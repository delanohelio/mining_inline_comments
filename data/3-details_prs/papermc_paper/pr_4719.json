{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNjQ1MDc1", "number": 4719, "title": "Throw proper exception on empty JsonList file", "bodyText": "Related to #4174, #4717.\nAs it stands, JsonList throws an NPE on jsonarray.iterator() when\nthe reader given is at EOF. This means there is an unintelligible\nmessage shown to the player:\n[16:44:31 ERROR]: Encountered an unexpected exception\njava.lang.NullPointerException: Cannot invoke \"com.google.gson.JsonArray.iterator()\" because \"jsonarray\" is null\n\tat net.minecraft.server.v1_16_R2.JsonList.load(JsonList.java:192) ~[patched_1.16.3.jar:git-Paper-248]\n\tat net.minecraft.server.v1_16_R2.DedicatedPlayerList.y(SourceFile:95) ~[patched_1.16.3.jar:git-Paper-248]\n\t...\n\nThis is clearly not understandable to the untrained eye: what is\njsonarray? What is DedicatedPlayerList.y?\nThis rather does a proper exception message:\n[16:42:59 ERROR]: Encountered an unexpected exception\njava.lang.NullPointerException: The file \"banned-players.json\" is either empty or corrupt\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:787) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\tat net.minecraft.server.v1_16_R2.JsonList.load(JsonList.java:190) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\tat net.minecraft.server.v1_16_R2.DedicatedPlayerList.y(SourceFile:95) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\t...\n\nIt is still an exception, which server owners may or may not understand,\nbut the message now says exactly what went wrong, and who would've\nknown, now we know what DedicatedPlayerList.y is, and we know what\nfile was broken.\nThis is more of a quality of life change, but it is certainly useful to\nthe server owners that come into #paper-help and the issue tracker\n(#4174) to ask for help with unintelligible messages we need to open a\npatched Paper project to make any sense out of.", "createdAt": "2020-11-01T15:48:08Z", "url": "https://github.com/PaperMC/Paper/pull/4719", "merged": true, "mergeCommit": {"oid": "fcc6d3359033a1fb2bdf38d63eb8881c80595606"}, "closed": true, "closedAt": "2021-03-03T20:56:04Z", "author": {"login": "Proximyst"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdapruaAFqTUyNTg2NDg0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABd_ndAvgBqjQ0MDQyNTI3Mjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODY0ODQ2", "url": "https://github.com/PaperMC/Paper/pull/4719#pullrequestreview-525864846", "createdAt": "2020-11-09T00:33:02Z", "commit": {"oid": "a24562c458411f29f7c143ef08424630319d519f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMDozMzowMlrOHvb2Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMDozMzowMlrOHvb2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwMTM2Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +                com.google.common.base.Preconditions.checkNotNull(jsonarray, \"The file \\\"\" + this.c.getName() + \"\\\" is either empty or corrupt\"); // Paper\n          \n          \n            \n            +                com.google.common.base.Preconditions.checkState(jsonarray != null, \"The file \\\"\" + this.c.getName() + \"\\\" is either empty or corrupt\"); // Paper", "url": "https://github.com/PaperMC/Paper/pull/4719#discussion_r519501363", "createdAt": "2020-11-09T00:33:02Z", "author": {"login": "kashike"}, "path": "Spigot-Server-Patches/0595-Throw-proper-exception-on-empty-JsonList-file.patch", "diffHunk": "@@ -0,0 +1,18 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Mariell Hoversholm <proximyst@proximyst.com>\n+Date: Sun, 1 Nov 2020 16:43:11 +0100\n+Subject: [PATCH] Throw proper exception on empty JsonList file\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/JsonList.java b/src/main/java/net/minecraft/server/JsonList.java\n+index 9213bfb78e92b838189161045e3945588251b486..9463db9df21f187593ee5ea649288e5bc34da720 100644\n+--- a/src/main/java/net/minecraft/server/JsonList.java\n++++ b/src/main/java/net/minecraft/server/JsonList.java\n+@@ -187,6 +187,7 @@ public abstract class JsonList<K, V extends JsonListEntry<K>> {\n+ \n+             try {\n+                 JsonArray jsonarray = (JsonArray) JsonList.b.fromJson(bufferedreader, JsonArray.class);\n++                com.google.common.base.Preconditions.checkNotNull(jsonarray, \"The file \\\"\" + this.c.getName() + \"\\\" is either empty or corrupt\"); // Paper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a24562c458411f29f7c143ef08424630319d519f"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0OTI2NDM4", "url": "https://github.com/PaperMC/Paper/pull/4719#pullrequestreview-564926438", "createdAt": "2021-01-11T01:45:14Z", "commit": {"oid": "7ecfcdc89a89374a8a2108c07fc2736c7aaecad3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb7fb6cb01fa80f565f4643f5266b38cd6a95a9c", "author": {"user": {"login": "Proximyst", "name": "Mariell Hoversholm"}}, "url": "https://github.com/PaperMC/Paper/commit/bb7fb6cb01fa80f565f4643f5266b38cd6a95a9c", "committedDate": "2021-03-03T20:51:54Z", "message": "Throw proper exception on empty JsonList file\n\nRelated to #4174, #4717.\n\nAs it stands, `JsonList` throws an NPE on `jsonarray.iterator()` when\nthe reader given is at EOF. This means there is an unintelligible\nmessage shown to the player:\n\n```\n[16:44:31 ERROR]: Encountered an unexpected exception\njava.lang.NullPointerException: Cannot invoke \"com.google.gson.JsonArray.iterator()\" because \"jsonarray\" is null\n\tat net.minecraft.server.v1_16_R2.JsonList.load(JsonList.java:192) ~[patched_1.16.3.jar:git-Paper-248]\n\tat net.minecraft.server.v1_16_R2.DedicatedPlayerList.y(SourceFile:95) ~[patched_1.16.3.jar:git-Paper-248]\n\t...\n```\n\nThis is clearly not understandable to the untrained eye: what is\n`jsonarray`? What is `DedicatedPlayerList.y`?\n\nThis rather does a proper exception message:\n\n```\n[16:42:59 ERROR]: Encountered an unexpected exception\njava.lang.NullPointerException: The file \"banned-players.json\" is either empty or corrupt\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:787) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\tat net.minecraft.server.v1_16_R2.JsonList.load(JsonList.java:190) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\tat net.minecraft.server.v1_16_R2.DedicatedPlayerList.y(SourceFile:95) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\t...\n```\n\nIt is still an exception, which server owners may or may not understand,\nbut the message now says exactly what went wrong, and who would've\nknown, now we know what `DedicatedPlayerList.y` is, and we know what\nfile was broken.\n\nThis is more of a quality of life change, but it is certainly useful to\nthe server owners that come into `#paper-help` and the issue tracker\n(#4174) to ask for help with unintelligible messages we need to open a\npatched Paper project to make any sense out of.\n\nCheck state of jsonarray instead of checkNotNull\n\nCo-authored-by: Riley Park <riley.park@meino.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ecfcdc89a89374a8a2108c07fc2736c7aaecad3", "author": {"user": {"login": "Proximyst", "name": "Mariell Hoversholm"}}, "url": "https://github.com/PaperMC/Paper/commit/7ecfcdc89a89374a8a2108c07fc2736c7aaecad3", "committedDate": "2020-11-09T21:38:44Z", "message": "Check state of jsonarray instead of checkNotNull\n\nCo-authored-by: Riley Park <riley.park@meino.net>"}, "afterCommit": {"oid": "bb7fb6cb01fa80f565f4643f5266b38cd6a95a9c", "author": {"user": {"login": "Proximyst", "name": "Mariell Hoversholm"}}, "url": "https://github.com/PaperMC/Paper/commit/bb7fb6cb01fa80f565f4643f5266b38cd6a95a9c", "committedDate": "2021-03-03T20:51:54Z", "message": "Throw proper exception on empty JsonList file\n\nRelated to #4174, #4717.\n\nAs it stands, `JsonList` throws an NPE on `jsonarray.iterator()` when\nthe reader given is at EOF. This means there is an unintelligible\nmessage shown to the player:\n\n```\n[16:44:31 ERROR]: Encountered an unexpected exception\njava.lang.NullPointerException: Cannot invoke \"com.google.gson.JsonArray.iterator()\" because \"jsonarray\" is null\n\tat net.minecraft.server.v1_16_R2.JsonList.load(JsonList.java:192) ~[patched_1.16.3.jar:git-Paper-248]\n\tat net.minecraft.server.v1_16_R2.DedicatedPlayerList.y(SourceFile:95) ~[patched_1.16.3.jar:git-Paper-248]\n\t...\n```\n\nThis is clearly not understandable to the untrained eye: what is\n`jsonarray`? What is `DedicatedPlayerList.y`?\n\nThis rather does a proper exception message:\n\n```\n[16:42:59 ERROR]: Encountered an unexpected exception\njava.lang.NullPointerException: The file \"banned-players.json\" is either empty or corrupt\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:787) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\tat net.minecraft.server.v1_16_R2.JsonList.load(JsonList.java:190) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\tat net.minecraft.server.v1_16_R2.DedicatedPlayerList.y(SourceFile:95) ~[paper-1.16.3.jar:git-Paper-\"8e6d90c2d\"]\n\t...\n```\n\nIt is still an exception, which server owners may or may not understand,\nbut the message now says exactly what went wrong, and who would've\nknown, now we know what `DedicatedPlayerList.y` is, and we know what\nfile was broken.\n\nThis is more of a quality of life change, but it is certainly useful to\nthe server owners that come into `#paper-help` and the issue tracker\n(#4174) to ask for help with unintelligible messages we need to open a\npatched Paper project to make any sense out of.\n\nCheck state of jsonarray instead of checkNotNull\n\nCo-authored-by: Riley Park <riley.park@meino.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1457, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}