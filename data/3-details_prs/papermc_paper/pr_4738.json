{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NDg2ODIx", "number": 4738, "title": "Significantly improve performance of the end generation", "bodyText": "Description\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\nNoise is the largest bottleneck in the ends generation, so by caching this where possible, the end now becomes the fastest world generated out of the three dimensions.\nThe terrain generated remains exactly the same as vanilla (seed for seed).\nTesting Results\nAll testing results were done using Chunky as a way to test the maximum chunks per second that could be achieved when generating the world.\nTesting procedure used the following commands on a fresh world using level seed 1\nchunky world world_the_end\nchunky center 5000 5000\nchunky radius 1000\nchunky start\n\nPaper #261\nCompletion time: 280026ms [4 minutes 42 seconds]\nChunks per second: 57 cps\nPaper #261 (with this patch)\nCompletion time: 86997ms [1 minute 24 seconds]\nChunks per second: 185 cps\nThe results are even more significant the larger of a radius you pregenerate, cutting hours upon hours off total world generation time.\nPR Notes\nIt's been years since I've contributed to Paper so forgive me if I missed anything :P I've tried my best to reduce diff as much as possible.\nThe authoring situation on the patch looks silly, but I wanted to credit everyone involved in making this happen as much as possible.", "createdAt": "2020-11-06T04:30:31Z", "url": "https://github.com/PaperMC/Paper/pull/4738", "merged": true, "mergeCommit": {"oid": "821ce25d95ef5aa33a7134c640258e239769fdac"}, "closed": true, "closedAt": "2020-11-19T20:02:09Z", "author": {"login": "Puremin0rez"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZwJfUgFqTUyNDg2NjU2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeIYgJAFqTUzNDgwMzg4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0ODY2NTY5", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-524866569", "createdAt": "2020-11-06T05:31:08Z", "commit": {"oid": "1f868a4d85f10f645db874fef70ea84052ee70bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNTozMTowOVrOHugqpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNTozMTowOVrOHugqpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUzMTc1MA==", "bodyText": "how often is it <= 4096? If this happens often, we should skip cache logic for this\nlike\nif (<= 4096)  f1 = minvalue\nelse if (incache)\nso that the cache isn't getting clobbered by static values", "url": "https://github.com/PaperMC/Paper/pull/4738#discussion_r518531750", "createdAt": "2020-11-06T05:31:09Z", "author": {"login": "aikar"}, "path": "Spigot-Server-Patches/0594-Significantly-improve-performance-of-the-end-generat.patch", "diffHunk": "@@ -0,0 +1,58 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: SuperCoder7979 <k.pranav@gmail.com>\n+Date: Tue, 3 Nov 2020 23:48:05 -0600\n+Subject: [PATCH] Significantly improve performance of the end generation\n+\n+This patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n+\n+Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n+\n+Co-authored-by: Gegy <gegy1000@gmail.com>\n+Co-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\n+Co-authored-by: pop4959 <pop4959@gmail.com>\n+\n+diff --git a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+index 9c15cd303ccc2928be4e3e7080e74e8314d7e0f2..eb370c226d401ad0d1b29f054b34e6cfb5d192c1 100644\n+--- a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n++++ b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+@@ -3,6 +3,7 @@ package net.minecraft.server;\n+ import com.google.common.collect.ImmutableList;\n+ import com.mojang.serialization.Codec;\n+ import com.mojang.serialization.codecs.RecordCodecBuilder;\n++import it.unimi.dsi.fastutil.HashCommon; // Paper\n+ import java.util.List;\n+ \n+ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+@@ -22,6 +23,8 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+     private final BiomeBase k;\n+     private final BiomeBase l;\n+     private final BiomeBase m;\n++    private static final long[] keys = new long[8192]; // Paper\n++    private static final float[] values = new float[8192]; // Paper\n+ \n+     public WorldChunkManagerTheEnd(IRegistry<BiomeBase> iregistry, long i) {\n+         this(iregistry, i, (BiomeBase) iregistry.d(Biomes.THE_END), (BiomeBase) iregistry.d(Biomes.END_HIGHLANDS), (BiomeBase) iregistry.d(Biomes.END_MIDLANDS), (BiomeBase) iregistry.d(Biomes.SMALL_END_ISLANDS), (BiomeBase) iregistry.d(Biomes.END_BARRENS));\n+@@ -81,8 +84,21 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+                 long i2 = (long) (k + k1);\n+                 long j2 = (long) (l + l1);\n+ \n+-                if (i2 * i2 + j2 * j2 > 4096L && noisegenerator3handler.a((double) i2, (double) j2) < -0.8999999761581421D) {\n+-                    float f1 = (MathHelper.e((float) i2) * 3439.0F + MathHelper.e((float) j2) * 147.0F) % 13.0F + 9.0F;\n++                // Paper start - Significantly improve end generation performance by using a noise cache\n++                long key = ChunkCoordIntPair.pair((int) i2, (int) j2);\n++                int index = (int) HashCommon.mix(key) & 8191;\n++                float f1 = Long.MIN_VALUE;\n++                if (keys[index] == key) {\n++                    f1 = values[index];\n++                } else {\n++                    if (i2 * i2 + j2 * j2 > 4096L && noisegenerator3handler.a((double) i2, (double) j2) < -0.8999999761581421D) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f868a4d85f10f645db874fef70ea84052ee70bc"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f868a4d85f10f645db874fef70ea84052ee70bc", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/1f868a4d85f10f645db874fef70ea84052ee70bc", "committedDate": "2020-11-06T03:37:46Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}, "afterCommit": {"oid": "031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2", "committedDate": "2020-11-07T00:51:08Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMyNzI0", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-525632724", "createdAt": "2020-11-07T06:48:31Z", "commit": {"oid": "031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjo0ODozMVrOHvFshA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjo0ODozMVrOHvFshA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEzODQzNg==", "bodyText": "This should probably be stored per-generator-instance. Even then there\u2019s still a concern of handling threaded generation since this cache does not work concurrently- is it possible for concurrent generation of chunks on the same generator instance with Paper?", "url": "https://github.com/PaperMC/Paper/pull/4738#discussion_r519138436", "createdAt": "2020-11-07T06:48:31Z", "author": {"login": "Gegy"}, "path": "Spigot-Server-Patches/0594-Significantly-improve-performance-of-the-end-generat.patch", "diffHunk": "@@ -0,0 +1,58 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: SuperCoder7979 <25208576+SuperCoder7979@users.noreply.github.com>\n+Date: Tue, 3 Nov 2020 23:48:05 -0600\n+Subject: [PATCH] Significantly improve performance of the end generation\n+\n+This patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n+\n+Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n+\n+Co-authored-by: Gegy <gegy1000@gmail.com>\n+Co-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\n+Co-authored-by: pop4959 <pop4959@gmail.com>\n+\n+diff --git a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+index 9c15cd303ccc2928be4e3e7080e74e8314d7e0f2..eb370c226d401ad0d1b29f054b34e6cfb5d192c1 100644\n+--- a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n++++ b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+@@ -3,6 +3,7 @@ package net.minecraft.server;\n+ import com.google.common.collect.ImmutableList;\n+ import com.mojang.serialization.Codec;\n+ import com.mojang.serialization.codecs.RecordCodecBuilder;\n++import it.unimi.dsi.fastutil.HashCommon; // Paper\n+ import java.util.List;\n+ \n+ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+@@ -22,6 +23,8 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+     private final BiomeBase k;\n+     private final BiomeBase l;\n+     private final BiomeBase m;\n++    private static final long[] keys = new long[8192]; // Paper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODY0NTcx", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-525864571", "createdAt": "2020-11-09T00:31:05Z", "commit": {"oid": "031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/031a3f564ac79ddfa8dbf26a749c9a6a9a787fd2", "committedDate": "2020-11-07T00:51:08Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}, "afterCommit": {"oid": "ad3682e8751e6044caac6afa1e400a1617924af0", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/ad3682e8751e6044caac6afa1e400a1617924af0", "committedDate": "2020-11-12T00:57:14Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODMwMjg0", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-528830284", "createdAt": "2020-11-12T08:03:15Z", "commit": {"oid": "ad3682e8751e6044caac6afa1e400a1617924af0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODowMzoxNVrOHxuk0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODowMzoxNVrOHxuk0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwNTM2Mg==", "bodyText": "Might be beneficial to avoid the double map-lookup by storing a separate object that contains the keys and values?", "url": "https://github.com/PaperMC/Paper/pull/4738#discussion_r521905362", "createdAt": "2020-11-12T08:03:15Z", "author": {"login": "Gegy"}, "path": "Spigot-Server-Patches/0594-Significantly-improve-performance-of-the-end-generat.patch", "diffHunk": "@@ -0,0 +1,79 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: SuperCoder7979 <25208576+SuperCoder7979@users.noreply.github.com>\n+Date: Tue, 3 Nov 2020 23:48:05 -0600\n+Subject: [PATCH] Significantly improve performance of the end generation\n+\n+This patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n+\n+Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n+\n+Co-authored-by: Gegy <gegy1000@gmail.com>\n+Co-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\n+Co-authored-by: pop4959 <pop4959@gmail.com>\n+\n+diff --git a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+index 9c15cd303ccc2928be4e3e7080e74e8314d7e0f2..195a9b53062f7d3896d17210989d6785ea4baee3 100644\n+--- a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n++++ b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+@@ -3,6 +3,9 @@ package net.minecraft.server;\n+ import com.google.common.collect.ImmutableList;\n+ import com.mojang.serialization.Codec;\n+ import com.mojang.serialization.codecs.RecordCodecBuilder;\n++import it.unimi.dsi.fastutil.HashCommon; // Paper\n++import it.unimi.dsi.fastutil.objects.Object2ObjectLinkedOpenHashMap; // Paper\n++import it.unimi.dsi.fastutil.objects.Object2ObjectMap; // Paper\n+ import java.util.List;\n+ \n+ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+@@ -22,6 +25,13 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+     private final BiomeBase k;\n+     private final BiomeBase l;\n+     private final BiomeBase m;\n++    // Paper start\n++    private static final class NoiseCache {\n++        public Object2ObjectMap<NoiseGenerator3Handler, long[]> keys = new Object2ObjectLinkedOpenHashMap<>();\n++        public Object2ObjectMap<NoiseGenerator3Handler, float[]> values = new Object2ObjectLinkedOpenHashMap<>();\n++    }\n++    private static final ThreadLocal<NoiseCache> noiseCache = ThreadLocal.withInitial(NoiseCache::new);\n++    // Paper end\n+ \n+     public WorldChunkManagerTheEnd(IRegistry<BiomeBase> iregistry, long i) {\n+         this(iregistry, i, (BiomeBase) iregistry.d(Biomes.THE_END), (BiomeBase) iregistry.d(Biomes.END_HIGHLANDS), (BiomeBase) iregistry.d(Biomes.END_MIDLANDS), (BiomeBase) iregistry.d(Biomes.SMALL_END_ISLANDS), (BiomeBase) iregistry.d(Biomes.END_BARRENS));\n+@@ -76,13 +86,35 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+ \n+         f = MathHelper.a(f, -100.0F, 80.0F);\n+ \n++        // Paper start\n++        NoiseCache cache = noiseCache.get();\n++        long[] keys = cache.keys.computeIfAbsent(noisegenerator3handler, m -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad3682e8751e6044caac6afa1e400a1617924af0"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODMwNjk3", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-528830697", "createdAt": "2020-11-12T08:03:54Z", "commit": {"oid": "ad3682e8751e6044caac6afa1e400a1617924af0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODowMzo1NFrOHxul9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODowMzo1NFrOHxul9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwNTY1NA==", "bodyText": "This probably shouldn't need to use a linked map. Possibly even can use a Reference2ObjectMap, which can give better performance if reference equality is valid here?", "url": "https://github.com/PaperMC/Paper/pull/4738#discussion_r521905654", "createdAt": "2020-11-12T08:03:54Z", "author": {"login": "Gegy"}, "path": "Spigot-Server-Patches/0594-Significantly-improve-performance-of-the-end-generat.patch", "diffHunk": "@@ -0,0 +1,79 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: SuperCoder7979 <25208576+SuperCoder7979@users.noreply.github.com>\n+Date: Tue, 3 Nov 2020 23:48:05 -0600\n+Subject: [PATCH] Significantly improve performance of the end generation\n+\n+This patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n+\n+Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n+\n+Co-authored-by: Gegy <gegy1000@gmail.com>\n+Co-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\n+Co-authored-by: pop4959 <pop4959@gmail.com>\n+\n+diff --git a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+index 9c15cd303ccc2928be4e3e7080e74e8314d7e0f2..195a9b53062f7d3896d17210989d6785ea4baee3 100644\n+--- a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n++++ b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+@@ -3,6 +3,9 @@ package net.minecraft.server;\n+ import com.google.common.collect.ImmutableList;\n+ import com.mojang.serialization.Codec;\n+ import com.mojang.serialization.codecs.RecordCodecBuilder;\n++import it.unimi.dsi.fastutil.HashCommon; // Paper\n++import it.unimi.dsi.fastutil.objects.Object2ObjectLinkedOpenHashMap; // Paper\n++import it.unimi.dsi.fastutil.objects.Object2ObjectMap; // Paper\n+ import java.util.List;\n+ \n+ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+@@ -22,6 +25,13 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+     private final BiomeBase k;\n+     private final BiomeBase l;\n+     private final BiomeBase m;\n++    // Paper start\n++    private static final class NoiseCache {\n++        public Object2ObjectMap<NoiseGenerator3Handler, long[]> keys = new Object2ObjectLinkedOpenHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad3682e8751e6044caac6afa1e400a1617924af0"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad3682e8751e6044caac6afa1e400a1617924af0", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/ad3682e8751e6044caac6afa1e400a1617924af0", "committedDate": "2020-11-12T00:57:14Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}, "afterCommit": {"oid": "27d560e37d293cfdc7241a5d4863fcdfbf59f583", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/27d560e37d293cfdc7241a5d4863fcdfbf59f583", "committedDate": "2020-11-13T06:55:37Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTk3NjUx", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-530597651", "createdAt": "2020-11-14T18:59:28Z", "commit": {"oid": "27d560e37d293cfdc7241a5d4863fcdfbf59f583"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxODo1OToyOFrOHzM7Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxODo1OToyOFrOHzM7Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ1MTIxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n          \n          \n            \n            Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: <https://github.com/jellysquid3/lithium-fabric>)", "url": "https://github.com/PaperMC/Paper/pull/4738#discussion_r523451214", "createdAt": "2020-11-14T18:59:28Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0594-Significantly-improve-performance-of-the-end-generat.patch", "diffHunk": "@@ -0,0 +1,74 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: SuperCoder7979 <25208576+SuperCoder7979@users.noreply.github.com>\n+Date: Tue, 3 Nov 2020 23:48:05 -0600\n+Subject: [PATCH] Significantly improve performance of the end generation\n+\n+This patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n+\n+Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d560e37d293cfdc7241a5d4863fcdfbf59f583"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27d560e37d293cfdc7241a5d4863fcdfbf59f583", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/27d560e37d293cfdc7241a5d4863fcdfbf59f583", "committedDate": "2020-11-13T06:55:37Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 <Source: https://github.com/jellysquid3/lithium-fabric>\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}, "afterCommit": {"oid": "0f37e31cb86a3f150aff0cf37072ef80682ef5b0", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/0f37e31cb86a3f150aff0cf37072ef80682ef5b0", "committedDate": "2020-11-14T22:15:11Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNjA5OTY2", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-530609966", "createdAt": "2020-11-14T22:53:29Z", "commit": {"oid": "0f37e31cb86a3f150aff0cf37072ef80682ef5b0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNjEwMDg2", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-530610086", "createdAt": "2020-11-14T22:56:00Z", "commit": {"oid": "0f37e31cb86a3f150aff0cf37072ef80682ef5b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQyMjo1NjowMFrOHzORfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQyMjo1NjowMFrOHzORfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ3MzI3OQ==", "bodyText": "Not really sure that a ThreadLocal is the best idea, especially if you have worlds loading/unloading, any reason why this is preferred over just using a standard map/array?\nThere's no real garauntees over how threads will be handled, e.g. if we get parallel, will it be using multiple threads which are killed afterwards, etc\nCould just store it in a singular array per manager, that way you can \"guarantee\" enough safety there", "url": "https://github.com/PaperMC/Paper/pull/4738#discussion_r523473279", "createdAt": "2020-11-14T22:56:00Z", "author": {"login": "electronicboy"}, "path": "Spigot-Server-Patches/0594-Significantly-improve-performance-of-the-end-generat.patch", "diffHunk": "@@ -0,0 +1,74 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: SuperCoder7979 <25208576+SuperCoder7979@users.noreply.github.com>\n+Date: Tue, 3 Nov 2020 23:48:05 -0600\n+Subject: [PATCH] Significantly improve performance of the end generation\n+\n+This patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n+\n+Original code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n+\n+Co-authored-by: Gegy <gegy1000@gmail.com>\n+Co-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\n+Co-authored-by: pop4959 <pop4959@gmail.com>\n+\n+diff --git a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+index 9c15cd303ccc2928be4e3e7080e74e8314d7e0f2..3604f815ab3df190e0582f279d3164af8b6f6880 100644\n+--- a/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n++++ b/src/main/java/net/minecraft/server/WorldChunkManagerTheEnd.java\n+@@ -3,6 +3,9 @@ package net.minecraft.server;\n+ import com.google.common.collect.ImmutableList;\n+ import com.mojang.serialization.Codec;\n+ import com.mojang.serialization.codecs.RecordCodecBuilder;\n++import it.unimi.dsi.fastutil.HashCommon; // Paper\n++import it.unimi.dsi.fastutil.objects.Reference2ObjectMap; // Paper\n++import it.unimi.dsi.fastutil.objects.Reference2ObjectOpenHashMap; // Paper\n+ import java.util.List;\n+ \n+ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+@@ -22,6 +25,16 @@ public class WorldChunkManagerTheEnd extends WorldChunkManager {\n+     private final BiomeBase k;\n+     private final BiomeBase l;\n+     private final BiomeBase m;\n++    // Paper start\n++    private static final class NoiseCache {\n++        public long[] keys = new long[8192];\n++        public float[] values = new float[8192];\n++        public NoiseCache() {\n++            java.util.Arrays.fill(keys, Long.MIN_VALUE);\n++        }\n++    }\n++    private static final ThreadLocal<Reference2ObjectMap<NoiseGenerator3Handler, NoiseCache>> noiseCache = ThreadLocal.withInitial(Reference2ObjectOpenHashMap::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f37e31cb86a3f150aff0cf37072ef80682ef5b0"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDc0MTE0", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-531474114", "createdAt": "2020-11-16T16:13:02Z", "commit": {"oid": "0f37e31cb86a3f150aff0cf37072ef80682ef5b0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f37e31cb86a3f150aff0cf37072ef80682ef5b0", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/0f37e31cb86a3f150aff0cf37072ef80682ef5b0", "committedDate": "2020-11-14T22:15:11Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}, "afterCommit": {"oid": "38ea285eed325a18e2344b15d1b543639e16a56f", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/38ea285eed325a18e2344b15d1b543639e16a56f", "committedDate": "2020-11-18T22:23:10Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTk1ODY0", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-533995864", "createdAt": "2020-11-19T00:45:13Z", "commit": {"oid": "38ea285eed325a18e2344b15d1b543639e16a56f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87280857f75c87f7a3e0888b61bd790fccc09c11", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/87280857f75c87f7a3e0888b61bd790fccc09c11", "committedDate": "2020-11-19T19:51:08Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38ea285eed325a18e2344b15d1b543639e16a56f", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/38ea285eed325a18e2344b15d1b543639e16a56f", "committedDate": "2020-11-18T22:23:10Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}, "afterCommit": {"oid": "87280857f75c87f7a3e0888b61bd790fccc09c11", "author": {"user": {"login": "SuperCoder7979", "name": "SuperCoder79"}}, "url": "https://github.com/PaperMC/Paper/commit/87280857f75c87f7a3e0888b61bd790fccc09c11", "committedDate": "2020-11-19T19:51:08Z", "message": "Significantly improve performance of the end generation\n\nThis patch implements a noise cache for the end which significantly reduces the computation time of generation. This results in about a 3x improvement.\n\nOriginal code by SuperCoder7979 and Gegy in Lithium, licensed under LGPL-3.0 (Source: https://github.com/jellysquid3/lithium-fabric)\n\nCo-authored-by: Gegy <gegy1000@gmail.com>\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>\nCo-authored-by: pop4959 <pop4959@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODAzODgw", "url": "https://github.com/PaperMC/Paper/pull/4738#pullrequestreview-534803880", "createdAt": "2020-11-19T20:00:58Z", "commit": {"oid": "87280857f75c87f7a3e0888b61bd790fccc09c11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1468, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}