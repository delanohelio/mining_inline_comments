{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MDcwOTQy", "number": 3026, "title": "Call BlockRedstoneEvent for fence gates", "bodyText": "Fixes #3025\nThe code for this patch was heavily based on the patch for BlockDoor, but I don't think there's an elegant way to share code between the two patches.\nI tested the patch using the example plugin described in the bugreport, everything seems to work fine. As with BlockDoor, the BlockRedstoneEvent is only called when the fence gate actually changes from an open state to a closed state or vice versa. More specifically; redstone power level changes where both the old and new power levels are above 0 are ignored for this event.", "createdAt": "2020-03-14T00:04:17Z", "url": "https://github.com/PaperMC/Paper/pull/3026", "merged": true, "mergeCommit": {"oid": "0ad8cf73ff1d8f5dd61354e4bc986faee996ca89"}, "closed": true, "closedAt": "2020-03-14T13:39:55Z", "author": {"login": "Jannyboy11"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNitpsAFqTM3NDcxNDA2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNlFJ-gFqTM3NDcyNzg4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzE0MDY4", "url": "https://github.com/PaperMC/Paper/pull/3026#pullrequestreview-374714068", "createdAt": "2020-03-14T10:51:30Z", "commit": {"oid": "0a19e09ab704b430a5ddddb48fcc4d96c758c8f8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMDo1MTozMFrOF2Y8Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMDo1MTo1OVrOF2Y8Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NjA0Mw==", "bodyText": "CraftBlock#at", "url": "https://github.com/PaperMC/Paper/pull/3026#discussion_r392576043", "createdAt": "2020-03-14T10:51:30Z", "author": {"login": "electronicboy"}, "path": "Spigot-Server-Patches/0449-Call-BlockRedstoneEvent-for-fence-gates.patch", "diffHunk": "@@ -0,0 +1,50 @@\n+From 786852e993b9699be0adde0b4641bf455a344650 Mon Sep 17 00:00:00 2001\n+From: Jan Boerman <Janboerman95@gmail.com>\n+Date: Sat, 14 Mar 2020 00:53:51 +0100\n+Subject: [PATCH] Call BlockRedstoneEvent for fence gates\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/BlockFenceGate.java b/src/main/java/net/minecraft/server/BlockFenceGate.java\n+index 432e47bb..3107fa98 100644\n+--- a/src/main/java/net/minecraft/server/BlockFenceGate.java\n++++ b/src/main/java/net/minecraft/server/BlockFenceGate.java\n+@@ -102,15 +102,28 @@ public class BlockFenceGate extends BlockFacingHorizontal {\n+     @Override\n+     public void doPhysics(IBlockData iblockdata, World world, BlockPosition blockposition, Block block, BlockPosition blockposition1, boolean flag) {\n+         if (!world.isClientSide) {\n+-            boolean flag1 = world.isBlockIndirectlyPowered(blockposition);\n+-\n+-            if ((Boolean) iblockdata.get(BlockFenceGate.POWERED) != flag1) {\n+-                world.setTypeAndData(blockposition, (IBlockData) ((IBlockData) iblockdata.set(BlockFenceGate.POWERED, flag1)).set(BlockFenceGate.OPEN, flag1), 2);\n+-                if ((Boolean) iblockdata.get(BlockFenceGate.OPEN) != flag1) {\n+-                    world.a((EntityHuman) null, flag1 ? 1008 : 1014, blockposition, 0);\n++            // Paper start\n++            org.bukkit.World bworld = world.getWorld();\n++            org.bukkit.block.Block bukkitBlock = bworld.getBlockAt(blockposition.getX(), blockposition.getY(), blockposition.getZ());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a19e09ab704b430a5ddddb48fcc4d96c758c8f8"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NjA3MA==", "bodyText": "don't indent vanilla code, it's not pretty, but helps with merging, etc", "url": "https://github.com/PaperMC/Paper/pull/3026#discussion_r392576070", "createdAt": "2020-03-14T10:51:59Z", "author": {"login": "electronicboy"}, "path": "Spigot-Server-Patches/0449-Call-BlockRedstoneEvent-for-fence-gates.patch", "diffHunk": "@@ -0,0 +1,50 @@\n+From 786852e993b9699be0adde0b4641bf455a344650 Mon Sep 17 00:00:00 2001\n+From: Jan Boerman <Janboerman95@gmail.com>\n+Date: Sat, 14 Mar 2020 00:53:51 +0100\n+Subject: [PATCH] Call BlockRedstoneEvent for fence gates\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/BlockFenceGate.java b/src/main/java/net/minecraft/server/BlockFenceGate.java\n+index 432e47bb..3107fa98 100644\n+--- a/src/main/java/net/minecraft/server/BlockFenceGate.java\n++++ b/src/main/java/net/minecraft/server/BlockFenceGate.java\n+@@ -102,15 +102,28 @@ public class BlockFenceGate extends BlockFacingHorizontal {\n+     @Override\n+     public void doPhysics(IBlockData iblockdata, World world, BlockPosition blockposition, Block block, BlockPosition blockposition1, boolean flag) {\n+         if (!world.isClientSide) {\n+-            boolean flag1 = world.isBlockIndirectlyPowered(blockposition);\n+-\n+-            if ((Boolean) iblockdata.get(BlockFenceGate.POWERED) != flag1) {\n+-                world.setTypeAndData(blockposition, (IBlockData) ((IBlockData) iblockdata.set(BlockFenceGate.POWERED, flag1)).set(BlockFenceGate.OPEN, flag1), 2);\n+-                if ((Boolean) iblockdata.get(BlockFenceGate.OPEN) != flag1) {\n+-                    world.a((EntityHuman) null, flag1 ? 1008 : 1014, blockposition, 0);\n++            // Paper start\n++            org.bukkit.World bworld = world.getWorld();\n++            org.bukkit.block.Block bukkitBlock = bworld.getBlockAt(blockposition.getX(), blockposition.getY(), blockposition.getZ());\n++\n++            int power = bukkitBlock.getBlockPower();\n++            int oldPower = iblockdata.get(BlockFenceGate.POWERED) ? 15 : 0;\n++\n++            if ((oldPower == 0) != (power == 0)) {\n++                // if power changes from on to off, or vice versa\n++                org.bukkit.event.block.BlockRedstoneEvent redstoneEvent = new org.bukkit.event.block.BlockRedstoneEvent(bukkitBlock, oldPower, power);\n++                world.getServer().getPluginManager().callEvent(redstoneEvent);\n++                boolean flag1 = redstoneEvent.getNewCurrent() > 0;\n++                // boolean flag1 = world.isBlockIndirectlyPowered(blockposition); // Paper - replaced by event outcome", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a19e09ab704b430a5ddddb48fcc4d96c758c8f8"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4c121d0c651a76f6e7abe6bcc3036c3ed54a4cf", "author": {"user": {"login": "Jankoekenpan", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/f4c121d0c651a76f6e7abe6bcc3036c3ed54a4cf", "committedDate": "2020-03-14T13:28:08Z", "message": "Call BlockRedstoneEvent for fence gates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzI3ODg4", "url": "https://github.com/PaperMC/Paper/pull/3026#pullrequestreview-374727888", "createdAt": "2020-03-14T13:39:13Z", "commit": {"oid": "f4c121d0c651a76f6e7abe6bcc3036c3ed54a4cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1234, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}