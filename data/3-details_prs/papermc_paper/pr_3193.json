{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NzQ2NDMz", "number": 3193, "title": "Implement Brigadier Mojang API", "bodyText": "This is the start of a new module for Paper to add support for API's\nthat interface Mojang API's directly.\nThis allows us to version properly by MC version incase Mojang makes any major breaking changes.\nIt also lets us separate Mojang API's from Paper-API so our downstream friends at Glowstone\nwill not have to worry about Mojang code.\nAdds AsyncPlayerSendCommandsEvent\n\nAllows modifying on a per command basis what command data they see.\n\nAdds CommandRegisteredEvent\n\nAllows manipulating the CommandNode to add more children/metadata for the client", "createdAt": "2020-04-19T22:22:14Z", "url": "https://github.com/PaperMC/Paper/pull/3193", "merged": true, "mergeCommit": {"oid": "fdf41b742d5e78e7e97659a829f43803c61efb8f"}, "closed": true, "closedAt": "2020-04-27T05:46:26Z", "author": {"login": "aikar"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZSuwYgFqTM5NjA3MjM1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcboqAFgBqjMyNzQwNjI0Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDcyMzU0", "url": "https://github.com/PaperMC/Paper/pull/3193#pullrequestreview-396072354", "createdAt": "2020-04-19T23:01:42Z", "commit": {"oid": "96f24f8716ee709a891c4e7ab22a4126dc9e9387"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMzowMTo0MlrOGH-H6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMzowMTo0MlrOGH-H6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAxMTA1MQ==", "bodyText": "Wasn't this supposed to be called AsyncPlayerSendCommandsEvent?", "url": "https://github.com/PaperMC/Paper/pull/3193#discussion_r411011051", "createdAt": "2020-04-19T23:01:42Z", "author": {"login": "JavierKasunic"}, "path": "Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommands.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.destroystokyo.paper.event.brigadier;\n+\n+import com.mojang.brigadier.tree.RootCommandNode;\n+import org.bukkit.Bukkit;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.HandlerList;\n+import org.bukkit.event.player.PlayerEvent;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Fired any time a Brigadier RootCommandNode is generated for a player to inform the client of commands.\n+ * You may manipulate this CommandNode to change what the client sees.\n+ *\n+ * This event may fire on login, world change, and permission rebuilds, by plugin request, and potentially future means.\n+ *\n+ * WARNING: This event will potentially (and most likely) fire twice! Once for Async, and once again for Sync.\n+ * It is important that you check event.isAsync() and event.hasFiredAsync() to ensure you only act once.\n+ * If for some reason we are unable to send this asynchronously in the future, only the sync method will fire.\n+ *\n+ * Your logic should look like this:\n+ * if (event.isAsync() || (!event.isAsync() && !event.hasFiredAsync())) { do stuff }\n+ *\n+ * If your logic is not safe to run asynchronously, only react to the synchronous version.\n+ */\n+public class AsyncPlayerSendCommands extends PlayerEvent {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96f24f8716ee709a891c4e7ab22a4126dc9e9387"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NDcxMzEy", "url": "https://github.com/PaperMC/Paper/pull/3193#pullrequestreview-397471312", "createdAt": "2020-04-21T16:28:59Z", "commit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNjoyODo1OVrOGJNNEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNjoyODo1OVrOGJNNEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMwNjcwNQ==", "bodyText": "I know this is pseudo code, but for easy copy and pasting, this and the reference in line 20 should prolly say isAsynchronous since thats the proper name of the method.\nIntelliJ also reminded me, that this can be simplified to event.isAsynchronous() || !event.hasFiredAsync()", "url": "https://github.com/PaperMC/Paper/pull/3193#discussion_r412306705", "createdAt": "2020-04-21T16:28:59Z", "author": {"login": "MiniDigger"}, "path": "Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.destroystokyo.paper.event.brigadier;\n+\n+import com.mojang.brigadier.tree.RootCommandNode;\n+import org.bukkit.Bukkit;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.HandlerList;\n+import org.bukkit.event.player.PlayerEvent;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Fired any time a Brigadier RootCommandNode is generated for a player to inform the client of commands.\n+ * You may manipulate this CommandNode to change what the client sees.\n+ *\n+ * This event may fire on login, world change, and permission rebuilds, by plugin request, and potentially future means.\n+ *\n+ * This event will fire before {@link org.bukkit.event.player.PlayerCommandSendEvent}, so no filtering has been done by\n+ * other plugins yet.\n+ *\n+ * WARNING: This event will potentially (and most likely) fire twice! Once for Async, and once again for Sync.\n+ * It is important that you check event.isAsync() and event.hasFiredAsync() to ensure you only act once.\n+ * If for some reason we are unable to send this asynchronously in the future, only the sync method will fire.\n+ *\n+ * Your logic should look like this:\n+ * if (event.isAsync() || (!event.isAsync() && !event.hasFiredAsync())) { do stuff }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTM1Nzkw", "url": "https://github.com/PaperMC/Paper/pull/3193#pullrequestreview-397535790", "createdAt": "2020-04-21T17:47:29Z", "commit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTc2MTgw", "url": "https://github.com/PaperMC/Paper/pull/3193#pullrequestreview-397576180", "createdAt": "2020-04-21T18:41:08Z", "commit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTc4NDk4", "url": "https://github.com/PaperMC/Paper/pull/3193#pullrequestreview-397578498", "createdAt": "2020-04-21T18:44:26Z", "commit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxODo0NDoyNlrOGJTGvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxODo0NDoyNlrOGJTGvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMzM4OA==", "bodyText": "I do not think this change is in the correct patch?", "url": "https://github.com/PaperMC/Paper/pull/3193#discussion_r412403388", "createdAt": "2020-04-21T18:44:26Z", "author": {"login": "chickeneer"}, "path": "Spigot-API-Patches/0001-POM-changes.patch", "diffHunk": "@@ -110,6 +110,19 @@ index 8964b9e33..ce09baeab 100644\n                      <!-- when downloading via Maven we can pull depends individually -->\n                      <shadedArtifactAttached>true</shadedArtifactAttached>\n                  </configuration>\n+diff --git a/src/main/java/org/bukkit/event/player/PlayerEvent.java b/src/main/java/org/bukkit/event/player/PlayerEvent.java\n+index 793b661b..b7c8f2c3 100644\n+--- a/src/main/java/org/bukkit/event/player/PlayerEvent.java\n++++ b/src/main/java/org/bukkit/event/player/PlayerEvent.java\n+@@ -14,7 +14,7 @@ public abstract class PlayerEvent extends Event {\n+         player = who;\n+     }\n+ \n+-    PlayerEvent(@NotNull final Player who, boolean async) {\n++    public PlayerEvent(@NotNull final Player who, boolean async) { // Paper - wtf?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69", "author": {"user": {"login": "aikar", "name": "Daniel Ennis"}}, "url": "https://github.com/PaperMC/Paper/commit/7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69", "committedDate": "2020-04-20T07:03:15Z", "message": "Properly handle Brigadier Command Source generics\n\nExpose Command Context such as Entity, Location, etc"}, "afterCommit": {"oid": "76f1a9c9d2129cfd707f2de41616d3248358c1e5", "author": {"user": {"login": "aikar", "name": "Daniel Ennis"}}, "url": "https://github.com/PaperMC/Paper/commit/76f1a9c9d2129cfd707f2de41616d3248358c1e5", "committedDate": "2020-04-23T08:16:24Z", "message": "Rebase master, More updates, fix generics on Send Event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdf41b742d5e78e7e97659a829f43803c61efb8f", "author": {"user": {"login": "aikar", "name": "Daniel Ennis"}}, "url": "https://github.com/PaperMC/Paper/commit/fdf41b742d5e78e7e97659a829f43803c61efb8f", "committedDate": "2020-04-27T05:42:12Z", "message": "Implement Brigadier Mojang API\n\nThis is the start of a new module for Paper to add support for API's\nthat interface Mojang API's directly.\n\nThis allows us to version properly by MC version incase Mojang makes any major breaking changes.\n\nIt also lets us separate Mojang API's from Paper-API so our downstream friends at Glowstone\nwill not have to worry about Mojang code.\n\nAdds AsyncPlayerSendCommandsEvent\n  - Allows modifying on a per command basis what command data they see.\n\nAdds CommandRegisteredEvent\n  - Allows manipulating the CommandNode to add more children/metadata for the client"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76f1a9c9d2129cfd707f2de41616d3248358c1e5", "author": {"user": {"login": "aikar", "name": "Daniel Ennis"}}, "url": "https://github.com/PaperMC/Paper/commit/76f1a9c9d2129cfd707f2de41616d3248358c1e5", "committedDate": "2020-04-23T08:16:24Z", "message": "Rebase master, More updates, fix generics on Send Event"}, "afterCommit": {"oid": "fdf41b742d5e78e7e97659a829f43803c61efb8f", "author": {"user": {"login": "aikar", "name": "Daniel Ennis"}}, "url": "https://github.com/PaperMC/Paper/commit/fdf41b742d5e78e7e97659a829f43803c61efb8f", "committedDate": "2020-04-27T05:42:12Z", "message": "Implement Brigadier Mojang API\n\nThis is the start of a new module for Paper to add support for API's\nthat interface Mojang API's directly.\n\nThis allows us to version properly by MC version incase Mojang makes any major breaking changes.\n\nIt also lets us separate Mojang API's from Paper-API so our downstream friends at Glowstone\nwill not have to worry about Mojang code.\n\nAdds AsyncPlayerSendCommandsEvent\n  - Allows modifying on a per command basis what command data they see.\n\nAdds CommandRegisteredEvent\n  - Allows manipulating the CommandNode to add more children/metadata for the client"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1271, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}