{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MjAyNzcx", "number": 4132, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMzo0ODo1NFrOEYpQIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMzo0ODo1NFrOEYpQIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Mjc3MTUzOnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0548-Don-t-mark-null-chunk-sections-for-block-updates.patch", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMzo0ODo1NFrOHBF7bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwODoyMjoxMVrOHBIu4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwNzc1Nw==", "bodyText": "I was working on a similar problem and think this solution may cause issues. I believe it's still valid to try to update positions in null chunk sections for purposes of updating fake blocks. I opened a related issue to spigot: https://hub.spigotmc.org/jira/projects/SPIGOT/issues/SPIGOT-6076", "url": "https://github.com/PaperMC/Paper/pull/4132#discussion_r470907757", "createdAt": "2020-08-14T23:48:54Z", "author": {"login": "mergu"}, "path": "Spigot-Server-Patches/0548-Don-t-mark-null-chunk-sections-for-block-updates.patch", "diffHunk": "@@ -0,0 +1,18 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Mariell Hoversholm <proximyst@proximyst.com>\n+Date: Fri, 14 Aug 2020 23:41:19 +0200\n+Subject: [PATCH] Don't mark null chunk sections for block updates\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerChunk.java b/src/main/java/net/minecraft/server/PlayerChunk.java\n+index 92a5a5cefb048d4a65ba64e154ce2a3459b28b28..e02ce1c93a6b0a1789212a60a789f7dada82a0fe 100644\n+--- a/src/main/java/net/minecraft/server/PlayerChunk.java\n++++ b/src/main/java/net/minecraft/server/PlayerChunk.java\n+@@ -363,6 +363,7 @@ public class PlayerChunk {\n+ \n+         if (chunk != null) {\n+             byte b0 = (byte) SectionPosition.a(blockposition.getY());\n++            if (chunk.getSections()[b0] == null) return; // Paper - Don't mark null chunk sections for block updates", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a4d5f8bace82f01b0dbd74f4807c2d967651c8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk0NjQ4OA==", "bodyText": "In that case, we have to make all blocks in that section air before it starts accessing the section. Does this sound sane?", "url": "https://github.com/PaperMC/Paper/pull/4132#discussion_r470946488", "createdAt": "2020-08-15T06:48:15Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0548-Don-t-mark-null-chunk-sections-for-block-updates.patch", "diffHunk": "@@ -0,0 +1,18 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Mariell Hoversholm <proximyst@proximyst.com>\n+Date: Fri, 14 Aug 2020 23:41:19 +0200\n+Subject: [PATCH] Don't mark null chunk sections for block updates\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerChunk.java b/src/main/java/net/minecraft/server/PlayerChunk.java\n+index 92a5a5cefb048d4a65ba64e154ce2a3459b28b28..e02ce1c93a6b0a1789212a60a789f7dada82a0fe 100644\n+--- a/src/main/java/net/minecraft/server/PlayerChunk.java\n++++ b/src/main/java/net/minecraft/server/PlayerChunk.java\n+@@ -363,6 +363,7 @@ public class PlayerChunk {\n+ \n+         if (chunk != null) {\n+             byte b0 = (byte) SectionPosition.a(blockposition.getY());\n++            if (chunk.getSections()[b0] == null) return; // Paper - Don't mark null chunk sections for block updates", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwNzc1Nw=="}, "originalCommit": {"oid": "74a4d5f8bace82f01b0dbd74f4807c2d967651c8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MjU2MA==", "bodyText": "I was hoping the fix here would be to init and add a ChunkSection if it's null, IE chunk.getSections()[b0] = new ChunkSection(blockposition.getY() >> 4 << 4);. Don't have any experience patching the server so I haven't been able to see if that works. Is that what you mean?\nAlso, this might be better deeper down where the server handles building its PacketPlayOutMultiBlockChange packet in PlayerChunk. Single block updates don't cause any errors/crashes since they don't reference the chunk section", "url": "https://github.com/PaperMC/Paper/pull/4132#discussion_r470952560", "createdAt": "2020-08-15T08:08:32Z", "author": {"login": "mergu"}, "path": "Spigot-Server-Patches/0548-Don-t-mark-null-chunk-sections-for-block-updates.patch", "diffHunk": "@@ -0,0 +1,18 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Mariell Hoversholm <proximyst@proximyst.com>\n+Date: Fri, 14 Aug 2020 23:41:19 +0200\n+Subject: [PATCH] Don't mark null chunk sections for block updates\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerChunk.java b/src/main/java/net/minecraft/server/PlayerChunk.java\n+index 92a5a5cefb048d4a65ba64e154ce2a3459b28b28..e02ce1c93a6b0a1789212a60a789f7dada82a0fe 100644\n+--- a/src/main/java/net/minecraft/server/PlayerChunk.java\n++++ b/src/main/java/net/minecraft/server/PlayerChunk.java\n+@@ -363,6 +363,7 @@ public class PlayerChunk {\n+ \n+         if (chunk != null) {\n+             byte b0 = (byte) SectionPosition.a(blockposition.getY());\n++            if (chunk.getSections()[b0] == null) return; // Paper - Don't mark null chunk sections for block updates", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwNzc1Nw=="}, "originalCommit": {"oid": "74a4d5f8bace82f01b0dbd74f4807c2d967651c8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MzY5Ng==", "bodyText": "I've done this in the latest commit.", "url": "https://github.com/PaperMC/Paper/pull/4132#discussion_r470953696", "createdAt": "2020-08-15T08:22:11Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0548-Don-t-mark-null-chunk-sections-for-block-updates.patch", "diffHunk": "@@ -0,0 +1,18 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Mariell Hoversholm <proximyst@proximyst.com>\n+Date: Fri, 14 Aug 2020 23:41:19 +0200\n+Subject: [PATCH] Don't mark null chunk sections for block updates\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerChunk.java b/src/main/java/net/minecraft/server/PlayerChunk.java\n+index 92a5a5cefb048d4a65ba64e154ce2a3459b28b28..e02ce1c93a6b0a1789212a60a789f7dada82a0fe 100644\n+--- a/src/main/java/net/minecraft/server/PlayerChunk.java\n++++ b/src/main/java/net/minecraft/server/PlayerChunk.java\n+@@ -363,6 +363,7 @@ public class PlayerChunk {\n+ \n+         if (chunk != null) {\n+             byte b0 = (byte) SectionPosition.a(blockposition.getY());\n++            if (chunk.getSections()[b0] == null) return; // Paper - Don't mark null chunk sections for block updates", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwNzc1Nw=="}, "originalCommit": {"oid": "74a4d5f8bace82f01b0dbd74f4807c2d967651c8"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1897, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}