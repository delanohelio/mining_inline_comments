{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMDM2OTY5", "number": 4766, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNzo0NToxOVrOE4-vsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxODo1MDowOVrOE4_DgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MTgzNzMwOnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNzo0NToxOVrOHzMggw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNzo0NToxOVrOHzMggw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ0NDM1NQ==", "bodyText": "Move this up to the method declaration", "url": "https://github.com/PaperMC/Paper/pull/4766#discussion_r523444355", "createdAt": "2020-11-14T17:45:19Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "diffHunk": "@@ -0,0 +1,69 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Sat, 14 Nov 2020 09:36:43 -0800\n+Subject: [PATCH] Fixed kick event leave message not being sent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 563ae7355f4f4645d21f2fbd494a5b5656c5e664..daff4bd095ee2ab1b6462c0d8258503da92c013a 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -303,7 +303,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         this.networkManager.sendPacket(new PacketPlayOutKickDisconnect(ichatbasecomponent), (future) -> {\n+             this.networkManager.close(ichatbasecomponent);\n+         });\n+-        this.a(ichatbasecomponent); // CraftBukkit - fire quit instantly\n++        this.onAllDisconnect(ichatbasecomponent, event.getLeaveMessage()); // CraftBukkit - fire quit instantly // Paper\n+         this.networkManager.stopReading();\n+         MinecraftServer minecraftserver = this.minecraftServer;\n+         NetworkManager networkmanager = this.networkManager;\n+@@ -1658,6 +1658,11 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+ \n+     @Override\n+     public void a(IChatBaseComponent ichatbasecomponent) {\n++        // Paper start\n++        this.onAllDisconnect(ichatbasecomponent, this.minecraftServer.getPlayerList().disconnect(this.player, \"\\u00A7e\" + this.player.getName() + \" left the game\"));\n++    }\n++\n++    private void onAllDisconnect(IChatBaseComponent ichatbasecomponent, String quitMessage) {\n+         // CraftBukkit start - Rarely it would send a disconnect line twice\n+         if (this.processedDisconnect) {\n+             return;\n+@@ -1673,7 +1678,6 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         */\n+ \n+         this.player.p();\n+-        String quitMessage = this.minecraftServer.getPlayerList().disconnect(this.player);\n+         if ((quitMessage != null) && (quitMessage.length() > 0)) {\n+             this.minecraftServer.getPlayerList().sendMessage(CraftChatMessage.fromString(quitMessage));\n+         }\n+@@ -1690,6 +1694,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         }\n+ \n+     }\n++    // Paper end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e93de5a037784a55cf818865028564c63d6c1a58"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MTgzNzM0OnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNzo0NToyNFrOHzMgiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNzo0NToyNFrOHzMgiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ0NDM2MA==", "bodyText": "Comment this", "url": "https://github.com/PaperMC/Paper/pull/4766#discussion_r523444360", "createdAt": "2020-11-14T17:45:24Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "diffHunk": "@@ -0,0 +1,69 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Sat, 14 Nov 2020 09:36:43 -0800\n+Subject: [PATCH] Fixed kick event leave message not being sent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 563ae7355f4f4645d21f2fbd494a5b5656c5e664..daff4bd095ee2ab1b6462c0d8258503da92c013a 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -303,7 +303,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         this.networkManager.sendPacket(new PacketPlayOutKickDisconnect(ichatbasecomponent), (future) -> {\n+             this.networkManager.close(ichatbasecomponent);\n+         });\n+-        this.a(ichatbasecomponent); // CraftBukkit - fire quit instantly\n++        this.onAllDisconnect(ichatbasecomponent, event.getLeaveMessage()); // CraftBukkit - fire quit instantly // Paper\n+         this.networkManager.stopReading();\n+         MinecraftServer minecraftserver = this.minecraftServer;\n+         NetworkManager networkmanager = this.networkManager;\n+@@ -1658,6 +1658,11 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+ \n+     @Override\n+     public void a(IChatBaseComponent ichatbasecomponent) {\n++        // Paper start\n++        this.onAllDisconnect(ichatbasecomponent, this.minecraftServer.getPlayerList().disconnect(this.player, \"\\u00A7e\" + this.player.getName() + \" left the game\"));\n++    }\n++\n++    private void onAllDisconnect(IChatBaseComponent ichatbasecomponent, String quitMessage) {\n+         // CraftBukkit start - Rarely it would send a disconnect line twice\n+         if (this.processedDisconnect) {\n+             return;\n+@@ -1673,7 +1678,6 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         */\n+ \n+         this.player.p();\n+-        String quitMessage = this.minecraftServer.getPlayerList().disconnect(this.player);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e93de5a037784a55cf818865028564c63d6c1a58"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MTg4ODAwOnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxODo1MDowOVrOHzM35g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQyMToyMDozN1rOHzNvtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ1MDM0Mg==", "bodyText": "I meant move this under the declaration, i.e.:\nprivate void onAllDisconnect(IChatBaseComponent ichatbasecomponent, String quitMessage) {\n    // Paper end", "url": "https://github.com/PaperMC/Paper/pull/4766#discussion_r523450342", "createdAt": "2020-11-14T18:50:09Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "diffHunk": "@@ -0,0 +1,71 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Sat, 14 Nov 2020 09:36:43 -0800\n+Subject: [PATCH] Fixed kick event leave message not being sent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 563ae7355f4f4645d21f2fbd494a5b5656c5e664..7b44f231f03d41d83c7680cfa9efc729e8d646ed 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -303,7 +303,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         this.networkManager.sendPacket(new PacketPlayOutKickDisconnect(ichatbasecomponent), (future) -> {\n+             this.networkManager.close(ichatbasecomponent);\n+         });\n+-        this.a(ichatbasecomponent); // CraftBukkit - fire quit instantly\n++        this.onAllDisconnect(ichatbasecomponent, event.getLeaveMessage()); // CraftBukkit - fire quit instantly // Paper\n+         this.networkManager.stopReading();\n+         MinecraftServer minecraftserver = this.minecraftServer;\n+         NetworkManager networkmanager = this.networkManager;\n+@@ -1658,6 +1658,11 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+ \n+     @Override\n+     public void a(IChatBaseComponent ichatbasecomponent) {\n++        // Paper start\n++        this.onAllDisconnect(ichatbasecomponent, this.minecraftServer.getPlayerList().disconnect(this.player, \"\\u00A7e\" + this.player.getName() + \" left the game\"));\n++    }\n++\n++    private void onAllDisconnect(IChatBaseComponent ichatbasecomponent, String quitMessage) {\n+         // CraftBukkit start - Rarely it would send a disconnect line twice\n+         if (this.processedDisconnect) {\n+             return;\n+@@ -1673,7 +1678,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         */\n+ \n+         this.player.p();\n+-        String quitMessage = this.minecraftServer.getPlayerList().disconnect(this.player);\n++        // String quitMessage = this.minecraftServer.getPlayerList().disconnect(this.player); // Paper\n+         if ((quitMessage != null) && (quitMessage.length() > 0)) {\n+             this.minecraftServer.getPlayerList().sendMessage(CraftChatMessage.fromString(quitMessage));\n+         }\n+@@ -1688,7 +1693,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+             PlayerConnection.LOGGER.info(\"Stopping singleplayer server as player logged out\");\n+             this.minecraftServer.safeShutdown(false);\n+         }\n+-\n++        // Paper end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23f0dfa66cc9df25c55747130315043d24e30913"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2NDYyOA==", "bodyText": "oh, ok I get it. I fixed it now.", "url": "https://github.com/PaperMC/Paper/pull/4766#discussion_r523464628", "createdAt": "2020-11-14T21:20:37Z", "author": {"login": "Machine-Maker"}, "path": "Spigot-Server-Patches/0599-Fixed-kick-event-leave-message-not-being-sent.patch", "diffHunk": "@@ -0,0 +1,71 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Sat, 14 Nov 2020 09:36:43 -0800\n+Subject: [PATCH] Fixed kick event leave message not being sent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 563ae7355f4f4645d21f2fbd494a5b5656c5e664..7b44f231f03d41d83c7680cfa9efc729e8d646ed 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -303,7 +303,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         this.networkManager.sendPacket(new PacketPlayOutKickDisconnect(ichatbasecomponent), (future) -> {\n+             this.networkManager.close(ichatbasecomponent);\n+         });\n+-        this.a(ichatbasecomponent); // CraftBukkit - fire quit instantly\n++        this.onAllDisconnect(ichatbasecomponent, event.getLeaveMessage()); // CraftBukkit - fire quit instantly // Paper\n+         this.networkManager.stopReading();\n+         MinecraftServer minecraftserver = this.minecraftServer;\n+         NetworkManager networkmanager = this.networkManager;\n+@@ -1658,6 +1658,11 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+ \n+     @Override\n+     public void a(IChatBaseComponent ichatbasecomponent) {\n++        // Paper start\n++        this.onAllDisconnect(ichatbasecomponent, this.minecraftServer.getPlayerList().disconnect(this.player, \"\\u00A7e\" + this.player.getName() + \" left the game\"));\n++    }\n++\n++    private void onAllDisconnect(IChatBaseComponent ichatbasecomponent, String quitMessage) {\n+         // CraftBukkit start - Rarely it would send a disconnect line twice\n+         if (this.processedDisconnect) {\n+             return;\n+@@ -1673,7 +1678,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+         */\n+ \n+         this.player.p();\n+-        String quitMessage = this.minecraftServer.getPlayerList().disconnect(this.player);\n++        // String quitMessage = this.minecraftServer.getPlayerList().disconnect(this.player); // Paper\n+         if ((quitMessage != null) && (quitMessage.length() > 0)) {\n+             this.minecraftServer.getPlayerList().sendMessage(CraftChatMessage.fromString(quitMessage));\n+         }\n+@@ -1688,7 +1693,7 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+             PlayerConnection.LOGGER.info(\"Stopping singleplayer server as player logged out\");\n+             this.minecraftServer.safeShutdown(false);\n+         }\n+-\n++        // Paper end", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ1MDM0Mg=="}, "originalCommit": {"oid": "23f0dfa66cc9df25c55747130315043d24e30913"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1737, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}