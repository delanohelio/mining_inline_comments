{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzk2MzE2", "number": 3550, "title": "Fix more exploits (carpet dupe, rail dupe, bedrock destroying, falling block (sand/dragon egg/etc) duping, dragon exp dupe) and properly prevent tnt duplication", "bodyText": "Properly prevents physics desyncs by setting the old pos to air and by getting the old pos after the set type call", "createdAt": "2020-06-12T17:10:46Z", "url": "https://github.com/PaperMC/Paper/pull/3550", "merged": true, "mergeCommit": {"oid": "0d8594ae94f73b87a647ea39ffd54858f33a69d3"}, "closed": true, "closedAt": "2020-06-20T19:18:26Z", "author": {"login": "Spottedleaf"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqvBiRgFqTQzMDExMDMxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABctMgsrgBqjM0NjQ5MzMwMTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTEwMzE5", "url": "https://github.com/PaperMC/Paper/pull/3550#pullrequestreview-430110319", "createdAt": "2020-06-13T03:38:07Z", "commit": {"oid": "83299d30f78ea91a8de6a53126300a70941246fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzozODowN1rOGjVe6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzozODowN1rOGjVe6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwNTMyMg==", "bodyText": "\"occurr\"", "url": "https://github.com/PaperMC/Paper/pull/3550#discussion_r439705322", "createdAt": "2020-06-13T03:38:07Z", "author": {"login": "mbax"}, "path": "Spigot-Server-Patches/0543-fixup-Protect-Bedrock-and-End-Portal-Frames-from-bei.patch", "diffHunk": "@@ -0,0 +1,63 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Spottedleaf <Spottedleaf@users.noreply.github.com>\n+Date: Fri, 12 Jun 2020 11:45:41 -0700\n+Subject: [PATCH] fixup! Protect Bedrock and End Portal/Frames from being\n+ destroyed\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/Block.java b/src/main/java/net/minecraft/server/Block.java\n+index bd7a92599b4182739aafef9eeaaf8665d2f9f954..66244a9d0e253b3709df4ae2adcd21e44ebbfc90 100644\n+--- a/src/main/java/net/minecraft/server/Block.java\n++++ b/src/main/java/net/minecraft/server/Block.java\n+@@ -37,7 +37,8 @@ public class Block implements IMaterial {\n+             this != Blocks.BEDROCK &&\n+             this != Blocks.END_PORTAL_FRAME &&\n+             this != Blocks.END_PORTAL &&\n+-            this != Blocks.END_GATEWAY;\n++            this != Blocks.END_GATEWAY &&\n++            this != Blocks.MOVING_PISTON; // try to prevent creation of headless pistons\n+     }\n+     public co.aikar.timings.Timing timing;\n+     public co.aikar.timings.Timing getTiming() {\n+diff --git a/src/main/java/net/minecraft/server/BlockPiston.java b/src/main/java/net/minecraft/server/BlockPiston.java\n+index 66dbe85fe975defa783fb0eb5f6053eb2ad5c187..0c519c1cdd2deb4163ec6bb4a5aaf41d519b70f2 100644\n+--- a/src/main/java/net/minecraft/server/BlockPiston.java\n++++ b/src/main/java/net/minecraft/server/BlockPiston.java\n+@@ -175,6 +175,12 @@ public class BlockPiston extends BlockDirectional {\n+     @Override\n+     public boolean a(IBlockData iblockdata, World world, BlockPosition blockposition, int i, int j) {\n+         EnumDirection enumdirection = (EnumDirection) iblockdata.get(BlockPiston.FACING);\n++        // Paper start - prevent retracting when we're facing the wrong way (we were replaced before retraction could occurr)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83299d30f78ea91a8de6a53126300a70941246fa"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTEwNDIw", "url": "https://github.com/PaperMC/Paper/pull/3550#pullrequestreview-430110420", "createdAt": "2020-06-13T03:40:07Z", "commit": {"oid": "83299d30f78ea91a8de6a53126300a70941246fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzo0MDowOFrOGjVfSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzo0MDowOFrOGjVfSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwNTQxOA==", "bodyText": "\"accross\"", "url": "https://github.com/PaperMC/Paper/pull/3550#discussion_r439705418", "createdAt": "2020-06-13T03:40:08Z", "author": {"login": "mbax"}, "path": "Spigot-Server-Patches/0545-Prevent-position-desync-in-playerconnection-causing-.patch", "diffHunk": "@@ -0,0 +1,31 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Spottedleaf <Spottedleaf@users.noreply.github.com>\n+Date: Fri, 12 Jun 2020 16:51:39 -0700\n+Subject: [PATCH] Prevent position desync in playerconnection causing tp\n+ exploit\n+\n+Caused the server to revert to the player's overworld coordinates\n+after teleporting into the end.\n+\n+Sidenote: The underlying issue is that the move call can teleport\n+entities and do other things like kill the entity. In the future,\n+to fix all exploits derieved from this usually unexpected\n+behaviour, we need to move all of this dangerous logic outside\n+of the move call and into an appropriate place in the tick method.\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 7123e197c7ed01afd4fbf7aa0760611373039a13..69cec4647c27bca92b037f63ca513935f8bc037c 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -1080,6 +1080,11 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+                             }\n+ \n+                             this.player.move(EnumMoveType.PLAYER, new Vec3D(d7, d8, d9));\n++                            // Paper start - prevent position desync\n++                            if (this.teleportPos != null) {\n++                                return; // ... thanks mojang for letting move calls teleport accross dimensions.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83299d30f78ea91a8de6a53126300a70941246fa"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e75d908100814a2d6ce0bf94fecf0d4eda5a22b", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/3e75d908100814a2d6ce0bf94fecf0d4eda5a22b", "committedDate": "2020-06-20T18:54:17Z", "message": "Fix more cases of Bedrock breaking\n\nThis is still covered under the setting to re-enable this."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96feb68ad9a79292a1bb2f23312b7bd3b2717bc9", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/96feb68ad9a79292a1bb2f23312b7bd3b2717bc9", "committedDate": "2020-06-20T18:56:08Z", "message": "Fix carpet and rail duping by pistons under same TNT duping config\n\nThis renames the config from enable tnt duping to enable piston duping\n\nNormally we would not have a config for rails and carpet duping, but\nthe fix for TNT is the same fix for rails and carpet, so they are\nhaving to be covered under that same config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f28f22ccfc19e064f849b9e391b266720447a5d", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/8f28f22ccfc19e064f849b9e391b266720447a5d", "committedDate": "2020-06-20T18:58:35Z", "message": "Fix sand not dying correctly\n\nIf the falling block dies during teleportation (entity#move), then we need\nto detect that by placing a check after the move."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cf1ebdc5d9b56c3dac1812e10007da590272e7a", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/1cf1ebdc5d9b56c3dac1812e10007da590272e7a", "committedDate": "2020-06-20T18:59:49Z", "message": "Prevent position desync in teleporting during movement\n\nCaused the server to revert to the player's overworld coordinates\nafter teleporting into the end.\n\nSidenote: The underlying issue is that the move call can teleport\nentities and do other things like kill the entity. In the future,\nto fix all exploits derieved from this usually unexpected\nbehaviour, we need to move all of this dangerous logic outside\nof the move call and into an appropriate place in the tick method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d8594ae94f73b87a647ea39ffd54858f33a69d3", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/0d8594ae94f73b87a647ea39ffd54858f33a69d3", "committedDate": "2020-06-20T19:04:50Z", "message": "Fix enderdragon exp dupe\n\nProperly track death stage when unloading/loading in the dragon"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "825f03f1007466a727d30629291aba08b01eea97", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/825f03f1007466a727d30629291aba08b01eea97", "committedDate": "2020-06-18T02:58:29Z", "message": "rebase"}, "afterCommit": {"oid": "0d8594ae94f73b87a647ea39ffd54858f33a69d3", "author": {"user": {"login": "Spottedleaf", "name": null}}, "url": "https://github.com/PaperMC/Paper/commit/0d8594ae94f73b87a647ea39ffd54858f33a69d3", "committedDate": "2020-06-20T19:04:50Z", "message": "Fix enderdragon exp dupe\n\nProperly track death stage when unloading/loading in the dragon"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1780, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}