{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzOTQyNzMy", "number": 3552, "title": "Track EnderDragon in View Distance", "bodyText": "In vanilla Enderdragon is tracked for 10 chunks, however if the view distance or no-tick view distance is set higher than 10, the enderdragon can be invisible even though the chunks it is in are visible.\nFixes #2616", "createdAt": "2020-06-13T01:49:43Z", "url": "https://github.com/PaperMC/Paper/pull/3552", "merged": true, "mergeCommit": {"oid": "246af15ddcca03cdad00956819ec3e14983a2910"}, "closed": true, "closedAt": "2020-06-20T20:21:09Z", "author": {"login": "kickash32"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqum7JgFqTQzMDEwODc5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABctNj6cABqjM0NjQ5NzgxMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTA4Nzk2", "url": "https://github.com/PaperMC/Paper/pull/3552#pullrequestreview-430108796", "createdAt": "2020-06-13T03:09:03Z", "commit": {"oid": "5a84a10099c9624766955e738bec6a3c07a4f37a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzowOTowM1rOGjVYZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzowOTowM1rOGjVYZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMzY1NA==", "bodyText": "defaultRange is 10 for enderdragon", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r439703654", "createdAt": "2020-06-13T03:09:03Z", "author": {"login": "Spottedleaf"}, "path": "Spigot-Server-Patches/0543-Always-track-EnderDragon.patch", "diffHunk": "@@ -0,0 +1,34 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: kickash32 <kickash32@gmail.com>\n+Date: Fri, 12 Jun 2020 21:18:33 -0400\n+Subject: [PATCH] Always track EnderDragon\n+\n+\n+diff --git a/src/main/java/org/spigotmc/TrackingRange.java b/src/main/java/org/spigotmc/TrackingRange.java\n+index 43b5ed8e396e5312f7de1f160f596f58baead28a..eed715c446a3febd660c157029f7445900bbee83 100644\n+--- a/src/main/java/org/spigotmc/TrackingRange.java\n++++ b/src/main/java/org/spigotmc/TrackingRange.java\n+@@ -1,5 +1,6 @@\n+ package org.spigotmc;\n+ \n++import com.destroystokyo.paper.PaperWorldConfig; // Paper\n+ import net.minecraft.server.Entity;\n+ import net.minecraft.server.EntityEnderDragon; // Paper\n+ import net.minecraft.server.EntityExperienceOrb;\n+@@ -23,6 +24,7 @@ public class TrackingRange\n+     public static int getEntityTrackingRange(Entity entity, int defaultRange)\n+     {\n+         SpigotWorldConfig config = entity.world.spigotConfig;\n++        PaperWorldConfig paperConfig = entity.world.paperConfig; // Paper\n+         if ( entity instanceof EntityPlayer )\n+         {\n+             return config.playerTrackingRange;\n+@@ -45,7 +47,7 @@ public class TrackingRange\n+             return config.miscTrackingRange;\n+         } else\n+         {\n+-            if (entity instanceof EntityEnderDragon) return defaultRange; // Paper - enderdragon is exempt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a84a10099c9624766955e738bec6a3c07a4f37a"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTA4OTM5", "url": "https://github.com/PaperMC/Paper/pull/3552#pullrequestreview-430108939", "createdAt": "2020-06-13T03:12:07Z", "commit": {"oid": "5a84a10099c9624766955e738bec6a3c07a4f37a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzoxMjowN1rOGjVZHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMzoxMjowN1rOGjVZHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMzgzNg==", "bodyText": "can't use config values as these are variable on runtime", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r439703836", "createdAt": "2020-06-13T03:12:07Z", "author": {"login": "Spottedleaf"}, "path": "Spigot-Server-Patches/0543-Always-track-EnderDragon.patch", "diffHunk": "@@ -0,0 +1,34 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: kickash32 <kickash32@gmail.com>\n+Date: Fri, 12 Jun 2020 21:18:33 -0400\n+Subject: [PATCH] Always track EnderDragon\n+\n+\n+diff --git a/src/main/java/org/spigotmc/TrackingRange.java b/src/main/java/org/spigotmc/TrackingRange.java\n+index 43b5ed8e396e5312f7de1f160f596f58baead28a..eed715c446a3febd660c157029f7445900bbee83 100644\n+--- a/src/main/java/org/spigotmc/TrackingRange.java\n++++ b/src/main/java/org/spigotmc/TrackingRange.java\n+@@ -1,5 +1,6 @@\n+ package org.spigotmc;\n+ \n++import com.destroystokyo.paper.PaperWorldConfig; // Paper\n+ import net.minecraft.server.Entity;\n+ import net.minecraft.server.EntityEnderDragon; // Paper\n+ import net.minecraft.server.EntityExperienceOrb;\n+@@ -23,6 +24,7 @@ public class TrackingRange\n+     public static int getEntityTrackingRange(Entity entity, int defaultRange)\n+     {\n+         SpigotWorldConfig config = entity.world.spigotConfig;\n++        PaperWorldConfig paperConfig = entity.world.paperConfig; // Paper\n+         if ( entity instanceof EntityPlayer )\n+         {\n+             return config.playerTrackingRange;\n+@@ -45,7 +47,7 @@ public class TrackingRange\n+             return config.miscTrackingRange;\n+         } else\n+         {\n+-            if (entity instanceof EntityEnderDragon) return defaultRange; // Paper - enderdragon is exempt\n++            if (entity instanceof EntityEnderDragon) return Math.max(Math.max(config.viewDistance * 16, defaultRange),  paperConfig.noTickViewDistance); // Paper - enderdragon is exempt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a84a10099c9624766955e738bec6a3c07a4f37a"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzE4NjQx", "url": "https://github.com/PaperMC/Paper/pull/3552#pullrequestreview-430718641", "createdAt": "2020-06-15T14:49:36Z", "commit": {"oid": "5ca93d290cffd97fb3fa81978f23da8d1732a315"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDo0OTozN1rOGj1ojA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDo0OTozN1rOGj1ojA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIzMjA3Ng==", "bodyText": "Isn't this meant to be no-tick-view?\n\nif the view distance or no-tick view distance is set higher than 10, the enderdragon can be invisible even though the chunks it is in are visible.\n\n(emphasis mine)", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r440232076", "createdAt": "2020-06-15T14:49:37Z", "author": {"login": "A248"}, "path": "Spigot-Server-Patches/0543-Always-track-EnderDragon.patch", "diffHunk": "@@ -0,0 +1,27 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: kickash32 <kickash32@gmail.com>\n+Date: Fri, 12 Jun 2020 21:18:33 -0400\n+Subject: [PATCH] Always track EnderDragon\n+\n+\n+diff --git a/src/main/java/org/spigotmc/TrackingRange.java b/src/main/java/org/spigotmc/TrackingRange.java\n+index 43b5ed8e396e5312f7de1f160f596f58baead28a..2ba1c1b9160e8d24cb338fa9b6b844423119dc73 100644\n+--- a/src/main/java/org/spigotmc/TrackingRange.java\n++++ b/src/main/java/org/spigotmc/TrackingRange.java\n+@@ -2,6 +2,7 @@ package org.spigotmc;\n+ \n+ import net.minecraft.server.Entity;\n+ import net.minecraft.server.EntityEnderDragon; // Paper\n++import net.minecraft.server.WorldServer; // Paper\n+ import net.minecraft.server.EntityExperienceOrb;\n+ import net.minecraft.server.EntityGhast;\n+ import net.minecraft.server.EntityItem;\n+@@ -45,7 +46,7 @@ public class TrackingRange\n+             return config.miscTrackingRange;\n+         } else\n+         {\n+-            if (entity instanceof EntityEnderDragon) return defaultRange; // Paper - enderdragon is exempt\n++            if (entity instanceof EntityEnderDragon) return ((WorldServer)(entity.getWorld())).getChunkProvider().playerChunkMap.getLoadViewDistance(); // Paper - enderdragon is exempt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca93d290cffd97fb3fa81978f23da8d1732a315"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "246af15ddcca03cdad00956819ec3e14983a2910", "author": {"user": {"login": "kickash32", "name": "Omer Uddin"}}, "url": "https://github.com/PaperMC/Paper/commit/246af15ddcca03cdad00956819ec3e14983a2910", "committedDate": "2020-06-20T20:20:00Z", "message": "Track Ender Dragon at current (no tick) view distance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ca93d290cffd97fb3fa81978f23da8d1732a315", "author": {"user": {"login": "kickash32", "name": "Omer Uddin"}}, "url": "https://github.com/PaperMC/Paper/commit/5ca93d290cffd97fb3fa81978f23da8d1732a315", "committedDate": "2020-06-13T15:14:01Z", "message": "use real values"}, "afterCommit": {"oid": "246af15ddcca03cdad00956819ec3e14983a2910", "author": {"user": {"login": "kickash32", "name": "Omer Uddin"}}, "url": "https://github.com/PaperMC/Paper/commit/246af15ddcca03cdad00956819ec3e14983a2910", "committedDate": "2020-06-20T20:20:00Z", "message": "Track Ender Dragon at current (no tick) view distance"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1783, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}