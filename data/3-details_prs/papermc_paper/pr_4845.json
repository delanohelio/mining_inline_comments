{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMDk4MTUy", "number": 4845, "title": "fixed bug in jvm checker", "bodyText": "Bug with ea versions. for example, the string it was trying to parse was 15-ea.", "createdAt": "2020-12-03T20:29:18Z", "url": "https://github.com/PaperMC/Paper/pull/4845", "merged": true, "mergeCommit": {"oid": "684b6ea40b83020cf919aaf7000882b38a0fa904"}, "closed": true, "closedAt": "2020-12-05T03:58:25Z", "author": {"login": "Machine-Maker"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdipP2kgFqTU0NDQwMTczMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjEMmXAFqTU0NTQwMTA0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NDAxNzMy", "url": "https://github.com/PaperMC/Paper/pull/4845#pullrequestreview-544401732", "createdAt": "2020-12-03T20:32:19Z", "commit": {"oid": "99a954d0057cb4bccf48fe94bef1ccc2c4e9af27"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDozMjoyMFrOH-w8-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDozMzo0NFrOH-xCpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NTgwMg==", "bodyText": "<3 thank you", "url": "https://github.com/PaperMC/Paper/pull/4845#discussion_r535575802", "createdAt": "2020-12-03T20:32:20Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0611-Add-warning-for-servers-not-running-on-Java-11.patch", "diffHunk": "@@ -4,21 +4,26 @@ Date: Wed, 2 Dec 2020 21:58:45 -0800\n Subject: [PATCH] Add warning for servers not running on Java 11\n \n \n-diff --git a/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java b/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java\n+diff --git a/src/main/java/io/papermc/paper/util/PaperJvmChecker.java b/src/main/java/io/papermc/paper/util/PaperJvmChecker.java\n new file mode 100644\n-index 0000000000000000000000000000000000000000..023123d52fbb458e6ee2d38e42c9651a5c7be728\n+index 0000000000000000000000000000000000000000..89deb34c78c54a5b306722f0138d2eddbafc5c6c\n --- /dev/null\n-+++ b/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java\n-@@ -0,0 +1,56 @@\n-+package com.destroystokyo.paper.util;\n++++ b/src/main/java/io/papermc/paper/util/PaperJvmChecker.java\n+@@ -0,0 +1,65 @@\n++package io.papermc.paper.util;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a954d0057cb4bccf48fe94bef1ccc2c4e9af27"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NzI1Mg==", "bodyText": "Perhaps return afterwards? Not sure if we should try to parse the number after it hasn't been found :p", "url": "https://github.com/PaperMC/Paper/pull/4845#discussion_r535577252", "createdAt": "2020-12-03T20:33:44Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0611-Add-warning-for-servers-not-running-on-Java-11.patch", "diffHunk": "@@ -36,7 +41,11 @@ index 0000000000000000000000000000000000000000..023123d52fbb458e6ee2d38e42c9651a\n +\n +        final int javaVersionNum;\n +        try {\n-+            javaVersionNum = Integer.parseInt(version);\n++            Matcher versionMatcher = NUM_PATTERN.matcher(version);\n++            if (!versionMatcher.find()) {\n++                PaperJvmChecker.printWarning(javaVersion, logger);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a954d0057cb4bccf48fe94bef1ccc2c4e9af27"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NjA2MzUy", "url": "https://github.com/PaperMC/Paper/pull/4845#pullrequestreview-544606352", "createdAt": "2020-12-04T02:08:46Z", "commit": {"oid": "99d71079615c0e8ee9e8191a83ec9b8f7b354068"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85ad9de2175ed1fdec9ef754be0571f299c02a53", "author": {"user": {"login": "Machine-Maker", "name": "Jake Potrebic"}}, "url": "https://github.com/PaperMC/Paper/commit/85ad9de2175ed1fdec9ef754be0571f299c02a53", "committedDate": "2020-12-05T00:17:09Z", "message": "fix bug in jvm version check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99d71079615c0e8ee9e8191a83ec9b8f7b354068", "author": {"user": {"login": "Machine-Maker", "name": "Jake Potrebic"}}, "url": "https://github.com/PaperMC/Paper/commit/99d71079615c0e8ee9e8191a83ec9b8f7b354068", "committedDate": "2020-12-03T20:36:54Z", "message": "added return"}, "afterCommit": {"oid": "85ad9de2175ed1fdec9ef754be0571f299c02a53", "author": {"user": {"login": "Machine-Maker", "name": "Jake Potrebic"}}, "url": "https://github.com/PaperMC/Paper/commit/85ad9de2175ed1fdec9ef754be0571f299c02a53", "committedDate": "2020-12-05T00:17:09Z", "message": "fix bug in jvm version check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1Mzc3ODMz", "url": "https://github.com/PaperMC/Paper/pull/4845#pullrequestreview-545377833", "createdAt": "2020-12-05T00:31:01Z", "commit": {"oid": "85ad9de2175ed1fdec9ef754be0571f299c02a53"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMDozMTowMVrOH_m8pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMDo0Mjo0MVrOH_nIkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ2MDQ1Mg==", "bodyText": "I don't see any reason to keep this around for a single-time check, just make this a local variable.", "url": "https://github.com/PaperMC/Paper/pull/4845#discussion_r536460452", "createdAt": "2020-12-05T00:31:01Z", "author": {"login": "DenWav"}, "path": "Spigot-Server-Patches/0611-Add-warning-for-servers-not-running-on-Java-11.patch", "diffHunk": "@@ -4,19 +4,24 @@ Date: Wed, 2 Dec 2020 21:58:45 -0800\n Subject: [PATCH] Add warning for servers not running on Java 11\n \n \n-diff --git a/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java b/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java\n+diff --git a/src/main/java/io/papermc/paper/util/PaperJvmChecker.java b/src/main/java/io/papermc/paper/util/PaperJvmChecker.java\n new file mode 100644\n-index 0000000000000000000000000000000000000000..afe07487b1e7337293f7147619a6f10fcdef9d0e\n+index 0000000000000000000000000000000000000000..d761a9e0c1e71fadb981f9af4736d7e8e6fda2a9\n --- /dev/null\n-+++ b/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java\n-@@ -0,0 +1,49 @@\n-+package com.destroystokyo.paper.util;\n++++ b/src/main/java/io/papermc/paper/util/PaperJvmChecker.java\n+@@ -0,0 +1,58 @@\n++package io.papermc.paper.util;\n +\n +import org.apache.logging.log4j.LogManager;\n +import org.apache.logging.log4j.Logger;\n +\n++import java.util.regex.Matcher;\n++import java.util.regex.Pattern;\n++\n +public class PaperJvmChecker {\n +\n++    private final static Pattern NUM_PATTERN = Pattern.compile(\"\\\\d+\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ad9de2175ed1fdec9ef754be0571f299c02a53"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ2Mjk4Mw==", "bodyText": "We might as well use regex for handling the 1. part too. Let's do:\n(?:1\\.)?(\\d+)\n\nAnd an error message for when the pattern fails would be good too.\nSo that would simplify the whole method to:\nprivate static int getJvmVersion() {\n    String javaVersion = System.getProperty(\"java.version\");\n    final Matcher matcher = Pattern.compile(\"(?:1\\\\.)?(\\\\d+)\").matcher(javaVersion);\n    if (!matcher.find()) {\n        LogManager.getLogger().warn(\"Failed to determine Java version; Could not parse {}\", javaVersion);\n        return -1;\n    }\n\n    final String version = matcher.group(1);\n    try {\n        return Integer.parseInt(version);\n    } catch (final NumberFormatException e) {\n        LogManager.getLogger().warn(\"Failed to determine Java version; Could not parse {} from {}\", version, javaVersion, e);\n        return -1;\n    }\n}", "url": "https://github.com/PaperMC/Paper/pull/4845#discussion_r536462983", "createdAt": "2020-12-05T00:40:34Z", "author": {"login": "DenWav"}, "path": "Spigot-Server-Patches/0611-Add-warning-for-servers-not-running-on-Java-11.patch", "diffHunk": "@@ -4,19 +4,24 @@ Date: Wed, 2 Dec 2020 21:58:45 -0800\n Subject: [PATCH] Add warning for servers not running on Java 11\n \n \n-diff --git a/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java b/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java\n+diff --git a/src/main/java/io/papermc/paper/util/PaperJvmChecker.java b/src/main/java/io/papermc/paper/util/PaperJvmChecker.java\n new file mode 100644\n-index 0000000000000000000000000000000000000000..afe07487b1e7337293f7147619a6f10fcdef9d0e\n+index 0000000000000000000000000000000000000000..d761a9e0c1e71fadb981f9af4736d7e8e6fda2a9\n --- /dev/null\n-+++ b/src/main/java/com/destroystokyo/paper/util/PaperJvmChecker.java\n-@@ -0,0 +1,49 @@\n-+package com.destroystokyo.paper.util;\n++++ b/src/main/java/io/papermc/paper/util/PaperJvmChecker.java\n+@@ -0,0 +1,58 @@\n++package io.papermc.paper.util;\n +\n +import org.apache.logging.log4j.LogManager;\n +import org.apache.logging.log4j.Logger;\n +\n++import java.util.regex.Matcher;\n++import java.util.regex.Pattern;\n++\n +public class PaperJvmChecker {\n +\n++    private final static Pattern NUM_PATTERN = Pattern.compile(\"\\\\d+\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ad9de2175ed1fdec9ef754be0571f299c02a53"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ2MzUwNw==", "bodyText": "Unnecessary import, the class is only used 1 time.", "url": "https://github.com/PaperMC/Paper/pull/4845#discussion_r536463507", "createdAt": "2020-12-05T00:42:41Z", "author": {"login": "DenWav"}, "path": "Spigot-Server-Patches/0611-Add-warning-for-servers-not-running-on-Java-11.patch", "diffHunk": "@@ -60,14 +69,22 @@ index 0000000000000000000000000000000000000000..afe07487b1e7337293f7147619a6f10f\n +    }\n +}\n diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java\n-index 0108a1a68572df562349688e93f8134cb14d6116..12d781f4ae6a46d0885972035870d5b5b62f5b8b 100644\n+index 0108a1a68572df562349688e93f8134cb14d6116..0d3d8fde1d3ae94ec79b36ad40997c39100d252a 100644\n --- a/src/main/java/net/minecraft/server/MinecraftServer.java\n +++ b/src/main/java/net/minecraft/server/MinecraftServer.java\n-@@ -950,6 +950,8 @@ public abstract class MinecraftServer extends IAsyncTaskHandlerReentrant<TickTas\n+@@ -69,6 +69,7 @@ import org.bukkit.craftbukkit.Main;\n+ import org.bukkit.event.server.ServerLoadEvent;\n+ // CraftBukkit end\n+ import co.aikar.timings.MinecraftTimings; // Paper\n++import io.papermc.paper.util.PaperJvmChecker; // Paper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ad9de2175ed1fdec9ef754be0571f299c02a53"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78611c64277468f3e97a1d362b331b37a3488808", "author": {"user": {"login": "Machine-Maker", "name": "Jake Potrebic"}}, "url": "https://github.com/PaperMC/Paper/commit/78611c64277468f3e97a1d362b331b37a3488808", "committedDate": "2020-12-05T01:42:00Z", "message": "changed whole check to regex-based check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NDAxMDQ2", "url": "https://github.com/PaperMC/Paper/pull/4845#pullrequestreview-545401046", "createdAt": "2020-12-05T03:57:58Z", "commit": {"oid": "78611c64277468f3e97a1d362b331b37a3488808"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1517, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}