{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0ODk5MTcw", "number": 2880, "title": "Fix openSCAP results", "bodyText": "What does this PR change?\nThe result of the openSCAP audit may list many not applicable rules. They make the test for passing rules difficult as they may start on page 2. This PR uses the filter button to focus on the passing rules.\nNow we will install all needed packages from the test suite, instead of a mixture of sumaform and the test suite (see uyuni-project/sumaform#801). This PR adapts.\nThe list of packages to install for openSCAP tests was wrong, For example, the CentOS traditional client is both a CentOS client and a traditional client. Constant package lists were not fit for this, this PR computes the list dynamically.\nThis PR also cleans up the generated reports, the installed packages and the enabled repositories at the end to make these tests idempotent.\nLinks\nPorts:\n\n4.1: SUSE/spacewalk#13187 SUSE/spacewalk#13189 SUSE/spacewalk#13195 SUSE/spacewalk#13197\n4.0: SUSE/spacewalk#13188 SUSE/spacewalk#13190 SUSE/spacewalk#13194 SUSE/spacewalk#13196\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed", "createdAt": "2020-11-20T19:10:02Z", "url": "https://github.com/uyuni-project/uyuni/pull/2880", "merged": true, "mergeCommit": {"oid": "06dfff5d0de4fcd8cf2a16a13d15e47fddbbf0af"}, "closed": true, "closedAt": "2020-11-23T09:41:36Z", "author": {"login": "Bischoff"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeizSGgBqjQwMjMzOTMyMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfRhVYgBqjQwMjY1NjY1MTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df210ef2e943c001b3656d6e5b4e90f7e0c65d50", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/df210ef2e943c001b3656d6e5b4e90f7e0c65d50", "committedDate": "2020-11-20T19:03:21Z", "message": "Idempotency: clean up audit results"}, "afterCommit": {"oid": "10c9f00f2b1895823701e11278fe65d11a7d8a09", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/10c9f00f2b1895823701e11278fe65d11a7d8a09", "committedDate": "2020-11-21T02:47:24Z", "message": "Idempotency: clean up audit results"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10c9f00f2b1895823701e11278fe65d11a7d8a09", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/10c9f00f2b1895823701e11278fe65d11a7d8a09", "committedDate": "2020-11-21T02:47:24Z", "message": "Idempotency: clean up audit results"}, "afterCommit": {"oid": "538e08a37da9f3250f152e58d7da0fa5905ffda9", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/538e08a37da9f3250f152e58d7da0fa5905ffda9", "committedDate": "2020-11-21T03:06:28Z", "message": "Idempotency: clean up audit results"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "538e08a37da9f3250f152e58d7da0fa5905ffda9", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/538e08a37da9f3250f152e58d7da0fa5905ffda9", "committedDate": "2020-11-21T03:06:28Z", "message": "Idempotency: clean up audit results"}, "afterCommit": {"oid": "7491f1f97f6ea03e9af8bce4f31e7751023c8f1d", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7491f1f97f6ea03e9af8bce4f31e7751023c8f1d", "committedDate": "2020-11-21T03:59:32Z", "message": "Idempotency: clean up audit results"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7491f1f97f6ea03e9af8bce4f31e7751023c8f1d", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7491f1f97f6ea03e9af8bce4f31e7751023c8f1d", "committedDate": "2020-11-21T03:59:32Z", "message": "Idempotency: clean up audit results"}, "afterCommit": {"oid": "a9be690c90a5c7e1da49fe1443e48842f864d0dc", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a9be690c90a5c7e1da49fe1443e48842f864d0dc", "committedDate": "2020-11-21T04:22:40Z", "message": "Idempotency: clean up audit results"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82d02f04a5333b585702d87d4b1824898c5b9bb4", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/82d02f04a5333b585702d87d4b1824898c5b9bb4", "committedDate": "2020-11-22T13:49:10Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}, "afterCommit": {"oid": "03142cb81cad072f84e010b51a556de6dcb910d0", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/03142cb81cad072f84e010b51a556de6dcb910d0", "committedDate": "2020-11-22T13:59:11Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03142cb81cad072f84e010b51a556de6dcb910d0", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/03142cb81cad072f84e010b51a556de6dcb910d0", "committedDate": "2020-11-22T13:59:11Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}, "afterCommit": {"oid": "ed4b25c050845b6d6169a4c463551b24dafc518c", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ed4b25c050845b6d6169a4c463551b24dafc518c", "committedDate": "2020-11-22T14:00:03Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a7926280b796e4c72d671b5406707e2bdbc247d", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5a7926280b796e4c72d671b5406707e2bdbc247d", "committedDate": "2020-11-22T14:04:20Z", "message": "Filter the rules to avoid that tested one is on another page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed4b25c050845b6d6169a4c463551b24dafc518c", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ed4b25c050845b6d6169a4c463551b24dafc518c", "committedDate": "2020-11-22T14:00:03Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}, "afterCommit": {"oid": "ed1cef83d8582c4459aa42b240dba270109a9570", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ed1cef83d8582c4459aa42b240dba270109a9570", "committedDate": "2020-11-22T14:04:59Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed1cef83d8582c4459aa42b240dba270109a9570", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ed1cef83d8582c4459aa42b240dba270109a9570", "committedDate": "2020-11-22T14:04:59Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}, "afterCommit": {"oid": "aa013ea853b4b72504733d3b6c5073a73b4a1183", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/aa013ea853b4b72504733d3b6c5073a73b4a1183", "committedDate": "2020-11-22T14:17:20Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa013ea853b4b72504733d3b6c5073a73b4a1183", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/aa013ea853b4b72504733d3b6c5073a73b4a1183", "committedDate": "2020-11-22T14:17:20Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}, "afterCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/96bd145af012c202d783f20313ef0aa04dc42fcb", "committedDate": "2020-11-22T14:22:36Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjQzMTc3", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536243177", "createdAt": "2020-11-23T08:14:27Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoxNDoyOFrOH4CtOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoxNDoyOFrOH4CtOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyNjY1MA==", "bodyText": "I don't like the idea to remove these constants.\nI prefer to have outside from a method this information, as it's easier to tweak and handle it.", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528526650", "createdAt": "2020-11-23T08:14:28Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/support/constants.rb", "diffHunk": "@@ -197,12 +197,3 @@\n                       'ubuntu1804_minion' => 'x86_64',\n                       'ubuntu2004_ssh_minion' => 'x86_64',\n                       'ubuntu2004_minion' => 'x86_64' }.freeze\n-\n-TRADITIONAL_STACK_RPMS = 'spacewalk-client-tools spacewalk-check spacewalk-client-setup '\\\n-                         'mgr-daemon mgr-osad mgr-cfg-actions'.freeze\n-\n-OPEN_SCAP_CENTOS_DEPS = 'spacewalk-oscap scap-security-guide'.freeze\n-\n-OPEN_SCAP_TRAD_DEPS = 'spacewalk-oscap'.freeze\n-\n-OPEN_SCAP_SALT_DEPS = 'openscap-utils openscap-content scap-security-guide'.freeze", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjQ0NTA3", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536244507", "createdAt": "2020-11-23T08:16:45Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoxNjo0NVrOH4CxSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoxNjo0NVrOH4CxSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyNzY4OQ==", "bodyText": "I'd prefer if we join these two steps definitions that are doing the same, but with the opposite result", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528527689", "createdAt": "2020-11-23T08:16:45Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -729,6 +729,32 @@\n   end\n end\n \n+When(/^I disable SUSE Manager tools repositories on \"([^\"]*)\"$/) do |host|\n+  node = get_target(host)\n+  os_version, os_family = get_os_version(node)\n+  if os_family =~ /^opensuse/ || os_family =~ /^sles/\n+    repos, _code = node.run('zypper lr | grep \"tools\" | cut -d\"|\" -f2')\n+    node.run(\"zypper mr --disable #{repos.gsub(/\\s/, ' ')}\")\n+  elsif os_family =~ /^centos/\n+    repos, _code = node.run('yum repolist enabled 2>/dev/null | grep \"tools\" | cut -d\" \" -f1')\n+    repos.gsub(/\\s/, ' ').split.each do |repo|\n+      node.run(\"sed -i 's/enabled=.*/enabled=0/g' /etc/yum.repos.d/#{repo}.repo\")\n+    end\n+  end\n+end\n+\n+When(/^I enable universe repositories on \"([^\"]*)\"$/) do |host|\n+  node = get_target(host)\n+  node.run(\"sed -i '/^#\\\\s*deb http:\\\\/\\\\/archive.ubuntu.com\\\\/ubuntu .* universe/ s/^#\\\\s*deb /deb /' /etc/apt/sources.list\")\n+  node.run(\"apt-get update\")\n+end\n+\n+When(/^I disable universe repositories on \"([^\"]*)\"$/) do |host|\n+  node = get_target(host)\n+  node.run(\"sed -i '/^deb http:\\\\/\\\\/archive.ubuntu.com\\\\/ubuntu .* universe/ s/^deb /# deb /' /etc/apt/sources.list\")\n+  node.run(\"apt-get update\")\n+end\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjQ2ODU1", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536246855", "createdAt": "2020-11-23T08:20:36Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyMDozN1rOH4C4QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyMDozN1rOH4C4QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyOTQ3Mw==", "bodyText": "I hope we never pass Sonarcube in our code, as we are adding a lot of duplicated code :S\nI would also refactor this code in the manner you wish, to don't have two \"step definitions\" doing exactly the same behavior but with the opposite result.", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528529473", "createdAt": "2020-11-23T08:20:37Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -729,6 +729,32 @@\n   end\n end\n \n+When(/^I disable SUSE Manager tools repositories on \"([^\"]*)\"$/) do |host|\n+  node = get_target(host)\n+  os_version, os_family = get_os_version(node)\n+  if os_family =~ /^opensuse/ || os_family =~ /^sles/\n+    repos, _code = node.run('zypper lr | grep \"tools\" | cut -d\"|\" -f2')\n+    node.run(\"zypper mr --disable #{repos.gsub(/\\s/, ' ')}\")\n+  elsif os_family =~ /^centos/\n+    repos, _code = node.run('yum repolist enabled 2>/dev/null | grep \"tools\" | cut -d\" \" -f1')\n+    repos.gsub(/\\s/, ' ').split.each do |repo|\n+      node.run(\"sed -i 's/enabled=.*/enabled=0/g' /etc/yum.repos.d/#{repo}.repo\")\n+    end\n+  end\n+end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjQ5MTcy", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536249172", "createdAt": "2020-11-23T08:24:09Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyNDoxMFrOH4C_Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyNDoxMFrOH4C_Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMTIxOQ==", "bodyText": "Does it only happen in CentOS7? It doesn't happen on CentOS 8?", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528531219", "createdAt": "2020-11-23T08:24:10Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -771,17 +771,30 @@\n end\n \n When(/^I (install|remove) the traditional stack utils (on|from) \"([^\"]*)\"$/) do |action, where, host|\n-  step %(I #{action} packages \"#{TRADITIONAL_STACK_RPMS}\" #{where} this \"#{host}\")\n+  pkgs = 'spacewalk-client-tools spacewalk-check spacewalk-client-setup mgr-daemon mgr-osad mgr-cfg-actions'\n+  step %(I #{action} packages \"#{pkgs}\" #{where} this \"#{host}\")\n end\n \n-When(/^I (install|remove) OpenSCAP (traditional|salt|centos) dependencies (on|from) \"([^\"]*)\"$/) do |action, client_type, where, host|\n-  if client_type == 'traditional'\n-    step %(I #{action} packages \"#{OPEN_SCAP_TRAD_DEPS}\" #{where} this \"#{host}\")\n-  elsif client_type == 'salt'\n-    step %(I #{action} packages \"#{OPEN_SCAP_SALT_DEPS}\" #{where} this \"#{host}\")\n-  else\n-    step %(I #{action} packages \"#{OPEN_SCAP_CENTOS_DEPS}\" #{where} this \"#{host}\")\n+When(/^I (install|remove) OpenSCAP dependencies (on|from) \"([^\"]*)\"$/) do |action, where, host|\n+  node = get_target(host)\n+  os_version, os_family = get_os_version(node)\n+  if os_family =~ /^opensuse/ || os_family =~ /^sles/\n+    pkgs = 'openscap-utils openscap-content'\n+  elsif os_family =~ /^centos/\n+    pkgs = 'openscap-utils scap-security-guide'\n+  elsif os_family =~ /^ubuntu/\n+    pkgs = 'libopenscap8 ssg-debderived'\n   end\n+  pkgs += ' spacewalk-oscap' if host.include? 'client'\n+  step %(I #{action} packages \"#{pkgs}\" #{where} this \"#{host}\")\n+end\n+\n+# On CentOS 7, OpenSCAP files are for RedHat and need a small adaptation for CentOS\n+When(/^I fix CentOS 7 OpenSCAP files on \"([^\"]*)\"$/) do |host|\n+  node = get_target(host)\n+  script = '/<\\/rear-matter>/a  <platform idref=\"cpe:/o:centos:centos:7\"/>'\n+  file = \"/usr/share/xml/scap/ssg/content/ssg-rhel7-xccdf.xml\"\n+  node.run(\"sed -i '#{script}' #{file}\")\n end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjUwNTQy", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536250542", "createdAt": "2020-11-23T08:26:21Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyNjoyMVrOH4DDbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyNjoyMVrOH4DDbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMjMzMw==", "bodyText": "If I recall correctly, a few weeks ago I manage to hide this information from the Gherkin code.\nCould you review that there is no method that provides you this action without specifying fake repository names (os_pool_repo os_update_repo) here in the scenario?", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528532333", "createdAt": "2020-11-23T08:26:21Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/secondary/trad_openscap_audit.feature", "diffHunk": "@@ -34,19 +40,24 @@ Feature: openSCAP audit of traditional client\n     And I click on \"Update Organization\"\n     Then I should see a \"Organization SUSE Test was successfully updated.\" text\n \n-  Scenario: Delete audit results from traditional client\n+  Scenario: Cleanup: delete audit results from traditional client\n     Given I am on the Systems overview page of this \"sle_client\"\n     When I follow \"Audit\" in the content area\n     And I follow \"List Scans\" in the content area\n     And I click on \"Select All\"\n     And I click on \"Remove Selected Scans\"\n     And I click on \"Confirm\"\n-    Then I should see a \"deleted. 0 SCAP Scan(s) retained\" text\n+    Then I should see a \"1 SCAP Scan(s) deleted. 0 SCAP Scan(s) retained\" text\n \n-  Scenario: Restore audit scans retention period on traditional client\n+  Scenario: Cleanup: restore audit scans retention period on traditional client\n     Given I am on the Organizations page\n     When I follow \"SUSE Test\" in the content area\n     And I follow \"Configuration\" in the content area\n     And I enter \"90\" as \"scap_retention_period\"\n     And I click on \"Update Organization\"\n     Then I should see a \"Organization SUSE Test was successfully updated.\" text\n+\n+  Scenario: Cleanup: remove the openSCAP packages from the traditional client\n+    When I remove OpenSCAP dependencies from \"sle_client\"\n+    And I disable SUSE Manager tools repositories on \"sle_client\"\n+    And I disable repository \"os_pool_repo os_update_repo\" on this \"sle_client\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjUxNzAz", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536251703", "createdAt": "2020-11-23T08:28:05Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyODowNVrOH4DGyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyODowNVrOH4DGyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMzE5NQ==", "bodyText": "These kinds of assumptions are very problematic for idempotency and it's a source of issues if we decide to run the tests in parallel. Please keep that in mind. Note it will not impact if the minion only runs SCAP in this feature.", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528533195", "createdAt": "2020-11-23T08:28:05Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/secondary/trad_openscap_audit.feature", "diffHunk": "@@ -34,19 +40,24 @@ Feature: openSCAP audit of traditional client\n     And I click on \"Update Organization\"\n     Then I should see a \"Organization SUSE Test was successfully updated.\" text\n \n-  Scenario: Delete audit results from traditional client\n+  Scenario: Cleanup: delete audit results from traditional client\n     Given I am on the Systems overview page of this \"sle_client\"\n     When I follow \"Audit\" in the content area\n     And I follow \"List Scans\" in the content area\n     And I click on \"Select All\"\n     And I click on \"Remove Selected Scans\"\n     And I click on \"Confirm\"\n-    Then I should see a \"deleted. 0 SCAP Scan(s) retained\" text\n+    Then I should see a \"1 SCAP Scan(s) deleted. 0 SCAP Scan(s) retained\" text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjUyNjgy", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536252682", "createdAt": "2020-11-23T08:29:36Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyOTozNlrOH4DJwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyOTozNlrOH4DJwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMzk1Mg==", "bodyText": "Unless \"rule-pwd-warnage\" text is visible on the UI and for the user, I'd prefer to have a step definition hiding this technical detail.", "url": "https://github.com/uyuni-project/uyuni/pull/2880#discussion_r528533952", "createdAt": "2020-11-23T08:29:36Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/secondary/trad_openscap_audit.feature", "diffHunk": "@@ -23,8 +28,9 @@ Feature: openSCAP audit of traditional client\n     Then I should see a \"Details of XCCDF Scan\" text\n     And I should see a \"Default\" text\n     And I should see a \"XCCDF Rule Results\" text\n-    And I should see a \"pass\" text or \"notapplicable\" text\n-    And I should see a \"rule-\" link\n+    When I enter \"pass\" as the filtered XCCDF result type\n+    And I click on the filter button\n+    Then I should see a \"rule-pwd-warnage\" link", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjY4NjI5", "url": "https://github.com/uyuni-project/uyuni/pull/2880#pullrequestreview-536268629", "createdAt": "2020-11-23T08:53:33Z", "commit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a2cf150dc8fa2a55cd6e3f2b888af255aeda24a", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3a2cf150dc8fa2a55cd6e3f2b888af255aeda24a", "committedDate": "2020-11-23T09:11:07Z", "message": "Idempotency: clean up audit results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb9b72eed0802473fca8544a874ce55776a25ca8", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bb9b72eed0802473fca8544a874ce55776a25ca8", "committedDate": "2020-11-23T09:12:57Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96bd145af012c202d783f20313ef0aa04dc42fcb", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/96bd145af012c202d783f20313ef0aa04dc42fcb", "committedDate": "2020-11-22T14:22:36Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}, "afterCommit": {"oid": "bb9b72eed0802473fca8544a874ce55776a25ca8", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bb9b72eed0802473fca8544a874ce55776a25ca8", "committedDate": "2020-11-23T09:12:57Z", "message": "Install correct OpenSCAP packages, and fix them if needed"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 866, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}