{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTUxMDg4", "number": 2290, "title": "Verify packages index with best checksum algorithm", "bodyText": "What does this PR change?\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: Just a bugfix\n\n\n DONE\n\n\nTest coverage\nI am not sure if backend/common/test/test_repo.py is executed anywhere, I had to change the import path everywhere and only ran the test from a particular directory. I think it makes more sense to clean the execution up than commit my additional test as is.\n\n DONE\n\nLinks\nFixes #2283\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\" (Test skipped, there are no changes to test)\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-06-04T16:22:59Z", "url": "https://github.com/uyuni-project/uyuni/pull/2290", "merged": true, "mergeCommit": {"oid": "b42a7f981c524a586a32a7deedbdd0f612121f39"}, "closed": true, "closedAt": "2020-06-22T11:16:31Z", "author": {"login": "agraul"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoBIKAAFqTQyNDY1MjEwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr1QNdAFqTQzMTUwMDUzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjUyMTA2", "url": "https://github.com/uyuni-project/uyuni/pull/2290#pullrequestreview-424652106", "createdAt": "2020-06-04T17:01:45Z", "commit": {"oid": "ddf97f96d6662b5d720445f5ffdbc25e3321045a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzowMTo0NVrOGfPY1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzowMTo0NVrOGfPY1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxMTE1OQ==", "bodyText": "You need to adapt the parser as well. Currently only \"sha256\", \"sha1\", \"md5\" are supported.\nMaybe currently debian do not use better algorithms, but sooner or later they will. So why not support them already.", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r435411159", "createdAt": "2020-06-04T17:01:45Z", "author": {"login": "mcalmer"}, "path": "backend/common/repo.py", "diffHunk": "@@ -214,19 +214,22 @@ def is_flat(self) -> bool:\n \n     def verify_packages_index(self) -> bool:\n         \"\"\"\n-        Verify Packages index against all listed checksum algorithms.\n+        Verify Packages index with the best available checksum algorithm.\n \n-        :param name: name of the packages index\n         :return: result (boolean)\n         \"\"\"\n         name, data = self.get_pkg_index_raw()\n         entry = self.get_release_index().get(name)\n-        for algorithm in [\"md5\", \"sha1\", \"sha256\"]:\n-            if entry is None:\n-                res = False\n-            else:\n-                res = getattr(hashlib, algorithm)(data).hexdigest() == getattr(entry.checksum, algorithm)\n-            if not res:\n+        if entry is None:\n+            return False\n+\n+        result = False\n+        for algorithm in (\"sha512\", \"sha384\", \"sha256\", \"sha1\", \"md5\"):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddf97f96d6662b5d720445f5ffdbc25e3321045a"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddf97f96d6662b5d720445f5ffdbc25e3321045a", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ddf97f96d6662b5d720445f5ffdbc25e3321045a", "committedDate": "2020-06-04T16:15:29Z", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283"}, "afterCommit": {"oid": "da0d7f9a17798a74d523bd4ff6b8ec93fea82b24", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/da0d7f9a17798a74d523bd4ff6b8ec93fea82b24", "committedDate": "2020-06-05T12:40:00Z", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da0d7f9a17798a74d523bd4ff6b8ec93fea82b24", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/da0d7f9a17798a74d523bd4ff6b8ec93fea82b24", "committedDate": "2020-06-05T12:40:00Z", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283"}, "afterCommit": {"oid": "1326f0f68fd35e7b2ebebd875f3391831e0c67ad", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1326f0f68fd35e7b2ebebd875f3391831e0c67ad", "committedDate": "2020-06-05T13:18:53Z", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1326f0f68fd35e7b2ebebd875f3391831e0c67ad", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1326f0f68fd35e7b2ebebd875f3391831e0c67ad", "committedDate": "2020-06-05T13:18:53Z", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283"}, "afterCommit": {"oid": "b82cdba9c8c827f8407aa6722349c8a24caf4268", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b82cdba9c8c827f8407aa6722349c8a24caf4268", "committedDate": "2020-06-08T14:23:38Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was 536787d and the test now fails 100% of the\ntime."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b82cdba9c8c827f8407aa6722349c8a24caf4268", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b82cdba9c8c827f8407aa6722349c8a24caf4268", "committedDate": "2020-06-08T14:23:38Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was 536787d and the test now fails 100% of the\ntime."}, "afterCommit": {"oid": "d0dc6c2804c055966302da22785c1c1ea5d9d2e1", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d0dc6c2804c055966302da22785c1c1ea5d9d2e1", "committedDate": "2020-06-08T14:28:24Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0dc6c2804c055966302da22785c1c1ea5d9d2e1", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d0dc6c2804c055966302da22785c1c1ea5d9d2e1", "committedDate": "2020-06-08T14:28:24Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time."}, "afterCommit": {"oid": "e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "committedDate": "2020-06-12T09:45:39Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjE1MTcw", "url": "https://github.com/uyuni-project/uyuni/pull/2290#pullrequestreview-429615170", "createdAt": "2020-06-12T09:58:51Z", "commit": {"oid": "e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwOTo1ODo1MVrOGi-Shg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwOTo1ODo1MVrOGi-Shg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNTMxOA==", "bodyText": "This entry needs to be added to the top of the file. It got placed in the wrong place probably after last rebase.", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r439325318", "createdAt": "2020-06-12T09:58:51Z", "author": {"login": "meaksh"}, "path": "backend/spacewalk-backend.changes", "diffHunk": "@@ -6,6 +6,7 @@ Wed Jun 10 12:14:57 CEST 2020 - jgonzalez@suse.com\n - supportconfig speedup fixes, add option to not compress spacewalk-debug output dir\n - Prevent failure when syncing from RHEL CDN due extra params (bsc#1171885)\n - Ubuntu repos sync uses http proxy (bsc#1168845)\n+- Only check strongest available Ubuntu/Debian repository index checksum", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112fde88ac153c0babdd29396969188653d487e6", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/112fde88ac153c0babdd29396969188653d487e6", "committedDate": "2020-06-12T10:05:14Z", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d8d04f0e899523fff63c6c698160804a78bdf425", "committedDate": "2020-06-12T10:05:14Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "committedDate": "2020-06-12T09:45:39Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time."}, "afterCommit": {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425", "author": {"user": {"login": "agraul", "name": "Alexander Graul"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d8d04f0e899523fff63c6c698160804a78bdf425", "committedDate": "2020-06-12T10:05:14Z", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjI0MDU4", "url": "https://github.com/uyuni-project/uyuni/pull/2290#pullrequestreview-429624058", "createdAt": "2020-06-12T10:13:20Z", "commit": {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5ODMxMjEy", "url": "https://github.com/uyuni-project/uyuni/pull/2290#pullrequestreview-429831212", "createdAt": "2020-06-12T15:22:28Z", "commit": {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTAwNTM3", "url": "https://github.com/uyuni-project/uyuni/pull/2290#pullrequestreview-431500537", "createdAt": "2020-06-16T13:27:30Z", "commit": {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1296, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}