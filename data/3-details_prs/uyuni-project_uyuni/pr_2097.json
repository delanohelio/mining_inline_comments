{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NTg4ODky", "number": 2097, "title": "Fix sp migration without target product", "bodyText": "What does this PR change?\nTest every installed extension if a successor could be found in the migration target set.\nIf not show them in UI to give a hint whats wrong.\nFor XMLRPC skip them.\nThis improve the situation for typical cases:\n\nLTSS product installed but not available in the migration target\nHA product installed on SLES for SAP\nunknown extension installed\n\nGUI diff\n\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: internal\n\n\n DONE\n\n\nTest coverage\n\n\nUnit tests were added\n\n\n DONE\n\n\nLinks\nFixes SUSE/spacewalk#11135\nFixes SUSE/spacewalk#10560\nTracks\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-04-04T14:25:39Z", "url": "https://github.com/uyuni-project/uyuni/pull/2097", "merged": true, "mergeCommit": {"oid": "651bccd6918f8d7313ac2dc90998892cd9812f1b"}, "closed": true, "closedAt": "2020-04-07T14:21:08Z", "author": {"login": "mcalmer"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU98nTgBqjMyMDUxNDE2MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVT46TgFqTM4OTE1MTQwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b58ef482f94963af3dc77578cc553848d7de9067", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b58ef482f94963af3dc77578cc553848d7de9067", "committedDate": "2020-04-04T14:20:01Z", "message": "Variant 2: test extensions and list not available one"}, "afterCommit": {"oid": "6cc420f1b0f2b648103a4a24d50bc60d25cd1528", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6cc420f1b0f2b648103a4a24d50bc60d25cd1528", "committedDate": "2020-04-06T12:34:28Z", "message": "remove incompatible migration targets in XMLRPC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3165e07be19b810db4d847dbf6caeff87e5d4025", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3165e07be19b810db4d847dbf6caeff87e5d4025", "committedDate": "2020-04-07T09:02:53Z", "message": "skip and show migration targets which do not have a successor for all installed extension products (bsc#1168227)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2bb93b60e07b4a521b36b2a32db84d793f3941a", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a2bb93b60e07b4a521b36b2a32db84d793f3941a", "committedDate": "2020-04-07T09:02:53Z", "message": "unit tests: test LTSS not available in the migration target"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f1cd091a6e148f9da170560d3023e5519a27f18", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2f1cd091a6e148f9da170560d3023e5519a27f18", "committedDate": "2020-04-07T09:03:22Z", "message": "update changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63252d4597e4df53e89a496c3653927387150192", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/63252d4597e4df53e89a496c3653927387150192", "committedDate": "2020-04-07T09:03:22Z", "message": "quartz moved to Uyuni:Other"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d3c390dd9063e059e3cd2b24354732b750a4c4c", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7d3c390dd9063e059e3cd2b24354732b750a4c4c", "committedDate": "2020-04-06T15:07:47Z", "message": "checkstyle"}, "afterCommit": {"oid": "63252d4597e4df53e89a496c3653927387150192", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/63252d4597e4df53e89a496c3653927387150192", "committedDate": "2020-04-07T09:03:22Z", "message": "quartz moved to Uyuni:Other"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MTUxNDA2", "url": "https://github.com/uyuni-project/uyuni/pull/2097#pullrequestreview-389151406", "createdAt": "2020-04-07T14:06:52Z", "commit": {"oid": "3165e07be19b810db4d847dbf6caeff87e5d4025"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNDowNjo1MlrOGCFRPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNDowNjo1MlrOGCFRPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNjY3MA==", "bodyText": "You can pass the installedProducts directly, not via an optional (the only thing that's done via the optional is get() in this method).", "url": "https://github.com/uyuni-project/uyuni/pull/2097#discussion_r404836670", "createdAt": "2020-04-07T14:06:52Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/manager/distupgrade/DistUpgradeManager.java", "diffHunk": "@@ -695,4 +697,42 @@ public static Long scheduleDistUpgrade(User user, Server server,\n         // Return the ID of the scheduled action\n         return ActionManager.scheduleDistUpgrade(user, server, details, earliest).getId();\n     }\n+\n+    /**\n+     * Remove incompatible migration targets compared to the installed products.\n+     * Write the failed products in the missingSuccesorExtensions set in case it should\n+     * be shown somewhere.\n+     *\n+     * @param installedProducts Optional set of the installed products\n+     * @param allMigrationTargets all calculated migration targets\n+     * @param missingSuccessorExtensions OUT: info about installed extensions missing a successor\n+     * @return list of valid migration targets\n+     */\n+    public static List<SUSEProductSet> removeIncompatibleTargets(Optional<SUSEProductSet> installedProducts,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3165e07be19b810db4d847dbf6caeff87e5d4025"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1587, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}