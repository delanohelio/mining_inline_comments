{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMDEwOTIw", "number": 2182, "title": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS", "bodyText": "What does this PR change?\nNOTE: The part for SUSE Manager bootstrap repos is missing, as the SCC channels are not ready yet. This will be part of a separate PR.\nEnable support for syncing and bootstrapping Ubuntu 20.04 LTS.\nI was able to onboard from WebUI and bootstrap script, and as salt-ssh client.\nWhat was tested and works:\n\nApply highstate\nInstall package\nRemove package\nList packages (see one exception below)\nRun a remote command\n\nWhat doesn't work:\n\nIf you remove a package, doesn't matter if from WebUI or manually from the instance, the package doesn't get remove from the list of packages at the WebUI. I checked the instance itself with salt-call pkg.list_pkgs and the output was right, so the problem is maybe on the master or the server.\n\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nDocumentation PR\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: To be prepated by QA soon, on Cucumber. For now, manual testing.\n\n\n DONE\n\n\nLinks\nTracks SUSE/spacewalk#11368 and SUSE/spacewalk#11367\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-05-04T15:09:46Z", "url": "https://github.com/uyuni-project/uyuni/pull/2182", "merged": true, "mergeCommit": {"oid": "61bae123f27f9c1672517788b805d7515ed97977"}, "closed": true, "closedAt": "2020-05-07T17:29:43Z", "author": {"login": "juliogonzalez"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceBAYgAFqTQwNTA4NDE3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABce_lR-gFqTQwNzYyMzIyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDg0MTcy", "url": "https://github.com/uyuni-project/uyuni/pull/2182#pullrequestreview-405084172", "createdAt": "2020-05-04T15:14:07Z", "commit": {"oid": "76b2d9bb7f39deb969be40de2c4ac4620066bc4d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNToxNDowN1rOGQE_jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNToxNDowN1rOGQE_jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxMjIwNg==", "bodyText": "There will be more packages, don't panic.\nI want to start from scratch instead of reusing stuff from Ubuntu 18.04, so we can have only the packages we really need for a really minimal Ubuntu installation (I am trying with Ubuntu Server without anything preinstalled but the openssh server).", "url": "https://github.com/uyuni-project/uyuni/pull/2182#discussion_r419512206", "createdAt": "2020-05-04T15:14:07Z", "author": {"login": "juliogonzalez"}, "path": "susemanager/src/mgr_bootstrap_data.py", "diffHunk": "@@ -538,6 +538,11 @@\n     \"dmidecode\",\n ]\n \n+PKGLISTUBUNTU2004 = [\n+    \"salt-common\",\n+    \"salt-minion\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76b2d9bb7f39deb969be40de2c4ac4620066bc4d"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76b2d9bb7f39deb969be40de2c4ac4620066bc4d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/76b2d9bb7f39deb969be40de2c4ac4620066bc4d", "committedDate": "2020-05-04T15:04:07Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}, "afterCommit": {"oid": "2e882fa294ea5533c0d5dd09d657509ff0f3ea01", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2e882fa294ea5533c0d5dd09d657509ff0f3ea01", "committedDate": "2020-05-04T15:45:13Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e882fa294ea5533c0d5dd09d657509ff0f3ea01", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2e882fa294ea5533c0d5dd09d657509ff0f3ea01", "committedDate": "2020-05-04T15:45:13Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}, "afterCommit": {"oid": "7bd341b269e9bc17f2380e6c77f5dfe6fdcbb6a7", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7bd341b269e9bc17f2380e6c77f5dfe6fdcbb6a7", "committedDate": "2020-05-06T11:48:09Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7bd341b269e9bc17f2380e6c77f5dfe6fdcbb6a7", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7bd341b269e9bc17f2380e6c77f5dfe6fdcbb6a7", "committedDate": "2020-05-06T11:48:09Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}, "afterCommit": {"oid": "275a5dd9542c454706d9dcfb0089077401214b2a", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/275a5dd9542c454706d9dcfb0089077401214b2a", "committedDate": "2020-05-06T16:06:35Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "275a5dd9542c454706d9dcfb0089077401214b2a", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/275a5dd9542c454706d9dcfb0089077401214b2a", "committedDate": "2020-05-06T16:06:35Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}, "afterCommit": {"oid": "432645213857878eeb4b3901095b752514ede348", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/432645213857878eeb4b3901095b752514ede348", "committedDate": "2020-05-07T08:56:05Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "432645213857878eeb4b3901095b752514ede348", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/432645213857878eeb4b3901095b752514ede348", "committedDate": "2020-05-07T08:56:05Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}, "afterCommit": {"oid": "e643cd41816bba72da36bca03b5cb129442cd3a2", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e643cd41816bba72da36bca03b5cb129442cd3a2", "committedDate": "2020-05-07T09:58:46Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c49978535e2f1c9070740d6ea3ea0ffc43787511", "committedDate": "2020-05-07T10:42:17Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e643cd41816bba72da36bca03b5cb129442cd3a2", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e643cd41816bba72da36bca03b5cb129442cd3a2", "committedDate": "2020-05-07T09:58:46Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}, "afterCommit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c49978535e2f1c9070740d6ea3ea0ffc43787511", "committedDate": "2020-05-07T10:42:17Z", "message": "Enable support for syncing and bootstrapping Ubuntu 20.04 LTS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzU2NDY3", "url": "https://github.com/uyuni-project/uyuni/pull/2182#pullrequestreview-407356467", "createdAt": "2020-05-07T10:47:25Z", "commit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDo0NzoyNVrOGR494Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDo0NzoyNVrOGR494Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQxMjMyMQ==", "bodyText": "This prevents getting extra \"recommended\" dependencies: debconf-utils, python3-tz and python3-croniter. I got the same test results with or without them. Even if we discover that they are really needed, then we should make them required on salt.\nWhy I did this? Because debconf-utils is a problem. The package is at universe, so for SUSE Manager I had to add it to the client tools. But the package that creates it is debconf (which is on main), and FMPOV doing that is really dangerous.", "url": "https://github.com/uyuni-project/uyuni/pull/2182#discussion_r421412321", "createdAt": "2020-05-07T10:47:25Z", "author": {"login": "juliogonzalez"}, "path": "spacewalk/certs-tools/rhn_bootstrap_strings.py", "diffHunk": "@@ -664,7 +664,7 @@ def getRegistrationStackSh(saltEnabled):\n \t        apt-get purge salt-common\n \t        rm -rf /etc/salt/minion.d/\n         fi\n-        apt-get --yes install $A_MISSING\n+        apt-get --yes install --no-install-recommends $A_MISSING", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzU3MDc4", "url": "https://github.com/uyuni-project/uyuni/pull/2182#pullrequestreview-407357078", "createdAt": "2020-05-07T10:48:22Z", "commit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDo0ODoyMlrOGR4_2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDo0ODoyMlrOGR4_2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQxMjgyNg==", "bodyText": "NOTE: This only works for apt-based systems (see https://docs.saltstack.com/en/latest/ref/states/all/salt.states.pkg.html)", "url": "https://github.com/uyuni-project/uyuni/pull/2182#discussion_r421412826", "createdAt": "2020-05-07T10:48:22Z", "author": {"login": "juliogonzalez"}, "path": "susemanager-utils/susemanager-sls/salt/bootstrap/init.sls", "diffHunk": "@@ -131,6 +131,7 @@ trust_suse_manager_tools_deb_gpg_key:\n salt-minion-package:\n   pkg.latest:\n     - name: salt-minion\n+    - install_recommends: False", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzU3NDA4", "url": "https://github.com/uyuni-project/uyuni/pull/2182#pullrequestreview-407357408", "createdAt": "2020-05-07T10:48:52Z", "commit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDo0ODo1MlrOGR5A7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDo0ODo1MlrOGR5A7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQxMzEwMQ==", "bodyText": "Missing from this PR: the SUSE Manager repo. Can't add them until SCC channels for Ubuntu 20.04 are ready.", "url": "https://github.com/uyuni-project/uyuni/pull/2182#discussion_r421413101", "createdAt": "2020-05-07T10:48:52Z", "author": {"login": "juliogonzalez"}, "path": "susemanager/src/mgr_bootstrap_data.py", "diffHunk": "@@ -1142,6 +1156,11 @@\n         'DEST' : '/srv/www/htdocs/pub/repositories/ubuntu/18/4/bootstrap/',\n         'TYPE' : 'deb'\n     },\n+    'ubuntu-20.04-amd64-uyuni' : {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjIzMjI1", "url": "https://github.com/uyuni-project/uyuni/pull/2182#pullrequestreview-407623225", "createdAt": "2020-05-07T16:08:33Z", "commit": {"oid": "c49978535e2f1c9070740d6ea3ea0ffc43787511"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1412, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}