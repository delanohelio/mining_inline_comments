{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMjkyNTgy", "number": 1859, "title": "TESTSUITE: Add tests for content staging in Ubuntu minion", "bodyText": "What does this PR change?\nAdd cucumber tests for content staging in Ubuntu minion.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: only internal and user invisible changes\n\n\n DONE\n\n\nTest coverage\n\n\nCucumber tests were added\n\n\n DONE\n\n\nLinks\nFixes #\nTracks https://github.com/SUSE/spacewalk/pull/9977\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-02-03T12:28:06Z", "url": "https://github.com/uyuni-project/uyuni/pull/1859", "merged": true, "mergeCommit": {"oid": "0fabbf781a8eb4f3b2b3f8357fa2cbbc8f533ad1"}, "closed": true, "closedAt": "2020-06-10T10:46:11Z", "author": {"login": "chiaradiamarcelo"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAsTTDgFqTM1MjIyNDk0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp3TTBAFqTQyNzkzMTM0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjI0OTQ5", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-352224949", "createdAt": "2020-02-03T12:42:59Z", "commit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMjo0Mjo1OVrOFkwE2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMjo0Mjo1OVrOFkwE2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA4MDczMQ==", "bodyText": "Don't re-add this file please.", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374080731", "createdAt": "2020-02-03T12:42:59Z", "author": {"login": "Bischoff"}, "path": "testsuite/run_sets/testsuite.yml", "diffHunk": "@@ -0,0 +1,143 @@\n+# This file describes the order of features in a normal testsuite run.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjUwOTE5", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-352250919", "createdAt": "2020-02-03T13:28:42Z", "commit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzoyODo0MlrOFkxS-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzoyODo0MlrOFkxS-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwMDcyOA==", "bodyText": "In order to cover other clients could you please do that?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if host == 'sle_minion'\n          \n          \n            \n              if host.include? 'ubuntu'\n          \n          \n            \n                cmd = \"ls /var/cache/apt/archives/#{pkg_name}*.deb\"\n          \n          \n            \n              else\n          \n          \n            \n                cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n          \n          \n            \n              end", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374100728", "createdAt": "2020-02-03T13:28:42Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -703,7 +703,11 @@\n \n When(/^I wait until the package \"(.*?)\" has been cached on this \"(.*?)\"$/) do |pkg_name, host|\n   node = get_target(host)\n-  cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n+  if host == 'sle_minion'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjYzNjcz", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-352263673", "createdAt": "2020-02-03T13:48:29Z", "commit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzo0ODoyOVrOFkx5Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzo0ODoyOVrOFkx5Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExMDQ3NA==", "bodyText": "2017-2020", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374110474", "createdAt": "2020-02-03T13:48:29Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/min_ubuntu_salt_install_with_staging.feature", "diffHunk": "@@ -0,0 +1,66 @@\n+# Copyright (c) 2017-2019 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjYzODc2", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-352263876", "createdAt": "2020-02-03T13:48:46Z", "commit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzo0ODo0NlrOFkx5mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzo0ODo0NlrOFkx5mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExMDYxOA==", "bodyText": "I install old package \"virgo-dummy=1.0\"", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374110618", "createdAt": "2020-02-03T13:48:46Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/min_ubuntu_salt_install_with_staging.feature", "diffHunk": "@@ -0,0 +1,66 @@\n+# Copyright (c) 2017-2019 SUSE LLC\n+# Licensed under the terms of the MIT license.\n+#\n+# This feature relies on having properly configured\n+#   /etc/rhn/rhn.conf\n+# file on your SUSE Manager server.\n+#\n+# For the scope of these tests, we configure it as follows:\n+#   java.salt_content_staging_window = 0.033 (2 minutes)\n+#   java.salt_content_staging_advance = 0.05 (3 minutes)\n+# which means \"between 3 and 1 minutes before package installation or patching\"\n+\n+@ubuntu_minion\n+Feature: Install a package on the Ubuntu minion with staging enabled\n+\n+  Scenario: Pre-requisite: install virgo-dummy-1.0 package, make sure orion-dummy is not present on Ubuntu minion\n+    When I enable repository \"test_repo_deb_pool\" on this \"ubuntu_minion\"\n+    And I run \"apt update\" on \"ubuntu_minion\"\n+    And I remove package \"orion-dummy\" from this \"ubuntu_minion\"\n+    And I install package \"virgo-dummy=1.0\" on this \"ubuntu_minion\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjY1MjAw", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-352265200", "createdAt": "2020-02-03T13:50:42Z", "commit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/d1b56972f793192b8ba0b3d1225b4afe9df8d86f", "committedDate": "2020-02-03T12:25:05Z", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion"}, "afterCommit": {"oid": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "committedDate": "2020-06-10T10:22:39Z", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTI0NjQ2", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-427924646", "createdAt": "2020-06-10T10:32:32Z", "commit": {"oid": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTI5MTgz", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-427929183", "createdAt": "2020-06-10T10:39:39Z", "commit": {"oid": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMDozOTozOVrOGhvG_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMDozOTozOVrOGhvG_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAyODAzMQ==", "bodyText": "elsif", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r438028031", "createdAt": "2020-06-10T10:39:39Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -770,7 +770,11 @@\n \n When(/^I wait until the package \"(.*?)\" has been cached on this \"(.*?)\"$/) do |pkg_name, host|\n   node = get_target(host)\n-  cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n+  if host == 'sle_minion'\n+    cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n+  if host.include? 'ubuntu'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58680fcb35ccd3216a5d2f019cb16385dd76f24", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/f58680fcb35ccd3216a5d2f019cb16385dd76f24", "committedDate": "2020-06-10T10:41:05Z", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "committedDate": "2020-06-10T10:22:39Z", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion"}, "afterCommit": {"oid": "f58680fcb35ccd3216a5d2f019cb16385dd76f24", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/f58680fcb35ccd3216a5d2f019cb16385dd76f24", "committedDate": "2020-06-10T10:41:05Z", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTMxMzQx", "url": "https://github.com/uyuni-project/uyuni/pull/1859#pullrequestreview-427931341", "createdAt": "2020-06-10T10:42:50Z", "commit": {"oid": "f58680fcb35ccd3216a5d2f019cb16385dd76f24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1636, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}