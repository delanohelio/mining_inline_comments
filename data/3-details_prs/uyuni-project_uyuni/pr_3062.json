{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTk4MDUz", "number": 3062, "title": "Change Select component to use react-select", "bodyText": "What does this PR change?\nIn order to start unifying the various select implementation, use\nreact-select as the Select component implementation.\nThis involves some API changes since the options can no longer be\nchildren, but a property. Also exposing some of the more advanced\nreact-select properties.\nGUI diff\nOnly the look and feel of the select has been improved, no feature change.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: just changed the look of the select components\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: react-select is so hard to unit test that people recommend mocking it as a <select> \ud83e\udd23\n\n\n DONE\n\n\nLinks\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-12-30T15:58:11Z", "url": "https://github.com/uyuni-project/uyuni/pull/3062", "merged": true, "mergeCommit": {"oid": "760e6be770bb4d383aa0b83fbf206812d5e8deaa"}, "closed": true, "closedAt": "2021-01-07T10:26:43Z", "author": {"login": "cbosdo"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdsy-awAFqTU2MDg4NjYyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtxURVgFqTU2MzM2MzA1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwODg2NjI3", "url": "https://github.com/uyuni-project/uyuni/pull/3062#pullrequestreview-560886627", "createdAt": "2021-01-04T09:33:20Z", "commit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTozMzoyMFrOINqyKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTozMzoyMFrOINqyKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwMzM2OA==", "bodyText": "Would recommend import ReactSelect from 'react-select'; instead unless there's a specific reason for importing this way here?", "url": "https://github.com/uyuni-project/uyuni/pull/3062#discussion_r551203368", "createdAt": "2021-01-04T09:33:20Z", "author": {"login": "Etheryte"}, "path": "web/html/src/components/input/Select.js", "diffHunk": "@@ -1,12 +1,23 @@\n // @flow\n \n import * as React from 'react';\n+import { default as ReactSelect } from 'react-select';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwODkwOTI2", "url": "https://github.com/uyuni-project/uyuni/pull/3062#pullrequestreview-560890926", "createdAt": "2021-01-04T09:39:46Z", "commit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTozOTo0NlrOINq_5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTozOTo0NlrOINq_5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNjg4Nw==", "bodyText": "I think this could be simplified a bit, right now we loop over options twice. Perhaps something along these lines?\nconst convertedOptions = (options || []).map(item => typeof item === 'string' ? { label: item, value: item } : item);\nUnless there's an additional edge case I missed here and options can also be something that isn't an array at all?", "url": "https://github.com/uyuni-project/uyuni/pull/3062#discussion_r551206887", "createdAt": "2021-01-04T09:39:46Z", "author": {"login": "Etheryte"}, "path": "web/html/src/components/input/Select.js", "diffHunk": "@@ -36,32 +47,49 @@ type Props = {\n export function Select(props: Props) {\n   const {\n     inputClass,\n-    children,\n+    options,\n+    getOptionLabel,\n+    getOptionValue,\n+    formatOptionLabel,\n+    placeholder,\n+    isClearable,\n     ...propsToPass\n   } = props;\n   const formContext = React.useContext(FormContext);\n+  const convertedOptions = options instanceof Array && options.every(item => !(item instanceof Object)) ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwODkyMDEz", "url": "https://github.com/uyuni-project/uyuni/pull/3062#pullrequestreview-560892013", "createdAt": "2021-01-04T09:41:18Z", "commit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTo0MToxOVrOINrDIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTo0MToxOVrOINrDIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNzcxMg==", "bodyText": "I suspect nullable options would be a common use case (correct me if I'm wrong here?), in which case it could be useful to move this into the select component and handle it centrally there.", "url": "https://github.com/uyuni-project/uyuni/pull/3062#discussion_r551207712", "createdAt": "2021-01-04T09:41:19Z", "author": {"login": "Etheryte"}, "path": "web/html/src/manager/content-management/shared/components/panels/environment-lifecycle/environment-form.js", "diffHunk": "@@ -54,17 +54,12 @@ const EnvironmentForm = (props: Props) =>\n             name=\"predecessorLabel\"\n             label={t(\"Insert before\")}\n             labelClass=\"col-md-3\"\n-            divClass=\"col-md-8\">\n-            <option\n-              key={\"predecessorLabelEmpty\"}/>\n-            {props.environments && props.environments.map(env =>\n-              <option\n-                key={env.label}\n-                value={env.label}>\n-                {env.name}\n-              </option>\n-            )}\n-          </Select>\n+            divClass=\"col-md-8\"\n+            isClearable\n+            options={props.environments}\n+            getOptionValue={option => option != null ? option.label : null}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwODk0Mjc0", "url": "https://github.com/uyuni-project/uyuni/pull/3062#pullrequestreview-560894274", "createdAt": "2021-01-04T09:44:49Z", "commit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5f920c40c2a40be25aacc3fa82686115795a8f5", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a5f920c40c2a40be25aacc3fa82686115795a8f5", "committedDate": "2020-12-30T15:56:56Z", "message": "Change Select component to use react-select\n\nIn order to start unifying the various select implementation, use\nreact-select as the Select component implementation.\n\nThis involves some API changes since the options can no longer be\nchildren, but a property. Also exposing some of the more advanced\nreact-select properties."}, "afterCommit": {"oid": "69ca7f017c32e8f16b6a461fb2cd2f1c6dd728c1", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/69ca7f017c32e8f16b6a461fb2cd2f1c6dd728c1", "committedDate": "2021-01-04T16:53:27Z", "message": "testsuite: handle both regular and react select in steps\n\nSince the react-select component is gradually taking over the regular\nHTML select elements, handle both cases in the step to avoid touching\nevery use of it in the features."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69ca7f017c32e8f16b6a461fb2cd2f1c6dd728c1", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/69ca7f017c32e8f16b6a461fb2cd2f1c6dd728c1", "committedDate": "2021-01-04T16:53:27Z", "message": "testsuite: handle both regular and react select in steps\n\nSince the react-select component is gradually taking over the regular\nHTML select elements, handle both cases in the step to avoid touching\nevery use of it in the features."}, "afterCommit": {"oid": "00998d2cead7b308b907100ab9b67f61b42a8ee6", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/00998d2cead7b308b907100ab9b67f61b42a8ee6", "committedDate": "2021-01-04T17:16:15Z", "message": "fixup! Change Select component to use react-select"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00998d2cead7b308b907100ab9b67f61b42a8ee6", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/00998d2cead7b308b907100ab9b67f61b42a8ee6", "committedDate": "2021-01-04T17:16:15Z", "message": "fixup! Change Select component to use react-select"}, "afterCommit": {"oid": "1311f79459bb6efbd45f0f71485f9c76f6a8a521", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1311f79459bb6efbd45f0f71485f9c76f6a8a521", "committedDate": "2021-01-05T10:25:44Z", "message": "fixup! testsuite: handle both regular and react select in steps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzMxMDQz", "url": "https://github.com/uyuni-project/uyuni/pull/3062#pullrequestreview-561731043", "createdAt": "2021-01-05T11:57:05Z", "commit": {"oid": "9721890466a7a56aa08296c9130e66a556653519"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMjoxMTozNFrOIOU8Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMjoxNzo0NVrOIOVHQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTg5NDEwMg==", "bodyText": "IIUC, it's allowed to have strings in options. Maybe define it as something like:\ntype OptionType = {\n  value: number | string,\n  label: string\n}\n\nand then in type Props:\noptions: Array<OptionType | string>", "url": "https://github.com/uyuni-project/uyuni/pull/3062#discussion_r551894102", "createdAt": "2021-01-05T12:11:34Z", "author": {"login": "cbbayburt"}, "path": "web/html/src/components/input/Select.js", "diffHunk": "@@ -1,12 +1,23 @@\n // @flow\n \n import * as React from 'react';\n+import ReactSelect from 'react-select';\n import { InputBase } from './InputBase';\n import { FormContext } from './Form';\n \n type Props = {\n-  /** <option> elements to display */\n-  children: React.Node,\n+  /** Select options */\n+  options: Array<Object>,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1311f79459bb6efbd45f0f71485f9c76f6a8a521"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTg5Njg5Nw==", "bodyText": "When used directly, this won't have the added styling. Would this be a problem?", "url": "https://github.com/uyuni-project/uyuni/pull/3062#discussion_r551896897", "createdAt": "2021-01-05T12:17:45Z", "author": {"login": "cbbayburt"}, "path": "web/html/src/manager/images/image-profile-edit.js", "diffHunk": "@@ -351,15 +341,12 @@ class CreateImageProfile extends React.Component {\n     const select = <FormGroup>\n       <Label className=\"col-md-3\" name={t(\"Custom Info Values\")}/>\n       <div className=\"col-md-6\">\n-        <select value=\"\" onChange={(e) => this.addCustomData(e.target.value)}\n-          className=\"form-control\">\n-          <option key=\"0\" value=\"\" disabled=\"disabled\">{t(\"Select a custom info key\")}</option>\n-          {\n+        <ReactSelect value=\"\" onChange={({value}) => this.addCustomData(value)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1311f79459bb6efbd45f0f71485f9c76f6a8a521"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1311f79459bb6efbd45f0f71485f9c76f6a8a521", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1311f79459bb6efbd45f0f71485f9c76f6a8a521", "committedDate": "2021-01-05T10:25:44Z", "message": "fixup! testsuite: handle both regular and react select in steps"}, "afterCommit": {"oid": "8f222a830d6d6c1dfb61368f1a8c58e2e466c74a", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8f222a830d6d6c1dfb61368f1a8c58e2e466c74a", "committedDate": "2021-01-06T16:02:42Z", "message": "Merge the Combo input component into Select"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12fa2bcf1deae73da88d68fdab8fd66dd8a1c6da", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/12fa2bcf1deae73da88d68fdab8fd66dd8a1c6da", "committedDate": "2021-01-06T16:03:47Z", "message": "Change Select component to use react-select\n\nIn order to start unifying the various select implementation, use\nreact-select as the Select component implementation.\n\nThis involves some API changes since the options can no longer be\nchildren, but a property. Also exposing some of the more advanced\nreact-select properties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c8b8286bfa94719c96ab7ebd540b05562209604", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5c8b8286bfa94719c96ab7ebd540b05562209604", "committedDate": "2021-01-06T16:03:47Z", "message": "testsuite: handle both regular and react select in steps\n\nSince the react-select component is gradually taking over the regular\nHTML select elements, handle both cases in the step to avoid touching\nevery use of it in the features."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5864b8ccb8689be239a9716cfe0b3aad683ef131", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5864b8ccb8689be239a9716cfe0b3aad683ef131", "committedDate": "2021-01-06T16:03:47Z", "message": "yarn build missing update\n\nCommit missing yarn.lock update after yarn build run."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "372f594acf2d4155c55f61f3eb0b8d1bbf7784d8", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/372f594acf2d4155c55f61f3eb0b8d1bbf7784d8", "committedDate": "2021-01-06T16:03:47Z", "message": "Merge the Combo input component into Select"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f222a830d6d6c1dfb61368f1a8c58e2e466c74a", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8f222a830d6d6c1dfb61368f1a8c58e2e466c74a", "committedDate": "2021-01-06T16:02:42Z", "message": "Merge the Combo input component into Select"}, "afterCommit": {"oid": "372f594acf2d4155c55f61f3eb0b8d1bbf7784d8", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/372f594acf2d4155c55f61f3eb0b8d1bbf7784d8", "committedDate": "2021-01-06T16:03:47Z", "message": "Merge the Combo input component into Select"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMzYzMDU5", "url": "https://github.com/uyuni-project/uyuni/pull/3062#pullrequestreview-563363059", "createdAt": "2021-01-07T10:11:19Z", "commit": {"oid": "372f594acf2d4155c55f61f3eb0b8d1bbf7784d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 770, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}