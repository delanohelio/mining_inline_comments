{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Mzc3MTc0", "number": 2225, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMDo0Mzo1NFrOD9VvQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwOTo1OToxNFrOD_VQNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NjQ1ODkwOnYy", "diffSide": "RIGHT", "path": "java/code/src/com/redhat/rhn/taskomatic/TaskomaticApi.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMDo0Mzo1NFrOGWxmKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMzo1NzoxM1rOGW4Xvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUzNDQ0Mw==", "bodyText": "With this name, I think we should limit the use and hardcode the bunchName.\nOtherwise it can be used to schedule any bunch which requires Satelite permissions using this new endpoint.\nSee also scheduleRepoSync() .....", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r426534443", "createdAt": "2020-05-18T10:43:54Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/taskomatic/TaskomaticApi.java", "diffHunk": "@@ -221,6 +221,20 @@ public Date scheduleSingleSatBunch(User user, String bunchName,\n         return (Date) invoke(\"tasko.scheduleSingleSatBunchRun\", bunchName, params);\n     }\n \n+    /**\n+     * Creates a new single gatherer schedule\n+     * @param user shall be org admin\n+     * @param bunchName bunch name\n+     * @param params parameters for the bunch\n+     * @return date of the first schedule\n+     * @throws TaskomaticApiException if there was an error\n+     */\n+    public Date scheduleGathererRefresh(User user, String bunchName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f22055d6c81c71cd097f0669a9b6d426e22455"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU1NTgyNA==", "bodyText": "the activation key thing is part of the another pr i made. but i didn't make a separate branch. but i managed to get them removed.", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r426555824", "createdAt": "2020-05-18T11:25:59Z", "author": {"login": "mseidl"}, "path": "java/code/src/com/redhat/rhn/taskomatic/TaskomaticApi.java", "diffHunk": "@@ -221,6 +221,20 @@ public Date scheduleSingleSatBunch(User user, String bunchName,\n         return (Date) invoke(\"tasko.scheduleSingleSatBunchRun\", bunchName, params);\n     }\n \n+    /**\n+     * Creates a new single gatherer schedule\n+     * @param user shall be org admin\n+     * @param bunchName bunch name\n+     * @param params parameters for the bunch\n+     * @return date of the first schedule\n+     * @throws TaskomaticApiException if there was an error\n+     */\n+    public Date scheduleGathererRefresh(User user, String bunchName,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUzNDQ0Mw=="}, "originalCommit": {"oid": "16f22055d6c81c71cd097f0669a9b6d426e22455"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY0NTQzOA==", "bodyText": "I think @mcalmer wants you to get rid of the bunchName parameter and pass the gatherer-matcher-bunch on line 235.\nMoreover, I'd suggest passing a vhmLabel parameter and crafting the params map inside of this method (instead of the whole params map as a param).\nIt'd be also nice to do some additional permission checking here (just call VirtualHostManagerFactory.lookupByLabelAndOrg based on given label and user.getOrg. When the result is null -> throw an exception (IllegalStateException probably)).", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r426645438", "createdAt": "2020-05-18T13:57:13Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/taskomatic/TaskomaticApi.java", "diffHunk": "@@ -221,6 +221,20 @@ public Date scheduleSingleSatBunch(User user, String bunchName,\n         return (Date) invoke(\"tasko.scheduleSingleSatBunchRun\", bunchName, params);\n     }\n \n+    /**\n+     * Creates a new single gatherer schedule\n+     * @param user shall be org admin\n+     * @param bunchName bunch name\n+     * @param params parameters for the bunch\n+     * @return date of the first schedule\n+     * @throws TaskomaticApiException if there was an error\n+     */\n+    public Date scheduleGathererRefresh(User user, String bunchName,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUzNDQ0Mw=="}, "originalCommit": {"oid": "16f22055d6c81c71cd097f0669a9b6d426e22455"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzM0OTgyOnYy", "diffSide": "RIGHT", "path": "java/code/src/com/suse/manager/webui/controllers/VirtualHostManagerController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwOTo1ODo1MFrOGZ73MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMDo0NToxMVrOGZ9Dig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODM2OA==", "bodyText": "If the label is the only possible value which can be set I would also go with @hustodemon suggestion to replace \"params\" with \"label\" and create the params map inside of the method.\nBut for me this is optional. Not sure what franky think :-)", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r429848368", "createdAt": "2020-05-25T09:58:50Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/suse/manager/webui/controllers/VirtualHostManagerController.java", "diffHunk": "@@ -616,8 +616,7 @@ public static Object refresh(Request request, Response response, User user) {\n             Map<String, String> params = new HashMap<>();\n             params.put(GathererJob.VHM_LABEL, label);\n             try {\n-                new TaskomaticApi()\n-                        .scheduleSingleSatBunch(user, \"gatherer-matcher-bunch\", params);\n+                new TaskomaticApi().scheduleGathererRefresh(user, params);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17e80d014cf547cc1fc2668bd4e55560644a4f53"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2NzkxNA==", "bodyText": "Yes, my comments weren't addressed yet. @mseidl let me know if there is anything unclear about them.", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r429867914", "createdAt": "2020-05-25T10:45:11Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/suse/manager/webui/controllers/VirtualHostManagerController.java", "diffHunk": "@@ -616,8 +616,7 @@ public static Object refresh(Request request, Response response, User user) {\n             Map<String, String> params = new HashMap<>();\n             params.put(GathererJob.VHM_LABEL, label);\n             try {\n-                new TaskomaticApi()\n-                        .scheduleSingleSatBunch(user, \"gatherer-matcher-bunch\", params);\n+                new TaskomaticApi().scheduleGathererRefresh(user, params);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODM2OA=="}, "originalCommit": {"oid": "17e80d014cf547cc1fc2668bd4e55560644a4f53"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzM1MDk0OnYy", "diffSide": "RIGHT", "path": "java/spacewalk-java.changes", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwOTo1OToxNFrOGZ735Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjoyNDowOVrOGZ_cmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODU0OQ==", "bodyText": "Do we have a bugreport with a bugnumber for this?", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r429848549", "createdAt": "2020-05-25T09:59:14Z", "author": {"login": "mcalmer"}, "path": "java/spacewalk-java.changes", "diffHunk": "@@ -1,3 +1,4 @@\n+- fixed bug where in scheduling a vhm refresh would result in a permission error for org admins", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17e80d014cf547cc1fc2668bd4e55560644a4f53"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg5NzUzNA==", "bodyText": "it's an issue. not bug", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r429897534", "createdAt": "2020-05-25T12:00:54Z", "author": {"login": "mseidl"}, "path": "java/spacewalk-java.changes", "diffHunk": "@@ -1,3 +1,4 @@\n+- fixed bug where in scheduling a vhm refresh would result in a permission error for org admins", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODU0OQ=="}, "originalCommit": {"oid": "17e80d014cf547cc1fc2668bd4e55560644a4f53"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwNzA5OA==", "bodyText": "oops, i fixed it last week but i didn't push it. lol", "url": "https://github.com/uyuni-project/uyuni/pull/2225#discussion_r429907098", "createdAt": "2020-05-25T12:24:09Z", "author": {"login": "mseidl"}, "path": "java/spacewalk-java.changes", "diffHunk": "@@ -1,3 +1,4 @@\n+- fixed bug where in scheduling a vhm refresh would result in a permission error for org admins", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODU0OQ=="}, "originalCommit": {"oid": "17e80d014cf547cc1fc2668bd4e55560644a4f53"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4415, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}