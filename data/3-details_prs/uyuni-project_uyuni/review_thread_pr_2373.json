{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMzIwODEw", "number": 2373, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMDo1MTo0OFrOEKdjZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMDo1MjoyNlrOEKdkHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDA1NDE0OnYy", "diffSide": "RIGHT", "path": "java/code/src/com/redhat/rhn/common/db/datasource/xml/SystemGroup_queries.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMDo1MTo0OFrOGrg6YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMDo1MTo0OFrOGrg6YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI4MTE4NQ==", "bodyText": "The name advisoryTypes or groupAdvisoryTypes would be more accurate here.", "url": "https://github.com/uyuni-project/uyuni/pull/2373#discussion_r448281185", "createdAt": "2020-07-01T10:51:48Z", "author": {"login": "cbbayburt"}, "path": "java/code/src/com/redhat/rhn/common/db/datasource/xml/SystemGroup_queries.xml", "diffHunk": "@@ -79,24 +66,50 @@ ORDER BY UPPER(NAME)\n     ) x\n     ORDER BY UPPER(NAME)\n   </query>\n-    <elaborator name=\"most_severe_errata\" />\n+  <elaborator name=\"most_severe_errata\" />\n </mode>\n <query name=\"most_severe_errata\" params=\"\">\n-    SELECT sgm.server_group_id AS id,\n-        CASE MAX(CASE e.advisory_type\n-            WHEN 'Security Advisory' THEN 3\n-            WHEN 'Bug Fix Advisory' THEN 2\n-            WHEN 'Product Enhancement Advisory' THEN 1 END)\n-            WHEN 3 THEN 'Security Advisory'\n-            WHEN 2 THEN 'Bug Fix Advisory'\n-            WHEN 1 THEN 'Product Enhancement Advisory'\n-        END AS most_severe_errata\n-    FROM rhnErrata e\n-        INNER JOIN rhnServerNeededCache snpc ON e.id = snpc.errata_id\n-        INNER JOIN rhnServerGroupMembers sgm ON sgm.server_id = snpc.server_id\n-        INNER JOIN rhnServerFeaturesView sfv ON sgm.server_id = sfv.server_id\n-    WHERE sgm.server_group_id IN (%s) AND sfv.label = 'ftr_system_grouping'\n-    GROUP BY server_group_id\n+    WITH groupTypes AS NOT MATERIALIZED (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "916d890cb3b8fefe6250342a7988d32f44445577"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDA1NTk4OnYy", "diffSide": "RIGHT", "path": "java/code/src/com/redhat/rhn/common/db/datasource/xml/SystemGroup_queries.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMDo1MjoyNlrOGrg7fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMDo1MjoyNlrOGrg7fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI4MTQ2OA==", "bodyText": "I think ELSE NULL is redundant because it's the default behavior anyway.", "url": "https://github.com/uyuni-project/uyuni/pull/2373#discussion_r448281468", "createdAt": "2020-07-01T10:52:26Z", "author": {"login": "cbbayburt"}, "path": "java/code/src/com/redhat/rhn/common/db/datasource/xml/SystemGroup_queries.xml", "diffHunk": "@@ -79,24 +66,50 @@ ORDER BY UPPER(NAME)\n     ) x\n     ORDER BY UPPER(NAME)\n   </query>\n-    <elaborator name=\"most_severe_errata\" />\n+  <elaborator name=\"most_severe_errata\" />\n </mode>\n <query name=\"most_severe_errata\" params=\"\">\n-    SELECT sgm.server_group_id AS id,\n-        CASE MAX(CASE e.advisory_type\n-            WHEN 'Security Advisory' THEN 3\n-            WHEN 'Bug Fix Advisory' THEN 2\n-            WHEN 'Product Enhancement Advisory' THEN 1 END)\n-            WHEN 3 THEN 'Security Advisory'\n-            WHEN 2 THEN 'Bug Fix Advisory'\n-            WHEN 1 THEN 'Product Enhancement Advisory'\n-        END AS most_severe_errata\n-    FROM rhnErrata e\n-        INNER JOIN rhnServerNeededCache snpc ON e.id = snpc.errata_id\n-        INNER JOIN rhnServerGroupMembers sgm ON sgm.server_id = snpc.server_id\n-        INNER JOIN rhnServerFeaturesView sfv ON sgm.server_id = sfv.server_id\n-    WHERE sgm.server_group_id IN (%s) AND sfv.label = 'ftr_system_grouping'\n-    GROUP BY server_group_id\n+    WITH groupTypes AS NOT MATERIALIZED (\n+        SELECT sgm.server_group_id, e.advisory_type\n+          FROM rhnServerNeededCache snpc\n+              INNER JOIN rhnServerGroupMembers sgm ON sgm.server_id = snpc.server_id\n+              INNER JOIN rhnServerFeaturesView sfv ON sgm.server_id = sfv.server_id\n+              LEFT JOIN rhnErrata e ON e.id = snpc.errata_id\n+          WHERE sfv.label = 'ftr_system_grouping'\n+    )\n+    SELECT rhnServerGroup.id,\n+        CASE (\n+            SELECT EXISTS (SELECT 1\n+                FROM groupTypes gt\n+                    WHERE gt.server_group_id = rhnServerGroup.id\n+                    AND gt.advisory_type = 'Security Advisory')\n+        )\n+        WHEN TRUE THEN 'Security Advisory'\n+        ELSE CASE (\n+            SELECT EXISTS (SELECT 1\n+                FROM groupTypes gt\n+                    WHERE gt.server_group_id = rhnServerGroup.id\n+                    AND gt.advisory_type = 'Bug Fix Advisory')\n+        )\n+        WHEN TRUE THEN 'Bug Fix Advisory'\n+        ELSE CASE (\n+            SELECT EXISTS (SELECT 1\n+                FROM groupTypes gt\n+                    WHERE gt.server_group_id = rhnServerGroup.id\n+                    AND gt.advisory_type = 'Product Enhancement Advisory')\n+        )\n+        WHEN TRUE THEN 'Product Enhancement Advisory'\n+        ELSE CASE (\n+            SELECT EXISTS (SELECT 1\n+                FROM groupTypes gt\n+                    WHERE gt.server_group_id = rhnServerGroup.id\n+                    AND gt.advisory_type IS NULL)\n+        )\n+        WHEN TRUE THEN 'Outdated Packages'\n+        ELSE NULL", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "916d890cb3b8fefe6250342a7988d32f44445577"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4229, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}