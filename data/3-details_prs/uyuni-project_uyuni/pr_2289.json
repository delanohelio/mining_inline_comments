{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3ODQ0NzIz", "number": 2289, "title": "Fix several problems with client logs acquisition", "bodyText": "What does this PR change?\nProblems fixed:\n\nopenSUSE clients have no tar command preinstalled. Install it if missing.\nUbuntu clients fail when archiving files with absolute paths like /var/log. Add P option to ignore.\ntar fails if files change while it's archiving them. Ignore error code 1 returned in those circumstances.\nreturn code of journalctl was ignored\nadded missing clients\n\nNitpicks, cleanup, etc\n\nbump copyright year\nrespect srv_ versus allcli_ filename prefix convention\nuse When for actions and Then for tests\nuse extract_file function instead of complicated scp command\nuse one node.run() command instead of 2 whenever possible\n\nLinks\nPart of general openSUSE clients effort (SUSE/spacewalk#10235)\nBackports:\n\n4.0: SUSE/spacewalk#11644\n3.2: SUSE/spacewalk#11645\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed", "createdAt": "2020-06-04T13:35:30Z", "url": "https://github.com/uyuni-project/uyuni/pull/2289", "merged": true, "mergeCommit": {"oid": "88837e29065b3c0fa4541fb7316eb2d6a480ed03"}, "closed": true, "closedAt": "2020-06-05T12:33:59Z", "author": {"login": "Bischoff"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn-dHtgFqTQyNDQ3Mzk2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoQtFtgH2gAyNDI3ODQ0NzIzOmY1OTg2N2FiZDFmYjcyYzVmZGNhMjc1OTJhNDViMGZhYThlNGRlZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NDczOTY3", "url": "https://github.com/uyuni-project/uyuni/pull/2289#pullrequestreview-424473967", "createdAt": "2020-06-04T13:55:03Z", "commit": {"oid": "08b741a87b253c3e49c6ff5d755c6b5b67570b38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NDc3MTA3", "url": "https://github.com/uyuni-project/uyuni/pull/2289#pullrequestreview-424477107", "createdAt": "2020-06-04T13:58:09Z", "commit": {"oid": "08b741a87b253c3e49c6ff5d755c6b5b67570b38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjQ0Mzc1", "url": "https://github.com/uyuni-project/uyuni/pull/2289#pullrequestreview-424644375", "createdAt": "2020-06-04T16:52:08Z", "commit": {"oid": "08b741a87b253c3e49c6ff5d755c6b5b67570b38"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo1MjowOVrOGfPBag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo1MjowOVrOGfPBag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNTE2Mg==", "bodyText": "Are you sure this is working? I tried it and failed. This was the reason why I used scp", "url": "https://github.com/uyuni-project/uyuni/pull/2289#discussion_r435405162", "createdAt": "2020-06-04T16:52:09Z", "author": {"login": "mcalmer"}, "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -283,40 +283,38 @@\n   \"\\n-----\\n#{output[:stderr]}\\n-----\\n\"\n end\n \n-When(/^I check the tomcat logs for errors$/) do\n+Then(/^the tomcat logs should not contain errors$/) do\n   output = $server.run('cat /var/log/tomcat/*')\n   msgs = %w[ERROR NullPointer]\n   msgs.each do |msg|\n     raise \"-#{msg}-  msg found on tomcat logs\" if output.include? msg\n   end\n end\n \n-Then(/^I restart the spacewalk service$/) do\n+When(/^I restart the spacewalk service$/) do\n   $server.run('spacewalk-service restart')\n end\n \n-Then(/^I shutdown the spacewalk service$/) do\n+When(/^I shutdown the spacewalk service$/) do\n   $server.run('spacewalk-service stop')\n end\n \n-Then(/^I execute spacewalk-debug on the server$/) do\n+When(/^I execute spacewalk-debug on the server$/) do\n   $server.run('spacewalk-debug')\n-  cmd = \"echo | scp -o StrictHostKeyChecking=no root@#{$server.ip}:/tmp/spacewalk-debug.tar.bz2 . 2>&1\"\n-  command_output = `#{cmd}`\n-  unless $CHILD_STATUS.success?\n-    raise \"Execute command failed: #{$ERROR_INFO}: #{command_output}\"\n-  end\n+  code = file_extract($server, \"/tmp/spacewalk-debug.tar.bz2\", \"spacewalk-debug.tar.bz2\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08b741a87b253c3e49c6ff5d755c6b5b67570b38"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f59867abd1fb72c5fdca27592a45b0faa8e4dee8", "author": {"user": {"login": "Bischoff", "name": "E Bischoff"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f59867abd1fb72c5fdca27592a45b0faa8e4dee8", "committedDate": "2020-06-05T11:10:47Z", "message": "opensuse clients have not tar preinstalled"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1293, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}