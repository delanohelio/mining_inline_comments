{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NzIxNTA4", "number": 2328, "title": "Maintenance windows - action schedule react component", "bodyText": "This is the React counterpart of the struts PR:\n#2265\nEnhanced the ActionSchedule component with the maintenance windows picker.\nChecked all ActionSchedule usages and made them maintenance-window-aware.\nReview commit-by-commit. The first commit is a squashed & rebased version of hustodemon#1.\nTODO\n\n fix ssm-subscribe-channels.js: pass systemIds correctly\n address cluster usages\n image-build.js: does it need maintenance windows? i think in general no, but our code should be flexible enough to handle this if the action type image.build changes in the future\n looks like the code hides the date picker in case there are maintenance windows. didn't we agree on greying out? In the end we will hide that component (I reverted the Struts patch)\n deuglify the state management in action-schedule.js\n handle multiple schedules\n decide: guest-properties-form.js: which type of action and on which system id? there are multiple actions.\n spin this off: test running actions with virtualization, clusters and image building\n\nGUI diff\n\nmaint. windows picker\n\n\n\nsituation, when systems have multiple schedules (this can happen in ssm)\n\n\n\n DONE\n\nDocumentation\nSUSE/spacewalk#11254\n\n DONE\n\nTest coverage\n\n\nNo tests: We do not have tests for react components\n\n\n DONE\n\n\nLinks\nTracks SUSE/spacewalk#11230\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-06-17T09:24:15Z", "url": "https://github.com/uyuni-project/uyuni/pull/2328", "merged": true, "mergeCommit": {"oid": "757013752706307eebc3997acd357273e8b5b364"}, "closed": true, "closedAt": "2020-06-23T13:42:02Z", "author": {"login": "hustodemon"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsI6TCABqjM0NTMzMjA4MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuFDShgH2gAyNDM1NzIxNTA4OjE3NzBiNGVhYTM0YmU4MjQyMzRiZDg3YjJiMzYzZWUzODk5YzQ3MmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb74443127c5250785f132e78b460200c367dc9e", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/fb74443127c5250785f132e78b460200c367dc9e", "committedDate": "2020-06-17T09:19:49Z", "message": "[wip] todos"}, "afterCommit": {"oid": "1dc657a267dcf4c323128d249f33338ec2277332", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1dc657a267dcf4c323128d249f33338ec2277332", "committedDate": "2020-06-17T12:21:12Z", "message": "Checkstyle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43275d433965e873494c6a4742a79b486ed81b48", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/43275d433965e873494c6a4742a79b486ed81b48", "committedDate": "2020-06-17T12:22:20Z", "message": "Revert \"JSP: Support for greying out date picker\"\n\nThis reverts commit 612c78fef76237c5038f91c92ab84b344c3be9a3.\n\nThis is to be consintent with the React schedule component, that _hides_\nthe date picker in case maint. windows are defined."}, "afterCommit": {"oid": "4a8026150adfa1c9f8c0f5bf963ed15e9860dfeb", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4a8026150adfa1c9f8c0f5bf963ed15e9860dfeb", "committedDate": "2020-06-17T12:25:40Z", "message": "Revert \"JSP: Support for greying out date picker\"\n\nThis reverts commit 612c78fef76237c5038f91c92ab84b344c3be9a3.\n\nThis is to be consintent with the React schedule component, that _hides_\nthe date picker in case maint. windows are defined."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ea79191cd6bbfefe822bf7f5b2702ea5420afb2", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3ea79191cd6bbfefe822bf7f5b2702ea5420afb2", "committedDate": "2020-06-17T14:12:30Z", "message": "Remove unnecessary check from action chains renderer"}, "afterCommit": {"oid": "bb40a511f9d145ee47241856d9f2098bdc8fd292", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bb40a511f9d145ee47241856d9f2098bdc8fd292", "committedDate": "2020-06-17T14:18:01Z", "message": "Remove unnecessary check from action chains renderer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb40a511f9d145ee47241856d9f2098bdc8fd292", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bb40a511f9d145ee47241856d9f2098bdc8fd292", "committedDate": "2020-06-17T14:18:01Z", "message": "Remove unnecessary check from action chains renderer"}, "afterCommit": {"oid": "adee7ff089ba8e4de899ebf2ff29fba706b125e0", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/adee7ff089ba8e4de899ebf2ff29fba706b125e0", "committedDate": "2020-06-17T14:20:06Z", "message": "Remove unnecessary check from action chains renderer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNDM4MTY3", "url": "https://github.com/uyuni-project/uyuni/pull/2328#pullrequestreview-433438167", "createdAt": "2020-06-18T16:11:00Z", "commit": {"oid": "4e251d669f7739e388776ea8698af1bcb9496a4e"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNjoxMTowMFrOGl2bLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNjoxNTozM1rOGl2mZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0MjE4OA==", "bodyText": "Please just add a comment on top of this usage: Object.assign for this.state is deprecated outside of the constructor. Outside of it we should always use this.setState because React knows what to do properly in the state. I am totally fine using it here, but make sure to add the comment to clarify to not use it elsewhere. Thanks", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r442342188", "createdAt": "2020-06-18T16:11:00Z", "author": {"login": "ncounter"}, "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -55,31 +55,26 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n   constructor(props: ActionScheduleProps) {\n     super(props);\n \n+    const commonState = {\n+      loading: true,\n+      type: \"earliest\",\n+      earliest: props.earliest,\n+      isMaintenanceModeEnabled: false,\n+      maintenanceWindow: {},\n+      maintenanceWindows: [],\n+      systemIds: props.systemIds ? props.systemIds : [],\n+      actionType: props.actionType ? props.actionType : \"\",\n+    }\n+\n+    let actionChainsState = {};\n     if (props.actionChains) {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n+      actionChainsState = {\n         actionChain: props.actionChains.length > 0 ? props.actionChains[0] : this.newActionChainOpt,\n         actionChains: props.actionChains.length > 0 ? props.actionChains : [this.newActionChainOpt],\n-        maintenanceWindow: {}, // todo deuglify\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n-      };\n-    } else {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n-        isMaintenanceModeEnabled: false,\n-        maintenanceWindow: {},\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n       };\n     }\n \n+    this.state = Object.assign(commonState, actionChainsState);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e251d669f7739e388776ea8698af1bcb9496a4e"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NTA2MQ==", "bodyText": "Isn't it enough to check for the single this.state.actionChain? IIUC if it is present there will always be a this.state.actionChains array (in some case an Array(1), but still). Am I missing something?", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r442345061", "createdAt": "2020-06-18T16:15:33Z", "author": {"login": "ncounter"}, "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -190,43 +263,13 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n       <div className=\"spacewalk-scheduler\">\n         <div className=\"form-horizontal\">\n           <div className=\"form-group\">\n-            <div className=\"col-sm-3 control-label\">\n-              { (this.state.actionChains && this.state.actionChain) &&\n-                <input type=\"radio\" name=\"use_date\" value=\"true\" checked={this.state.type == \"earliest\"} id=\"schedule-by-date\" onChange={this.onSelectEarliest}/> }\n-              <label htmlFor=\"schedule-by-date\">{!this.state.isMaintenanceModeEnabled ?t(\"Earliest:\") : t(\"Maintenance Window:\")}</label>\n-            </div>\n-              {\n-                !this.state.isMaintenanceModeEnabled ?\n-                  <div className=\"col-sm-6\">\n-                    <DateTimePicker onChange={this.onDateTimeChanged} value={this.state.earliest} timezone={this.props.timezone} />\n-                  </div>\n-                  :\n-                  <div className=\"col-sm-6\">\n-                    <select\n-                        id=\"maintenance-window\"\n-                        className=\"form-control\"\n-                        name=\"maintenance_window\"\n-                        onChange={this.onSelectMaintenanceWindow}\n-                        onFocus={this.onFocusMaintenanceWindow}>\n-                      { this.state.maintenanceWindows.map(mw =><option key={mw.id} value={mw.id}> {mw.from + \" - \" + mw.to}</option>) }\n-                    </select>\n-                  </div>\n-              }\n-          </div>\n-          { (this.state.actionChains && this.state.actionChain) &&\n-            <div className=\"form-group\">\n-              <div className=\"col-sm-3 control-label\">\n-                <input type=\"radio\" name=\"action_chain\" value=\"false\" checked={this.state.type == \"actionChain\"} id=\"schedule-by-action-chain\" onChange={this.onFocusActionChain}/>\n-                <label htmlFor=\"schedule-by-action-chain\">{t(\"Add to:\")}</label>\n-              </div>\n-              <div className=\"col-sm-3\">\n-                { (this.state.actionChains && this.state.actionChain) &&\n-                  <Combobox id=\"action-chain\" name=\"action_chain\" selectedId={this.state.actionChain.id}\n-                            data={this.state.actionChains} onSelect={this.onSelectActionChain}\n-                            onFocus={this.onFocusActionChain} />}\n-              </div>\n-            </div>\n+            { \n+              this.renderPickers()\n+            }\n+            {\n+              this.state.actionChains && this.state.actionChain && this.renderActionChainPicker()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22ccd2a8be8505df784a69c44fd5225ce4eb1f91"}, "originalPosition": 124}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bfe4e5692e24351a10e37271552725b2b91e16e", "author": {"user": {"login": "ncounter", "name": "Dario Leidi"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7bfe4e5692e24351a10e37271552725b2b91e16e", "committedDate": "2020-06-23T12:11:15Z", "message": "ActionSchedule React component for MaintenanceWindows\n\nThe patch consists of the following parts:\n- Add endpoint to fetch maintenance windows data\n- Fetch maintenance windows from the backend\n- Use maintenance windows in highstate action scheduler\n- Use maintenance windows in single system subscribe channel action scheduler\n- [WIP] Use maintenance windows in ssm subscribe channel action scheduler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eedf627d8b38b9d24f88e57f43af2d7f44ddea7", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8eedf627d8b38b9d24f88e57f43af2d7f44ddea7", "committedDate": "2020-06-23T12:11:16Z", "message": "Use POJO for passing parameters from frontend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b38583732726dce413af5ea89cb8caa2652b8a", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/19b38583732726dce413af5ea89cb8caa2652b8a", "committedDate": "2020-06-23T12:11:16Z", "message": "Refactor: Create a POJO for passing maintenance window data to frontend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5b839a67cfa9a3974d59d53e3a6b693a11f8f39", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d5b839a67cfa9a3974d59d53e3a6b693a11f8f39", "committedDate": "2020-06-23T12:11:16Z", "message": "Adjustments in the JS scheduler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9aeee0e7ad2b41e6ae3f2caf29765010f2b11b9", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c9aeee0e7ad2b41e6ae3f2caf29765010f2b11b9", "committedDate": "2020-06-23T12:11:16Z", "message": "Fix system id computation in SSM channel assignment UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84689ffc75ef42792df79fd2bb8f69ca7119f5a2", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/84689ffc75ef42792df79fd2bb8f69ca7119f5a2", "committedDate": "2020-06-23T12:11:16Z", "message": "Make image build UI maintenance-windows aware"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "949c48e1668619ed5155380cb84ae1850e5dd6bf", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/949c48e1668619ed5155380cb84ae1850e5dd6bf", "committedDate": "2020-06-23T12:11:16Z", "message": "Make cluster UI maintenance-windows aware"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d08ca7f0a8bc90c346fcd45d3fa67de65571f50a", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d08ca7f0a8bc90c346fcd45d3fa67de65571f50a", "committedDate": "2020-06-23T12:11:16Z", "message": "Slighly improve the state assignment; Make the maint. window picker wider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cfb0250c9dad3aad35657f89103bd3ad9118c95", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2cfb0250c9dad3aad35657f89103bd3ad9118c95", "committedDate": "2020-06-23T12:11:16Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32bf9a038868c8341cc487da07d2f4645c547456", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/32bf9a038868c8341cc487da07d2f4645c547456", "committedDate": "2020-06-23T12:11:16Z", "message": "Revert \"JSP: Support for greying out date picker\"\n\nThis reverts commit 612c78fef76237c5038f91c92ab84b344c3be9a3.\n\nThis is to be consintent with the React schedule component, that _hides_\nthe date picker in case maint. windows are defined."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f65283a5257bbf88dfdd633ca99b10725922ccc", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7f65283a5257bbf88dfdd633ca99b10725922ccc", "committedDate": "2020-06-23T12:11:16Z", "message": "Refactor: Extract rendering action scheduler fragments to separate functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0308bf78c5b5341ea61f86e37ed0264d1fab8113", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0308bf78c5b5341ea61f86e37ed0264d1fab8113", "committedDate": "2020-06-23T12:11:16Z", "message": "Add UI warning when dealing with multiple maintenance schedules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41700b89d2d732447d61499df086ea4d04d769f8", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/41700b89d2d732447d61499df086ea4d04d769f8", "committedDate": "2020-06-23T12:11:16Z", "message": "Remove unnecessary check from action chains renderer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e7ac191c136e98a3fad51f6e7a02a1a41fe5cb6", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8e7ac191c136e98a3fad51f6e7a02a1a41fe5cb6", "committedDate": "2020-06-23T12:11:16Z", "message": "Fix JS lint error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20bb605118dcec82986bedad8b1a375ac2d7807a", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/20bb605118dcec82986bedad8b1a375ac2d7807a", "committedDate": "2020-06-23T12:21:47Z", "message": "Adjust the Maint. controller to use POJO instead of Triple for maint. windows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64f3c6973c42d8984831519d7a56ae82040808e3", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/64f3c6973c42d8984831519d7a56ae82040808e3", "committedDate": "2020-06-23T12:38:38Z", "message": "Unify the Maintenance windows controllers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adee7ff089ba8e4de899ebf2ff29fba706b125e0", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/adee7ff089ba8e4de899ebf2ff29fba706b125e0", "committedDate": "2020-06-17T14:20:06Z", "message": "Remove unnecessary check from action chains renderer"}, "afterCommit": {"oid": "64f3c6973c42d8984831519d7a56ae82040808e3", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/64f3c6973c42d8984831519d7a56ae82040808e3", "committedDate": "2020-06-23T12:38:38Z", "message": "Unify the Maintenance windows controllers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1770b4eaa34be824234bd87b2b363ee3899c472c", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1770b4eaa34be824234bd87b2b363ee3899c472c", "committedDate": "2020-06-23T12:59:43Z", "message": "Set state using setState in the React component"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1335, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}