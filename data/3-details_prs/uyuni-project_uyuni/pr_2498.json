{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5OTk4NDI5", "number": 2498, "title": "Pass the log level to matcher", "bodyText": "Review commit-by-commit please.\n\n\nDerive the log level from the 'debug' config option and pass it to matcher.\n\n\nAlign the data transfer object to the current version of matcher: remove the confirmed flag from JsonMatch .\n\n\n IMPORTANT: This mustn't be merged before matches is able to accept the log level parameter (i.e. code from uyuni-project/subscription-matcher#18 must be released).\n\n\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\n@mcalmer: I couldn't find any documentation about setting log level in gatherer - is there any?\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: untestable\n\n\n DONE\n\n\nLinks\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-08-19T08:14:50Z", "url": "https://github.com/uyuni-project/uyuni/pull/2498", "merged": true, "mergeCommit": {"oid": "ee33c2c8441b6a9978ab968f7cd204eaeed50711"}, "closed": true, "closedAt": "2020-09-09T12:33:27Z", "author": {"login": "hustodemon"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAXmojgBqjM2Njk3NDAxNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHLXgQABqjM3NDU1ODMzNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "971ec3eae075515801b809d9f5738c9f7da889e5", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/971ec3eae075515801b809d9f5738c9f7da889e5", "committedDate": "2020-08-19T08:15:31Z", "message": "Changelog"}, "afterCommit": {"oid": "a63d586488774adbd7f5fdfc408aed0e6fe63ea3", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a63d586488774adbd7f5fdfc408aed0e6fe63ea3", "committedDate": "2020-08-19T08:47:04Z", "message": "Pass the log level to matcher\n\nDerive the log level from the 'debug' config option and pass it to\nmatcher."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a63d586488774adbd7f5fdfc408aed0e6fe63ea3", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a63d586488774adbd7f5fdfc408aed0e6fe63ea3", "committedDate": "2020-08-19T08:47:04Z", "message": "Pass the log level to matcher\n\nDerive the log level from the 'debug' config option and pass it to\nmatcher."}, "afterCommit": {"oid": "c03f25256dea4ab8298ec820d50c6935868c89b6", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c03f25256dea4ab8298ec820d50c6935868c89b6", "committedDate": "2020-08-19T09:21:44Z", "message": "Pass the log level to matcher\n\nDerive the log level from the 'debug' config option and pass it to\nmatcher."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c03f25256dea4ab8298ec820d50c6935868c89b6", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c03f25256dea4ab8298ec820d50c6935868c89b6", "committedDate": "2020-08-19T09:21:44Z", "message": "Pass the log level to matcher\n\nDerive the log level from the 'debug' config option and pass it to\nmatcher."}, "afterCommit": {"oid": "9a671276d61bcf06fc89dbe063e8657a3cea31d1", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/9a671276d61bcf06fc89dbe063e8657a3cea31d1", "committedDate": "2020-08-19T09:28:51Z", "message": "Pass the log level to matcher\n\nDerive the log level from the 'debug' config option and pass it to\nmatcher."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77cde3fcba3fe3c1ca3226113aee29660a567f1a", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/77cde3fcba3fe3c1ca3226113aee29660a567f1a", "committedDate": "2020-08-19T11:44:41Z", "message": "Exhaust the matcher output to prevent stuck state"}, "afterCommit": {"oid": "705832a18ac2f47badad3f80dd00e0cd1c35ba61", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/705832a18ac2f47badad3f80dd00e0cd1c35ba61", "committedDate": "2020-08-19T12:16:56Z", "message": "Exhaust the matcher output to prevent stuck state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "705832a18ac2f47badad3f80dd00e0cd1c35ba61", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/705832a18ac2f47badad3f80dd00e0cd1c35ba61", "committedDate": "2020-08-19T12:16:56Z", "message": "Exhaust the matcher output to prevent stuck state"}, "afterCommit": {"oid": "4068eb76b487ed144496e494aeae4629225a002b", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4068eb76b487ed144496e494aeae4629225a002b", "committedDate": "2020-08-19T12:27:47Z", "message": "Exhaust the matcher output to prevent stuck state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4068eb76b487ed144496e494aeae4629225a002b", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4068eb76b487ed144496e494aeae4629225a002b", "committedDate": "2020-08-19T12:27:47Z", "message": "Exhaust the matcher output to prevent stuck state"}, "afterCommit": {"oid": "f4c938d3be4369d25ade795d0937e2199c931413", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f4c938d3be4369d25ade795d0937e2199c931413", "committedDate": "2020-08-28T11:59:34Z", "message": "Get rid of the 'confirmed' flag in the Match JSON"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4c938d3be4369d25ade795d0937e2199c931413", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f4c938d3be4369d25ade795d0937e2199c931413", "committedDate": "2020-08-28T11:59:34Z", "message": "Get rid of the 'confirmed' flag in the Match JSON"}, "afterCommit": {"oid": "d8be6607625d109e0fb946acd372e6589fe93247", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d8be6607625d109e0fb946acd372e6589fe93247", "committedDate": "2020-09-09T11:07:07Z", "message": "Get rid of the 'confirmed' flag in the Match JSON"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTA5MzQy", "url": "https://github.com/uyuni-project/uyuni/pull/2498#pullrequestreview-484909342", "createdAt": "2020-09-09T11:24:45Z", "commit": {"oid": "3963bb5ca16e5b97e0992954e44dc1dca0a3b509"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMToyNDo0NVrOHPCwYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMToyNDo0NVrOHPCwYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzNTg0Mg==", "bodyText": "Nitpick: could we maybe use try-with-resources here?", "url": "https://github.com/uyuni-project/uyuni/pull/2498#discussion_r485535842", "createdAt": "2020-09-09T11:24:45Z", "author": {"login": "moio"}, "path": "java/code/src/com/suse/manager/matcher/MatcherRunner.java", "diffHunk": "@@ -76,22 +80,28 @@ public void run(String csvDelimiter) {\n         });\n \n         Runtime r = Runtime.getRuntime();\n+        ExecutorService errorReaderService = null;\n+        ExecutorService inputReaderService = null;\n         try {\n-            Process p = r.exec(args.toArray(new String[0]));\n-            PrintWriter stdin = new PrintWriter(p.getOutputStream());\n             boolean isISSMaster = IssFactory.getCurrentMaster() == null;\n             boolean isSelfMonitoringEnabled = MonitoringService.isMonitoringEnabled();\n-            String arch = System.getProperty(\"os.arch\");\n             PinnedSubscriptionFactory.getInstance().cleanStalePins();\n+            String arch = System.getProperty(\"os.arch\");\n             String s = new MatcherJsonIO().generateMatcherInput(isISSMaster, arch, isSelfMonitoringEnabled);\n+\n+            Process p = r.exec(args.toArray(new String[0]));\n+            PrintWriter stdin = new PrintWriter(p.getOutputStream());\n             stdin.println(s);\n             stdin.flush();\n             stdin.close();\n \n+            // we need to exhaust the process output not to get stuck\n+            errorReaderService = exhaustOutputOnBackground(p.getErrorStream());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3963bb5ca16e5b97e0992954e44dc1dca0a3b509"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a157452ebe5b8d802a37805a376118dc72a8103e", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a157452ebe5b8d802a37805a376118dc72a8103e", "committedDate": "2020-09-09T12:29:03Z", "message": "Pass the log level to matcher\n\nDerive the log level from the 'debug' config option and pass it to\nmatcher."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f49c582337c7c7624131562567b1ebc4baad2f62", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f49c582337c7c7624131562567b1ebc4baad2f62", "committedDate": "2020-09-09T12:29:03Z", "message": "Exhaust the matcher output to prevent stuck state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c818330efa125b2c6ac4755a8277925704bdd90b", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c818330efa125b2c6ac4755a8277925704bdd90b", "committedDate": "2020-09-09T12:29:03Z", "message": "Get rid of the 'confirmed' flag in the Match JSON"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc5fede46cd654b01860917ed0351e6412fa4714", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bc5fede46cd654b01860917ed0351e6412fa4714", "committedDate": "2020-09-09T12:29:03Z", "message": "Use try-with-resources statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5e2aea844219b7accc2aca430eec1e55c87285", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6f5e2aea844219b7accc2aca430eec1e55c87285", "committedDate": "2020-09-09T12:29:03Z", "message": "Make checkstyle happy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b08f39e52fdbaf95cd93fe7bbc039d85a7e34fa", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2b08f39e52fdbaf95cd93fe7bbc039d85a7e34fa", "committedDate": "2020-09-09T12:24:27Z", "message": "Make checkstyle happy"}, "afterCommit": {"oid": "6f5e2aea844219b7accc2aca430eec1e55c87285", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6f5e2aea844219b7accc2aca430eec1e55c87285", "committedDate": "2020-09-09T12:29:03Z", "message": "Make checkstyle happy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1064, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}