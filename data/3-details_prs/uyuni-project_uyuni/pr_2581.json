{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMTM4NTk4", "number": 2581, "title": "Show pool/volume informations where possible", "bodyText": "What does this PR change?\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: fixes VM disks infos for Xen\n\n\n DONE\n\n\nTest coverage\n\n\nUnit tests were updated\n\n\n DONE\n\n\nLinks\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-09-08T15:47:40Z", "url": "https://github.com/uyuni-project/uyuni/pull/2581", "merged": true, "mergeCommit": {"oid": "4133424b8bffa91925b335da6f71ad8d6ec1471c"}, "closed": true, "closedAt": "2020-10-27T15:18:21Z", "author": {"login": "cbosdo"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLUqejABqjM3OTIzMzE0Mjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWqadcgBqjM5MjY0NzM4NzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6801ed49e18a60e8b4fa2a60d9901612e7f09e2", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a6801ed49e18a60e8b4fa2a60d9901612e7f09e2", "committedDate": "2020-09-08T15:46:47Z", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output."}, "afterCommit": {"oid": "5a2bd4cf5d14534d3af446e5d9efba8e946f124b", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5a2bd4cf5d14534d3af446e5d9efba8e946f124b", "committedDate": "2020-09-22T09:34:02Z", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d26a0797f998911b7143d9a12e02f874c55cacd", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3d26a0797f998911b7143d9a12e02f874c55cacd", "committedDate": "2020-09-22T09:39:05Z", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device."}, "afterCommit": {"oid": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "committedDate": "2020-09-23T06:56:17Z", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDQzMDIx", "url": "https://github.com/uyuni-project/uyuni/pull/2581#pullrequestreview-504043021", "createdAt": "2020-10-07T16:08:11Z", "commit": {"oid": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjowODoxMVrOHd636Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjowODoxMVrOHd636Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEzNTMzNw==", "bodyText": "Pattern is immutable so you could make it a static member of this class.", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r501135337", "createdAt": "2020-10-07T16:08:11Z", "author": {"login": "mateiw"}, "path": "java/code/src/com/suse/manager/virtualization/GuestDiskDef.java", "diffHunk": "@@ -216,6 +218,16 @@ else if (\"cdrom\".equals(disk.getDevice())) {\n                         source.put(\"file\", info.getFile());\n                     }\n                 }\n+                else if (Arrays.asList(\"block\", \"file\").contains(disk.getType())) {\n+                    Pattern regex = Pattern.compile(\"([^/]+)/([^/]+)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "committedDate": "2020-09-23T06:56:17Z", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device."}, "afterCommit": {"oid": "b3b2aa92a1f42d1b8975bed5407e624cebc06716", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b3b2aa92a1f42d1b8975bed5407e624cebc06716", "committedDate": "2020-10-08T07:20:33Z", "message": "fixup! Show pool/volume informations where possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3b2aa92a1f42d1b8975bed5407e624cebc06716", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b3b2aa92a1f42d1b8975bed5407e624cebc06716", "committedDate": "2020-10-08T07:20:33Z", "message": "fixup! Show pool/volume informations where possible"}, "afterCommit": {"oid": "f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "committedDate": "2020-10-26T15:34:02Z", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2104ab302b2e6ca24dece6dcc6a7f28a2af775c7", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2104ab302b2e6ca24dece6dcc6a7f28a2af775c7", "committedDate": "2020-10-27T13:23:35Z", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "committedDate": "2020-10-26T15:34:02Z", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device."}, "afterCommit": {"oid": "d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "committedDate": "2020-10-27T13:23:35Z", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "committedDate": "2020-10-27T13:23:35Z", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases."}, "afterCommit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/cd68217da22a868fb1d2ab25c5212055324b340e", "committedDate": "2020-10-27T13:42:10Z", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzI5NTA1", "url": "https://github.com/uyuni-project/uyuni/pull/2581#pullrequestreview-517729505", "createdAt": "2020-10-27T13:55:13Z", "commit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3Nzg1MDcy", "url": "https://github.com/uyuni-project/uyuni/pull/2581#pullrequestreview-517785072", "createdAt": "2020-10-27T14:44:01Z", "commit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDo0NDowMVrOHo_-UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDo0NTozN1rOHpADxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1MzIzMg==", "bodyText": "scsi is an abbreviation: SCSI", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512753232", "createdAt": "2020-10-27T14:44:01Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -129,7 +129,7 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And \"test-vm\" virtual machine on \"kvm_server\" should have spice graphics device\n     And \"test-vm\" virtual machine on \"kvm_server\" should have 1 NIC using \"test-net1\" network\n     And \"test-vm\" virtual machine on \"kvm_server\" should have a NIC with 02:34:56:78:9a:bc MAC address\n-    And \"test-vm\" virtual machine on \"kvm_server\" should have a \"test-vm_disk.qcow2\" scsi disk\n+    And \"test-vm\" virtual machine on \"kvm_server\" should have a \"test-vm_disk.qcow2\" scsi disk from pool \"tmp\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1Mzg2OA==", "bodyText": "could be \"And\"", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512753868", "createdAt": "2020-10-27T14:44:45Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minxen_guests.feature", "diffHunk": "@@ -192,21 +186,21 @@ Feature: Be able to manage XEN virtual machines via the GUI\n     And I enter \"512\" as \"memory\"\n     And I enter \"/var/testsuite-data/disk-image-template-xenpv.qcow2\" as \"disk0_source_template\"\n     And I select \"test-net0\" from \"network0_source\"\n-    And I select \"Spice\" from \"graphicsType\"\n+    And I select \"VNC\" from \"graphicsType\"\n     And I click on \"Create\"\n     Then I should see a \"Hosted Virtual Systems\" text\n     When I wait until I see \"test-vm2\" text\n     And I wait at most 500 seconds until table row for \"test-vm2\" contains button \"Stop\"\n     And \"test-vm2\" virtual machine on \"xen_server\" should have 512MB memory and 1 vcpus\n     And \"test-vm2\" virtual machine on \"xen_server\" should have 1 NIC using \"test-net0\" network\n-    And \"test-vm2\" virtual machine on \"xen_server\" should have a \"test-vm2_system\" xen disk from pool \"test-pool0\"\n+    And \"test-vm2\" virtual machine on \"xen_server\" should have a \"/var/lib/libvirt/images/test-pool0/test-vm2_system\" xen disk\n \n @virthost_xen\n-  Scenario: Show the Spice graphical console for Xen\n+  Scenario: Show the VNC graphical console for Xen\n     Given I am on the \"Virtualization\" page of this \"xen_server\"\n     When I click on \"Graphical Console\" in row \"test-vm2\"\n     And I switch to last opened window\n-    Then I wait until I see the spice graphical console\n+    Then I wait until I see the VNC graphical console", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDM2MQ==", "bodyText": "\"Then\"", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512754361", "createdAt": "2020-10-27T14:45:18Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minxen_guests.feature", "diffHunk": "@@ -218,13 +212,21 @@ Feature: Be able to manage XEN virtual machines via the GUI\n     And I enter \"512\" as \"memory\"\n     And I enter \"/var/testsuite-data/disk-image-template.qcow2\" as \"disk0_source_template\"\n     And I select \"test-net0\" from \"network0_source\"\n+    And I select \"Spice\" from \"graphicsType\"\n     And I click on \"Create\"\n     Then I should see a \"Hosted Virtual Systems\" text\n     When I wait until I see \"test-vm3\" text\n     And I wait at most 500 seconds until table row for \"test-vm3\" contains button \"Stop\"\n     And \"test-vm3\" virtual machine on \"xen_server\" should have 512MB memory and 1 vcpus", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDYzMQ==", "bodyText": "Could be \"And\"", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512754631", "createdAt": "2020-10-27T14:45:37Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minxen_guests.feature", "diffHunk": "@@ -218,13 +212,21 @@ Feature: Be able to manage XEN virtual machines via the GUI\n     And I enter \"512\" as \"memory\"\n     And I enter \"/var/testsuite-data/disk-image-template.qcow2\" as \"disk0_source_template\"\n     And I select \"test-net0\" from \"network0_source\"\n+    And I select \"Spice\" from \"graphicsType\"\n     And I click on \"Create\"\n     Then I should see a \"Hosted Virtual Systems\" text\n     When I wait until I see \"test-vm3\" text\n     And I wait at most 500 seconds until table row for \"test-vm3\" contains button \"Stop\"\n     And \"test-vm3\" virtual machine on \"xen_server\" should have 512MB memory and 1 vcpus\n     And \"test-vm3\" virtual machine on \"xen_server\" should have 1 NIC using \"test-net0\" network\n-    And \"test-vm3\" virtual machine on \"xen_server\" should have a \"test-vm3_system\" xen disk from pool \"test-pool0\"\n+    And \"test-vm3\" virtual machine on \"xen_server\" should have a \"/var/lib/libvirt/images/test-pool0/test-vm3_system\" xen disk\n+\n+@virthost_xen\n+  Scenario: Show the Spice graphical console for Xen\n+    Given I am on the \"Virtualization\" page of this \"xen_server\"\n+    When I click on \"Graphical Console\" in row \"test-vm3\"\n+    And I switch to last opened window\n+    Then I wait until I see the spice graphical console", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3ODA1ODYw", "url": "https://github.com/uyuni-project/uyuni/pull/2581#pullrequestreview-517805860", "createdAt": "2020-10-27T15:01:45Z", "commit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a29f90b08bbdec839777808d663e8c3804bf565e", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a29f90b08bbdec839777808d663e8c3804bf565e", "committedDate": "2020-10-27T15:08:15Z", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c66f519de2966d80cd4bf5660408a0b8180c3b8b", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c66f519de2966d80cd4bf5660408a0b8180c3b8b", "committedDate": "2020-10-27T15:08:15Z", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/cd68217da22a868fb1d2ab25c5212055324b340e", "committedDate": "2020-10-27T13:42:10Z", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases."}, "afterCommit": {"oid": "c66f519de2966d80cd4bf5660408a0b8180c3b8b", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c66f519de2966d80cd4bf5660408a0b8180c3b8b", "committedDate": "2020-10-27T15:08:15Z", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1146, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}