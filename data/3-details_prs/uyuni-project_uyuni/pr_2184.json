{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNTI3MTY4", "number": 2184, "title": "Fix bootstrap repo md caching", "bodyText": "What does this PR change?\nA proxy should not cache the metadata. At least not for a long time.\nWe did this for repositories using traditional and salt download endpoints, but forgot\nthe bootstrap repositories.\nThis add a pattern to squid.conf which prevent caching of the metadata for a long time.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: internal\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: manually\n\n\n DONE\n\n\nLinks\nFixes SUSE/spacewalk#11405\nTracks #\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-05-05T13:47:24Z", "url": "https://github.com/uyuni-project/uyuni/pull/2184", "merged": true, "mergeCommit": {"oid": "db8b9aa34973cf9ea1ff18095095d44cc506794f"}, "closed": true, "closedAt": "2020-05-06T10:15:07Z", "author": {"login": "mcalmer"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceURxBgH2gAyNDEzNTI3MTY4OjM3MzY1MjYyMmMwMTlmYjFlYTNjZGQyZmY1MzFhOGQ1Y2E1NjZmMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceUrZpgFqTQwNTgyNTUyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "373652622c019fb1ea3cdd2ff531a8d5ca566f1e", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/373652622c019fb1ea3cdd2ff531a8d5ca566f1e", "committedDate": "2020-05-05T13:41:19Z", "message": "no not cache metadata of the bootstrap repositories (bsc#1171169)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42afe59dbefd3e1021767a08ceef16ec037394e7", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/42afe59dbefd3e1021767a08ceef16ec037394e7", "committedDate": "2020-05-05T13:42:08Z", "message": "update changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODI1Mzk2", "url": "https://github.com/uyuni-project/uyuni/pull/2184#pullrequestreview-405825396", "createdAt": "2020-05-05T14:09:11Z", "commit": {"oid": "42afe59dbefd3e1021767a08ceef16ec037394e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDowOToxMVrOGQrOOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDowOToxMVrOGQrOOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzODU1Mg==", "bodyText": "Trying to confirm the correctness of such a sed command by looking at the code is not trivial :) But I assume you tested it and if it results in the line below contained in squid.conf, it is obviously correct as we are using the same rule for the other metadata as well. So fine with me.", "url": "https://github.com/uyuni-project/uyuni/pull/2184#discussion_r420138552", "createdAt": "2020-05-05T14:09:11Z", "author": {"login": "mantel"}, "path": "proxy/installer/spacewalk-proxy-installer.spec", "diffHunk": "@@ -106,6 +106,9 @@ if [ -f /etc/sysconfig/apache2 ]; then\n     sysconf_addword /etc/sysconfig/apache2 APACHE_MODULES proxy_http\n fi\n sed -i -e\"s/^range_offset_limit -1 KB/range_offset_limit none/\" /etc/squid/squid.conf\n+if ! grep pub\\/repositories /etc/squid/squid.conf >/dev/null; then\n+    sed -i 's;\\(refresh_pattern /rhn/manager/download.*\\);\\1\\nrefresh_pattern /pub/repositories/.*/repodata/.*$ 0 1% 1440 ignore-no-cache reload-into-ims refresh-ims;' /etc/squid/squid.conf\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42afe59dbefd3e1021767a08ceef16ec037394e7"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODI1NTI1", "url": "https://github.com/uyuni-project/uyuni/pull/2184#pullrequestreview-405825525", "createdAt": "2020-05-05T14:09:19Z", "commit": {"oid": "42afe59dbefd3e1021767a08ceef16ec037394e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1414, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}