{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMDgwNzUx", "number": 2580, "title": "WIP: rework filelocking used for scc sync", "bodyText": "What does this PR change?\nThis PR reworks the file locking we use for synchronize scc refresh between tomcat and taskomatic in an effort to simplify the code and usage. There also have been some issues indicating that the current locking may not always work but since this issue has not been reproduced so far its unclear if the new code resolves this.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests\n\n\n DONE\n\n\nLinks\nFixes #\nTracks # add downstream PR, if any\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-09-08T14:22:44Z", "url": "https://github.com/uyuni-project/uyuni/pull/2580", "merged": true, "mergeCommit": {"oid": "d8511d81be1472e5dda3d91811675981e729e6c9"}, "closed": true, "closedAt": "2020-11-12T10:53:03Z", "author": {"login": "lucidd"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG5GWFAFqTQ4NDIzNTQyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbwTXPgBqjM5ODgwMzgzODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjM1NDI1", "url": "https://github.com/uyuni-project/uyuni/pull/2580#pullrequestreview-484235425", "createdAt": "2020-09-08T15:04:40Z", "commit": {"oid": "5a76c415ee5fdbfcfabdca5132d2aa0209d5ffe7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNTowNDo0MFrOHOhpug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNTowNTo0M1rOHOhstg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5MzQ2Ng==", "bodyText": "old copyright year", "url": "https://github.com/uyuni-project/uyuni/pull/2580#discussion_r484993466", "createdAt": "2020-09-08T15:04:40Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/common/util/FileLocks.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * Copyright (c) 2018 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a76c415ee5fdbfcfabdca5132d2aa0209d5ffe7"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5MzcwNw==", "bodyText": "old comment from former class name", "url": "https://github.com/uyuni-project/uyuni/pull/2580#discussion_r484993707", "createdAt": "2020-09-08T15:04:58Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/common/util/FileLocks.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * Copyright (c) 2018 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.redhat.rhn.common.util;\n+\n+import org.apache.log4j.Logger;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.channels.FileChannel;\n+import java.nio.channels.FileLock;\n+import java.nio.channels.OverlappingFileLockException;\n+import java.nio.file.FileSystem;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.LinkOption;\n+import java.nio.file.attribute.UserPrincipal;\n+import java.nio.file.attribute.UserPrincipalLookupService;\n+import java.util.function.Supplier;\n+\n+/**\n+ * SCCRefreshLock - locks the SCC refresh process", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a76c415ee5fdbfcfabdca5132d2aa0209d5ffe7"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NDIzMA==", "bodyText": "As it is public, does it need a comment?", "url": "https://github.com/uyuni-project/uyuni/pull/2580#discussion_r484994230", "createdAt": "2020-09-08T15:05:43Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/common/util/FileLocks.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * Copyright (c) 2018 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package com.redhat.rhn.common.util;\n+\n+import org.apache.log4j.Logger;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.channels.FileChannel;\n+import java.nio.channels.FileLock;\n+import java.nio.channels.OverlappingFileLockException;\n+import java.nio.file.FileSystem;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.LinkOption;\n+import java.nio.file.attribute.UserPrincipal;\n+import java.nio.file.attribute.UserPrincipalLookupService;\n+import java.util.function.Supplier;\n+\n+/**\n+ * SCCRefreshLock - locks the SCC refresh process\n+ */\n+public class FileLocks {\n+\n+    // Logger instance\n+    private static Logger log = Logger.getLogger(FileLocks.class);\n+\n+    public static FileLocks SCC_REFRESH_LOCK =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a76c415ee5fdbfcfabdca5132d2aa0209d5ffe7"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a76c415ee5fdbfcfabdca5132d2aa0209d5ffe7", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5a76c415ee5fdbfcfabdca5132d2aa0209d5ffe7", "committedDate": "2020-09-08T14:16:37Z", "message": "rework filelocking used for scc sync"}, "afterCommit": {"oid": "99fc467f08fd816fdb2fd71363423fd81c4fb9e1", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/99fc467f08fd816fdb2fd71363423fd81c4fb9e1", "committedDate": "2020-09-08T15:32:49Z", "message": "rework filelocking used for scc sync"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99fc467f08fd816fdb2fd71363423fd81c4fb9e1", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/99fc467f08fd816fdb2fd71363423fd81c4fb9e1", "committedDate": "2020-09-08T15:32:49Z", "message": "rework filelocking used for scc sync"}, "afterCommit": {"oid": "a3621dd0b873c57a1975266d665cad3d3c34fef7", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a3621dd0b873c57a1975266d665cad3d3c34fef7", "committedDate": "2020-09-08T16:22:45Z", "message": "rework filelocking used for scc sync"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MjQ1OTY3", "url": "https://github.com/uyuni-project/uyuni/pull/2580#pullrequestreview-509245967", "createdAt": "2020-10-15T10:42:25Z", "commit": {"oid": "a3621dd0b873c57a1975266d665cad3d3c34fef7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c62956bcb43a6dd61b4f3d35be513d38798b3f9", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0c62956bcb43a6dd61b4f3d35be513d38798b3f9", "committedDate": "2020-11-12T10:49:24Z", "message": "rework filelocking used for scc sync"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3621dd0b873c57a1975266d665cad3d3c34fef7", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a3621dd0b873c57a1975266d665cad3d3c34fef7", "committedDate": "2020-09-08T16:22:45Z", "message": "rework filelocking used for scc sync"}, "afterCommit": {"oid": "0c62956bcb43a6dd61b4f3d35be513d38798b3f9", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0c62956bcb43a6dd61b4f3d35be513d38798b3f9", "committedDate": "2020-11-12T10:49:24Z", "message": "rework filelocking used for scc sync"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1142, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}