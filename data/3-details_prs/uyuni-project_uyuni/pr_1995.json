{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MTU2NzA1", "number": 1995, "title": "show a warning when missing the SUSE Manager Tools Channel", "bodyText": "What does this PR change?\nWhen there is no subscription for the SUSE Manager Tools Channel available only\nproducts which do not directly require them are shown. This confuse customers and raise questions what is wrong.\nThis PR add a warning message to the products page.\nGUI diff\nAfter:\n\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: self explanatory\n\n\n DONE\n\n\nTest coverage\n\n\nUnit tests added\n\n\n DONE\n\n\nLinks\nTracks SUSE/spacewalk#10944\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-03-07T15:43:48Z", "url": "https://github.com/uyuni-project/uyuni/pull/1995", "merged": true, "mergeCommit": {"oid": "217323a4e6135ca2cf4fd1432b0a9420cde834e9"}, "closed": true, "closedAt": "2020-03-09T14:00:54Z", "author": {"login": "mcalmer"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLW0xUABqjMxMDc3OTYxMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL9wykgBqjMxMTA1NjkwMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d9b0db56cc8aa6a10bab470a7d9dbff37bb617b", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2d9b0db56cc8aa6a10bab470a7d9dbff37bb617b", "committedDate": "2020-03-07T15:41:45Z", "message": "show a warning when missing the SUSE Manager Tools Channel"}, "afterCommit": {"oid": "b6c0db22caf168f8c4fbcfd6b46e2cd24340eac1", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b6c0db22caf168f8c4fbcfd6b46e2cd24340eac1", "committedDate": "2020-03-07T15:54:37Z", "message": "show a warning when missing the SUSE Manager Tools Channel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODU5NTQw", "url": "https://github.com/uyuni-project/uyuni/pull/1995#pullrequestreview-370859540", "createdAt": "2020-03-08T21:33:28Z", "commit": {"oid": "a99d9b364d9e71d7bdc9bc25bf4bf1883a1cdfb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQyMTozMzoyOFrOFzXiNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQyMTozMzoyOFrOFzXiNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwNzI4Ng==", "bodyText": "It is better to set the state everything at once. I'd just move these lines right before setState few lines above and preparing a variable to populate with messages. Something like the following:\nlet resultMessages = [];\n      if (currentObject.state.noToolsChannelSubscription && currentObject.state.issMaster) {\n        resultMessages = MessagesUtils.warning(t(\"No SUSE Manager Server Subscription availabel. Products requiring Client Tools Channel will not be shown.\"))\n      }\ncurrentObject.setState({\n          serverData: data[_DATA_ROOT_ID],\n          errors: resultMessages,\n          loading: false,\n          selectedItems: [],\n          scheduleResyncItems: [],\n          scheduledItems: [],\n        });", "url": "https://github.com/uyuni-project/uyuni/pull/1995#discussion_r389407286", "createdAt": "2020-03-08T21:33:28Z", "author": {"login": "ncounter"}, "path": "web/html/src/manager/admin/setup/products/products.js", "diffHunk": "@@ -118,6 +119,11 @@ class ProductsPageWrapper extends React.Component {\n           scheduleResyncItems: [],\n           scheduledItems: [],\n         });\n+        if (currentObject.state.noToolsChannelSubscription && currentObject.state.issMaster) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a99d9b364d9e71d7bdc9bc25bf4bf1883a1cdfb6"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODY3ODc2", "url": "https://github.com/uyuni-project/uyuni/pull/1995#pullrequestreview-370867876", "createdAt": "2020-03-08T23:41:21Z", "commit": {"oid": "a99d9b364d9e71d7bdc9bc25bf4bf1883a1cdfb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQyMzo0MToyMVrOFzYQZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQyMzo0MToyMVrOFzYQZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQxOTEwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        errors: MessagesUtils.warning(t(\"No SUSE Manager Server Subscription availabel. Products requiring Client Tools Channel will not be shown.\"))\n          \n          \n            \n                        errors: MessagesUtils.warning(t(\"No SUSE Manager Server Subscription available. Products requiring Client Tools Channel will not be shown.\"))", "url": "https://github.com/uyuni-project/uyuni/pull/1995#discussion_r389419109", "createdAt": "2020-03-08T23:41:21Z", "author": {"login": "Loquacity"}, "path": "web/html/src/manager/admin/setup/products/products.js", "diffHunk": "@@ -118,6 +119,11 @@ class ProductsPageWrapper extends React.Component {\n           scheduleResyncItems: [],\n           scheduledItems: [],\n         });\n+        if (currentObject.state.noToolsChannelSubscription && currentObject.state.issMaster) {\n+          currentObject.setState({\n+            errors: MessagesUtils.warning(t(\"No SUSE Manager Server Subscription availabel. Products requiring Client Tools Channel will not be shown.\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a99d9b364d9e71d7bdc9bc25bf4bf1883a1cdfb6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODY3OTAw", "url": "https://github.com/uyuni-project/uyuni/pull/1995#pullrequestreview-370867900", "createdAt": "2020-03-08T23:41:34Z", "commit": {"oid": "a99d9b364d9e71d7bdc9bc25bf4bf1883a1cdfb6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDUzNzY5", "url": "https://github.com/uyuni-project/uyuni/pull/1995#pullrequestreview-371053769", "createdAt": "2020-03-09T10:27:58Z", "commit": {"oid": "eac180c064e856eb5ee3294316b613f5aae6a16b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTMyNDQ0", "url": "https://github.com/uyuni-project/uyuni/pull/1995#pullrequestreview-371132444", "createdAt": "2020-03-09T12:48:25Z", "commit": {"oid": "eac180c064e856eb5ee3294316b613f5aae6a16b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd07c6b79603f192cc8cbb0193a19fa7cf52e6b6", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/dd07c6b79603f192cc8cbb0193a19fa7cf52e6b6", "committedDate": "2020-03-09T13:15:49Z", "message": "show a warning when missing the SUSE Manager Tools Channel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f7633e24a21e128486ab53c72cf7ba4dec2714", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/46f7633e24a21e128486ab53c72cf7ba4dec2714", "committedDate": "2020-03-09T13:15:49Z", "message": "update changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da527d9a7e403e95d9318df4b47940f3c04c2927", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/da527d9a7e403e95d9318df4b47940f3c04c2927", "committedDate": "2020-03-09T13:15:49Z", "message": "add warning to logfile when no SUSE Manager Subscription is available"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3718c2d4323e403cf5c1edcf5bf387b816cdee71", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3718c2d4323e403cf5c1edcf5bf387b816cdee71", "committedDate": "2020-03-09T13:15:58Z", "message": "unit test hasToolsChannelSubscription()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eac180c064e856eb5ee3294316b613f5aae6a16b", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/eac180c064e856eb5ee3294316b613f5aae6a16b", "committedDate": "2020-03-09T10:07:46Z", "message": "unit test hasToolsChannelSubscription()"}, "afterCommit": {"oid": "3718c2d4323e403cf5c1edcf5bf387b816cdee71", "author": {"user": {"login": "mcalmer", "name": "Michael Calmer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3718c2d4323e403cf5c1edcf5bf387b816cdee71", "committedDate": "2020-03-09T13:15:58Z", "message": "unit test hasToolsChannelSubscription()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1633, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}