{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NzIxNTA4", "number": 2328, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNjoxMTowMFrOEG0cMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNjoxNTozM1rOEG0i_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTg2MDk3OnYy", "diffSide": "RIGHT", "path": "web/html/src/components/action-schedule.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNjoxMTowMFrOGl2bLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMjo1OToxMFrOGnoAUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0MjE4OA==", "bodyText": "Please just add a comment on top of this usage: Object.assign for this.state is deprecated outside of the constructor. Outside of it we should always use this.setState because React knows what to do properly in the state. I am totally fine using it here, but make sure to add the comment to clarify to not use it elsewhere. Thanks", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r442342188", "createdAt": "2020-06-18T16:11:00Z", "author": {"login": "ncounter"}, "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -55,31 +55,26 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n   constructor(props: ActionScheduleProps) {\n     super(props);\n \n+    const commonState = {\n+      loading: true,\n+      type: \"earliest\",\n+      earliest: props.earliest,\n+      isMaintenanceModeEnabled: false,\n+      maintenanceWindow: {},\n+      maintenanceWindows: [],\n+      systemIds: props.systemIds ? props.systemIds : [],\n+      actionType: props.actionType ? props.actionType : \"\",\n+    }\n+\n+    let actionChainsState = {};\n     if (props.actionChains) {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n+      actionChainsState = {\n         actionChain: props.actionChains.length > 0 ? props.actionChains[0] : this.newActionChainOpt,\n         actionChains: props.actionChains.length > 0 ? props.actionChains : [this.newActionChainOpt],\n-        maintenanceWindow: {}, // todo deuglify\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n-      };\n-    } else {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n-        isMaintenanceModeEnabled: false,\n-        maintenanceWindow: {},\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n       };\n     }\n \n+    this.state = Object.assign(commonState, actionChainsState);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e251d669f7739e388776ea8698af1bcb9496a4e"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIwMzA5MA==", "bodyText": "Fixing.", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r444203090", "createdAt": "2020-06-23T12:59:10Z", "author": {"login": "hustodemon"}, "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -55,31 +55,26 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n   constructor(props: ActionScheduleProps) {\n     super(props);\n \n+    const commonState = {\n+      loading: true,\n+      type: \"earliest\",\n+      earliest: props.earliest,\n+      isMaintenanceModeEnabled: false,\n+      maintenanceWindow: {},\n+      maintenanceWindows: [],\n+      systemIds: props.systemIds ? props.systemIds : [],\n+      actionType: props.actionType ? props.actionType : \"\",\n+    }\n+\n+    let actionChainsState = {};\n     if (props.actionChains) {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n+      actionChainsState = {\n         actionChain: props.actionChains.length > 0 ? props.actionChains[0] : this.newActionChainOpt,\n         actionChains: props.actionChains.length > 0 ? props.actionChains : [this.newActionChainOpt],\n-        maintenanceWindow: {}, // todo deuglify\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n-      };\n-    } else {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n-        isMaintenanceModeEnabled: false,\n-        maintenanceWindow: {},\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n       };\n     }\n \n+    this.state = Object.assign(commonState, actionChainsState);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0MjE4OA=="}, "originalCommit": {"oid": "4e251d669f7739e388776ea8698af1bcb9496a4e"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTg3ODM4OnYy", "diffSide": "RIGHT", "path": "web/html/src/components/action-schedule.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNjoxNTozM1rOGl2mZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMzo0MTozMFrOGnpzyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NTA2MQ==", "bodyText": "Isn't it enough to check for the single this.state.actionChain? IIUC if it is present there will always be a this.state.actionChains array (in some case an Array(1), but still). Am I missing something?", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r442345061", "createdAt": "2020-06-18T16:15:33Z", "author": {"login": "ncounter"}, "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -190,43 +263,13 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n       <div className=\"spacewalk-scheduler\">\n         <div className=\"form-horizontal\">\n           <div className=\"form-group\">\n-            <div className=\"col-sm-3 control-label\">\n-              { (this.state.actionChains && this.state.actionChain) &&\n-                <input type=\"radio\" name=\"use_date\" value=\"true\" checked={this.state.type == \"earliest\"} id=\"schedule-by-date\" onChange={this.onSelectEarliest}/> }\n-              <label htmlFor=\"schedule-by-date\">{!this.state.isMaintenanceModeEnabled ?t(\"Earliest:\") : t(\"Maintenance Window:\")}</label>\n-            </div>\n-              {\n-                !this.state.isMaintenanceModeEnabled ?\n-                  <div className=\"col-sm-6\">\n-                    <DateTimePicker onChange={this.onDateTimeChanged} value={this.state.earliest} timezone={this.props.timezone} />\n-                  </div>\n-                  :\n-                  <div className=\"col-sm-6\">\n-                    <select\n-                        id=\"maintenance-window\"\n-                        className=\"form-control\"\n-                        name=\"maintenance_window\"\n-                        onChange={this.onSelectMaintenanceWindow}\n-                        onFocus={this.onFocusMaintenanceWindow}>\n-                      { this.state.maintenanceWindows.map(mw =><option key={mw.id} value={mw.id}> {mw.from + \" - \" + mw.to}</option>) }\n-                    </select>\n-                  </div>\n-              }\n-          </div>\n-          { (this.state.actionChains && this.state.actionChain) &&\n-            <div className=\"form-group\">\n-              <div className=\"col-sm-3 control-label\">\n-                <input type=\"radio\" name=\"action_chain\" value=\"false\" checked={this.state.type == \"actionChain\"} id=\"schedule-by-action-chain\" onChange={this.onFocusActionChain}/>\n-                <label htmlFor=\"schedule-by-action-chain\">{t(\"Add to:\")}</label>\n-              </div>\n-              <div className=\"col-sm-3\">\n-                { (this.state.actionChains && this.state.actionChain) &&\n-                  <Combobox id=\"action-chain\" name=\"action_chain\" selectedId={this.state.actionChain.id}\n-                            data={this.state.actionChains} onSelect={this.onSelectActionChain}\n-                            onFocus={this.onFocusActionChain} />}\n-              </div>\n-            </div>\n+            { \n+              this.renderPickers()\n+            }\n+            {\n+              this.state.actionChains && this.state.actionChain && this.renderActionChainPicker()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22ccd2a8be8505df784a69c44fd5225ce4eb1f91"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIzMjY1MA==", "bodyText": "I'd rather not touch this code in this PR. This was only meant as a refactoring and I used condition from the original code.", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r444232650", "createdAt": "2020-06-23T13:41:30Z", "author": {"login": "hustodemon"}, "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -190,43 +263,13 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n       <div className=\"spacewalk-scheduler\">\n         <div className=\"form-horizontal\">\n           <div className=\"form-group\">\n-            <div className=\"col-sm-3 control-label\">\n-              { (this.state.actionChains && this.state.actionChain) &&\n-                <input type=\"radio\" name=\"use_date\" value=\"true\" checked={this.state.type == \"earliest\"} id=\"schedule-by-date\" onChange={this.onSelectEarliest}/> }\n-              <label htmlFor=\"schedule-by-date\">{!this.state.isMaintenanceModeEnabled ?t(\"Earliest:\") : t(\"Maintenance Window:\")}</label>\n-            </div>\n-              {\n-                !this.state.isMaintenanceModeEnabled ?\n-                  <div className=\"col-sm-6\">\n-                    <DateTimePicker onChange={this.onDateTimeChanged} value={this.state.earliest} timezone={this.props.timezone} />\n-                  </div>\n-                  :\n-                  <div className=\"col-sm-6\">\n-                    <select\n-                        id=\"maintenance-window\"\n-                        className=\"form-control\"\n-                        name=\"maintenance_window\"\n-                        onChange={this.onSelectMaintenanceWindow}\n-                        onFocus={this.onFocusMaintenanceWindow}>\n-                      { this.state.maintenanceWindows.map(mw =><option key={mw.id} value={mw.id}> {mw.from + \" - \" + mw.to}</option>) }\n-                    </select>\n-                  </div>\n-              }\n-          </div>\n-          { (this.state.actionChains && this.state.actionChain) &&\n-            <div className=\"form-group\">\n-              <div className=\"col-sm-3 control-label\">\n-                <input type=\"radio\" name=\"action_chain\" value=\"false\" checked={this.state.type == \"actionChain\"} id=\"schedule-by-action-chain\" onChange={this.onFocusActionChain}/>\n-                <label htmlFor=\"schedule-by-action-chain\">{t(\"Add to:\")}</label>\n-              </div>\n-              <div className=\"col-sm-3\">\n-                { (this.state.actionChains && this.state.actionChain) &&\n-                  <Combobox id=\"action-chain\" name=\"action_chain\" selectedId={this.state.actionChain.id}\n-                            data={this.state.actionChains} onSelect={this.onSelectActionChain}\n-                            onFocus={this.onFocusActionChain} />}\n-              </div>\n-            </div>\n+            { \n+              this.renderPickers()\n+            }\n+            {\n+              this.state.actionChains && this.state.actionChain && this.renderActionChainPicker()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NTA2MQ=="}, "originalCommit": {"oid": "22ccd2a8be8505df784a69c44fd5225ce4eb1f91"}, "originalPosition": 124}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4316, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}