{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MjkwNzMw", "number": 1984, "title": "Virt pool refresh", "bodyText": "What does this PR change?\nAdd virtual pool refresh action\nGUI diff\nBefore:\nNo action was possible for virtual pools\nAfter:\nThe refresh action is possible for virtual pools\n\n DONE\n\nDocumentation\n\n\nuyuni-docs PR or issue was created for all pool actions\n\n\n DONE\n\n\nTest coverage\n\n\nUnit tests were added\n\n\nCucumber tests were added\n\n\n DONE\n\n\nLinks\nFixes #\nTracks # add downstream PR, if any\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nTo avoid cluttering the changelog there is one commit adding changelog entry for all storage pool actions coming in an upcoming PR.\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-03-05T13:57:48Z", "url": "https://github.com/uyuni-project/uyuni/pull/1984", "merged": true, "mergeCommit": {"oid": "d535b01e0755bc6431ea14d85e17cc9b6fa509b7"}, "closed": true, "closedAt": "2020-03-23T08:45:44Z", "author": {"login": "cbosdo"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKsE4ogBqjMxMDEzMzY1OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQZ8F4ABqjMxNTQwOTYxNTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ccb13e74db333579db2109a67d8e96597b8e557", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3ccb13e74db333579db2109a67d8e96597b8e557", "committedDate": "2020-03-05T13:53:45Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "b1c9a5ed8313554ab2280feda2a5a69f47dda695", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b1c9a5ed8313554ab2280feda2a5a69f47dda695", "committedDate": "2020-03-05T14:06:19Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1c9a5ed8313554ab2280feda2a5a69f47dda695", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b1c9a5ed8313554ab2280feda2a5a69f47dda695", "committedDate": "2020-03-05T14:06:19Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "8b5c42785291e7edd6e1a26b6eb639f1b83067f9", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8b5c42785291e7edd6e1a26b6eb639f1b83067f9", "committedDate": "2020-03-05T16:15:04Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b5c42785291e7edd6e1a26b6eb639f1b83067f9", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8b5c42785291e7edd6e1a26b6eb639f1b83067f9", "committedDate": "2020-03-05T16:15:04Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "6d46c8642351d4638441e0ac7eddd04422efe0bb", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6d46c8642351d4638441e0ac7eddd04422efe0bb", "committedDate": "2020-03-05T17:19:41Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d46c8642351d4638441e0ac7eddd04422efe0bb", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6d46c8642351d4638441e0ac7eddd04422efe0bb", "committedDate": "2020-03-05T17:19:41Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "5cc829468c1c1a60afc3b760379445277b3724b3", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5cc829468c1c1a60afc3b760379445277b3724b3", "committedDate": "2020-03-06T13:39:19Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5cc829468c1c1a60afc3b760379445277b3724b3", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5cc829468c1c1a60afc3b760379445277b3724b3", "committedDate": "2020-03-06T13:39:19Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/738e045fd8af0832d8f44f15c85a69e112d820f6", "committedDate": "2020-03-09T13:56:33Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMjA4MjE4", "url": "https://github.com/uyuni-project/uyuni/pull/1984#pullrequestreview-371208218", "createdAt": "2020-03-09T14:02:51Z", "commit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNDowMjo1MlrOFzpkaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNTozODo1NFrOFzt7IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTcwMjc2MA==", "bodyText": "We have 2020 :-)", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r389702760", "createdAt": "2020-03-09T14:02:52Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/domain/action/virtualization/BaseVirtualizationPoolAction.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * Copyright (c) 2019 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTcwMjk3NQ==", "bodyText": "2020", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r389702975", "createdAt": "2020-03-09T14:03:04Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/domain/action/virtualization/VirtualizationPoolRefreshAction.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/**\n+ * Copyright (c) 2019 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc3MjYyMA==", "bodyText": "2020", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r389772620", "createdAt": "2020-03-09T15:36:38Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/suse/manager/webui/utils/gson/VirtualPoolBaseActionJson.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/**\n+ * Copyright (c) 2019 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc3MzE3Mg==", "bodyText": "2020 please :-)", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r389773172", "createdAt": "2020-03-09T15:37:28Z", "author": {"login": "mcalmer"}, "path": "schema/spacewalk/common/tables/rhnActionVirtPoolRefresh.sql", "diffHunk": "@@ -0,0 +1,30 @@\n+--\n+-- Copyright (c) 2018 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc3MzQ3Mg==", "bodyText": "2020", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r389773472", "createdAt": "2020-03-09T15:37:58Z", "author": {"login": "mcalmer"}, "path": "schema/spacewalk/upgrade/susemanager-schema-4.1.3-to-susemanager-schema-4.1.4/006-rhnActionVirtPoolRefresh.sql", "diffHunk": "@@ -0,0 +1,29 @@\n+-- Copyright (c) 2019 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc3NDExMg==", "bodyText": "2020", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r389774112", "createdAt": "2020-03-09T15:38:54Z", "author": {"login": "mcalmer"}, "path": "schema/spacewalk/upgrade/susemanager-schema-4.1.3-to-susemanager-schema-4.1.4/007-add_virt_pool_actions_rhnActionType.sql", "diffHunk": "@@ -0,0 +1,19 @@\n+-- Copyright (c) 2019 SUSE LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "738e045fd8af0832d8f44f15c85a69e112d820f6", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/738e045fd8af0832d8f44f15c85a69e112d820f6", "committedDate": "2020-03-09T13:56:33Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "d392522c8cc542208b64cbcb9cdd9ad4df146fcb", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d392522c8cc542208b64cbcb9cdd9ad4df146fcb", "committedDate": "2020-03-09T16:49:17Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d392522c8cc542208b64cbcb9cdd9ad4df146fcb", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d392522c8cc542208b64cbcb9cdd9ad4df146fcb", "committedDate": "2020-03-09T16:49:17Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "86d2f629d96acccab7ef9ba360bf43a2846e9b91", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/86d2f629d96acccab7ef9ba360bf43a2846e9b91", "committedDate": "2020-03-10T10:11:11Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjE4MzM5", "url": "https://github.com/uyuni-project/uyuni/pull/1984#pullrequestreview-372618339", "createdAt": "2020-03-11T10:04:50Z", "commit": {"oid": "86d2f629d96acccab7ef9ba360bf43a2846e9b91"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDowNDo1MFrOF0wTcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDowNDo1MFrOF0wTcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2MTY4MA==", "bodyText": "Could be \"And\"", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r390861680", "createdAt": "2020-03-11T10:04:50Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -194,6 +194,13 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And I click on \"Delete\" in \"Delete Guest\" modal\n     Then I should not see a \"test-vm2\" virtual machine on \"kvm_server\"\n \n+@virthost_kvm\n+  Scenario: Refresh a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Refresh\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" has no sub-list", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d2f629d96acccab7ef9ba360bf43a2846e9b91"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86d2f629d96acccab7ef9ba360bf43a2846e9b91", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/86d2f629d96acccab7ef9ba360bf43a2846e9b91", "committedDate": "2020-03-10T10:11:11Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "9b7cab21275f8b3d81fab91056ba66563753b043", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/9b7cab21275f8b3d81fab91056ba66563753b043", "committedDate": "2020-03-11T15:20:01Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b7cab21275f8b3d81fab91056ba66563753b043", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/9b7cab21275f8b3d81fab91056ba66563753b043", "committedDate": "2020-03-11T15:20:01Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "0985b2bf2caf7c0e950cce1b85d82e2af8aeebc0", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0985b2bf2caf7c0e950cce1b85d82e2af8aeebc0", "committedDate": "2020-03-11T16:18:13Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0985b2bf2caf7c0e950cce1b85d82e2af8aeebc0", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0985b2bf2caf7c0e950cce1b85d82e2af8aeebc0", "committedDate": "2020-03-11T16:18:13Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "39232ff63117d0c6b4bfac87e3d1782b386dec4a", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/39232ff63117d0c6b4bfac87e3d1782b386dec4a", "committedDate": "2020-03-12T07:13:39Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyODE1ODI5", "url": "https://github.com/uyuni-project/uyuni/pull/1984#pullrequestreview-372815829", "createdAt": "2020-03-11T14:34:14Z", "commit": {"oid": "cc9c2d38a1f45f20a01db24c9f5672a26fd71d12"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNDozNDoxNVrOF05rmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMDowNzowOFrOF1YOeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAxNTMyMw==", "bodyText": "I'm missing something: why are changes in this file needed?", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r391015323", "createdAt": "2020-03-11T14:34:15Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/domain/action/Action_legacyUser.hbm.xml", "diffHunk": "@@ -502,7 +510,8 @@ select {ra.*}\n             NULL as arch,\n             NULL as graphics_type,\n             NULL as remove_disks,\n-            NULL as remove_interfaces from dual) ra_11_\n+            NULL as remove_interfaces from dual) ra_11_,\n+    (select NULL as name from dual) ra_12_", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc9c2d38a1f45f20a01db24c9f5672a26fd71d12"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NzM4NQ==", "bodyText": "Nitpick: Is there a reason for function definition syntax (const fn-name vs. function fn-name)?", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r391477385", "createdAt": "2020-03-12T08:56:45Z", "author": {"login": "hustodemon"}, "path": "web/html/src/manager/virtualization/pools/list/pools-list.js", "diffHunk": "@@ -93,9 +97,42 @@ function FilteredTree(props: FilteredTreeProps) {\n }\n \n export function PoolsList(props: Props) {\n+  const [errors, setErrors] = React.useState([]);\n+\n+  const [actionsResults, setActionsResults] = useVirtNotification(errors, setErrors,\n+                                                                  props.serverId);\n+\n+  const actionCallback = (results: Object) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39232ff63117d0c6b4bfac87e3d1782b386dec4a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4NzgwOA==", "bodyText": "Please also use the ./scripts/translation/fixmissingstrings.py script to add missing translations - just run it in the java/code/src/com/redhat/rhn/frontend/strings dir. Put the changes in a separate commit please. If you encounter issues with trailing spaces after having used that script, contact me :)", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r391487808", "createdAt": "2020-03-12T09:17:04Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/frontend/strings/java/StringResource_en_US.xml", "diffHunk": "@@ -7076,6 +7076,12 @@ Follow this url to see the full list of inactive systems:\n           <context context-type=\"sourcefile\">com.redhat.rhn.domain.action.ActionFormatter.getActionType</context>\n         </context-group>\n       </trans-unit>\n+      <trans-unit id=\"virt.pool_refresh\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b59b989cf6c63d985d544b25cd67d2e63c20bfda"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NTc5OQ==", "bodyText": "How big is typically the job result (in case of both success and error)? (I suppose it's pretty small.)", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r391495799", "createdAt": "2020-03-12T09:32:13Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/suse/manager/utils/SaltUtils.java", "diffHunk": "@@ -659,6 +660,12 @@ else if (action instanceof BaseVirtualizationAction) {\n             String key = result.keySet().iterator().next();\n             serverAction.setResultMsg(result.get(key).getAsJsonObject().get(\"comment\").getAsString());\n         }\n+        else if (action instanceof BaseVirtualizationPoolAction) {\n+            // Tell VirtNotifications that we got a pool action change, passing action\n+            VirtNotifications.spreadActionUpdate(action);\n+            // Intentionally don't get only the comment since the changes value could be interesting\n+            serverAction.setResultMsg(getJsonResultWithPrettyPrint(jsonResult));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "166923f5bec17e34f96ca240b4018e12049e55d3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUwMDExOA==", "bodyText": "IIRC, the backing data for statuses is delivered by the hook (which it turn gets it from the websocket). I can see, that only the data about pool is \"spread\" to the websocket, nothing about volume. How is the backing data for volumes provided?", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r391500118", "createdAt": "2020-03-12T09:40:02Z", "author": {"login": "hustodemon"}, "path": "web/html/src/manager/virtualization/pools/list/pools-list.js", "diffHunk": "@@ -174,6 +214,9 @@ export function PoolsList(props: Props) {\n                       <span>{t(\"Unknown\")}</span>\n                     }\n                   </CustomDiv>,\n+                  <CustomDiv key=\"actionStatus\" className=\"col\" width=\"calc(100% + 3em) * 0.05\" um=\"\">\n+                    {renderActionStatus('volume', volume.name)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39232ff63117d0c6b4bfac87e3d1782b386dec4a"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxNTc3MA==", "bodyText": "I wonder about the behavior of the pool-refreshed.sls (and in turn of the virt.pool_refresh execution module as well) if the pool name is null. Does it refresh all pools/the default one/...?", "url": "https://github.com/uyuni-project/uyuni/pull/1984#discussion_r391515770", "createdAt": "2020-03-12T10:07:08Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/suse/manager/webui/controllers/VirtualPoolsController.java", "diffHunk": "@@ -220,4 +269,68 @@ private static ModelAndView renderPage(Request request, Response response, User\n \n         return new ModelAndView(data, String.format(\"templates/virtualization/pools/%s.jade\", template));\n     }\n+\n+    private static String poolAction(Request request, Response response, User user,\n+            Function<VirtualPoolBaseActionJson, BaseVirtualizationPoolAction> actionCreator) {\n+        return poolAction(request, response, user, actionCreator, VirtualPoolBaseActionJson.class);\n+    }\n+\n+    private static String poolAction(Request request, Response response, User user,\n+            Function<VirtualPoolBaseActionJson, BaseVirtualizationPoolAction> actionCreator,\n+            Class<? extends VirtualPoolBaseActionJson> jsonClass) {\n+        Long serverId;\n+\n+        try {\n+            serverId = Long.parseLong(request.params(\"sid\"));\n+        }\n+        catch (NumberFormatException e) {\n+            throw new NotFoundException();\n+        }\n+        Server host = SystemManager.lookupByIdAndUser(serverId, user);\n+\n+        VirtualPoolBaseActionJson data;\n+        try {\n+            data = GSON.fromJson(request.body(), jsonClass);\n+        }\n+        catch (JsonParseException e) {\n+            throw Spark.halt(HttpStatus.SC_BAD_REQUEST);\n+        }\n+\n+        if (!data.getPoolNames().isEmpty()) {\n+            Map<String, String> actionsResults = data.getPoolNames().stream().collect(\n+                    Collectors.toMap(Function.identity(),\n+                poolName -> {\n+                    return scheduleAction(poolName, user, host, actionCreator, data);\n+                }\n+            ));\n+            return json(response, actionsResults);\n+        }\n+\n+        String result = scheduleAction(null, user, host, actionCreator, data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade3e08fc622c6f2e3829cb48ac5817617c4c02"}, "originalPosition": 147}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39232ff63117d0c6b4bfac87e3d1782b386dec4a", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/39232ff63117d0c6b4bfac87e3d1782b386dec4a", "committedDate": "2020-03-12T07:13:39Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "5476b39185609eca6241ff22ab343004b4d7e594", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5476b39185609eca6241ff22ab343004b4d7e594", "committedDate": "2020-03-12T12:36:19Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODE1NTgw", "url": "https://github.com/uyuni-project/uyuni/pull/1984#pullrequestreview-373815580", "createdAt": "2020-03-12T18:47:55Z", "commit": {"oid": "5476b39185609eca6241ff22ab343004b4d7e594"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5476b39185609eca6241ff22ab343004b4d7e594", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5476b39185609eca6241ff22ab343004b4d7e594", "committedDate": "2020-03-12T12:36:19Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "c1a71e7cc954fe26443dac01e9831894b685d631", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c1a71e7cc954fe26443dac01e9831894b685d631", "committedDate": "2020-03-13T15:59:10Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c786ff8197f7e5e26de777e9485b0ec7ac512a6", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4c786ff8197f7e5e26de777e9485b0ec7ac512a6", "committedDate": "2020-03-23T07:43:26Z", "message": "Add cucumber steps to work with trees"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97c64f73205d6de2cbc0e66d304d4c7164cac3ef", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/97c64f73205d6de2cbc0e66d304d4c7164cac3ef", "committedDate": "2020-03-23T07:43:26Z", "message": "Add virtual pool refresh action\n\nAdd the base virtual pool action class and the refresh action"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "167c3d6e3477cbec24a3acc84864df4581071d9a", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/167c3d6e3477cbec24a3acc84864df4581071d9a", "committedDate": "2020-03-23T07:43:27Z", "message": "Add virtual pool refresh action Salt implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "361d0b28dc1cadce51e4fb73be689ccb7671a344", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/361d0b28dc1cadce51e4fb73be689ccb7671a344", "committedDate": "2020-03-23T07:43:27Z", "message": "Handle VirtNotifications for pool actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "facf168a23e3bc8b845cf6cda035a92002b487a5", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/facf168a23e3bc8b845cf6cda035a92002b487a5", "committedDate": "2020-03-23T08:21:41Z", "message": "Add REST API to trigger virtual pool refresh action"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36f61fdb75cf309cef84dfb17be23dcf74683f4", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a36f61fdb75cf309cef84dfb17be23dcf74683f4", "committedDate": "2020-03-23T08:21:43Z", "message": "Add virtual pool refresh action UI and cucumber test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5030ac022b9277a2af9427f49ea384b6d4beb91c", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5030ac022b9277a2af9427f49ea384b6d4beb91c", "committedDate": "2020-03-23T08:21:43Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1a71e7cc954fe26443dac01e9831894b685d631", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c1a71e7cc954fe26443dac01e9831894b685d631", "committedDate": "2020-03-13T15:59:10Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}, "afterCommit": {"oid": "5030ac022b9277a2af9427f49ea384b6d4beb91c", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5030ac022b9277a2af9427f49ea384b6d4beb91c", "committedDate": "2020-03-23T08:21:43Z", "message": "Add actions status notification in virt storage pool list\n\nSince the actions status will need to be reported, add notification\nusing the useVirtNotification hook.\nAlso add a column with no title for the actions status."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1619, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}