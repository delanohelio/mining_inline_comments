{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0ODI3ODIx", "number": 2789, "title": "Adds some logging to the DpkgRepo class", "bodyText": "What does this PR change?\nAdds some logging to the DpkgRepo class.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: No change for the users.\n\n\n DONE\n\n\nTest coverage\n\nNo tests: Just added logging.\n\nLinks\nNope\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-11-03T15:51:07Z", "url": "https://github.com/uyuni-project/uyuni/pull/2789", "merged": true, "mergeCommit": {"oid": "bb2f7b9115705cdb36441b1ce0a8fe7c261c467c"}, "closed": true, "closedAt": "2020-12-09T09:43:51Z", "author": {"login": "brejoc"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY7K5RgH2gAyNTE0ODI3ODIxOmJmZDE5YWM4N2Y4Yzc3MGZlMTM1MDMxYWQ3MWMxYjNkYjA0YTA3NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj27tygH2gAyNTE0ODI3ODIxOmZjMDE3NWRkOTRmMTc2MDc0NTFkNGJhN2Q2NDk5OWYyNTc3NWNlNzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bfd19ac87f8c770fe135031ad71c1b3db04a0775", "committedDate": "2020-11-03T15:47:43Z", "message": "Adds some logging to the DpkgRepo class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTQyNzc1", "url": "https://github.com/uyuni-project/uyuni/pull/2789#pullrequestreview-524142775", "createdAt": "2020-11-05T10:53:49Z", "commit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo1Mzo0OVrOHt91ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMTowMTo1NFrOHt-HsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTA2Ng==", "bodyText": "[nitpick] You don't need to capture the exception here, a raise without an argument will re-raise the last exception.. So instead of doing\nexcept Exception as ex:\n    ...\n    raise ex\nyou could do\nexcept Exception:\n    ...\n    raise", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517961066", "createdAt": "2020-11-05T10:53:49Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -111,10 +114,15 @@ def get_pkg_index_raw(self) -> typing.Tuple[str, bytes]:\n             for cnt_fname in [DpkgRepo.PKG_GZ, DpkgRepo.PKG_XZ, DpkgRepo.PKG_RW]:\n                 packages_url = self.append_index_file(cnt_fname)\n                 if packages_url.startswith(\"file://\"):\n-                    with open(packages_url.replace(\"file://\", \"\"), \"rb\") as f:\n-                        self._pkg_index = cnt_fname, f.read()\n-                        break\n-                    # TODO: Add logging in error case!\n+                    try:\n+                        with open(packages_url.replace(\"file://\", \"\"), \"rb\") as f:\n+                            self._pkg_index = cnt_fname, f.read()\n+                            break\n+                    except FileNotFoundError as ex:\n+                        logging.execption(\n+                            \"File not found: {}\".format(\n+                                packages_url.replace(\"file://\", \"\"), exc_info=True)\n+                        raise ex", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTE1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    logging.execption(\n          \n          \n            \n                                    logging.exception(", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517961158", "createdAt": "2020-11-05T10:54:02Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -111,10 +114,15 @@ def get_pkg_index_raw(self) -> typing.Tuple[str, bytes]:\n             for cnt_fname in [DpkgRepo.PKG_GZ, DpkgRepo.PKG_XZ, DpkgRepo.PKG_RW]:\n                 packages_url = self.append_index_file(cnt_fname)\n                 if packages_url.startswith(\"file://\"):\n-                    with open(packages_url.replace(\"file://\", \"\"), \"rb\") as f:\n-                        self._pkg_index = cnt_fname, f.read()\n-                        break\n-                    # TODO: Add logging in error case!\n+                    try:\n+                        with open(packages_url.replace(\"file://\", \"\"), \"rb\") as f:\n+                            self._pkg_index = cnt_fname, f.read()\n+                            break\n+                    except FileNotFoundError as ex:\n+                        logging.execption(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2Mjg1Ng==", "bodyText": "Shouldn't this be a logging.error() since there is no exception at this point? The exception will come later and logging it can be done when handling the exception.", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517962856", "createdAt": "2020-11-05T10:57:01Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -292,11 +309,15 @@ def _get_release_index_from_file(self) -> typing.Dict[str, \"DpkgRepo.ReleaseEntr\n         # Repo format is not flat\n         if not self.is_flat():\n             if self.gpg_verify and not self._has_valid_gpg_signature(local_path):\n+                logging.exception(\"GPG verfication failed: {}\".format(release_file), exc_info=True)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NDAzMA==", "bodyText": "For consistency with the other messages about raising an exception (btw, do we actually win anything by logging that we are about to raise an exception? Isn't the exception handling logging enough to tell us we got one?), this should be\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            logging.error(\"GeneralRepoException will be raised!\")\n          \n          \n            \n                            logging.error(\"Raising GeneralRepoException!\")", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517964030", "createdAt": "2020-11-05T10:58:56Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -292,11 +309,15 @@ def _get_release_index_from_file(self) -> typing.Dict[str, \"DpkgRepo.ReleaseEntr\n         # Repo format is not flat\n         if not self.is_flat():\n             if self.gpg_verify and not self._has_valid_gpg_signature(local_path):\n+                logging.exception(\"GPG verfication failed: {}\".format(release_file), exc_info=True)\n+                logging.error(\"GeneralRepoException will be raised!\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NDQ3OA==", "bodyText": "Shouldn't this be logging.error() again?", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517964478", "createdAt": "2020-11-05T10:59:42Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -306,31 +327,40 @@ def _get_release_index_from_file(self) -> typing.Dict[str, \"DpkgRepo.ReleaseEntr\n             elif os.access(self._get_parent_url(local_path, 0, \"Release\"), os.R_OK):\n                 release_file = self._get_parent_url(local_path, 0, \"Release\")\n             else:\n+                logging.exception(\"No release file found in '{}'. Raising \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NDczMw==", "bodyText": "This one as well (logging.error())", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517964733", "createdAt": "2020-11-05T11:00:06Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -306,31 +327,40 @@ def _get_release_index_from_file(self) -> typing.Dict[str, \"DpkgRepo.ReleaseEntr\n             elif os.access(self._get_parent_url(local_path, 0, \"Release\"), os.R_OK):\n                 release_file = self._get_parent_url(local_path, 0, \"Release\")\n             else:\n+                logging.exception(\"No release file found in '{}'. Raising \\\n+                                   GeneralRepoException.\".format(self._get_parent_url(local_path, 0)), exc_info=True)\n                 raise GeneralRepoException(\"No release file found in {}\".format(self._get_parent_url(local_path, 0)))\n \n             try:\n                 with open(release_file, \"rb\") as f:\n                     release_file_content = f.read().decode(\"utf-8\")\n                     if self.gpg_verify and not self._has_valid_gpg_signature(local_path):\n+                        logging.exception(\"GPG verfication failed: '{}'. \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NTc0NA==", "bodyText": "Would it make sense to also include the actual problem in the exception that is raised? So instead of only saying \"GPG verification failed\", we could also say why it failed.", "url": "https://github.com/uyuni-project/uyuni/pull/2789#discussion_r517965744", "createdAt": "2020-11-05T11:01:54Z", "author": {"login": "agraul"}, "path": "backend/common/repo.py", "diffHunk": "@@ -339,6 +369,7 @@ def _get_release_index_from_http(self) -> typing.Dict[str, \"DpkgRepo.ReleaseEntr\n             self._flat_checked = 1\n \n             if not self.is_flat() and self.gpg_verify and not self._has_valid_gpg_signature(resp.url, resp):\n+                logging.error(\"Repo has no valid GPG signature. Raising GeneralRepoException.\")\n                 raise GeneralRepoException(\"GPG verfication failed: {}\".format(resp.url))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd19ac87f8c770fe135031ad71c1b3db04a0775"}, "originalPosition": 134}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3192dde069ba601bf69053de928de8427dff795e", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3192dde069ba601bf69053de928de8427dff795e", "committedDate": "2020-11-05T14:31:58Z", "message": "Adds missing parenthesis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57187686ea56e48a9970e23ff0b5c995905c3cd0", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/57187686ea56e48a9970e23ff0b5c995905c3cd0", "committedDate": "2020-11-05T14:34:51Z", "message": "Adds changelog entry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ea4fb726c167ec0d3349c5f5f776621d6b7ac7d", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/9ea4fb726c167ec0d3349c5f5f776621d6b7ac7d", "committedDate": "2020-11-05T14:37:36Z", "message": "Fix for typo execption vs exception\n\nCo-authored-by: Alexander Graul <agraul@suse.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61e0aebc233b580ca37cf27e2579ee7a8460df6c", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/61e0aebc233b580ca37cf27e2579ee7a8460df6c", "committedDate": "2020-11-05T14:43:56Z", "message": "Wording of logging message\n\nCo-authored-by: Alexander Graul <agraul@suse.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab714d3f53a49d10bfac51ef684ed37a1293c1dd", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ab714d3f53a49d10bfac51ef684ed37a1293c1dd", "committedDate": "2020-11-05T14:51:12Z", "message": "Adds success and failure logging for _has_valid_gpg_signature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d450efccf6ef143f9f0bd52c394dd0dc7ee7b38e", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d450efccf6ef143f9f0bd52c394dd0dc7ee7b38e", "committedDate": "2020-11-09T18:48:15Z", "message": "Adds raise from and fixes usage of exception logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MjA3NDY3", "url": "https://github.com/uyuni-project/uyuni/pull/2789#pullrequestreview-546207467", "createdAt": "2020-12-07T14:35:53Z", "commit": {"oid": "d450efccf6ef143f9f0bd52c394dd0dc7ee7b38e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc0175dd94f17607451d4ba7d64999f25775ce77", "author": {"user": {"login": "brejoc", "name": "Jochen Breuer"}}, "url": "https://github.com/uyuni-project/uyuni/commit/fc0175dd94f17607451d4ba7d64999f25775ce77", "committedDate": "2020-12-07T15:04:41Z", "message": "Merge remote-tracking branch 'uyuni/master' into uyuni-master-logging-for-repo-py"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 965, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}