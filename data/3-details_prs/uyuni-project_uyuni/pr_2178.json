{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNTY4MjA0", "number": 2178, "title": "Manager bsc1169535", "bodyText": "What does this PR change?\nWhen a proxy gets migrated from 3.2 to 4.0, a new apache configuration file gets installed at /etc/apache2/conf.d/susemanager-tftpsync-recv.conf because the syntax has changed with the newer apache version. However this file is just a template that gets filled by configure-tftpsync.sh so the new template gets installed as /etc/apache2/conf.d/susemanager-tftpsync-recv.conf.rpmnew and apache will complain as it only finds the syntax of the old version. So we need to detect this condition and install and configure the new template during postinstall.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: Bugfix\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: Happens only when upgrading a proxy where tftpsync had already been configured\n\n\n DONE\n\n\nLinks\nFixes https://bugzilla.suse.com/show_bug.cgi?id=1169535\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-04-30T14:32:12Z", "url": "https://github.com/uyuni-project/uyuni/pull/2178", "merged": true, "mergeCommit": {"oid": "71f37d2ea35677ab3dcbf59f69d60653ede8b826"}, "closed": true, "closedAt": "2020-05-04T11:24:27Z", "author": {"login": "mantel"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcct39qgH2gAyNDExNTY4MjA0OmUwNWVlZjNjYjNiNmU1OWU5MjZjYmM0ZjhlODVlNWFmN2ZhZWExYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd8WusgFqTQwNDg0NDQxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e05eef3cb3b6e59e926cbc4f8e85e5af7faea1bf", "author": {"user": {"login": "mantel", "name": "Hubert Mantel"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e05eef3cb3b6e59e926cbc4f8e85e5af7faea1bf", "committedDate": "2020-04-30T14:22:49Z", "message": "ensure correct /etc/apache2/conf.d/susemanager-tftpsync-recv.conf after upgrade (bsc#1169535)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4ab64dcaf2075628a5f6c3f5013b79060d22665", "author": {"user": {"login": "mantel", "name": "Hubert Mantel"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d4ab64dcaf2075628a5f6c3f5013b79060d22665", "committedDate": "2020-04-30T14:23:20Z", "message": "ensure correct /etc/apache2/conf.d/susemanager-tftpsync-recv.conf after upgrade (bsc#1169535)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNjcxOTIy", "url": "https://github.com/uyuni-project/uyuni/pull/2178#pullrequestreview-403671922", "createdAt": "2020-04-30T16:13:19Z", "commit": {"oid": "d4ab64dcaf2075628a5f6c3f5013b79060d22665"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjoxMzoxOVrOGOwdOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjoxMzoxOVrOGOwdOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEyNzE2MQ==", "bodyText": "Wasn't there a rule that RPM post scripts should never fail?\nAFAIK RPM would see this as a broken package.\nReporting the error is ok, but I think it should still \"exit 0\".\nMaybe check back with @mlandres", "url": "https://github.com/uyuni-project/uyuni/pull/2178#discussion_r418127161", "createdAt": "2020-04-30T16:13:19Z", "author": {"login": "mcalmer"}, "path": "tftpsync/susemanager-tftpsync-recv/susemanager-tftpsync-recv.spec", "diffHunk": "@@ -70,6 +70,20 @@ if [ -d /srv/tftpboot ]; then\n     chmod 750 /srv/tftpboot\n     chown wwwrun:tftp /srv/tftpboot\n fi\n+if [ -f /etc/apache2/conf.d/susemanager-tftpsync-recv.conf.rpmnew ]; then\n+    PARENT_FQDN=$( egrep -m1 \"^proxy.rhn_parent[[:space:]]*=\" /etc/rhn/rhn.conf | sed 's/^proxy.rhn_parent[[:space:]]*=[[:space:]]*\\(.*\\)/\\1/' || echo \"\" )\n+    if [ -z \"$PARENT_FQDN\" ]; then\n+            echo \"Could not determine SUSE Manager Parent Hostname! Got /etc/rhn/rhn.conf vanished?\" >&2;\n+            exit 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4ab64dcaf2075628a5f6c3f5013b79060d22665"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODQ0NDE3", "url": "https://github.com/uyuni-project/uyuni/pull/2178#pullrequestreview-404844417", "createdAt": "2020-05-04T09:49:01Z", "commit": {"oid": "d4ab64dcaf2075628a5f6c3f5013b79060d22665"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1405, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}