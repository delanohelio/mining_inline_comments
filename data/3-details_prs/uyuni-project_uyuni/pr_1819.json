{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzQ5MDQ2", "number": 1819, "title": "Move all the routes initialization calls into the controllers", "bodyText": "What does this PR change?\nIn order to make the Router class more readable, move all the route\ninitialization functions into the controller as it has already been\nstarted.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: code move\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: code mode\n\n\n DONE\n\n\nLinks\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-01-22T09:28:25Z", "url": "https://github.com/uyuni-project/uyuni/pull/1819", "merged": true, "mergeCommit": {"oid": "7e78ef86b8757c71660f0d0dddb9a8ba5e8418f2"}, "closed": true, "closedAt": "2020-02-01T16:20:33Z", "author": {"login": "cbosdo"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8yqK7AFqTM0NjQ1OTcxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9Ge9EgFqTM0NzEzODUzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDU5NzEy", "url": "https://github.com/uyuni-project/uyuni/pull/1819#pullrequestreview-346459712", "createdAt": "2020-01-22T09:51:41Z", "commit": {"oid": "15b2511596a9f963fb06cb612fe668d9128f69f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwOTo1MTo0MVrOFgWFDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwOTo1MTo0MVrOFgWFDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ2MDQ5NQ==", "bodyText": "How about organizing the removed code by route i.e. groups, systems, etc by adding new methods and calling them inside MinionsAPI.initRoutes() or calling them directly from here.", "url": "https://github.com/uyuni-project/uyuni/pull/1819#discussion_r369460495", "createdAt": "2020-01-22T09:51:41Z", "author": {"login": "mateiw"}, "path": "java/code/src/com/suse/manager/webui/Router.java", "diffHunk": "@@ -117,204 +106,49 @@ public void init() {\n         AdminApiController.initRoutes();\n \n         // Minions\n-        get(\"/manager/systems/keys\",\n-                withUserPreferences(withCsrfToken(withUser(MinionController::list))),\n-                jade);\n-        get(\"/manager/systems/bootstrap\",\n-                withCsrfToken(withOrgAdmin(MinionController::bootstrap)),\n-                jade);\n-        get(\"/manager/systems/cmd\",\n-                withCsrfToken(MinionController::cmd),\n-                jade);\n-        get(\"/manager/systems/:id\",\n-                MinionController::show);\n+        MinionController.initRoutes(jade);\n \n         // Minions API\n-        post(\"/manager/api/systems/bootstrap\", withOrgAdmin(MinionsAPI::bootstrap));\n-        post(\"/manager/api/systems/bootstrap-ssh\", withOrgAdmin(MinionsAPI::bootstrapSSH));\n-        get(\"/manager/api/systems/keys\", withUser(MinionsAPI::listKeys));\n-        post(\"/manager/api/systems/keys/:target/accept\", withOrgAdmin(MinionsAPI::accept));\n-        post(\"/manager/api/systems/keys/:target/reject\", withOrgAdmin(MinionsAPI::reject));\n-        post(\"/manager/api/systems/keys/:target/delete\", withOrgAdmin(MinionsAPI::delete));\n-\n-        // States\n-        get(\"/manager/systems/details/packages\",\n-                withCsrfToken(MinionController::packageStates),\n-                jade);\n-        get(\"/manager/systems/details/custom\",\n-                withCsrfToken(MinionController::minionCustomStates),\n-                jade);\n-        get(\"/manager/systems/details/highstate\",\n-                withCsrfToken(withUser(MinionController::highstate)),\n-                jade);\n-        get(\"/manager/multiorg/details/custom\",\n-                withCsrfToken(MinionController::orgCustomStates),\n-                jade);\n-        get(\"/manager/yourorg/custom\",\n-                withCsrfToken(withUser(MinionController::yourOrgConfigChannels)),\n-                jade);\n-        get(\"/manager/groups/details/custom\",\n-                withCsrfToken(withUser(MinionController::serverGroupConfigChannels)),\n-                jade);\n-        get(\"/manager/groups/details/highstate\",\n-                withCsrfToken(withUser(MinionController::serverGroupHighstate)), jade);\n-\n-        // SSM API\n-        get(\"/manager/systems/ssm/highstate\",\n-                withCsrfToken(withUser(MinionController::ssmHighstate)), jade);\n-        get(\"/manager/systems/ssm/channels/bases\",\n-                withUser(SsmController::getBaseChannels));\n-        post(\"/manager/systems/ssm/channels/allowed-changes\",\n-                withUser(SsmController::computeAllowedChannelChanges));\n-        post(\"/manager/systems/ssm/channels\",\n-                withUser(SsmController::changeChannels));\n+        MinionsAPI.initRoutes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b2511596a9f963fb06cb612fe668d9128f69f2"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a548d404aadc988f5f0b473be7330f88efed3c9", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8a548d404aadc988f5f0b473be7330f88efed3c9", "committedDate": "2020-01-23T08:21:14Z", "message": "Move all the routes initialization calls into the controllers\n\nIn order to make the Router class more readable, move all the route\ninitialization functions into the controller as it has already been\nstarted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15b2511596a9f963fb06cb612fe668d9128f69f2", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/15b2511596a9f963fb06cb612fe668d9128f69f2", "committedDate": "2020-01-22T09:26:09Z", "message": "Move all the routes initialization calls into the controllers\n\nIn order to make the Router class more readable, move all the route\ninitialization functions into the controller as it has already been\nstarted."}, "afterCommit": {"oid": "8a548d404aadc988f5f0b473be7330f88efed3c9", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8a548d404aadc988f5f0b473be7330f88efed3c9", "committedDate": "2020-01-23T08:21:14Z", "message": "Move all the routes initialization calls into the controllers\n\nIn order to make the Router class more readable, move all the route\ninitialization functions into the controller as it has already been\nstarted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTM4NTM0", "url": "https://github.com/uyuni-project/uyuni/pull/1819#pullrequestreview-347138534", "createdAt": "2020-01-23T08:57:33Z", "commit": {"oid": "8a548d404aadc988f5f0b473be7330f88efed3c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1739, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}