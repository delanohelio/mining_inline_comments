{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MzUzMzMw", "number": 2021, "title": "Read modularity tag", "bodyText": "What does this PR change?\nImplements modularity tag reading as per https://github.com/SUSE/spacewalk/issues/10897\n\n DONE\n\nDocumentation\n\nNo documentation needed: this change is a part of above mentioned project.\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-03-16T16:25:49Z", "url": "https://github.com/uyuni-project/uyuni/pull/2021", "merged": true, "mergeCommit": {"oid": "b879601259c9244b9b98bdca79cfef9103d36cfc"}, "closed": true, "closedAt": "2020-03-17T13:40:10Z", "author": {"login": "isbm"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOQiXDAH2gAyMzg5MzUzMzMwOmRjYTRiODI3MzA4MzIzOWIyODRmMjk1NmE3ZThlYWUwZDA0YThjOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOiz3rgFqTM3NjAzNzM5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dca4b8273083239b284f2956a7e8eae0d04a8c8b", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/dca4b8273083239b284f2956a7e8eae0d04a8c8b", "committedDate": "2020-03-16T16:17:02Z", "message": "Add modularitylabel tag support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c14c4aefce2b46a2852044497a440e40b6513f", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/78c14c4aefce2b46a2852044497a440e40b6513f", "committedDate": "2020-03-16T16:17:24Z", "message": "Populate extra-tags (currently only modularitylabel)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9787a3ba24eb9033c3ff3190fb595e7cb8178b9", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/c9787a3ba24eb9033c3ff3190fb595e7cb8178b9", "committedDate": "2020-03-17T11:08:31Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2c119680e097bd007123c16c4bc943912727399", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/d2c119680e097bd007123c16c4bc943912727399", "committedDate": "2020-03-17T11:08:58Z", "message": "Fix hdr object has no .get method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "292e98b7ff962c350e1c8276d7b3563872431cf8", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/292e98b7ff962c350e1c8276d7b3563872431cf8", "committedDate": "2020-03-17T12:58:01Z", "message": "Move extra tag population method to the base class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "committedDate": "2020-03-17T12:59:57Z", "message": "Update CL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDEzMTc1", "url": "https://github.com/uyuni-project/uyuni/pull/2021#pullrequestreview-376013175", "createdAt": "2020-03-17T13:05:27Z", "commit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDIxNDQz", "url": "https://github.com/uyuni-project/uyuni/pull/2021#pullrequestreview-376021443", "createdAt": "2020-03-17T13:16:02Z", "commit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoxNjowMlrOF3bslg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoxNjowMlrOF3bslg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2OTc4Mg==", "bodyText": "You are missing an entry at uyuni-common-libs.changes", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393669782", "createdAt": "2020-03-17T13:16:02Z", "author": {"login": "juliogonzalez"}, "path": "uyuni/common-libs/common/rhn_rpm.py", "diffHunk": "@@ -47,6 +47,7 @@\n \n # need this for rpm-pyhon < 4.6 (e.g. on RHEL5)\n rpm.RPMTAG_FILEDIGESTALGO = 5011\n+rpm.RPMTAG_MODULARITYLABEL = 5096", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDE5ODIw", "url": "https://github.com/uyuni-project/uyuni/pull/2021#pullrequestreview-376019820", "createdAt": "2020-03-17T13:14:01Z", "commit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoxNDowMVrOF3bn2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoxNjoyNlrOF3btlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2ODU3MQ==", "bodyText": "I think this is only initialized in case of a rpmBinaryPackage. When this is a rpmSourcePackage extra_tags is not part of the tagMap.\nI would suggest to do a similar thing as build_time which is available in both tagMaps.\nJust add extra_tags to rpmSourcePackage tagMap.\nclass rpmSourcePackage(SourcePackage, rpmPackage):\n    tagMap = rpmPackage.tagMap.copy()\n    tagMap.update({\n        'package_group': 'group',\n        'rpm_version': 'rpmversion',\n        'payload_size': 'archivesize',\n        'build_host': 'buildhost',\n        'build_time': 'buildtime',\n        'source_rpm': 'sourcerpm',\n        # Arrays: require a different mapping\n        # We set them differently\n        'package_size': None,\n        'org_id': None,\n        'md5sum': None,\n        'path': None,\n        # Unsupported\n        'payload_format': None,\n        'channels': None,\n        'package_id': None,\n    })", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393668571", "createdAt": "2020-03-17T13:14:01Z", "author": {"login": "mcalmer"}, "path": "backend/server/importlib/headerSource.py", "diffHunk": "@@ -98,8 +98,21 @@ def populate(self, header, size, checksum_type, checksum, path=None, org_id=None\n             self['payload_format'] = 'cpio'\n         if self['payload_size'] is None:\n             self['payload_size'] = 0\n+        # Extra tags\n+        self._populateExtraTags(header)\n+\n         return self\n \n+    def _populateExtraTags(self, header):\n+        \"\"\"\n+        Populate extra tags. Currently only \"modularitylabel\".\n+        \"\"\"\n+        mlabel = header.modularity_label()\n+        if mlabel is not None:\n+            self[\"extra_tags\"] = [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3MDAzOA==", "bodyText": "We need also a changelog entry for uyuni-common-libs", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393670038", "createdAt": "2020-03-17T13:16:26Z", "author": {"login": "mcalmer"}, "path": "backend/spacewalk-backend.changes", "diffHunk": "@@ -1,3 +1,5 @@\n+- Read MODULARITYLABEL tag from RPM packages", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f952611ae67fb5901e4c5f8be74a3978d48fb51", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/9f952611ae67fb5901e4c5f8be74a3978d48fb51", "committedDate": "2020-03-17T13:21:32Z", "message": "Update CL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae00a3584f035b475f21199a1e677cf645bebe23", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/ae00a3584f035b475f21199a1e677cf645bebe23", "committedDate": "2020-03-17T13:30:53Z", "message": "Initialise extra_tags key for src packages (consistency)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDM3MjUy", "url": "https://github.com/uyuni-project/uyuni/pull/2021#pullrequestreview-376037252", "createdAt": "2020-03-17T13:34:18Z", "commit": {"oid": "ae00a3584f035b475f21199a1e677cf645bebe23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDM3Mzk2", "url": "https://github.com/uyuni-project/uyuni/pull/2021#pullrequestreview-376037396", "createdAt": "2020-03-17T13:34:27Z", "commit": {"oid": "ae00a3584f035b475f21199a1e677cf645bebe23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1501, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}