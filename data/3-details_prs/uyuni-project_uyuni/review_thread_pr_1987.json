{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MzA0NjM3", "number": 1987, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjowNFrODnBL9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoxNToxNFrODoc0YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjQwNTAyOnYy", "diffSide": "RIGHT", "path": "testsuite/features/secondary/minkvm_guests.feature", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjowNFrOF0xPnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjowNFrOF0xPnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzA4NA==", "bodyText": "Could be \"And\"", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r390877084", "createdAt": "2020-03-11T10:32:04Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -194,6 +194,37 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And I click on \"Delete\" in \"Delete Guest\" modal\n     Then I should not see a \"test-vm2\" virtual machine on \"kvm_server\"\n \n+@virthost_kvm\n+  Scenario: Refresh a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Refresh\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" has no sub-list", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjQwNTkxOnYy", "diffSide": "RIGHT", "path": "testsuite/features/secondary/minkvm_guests.feature", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjoyMFrOF0xQIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjoyMFrOF0xQIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzIxOQ==", "bodyText": "Same", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r390877219", "createdAt": "2020-03-11T10:32:20Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -194,6 +194,37 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And I click on \"Delete\" in \"Delete Guest\" modal\n     Then I should not see a \"test-vm2\" virtual machine on \"kvm_server\"\n \n+@virthost_kvm\n+  Scenario: Refresh a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Refresh\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" has no sub-list\n+\n+@virthost_kvm\n+  Scenario: Stop a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Stop\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" contains \"inactive\" text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjQwNjU2OnYy", "diffSide": "RIGHT", "path": "testsuite/features/secondary/minkvm_guests.feature", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjozMlrOF0xQkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjozMlrOF0xQkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzMzMQ==", "bodyText": "Same", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r390877331", "createdAt": "2020-03-11T10:32:32Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -194,6 +194,37 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And I click on \"Delete\" in \"Delete Guest\" modal\n     Then I should not see a \"test-vm2\" virtual machine on \"kvm_server\"\n \n+@virthost_kvm\n+  Scenario: Refresh a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Refresh\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" has no sub-list\n+\n+@virthost_kvm\n+  Scenario: Stop a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Stop\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" contains \"inactive\" text\n+\n+@virthost_kvm\n+  Scenario: Start a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Start\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" contains \"running\" text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjQwNzkyOnYy", "diffSide": "RIGHT", "path": "testsuite/features/secondary/minkvm_guests.feature", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjo1NlrOF0xRZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMjo1NlrOF0xRZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzU0MA==", "bodyText": "Could be \"And\", then \"Then\"", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r390877540", "createdAt": "2020-03-11T10:32:56Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -194,6 +194,37 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And I click on \"Delete\" in \"Delete Guest\" modal\n     Then I should not see a \"test-vm2\" virtual machine on \"kvm_server\"\n \n+@virthost_kvm\n+  Scenario: Refresh a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Refresh\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" has no sub-list\n+\n+@virthost_kvm\n+  Scenario: Stop a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Stop\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" contains \"inactive\" text\n+\n+@virthost_kvm\n+  Scenario: Start a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Start\" in tree item \"test-pool0\"\n+    Then I wait until the tree item \"test-pool0\" contains \"running\" text\n+\n+@virthost_kvm\n+  Scenario: Delete a virtual storage pool for KVM\n+    Given I am on the \"Virtualization\" page of this \"kvm_server\"\n+    When I follow \"Storage\"\n+    And I click on \"Delete\" in tree item \"test-pool0\"\n+    And I check \"purge\"\n+    And I click on \"Delete\" in \"Delete Virtual Storage Pool\" modal\n+    Then I wait until I do not see \"test-pool0\" text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjQwODYzOnYy", "diffSide": "RIGHT", "path": "testsuite/features/step_definitions/common_steps.rb", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMzoxMFrOF0xR2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMzoxMFrOF0xR2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzY1OQ==", "bodyText": "\"When\" please", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r390877659", "createdAt": "2020-03-11T10:33:10Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -461,6 +461,24 @@\n   raise \"xpath: #{xpath} not found\" unless find(:xpath, xpath).set(true)\n end\n \n+When(/I wait until the tree item \"([^\"]+)\" has no sub-list/) do |item|\n+  repeat_until_timeout(message: \"could still find a sub list for tree item #{item}\") do\n+    xpath = \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]/div/i[contains(@class, 'fa-angle-')]\"\n+    begin\n+      find(:xpath, xpath)\n+      sleep 1\n+    rescue Capybara::ElementNotFound\n+      break\n+    end\n+  end\n+end\n+\n+And(/^I wait until the tree item \"([^\"]+)\" contains \"([^\"]+)\" text$/) do |item, text|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjQwOTM3OnYy", "diffSide": "RIGHT", "path": "testsuite/features/step_definitions/common_steps.rb", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDozMzoyNVrOF0xSaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNzoyODo1NVrOF1BXAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzgwMQ==", "bodyText": "\"When\" please", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r390877801", "createdAt": "2020-03-11T10:33:25Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -461,6 +461,24 @@\n   raise \"xpath: #{xpath} not found\" unless find(:xpath, xpath).set(true)\n end\n \n+When(/I wait until the tree item \"([^\"]+)\" has no sub-list/) do |item|\n+  repeat_until_timeout(message: \"could still find a sub list for tree item #{item}\") do\n+    xpath = \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]/div/i[contains(@class, 'fa-angle-')]\"\n+    begin\n+      find(:xpath, xpath)\n+      sleep 1\n+    rescue Capybara::ElementNotFound\n+      break\n+    end\n+  end\n+end\n+\n+And(/^I wait until the tree item \"([^\"]+)\" contains \"([^\"]+)\" text$/) do |item, text|\n+  within(:xpath, \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\") do\n+    raise \"could not find text #{text} for tree item #{item}\" unless has_text?(text, wait: DEFAULT_TIMEOUT)\n+  end\n+end\n+\n And(/^I open the sub-list of the product \"(.*?)\"$/) do |product|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA3NTUzNw==", "bodyText": "that one is from another commit though ;)", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r391075537", "createdAt": "2020-03-11T15:53:38Z", "author": {"login": "cbosdo"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -461,6 +461,24 @@\n   raise \"xpath: #{xpath} not found\" unless find(:xpath, xpath).set(true)\n end\n \n+When(/I wait until the tree item \"([^\"]+)\" has no sub-list/) do |item|\n+  repeat_until_timeout(message: \"could still find a sub list for tree item #{item}\") do\n+    xpath = \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]/div/i[contains(@class, 'fa-angle-')]\"\n+    begin\n+      find(:xpath, xpath)\n+      sleep 1\n+    rescue Capybara::ElementNotFound\n+      break\n+    end\n+  end\n+end\n+\n+And(/^I wait until the tree item \"([^\"]+)\" contains \"([^\"]+)\" text$/) do |item, text|\n+  within(:xpath, \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\") do\n+    raise \"could not find text #{text} for tree item #{item}\" unless has_text?(text, wait: DEFAULT_TIMEOUT)\n+  end\n+end\n+\n And(/^I open the sub-list of the product \"(.*?)\"$/) do |product|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzgwMQ=="}, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0MTEyMg==", "bodyText": "yeah, but if you could fix it while you're at it ;-)", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r391141122", "createdAt": "2020-03-11T17:28:55Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -461,6 +461,24 @@\n   raise \"xpath: #{xpath} not found\" unless find(:xpath, xpath).set(true)\n end\n \n+When(/I wait until the tree item \"([^\"]+)\" has no sub-list/) do |item|\n+  repeat_until_timeout(message: \"could still find a sub list for tree item #{item}\") do\n+    xpath = \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]/div/i[contains(@class, 'fa-angle-')]\"\n+    begin\n+      find(:xpath, xpath)\n+      sleep 1\n+    rescue Capybara::ElementNotFound\n+      break\n+    end\n+  end\n+end\n+\n+And(/^I wait until the tree item \"([^\"]+)\" contains \"([^\"]+)\" text$/) do |item, text|\n+  within(:xpath, \"//span[contains(text(), '#{item}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\") do\n+    raise \"could not find text #{text} for tree item #{item}\" unless has_text?(text, wait: DEFAULT_TIMEOUT)\n+  end\n+end\n+\n And(/^I open the sub-list of the product \"(.*?)\"$/) do |product|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3NzgwMQ=="}, "originalCommit": {"oid": "e41c1355ed826953154ecbd7fb1a3d24f3deedae"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzQxNzkyOnYy", "diffSide": "RIGHT", "path": "java/code/src/com/suse/manager/webui/controllers/test/VirtualPoolsControllerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoxNToxNFrOF3AcLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoxNToxNFrOF3AcLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIyMzIxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Ensure the start action is queued\n          \n          \n            \n                    // Ensure the delete action is queued", "url": "https://github.com/uyuni-project/uyuni/pull/1987#discussion_r393223214", "createdAt": "2020-03-16T18:15:14Z", "author": {"login": "cbbayburt"}, "path": "java/code/src/com/suse/manager/webui/controllers/test/VirtualPoolsControllerTest.java", "diffHunk": "@@ -224,4 +225,27 @@ public void testStop() throws Exception {\n         Map<String, Long> model = GSON.fromJson(json, new TypeToken<Map<String, Long>>() {}.getType());\n         assertTrue(IsMapContaining.hasEntry(\"pool0\", action.getId()).matches(model));\n     }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    public void testDelete() throws Exception {\n+        String json = VirtualPoolsController.poolDelete(\n+                getPostRequestWithCsrfAndBody(\"/manager/api/systems/details/virtualization/pools/:sid/delete\",\n+                                              \"{poolNames: [\\\"pool0\\\"], purge: true}\",\n+                                              host.getId()),\n+                response, user);\n+\n+        // Ensure the start action is queued", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ebce18b0b8811ad28fc2d40ff2ceea4ccf1f7f"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 138, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}