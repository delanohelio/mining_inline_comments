{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NTI0NTMx", "number": 2745, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMDo1NTozNVrOExKAHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTozNDoyNVrOEyTk7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTc5NTQ5OnYy", "diffSide": "RIGHT", "path": "backend/satellite_tools/reposync.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMDo1NTozNVrOHnI7bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMDo1NTozNVrOHnI7bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgwMjc5Nw==", "bodyText": "I would adjust the padding of the message like previous messages in this same stage of reposync\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log(0, \"Including the checksum in the modules file name: %s\" % basename)\n          \n          \n            \n                        log(0, \"  Including the checksum in the modules file name: %s\" % basename)", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r510802797", "createdAt": "2020-10-23T10:55:35Z", "author": {"login": "meaksh"}, "path": "backend/satellite_tools/reposync.py", "diffHunk": "@@ -748,6 +760,12 @@ def copy_metadata_file(self, plug, filename, comps_type, relative_dir):\n         if comps_type == 'comps' and not re.match('comps.xml(' + \"|\".join(compressed_suffixes) + ')*', basename):\n             log(0, \"  Renaming non-standard filename %s to %s.\" % (basename, 'comps' + basename[basename.find('.'):]))\n             basename = 'comps' + basename[basename.find('.'):]\n+        elif comps_type == 'modules' and re.match('modules.yaml(' + \"|\".join(compressed_suffixes) + ')*', basename):\n+            # decompress only for getting the checksum\n+            checksum = self._getDecompressedFileChecksum(filename, 'sha256')\n+            basename = checksum + \"-\" + basename\n+            log(0, \"Including the checksum in the modules file name: %s\" % basename)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99fe71b3a063733959345cd796c7d1d0c44492b7"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTgyNDQzOnYy", "diffSide": "RIGHT", "path": "backend/satellite_tools/reposync.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMTowNDoyNVrOHnJMiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMTo0MDozMlrOHnKOCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgwNzE3Nw==", "bodyText": "Let's try to prevent introducing more camelCase code in Python files if possible \ud83d\ude04\nBetter use something more pythonic like, _get_decompressed_file_checksum", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r510807177", "createdAt": "2020-10-23T11:04:25Z", "author": {"login": "meaksh"}, "path": "backend/satellite_tools/reposync.py", "diffHunk": "@@ -734,6 +735,17 @@ def import_updates(self, plug):\n             elif notices_type == 'patches':\n                 self.upload_patches(notices)\n \n+    @staticmethod\n+    def _getDecompressedFileChecksum(abspath, hashtype):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99fe71b3a063733959345cd796c7d1d0c44492b7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMzk0Ng==", "bodyText": "Makes sense. I was confused by the getFileCheckSum, but that one is imported from somewhere else.", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r510823946", "createdAt": "2020-10-23T11:40:32Z", "author": {"login": "hustodemon"}, "path": "backend/satellite_tools/reposync.py", "diffHunk": "@@ -734,6 +735,17 @@ def import_updates(self, plug):\n             elif notices_type == 'patches':\n                 self.upload_patches(notices)\n \n+    @staticmethod\n+    def _getDecompressedFileChecksum(abspath, hashtype):", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgwNzE3Nw=="}, "originalCommit": {"oid": "99fe71b3a063733959345cd796c7d1d0c44492b7"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTY2Njk1OnYy", "diffSide": "RIGHT", "path": "schema/spacewalk/common/data/rhnTaskoTask.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1MTowN1rOHo17hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoxNTo0NFrOHo5RuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU4ODY3OA==", "bodyText": "typo", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512588678", "createdAt": "2020-10-27T10:51:07Z", "author": {"login": "mcalmer"}, "path": "schema/spacewalk/common/data/rhnTaskoTask.sql", "diffHunk": "@@ -116,4 +116,7 @@ INSERT INTO rhnTaskoTask (id, name, class)\n INSERT INTO rhnTaskoTask (id, name, class)\n    VALUES (sequence_nextval('rhn_tasko_task_id_seq'), 'ssh-minion-action-executor', 'com.redhat.rhn.taskomatic.task.SSHMinionActionExecutor');\n \n+INSERT INTO rhnTaskoTask (id, name, class)\n+   VALUES (sequence_nextval('rhn_tasko_task_id_seq'), 'channel-modular-data-cleaunp', 'com.redhat.rhn.taskomatic.task.ModularDataCleanup');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY0MzUxMg==", "bodyText": "Good catch.", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512643512", "createdAt": "2020-10-27T12:15:44Z", "author": {"login": "hustodemon"}, "path": "schema/spacewalk/common/data/rhnTaskoTask.sql", "diffHunk": "@@ -116,4 +116,7 @@ INSERT INTO rhnTaskoTask (id, name, class)\n INSERT INTO rhnTaskoTask (id, name, class)\n    VALUES (sequence_nextval('rhn_tasko_task_id_seq'), 'ssh-minion-action-executor', 'com.redhat.rhn.taskomatic.task.SSHMinionActionExecutor');\n \n+INSERT INTO rhnTaskoTask (id, name, class)\n+   VALUES (sequence_nextval('rhn_tasko_task_id_seq'), 'channel-modular-data-cleaunp', 'com.redhat.rhn.taskomatic.task.ModularDataCleanup');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU4ODY3OA=="}, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTY2NzgyOnYy", "diffSide": "RIGHT", "path": "schema/spacewalk/common/data/rhnTaskoTemplate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1MToxN1rOHo17-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1MToxN1rOHo17-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU4ODc5NQ==", "bodyText": "typo", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512588795", "createdAt": "2020-10-27T10:51:17Z", "author": {"login": "mcalmer"}, "path": "schema/spacewalk/common/data/rhnTaskoTemplate.sql", "diffHunk": "@@ -252,4 +252,11 @@ INSERT INTO rhnTaskoTemplate (id, bunch_id, task_id, ordering, start_if)\n                         0,\n                         null);\n \n+INSERT INTO rhnTaskoTemplate (id, bunch_id, task_id, ordering, start_if)\n+            VALUES (sequence_nextval('rhn_tasko_template_id_seq'),\n+                        (SELECT id FROM rhnTaskoBunch WHERE name='cleanup-data-bunch'),\n+                        (SELECT id FROM rhnTaskoTask WHERE name='channel-modular-data-cleaunp'),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTcwNzk0OnYy", "diffSide": "RIGHT", "path": "schema/spacewalk/upgrade/susemanager-schema-4.2.2-to-susemanager-schema-4.2.3/210-channel-modular-data-cleaunp-job.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1ODo1OVrOHo2TIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1ODo1OVrOHo2TIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5NDcyMA==", "bodyText": "So we have a new Task, but use an existing Bunch. Ok, but the typo in the task name should be fixed.", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512594720", "createdAt": "2020-10-27T10:58:59Z", "author": {"login": "mcalmer"}, "path": "schema/spacewalk/upgrade/susemanager-schema-4.2.2-to-susemanager-schema-4.2.3/210-channel-modular-data-cleaunp-job.sql", "diffHunk": "@@ -0,0 +1,16 @@\n+INSERT INTO rhnTaskoTask (id, name, class)\n+SELECT sequence_nextval('rhn_tasko_task_id_seq'), 'channel-modular-data-cleaunp', 'com.redhat.rhn.taskomatic.task.ModularDataCleanup'\n+WHERE NOT EXISTS (SELECT 1 FROM rhnTaskoTask WHERE name='channel-modular-data-cleaunp');\n+\n+INSERT INTO rhnTaskoTemplate (id, bunch_id, task_id, ordering, start_if)\n+SELECT sequence_nextval('rhn_tasko_template_id_seq'),\n+    (SELECT id FROM rhnTaskoBunch WHERE name='cleanup-data-bunch'),\n+    (SELECT id FROM rhnTaskoTask WHERE name='channel-modular-data-cleaunp'),\n+    1,\n+    null\n+WHERE NOT EXISTS (\n+    SELECT 1 FROM rhnTaskoTemplate\n+    WHERE bunch_id = (SELECT id FROM rhnTaskoBunch WHERE name = 'cleanup-data-bunch')\n+      AND task_id = (SELECT id FROM rhnTaskoTask WHERE name = 'channel-modular-data-cleaunp')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTczMzM1OnYy", "diffSide": "RIGHT", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/channel/software/ChannelSoftwareHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTowNDo0NlrOHo2ibw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoyNDo0N1rOHo7-Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5ODYzOQ==", "bodyText": "Is there any good reason to call this with false in future? Will true break the functionality under some conditions?\nIf true should work in general, we should just do it always and do not implement an extra function.", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512598639", "createdAt": "2020-10-27T11:04:46Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/channel/software/ChannelSoftwareHandler.java", "diffHunk": "@@ -2331,6 +2331,32 @@ private void channelAdminPermCheck(User loggedInUser) {\n      */\n     public Object[] mergePackages(User loggedInUser, String mergeFromLabel,\n             String mergeToLabel) {\n+        return mergePackages(loggedInUser, mergeFromLabel, mergeToLabel, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY1ODU2Nw==", "bodyText": "This is a bit tricky topic, but I'd say it shouldn't be a default behavior. I think, that in situations when user wants to merge 1 package from a modular channel into another one, it does not make sense to align the modular metadata (unless user really wants it, in which case they can use the boolean parameter). In any case, using mergePackages on modular channels can be somewhat risky: let's say that both source and target channels have incompatible modular data. Blindly aligning the modular data could break the target channel...\n\nWhat about cloneByDate tool?\n\nThis tool uses CloneChannelCommand in the end -> the modular metadata is cloned as well. Next question would be: is the modular repodata valid if the target channel only contains subset packages of the source? I think using this tool for modular channels can bring some funky results.", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512658567", "createdAt": "2020-10-27T12:41:10Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/channel/software/ChannelSoftwareHandler.java", "diffHunk": "@@ -2331,6 +2331,32 @@ private void channelAdminPermCheck(User loggedInUser) {\n      */\n     public Object[] mergePackages(User loggedInUser, String mergeFromLabel,\n             String mergeToLabel) {\n+        return mergePackages(loggedInUser, mergeFromLabel, mergeToLabel, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5ODYzOQ=="}, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NzYyNg==", "bodyText": "Ok, I just wanted to double check if this is really needed.\nAbout CloneByDate: should we prevent using this tool for modular channels? Should we document that it would be better to not use it?", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512687626", "createdAt": "2020-10-27T13:24:47Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/channel/software/ChannelSoftwareHandler.java", "diffHunk": "@@ -2331,6 +2331,32 @@ private void channelAdminPermCheck(User loggedInUser) {\n      */\n     public Object[] mergePackages(User loggedInUser, String mergeFromLabel,\n             String mergeToLabel) {\n+        return mergePackages(loggedInUser, mergeFromLabel, mergeToLabel, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5ODYzOQ=="}, "originalCommit": {"oid": "59587ad3da951f41ea63f8f4238f7000c71c8237"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTg1MDA0OnYy", "diffSide": "RIGHT", "path": "java/code/src/com/redhat/rhn/manager/contentmgmt/test/ContentManagerChannelAlignmentTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTozNDoyNVrOHo3oAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo0MTo1MVrOHo6OOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxNjQ1MA==", "bodyText": "There are some unused imports in this one, and maybe in some other test classes as well", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512616450", "createdAt": "2020-10-27T11:34:25Z", "author": {"login": "cbbayburt"}, "path": "java/code/src/com/redhat/rhn/manager/contentmgmt/test/ContentManagerChannelAlignmentTest.java", "diffHunk": "@@ -22,13 +22,15 @@\n import static com.redhat.rhn.domain.role.RoleFactory.ORG_ADMIN;\n import static java.util.Collections.emptyList;\n import static java.util.Collections.singleton;\n+import static java.util.Optional.empty;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a3112f2acd245a473d1dc9371503fac5210cda0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY1OTAwMA==", "bodyText": "I'll revisit the tests. Thanks for reminding!", "url": "https://github.com/uyuni-project/uyuni/pull/2745#discussion_r512659000", "createdAt": "2020-10-27T12:41:51Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/manager/contentmgmt/test/ContentManagerChannelAlignmentTest.java", "diffHunk": "@@ -22,13 +22,15 @@\n import static com.redhat.rhn.domain.role.RoleFactory.ORG_ADMIN;\n import static java.util.Collections.emptyList;\n import static java.util.Collections.singleton;\n+import static java.util.Optional.empty;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxNjQ1MA=="}, "originalCommit": {"oid": "3a3112f2acd245a473d1dc9371503fac5210cda0"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3965, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}