{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MDI3MzU2", "number": 2352, "title": "Optimize Salt and DB calls in virtualization guests and pools pages", "bodyText": "What does this PR change?\nAs of today the Guests and Pools virtualization pages are refreshing every 5s and thus issuing calls to the DB and Salt minion to get the data they need.\nThis PR removes the periodic refresh and only refreshes when a virtualization event is triggered.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: no difference\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: hard to test features involving websockets\n\n\n DONE\n\n\nLinks\nRequires openSUSE/salt#248 in the KVM Salt minion\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-06-24T07:49:47Z", "url": "https://github.com/uyuni-project/uyuni/pull/2352", "merged": true, "mergeCommit": {"oid": "b7f3168f6d28fa2a26ed700090efc40ffe324fa7"}, "closed": true, "closedAt": "2020-07-17T17:12:12Z", "author": {"login": "cbosdo"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuW53hgBqjM0NzY3MDI4MTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1ud95ABqjM1NTY3MDY3MDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e36fdc85f22b8312ce9d60b11aadb240032cb282", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e36fdc85f22b8312ce9d60b11aadb240032cb282", "committedDate": "2020-06-24T07:18:42Z", "message": "Update changelogs"}, "afterCommit": {"oid": "3c654f92dd7f3b376e5d6470b4e1bd16fcbbf775", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3c654f92dd7f3b376e5d6470b4e1bd16fcbbf775", "committedDate": "2020-06-24T09:47:32Z", "message": "Update changelogs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c654f92dd7f3b376e5d6470b4e1bd16fcbbf775", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3c654f92dd7f3b376e5d6470b4e1bd16fcbbf775", "committedDate": "2020-06-24T09:47:32Z", "message": "Update changelogs"}, "afterCommit": {"oid": "73a25aa376accd73f5ad74c06474edb620c93f08", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/73a25aa376accd73f5ad74c06474edb620c93f08", "committedDate": "2020-06-24T10:15:58Z", "message": "Update changelogs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzgxOTIy", "url": "https://github.com/uyuni-project/uyuni/pull/2352#pullrequestreview-436781922", "createdAt": "2020-06-24T15:51:06Z", "commit": {"oid": "76f9badb674cf67f1d86217e6592778e11941259"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNTo1MTowN1rOGoYcXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNTo1MTowN1rOGoYcXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk5NjcwMA==", "bodyText": "Can we use a more specific prefix? Something like guest-", "url": "https://github.com/uyuni-project/uyuni/pull/2352#discussion_r444996700", "createdAt": "2020-06-24T15:51:07Z", "author": {"login": "mbologna"}, "path": "java/code/src/com/redhat/rhn/domain/action/virtualization/BaseVirtualizationGuestAction.java", "diffHunk": "@@ -54,4 +55,12 @@ public void extractParameters(Map context) {\n         // therefore does nothing.\n     }\n \n+    @Override\n+    public String getWebSocketActionId() {\n+        String id = \"new-\" + getId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76f9badb674cf67f1d86217e6592778e11941259"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Nzg0MjI5", "url": "https://github.com/uyuni-project/uyuni/pull/2352#pullrequestreview-436784229", "createdAt": "2020-06-24T15:53:46Z", "commit": {"oid": "73a25aa376accd73f5ad74c06474edb620c93f08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73a25aa376accd73f5ad74c06474edb620c93f08", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/73a25aa376accd73f5ad74c06474edb620c93f08", "committedDate": "2020-06-24T10:15:58Z", "message": "Update changelogs"}, "afterCommit": {"oid": "2730abc0f5fa8afa00b8be1b782edc15647ef0f4", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2730abc0f5fa8afa00b8be1b782edc15647ef0f4", "committedDate": "2020-06-26T15:21:17Z", "message": "Update changelogs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2730abc0f5fa8afa00b8be1b782edc15647ef0f4", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2730abc0f5fa8afa00b8be1b782edc15647ef0f4", "committedDate": "2020-06-26T15:21:17Z", "message": "Update changelogs"}, "afterCommit": {"oid": "2ae6536958341d200c57558d871a0c8e9a8a4e0c", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2ae6536958341d200c57558d871a0c8e9a8a4e0c", "committedDate": "2020-06-29T08:16:18Z", "message": "Update changelogs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ae6536958341d200c57558d871a0c8e9a8a4e0c", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2ae6536958341d200c57558d871a0c8e9a8a4e0c", "committedDate": "2020-06-29T08:16:18Z", "message": "Update changelogs"}, "afterCommit": {"oid": "3b17c628bab66d7cd6760e2fc5c1e54ab2ca74e9", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3b17c628bab66d7cd6760e2fc5c1e54ab2ca74e9", "committedDate": "2020-06-29T09:46:49Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b17c628bab66d7cd6760e2fc5c1e54ab2ca74e9", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3b17c628bab66d7cd6760e2fc5c1e54ab2ca74e9", "committedDate": "2020-06-29T09:46:49Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "2b0bf8601a8b34ff3c2f38f784ee58b9f2bbfa98", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2b0bf8601a8b34ff3c2f38f784ee58b9f2bbfa98", "committedDate": "2020-06-29T15:01:38Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b0bf8601a8b34ff3c2f38f784ee58b9f2bbfa98", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2b0bf8601a8b34ff3c2f38f784ee58b9f2bbfa98", "committedDate": "2020-06-29T15:01:38Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "6fde8b189372ecf21314c591f3cab761ccc923a1", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6fde8b189372ecf21314c591f3cab761ccc923a1", "committedDate": "2020-07-03T13:25:13Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fde8b189372ecf21314c591f3cab761ccc923a1", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6fde8b189372ecf21314c591f3cab761ccc923a1", "committedDate": "2020-07-03T13:25:13Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "36b097394649618c76fb611a7db9c4e922946686", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/36b097394649618c76fb611a7db9c4e922946686", "committedDate": "2020-07-06T13:25:45Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36b097394649618c76fb611a7db9c4e922946686", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/36b097394649618c76fb611a7db9c4e922946686", "committedDate": "2020-07-06T13:25:45Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "b2718d33ce86b75291725c4a2724f956ce200500", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b2718d33ce86b75291725c4a2724f956ce200500", "committedDate": "2020-07-06T14:58:17Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2718d33ce86b75291725c4a2724f956ce200500", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b2718d33ce86b75291725c4a2724f956ce200500", "committedDate": "2020-07-06T14:58:17Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "ceff02d3a14b2b75a2dfd32d52a5ba36043f8fd7", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ceff02d3a14b2b75a2dfd32d52a5ba36043f8fd7", "committedDate": "2020-07-09T13:24:46Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ceff02d3a14b2b75a2dfd32d52a5ba36043f8fd7", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ceff02d3a14b2b75a2dfd32d52a5ba36043f8fd7", "committedDate": "2020-07-09T13:24:46Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "a390e4e38422cb82796df92456203195331e6a6e", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a390e4e38422cb82796df92456203195331e6a6e", "committedDate": "2020-07-09T15:01:32Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a390e4e38422cb82796df92456203195331e6a6e", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a390e4e38422cb82796df92456203195331e6a6e", "committedDate": "2020-07-09T15:01:32Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "d8f89e0c179bce57d2e982387f5b24fe51e36f16", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d8f89e0c179bce57d2e982387f5b24fe51e36f16", "committedDate": "2020-07-10T11:58:45Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014c80aa6f0549e964d3a67c0897b325eddc2a72", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/014c80aa6f0549e964d3a67c0897b325eddc2a72", "committedDate": "2020-07-17T07:10:48Z", "message": "Rename the virtual guest actions to *VirtualizationGuest*\n\nIn order to clearly reflect what the classes are acting on, add\nGuest to the action classname."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb6fa1d70f407eb8869887d4df8ff6b76563ffe", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/cfb6fa1d70f407eb8869887d4df8ff6b76563ffe", "committedDate": "2020-07-17T07:10:48Z", "message": "VirtNotifications: move ID calculation to the action class\n\nUse inheritance to compute the action id to send via the websocket\nrather than an ungly classname-based map."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "939211b9cda7ec8eee17688c3650ce3462b2ee95", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/939211b9cda7ec8eee17688c3650ce3462b2ee95", "committedDate": "2020-07-17T07:10:48Z", "message": "virt guests: trigger refresh only when getting a websocket event\n\nTo avoid polling the DB and Salt minion every 5s while the page is\nopened, move to an event based refresh."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff880086d911563f4025ca18fd935d190e209677", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ff880086d911563f4025ca18fd935d190e209677", "committedDate": "2020-07-17T07:10:48Z", "message": "virt pools: trigger refresh only when getting a websocket event\n\nTo avoid polling the DB and Salt minion every 5s while the page is\nopened, move to an event based refresh."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34789d2f2a2fdcdaa7408b98394f43066164a379", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/34789d2f2a2fdcdaa7408b98394f43066164a379", "committedDate": "2020-07-17T07:10:48Z", "message": "Move the transaction in the AbstractLibvirtEngineMessage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62c9603599c26fcdd18a26c1479f2575dd104f6d", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/62c9603599c26fcdd18a26c1479f2575dd104f6d", "committedDate": "2020-07-17T07:10:48Z", "message": "Handle virtual storage pool events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79039b327fafbad54742480f40cb9aec27e97895", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/79039b327fafbad54742480f40cb9aec27e97895", "committedDate": "2020-07-17T07:10:48Z", "message": "Notify VM state changes to virt WebSocket\n\nA virtualization action being completed doesn't mean the virtual machine\nor storage was actually started, stopped, etc. Notify the\nVirt WebSocket when the virtpoller detects changes or when libvirt\nevents are received so that the UI can refresh after any libvirt change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfabe39d5b4471b3a36235a80b1e94c7c34f18fc", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bfabe39d5b4471b3a36235a80b1e94c7c34f18fc", "committedDate": "2020-07-17T07:11:30Z", "message": "Update changelogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c6778b5e019556fcb90e7a4d60acf18c5bf9104", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8c6778b5e019556fcb90e7a4d60acf18c5bf9104", "committedDate": "2020-07-17T07:12:00Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8f89e0c179bce57d2e982387f5b24fe51e36f16", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d8f89e0c179bce57d2e982387f5b24fe51e36f16", "committedDate": "2020-07-10T11:58:45Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}, "afterCommit": {"oid": "8c6778b5e019556fcb90e7a4d60acf18c5bf9104", "author": {"user": {"login": "cbosdo", "name": "Cedric Bosdonnat"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8c6778b5e019556fcb90e7a4d60acf18c5bf9104", "committedDate": "2020-07-17T07:12:00Z", "message": "Refresh virtual storage pool after deleting a volume\n\nLibvirt doesn't report any event when a volume has been deleted from a\npool. In order to refresh the UI automatically when triggering a delete\naction, force a pool refresh too."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1165, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}