{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMjI4NDM3", "number": 1856, "title": "Testsuite - accessing element to trigger DOM refresh", "bodyText": "What does this PR change?\nReplacement of #1839 after further investigation. Additional delay caused by puts doesn't solve the issue. Accessing DOM does, so there is no need to keep these debug outputs.\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-02-03T10:05:57Z", "url": "https://github.com/uyuni-project/uyuni/pull/1856", "merged": true, "mergeCommit": {"oid": "3a2fe4bdb550753e422baa56ddd5d19a6aa149c4"}, "closed": true, "closedAt": "2020-02-04T09:29:14Z", "author": {"login": "lkotek"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAqbHpgFqTM1MjE1NTM2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA9q0wAFqTM1MjgwOTAxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMTU1MzYz", "url": "https://github.com/uyuni-project/uyuni/pull/1856#pullrequestreview-352155363", "createdAt": "2020-02-03T10:31:42Z", "commit": {"oid": "9087cc4b55a91d7b18771cf5f9834ffb053bc166"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDozMTo0M1rOFkszMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDozMTo0M1rOFkszMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyNzA1Ng==", "bodyText": "Could it be the first assignment (the one with the comment) is enough, and we do not need the other two?\nAfter all, if the problem is to force access to DOM tree, once is enough, isn't it?", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374027056", "createdAt": "2020-02-03T10:31:43Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,14 +271,16 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  _inner_element = find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+    _inner_element = find('#chooseFormulas')['innerHTML']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9087cc4b55a91d7b18771cf5f9834ffb053bc166"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a4063c1d427518ca398ab26cc46871557adeb71", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/5a4063c1d427518ca398ab26cc46871557adeb71", "committedDate": "2020-02-03T11:30:50Z", "message": "review fixes"}, "afterCommit": {"oid": "e62bda984ea6686a6146cc153c83dc9c71544f9c", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/e62bda984ea6686a6146cc153c83dc9c71544f9c", "committedDate": "2020-02-03T11:33:33Z", "message": "accessing element to trigger DOM refresh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMTk3MDg1", "url": "https://github.com/uyuni-project/uyuni/pull/1856#pullrequestreview-352197085", "createdAt": "2020-02-03T11:47:27Z", "commit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMTo0NzoyN1rOFkuxBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMTo0NzoyN1rOFkuxBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTI2OA==", "bodyText": "Interesting, I thought that rubocop complains if we don't add a newline after a raise.", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374059268", "createdAt": "2020-02-03T11:47:27Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless find(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).click\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMTk3NTky", "url": "https://github.com/uyuni-project/uyuni/pull/1856#pullrequestreview-352197592", "createdAt": "2020-02-03T11:48:29Z", "commit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMTo0ODoyOVrOFkuyhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMTo0ODoyOVrOFkuyhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTY1NA==", "bodyText": "We can get rid of that one, as we are already acting through it later on.", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374059654", "createdAt": "2020-02-03T11:48:29Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjE2OTU1", "url": "https://github.com/uyuni-project/uyuni/pull/1856#pullrequestreview-352216955", "createdAt": "2020-02-03T12:27:01Z", "commit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMjoyNzowMlrOFkvsuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMjoyODoxNVrOFkvuwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3NDU1Mw==", "bodyText": "Remove the `if find(#chooseFormulas) i.e. revert to original code", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374074553", "createdAt": "2020-02-03T12:27:02Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless find(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).click\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTI2OA=="}, "originalCommit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3NTA3Mg==", "bodyText": "Remove the `if find(#chooseFormulas) i.e. revert to original code", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374075072", "createdAt": "2020-02-03T12:28:15Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless find(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).click\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    \n+    element.click   \n   else\n     xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'check'\n     xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'uncheck'\n-    puts \"Selected formulas [else]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90b9685846397f7f3e5e9b8d8bc8078c6a437085"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjkyNzQ5", "url": "https://github.com/uyuni-project/uyuni/pull/1856#pullrequestreview-352292749", "createdAt": "2020-02-03T14:29:03Z", "commit": {"oid": "e35d49f265b59d380421386d89b8d5c953b28eb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e35d49f265b59d380421386d89b8d5c953b28eb8", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/e35d49f265b59d380421386d89b8d5c953b28eb8", "committedDate": "2020-02-03T12:56:44Z", "message": "reintroduction of previous exception raise"}, "afterCommit": {"oid": "cd24b37f0bd3f34604d8458779617026872ed356", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/cd24b37f0bd3f34604d8458779617026872ed356", "committedDate": "2020-02-03T15:01:28Z", "message": "reintroduction of previous exception raise"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "committedDate": "2020-02-04T08:39:04Z", "message": "accessing element to trigger DOM refresh"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e546f077d1540488215111e19557dbc40c34238", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/5e546f077d1540488215111e19557dbc40c34238", "committedDate": "2020-02-03T16:01:03Z", "message": "comment added"}, "afterCommit": {"oid": "ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "author": {"user": null}, "url": "https://github.com/uyuni-project/uyuni/commit/ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "committedDate": "2020-02-04T08:39:04Z", "message": "accessing element to trigger DOM refresh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODA5MDEx", "url": "https://github.com/uyuni-project/uyuni/pull/1856#pullrequestreview-352809011", "createdAt": "2020-02-04T08:57:04Z", "commit": {"oid": "ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1771, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}