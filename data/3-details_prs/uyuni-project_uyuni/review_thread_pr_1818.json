{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzI1NjE3", "number": 1818, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozMzoxMVrODZv3rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODo0Mjo0NVrODZwBkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MzI1Mjk0OnYy", "diffSide": "RIGHT", "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozMzoxMVrOFgT5Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozMzoxMVrOFgT5Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNDc0Mg==", "bodyText": "salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2')\nSo it works with both SLE15 and SLE12:\nSLE-Module-Python2_15-SP1_x86_64/_channel:    <binary name=\"python2-Jinja2\" package=\"python-Jinja2\" supportstatus=\"l3\"/>\nSLE-Module-Basesystem_15_x86_64/_channel:    <binary name=\"python2-Jinja2\" package=\"python-Jinja2\" supportstatus=\"l3\"/>\nSLE-Manager-Tools_12_x86_64/_channel:    <binary package=\"python-Jinja2\"             name=\"python-Jinja2\"                    supportstatus=\"l3\"/>", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369424742", "createdAt": "2020-01-22T08:33:11Z", "author": {"login": "juliogonzalez"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MzI3ODI2OnYy", "diffSide": "RIGHT", "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODo0Mjo0NVrOFgUI6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDoyOToxNFrOFgXR1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ==", "bodyText": "performance: maybe it's faster to do a series of nested {% ifs (I'm not sure that jinja short-circuits boolean expressions)\nother possibility: pkg.info_available takes several arguments. Are they joined with a OR or a AND? If it's a AND, you could list all packages in one single call\n\nMy 2 cents", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369428715", "createdAt": "2020-01-22T08:42:45Z", "author": {"login": "Bischoff"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzMDQ1NQ==", "bodyText": "Seems to behave as an OR:\njuliogonzalez@juliogonzalez:~/Documents/development/obs/suse/Devel:Galaxy:Manager:Head/salt$ sudo salt-call --local pkg.info_available python pythonblah\nlocal:\n    ----------\n    python:\n        ----------\n        arch:\n            x86_64\n        installed:\n            True\n        installed size:\n            1.4 MiB\n        repository:\n            openSUSE-Leap-15.1-Update\n        source package:\n            python-2.7.14-lp151.10.13.1.src\n        status:\n            up-to-date\n        summary:\n            Python Interpreter\n        vendor:\n            openSUSE\n        version:\n            2.7.14-lp151.10.13.1\njuliogonzalez@juliogonzalez:~/Documents/development/obs/suse/Devel:Galaxy:Manager:Head/salt$ echo $?\n0", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369430455", "createdAt": "2020-01-22T08:46:50Z", "author": {"login": "juliogonzalez"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzMjI2OQ==", "bodyText": "Apparently it's a OR, so you can forget second suggestion", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369432269", "createdAt": "2020-01-22T08:51:26Z", "author": {"login": "Bischoff"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNDQ0MA==", "bodyText": "As for the if even if jinja doesn't short-circuits boolean expressions, I think having nested ifs make things easier to understand. Will change it.", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369434440", "createdAt": "2020-01-22T08:56:25Z", "author": {"login": "juliogonzalez"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNjgyOQ==", "bodyText": "After trying, nesting seems to things harder to understand, so let's keep it as it is.", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369436829", "createdAt": "2020-01-22T09:01:53Z", "author": {"login": "juliogonzalez"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ3ODExNg==", "bodyText": "I think the interpreter should evaluate the first statement and only if this is true the next statement is executed. So I would suggest to put the Jinja test first.", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369478116", "createdAt": "2020-01-22T10:25:32Z", "author": {"login": "mcalmer"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ4MDE0OA==", "bodyText": "Sorry, didn't notice the comment in time.\nI will issue a new PR and merge it right away.", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369480148", "createdAt": "2020-01-22T10:29:14Z", "author": {"login": "juliogonzalez"}, "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, "originalCommit": {"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 218, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}