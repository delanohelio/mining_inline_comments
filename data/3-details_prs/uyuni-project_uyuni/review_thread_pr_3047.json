{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNTE0Mzg2", "number": 3047, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NDozMlrOFIGHZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NTowMlrOFIGIAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MDMzMTI1OnYy", "diffSide": "RIGHT", "path": "backend/server/importlib/backend.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NDozMlrOIJ1LnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NDozMlrOIJ1LnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTQyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       LEFT JOIN rhnPackageExtraTagKey ON rhnPackageExtraTagKey.name = wanted.name\n          \n          \n            \n                                LEFT JOIN rhnPackageExtraTagKey ON rhnPackageExtraTagKey.name = wanted.name", "url": "https://github.com/uyuni-project/uyuni/pull/3047#discussion_r547179421", "createdAt": "2020-12-22T09:54:32Z", "author": {"login": "moio"}, "path": "backend/server/importlib/backend.py", "diffHunk": "@@ -299,40 +298,40 @@ def processCVEs(self, cveHash):\n         h.executemany(id=toinsert[0], name=toinsert[1])\n \n     def processExtraTags(self, extraTags):\n-        query_lookup = \"\"\"\n-            SELECT id\n-              FROM rhnPackageExtraTagKey\n-             WHERE name = :name\n+        if not extraTags:\n+            return\n+        sql = \"\"\"\n+            WITH wanted (name) AS (\n+              VALUES %s\n+            )\n+            missing AS (\n+              SELECT nextval('rhn_package_extra_tags_keys_id_seq') AS id, wanted.name\n+                FROM wanted\n+           LEFT JOIN rhnPackageExtraTagKey ON rhnPackageExtraTagKey.name = wanted.name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f38dcfb05e99b85acc67520911619242de4a3aa"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MDMzMjMwOnYy", "diffSide": "RIGHT", "path": "backend/server/importlib/backend.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NDo1MVrOIJ1MNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NDo1MVrOIJ1MNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTU3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        SELECT * from missing\n          \n          \n            \n                            SELECT * from missing", "url": "https://github.com/uyuni-project/uyuni/pull/3047#discussion_r547179574", "createdAt": "2020-12-22T09:54:51Z", "author": {"login": "moio"}, "path": "backend/server/importlib/backend.py", "diffHunk": "@@ -299,40 +298,40 @@ def processCVEs(self, cveHash):\n         h.executemany(id=toinsert[0], name=toinsert[1])\n \n     def processExtraTags(self, extraTags):\n-        query_lookup = \"\"\"\n-            SELECT id\n-              FROM rhnPackageExtraTagKey\n-             WHERE name = :name\n+        if not extraTags:\n+            return\n+        sql = \"\"\"\n+            WITH wanted (name) AS (\n+              VALUES %s\n+            )\n+            missing AS (\n+              SELECT nextval('rhn_package_extra_tags_keys_id_seq') AS id, wanted.name\n+                FROM wanted\n+           LEFT JOIN rhnPackageExtraTagKey ON rhnPackageExtraTagKey.name = wanted.name\n+               WHERE rhnPackageExtraTagKey.id IS NULL\n+            )\n+            INSERT INTO rhnPackageExtraTagKey (id, name)\n+            SELECT * from missing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f38dcfb05e99b85acc67520911619242de4a3aa"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MDMzMjgzOnYy", "diffSide": "RIGHT", "path": "backend/server/importlib/backend.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NTowMlrOIJ1MlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NTowMlrOIJ1MlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTY2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        ON CONFLICT DO NOTHING\n          \n          \n            \n                            ON CONFLICT DO NOTHING", "url": "https://github.com/uyuni-project/uyuni/pull/3047#discussion_r547179668", "createdAt": "2020-12-22T09:55:02Z", "author": {"login": "moio"}, "path": "backend/server/importlib/backend.py", "diffHunk": "@@ -299,40 +298,40 @@ def processCVEs(self, cveHash):\n         h.executemany(id=toinsert[0], name=toinsert[1])\n \n     def processExtraTags(self, extraTags):\n-        query_lookup = \"\"\"\n-            SELECT id\n-              FROM rhnPackageExtraTagKey\n-             WHERE name = :name\n+        if not extraTags:\n+            return\n+        sql = \"\"\"\n+            WITH wanted (name) AS (\n+              VALUES %s\n+            )\n+            missing AS (\n+              SELECT nextval('rhn_package_extra_tags_keys_id_seq') AS id, wanted.name\n+                FROM wanted\n+           LEFT JOIN rhnPackageExtraTagKey ON rhnPackageExtraTagKey.name = wanted.name\n+               WHERE rhnPackageExtraTagKey.id IS NULL\n+            )\n+            INSERT INTO rhnPackageExtraTagKey (id, name)\n+            SELECT * from missing\n+            ON CONFLICT DO NOTHING", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f38dcfb05e99b85acc67520911619242de4a3aa"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3819, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}