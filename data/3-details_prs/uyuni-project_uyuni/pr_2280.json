{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MzIzNjA5", "number": 2280, "title": "Drop unpublished errata functionality (Web UI)", "bodyText": "What does this PR change?\nBackground\nThis PR adds patches on top of #2296 to also drop functionality from the UI relative to displaying, looking up and creating unpublished patches. Both PRs will be merged at the same time when approved.\nPlease refer to #2296 for background information.\nContents of this PR\n\ndrop the unpublished patch ACL\nchange the UI for creating a new patch. Before this PR any new patch was first created unpublished and then published in a second step, this patch allows to create published patch directly\nchange the UI for cloning an patch. Before this PR any newly cloned patch was first created unpublished and then published in a second step, this patch allows to clone and publish in one step\nremove the unpublished patch list link from the menu\nadapt tests\n\nGUI diff\nMenu\nBefore:\n\nAfter:\n\nCreation of patch\nBefore:\n\nAfter:\n\n(top of form is identical until \"Notes\" - only the channel list is added)\nCloning of patch (confirm screen)\nThe selection of patches is identical. After clicking on \"Clone\" the confirm screen changes per below.\nBefore:\n\nAfter:\n\n\n DONE\n\nDocumentation\n\n\nDocumentation PR\n\n\n DONE\n\n\nTest coverage\n\n\nUnit tests were adapted\n\n\nCucumber tests were adapted\n\n\n DONE\n\n\nLinks\nPartially addressing SUSE/spacewalk#11548\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-06-03T16:35:54Z", "url": "https://github.com/uyuni-project/uyuni/pull/2280", "merged": true, "mergeCommit": {"oid": "6ac319731e301e37ca00233165df051ee77904d7"}, "closed": true, "closedAt": "2020-06-08T15:59:17Z", "author": {"login": "moio"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoZIwxgBqjM0MTMyNTU4MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpSmmnAH2gAyNDI3MzIzNjA5OmY1ZjI1MzU4MjMyM2I2ZWIwOGM4MTc1OGRkNWZlMzg0NzY0ZmE1MzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bed7dd3bb30251b5c8745b1601871d24eb80b12", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4bed7dd3bb30251b5c8745b1601871d24eb80b12", "committedDate": "2020-06-03T16:25:17Z", "message": "Drop errata_is_published ACL"}, "afterCommit": {"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3de78fcc64ae72761bc59ab4311b87b45aa2e865", "committedDate": "2020-06-05T20:59:54Z", "message": "Clone patches as published in the UI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjQ3ODMw", "url": "https://github.com/uyuni-project/uyuni/pull/2280#pullrequestreview-425647830", "createdAt": "2020-06-05T21:55:22Z", "commit": {"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjU4MDY3", "url": "https://github.com/uyuni-project/uyuni/pull/2280#pullrequestreview-425658067", "createdAt": "2020-06-05T22:14:53Z", "commit": {"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODE3NTUw", "url": "https://github.com/uyuni-project/uyuni/pull/2280#pullrequestreview-425817550", "createdAt": "2020-06-07T12:55:06Z", "commit": {"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDQ3MzMz", "url": "https://github.com/uyuni-project/uyuni/pull/2280#pullrequestreview-426047333", "createdAt": "2020-06-08T09:13:03Z", "commit": {"oid": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2"}, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOToxMzowM1rOGgVbtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOToyNjoyNVrOGgV4tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1ODc3NA==", "bodyText": "makes sense to use com.redhat.rhn.frontend.struts.RequestContext.ERRATA_ID here as well", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436558774", "createdAt": "2020-06-08T09:13:03Z", "author": {"login": "chiaradiamarcelo"}, "path": "java/code/src/com/redhat/rhn/frontend/action/errata/ChannelAction.java", "diffHunk": "@@ -246,18 +246,20 @@ protected void processMethodKeys(Map<String, String> map) {\n      * {@inheritDoc}\n      * Add eid to our parameter map\n      */\n-    protected void processParamMap(ActionForm formIn,\n+    public void processParamMap(ActionForm formIn,\n                                    HttpServletRequest request,\n                                    Map<String, Object> params) {\n         //keep eid in params\n-        Long eid = new RequestContext(request).getRequiredParam(\"eid\");\n+        Long eid = new RequestContext(request).getParamAsLong(\"eid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1ODg2Nw==", "bodyText": "same here", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436558867", "createdAt": "2020-06-08T09:13:15Z", "author": {"login": "chiaradiamarcelo"}, "path": "java/code/src/com/redhat/rhn/frontend/action/errata/ChannelAction.java", "diffHunk": "@@ -246,18 +246,20 @@ protected void processMethodKeys(Map<String, String> map) {\n      * {@inheritDoc}\n      * Add eid to our parameter map\n      */\n-    protected void processParamMap(ActionForm formIn,\n+    public void processParamMap(ActionForm formIn,\n                                    HttpServletRequest request,\n                                    Map<String, Object> params) {\n         //keep eid in params\n-        Long eid = new RequestContext(request).getRequiredParam(\"eid\");\n+        Long eid = new RequestContext(request).getParamAsLong(\"eid\");\n+        if (eid != null) {\n+            params.put(\"eid\", eid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1OTk0Mg==", "bodyText": "might make sense to return an optional here if Errata can be null. Maybe for a next PR", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436559942", "createdAt": "2020-06-08T09:15:14Z", "author": {"login": "chiaradiamarcelo"}, "path": "java/code/src/com/redhat/rhn/frontend/action/errata/ChannelSetupAction.java", "diffHunk": "@@ -65,7 +68,8 @@ public ActionForward execute(ActionMapping mapping,\n         clampListBounds(pc, request, user);\n \n         //Get the errata object\n-        Errata e = requestContext.lookupErratum();\n+        Long errataId = requestContext.getParamAsLong(ERRATA_ID);\n+        Errata e = ErrataManager.lookupErrata(errataId, requestContext.getCurrentUser());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2Mzk2MA==", "bodyText": "is the whole concept of \"publishing an errata\" still valid? can it be an errata in another state that is \"not published\"?\nshouldn't we do this as part of the creation of the errata?", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436563960", "createdAt": "2020-06-08T09:22:12Z", "author": {"login": "chiaradiamarcelo"}, "path": "java/code/src/com/redhat/rhn/frontend/action/errata/CreateAction.java", "diffHunk": "@@ -134,6 +148,7 @@ public ActionForward execute(ActionMapping mapping,\n         e.setOrg(user.getOrg());\n \n         ErrataManager.storeErrata(e);\n+        ErrataManager.publish(e, channelAction.getChannelIdsFromRhnSet(set), user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2NTA1NQ==", "bodyText": "Should we still use the \"publish\" word in the UI? to me it gives some sense of \"an errata can be in another state than 'published'\"", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436565055", "createdAt": "2020-06-08T09:24:14Z", "author": {"login": "chiaradiamarcelo"}, "path": "java/code/src/com/redhat/rhn/frontend/strings/jsp/StringResource_en_US.xml", "diffHunk": "@@ -3384,7 +3384,7 @@ button below, and &lt;b&gt;will be unable to log back in&lt;/b&gt;.</source>\n         </context-group>\n       </trans-unit>\n       <trans-unit id=\"errata.publish.nochannelsselected\">\n-        <source>A published patch must belong to at least one channel.</source>\n+        <source>At least one channel must be selected for publishing.</source>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2NjE5Nw==", "bodyText": "same here. I would remove the the \"publish\":\n\"The patches listed here will be cloned in the channels selected below. Once they are cloned, they will appear in each channel's patch list.\"", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436566197", "createdAt": "2020-06-08T09:26:25Z", "author": {"login": "chiaradiamarcelo"}, "path": "java/code/src/com/redhat/rhn/frontend/strings/jsp/StringResource_en_US.xml", "diffHunk": "@@ -7191,7 +7191,7 @@ organization management tools if you choose to remove this role from your login.\n         </context-group>\n       </trans-unit>\n       <trans-unit id=\"cloneconfirm.jsp.pagesummary\">\n-        <source>The patches listed below will be cloned. Once they are cloned, they will appear in your &lt;a href=&quot;{0}&quot;&gt;unpublished patches list&lt;/a&gt;. From there you can verify the text and associated packages for each patch. Once you are ready, you can publish the patches so they are available to users in your organization.</source>\n+        <source>The patches listed here will be cloned and published in the channels selected below. Once they are cloned, they will appear in each channel's patch list.</source>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3de78fcc64ae72761bc59ab4311b87b45aa2e865", "committedDate": "2020-06-05T20:59:54Z", "message": "Clone patches as published in the UI"}, "afterCommit": {"oid": "75fcb39d0bb037ce1ccc0979899024cb714051e2", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/75fcb39d0bb037ce1ccc0979899024cb714051e2", "committedDate": "2020-06-08T13:57:39Z", "message": "Bugfix: fallback did not work in all cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Mjg4ODgx", "url": "https://github.com/uyuni-project/uyuni/pull/2280#pullrequestreview-426288881", "createdAt": "2020-06-08T14:17:46Z", "commit": {"oid": "75fcb39d0bb037ce1ccc0979899024cb714051e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75fcb39d0bb037ce1ccc0979899024cb714051e2", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/75fcb39d0bb037ce1ccc0979899024cb714051e2", "committedDate": "2020-06-08T13:57:39Z", "message": "Bugfix: fallback did not work in all cases"}, "afterCommit": {"oid": "33eba668b7dd94979c39c6efd64c9e29798ee4b3", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/33eba668b7dd94979c39c6efd64c9e29798ee4b3", "committedDate": "2020-06-08T14:51:57Z", "message": "Bugfix: fallback did not work in all cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88f8eb18c11c4e37405c8a8c18adca061ec6494d", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/88f8eb18c11c4e37405c8a8c18adca061ec6494d", "committedDate": "2020-06-08T15:15:41Z", "message": "Drop errata_is_published ACL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74e3ea0384f70ad203901ffa5bec18342e6a629b", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/74e3ea0384f70ad203901ffa5bec18342e6a629b", "committedDate": "2020-06-08T15:15:41Z", "message": "Allow to create published patches in the UI\n\nPreviously, any patch had to be created unpublished first, and then\npublished to channels. This patch allows to create published patches\nright away."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9c8fe5f6c2250c958abb520c3452b45835ba342", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b9c8fe5f6c2250c958abb520c3452b45835ba342", "committedDate": "2020-06-08T15:15:41Z", "message": "Remove unpublished errata from menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2c4256b63f8117889ddc1264c8e88968dccbd5f", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c2c4256b63f8117889ddc1264c8e88968dccbd5f", "committedDate": "2020-06-08T15:15:41Z", "message": "Adapt Cucumber tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcf6fe28710975804d61fd5092c9730ae6990b8a", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/fcf6fe28710975804d61fd5092c9730ae6990b8a", "committedDate": "2020-06-08T15:15:41Z", "message": "Clone patches as published in the UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ff85c8b8d70e615bad7f1f11deb83219bbdea6f", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5ff85c8b8d70e615bad7f1f11deb83219bbdea6f", "committedDate": "2020-06-08T15:15:41Z", "message": "Adapt JUnit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67bfec9757b53c778d87f68613ac3575b9e84276", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/67bfec9757b53c778d87f68613ac3575b9e84276", "committedDate": "2020-06-08T15:15:41Z", "message": "Bugfix: fallback did not work in all cases"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33eba668b7dd94979c39c6efd64c9e29798ee4b3", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/33eba668b7dd94979c39c6efd64c9e29798ee4b3", "committedDate": "2020-06-08T14:51:57Z", "message": "Bugfix: fallback did not work in all cases"}, "afterCommit": {"oid": "67bfec9757b53c778d87f68613ac3575b9e84276", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/67bfec9757b53c778d87f68613ac3575b9e84276", "committedDate": "2020-06-08T15:15:41Z", "message": "Bugfix: fallback did not work in all cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5f253582323b6eb08c81758dd5fe384764fa531", "author": {"user": {"login": "moio", "name": "Silvio Moioli"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f5f253582323b6eb08c81758dd5fe384764fa531", "committedDate": "2020-06-08T15:57:26Z", "message": "Port translations"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1288, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}