{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjQ3NDU0", "number": 2372, "title": "Maintenance schedules system assignment UI", "bodyText": "Adds UI for assigning maintenance schedules to systems.\nTODO\n\n Add an info text to the SSM panel header\n Add \"Schedule\" tab and schedule assignment form to SSM interface\n Add \"Assign Systems\" tab to the schedule details page to pick multiple systems to assign to a specific schedule\n Implement schedule assignment UI in the system properties page\n Add a shortcut link to the SSM summary page\n Move the SSM tab under \"Misc\" > \"Maintenance Windows\"\n Implement server side pagination for the systems list table (SUSE/spacewalk#11895)\n Elaborate the system list with assigned schedule names (SUSE/spacewalk#11895)\n Add confirm dialogs for when canceling affected actions\n Unify the notification messages (toastr or regular)\n Add a flag to cancel affected actions strategies parameter to assignScheduleToSystems XMLRPC endpoint\n Test user/org permissions\n Organize the code structure\n\nGUI diff\nAssignment from schedule details page\n\nAssignment from SSM\n\nCancel affected actions confirmation\n\nAssignment from system properties page\n\nDocumentation\n\nWill be covered as part of the \"Maintenance Windows\" feature\n\nTest coverage\n\nUnit tests were adapted\n\nLinks\nFixes SUSE/spacewalk#11228\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-06-30T19:28:14Z", "url": "https://github.com/uyuni-project/uyuni/pull/2372", "merged": true, "mergeCommit": {"oid": "3a485028298a0109ee656dbc688d729dac404443"}, "closed": true, "closedAt": "2020-07-16T16:14:02Z", "author": {"login": "cbbayburt"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxGiwhABqjM1MDg5MzI1NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1fq7igFqTQ0OTg3NDI4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab00d90046118e0c7917158db7489bfc0ca9ca13", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ab00d90046118e0c7917158db7489bfc0ca9ca13", "committedDate": "2020-06-30T19:05:20Z", "message": "[WIP] Schedule assignment UI"}, "afterCommit": {"oid": "0bfb6f90105d53d811416bc2645b5ef182759fe5", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0bfb6f90105d53d811416bc2645b5ef182759fe5", "committedDate": "2020-07-02T22:23:29Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0bfb6f90105d53d811416bc2645b5ef182759fe5", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0bfb6f90105d53d811416bc2645b5ef182759fe5", "committedDate": "2020-07-02T22:23:29Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "3af64cffde8822641a2f53b0138a431b78983e85", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3af64cffde8822641a2f53b0138a431b78983e85", "committedDate": "2020-07-02T22:49:27Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3af64cffde8822641a2f53b0138a431b78983e85", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3af64cffde8822641a2f53b0138a431b78983e85", "committedDate": "2020-07-02T22:49:27Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "34654eddf4266a4710a3d729b1f993ca324c93ad", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/34654eddf4266a4710a3d729b1f993ca324c93ad", "committedDate": "2020-07-03T00:01:18Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34654eddf4266a4710a3d729b1f993ca324c93ad", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/34654eddf4266a4710a3d729b1f993ca324c93ad", "committedDate": "2020-07-03T00:01:18Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "1e3a88b51504ad877854d8eeac7a23e3eb66ed85", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1e3a88b51504ad877854d8eeac7a23e3eb66ed85", "committedDate": "2020-07-06T16:46:50Z", "message": "fixup! Add maintenance schedule form controls to system properties edit page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e3a88b51504ad877854d8eeac7a23e3eb66ed85", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1e3a88b51504ad877854d8eeac7a23e3eb66ed85", "committedDate": "2020-07-06T16:46:50Z", "message": "fixup! Add maintenance schedule form controls to system properties edit page"}, "afterCommit": {"oid": "4bd7aedfa3dd11b39022b5709d7f567c6e69107d", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4bd7aedfa3dd11b39022b5709d7f567c6e69107d", "committedDate": "2020-07-06T16:48:45Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bd7aedfa3dd11b39022b5709d7f567c6e69107d", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4bd7aedfa3dd11b39022b5709d7f567c6e69107d", "committedDate": "2020-07-06T16:48:45Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "19737707dddee6f7f983d1c7ff21e46084380dde", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/19737707dddee6f7f983d1c7ff21e46084380dde", "committedDate": "2020-07-07T11:13:43Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bdaa7f6dd0a2367a71e4419aef8184c4134c3ba", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/9bdaa7f6dd0a2367a71e4419aef8184c4134c3ba", "committedDate": "2020-07-08T17:28:13Z", "message": "Remove Hibernate rollback when reschedule strategies fail"}, "afterCommit": {"oid": "cffde60a4ac510bde5186882e23122c2c48b5fb9", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/cffde60a4ac510bde5186882e23122c2c48b5fb9", "committedDate": "2020-07-08T18:17:21Z", "message": "Remove Hibernate rollback when reschedule strategies fail"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cffde60a4ac510bde5186882e23122c2c48b5fb9", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/cffde60a4ac510bde5186882e23122c2c48b5fb9", "committedDate": "2020-07-08T18:17:21Z", "message": "Remove Hibernate rollback when reschedule strategies fail"}, "afterCommit": {"oid": "1975f5ef71a23d3d058f8b19ed704e2a2f9c698b", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1975f5ef71a23d3d058f8b19ed704e2a2f9c698b", "committedDate": "2020-07-08T18:30:59Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1975f5ef71a23d3d058f8b19ed704e2a2f9c698b", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1975f5ef71a23d3d058f8b19ed704e2a2f9c698b", "committedDate": "2020-07-08T18:30:59Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "3260e542a9aebef65ef62a035cb58ddcc5ee0468", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3260e542a9aebef65ef62a035cb58ddcc5ee0468", "committedDate": "2020-07-09T11:29:33Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3260e542a9aebef65ef62a035cb58ddcc5ee0468", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3260e542a9aebef65ef62a035cb58ddcc5ee0468", "committedDate": "2020-07-09T11:29:33Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "1dd053988f6b0387b7f4798426b6dbf5a927566a", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1dd053988f6b0387b7f4798426b6dbf5a927566a", "committedDate": "2020-07-09T12:51:14Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDA0OTYx", "url": "https://github.com/uyuni-project/uyuni/pull/2372#pullrequestreview-445404961", "createdAt": "2020-07-09T08:37:25Z", "commit": {"oid": "9ac175aad9370ed21ad4392f823e2526b730f043"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwODo0Njo0M1rOGvHqmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzoxODowMFrOGvQs6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA2MTg1MA==", "bodyText": "Instead of propagating the error message directly, I would prefer to have a custom message that can be translated (I just realized I need to adapt this in one place as well)", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452061850", "createdAt": "2020-07-09T08:46:43Z", "author": {"login": "parlt91"}, "path": "java/code/src/com/suse/manager/webui/controllers/maintenance/MaintenanceScheduleController.java", "diffHunk": "@@ -233,6 +240,59 @@ public static String deleteSchedule(Request request, Response response, User use\n         return json(response, ResultJson.success());\n     }\n \n+    private class SystemAssignmentRequest {\n+        private List<Long> systemIds;\n+        private boolean cancelActions;\n+    }\n+\n+    /**\n+     * Assign a schedule to systems\n+     *\n+     * @param request the request object\n+     * @param response the response obejct\n+     * @param user the authorized user\n+     * @return string containing the JSON response\n+     */\n+    public static String assignSchedule(Request request, Response response, User user) {\n+        response.type(\"application/json\");\n+        SystemAssignmentRequest reqData = GSON.fromJson(request.body(), SystemAssignmentRequest.class);\n+        List<Long> systemIds = reqData.systemIds;\n+\n+        Long scheduleId = Long.parseLong(request.params(\"id\"));\n+        MM.lookupScheduleByUserAndId(user, scheduleId).ifPresentOrElse(\n+                schedule -> {\n+                    try {\n+                        MM.assignScheduleToSystems(user, schedule, new HashSet<>(systemIds), reqData.cancelActions);\n+                    }\n+                    catch (LookupException | IllegalArgumentException e) {\n+                        Spark.halt(HttpStatus.SC_BAD_REQUEST, GSON.toJson(ResultJson.error(e.getMessage())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5baf9023bb2b48acdc8d6ffa1d8f60b2c6e731a"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA2MjAxNQ==", "bodyText": "Same here", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452062015", "createdAt": "2020-07-09T08:46:58Z", "author": {"login": "parlt91"}, "path": "java/code/src/com/suse/manager/webui/controllers/maintenance/MaintenanceScheduleController.java", "diffHunk": "@@ -233,6 +240,59 @@ public static String deleteSchedule(Request request, Response response, User use\n         return json(response, ResultJson.success());\n     }\n \n+    private class SystemAssignmentRequest {\n+        private List<Long> systemIds;\n+        private boolean cancelActions;\n+    }\n+\n+    /**\n+     * Assign a schedule to systems\n+     *\n+     * @param request the request object\n+     * @param response the response obejct\n+     * @param user the authorized user\n+     * @return string containing the JSON response\n+     */\n+    public static String assignSchedule(Request request, Response response, User user) {\n+        response.type(\"application/json\");\n+        SystemAssignmentRequest reqData = GSON.fromJson(request.body(), SystemAssignmentRequest.class);\n+        List<Long> systemIds = reqData.systemIds;\n+\n+        Long scheduleId = Long.parseLong(request.params(\"id\"));\n+        MM.lookupScheduleByUserAndId(user, scheduleId).ifPresentOrElse(\n+                schedule -> {\n+                    try {\n+                        MM.assignScheduleToSystems(user, schedule, new HashSet<>(systemIds), reqData.cancelActions);\n+                    }\n+                    catch (LookupException | IllegalArgumentException e) {\n+                        Spark.halt(HttpStatus.SC_BAD_REQUEST, GSON.toJson(ResultJson.error(e.getMessage())));\n+                    }\n+                },\n+                () -> Spark.halt(HttpStatus.SC_NOT_FOUND)\n+        );\n+        return json(response, ResultJson.success());\n+    }\n+\n+    /**\n+     * Unassign a schedule from systems\n+     *\n+     * @param request the request object\n+     * @param response the response obejct\n+     * @param user the authorized user\n+     * @return string containing the JSON response\n+     */\n+    public static String unassignSchedule(Request request, Response response, User user) {\n+        response.type(\"application/json\");\n+        List<Long> systemIds = Arrays.asList(GSON.fromJson(request.body(), Long[].class));\n+        try {\n+            MM.retractScheduleFromSystems(user, new HashSet<>(systemIds));\n+        }\n+        catch (LookupException e) {\n+            Spark.halt(HttpStatus.SC_BAD_REQUEST, GSON.toJson(ResultJson.error(e.getMessage())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5baf9023bb2b48acdc8d6ffa1d8f60b2c6e731a"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwNTE2Nw==", "bodyText": "I wonder whether we should move this one to the SsmController instead. At least that's where I would expect this to be found.", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452205167", "createdAt": "2020-07-09T13:10:49Z", "author": {"login": "parlt91"}, "path": "java/code/src/com/suse/manager/webui/controllers/maintenance/MaintenanceScheduleController.java", "diffHunk": "@@ -115,6 +118,22 @@ public static ModelAndView maintenanceSchedules(Request request, Response respon\n         return new ModelAndView(params, \"templates/schedule/maintenance-windows.jade\");\n     }\n \n+    /**\n+     * Handler for the SSM schedule assignment page.\n+     *\n+     * @param request the request object\n+     * @param response the response object\n+     * @param user the current user\n+     * @return the ModelAndView object to render the page\n+     */\n+    public static ModelAndView ssmSchedules(Request request, Response response, User user) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwOTg5Nw==", "bodyText": "Same thought here maybe move the code in maintenance/ssm to systems/ssm? On the other hand I am not against having everything maintenance window related in maintenance/. I'd like to hear some of your opinions about this.", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452209897", "createdAt": "2020-07-09T13:18:00Z", "author": {"login": "parlt91"}, "path": "web/html/src/manager/maintenance/ssm/schedule-picker.js", "diffHunk": "@@ -0,0 +1,148 @@\n+// @flow\n+\n+import React, {useState, useEffect, useContext} from \"react\";\n+\n+import {AsyncButton} from \"components/buttons\";\n+import {ModalButton} from \"components/dialog/ModalButton\";\n+import {Form, FormContext} from \"components/input/Form\";\n+import {Select} from \"components/input/Select\";\n+import {Check} from \"components/input/Check\";\n+import {Utils as MessagesUtils} from \"components/messages\";\n+\n+import CancelActionsDialog from \"../shared/cancel-actions-dialog\";\n+\n+import type {Node} from 'react';\n+import type {MessageType} from \"components/messages\";\n+\n+const Network = require(\"utils/network\");\n+\n+type ScheduleType = {\n+  scheduleId: number,\n+  scheduleName: string\n+};\n+\n+type WithMaintenanceSchedulesProps = {\n+  systems: string[],\n+  onMessage: (messages: MessageType[]) => void,\n+  children: (\n+    schedules: ScheduleType[],\n+    onAssign: (scheduleId: number, cancelActions: boolean) => Promise<any>\n+  ) => Node\n+};\n+\n+export function WithMaintenanceSchedules(props: WithMaintenanceSchedulesProps) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MzU4NzQ1", "url": "https://github.com/uyuni-project/uyuni/pull/2372#pullrequestreview-446358745", "createdAt": "2020-07-10T12:25:55Z", "commit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMjoyNTo1NVrOGv1XdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzo0NDo0NFrOGv376g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxMDYxMg==", "bodyText": "Does this not affect existing usages in a bad way?", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452810612", "createdAt": "2020-07-10T12:25:55Z", "author": {"login": "hustodemon"}, "path": "web/html/src/components/buttons.js", "diffHunk": "@@ -65,7 +65,7 @@ export class AsyncButton extends _ButtonBase {\n     let style = \"btn \";\n     switch (this.state.value) {\n         case \"failure\": style += \"btn-danger\"; break;\n-        case \"waiting\": style += \"btn-default\"; break;\n+        case \"waiting\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxMTEyMg==", "bodyText": "The line 15 suggests, that this prop is optional. Shouldn't this be reflected in the props as well?", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452811122", "createdAt": "2020-07-10T12:27:02Z", "author": {"login": "hustodemon"}, "path": "web/html/src/components/dialog/DangerDialog.js", "diffHunk": "@@ -72,4 +73,5 @@ DangerDialog.propTypes = {\n     onConfirmAsync: PropTypes.func,\n     submitText: PropTypes.string,\n     submitIcon: PropTypes.string,\n+    btnClass: PropTypes.string", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1MjcxNA==", "bodyText": "Nit: Maybe debug would be more fitting in these 3 scenarios?", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r452852714", "createdAt": "2020-07-10T13:44:44Z", "author": {"login": "hustodemon"}, "path": "java/code/src/com/redhat/rhn/frontend/action/systems/sdc/SystemDetailsEditAction.java", "diffHunk": "@@ -167,6 +175,31 @@ else if (selectedEnt.equals(UNENTITLE)) {\n         s.getLocation().setRoom(daForm.getString(ROOM));\n         s.getLocation().setRack(daForm.getString(RACK));\n \n+        // Assign maintenance schedule\n+        Long scheduleId = (Long) daForm.get(MAINTENANCE_SCHEDULE);\n+\n+        if (scheduleId != null && scheduleId != 0) {\n+            // Assign schedule\n+            MaintenanceSchedule schedule = maintenanceManager.lookupScheduleByUserAndId(user, scheduleId).get();\n+            boolean cancelAffected = Boolean.TRUE.equals(daForm.get(MAINTENANCE_CANCEL_AFFECTED));\n+            try {\n+                maintenanceManager.assignScheduleToSystems(user, schedule, Collections.singleton(s.getId()),\n+                        cancelAffected);\n+                log.info(String.format(\"System %s assigned to schedule %s.\", s.getId(), schedule.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfe79d976f4f18e851329a28f21e6aea08fc28ab"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MzQ3OTE2", "url": "https://github.com/uyuni-project/uyuni/pull/2372#pullrequestreview-449347916", "createdAt": "2020-07-15T21:22:00Z", "commit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMToyMjowMFrOGyQ8EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMTozNjowNFrOGyRiEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM1OTUwNQ==", "bodyText": "Just  to make sure: no restriction for all the type of user right?", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r455359505", "createdAt": "2020-07-15T21:22:00Z", "author": {"login": "ncounter"}, "path": "java/code/webapp/WEB-INF/pages/ssm/ssmindex.jsp", "diffHunk": "@@ -173,6 +173,7 @@\n                         <rhn:require acl=\"all_systems_in_set_have_feature(ftr_package_refresh)\">\n                             <li><bean:message key=\"ssm.overview.misc.packageprofiles\"/></li>\n                         </rhn:require>\n+                        <li><bean:message key=\"ssm.overview.schedule.assign\"/></li>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM2MDI4NQ==", "bodyText": "Woah, sounds new to me. What's the scenario did you experienced it?", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r455360285", "createdAt": "2020-07-15T21:23:43Z", "author": {"login": "ncounter"}, "path": "web/html/src/core/spa/spa-renderer.js", "diffHunk": "@@ -26,7 +26,10 @@ function hasReactApp() {\n   return window.pageRenderers.spa.reactAppsName.length > 0;\n }\n \n-function renderGlobalReact(element: ReactElement<any>, container: Element) {\n+function renderGlobalReact(element: ReactElement<any>, container: ?Element) {\n+  if (container == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM2MjY5Mg==", "bodyText": "Checkstyle: else should go to a new line", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r455362692", "createdAt": "2020-07-15T21:28:33Z", "author": {"login": "ncounter"}, "path": "web/html/src/manager/maintenance/ssm/schedule-picker.js", "diffHunk": "@@ -0,0 +1,148 @@\n+// @flow\n+\n+import React, {useState, useEffect, useContext} from \"react\";\n+\n+import {AsyncButton} from \"components/buttons\";\n+import {ModalButton} from \"components/dialog/ModalButton\";\n+import {Form, FormContext} from \"components/input/Form\";\n+import {Select} from \"components/input/Select\";\n+import {Check} from \"components/input/Check\";\n+import {Utils as MessagesUtils} from \"components/messages\";\n+\n+import CancelActionsDialog from \"../shared/cancel-actions-dialog\";\n+\n+import type {Node} from 'react';\n+import type {MessageType} from \"components/messages\";\n+\n+const Network = require(\"utils/network\");\n+\n+type ScheduleType = {\n+  scheduleId: number,\n+  scheduleName: string\n+};\n+\n+type WithMaintenanceSchedulesProps = {\n+  systems: string[],\n+  onMessage: (messages: MessageType[]) => void,\n+  children: (\n+    schedules: ScheduleType[],\n+    onAssign: (scheduleId: number, cancelActions: boolean) => Promise<any>\n+  ) => Node\n+};\n+\n+export function WithMaintenanceSchedules(props: WithMaintenanceSchedulesProps) {\n+  const [schedules, setSchedules] = useState([]);\n+\n+  const onAssign = (scheduleId: number, cancelActions: boolean): Promise<any> => {\n+    let uri;\n+    let data;\n+    let successMsg;\n+    if (scheduleId === 0) {\n+      uri = \"/rhn/manager/api/maintenance/schedule/unassign\";\n+      successMsg = t(\"Maintenance schedule has been cleared\");\n+      data = props.systems;\n+    } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM2NDQzNg==", "bodyText": "Is the TODO still something missing? I'd either address it or drop it.", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r455364436", "createdAt": "2020-07-15T21:31:01Z", "author": {"login": "ncounter"}, "path": "web/html/src/manager/maintenance/ssm/system-assignment.js", "diffHunk": "@@ -0,0 +1,40 @@\n+// @flow\n+\n+import React, {useState} from \"react\";\n+import SpaRenderer from \"core/spa/spa-renderer\";\n+\n+import {Messages} from \"components/messages\";\n+import {BootstrapPanel} from \"components/panels/BootstrapPanel\";\n+\n+import {SchedulePickerForm, WithMaintenanceSchedules} from \"./schedule-picker\";\n+\n+function SystemAssignment(props: {systems: string[]}) {\n+  // TODO: Add proper info text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3abd5e7e85ac9cc4fef4514c1e507b498ce434d8"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM2OTIzMw==", "bodyText": "Maybe better to check first if it is null and then by comparing by schedule_id just for the sake of performance?", "url": "https://github.com/uyuni-project/uyuni/pull/2372#discussion_r455369233", "createdAt": "2020-07-15T21:36:04Z", "author": {"login": "ncounter"}, "path": "java/code/src/com/redhat/rhn/common/db/datasource/xml/System_queries.xml", "diffHunk": "@@ -2419,6 +2419,17 @@ ORDER BY UPPER(COALESCE(X.SERVER_NAME, '(none)')), X.ID\n   <elaborator name=\"entitlements\" />\n </mode>\n \n+<mode name=\"target_systems_for_maintenance_schedule\" class=\"com.redhat.rhn.frontend.dto.EssentialServerDto\">\n+    <query params=\"user_id, schedule_id\">\n+        SELECT s.id, s.name\n+        FROM rhnServer s JOIN rhnUserServerPerms usp on s.id = usp.server_id\n+        WHERE usp.user_id = :user_id\n+            AND (s.maintenance_schedule_id != :schedule_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dd053988f6b0387b7f4798426b6dbf5a927566a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034969bffe7eef78c6340a505bff4f4a014bc721", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/034969bffe7eef78c6340a505bff4f4a014bc721", "committedDate": "2020-07-16T11:13:36Z", "message": "Change execution order in the 'assignScheduleToSystemWithPendingActions' test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acc5fb6da54e236aeb0840784fc147b9b92cf768", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/acc5fb6da54e236aeb0840784fc147b9b92cf768", "committedDate": "2020-07-16T11:13:37Z", "message": "Add option to cancel affected actions when assigning schedules to systems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49f915529cce85633dc35d233c0728798910539f", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/49f915529cce85633dc35d233c0728798910539f", "committedDate": "2020-07-16T11:13:37Z", "message": "Add reschedule strategy parameter to the system assignment XMLRPC endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a6ff46e861a494bd658fe1d16545ad2def7a28f", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6a6ff46e861a494bd658fe1d16545ad2def7a28f", "committedDate": "2020-07-16T11:16:09Z", "message": "API endpoints for assigning maintenance schedules to systems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "076c5a3eb377f15596cb720a86060af7f08a50a4", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/076c5a3eb377f15596cb720a86060af7f08a50a4", "committedDate": "2020-07-16T11:17:59Z", "message": "Add maintenance schedule assignment page under 'Misc' tab to SSM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dea483034f532ed652b20cbbbe763c548f03d98", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7dea483034f532ed652b20cbbbe763c548f03d98", "committedDate": "2020-07-16T11:18:00Z", "message": "Show currently assigned maintenance schedule in system properties panel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3c0e450312f87e0ff16b5a377d572af1b50d88e", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a3c0e450312f87e0ff16b5a377d572af1b50d88e", "committedDate": "2020-07-16T11:18:00Z", "message": "Add maintenance schedule form controls to system properties edit page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2ad16d06db90bbef60b454a52b8d1c433575533", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d2ad16d06db90bbef60b454a52b8d1c433575533", "committedDate": "2020-07-16T11:38:28Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1dd053988f6b0387b7f4798426b6dbf5a927566a", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/1dd053988f6b0387b7f4798426b6dbf5a927566a", "committedDate": "2020-07-09T12:51:14Z", "message": "Add system assignment tab to maintenance schedule details page"}, "afterCommit": {"oid": "d2ad16d06db90bbef60b454a52b8d1c433575533", "author": {"user": {"login": "cbbayburt", "name": "Can Bulut Bayburt"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d2ad16d06db90bbef60b454a52b8d1c433575533", "committedDate": "2020-07-16T11:38:28Z", "message": "Add system assignment tab to maintenance schedule details page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5ODY3Mjc5", "url": "https://github.com/uyuni-project/uyuni/pull/2372#pullrequestreview-449867279", "createdAt": "2020-07-16T13:50:45Z", "commit": {"oid": "d2ad16d06db90bbef60b454a52b8d1c433575533"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5ODc0Mjg1", "url": "https://github.com/uyuni-project/uyuni/pull/2372#pullrequestreview-449874285", "createdAt": "2020-07-16T13:58:01Z", "commit": {"oid": "d2ad16d06db90bbef60b454a52b8d1c433575533"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1195, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}