{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTEwMTEy", "number": 2782, "title": "Only update the kickstart path in cobbler if necessary (bsc#1175216)", "bodyText": "What does this PR change?\nThe CobblerSyncTask calls CobblerProfileSyncCommand, which in turn modifies the kickstart path attribute in the cobbler profile.\nThis results in a full sync, which might be slow on bigger setups.\nFixed by updating the attribute only if necessary (cobbler value differs from the one in Uyuni database).\nMinor TODO\n\n Adjust the javadoc: mention that java -> cobbler sync can cause full sync in CobblerSyncTask\n\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: bugfix\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: no tests in this area\n\n\n DONE\n\n\nLinks\nTracks SUSE/spacewalk#12174\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-10-30T16:06:34Z", "url": "https://github.com/uyuni-project/uyuni/pull/2782", "merged": true, "mergeCommit": {"oid": "71ceeb03d9bcf4ae5e185016a008354d6647c2aa"}, "closed": true, "closedAt": "2021-03-22T17:07:04Z", "author": {"login": "hustodemon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdX2BvUABqjM5NDM4NDIzMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeFrGmOABqjQ0OTEyNTYxMzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5bb18115a633782238865c39a851d09e4ed23b77", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5bb18115a633782238865c39a851d09e4ed23b77", "committedDate": "2020-10-30T16:01:14Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}, "afterCommit": {"oid": "16f572644dd5792e3bef2787622930ce8f8ce122", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/16f572644dd5792e3bef2787622930ce8f8ce122", "committedDate": "2020-10-31T07:14:02Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNjQ3NDk4", "url": "https://github.com/uyuni-project/uyuni/pull/2782#pullrequestreview-522647498", "createdAt": "2020-11-03T16:03:54Z", "commit": {"oid": "16f572644dd5792e3bef2787622930ce8f8ce122"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNDY5MzY0", "url": "https://github.com/uyuni-project/uyuni/pull/2782#pullrequestreview-523469364", "createdAt": "2020-11-04T15:26:02Z", "commit": {"oid": "16f572644dd5792e3bef2787622930ce8f8ce122"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE2NTUyMzUy", "url": "https://github.com/uyuni-project/uyuni/pull/2782#pullrequestreview-616552352", "createdAt": "2021-03-19T15:55:04Z", "commit": {"oid": "16f572644dd5792e3bef2787622930ce8f8ce122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOVQxNTo1NTowNVrOI6GTXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOVQxNTo1NTowNVrOI6GTXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Nzc5MTU4MQ==", "bodyText": "Is the double \"cobbler\" an oversight?", "url": "https://github.com/uyuni-project/uyuni/pull/2782#discussion_r597791581", "createdAt": "2021-03-19T15:55:05Z", "author": {"login": "agraul"}, "path": "java/code/src/com/redhat/rhn/manager/kickstart/cobbler/CobblerProfileSyncCommand.java", "diffHunk": "@@ -152,25 +154,35 @@ private void syncProfileToSpacewalk(Map cobblerProfile, KickstartData profile) {\n         }\n \n         //Now re-set the filename in case someone set it incorrectly\n-        try {\n-        String handle = (String) invokeXMLRPC(\"get_profile_handle\",\n-                cobblerProfile.get(\"name\"), xmlRpcToken);\n-        invokeXMLRPC(\"modify_profile\", handle, \"kickstart\", profile.buildCobblerFileName(),\n-                xmlRpcToken);\n-        invokeXMLRPC(\"save_profile\", handle, xmlRpcToken);\n-\n-        //Lets update the modified date just to make sure\n-        profile.setModified(new Date());\n-        }\n-        catch (RuntimeException re) {\n-            if (re.getCause() instanceof XmlRpcFault) {\n-                XmlRpcFault xrf = (XmlRpcFault)re.getCause();\n-                if (xrf.getMessage().contains(\"unknown profile name\")) {\n-                    log.error(\"Cobbler doesn't know about this profile any more!\");\n-                }\n+        Path kickstartPath = Path.of(\n+                ConfigDefaults.get().getKickstartConfigDir(),\n+                cobblerProfile.get(\"kickstart\").toString()\n+        );\n+        String cobblerKickstartFileName = profile.buildCobblerFileName();\n+        if (!Path.of(cobblerKickstartFileName).equals(kickstartPath)) {\n+            try {\n+                log.info(String.format(\"Updating cobbler cobbler profile, setting 'kickstart' to: %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f572644dd5792e3bef2787622930ce8f8ce122"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16f572644dd5792e3bef2787622930ce8f8ce122", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/16f572644dd5792e3bef2787622930ce8f8ce122", "committedDate": "2020-10-31T07:14:02Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}, "afterCommit": {"oid": "8b612605f24db46961e195c23f1db37f1171dd95", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8b612605f24db46961e195c23f1db37f1171dd95", "committedDate": "2021-03-22T16:30:04Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "committedDate": "2021-03-22T16:30:58Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b612605f24db46961e195c23f1db37f1171dd95", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8b612605f24db46961e195c23f1db37f1171dd95", "committedDate": "2021-03-22T16:30:04Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}, "afterCommit": {"oid": "6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "author": {"user": {"login": "hustodemon", "name": "Frantisek Kobzik"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6026b424b5d2a10562d5c12c0b8e8b6686e05ccd", "committedDate": "2021-03-22T16:30:58Z", "message": "Only update the kickstart path in cobbler if necessary (bsc#1175216)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 958, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}