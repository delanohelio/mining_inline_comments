{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5OTY5MzAx", "number": 2845, "title": "QA: Refactor extraction of logs to support QAM clients", "bodyText": "What does this PR change?\nSmall refactor to extract logs from all the active nodes in our testsuite. In that way, we fix the current failure on the QAM test suite at the same time that we don't need to worry if we add more clients to the list of nodes.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed\n\n\n DONE\n\n\nTest coverage\n\n\nCucumber tests were changed\n\n\n DONE\n\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-11-12T15:37:11Z", "url": "https://github.com/uyuni-project/uyuni/pull/2845", "merged": true, "mergeCommit": {"oid": "07387f30b1d17ecf0c8bbe06af4c708435800df0"}, "closed": true, "closedAt": "2020-11-12T16:50:54Z", "author": {"login": "srbarrios"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb0cQXgBqjM5ODkzMTE4MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb1NLOgBqjM5ODk1NzU2MTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f01deaad3d00156d26cdc40171e551fccde8f86b", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f01deaad3d00156d26cdc40171e551fccde8f86b", "committedDate": "2020-11-12T15:34:47Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "3a4c3ce26476058280ddf171da55eae5c5ada62c", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3a4c3ce26476058280ddf171da55eae5c5ada62c", "committedDate": "2020-11-12T15:38:46Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a4c3ce26476058280ddf171da55eae5c5ada62c", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/3a4c3ce26476058280ddf171da55eae5c5ada62c", "committedDate": "2020-11-12T15:38:46Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "ef2a0d7d41379eb392221d33d28418b72a9629d8", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ef2a0d7d41379eb392221d33d28418b72a9629d8", "committedDate": "2020-11-12T15:39:09Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef2a0d7d41379eb392221d33d28418b72a9629d8", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ef2a0d7d41379eb392221d33d28418b72a9629d8", "committedDate": "2020-11-12T15:39:09Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "28568207ba7d532741f68f23a5d0de4e6719b27f", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/28568207ba7d532741f68f23a5d0de4e6719b27f", "committedDate": "2020-11-12T15:41:01Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28568207ba7d532741f68f23a5d0de4e6719b27f", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/28568207ba7d532741f68f23a5d0de4e6719b27f", "committedDate": "2020-11-12T15:41:01Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "committedDate": "2020-11-12T15:42:31Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjE5NzI0", "url": "https://github.com/uyuni-project/uyuni/pull/2845#pullrequestreview-529219724", "createdAt": "2020-11-12T15:44:34Z", "commit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo0NDozNVrOHyA6uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo0NDozNVrOHyA6uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNTg4Mw==", "bodyText": "This might fail in SLES11 nodes, right? \ud83e\udd14", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522205883", "createdAt": "2020-11-12T15:44:35Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/support/commonlib.rb", "diffHunk": "@@ -228,3 +228,16 @@ def generate_repository_name(repo_url)\n   repo_name.delete_prefix! 'http://minima-mirror-qam.mgr.prv.suse.net/ibs/SUSE:/Maintenance:/'\n   repo_name\n end\n+\n+def extract_logs_from_node(node)\n+  _os_version, os_family = get_os_version(node)\n+  if os_family =~ /^opensuse/\n+    node.run('zypper mr --enable os_pool_repo os_update_repo') unless $qam_test\n+    node.run('zypper --non-interactive install tar')\n+    node.run('zypper mr --disable os_pool_repo os_update_repo') unless $qam_test\n+  end\n+  node.run(\"journalctl > /var/log/messages && (tar cfvJP /tmp/#{node.full_hostname}-logs.tar.xz /var/log/ || [[ $? -eq 1 ]])\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjI3MTA5", "url": "https://github.com/uyuni-project/uyuni/pull/2845#pullrequestreview-529227109", "createdAt": "2020-11-12T15:51:34Z", "commit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo1MTozNFrOHyBRFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo1MTozNFrOHyBRFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIxMTYwNA==", "bodyText": "No idea.", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522211604", "createdAt": "2020-11-12T15:51:34Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/support/commonlib.rb", "diffHunk": "@@ -228,3 +228,16 @@ def generate_repository_name(repo_url)\n   repo_name.delete_prefix! 'http://minima-mirror-qam.mgr.prv.suse.net/ibs/SUSE:/Maintenance:/'\n   repo_name\n end\n+\n+def extract_logs_from_node(node)\n+  _os_version, os_family = get_os_version(node)\n+  if os_family =~ /^opensuse/\n+    node.run('zypper mr --enable os_pool_repo os_update_repo') unless $qam_test\n+    node.run('zypper --non-interactive install tar')\n+    node.run('zypper mr --disable os_pool_repo os_update_repo') unless $qam_test\n+  end\n+  node.run(\"journalctl > /var/log/messages && (tar cfvJP /tmp/#{node.full_hostname}-logs.tar.xz /var/log/ || [[ $? -eq 1 ]])\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNTg4Mw=="}, "originalCommit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjI4MjQ3", "url": "https://github.com/uyuni-project/uyuni/pull/2845#pullrequestreview-529228247", "createdAt": "2020-11-12T15:52:37Z", "commit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo1MjozN1rOHyBUiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo1MjozN1rOHyBUiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIxMjQ5MQ==", "bodyText": "I don't think we have used until now a global variable $nodes.\nThis PR gives a good point to add one.", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522212491", "createdAt": "2020-11-12T15:52:37Z", "author": {"login": "calancha"}, "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -324,16 +324,12 @@\n   raise \"Download debug file failed\" unless code.zero?\n end\n \n-Then(/^I get logfiles from \"([^\"]*)\"$/) do |target|\n-  node = get_target(target)\n-  os_version, os_family = get_os_version(node)\n-  if os_family =~ /^opensuse/\n-    node.run('zypper mr --enable os_pool_repo os_update_repo && zypper --non-interactive install tar')\n-  end\n-  node.run(\"journalctl > /var/log/messages && (tar cfvJP /tmp/#{target}-logs.tar.xz /var/log/ || [[ $? -eq 1 ]])\")\n-  `mkdir logs` unless Dir.exist?('logs')\n-  code = file_extract(node, \"/tmp/#{target}-logs.tar.xz\", \"logs/#{target}-logs.tar.xz\")\n-  raise \"Download log archive failed\" unless code.zero?\n+When(/^I extract the log files from all our active nodes$/) do\n+  $nodes.each do |node|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "committedDate": "2020-11-12T15:42:31Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "a3c687cff1a41d14431f5278ba4cab639a9d8177", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a3c687cff1a41d14431f5278ba4cab639a9d8177", "committedDate": "2020-11-12T15:58:04Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3c687cff1a41d14431f5278ba4cab639a9d8177", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a3c687cff1a41d14431f5278ba4cab639a9d8177", "committedDate": "2020-11-12T15:58:04Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "7988541ad47f2d3e03aab2e2e8023e98ab103377", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7988541ad47f2d3e03aab2e2e8023e98ab103377", "committedDate": "2020-11-12T16:00:01Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e335745c542649c510d616a616fce92729e76972", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e335745c542649c510d616a616fce92729e76972", "committedDate": "2020-11-12T16:32:17Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7988541ad47f2d3e03aab2e2e8023e98ab103377", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7988541ad47f2d3e03aab2e2e8023e98ab103377", "committedDate": "2020-11-12T16:00:01Z", "message": "QA: Refactor extraction of logs to support QAM clients"}, "afterCommit": {"oid": "e335745c542649c510d616a616fce92729e76972", "author": {"user": {"login": "srbarrios", "name": "Oscar Barrios"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e335745c542649c510d616a616fce92729e76972", "committedDate": "2020-11-12T16:32:17Z", "message": "QA: Refactor extraction of logs to support QAM clients"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 843, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}