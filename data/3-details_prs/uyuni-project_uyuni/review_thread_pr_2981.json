{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNzcyMjQ4", "number": 2981, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODoyMDoxNVrOFB6y6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODoyMDoxNVrOFB6y6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTU2MjAzOnYy", "diffSide": "RIGHT", "path": "testsuite/features/step_definitions/common_steps.rb", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODoyMDoxNVrOIA0KrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNTo0NzoxNVrOIBkpog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              product = find(:xpath, xpath)\n          \n          \n            \n              selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n          \n          \n            \n              raise \"#{product['data-identifier']} is not checked\" unless selected\n          \n          \n            \n            within(xpath) do\n          \n          \n            \n              raise \"#{product} is not checked\" unless find(:xpath, \"./div/input[@type='checkbox']\").checked?\n          \n          \n            \n            end", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r537725612", "createdAt": "2020-12-07T18:20:15Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -511,8 +511,9 @@\n \n Then(/^I should see the \"(.*?)\" selected$/) do |product|\n   xpath = \"//span[contains(text(), '#{product}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\"\n-  product_identifier = find(:xpath, xpath)['data-identifier']\n-  raise \"#{product_identifier} is not checked\" unless has_checked_field?('checkbox-for-' + product_identifier)\n+  product = find(:xpath, xpath)\n+  selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n+  raise \"#{product['data-identifier']} is not checked\" unless selected", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f28791a067eeae3677a82d127fcf479528a44d5e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMzMDYwNA==", "bodyText": "why not, it's indeed more elegant with within\nBUT what you want in the error message is find(:xpath, '.')['data-identifier'], because product is undefined in your solution\nok, i have to redo my test :-(", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r538330604", "createdAt": "2020-12-08T12:50:23Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -511,8 +511,9 @@\n \n Then(/^I should see the \"(.*?)\" selected$/) do |product|\n   xpath = \"//span[contains(text(), '#{product}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\"\n-  product_identifier = find(:xpath, xpath)['data-identifier']\n-  raise \"#{product_identifier} is not checked\" unless has_checked_field?('checkbox-for-' + product_identifier)\n+  product = find(:xpath, xpath)\n+  selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n+  raise \"#{product['data-identifier']} is not checked\" unless selected", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg=="}, "originalCommit": {"oid": "f28791a067eeae3677a82d127fcf479528a44d5e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ1NDYwNA==", "bodyText": "Done.", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r538454604", "createdAt": "2020-12-08T14:48:33Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -511,8 +511,9 @@\n \n Then(/^I should see the \"(.*?)\" selected$/) do |product|\n   xpath = \"//span[contains(text(), '#{product}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\"\n-  product_identifier = find(:xpath, xpath)['data-identifier']\n-  raise \"#{product_identifier} is not checked\" unless has_checked_field?('checkbox-for-' + product_identifier)\n+  product = find(:xpath, xpath)\n+  selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n+  raise \"#{product['data-identifier']} is not checked\" unless selected", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg=="}, "originalCommit": {"oid": "f28791a067eeae3677a82d127fcf479528a44d5e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUxOTk3MA==", "bodyText": "@Bischoff it is impossible that product is undefined, we are passing a value as a parameter in the step definition.\nWith your extra change, we are adding an extra find, anyhow, as it is only called on a raise, fine with this approach.\nNote: Be caution to reuse variables like 'product' to store completely different values, even if possible, can bring confusion.", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r538519970", "createdAt": "2020-12-08T15:47:15Z", "author": {"login": "srbarrios"}, "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -511,8 +511,9 @@\n \n Then(/^I should see the \"(.*?)\" selected$/) do |product|\n   xpath = \"//span[contains(text(), '#{product}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\"\n-  product_identifier = find(:xpath, xpath)['data-identifier']\n-  raise \"#{product_identifier} is not checked\" unless has_checked_field?('checkbox-for-' + product_identifier)\n+  product = find(:xpath, xpath)\n+  selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n+  raise \"#{product['data-identifier']} is not checked\" unless selected", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg=="}, "originalCommit": {"oid": "f28791a067eeae3677a82d127fcf479528a44d5e"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3862, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}