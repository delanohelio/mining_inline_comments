{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMzA0NjYz", "number": 2952, "title": "Use sanitized repo label to build reposync repo cache path (bsc#1179410)", "bodyText": "What does this PR change?\nThis PR makes fixes some issues we have in spacewalk-repo-sync when dealing with custom DEB repositories that contains non-valid characters on its label (like /).\nThe summary of changes is:\n\nAdd validation to custom repository label (same as channel name): allow uppercase, spaces, slashes, etc.\nFix deb_src reposync plugin to use a sanitized \"repository label\" when building the repository cache root path.\nFix yum_src reposync plugin to use a sanitized \"repository label\" (instead of channel label) when building the repository cache root path.\n\nThese are the current regex we use for validation:\nCHANNEL_NAME_REGEX = \"^[a-zA-Z\\\\d][\\\\w\\\\d\\\\s\\\\-\\\\.\\\\'\\\\(\\\\)\\\\/\\\\_]*$\"\nCHANNEL_LABEL_REGEX = \"^[a-z\\\\d][a-z\\\\d\\\\-\\\\.\\\\_]*\"\nREPO_LABEL_REGEX = \"^[a-zA-Z\\\\d][\\\\w\\\\d\\\\s\\\\-\\\\.\\\\'\\\\(\\\\)\\\\/\\\\_]*$\"\nSo, with this PR, reposync will use a sanitized \"repository label\" (which only allows alphanumerical characters) to build the reposync repo cache path for both RPM and DEB reposync plugins.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: bugfix\n\n\n DONE\n\n\nTest coverage\n\n\nUnit tests were added\n\n\n DONE\n\n\nLinks\nTracks SUSE/spacewalk#13294\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-12-01T13:32:49Z", "url": "https://github.com/uyuni-project/uyuni/pull/2952", "merged": true, "mergeCommit": {"oid": "cd8de73346b93c9cc99e03cb2b721067c892fbff"}, "closed": true, "closedAt": "2020-12-14T10:08:17Z", "author": {"login": "meaksh"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiNtoWABqjQwNjIwODg2NzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmCZsfABqjQxMDgxODU2NzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95dd3deb35e81feef42d3f2703031b50094b42dd", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/95dd3deb35e81feef42d3f2703031b50094b42dd", "committedDate": "2020-12-02T12:23:42Z", "message": "Update changelog for spacewalk-backend"}, "afterCommit": {"oid": "8d33d26c138d3132405d0abd4e703d061eb64b29", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8d33d26c138d3132405d0abd4e703d061eb64b29", "committedDate": "2020-12-02T12:28:31Z", "message": "Update changelog for spacewalk-backend"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDU4NDc3", "url": "https://github.com/uyuni-project/uyuni/pull/2952#pullrequestreview-543058477", "createdAt": "2020-12-02T17:12:55Z", "commit": {"oid": "8d33d26c138d3132405d0abd4e703d061eb64b29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzoxMjo1NVrOH9lcvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzoxMjo1NVrOH9lcvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODc0OA==", "bodyText": "Why is this valid?", "url": "https://github.com/uyuni-project/uyuni/pull/2952#discussion_r534338748", "createdAt": "2020-12-02T17:12:55Z", "author": {"login": "mcalmer"}, "path": "java/code/src/com/redhat/rhn/manager/channel/test/BaseRepoCommandTest.java", "diffHunk": "@@ -130,4 +130,82 @@ private void validUrlInput(String url, String type) {\n             fail(\"valid repo type caused error: \" + url);\n         }\n     }\n+\n+    public void testRepoLabelInput() {\n+\n+        // Repository label must contain only letters, hyphens, periods, underscores and numeral\n+\n+        // I N V A L I D\n+        invalidRepoLabelInput(\"\");\n+        invalidRepoLabelInput(\"example/repo\");\n+        invalidRepoLabelInput(\"example;repo\");\n+        invalidRepoLabelInput(\"example_repo$\");\n+        invalidRepoLabelInput(\"my*examplerepo\");\n+        invalidRepoLabelInput(\"example^repo\");\n+\n+        // V A L I D\n+        validRepoLabelInput(\"my example repo\");\n+        validRepoLabelInput(\"my-example-repo\");\n+        validRepoLabelInput(\"my-example_repo\");\n+        validRepoLabelInput(\"my_repo_22\");\n+        validRepoLabelInput(\"My-Example-Repo\");\n+        validRepoLabelInput(\"My/Example/Repo/15\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d33d26c138d3132405d0abd4e703d061eb64b29"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89f86a4f66c02612aab60bee07bf26757e235e9f", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/89f86a4f66c02612aab60bee07bf26757e235e9f", "committedDate": "2020-12-04T10:08:36Z", "message": "Exclude valid repo name from invalid tests"}, "afterCommit": {"oid": "2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c", "committedDate": "2020-12-04T10:18:21Z", "message": "Exclude valid repo name from invalid tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NTk1Mjg1", "url": "https://github.com/uyuni-project/uyuni/pull/2952#pullrequestreview-545595285", "createdAt": "2020-12-05T15:31:45Z", "commit": {"oid": "2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10765ef6be1dff679049778013102247abd977c6", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/10765ef6be1dff679049778013102247abd977c6", "committedDate": "2020-12-14T09:32:50Z", "message": "Add validation for custom repository label"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da431cbba973a49134a5ed845a9cb9c4ed0aa8b0", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/da431cbba973a49134a5ed845a9cb9c4ed0aa8b0", "committedDate": "2020-12-14T09:32:53Z", "message": "Add Java tests for validating custom reposity labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8969f8ed7b85f0db66f18d50c7b713816154ba3b", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8969f8ed7b85f0db66f18d50c7b713816154ba3b", "committedDate": "2020-12-14T09:32:53Z", "message": "Use channel label to calculate DEB repo cache path (bsc#1179410)\n\nThis also ensures that, in case of failing back to repo name (should not\nhappend), it would exclude non-valid characters from the repo name."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bf3a4dd20d05d27c7c5202e0b188bf6df868c20", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/6bf3a4dd20d05d27c7c5202e0b188bf6df868c20", "committedDate": "2020-12-14T09:33:10Z", "message": "Update changelog for spacewalk-backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa69c8d647aa2b285a13a7e418627ce647f0beb4", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/fa69c8d647aa2b285a13a7e418627ce647f0beb4", "committedDate": "2020-12-14T09:33:26Z", "message": "Update changelog for spacewalk-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5725ee587a0f6c56bd1e0527afd5be5b97f67c97", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5725ee587a0f6c56bd1e0527afd5be5b97f67c97", "committedDate": "2020-12-14T09:33:27Z", "message": "Add fixes for checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d263390673560d7855ce9cb622c8e5ae9d1291c", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7d263390673560d7855ce9cb622c8e5ae9d1291c", "committedDate": "2020-12-14T09:33:27Z", "message": "Use sanitized repo label to build reposync repo cache path (bsc#1179410)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c69badd5832ca289fbbb8297f21eccf8538aea4c", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c69badd5832ca289fbbb8297f21eccf8538aea4c", "committedDate": "2020-12-14T09:33:44Z", "message": "Update changelog for spacewalk-backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "062eaaf5894a4706a9ac5ad09baedb3c29afb326", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/062eaaf5894a4706a9ac5ad09baedb3c29afb326", "committedDate": "2020-12-14T09:33:45Z", "message": "Fix invalidRepoLabelInput to properly fail on invalid repo label"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84012d3879f4ca6a730aadeb17bf367e78113da2", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/84012d3879f4ca6a730aadeb17bf367e78113da2", "committedDate": "2020-12-14T09:33:45Z", "message": "Exclude valid repo name from invalid tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c", "committedDate": "2020-12-04T10:18:21Z", "message": "Exclude valid repo name from invalid tests"}, "afterCommit": {"oid": "84012d3879f4ca6a730aadeb17bf367e78113da2", "author": {"user": {"login": "meaksh", "name": "Pablo Su\u00e1rez Hern\u00e1ndez"}}, "url": "https://github.com/uyuni-project/uyuni/commit/84012d3879f4ca6a730aadeb17bf367e78113da2", "committedDate": "2020-12-14T09:33:45Z", "message": "Exclude valid repo name from invalid tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 786, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}