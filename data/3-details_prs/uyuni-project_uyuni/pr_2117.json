{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzA2NTU0", "number": 2117, "title": "Tool to check Uyuni versions before a release", "bodyText": "What does this PR change?\nTool to check Uyuni versions before a release.\nWe released 2020.03 without changing the pattern version.\nThis script will check that the relevant spec files have the same version we have at the WebUI.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nNo documentation needed: To be added to the release page wiki. Not for customers or users.\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: Not sure a so simple script should have them.\n\n\n DONE\n\n\nLinks\nNone\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-04-13T15:50:48Z", "url": "https://github.com/uyuni-project/uyuni/pull/2117", "merged": true, "mergeCommit": {"oid": "4a640ed303a1f45d0e135179ac9139dea63b90d0"}, "closed": true, "closedAt": "2020-04-20T15:53:08Z", "author": {"login": "juliogonzalez"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXQ8d2ABqjMyMjc1NDU5NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZhAXFgFqTM5NjU3NTY2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8e1de87e0594b2dccd158cc4d1e93ca73a416c6", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e8e1de87e0594b2dccd158cc4d1e93ca73a416c6", "committedDate": "2020-04-13T15:47:31Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "e44a4c8aceff72e44e61b07abe18c6f6ef24d0cb", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e44a4c8aceff72e44e61b07abe18c6f6ef24d0cb", "committedDate": "2020-04-13T15:50:43Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e44a4c8aceff72e44e61b07abe18c6f6ef24d0cb", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e44a4c8aceff72e44e61b07abe18c6f6ef24d0cb", "committedDate": "2020-04-13T15:50:43Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "e229b2a68f3cbe867b9c71447d3999fab971eab8", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e229b2a68f3cbe867b9c71447d3999fab971eab8", "committedDate": "2020-04-13T15:52:46Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjM1NjAz", "url": "https://github.com/uyuni-project/uyuni/pull/2117#pullrequestreview-392235603", "createdAt": "2020-04-13T15:54:28Z", "commit": {"oid": "e229b2a68f3cbe867b9c71447d3999fab971eab8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNTo1NDoyOFrOGErB8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNTo1NDoyOFrOGErB8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU1MjQ5OQ==", "bodyText": "IIRC new osc versions have a new path for this file, so maybe we will need to check both.", "url": "https://github.com/uyuni-project/uyuni/pull/2117#discussion_r407552499", "createdAt": "2020-04-13T15:54:28Z", "author": {"login": "juliogonzalez"}, "path": "rel-eng/uyuni-check-version", "diffHunk": "@@ -0,0 +1,95 @@\n+#!/usr/bin/python3\n+\n+from argparse import ArgumentParser\n+from configparser import ConfigParser\n+from itertools import chain\n+from os.path import dirname, expanduser, realpath\n+from re import match\n+from sys import exit\n+import urllib.parse\n+import urllib.request\n+\n+PRJ = 'systemsmanagement:Uyuni:Master'\n+PACKAGES = ['patterns-uyuni', 'uyuni-docs_en',\n+            'release-notes-uyuni', 'release-notes-uyuni-proxy']\n+\n+\n+def webui_version(conf='%s/../web/conf/rhn_web.conf' % dirname(realpath(__file__))):\n+    config = ConfigParser()\n+    with open(conf) as f:\n+        # This is basically a hack, as our .conf file does not have sections\n+        config.read_file(chain(['[section]'], f), source=conf)\n+        return config.get('section', 'web.version.uyuni')\n+\n+\n+def obs_get_package_ver(args, project, package):\n+    url = \"%s/source/%s/%s/%s.spec\" % (args.apiurl, project, package, package)\n+    user = args.user\n+    password = args.password\n+    password_mgr = urllib.request.HTTPPasswordMgrWithDefaultRealm()\n+    password_mgr.add_password(None, url, user, password)\n+    auth_handler = urllib.request.HTTPBasicAuthHandler(password_mgr)\n+    opener = urllib.request.build_opener(auth_handler)\n+    urllib.request.install_opener(opener)\n+    req = urllib.request.Request(url=url, method='GET')\n+    resource = urllib.request.urlopen(req)\n+    charset = resource.headers.get_content_charset()\n+    if charset is None:\n+        charset = 'utf-8'\n+    for line in resource.read().decode(charset).split('\\n'):\n+        version = match('^Version:\\s*(\\S+)$', line)\n+        if version:\n+            return version.group(1)\n+\n+\n+def parse_arguments():\n+    \"\"\" Parse arguments from command line \"\"\"\n+    parser = ArgumentParser(\n+        description=\"Check if Uyuni versions are aligned at all packages before a release\")\n+    parser.add_argument(\"-u\", \"--user\", action=\"store\", dest=\"user\",\n+                        help=\"OBS Username or read from ~/.oscrc\")\n+    parser.add_argument(\"-p\", \"--password\", action=\"store\", dest=\"password\",\n+                        help=\"OBS Password or read from ~/.oscrc\")\n+    parser.add_argument(\"-a\", \"--api-url\", action=\"store\", dest=\"apiurl\",\n+                        default=\"https://api.opensuse.org\",\n+                        help=\"OBS API URL (Default: https://api.opensuse.org\")\n+    args = parser.parse_args()\n+    if not args.user or not args.password:\n+        try:\n+            creds_path = \"%s/.oscrc\" % expanduser('~')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e229b2a68f3cbe867b9c71447d3999fab971eab8"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e229b2a68f3cbe867b9c71447d3999fab971eab8", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e229b2a68f3cbe867b9c71447d3999fab971eab8", "committedDate": "2020-04-13T15:52:46Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "5036803afb20728d2c011c1d08d4c7dc92412863", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5036803afb20728d2c011c1d08d4c7dc92412863", "committedDate": "2020-04-14T12:46:07Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTI3OTU5", "url": "https://github.com/uyuni-project/uyuni/pull/2117#pullrequestreview-396527959", "createdAt": "2020-04-20T14:50:27Z", "commit": {"oid": "5036803afb20728d2c011c1d08d4c7dc92412863"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDo1MDoyN1rOGIYZcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDo1MDoyN1rOGIYZcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ0MTUyMg==", "bodyText": "I would use a different name for the variable to not overwrite the webui_version function.", "url": "https://github.com/uyuni-project/uyuni/pull/2117#discussion_r411441522", "createdAt": "2020-04-20T14:50:27Z", "author": {"login": "meaksh"}, "path": "rel-eng/uyuni-check-version", "diffHunk": "@@ -0,0 +1,95 @@\n+#!/usr/bin/python3\n+\n+from argparse import ArgumentParser\n+from configparser import ConfigParser\n+from itertools import chain\n+from os.path import dirname, expanduser, realpath\n+from re import match\n+from sys import exit\n+import urllib.parse\n+import urllib.request\n+\n+PRJ = 'systemsmanagement:Uyuni:Master'\n+PACKAGES = ['patterns-uyuni', 'uyuni-docs_en',\n+            'release-notes-uyuni', 'release-notes-uyuni-proxy']\n+\n+\n+def webui_version(conf='%s/../web/conf/rhn_web.conf' % dirname(realpath(__file__))):\n+    config = ConfigParser()\n+    with open(conf) as f:\n+        # This is basically a hack, as our .conf file does not have sections\n+        config.read_file(chain(['[section]'], f), source=conf)\n+        return config.get('section', 'web.version.uyuni')\n+\n+\n+def obs_get_package_ver(args, project, package):\n+    url = \"%s/source/%s/%s/%s.spec\" % (args.apiurl, project, package, package)\n+    user = args.user\n+    password = args.password\n+    password_mgr = urllib.request.HTTPPasswordMgrWithDefaultRealm()\n+    password_mgr.add_password(None, url, user, password)\n+    auth_handler = urllib.request.HTTPBasicAuthHandler(password_mgr)\n+    opener = urllib.request.build_opener(auth_handler)\n+    urllib.request.install_opener(opener)\n+    req = urllib.request.Request(url=url, method='GET')\n+    resource = urllib.request.urlopen(req)\n+    charset = resource.headers.get_content_charset()\n+    if charset is None:\n+        charset = 'utf-8'\n+    for line in resource.read().decode(charset).split('\\n'):\n+        version = match('^Version:\\s*(\\S+)$', line)\n+        if version:\n+            return version.group(1)\n+\n+\n+def parse_arguments():\n+    \"\"\" Parse arguments from command line \"\"\"\n+    parser = ArgumentParser(\n+        description=\"Check if Uyuni versions are aligned at all packages before a release\")\n+    parser.add_argument(\"-u\", \"--user\", action=\"store\", dest=\"user\",\n+                        help=\"OBS Username or read from ~/.oscrc\")\n+    parser.add_argument(\"-p\", \"--password\", action=\"store\", dest=\"password\",\n+                        help=\"OBS Password or read from ~/.oscrc\")\n+    parser.add_argument(\"-a\", \"--api-url\", action=\"store\", dest=\"apiurl\",\n+                        default=\"https://api.opensuse.org\",\n+                        help=\"OBS API URL (Default: https://api.opensuse.org\")\n+    args = parser.parse_args()\n+    if not args.user or not args.password:\n+        try:\n+            creds_path = \"%s/.oscrc\" % expanduser('~')\n+            creds = ConfigParser()\n+            creds.read(creds_path)\n+            args.user = creds.get(args.apiurl, 'user')\n+            args.password = creds.get(args.apiurl, 'pass')\n+        except Exception:\n+            raise RuntimeError(\n+                'Could not find credentials for %s at %s' % (args.apiurl, creds_path))\n+    return args\n+\n+\n+def print_info(msg):\n+    print(\"[\\033[01m\\033[34mINFO \\033[0m] %s\" % msg)\n+\n+\n+def print_ok(msg):\n+    print(\"[\\033[01m\\033[32mOK   \\033[0m] %s\" % msg)\n+\n+\n+def print_error(msg):\n+    print(\"[\\033[01m\\033[31mERROR\\033[0m] %s\" % msg)\n+\n+\n+args = parse_arguments()\n+webui_version = webui_version()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5036803afb20728d2c011c1d08d4c7dc92412863"}, "originalPosition": 83}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5036803afb20728d2c011c1d08d4c7dc92412863", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/5036803afb20728d2c011c1d08d4c7dc92412863", "committedDate": "2020-04-14T12:46:07Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "d2f85356ae88d17ede1e49a19935f17d7a14d038", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d2f85356ae88d17ede1e49a19935f17d7a14d038", "committedDate": "2020-04-20T15:03:05Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTQwNjM5", "url": "https://github.com/uyuni-project/uyuni/pull/2117#pullrequestreview-396540639", "createdAt": "2020-04-20T15:03:46Z", "commit": {"oid": "d2f85356ae88d17ede1e49a19935f17d7a14d038"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2f85356ae88d17ede1e49a19935f17d7a14d038", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d2f85356ae88d17ede1e49a19935f17d7a14d038", "committedDate": "2020-04-20T15:03:05Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "2efe510f7ab70cd49144ab8a605fc3c5810dbdf2", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2efe510f7ab70cd49144ab8a605fc3c5810dbdf2", "committedDate": "2020-04-20T15:20:41Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2efe510f7ab70cd49144ab8a605fc3c5810dbdf2", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2efe510f7ab70cd49144ab8a605fc3c5810dbdf2", "committedDate": "2020-04-20T15:20:41Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "a74ebdcc69c0efafa8e04c7190e83494550dcbca", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a74ebdcc69c0efafa8e04c7190e83494550dcbca", "committedDate": "2020-04-20T15:20:56Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a74ebdcc69c0efafa8e04c7190e83494550dcbca", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a74ebdcc69c0efafa8e04c7190e83494550dcbca", "committedDate": "2020-04-20T15:20:56Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "d5502f922ed22de44e34c6c78b7dd9e6d8ebe871", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d5502f922ed22de44e34c6c78b7dd9e6d8ebe871", "committedDate": "2020-04-20T15:22:59Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5502f922ed22de44e34c6c78b7dd9e6d8ebe871", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d5502f922ed22de44e34c6c78b7dd9e6d8ebe871", "committedDate": "2020-04-20T15:22:59Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "7e2332e9419d5fce5d1a65fe6b23abf5c8bfd1e1", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7e2332e9419d5fce5d1a65fe6b23abf5c8bfd1e1", "committedDate": "2020-04-20T15:34:07Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d9eb31558c7eb02c0abcc1f4dd75e50e5038bf6", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0d9eb31558c7eb02c0abcc1f4dd75e50e5038bf6", "committedDate": "2020-04-20T15:36:50Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e2332e9419d5fce5d1a65fe6b23abf5c8bfd1e1", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7e2332e9419d5fce5d1a65fe6b23abf5c8bfd1e1", "committedDate": "2020-04-20T15:34:07Z", "message": "Tool to check Uyuni versions before a release"}, "afterCommit": {"oid": "0d9eb31558c7eb02c0abcc1f4dd75e50e5038bf6", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/0d9eb31558c7eb02c0abcc1f4dd75e50e5038bf6", "committedDate": "2020-04-20T15:36:50Z", "message": "Tool to check Uyuni versions before a release"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTc1NjYz", "url": "https://github.com/uyuni-project/uyuni/pull/2117#pullrequestreview-396575663", "createdAt": "2020-04-20T15:41:27Z", "commit": {"oid": "0d9eb31558c7eb02c0abcc1f4dd75e50e5038bf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1350, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}