{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5OTU2Nzk0", "number": 2467, "title": "Allow pushing Errata to vendor channels when configured", "bodyText": "What does this PR change?\nThis adds a config parameter to allow pushing errata via xml rpc api to vendor channels.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nuyuni-project/uyuni-docs#451\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: manually tested\n\n\n DONE\n\n\nLinks\nFixes SUSE/spacewalk#11981\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-07-31T09:21:16Z", "url": "https://github.com/uyuni-project/uyuni/pull/2467", "merged": true, "mergeCommit": {"oid": "765b2ce26a4992dad885e0846314fe64bd7a2f33"}, "closed": true, "closedAt": "2020-08-21T14:18:31Z", "author": {"login": "lucidd"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_5hjegFqTQ2ODg0NzEzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBAXTogBqjM2Nzg1NTI0NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODQ3MTM2", "url": "https://github.com/uyuni-project/uyuni/pull/2467#pullrequestreview-468847136", "createdAt": "2020-08-17T21:32:13Z", "commit": {"oid": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMTozMjoxM1rOHB7lOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMTo0MjozN1rOHB72eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4NjgxMA==", "bodyText": "Comment does not seem to agree with code", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471786810", "createdAt": "2020-08-17T21:32:13Z", "author": {"login": "moio"}, "path": "java/code/src/com/redhat/rhn/common/conf/ConfigDefaults.java", "diffHunk": "@@ -324,6 +324,11 @@\n      */\n     public static final String AUTOMATIC_SYSTEM_LOCK_CLUSTER_NODES_ENABLED = \"java.automatic_system_lock_cluster_nodes\";\n \n+    /**\n+     * Indicates the salt-api host to connect to (host", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4OTA2OA==", "bodyText": "Maybe you can inline this 2-parameter variant, since it's only called once.", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471789068", "createdAt": "2020-08-17T21:37:34Z", "author": {"login": "moio"}, "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/errata/ErrataHandler.java", "diffHunk": "@@ -1384,19 +1402,34 @@ public Errata publishAsOriginal(User loggedInUser, String advisory,\n      * @return a List of channel objects\n      */\n     private List<Channel> verifyChannelList(List<String> channelsLabels, User user) {\n+        return verifyChannelList(channelsLabels, user, Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4OTIxOA==", "bodyText": "Maybe add Javadoc for vendorChannelOverride", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471789218", "createdAt": "2020-08-17T21:37:54Z", "author": {"login": "moio"}, "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/errata/ErrataHandler.java", "diffHunk": "@@ -1384,19 +1402,34 @@ public Errata publishAsOriginal(User loggedInUser, String advisory,\n      * @return a List of channel objects\n      */\n     private List<Channel> verifyChannelList(List<String> channelsLabels, User user) {\n+        return verifyChannelList(channelsLabels, user, Collections.emptyList());\n+    }\n+\n+    /**\n+     * Verify a list of channels labels, and populate their corresponding\n+     *      Channel objects into a List.  This is primarily used before publishing\n+     *      to verify all channels are valid before starting the errata creation\n+     * @param channelsLabels the List of channel labels to verify\n+     * @return a List of channel objects", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc5MTIyNg==", "bodyText": "I would suggest to add a bit more descriptive string here, such as \"Package IDs ... added to vendor channel...\" (just like you did above for the errata editing).", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471791226", "createdAt": "2020-08-17T21:42:37Z", "author": {"login": "moio"}, "path": "java/code/src/com/redhat/rhn/manager/channel/ChannelManager.java", "diffHunk": "@@ -2421,16 +2421,27 @@ public static void disassociateChannelEntries(Channel c) {\n     public static void addPackages(Channel chan, List<Long> packageIds, User user) {\n \n         if (!UserManager.verifyChannelAdmin(user, chan)) {\n-            StringBuilder msg = new StringBuilder(\"User: \");\n-            msg.append(user.getLogin());\n-            msg.append(\" does not have channel admin access to channel: \");\n-            msg.append(chan.getLabel());\n-\n-            LocalizationService ls = LocalizationService.getInstance();\n-            PermissionException pex = new PermissionException(msg.toString());\n-            pex.setLocalizedTitle(ls.getMessage(\"permission.jsp.title.channel\"));\n-            pex.setLocalizedSummary(ls.getMessage(\"permission.jsp.summary.channel\"));\n-            throw pex;\n+            List<String> allowedList = Config.get().getList(ConfigDefaults.ALLOW_ADDING_PATCHES_VIA_API);\n+            if (chan.isVendorChannel() && allowedList.contains(chan.getLabel())) {\n+                log.warn(\"Channel: \" + chan.getLabel() +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c3e4f2277afb265db4f7772f85b5a9a21049ccfb", "committedDate": "2020-07-31T09:22:59Z", "message": "add changelog"}, "afterCommit": {"oid": "bc619411bb152f7d1cb9bce5b6f0eb120d214618", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/bc619411bb152f7d1cb9bce5b6f0eb120d214618", "committedDate": "2020-08-18T12:14:32Z", "message": "add changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94a6756dd011b8eefd52fd1d984cc77f4a30830e", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/94a6756dd011b8eefd52fd1d984cc77f4a30830e", "committedDate": "2020-08-21T08:15:54Z", "message": "rename isRhelChannel to isVendorChannel to be in line with current terminology"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9936eb955f9199019c4a6f0aabd11550e4ec65cc", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/9936eb955f9199019c4a6f0aabd11550e4ec65cc", "committedDate": "2020-08-21T08:15:57Z", "message": "add ALLOW_ADDING_PATCHES_VIA_API config parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48289ac0f1b38105761dbe1f964fe525e966aa65", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/48289ac0f1b38105761dbe1f964fe525e966aa65", "committedDate": "2020-08-21T08:15:57Z", "message": "adapt code to use ALLOW_ADDING_PATCH_VIA_API config parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f21b4e3791c0c12cedf3e4ff05426824bf73b518", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f21b4e3791c0c12cedf3e4ff05426824bf73b518", "committedDate": "2020-08-21T08:16:23Z", "message": "add changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3d2b40779eca4525930fc53307e6bc0f6178abc", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d3d2b40779eca4525930fc53307e6bc0f6178abc", "committedDate": "2020-08-21T08:16:25Z", "message": "only allow sat admin users"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "167e19eca70d9e2af573c99cb18c90bf63df0ced", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/167e19eca70d9e2af573c99cb18c90bf63df0ced", "committedDate": "2020-08-19T08:38:04Z", "message": "only allow sat admin users"}, "afterCommit": {"oid": "d3d2b40779eca4525930fc53307e6bc0f6178abc", "author": {"user": {"login": "lucidd", "name": "Kevin Walter"}}, "url": "https://github.com/uyuni-project/uyuni/commit/d3d2b40779eca4525930fc53307e6bc0f6178abc", "committedDate": "2020-08-21T08:16:25Z", "message": "only allow sat admin users"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1046, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}