{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MTE5NzUx", "number": 2882, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoxNDoxNVrOE73FoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoxNDoxNVrOE73FoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjA0MDAwOnYy", "diffSide": "RIGHT", "path": "susemanager/bin/mgr-setup", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoxNDoxNVrOH3u03A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDo0NDo1NFrOH4H7bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMDkyNA==", "bodyText": "Please add here also a check for not SUSE.\nOn SUSE systems this happens when starting the DB in the systemd start script (systemctl start postgresql).\nYou can check via /etc/os-release that ID_LIKE contains \"suse\":\nif [ -e /etc/os-release ]; then\n   . /etc/os-release\n   if [[ \"$ID_LIKE\" = *\"suse\"* ]]; then\n      echo \"Do something for any SUSE/openSUSE distro\"\n   fi\nfi", "url": "https://github.com/uyuni-project/uyuni/pull/2882#discussion_r528200924", "createdAt": "2020-11-21T14:14:15Z", "author": {"login": "mcalmer"}, "path": "susemanager/bin/mgr-setup", "diffHunk": "@@ -181,7 +182,17 @@ cleanup_hostname() {\n }\n \n setup_db_postgres() {\n+    DATADIR=\"/var/lib/pgsql/data\" \n     systemctl --quiet enable postgresql 2>&1\n+    # Create the PostgreSQL data folder, should it not exist.\n+    if [ ! -f $DATADIR/PG_VERSION ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04df52be6258389ec290de9d768fd249dda32bc7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIxMTQyNw==", "bodyText": "I had two thoughts for not making this distro dependent:\n\nThe folder would already exist for SUSE. Or is postgresql service started only AFTER mgr-setup?\nIt is the same code as in postgresql.service. This is where I got it from. So it wouldn't make a difference what creates it.\n\nOverall adding the distro check shouldn't be more than 2 lines (if/fi) as it is already done at the top of mgr-setup for Java.", "url": "https://github.com/uyuni-project/uyuni/pull/2882#discussion_r528211427", "createdAt": "2020-11-21T15:58:44Z", "author": {"login": "sbluhm"}, "path": "susemanager/bin/mgr-setup", "diffHunk": "@@ -181,7 +182,17 @@ cleanup_hostname() {\n }\n \n setup_db_postgres() {\n+    DATADIR=\"/var/lib/pgsql/data\" \n     systemctl --quiet enable postgresql 2>&1\n+    # Create the PostgreSQL data folder, should it not exist.\n+    if [ ! -f $DATADIR/PG_VERSION ]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMDkyNA=="}, "originalCommit": {"oid": "04df52be6258389ec290de9d768fd249dda32bc7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIzODk4MA==", "bodyText": "I have made the change in my branch and tested it. If you still insist, let me know and I will push it.", "url": "https://github.com/uyuni-project/uyuni/pull/2882#discussion_r528238980", "createdAt": "2020-11-21T20:26:06Z", "author": {"login": "sbluhm"}, "path": "susemanager/bin/mgr-setup", "diffHunk": "@@ -181,7 +182,17 @@ cleanup_hostname() {\n }\n \n setup_db_postgres() {\n+    DATADIR=\"/var/lib/pgsql/data\" \n     systemctl --quiet enable postgresql 2>&1\n+    # Create the PostgreSQL data folder, should it not exist.\n+    if [ ! -f $DATADIR/PG_VERSION ]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMDkyNA=="}, "originalCommit": {"oid": "04df52be6258389ec290de9d768fd249dda32bc7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4NzI0MQ==", "bodyText": "The folder would already exist for SUSE. Or is postgresql service started only AFTER mgr-setup?\n\n\nI think mgr-setup start postgresql the first time.\n\n\nIt is the same code as in postgresql.service. This is where I got it from. So it wouldn't make a difference what creates it.\n\n\nYes, but I fear times when something must be changed in the init process and we do not get the info about it.\nAnd the init code here on my system looks already a bit different then the one in this PR.\nEspecially exporting the correct environment is important. We had in the past a lot of fun with it.\nIf you don't mind I would like to use the initialization provided by the OS vendor.", "url": "https://github.com/uyuni-project/uyuni/pull/2882#discussion_r528587241", "createdAt": "2020-11-23T10:02:49Z", "author": {"login": "mcalmer"}, "path": "susemanager/bin/mgr-setup", "diffHunk": "@@ -181,7 +182,17 @@ cleanup_hostname() {\n }\n \n setup_db_postgres() {\n+    DATADIR=\"/var/lib/pgsql/data\" \n     systemctl --quiet enable postgresql 2>&1\n+    # Create the PostgreSQL data folder, should it not exist.\n+    if [ ! -f $DATADIR/PG_VERSION ]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMDkyNA=="}, "originalCommit": {"oid": "04df52be6258389ec290de9d768fd249dda32bc7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYxMjIwNA==", "bodyText": "Pushed.", "url": "https://github.com/uyuni-project/uyuni/pull/2882#discussion_r528612204", "createdAt": "2020-11-23T10:44:54Z", "author": {"login": "sbluhm"}, "path": "susemanager/bin/mgr-setup", "diffHunk": "@@ -181,7 +182,17 @@ cleanup_hostname() {\n }\n \n setup_db_postgres() {\n+    DATADIR=\"/var/lib/pgsql/data\" \n     systemctl --quiet enable postgresql 2>&1\n+    # Create the PostgreSQL data folder, should it not exist.\n+    if [ ! -f $DATADIR/PG_VERSION ]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMDkyNA=="}, "originalCommit": {"oid": "04df52be6258389ec290de9d768fd249dda32bc7"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3920, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}