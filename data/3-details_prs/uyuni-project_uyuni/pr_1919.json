{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDkyMTg0", "number": 1919, "title": "Support for Amazon Linux 2", "bodyText": "What does this PR change?\nSupport for Amazon Linux 2, which is the recommended OS for AWS.\nTo use:\n# spacewalk-common-channels -a x86_64 amazonlinux2-core amazonlinux2-uyuni-client\n# spacewalk-repo-sync -p amazonlinux2-core-x86_64\n# mgr-create-bootstrap-repo\n\nOnboard normally.\nFor now amazonlinux2-uyuni-client uses the centos7 client tools, but we should add Amazon Linux 2 to OBS before shipping this. Reason is simple: without it we can't support Amazon Linux 2 aaarch64 which is cheaper and it's being used more and more each day.\nWARNING: This PR also requires a SR for uyuni-build-keys at https://build.opensuse.org/project/show/home:juliogonzalezgil:branches:systemsmanagement:Uyuni:Master (will require a SR to systemsmanagement:Uyuni:Master, and a port of the same change to susemanager-build-keys at Head!\nWhat DOES NOT work\n\nAll Amazon Linux instances I created have the same /etc/machine-id: ec214dee1f497e5a0c3f972da49e4684. That's a problem because we us it to identify the instances, so with that you get: 2021-03-23 15:52:57,520 [ajp-nio-0:0:0:0:0:0:0:1-8009-exec-4] WARN  com.suse.manager.reactor.messaging.RegisterMinionEventMessageAction - Minion '10.0.0.82' already registered, updating profile to '10.0.0.139' [ec214dee1f497e5a0c3f972da49e4684] at the logs. Registration does NOT fail, but only one minion shows at the system list, with the IP of '10.0.0.139 but that it's in fact 10.0.0.82. Looks to me as an Amazon Linux bug! I started two instances using the Leap 15.2 images, and they have different /etc/machine-id.\nNOTE: Confirmed by @danielmayor. Thanks Dani! :-)\nNOTE2: This is indeed a bug that some other AMIs (Amazon Images) for other OS share: https://bugs.launchpad.net/ubuntu/+source/cloud-init/+bug/1563951 https://bugs.centos.org/view.php?id=13327. But openSUSE Leap 15.2 does not have it, so it can be fixed there. Uyuni can't do anything, because we must not change the machine-id in case the user already did, and we should not create whitelist to change it in some cases, as the current machine ID from the Amazon Linux image can change if they repackage.\nProduct detection (requires Java changes)\nMonitoring enablement (requires Java changes)\n\nWhat was TESTED and DOES work.\n\nReposync\nBootstrap repo generator\nBootstrap script generator\nBootstrapping as salt minion from WebUI (with an activation key)\nBootstrapping as salt minion from Bootstrap Script (with an activation key)\nsalt minion: Detect Packages requiring an update\nsalt minion: Updating packages (problems with the GPG from Uyuni, but that's not something new)\nsalt minion: Installing a package\nsalt minion: Removing a package\nsalt minion: Running a salt command\nsalt minion: Enabled locale and cpu-mitigations formulas and applied highstate\nBootstrapping as salt ssh minion from WebUI (with an activation key)\nsalt ssh minion: Detect Packages requiring an update\nsalt ssh minion: Updating packages (problems with the GPG from Uyuni, but that's not something new)\nsalt ssh minion: Installing a package\nsalt ssh minion: Removing a package\nsalt ssh minion: Running a salt command\nsalt ssh minion: Enabled locale and cpu-mitigations formulas and applied highstate\nBootstrapping as traditional client from script (with an activation key, most likely won't be supported)\ntraditional: Detect Packages requiring an update\ntraditional: Updating packages (problems with the GPG from Uyuni, but that's not something new)\ntraditional: Installing a package\ntraditional: Removing a package\ntraditional: configuration management, deploy a file\n\nApparently CVE auditing works, or at least I get a image saying that none of my servers are affected (which is true). I asked @Bischoff if he knows how to use a fully updated instance to simulate it being affected by a CVE.\nWhat is NOT tested\n\nPatching. The reposync got information for patches, but nothing applies to our instances. They are too new.\nCVE auditing: don't have any Amazon Linux affected by any CVEs right now (see \"What was tested). I installed milkyway-dummy 1.0 as the testsuite does to detect the CVE-1999-9999 and the UI says The specified CVE number was not found. This can happen for very old or yet-unknown numbers, please also check it for possible typing errors.. However if I look for CVE-2021-23841, works fine and tells me no instances are affected.\n\nConclusion\nTests are looking really good. We can request Amazon Linux to be added to OBS (to see if we can provide a specific salt package for the distribution).\nIon squad has to have a look at the salt package about the CPE error.\n2020-02-14 16:38:31,902 [salt.loaded.int.grains.core:1854][ERROR ][5673] Broken CPE_NAME format in /etc/os-release!\n\nAs it is still present.\nGUI diff\nNo difference.\n\n DONE\n\nDocumentation\n\n\nPR: uyuni-project/uyuni-docs#867\n\n\n DONE\n\n\nTest coverage\n\n\nNo tests: We don't have them for unsupported distributions.\n\n\n DONE\n\n\nLinks\nhttps://hackweek.suse.com/20/projects/testing-gnu-slash-linux-distributions-on-uyuni\n\n DONE\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed\n\nIf you uncheck the checkbox after the PR is created, you will need to re-run changelog_test (see below)\nRe-run a test\nIf you need to re-run a test, please mark the related checkbox, it will be unchecked automatically once it has re-run:\n\n Re-run test \"changelog_test\"\n Re-run test \"backend_unittests_pgsql\"\n Re-run test \"java_lint_checkstyle\"\n Re-run test \"java_pgsql_tests\"\n Re-run test \"ruby_rubocop\"\n Re-run test \"schema_migration_test_oracle\"\n Re-run test \"schema_migration_test_pgsql\"\n Re-run test \"susemanager_unittests\"\n Re-run test \"javascript_lint\"\n Re-run test \"spacecmd_unittests\"", "createdAt": "2020-02-14T17:21:29Z", "url": "https://github.com/uyuni-project/uyuni/pull/1919", "merged": true, "mergeCommit": {"oid": "7ac753910cff7a84d172df35bf34fb15c14fa3b4"}, "closed": true, "closedAt": "2021-03-30T10:03:58Z", "author": {"login": "juliogonzalez"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABeFk0JYgBqjQ0ODg4MzYxNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeHYovogFqTYyMjcwOTg4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ff0d457ef814983e4b52ff1fde636f64dbdbc16", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/4ff0d457ef814983e4b52ff1fde636f64dbdbc16", "committedDate": "2020-02-14T17:17:34Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "e9c0525aa2f631b6edc4b344693da67f6f6d3d66", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e9c0525aa2f631b6edc4b344693da67f6f6d3d66", "committedDate": "2021-03-22T09:11:19Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9c0525aa2f631b6edc4b344693da67f6f6d3d66", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/e9c0525aa2f631b6edc4b344693da67f6f6d3d66", "committedDate": "2021-03-22T09:11:19Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "49b6a7febd7a3e6d0a2848cdd86ffd0919ad14dd", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/49b6a7febd7a3e6d0a2848cdd86ffd0919ad14dd", "committedDate": "2021-03-22T09:13:14Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49b6a7febd7a3e6d0a2848cdd86ffd0919ad14dd", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/49b6a7febd7a3e6d0a2848cdd86ffd0919ad14dd", "committedDate": "2021-03-22T09:13:14Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "b3d6669581f9da4325213cfeacc60c903406bb6b", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b3d6669581f9da4325213cfeacc60c903406bb6b", "committedDate": "2021-03-22T11:04:31Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3d6669581f9da4325213cfeacc60c903406bb6b", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b3d6669581f9da4325213cfeacc60c903406bb6b", "committedDate": "2021-03-22T11:04:31Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "ebaefd08ef44037dcf47b7b76b2e36c15858f20d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ebaefd08ef44037dcf47b7b76b2e36c15858f20d", "committedDate": "2021-03-22T11:17:44Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebaefd08ef44037dcf47b7b76b2e36c15858f20d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ebaefd08ef44037dcf47b7b76b2e36c15858f20d", "committedDate": "2021-03-22T11:17:44Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "43842b9d9c6d79ec3e7db81bfb75e8d5ca619b1d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/43842b9d9c6d79ec3e7db81bfb75e8d5ca619b1d", "committedDate": "2021-03-22T11:27:39Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43842b9d9c6d79ec3e7db81bfb75e8d5ca619b1d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/43842b9d9c6d79ec3e7db81bfb75e8d5ca619b1d", "committedDate": "2021-03-22T11:27:39Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "f7e2c6c10773f04ce28e11b6a35ef4775145fd2a", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f7e2c6c10773f04ce28e11b6a35ef4775145fd2a", "committedDate": "2021-03-22T11:48:46Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7e2c6c10773f04ce28e11b6a35ef4775145fd2a", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f7e2c6c10773f04ce28e11b6a35ef4775145fd2a", "committedDate": "2021-03-22T11:48:46Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "b6e450f4c40759e5b4c361ddfc34e3883e7c18c9", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b6e450f4c40759e5b4c361ddfc34e3883e7c18c9", "committedDate": "2021-03-22T12:54:57Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6e450f4c40759e5b4c361ddfc34e3883e7c18c9", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b6e450f4c40759e5b4c361ddfc34e3883e7c18c9", "committedDate": "2021-03-22T12:54:57Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "8c792de5ffec6c92b3ad38c704b7417d019e39a3", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8c792de5ffec6c92b3ad38c704b7417d019e39a3", "committedDate": "2021-03-22T13:24:07Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c792de5ffec6c92b3ad38c704b7417d019e39a3", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/8c792de5ffec6c92b3ad38c704b7417d019e39a3", "committedDate": "2021-03-22T13:24:07Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "2a3fc2032f6e2d936e6a82c7ac4dd4002a5a7ea8", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2a3fc2032f6e2d936e6a82c7ac4dd4002a5a7ea8", "committedDate": "2021-03-22T13:26:37Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a3fc2032f6e2d936e6a82c7ac4dd4002a5a7ea8", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2a3fc2032f6e2d936e6a82c7ac4dd4002a5a7ea8", "committedDate": "2021-03-22T13:26:37Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "a652c158dfc76cef094754428e296cfef468346d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a652c158dfc76cef094754428e296cfef468346d", "committedDate": "2021-03-22T15:39:15Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a652c158dfc76cef094754428e296cfef468346d", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a652c158dfc76cef094754428e296cfef468346d", "committedDate": "2021-03-22T15:39:15Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "2d099c579ef67d198208fc4d437713b1032ff02b", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2d099c579ef67d198208fc4d437713b1032ff02b", "committedDate": "2021-03-22T15:48:14Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d099c579ef67d198208fc4d437713b1032ff02b", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/2d099c579ef67d198208fc4d437713b1032ff02b", "committedDate": "2021-03-22T15:48:14Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "ae45b1103ac947eef4b945edb911ab66ab048151", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ae45b1103ac947eef4b945edb911ab66ab048151", "committedDate": "2021-03-22T15:56:20Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae45b1103ac947eef4b945edb911ab66ab048151", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/ae45b1103ac947eef4b945edb911ab66ab048151", "committedDate": "2021-03-22T15:56:20Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "315f348e2efa595ef9af6df9431851ea1f7b79e6", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/315f348e2efa595ef9af6df9431851ea1f7b79e6", "committedDate": "2021-03-22T16:09:09Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "315f348e2efa595ef9af6df9431851ea1f7b79e6", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/315f348e2efa595ef9af6df9431851ea1f7b79e6", "committedDate": "2021-03-22T16:09:09Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "c43f19ab8ffd09a55765d91ca473c786da181a74", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c43f19ab8ffd09a55765d91ca473c786da181a74", "committedDate": "2021-03-22T16:16:07Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c43f19ab8ffd09a55765d91ca473c786da181a74", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c43f19ab8ffd09a55765d91ca473c786da181a74", "committedDate": "2021-03-22T16:16:07Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "7323e80548ca3e8a14c56ae44981090a14abaf9a", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7323e80548ca3e8a14c56ae44981090a14abaf9a", "committedDate": "2021-03-22T16:19:30Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE4NTg4MTI5", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-618588129", "createdAt": "2021-03-23T13:29:44Z", "commit": {"oid": "7323e80548ca3e8a14c56ae44981090a14abaf9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yM1QxMzoyOTo0NFrOI7yuSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yM1QxMzoyOTo0NFrOI7yuSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTU2Nzk0NA==", "bodyText": "I think you need to create a new Amazon2.sls file here if you want to install the Amazon Linux 2 repo key. See https://github.com/paususe/uyuni/blob/492f64fca41f1292444690e8b42e16a812b28970/susemanager-utils/susemanager-sls/salt/certs/Alibaba2.sls", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r599567944", "createdAt": "2021-03-23T13:29:44Z", "author": {"login": "paususe"}, "path": "susemanager-utils/susemanager-sls/salt/certs/Amazon2.sls", "diffHunk": "@@ -0,0 +1 @@\n+RedHat7.sls", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7323e80548ca3e8a14c56ae44981090a14abaf9a"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7323e80548ca3e8a14c56ae44981090a14abaf9a", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/7323e80548ca3e8a14c56ae44981090a14abaf9a", "committedDate": "2021-03-22T16:19:30Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "224fcaac9a681f9fb0c8000fccd1231ef344b908", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/224fcaac9a681f9fb0c8000fccd1231ef344b908", "committedDate": "2021-03-24T14:41:15Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "224fcaac9a681f9fb0c8000fccd1231ef344b908", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/224fcaac9a681f9fb0c8000fccd1231ef344b908", "committedDate": "2021-03-24T14:41:15Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "c1abc99a74e391fc70140913a32ee1c930ef9e52", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c1abc99a74e391fc70140913a32ee1c930ef9e52", "committedDate": "2021-03-24T15:25:40Z", "message": "Support for Amazon Linux 2 (PoC)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a2c9fe02c445ec2d8c2265ab5721916410a3275c", "committedDate": "2021-03-24T15:34:05Z", "message": "Support for Amazon Linux 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1abc99a74e391fc70140913a32ee1c930ef9e52", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/c1abc99a74e391fc70140913a32ee1c930ef9e52", "committedDate": "2021-03-24T15:25:40Z", "message": "Support for Amazon Linux 2 (PoC)"}, "afterCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "author": {"user": {"login": "juliogonzalez", "name": "Julio Gonz\u00e1lez Gil"}}, "url": "https://github.com/uyuni-project/uyuni/commit/a2c9fe02c445ec2d8c2265ab5721916410a3275c", "committedDate": "2021-03-24T15:34:05Z", "message": "Support for Amazon Linux 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE5OTU1MDU5", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-619955059", "createdAt": "2021-03-24T16:32:53Z", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNFQxNjozMjo1M1rOI81JGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNFQxNjozMjo1M1rOI81JGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NjE1Mw==", "bodyText": "We really need to decide what to do here. Personally I'd add Amazon Linux to OBS and build separate client tools, as Amazon Linux is not a clone of CentOS7, even if it's very similar.\nBesides, if we add Amazon Linux to OBS, we'll be able to support aarch64 as well, which is being used more and more because the EC2 instances with Amazon Linux aarch64 are cheaper.", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r600656153", "createdAt": "2021-03-24T16:32:53Z", "author": {"login": "juliogonzalez"}, "path": "utils/spacewalk-common-channels.ini", "diffHunk": "@@ -2164,3 +2164,41 @@ repo_type = deb\n checksum = sha256\n base_channels = astralinux-orel-pool-amd64\n repo_url = https://download.astralinux.ru/astra/stable/orel/repository/dists/orel/non-free/binary-amd64/\n+\n+[amazonlinux2-core]\n+archs    =  x86_64, aarch64\n+name     = Amazon Linux 2 Core %(arch)s\n+label    = amazonlinux2-core-%(arch)s\n+checksum  = sha256\n+gpgkey_url =\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/core/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-extra-docker]\n+archs    =  x86_64, aarch64\n+name     = Amazon Extras 2 repo for Docker %(arch)s\n+label    = amazonlinux2-extras-docker-%(arch)s\n+base_channels = amazonlinux2-core-%(arch)s\n+checksum = sha256\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/extras/docker/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-uyuni-client]\n+name     = Uyuni Client Tools for %(base_channel_name)s\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE5OTU1MjQ1", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-619955245", "createdAt": "2021-03-24T16:33:02Z", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNFQxNjozMzowM1rOI81JmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNFQxNjozMzowM1rOI81JmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NjI4MA==", "bodyText": "Same here, of course.", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r600656280", "createdAt": "2021-03-24T16:33:03Z", "author": {"login": "juliogonzalez"}, "path": "utils/spacewalk-common-channels.ini", "diffHunk": "@@ -2164,3 +2164,41 @@ repo_type = deb\n checksum = sha256\n base_channels = astralinux-orel-pool-amd64\n repo_url = https://download.astralinux.ru/astra/stable/orel/repository/dists/orel/non-free/binary-amd64/\n+\n+[amazonlinux2-core]\n+archs    =  x86_64, aarch64\n+name     = Amazon Linux 2 Core %(arch)s\n+label    = amazonlinux2-core-%(arch)s\n+checksum  = sha256\n+gpgkey_url =\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/core/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-extra-docker]\n+archs    =  x86_64, aarch64\n+name     = Amazon Extras 2 repo for Docker %(arch)s\n+label    = amazonlinux2-extras-docker-%(arch)s\n+base_channels = amazonlinux2-core-%(arch)s\n+checksum = sha256\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/extras/docker/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-uyuni-client]\n+name     = Uyuni Client Tools for %(base_channel_name)s\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/\n+\n+[amazonlinux2-uyuni-client-devel]\n+name     = Uyuni Client Tools for %(base_channel_name)s (Development)\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Master:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Master:/CentOS7-Uyuni-Client-Tools/CentOS_7/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE5OTU2OTkz", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-619956993", "createdAt": "2021-03-24T16:34:34Z", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNFQxNjozNDozNVrOI81OgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNFQxNjozNDozNVrOI81OgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NzUzNw==", "bodyText": "This is required for the WebUI bootstrap, where system-rpm-config is required.", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r600657537", "createdAt": "2021-03-24T16:34:35Z", "author": {"login": "juliogonzalez"}, "path": "susemanager/src/mgr_bootstrap_data.py", "diffHunk": "@@ -389,6 +389,40 @@\n     \"dmidecode\"\n ]\n \n+AMAZONLINUX2 = [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjIxOTE1ODU0", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-621915854", "createdAt": "2021-03-26T09:10:56Z", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQwOToxMDo1NlrOI-Ok-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQwOToxNDo1N1rOI-Ou3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjEyMTQ2NQ==", "bodyText": "suseRegisterInfo is AFAIK only used for traditional clients. Not sure if you want to support it?", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602121465", "createdAt": "2021-03-26T09:10:56Z", "author": {"login": "mcalmer"}, "path": "suseRegisterInfo/suseRegister/info.py", "diffHunk": "@@ -49,6 +49,10 @@ def getRedHatLikeProducts():\n         ret = parseReleaseInfo(release='/etc/centos-release')\n         if ret:\n             ret['name'] = \"CentOS\"\n+    elif os.path.exists('/etc/system-release'):\n+        ret = parseReleaseInfo(release='/etc/system-release')\n+        if ret:\n+            ret['name'] = \"AmazonLinux\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjEyMzk5OQ==", "bodyText": "When you change this, you should check the java part of the product detection. I think it requires also changes.", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602123999", "createdAt": "2021-03-26T09:14:57Z", "author": {"login": "mcalmer"}, "path": "susemanager-utils/susemanager-sls/salt/packages/redhatproductinfo.sls", "diffHunk": "@@ -11,6 +11,10 @@ oraclerelease:\n   cmd.run:\n     - name: cat /etc/oracle-release\n     - onlyif: test -f /etc/oracle-release\n+amazonrelease:\n+  cmd.run:\n+    - name: cat /etc/system-release\n+    - onlyif: test -f /etc/system-release", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjIyMDU5NzY4", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-622059768", "createdAt": "2021-03-26T12:07:42Z", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjIyNzA5ODg5", "url": "https://github.com/uyuni-project/uyuni/pull/1919#pullrequestreview-622709889", "createdAt": "2021-03-28T00:07:53Z", "commit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yOFQwMDowNzo1M1rOI-4e9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yOFQwMDowNzo1M1rOI-4e9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjgwODA1NQ==", "bodyText": "We can also build aarch64 using CentOS 7", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602808055", "createdAt": "2021-03-28T00:07:53Z", "author": {"login": "paususe"}, "path": "utils/spacewalk-common-channels.ini", "diffHunk": "@@ -2164,3 +2164,41 @@ repo_type = deb\n checksum = sha256\n base_channels = astralinux-orel-pool-amd64\n repo_url = https://download.astralinux.ru/astra/stable/orel/repository/dists/orel/non-free/binary-amd64/\n+\n+[amazonlinux2-core]\n+archs    =  x86_64, aarch64\n+name     = Amazon Linux 2 Core %(arch)s\n+label    = amazonlinux2-core-%(arch)s\n+checksum  = sha256\n+gpgkey_url =\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/core/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-extra-docker]\n+archs    =  x86_64, aarch64\n+name     = Amazon Extras 2 repo for Docker %(arch)s\n+label    = amazonlinux2-extras-docker-%(arch)s\n+base_channels = amazonlinux2-core-%(arch)s\n+checksum = sha256\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/extras/docker/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-uyuni-client]\n+name     = Uyuni Client Tools for %(base_channel_name)s\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NjE1Mw=="}, "originalCommit": {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1667, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}