{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NjI2MTA4", "number": 1933, "title": "Testsuite: Workaround for spacewalk #9165", "bodyText": "What does this PR change?\nAdd a workaround for https://github.com/SUSE/spacewalk/issues/9165\nso that we can configure the proxy via script in the test suite.\n\n\ntestsuite/features/step_definitions/command_steps.rb\nCatch the exception.\n\n\ntestsuite/run_sets/core.yml: Setup the proxy with the script.\nThis is significantly faster that using the GUI; it also\nincreases the test coverage.\n\n\nLinks\nPorts\n\nManager-3.2: https://github.com/SUSE/spacewalk/pull/10785\nManager-4.0: https://github.com/SUSE/spacewalk/pull/10784\n\nChangelogs\nIf you don't need a changelog check, please mark this checkbox:\n\n No changelog needed", "createdAt": "2020-02-20T08:49:54Z", "url": "https://github.com/uyuni-project/uyuni/pull/1933", "merged": true, "mergeCommit": {"oid": "105b7ae68e7361b07303a02d6483124c2d6445d9"}, "closed": true, "closedAt": "2020-02-20T12:25:24Z", "author": {"login": "calancha"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGHb2bgFqTM2MTczMzk1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGJiV2gFqTM2MTgzMTc5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzMzOTUz", "url": "https://github.com/uyuni-project/uyuni/pull/1933#pullrequestreview-361733953", "createdAt": "2020-02-20T09:09:23Z", "commit": {"oid": "f1a342066d839500f603a16679054856ad9717ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzM3NTI4", "url": "https://github.com/uyuni-project/uyuni/pull/1933#pullrequestreview-361737528", "createdAt": "2020-02-20T09:14:48Z", "commit": {"oid": "f1a342066d839500f603a16679054856ad9717ba"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToxNDo0OFrOFsLg_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToxNjozMFrOFsLklA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3MDMzNQ==", "bodyText": "When", "url": "https://github.com/uyuni-project/uyuni/pull/1933#discussion_r381870335", "createdAt": "2020-02-20T09:14:48Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/core/proxy_register_as_minion_with_script.feature", "diffHunk": "@@ -22,9 +22,9 @@ Feature: Setup SUSE Manager proxy\n @proxy\n   Scenario: Accept the key for the proxy\n     Given I am authorized as \"testing\" with password \"testing\"\n-    When I go to the minion onboarding page\n-    Then I should see a \"pending\" text\n-    When I accept \"proxy\" key\n+    And I go to the minion onboarding page", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1a342066d839500f603a16679054856ad9717ba"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3MDkzNA==", "bodyText": "ok, nice, thanks", "url": "https://github.com/uyuni-project/uyuni/pull/1933#discussion_r381870934", "createdAt": "2020-02-20T09:15:55Z", "author": {"login": "Bischoff"}, "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -834,7 +834,14 @@\n   filename = File.basename(path)\n   cmd = \"configure-proxy.sh --non-interactive --rhn-user=admin --rhn-password=admin --answer-file=#{filename}\"\n   proxy_timeout = 600\n-  $proxy.run(cmd, true, proxy_timeout, 'root')\n+  return_code = 0\n+  # Workaround issue https://github.com/SUSE/spacewalk/issues/9165\n+  begin\n+    return_code = $proxy.run(cmd, true, proxy_timeout, 'root')\n+  rescue StandardError => e\n+    puts \"Catched exception (see bsc#1138952): #{e}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1a342066d839500f603a16679054856ad9717ba"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3MTI1Mg==", "bodyText": "Finally... :-)", "url": "https://github.com/uyuni-project/uyuni/pull/1933#discussion_r381871252", "createdAt": "2020-02-20T09:16:30Z", "author": {"login": "Bischoff"}, "path": "testsuite/run_sets/core.yml", "diffHunk": "@@ -23,7 +23,7 @@\n   # one of: proxy_register_as_trad_with_script.feature\n   #         proxy_register_as_minion_with_script.feature\n   #         proxy_register_as_minion_with_gui.feature\n-- features/core/proxy_register_as_minion_with_gui.feature\n+- features/core/proxy_register_as_minion_with_script.feature", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1a342066d839500f603a16679054856ad9717ba"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f1fe3f5159be7ea1d7d053b519e4d2fcc375ab", "author": {"user": {"login": "calancha", "name": "Tino Calancha"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b7f1fe3f5159be7ea1d7d053b519e4d2fcc375ab", "committedDate": "2020-02-20T10:31:00Z", "message": "Testsuite: Workaround for spacewalk #9165\n\nRelated with bsc#1138952\n(see https://github.com/SUSE/spacewalk/issues/9165)\n\n- testsuite/features/step_definitions/command_steps.rb\n  Catch the exception.\n\n- testsuite/run_sets/core.yml: Setup the proxy with the script.\n  This is significantly faster that using the GUI; it also\n  increases the test coverage."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1a342066d839500f603a16679054856ad9717ba", "author": {"user": {"login": "calancha", "name": "Tino Calancha"}}, "url": "https://github.com/uyuni-project/uyuni/commit/f1a342066d839500f603a16679054856ad9717ba", "committedDate": "2020-02-20T08:14:40Z", "message": "Testsuite: Workaround for spacewalk #9165\n\nRelated with bsc#1138952\n(see https://github.com/SUSE/spacewalk/issues/9165)\n\n- testsuite/features/step_definitions/command_steps.rb\n  Catch the exception.\n\n- testsuite/run_sets/core.yml: Setup the proxy with the script.\n  This is significantly faster that using the GUI; it also\n  increases the test coverage."}, "afterCommit": {"oid": "b7f1fe3f5159be7ea1d7d053b519e4d2fcc375ab", "author": {"user": {"login": "calancha", "name": "Tino Calancha"}}, "url": "https://github.com/uyuni-project/uyuni/commit/b7f1fe3f5159be7ea1d7d053b519e4d2fcc375ab", "committedDate": "2020-02-20T10:31:00Z", "message": "Testsuite: Workaround for spacewalk #9165\n\nRelated with bsc#1138952\n(see https://github.com/SUSE/spacewalk/issues/9165)\n\n- testsuite/features/step_definitions/command_steps.rb\n  Catch the exception.\n\n- testsuite/run_sets/core.yml: Setup the proxy with the script.\n  This is significantly faster that using the GUI; it also\n  increases the test coverage."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODMxNzk4", "url": "https://github.com/uyuni-project/uyuni/pull/1933#pullrequestreview-361831798", "createdAt": "2020-02-20T11:36:17Z", "commit": {"oid": "b7f1fe3f5159be7ea1d7d053b519e4d2fcc375ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1678, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}