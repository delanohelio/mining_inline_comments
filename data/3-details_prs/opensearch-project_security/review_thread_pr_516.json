{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MzQzODE4", "number": 516, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMDowNjoxMVrOEIgtBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjozNjowOFrOEIjUHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MzU5ODc4OnYy", "diffSide": "RIGHT", "path": "src/test/resources/roles_bulk.yml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMDowNjoxMVrOGohQsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMDo1NzowOFrOGoi26Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA==", "bodyText": "Should you have here both ? \"create\" and \"auto_create\" ?", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445141168", "createdAt": "2020-06-24T20:06:11Z", "author": {"login": "dinusX"}, "path": "src/test/resources/roles_bulk.yml", "diffHunk": "@@ -17,6 +17,6 @@ bulk:\n     allowed_actions:\n     - \"indices:data/write/index\"\n     - \"indices:admin/mapping/put\"\n-    - \"indices:admin/create\"\n+    - \"indices:admin/auto_create\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MjQyMQ==", "bodyText": "bulk requires only \"auto_create\". I can add \"create\", but it won't be used.", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445142421", "createdAt": "2020-06-24T20:08:38Z", "author": {"login": "vrozov"}, "path": "src/test/resources/roles_bulk.yml", "diffHunk": "@@ -17,6 +17,6 @@ bulk:\n     allowed_actions:\n     - \"indices:data/write/index\"\n     - \"indices:admin/mapping/put\"\n-    - \"indices:admin/create\"\n+    - \"indices:admin/auto_create\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2MTgxNA==", "bodyText": "Looking at the ES PR, I see that they added \"auto_create\" everywhere where \"create\" was present, so ideally we should have both, just in case.\nIn addition to these changes, could you review all the places were we use \"indices:admin/create\" ?\nExample:\nhttps://github.com/opendistro-for-elasticsearch/security/blob/cbcc6245bd923c545fc7e52dabe1bed267ddbf6c/src/main/resources/static_config/static_roles.yml\nhttps://github.com/opendistro-for-elasticsearch/security/blob/a3d7a56e7c21ff011dad66a75389d157732f43fc/src/main/resources/static_config/static_action_groups.yml\nhttps://github.com/opendistro-for-elasticsearch/security/blob/3aef3a3143f30fb95ac499742b80e2de75a355d1/src/main/java/com/amazon/opendistroforelasticsearch/security/support/ConfigConstants.java", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445161814", "createdAt": "2020-06-24T20:46:29Z", "author": {"login": "dinusX"}, "path": "src/test/resources/roles_bulk.yml", "diffHunk": "@@ -17,6 +17,6 @@ bulk:\n     allowed_actions:\n     - \"indices:data/write/index\"\n     - \"indices:admin/mapping/put\"\n-    - \"indices:admin/create\"\n+    - \"indices:admin/auto_create\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NzMzNw==", "bodyText": "We can follow the same approach and replace \"auto_create\" with \"create\" while checking if user is allowed to perform \"auto_create\" action.\nBased on testing restoring snapshot does not require permission for \"auto_create\".", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445167337", "createdAt": "2020-06-24T20:57:08Z", "author": {"login": "vrozov"}, "path": "src/test/resources/roles_bulk.yml", "diffHunk": "@@ -17,6 +17,6 @@ bulk:\n     allowed_actions:\n     - \"indices:data/write/index\"\n     - \"indices:admin/mapping/put\"\n-    - \"indices:admin/create\"\n+    - \"indices:admin/auto_create\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDAyNjUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/securityconf/ConfigModelV7.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjozNjowOFrOGolazg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjo0ODoyMFrOGolqSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIwOTI5NA==", "bodyText": "nit: is ALIAS a string? .equals comparison may be better here.", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445209294", "createdAt": "2020-06-24T22:36:08Z", "author": {"login": "debjanibnrj"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/securityconf/ConfigModelV7.java", "diffHunk": "@@ -743,8 +745,10 @@ public String getUnresolvedIndexPattern(User user) {\n             WildcardMatcher matcher = WildcardMatcher.from(unresolved);\n             String[] resolved = null;\n             if (!(matcher instanceof WildcardMatcher.Exact)) {\n-                final String[] aliasesForPermittedPattern = cs.state().getMetaData().getAliasAndIndexLookup().entrySet().stream()\n-                        .filter(e -> e.getValue().isAlias()).filter(e -> matcher.test(e.getKey())).map(e -> e.getKey())\n+                final String[] aliasesForPermittedPattern = cs.state().getMetadata().getIndicesLookup().entrySet().stream()\n+                        .filter(e -> e.getValue().getType() == ALIAS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3226dbb10f725f79edadcb53c492f6f2c3eb63ed"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxMzI1Nw==", "bodyText": "ALIAS is enum.", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445213257", "createdAt": "2020-06-24T22:48:20Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/securityconf/ConfigModelV7.java", "diffHunk": "@@ -743,8 +745,10 @@ public String getUnresolvedIndexPattern(User user) {\n             WildcardMatcher matcher = WildcardMatcher.from(unresolved);\n             String[] resolved = null;\n             if (!(matcher instanceof WildcardMatcher.Exact)) {\n-                final String[] aliasesForPermittedPattern = cs.state().getMetaData().getAliasAndIndexLookup().entrySet().stream()\n-                        .filter(e -> e.getValue().isAlias()).filter(e -> matcher.test(e.getKey())).map(e -> e.getKey())\n+                final String[] aliasesForPermittedPattern = cs.state().getMetadata().getIndicesLookup().entrySet().stream()\n+                        .filter(e -> e.getValue().getType() == ALIAS)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIwOTI5NA=="}, "originalCommit": {"oid": "3226dbb10f725f79edadcb53c492f6f2c3eb63ed"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2497, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}