{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMjE4Mjg4", "number": 902, "title": "Optimize by avoid creating wildcard matchers for every request ", "bodyText": "opendistro-for-elasticsearch/security pull request intake form\nPlease provide as much details as possible to get feedback/acceptance on your PR quickly\n\nCategory: (Enhancement, New feature, Bug fix, Test fix, Refactoring, Maintenance, Documentation)\n\n\nRefactoring\n\n\nGithub Issue # or road-map entry, if available:\n\n\nN/A\n\n\nDescription of changes:\n\n\nRolesmapping is loaded from the index. For every request, we are creating same wildcard matchers and iterating over them https://github.com/opendistro-for-elasticsearch/security/blob/master/src/main/java/com/amazon/opendistroforelasticsearch/security/privileges/PrivilegesEvaluator.java#L209\nUse HashSet instead of TreeSet (O(1) vs O(log n) for add, remove, contains) and we are not taking any advantage of ordering\n\n\nWhy these changes are required?\n\n\nOptimize creating wildcard matchers and few loops for every request hence improving performance\n\n\nWhat is the old behavior before changes and new behavior after changes? (Please add any example/logs/screen-shot if available)\n\n\nNo changes in behavior\n\n\nTesting done: (Please provide details of testing done: Unit testing, integration testing and manual testing)\n\n\nAutomated tests\n\n\nTO-DOs, if any: (Please describe pending items and provide Github issues# for each of them)\n\n\nFollow up https://github.com/opendistro-for-elasticsearch/security/issues/906\n\n\nIs it backport from master branch? (If yes, please add backport PR # and commits #)\n\n\nNo\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-12-18T00:41:49Z", "url": "https://github.com/opensearch-project/security/pull/902", "merged": true, "mergeCommit": {"oid": "db56dc2eefc91791d965d448df80c53492af19d8"}, "closed": true, "closedAt": "2020-12-22T18:22:18Z", "author": {"login": "sujithvm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnM9IjgH2gAyNTQyMjE4Mjg4OjZlODBhZDQ1NWY3Njc0ZjIzODNkNWM3ZmU3MTFlM2Q2ZDE3OTEzMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdouCUHAFqTU1NzI0NjQ5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6e80ad455f7674f2383d5c7fe711e3d6d1791331", "author": {"user": {"login": "sujithvm", "name": "Sujith Vadakkepat"}}, "url": "https://github.com/opensearch-project/security/commit/6e80ad455f7674f2383d5c7fe711e3d6d1791331", "committedDate": "2020-12-18T00:25:55Z", "message": "Optimize by avoiding creating wildcard matchers for every request for constant resources users, backend roles, hosts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db89e48a600d0f056ec8398107563de40a06acf8", "author": {"user": {"login": "sujithvm", "name": "Sujith Vadakkepat"}}, "url": "https://github.com/opensearch-project/security/commit/db89e48a600d0f056ec8398107563de40a06acf8", "committedDate": "2020-12-18T01:08:55Z", "message": "Use hash set instead of tree set as we are not taking any advantage of ordering"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1ODY3Mjg2", "url": "https://github.com/opensearch-project/security/pull/902#pullrequestreview-555867286", "createdAt": "2020-12-18T22:55:40Z", "commit": {"oid": "db89e48a600d0f056ec8398107563de40a06acf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQyMjo1NTo0MFrOII1H4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQyMjo1NTo0MFrOII1H4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyOTg5MQ==", "bodyText": "nit: not sure if Collection is the best option here. If it is always List, should we use List instead?", "url": "https://github.com/opensearch-project/security/pull/902#discussion_r546129891", "createdAt": "2020-12-18T22:55:40Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/securityconf/ConfigModelV6.java", "diffHunk": "@@ -1100,47 +1100,52 @@ public TenantHolder(SecurityDynamicConfiguration<RoleV6> roles) {\n     private class RoleMappingHolder {\n \n         private ListMultimap<String, String> users;\n-        private ListMultimap<Set<String>, String> abars;\n+        private ListMultimap<Collection<WildcardMatcher>, String> abars;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db89e48a600d0f056ec8398107563de40a06acf8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0a38b2edcdc3f36b7902c902480db6bbc0f1c34", "author": {"user": {"login": "sujithvm", "name": "Sujith Vadakkepat"}}, "url": "https://github.com/opensearch-project/security/commit/c0a38b2edcdc3f36b7902c902480db6bbc0f1c34", "committedDate": "2020-12-18T22:58:37Z", "message": "Convert collection to list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1ODY5MTMx", "url": "https://github.com/opensearch-project/security/pull/902#pullrequestreview-555869131", "createdAt": "2020-12-18T23:01:12Z", "commit": {"oid": "c0a38b2edcdc3f36b7902c902480db6bbc0f1c34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MjQ2NDkx", "url": "https://github.com/opensearch-project/security/pull/902#pullrequestreview-557246491", "createdAt": "2020-12-22T17:32:23Z", "commit": {"oid": "c0a38b2edcdc3f36b7902c902480db6bbc0f1c34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2711, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}