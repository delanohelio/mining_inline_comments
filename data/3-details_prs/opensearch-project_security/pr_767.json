{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyODA1MTU3", "number": 767, "title": "Change CD workflow to use new staging bucket for artifacts", "bodyText": "Description of changes:\nThe infrastructure team is separating the production and staging locations into different AWS accounts. Plugins need to modify their workflows to publish to the new locations.\nThis PR changes the CD workflow to add a build number and write the zip, deb, and rpm plugin artifacts to staging.artifacts.opendistroforelasticsearch.amazon.com. The write to S3 currently fails (see https://github.com/camerski/security/actions/runs/305148456) because the secrets have not been updated; the secrets will be updated at the same time this PR is merged.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-13T20:31:44Z", "url": "https://github.com/opensearch-project/security/pull/767", "merged": true, "mergeCommit": {"oid": "7d933c03ffbe33310194c6564c5deed9fbfa7d80"}, "closed": true, "closedAt": "2020-10-14T22:08:31Z", "author": {"login": "camerski"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSOor7gH2gAyNTAyODA1MTU3OmQxOGUyNDQ4NzcwMWU5MjAxMWMxMDI2YmYxYmYxZWIxMDA0MTc2OWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSknIoAFqTUwODgwMzkyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d18e24487701e92011c1026bf1bf1eb10041769e", "author": {"user": {"login": "camerski", "name": "Cameron Skinner"}}, "url": "https://github.com/opensearch-project/security/commit/d18e24487701e92011c1026bf1bf1eb10041769e", "committedDate": "2020-10-13T20:30:59Z", "message": "Change CD workflow to use new staging bucket for artifacts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODU5Mzgz", "url": "https://github.com/opensearch-project/security/pull/767#pullrequestreview-507859383", "createdAt": "2020-10-13T22:00:47Z", "commit": {"oid": "d18e24487701e92011c1026bf1bf1eb10041769e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMjowMDo0N1rOHg7Bdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMjowMDo0N1rOHg7Bdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI4MzUxMA==", "bodyText": "Will it be better to modify pom.xml and build.gradle to produce output files in the required format by passing ${GITHUB_RUN_NUMBER}?", "url": "https://github.com/opensearch-project/security/pull/767#discussion_r504283510", "createdAt": "2020-10-13T22:00:47Z", "author": {"login": "vrozov"}, "path": ".github/workflows/cd.yml", "diffHunk": "@@ -50,11 +50,25 @@ jobs:\n \n     - name: Upload Artifacts to S3\n       run: |\n-        s3_path=s3://artifacts.opendistroforelasticsearch.amazon.com/downloads\n-        aws s3 cp artifacts/*.zip $s3_path/elasticsearch-plugins/opendistro-security/\n-        aws s3 cp artifacts/*.deb $s3_path/debs/opendistro-security/\n-        aws s3 cp artifacts/*.rpm $s3_path/rpms/opendistro-security/\n-        aws cloudfront create-invalidation --distribution-id ${{ secrets.DISTRIBUTION_ID }} --paths '/downloads/*'\n+        zip=`ls artifacts/*.zip`\n+        rpm=`ls artifacts/*.rpm`\n+        deb=`ls artifacts/*.deb`\n+\n+        # Inject the build number before the suffix\n+        zip_outfile=`basename ${zip%.zip}-build-${GITHUB_RUN_NUMBER}.zip`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d18e24487701e92011c1026bf1bf1eb10041769e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODc3MTkx", "url": "https://github.com/opensearch-project/security/pull/767#pullrequestreview-507877191", "createdAt": "2020-10-13T22:38:39Z", "commit": {"oid": "d18e24487701e92011c1026bf1bf1eb10041769e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODAzOTI5", "url": "https://github.com/opensearch-project/security/pull/767#pullrequestreview-508803929", "createdAt": "2020-10-14T22:07:12Z", "commit": {"oid": "d18e24487701e92011c1026bf1bf1eb10041769e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2784, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}