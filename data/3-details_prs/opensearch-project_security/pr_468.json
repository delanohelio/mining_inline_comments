{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNTMzMDQz", "number": 468, "title": "Refactor Base64Helper class", "bodyText": "Description of changes:\n\nintroduced SafeObjectOutputStream to catch unauthorized serializations\nintroduced Base64HelperTest\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-05-20T06:20:42Z", "url": "https://github.com/opensearch-project/security/pull/468", "merged": true, "mergeCommit": {"oid": "84bdd62e426efafa24c02bc4c376655751b025ce"}, "closed": true, "closedAt": "2020-05-26T04:14:31Z", "author": {"login": "vrozov"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjC-YrgH2gAyNDIwNTMzMDQzOjVkMjU0MTJiZmUxM2U2MzdjYTgyMjE3NDA1YzY2ZjVmYTViMDU5NWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjP4NOAFqTQxNTcyNDI5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b", "author": {"user": {"login": "vrozov", "name": "Vlad Rozov"}}, "url": "https://github.com/opensearch-project/security/commit/5d25412bfe13e637ca82217405c66f5fa5b0595b", "committedDate": "2020-05-20T06:21:23Z", "message": "Refactor Base64Helper class\n- introduced SafeObjectOutputStream to catch unauthorized serializations\n- introduced Base64HelperTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b", "author": {"user": {"login": "vrozov", "name": "Vlad Rozov"}}, "url": "https://github.com/opensearch-project/security/commit/5d25412bfe13e637ca82217405c66f5fa5b0595b", "committedDate": "2020-05-20T06:21:23Z", "message": "Refactor Base64Helper class\n- introduced SafeObjectOutputStream to catch unauthorized serializations\n- introduced Base64HelperTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjY5ODE2", "url": "https://github.com/opensearch-project/security/pull/468#pullrequestreview-415669816", "createdAt": "2020-05-20T19:58:41Z", "commit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxOTo1ODo0MVrOGYbtJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxOTo1ODo0MVrOGYbtJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3MjkzMg==", "bodyText": "Should this be a Set as well?", "url": "https://github.com/opensearch-project/security/pull/468#discussion_r428272932", "createdAt": "2020-05-20T19:58:41Z", "author": {"login": "debjanibnrj"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/support/Base64Helper.java", "diffHunk": "@@ -38,79 +44,123 @@\n import java.io.ObjectInputStream;\n import java.io.ObjectOutputStream;\n import java.io.ObjectStreamClass;\n+import java.io.OutputStream;\n import java.io.Serializable;\n import java.net.InetAddress;\n import java.net.InetSocketAddress;\n import java.net.SocketAddress;\n-import java.util.ArrayList;\n+import java.security.PrivilegedAction;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Pattern;\n \n import org.elasticsearch.ElasticsearchException;\n+import org.elasticsearch.common.Strings;\n \n-import com.amazon.opendistroforelasticsearch.security.resolver.IndexResolverReplacer;\n import com.amazon.opendistroforelasticsearch.security.user.User;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.io.BaseEncoding;\n \n public class Base64Helper {\n \n-    public static String serializeObject(final Serializable object) {\n+    private static final Set<Class<?>> SAFE_CLASSES = ImmutableSet.of(\n+        String.class,\n+        SocketAddress.class,\n+        InetSocketAddress.class,\n+        Pattern.class,\n+        User.class,\n+        SourceFieldsContext.class,\n+        LdapUser.class,\n+        SearchEntry.class,\n+        LdapEntry.class,\n+        AbstractLdapBean.class,\n+        LdapAttribute.class\n+    );\n+\n+    private static final List<Class<?>> SAFE_ASSIGNABLE_FROM_CLASSES = ImmutableList.of(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1Njc1MzY0", "url": "https://github.com/opensearch-project/security/pull/468#pullrequestreview-415675364", "createdAt": "2020-05-20T20:06:46Z", "commit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDowNjo0NlrOGYb91w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDowNjo0NlrOGYb91w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3NzIwNw==", "bodyText": "Is IndexResolverReplacer.Resolved not needed or missed ?", "url": "https://github.com/opensearch-project/security/pull/468#discussion_r428277207", "createdAt": "2020-05-20T20:06:46Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/support/Base64Helper.java", "diffHunk": "@@ -38,79 +44,123 @@\n import java.io.ObjectInputStream;\n import java.io.ObjectOutputStream;\n import java.io.ObjectStreamClass;\n+import java.io.OutputStream;\n import java.io.Serializable;\n import java.net.InetAddress;\n import java.net.InetSocketAddress;\n import java.net.SocketAddress;\n-import java.util.ArrayList;\n+import java.security.PrivilegedAction;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Pattern;\n \n import org.elasticsearch.ElasticsearchException;\n+import org.elasticsearch.common.Strings;\n \n-import com.amazon.opendistroforelasticsearch.security.resolver.IndexResolverReplacer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzAxOTEy", "url": "https://github.com/opensearch-project/security/pull/468#pullrequestreview-415701912", "createdAt": "2020-05-20T20:47:23Z", "commit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzI0Mjkz", "url": "https://github.com/opensearch-project/security/pull/468#pullrequestreview-415724293", "createdAt": "2020-05-20T21:23:24Z", "commit": {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2918, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}