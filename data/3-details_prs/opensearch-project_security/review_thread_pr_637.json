{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0Nzk3MjAz", "number": 637, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMDowNzozMlrOEWgnNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMDoxNzowMlrOEWgprw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMDM4NDU0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMDowNzozMlrOG9164g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0MDoyOVrOG-kbGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTc0Ng==", "bodyText": "Is it necessary to create the clone even if excludeSensitiveHeaders is false?", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467499746", "createdAt": "2020-08-08T20:07:32Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMTEyOQ==", "bodyText": "Input can be unmodifiable map. IMO its better to have consistency in what the method is setting for that attribute. It would assign unmodifiable map if excludeSensitiveHeaders is false or modifiable map if true. Retaining current behavior of setting modifiable map in either case.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467501129", "createdAt": "2020-08-08T20:25:20Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTc0Ng=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwNzI1Mw==", "bodyText": "Why does it matter? Where and why it can be modified?", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467507253", "createdAt": "2020-08-08T21:45:02Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTc0Ng=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1NjA3NQ==", "bodyText": "As i ve mentioned in the PR body, retaining the current behavior as it was specifically doing that.\nThis may help in building a redactor module.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r468256075", "createdAt": "2020-08-11T00:21:00Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTc0Ng=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MTY1OA==", "bodyText": "I don't see why is it necessary to keep the original behavior.  It should be redactor module responsibility to create a copy or filter original Map if necessary.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r468261658", "createdAt": "2020-08-11T00:40:29Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTc0Ng=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMDM4NTg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMDowOTo0N1rOG917ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMTo0NjoyOVrOG92YtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTg5OQ==", "bodyText": "headers = Maps.filterEntries(headers, header -> !AUTHORIZATION_HEADER.test(header.getKey()));", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467499899", "createdAt": "2020-08-08T20:09:47Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);\n+            if (excludeSensitiveHeaders) {\n+                headersClone.keySet().removeIf(AUTHORIZATION_HEADER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMTMzOQ==", "bodyText": "What is the advantage of doing this ?", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467501339", "createdAt": "2020-08-08T20:28:08Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);\n+            if (excludeSensitiveHeaders) {\n+                headersClone.keySet().removeIf(AUTHORIZATION_HEADER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTg5OQ=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwNzM4MQ==", "bodyText": "There is no copy/clone, it is a read only filtered view on the original map.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467507381", "createdAt": "2020-08-08T21:46:29Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -307,15 +307,11 @@ public void addRestParams(Map<String,String> params) {\n \n     public void addRestHeaders(Map<String,List<String>> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String, List<String>> headersClone = new HashMap<String, List<String>>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(REST_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(REST_REQUEST_HEADERS, new HashMap<String, List<String>>(headers));\n+            final Map<String, List<String>> headersClone = new HashMap<>(headers);\n+            if (excludeSensitiveHeaders) {\n+                headersClone.keySet().removeIf(AUTHORIZATION_HEADER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ5OTg5OQ=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMDM5MDg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMDoxNzowMlrOG919rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo1MjoxNFrOHERDqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMDQ2Mw==", "bodyText": "Avoid code duplication. Merge addTransportHeaders and addRestHeaders to a single method with one more parameter.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467500463", "createdAt": "2020-08-08T20:17:02Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -339,15 +335,11 @@ void addRestRequestInfo(final RestRequest request, final AuditConfig.Filter filt\n \n     public void addTransportHeaders(Map<String,String> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String,String> headersClone = new HashMap<String,String>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, new HashMap<String,String>(headers));\n+            final Map<String, String> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMTYxOQ==", "bodyText": "Both are accepting different map types.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467501619", "createdAt": "2020-08-08T20:31:28Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -339,15 +335,11 @@ void addRestRequestInfo(final RestRequest request, final AuditConfig.Filter filt\n \n     public void addTransportHeaders(Map<String,String> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String,String> headersClone = new HashMap<String,String>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, new HashMap<String,String>(headers));\n+            final Map<String, String> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMDQ2Mw=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwNzg3MQ==", "bodyText": "Accept Map<String, ?>, value type actually does not matter (or use generic).", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r467507871", "createdAt": "2020-08-08T21:53:30Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -339,15 +335,11 @@ void addRestRequestInfo(final RestRequest request, final AuditConfig.Filter filt\n \n     public void addTransportHeaders(Map<String,String> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String,String> headersClone = new HashMap<String,String>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, new HashMap<String,String>(headers));\n+            final Map<String, String> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMDQ2Mw=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1NzI5Mw==", "bodyText": "Not in favor of merging addTransportHeaders and addRestHeaders into one function with accepting generics as value types will be permissive for consumers.\nMaybe the validation and filtering can be done as a separate function with generics.\nIntention of this PR was not to do a lot of refactor (check PR body). Maybe raise a separate issue?", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r468257293", "createdAt": "2020-08-11T00:25:30Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -339,15 +335,11 @@ void addRestRequestInfo(final RestRequest request, final AuditConfig.Filter filt\n \n     public void addTransportHeaders(Map<String,String> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String,String> headersClone = new HashMap<String,String>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, new HashMap<String,String>(headers));\n+            final Map<String, String> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMDQ2Mw=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NjYyMQ==", "bodyText": "Yes, please open a follow up PR.\n\navoid code duplication. IMO, it is OK to accept generics as AuditMessage does not care in what format Headers are provided.\nheader filtering logic should avoid creating a new map and then removing elements from them.", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r468266621", "createdAt": "2020-08-11T00:59:37Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -339,15 +335,11 @@ void addRestRequestInfo(final RestRequest request, final AuditConfig.Filter filt\n \n     public void addTransportHeaders(Map<String,String> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String,String> headersClone = new HashMap<String,String>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, new HashMap<String,String>(headers));\n+            final Map<String, String> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMDQ2Mw=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzNTgxOA==", "bodyText": "Created #657", "url": "https://github.com/opensearch-project/security/pull/637#discussion_r474235818", "createdAt": "2020-08-20T19:52:14Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AuditMessage.java", "diffHunk": "@@ -339,15 +335,11 @@ void addRestRequestInfo(final RestRequest request, final AuditConfig.Filter filt\n \n     public void addTransportHeaders(Map<String,String> headers, boolean excludeSensitiveHeaders) {\n         if(headers != null && !headers.isEmpty()) {\n-            if(excludeSensitiveHeaders) {\n-                final Map<String,String> headersClone = new HashMap<String,String>(headers)\n-                        .entrySet().stream()\n-                        .filter(map -> !map.getKey().equalsIgnoreCase(AUTHORIZATION_HEADER))\n-                        .collect(Collectors.toMap(p -> p.getKey(), p -> p.getValue()));\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, headersClone);\n-            } else {\n-                auditInfo.put(TRANSPORT_REQUEST_HEADERS, new HashMap<String,String>(headers));\n+            final Map<String, String> headersClone = new HashMap<>(headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUwMDQ2Mw=="}, "originalCommit": {"oid": "ea605549c280f5bdfe0ef62e493b60eda0a60ea4"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2389, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}