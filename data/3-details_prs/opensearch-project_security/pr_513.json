{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MzI0NTcz", "number": 513, "title": "Allow superadmin to update/delete hidden resources required for tenan\u2026", "bodyText": "Description of changes:\n\nAllow superAdmin to update/delete hidden resources required for tenantinfo check. This can update the hidden roles which will be used by tenantinfo check.\nAllow superAdmin to see hidden resources\n\nThe user required to start the kibana process will have kibana_server roles which is currently hidden. The kibana_server will give privileges to properly start kibana and its component. So updating hidden role is required to add the user to the hidden role.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-06-19T22:58:37Z", "url": "https://github.com/opensearch-project/security/pull/513", "merged": true, "mergeCommit": {"oid": "e97d30d204c42c1a9518c85039144fcdadc0e590"}, "closed": true, "closedAt": "2020-06-29T16:34:24Z", "author": {"login": "palashhedau"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvGX_9AFqTQzODQ1ODQzOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvSFEYgFqTQzODY3Nzg3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDU4NDM5", "url": "https://github.com/opensearch-project/security/pull/513#pullrequestreview-438458439", "createdAt": "2020-06-26T17:06:09Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzowNjoxMFrOGpoVqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzowNjoxMFrOGpoVqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw==", "bodyText": "Is it necessary to introduce this method? Should isHidden() be modified to exclude super admin?", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446305707", "createdAt": "2020-06-26T17:06:10Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTY2Mjgx", "url": "https://github.com/opensearch-project/security/pull/513#pullrequestreview-438566281", "createdAt": "2020-06-26T20:10:20Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoxMDo1OFrOGptWfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoxNjoxOVrOGptfRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4NzgzOQ==", "bodyText": "It will be good to understand the desired behavior here. If super admin is able to see a role, should she be able to assign that role to a user? @debjanibnrj", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446387839", "createdAt": "2020-06-26T20:10:58Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/InternalUsersApiAction.java", "diffHunk": "@@ -121,7 +121,7 @@ protected void handlePut(RestChannel channel, final RestRequest request, final C\n             final SecurityDynamicConfiguration<?> rolesConfiguration = load(CType.ROLES, false);\n             for (final String role: opendistroSecurityRoles) {\n \n-                if (!rolesConfiguration.exists(role) || isHidden(rolesConfiguration, role)) {\n+                if (!rolesConfiguration.exists(role) || rolesConfiguration.isHidden(role)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4OTEyNA==", "bodyText": "Please add a super admin test case that checks that the resource is visible and marked as hidden.", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446389124", "createdAt": "2020-06-26T20:13:57Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -174,17 +174,20 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertFalse(response.getBody().contains(\"Resource 'GET_UT' is read-only.\"));\n \n         // -- GET_UT hidden resource, must be 404\n-        rh.sendAdminCertificate = true;\n+        rh.sendAdminCertificate = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng==", "bodyText": "For \"OK\" response, should it also check the content of the response?", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446390086", "createdAt": "2020-06-26T20:16:19Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,7 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjM0Njc5", "url": "https://github.com/opensearch-project/security/pull/513#pullrequestreview-438634679", "createdAt": "2020-06-26T22:48:55Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo0ODo1NVrOGpwqxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo0ODo1NVrOGpwqxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MjE4Mw==", "bodyText": "nit: it is better to check for the status code first. When test does not fail, it does not matter, but may help with debugging if test fails. The same applies to all other places where response returns success code.", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446442183", "createdAt": "2020-06-26T22:48:55Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,8 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertTrue(response.getBody().contains(\"\\\"hidden\\\":true\"));\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "511eb1b812d23d5a9e94b6da58743ac4fed23fca", "author": {"user": null}, "url": "https://github.com/opensearch-project/security/commit/511eb1b812d23d5a9e94b6da58743ac4fed23fca", "committedDate": "2020-06-26T23:11:24Z", "message": "Allow superadmin to update/delete hidden resources required for tenantinfo check. This can update the hidden roles which will be used bt tenantinfo check.\n\nAdded test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjYxOTU3", "url": "https://github.com/opensearch-project/security/pull/513#pullrequestreview-438661957", "createdAt": "2020-06-27T01:39:47Z", "commit": {"oid": "511eb1b812d23d5a9e94b6da58743ac4fed23fca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Njc3ODc5", "url": "https://github.com/opensearch-project/security/pull/513#pullrequestreview-438677879", "createdAt": "2020-06-27T06:44:21Z", "commit": {"oid": "511eb1b812d23d5a9e94b6da58743ac4fed23fca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2962, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}