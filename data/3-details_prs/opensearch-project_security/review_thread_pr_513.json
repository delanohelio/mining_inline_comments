{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MzI0NTcz", "number": 513, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzowNjoxMFrOEJNDoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo0ODo1NVrOEJSQIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDg2NTYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzowNjoxMFrOGpoVqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxMjoyNFrOGpr36Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw==", "bodyText": "Is it necessary to introduce this method? Should isHidden() be modified to exclude super admin?", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446305707", "createdAt": "2020-06-26T17:06:10Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwODEwNA==", "bodyText": "I was thinking about modifying but there are some occurrences in the code where they require isHidden and hence can not modify.\nAlso it is consistent to the isReserved, but thats a second excuse.", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446308104", "createdAt": "2020-06-26T17:11:13Z", "author": {"login": "palashhedau"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, "originalCommit": null, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMDgyNg==", "bodyText": "The PR makes \"hidden\" resource to be \"visible\" to super admin, should not the other occurrences of isHidden() be replaced too?", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446320826", "createdAt": "2020-06-26T17:37:52Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, "originalCommit": null, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNTg4NA==", "bodyText": "Most of them are replaced.\nThe only one which is not replaced is the GET request where we have to specify if it is a hidden resource or not in the response\nhttps://github.com/opendistro-for-elasticsearch/security/blob/master/src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AccountApiAction.java#L140", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446325884", "createdAt": "2020-06-26T17:48:36Z", "author": {"login": "palashhedau"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, "originalCommit": null, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0MzUyNQ==", "bodyText": "IMO, it will be better to change one place instead of changing multiple locations. Introduce isHidden(String resourceName) into SecurityDynamicConfiguration and call it directly from GET.", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446343525", "createdAt": "2020-06-26T18:26:51Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, "originalCommit": null, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MzYyNQ==", "bodyText": "I can remove the isHidden function alltogether itself from AbstractApiAction as it might look like some code duplication.\nisHidden will point to SecurityDynamicConfiguration and wherever supderAdmin check is required will be added like\nisHidden && superAdmin()\nOr do you want the way you said. IsHidden at both the location, only single GET request points to SecurityDynamicConfiguration", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446363625", "createdAt": "2020-06-26T19:12:24Z", "author": {"login": "palashhedau"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, "originalCommit": null, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTM3Mzg4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/InternalUsersApiAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoxMDo1OFrOGptWfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoxMDo1OFrOGptWfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4NzgzOQ==", "bodyText": "It will be good to understand the desired behavior here. If super admin is able to see a role, should she be able to assign that role to a user? @debjanibnrj", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446387839", "createdAt": "2020-06-26T20:10:58Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/InternalUsersApiAction.java", "diffHunk": "@@ -121,7 +121,7 @@ protected void handlePut(RestChannel channel, final RestRequest request, final C\n             final SecurityDynamicConfiguration<?> rolesConfiguration = load(CType.ROLES, false);\n             for (final String role: opendistroSecurityRoles) {\n \n-                if (!rolesConfiguration.exists(role) || isHidden(rolesConfiguration, role)) {\n+                if (!rolesConfiguration.exists(role) || rolesConfiguration.isHidden(role)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTM4MjUzOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoxMzo1N1rOGptbhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMTo1OTo1MlrOGpv33g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4OTEyNA==", "bodyText": "Please add a super admin test case that checks that the resource is visible and marked as hidden.", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446389124", "createdAt": "2020-06-26T20:13:57Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -174,17 +174,20 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertFalse(response.getBody().contains(\"Resource 'GET_UT' is read-only.\"));\n \n         // -- GET_UT hidden resource, must be 404\n-        rh.sendAdminCertificate = true;\n+        rh.sendAdminCertificate = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyOTE1MA==", "bodyText": "I didnt wanted it it be false as I have separate test cases for it.\nI should have reverted it, but I guess, i missed out. Reverting now", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446429150", "createdAt": "2020-06-26T21:59:52Z", "author": {"login": "palashhedau"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -174,17 +174,20 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertFalse(response.getBody().contains(\"Resource 'GET_UT' is read-only.\"));\n \n         // -- GET_UT hidden resource, must be 404\n-        rh.sendAdminCertificate = true;\n+        rh.sendAdminCertificate = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4OTEyNA=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTM4ODMyOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoxNjoxOVrOGptfRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjozNDo0N1rOGpwddQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng==", "bodyText": "For \"OK\" response, should it also check the content of the response?", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446390086", "createdAt": "2020-06-26T20:16:19Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,7 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzMTU5Mg==", "bodyText": "We can add. Adding a few now", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446431592", "createdAt": "2020-06-26T22:07:56Z", "author": {"login": "palashhedau"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,7 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzODc3Mw==", "bodyText": "added", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446438773", "createdAt": "2020-06-26T22:34:47Z", "author": {"login": "palashhedau"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,7 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTcxNjgzOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo0ODo1NVrOGpwqxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoxNToyMVrOGpxB_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MjE4Mw==", "bodyText": "nit: it is better to check for the status code first. When test does not fail, it does not matter, but may help with debugging if test fails. The same applies to all other places where response returns success code.", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446442183", "createdAt": "2020-06-26T22:48:55Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,8 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertTrue(response.getBody().contains(\"\\\"hidden\\\":true\"));\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0ODEyNQ==", "bodyText": "done", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446448125", "createdAt": "2020-06-26T23:15:21Z", "author": {"login": "palashhedau"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,8 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertTrue(response.getBody().contains(\"\\\"hidden\\\":true\"));\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MjE4Mw=="}, "originalCommit": null, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2491, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}