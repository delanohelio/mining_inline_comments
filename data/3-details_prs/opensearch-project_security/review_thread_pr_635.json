{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjk4Nzcx", "number": 635, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzozNDo1MVrOEV7SkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0OTo1NFrOEV7nTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDI2OTYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzozNDo1MVrOG89jAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzozNDo1MVrOG89jAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3NjEzMA==", "bodyText": "Something does not look correct here.\nMethod is \"isHiddenAndAccessible\" but it returns \"false\" when object is hidden and not super admin.\nThis is  too confusing.\nCan we name it instead  \"isAccessible\" or convert it to opposite \"isInaccessible\" or any other name that is less confusing.", "url": "https://github.com/opensearch-project/security/pull/635#discussion_r466576130", "createdAt": "2020-08-06T17:34:51Z", "author": {"login": "dinusX"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -581,4 +583,11 @@ protected boolean isReadOnlyAndAccessible(Settings settings, String name) {\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(Settings settings, String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fabbdd70247b554ffc6ebd7a406344a5a816cc76"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDMyMjY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/rest/TenantInfoAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0OTo1NFrOG8-D3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0OTo1NFrOG8-D3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4NDU0MA==", "bodyText": "I just now realized that this check is done only by username. The role mapping can be  based on backend role as well. Is there any other way to make this check based on both criterias.", "url": "https://github.com/opensearch-project/security/pull/635#discussion_r466584540", "createdAt": "2020-08-06T17:49:54Z", "author": {"login": "dinusX"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/rest/TenantInfoAction.java", "diffHunk": "@@ -127,7 +136,46 @@ public void accept(RestChannel channel) throws Exception {\n             }\n         };\n     }\n-    \n+\n+    private boolean isAuthorized() {\n+        final User user = (User)threadContext.getTransient(ConfigConstants.OPENDISTRO_SECURITY_USER);\n+\n+        if (user == null) {\n+            return false;\n+        }\n+\n+        // check if the user is a kibanauser or super admin\n+        if (user.getName().equals(evaluator.kibanaServerUsername()) || adminDns.isAdmin(user)) {\n+            return true;\n+        }\n+\n+        // If user check failed by name and admin, check if the users belong to kibana opendistro role\n+        final Tuple<Long, Settings.Builder> rolesMapping = load(ConfigConstants.CONFIGNAME_ROLES_MAPPING, true);\n+        final Map<String, Object> rolesMappingConfiguration = Utils.convertJsonToxToStructuredMap(rolesMapping.v2().build());\n+\n+        // check if kibanaOpendistroRole is present in RolesMapping and if yes, check if user is a part of this role\n+        if (rolesMappingConfiguration != null) {\n+            String kibanaOpendistroRole = evaluator.kibanaOpendistroRole();\n+            if (Strings.isNullOrEmpty(kibanaOpendistroRole)) {\n+                return false;\n+            }\n+\n+            Map<String, Object> kibanaOpendistroRoleEntry = (Map<String, Object>) rolesMappingConfiguration.getOrDefault(kibanaOpendistroRole, null);\n+\n+            if (kibanaOpendistroRoleEntry != null) {\n+                ArrayList<String> kibanaOpendistroRoleUsers = (ArrayList<String>) kibanaOpendistroRoleEntry.get(\"users\");\n+                return kibanaOpendistroRoleUsers != null && kibanaOpendistroRoleUsers.contains(user.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fabbdd70247b554ffc6ebd7a406344a5a816cc76"}, "originalPosition": 87}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2386, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}