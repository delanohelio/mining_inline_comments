{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MjgzNjA2", "number": 242, "title": "Added SuperAdmin check to allow update/delete/add of reserved config \u2026", "bodyText": "Functionality - Allow superAdmin to add, update and delete the reserved configuration such as roles, roles_mapping, internal_users, action_groups and tenants. Till now, the reserved were loaded from the default configuration present in yml files and now superAdmin has the privileges to do the same.\nTesting - Tested on local to create, update and delete config.\nAdd the Reserved configuration -\ncurl -X PUT https://localhost:9200/_opendistro/_security/api/roles/palash_role -k -H 'Content-Type: application/json' -d '\n{\n\"reserved\": true,\n\"description\": \"This is Palash default role\",\n\"cluster_permissions\": [],\n\"index_permissions\" : [\n{\n\"index_patterns\" : [],\n\"fls\" : [],\n\"masked_fields\" : [ ],\n\"allowed_actions\" : [\n\"crud\",\"read\"\n]\n}\n],\n\"tenant_permissions\": []\n}'\n{\"status\":\"CREATED\",\"message\":\"'palash_role' created.\"}\nUpdate the reserved configuration\ncurl -X PUT https://localhost:9200/_opendistro/_security/api/roles/palash_role -k -H 'Content-Type: application/json' -d '\n{\n\"reserved\": true,\n\"description\": \"This is Palash default role\",\n\"cluster_permissions\": [],\n\"index_permissions\" : [\n{\n\"index_patterns\" : [],\n\"fls\" : [],\n\"masked_fields\" : [ ],\n\"allowed_actions\" : [\n\"crud\"\n]\n}\n],\n\"tenant_permissions\": []\n}'\n{\"status\":\"OK\",\"message\":\"'palash_role' updated.\"}\nDelete the reserved configuration\ncurl -X DELETE https://localhost:9200/_opendistro/_security/api/roles/palash_role -k\n{\"status\":\"OK\",\"message\":\"'palash_role' deleted.\"}", "createdAt": "2020-02-24T23:28:30Z", "url": "https://github.com/opensearch-project/security/pull/242", "merged": true, "mergeCommit": {"oid": "7e804a58247994f772a637609b6087ca16d593ab"}, "closed": true, "closedAt": "2020-02-26T23:21:34Z", "author": {"login": "palashhedau"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHmBXPAH2gAyMzc5MjgzNjA2OmExMGQ5NTQzYTIyNDMzM2UyMjQwYWIyMTMzNTJiODIwMWNmYTI3YTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIPG0ZAFqTM2NTMxMzIyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a10d9543a224333e2240ab213352b8201cfa27a0", "author": {"user": null}, "url": "https://github.com/opensearch-project/security/commit/a10d9543a224333e2240ab213352b8201cfa27a0", "committedDate": "2020-02-24T23:21:26Z", "message": "Added SuperAdmin check to allow update/delete/add of reserved config without restarting elasticsearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd25120141ebf3a969f28d87d04c09a60a786458", "author": {"user": null}, "url": "https://github.com/opensearch-project/security/commit/dd25120141ebf3a969f28d87d04c09a60a786458", "committedDate": "2020-02-25T01:46:15Z", "message": "Add unit test for disallowing anyone apart from SuperAdmin to alter the reserved resources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzkwNjg2", "url": "https://github.com/opensearch-project/security/pull/242#pullrequestreview-364390686", "createdAt": "2020-02-25T19:33:06Z", "commit": {"oid": "dd25120141ebf3a969f28d87d04c09a60a786458"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMzowNlrOFuSXMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMzowNlrOFuSXMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3OTY2Nw==", "bodyText": "PR looks good to me.\nNot sure if there is a better name for isReservedAndAccessibleToSuperAdmin or maybe use isReserved itself and document that super admins can update reserved resources.", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384079667", "createdAt": "2020-02-25T19:33:06Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -537,4 +538,17 @@ public String getName() {\n \n \tprotected abstract Endpoint getEndpoint();\n \n+\tprotected boolean isSuperAdmin() {\n+\t\tUser user = threadPool.getThreadContext().getTransient(ConfigConstants.OPENDISTRO_SECURITY_USER);\n+\t\treturn adminDNs.isAdmin(user);\n+\t}\n+\n+\tprotected boolean isReservedAndAccessibleToSuperAdmin(final SecurityDynamicConfiguration<?> existingConfiguration,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd25120141ebf3a969f28d87d04c09a60a786458"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36ed503d349bbe1437228019b9f7388495c64e6e", "author": {"user": null}, "url": "https://github.com/opensearch-project/security/commit/36ed503d349bbe1437228019b9f7388495c64e6e", "committedDate": "2020-02-26T01:43:33Z", "message": "Function name change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "321817c808e0f54529d5220fece033a491c78070", "author": {"user": null}, "url": "https://github.com/opensearch-project/security/commit/321817c808e0f54529d5220fece033a491c78070", "committedDate": "2020-02-26T01:51:25Z", "message": "Reverse the logic to make sense to the caller"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjI0NTMw", "url": "https://github.com/opensearch-project/security/pull/242#pullrequestreview-365224530", "createdAt": "2020-02-26T20:39:00Z", "commit": {"oid": "321817c808e0f54529d5220fece033a491c78070"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMDozOTowMFrOFu7XDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMDo1NjoxMVrOFu75ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1MTM3Mw==", "bodyText": "Should we rename it to testActionGroupsApiForNonSuperAdmin() ?", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384751373", "createdAt": "2020-02-26T20:39:00Z", "author": {"login": "hardik-k-shah"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -298,4 +307,36 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertEquals(1, permissions.size());\n         Assert.assertTrue(permissions.contains(\"READ_UT\"));        \n \t}\n+\n+    @Test\n+    public void testActionGroupsApiWithoutCertificate() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321817c808e0f54529d5220fece033a491c78070"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MDI1OQ==", "bodyText": "lets rename sendHTTPClientCertificate to presentAdminCertificate or sendAdminCertificate", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384760259", "createdAt": "2020-02-26T20:56:11Z", "author": {"login": "hardik-k-shah"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -193,9 +195,10 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n \n         // PATCH read only resource, must be forbidden\n+        // SuperAdmin can patch read only resource", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321817c808e0f54529d5220fece033a491c78070"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53c824936c77970804745b3a77844b7b6a2289eb", "author": {"user": null}, "url": "https://github.com/opensearch-project/security/commit/53c824936c77970804745b3a77844b7b6a2289eb", "committedDate": "2020-02-26T21:56:52Z", "message": "Changed test admincert variable name and renamed test function to reflect proper functionality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzEwNzU5", "url": "https://github.com/opensearch-project/security/pull/242#pullrequestreview-365310759", "createdAt": "2020-02-26T23:07:43Z", "commit": {"oid": "53c824936c77970804745b3a77844b7b6a2289eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzEzMjI3", "url": "https://github.com/opensearch-project/security/pull/242#pullrequestreview-365313227", "createdAt": "2020-02-26T23:13:30Z", "commit": {"oid": "53c824936c77970804745b3a77844b7b6a2289eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2995, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}