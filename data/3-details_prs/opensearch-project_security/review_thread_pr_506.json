{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NjY2ODE4", "number": 506, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDozMzo0OFrOEHzwxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTozMDowOFrOEIJDww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NjIzNTU2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/DlsFlsFilterLeafReader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDozMzo0OVrOGnY5aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDozMzo0OVrOGnY5aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk1NTU2Mw==", "bodyText": "nit: pass Salt to MaskedFieldsMap.extractMaskedFields and add private final Salt salt to MaskedFieldsMap.", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r443955563", "createdAt": "2020-06-23T04:33:49Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/DlsFlsFilterLeafReader.java", "diffHunk": "@@ -106,23 +106,25 @@\n     private final MaskedFieldsMap maskedFieldsMap;\n     private final ShardId shardId;\n     private final boolean maskFields;\n+    private final Salt salt;\n \n     private DlsGetEvaluator dge = null;\n \n \n     DlsFlsFilterLeafReader(final LeafReader delegate, final Set<String> includesExcludes,\n                            final Query dlsQuery, final IndexService indexService, final ThreadContext threadContext,\n                            final ClusterService clusterService,\n-                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId) {\n+                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId, final Salt salt) {\n         super(delegate);\n \n-        maskFields = (auditlog.getComplianceConfig().isEnabled() && maskedFields != null && maskedFields.size() > 0);\n+        maskFields = (maskedFields != null && maskedFields.size() > 0);\n \n         this.indexService = indexService;\n         this.threadContext = threadContext;\n         this.clusterService = clusterService;\n         this.auditlog = auditlog;\n-        this.maskedFieldsMap = MaskedFieldsMap.extractMaskedFields(maskFields, maskedFields, auditlog.getComplianceConfig().getSalt16());\n+        this.salt = salt;\n+        this.maskedFieldsMap = MaskedFieldsMap.extractMaskedFields(maskFields, maskedFields, this.salt.getSalt16());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NjI2MDU0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/Salt.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDo1MDo1OVrOGnZJLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDo1MDo1OVrOGnZJLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk1OTU5OQ==", "bodyText": "I don't think it is necessary to limit copyright for this file", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r443959599", "createdAt": "2020-06-23T04:50:59Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/Salt.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Portions Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NjI2MTQ1OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/configuration/SaltTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDo1MToyOFrOGnZJvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNDo1MToyOFrOGnZJvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk1OTc0Mw==", "bodyText": "Add copyright", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r443959743", "createdAt": "2020-06-23T04:51:28Z", "author": {"login": "vrozov"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/configuration/SaltTest.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package com.amazon.opendistroforelasticsearch.security.configuration;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTcyNDgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/DlsFlsFilterLeafReader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTozMDowOFrOGn7Vqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTozMDowOFrOGn7Vqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUxOTg1MA==", "bodyText": "Is the similar check on line 1099 necessary? If it is removed here, should it be also removed in getRuntimeMaskedFieldInfo()?", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r444519850", "createdAt": "2020-06-23T21:30:08Z", "author": {"login": "vrozov"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/DlsFlsFilterLeafReader.java", "diffHunk": "@@ -106,23 +106,25 @@\n     private final MaskedFieldsMap maskedFieldsMap;\n     private final ShardId shardId;\n     private final boolean maskFields;\n+    private final Salt salt;\n \n     private DlsGetEvaluator dge = null;\n \n \n     DlsFlsFilterLeafReader(final LeafReader delegate, final Set<String> includesExcludes,\n                            final Query dlsQuery, final IndexService indexService, final ThreadContext threadContext,\n                            final ClusterService clusterService,\n-                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId) {\n+                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId, final Salt salt) {\n         super(delegate);\n \n-        maskFields = (auditlog.getComplianceConfig().isEnabled() && maskedFields != null && maskedFields.size() > 0);\n+        maskFields = (maskedFields != null && maskedFields.size() > 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2487, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}