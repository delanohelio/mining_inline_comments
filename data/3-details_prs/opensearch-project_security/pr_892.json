{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzEzODg3", "number": 892, "title": "Using SAML subject_key and roles_key in the HTTPSamlAuthenticator", "bodyText": "opendistro-for-elasticsearch/security pull request intake form\nPlease provide as much details as possible to get feedback/acceptance on your PR quickly\n\n\nCategory: (Enhancement, New feature, Bug fix, Test fix, Refactoring, Maintenance, Documentation): Enhancement\n\n\nGithub Issue # or roaddmap entry, if available:: N/A\n\n\nDescription of changes:\nIn HTTPSamlAuthenticator am using SAML roles_key and subject_key as the JWT roles_key and subject_key. This will ensure that while logging/retrieving subject_key and roles_key we are using the SAML key for SAML auth instead of the JWT key.\n\n\nWhy these changes are required?\nThese will improve logging for SAML.\n\n\nWhat is the old behavior before changes and new behavior after changes? (Please add any example/logs/screenshot if avaialble)\n\n\nTesting done: (Please provide details of testing done: Unit testing, integration testing and manaual testing)\nN/A\n\n\nTO-DOs, if any: (_Please describe pending items and provide github issues# for each of them)\nN/A\n\n\nIs it backport from master branch? (If yes, please add backport PR # and commits #)\nN/A\n\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-12-14T18:24:21Z", "url": "https://github.com/opensearch-project/security/pull/892", "merged": true, "mergeCommit": {"oid": "a629421fe4cf207d5d13613370211d2d28a578c4"}, "closed": true, "closedAt": "2020-12-15T00:07:49Z", "author": {"login": "debjanibnrj"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmKgiigFqTU1MTc5ODU2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmM6utAFqTU1MTkyMTcyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNzk4NTY1", "url": "https://github.com/opensearch-project/security/pull/892#pullrequestreview-551798565", "createdAt": "2020-12-14T18:56:36Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxODo1NjozNlrOIFgdAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxODo1OTozN1rOIFgtgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY0NTUwNw==", "bodyText": "don't we need null check/ default fall back for settings.get(\"roles_key\") same like \"subject_key\"?", "url": "https://github.com/opensearch-project/security/pull/892#discussion_r542645507", "createdAt": "2020-12-14T18:56:36Z", "author": {"login": "hardik-k-shah"}, "path": "src/main/java/com/amazon/dlic/auth/http/saml/HTTPSamlAuthenticator.java", "diffHunk": "@@ -339,11 +339,16 @@ private Settings createJwtAuthenticatorSettings(Settings settings) {\n         settingsBuilder.put(jwtSettings);\n \n         if (jwtSettings.get(\"roles_key\") == null && settings.get(\"roles_key\") != null) {\n-            settingsBuilder.put(\"roles_key\", \"roles\");\n+            settingsBuilder.put(\"roles_key\", settings.get(\"roles_key\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY0OTcyOQ==", "bodyText": "any other way to handle default value instead if..else.. condition?", "url": "https://github.com/opensearch-project/security/pull/892#discussion_r542649729", "createdAt": "2020-12-14T18:59:37Z", "author": {"login": "hardik-k-shah"}, "path": "src/main/java/com/amazon/dlic/auth/http/saml/HTTPSamlAuthenticator.java", "diffHunk": "@@ -339,11 +339,16 @@ private Settings createJwtAuthenticatorSettings(Settings settings) {\n         settingsBuilder.put(jwtSettings);\n \n         if (jwtSettings.get(\"roles_key\") == null && settings.get(\"roles_key\") != null) {\n-            settingsBuilder.put(\"roles_key\", \"roles\");\n+            settingsBuilder.put(\"roles_key\", settings.get(\"roles_key\"));\n         }\n \n         if (jwtSettings.get(\"subject_key\") == null) {\n-            settingsBuilder.put(\"subject_key\", \"sub\");\n+            if (settings.get(\"subject_key\") != null) {\n+                settingsBuilder.put(\"subject_key\", settings.get(\"subject_key\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODYzODc5", "url": "https://github.com/opensearch-project/security/pull/892#pullrequestreview-551863879", "createdAt": "2020-12-14T20:24:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDoyNDo1MVrOIFmYOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDoyNDo1MVrOIFmYOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc0MjU4NQ==", "bodyText": "You can just do settings.get(\"roles_key\", \"roles\") which puts default roles is roles_key is absent", "url": "https://github.com/opensearch-project/security/pull/892#discussion_r542742585", "createdAt": "2020-12-14T20:24:51Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/dlic/auth/http/saml/HTTPSamlAuthenticator.java", "diffHunk": "@@ -338,12 +338,12 @@ private Settings createJwtAuthenticatorSettings(Settings settings) {\n \n         settingsBuilder.put(jwtSettings);\n \n-        if (jwtSettings.get(\"roles_key\") == null && settings.get(\"roles_key\") != null) {\n-            settingsBuilder.put(\"roles_key\", \"roles\");\n+        if (jwtSettings.get(\"roles_key\") == null) {\n+            settingsBuilder.put(\"roles_key\", settings.get(\"roles_key\") !=null ? settings.get(\"roles_key\") : \"roles\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f38370a2c089e67344f2aed5b8c6c39ae1a4db8f", "author": {"user": {"login": "debjanibnrj", "name": "Debjani Banerjee"}}, "url": "https://github.com/opensearch-project/security/commit/f38370a2c089e67344f2aed5b8c6c39ae1a4db8f", "committedDate": "2020-12-14T20:43:05Z", "message": "Using SAML subject_key and roles_key in the HTTPSamlAuthenticator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "f38370a2c089e67344f2aed5b8c6c39ae1a4db8f", "author": {"user": {"login": "debjanibnrj", "name": "Debjani Banerjee"}}, "url": "https://github.com/opensearch-project/security/commit/f38370a2c089e67344f2aed5b8c6c39ae1a4db8f", "committedDate": "2020-12-14T20:43:05Z", "message": "Using SAML subject_key and roles_key in the HTTPSamlAuthenticator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODc4NDU5", "url": "https://github.com/opensearch-project/security/pull/892#pullrequestreview-551878459", "createdAt": "2020-12-14T20:45:53Z", "commit": {"oid": "f38370a2c089e67344f2aed5b8c6c39ae1a4db8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTIxNzI5", "url": "https://github.com/opensearch-project/security/pull/892#pullrequestreview-551921729", "createdAt": "2020-12-14T21:49:23Z", "commit": {"oid": "f38370a2c089e67344f2aed5b8c6c39ae1a4db8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2702, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}