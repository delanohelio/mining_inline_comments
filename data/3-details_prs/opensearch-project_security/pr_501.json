{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMjgzMTkz", "number": 501, "title": "Avoid using Basic Authorization header as JWT token", "bodyText": "Issue #, if available: #376\nDescription of changes:\nWhen Authorization header includes \"Basic\" it can't be JWT token, so we don't need to try to parse it as JWT.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-06-11T19:22:42Z", "url": "https://github.com/opensearch-project/security/pull/501", "merged": true, "mergeCommit": {"oid": "e17b0c8f7c73486fe6f752df943841b60dbbf65e"}, "closed": true, "closedAt": "2020-06-26T00:52:23Z", "author": {"login": "vrozov"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqTPsDAH2gAyNDMzMjgzMTkzOjFiNWUzOTEzMGViYTk1ZjJmODdkN2Y3Y2YyNzk2YmExNjZlNTk2MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu4QsbgFqTQzNzk0NjcwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1b5e39130eba95f2f87d7f7cf2796ba166e59609", "author": {"user": {"login": "vrozov", "name": "Vlad Rozov"}}, "url": "https://github.com/opensearch-project/security/commit/1b5e39130eba95f2f87d7f7cf2796ba166e59609", "committedDate": "2020-06-11T19:16:14Z", "message": "Avoid using Basic Authorization header as JWT token"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MjI1MTQ4", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-429225148", "createdAt": "2020-06-11T19:35:53Z", "commit": {"oid": "1b5e39130eba95f2f87d7f7cf2796ba166e59609"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1342b68df46e612351f0bbd80eb8a1376277e893", "author": {"user": {"login": "vrozov", "name": "Vlad Rozov"}}, "url": "https://github.com/opensearch-project/security/commit/1342b68df46e612351f0bbd80eb8a1376277e893", "committedDate": "2020-06-11T20:31:43Z", "message": "Fix NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Mjc2Njgw", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-429276680", "createdAt": "2020-06-11T20:45:55Z", "commit": {"oid": "1b5e39130eba95f2f87d7f7cf2796ba166e59609"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMDo0NTo1NVrOGiuL9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMDo0NTo1NVrOGiuL9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA2MTQ5Mg==", "bodyText": "Instead of skipping basic Auth headers, can we skip any non \"bearer\" headers ?", "url": "https://github.com/opensearch-project/security/pull/501#discussion_r439061492", "createdAt": "2020-06-11T20:45:55Z", "author": {"login": "dinusX"}, "path": "src/main/java/com/amazon/dlic/auth/http/jwt/HTTPJwtAuthenticator.java", "diffHunk": "@@ -51,9 +53,12 @@\n \n     protected final Logger log = LogManager.getLogger(this.getClass());\n \n+    private static final Pattern BASIC = Pattern.compile(\"^\\\\s*Basic\\\\s.*\", Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5e39130eba95f2f87d7f7cf2796ba166e59609"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODM2NDk2", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-431836496", "createdAt": "2020-06-16T19:43:44Z", "commit": {"oid": "1342b68df46e612351f0bbd80eb8a1376277e893"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo0Mzo0NFrOGkqj9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo0NjowOVrOGkqpGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5OTI1NQ==", "bodyText": "According to the specifications the token will always start with \"Basic \". I don't think we should allow spaces before.\nhttps://tools.ietf.org/html/rfc2617#page-5", "url": "https://github.com/opensearch-project/security/pull/501#discussion_r441099255", "createdAt": "2020-06-16T19:43:44Z", "author": {"login": "dinusX"}, "path": "src/main/java/com/amazon/dlic/auth/http/jwt/AbstractHTTPJwtAuthenticator.java", "diffHunk": "@@ -46,17 +48,20 @@\n     private final static Logger log = LogManager.getLogger(AbstractHTTPJwtAuthenticator.class);\n \n     private static final String BEARER = \"bearer \";\n+    private static final Pattern BASIC = Pattern.compile(\"^\\\\s*Basic\\\\s.*\", Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1342b68df46e612351f0bbd80eb8a1376277e893"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwMDU2OQ==", "bodyText": "I see.\nWould be great if you can add a unit-test for this use-case.\nIn addition to this, there might be other \"Authorization\" headers that needs to be checked similarly as \"Basic\".\nI would prefer also to discuss this internally if we should push this change, because usually this issue is happening when users configure incorrectly the order of authentication configurations.", "url": "https://github.com/opensearch-project/security/pull/501#discussion_r441100569", "createdAt": "2020-06-16T19:46:09Z", "author": {"login": "dinusX"}, "path": "src/main/java/com/amazon/dlic/auth/http/jwt/HTTPJwtAuthenticator.java", "diffHunk": "@@ -51,9 +53,12 @@\n \n     protected final Logger log = LogManager.getLogger(this.getClass());\n \n+    private static final Pattern BASIC = Pattern.compile(\"^\\\\s*Basic\\\\s.*\", Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA2MTQ5Mg=="}, "originalCommit": {"oid": "1b5e39130eba95f2f87d7f7cf2796ba166e59609"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0efaf3bf26c4798ef11a18c57f155b70cf60526e", "author": {"user": {"login": "vrozov", "name": "Vlad Rozov"}}, "url": "https://github.com/opensearch-project/security/commit/0efaf3bf26c4798ef11a18c57f155b70cf60526e", "committedDate": "2020-06-19T18:10:28Z", "message": "Add unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQxNzQy", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-437941742", "createdAt": "2020-06-26T00:22:10Z", "commit": {"oid": "0efaf3bf26c4798ef11a18c57f155b70cf60526e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQ1MzYz", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-437945363", "createdAt": "2020-06-26T00:34:59Z", "commit": {"oid": "0efaf3bf26c4798ef11a18c57f155b70cf60526e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQ1NzAy", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-437945702", "createdAt": "2020-06-26T00:36:08Z", "commit": {"oid": "0efaf3bf26c4798ef11a18c57f155b70cf60526e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDozNjowOVrOGpQLZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDozNjowOVrOGpQLZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwOTg2MA==", "bodyText": "Factor out BASIC pattern as it is re-used ?", "url": "https://github.com/opensearch-project/security/pull/501#discussion_r445909860", "createdAt": "2020-06-26T00:36:09Z", "author": {"login": "sujithvm"}, "path": "src/main/java/com/amazon/dlic/auth/http/jwt/AbstractHTTPJwtAuthenticator.java", "diffHunk": "@@ -46,17 +48,20 @@\n     private final static Logger log = LogManager.getLogger(AbstractHTTPJwtAuthenticator.class);\n \n     private static final String BEARER = \"bearer \";\n+    private static final Pattern BASIC = Pattern.compile(\"^\\\\s*Basic\\\\s.*\", Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0efaf3bf26c4798ef11a18c57f155b70cf60526e"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQ2NzA2", "url": "https://github.com/opensearch-project/security/pull/501#pullrequestreview-437946706", "createdAt": "2020-06-26T00:39:31Z", "commit": {"oid": "0efaf3bf26c4798ef11a18c57f155b70cf60526e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2956, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}