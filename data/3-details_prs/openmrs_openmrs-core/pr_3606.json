{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MjE0Mzgx", "number": 3606, "title": "TRUNK-5970: Encounter to handle voided conditions.", "bodyText": "Description of what I changed\n\n\nIssue I worked on\n\n\n\n\nsee https://issues.openmrs.org/browse/TRUNK-5970\nChecklist: I completed these to help reviewers :)\n\n\n\n\n My IDE is configured to follow the code style of this project.\n\n\n I have added tests to cover my changes. (If you refactored\nexisting code that was well tested you do not have to add tests)\n\n\n I ran mvn clean package right before creating this pull request and\nadded all formatting changes to my commit.\n\n\n All new and existing tests passed.\n\n\n My pull request is based on the latest changes of the master branch.", "createdAt": "2020-10-22T11:19:23Z", "url": "https://github.com/openmrs/openmrs-core/pull/3606", "merged": true, "mergeCommit": {"oid": "1406c9ba7a1f2458fc0f4271ac95729daf9d542f"}, "closed": true, "closedAt": "2020-11-18T22:02:04Z", "author": {"login": "icrc-loliveira"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVAE7vAH2gAyNTA4MjE0MzgxOjAzNGI4MDFlMGU5YTE4YzlhOTRkN2Y4NDg1MmMxZDVjNTAwNDMyZjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd1Z9rAFqTUzMzkxMTQxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "034b801e0e9a18c9a94d7f84852c1d5c500432f9", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/034b801e0e9a18c9a94d7f84852c1d5c500432f9", "committedDate": "2020-10-22T11:15:02Z", "message": "Allow encounters to handle voided conditions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7be99c6c4ae75bceb407d5cf908f4dccdca7e87c", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/7be99c6c4ae75bceb407d5cf908f4dccdca7e87c", "committedDate": "2020-10-22T11:15:03Z", "message": "Added filters to remove condition.\nAdded test for remove condition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db8bd0b4c7f3ff8634d33e52f816dd5156552b98", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/db8bd0b4c7f3ff8634d33e52f816dd5156552b98", "committedDate": "2020-10-22T11:15:04Z", "message": "Updated removeCondition conditions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNzQ5MjY4", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-520749268", "createdAt": "2020-10-30T14:56:18Z", "commit": {"oid": "db8bd0b4c7f3ff8634d33e52f816dd5156552b98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1NjoxOFrOHrS2gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1NjoxOFrOHrS2gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1OTY4Mg==", "bodyText": "Let's cleanup this class a little. I believe that 1) it should not extend BaseContextSensitiveTest and that 2) the two mocked services are not needed.\nCan you confirm those two points?\nThen I'd simplify your test so that you setup your encounter with a bunch of conditions in a setup method so that you can work on a reference encounter across all your test cases.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r515159682", "createdAt": "2020-10-30T14:56:18Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1397,85 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getAllConditions_shouldReturnAllCondition(){\n+\t\tEncounter encounter = new Encounter();\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(2,encounter.getAllConditions(true).size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnActiveCondition(){\n+\t\tEncounter encounter = new Encounter();\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\t\t\n+\t\tassertEquals(1,encounter.getConditions().size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void removeConditions_shouldRemoveCondition(){\n+\t\tEncounter encounter = new Encounter();\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\t\t// The condition should be voided\n+\t\tencounter.removeCondition(activeCondition);\n+\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\n+\t\tSet<Condition> a = encounter.getConditions();\n+\t\tSet<Condition> b = encounter.getAllConditions(true);\n+\t\tassertEquals(0,encounter.getConditions().size());\n+\t\tassertEquals(2,encounter.getAllConditions(true).size());\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db8bd0b4c7f3ff8634d33e52f816dd5156552b98"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ab481772cb687e73ad3eb46724a93301635c178", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/3ab481772cb687e73ad3eb46724a93301635c178", "committedDate": "2020-10-30T17:05:47Z", "message": "Added filters to remove condition.\nAdded test for remove condition."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODkyMDc5", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-520892079", "createdAt": "2020-10-30T17:34:51Z", "commit": {"oid": "3ab481772cb687e73ad3eb46724a93301635c178"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzozNDo1MVrOHrZcvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzozNjo1OFrOHrZjLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI2Nzc3NQ==", "bodyText": "private", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r515267775", "createdAt": "2020-10-30T17:34:51Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -26,25 +26,29 @@\n import java.util.Set;\n \n import org.apache.commons.lang3.reflect.FieldUtils;\n+import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n import org.mockito.Mock;\n import org.openmrs.api.EncounterService;\n-import org.openmrs.api.ProviderService;\n import org.openmrs.test.jupiter.BaseContextSensitiveTest;\n \n /**\n  * This class tests the all of the {@link Encounter} non-trivial object methods.\n- * \n+ *\n  * @see Encounter\n  */\n public class EncounterTest extends BaseContextSensitiveTest {\n-\t\n-\t@Mock\n-\tEncounterService encounterService;\n-\t\n+\n \t@Mock\n-\tProviderService providerService;\n-\t\n+\tprivate EncounterService encounterService;\n+\n+\tEncounter encounter;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ab481772cb687e73ad3eb46724a93301635c178"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI2ODYyNw==", "bodyText": "The tested method is named removeCondition (singular).", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r515268627", "createdAt": "2020-10-30T17:35:47Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1401,80 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getAllConditions_shouldReturnAllConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnActiveConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(1, encounter.getConditions().size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void removeConditions_shouldRemoveConditions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ab481772cb687e73ad3eb46724a93301635c178"}, "originalPosition": 1478}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI2OTQyMg==", "bodyText": "Make this extend BaseContextMockTest as discussed on Slack.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r515269422", "createdAt": "2020-10-30T17:36:58Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -26,25 +26,29 @@\n import java.util.Set;\n \n import org.apache.commons.lang3.reflect.FieldUtils;\n+import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n import org.mockito.Mock;\n import org.openmrs.api.EncounterService;\n-import org.openmrs.api.ProviderService;\n import org.openmrs.test.jupiter.BaseContextSensitiveTest;\n \n /**\n  * This class tests the all of the {@link Encounter} non-trivial object methods.\n- * \n+ *\n  * @see Encounter\n  */\n public class EncounterTest extends BaseContextSensitiveTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ab481772cb687e73ad3eb46724a93301635c178"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/15c5e5e8b2e89418550a84e4c65bbdf72db89582", "committedDate": "2020-11-02T08:43:30Z", "message": "PR review changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzQ1NDQw", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-521745440", "createdAt": "2020-11-02T15:41:02Z", "commit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNTo0MTowMlrOHsJ0UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNTo1NzozOVrOHsKkEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2MDI0MA==", "bodyText": "Just name this getCondition(Boolean), there is no need for a different name.\nI know you borrowed this from the logic for the obs getters, but obs is a different situation, the distinction between \"obs\" and \"all obs\" is \"top level\" vs \"including nested in groups\" obs.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516060240", "createdAt": "2020-11-02T15:41:02Z", "author": {"login": "mks-d"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -496,12 +496,42 @@ public void setDiagnoses(Set<Diagnosis> diagnoses) {\n \t * @since 2.4.0, 2.3.1\n \t */\n \tpublic Set<Condition> getConditions() {\n-\t\tif (conditions == null) {\n-\t\t\tconditions = new LinkedHashSet<>();\n+\n+\t\treturn getAllConditions();\n+\t}\n+\n+\t/**\n+\t * Returns all conditions where conditions.encounterId = Encounter.encounterId In practice, this method should\n+\t * not be used very often...\n+\t *\n+\t * @param includeVoided specifies whether or not to include voided Conditions\n+\t * @return Returns the all Conditions.\n+\t * <strong>Should</strong> not return null with null conditions set\n+\t * <strong>Should</strong> get conditions\n+\t */\n+\tpublic Set<Condition> getAllConditions(boolean includeVoided) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2NTcwNw==", "bodyText": "The whole thing could be done with a one-liner:\nreturn Optional.of(conditions).orElse(new LinkedHashSet<>())\n  .stream().filter(o -> includeVoided || !o.getVoided()).collect(Collectors.toSet());", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516065707", "createdAt": "2020-11-02T15:48:27Z", "author": {"login": "mks-d"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -496,12 +496,42 @@ public void setDiagnoses(Set<Diagnosis> diagnoses) {\n \t * @since 2.4.0, 2.3.1\n \t */\n \tpublic Set<Condition> getConditions() {\n-\t\tif (conditions == null) {\n-\t\t\tconditions = new LinkedHashSet<>();\n+\n+\t\treturn getAllConditions();\n+\t}\n+\n+\t/**\n+\t * Returns all conditions where conditions.encounterId = Encounter.encounterId In practice, this method should\n+\t * not be used very often...\n+\t *\n+\t * @param includeVoided specifies whether or not to include voided Conditions\n+\t * @return Returns the all Conditions.\n+\t * <strong>Should</strong> not return null with null conditions set\n+\t * <strong>Should</strong> get conditions\n+\t */\n+\tpublic Set<Condition> getAllConditions(boolean includeVoided) {\n+\t\tif (includeVoided && conditions != null) {\n+\t\t\treturn conditions;\n+\t\t}\n+\n+\t\tSet<Condition> ret = new LinkedHashSet<>();\n+\n+\t\tif (this.conditions != null) {\n+\t\t\tret = this.conditions.stream().filter(o -> includeVoided || !o.getVoided()).collect(Collectors.toSet());\n \t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2OTY0NQ==", "bodyText": "Use Optional.of(conditions).orElse(new LinkedHashSet<>()).", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516069645", "createdAt": "2020-11-02T15:53:50Z", "author": {"login": "mks-d"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -518,19 +548,32 @@ public void setConditions(Set<Condition> conditions) {\n \t * @param condition - the condition to add\n \t */\n \tpublic void addCondition(Condition condition) {\n-\t\tcondition.setEncounter(this);\n-\t\tgetConditions().add(condition);\n+\t\tif (conditions == null) {\n+\t\t\tconditions = new LinkedHashSet<>();\n+\t\t}\n+\n+\t\tif (condition != null) {\n+\t\t\tcondition.setEncounter(this);\n+\t\t\tconditions.add(condition);\n+\t\t}\n \t}\n-\t\n+\n \t/**\n \t * Remove the given condition from the set of conditions for this Encounter\n \t *\n \t * @param condition - the condition to remove\n \t */\n \tpublic void removeCondition(Condition condition) {\n-\t\tif (conditions != null) {\n-\t\t\tconditions.remove(condition);\n+\n+\t\tif (conditions == null) {\n+\t\t\treturn;\n \t\t}\n+\n+\t\tconditions.stream().filter(c -> !c.getVoided() && c.getUuid().equals(condition.getUuid())).forEach(c -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MTU1Ng==", "bodyText": "Put all this in the before() method.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516071556", "createdAt": "2020-11-02T15:56:22Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1401,80 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getAllConditions_shouldReturnAllConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 1447}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MTk4MA==", "bodyText": "Also assert that you get the conditions that you are supposed to get, not just the size of the resulting collection.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516071980", "createdAt": "2020-11-02T15:56:58Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1401,80 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getAllConditions_shouldReturnAllConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(2, encounter.getAllConditions(true).size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 1449}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MjE0Nw==", "bodyText": "Same remarks.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516072147", "createdAt": "2020-11-02T15:57:12Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1401,80 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getAllConditions_shouldReturnAllConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnActiveConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(1, encounter.getConditions().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 1473}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MjQ2Nw==", "bodyText": "Same remarks.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r516072467", "createdAt": "2020-11-02T15:57:39Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1401,80 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getAllConditions_shouldReturnAllConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnActiveConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tassertEquals(1, encounter.getConditions().size());\n+\t}\n+\n+\t/**\n+\t * @see Encounter#removeCondition()\n+\t */\n+\t@Test\n+\tpublic void removeCondition_shouldRemoveConditions() {\n+\n+\t\tCondition activeCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\t\t// The condition should be voided\n+\t\tencounter.removeCondition(activeCondition);\n+\n+\t\tCondition voidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");\n+\t\tvoidedCondition.setCondition(freeText01);\n+\t\tencounter.addCondition(voidedCondition);\n+\n+\t\tSet<Condition> a = encounter.getConditions();\n+\t\tSet<Condition> b = encounter.getAllConditions(true);\n+\t\tassertEquals(0, encounter.getConditions().size());\n+\t\tassertEquals(2, encounter.getAllConditions(true).size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c5e5e8b2e89418550a84e4c65bbdf72db89582"}, "originalPosition": 1502}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a49c1394df8fc655add9c2af397f2f6d95307908", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/a49c1394df8fc655add9c2af397f2f6d95307908", "committedDate": "2020-11-03T10:08:06Z", "message": "PR review changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/b9bd57d759fdfe1060ba406eb186fb6df64c1c35", "committedDate": "2020-11-03T10:08:57Z", "message": "PR review changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b7e344a3c373f7b95ff1ff344988baa59cbdcf", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/80b7e344a3c373f7b95ff1ff344988baa59cbdcf", "committedDate": "2020-11-03T12:23:31Z", "message": "PR review changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MDQ5NzA1", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-526049705", "createdAt": "2020-11-09T09:09:07Z", "commit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOTowOTowN1rOHvlCrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOToyMDo0NFrOHvleNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1MjAxMg==", "bodyText": "Avoid wildcard imports.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519652012", "createdAt": "2020-11-09T09:09:07Z", "author": {"login": "mks-d"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -9,15 +9,7 @@\n  */\n package org.openmrs;\n \n-import java.util.ArrayDeque;\n-import java.util.ArrayList;\n-import java.util.Date;\n-import java.util.Deque;\n-import java.util.HashMap;\n-import java.util.LinkedHashSet;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1MzAzNg==", "bodyText": "Do not just assert the size, assert that the content is the one that is expected.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519653036", "createdAt": "2020-11-09T09:10:50Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1406,75 +1425,31 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis() {\n \t */\n \t@Test\n \tpublic void getAllConditions_shouldReturnAllConditions() {\n-\n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n-\n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n-\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t\t\n+\t\tassertEquals(2, encounter.getConditions(true).size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1MzE0Mw==", "bodyText": "Same here.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519653143", "createdAt": "2020-11-09T09:11:03Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1406,75 +1425,31 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis() {\n \t */\n \t@Test\n \tpublic void getAllConditions_shouldReturnAllConditions() {\n-\n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n-\n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n-\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t\t\n+\t\tassertEquals(2, encounter.getConditions(true).size());\n \t}\n \n \t/**\n \t * @see Encounter#getConditions()\n \t */\n \t@Test\n \tpublic void getConditions_shouldReturnActiveConditions() {\n-\n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n-\n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n+\t\t\n \t\tassertEquals(1, encounter.getConditions().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1MzUxOQ==", "bodyText": "getConditions_shouldReturnNonVoidedConditionsByDefault", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519653519", "createdAt": "2020-11-09T09:11:38Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1406,75 +1425,31 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis() {\n \t */\n \t@Test\n \tpublic void getAllConditions_shouldReturnAllConditions() {\n-\n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n-\n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n-\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t\t\n+\t\tassertEquals(2, encounter.getConditions(true).size());\n \t}\n \n \t/**\n \t * @see Encounter#getConditions()\n \t */\n \t@Test\n \tpublic void getConditions_shouldReturnActiveConditions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1Mzk0NA==", "bodyText": "getConditions_shouldReturnAllConditionsWhenFlagIsTrue", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519653944", "createdAt": "2020-11-09T09:12:20Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1406,75 +1425,31 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis() {\n \t */\n \t@Test\n \tpublic void getAllConditions_shouldReturnAllConditions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1NTEwNA==", "bodyText": "What is this test actually testing?", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519655104", "createdAt": "2020-11-09T09:14:19Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1406,75 +1425,31 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis() {\n \t */\n \t@Test\n \tpublic void getAllConditions_shouldReturnAllConditions() {\n-\n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n-\n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n-\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t\t\n+\t\tassertEquals(2, encounter.getConditions(true).size());\n \t}\n \n \t/**\n \t * @see Encounter#getConditions()\n \t */\n \t@Test\n \tpublic void getConditions_shouldReturnActiveConditions() {\n-\n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n-\n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n+\t\t\n \t\tassertEquals(1, encounter.getConditions().size());\n \t}\n \n \t/**\n-\t * @see Encounter#removeCondition()\n+\t * @see Encounter#removeCondition(Condition)\n \t */\n \t@Test\n \tpublic void removeCondition_shouldRemoveConditions() {\n \n-\t\tCondition activeCondition = new Condition();\n-\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n-\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n-\t\tfreeText.setNonCoded(\"Free text\");\n-\t\tactiveCondition.setCondition(freeText);\n-\t\tencounter.addCondition(activeCondition);\n \t\t// The condition should be voided\n \t\tencounter.removeCondition(activeCondition);\n \n-\t\tCondition voidedCondition = new Condition();\n-\t\tvoidedCondition.setVoided(true);\n-\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n-\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n-\t\tfreeText01.setNonCoded(\"Free text\");\n-\t\tvoidedCondition.setCondition(freeText01);\n-\t\tencounter.addCondition(voidedCondition);\n-\n \t\tSet<Condition> a = encounter.getConditions();\n-\t\tSet<Condition> b = encounter.getAllConditions(true);\n+\t\tSet<Condition> b = encounter.getConditions(true);\n \t\tassertEquals(0, encounter.getConditions().size());\n-\t\tassertEquals(2, encounter.getAllConditions(true).size());\n+\t\tassertEquals(2, encounter.getConditions(true).size());\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1ODE5Mw==", "bodyText": "Give it a real name, that helps people understand what things are about:\nfreeText1.setNonCoded(\"Asthma non-coded\");", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519658193", "createdAt": "2020-11-09T09:19:24Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -43,10 +43,29 @@\n \tprivate EncounterService encounterService;\n \n \tprivate Encounter encounter;\n+\t\n+\tprivate Condition activeCondition;\n+\t\n+\tprivate Condition voidedCondition;\n \n \t@BeforeEach\n \tpublic void before() {\n \t\tencounter = new Encounter();\n+\n+\t\tactiveCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1ODcxNQ==", "bodyText": "Let's name them freeText1 and freeText2.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519658715", "createdAt": "2020-11-09T09:20:11Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -43,10 +43,29 @@\n \tprivate EncounterService encounterService;\n \n \tprivate Encounter encounter;\n+\t\n+\tprivate Condition activeCondition;\n+\t\n+\tprivate Condition voidedCondition;\n \n \t@BeforeEach\n \tpublic void before() {\n \t\tencounter = new Encounter();\n+\n+\t\tactiveCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1OTA2MQ==", "bodyText": "Same here:\nfreeText2.setNonCoded(\"Glaucoma non-coded\");", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r519659061", "createdAt": "2020-11-09T09:20:44Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -43,10 +43,29 @@\n \tprivate EncounterService encounterService;\n \n \tprivate Encounter encounter;\n+\t\n+\tprivate Condition activeCondition;\n+\t\n+\tprivate Condition voidedCondition;\n \n \t@BeforeEach\n \tpublic void before() {\n \t\tencounter = new Encounter();\n+\n+\t\tactiveCondition = new Condition();\n+\t\tactiveCondition.setClinicalStatus(ConditionClinicalStatus.ACTIVE);\n+\t\tCodedOrFreeText freeText = new CodedOrFreeText();\n+\t\tfreeText.setNonCoded(\"Free text\");\n+\t\tactiveCondition.setCondition(freeText);\n+\t\tencounter.addCondition(activeCondition);\n+\n+\t\tvoidedCondition = new Condition();\n+\t\tvoidedCondition.setVoided(true);\n+\t\tvoidedCondition.setClinicalStatus(ConditionClinicalStatus.HISTORY_OF);\n+\t\tCodedOrFreeText freeText01 = new CodedOrFreeText();\n+\t\tfreeText01.setNonCoded(\"Free text\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bd57d759fdfe1060ba406eb186fb6df64c1c35"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75f1a0a7732d930edcf7601921eb661d46b0e15a", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/75f1a0a7732d930edcf7601921eb661d46b0e15a", "committedDate": "2020-11-09T10:25:19Z", "message": "Replaced wildcard imports."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e2af8868405b4dfc4a6a33c2c2e17e0713a8779", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/7e2af8868405b4dfc4a6a33c2c2e17e0713a8779", "committedDate": "2020-11-09T10:37:57Z", "message": "PR review changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12f16de66bde193bb0063c22aa7fa082c1f43bb3", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/12f16de66bde193bb0063c22aa7fa082c1f43bb3", "committedDate": "2020-11-09T10:41:05Z", "message": "PR review changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cebf27418091842ae1fd254839106111b2aed8a", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/4cebf27418091842ae1fd254839106111b2aed8a", "committedDate": "2020-11-09T10:43:55Z", "message": "PR review changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a66f864d81a0503f2c5ce855e602c855dc6b6da", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/2a66f864d81a0503f2c5ce855e602c855dc6b6da", "committedDate": "2020-11-12T09:45:56Z", "message": "Removed untouched changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e70e45ba0a59c2482484175ca53981459723925", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/2e70e45ba0a59c2482484175ca53981459723925", "committedDate": "2020-11-13T15:52:44Z", "message": "Fixed header comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3340d8c4be232e606229d56736bc8d2b2890403", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/b3340d8c4be232e606229d56736bc8d2b2890403", "committedDate": "2020-11-16T15:38:45Z", "message": "Removed untouched changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDU0MjUw", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-531454250", "createdAt": "2020-11-16T15:52:46Z", "commit": {"oid": "b3340d8c4be232e606229d56736bc8d2b2890403"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo1Mjo0NlrOH0FI4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo1NjoyOFrOH0FUsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3MjE5Mg==", "bodyText": "Rename a to conditions or allConditions.\nRename b to voidedConditions.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524372192", "createdAt": "2020-11-16T15:52:46Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1420,40 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnAllConditionsWhenFlagIsTrue() {\n+\n+\t\tassertEquals(2, encounter.getConditions(true).size());\n+\t\tassertTrue(encounter.getConditions(true).contains(activeCondition));\n+\t\tassertTrue(encounter.getConditions(true).contains(voidedCondition));\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnNonVoidedConditionsByDefault() {\n+\n+\t\tassertEquals(1, encounter.getConditions().size());\n+\t\tassertTrue(encounter.getConditions().contains(activeCondition));\n+\t\tassertFalse(encounter.getConditions().contains(voidedCondition));\n+\t}\n+\n+\t/**\n+\t * @see Encounter#removeCondition(Condition)\n+\t */\n+\t@Test\n+\tpublic void removeCondition_shouldRemoveConditions() {\n+\n+\t\t// The condition should be voided\n+\t\tencounter.removeCondition(activeCondition);\n+\n+\t\tSet<Condition> a = encounter.getConditions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3340d8c4be232e606229d56736bc8d2b2890403"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3NTIxOA==", "bodyText": "Did you need to touch that test?", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524375218", "createdAt": "2020-11-16T15:56:28Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/api/EncounterServiceTest.java", "diffHunk": "@@ -414,9 +414,9 @@ public void saveEncounter_shouldCascadeSaveToContainedConditions() {\n \t\tedema = (Condition) conditionsArray[1];\n \t\tassertEquals(2, conditionsArray.length);\n \t\tassertNotNull(pregnancy.getId());\n-\t\tassertEquals(\"Pregnancy\", pregnancy.getCondition().getNonCoded());\n+\t\tassertNotNull(pregnancy.getCondition().getNonCoded());\n \t\tassertNotNull(edema.getId());\n-\t\tassertEquals(\"Edema\", edema.getCondition().getNonCoded());\n+\t\tassertNotNull(edema.getCondition().getNonCoded());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3340d8c4be232e606229d56736bc8d2b2890403"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/43c03c90891c2636ecc14e2be8021b26f70cbc19", "committedDate": "2020-11-16T16:17:47Z", "message": "PR review changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjU3ODAw", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-531657800", "createdAt": "2020-11-16T19:56:09Z", "commit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTo1NjowOVrOH0PDZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTo1NjowOVrOH0PDZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUzNDYyOQ==", "bodyText": "@icrc-loliveira this is burying the issue. We need to understand why our changes are affecting an order that used to be stable.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524534629", "createdAt": "2020-11-16T19:56:09Z", "author": {"login": "mks-d"}, "path": "api/src/test/java/org/openmrs/api/EncounterServiceTest.java", "diffHunk": "@@ -414,9 +414,9 @@ public void saveEncounter_shouldCascadeSaveToContainedConditions() {\n \t\tedema = (Condition) conditionsArray[1];\n \t\tassertEquals(2, conditionsArray.length);\n \t\tassertNotNull(pregnancy.getId());\n-\t\tassertEquals(\"Pregnancy\", pregnancy.getCondition().getNonCoded());\n+\t\tassertNotNull(pregnancy.getCondition().getNonCoded());\n \t\tassertNotNull(edema.getId());\n-\t\tassertEquals(\"Edema\", edema.getCondition().getNonCoded());\n+\t\tassertNotNull(edema.getCondition().getNonCoded());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3NTIxOA=="}, "originalCommit": {"oid": "b3340d8c4be232e606229d56736bc8d2b2890403"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNzIyNjU1", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-531722655", "createdAt": "2020-11-16T20:30:25Z", "commit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMDozMDoyNVrOH0QMKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMDozNDowM1rOH0QTjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1MzI1Ng==", "bodyText": "While the implementation here is simpler, it does potentially break existing code which relies on being able to do, say, getConditions().add(newCondition).", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524553256", "createdAt": "2020-11-16T20:30:25Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -492,16 +493,31 @@ public void setDiagnoses(Set<Diagnosis> diagnoses) {\n \t/**\n \t * Basic property getter for conditions\n \t * \n-\t * @return conditions - set of conditions\n+\t * @return all non-voided conditions\n+\t * <strong>Should</strong> not get voided conditions\n \t * @since 2.4.0, 2.3.1\n \t */\n \tpublic Set<Condition> getConditions() {\n-\t\tif (conditions == null) {\n-\t\t\tconditions = new LinkedHashSet<>();\n-\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1MzMwMQ==", "bodyText": "Shouldn't we just be explicitly relying on the notion of equality here, e.g., filter(c -> !c.getVoided && condition.equals(c))?", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524553301", "createdAt": "2020-11-16T20:30:30Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -518,19 +534,28 @@ public void setConditions(Set<Condition> conditions) {\n \t * @param condition - the condition to add\n \t */\n \tpublic void addCondition(Condition condition) {\n-\t\tcondition.setEncounter(this);\n-\t\tgetConditions().add(condition);\n+\t\tif (conditions == null) {\n+\t\t\tconditions = new LinkedHashSet<>();\n+\t\t}\n+\n+\t\tif (condition != null) {\n+\t\t\tcondition.setEncounter(this);\n+\t\t\tconditions.add(condition);\n+\t\t}\n \t}\n-\t\n+\n \t/**\n \t * Remove the given condition from the set of conditions for this Encounter\n \t *\n \t * @param condition - the condition to remove\n \t */\n \tpublic void removeCondition(Condition condition) {\n-\t\tif (conditions != null) {\n-\t\t\tconditions.remove(condition);\n-\t\t}\n+\t\t\n+\t\tOptional.ofNullable(conditions).orElse(new LinkedHashSet<>()).stream().filter(c -> !c.getVoided() && c.getUuid().equals(condition.getUuid())).forEach(c -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1MzcyMg==", "bodyText": "We should have a void reason when voiding the condition, even if it's as simple as \"Voided by the API\"", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524553722", "createdAt": "2020-11-16T20:31:19Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -518,19 +534,28 @@ public void setConditions(Set<Condition> conditions) {\n \t * @param condition - the condition to add\n \t */\n \tpublic void addCondition(Condition condition) {\n-\t\tcondition.setEncounter(this);\n-\t\tgetConditions().add(condition);\n+\t\tif (conditions == null) {\n+\t\t\tconditions = new LinkedHashSet<>();\n+\t\t}\n+\n+\t\tif (condition != null) {\n+\t\t\tcondition.setEncounter(this);\n+\t\t\tconditions.add(condition);\n+\t\t}\n \t}\n-\t\n+\n \t/**\n \t * Remove the given condition from the set of conditions for this Encounter\n \t *\n \t * @param condition - the condition to remove\n \t */\n \tpublic void removeCondition(Condition condition) {\n-\t\tif (conditions != null) {\n-\t\t\tconditions.remove(condition);\n-\t\t}\n+\t\t\n+\t\tOptional.ofNullable(conditions).orElse(new LinkedHashSet<>()).stream().filter(c -> !c.getVoided() && c.getUuid().equals(condition.getUuid())).forEach(c -> {\n+\t\t\tc.setVoided(true);\n+\t\t\tc.setDateVoided(new Date());\n+\t\t\tc.setVoidedBy(Context.getAuthenticatedUser());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1NDY1Mg==", "bodyText": "I know that condition.equals() doesn't work that way right now, but I thought it was agreed that we'd proceed with an implementation of condition.equals() that only verifies UUID.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524554652", "createdAt": "2020-11-16T20:33:02Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -518,19 +534,28 @@ public void setConditions(Set<Condition> conditions) {\n \t * @param condition - the condition to add\n \t */\n \tpublic void addCondition(Condition condition) {\n-\t\tcondition.setEncounter(this);\n-\t\tgetConditions().add(condition);\n+\t\tif (conditions == null) {\n+\t\t\tconditions = new LinkedHashSet<>();\n+\t\t}\n+\n+\t\tif (condition != null) {\n+\t\t\tcondition.setEncounter(this);\n+\t\t\tconditions.add(condition);\n+\t\t}\n \t}\n-\t\n+\n \t/**\n \t * Remove the given condition from the set of conditions for this Encounter\n \t *\n \t * @param condition - the condition to remove\n \t */\n \tpublic void removeCondition(Condition condition) {\n-\t\tif (conditions != null) {\n-\t\t\tconditions.remove(condition);\n-\t\t}\n+\t\t\n+\t\tOptional.ofNullable(conditions).orElse(new LinkedHashSet<>()).stream().filter(c -> !c.getVoided() && c.getUuid().equals(condition.getUuid())).forEach(c -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1MzMwMQ=="}, "originalCommit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1NTE0OA==", "bodyText": "Shouldn't we also verify that one of the voided conditions has the same UUID as the activeCondition?", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r524555148", "createdAt": "2020-11-16T20:34:03Z", "author": {"login": "ibacher"}, "path": "api/src/test/java/org/openmrs/EncounterTest.java", "diffHunk": "@@ -1397,4 +1420,40 @@ public void hasDiagnosis_shouldReturnFalseIfEncounterDoesNotHaveDiagnosis(){\n \t\tassertFalse(encounter.hasDiagnosis(diagnosis));\n \t}\n \n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnAllConditionsWhenFlagIsTrue() {\n+\n+\t\tassertEquals(2, encounter.getConditions(true).size());\n+\t\tassertTrue(encounter.getConditions(true).contains(activeCondition));\n+\t\tassertTrue(encounter.getConditions(true).contains(voidedCondition));\n+\t}\n+\n+\t/**\n+\t * @see Encounter#getConditions()\n+\t */\n+\t@Test\n+\tpublic void getConditions_shouldReturnNonVoidedConditionsByDefault() {\n+\n+\t\tassertEquals(1, encounter.getConditions().size());\n+\t\tassertTrue(encounter.getConditions().contains(activeCondition));\n+\t\tassertFalse(encounter.getConditions().contains(voidedCondition));\n+\t}\n+\n+\t/**\n+\t * @see Encounter#removeCondition(Condition)\n+\t */\n+\t@Test\n+\tpublic void removeCondition_shouldRemoveConditions() {\n+\n+\t\t// The condition should be voided\n+\t\tencounter.removeCondition(activeCondition);\n+\n+\t\tSet<Condition> allConditions = encounter.getConditions();\n+\t\tSet<Condition> voidedConditions = encounter.getConditions(true);\n+\t\tassertEquals(0, encounter.getConditions().size());\n+\t\tassertEquals(2, encounter.getConditions(true).size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b5c8d26253a85c338e84bc92f72e990f88638e", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/f6b5c8d26253a85c338e84bc92f72e990f88638e", "committedDate": "2020-11-17T12:13:26Z", "message": "PR review changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90cba56516ee6ce68fa2577fe8940cede8615cef", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/90cba56516ee6ce68fa2577fe8940cede8615cef", "committedDate": "2020-11-17T12:15:51Z", "message": "PR review changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDg4Mjk4", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-532488298", "createdAt": "2020-11-17T15:27:18Z", "commit": {"oid": "90cba56516ee6ce68fa2577fe8940cede8615cef"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNToyNzoxOFrOH06g-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNToyNzoxOFrOH06g-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI0NjcxNQ==", "bodyText": "@mks-d I suppose that's fair. And realistically, I don't expect there to be much actual code out there that uses this.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r525246715", "createdAt": "2020-11-17T15:27:18Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/Encounter.java", "diffHunk": "@@ -492,16 +493,31 @@ public void setDiagnoses(Set<Diagnosis> diagnoses) {\n \t/**\n \t * Basic property getter for conditions\n \t * \n-\t * @return conditions - set of conditions\n+\t * @return all non-voided conditions\n+\t * <strong>Should</strong> not get voided conditions\n \t * @since 2.4.0, 2.3.1\n \t */\n \tpublic Set<Condition> getConditions() {\n-\t\tif (conditions == null) {\n-\t\t\tconditions = new LinkedHashSet<>();\n-\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1MzI1Ng=="}, "originalCommit": {"oid": "43c03c90891c2636ecc14e2be8021b26f70cbc19"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDkxNTMx", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-532491531", "createdAt": "2020-11-17T15:30:18Z", "commit": {"oid": "90cba56516ee6ce68fa2577fe8940cede8615cef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTozMDoxOFrOH06y1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTozMDoxOFrOH06y1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI1MTI4NA==", "bodyText": "I'd honestly feel more comfortable with the changes here if we can prove that the same test still passes or, if it doesn't, that the reason it doesn't pass is because of an expected change in behaviour.", "url": "https://github.com/openmrs/openmrs-core/pull/3606#discussion_r525251284", "createdAt": "2020-11-17T15:30:18Z", "author": {"login": "ibacher"}, "path": "api/src/test/java/org/openmrs/api/EncounterServiceTest.java", "diffHunk": "@@ -409,14 +409,10 @@ public void saveEncounter_shouldCascadeSaveToContainedConditions() {\n \t\tContext.getEncounterService().saveEncounter(encounter);\n \t\t\n \t\t// verify\n-\t\tObject[] conditionsArray = encounter.getConditions().toArray();\n-\t\tpregnancy = (Condition) conditionsArray[0];\n-\t\tedema = (Condition) conditionsArray[1];\n-\t\tassertEquals(2, conditionsArray.length);\n-\t\tassertNotNull(pregnancy.getId());\n-\t\tassertEquals(\"Pregnancy\", pregnancy.getCondition().getNonCoded());\n-\t\tassertNotNull(edema.getId());\n-\t\tassertEquals(\"Edema\", edema.getCondition().getNonCoded());\n+\t\tSet<Condition> savedConditions = encounter.getConditions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90cba56516ee6ce68fa2577fe8940cede8615cef"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d28a73677edee16950caf7bb16e90e284860f84b", "author": {"user": {"login": "mks-d", "name": "Dimitri R"}}, "url": "https://github.com/openmrs/openmrs-core/commit/d28a73677edee16950caf7bb16e90e284860f84b", "committedDate": "2020-11-18T21:46:29Z", "message": "Improved JavaDoc + renamed 'o' to 'c' for condition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d68c6eca2dec7d814f4cb0e78bea7c29f2801635", "author": {"user": {"login": "mks-d", "name": "Dimitri R"}}, "url": "https://github.com/openmrs/openmrs-core/commit/d68c6eca2dec7d814f4cb0e78bea7c29f2801635", "committedDate": "2020-11-18T21:47:58Z", "message": "Improved JavaDoc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTExNDE3", "url": "https://github.com/openmrs/openmrs-core/pull/3606#pullrequestreview-533911417", "createdAt": "2020-11-18T21:54:22Z", "commit": {"oid": "d68c6eca2dec7d814f4cb0e78bea7c29f2801635"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4423, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}