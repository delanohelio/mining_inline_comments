{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MTUzNTM0", "number": 3220, "title": "TRUNK-5751, Set Up InitializationFilter.java for PostgreSQL", "bodyText": "Description of what I changed\nSet Up InitializationFilter.java for PostgreSQL\n\n\nIssue I worked on\n\n\n\n\nsee https://issues.openmrs.org/browse/TRUNK-5751\nChecklist: I completed these to help reviewers :)\n\n\n\n\n My IDE is configured to follow the code style of this project.\nNo? Unsure? -> configure your IDE, format the code and add the changes with git add . && git commit --amend\n\n\n I have added tests to cover my changes. (If you refactored\nexisting code that was well tested you do not have to add tests)\nNo? -> write tests and add them to this commit git add . && git commit --amend\n\n\n I ran mvn clean package right before creating this pull request and\nadded all formatting changes to my commit.\nNo? -> execute above command\n\n\n All new and existing tests passed.\nNo? -> figure out why and add the fix to your commit. It is your responsibility to make sure your code works.\n\n\n My pull request is based on the latest changes of the master branch.\nNo? Unsure? -> execute command git pull --rebase upstream master", "createdAt": "2020-06-01T18:51:18Z", "url": "https://github.com/openmrs/openmrs-core/pull/3220", "merged": true, "mergeCommit": {"oid": "8199f1fc9c215544eb529033b610bb6f3b7cb0e7"}, "closed": true, "closedAt": "2020-06-10T21:43:07Z", "author": {"login": "Am-Coder"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnE06ygH2gAyNDI2MTUzNTM0OjQ2MmZhYTk3OWVlZjg5Y2ExNGRjMGQ3MjE4MDg5M2ExMTI2NmE1NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp8kHqAFqTQyODI0ODcxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "462faa979eef89ca14dc0d72180893a11266a556", "author": {"user": {"login": "Am-Coder", "name": null}}, "url": "https://github.com/openmrs/openmrs-core/commit/462faa979eef89ca14dc0d72180893a11266a556", "committedDate": "2020-06-01T18:46:33Z", "message": "TRUNK-5751, Set Up InitializationFilter.java for PostgreSQL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMTU0MzY0", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-422154364", "createdAt": "2020-06-01T20:23:25Z", "commit": {"oid": "462faa979eef89ca14dc0d72180893a11266a556"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMDoyMzoyNVrOGdY1eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMDoyMzoyNVrOGdY1eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ2ODc5Mw==", "bodyText": "Could you remind me as to why we are using PostgreSQL82Dialect instead of PostgreSQL92Dialect or PostgreSQL102Dialect, etc?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r433468793", "createdAt": "2020-06-01T20:23:25Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1492,7 +1516,7 @@ public void run() {\n \t\t\t\t\t\t\truntimeProperties.put(\"connection.driver_class\", wizardModel.databaseDriver);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tif (finalDatabaseConnectionString.contains(\"postgres\")) {\n-\t\t\t\t\t\t\truntimeProperties.put(\"hibernate.dialect\", \"org.hibernate.dialect.PostgreSQLDialect\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "462faa979eef89ca14dc0d72180893a11266a556"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cc23fe9f41a221f4084484f45de0dd431f31540", "author": {"user": {"login": "Am-Coder", "name": null}}, "url": "https://github.com/openmrs/openmrs-core/commit/0cc23fe9f41a221f4084484f45de0dd431f31540", "committedDate": "2020-06-05T10:51:57Z", "message": "TRUNK-5751, Set Up InitializationFilter.java for PostgreSQL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzMzMzIy", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-425333322", "createdAt": "2020-06-05T14:06:22Z", "commit": {"oid": "0cc23fe9f41a221f4084484f45de0dd431f31540"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDowNjoyMlrOGfwBjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDowNjoyMlrOGfwBjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk0NTg2OQ==", "bodyText": "Is the replacedSql.replaceAll needed for postgresql?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r435945869", "createdAt": "2020-06-05T14:06:22Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1152,6 +1152,9 @@ private int executeStatement(boolean silent, String user, String pw, String sql,\n \t\t\t// TODO how to get the driver for the other dbs...\n \t\t\tif (wizardModel.databaseConnection.contains(\"mysql\")) {\n \t\t\t\tClass.forName(\"com.mysql.cj.jdbc.Driver\").newInstance();\n+\t\t\t} else if (wizardModel.databaseConnection.contains(\"postgres\")) {\n+\t\t\t\tClass.forName(\"org.postgresql.Driver\").newInstance();\n+\t\t\t\treplacedSql = replacedSql.replaceAll(\"`\", \"\\\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cc23fe9f41a221f4084484f45de0dd431f31540"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzM0MzM2", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-425334336", "createdAt": "2020-06-05T14:07:38Z", "commit": {"oid": "0cc23fe9f41a221f4084484f45de0dd431f31540"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDowNzozOFrOGfwEYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDowNzozOFrOGfwEYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk0NjU5NA==", "bodyText": "Shouldn't we be using a constant for mysql or posgresql?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r435946594", "createdAt": "2020-06-05T14:07:38Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1434,10 +1437,23 @@ public void run() {\n \t\t\t\t\t\t\t        || wizardModel.databaseConnection.contains(\"127.0.0.1\")) {\n \t\t\t\t\t\t\t\thost = \"'localhost'\";\n \t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tString sql = \"drop user '?'@\" + host;\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tString sql = \"\";\n+\t\t\t\t\t\t\tif (wizardModel.databaseConnection.contains(\"mysql\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cc23fe9f41a221f4084484f45de0dd431f31540"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "506635506a623a275e6506701dbbb986642bfe74", "author": {"user": {"login": "Am-Coder", "name": null}}, "url": "https://github.com/openmrs/openmrs-core/commit/506635506a623a275e6506701dbbb986642bfe74", "committedDate": "2020-06-06T10:18:34Z", "message": "TRUNK-5751, Set Up InitializationFilter.java for PostgreSQL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzY2MDIz", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-426366023", "createdAt": "2020-06-08T15:37:38Z", "commit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTozNzozOVrOGgkSSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTozNzozOVrOGgkSSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgwMjEyMg==", "bodyText": "Is there any reason why you did not use the latest version?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r436802122", "createdAt": "2020-06-08T15:37:39Z", "author": {"login": "dkayiwa"}, "path": "pom.xml", "diffHunk": "@@ -412,9 +412,9 @@\n \t\t\t\t<version>5.0.11</version>\n \t\t\t</dependency>\n \t\t\t<dependency>\n-\t\t\t\t<groupId>postgresql</groupId>\n+\t\t\t\t<groupId>org.postgresql</groupId>\n \t\t\t\t<artifactId>postgresql</artifactId>\n-\t\t\t\t<version>9.0-801.jdbc4</version>\n+\t\t\t\t<version>42.2.5</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzY2NTYy", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-426366562", "createdAt": "2020-06-08T15:38:12Z", "commit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTozODoxM1rOGgkT3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTozODoxM1rOGgkT3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgwMjUyNA==", "bodyText": "What is the value added by this comment?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r436802524", "createdAt": "2020-06-08T15:38:13Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -86,6 +86,26 @@\n \t\n \tprivate static final org.slf4j.Logger log = LoggerFactory.getLogger(InitializationFilter.class);\n \t\n+\t/**\n+\t * Supported Database", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzY4NDE1", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-426368415", "createdAt": "2020-06-08T15:40:20Z", "commit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo0MDoyMFrOGgkZDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo0MDoyMFrOGgkZDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgwMzg1NA==", "bodyText": "What does checkDatabase mean?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r436803854", "createdAt": "2020-06-08T15:40:20Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1133,6 +1153,12 @@ private void importTestDataSet(InputStream in, String connectionUrl, String conn\n \t\t}\n \t}\n \t\n+\tprivate boolean checkDatabase(String database) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzY5MjY2", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-426369266", "createdAt": "2020-06-08T15:41:17Z", "commit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo0MToxN1rOGgkbhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo0MToxN1rOGgkbhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgwNDQ4Nw==", "bodyText": "https://wiki.openmrs.org/display/docs/Java+Conventions#JavaConventions-CodeStyle", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r436804487", "createdAt": "2020-06-08T15:41:17Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1133,6 +1153,12 @@ private void importTestDataSet(InputStream in, String connectionUrl, String conn\n \t\t}\n \t}\n \t\n+\tprivate boolean checkDatabase(String database) {\n+\t\tif (wizardModel.databaseConnection.contains(database))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "506635506a623a275e6506701dbbb986642bfe74"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f509e7235d2fae0c8d9f737cc380f161516b3de5", "author": {"user": {"login": "Am-Coder", "name": null}}, "url": "https://github.com/openmrs/openmrs-core/commit/f509e7235d2fae0c8d9f737cc380f161516b3de5", "committedDate": "2020-06-09T11:17:38Z", "message": "TRUNK-5751, Set Up InitializationFilter.java for PostgreSQL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTMyNDA5", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-427532409", "createdAt": "2020-06-09T20:46:33Z", "commit": {"oid": "f509e7235d2fae0c8d9f737cc380f161516b3de5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDo0NjozM1rOGhbmBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDo0NjozM1rOGhbmBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcwODI5Mw==", "bodyText": "This method name creates an impression that we support only one database. But from the code base, we support four databases. Do you get my point?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r437708293", "createdAt": "2020-06-09T20:46:33Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1133,6 +1141,13 @@ private void importTestDataSet(InputStream in, String connectionUrl, String conn\n \t\t}\n \t}\n \t\n+\tprivate boolean checkIfDatabaseIsSupported(String database) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f509e7235d2fae0c8d9f737cc380f161516b3de5"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8771d54e83d810ec2ea4f84dbbe7abafb500a6e", "author": {"user": {"login": "Am-Coder", "name": null}}, "url": "https://github.com/openmrs/openmrs-core/commit/c8771d54e83d810ec2ea4f84dbbe7abafb500a6e", "committedDate": "2020-06-10T16:09:18Z", "message": "TRUNK-5751, Set Up InitializationFilter.java for PostgreSQL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjQxMTI4", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-428241128", "createdAt": "2020-06-10T16:40:59Z", "commit": {"oid": "c8771d54e83d810ec2ea4f84dbbe7abafb500a6e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo0MDo1OVrOGh9hDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo0MDo1OVrOGh9hDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2NDA3Nw==", "bodyText": "Why run executeStatement twice?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r438264077", "createdAt": "2020-06-10T16:40:59Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1448,9 +1479,17 @@ public void run() {\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\n \t\t\t\t\t\t\t// grant the roles\n-\t\t\t\t\t\t\tsql = \"GRANT ALL ON `?`.* TO '?'@\" + host;\n-\t\t\t\t\t\t\tint result = executeStatement(false, wizardModel.createUserUsername,\n-\t\t\t\t\t\t\t    wizardModel.createUserPassword, sql, wizardModel.databaseName, connectionUsername);\n+\t\t\t\t\t\t\tint result = 1;\n+\t\t\t\t\t\t\tif (isCurrentDatabase(DATABASE_MYSQL)) {\n+\t\t\t\t\t\t\t\tsql = \"GRANT ALL ON `?`.* TO '?'@\" + host;\n+\t\t\t\t\t\t\t\tresult = executeStatement(false, wizardModel.createUserUsername,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8771d54e83d810ec2ea4f84dbbe7abafb500a6e"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjQ4NzEx", "url": "https://github.com/openmrs/openmrs-core/pull/3220#pullrequestreview-428248711", "createdAt": "2020-06-10T16:50:44Z", "commit": {"oid": "c8771d54e83d810ec2ea4f84dbbe7abafb500a6e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo1MDo0NFrOGh936Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo1MDo0NFrOGh936Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2OTkyOQ==", "bodyText": "Why do we have the exact same replacedSql.replaceAll in more than one place?", "url": "https://github.com/openmrs/openmrs-core/pull/3220#discussion_r438269929", "createdAt": "2020-06-10T16:50:44Z", "author": {"login": "dkayiwa"}, "path": "web/src/main/java/org/openmrs/web/filter/initialization/InitializationFilter.java", "diffHunk": "@@ -1150,8 +1165,11 @@ private int executeStatement(boolean silent, String user, String pw, String sql,\n \t\t\tString replacedSql = sql;\n \t\t\t\n \t\t\t// TODO how to get the driver for the other dbs...\n-\t\t\tif (wizardModel.databaseConnection.contains(\"mysql\")) {\n+\t\t\tif (isCurrentDatabase(DATABASE_MYSQL)) {\n \t\t\t\tClass.forName(\"com.mysql.cj.jdbc.Driver\").newInstance();\n+\t\t\t} else if (isCurrentDatabase(DATABASE_POSTGRESQL)) {\n+\t\t\t\tClass.forName(\"org.postgresql.Driver\").newInstance();\n+\t\t\t\treplacedSql = replacedSql.replaceAll(\"`\", \"\\\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8771d54e83d810ec2ea4f84dbbe7abafb500a6e"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4826, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}