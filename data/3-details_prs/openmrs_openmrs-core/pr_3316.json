{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NDIwNTE2", "number": 3316, "title": "TRUNK-5816: Migrate unit tests to Junit5", "bodyText": "Description of what I changed\n\n\nIssue I worked on\n\n\n\n\nsee https://issues.openmrs.org/browse/TRUNK-5816\nChecklist: I completed these to help reviewers :)\n\n\n\n\n My IDE is configured to follow the code style of this project.\nNo? Unsure? -> configure your IDE, format the code and add the changes with git add . && git commit --amend\n\n\n I have added tests to cover my changes. (If you refactored\nexisting code that was well tested you do not have to add tests)\nNo? -> write tests and add them to this commit git add . && git commit --amend\n\n\n I ran mvn clean package right before creating this pull request and\nadded all formatting changes to my commit.\nNo? -> execute above command\n\n\n All new and existing tests passed.\nNo? -> figure out why and add the fix to your commit. It is your responsibility to make sure your code works.\n\n\n My pull request is based on the latest changes of the master branch.\nNo? Unsure? -> execute command git pull --rebase upstream master", "createdAt": "2020-07-08T18:45:27Z", "url": "https://github.com/openmrs/openmrs-core/pull/3316", "merged": true, "mergeCommit": {"oid": "06c9129e2ebaf32e46736495fe07b34ecfd06a4d"}, "closed": true, "closedAt": "2020-07-10T04:31:53Z", "author": {"login": "achilep"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczHccAgFqTQ0NTI4MjgxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABczbZiYgH2gAyNDQ2NDIwNTE2OjkxYWYzZTI0MmMyZDc4Yzc3ODY2MjlkZjUzNmYyODFmNjJjMWQ3Y2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjgyODEx", "url": "https://github.com/openmrs/openmrs-core/pull/3316#pullrequestreview-445282811", "createdAt": "2020-07-09T04:34:06Z", "commit": {"oid": "2663210eac1c4e9f7e4ad58c33660cbe57a1c86d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNDozNDowNlrOGvBVAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNDozNTozN1rOGvBWbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk1ODAxOQ==", "bodyText": "I believe we should add <scope>test</scope> to every junit dependency so these dependencies are not packaged into the api jar", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r451958019", "createdAt": "2020-07-09T04:34:06Z", "author": {"login": "teleivo"}, "path": "api/pom.xml", "diffHunk": "@@ -278,6 +278,21 @@\n \t\t\t<groupId>com.sun.xml.bind</groupId>\n \t\t\t<artifactId>jaxb-impl</artifactId>\n \t    </dependency>\n+\t   <dependency>\n+\t\t   <groupId>org.junit.jupiter</groupId>\n+\t\t   <artifactId>junit-jupiter-api</artifactId>\n+\t\t   <version>${junitVersion}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2663210eac1c4e9f7e4ad58c33660cbe57a1c86d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk1ODM4MA==", "bodyText": "see for example https://github.com/junit-team/junit5-samples/blob/main/junit5-jupiter-starter-maven/pom.xml#L22", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r451958380", "createdAt": "2020-07-09T04:35:37Z", "author": {"login": "teleivo"}, "path": "api/pom.xml", "diffHunk": "@@ -278,6 +278,21 @@\n \t\t\t<groupId>com.sun.xml.bind</groupId>\n \t\t\t<artifactId>jaxb-impl</artifactId>\n \t    </dependency>\n+\t   <dependency>\n+\t\t   <groupId>org.junit.jupiter</groupId>\n+\t\t   <artifactId>junit-jupiter-api</artifactId>\n+\t\t   <version>${junitVersion}</version>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk1ODAxOQ=="}, "originalCommit": {"oid": "2663210eac1c4e9f7e4ad58c33660cbe57a1c86d"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2663210eac1c4e9f7e4ad58c33660cbe57a1c86d", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/2663210eac1c4e9f7e4ad58c33660cbe57a1c86d", "committedDate": "2020-07-08T18:42:28Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}, "afterCommit": {"oid": "3db98dfec629cc38442a189472b269027fb8094b", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/3db98dfec629cc38442a189472b269027fb8094b", "committedDate": "2020-07-09T06:44:20Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzQ0NTUy", "url": "https://github.com/openmrs/openmrs-core/pull/3316#pullrequestreview-445344552", "createdAt": "2020-07-09T07:11:33Z", "commit": {"oid": "3db98dfec629cc38442a189472b269027fb8094b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzoxMTozNFrOGvEeRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzoxMTozNFrOGvEeRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg==", "bodyText": "@achilep will you also add a Test? I believe thats a class testing whether an OpenMRS test is properly setup.", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452009542", "createdAt": "2020-07-09T07:11:34Z", "author": {"login": "teleivo"}, "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -9,7 +9,8 @@\n  */\n package org.openmrs;\n \n-import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertFalse;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db98dfec629cc38442a189472b269027fb8094b"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3db98dfec629cc38442a189472b269027fb8094b", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/3db98dfec629cc38442a189472b269027fb8094b", "committedDate": "2020-07-09T06:44:20Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}, "afterCommit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/0568ac43dfcd0f628a3d0a8596382120c1c4699a", "committedDate": "2020-07-09T16:07:52Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODI3MjIz", "url": "https://github.com/openmrs/openmrs-core/pull/3316#pullrequestreview-445827223", "createdAt": "2020-07-09T17:31:41Z", "commit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzozMTo0MVrOGvbDgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzozMTo0MVrOGvbDgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM3OTUyMA==", "bodyText": "Shouldnt this also be an ||?\nSince before it was setting foundATestMethod to true if there is a method with the org.junit.Test annotation. I think now it should also count the ones with the org.junit.jupiter.api.Test annotation as a test method. Both annotations will never be present so an && cannot identify a test method then.\ntherefore\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tif (method.getAnnotation(org.junit.Test.class) != null && method.getAnnotation(Test.class) != null) {\n          \n          \n            \n            \t\t\t\t\tif (method.getAnnotation(org.junit.Test.class) != null || method.getAnnotation(Test.class) != null) {", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452379520", "createdAt": "2020-07-09T17:31:41Z", "author": {"login": "teleivo"}, "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -111,18 +109,16 @@ public void shouldHaveClassNameEndWithTestIfContainsMethodTestAnnotations() {\n \t\tfor (Class<?> currentClass : getClasses(\"^.*(?<!Test|IT|PT)\\\\.class$\")) {\n \t\t\t\n \t\t\t// skip over classes that are @Ignore'd\n-\t\t\tif (currentClass.getAnnotation(Ignore.class) == null) {\n+\t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {\n \t\t\t\tboolean foundATestMethod = false;\n \t\t\t\t\n \t\t\t\tfor (Method method : currentClass.getMethods()) {\n-\t\t\t\t\tif (method.getAnnotation(Test.class) != null) {\n+\t\t\t\t\tif (method.getAnnotation(org.junit.Test.class) != null && method.getAnnotation(Test.class) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODc5MDM4", "url": "https://github.com/openmrs/openmrs-core/pull/3316#pullrequestreview-445879038", "createdAt": "2020-07-09T18:46:06Z", "commit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxODo0NjowN1rOGvdgNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxODo0NzoyOFrOGvdjJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxOTYzNg==", "bodyText": "oh, now I get it. So here it says // skip over classes that are @Ignore'd. So what we have to do is skip over classes that do not have the annotation Ignore and also do not have the annotation Disabled\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {\n          \n          \n            \n            \t\t\tif (currentClass.getAnnotation(Ignore.class) == null && currentClass.getAnnotation(Disabled.class) == null) {\n          \n      \n    \n    \n  \n\nOtherwise you are going to check CreateInitialDataSet.", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452419636", "createdAt": "2020-07-09T18:46:07Z", "author": {"login": "teleivo"}, "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -111,18 +109,16 @@ public void shouldHaveClassNameEndWithTestIfContainsMethodTestAnnotations() {\n \t\tfor (Class<?> currentClass : getClasses(\"^.*(?<!Test|IT|PT)\\\\.class$\")) {\n \t\t\t\n \t\t\t// skip over classes that are @Ignore'd\n-\t\t\tif (currentClass.getAnnotation(Ignore.class) == null) {\n+\t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyMDM4OQ==", "bodyText": "So you get the error after my suggested change only because you are in fact checking a class that should not be checked since it is annotated with @Ignore. So you need to take both my suggestions and it should work if I am not mistaken.", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452420389", "createdAt": "2020-07-09T18:47:28Z", "author": {"login": "teleivo"}, "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -111,18 +109,16 @@ public void shouldHaveClassNameEndWithTestIfContainsMethodTestAnnotations() {\n \t\tfor (Class<?> currentClass : getClasses(\"^.*(?<!Test|IT|PT)\\\\.class$\")) {\n \t\t\t\n \t\t\t// skip over classes that are @Ignore'd\n-\t\t\tif (currentClass.getAnnotation(Ignore.class) == null) {\n+\t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxOTYzNg=="}, "originalCommit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/c749cac1f5e71e7fb43f8a5728919c0614264c85", "committedDate": "2020-07-09T18:53:20Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/0568ac43dfcd0f628a3d0a8596382120c1c4699a", "committedDate": "2020-07-09T16:07:52Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}, "afterCommit": {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85", "author": {"user": null}, "url": "https://github.com/openmrs/openmrs-core/commit/c749cac1f5e71e7fb43f8a5728919c0614264c85", "committedDate": "2020-07-09T18:53:20Z", "message": "TRUNK-5816: Migrate unit tests to Junit5"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MTAwNzA3", "url": "https://github.com/openmrs/openmrs-core/pull/3316#pullrequestreview-446100707", "createdAt": "2020-07-10T03:33:30Z", "commit": {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMzozMzozMFrOGvowyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMzo0MjoyN1rOGvo4Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwNDEwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tif (method.getAnnotation(Test.class) != null && method.getAnnotation(org.junit.Test.class) != null) {\n          \n          \n            \n            \t\t\t\tif (method.getAnnotation(Test.class) != null || method.getAnnotation(org.junit.Test.class) != null) {", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452604107", "createdAt": "2020-07-10T03:33:30Z", "author": {"login": "teleivo"}, "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -61,12 +62,11 @@ public void shouldStartWithShould() {\n \t\t\t\t\n \t\t\t\t// make sure every \"test\" method (determined by having \n \t\t\t\t// the @Test annotation) starts with \"testShould\"\n-\t\t\t\tif (method.getAnnotation(Test.class) != null) {\n+\t\t\t\tif (method.getAnnotation(Test.class) != null && method.getAnnotation(org.junit.Test.class) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwNjA1NQ==", "bodyText": "Tests will never have Junit 4 and Junit 5 annotations. Its always a good idea to make a test fail once you assume its good. shouldStartWithShould is supposed to fail if any method annotated with a Test annotation does not start with should or have _should in its name. So you can just open any test and delete a should and _should and see if that test here fails. Since you made. a change you should test that in a Junit 4 and 5 test method. That would have told you that with the && its not checking any test method.", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452606055", "createdAt": "2020-07-10T03:42:27Z", "author": {"login": "teleivo"}, "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -61,12 +62,11 @@ public void shouldStartWithShould() {\n \t\t\t\t\n \t\t\t\t// make sure every \"test\" method (determined by having \n \t\t\t\t// the @Test annotation) starts with \"testShould\"\n-\t\t\t\tif (method.getAnnotation(Test.class) != null) {\n+\t\t\t\tif (method.getAnnotation(Test.class) != null && method.getAnnotation(org.junit.Test.class) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwNDEwNw=="}, "originalCommit": {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91af3e242c2d78c7786629df536f281f62c1d7cd", "author": {"user": {"login": "teleivo", "name": "Ivo"}}, "url": "https://github.com/openmrs/openmrs-core/commit/91af3e242c2d78c7786629df536f281f62c1d7cd", "committedDate": "2020-07-10T03:51:33Z", "message": "TRUNK-5816 Detect Junit 4 & 5 tests not starting with should"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4686, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}