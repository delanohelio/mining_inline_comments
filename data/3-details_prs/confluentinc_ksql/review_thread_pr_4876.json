{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjcyODA4", "number": 4876, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzo1ODo0MFrODrA99g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDo1MToxNVrODulkWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDMxMjIyOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzo1ODo0MFrOF7Hemg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzo0Mjo0MVrOF72XNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzMjgyNg==", "bodyText": "this doesn't have to be a sha right? In fact, assuming cloud-first releases this could just be the tag we used for the cloud-release.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r397532826", "createdAt": "2020-03-24T23:58:40Z", "author": {"login": "rodesai"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',\n         defaultValue: false),\n     string(name: 'GIT_REVISION',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a12ca5f4fa565dca20c9cab2e53ce6ed2c098805"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMDgxNQ==", "bodyText": "It doesn't have to be a SHA, it can also be a branch name or Git tag. However, directly using the tag from a previous build doesn't work since the tags have CP dependencies updated to be beta packaging builds, which means the job fails to process the pom since the job isn't configured with the packaging beta maven repo.\n(Tried just now to confirm and the error was\n20:30:04  [FATAL] Non-resolvable parent POM for io.confluent.ksql:ksqldb-parent:0.8.0: Could not find artifact io.confluent:rest-utils-parent:pom:6.0.0-beta200310175819 in confluent (https://****-confluent-packages-beta-maven.s3-us-west-2.amazonaws.com/6.0.0-beta200320180305/1/maven) and 'parent.relativePath' points at wrong local POM @ line 22, column 13\n\n)", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398300815", "createdAt": "2020-03-26T03:41:54Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',\n         defaultValue: false),\n     string(name: 'GIT_REVISION',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzMjgyNg=="}, "originalCommit": {"oid": "a12ca5f4fa565dca20c9cab2e53ce6ed2c098805"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMDk4Mg==", "bodyText": "The way we'd reproduce an earlier build is to go to the Git tag, find the parent SHA, and specify that SHA in the build.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398300982", "createdAt": "2020-03-26T03:42:41Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',\n         defaultValue: false),\n     string(name: 'GIT_REVISION',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzMjgyNg=="}, "originalCommit": {"oid": "a12ca5f4fa565dca20c9cab2e53ce6ed2c098805"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTgyNzk4OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjozNjozMlrOF8P1ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxMjoyNVrOF8cYuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxODM2Ng==", "bodyText": "when you say only on-prem images will be built you mean it won't trigger the cloud build, correct? because this build only builds on-prem images anyways, right. maybe we can change this to just say won't trigger cloud build because it makes it seem like this job could actually do that. i am thinking this wording is probably just left over from the original draft where this was doing both builds.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398718366", "createdAt": "2020-03-26T16:36:32Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyMzk2MA==", "bodyText": "Yeah, leftover from an earlier version as you said. I've updated this.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398923960", "createdAt": "2020-03-26T22:12:25Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxODM2Ng=="}, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTgzNjYwOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjozODoyM1rOF8P7Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxMzo0MVrOF8ca5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxOTg0Ng==", "bodyText": "i'm confused by this. the cloud build is downstream from this so why would you need to enter the git sha for cloud when building this? it seems like this makes the ksqldb on prem build dependent on the cloud ksql build.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398719846", "createdAt": "2020-03-26T16:38:23Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',\n         defaultValue: false),\n     string(name: 'GIT_REVISION',\n-        description: 'The git SHA to create the release build from.',\n+        description: 'The git SHA to build ksqlDB from.',\n+        defaultValue: ''),\n+    string(name: 'CCLOUD_GIT_REVISION',\n+        description: 'The cc-docker-ksql git SHA to build the CCloud ksqlDB image from.',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyNDUxNg==", "bodyText": "Also leftover from an earlier iteration. Removed.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398924516", "createdAt": "2020-03-26T22:13:41Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -16,20 +16,23 @@ def baseConfig = {\n \n def defaultParams = [\n     booleanParam(name: 'RELEASE_BUILD',\n-        description: 'Is this a release build.',\n+        description: 'Is this a release build. If so, GIT_REVISION must be specified, and only on-prem images will be built.',\n         defaultValue: false),\n     string(name: 'GIT_REVISION',\n-        description: 'The git SHA to create the release build from.',\n+        description: 'The git SHA to build ksqlDB from.',\n+        defaultValue: ''),\n+    string(name: 'CCLOUD_GIT_REVISION',\n+        description: 'The cc-docker-ksql git SHA to build the CCloud ksqlDB image from.',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxOTg0Ng=="}, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTg2NzA1OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0NTowM1rOF8QO9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxNDowOVrOF8cb6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNDg1NA==", "bodyText": "if you are going to append the build number then you need to remove the snapshot qualifier. i made a more detailed comment about this in the cloud PR since I reviewed that one first", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398724854", "createdAt": "2020-03-26T16:45:03Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -74,9 +77,13 @@ def job = {\n \n         // For a release build we remove the -SNAPSHOT from the version.\n         config.ksql_db_version = config.ksql_db_version.tokenize(\"-\")[0]\n+\n+        config.ksql_db_artifact_version = config.ksql_db_version\n         config.docker_tag = config.ksql_db_version\n     } else {\n-        config.docker_tag = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER\n+        // For non-release builds, we append the build number to the maven artifacts and docker image tag\n+        config.ksql_db_artifact_version = config.ksql_db_version + '-' + env.BUILD_NUMBER", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyNDc3OQ==", "bodyText": "Yup, responded on the other PR. Updated here as well.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398924779", "createdAt": "2020-03-26T22:14:09Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -74,9 +77,13 @@ def job = {\n \n         // For a release build we remove the -SNAPSHOT from the version.\n         config.ksql_db_version = config.ksql_db_version.tokenize(\"-\")[0]\n+\n+        config.ksql_db_artifact_version = config.ksql_db_version\n         config.docker_tag = config.ksql_db_version\n     } else {\n-        config.docker_tag = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER\n+        // For non-release builds, we append the build number to the maven artifacts and docker image tag\n+        config.ksql_db_artifact_version = config.ksql_db_version + '-' + env.BUILD_NUMBER", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNDg1NA=="}, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTg2OTU1OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0NTozNlrOF8QQpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxNDoxN1rOF8ccIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNTI4Ng==", "bodyText": "is this comment still relevant since we don't build cloud images here?", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398725286", "createdAt": "2020-03-26T16:45:36Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -146,6 +153,8 @@ def job = {\n         return null\n     }\n \n+    // Build on-prem ksqlDB image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyNDgzNQ==", "bodyText": "Nope, removed.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398924835", "createdAt": "2020-03-26T22:14:17Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -146,6 +153,8 @@ def job = {\n         return null\n     }\n \n+    // Build on-prem ksqlDB image", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNTI4Ng=="}, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTg5MTMyOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo1MDowOVrOF8QeeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxNDozNlrOF8cclA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyODgyNA==", "bodyText": "can we make this if not release build then do the extra stage and trigger the cloud build.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398728824", "createdAt": "2020-03-26T16:50:09Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +328,35 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-beta${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-beta${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (config.release) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyNDk0OA==", "bodyText": "Done. Also made it so the downstream is not triggered for PR jobs, which was a bug in the previous iteration of this PR.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r398924948", "createdAt": "2020-03-26T22:14:36Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +328,35 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-beta${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-beta${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (config.release) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyODgyNA=="}, "originalCommit": {"oid": "d9021289f095bcad7a3986322e5a1d7cf909fd25"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDAwOTk3OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzo0NDoyMFrOF-AO5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjoxMzoxNFrOF-qJPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1OTg0Ng==", "bodyText": "we won't ever be doing snapshot builds anymore correct? So if you just remove the -SNAPSHOT from the ksql_db_version variable in the config you don't need the tokenize call here or line 77 anymore. would you still need this new variable config.ksql_db_artifact_version?", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r400559846", "createdAt": "2020-03-30T23:44:20Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -82,7 +79,7 @@ def job = {\n         config.docker_tag = config.ksql_db_version\n     } else {\n         // For non-release builds, we append the build number to the maven artifacts and docker image tag\n-        config.ksql_db_artifact_version = config.ksql_db_version + '-' + env.BUILD_NUMBER\n+        config.ksql_db_artifact_version = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d8383acf1f0ec0fd7a18e132c09ac7a4a856ef6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NjUyNA==", "bodyText": "Great point. An added benefit of this is that the build param KSQLDB_VERSION and the config var ksql_db_version are now of the same form, removing some existing confusion around the two.\nMade the update, though I left docker_tag as a separate var from ksql_db_artifact_version even though they're always the same since I think subsequent lines in this script are easier to read that way.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401246524", "createdAt": "2020-03-31T22:13:14Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -82,7 +79,7 @@ def job = {\n         config.docker_tag = config.ksql_db_version\n     } else {\n         // For non-release builds, we append the build number to the maven artifacts and docker image tag\n-        config.ksql_db_artifact_version = config.ksql_db_version + '-' + env.BUILD_NUMBER\n+        config.ksql_db_artifact_version = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1OTg0Ng=="}, "originalCommit": {"oid": "4d8383acf1f0ec0fd7a18e132c09ac7a4a856ef6"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDAxNzM2OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzo0ODowOVrOF-ATPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjoxMToxMFrOF-qGKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2MDk1Ng==", "bodyText": "I would prefer we didn't use the beta qualifier in the artifact version.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r400560956", "createdAt": "2020-03-30T23:48:09Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -74,13 +75,17 @@ def job = {\n \n         // For a release build we remove the -SNAPSHOT from the version.\n         config.ksql_db_version = config.ksql_db_version.tokenize(\"-\")[0]\n+\n+        config.ksql_db_artifact_version = config.ksql_db_version\n         config.docker_tag = config.ksql_db_version\n     } else {\n-        config.docker_tag = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER\n+        // For non-release builds, we append the build number to the maven artifacts and docker image tag\n+        config.ksql_db_artifact_version = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER\n+        config.docker_tag = config.ksql_db_version.tokenize(\"-\")[0] + '-beta' + env.BUILD_NUMBER", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d62ff6aea894622886c3e673f786a438c48955c"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NTczNg==", "bodyText": "As discussed offline, I've updated the docker tag, maven artifact version, and git tag to all use -rc instead of -beta.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401245736", "createdAt": "2020-03-31T22:11:10Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -74,13 +75,17 @@ def job = {\n \n         // For a release build we remove the -SNAPSHOT from the version.\n         config.ksql_db_version = config.ksql_db_version.tokenize(\"-\")[0]\n+\n+        config.ksql_db_artifact_version = config.ksql_db_version\n         config.docker_tag = config.ksql_db_version\n     } else {\n-        config.docker_tag = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER\n+        // For non-release builds, we append the build number to the maven artifacts and docker image tag\n+        config.ksql_db_artifact_version = config.ksql_db_version.tokenize(\"-\")[0] + '-' + env.BUILD_NUMBER\n+        config.docker_tag = config.ksql_db_version.tokenize(\"-\")[0] + '-beta' + env.BUILD_NUMBER", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2MDk1Ng=="}, "originalCommit": {"oid": "1d62ff6aea894622886c3e673f786a438c48955c"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDAzMzAyOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzo1NTo1NVrOF-AclQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjoxMToxN1rOF-qGSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2MzM0OQ==", "bodyText": "i would prefer we remove the \"-beta\" qualifier", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r400563349", "createdAt": "2020-03-30T23:55:55Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +324,31 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-beta${env.BUILD_NUMBER}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d62ff6aea894622886c3e673f786a438c48955c"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NTc2OA==", "bodyText": "As above.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401245768", "createdAt": "2020-03-31T22:11:17Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +324,31 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-beta${env.BUILD_NUMBER}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2MzM0OQ=="}, "originalCommit": {"oid": "1d62ff6aea894622886c3e673f786a438c48955c"}, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjM4NjI0OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMDoyMzozNFrOF_RPAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzoyNjoyOFrOF_WJfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4Njk3OQ==", "bodyText": "you can move these up to line 171 along with other call to writeFile, and then you only need one sh block.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401886979", "createdAt": "2020-04-01T20:23:34Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -175,10 +176,9 @@ def job = {\n                                 set +x\n \n                                 LOGIN_CMD=$(aws ecr get-login --no-include-email --region us-west-2)\n-\n                                 $LOGIN_CMD\n-                            '''\n-                            sh '''\n+\n+                                set -x\n                                 echo $ARTIFACTORY_PASSWORD | docker login confluent-docker.jfrog.io -u $ARTIFACTORY_USERNAME --password-stdin\n                             '''\n                             writeFile file:'create-pip-conf-with-jfrog.sh', text:libraryResource('scripts/create-pip-conf-with-jfrog.sh')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cd165cf73f1ee6211c6d3708c83cf02c068a84"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2NzQ4NA==", "bodyText": "Done.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401967484", "createdAt": "2020-04-01T23:26:28Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -175,10 +176,9 @@ def job = {\n                                 set +x\n \n                                 LOGIN_CMD=$(aws ecr get-login --no-include-email --region us-west-2)\n-\n                                 $LOGIN_CMD\n-                            '''\n-                            sh '''\n+\n+                                set -x\n                                 echo $ARTIFACTORY_PASSWORD | docker login confluent-docker.jfrog.io -u $ARTIFACTORY_USERNAME --password-stdin\n                             '''\n                             writeFile file:'create-pip-conf-with-jfrog.sh', text:libraryResource('scripts/create-pip-conf-with-jfrog.sh')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4Njk3OQ=="}, "originalCommit": {"oid": "94cd165cf73f1ee6211c6d3708c83cf02c068a84"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjM5MzUyOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMDoyNTozOVrOF_RTUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzoyNzowOFrOF_WKaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4ODA4Mw==", "bodyText": "seems odd to use the docker_tag here instead of the artifact version, even though they are the same thing.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401888083", "createdAt": "2020-04-01T20:25:39Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -226,13 +216,23 @@ def job = {\n                                 sh cmd\n                             }\n                             step([$class: 'hudson.plugins.findbugs.FindBugsPublisher', pattern: '**/*bugsXml.xml'])\n+\n+                            if (!config.isPrJob) {\n+                                def git_tag = \"v${config.docker_tag}-ksqldb\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cd165cf73f1ee6211c6d3708c83cf02c068a84"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2NzcyMA==", "bodyText": "Don't feel strongly one way or the other. I've updated it to be the artifact version.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401967720", "createdAt": "2020-04-01T23:27:08Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -226,13 +216,23 @@ def job = {\n                                 sh cmd\n                             }\n                             step([$class: 'hudson.plugins.findbugs.FindBugsPublisher', pattern: '**/*bugsXml.xml'])\n+\n+                            if (!config.isPrJob) {\n+                                def git_tag = \"v${config.docker_tag}-ksqldb\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4ODA4Mw=="}, "originalCommit": {"oid": "94cd165cf73f1ee6211c6d3708c83cf02c068a84"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjM5NTU5OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMDoyNjoyMVrOF_RUsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzoyNzoxOVrOF_WKlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4ODQzMw==", "bodyText": "i don't know if this is just a display problem with the diff, but it seems like you have a space between \"${config.\" and \"cp_version}\".", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401888433", "createdAt": "2020-04-01T20:26:21Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -226,13 +216,23 @@ def job = {\n                                 sh cmd\n                             }\n                             step([$class: 'hudson.plugins.findbugs.FindBugsPublisher', pattern: '**/*bugsXml.xml'])\n+\n+                            if (!config.isPrJob) {\n+                                def git_tag = \"v${config.docker_tag}-ksqldb\"\n+                                sh \"git add .\"\n+                                sh \"git commit -m \\\"build: Setting project version ${config.ksql_db_artifact_version} and parent version ${config. cp_version}.\\\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cd165cf73f1ee6211c6d3708c83cf02c068a84"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2Nzc2Nw==", "bodyText": "Good catch -- fixed.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401967767", "createdAt": "2020-04-01T23:27:19Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -226,13 +216,23 @@ def job = {\n                                 sh cmd\n                             }\n                             step([$class: 'hudson.plugins.findbugs.FindBugsPublisher', pattern: '**/*bugsXml.xml'])\n+\n+                            if (!config.isPrJob) {\n+                                def git_tag = \"v${config.docker_tag}-ksqldb\"\n+                                sh \"git add .\"\n+                                sh \"git commit -m \\\"build: Setting project version ${config.ksql_db_artifact_version} and parent version ${config. cp_version}.\\\"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4ODQzMw=="}, "originalCommit": {"oid": "94cd165cf73f1ee6211c6d3708c83cf02c068a84"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjkwNTQ4OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzoyOTozOVrOF_WNkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNjoxMDozMFrOF_ciQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2ODUyOQ==", "bodyText": "Added this so dependency images are cleaned up in addition to the built ones. The script doesn't pull dependencies in PROMOTE_TO_PRODUCTION mode and the dependency repo doesn't exist in the production registry, but I think that should be fine? As in, trying to clean up a registry + repo combination that doesn't exist shouldn't cause the script to error. Please correct me if I'm mistaken.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401968529", "createdAt": "2020-04-01T23:29:39Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,18 +318,36 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (!config.release && !config.isPrJob) {\n+        stage('Trigger CCloud ksqlDB Docker image job') {\n+            build job: \"confluentinc/cc-docker-ksql/master\",\n+                wait: false,\n+                parameters: [\n+                    booleanParam(name: \"NIGHTLY_BUILD\", value: true),\n+                    string(name: \"NIGHTLY_BUILD_NUMBER\", value: \"${env.BUILD_NUMBER}\"),\n+                    string(name: \"CP_BETA_VERSION\", value: \"${config.cp_version}\"),\n+                    string(name: \"CP_BETA_BUILD_NUMBER\", value: \"${config.packaging_build_number}\"),\n+                    string(name: \"KSQLDB_ARTIFACT_VERSION\", value: \"${config.ksql_db_artifact_version}\")\n+                ]\n+        }\n+    }\n }\n \n def post = {\n     withDockerServer([uri: dockerHost()]) {\n-        repos = config.dockerArtifacts + config.dockerRepos\n+        repos = config.dockerArtifacts + config.dockerRepos + config.dockerPullDeps", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c308465545de2bbdf6a69f6087563d7fb9a193"}, "originalPosition": 194}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5OTIxNw==", "bodyText": "@vcrfxia Apologies, but I got that wrong and I mentioned some more detail in the other PR. You only want to delete the images you build.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r401999217", "createdAt": "2020-04-02T01:16:35Z", "author": {"login": "elismaga"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,18 +318,36 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (!config.release && !config.isPrJob) {\n+        stage('Trigger CCloud ksqlDB Docker image job') {\n+            build job: \"confluentinc/cc-docker-ksql/master\",\n+                wait: false,\n+                parameters: [\n+                    booleanParam(name: \"NIGHTLY_BUILD\", value: true),\n+                    string(name: \"NIGHTLY_BUILD_NUMBER\", value: \"${env.BUILD_NUMBER}\"),\n+                    string(name: \"CP_BETA_VERSION\", value: \"${config.cp_version}\"),\n+                    string(name: \"CP_BETA_BUILD_NUMBER\", value: \"${config.packaging_build_number}\"),\n+                    string(name: \"KSQLDB_ARTIFACT_VERSION\", value: \"${config.ksql_db_artifact_version}\")\n+                ]\n+        }\n+    }\n }\n \n def post = {\n     withDockerServer([uri: dockerHost()]) {\n-        repos = config.dockerArtifacts + config.dockerRepos\n+        repos = config.dockerArtifacts + config.dockerRepos + config.dockerPullDeps", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2ODUyOQ=="}, "originalCommit": {"oid": "86c308465545de2bbdf6a69f6087563d7fb9a193"}, "originalPosition": 194}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3MjEyOQ==", "bodyText": "No worries, reverted the cleanup logic change.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r402072129", "createdAt": "2020-04-02T06:10:30Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,18 +318,36 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (!config.release && !config.isPrJob) {\n+        stage('Trigger CCloud ksqlDB Docker image job') {\n+            build job: \"confluentinc/cc-docker-ksql/master\",\n+                wait: false,\n+                parameters: [\n+                    booleanParam(name: \"NIGHTLY_BUILD\", value: true),\n+                    string(name: \"NIGHTLY_BUILD_NUMBER\", value: \"${env.BUILD_NUMBER}\"),\n+                    string(name: \"CP_BETA_VERSION\", value: \"${config.cp_version}\"),\n+                    string(name: \"CP_BETA_BUILD_NUMBER\", value: \"${config.packaging_build_number}\"),\n+                    string(name: \"KSQLDB_ARTIFACT_VERSION\", value: \"${config.ksql_db_artifact_version}\")\n+                ]\n+        }\n+    }\n }\n \n def post = {\n     withDockerServer([uri: dockerHost()]) {\n-        repos = config.dockerArtifacts + config.dockerRepos\n+        repos = config.dockerArtifacts + config.dockerRepos + config.dockerPullDeps", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2ODUyOQ=="}, "originalCommit": {"oid": "86c308465545de2bbdf6a69f6087563d7fb9a193"}, "originalPosition": 194}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMTc2NjAzOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDo1MToxNVrOGApGbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMjoxNDozMVrOGArP_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMyNjU3Mw==", "bodyText": "1 nit here: would it be better to just pass in an opaque version string here rather than the beta version and the nightly build number and having the cc-docker-ksql build reconstruct the ksqldb rc version? It would be easier to keep it consistent this way (in case we change the format of the ksqldb rc version).", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r403326573", "createdAt": "2020-04-03T20:51:15Z", "author": {"login": "rodesai"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +318,31 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (!config.release && !config.isPrJob) {\n+        stage('Trigger CCloud ksqlDB Docker image job') {\n+            build job: \"confluentinc/cc-docker-ksql/master\",\n+                wait: false,\n+                parameters: [\n+                    booleanParam(name: \"NIGHTLY_BUILD\", value: true),\n+                    string(name: \"NIGHTLY_BUILD_NUMBER\", value: \"${env.BUILD_NUMBER}\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ee4cb2e4d1b6a61a708ac865483bdd37b6a47"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1MTUxNg==", "bodyText": "Discussed offline. Decision was to remove the parameter NIGHTLY_BUILD_NUMBER and have the cc-docker-ksql build construct its docker image tag from KSQLDB_ARTIFACT_VERSION directly. The beta version params are separate.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r403351516", "createdAt": "2020-04-03T21:45:00Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +318,31 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (!config.release && !config.isPrJob) {\n+        stage('Trigger CCloud ksqlDB Docker image job') {\n+            build job: \"confluentinc/cc-docker-ksql/master\",\n+                wait: false,\n+                parameters: [\n+                    booleanParam(name: \"NIGHTLY_BUILD\", value: true),\n+                    string(name: \"NIGHTLY_BUILD_NUMBER\", value: \"${env.BUILD_NUMBER}\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMyNjU3Mw=="}, "originalCommit": {"oid": "836ee4cb2e4d1b6a61a708ac865483bdd37b6a47"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTc4OA==", "bodyText": "Nvm, decided to leave this as is in order to allow more flexibility for the downstream image tag format.", "url": "https://github.com/confluentinc/ksql/pull/4876#discussion_r403361788", "createdAt": "2020-04-03T22:14:31Z", "author": {"login": "vcrfxia"}, "path": "Jenkinsfile", "diffHunk": "@@ -319,13 +318,31 @@ def job = {\n                     sh \"docker push ${config.dockerRegistry}${dockerRepo}:master-latest\"\n \n                     if (config.release) {\n-                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n-                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-${env.BUILD_NUMBER}\"\n+                        // docker_tag for release builds does not include the build number\n+                        // here we add it back so an image version with the build number always exists\n+                        sh \"docker tag ${config.dockerRegistry}${dockerRepo}:${config.docker_tag} ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n+                        sh \"docker push ${config.dockerRegistry}${dockerRepo}:${config.docker_tag}-rc${env.BUILD_NUMBER}\"\n                     }\n                 }\n             }\n         }\n     }\n+\n+    // Build CCloud ksqlDB image\n+\n+    if (!config.release && !config.isPrJob) {\n+        stage('Trigger CCloud ksqlDB Docker image job') {\n+            build job: \"confluentinc/cc-docker-ksql/master\",\n+                wait: false,\n+                parameters: [\n+                    booleanParam(name: \"NIGHTLY_BUILD\", value: true),\n+                    string(name: \"NIGHTLY_BUILD_NUMBER\", value: \"${env.BUILD_NUMBER}\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMyNjU3Mw=="}, "originalCommit": {"oid": "836ee4cb2e4d1b6a61a708ac865483bdd37b6a47"}, "originalPosition": 182}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3656, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}