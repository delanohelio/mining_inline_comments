{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MTk2MzA5", "number": 6556, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzoxNlrOE0d8wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDo0MlrOE0d_AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyMDk4OnYy", "diffSide": "LEFT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzoxN1rOHsNeIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzoxN1rOHsNeIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDA5OA==", "bodyText": "No need to use Ticker here.\na) Ticker is marked as unstable\nb) Ticker.read()'s java docs say it returns nanoseconds, not milliseconds as this impl does\nc) A simple Supplier<Long> does what is needed.", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120098", "createdAt": "2020-11-02T17:03:17Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -46,18 +46,13 @@\n  * complete backup of the command_topic is created.\n  */\n public class CommandTopicBackupImpl implements CommandTopicBackup {\n+\n   private static final Logger LOG = LoggerFactory.getLogger(CommandTopicBackupImpl.class);\n-  private static final Ticker CURRENT_MILLIS_TICKER = new Ticker() {\n-    @Override\n-    public long read() {\n-      return System.currentTimeMillis();\n-    }\n-  };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyMjU2OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzo0MFrOHsNfJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzo0MFrOHsNfJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDM1Ng==", "bodyText": "Findbugs error no 1.", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120356", "createdAt": "2020-11-02T17:03:40Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -133,23 +129,22 @@ private boolean isRecordInLatestReplay(final ConsumerRecord<byte[], byte[]> reco\n     return false;\n   }\n \n-  private void throwIfInvalidRecord(final ConsumerRecord<byte[], byte[]> record) {\n+  private static void throwIfInvalidRecord(final ConsumerRecord<byte[], byte[]> record) {\n     try {\n       InternalTopicSerdes.deserializer(CommandId.class).deserialize(record.topic(), record.key());\n     } catch (final Exception e) {\n       throw new KsqlException(String.format(\n           \"Failed to backup record because it cannot deserialize key: %s\",\n-          new String(record.key(), StandardCharsets.UTF_8), e\n-      ));\n+          new String(record.key(), StandardCharsets.UTF_8)), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyMzA0OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzo0OFrOHsNfeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzo0OFrOHsNfeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDQ0Mg==", "bodyText": "Findbugs error no 2.", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120442", "createdAt": "2020-11-02T17:03:48Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -133,23 +129,22 @@ private boolean isRecordInLatestReplay(final ConsumerRecord<byte[], byte[]> reco\n     return false;\n   }\n \n-  private void throwIfInvalidRecord(final ConsumerRecord<byte[], byte[]> record) {\n+  private static void throwIfInvalidRecord(final ConsumerRecord<byte[], byte[]> record) {\n     try {\n       InternalTopicSerdes.deserializer(CommandId.class).deserialize(record.topic(), record.key());\n     } catch (final Exception e) {\n       throw new KsqlException(String.format(\n           \"Failed to backup record because it cannot deserialize key: %s\",\n-          new String(record.key(), StandardCharsets.UTF_8), e\n-      ));\n+          new String(record.key(), StandardCharsets.UTF_8)), e);\n     }\n \n     try {\n       InternalTopicSerdes.deserializer(Command.class).deserialize(record.topic(), record.value());\n     } catch (final Exception e) {\n       throw new KsqlException(String.format(\n           \"Failed to backup record because it cannot deserialize value: %s\",\n-          new String(record.value(), StandardCharsets.UTF_8), e\n-      ));\n+          new String(record.value(), StandardCharsets.UTF_8)), e\n+      );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyMzQ4OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzo1NlrOHsNfxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMzo1NlrOHsNfxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDUxOQ==", "bodyText": "simplified", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120519", "createdAt": "2020-11-02T17:03:56Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -193,18 +188,14 @@ public boolean commandTopicCorruption() {\n \n   @VisibleForTesting\n   BackupReplayFile openOrCreateReplayFile() {\n-    final Optional<BackupReplayFile> latestFile = latestReplayFile();\n-    if (latestFile.isPresent()) {\n-      return latestFile.get();\n-    }\n-\n-    return newReplayFile();\n+    return latestReplayFile()\n+        .orElseGet(this::newReplayFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyNDA3OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDowNlrOHsNgNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDowNlrOHsNgNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDYyOA==", "bodyText": "warning fixed", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120628", "createdAt": "2020-11-02T17:04:06Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -216,12 +207,11 @@ private BackupReplayFile newReplayFile() {\n     File latestBakFile = null;\n     if (files != null) {\n       long latestTs = 0;\n-      for (int i = 0; i < files.length; i++) {\n-        final File bakFile = files[i];\n+      for (final File bakFile : files) {\n         final String bakTimestamp = bakFile.getName().substring(prefixFilename.length());\n \n         try {\n-          final Long ts = Long.valueOf(bakTimestamp);\n+          final long ts = Long.parseLong(bakTimestamp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 129}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyNDM0OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDoxMVrOHsNgYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDoxMVrOHsNgYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDY3NQ==", "bodyText": "warning fixed", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120675", "createdAt": "2020-11-02T17:04:11Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -216,12 +207,11 @@ private BackupReplayFile newReplayFile() {\n     File latestBakFile = null;\n     if (files != null) {\n       long latestTs = 0;\n-      for (int i = 0; i < files.length; i++) {\n-        final File bakFile = files[i];\n+      for (final File bakFile : files) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyNDk1OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDoxN1rOHsNguA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDoxN1rOHsNguA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDc2MA==", "bodyText": "simpified", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120760", "createdAt": "2020-11-02T17:04:17Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/CommandTopicBackupImpl.java", "diffHunk": "@@ -230,17 +220,15 @@ private BackupReplayFile newReplayFile() {\n           LOG.warn(\n               \"Invalid timestamp '{}' found in backup replay file (file ignored): {}\",\n               bakTimestamp, bakFile.getName());\n-          continue;\n         }\n       }\n     }\n \n-    return (latestBakFile != null)\n-        ? Optional.of(BackupReplayFile.writable(latestBakFile))\n-        : Optional.empty();\n+    return Optional.ofNullable(latestBakFile)\n+        .map(BackupReplayFile::writable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 146}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyNjA0OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/restore/KsqlRestoreCommandTopic.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDoyOVrOHsNhWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDoyOVrOHsNhWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDkyMQ==", "bodyText": "Findbugs error no 3.", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120921", "createdAt": "2020-11-02T17:04:29Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/restore/KsqlRestoreCommandTopic.java", "diffHunk": "@@ -88,8 +86,9 @@ private static void throwOnInvalidRecords(final List<Pair<byte[], byte[]>> recor\n       } catch (final Exception e) {\n         throw new KsqlException(String.format(\n             \"Invalid CommandId string (line %d): %s\",\n-            n, new String(record.getLeft(), StandardCharsets.UTF_8), e\n-        ));\n+            n, new String(record.getLeft(), StandardCharsets.UTF_8)),\n+            e", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyNjM3OnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/restore/KsqlRestoreCommandTopic.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDozNlrOHsNhmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDozNlrOHsNhmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMDk4Ng==", "bodyText": "Findbugs error no 4.", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516120986", "createdAt": "2020-11-02T17:04:36Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/restore/KsqlRestoreCommandTopic.java", "diffHunk": "@@ -98,8 +97,9 @@ private static void throwOnInvalidRecords(final List<Pair<byte[], byte[]>> recor\n       } catch (final Exception e) {\n         throw new KsqlException(String.format(\n             \"Invalid Command string (line %d): %s\",\n-            n, new String(record.getRight(), StandardCharsets.UTF_8), e\n-        ));\n+            n, new String(record.getRight(), StandardCharsets.UTF_8)),\n+            e", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUyNjcyOnYy", "diffSide": "RIGHT", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/restore/KsqlRestoreCommandTopic.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDo0MlrOHsNhzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowNDo0MlrOHsNhzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEyMTAzOQ==", "bodyText": "simplified", "url": "https://github.com/confluentinc/ksql/pull/6556#discussion_r516121039", "createdAt": "2020-11-02T17:04:42Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/restore/KsqlRestoreCommandTopic.java", "diffHunk": "@@ -135,12 +135,7 @@ private static boolean promptQuestion() {\n     final Console console = System.console();\n     final String decision = console.readLine();\n \n-    switch (decision.toLowerCase()) {\n-      case \"yes\":\n-        return true;\n-      default:\n-        return false;\n-    }\n+    return \"yes\".equals(decision.toLowerCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c12aee6504452b7b71273bcae3eee4a57acd8d0a"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2607, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}