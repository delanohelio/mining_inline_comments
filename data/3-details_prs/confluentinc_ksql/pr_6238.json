{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MTc4MzQ4", "number": 6238, "title": "fix: delimited format should write decimals in a format it can read", "bodyText": "Description\nfixes: #6234\nNote: stacked on top of #6233 - ignore the first commit.\nBREAKING CHANGE\nThis changes the format the DELIMITED form writes decimals from 12,345,678,987,654,321.12345 to 12345678987654321.12345\nTesting done\nusual\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-09-16T18:44:48Z", "url": "https://github.com/confluentinc/ksql/pull/6238", "merged": true, "mergeCommit": {"oid": "626965e542cbca45351f5c37d9fc52fe1164edd4"}, "closed": true, "closedAt": "2020-09-22T22:51:57Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJgoRNAH2gAyNDg4MTc4MzQ4OjRjMGQ1Y2Q2YzhiMjM3Y2M3ZTBmYzMzMDlkMmFjNzljYmI5NmU0OGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLe516AH2gAyNDg4MTc4MzQ4OjU1Y2Q4MTgwYjJjYjIyZDNmMzhiMzMzYzAxNTMzNTZmNGMzMWVjMWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c0d5cd6c8b237cc7e0fc3309d2ac79cbb96e48b", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/4c0d5cd6c8b237cc7e0fc3309d2ac79cbb96e48b", "committedDate": "2020-09-16T18:23:30Z", "message": "fix: scale of ROUND() return value\n\nfixes: https://github.com/confluentinc/ksql/issues/6233\n\nFixes the scale of the decimals values returned by the variant of the `ROUND` method that takes a decimal and a required number of decimal places to round to.\n\nThis fixes a bug where the output could not be serialized to Avro."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c6b1895b7b3f895dc13bd399a82004dad46c2b2", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/0c6b1895b7b3f895dc13bd399a82004dad46c2b2", "committedDate": "2020-09-16T18:43:42Z", "message": "fix: delimited format should write decimals in a format it can read\n\nfixes: https://github.com/confluentinc/ksql/issues/6234\n\nBREAKING CHANGE\nThis changes the format the `DELIMITED` form writes decimals from `12,345,678,987,654,321.12345` to `12345678987654321.12345`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTUwNDA1", "url": "https://github.com/confluentinc/ksql/pull/6238#pullrequestreview-489950405", "createdAt": "2020-09-16T19:19:31Z", "commit": {"oid": "0c6b1895b7b3f895dc13bd399a82004dad46c2b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToxOTozMVrOHTAvUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToxOTozMVrOHTAvUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5NzEwNA==", "bodyText": "Kids distracted me - on it...", "url": "https://github.com/confluentinc/ksql/pull/6238#discussion_r489697104", "createdAt": "2020-09-16T19:19:31Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/serde/delimited/KsqlDelimitedSerializer.java", "diffHunk": "@@ -95,7 +95,8 @@ private String getDecimal(final Field field) {\n       final int precision = DecimalUtil.precision(field.schema());\n       final int scale = DecimalUtil.scale(field.schema());\n \n-      return DecimalUtil.format(precision, scale, value);\n+      return value.toString();\n+//      return DecimalUtil.format(precision, scale, value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c6b1895b7b3f895dc13bd399a82004dad46c2b2"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957d68f22dd7ce4ffd48107c59d39287007d07ca", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/957d68f22dd7ce4ffd48107c59d39287007d07ca", "committedDate": "2020-09-16T19:20:45Z", "message": "chore: missed change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d94a5e9447287fa47fab9076a5dc659a77bd70b", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/2d94a5e9447287fa47fab9076a5dc659a77bd70b", "committedDate": "2020-09-16T19:21:50Z", "message": "chore: remove unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNTIzNDU1", "url": "https://github.com/confluentinc/ksql/pull/6238#pullrequestreview-491523455", "createdAt": "2020-09-18T14:34:47Z", "commit": {"oid": "2d94a5e9447287fa47fab9076a5dc659a77bd70b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNDozNDo0N1rOHUP0vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNDozNDo0N1rOHUP0vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk5MjgyOQ==", "bodyText": "Isn't this format used to add trailing zeros to decimals? Without this, we loose those zeros.\nCan the DecimalFormat be configured to avoid adding commas?", "url": "https://github.com/confluentinc/ksql/pull/6238#discussion_r490992829", "createdAt": "2020-09-18T14:34:47Z", "author": {"login": "spena"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/serde/delimited/KsqlDelimitedSerializer.java", "diffHunk": "@@ -84,20 +82,9 @@ public boolean hasNext() {\n     public Object next() {\n       final Field field = fieldIt.next();\n       throwOnUnsupportedType(field.schema());\n-      if (DecimalUtil.isDecimal(field.schema())) {\n-        return getDecimal(field);\n-      }\n       return data.get(field);\n     }\n \n-    private String getDecimal(final Field field) {\n-      final BigDecimal value = (BigDecimal) data.get(field);\n-      final int precision = DecimalUtil.precision(field.schema());\n-      final int scale = DecimalUtil.scale(field.schema());\n-\n-      return DecimalUtil.format(precision, scale, value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d94a5e9447287fa47fab9076a5dc659a77bd70b"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b45524daf39b28e7a8fb17081483baedbbe4072", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/3b45524daf39b28e7a8fb17081483baedbbe4072", "committedDate": "2020-09-21T10:53:12Z", "message": "chore: do not use scientific notation for decimals"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyOTAwNDY4", "url": "https://github.com/confluentinc/ksql/pull/6238#pullrequestreview-492900468", "createdAt": "2020-09-21T19:05:19Z", "commit": {"oid": "2d94a5e9447287fa47fab9076a5dc659a77bd70b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxOTowNToxOVrOHVekVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxOTowNToxOVrOHVekVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4Mjk2NA==", "bodyText": "Looking at this, is there any reason to prefer plain notation over scientific notation? the plan notation is lossy while scientific notation conserves the precision/scale exactly (docs about toPlainString):\nNote that if the result of this method is passed to the string constructor, only the numerical \nvalue of this BigDecimal will necessarily be recovered; the representation of the new BigDecimal \nmay have a different scale.\n\nCompare with toString:\nThere is a one-to-one mapping between the distinguishable BigDecimal values and the \nresult of this conversion.", "url": "https://github.com/confluentinc/ksql/pull/6238#discussion_r492282964", "createdAt": "2020-09-21T19:05:19Z", "author": {"login": "agavra"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/serde/delimited/KsqlDelimitedSerializer.java", "diffHunk": "@@ -84,20 +82,9 @@ public boolean hasNext() {\n     public Object next() {\n       final Field field = fieldIt.next();\n       throwOnUnsupportedType(field.schema());\n-      if (DecimalUtil.isDecimal(field.schema())) {\n-        return getDecimal(field);\n-      }\n       return data.get(field);\n     }\n \n-    private String getDecimal(final Field field) {\n-      final BigDecimal value = (BigDecimal) data.get(field);\n-      final int precision = DecimalUtil.precision(field.schema());\n-      final int scale = DecimalUtil.scale(field.schema());\n-\n-      return DecimalUtil.format(precision, scale, value);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk5MjgyOQ=="}, "originalCommit": {"oid": "2d94a5e9447287fa47fab9076a5dc659a77bd70b"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e77b5e6f555611f7daee6428b79c73ff728e0d14", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/e77b5e6f555611f7daee6428b79c73ff728e0d14", "committedDate": "2020-09-21T20:31:26Z", "message": "chore: merge from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e33fc4841d6bd288110189086edca12c41c3392", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/4e33fc4841d6bd288110189086edca12c41c3392", "committedDate": "2020-09-22T16:01:23Z", "message": "chore: fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzUyNDQ5", "url": "https://github.com/confluentinc/ksql/pull/6238#pullrequestreview-493752449", "createdAt": "2020-09-22T18:49:45Z", "commit": {"oid": "4e33fc4841d6bd288110189086edca12c41c3392"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55cd8180b2cb22d3f38b333c0153356f4c31ec1f", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/55cd8180b2cb22d3f38b333c0153356f4c31ec1f", "committedDate": "2020-09-22T21:30:44Z", "message": "test: add historical plans"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4656, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}