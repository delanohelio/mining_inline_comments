{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4ODA2NDAz", "number": 5909, "title": "chore: dont retry isTopicExists on UnknownTopicOrPartitionException", "bodyText": "Description\nThe retry behavior was causing all isTopicExists calls where the topic is expected not to exist to hang for 2.5s (5x 500ms)\nTesting done\nUnit test ensures only is called once.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-07-30T01:27:41Z", "url": "https://github.com/confluentinc/ksql/pull/5909", "merged": true, "mergeCommit": {"oid": "41b8592c805562b0b491d1e05079ad6b93d2c5ff"}, "closed": true, "closedAt": "2020-07-30T21:29:32Z", "author": {"login": "agavra"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6DAQUgFqTQ1ODYwNDQ0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6FtThAH2gAyNDU4ODA2NDAzOjExYjFhNDJkYTM1NTlhMjYyZTZhMGM0MDdlNjRiODgyMzk4NDM4Y2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjA0NDQ5", "url": "https://github.com/confluentinc/ksql/pull/5909#pullrequestreview-458604449", "createdAt": "2020-07-30T17:19:45Z", "commit": {"oid": "905dfff90980a7d8aa5c8277583ce9880527ad5d"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoxOTo0NVrOG5sixw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoyMjo0M1rOG5spuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1MTgxNQ==", "bodyText": "Was this log message deleted intentionally?", "url": "https://github.com/confluentinc/ksql/pull/5909#discussion_r463151815", "createdAt": "2020-07-30T17:19:45Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/util/ExecutorUtil.java", "diffHunk": "@@ -73,9 +91,7 @@ public static void executeWithRetries(\n         return executable.call();\n       } catch (final Exception e) {\n         final Throwable cause = e instanceof ExecutionException ? e.getCause() : e;\n-        if (cause instanceof RetriableException\n-            || (cause instanceof Exception && retryBehaviour == RetryBehaviour.ALWAYS)) {\n-          log.info(\"Retrying request. Retry no: \" + retries, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905dfff90980a7d8aa5c8277583ce9880527ad5d"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1MjUwOQ==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // Expect\n          \n          \n            \n                // Given", "url": "https://github.com/confluentinc/ksql/pull/5909#discussion_r463152509", "createdAt": "2020-07-30T17:20:52Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/util/ExecutorUtilTest.java", "diffHunk": "@@ -102,6 +103,30 @@ public void shouldNotRetryOnNonRetriableException() throws Exception {\n     assertThat(e.getMessage(), containsString(\"First non-retry exception\"));\n   }\n \n+  @Test\n+  public void shouldNotRetryOnCustomRetryableDenied() throws Exception {\n+    // Expect", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905dfff90980a7d8aa5c8277583ce9880527ad5d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1MzU5Mg==", "bodyText": "The expectation is that we get the UnknownTopicOrPartitionException rather than RuntimeException(\"Test should not retry\") right? Can we change this to UnknownTopicOrPartitionException.class to disambiguate?", "url": "https://github.com/confluentinc/ksql/pull/5909#discussion_r463153592", "createdAt": "2020-07-30T17:22:43Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/util/ExecutorUtilTest.java", "diffHunk": "@@ -102,6 +103,30 @@ public void shouldNotRetryOnNonRetriableException() throws Exception {\n     assertThat(e.getMessage(), containsString(\"First non-retry exception\"));\n   }\n \n+  @Test\n+  public void shouldNotRetryOnCustomRetryableDenied() throws Exception {\n+    // Expect\n+    final AtomicBoolean firstCall = new AtomicBoolean(true);\n+    final Callable<Object> throwsException = () -> {\n+      if (firstCall.get()) {\n+        firstCall.set(false);\n+        // this is a retryable exception usually\n+        throw new UnknownTopicOrPartitionException(\"First non-retry exception\");\n+      } else {\n+        throw new RuntimeException(\"Test should not retry\");\n+      }\n+    };\n+\n+    // When:\n+    final RuntimeException e = assertThrows(\n+        RuntimeException.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905dfff90980a7d8aa5c8277583ce9880527ad5d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "709015875018c1edcb3675fa69f972695ede823f", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/709015875018c1edcb3675fa69f972695ede823f", "committedDate": "2020-07-30T17:48:27Z", "message": "chore: dont retry isTopicExists on UnknownTopicOrPartitionException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c4887c951b4479c7358df5810c45c3b415989c3", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/1c4887c951b4479c7358df5810c45c3b415989c3", "committedDate": "2020-07-30T17:48:27Z", "message": "chore: minor changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "905dfff90980a7d8aa5c8277583ce9880527ad5d", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/905dfff90980a7d8aa5c8277583ce9880527ad5d", "committedDate": "2020-07-30T01:21:46Z", "message": "chore: dont retry isTopicExists on UnknownTopicOrPartitionException"}, "afterCommit": {"oid": "1c4887c951b4479c7358df5810c45c3b415989c3", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/1c4887c951b4479c7358df5810c45c3b415989c3", "committedDate": "2020-07-30T17:48:27Z", "message": "chore: minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ad5ea50327a2dcfca277bc5758c4dd6b22c1415", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/8ad5ea50327a2dcfca277bc5758c4dd6b22c1415", "committedDate": "2020-07-30T19:00:27Z", "message": "chore: empty commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbea16f3dc862d92329332f2c25350904365b2d0", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/bbea16f3dc862d92329332f2c25350904365b2d0", "committedDate": "2020-07-30T20:05:01Z", "message": "chore: unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11b1a42da3559a262e6a0c407e64b882398438cc", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/11b1a42da3559a262e6a0c407e64b882398438cc", "committedDate": "2020-07-30T20:32:42Z", "message": "test: fix the tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4767, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}