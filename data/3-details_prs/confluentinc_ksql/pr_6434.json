{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNjgwMDcz", "number": 6434, "title": "docs: note PARTITION BY requirement for aggregations (DOCS-5550)", "bodyText": "Fixes #1053.", "createdAt": "2020-10-14T22:06:39Z", "url": "https://github.com/confluentinc/ksql/pull/6434", "merged": true, "mergeCommit": {"oid": "6eb71909e448d2d48343b1b02d3ff616ad6015ee"}, "closed": true, "closedAt": "2020-10-16T22:17:08Z", "author": {"login": "JimGalasyn"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSklHuAH2gAyNTAzNjgwMDczOjVkMmFjMDNjMDI0OGU2Y2Q3NGZkYmZjN2I0NDQ4MDk4YjY1YmFhN2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTNC07gH2gAyNTAzNjgwMDczOmQwMGYxYjFiYjQwM2EwOWYxNjU4OTgyZWM1NGEzNGIyNGE5ZTBhMjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e", "author": {"user": {"login": "JimGalasyn", "name": "Jim Galasyn"}}, "url": "https://github.com/confluentinc/ksql/commit/5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e", "committedDate": "2020-10-14T22:05:00Z", "message": "docs: note PARTITION BY requirement for aggregations (DOCS-5550)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODA5Nzgw", "url": "https://github.com/confluentinc/ksql/pull/6434#pullrequestreview-508809780", "createdAt": "2020-10-14T22:19:19Z", "commit": {"oid": "5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjoxOToxOVrOHhnyGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo1MzoxMFrOHhpS0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAxNjg1OQ==", "bodyText": "I think VARCHAR KEY should be removed here. Type and key specification are only for CT/CS statements. Also, single quotes instead of double quotes around 'fixed_key'", "url": "https://github.com/confluentinc/ksql/pull/6434#discussion_r505016859", "createdAt": "2020-10-14T22:19:19Z", "author": {"login": "mikebin"}, "path": "docs/developer-guide/syntax-reference.md", "diffHunk": "@@ -99,6 +99,31 @@ You can create your own aggregation logic by implementing a User Defined\n Aggregation Function (UDAF). For more information, see\n [UDAFs](../concepts/functions.md#udafs).\n \n+Aggregations return results per partition. To get results across all partitions,\n+you can use PARTITION BY with a fixed key, for example:\n+\n+```sql\n+CREATE STREAM allplaycounts AS\n+  SELECT \"fixed_key\" VARCHAR KEY, COUNT(*) FROM", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAzNzcxOA==", "bodyText": "Instead of \"big bucket (partition)\", maybe just \"partition\"", "url": "https://github.com/confluentinc/ksql/pull/6434#discussion_r505037718", "createdAt": "2020-10-14T22:47:36Z", "author": {"login": "mikebin"}, "path": "docs/developer-guide/syntax-reference.md", "diffHunk": "@@ -99,6 +99,31 @@ You can create your own aggregation logic by implementing a User Defined\n Aggregation Function (UDAF). For more information, see\n [UDAFs](../concepts/functions.md#udafs).\n \n+Aggregations return results per partition. To get results across all partitions,\n+you can use PARTITION BY with a fixed key, for example:\n+\n+```sql\n+CREATE STREAM allplaycounts AS\n+  SELECT \"fixed_key\" VARCHAR KEY, COUNT(*) FROM\n+    playcountsstream PARTITION BY \"fixed_key\";\n+```\n+\n+Also, you can get results across all partitions as part of the aggregate query,\n+instead of requiring a separate step to partition by a fixed key. In the\n+following example, GROUP BY causes COUNT to aggregate over all records.\n+\n+```sql\n+SELECT 'totalCount', COUNT(*) FROM\n+  ksql_processing_log GROUP BY 'totalCount';\n+```\n+\n+Grouping by a single constant indicates that ksqlDB uses one big bucket", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAzOTc2OA==", "bodyText": "Maybe this whole example with PARTITION BY is no longer needed? Instead, could say\n\nTo get results across all partitions, you can use GROUP BY with a fixed key\n\nand just show the group by example below. Probably best to get input from the ksqlDB team on whether that's reasonable or not.", "url": "https://github.com/confluentinc/ksql/pull/6434#discussion_r505039768", "createdAt": "2020-10-14T22:50:24Z", "author": {"login": "mikebin"}, "path": "docs/developer-guide/syntax-reference.md", "diffHunk": "@@ -99,6 +99,31 @@ You can create your own aggregation logic by implementing a User Defined\n Aggregation Function (UDAF). For more information, see\n [UDAFs](../concepts/functions.md#udafs).\n \n+Aggregations return results per partition. To get results across all partitions,\n+you can use PARTITION BY with a fixed key, for example:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA0MTYxNw==", "bodyText": "Maybe instead of\n\nWe recommend this approach even if you're using GROUP BY because otherwise ...\n\nIt could say:\n\nWe recommend this if you're grouping by a fixed key because otherwise ....", "url": "https://github.com/confluentinc/ksql/pull/6434#discussion_r505041617", "createdAt": "2020-10-14T22:53:10Z", "author": {"login": "mikebin"}, "path": "docs/developer-guide/syntax-reference.md", "diffHunk": "@@ -99,6 +99,31 @@ You can create your own aggregation logic by implementing a User Defined\n Aggregation Function (UDAF). For more information, see\n [UDAFs](../concepts/functions.md#udafs).\n \n+Aggregations return results per partition. To get results across all partitions,\n+you can use PARTITION BY with a fixed key, for example:\n+\n+```sql\n+CREATE STREAM allplaycounts AS\n+  SELECT \"fixed_key\" VARCHAR KEY, COUNT(*) FROM\n+    playcountsstream PARTITION BY \"fixed_key\";\n+```\n+\n+Also, you can get results across all partitions as part of the aggregate query,\n+instead of requiring a separate step to partition by a fixed key. In the\n+following example, GROUP BY causes COUNT to aggregate over all records.\n+\n+```sql\n+SELECT 'totalCount', COUNT(*) FROM\n+  ksql_processing_log GROUP BY 'totalCount';\n+```\n+\n+Grouping by a single constant indicates that ksqlDB uses one big bucket\n+(partition) containing all of the records for the aggregation. If you're\n+creating a persistent query, you can set the partition count of the sink\n+topic to 1 by using WITH(PARTITIONS=1). We recommend this approach even", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d2ac03c0248e6cd74fdbfc7b4448098b65baa7e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d00f1b1bb403a09f1658982ec54a34b24a9e0a20", "author": {"user": {"login": "JimGalasyn", "name": "Jim Galasyn"}}, "url": "https://github.com/confluentinc/ksql/commit/d00f1b1bb403a09f1658982ec54a34b24a9e0a20", "committedDate": "2020-10-16T21:13:39Z", "message": "docs: incorporate feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4631, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}