{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NzQ5NDIz", "number": 4575, "title": "feat: log groupby errors to processing logger", "bodyText": "Description\nLogs errors in groupby to the processing logger.\nTesting done\nAdded unit tests for the group by mappers to ensure they log correctly.", "createdAt": "2020-02-15T19:26:00Z", "url": "https://github.com/confluentinc/ksql/pull/4575", "merged": true, "mergeCommit": {"oid": "b503d25507b369f8ec8bb600c23063a6691a9856"}, "closed": true, "closedAt": "2020-02-20T21:53:05Z", "author": {"login": "rodesai"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFmb9TAFqTM2MDU3OTQ5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFxEdDgBqjMwNTA0OTcyNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTc5NDkw", "url": "https://github.com/confluentinc/ksql/pull/4575#pullrequestreview-360579490", "createdAt": "2020-02-18T18:40:46Z", "commit": {"oid": "05cd4803a9b906c9530172cd5350834f1dba285c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODo0MDo0NlrOFrN7Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODo0MTozNlrOFrN9Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg2MTI4Mg==", "bodyText": "Do we want to remove the LOG.error line below now that we have this?  Seems unnecessary to log the error twice.\nOther uses of the processing logger don't double log.", "url": "https://github.com/confluentinc/ksql/pull/4575#discussion_r380861282", "createdAt": "2020-02-18T18:40:46Z", "author": {"login": "big-andy-coates"}, "path": "ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java", "diffHunk": "@@ -82,16 +93,36 @@ private static LogicalSchema buildSchema(\n   private static Object processColumn(\n       final int index,\n       final ExpressionMetadata exp,\n-      final GenericRow row\n+      final GenericRow row,\n+      final ProcessingLogger logger\n   ) {\n     try {\n       final Object result = exp.evaluate(row);\n       if (result == null) {\n+        logger.error(\n+            EngineProcessingLogMessageFactory.recordProcessingError(\n+               String.format(\n+                   \"Group-by column with index %d resolved to null.\"\n+                       + \" The source row will be excluded from the table.\",\n+                   index),\n+                row\n+            )\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05cd4803a9b906c9530172cd5350834f1dba285c"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg2MTcxNA==", "bodyText": "Same again - remove the LOG.error below.  - and you can remove the LOG field too.", "url": "https://github.com/confluentinc/ksql/pull/4575#discussion_r380861714", "createdAt": "2020-02-18T18:41:36Z", "author": {"login": "big-andy-coates"}, "path": "ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java", "diffHunk": "@@ -82,16 +93,36 @@ private static LogicalSchema buildSchema(\n   private static Object processColumn(\n       final int index,\n       final ExpressionMetadata exp,\n-      final GenericRow row\n+      final GenericRow row,\n+      final ProcessingLogger logger\n   ) {\n     try {\n       final Object result = exp.evaluate(row);\n       if (result == null) {\n+        logger.error(\n+            EngineProcessingLogMessageFactory.recordProcessingError(\n+               String.format(\n+                   \"Group-by column with index %d resolved to null.\"\n+                       + \" The source row will be excluded from the table.\",\n+                   index),\n+                row\n+            )\n+        );\n         LOG.error(\"Group-by column with index {} resolved to null. \"\n             + \"The source row will be excluded from the table.\", index);\n       }\n       return result;\n     } catch (final Exception e) {\n+      logger.error(\n+          EngineProcessingLogMessageFactory.recordProcessingError(\n+              String.format(\n+                  \"Error calculating group-by column with index %d. \"\n+                      + \"The source row will be excluded from the table: %s\",\n+                  index, e.getMessage()),\n+              e,\n+              row\n+          )\n+      );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05cd4803a9b906c9530172cd5350834f1dba285c"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b0b20390804f952db17c7f7259e484d82384e7", "author": {"user": {"login": "rodesai", "name": "Rohan"}}, "url": "https://github.com/confluentinc/ksql/commit/c1b0b20390804f952db17c7f7259e484d82384e7", "committedDate": "2020-02-19T06:58:34Z", "message": "feat: log groupby errors to processing logger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b61eae0d33ce47c8e3250c2194742275ca2655df", "author": {"user": {"login": "rodesai", "name": "Rohan"}}, "url": "https://github.com/confluentinc/ksql/commit/b61eae0d33ce47c8e3250c2194742275ca2655df", "committedDate": "2020-02-19T06:58:34Z", "message": "review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "author": {"user": {"login": "rodesai", "name": "Rohan"}}, "url": "https://github.com/confluentinc/ksql/commit/df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "committedDate": "2020-02-19T07:04:55Z", "message": "fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05cd4803a9b906c9530172cd5350834f1dba285c", "author": {"user": {"login": "rodesai", "name": "Rohan"}}, "url": "https://github.com/confluentinc/ksql/commit/05cd4803a9b906c9530172cd5350834f1dba285c", "committedDate": "2020-02-15T19:24:57Z", "message": "feat: log groupby errors to processing logger"}, "afterCommit": {"oid": "df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "author": {"user": {"login": "rodesai", "name": "Rohan"}}, "url": "https://github.com/confluentinc/ksql/commit/df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "committedDate": "2020-02-19T07:04:55Z", "message": "fix tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 37, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}