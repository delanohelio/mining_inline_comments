{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MjIwMzg5", "number": 5656, "title": "fix: allow empty structs in schema inference", "bodyText": "Description\nPreviously, empty structs would be formatted as STRUCT<> in the SqlSchemaFormatter (which for some reason is used independently of SqlFormatter, we should dig into that) which would cause parsing to fail because <> is it's own symbol for \"not equal to\".\nThis code path was not used in master after #4637 so it was no longer happening. That change has a relatively large surface area, so for the backport I am making the most targeted change possible to address the edge case.\nTesting done\nAdded a unit test, which fails before this fix.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-06-19T17:28:11Z", "url": "https://github.com/confluentinc/ksql/pull/5656", "merged": true, "mergeCommit": {"oid": "3c38c8ce3771ad3418645f81ee0caf1370e784b1"}, "closed": true, "closedAt": "2020-06-19T21:26:03Z", "author": {"login": "agavra"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcs2dMvgH2gAyNDM3MjIwMzg5OjhmM2QxNWZmOTNiMTI2NGFkNzAyMzM5YmFmYjI5ZDU1NTc2YzliNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs4bEaAH2gAyNDM3MjIwMzg5OjkzMDk4Y2U0NTc1ZjVlNzZlZWNmNGQxYWYxZTFjOTA2NjUyN2E2Y2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f3d15ff93b1264ad702339bafb29d55576c9b5d", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/8f3d15ff93b1264ad702339bafb29d55576c9b5d", "committedDate": "2020-06-19T17:25:31Z", "message": "fix: allow empy structs in schema inference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19361f8c5d0e40251e8e99cdc72497fbe016d36e", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/19361f8c5d0e40251e8e99cdc72497fbe016d36e", "committedDate": "2020-06-19T18:15:15Z", "message": "test :add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjY1Mzc0", "url": "https://github.com/confluentinc/ksql/pull/5656#pullrequestreview-434265374", "createdAt": "2020-06-19T18:18:47Z", "commit": {"oid": "8f3d15ff93b1264ad702339bafb29d55576c9b5d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxODoxODo0N1rOGmdnIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxODoxODo0N1rOGmdnIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk4NDIyNQ==", "bodyText": "Just curious, what does the below collector return with empty fields?", "url": "https://github.com/confluentinc/ksql/pull/5656#discussion_r442984225", "createdAt": "2020-06-19T18:18:47Z", "author": {"login": "AlanConfluent"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/schema/connect/SqlSchemaFormatter.java", "diffHunk": "@@ -161,6 +161,9 @@ public String visitMap(final Schema schema, final String key, final String value\n     }\n \n     public String visitStruct(final Schema schema, final List<? extends String> fields) {\n+      if (fields.isEmpty()) {\n+        return \"STRUCT< >\";\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3d15ff93b1264ad702339bafb29d55576c9b5d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93098ce4575f5e76eecf4d1af1e1c9066527a6ce", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/93098ce4575f5e76eecf4d1af1e1c9066527a6ce", "committedDate": "2020-06-19T19:43:00Z", "message": "fix: change historical test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 241, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}