{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NTQ3MjM4", "number": 6126, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODowMVrOEeepWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODozOFrOEeeqBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMzk0ODQzOnYy", "diffSide": "LEFT", "path": "debian/confluent-ksqldb.postinst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODowMVrOHKJ07Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNzozNzo0OVrOHRfynw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODgxMw==", "bodyText": "any reason why we removed this?", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r480408813", "createdAt": "2020-08-31T21:28:01Z", "author": {"login": "agavra"}, "path": "debian/confluent-ksqldb.postinst", "diffHunk": "@@ -10,25 +10,28 @@ case \"$1\" in\n \t(getent group $_group 2>&1 >/dev/null) || addgroup --quiet --system $_group\n         adduser --system --disabled-password --disabled-login --home /var/empty \\\n                 --no-create-home --quiet --force-badname --ingroup $_group $_user\n+                \n+  # Set explicit kafka-streams directory if not set\n+  ksqldb_config=/etc/ksqldb/ksql-server.properties\n+  if [ -f $ksqldb_config ]; then\n+    if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+      echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+    fi\n+  fi                \n \n \t_permwarn=\n-\tfor dir in /var/log/confluent ; do\n-\t    if [ $dir = /var/log/confluent ]; then\n-\t\t# Confluent log directory should be writable by group\n+\tfor dir in /var/log/confluent /var/lib/kafka-streams ; do\n+\t\t# Confluent log and kafka-streams directories should be writable by group\n \t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-\t    else\n-\t\t# Other dirs are only readable by group\n-\t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEwODcwMw==", "bodyText": "It's not used. It was supposed to set a read-only permission on groups for directories other than /var/log/confluent. But that's the only directory it was used, so this line was never triggered.\nThis was the code before:\nfor dir in /var/log/confluent ; do\n  if [ $dir = /var/log/confluent ]; then\n    // read/write perms\n  else\n    // read-only perms\n  fi", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r488108703", "createdAt": "2020-09-14T17:37:49Z", "author": {"login": "spena"}, "path": "debian/confluent-ksqldb.postinst", "diffHunk": "@@ -10,25 +10,28 @@ case \"$1\" in\n \t(getent group $_group 2>&1 >/dev/null) || addgroup --quiet --system $_group\n         adduser --system --disabled-password --disabled-login --home /var/empty \\\n                 --no-create-home --quiet --force-badname --ingroup $_group $_user\n+                \n+  # Set explicit kafka-streams directory if not set\n+  ksqldb_config=/etc/ksqldb/ksql-server.properties\n+  if [ -f $ksqldb_config ]; then\n+    if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+      echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+    fi\n+  fi                \n \n \t_permwarn=\n-\tfor dir in /var/log/confluent ; do\n-\t    if [ $dir = /var/log/confluent ]; then\n-\t\t# Confluent log directory should be writable by group\n+\tfor dir in /var/log/confluent /var/lib/kafka-streams ; do\n+\t\t# Confluent log and kafka-streams directories should be writable by group\n \t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-\t    else\n-\t\t# Other dirs are only readable by group\n-\t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODgxMw=="}, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMzk0ODc3OnYy", "diffSide": "RIGHT", "path": "debian/confluent-ksqldb.postinst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODowOVrOHKJ1KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNzozNjowNVrOHRfvHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODg3Mg==", "bodyText": "nit: indentation seems off?", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r480408872", "createdAt": "2020-08-31T21:28:09Z", "author": {"login": "agavra"}, "path": "debian/confluent-ksqldb.postinst", "diffHunk": "@@ -10,25 +10,28 @@ case \"$1\" in\n \t(getent group $_group 2>&1 >/dev/null) || addgroup --quiet --system $_group\n         adduser --system --disabled-password --disabled-login --home /var/empty \\\n                 --no-create-home --quiet --force-badname --ingroup $_group $_user\n+                \n+  # Set explicit kafka-streams directory if not set\n+  ksqldb_config=/etc/ksqldb/ksql-server.properties\n+  if [ -f $ksqldb_config ]; then\n+    if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+      echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+    fi\n+  fi                \n \n \t_permwarn=\n-\tfor dir in /var/log/confluent ; do\n-\t    if [ $dir = /var/log/confluent ]; then\n-\t\t# Confluent log directory should be writable by group\n+\tfor dir in /var/log/confluent /var/lib/kafka-streams ; do\n+\t\t# Confluent log and kafka-streams directories should be writable by group\n \t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-\t    else\n-\t\t# Other dirs are only readable by group\n-\t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"\n-\t    fi\n-\n-\t    if [ ! -d $dir ]; then\n-\t\techo \"Creating directory $dir with owner $_user:$_group\"\n-\t\tmkdir -p $dir\n-\t\teval $_perm\n-\t    else\n-\t\techo \"Notice: Not creating existing directory $dir, ensure proper permissions for user $_user group $_group\"\n-\t\t_permwarn=\"${_permwarn}${_perm}\\n\"\n-\t    fi\n+\n+    if [ ! -d $dir ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEwNzgwNQ==", "bodyText": "Um, editor problems. I fixed them.", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r488107805", "createdAt": "2020-09-14T17:36:05Z", "author": {"login": "spena"}, "path": "debian/confluent-ksqldb.postinst", "diffHunk": "@@ -10,25 +10,28 @@ case \"$1\" in\n \t(getent group $_group 2>&1 >/dev/null) || addgroup --quiet --system $_group\n         adduser --system --disabled-password --disabled-login --home /var/empty \\\n                 --no-create-home --quiet --force-badname --ingroup $_group $_user\n+                \n+  # Set explicit kafka-streams directory if not set\n+  ksqldb_config=/etc/ksqldb/ksql-server.properties\n+  if [ -f $ksqldb_config ]; then\n+    if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+      echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+    fi\n+  fi                \n \n \t_permwarn=\n-\tfor dir in /var/log/confluent ; do\n-\t    if [ $dir = /var/log/confluent ]; then\n-\t\t# Confluent log directory should be writable by group\n+\tfor dir in /var/log/confluent /var/lib/kafka-streams ; do\n+\t\t# Confluent log and kafka-streams directories should be writable by group\n \t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-\t    else\n-\t\t# Other dirs are only readable by group\n-\t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"\n-\t    fi\n-\n-\t    if [ ! -d $dir ]; then\n-\t\techo \"Creating directory $dir with owner $_user:$_group\"\n-\t\tmkdir -p $dir\n-\t\teval $_perm\n-\t    else\n-\t\techo \"Notice: Not creating existing directory $dir, ensure proper permissions for user $_user group $_group\"\n-\t\t_permwarn=\"${_permwarn}${_perm}\\n\"\n-\t    fi\n+\n+    if [ ! -d $dir ]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODg3Mg=="}, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMzk1MDEyOnYy", "diffSide": "LEFT", "path": "debian/confluent-ksqldb.spec.in", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODozOFrOHKJ2BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNzozODoyNVrOHRfz0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTA5Mg==", "bodyText": "same as above", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r480409092", "createdAt": "2020-08-31T21:28:38Z", "author": {"login": "agavra"}, "path": "debian/confluent-ksqldb.spec.in", "diffHunk": "@@ -27,16 +27,19 @@ _group=confluent\n getent group $_group 2>&1 >/dev/null || groupadd -r $_group\n getent passwd $_user 2>&1 >/dev/null || \\\n     useradd -r -g $_group --home-dir /tmp --no-create-home -s /sbin/nologin -c \"Confluent KSQL\" $_user\n+    \n+# Set explicit kafka-streams directory if not set\n+ksqldb_config=/etc/ksqldb/ksql-server.properties\n+if [ -f $ksqldb_config ]; then\n+  if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+    echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+  fi\n+fi    \n \n _permwarn=\n-for dir in /var/log/confluent ; do\n-    if [ $dir = /var/log/confluent ]; then\n-        # Confluent log directory should be writable by group\n-        _perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-    else\n-        # Other dirs are only readable by group\n-        _perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEwOTAwOQ==", "bodyText": "Same answer", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r488109009", "createdAt": "2020-09-14T17:38:25Z", "author": {"login": "spena"}, "path": "debian/confluent-ksqldb.spec.in", "diffHunk": "@@ -27,16 +27,19 @@ _group=confluent\n getent group $_group 2>&1 >/dev/null || groupadd -r $_group\n getent passwd $_user 2>&1 >/dev/null || \\\n     useradd -r -g $_group --home-dir /tmp --no-create-home -s /sbin/nologin -c \"Confluent KSQL\" $_user\n+    \n+# Set explicit kafka-streams directory if not set\n+ksqldb_config=/etc/ksqldb/ksql-server.properties\n+if [ -f $ksqldb_config ]; then\n+  if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+    echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+  fi\n+fi    \n \n _permwarn=\n-for dir in /var/log/confluent ; do\n-    if [ $dir = /var/log/confluent ]; then\n-        # Confluent log directory should be writable by group\n-        _perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-    else\n-        # Other dirs are only readable by group\n-        _perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTA5Mg=="}, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2962, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}