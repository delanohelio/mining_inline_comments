{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMTE4NjU0", "number": 4829, "title": "feat: add COALESCE function", "bodyText": "Description\nThe COALESCE function takes one or more parameters and returns the first that is non-null.\nAll parameters must be of the same type.\nThis function supersedes the existing IFNULL function, which only worked for strings and one accepted two parameters.\nNote: also added docs for the ARRAY_LENGH I added recently, as I seemed to of missed adding docs!\nTesting done\nQTT + unit tests added.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-03-19T16:49:40Z", "url": "https://github.com/confluentinc/ksql/pull/4829", "merged": true, "mergeCommit": {"oid": "251c237c455f4cf3843628f41e4bbf57795cfd12"}, "closed": true, "closedAt": "2020-03-23T17:31:41Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPOyM3gH2gAyMzkxMTE4NjU0OjAyZjZiMjQ3Zjc4MjFhY2M3Zjk2NTAyYzQzNjZhMGY3NzE0YmQ1MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQhy7hAH2gAyMzkxMTE4NjU0Ojk5MjllZDQ0YjBlODczMzE1YjQyMGYzMTdmMTEyYTlhOTIyNDVmZjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "02f6b247f7821acc7f96502c4366a0f7714bd526", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/02f6b247f7821acc7f96502c4366a0f7714bd526", "committedDate": "2020-03-19T16:48:27Z", "message": "feat: add COALESCE function\n\nThe `COALESCE` function takes one or more parameters and returns the first that is non-null.\n\nAll parameters must be of the same type.\n\nThis function supersedes the existing `IFNULL` function, which only worked for strings and one accepted two parameters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "259fbd5d401ceda270b79b43d367d16245d4d709", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/259fbd5d401ceda270b79b43d367d16245d4d709", "committedDate": "2020-03-19T17:14:41Z", "message": "test: add test using coalesce in PARTITION BY"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9162c228143fd8589b1197f89a6ef9afb0f24cd7", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/9162c228143fd8589b1197f89a6ef9afb0f24cd7", "committedDate": "2020-03-19T17:25:17Z", "message": "chore: log deprecation on first use of IFNULL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTUxNzE1", "url": "https://github.com/confluentinc/ksql/pull/4829#pullrequestreview-377951715", "createdAt": "2020-03-19T17:41:55Z", "commit": {"oid": "9162c228143fd8589b1197f89a6ef9afb0f24cd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b46930c4ac099bbabb930b82d0c1e0b9890805f", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/4b46930c4ac099bbabb930b82d0c1e0b9890805f", "committedDate": "2020-03-19T17:57:52Z", "message": "chore: changes requested by Nick"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDA1MDcz", "url": "https://github.com/confluentinc/ksql/pull/4829#pullrequestreview-378005073", "createdAt": "2020-03-19T18:53:27Z", "commit": {"oid": "4b46930c4ac099bbabb930b82d0c1e0b9890805f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxODo1MzoyN1rOF48G9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxODo1MzoyN1rOF48G9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI0OTM5OQ==", "bodyText": "sorry, i realize i should have seen this array_length function going in separately but adding the docs here has called it to my attention :)   - not sure we should return zero for a null input array, that conflicts with the result for an empty array. I would expect that array_length(null) returns NULL.  From what i can see in a quick google around, that looks to be more common but it's not well documented in many places.", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r395249399", "createdAt": "2020-03-19T18:53:27Z", "author": {"login": "blueedgenick"}, "path": "docs-md/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -186,6 +189,15 @@ The square root of a value.\n Collections\r\n ===========\r\n \r\n+ARRAY_LENGTH\r\n+------------\r\n+\r\n+`ARRAY_LENGTH(ARRAY[1, 2, 3])`\r\n+\r\n+Given an array, return the number of elements in the array.\r\n+\r\n+If the supplied parameter is null the method returns 0.\r\n+\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b46930c4ac099bbabb930b82d0c1e0b9890805f"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8090246ce25791c44acc94fb9003b5476f0f0d7", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/f8090246ce25791c44acc94fb9003b5476f0f0d7", "committedDate": "2020-03-20T10:29:17Z", "message": "chore: remove ARRAY_LENGTH docs\n\nMoved to separate PR."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjUyNjc0", "url": "https://github.com/confluentinc/ksql/pull/4829#pullrequestreview-379652674", "createdAt": "2020-03-23T17:23:23Z", "commit": {"oid": "f8090246ce25791c44acc94fb9003b5476f0f0d7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyMzoyNFrOF6P_Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyMzoyNFrOF6P_Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzY0Nw==", "bodyText": "can we add a test for COALESCE(some_column) (e.g. no constants)", "url": "https://github.com/confluentinc/ksql/pull/4829#discussion_r396623647", "createdAt": "2020-03-23T17:23:24Z", "author": {"login": "agavra"}, "path": "ksqldb-functional-tests/src/test/resources/query-validation-tests/null.json", "diffHunk": "@@ -76,6 +76,42 @@\n         \"type\": \"io.confluent.ksql.util.KsqlStatementException\",\n         \"message\": \"Comparison with NULL not supported: NULL <> NULL\"\n       }\n+    },\n+    {\n+      \"name\": \"coalesce\",\n+      \"statements\": [\n+        \"CREATE STREAM INPUT (COL0 INT KEY, COL1 STRING, COL2 ARRAY<INT>) WITH (kafka_topic='test_topic', value_format='JSON');\",\n+        \"CREATE STREAM OUTPUT AS SELECT COALESCE(COL0, 10, 20) AS A, COALESCE(COL1, 'x') AS B, COALESCE(COL2, ARRAY[10, 20]) AS C FROM INPUT;\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8090246ce25791c44acc94fb9003b5476f0f0d7"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9929ed44b0e873315b420f317f112a9a92245ff2", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/9929ed44b0e873315b420f317f112a9a92245ff2", "committedDate": "2020-03-23T17:31:22Z", "message": "chore: almog's requested changes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 51, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}