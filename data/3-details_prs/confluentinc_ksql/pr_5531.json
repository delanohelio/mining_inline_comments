{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2ODcxNDI4", "number": 5531, "title": "fix: zero decimal bug", "bodyText": "Description\nFixes issue #5282, where there was a bug that would not allow the insertion of valid decimals if they were equal to 0. This was due to an edge case in how BigDecimal calculates precision for zero decimal values.  This patch adds a condition to check for zero decimal values and calculates their precision correctly.\nTesting done\nA unit test checking if the server allows the insertion of valid zero decimals was added to the rest-query-validation-tests folder.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-06-02T22:59:25Z", "url": "https://github.com/confluentinc/ksql/pull/5531", "merged": true, "mergeCommit": {"oid": "1b9094bd5ead8a8441ef8f10a5f86722dd7d3988"}, "closed": true, "closedAt": "2020-06-03T23:58:00Z", "author": {"login": "nae701"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnc8FfAH2gAyNDI2ODcxNDI4OjNlZmNiNDkzZWRjZWJhMjYyNTNhYmMzMmEzOWIwMDkzOGNkYTczNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnx7m1gFqTQyNDAwMTA2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3efcb493edceba26253abc32a39b00938cda7345", "author": {"user": null}, "url": "https://github.com/confluentinc/ksql/commit/3efcb493edceba26253abc32a39b00938cda7345", "committedDate": "2020-06-02T22:52:06Z", "message": "fix zero decimal bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTI0MTcx", "url": "https://github.com/confluentinc/ksql/pull/5531#pullrequestreview-423124171", "createdAt": "2020-06-02T23:31:07Z", "commit": {"oid": "3efcb493edceba26253abc32a39b00938cda7345"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMzozMTowN1rOGeHSXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMzozMjowN1rOGeHTYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIyOTg1NQ==", "bodyText": "nit: use BigDecimal.ZERO", "url": "https://github.com/confluentinc/ksql/pull/5531#discussion_r434229855", "createdAt": "2020-06-02T23:31:07Z", "author": {"login": "agavra"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/DecimalUtil.java", "diffHunk": "@@ -234,6 +234,10 @@ private static void ensureMax(final BigDecimal value, final int precision, final\n   }\n \n   public static SqlType fromValue(final BigDecimal value) {\n+    final BigDecimal bigDecimalZero = new BigDecimal(\"0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3efcb493edceba26253abc32a39b00938cda7345"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIyOTkyNA==", "bodyText": "let's add a comment in here explaining what's going on on and why we have to do this", "url": "https://github.com/confluentinc/ksql/pull/5531#discussion_r434229924", "createdAt": "2020-06-02T23:31:26Z", "author": {"login": "agavra"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/DecimalUtil.java", "diffHunk": "@@ -234,6 +234,10 @@ private static void ensureMax(final BigDecimal value, final int precision, final\n   }\n \n   public static SqlType fromValue(final BigDecimal value) {\n+    final BigDecimal bigDecimalZero = new BigDecimal(\"0\");\n+    if (value.compareTo(bigDecimalZero) == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3efcb493edceba26253abc32a39b00938cda7345"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIzMDExMw==", "bodyText": "we should also add a unit test in DecimalUtilTest - follow the pattern that is already there", "url": "https://github.com/confluentinc/ksql/pull/5531#discussion_r434230113", "createdAt": "2020-06-02T23:32:07Z", "author": {"login": "agavra"}, "path": "ksqldb-functional-tests/src/test/resources/rest-query-validation-tests/insert-values.json", "diffHunk": "@@ -332,6 +332,18 @@\n       \"outputs\": [\n         {\"topic\": \"test_topic\", \"key\": 1, \"value\": {\"V0\": {\"F0\": null}}}\n       ]\n+    },\n+    {\n+      \"name\": \"should insert decimals that equal zero\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3efcb493edceba26253abc32a39b00938cda7345"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ed6b7a1d8255b7505a91a5c3ced2af8a6e29b7a", "author": {"user": null}, "url": "https://github.com/confluentinc/ksql/commit/9ed6b7a1d8255b7505a91a5c3ced2af8a6e29b7a", "committedDate": "2020-06-03T16:25:06Z", "message": "fix zero decimal bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "952ee70f7ce100bc0f376c4c6e887abafa40e304", "author": {"user": {"login": "nae701", "name": "Natea Eshetu Beshada"}}, "url": "https://github.com/confluentinc/ksql/commit/952ee70f7ce100bc0f376c4c6e887abafa40e304", "committedDate": "2020-06-03T17:46:41Z", "message": "fix zero decimal bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d65350c3456cff77219afc69ba350f291408592", "author": {"user": {"login": "nae701", "name": "Natea Eshetu Beshada"}}, "url": "https://github.com/confluentinc/ksql/commit/8d65350c3456cff77219afc69ba350f291408592", "committedDate": "2020-06-03T20:59:56Z", "message": "fix zero decimal bug and add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2e9e6f22cf0c09c88f54b52aa7fe41949538aaf", "author": {"user": {"login": "nae701", "name": "Natea Eshetu Beshada"}}, "url": "https://github.com/confluentinc/ksql/commit/e2e9e6f22cf0c09c88f54b52aa7fe41949538aaf", "committedDate": "2020-06-03T21:09:59Z", "message": "merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44da38dfcb9a625fa57293c9b21799b437038d93", "author": {"user": {"login": "nae701", "name": "Natea Eshetu Beshada"}}, "url": "https://github.com/confluentinc/ksql/commit/44da38dfcb9a625fa57293c9b21799b437038d93", "committedDate": "2020-06-03T21:15:16Z", "message": "fix zero decimal bug add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f7e3812d2e095cf255069b1014496214c67821e", "author": {"user": {"login": "nae701", "name": "Natea Eshetu Beshada"}}, "url": "https://github.com/confluentinc/ksql/commit/8f7e3812d2e095cf255069b1014496214c67821e", "committedDate": "2020-06-03T21:24:55Z", "message": "merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDAxMDYw", "url": "https://github.com/confluentinc/ksql/pull/5531#pullrequestreview-424001060", "createdAt": "2020-06-03T23:19:35Z", "commit": {"oid": "8f7e3812d2e095cf255069b1014496214c67821e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4704, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}