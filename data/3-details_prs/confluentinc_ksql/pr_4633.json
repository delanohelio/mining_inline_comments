{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTMxOTkw", "number": 4633, "title": "Use the new topics endpoint in Connect REST API to describe the topics of a connector", "bodyText": "Description\nAfter KIP-558 and starting with Apache Kafka version 2.5, Kafka Connect adds a new 'topics' endpoint per connector to discover the set of topics a connector is using during runtime. Using this new endpoint will allow ksqlDB to get a more accurate view of a connector's active topics. The code is refactor to no longer depend on listing the topics with an adminclient when describing a connector in ksqlDB\nDetails on active topics tracking here:\nhttps://cwiki.apache.org/confluence/display/KAFKA/KIP-558%3A+Track+the+set+of+actively+used+topics+by+connectors+in+Kafka+Connect\nTesting done\nExisting unit tests were adjusted to test the new functionality.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-02-26T01:08:40Z", "url": "https://github.com/confluentinc/ksql/pull/4633", "merged": true, "mergeCommit": {"oid": "6dd3066cf1b8dd552fcd82f4c1dafe3cd81a65f1"}, "closed": true, "closedAt": "2020-03-10T18:15:46Z", "author": {"login": "kkonstantine"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIBFZ0gBqjMwNzIzNTcxMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMGrdCAFqTM3MTU5Njc5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e5242666a42aece824020d6a70ca5d31f403b59", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/0e5242666a42aece824020d6a70ca5d31f403b59", "committedDate": "2020-02-26T00:45:30Z", "message": "test: adapt tests to the new topics method"}, "afterCommit": {"oid": "5f7b34515d1d8ecec8aaad2e8639bcdf435178d6", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/5f7b34515d1d8ecec8aaad2e8639bcdf435178d6", "committedDate": "2020-02-26T06:53:05Z", "message": "feat: use TypeReference instead of Class when reading json responses from Connect"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTU4NzI3", "url": "https://github.com/confluentinc/ksql/pull/4633#pullrequestreview-367558727", "createdAt": "2020-03-02T21:57:43Z", "commit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1Nzo0M1rOFwwy-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjozNDoxNlrOFwx01A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NTQ1MA==", "bodyText": "is there any reason we can't use Map<String, ActiveTopicsInfo> for this API?", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386675450", "createdAt": "2020-03-02T21:57:43Z", "author": {"login": "agavra"}, "path": "ksql-engine/src/main/java/io/confluent/ksql/services/DefaultConnectClient.java", "diffHunk": "@@ -214,6 +224,33 @@ public DefaultConnectClient(\n     }\n   }\n \n+  @Override\n+  public ConnectResponse<Map<String, Map<String, List<String>>>> topics(final String connector) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NjEwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              protected static final String TOPICS_KEY = \"topics\";\n          \n          \n            \n              static final String TOPICS_KEY = \"topics\";\n          \n      \n    \n    \n  \n\nnit: since this is final, might as well make it package-private", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386676100", "createdAt": "2020-03-02T21:59:05Z", "author": {"login": "agavra"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -46,6 +45,8 @@\n public final class DescribeConnectorExecutor {\n \n   private static final Logger LOG = LoggerFactory.getLogger(DescribeConnectorExecutor.class);\n+  @VisibleForTesting\n+  protected static final String TOPICS_KEY = \"topics\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NjUyMQ==", "bodyText": "we should remove this method from the Connector class altogether as I believe this was the only place this was used (EDIT: see comment below)", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386676521", "createdAt": "2020-03-02T21:59:56Z", "author": {"login": "agavra"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -137,16 +145,4 @@ public DescribeConnectorExecutor() {\n \n     return Optional.of(description);\n   }\n-\n-  private List<String> getTopics(final Admin admin, final Optional<Connector> connector)\n-      throws Exception {\n-    if (!connector.isPresent()) {\n-      return ImmutableList.of();\n-    }\n-\n-    return admin.listTopics().names().get(5, TimeUnit.SECONDS)\n-        .stream()\n-        .filter(connector.get()::matches)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MjMwOA==", "bodyText": "we should use the information here before getting the data sources above (basically instead of calling matches on L106 above we should check topics#contains)", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386692308", "createdAt": "2020-03-02T22:34:16Z", "author": {"login": "agavra"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -114,16 +115,23 @@ public DescribeConnectorExecutor() {\n       sources = ImmutableList.of();\n     }\n \n-    List<KsqlWarning> warnings;\n-    List<String> topics;\n-    try {\n-      topics = getTopics(serviceContext.getAdminClient(), connector);\n-      warnings = ImmutableList.of();\n-    } catch (final Exception e) {\n+    final ConnectResponse<Map<String, Map<String, List<String>>>> topicsResponse = serviceContext\n+        .getConnectClient()\n+        .topics(connectorName);\n+\n+    final List<KsqlWarning> warnings;\n+    final List<String> topics;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e32f177a86a403716716b19dfc653fb810856a12", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/e32f177a86a403716716b19dfc653fb810856a12", "committedDate": "2020-03-06T01:23:24Z", "message": "feat: extend ConnectClient to add topics method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ff683bdce91c84426e60f4f0c2c5b73dbba47ec", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/1ff683bdce91c84426e60f4f0c2c5b73dbba47ec", "committedDate": "2020-03-06T01:23:24Z", "message": "feat: use ConnectClient#topics to describe a connector's topics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96b2dba253a2cd2913674693c68d1b43d52514b8", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/96b2dba253a2cd2913674693c68d1b43d52514b8", "committedDate": "2020-03-06T01:23:24Z", "message": "test: adapt tests to the new topics method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8465ea945a94d7915be51f55843b334fed24f3c", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/f8465ea945a94d7915be51f55843b334fed24f3c", "committedDate": "2020-03-06T01:23:24Z", "message": "feat: use TypeReference instead of Class when reading json responses from Connect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81176925254ef18f58d3f64d78139b5ba14ef35e", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/81176925254ef18f58d3f64d78139b5ba14ef35e", "committedDate": "2020-03-06T01:23:24Z", "message": "fix: use the correct endpoint for connector topics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2915ea8a35042973ef505c529057967d24e83581", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/2915ea8a35042973ef505c529057967d24e83581", "committedDate": "2020-03-06T01:23:24Z", "message": "fix: use the correct endpoint for connector topics in test too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9644053344e3d9bd2dfc831fcae3aad3875b1b89", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/9644053344e3d9bd2dfc831fcae3aad3875b1b89", "committedDate": "2020-03-06T01:23:24Z", "message": "fix: remove topic-prefix as a requirement from connector configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/0dd0a0be11087bc80029236164de5839485260e0", "committedDate": "2020-02-26T19:57:11Z", "message": "fix: use the correct endpoint for connector topics in test too"}, "afterCommit": {"oid": "9644053344e3d9bd2dfc831fcae3aad3875b1b89", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/9644053344e3d9bd2dfc831fcae3aad3875b1b89", "committedDate": "2020-03-06T01:23:24Z", "message": "fix: remove topic-prefix as a requirement from connector configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "455024508986e26273668b7ec704b7daf28f8154", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/455024508986e26273668b7ec704b7daf28f8154", "committedDate": "2020-03-06T02:20:49Z", "message": "fix: remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "234d4d8e014df1366cf8f648158192d85f6915ef", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/234d4d8e014df1366cf8f648158192d85f6915ef", "committedDate": "2020-03-06T02:59:10Z", "message": "Update ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java\r\n\r\nstyle: prefer package private access for fields visible for testing\n\nCo-Authored-By: Almog Gavra <almog@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1acf0782ad0b04e1df165ab6a177e66e135a9ca", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/e1acf0782ad0b04e1df165ab6a177e66e135a9ca", "committedDate": "2020-03-06T06:41:24Z", "message": "fix: remove unused local variable from JdbcSource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d26dbe7f7257608cc8a9e6bf634488b479912b80", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/d26dbe7f7257608cc8a9e6bf634488b479912b80", "committedDate": "2020-03-06T18:18:26Z", "message": "test: adapt test to not expect a call to topics for unknown connectors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b46738c488f6db9d96e51c4c4a1a8c88bdbcfcc", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/confluentinc/ksql/commit/8b46738c488f6db9d96e51c4c4a1a8c88bdbcfcc", "committedDate": "2020-03-09T19:31:01Z", "message": "fix: minor cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTk2Nzk4", "url": "https://github.com/confluentinc/ksql/pull/4633#pullrequestreview-371596798", "createdAt": "2020-03-09T23:40:04Z", "commit": {"oid": "8b46738c488f6db9d96e51c4c4a1a8c88bdbcfcc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4876, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}