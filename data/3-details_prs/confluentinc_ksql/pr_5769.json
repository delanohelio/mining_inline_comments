{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MDU4ODc0", "number": 5769, "title": "fix: ensure null values cast to varchar/string remain null", "bodyText": "Description\nFixes #4892\nString.valueOf() will return the string \"null\" when a null value is passed in. Using Object.toString(obj, defaultValue) allows the null value to be returned when a null is passed in https://docs.oracle.com/javase/8/docs/api/java/util/Objects.html#toString-java.lang.Object-java.lang.String-\nTesting done\nTested the scenario described in the ticket\nAdded new QTT case\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-07-06T23:55:00Z", "url": "https://github.com/confluentinc/ksql/pull/5769", "merged": true, "mergeCommit": {"oid": "530eb7f93686106deac153b2fb4268d91a3b7672"}, "closed": true, "closedAt": "2020-07-14T00:43:05Z", "author": {"login": "stevenpyzhang"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczlrVBAFqTQ0NjUxMDY0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0py2yABqjM1NDE2MzQwODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTEwNjQ3", "url": "https://github.com/confluentinc/ksql/pull/5769#pullrequestreview-446510647", "createdAt": "2020-07-10T15:49:51Z", "commit": {"oid": "e0c79f43643c7a9ef09b7d14540cc7da05e7e5e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTo0OTo1MlrOGv8exQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTo0OTo1MlrOGv8exQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkyNzE3Mw==", "bodyText": "looking at the plan.json that was generated from the test, I'm not sure this is backwards compatible - unless I'm missing something, we don't add the generated java code to the plan that we enqueue (cc @rodesai to comment on whether or not including that might be a good idea). That would mean that we would be changing any existing query to have this behavior.\nwe should consider whether this backwards incompatible change is acceptable or if we should guard this with a config that defaults to disabled, but any new query would have it enabled", "url": "https://github.com/confluentinc/ksql/pull/5769#discussion_r452927173", "createdAt": "2020-07-10T15:49:52Z", "author": {"login": "agavra"}, "path": "ksqldb-execution/src/main/java/io/confluent/ksql/execution/codegen/SqlToJavaVisitor.java", "diffHunk": "@@ -932,7 +933,7 @@ private CastVisitor() {\n         final int scale = decimal.getScale();\n         exprStr = String.format(\"DecimalUtil.format(%d, %d, %s)\", precision, scale, expr.getLeft());\n       } else {\n-        exprStr = \"String.valueOf(\" + expr.getLeft() + \")\";\n+        exprStr = \"Objects.toString(\" + expr.getLeft() + \", null)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0c79f43643c7a9ef09b7d14540cc7da05e7e5e2"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66c34aca1b086a4e558d567a8276228f981dd083", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/66c34aca1b086a4e558d567a8276228f981dd083", "committedDate": "2020-07-10T18:06:07Z", "message": "fix: ensure null values cast to varchar/string remain null"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0c79f43643c7a9ef09b7d14540cc7da05e7e5e2", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/e0c79f43643c7a9ef09b7d14540cc7da05e7e5e2", "committedDate": "2020-07-06T23:51:47Z", "message": "fix: ensure null values cast to varchar/string remain null"}, "afterCommit": {"oid": "66c34aca1b086a4e558d567a8276228f981dd083", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/66c34aca1b086a4e558d567a8276228f981dd083", "committedDate": "2020-07-10T18:06:07Z", "message": "fix: ensure null values cast to varchar/string remain null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1440810db9f2d6d04e09894d3ddbd1fab94c0bf", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/e1440810db9f2d6d04e09894d3ddbd1fab94c0bf", "committedDate": "2020-07-13T16:59:44Z", "message": "make a config to toggle fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c8f800b755506da1a55098b1d58b36472128595", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/5c8f800b755506da1a55098b1d58b36472128595", "committedDate": "2020-07-13T16:22:48Z", "message": "make a config to toggle fix"}, "afterCommit": {"oid": "e1440810db9f2d6d04e09894d3ddbd1fab94c0bf", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/e1440810db9f2d6d04e09894d3ddbd1fab94c0bf", "committedDate": "2020-07-13T16:59:44Z", "message": "make a config to toggle fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8a5cbed1d29f571592b627e479476280c505576", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/e8a5cbed1d29f571592b627e479476280c505576", "committedDate": "2020-07-13T19:40:32Z", "message": "update plans"}, "afterCommit": {"oid": "2a4c54dca04d32194d9272f6e4279e4465f6e63e", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/2a4c54dca04d32194d9272f6e4279e4465f6e63e", "committedDate": "2020-07-13T19:41:57Z", "message": "update plans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "728f4b41a39876fb056431fae0be6eda6440a15f", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/728f4b41a39876fb056431fae0be6eda6440a15f", "committedDate": "2020-07-13T19:46:27Z", "message": "update plans"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a4c54dca04d32194d9272f6e4279e4465f6e63e", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/2a4c54dca04d32194d9272f6e4279e4465f6e63e", "committedDate": "2020-07-13T19:41:57Z", "message": "update plans"}, "afterCommit": {"oid": "728f4b41a39876fb056431fae0be6eda6440a15f", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/728f4b41a39876fb056431fae0be6eda6440a15f", "committedDate": "2020-07-13T19:46:27Z", "message": "update plans"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjQyODU1", "url": "https://github.com/confluentinc/ksql/pull/5769#pullrequestreview-447642855", "createdAt": "2020-07-13T22:05:02Z", "commit": {"oid": "728f4b41a39876fb056431fae0be6eda6440a15f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjQ0ODM1", "url": "https://github.com/confluentinc/ksql/pull/5769#pullrequestreview-447644835", "createdAt": "2020-07-13T22:09:16Z", "commit": {"oid": "728f4b41a39876fb056431fae0be6eda6440a15f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjowOToxNlrOGw8BRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjowOToxNlrOGw8BRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk2ODE5OA==", "bodyText": "maybe ksql.cast.strings.stringify.nulls (or flipping the semantics ksql.cast.strings.preserve.nulls)", "url": "https://github.com/confluentinc/ksql/pull/5769#discussion_r453968198", "createdAt": "2020-07-13T22:09:16Z", "author": {"login": "agavra"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java", "diffHunk": "@@ -215,8 +215,10 @@\n   public static final String KSQL_QUERY_PULL_MAX_QPS_DOC = \"The maximum qps allowed for pull \"\n       + \"queries. Once the limit is hit, queries will fail immediately\";\n \n-  public static final Collection<CompatibilityBreakingConfigDef> COMPATIBLY_BREAKING_CONFIG_DEFS\n-      = ImmutableList.of();\n+  public static final String KSQL_STRING_CASE_CONFIG_TOGGLE = \"ksql.string.case.toggle\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "728f4b41a39876fb056431fae0be6eda6440a15f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a70989390ae4ec688bf499b70dbcf5adeb26b3", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/02a70989390ae4ec688bf499b70dbcf5adeb26b3", "committedDate": "2020-07-13T23:11:40Z", "message": "change config name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a38bfc8f94815fc3a807e055dbc065cd92718c8a", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/a38bfc8f94815fc3a807e055dbc065cd92718c8a", "committedDate": "2020-07-13T22:32:36Z", "message": "rename config"}, "afterCommit": {"oid": "02a70989390ae4ec688bf499b70dbcf5adeb26b3", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/02a70989390ae4ec688bf499b70dbcf5adeb26b3", "committedDate": "2020-07-13T23:11:40Z", "message": "change config name"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4809, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}