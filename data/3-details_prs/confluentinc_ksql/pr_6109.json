{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NzcxNjI4", "number": 6109, "title": "feat: clarify key or value in (de)serialization processing log messages", "bodyText": "Description\nFixes #5627\nCurrently, there's nothing in the processing log message for (de)serialization errors to indicate whether it was the record key or value that failed to serialize/deserialize. This PR adds a new field to the relevant processing log message schemas called \"component\" with value \"key\" or \"value\" to indicate so.\nNot in love with the name \"component\" but couldn't think of anything better. Suggestions appreciated!\nAlso fixes a typo in the Kafka deserializer error message that indicated the wrong format (delimited).\nTesting done\nUnit + manual.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-08-27T15:16:39Z", "url": "https://github.com/confluentinc/ksql/pull/6109", "merged": true, "mergeCommit": {"oid": "7a16b91850c6428bd71d858e4dfd100a0088df36"}, "closed": true, "closedAt": "2020-09-08T02:13:57Z", "author": {"login": "vcrfxia"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDB4rKgH2gAyNDc0NzcxNjI4OjY2MzM4OTA1MjRjNjI5MWY3NWJjYmZkZjkxYTBhNDc5ZTNkYTVhNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFG6TPAH2gAyNDc0NzcxNjI4OjJjODI4Zjg3OGExZGExZGI0ZWM2ZTEzZTUxNTQ3ZTI0YmYzMGY5YjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6633890524c6291f75bcbfdf91a0a479e3da5a46", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/6633890524c6291f75bcbfdf91a0a479e3da5a46", "committedDate": "2020-08-27T15:10:49Z", "message": "chore: fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/b63c2960c11fcd95bc5809323044ed04ce6ccaf8", "committedDate": "2020-08-27T15:10:49Z", "message": "feat: add component to (de)serialization processing log messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODI2NjY4", "url": "https://github.com/confluentinc/ksql/pull/6109#pullrequestreview-476826668", "createdAt": "2020-08-27T15:18:04Z", "commit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNToxODowNFrOHIVPug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNToxODowNFrOHIVPug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ5ODc0Ng==", "bodyText": "Not a huge fan of the name \"component\" but couldn't think of anything better. Hopefully someone else has a better suggestion?", "url": "https://github.com/confluentinc/ksql/pull/6109#discussion_r478498746", "createdAt": "2020-08-27T15:18:04Z", "author": {"login": "vcrfxia"}, "path": "docs/developer-guide/test-and-debug/processing-log.md", "diffHunk": "@@ -121,6 +121,11 @@ message.deserializationError (STRUCT)\n :   The contents of a message with type 0 (DESERIALIZATION_ERROR).\n     Logged when a deserializer fails to deserialize an {{ site.ak }} record.\n \n+message.deserializationError.component (STRING)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTU0ODQx", "url": "https://github.com/confluentinc/ksql/pull/6109#pullrequestreview-476954841", "createdAt": "2020-08-27T17:55:41Z", "commit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5Njk0ODU3", "url": "https://github.com/confluentinc/ksql/pull/6109#pullrequestreview-479694857", "createdAt": "2020-09-01T12:34:27Z", "commit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjozNDoyOFrOHK0L4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjo0MTo0M1rOHK0ctQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwMjgxOA==", "bodyText": "Don't mind component or part, or how about target?", "url": "https://github.com/confluentinc/ksql/pull/6109#discussion_r481102818", "createdAt": "2020-09-01T12:34:28Z", "author": {"login": "big-andy-coates"}, "path": "docs/developer-guide/test-and-debug/processing-log.md", "diffHunk": "@@ -121,6 +121,11 @@ message.deserializationError (STRUCT)\n :   The contents of a message with type 0 (DESERIALIZATION_ERROR).\n     Logged when a deserializer fails to deserialize an {{ site.ak }} record.\n \n+message.deserializationError.component (STRING)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ5ODc0Ng=="}, "originalCommit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNTIxMw==", "bodyText": "We should have a unit test testing this. Can you add one please?", "url": "https://github.com/confluentinc/ksql/pull/6109#discussion_r481105213", "createdAt": "2020-09-01T12:38:26Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/logging/processing/SerializationError.java", "diffHunk": "@@ -58,30 +59,32 @@ public boolean equals(final Object o) {\n     if (o == null || getClass() != o.getClass()) {\n       return false;\n     }\n-    final SerializationError<?> that = (SerializationError) o;\n+    final SerializationError<?> that = (SerializationError<?>) o;\n     return Objects.equals(exception, that.exception)\n         && Objects.equals(record, that.record)\n-        && Objects.equals(topic, that.topic);\n+        && Objects.equals(topic, that.topic)\n+        && isKey == that.isKey;\n   }\n \n   @Override\n   public int hashCode() {\n-    return Objects.hash(exception, record, topic);\n+    return Objects.hash(exception, record, topic, isKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNTU1OQ==", "bodyText": "We should have a unit test testing this. Can you add one please?", "url": "https://github.com/confluentinc/ksql/pull/6109#discussion_r481105559", "createdAt": "2020-09-01T12:38:59Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/logging/processing/DeserializationError.java", "diffHunk": "@@ -62,27 +63,29 @@ public boolean equals(final Object o) {\n     final DeserializationError that = (DeserializationError) o;\n     return Objects.equals(exception, that.exception)\n         && Objects.equals(record, that.record)\n-        && Objects.equals(topic, that.topic);\n+        && Objects.equals(topic, that.topic)\n+        && isKey == that.isKey;\n   }\n \n   @Override\n   public int hashCode() {\n-    return Objects.hash(exception, record, topic);\n+    return Objects.hash(exception, record, topic, isKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNjEzMw==", "bodyText": "I know this is a cut & paste, but I've seen this remove(0) remove the actual cause of the error, e.g. I've seen cases where exception is a simple NullPointerException and the remove(0) has resulted in an empty cause list.\nPersonally, I'd remove the remove and inline this method.\nWhich would only leave getRecordComponent, which I'd also be tempted to remove, and just add appropriate \"key\" and \"value\" constants to ProcessingLogMessageSchema instead.", "url": "https://github.com/confluentinc/ksql/pull/6109#discussion_r481106133", "createdAt": "2020-09-01T12:39:58Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/logging/processing/LoggingSerdeUtil.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.logging.processing;\n+\n+import io.confluent.ksql.util.ErrorMessageUtil;\n+import java.util.List;\n+\n+final class LoggingSerdeUtil {\n+\n+  private LoggingSerdeUtil() {\n+  }\n+\n+  static List<String> getCause(final Throwable exception) {\n+    final List<String> cause = ErrorMessageUtil.getErrorMessages(exception);\n+    cause.remove(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNzEyNQ==", "bodyText": "Probably worth adding a test that called configure with isKey=true, and ensure logged error has isKey=true.\nSame for LoggingSerializerTest.", "url": "https://github.com/confluentinc/ksql/pull/6109#discussion_r481107125", "createdAt": "2020-09-01T12:41:43Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-serde/src/test/java/io/confluent/ksql/logging/processing/LoggingDeserializerTest.java", "diffHunk": "@@ -60,6 +61,7 @@\n   @Before\n   public void setUp() {\n     deserializer = new LoggingDeserializer<>(delegate, processingLogger);\n+    deserializer.configure(Collections.emptyMap(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63c2960c11fcd95bc5809323044ed04ce6ccaf8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b47e9476c91192d6201ea35cbff8b40f579804e3", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/b47e9476c91192d6201ea35cbff8b40f579804e3", "committedDate": "2020-09-03T01:52:39Z", "message": "test: add hashcode and equals tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fc4dec270388ab1c48454a068ff273dcd3dc9cc", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/9fc4dec270388ab1c48454a068ff273dcd3dc9cc", "committedDate": "2020-09-03T02:06:13Z", "message": "test: add logging serde unit test for keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c828f878a1da1db4ec6e13e51547e24bf30f9b4", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/2c828f878a1da1db4ec6e13e51547e24bf30f9b4", "committedDate": "2020-09-03T02:09:58Z", "message": "chore: rename component to target"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4736, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}