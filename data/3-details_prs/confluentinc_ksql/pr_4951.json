{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NjUyOTg1", "number": 4951, "title": "feat: Adds rate limiting to pull queries", "bodyText": "Description\nAdds the use of a rate limiter for pull queries, to allow for capping QPS.  Fails immediately if limit is reached.\nFixes #4445\nTesting done\nmvn package\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-03-31T22:50:12Z", "url": "https://github.com/confluentinc/ksql/pull/4951", "merged": true, "mergeCommit": {"oid": "6284111652252b63cfc233bdfc3e08dbff983bbd"}, "closed": true, "closedAt": "2020-04-02T17:16:58Z", "author": {"login": "AlanConfluent"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTLokvgFqTM4NTE3MTA5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTfYUoAH2gAyMzk2NjUyOTg1OjQ2MGFlZTM5NjI3ODI5MTRhODUyZWNkNTRkYjY3MmIyMmZjOThhYmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTcxMDkz", "url": "https://github.com/confluentinc/ksql/pull/4951#pullrequestreview-385171093", "createdAt": "2020-03-31T23:23:54Z", "commit": {"oid": "3dc64405c7ae9933d55cb7b9d2bab2876c944628"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMzoyMzo1NFrOF-rqXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMzoyMzo1NFrOF-rqXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI3MTM4OQ==", "bodyText": "how does this interact with host forwarding? If I forwarded to a host that is overwhelmed will I then try it's standby? It might make sense to check the error message and not forward to another host in this scenario (not sure if that's what happens or not)", "url": "https://github.com/confluentinc/ksql/pull/4951#discussion_r401271389", "createdAt": "2020-03-31T23:23:54Z", "author": {"login": "agavra"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/PullQueryExecutor.java", "diffHunk": "@@ -168,6 +172,11 @@ public TableRowsEntity execute(\n               + \"this feature.\");\n     }\n \n+    if (!rateLimiter.tryAcquire()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc64405c7ae9933d55cb7b9d2bab2876c944628"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "540d154cbfb048852df10a76028e5663b939cfdb", "author": {"user": {"login": "AlanConfluent", "name": "Alan Sheinberg"}}, "url": "https://github.com/confluentinc/ksql/commit/540d154cbfb048852df10a76028e5663b939cfdb", "committedDate": "2020-03-31T23:49:32Z", "message": "feat: Adds rate limiting to pull queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb51d46b2553ba49ad688b6eaabcf8e01576f1d", "author": {"user": {"login": "AlanConfluent", "name": "Alan Sheinberg"}}, "url": "https://github.com/confluentinc/ksql/commit/3eb51d46b2553ba49ad688b6eaabcf8e01576f1d", "committedDate": "2020-04-01T00:38:31Z", "message": "Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3dc64405c7ae9933d55cb7b9d2bab2876c944628", "author": {"user": {"login": "AlanConfluent", "name": "Alan Sheinberg"}}, "url": "https://github.com/confluentinc/ksql/commit/3dc64405c7ae9933d55cb7b9d2bab2876c944628", "committedDate": "2020-03-31T22:37:14Z", "message": "feat: Adds rate limiting to pull queries"}, "afterCommit": {"oid": "3eb51d46b2553ba49ad688b6eaabcf8e01576f1d", "author": {"user": {"login": "AlanConfluent", "name": "Alan Sheinberg"}}, "url": "https://github.com/confluentinc/ksql/commit/3eb51d46b2553ba49ad688b6eaabcf8e01576f1d", "committedDate": "2020-04-01T00:38:31Z", "message": "Tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1Nzc4MDY2", "url": "https://github.com/confluentinc/ksql/pull/4951#pullrequestreview-385778066", "createdAt": "2020-04-01T17:00:57Z", "commit": {"oid": "3eb51d46b2553ba49ad688b6eaabcf8e01576f1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNzowMDo1N1rOF_KDwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNzowMDo1N1rOF_KDwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc2OTQwOQ==", "bodyText": "How does this fail here? There are no queries issued?", "url": "https://github.com/confluentinc/ksql/pull/4951#discussion_r401769409", "createdAt": "2020-04-01T17:00:57Z", "author": {"login": "vpapavas"}, "path": "ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/server/execution/PullQueryExecutorTest.java", "diffHunk": "@@ -118,4 +120,22 @@ public void shouldRedirectQueriesToQueryEndPoint() {\n       );\n     }\n   }\n+\n+  @RunWith(MockitoJUnitRunner.class)\n+  public static class RateLimit {\n+\n+    @Rule\n+    public final TemporaryEngine engine = new TemporaryEngine()\n+        .withConfigs(ImmutableMap.of(KsqlConfig.KSQL_QUERY_PULL_MAX_QPS_CONFIG, 2));\n+\n+    @Test\n+    public void shouldRateLimit() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eb51d46b2553ba49ad688b6eaabcf8e01576f1d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1Nzc4ODIz", "url": "https://github.com/confluentinc/ksql/pull/4951#pullrequestreview-385778823", "createdAt": "2020-04-01T17:01:59Z", "commit": {"oid": "3eb51d46b2553ba49ad688b6eaabcf8e01576f1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "460aee3962782914a852ecd54db672b22fc98abb", "author": {"user": {"login": "AlanConfluent", "name": "Alan Sheinberg"}}, "url": "https://github.com/confluentinc/ksql/commit/460aee3962782914a852ecd54db672b22fc98abb", "committedDate": "2020-04-01T22:24:16Z", "message": "Feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4969, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}