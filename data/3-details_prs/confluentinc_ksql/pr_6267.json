{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDY5OTk0", "number": 6267, "title": "feat: new CLI parameter to execute a command and quit (without CLI interaction)", "bodyText": "Description\nFixes #4981\nAdds a new paramter to the CLI to execute a command and quit. This without having to interact with the CLI console.\nsergio@pop-os:~/Development/ksql$ time ./bin/ksql -e \"show streams;\"\n\n Stream Name         | Kafka Topic                 | Format \n------------------------------------------------------------\n KSQL_PROCESSING_LOG | default_ksql_processing_log | JSON   \n TOPIC1              | topic1                      | JSON   \n------------------------------------------------------------\n\nreal\t0m2.250s\nuser\t0m4.604s\nsys\t0m0.185s\n\nsergio@pop-os:~/Development/ksql$ ./bin/ksql -e \"set 'auto.offset.reset'='earliest'; select * from topic1 emit changes;\"\nSuccessfully changed local property 'auto.offset.reset' to 'earliest'. Use the UNSET command to revert your change.\n+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|ID                                                                                                                                                                                                                               |\n+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|1                                                                                                                                                                                                                                |\n^CQuery terminated\n\nYou can use a different output format to easily parse the command result. For instance, JSON:\n$ ./bin/ksql -e \"show streams\" --output JSON | jq '.[].streams' | jq '.[].name'\n\"TOPIC1\"\n\"KSQL_PROCESSING_LOG\"\n\"S1\"\n\nTesting done\nAdded unit tests\nVerified manually\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-09-21T18:06:02Z", "url": "https://github.com/confluentinc/ksql/pull/6267", "merged": true, "mergeCommit": {"oid": "0d60246f95bbd43e7f8c3f33105e351762461aa6"}, "closed": true, "closedAt": "2020-10-02T13:20:38Z", "author": {"login": "spena"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLHJYVgH2gAyNDkwNDY5OTk0OjU0Mjg4ODhmMjhiMWJmOWZmZDdkNzFlNDBhY2I1NzkwYzE1YTc1NGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdObkH0AFqTUwMDgxMjAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5428888f28b1bf9ffd7d71e40acb5790c15a754b", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/5428888f28b1bf9ffd7d71e40acb5790c15a754b", "committedDate": "2020-09-21T17:49:59Z", "message": "feat: new CLI parameter to execute a command and quit (without CLI interaction)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMTQ2MjIw", "url": "https://github.com/confluentinc/ksql/pull/6267#pullrequestreview-493146220", "createdAt": "2020-09-22T06:05:07Z", "commit": {"oid": "5428888f28b1bf9ffd7d71e40acb5790c15a754b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwNjowNTowN1rOHVrQ-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwNjowNjozNVrOHVrS1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MTAwMg==", "bodyText": "nit: the user may not understand \"command\" - maybe \"run one or more ksql statements and quit.\"?", "url": "https://github.com/confluentinc/ksql/pull/6267#discussion_r492491002", "createdAt": "2020-09-22T06:05:07Z", "author": {"login": "rodesai"}, "path": "ksqldb-cli/src/main/java/io/confluent/ksql/cli/Options.java", "diffHunk": "@@ -111,6 +113,12 @@\n           + \"defaults to TABULAR)\")\n   private String outputFormat = OutputFormat.TABULAR.name();\n \n+  @SuppressWarnings(\"unused\") // Accessed via reflection\n+  @Option(\n+      name = {EXECUTE_OPTION, EXECUTE_SHORT_OPTION},\n+      description = \"Execute a command and quit.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5428888f28b1bf9ffd7d71e40acb5790c15a754b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MTQ3Ng==", "bodyText": "why the empty log message?", "url": "https://github.com/confluentinc/ksql/pull/6267#discussion_r492491476", "createdAt": "2020-09-22T06:06:35Z", "author": {"login": "rodesai"}, "path": "ksqldb-cli/src/main/java/io/confluent/ksql/cli/Cli.java", "diffHunk": "@@ -179,13 +182,31 @@ public void makeKsqlRequest(final String statements) {\n     throw new KsqlRestClientException(\"Failed to execute request \" + ksql);\n   }\n \n+  public void runCommand(final String command) {\n+    RemoteServerSpecificCommand.validateClient(terminal.writer(), restClient);\n+    try {\n+      // Handles the RUN SCRIPT command if found\n+      if (!terminal.maybeHandleCliSpecificCommands(command)) {\n+        handleLine(command);\n+      }\n+    } catch (final EndOfFileException exception) {\n+      // Ignore - only used by runInteractively() to exit the CLI\n+    } catch (final Exception exception) {\n+      LOGGER.error(\"\", exception);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5428888f28b1bf9ffd7d71e40acb5790c15a754b"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c", "committedDate": "2020-09-22T15:18:00Z", "message": "fix: address PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwODEyMDAy", "url": "https://github.com/confluentinc/ksql/pull/6267#pullrequestreview-500812002", "createdAt": "2020-10-02T01:19:04Z", "commit": {"oid": "63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4666, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}