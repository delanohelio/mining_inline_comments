{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMzI3MzI5", "number": 5921, "title": "chore: isTopicExists should not throw if topic has denied authorization", "bodyText": "Description\nKSQL should treated unauthorized topics as not existing. Recently, there was a change in the KafkaTopicClientImpl.isTopicExists() that causes the method to throw a TopicAuthorizationException if the topic does not exist. This code used to call the listTopicNames().contains(topic) which wasn't including the topic thus returning false when it is not authorized to see it.\nTesting done\nAdded unit test\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-07-31T17:08:52Z", "url": "https://github.com/confluentinc/ksql/pull/5921", "merged": true, "mergeCommit": {"oid": "0f3178565f18ea26cfd2f12b9d2094d4cf5485c9"}, "closed": true, "closedAt": "2020-08-04T13:45:17Z", "author": {"login": "spena"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6XcuggFqTQ1OTMzMTU1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7eEtzgBqjM2MTgzNzM3NjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzMxNTU5", "url": "https://github.com/confluentinc/ksql/pull/5921#pullrequestreview-459331559", "createdAt": "2020-07-31T17:12:52Z", "commit": {"oid": "1bad64a55835ac84675f396f4c60de845b930f99"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNzoxMjo1M1rOG6P3fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNzoxMjo1M1rOG6P3fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMDU1Nw==", "bodyText": "I originally had the code like this, but @rodesai convinced me that it shouldn't. If we know that we can't access it then we know that it exists. I feel like we should propagate this exception. Is there any issue you found that made you submit this PR?", "url": "https://github.com/confluentinc/ksql/pull/5921#discussion_r463730557", "createdAt": "2020-07-31T17:12:53Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/services/KafkaTopicClientImpl.java", "diffHunk": "@@ -173,6 +173,9 @@ public boolean isTopicExists(final String topic) {\n           RetryBehaviour.ON_RETRYABLE.and(e -> !(e instanceof UnknownTopicOrPartitionException))\n       );\n       return true;\n+    } catch (final TopicAuthorizationException e) {\n+      LOG.debug(\"Topic {} has denied authorization. Marking topic as not existing.\", topic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bad64a55835ac84675f396f4c60de845b930f99"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bad64a55835ac84675f396f4c60de845b930f99", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/1bad64a55835ac84675f396f4c60de845b930f99", "committedDate": "2020-07-31T17:05:00Z", "message": "chore: isTopicExists should not throw if topic has denied authorization"}, "afterCommit": {"oid": "7c85bbf81c07c96a595e4211e3e552714277b095", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/7c85bbf81c07c96a595e4211e3e552714277b095", "committedDate": "2020-08-03T18:18:58Z", "message": "chore: throw KsqlTopicAuthorizationException from isTopicExists"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjUyMzc2", "url": "https://github.com/confluentinc/ksql/pull/5921#pullrequestreview-460252376", "createdAt": "2020-08-03T18:32:48Z", "commit": {"oid": "7c85bbf81c07c96a595e4211e3e552714277b095"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6846c93a07dba3a444d1da6ef789ed281e05265f", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/6846c93a07dba3a444d1da6ef789ed281e05265f", "committedDate": "2020-08-04T03:29:40Z", "message": "chore: isTopicExists should not throw if topic has denied authorization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745b4ca1453151d24a29f0cba2c5d9a05f523037", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/745b4ca1453151d24a29f0cba2c5d9a05f523037", "committedDate": "2020-08-04T03:29:40Z", "message": "chore: throw KsqlTopicAuthorizationException from isTopicExists"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c85bbf81c07c96a595e4211e3e552714277b095", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/7c85bbf81c07c96a595e4211e3e552714277b095", "committedDate": "2020-08-03T18:18:58Z", "message": "chore: throw KsqlTopicAuthorizationException from isTopicExists"}, "afterCommit": {"oid": "745b4ca1453151d24a29f0cba2c5d9a05f523037", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/745b4ca1453151d24a29f0cba2c5d9a05f523037", "committedDate": "2020-08-04T03:29:40Z", "message": "chore: throw KsqlTopicAuthorizationException from isTopicExists"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4773, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}