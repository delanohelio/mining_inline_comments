{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MTM5MDc0", "number": 5368, "title": "refactor: Cleanup and refactoring of new server API", "bodyText": "Description\nThis PR contains a bunch of refactorings around the new API which help to unify it somewhat with the old REST API. It includes:\n\nRefactoring of error codes - The new API uses the same error code mechanism as the old REST API. The old API error codes haven't changed\nMoving some of the protocol classes into rest-model\nMerging of ServerVerticle and PortedEndpoints - simplifying the routing logic in one place.\nVarious other refactorings around ServerVerticle - moving some logic out into util classes.\n\nTesting done\nNon functional change.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-05-14T17:17:10Z", "url": "https://github.com/confluentinc/ksql/pull/5368", "merged": true, "mergeCommit": {"oid": "a56c54ae8c74cfcf7cede0636b23c08c9d605542"}, "closed": true, "closedAt": "2020-05-18T08:16:55Z", "author": {"login": "purplefox"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchheEzABqjMzNDA3NjEyODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcibasXAH2gAyNDE4MTM5MDc0OmZiYzUxNmVlOWM0MjMxODk0ODVkM2NjZGMzMjVkMTBjMGZjZjU3NTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8c6a1cb0b026a0b5458b387142db05c39e8f047", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/f8c6a1cb0b026a0b5458b387142db05c39e8f047", "committedDate": "2020-05-15T12:34:21Z", "message": "Moved things around"}, "afterCommit": {"oid": "e76cb82dd3dacf2c594c2e9f2085b94d4220b6a9", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/e76cb82dd3dacf2c594c2e9f2085b94d4220b6a9", "committedDate": "2020-05-15T12:44:37Z", "message": "Moved things around"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzE4MjUy", "url": "https://github.com/confluentinc/ksql/pull/5368#pullrequestreview-412718252", "createdAt": "2020-05-15T14:51:19Z", "commit": {"oid": "cb6c6a5cf38fd38879179de7eb44e4453fc2458c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b91cb0a88027708ae9ef25a8634992de5b0f968", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/3b91cb0a88027708ae9ef25a8634992de5b0f968", "committedDate": "2020-05-15T17:21:47Z", "message": "fixed test"}, "afterCommit": {"oid": "104b46fc664448a1a45097f2b391dc88068d5393", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/104b46fc664448a1a45097f2b391dc88068d5393", "committedDate": "2020-05-15T19:14:30Z", "message": "fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7686d3f3f8a1c036a54a6b8ef913f7fb91c3ed5e", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/7686d3f3f8a1c036a54a6b8ef913f7fb91c3ed5e", "committedDate": "2020-05-17T07:27:33Z", "message": "Unify rest errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b05bf6606de9ba8712d7afea28e1d41b044bf1d5", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/b05bf6606de9ba8712d7afea28e1d41b044bf1d5", "committedDate": "2020-05-17T07:27:33Z", "message": "new API refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bb61ff8fbfd85cae58fea90082d47a6561f7fd7", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/5bb61ff8fbfd85cae58fea90082d47a6561f7fd7", "committedDate": "2020-05-17T07:27:33Z", "message": "findbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e38b691bdaf6689c9e924deaeca30f6d4acf7bce", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/e38b691bdaf6689c9e924deaeca30f6d4acf7bce", "committedDate": "2020-05-17T07:27:33Z", "message": "add jsonignoreproperties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3510c52095ee87d8788396e4253913954c15fa23", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/3510c52095ee87d8788396e4253913954c15fa23", "committedDate": "2020-05-17T07:27:33Z", "message": "Unify POJO serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baadbdd385c70d97fba75bf87c01060df353b896", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/baadbdd385c70d97fba75bf87c01060df353b896", "committedDate": "2020-05-17T07:27:33Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac1965bab8c86290d7bb8e50d29f6e16217eb9a9", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/ac1965bab8c86290d7bb8e50d29f6e16217eb9a9", "committedDate": "2020-05-17T07:27:34Z", "message": "Moved things around"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15bd28bb00384044b8dced2eb3b2a61ff8467bd", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/f15bd28bb00384044b8dced2eb3b2a61ff8467bd", "committedDate": "2020-05-17T07:27:34Z", "message": "Moved things around"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "171b0d8a239cead0bab12cca952e8d7362b9358d", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/171b0d8a239cead0bab12cca952e8d7362b9358d", "committedDate": "2020-05-17T07:27:34Z", "message": "fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8890549921f8740c13c21734c2335c7e9e86160b", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/8890549921f8740c13c21734c2335c7e9e86160b", "committedDate": "2020-05-17T07:30:59Z", "message": "fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/b698eaed0d4eed6c228a0e58cff594e29718ac5b", "committedDate": "2020-05-17T07:43:02Z", "message": "fixed test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "104b46fc664448a1a45097f2b391dc88068d5393", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/104b46fc664448a1a45097f2b391dc88068d5393", "committedDate": "2020-05-15T19:14:30Z", "message": "fixed test"}, "afterCommit": {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/b698eaed0d4eed6c228a0e58cff594e29718ac5b", "committedDate": "2020-05-17T07:43:02Z", "message": "fixed test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMjAwMzIy", "url": "https://github.com/confluentinc/ksql/pull/5368#pullrequestreview-413200322", "createdAt": "2020-05-17T21:28:50Z", "commit": {"oid": "104b46fc664448a1a45097f2b391dc88068d5393"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMToyOTowOVrOGWjtaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QyMTozMTowOFrOGWjuHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNjkyMQ==", "bodyText": "Why do we need to add this? I thought the point in setting .disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES) in ApiJsonMapper was precisely so that we wouldn't have to individually set @JsonIgnoreProperties(ignoreUnknown = true) on each of the request and response types.", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426306921", "createdAt": "2020-05-17T21:29:09Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/CloseQueryArgs.java", "diffHunk": "@@ -13,17 +13,18 @@\n  * specific language governing permissions and limitations under the License.\n  */\n \n-package io.confluent.ksql.api.server.protocol;\n+package io.confluent.ksql.rest.entity;\n \n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import com.google.errorprone.annotations.Immutable;\n-import io.confluent.ksql.api.server.PushQueryId;\n import java.util.Objects;\n \n /**\n  * Represents the arguments to a close query request\n  */\n @Immutable\n+@JsonIgnoreProperties(ignoreUnknown = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNjk1Mw==", "bodyText": "This looks like it was meant to be removed.", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426306953", "createdAt": "2020-05-17T21:29:43Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java", "diffHunk": "@@ -63,6 +69,23 @@\n   public static final int ERROR_CODE_SERVER_ERROR =\n       toErrorCode(INTERNAL_SERVER_ERROR.code());\n \n+  /*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNzEwMw==", "bodyText": "This PR is a breaking change since some of the error codes for the new API endpoints have changed. Can we mark it as a breaking change in the PR and commit description? Do we need to make updates to any of the examples that use the new API endpoints (e.g., the Javascript ride-sharing app)?", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426307103", "createdAt": "2020-05-17T21:31:08Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java", "diffHunk": "@@ -40,13 +40,19 @@\n   public static final int ERROR_CODE_BAD_STATEMENT = toErrorCode(BAD_REQUEST.code()) + 1;\n   private static final int ERROR_CODE_QUERY_ENDPOINT = toErrorCode(BAD_REQUEST.code()) + 2;\n \n+  public static final int ERROR_CODE_MAX_PUSH_QUERIES_EXCEEDED =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbc516ee9c423189485d3ccdc325d10c0fcf5750", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/fbc516ee9c423189485d3ccdc325d10c0fcf5750", "committedDate": "2020-05-18T08:16:06Z", "message": "Removed some commented out code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4760, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}