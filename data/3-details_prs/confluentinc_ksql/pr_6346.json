{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NDYzOTA2", "number": 6346, "title": "feat: add commandRunnerCheck to healthcheck detail", "bodyText": "Description\n#6308\nExposes command runner health in the healthcheck endpoint\nTesting done\nIssued a request to healthcheck endpoint\nUnit test\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-10-01T18:29:04Z", "url": "https://github.com/confluentinc/ksql/pull/6346", "merged": true, "mergeCommit": {"oid": "5f64d05540039282739526ec24c0b3ba7f0f67ae"}, "closed": true, "closedAt": "2020-10-02T23:17:30Z", "author": {"login": "stevenpyzhang"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOJQYmgH2gAyNDk2NDYzOTA2OmQ1MWVmZjA1NWIyYTU5MGM2Njc1MjI4ZGI2ZTk0N2Y4N2YwNzRhMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOlxD5gFqTUwMTEyMTUzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d51eff055b2a590c6675228db6e947f87f074a08", "author": {"user": {"login": "stevenpyzhang", "name": "Steven Zhang"}}, "url": "https://github.com/confluentinc/ksql/commit/d51eff055b2a590c6675228db6e947f87f074a08", "committedDate": "2020-10-01T03:59:13Z", "message": "feat: add commandRunnerCheck to healthcheck detail"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTIxNTM4", "url": "https://github.com/confluentinc/ksql/pull/6346#pullrequestreview-501121538", "createdAt": "2020-10-02T13:12:03Z", "commit": {"oid": "d51eff055b2a590c6675228db6e947f87f074a08"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoxMjowNFrOHbtDZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoxMjowNFrOHbtDZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgxMTc1MQ==", "bodyText": "Do we understand what causes the command runner to transition into ERROR state in practice? From looking at the code, it looks like this happens if the command runner has been unable to poll for 15 seconds (by default). Do we have a sense of how often this happens in practice, and why? It'd be good to have some assurance that this is rare, and that when it happens it singles an actual issue rather than something spurious, else failing the healthcheck because of it would not provide useful signal to users.\nBTW, how was the 15 second default time limit chosen?", "url": "https://github.com/confluentinc/ksql/pull/6346#discussion_r498811751", "createdAt": "2020-10-02T13:12:04Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/healthcheck/HealthCheckAgent.java", "diffHunk": "@@ -156,4 +162,24 @@ public HealthCheckResponseDetail check(final HealthCheckAgent healthCheckAgent)\n       return new HealthCheckResponseDetail(isHealthy);\n     }\n   }\n+\n+  private static class CommandRunnerCheck implements Check {\n+    private final String name;\n+\n+    CommandRunnerCheck(final String name) {\n+      this.name = Objects.requireNonNull(name, \"name\");\n+    }\n+\n+    @Override\n+    public String getName() {\n+      return name;\n+    }\n+\n+    @Override\n+    public HealthCheckResponseDetail check(final HealthCheckAgent healthCheckAgent) {\n+      return new HealthCheckResponseDetail(\n+          healthCheckAgent.commandRunner.checkCommandRunnerStatus()\n+              == CommandRunner.CommandRunnerStatus.RUNNING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d51eff055b2a590c6675228db6e947f87f074a08"}, "originalPosition": 64}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4615, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}