{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODM5OTEy", "number": 5969, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyNzo1NVrOEWYR8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMToyMVrOEWYUEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTAxOTM4OnYy", "diffSide": "RIGHT", "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyNzo1NVrOG9qetg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyNzo1NVrOG9qetg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMjMxMA==", "bodyText": "let's explicitly call out that -1L is \"unbounded\" and also we should describe the failure behavior (i.e. what happens if the bound is filled?)", "url": "https://github.com/confluentinc/ksql/pull/5969#discussion_r467312310", "createdAt": "2020-08-07T22:27:55Z", "author": {"login": "agavra"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java", "diffHunk": "@@ -304,10 +304,14 @@\n       + \"KSQL metastore backup files are located.\";\n \n   public static final String KSQL_SUPPRESS_ENABLED = \"ksql.suppress.enabled\";\n-  public static final Boolean KSQL_SUPPRESS_ENABLED_DEFAULT = false;\n+  public static final Boolean KSQL_SUPPRESS_ENABLED_DEFAULT = true;\n   public static final String KSQL_SUPPRESS_ENABLED_DOC =\n       \"Feature flag for suppression, specifically EMIT FINAL\";\n \n+  public static final String KSQL_SUPPRESS_BUFFER_SIZE = \"ksql.suppress.buffer.size\";\n+  public static final Long KSQL_SUPPRESS_BUFFER_SIZE_DEFAULT = -1L;\n+  public static final String KSQL_SUPPRESS_BUFFER_SIZE_DOC =\n+      \"Bound the size of the buffer used for suppression\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ec739b44f5aa591bedfcf7747a3f9781cc85"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTAyMDExOnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/planner/LogicalPlanner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyODoyNlrOG9qfJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyODoyNlrOG9qfJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMjQyMw==", "bodyText": "let's just toss in the config name here so that it's easier for people to track it down\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    throw new KsqlException(\"Suppression is currently disabled in the KsqlConfig.\");\n          \n          \n            \n                    throw new KsqlException(\"Suppression is currently disabled. You can enable it by setting \" + KsqlConfig.KSQL_SUPPRESS_ENABLED + \" to true\");", "url": "https://github.com/confluentinc/ksql/pull/5969#discussion_r467312423", "createdAt": "2020-08-07T22:28:26Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/planner/LogicalPlanner.java", "diffHunk": "@@ -143,6 +145,9 @@ public OutputNode buildPlan() {\n \n     if (analysis.getRefinementInfo().isPresent()\n         && analysis.getRefinementInfo().get().getOutputRefinement() == OutputRefinement.FINAL) {\n+      if (!ksqlConfig.getBoolean(KsqlConfig.KSQL_SUPPRESS_ENABLED)) {\n+        throw new KsqlException(\"Suppression is currently disabled in the KsqlConfig.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ec739b44f5aa591bedfcf7747a3f9781cc85"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTAyMTc5OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/test/java/io/confluent/ksql/planner/LogicalPlannerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyOToyOFrOG9qgPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjoyOToyOFrOG9qgPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMjcwMQ==", "bodyText": "nit: used?", "url": "https://github.com/confluentinc/ksql/pull/5969#discussion_r467312701", "createdAt": "2020-08-07T22:29:28Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/planner/LogicalPlannerTest.java", "diffHunk": "@@ -45,6 +44,8 @@\n import io.confluent.ksql.util.KsqlException;\n import io.confluent.ksql.util.MetaStoreFixture;\n import java.util.Collections;\n+\n+import org.apache.kafka.common.config.ConfigDef;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ec739b44f5aa591bedfcf7747a3f9781cc85"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTAyMzY0OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/test/java/io/confluent/ksql/planner/LogicalPlannerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMDozMFrOG9qhYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMDozMFrOG9qhYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMjk5Mg==", "bodyText": "nit: add //given //when //then", "url": "https://github.com/confluentinc/ksql/pull/5969#discussion_r467312992", "createdAt": "2020-08-07T22:30:30Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/planner/LogicalPlannerTest.java", "diffHunk": "@@ -319,6 +323,20 @@ public void shouldThrowOnNonWindowedAggregationSuppressions() {\n \n     assertThat(e.getMessage(), containsString(\"EMIT FINAL is only supported for windowed aggregations.\"));\n   }\n+\n+  @Test\n+  public void shouldThrowOnSuppressDisabledInConfig() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ec739b44f5aa591bedfcf7747a3f9781cc85"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTAyNDM5OnYy", "diffSide": "RIGHT", "path": "ksqldb-streams/src/main/java/io/confluent/ksql/execution/streams/TableSuppressBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMTowNVrOG9qh0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMTowNVrOG9qh0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMzEwNA==", "bodyText": "I think checkstyle forces this to be final", "url": "https://github.com/confluentinc/ksql/pull/5969#discussion_r467313104", "createdAt": "2020-08-07T22:31:05Z", "author": {"login": "agavra"}, "path": "ksqldb-streams/src/main/java/io/confluent/ksql/execution/streams/TableSuppressBuilder.java", "diffHunk": "@@ -91,6 +93,18 @@ public TableSuppressBuilder() {\n             keySerde,\n             valueSerde\n         );\n+\n+    final Suppressed.StrictBufferConfig strictBufferConfig;\n+    long maxBytes = queryBuilder.getKsqlConfig().getLong(KsqlConfig.KSQL_SUPPRESS_BUFFER_SIZE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ec739b44f5aa591bedfcf7747a3f9781cc85"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTAyNDgyOnYy", "diffSide": "RIGHT", "path": "ksqldb-streams/src/main/java/io/confluent/ksql/execution/streams/TableSuppressBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMToyMVrOG9qiEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjozMToyMVrOG9qiEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMzE3MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (maxBytes == -1) {\n          \n          \n            \n                if (maxBytes < 0) {\n          \n      \n    \n    \n  \n\nnit: sometimes people typo", "url": "https://github.com/confluentinc/ksql/pull/5969#discussion_r467313170", "createdAt": "2020-08-07T22:31:21Z", "author": {"login": "agavra"}, "path": "ksqldb-streams/src/main/java/io/confluent/ksql/execution/streams/TableSuppressBuilder.java", "diffHunk": "@@ -91,6 +93,18 @@ public TableSuppressBuilder() {\n             keySerde,\n             valueSerde\n         );\n+\n+    final Suppressed.StrictBufferConfig strictBufferConfig;\n+    long maxBytes = queryBuilder.getKsqlConfig().getLong(KsqlConfig.KSQL_SUPPRESS_BUFFER_SIZE);\n+\n+    if (maxBytes == -1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ec739b44f5aa591bedfcf7747a3f9781cc85"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3065, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}