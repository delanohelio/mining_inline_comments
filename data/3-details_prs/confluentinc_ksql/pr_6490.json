{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzAxNTI2", "number": 6490, "title": "test: stop (r)qtt locking up", "bodyText": "Description\nFixes an issue where running QTT can cause IntelliJ and even MacOS to lockup for some period at the end of a test run.\nI've found that IntelliJ can lock up for over a minute after running all QTT tests.  This can sometimes cause MacOS to also become unresponsive.\nWell, I've finally tracked down the cause! The Confluent TestUtils class the code used to create temporary directories registers a shutdown hook for each temp directory created to ensure the directory is deleted on shutdown. (Simply calling deleteOnExist is not enough, as this fails if the directory is not empty).\nA new directory is created for each QTT/RQTT test.  This means thousands of hooks are registered, (there's currently over 5K QTT tests).  When the JVM is shutting down it creates THOUSANDS of threads, each trying to delete one directly.\nFixed by having a single parent directory, with a single shutdown hook.", "createdAt": "2020-10-22T13:42:18Z", "url": "https://github.com/confluentinc/ksql/pull/6490", "merged": true, "mergeCommit": {"oid": "d3a14c30af197d20842da2773f6f41a0c557b952"}, "closed": true, "closedAt": "2020-10-23T13:43:22Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVCLHoAH2gAyNTA4MzAxNTI2OjY4MzMxZDliNmFlOTYyNmZmOGY0MWIyODNhYWFlMTg0NmFhN2M2OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVV7FLgH2gAyNTA4MzAxNTI2OjBhM2NiYTQ2MDExMzZkMWU5ZDRiOGUwNGE1ZDAzZWU4ODYxOWQyZjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68331d9b6ae9626ff8f41b283aaae1846aa7c692", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/68331d9b6ae9626ff8f41b283aaae1846aa7c692", "committedDate": "2020-10-22T13:41:36Z", "message": "test: stop (r)qtt locking up\n\nFixes an issue where running QTT can cause IntelliJ and even MacOS to lockup for some period at the end of a test run.\n\nI've found that IntelliJ can lock up for over a minute after running all QTT tests.  This can sometimes cause MacOS to also become unresponsive.\n\nWell, I've finally tracked down the cause! The Confluent `TestUtils` class the code used to create temporary directories registers a shutdown hook for each temp directory created to ensure the directory is deleted on shutdown. (Simply calling `deleteOnExist` is not enough, as this fails if the directory is not empty).\n\nA new directory is created for each QTT/RQTT test.  This means thousands of hooks are registered, (there's currently over 5K QTT tests).  When the JVM is shutting down it creates THOUSANDS of threads, each trying to delete one directly.\n\nFixed by having a single parent directory, with a single shutdown hook."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODkwMTc0", "url": "https://github.com/confluentinc/ksql/pull/6490#pullrequestreview-514890174", "createdAt": "2020-10-22T16:04:23Z", "commit": {"oid": "68331d9b6ae9626ff8f41b283aaae1846aa7c692"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0OTI4Mjg0", "url": "https://github.com/confluentinc/ksql/pull/6490#pullrequestreview-514928284", "createdAt": "2020-10-22T16:48:15Z", "commit": {"oid": "68331d9b6ae9626ff8f41b283aaae1846aa7c692"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjo0ODoxNVrOHmq7hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjo0ODoxNVrOHmq7hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMTMwMg==", "bodyText": "Living in the past, I see ;P", "url": "https://github.com/confluentinc/ksql/pull/6490#discussion_r510311302", "createdAt": "2020-10-22T16:48:15Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-functional-tests/src/main/java/io/confluent/ksql/test/utils/TestUtils.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright 2019 Confluent Inc.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68331d9b6ae9626ff8f41b283aaae1846aa7c692"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff1847e8d4ecc86e7025fb6b315d06af3b85bcbe", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/ff1847e8d4ecc86e7025fb6b315d06af3b85bcbe", "committedDate": "2020-10-23T12:41:26Z", "message": "Merge branch 'master' into qtt_lock_up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a3cba4601136d1e9d4b8e04a5d03ee88619d2f1", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/0a3cba4601136d1e9d4b8e04a5d03ee88619d2f1", "committedDate": "2020-10-23T12:42:11Z", "message": "chore: update copyright year"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4587, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}