{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MTQ5MzQ1", "number": 6013, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzo1NTowNVrOEYEHgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDowMToxOVrOEYETRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjY4NzM5OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzo1NTowNVrOHAMpfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNToxNToxNFrOHAQQIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk2OTI3Ng==", "bodyText": "API of this class could be cleaner.  Currently its exposing implementation detail on its API, i.e. it's extending VisitParentExpressionVisitor.\nBetter / cleaner to instead have the visitor as an internal implementation detail and clean, documented, API for this class:\nclass GenericExpressionResolver {\n   \n  .... \n\n   public Object resolve(final Expression expression) {\n      return new Visitor().process(expression, null);\n   }\n\n   private static class Visitor extends VisitParentExpressionVisitor<Object, Void> {\n      ...\n   }\n}", "url": "https://github.com/confluentinc/ksql/pull/6013#discussion_r469969276", "createdAt": "2020-08-13T13:55:05Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.engine.generic;\n+\n+import com.google.common.collect.Iterables;\n+import io.confluent.ksql.GenericRow;\n+import io.confluent.ksql.execution.codegen.CodeGenRunner;\n+import io.confluent.ksql.execution.codegen.ExpressionMetadata;\n+import io.confluent.ksql.execution.expression.tree.Expression;\n+import io.confluent.ksql.execution.expression.tree.NullLiteral;\n+import io.confluent.ksql.execution.expression.tree.VisitParentExpressionVisitor;\n+import io.confluent.ksql.function.FunctionRegistry;\n+import io.confluent.ksql.logging.processing.ProcessingLogger;\n+import io.confluent.ksql.logging.processing.RecordProcessingError;\n+import io.confluent.ksql.name.ColumnName;\n+import io.confluent.ksql.schema.ksql.DefaultSqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.schema.ksql.SchemaConverters;\n+import io.confluent.ksql.schema.ksql.SqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.types.SqlBaseType;\n+import io.confluent.ksql.schema.ksql.types.SqlType;\n+import io.confluent.ksql.util.KsqlConfig;\n+import io.confluent.ksql.util.KsqlException;\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+import java.util.stream.Stream;\n+\n+/**\n+ * Builds a Java object, coerced to the desired type, from an arbitrary SQL\n+ * expression that does not reference any source data.\n+ */\n+class GenericExpressionResolver extends VisitParentExpressionVisitor<Object, Void> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42839b269ed9cc49f8269184e1b068e782b3742"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAyODMyMQ==", "bodyText": "done, I left it package private so that I could just copy it over from what it was - but I agree with you that this is cleaner.", "url": "https://github.com/confluentinc/ksql/pull/6013#discussion_r470028321", "createdAt": "2020-08-13T15:15:14Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.engine.generic;\n+\n+import com.google.common.collect.Iterables;\n+import io.confluent.ksql.GenericRow;\n+import io.confluent.ksql.execution.codegen.CodeGenRunner;\n+import io.confluent.ksql.execution.codegen.ExpressionMetadata;\n+import io.confluent.ksql.execution.expression.tree.Expression;\n+import io.confluent.ksql.execution.expression.tree.NullLiteral;\n+import io.confluent.ksql.execution.expression.tree.VisitParentExpressionVisitor;\n+import io.confluent.ksql.function.FunctionRegistry;\n+import io.confluent.ksql.logging.processing.ProcessingLogger;\n+import io.confluent.ksql.logging.processing.RecordProcessingError;\n+import io.confluent.ksql.name.ColumnName;\n+import io.confluent.ksql.schema.ksql.DefaultSqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.schema.ksql.SchemaConverters;\n+import io.confluent.ksql.schema.ksql.SqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.types.SqlBaseType;\n+import io.confluent.ksql.schema.ksql.types.SqlType;\n+import io.confluent.ksql.util.KsqlConfig;\n+import io.confluent.ksql.util.KsqlException;\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+import java.util.stream.Stream;\n+\n+/**\n+ * Builds a Java object, coerced to the desired type, from an arbitrary SQL\n+ * expression that does not reference any source data.\n+ */\n+class GenericExpressionResolver extends VisitParentExpressionVisitor<Object, Void> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk2OTI3Ng=="}, "originalCommit": {"oid": "f42839b269ed9cc49f8269184e1b068e782b3742"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjY5MzM2OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzo1NjowOVrOHAMs5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzo1NjowOVrOHAMs5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk3MDE1MA==", "bodyText": "wonder if this is a common enough pattern to warrant a singular CodeGenRunner.compileExpression helper method...", "url": "https://github.com/confluentinc/ksql/pull/6013#discussion_r469970150", "createdAt": "2020-08-13T13:56:09Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.engine.generic;\n+\n+import com.google.common.collect.Iterables;\n+import io.confluent.ksql.GenericRow;\n+import io.confluent.ksql.execution.codegen.CodeGenRunner;\n+import io.confluent.ksql.execution.codegen.ExpressionMetadata;\n+import io.confluent.ksql.execution.expression.tree.Expression;\n+import io.confluent.ksql.execution.expression.tree.NullLiteral;\n+import io.confluent.ksql.execution.expression.tree.VisitParentExpressionVisitor;\n+import io.confluent.ksql.function.FunctionRegistry;\n+import io.confluent.ksql.logging.processing.ProcessingLogger;\n+import io.confluent.ksql.logging.processing.RecordProcessingError;\n+import io.confluent.ksql.name.ColumnName;\n+import io.confluent.ksql.schema.ksql.DefaultSqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.schema.ksql.SchemaConverters;\n+import io.confluent.ksql.schema.ksql.SqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.types.SqlBaseType;\n+import io.confluent.ksql.schema.ksql.types.SqlType;\n+import io.confluent.ksql.util.KsqlConfig;\n+import io.confluent.ksql.util.KsqlException;\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+import java.util.stream.Stream;\n+\n+/**\n+ * Builds a Java object, coerced to the desired type, from an arbitrary SQL\n+ * expression that does not reference any source data.\n+ */\n+class GenericExpressionResolver extends VisitParentExpressionVisitor<Object, Void> {\n+\n+  private static final Supplier<String> IGNORED_MSG = () -> \"\";\n+  private static final ProcessingLogger THROWING_LOGGER = errorMessage -> {\n+    throw new KsqlException(((RecordProcessingError) errorMessage).getMessage());\n+  };\n+\n+  private final SqlType fieldType;\n+  private final ColumnName fieldName;\n+  private final LogicalSchema schema;\n+  private final SqlValueCoercer sqlValueCoercer = DefaultSqlValueCoercer.INSTANCE;\n+  private final FunctionRegistry functionRegistry;\n+  private final KsqlConfig config;\n+\n+  GenericExpressionResolver(\n+      final SqlType fieldType,\n+      final ColumnName fieldName,\n+      final LogicalSchema schema,\n+      final FunctionRegistry functionRegistry,\n+      final KsqlConfig config\n+  ) {\n+    this.fieldType = Objects.requireNonNull(fieldType, \"fieldType\");\n+    this.fieldName = Objects.requireNonNull(fieldName, \"fieldName\");\n+    this.schema = Objects.requireNonNull(schema, \"schema\");\n+    this.functionRegistry = Objects.requireNonNull(functionRegistry, \"functionRegistry\");\n+    this.config = Objects.requireNonNull(config, \"config\");\n+  }\n+\n+  @Override\n+  protected Object visitExpression(final Expression expression, final Void context) {\n+    final ExpressionMetadata metadata =\n+        Iterables.getOnlyElement(\n+            CodeGenRunner.compileExpressions(\n+                Stream.of(expression),\n+                \"insert value\",\n+                schema,\n+                config,\n+                functionRegistry)\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42839b269ed9cc49f8269184e1b068e782b3742"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjY5NTg3OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzo1NjozOFrOHAMuVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNTo0NTowN1rOHARgdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk3MDUxNw==", "bodyText": "Can the code be enhanced to throw on a column reference? Or does it already?", "url": "https://github.com/confluentinc/ksql/pull/6013#discussion_r469970517", "createdAt": "2020-08-13T13:56:38Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.engine.generic;\n+\n+import com.google.common.collect.Iterables;\n+import io.confluent.ksql.GenericRow;\n+import io.confluent.ksql.execution.codegen.CodeGenRunner;\n+import io.confluent.ksql.execution.codegen.ExpressionMetadata;\n+import io.confluent.ksql.execution.expression.tree.Expression;\n+import io.confluent.ksql.execution.expression.tree.NullLiteral;\n+import io.confluent.ksql.execution.expression.tree.VisitParentExpressionVisitor;\n+import io.confluent.ksql.function.FunctionRegistry;\n+import io.confluent.ksql.logging.processing.ProcessingLogger;\n+import io.confluent.ksql.logging.processing.RecordProcessingError;\n+import io.confluent.ksql.name.ColumnName;\n+import io.confluent.ksql.schema.ksql.DefaultSqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.schema.ksql.SchemaConverters;\n+import io.confluent.ksql.schema.ksql.SqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.types.SqlBaseType;\n+import io.confluent.ksql.schema.ksql.types.SqlType;\n+import io.confluent.ksql.util.KsqlConfig;\n+import io.confluent.ksql.util.KsqlException;\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+import java.util.stream.Stream;\n+\n+/**\n+ * Builds a Java object, coerced to the desired type, from an arbitrary SQL\n+ * expression that does not reference any source data.\n+ */\n+class GenericExpressionResolver extends VisitParentExpressionVisitor<Object, Void> {\n+\n+  private static final Supplier<String> IGNORED_MSG = () -> \"\";\n+  private static final ProcessingLogger THROWING_LOGGER = errorMessage -> {\n+    throw new KsqlException(((RecordProcessingError) errorMessage).getMessage());\n+  };\n+\n+  private final SqlType fieldType;\n+  private final ColumnName fieldName;\n+  private final LogicalSchema schema;\n+  private final SqlValueCoercer sqlValueCoercer = DefaultSqlValueCoercer.INSTANCE;\n+  private final FunctionRegistry functionRegistry;\n+  private final KsqlConfig config;\n+\n+  GenericExpressionResolver(\n+      final SqlType fieldType,\n+      final ColumnName fieldName,\n+      final LogicalSchema schema,\n+      final FunctionRegistry functionRegistry,\n+      final KsqlConfig config\n+  ) {\n+    this.fieldType = Objects.requireNonNull(fieldType, \"fieldType\");\n+    this.fieldName = Objects.requireNonNull(fieldName, \"fieldName\");\n+    this.schema = Objects.requireNonNull(schema, \"schema\");\n+    this.functionRegistry = Objects.requireNonNull(functionRegistry, \"functionRegistry\");\n+    this.config = Objects.requireNonNull(config, \"config\");\n+  }\n+\n+  @Override\n+  protected Object visitExpression(final Expression expression, final Void context) {\n+    final ExpressionMetadata metadata =\n+        Iterables.getOnlyElement(\n+            CodeGenRunner.compileExpressions(\n+                Stream.of(expression),\n+                \"insert value\",\n+                schema,\n+                config,\n+                functionRegistry)\n+        );\n+\n+    // we expect no column references, so we can pass in an empty generic row", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42839b269ed9cc49f8269184e1b068e782b3742"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0ODg4NQ==", "bodyText": "It never gets to this point because it can't prepare the statement. Added a test to confirm the behavior, making it better though is a little out of scope for this PR:\n    {\n      \"name\": \"should fail on column reference\",\n      \"statements\": [\n        \"CREATE STREAM TEST (K STRING KEY, ID INT) WITH (kafka_topic='test_topic', value_format='JSON');\",\n        \"INSERT INTO TEST (K, ID) VALUES (FOO.bar, '10');\"\n      ],\n      \"expectedError\": {\n        \"type\": \"io.confluent.ksql.rest.entity.KsqlStatementErrorMessage\",\n        \"message\": \"Failed to prepare statement: 'FOO' is not a valid stream/table name or alias.\",\n        \"status\": 400\n      }\n    }", "url": "https://github.com/confluentinc/ksql/pull/6013#discussion_r470048885", "createdAt": "2020-08-13T15:45:07Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericExpressionResolver.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.engine.generic;\n+\n+import com.google.common.collect.Iterables;\n+import io.confluent.ksql.GenericRow;\n+import io.confluent.ksql.execution.codegen.CodeGenRunner;\n+import io.confluent.ksql.execution.codegen.ExpressionMetadata;\n+import io.confluent.ksql.execution.expression.tree.Expression;\n+import io.confluent.ksql.execution.expression.tree.NullLiteral;\n+import io.confluent.ksql.execution.expression.tree.VisitParentExpressionVisitor;\n+import io.confluent.ksql.function.FunctionRegistry;\n+import io.confluent.ksql.logging.processing.ProcessingLogger;\n+import io.confluent.ksql.logging.processing.RecordProcessingError;\n+import io.confluent.ksql.name.ColumnName;\n+import io.confluent.ksql.schema.ksql.DefaultSqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.schema.ksql.SchemaConverters;\n+import io.confluent.ksql.schema.ksql.SqlValueCoercer;\n+import io.confluent.ksql.schema.ksql.types.SqlBaseType;\n+import io.confluent.ksql.schema.ksql.types.SqlType;\n+import io.confluent.ksql.util.KsqlConfig;\n+import io.confluent.ksql.util.KsqlException;\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+import java.util.stream.Stream;\n+\n+/**\n+ * Builds a Java object, coerced to the desired type, from an arbitrary SQL\n+ * expression that does not reference any source data.\n+ */\n+class GenericExpressionResolver extends VisitParentExpressionVisitor<Object, Void> {\n+\n+  private static final Supplier<String> IGNORED_MSG = () -> \"\";\n+  private static final ProcessingLogger THROWING_LOGGER = errorMessage -> {\n+    throw new KsqlException(((RecordProcessingError) errorMessage).getMessage());\n+  };\n+\n+  private final SqlType fieldType;\n+  private final ColumnName fieldName;\n+  private final LogicalSchema schema;\n+  private final SqlValueCoercer sqlValueCoercer = DefaultSqlValueCoercer.INSTANCE;\n+  private final FunctionRegistry functionRegistry;\n+  private final KsqlConfig config;\n+\n+  GenericExpressionResolver(\n+      final SqlType fieldType,\n+      final ColumnName fieldName,\n+      final LogicalSchema schema,\n+      final FunctionRegistry functionRegistry,\n+      final KsqlConfig config\n+  ) {\n+    this.fieldType = Objects.requireNonNull(fieldType, \"fieldType\");\n+    this.fieldName = Objects.requireNonNull(fieldName, \"fieldName\");\n+    this.schema = Objects.requireNonNull(schema, \"schema\");\n+    this.functionRegistry = Objects.requireNonNull(functionRegistry, \"functionRegistry\");\n+    this.config = Objects.requireNonNull(config, \"config\");\n+  }\n+\n+  @Override\n+  protected Object visitExpression(final Expression expression, final Void context) {\n+    final ExpressionMetadata metadata =\n+        Iterables.getOnlyElement(\n+            CodeGenRunner.compileExpressions(\n+                Stream.of(expression),\n+                \"insert value\",\n+                schema,\n+                config,\n+                functionRegistry)\n+        );\n+\n+    // we expect no column references, so we can pass in an empty generic row", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk3MDUxNw=="}, "originalCommit": {"oid": "f42839b269ed9cc49f8269184e1b068e782b3742"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjcxNzQ5OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericRecordFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDowMToxOVrOHAM7kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDowMToxOVrOHAM7kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk3MzkwNQ==", "bodyText": "nit: never used.", "url": "https://github.com/confluentinc/ksql/pull/6013#discussion_r469973905", "createdAt": "2020-08-13T14:01:19Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/generic/GenericRecordFactory.java", "diffHunk": "@@ -0,0 +1,199 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.engine.generic;\n+\n+import com.google.common.collect.Streams;\n+import io.confluent.ksql.GenericRow;\n+import io.confluent.ksql.execution.expression.tree.Expression;\n+import io.confluent.ksql.function.FunctionRegistry;\n+import io.confluent.ksql.metastore.model.DataSource;\n+import io.confluent.ksql.metastore.model.DataSource.DataSourceType;\n+import io.confluent.ksql.name.ColumnName;\n+import io.confluent.ksql.schema.ksql.Column;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.schema.ksql.SystemColumns;\n+import io.confluent.ksql.schema.ksql.types.SqlType;\n+import io.confluent.ksql.util.KsqlConfig;\n+import io.confluent.ksql.util.KsqlException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.function.LongSupplier;\n+import java.util.stream.Collectors;\n+import org.apache.kafka.connect.data.Struct;\n+\n+/**\n+ * Builds {@link KsqlGenericRecord} from lists of expressions/column names,\n+ * coercing any values to the correct java type using the schema of the supplied\n+ * {@link DataSource}.\n+ */\n+public class GenericRecordFactory {\n+\n+  private final KsqlConfig config;\n+  private final FunctionRegistry functionRegistry;\n+  private final LongSupplier clock;\n+\n+  public GenericRecordFactory(\n+      final KsqlConfig config,\n+      final FunctionRegistry functionRegistry\n+  ) {\n+    this(config, functionRegistry, System::currentTimeMillis);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42839b269ed9cc49f8269184e1b068e782b3742"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2862, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}