{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI5NDcxOTQ5", "number": 5563, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo1ODo1MFrOEDhIEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjoxMjoyM1rOEEXfWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTIzOTIzOnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/string/SplitToMap.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo1ODo1MFrOGglMjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjoxMjo0OFrOGgly8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgxNzAzOA==", "bodyText": "by the way, guava Splitter has support for withKeyValueSeparator to simplify exactly this :)\nFrom the docs:\n    /*\n     * For example, {@code\n     * Splitter.on(';').trimResults().withKeyValueSeparator(\"=>\").split(\"a=>b ; c=>b\")} will return\n     * a mapping from {@code \"a\"} to {@code \"b\"} and {@code \"c\"} to {@code \"b\"}.", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r436817038", "createdAt": "2020-06-08T15:58:50Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/string/SplitToMap.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and limitations under the\n+ * License.\n+ */\n+\n+package io.confluent.ksql.function.udf.string;\n+\n+import com.google.common.base.Splitter;\n+import io.confluent.ksql.function.udf.Udf;\n+import io.confluent.ksql.function.udf.UdfDescription;\n+import io.confluent.ksql.function.udf.UdfParameter;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+@UdfDescription(\n+    name = \"split_to_map\",\n+    description = \"Splits a string into key-value pairs and creates a map from them. The \"\n+        + \"'entryDelimiter' splits the string into key-value pairs which are then split by \"\n+        + \"'kvDelimiter'. If the same key is present multiple times in the input, the latest \"\n+        + \"value for that key is returned. Returns NULL f the input text or either of the \"\n+        + \"delimiters is NULL.\")\n+public class SplitToMap {\n+  @Udf\n+  public Map<String, String> splitToMap(\n+      @UdfParameter(\n+          description = \"Separator string and values to join\") final String input,\n+      @UdfParameter(\n+          description = \"Separator string and values to join\") final String entryDelimiter,\n+      @UdfParameter(\n+          description = \"Separator string and values to join\") final String kvDelimiter) {\n+\n+    if (input == null || entryDelimiter == null || kvDelimiter == null) {\n+      return null;\n+    }\n+\n+    if (entryDelimiter.isEmpty() || kvDelimiter.isEmpty() || entryDelimiter.equals(kvDelimiter)) {\n+      return null;\n+    }\n+\n+    final Iterable<String> entries = Splitter.on(entryDelimiter).omitEmptyStrings().split(input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgyNjg2NA==", "bodyText": "yeah, tried multiple ways with that at first but it's too inflexible and likes to throw a lot of exceptions on my test-cases :(", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r436826864", "createdAt": "2020-06-08T16:12:48Z", "author": {"login": "blueedgenick"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/string/SplitToMap.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and limitations under the\n+ * License.\n+ */\n+\n+package io.confluent.ksql.function.udf.string;\n+\n+import com.google.common.base.Splitter;\n+import io.confluent.ksql.function.udf.Udf;\n+import io.confluent.ksql.function.udf.UdfDescription;\n+import io.confluent.ksql.function.udf.UdfParameter;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+@UdfDescription(\n+    name = \"split_to_map\",\n+    description = \"Splits a string into key-value pairs and creates a map from them. The \"\n+        + \"'entryDelimiter' splits the string into key-value pairs which are then split by \"\n+        + \"'kvDelimiter'. If the same key is present multiple times in the input, the latest \"\n+        + \"value for that key is returned. Returns NULL f the input text or either of the \"\n+        + \"delimiters is NULL.\")\n+public class SplitToMap {\n+  @Udf\n+  public Map<String, String> splitToMap(\n+      @UdfParameter(\n+          description = \"Separator string and values to join\") final String input,\n+      @UdfParameter(\n+          description = \"Separator string and values to join\") final String entryDelimiter,\n+      @UdfParameter(\n+          description = \"Separator string and values to join\") final String kvDelimiter) {\n+\n+    if (input == null || entryDelimiter == null || kvDelimiter == null) {\n+      return null;\n+    }\n+\n+    if (entryDelimiter.isEmpty() || kvDelimiter.isEmpty() || entryDelimiter.equals(kvDelimiter)) {\n+      return null;\n+    }\n+\n+    final Iterable<String> entries = Splitter.on(entryDelimiter).omitEmptyStrings().split(input);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgxNzAzOA=="}, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTI0MjEyOnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/string/SplitToMap.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNTo1OTozMVrOGglOXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDozODowN1rOGiFdww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgxNzUwMw==", "bodyText": "We may also want to have EncodeMap(map, entry_delim, kv_delim) which encodes a map into a string", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r436817503", "createdAt": "2020-06-08T15:59:31Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/string/SplitToMap.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and limitations under the\n+ * License.\n+ */\n+\n+package io.confluent.ksql.function.udf.string;\n+\n+import com.google.common.base.Splitter;\n+import io.confluent.ksql.function.udf.Udf;\n+import io.confluent.ksql.function.udf.UdfDescription;\n+import io.confluent.ksql.function.udf.UdfParameter;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+@UdfDescription(\n+    name = \"split_to_map\",\n+    description = \"Splits a string into key-value pairs and creates a map from them. The \"\n+        + \"'entryDelimiter' splits the string into key-value pairs which are then split by \"\n+        + \"'kvDelimiter'. If the same key is present multiple times in the input, the latest \"\n+        + \"value for that key is returned. Returns NULL f the input text or either of the \"\n+        + \"delimiters is NULL.\")\n+public class SplitToMap {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NDMwNw==", "bodyText": "i'll add it to my udf backlog ;)   - although i'm less concerned about that from a use-case perspective as you can always construct almost-arbitrary json output by using structs/maps/arrays if you need that for a downstream system. The primary motivator for this one is when you get, for example, some encoded message from a mainframe MQ system that needs to be parsed out this way", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r438394307", "createdAt": "2020-06-10T20:38:07Z", "author": {"login": "blueedgenick"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/string/SplitToMap.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and limitations under the\n+ * License.\n+ */\n+\n+package io.confluent.ksql.function.udf.string;\n+\n+import com.google.common.base.Splitter;\n+import io.confluent.ksql.function.udf.Udf;\n+import io.confluent.ksql.function.udf.UdfDescription;\n+import io.confluent.ksql.function.udf.UdfParameter;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+@UdfDescription(\n+    name = \"split_to_map\",\n+    description = \"Splits a string into key-value pairs and creates a map from them. The \"\n+        + \"'entryDelimiter' splits the string into key-value pairs which are then split by \"\n+        + \"'kvDelimiter'. If the same key is present multiple times in the input, the latest \"\n+        + \"value for that key is returned. Returns NULL f the input text or either of the \"\n+        + \"delimiters is NULL.\")\n+public class SplitToMap {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgxNzUwMw=="}, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTk4MDk2OnYy", "diffSide": "RIGHT", "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToxMDowOVrOGgsZYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToxMDowOVrOGgsZYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkzNTAwOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            'entryDelimiter' splits the string into key-value pairs which are then split by 'kvDelimiter'. If the same key is present multiple times in the input, the latest value for that key is returned. \n          \n          \n            \n            `entryDelimiter` splits the string into key-value pairs which are then split by `kvDelimiter`. If the same key is present multiple times in the input, the latest value for that key is returned.", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r436935008", "createdAt": "2020-06-08T19:10:09Z", "author": {"login": "JimGalasyn"}, "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -701,6 +701,23 @@ If the delimiter is found at the beginning or end\n of the string, or there are contiguous delimiters,\n then an empty space is added to the array.\n \n+### `SPLIT_TO_MAP`\n+\n+```sql\n+SPLIT_TO_MAP(input, entryDelimiter, kvDelimiter)\n+```\n+\n+Splits a string into key-value pairs and creates a map from them. The \n+'entryDelimiter' splits the string into key-value pairs which are then split by 'kvDelimiter'. If the same key is present multiple times in the input, the latest value for that key is returned. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTk4Mjk2OnYy", "diffSide": "RIGHT", "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToxMDoyM1rOGgsacg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0MzozNFrOGiFodA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkzNTI4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Returns NULL f the input text is NULL.\n          \n          \n            \n            Returns NULL if the input text is NULL.", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r436935282", "createdAt": "2020-06-08T19:10:23Z", "author": {"login": "JimGalasyn"}, "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -701,6 +701,23 @@ If the delimiter is found at the beginning or end\n of the string, or there are contiguous delimiters,\n then an empty space is added to the array.\n \n+### `SPLIT_TO_MAP`\n+\n+```sql\n+SPLIT_TO_MAP(input, entryDelimiter, kvDelimiter)\n+```\n+\n+Splits a string into key-value pairs and creates a map from them. The \n+'entryDelimiter' splits the string into key-value pairs which are then split by 'kvDelimiter'. If the same key is present multiple times in the input, the latest value for that key is returned. \n+\n+Returns NULL f the input text is NULL.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NzA0NA==", "bodyText": "arghhh! thanks Jim :)", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r438397044", "createdAt": "2020-06-10T20:43:34Z", "author": {"login": "blueedgenick"}, "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -701,6 +701,23 @@ If the delimiter is found at the beginning or end\n of the string, or there are contiguous delimiters,\n then an empty space is added to the array.\n \n+### `SPLIT_TO_MAP`\n+\n+```sql\n+SPLIT_TO_MAP(input, entryDelimiter, kvDelimiter)\n+```\n+\n+Splits a string into key-value pairs and creates a map from them. The \n+'entryDelimiter' splits the string into key-value pairs which are then split by 'kvDelimiter'. If the same key is present multiple times in the input, the latest value for that key is returned. \n+\n+Returns NULL f the input text is NULL.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkzNTI4Mg=="}, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDE0NjE4OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/test/java/io/confluent/ksql/function/udf/string/SplitToMapTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjoxMjoyM1rOGh8Z9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNjo1ODo1NlrOGimbmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI0NTg3Ng==", "bodyText": "can you add a test with whitespace? what do we want the behavior to be when there is whitespace (e.g. foo := bar)", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r438245876", "createdAt": "2020-06-10T16:12:23Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/function/udf/string/SplitToMapTest.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright 2018 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+package io.confluent.ksql.function.udf.string;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.hasEntry;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+import org.junit.Test;\n+\n+public class SplitToMapTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkzNDQyNw==", "bodyText": "good idea, test added!", "url": "https://github.com/confluentinc/ksql/pull/5563#discussion_r438934427", "createdAt": "2020-06-11T16:58:56Z", "author": {"login": "blueedgenick"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/function/udf/string/SplitToMapTest.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright 2018 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+package io.confluent.ksql.function.udf.string;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.hasEntry;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+import org.junit.Test;\n+\n+public class SplitToMapTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI0NTg3Ng=="}, "originalCommit": {"oid": "638132435b096f3f01a5878be896006dad45922e"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3365, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}