{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MDM5Nzk4", "number": 5536, "title": "feat: new UDFs for working with Maps", "bodyText": "Three new UDFs:\n\nmap_keys(some_map) - get array of all keys from a map\nmap_values(some_map) - get array of all values from a map\nmap_union(map1, map2) - add all entries from 2 maps into a new map\n\nThis is an updated version of functions and their tests originally proposed waaaay back in PR #1611 and blocked at that time by limited scope for handling generics in the UDF invocation framework.\nIdeally I'd like to also make map_union variadic but the invocation framework will choke on that until #5511 is resolved.", "createdAt": "2020-06-03T08:18:31Z", "url": "https://github.com/confluentinc/ksql/pull/5536", "merged": true, "mergeCommit": {"oid": "bc9ad2ea93b08ace708d6e74684582fa3e9c2d4d"}, "closed": true, "closedAt": "2020-06-03T23:29:58Z", "author": {"login": "blueedgenick"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnk5m3AH2gAyNDI3MDM5Nzk4OjgwYjFhOGYwYjUxNjMwZDM0MjM1ZDU3MDRhN2NmMzU3ZWYyNTE2OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnyEo9gH2gAyNDI3MDM5Nzk4OjlkYmJiOTRhMTQ5ZTEyODhiZTk3NTdhY2M0OTRjMDVjYWQ1ZjFkZjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "80b1a8f0b51630d34235d5704a7cf357ef251699", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/80b1a8f0b51630d34235d5704a7cf357ef251699", "committedDate": "2020-06-03T08:08:38Z", "message": "initial version 3 new map udfs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7512103c40851c9394c07238f3ab4f5bdd42a734", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/7512103c40851c9394c07238f3ab4f5bdd42a734", "committedDate": "2020-06-03T14:33:46Z", "message": "make a couple of fields final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzQ3NjM0", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423747634", "createdAt": "2020-06-03T16:50:32Z", "commit": {"oid": "7512103c40851c9394c07238f3ab4f5bdd42a734"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjo1MDozMlrOGekzjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjo1MDozMlrOGekzjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxMzQ4NA==", "bodyText": "What if the maps have the same key with different values? Currently, the latter will be in the result. Maybe point this out in the description", "url": "https://github.com/confluentinc/ksql/pull/5536#discussion_r434713484", "createdAt": "2020-06-03T16:50:32Z", "author": {"login": "vpapavas"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/map/MapUnion.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and limitations under the\n+ * License.\n+ */\n+\n+package io.confluent.ksql.function.udf.map;\n+\n+import io.confluent.ksql.function.udf.Udf;\n+import io.confluent.ksql.function.udf.UdfDescription;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+@UdfDescription(\n+    name = \"map_union\",\n+    description = \"Returns a new map containing the union of all entries from both input maps. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7512103c40851c9394c07238f3ab4f5bdd42a734"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzQ5MDYx", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423749061", "createdAt": "2020-06-03T16:52:20Z", "commit": {"oid": "7512103c40851c9394c07238f3ab4f5bdd42a734"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjo1MjoyMFrOGek3tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjo1MjoyMFrOGek3tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxNDU0OA==", "bodyText": "Add @UdfParameter just so that it can compile without the -parameters in the pom file?", "url": "https://github.com/confluentinc/ksql/pull/5536#discussion_r434714548", "createdAt": "2020-06-03T16:52:20Z", "author": {"login": "vpapavas"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/map/MapUnion.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and limitations under the\n+ * License.\n+ */\n+\n+package io.confluent.ksql.function.udf.map;\n+\n+import io.confluent.ksql.function.udf.Udf;\n+import io.confluent.ksql.function.udf.UdfDescription;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+@UdfDescription(\n+    name = \"map_union\",\n+    description = \"Returns a new map containing the union of all entries from both input maps. \"\n+        + \"Returns NULL if all of the input maps are NULL.\")\n+public class MapUnion {\n+\n+  @Udf\n+  public <T> Map<String, T> union(final Map<String, T> input1, final Map<String, T> input2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7512103c40851c9394c07238f3ab4f5bdd42a734"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzU1OTc5", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423755979", "createdAt": "2020-06-03T17:01:04Z", "commit": {"oid": "7512103c40851c9394c07238f3ab4f5bdd42a734"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/0a22986c221289d883554c1e452d711f0e597c26", "committedDate": "2020-06-03T18:09:05Z", "message": "review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTEyMzYw", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423912360", "createdAt": "2020-06-03T20:39:57Z", "commit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDozOTo1N1rOGesh0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDozOTo1N1rOGesh0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg0MDAxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Returns an array of all the keys from the specified map.\n          \n          \n            \n            Returns an array that contains all of the keys from the specified map.", "url": "https://github.com/confluentinc/ksql/pull/5536#discussion_r434840016", "createdAt": "2020-06-03T20:39:57Z", "author": {"login": "JimGalasyn"}, "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -259,6 +259,52 @@ MAP(key VARCHAR := value, ...)\n \n Construct a map from specific key-value tuples.\n \n+### `MAP_KEYS`\n+\n+```sql\n+MAP_KEYS(a_map)\n+```\n+\n+Returns an array of all the keys from the specified map.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTEyOTY1", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423912965", "createdAt": "2020-06-03T20:40:50Z", "commit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo0MDo1MFrOGesjpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo0MDo1MFrOGesjpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg0MDQ4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Returns an array of all the values from the specified map.\n          \n          \n            \n            Returns an array that contains all of the values from the specified map.", "url": "https://github.com/confluentinc/ksql/pull/5536#discussion_r434840485", "createdAt": "2020-06-03T20:40:50Z", "author": {"login": "JimGalasyn"}, "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -259,6 +259,52 @@ MAP(key VARCHAR := value, ...)\n \n Construct a map from specific key-value tuples.\n \n+### `MAP_KEYS`\n+\n+```sql\n+MAP_KEYS(a_map)\n+```\n+\n+Returns an array of all the keys from the specified map.\n+\n+Returns NULL if the input map is NULL.\n+\n+Example:\n+```sql\n+map_keys( map('apple' := 10, 'banana' := 20) )  => ['apple', 'banana'] \n+```\n+\n+### `MAP_VALUES`\n+\n+```sql\n+MAP_VALUES(a_map)\n+```\n+\n+Returns an array of all the values from the specified map.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTE0MDc1", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423914075", "createdAt": "2020-06-03T20:42:35Z", "commit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo0MjozNVrOGesnFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo0MjozNVrOGesnFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg0MTM2NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Returns a new map containing the union of all entries from both input maps. If a key is present in both input maps then the corresponding value from _map2_ is the one which appears in the output.\n          \n          \n            \n            Returns a new map containing the union of all entries from both input maps. If a key is present in both input maps, the corresponding value from _map2_ is returned.", "url": "https://github.com/confluentinc/ksql/pull/5536#discussion_r434841365", "createdAt": "2020-06-03T20:42:35Z", "author": {"login": "JimGalasyn"}, "path": "docs/developer-guide/ksqldb-reference/scalar-functions.md", "diffHunk": "@@ -259,6 +259,52 @@ MAP(key VARCHAR := value, ...)\n \n Construct a map from specific key-value tuples.\n \n+### `MAP_KEYS`\n+\n+```sql\n+MAP_KEYS(a_map)\n+```\n+\n+Returns an array of all the keys from the specified map.\n+\n+Returns NULL if the input map is NULL.\n+\n+Example:\n+```sql\n+map_keys( map('apple' := 10, 'banana' := 20) )  => ['apple', 'banana'] \n+```\n+\n+### `MAP_VALUES`\n+\n+```sql\n+MAP_VALUES(a_map)\n+```\n+\n+Returns an array of all the values from the specified map.\n+\n+Returns NULL if the input map is NULL.\n+\n+Example:\n+```sql\n+map_values( map('apple' := 10, 'banana' := 20) )  => [10, 20] \n+```\n+\n+### `MAP_UNION`\n+\n+```sql\n+MAP_UNION(map1, map2)\n+```\n+\n+Returns a new map containing the union of all entries from both input maps. If a key is present in both input maps then the corresponding value from _map2_ is the one which appears in the output.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTE0NjU5", "url": "https://github.com/confluentinc/ksql/pull/5536#pullrequestreview-423914659", "createdAt": "2020-06-03T20:43:32Z", "commit": {"oid": "0a22986c221289d883554c1e452d711f0e597c26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2b02abbf5aa8406aa2cd22ec51925ac9a088edd", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/f2b02abbf5aa8406aa2cd22ec51925ac9a088edd", "committedDate": "2020-06-03T22:01:35Z", "message": "Update docs/developer-guide/ksqldb-reference/scalar-functions.md\r\n\r\nJim's doc feedback\n\nCo-authored-by: Jim Galasyn <jim.galasyn@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29076ea9872a44f0d5079073cbd9d121aa9863ac", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/29076ea9872a44f0d5079073cbd9d121aa9863ac", "committedDate": "2020-06-03T22:01:48Z", "message": "Update docs/developer-guide/ksqldb-reference/scalar-functions.md\r\n\r\nJim's doc feedback\n\nCo-authored-by: Jim Galasyn <jim.galasyn@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93de7b509e5e0e00ebce885205922c537cb89adf", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/93de7b509e5e0e00ebce885205922c537cb89adf", "committedDate": "2020-06-03T22:02:18Z", "message": "Update docs/developer-guide/ksqldb-reference/scalar-functions.md\r\n\r\nJim's doc feedback\n\nCo-authored-by: Jim Galasyn <jim.galasyn@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dbbb94a149e1288be9757acc494c05cad5f1df6", "author": {"user": {"login": "blueedgenick", "name": "Nick Dearden"}}, "url": "https://github.com/confluentinc/ksql/commit/9dbbb94a149e1288be9757acc494c05cad5f1df6", "committedDate": "2020-06-03T23:29:27Z", "message": "Merge branch 'master' into map_keys_values_union"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4709, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}