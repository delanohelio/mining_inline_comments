{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTMxOTkw", "number": 4633, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1Nzo0M1rODkcEXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjozNDoxNVrODkcuzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTM1MTk4OnYy", "diffSide": "RIGHT", "path": "ksql-engine/src/main/java/io/confluent/ksql/services/DefaultConnectClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1Nzo0M1rOFwwy-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODoxNDoyOVrOFyeeyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NTQ1MA==", "bodyText": "is there any reason we can't use Map<String, ActiveTopicsInfo> for this API?", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386675450", "createdAt": "2020-03-02T21:57:43Z", "author": {"login": "agavra"}, "path": "ksql-engine/src/main/java/io/confluent/ksql/services/DefaultConnectClient.java", "diffHunk": "@@ -214,6 +224,33 @@ public DefaultConnectClient(\n     }\n   }\n \n+  @Override\n+  public ConnectResponse<Map<String, Map<String, List<String>>>> topics(final String connector) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MjUyMw==", "bodyText": "The reason is that the key is the actual name of the connector and not connector : <connector name>\nMaybe my json foo is missing a way to deserialize this with a JsonCreator and the constructor, but based on what I know it can't be done with jackson and the return type that you mention (which is a bummer but we use that notation in other endpoints already). The return type is a bit verbose, indeed.", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r388472523", "createdAt": "2020-03-05T18:14:29Z", "author": {"login": "kkonstantine"}, "path": "ksql-engine/src/main/java/io/confluent/ksql/services/DefaultConnectClient.java", "diffHunk": "@@ -214,6 +224,33 @@ public DefaultConnectClient(\n     }\n   }\n \n+  @Override\n+  public ConnectResponse<Map<String, Map<String, List<String>>>> topics(final String connector) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NTQ1MA=="}, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTM1NjA3OnYy", "diffSide": "RIGHT", "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1OTowNVrOFww1hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODoxNTo0NVrOFyehWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NjEwMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              protected static final String TOPICS_KEY = \"topics\";\n          \n          \n            \n              static final String TOPICS_KEY = \"topics\";\n          \n      \n    \n    \n  \n\nnit: since this is final, might as well make it package-private", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386676100", "createdAt": "2020-03-02T21:59:05Z", "author": {"login": "agavra"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -46,6 +45,8 @@\n public final class DescribeConnectorExecutor {\n \n   private static final Logger LOG = LoggerFactory.getLogger(DescribeConnectorExecutor.class);\n+  @VisibleForTesting\n+  protected static final String TOPICS_KEY = \"topics\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MzE3OQ==", "bodyText": "I don't use package private that much for members that are meant to be visible in tests, but happy to adjust if that's the default in the project.", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r388473179", "createdAt": "2020-03-05T18:15:45Z", "author": {"login": "kkonstantine"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -46,6 +45,8 @@\n public final class DescribeConnectorExecutor {\n \n   private static final Logger LOG = LoggerFactory.getLogger(DescribeConnectorExecutor.class);\n+  @VisibleForTesting\n+  protected static final String TOPICS_KEY = \"topics\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NjEwMA=="}, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTM1ODYyOnYy", "diffSide": "LEFT", "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1OTo1NlrOFww3KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMjoxNTozOFrOFyrIxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NjUyMQ==", "bodyText": "we should remove this method from the Connector class altogether as I believe this was the only place this was used (EDIT: see comment below)", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386676521", "createdAt": "2020-03-02T21:59:56Z", "author": {"login": "agavra"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -137,16 +145,4 @@ public DescribeConnectorExecutor() {\n \n     return Optional.of(description);\n   }\n-\n-  private List<String> getTopics(final Admin admin, final Optional<Connector> connector)\n-      throws Exception {\n-    if (!connector.isPresent()) {\n-      return ImmutableList.of();\n-    }\n-\n-    return admin.listTopics().names().get(5, TimeUnit.SECONDS)\n-        .stream()\n-        .filter(connector.get()::matches)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY3OTg3OQ==", "bodyText": "Removed. Seems that there's no need for Connector#matches and Connector#mapToSource as well as their respect member fields. I removed a couple unit tests that were built around those two methods and will wait for a full build to see what else might need adjustment (I have some issues running the full test suite locally).", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r388679879", "createdAt": "2020-03-06T02:15:38Z", "author": {"login": "kkonstantine"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -137,16 +145,4 @@ public DescribeConnectorExecutor() {\n \n     return Optional.of(description);\n   }\n-\n-  private List<String> getTopics(final Admin admin, final Optional<Connector> connector)\n-      throws Exception {\n-    if (!connector.isPresent()) {\n-      return ImmutableList.of();\n-    }\n-\n-    return admin.listTopics().names().get(5, TimeUnit.SECONDS)\n-        .stream()\n-        .filter(connector.get()::matches)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NjUyMQ=="}, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTQ2MDYyOnYy", "diffSide": "RIGHT", "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjozNDoxNlrOFwx01A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMjoyMzo1M1rOFyrRBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MjMwOA==", "bodyText": "we should use the information here before getting the data sources above (basically instead of calling matches on L106 above we should check topics#contains)", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r386692308", "createdAt": "2020-03-02T22:34:16Z", "author": {"login": "agavra"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -114,16 +115,23 @@ public DescribeConnectorExecutor() {\n       sources = ImmutableList.of();\n     }\n \n-    List<KsqlWarning> warnings;\n-    List<String> topics;\n-    try {\n-      topics = getTopics(serviceContext.getAdminClient(), connector);\n-      warnings = ImmutableList.of();\n-    } catch (final Exception e) {\n+    final ConnectResponse<Map<String, Map<String, List<String>>>> topicsResponse = serviceContext\n+        .getConnectClient()\n+        .topics(connectorName);\n+\n+    final List<KsqlWarning> warnings;\n+    final List<String> topics;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY4MTk4OQ==", "bodyText": "Moved up with a small optimization to avoid hitting the topics endpoint if the first REST call did not return the connector's info. But if the doubly nested if does look great or you think it's worth calling regardless I can change the if/else", "url": "https://github.com/confluentinc/ksql/pull/4633#discussion_r388681989", "createdAt": "2020-03-06T02:23:53Z", "author": {"login": "kkonstantine"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/DescribeConnectorExecutor.java", "diffHunk": "@@ -114,16 +115,23 @@ public DescribeConnectorExecutor() {\n       sources = ImmutableList.of();\n     }\n \n-    List<KsqlWarning> warnings;\n-    List<String> topics;\n-    try {\n-      topics = getTopics(serviceContext.getAdminClient(), connector);\n-      warnings = ImmutableList.of();\n-    } catch (final Exception e) {\n+    final ConnectResponse<Map<String, Map<String, List<String>>>> topicsResponse = serviceContext\n+        .getConnectClient()\n+        .topics(connectorName);\n+\n+    final List<KsqlWarning> warnings;\n+    final List<String> topics;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MjMwOA=="}, "originalCommit": {"oid": "0dd0a0be11087bc80029236164de5839485260e0"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2007, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}