{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMTQ3ODEx", "number": 4469, "title": "feat: support Protobuf in ksqlDB", "bodyText": "fixes #278\nDescription\nThis PR introduces the PROTOBUF value format to ksqlDB:\n\nadded ProtobufFormat class and ProtobufSerdeFactory to handle most of the heavy lifting\nconversion between ParsedSchema and org.apache.kafka.connect.Schema now happens in the Format interface (cf. SchemaRegistryTopicSchemaSupplier)\nthe testing framework no longer depends on AvroSchema in its interface (instead it will convert it to a ParsedSchema) (cf. TestExecutorUtil, Topic, SerdeUtil and TopicNode)\nAdded a new RecordFormatter for printing out PRINT <topic> commands with PROTOBUF format\n\nNote on null and Default Values\nProtobuf handles null values differently than AVRO and JSON. Namely, it doesn't have the true concept of a null value so the way it converts between PROTOBUF and Java (Connect) objects is undefined. For the most part, it will resolve a \"missing field\" to its default value:\nFor strings, the default value is the empty string.\nFor bytes, the default value is empty bytes.\nFor bools, the default value is false.\nFor numeric types, the default value is zero.\nFor enums, the default value is the first defined enum value, which must be 0.\nFor message fields, the field is not set. Its exact value is language-dependent. See the generated code guide for details.\n\nSee the QTT tests for clarification on these default values.\nTesting done\nHonestly, 90% of this PR affects only test code :)\n\nadd PROTOBUF to many QTT tests\nUpdated unit tests were applicable\n\nksql> CREATE STREAM proto (age INT, name VARCHAR, jobs ARRAY<VARCHAR>, address STRUCT<street VARCHAR>) WITH (kafka_topic='proto1', value_format='PROTOBUF', partitions=1);\n\n Message\n----------------\n Stream created\n----------------\nksql> INSERT INTO proto (age, name, jobs, address) VALUES (27, 'gordon', ARRAY['the flash'], STRUCT(street:='7th ave'));\nksql> SET 'auto.offset.reset'='earliest';\nSuccessfully changed local property 'auto.offset.reset' to 'earliest'. Use the UNSET command to revert your change.\n\nksql> SELECT * from PROTO EMIT CHANGES;\n+--------------+--------------+--------------+--------------+--------------+--------------+\n|ROWTIME       |ROWKEY        |AGE           |NAME          |JOBS          |ADDRESS       |\n+--------------+--------------+--------------+--------------+--------------+--------------+\n|1581025858985 |null          |27            |gordon        |[the flash]   |{STREET=7th av|\n|              |              |              |              |              |e}            |\n\n\nksql> PRINT proto1 FROM BEGINNING;\nFormat:PROTOBUF\n2/6/20 1:50:58 PM PST, null, {AGE: 27 NAME: \"gordon\" JOBS: \"the flash\" ADDRESS { STREET: \"7th ave\" }}\n^CTopic printing ceased\nksql>\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-02-06T22:41:18Z", "url": "https://github.com/confluentinc/ksql/pull/4469", "merged": true, "mergeCommit": {"oid": "a77cebe88dae366a2e5367bc172379cfad87abf7"}, "closed": true, "closedAt": "2020-02-11T21:13:21Z", "author": {"login": "agavra"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcByqgIgBqjMwMTU3NDg5MDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDXq50ABqjMwMjgwODM4NTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "337df8fa03df84d1b3ebc6e1ca544716f1a3385c", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/337df8fa03df84d1b3ebc6e1ca544716f1a3385c", "committedDate": "2020-02-06T21:52:16Z", "message": "feat: support Protobuf in ksqlDB"}, "afterCommit": {"oid": "a862ea2ae3ac7b40261a065362c60b1b14c144b7", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/a862ea2ae3ac7b40261a065362c60b1b14c144b7", "committedDate": "2020-02-06T22:40:34Z", "message": "feat: support Protobuf in ksqlDB"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MzU3NTkw", "url": "https://github.com/confluentinc/ksql/pull/4469#pullrequestreview-356357590", "createdAt": "2020-02-11T00:19:56Z", "commit": {"oid": "a862ea2ae3ac7b40261a065362c60b1b14c144b7"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMDoxOTo1NlrOFn6RzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODo1Mzo1N1rOFoU--w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM5MzYxMw==", "bodyText": "was this intentional?", "url": "https://github.com/confluentinc/ksql/pull/4469#discussion_r377393613", "createdAt": "2020-02-11T00:19:56Z", "author": {"login": "rodesai"}, "path": "config/ksql-server.properties", "diffHunk": "@@ -62,4 +62,4 @@ bootstrap.servers=localhost:9092\n # ksql.connect.worker.config=config/connect.properties\n \n # Uncomment and complete the following to enable KSQL's integration to the Confluent Schema Registry:\n-#ksql.schema.registry.url=?\n+ksql.schema.registry.url=http://localhost:8081", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a862ea2ae3ac7b40261a065362c60b1b14c144b7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTE2Mw==", "bodyText": "should we add a test with a struct?", "url": "https://github.com/confluentinc/ksql/pull/4469#discussion_r377831163", "createdAt": "2020-02-11T18:53:57Z", "author": {"login": "rodesai"}, "path": "ksql-functional-tests/src/test/resources/query-validation-tests/protobuf.json", "diffHunk": "@@ -0,0 +1,52 @@\n+{\n+  \"tests\": [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a862ea2ae3ac7b40261a065362c60b1b14c144b7"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a862ea2ae3ac7b40261a065362c60b1b14c144b7", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/a862ea2ae3ac7b40261a065362c60b1b14c144b7", "committedDate": "2020-02-06T22:40:34Z", "message": "feat: support Protobuf in ksqlDB"}, "afterCommit": {"oid": "4549caa2bcaeb27fd3c1446dfff59c59a1ff5849", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/4549caa2bcaeb27fd3c1446dfff59c59a1ff5849", "committedDate": "2020-02-11T20:16:13Z", "message": "fix: address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5459dbbc610883ff0ecadeb1309675944e13c897", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/5459dbbc610883ff0ecadeb1309675944e13c897", "committedDate": "2020-02-11T20:22:00Z", "message": "feat: support Protobuf in ksqlDB"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "969955fcb970c97a05b20d9fd9692c012e1e3b6c", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/969955fcb970c97a05b20d9fd9692c012e1e3b6c", "committedDate": "2020-02-11T20:22:05Z", "message": "fix: address review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4549caa2bcaeb27fd3c1446dfff59c59a1ff5849", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/4549caa2bcaeb27fd3c1446dfff59c59a1ff5849", "committedDate": "2020-02-11T20:16:13Z", "message": "fix: address review comments"}, "afterCommit": {"oid": "969955fcb970c97a05b20d9fd9692c012e1e3b6c", "author": {"user": {"login": "agavra", "name": "Almog Gavra"}}, "url": "https://github.com/confluentinc/ksql/commit/969955fcb970c97a05b20d9fd9692c012e1e3b6c", "committedDate": "2020-02-11T20:22:05Z", "message": "fix: address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4955, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}