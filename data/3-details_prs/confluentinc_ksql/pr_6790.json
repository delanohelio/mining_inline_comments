{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNDQ5MDYy", "number": 6790, "title": "chore: improve error messages on invalid GROUP BYs", "bodyText": "Description\ntl;dr this PR improves error messages on invalid statements involving GROUP BYs.\nThe long version: Currently, in the logical planner when we build aggregate nodes, validation is split across the logic for building the aggregate schema (LogicalPlanner#buildAggregateSchema()) and for performing the aggregate analysis (AggregateAnalyzer#analyze()). The former throws a nice error message if the statement contains a function call that doesn\u2019t exist. The latter throws a nice error message if the GROUP BY expressions contain window bounds (since doesn't support that today). However, the two pieces of logic throw unhelpful errors in the reverse scenarios: if the schema building logic encounters window bounds, it throws an error saying the column doesn\u2019t exist. If the aggregate analyzer encounters an unknown function, it ignores it and returns an error about not finding any aggregate functions in the select expressions. In order to get helpful error messages in both scenarios, this PR updates AggregateAnazlyer to throw a helpful error message if a nonexistent function call is encountered, and moves the AggregateAnalyzer code above the schema building code in order to fail early (with helpful error messages).\nTesting done\nUnit + QTT.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-12-16T21:27:37Z", "url": "https://github.com/confluentinc/ksql/pull/6790", "merged": true, "mergeCommit": {"oid": "96645b5f9cacf599326fd65e1fce7b5594309d3a"}, "closed": true, "closedAt": "2020-12-17T00:04:40Z", "author": {"login": "vcrfxia"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm1B-agH2gAyNTQxNDQ5MDYyOjcwNTNmMTEwNzUzYTRhYjc2Yjg3MmU5YTg5MDQ0ZGU5YWNhOGVmMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm22L6gH2gAyNTQxNDQ5MDYyOmUyOTg4MjkxNWYwNGJhMDcxODA4MTM4NzIxNWY2ZjE3M2M4ZTllMmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7053f110753a4ab76b872e9a89044de9aca8ef03", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/7053f110753a4ab76b872e9a89044de9aca8ef03", "committedDate": "2020-12-16T20:33:29Z", "message": "chore: improve error messages on invalid group bys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTQxMTcw", "url": "https://github.com/confluentinc/ksql/pull/6790#pullrequestreview-554141170", "createdAt": "2020-12-16T22:36:57Z", "commit": {"oid": "7053f110753a4ab76b872e9a89044de9aca8ef03"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozNjo1OFrOIHcOAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozNjo1OFrOIHcOAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MzI4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Test whether this is a function with the supplied {@code functionName}.\n          \n          \n            \n               * Test whether there is a function with the supplied {@code functionName}.", "url": "https://github.com/confluentinc/ksql/pull/6790#discussion_r544673281", "createdAt": "2020-12-16T22:36:58Z", "author": {"login": "agavra"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/function/FunctionRegistry.java", "diffHunk": "@@ -47,6 +47,14 @@\n    */\n   boolean isTableFunction(FunctionName functionName);\n \n+  /**\n+   * Test whether this is a function with the supplied {@code functionName}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7053f110753a4ab76b872e9a89044de9aca8ef03"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29882915f04ba0718081387215f6f173c8e9e2b", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/e29882915f04ba0718081387215f6f173c8e9e2b", "committedDate": "2020-12-16T22:40:25Z", "message": "chore: feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4528, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}