{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNjcyNzk5", "number": 5273, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMjo0MFrOD5hmvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwODozNDozNlrOD9EqNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ2MDEzOnYy", "diffSide": "RIGHT", "path": "docs/developer-guide/ksqldb-reference/aggregate-functions.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMjo0MFrOGQ2CcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDoyMjo0N1rOGSnV8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNTc2MQ==", "bodyText": "Please add a link to the TOC at the top of the page. Thanks!", "url": "https://github.com/confluentinc/ksql/pull/5273#discussion_r420315761", "createdAt": "2020-05-05T18:22:40Z", "author": {"login": "JimGalasyn"}, "path": "docs/developer-guide/ksqldb-reference/aggregate-functions.md", "diffHunk": "@@ -100,6 +100,16 @@ Returns the _approximate_ number of unique values of `col1` in a group.\n The function implementation uses [HyperLogLog](https://en.wikipedia.org/wiki/HyperLogLog)\r\n to estimate cardinalities of 10^9 with a typical standard error of 2%.\r\n \r\n+EARLIEST_BY_OFFSET\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fe5b470e91567bf3a4cfb5d57d825589a152352"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE3MjE0Nw==", "bodyText": "Done", "url": "https://github.com/confluentinc/ksql/pull/5273#discussion_r422172147", "createdAt": "2020-05-08T14:22:47Z", "author": {"login": "spena"}, "path": "docs/developer-guide/ksqldb-reference/aggregate-functions.md", "diffHunk": "@@ -100,6 +100,16 @@ Returns the _approximate_ number of unique values of `col1` in a group.\n The function implementation uses [HyperLogLog](https://en.wikipedia.org/wiki/HyperLogLog)\r\n to estimate cardinalities of 10^9 with a typical standard error of 2%.\r\n \r\n+EARLIEST_BY_OFFSET\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNTc2MQ=="}, "originalCommit": {"oid": "6fe5b470e91567bf3a4cfb5d57d825589a152352"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTEwODk4OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/earliest/EarliestByOffset.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0NDowMVrOGUKLpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0NDowMVrOGUKLpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc5MTUyNA==", "bodyText": "All these constants look the same as the ones in LatestbyOffset. It would be nice to move them to another shared file instead of duplicating them.", "url": "https://github.com/confluentinc/ksql/pull/5273#discussion_r423791524", "createdAt": "2020-05-12T14:44:01Z", "author": {"login": "purplefox"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/earliest/EarliestByOffset.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.function.udaf.earliest;\n+\n+import io.confluent.ksql.function.udaf.Udaf;\n+import io.confluent.ksql.function.udaf.UdafDescription;\n+import io.confluent.ksql.function.udaf.UdafFactory;\n+import java.util.concurrent.atomic.AtomicLong;\n+import org.apache.kafka.connect.data.Schema;\n+import org.apache.kafka.connect.data.SchemaBuilder;\n+import org.apache.kafka.connect.data.Struct;\n+\n+@UdafDescription(\n+    name = \"EARLIEST_BY_OFFSET\",\n+    description = EarliestByOffset.DESCRIPTION\n+)\n+public final class EarliestByOffset {\n+  static final String DESCRIPTION =\n+      \"This function returns the oldest value for the column, computed by offset.\";\n+\n+  private EarliestByOffset() {\n+  }\n+\n+  static final String SEQ_FIELD = \"SEQ\";\n+  static final String VAL_FIELD = \"VAL\";\n+\n+  public static final Schema STRUCT_INTEGER = SchemaBuilder.struct().optional()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf2d84672c2d1d291b4b7b8a2e3ba00588acb33e"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTExMzY1OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/earliest/EarliestByOffset.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0NDo1NlrOGUKOcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0NDo1NlrOGUKOcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc5MjI0MA==", "bodyText": "This could go in a common base class instead of duplicating (or a utils class)", "url": "https://github.com/confluentinc/ksql/pull/5273#discussion_r423792240", "createdAt": "2020-05-12T14:44:56Z", "author": {"login": "purplefox"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/earliest/EarliestByOffset.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.function.udaf.earliest;\n+\n+import io.confluent.ksql.function.udaf.Udaf;\n+import io.confluent.ksql.function.udaf.UdafDescription;\n+import io.confluent.ksql.function.udaf.UdafFactory;\n+import java.util.concurrent.atomic.AtomicLong;\n+import org.apache.kafka.connect.data.Schema;\n+import org.apache.kafka.connect.data.SchemaBuilder;\n+import org.apache.kafka.connect.data.Struct;\n+\n+@UdafDescription(\n+    name = \"EARLIEST_BY_OFFSET\",\n+    description = EarliestByOffset.DESCRIPTION\n+)\n+public final class EarliestByOffset {\n+  static final String DESCRIPTION =\n+      \"This function returns the oldest value for the column, computed by offset.\";\n+\n+  private EarliestByOffset() {\n+  }\n+\n+  static final String SEQ_FIELD = \"SEQ\";\n+  static final String VAL_FIELD = \"VAL\";\n+\n+  public static final Schema STRUCT_INTEGER = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_INT32_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_LONG = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_DOUBLE = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_FLOAT64_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_BOOLEAN = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_BOOLEAN_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_STRING = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_STRING_SCHEMA)\n+      .build();\n+\n+  static AtomicLong sequence = new AtomicLong();\n+\n+  @UdafFactory(description = \"return the earliest value of an integer column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL INT>\")\n+  public static Udaf<Integer, Struct, Integer> earliestInteger() {\n+    return earliest(STRUCT_INTEGER);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of an big integer column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL BIGINT>\")\n+  public static Udaf<Long, Struct, Long> earliestLong() {\n+    return earliest(STRUCT_LONG);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of a double column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL DOUBLE>\")\n+  public static Udaf<Double, Struct, Double> earliestDouble() {\n+    return earliest(STRUCT_DOUBLE);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of a boolean column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL BOOLEAN>\")\n+  public static Udaf<Boolean, Struct, Boolean> earliestBoolean() {\n+    return earliest(STRUCT_BOOLEAN);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of a string column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL STRING>\")\n+  public static Udaf<String, Struct, String> earliestString() {\n+    return earliest(STRUCT_STRING);\n+  }\n+\n+  static <T> Struct createStruct(final Schema schema, final T val) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf2d84672c2d1d291b4b7b8a2e3ba00588acb33e"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTEyMDc1OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/earliest/EarliestByOffset.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0NjoxMVrOGUKSqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0NjoxMVrOGUKSqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc5MzMyMA==", "bodyText": "This could go in common class too.", "url": "https://github.com/confluentinc/ksql/pull/5273#discussion_r423793320", "createdAt": "2020-05-12T14:46:11Z", "author": {"login": "purplefox"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/earliest/EarliestByOffset.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.function.udaf.earliest;\n+\n+import io.confluent.ksql.function.udaf.Udaf;\n+import io.confluent.ksql.function.udaf.UdafDescription;\n+import io.confluent.ksql.function.udaf.UdafFactory;\n+import java.util.concurrent.atomic.AtomicLong;\n+import org.apache.kafka.connect.data.Schema;\n+import org.apache.kafka.connect.data.SchemaBuilder;\n+import org.apache.kafka.connect.data.Struct;\n+\n+@UdafDescription(\n+    name = \"EARLIEST_BY_OFFSET\",\n+    description = EarliestByOffset.DESCRIPTION\n+)\n+public final class EarliestByOffset {\n+  static final String DESCRIPTION =\n+      \"This function returns the oldest value for the column, computed by offset.\";\n+\n+  private EarliestByOffset() {\n+  }\n+\n+  static final String SEQ_FIELD = \"SEQ\";\n+  static final String VAL_FIELD = \"VAL\";\n+\n+  public static final Schema STRUCT_INTEGER = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_INT32_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_LONG = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_DOUBLE = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_FLOAT64_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_BOOLEAN = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_BOOLEAN_SCHEMA)\n+      .build();\n+\n+  public static final Schema STRUCT_STRING = SchemaBuilder.struct().optional()\n+      .field(SEQ_FIELD, Schema.OPTIONAL_INT64_SCHEMA)\n+      .field(VAL_FIELD, Schema.OPTIONAL_STRING_SCHEMA)\n+      .build();\n+\n+  static AtomicLong sequence = new AtomicLong();\n+\n+  @UdafFactory(description = \"return the earliest value of an integer column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL INT>\")\n+  public static Udaf<Integer, Struct, Integer> earliestInteger() {\n+    return earliest(STRUCT_INTEGER);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of an big integer column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL BIGINT>\")\n+  public static Udaf<Long, Struct, Long> earliestLong() {\n+    return earliest(STRUCT_LONG);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of a double column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL DOUBLE>\")\n+  public static Udaf<Double, Struct, Double> earliestDouble() {\n+    return earliest(STRUCT_DOUBLE);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of a boolean column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL BOOLEAN>\")\n+  public static Udaf<Boolean, Struct, Boolean> earliestBoolean() {\n+    return earliest(STRUCT_BOOLEAN);\n+  }\n+\n+  @UdafFactory(description = \"return the earliest value of a string column\",\n+      aggregateSchema = \"STRUCT<SEQ BIGINT, VAL STRING>\")\n+  public static Udaf<String, Struct, String> earliestString() {\n+    return earliest(STRUCT_STRING);\n+  }\n+\n+  static <T> Struct createStruct(final Schema schema, final T val) {\n+    final Struct struct = new Struct(schema);\n+    struct.put(SEQ_FIELD, generateSequence());\n+    struct.put(VAL_FIELD, val);\n+    return struct;\n+  }\n+\n+  private static long generateSequence() {\n+    return sequence.getAndIncrement();\n+  }\n+\n+  private static int compareStructs(final Struct struct1, final Struct struct2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf2d84672c2d1d291b4b7b8a2e3ba00588acb33e"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MzY2MDY5OnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/KudafByOffsetUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwODozNDozNlrOGWZF4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwODozNDozNlrOGWZF4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzMjk2MA==", "bodyText": "Imho we should create a directory and put both udafs and this file in the same package. That way it can be package protected.", "url": "https://github.com/confluentinc/ksql/pull/5273#discussion_r426132960", "createdAt": "2020-05-16T08:34:36Z", "author": {"login": "purplefox"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udaf/KudafByOffsetUtils.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"; you may not use\n+ * this file except in compliance with the License. You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.function.udaf;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1517c0623de35a3c564391ee81655496a1a2a727"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3537, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}