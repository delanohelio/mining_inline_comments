{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNDMzMTkx", "number": 4474, "title": "chore: include support metrics in the project", "bodyText": "Description\nksqlDB is the only user of these classes, so include it in the project instead of consuming it as a library.\nSource files were copied from Confluent Kafka's support-metrics-common module. They were updated to match ksqlDB checkstyle and to remove functionality that submits metrics to a Kafka topic (this was never used by ksqlDB).\nTesting done\nTested by building a docker image and running it locally using the docker-compose file in the ksqldb.io quickstart as a template. Based on inspecting network traffic sent at server startup, there was an HTTP POST to the version-checker endpoint with the expected Avro payload.\nPOST /ksql/anon HTTP/1.1\napi-version: phone-home-v1\nContent-Length: 1155\nContent-Type: multipart/form-data; boundary=Hf24SYtnRPyDwcgTVg30h6rdXnQ0-Xfw0jC\nHost: version-check.confluent.io\nConnection: Keep-Alive\nUser-Agent: Apache-HttpClient/4.5.3 (Java/1.8.0_212)\nAccept-Encoding: gzip,deflate\n\n--Hf24SYtnRPyDwcgTVg30h6rdXnQ0-Xfw0jC\nContent-Disposition: form-data; name=\"cid\"\n\nanonymous\n--Hf24SYtnRPyDwcgTVg30h6rdXnQ0-Xfw0jC\nContent-Disposition: form-data; name=\"file\"; filename=\"filename\"\nContent-Type: application/octet-stream\n\nObjavro.schema\u00a4{\"type\":\"record\",\"name\":\"KsqlVersionMetrics\",\"namespace\":\"io.confluent.ksql.version.metrics\",\"doc\":\"Represents basic metrics captured on a single ksql component\",\"fields\":[{\"name\":\"timestamp\",\"type\":\"long\",\"doc\":\"Time when this data record was created on the ksql component (Unix time).\"},{\"name\":\"confluentPlatformVersion\",\"type\":[\"null\",{\"type\":\"string\",\"avro.java.string\":\"String\"}],\"doc\":\"The version of the Confluent Platform this ksql component is running.\"},{\"name\":\"ksqlComponentType\",\"type\":{\"type\":\"string\",\"avro.java.string\":\"String\"},\"doc\":\"Identifies the ksql component\"},{\"name\":\"isActive\",\"type\":\"boolean\",\"doc\":\"Indicates if the server was active in the last 24 hours. A server is considered active if it received a rest request or it has at least one running query.\"}]}\u00f0p\ufffd\u00db\u00fa\u00dc6&\u00a1\u00b7\u00f9\u00c2:\u00f4\u00bc\u00e5\ufffd5.5.0-SNAPSHOTSERVER\u00f0p\ufffd\u00db\u00fa\u00dc6&\u00a1\u00b7\u00f9\u00c2\n--Hf24SYtnRPyDwcgTVg30h6rdXnQ0-Xfw0jC--\n\n\n(The ksqldb-server container was configured to send data to the insecure version-checker endpoint, so that the payload could be more easily verified)\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-02-07T14:17:10Z", "url": "https://github.com/confluentinc/ksql/pull/4474", "merged": true, "mergeCommit": {"oid": "a80a7d8d24abd152dd98e63fb67f1579b37757c9"}, "closed": true, "closedAt": "2020-02-24T15:09:39Z", "author": {"login": "ijuma"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCBS7xgFqTM1NTI0NzI2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHe0gHgBqjMwNjU2OTE4MDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MjQ3MjY1", "url": "https://github.com/confluentinc/ksql/pull/4474#pullrequestreview-355247265", "createdAt": "2020-02-07T15:44:31Z", "commit": {"oid": "2b7b5f8d2290949bbdd06d8ad54eae5c396ab163"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNTo0NDozMVrOFnBUuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNTo0NDozMVrOFnBUuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ2MDQ3Mw==", "bodyText": "License should be updated to match ksqldb's template.", "url": "https://github.com/confluentinc/ksql/pull/4474#discussion_r376460473", "createdAt": "2020-02-07T15:44:31Z", "author": {"login": "ijuma"}, "path": "ksql-version-metrics-client/src/test/java/io/confluent/support/metrics/utils/StringUtilsTest.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright 2019 Confluent Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b7b5f8d2290949bbdd06d8ad54eae5c396ab163"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b7b5f8d2290949bbdd06d8ad54eae5c396ab163", "author": {"user": {"login": "ijuma", "name": "Ismael Juma"}}, "url": "https://github.com/confluentinc/ksql/commit/2b7b5f8d2290949bbdd06d8ad54eae5c396ab163", "committedDate": "2020-02-07T14:15:55Z", "message": "Include support metrics in the project\n\nksqlDB is the only user of these classes, so include it\nin the project instead of consuming it as a library."}, "afterCommit": {"oid": "e57d65069e91227819b9060160e9b7e55289c19e", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/e57d65069e91227819b9060160e9b7e55289c19e", "committedDate": "2020-02-20T16:29:11Z", "message": "Adapt for checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODA2NTI1", "url": "https://github.com/confluentinc/ksql/pull/4474#pullrequestreview-362806525", "createdAt": "2020-02-21T17:50:13Z", "commit": {"oid": "144d4e3edcf49770499a9296c32642bace0ec97a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8baaf87ca4caf1ce6301103e37fccef68066a78", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/b8baaf87ca4caf1ce6301103e37fccef68066a78", "committedDate": "2020-02-24T14:56:41Z", "message": "Include support metrics in the project\n\nksqlDB is the only user of these classes, so include it\nin the project instead of consuming it as a library."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "279d9fbb90dc561e2a558f2d84599b28c1b502ec", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/279d9fbb90dc561e2a558f2d84599b28c1b502ec", "committedDate": "2020-02-24T14:57:13Z", "message": "Adds BaseMetricsReporter, AvroSerializer and http deps."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2fb6d186169bc95e692bd9cc8a1972f51221320", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/e2fb6d186169bc95e692bd9cc8a1972f51221320", "committedDate": "2020-02-24T14:57:13Z", "message": "Updates licensing notice."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c4b9a13b1eaf9be9ad8d6cd31d145a0352c3e31", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/8c4b9a13b1eaf9be9ad8d6cd31d145a0352c3e31", "committedDate": "2020-02-24T14:57:13Z", "message": "Remove obsolete tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd143ad46c293cbf85405064cfb9012ac0937aa", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/7dd143ad46c293cbf85405064cfb9012ac0937aa", "committedDate": "2020-02-24T14:57:13Z", "message": "Adapt for checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4c6b8bba9f01bcddc50b7f4d11713d4f3b4781f", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/e4c6b8bba9f01bcddc50b7f4d11713d4f3b4781f", "committedDate": "2020-02-24T14:57:13Z", "message": "Fix spotbugs errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "476253a1bf749af1f5105d1ec8848c5d54c0f792", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/476253a1bf749af1f5105d1ec8848c5d54c0f792", "committedDate": "2020-02-24T14:57:13Z", "message": "Remove support for submitting to Kafka"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "144d4e3edcf49770499a9296c32642bace0ec97a", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/144d4e3edcf49770499a9296c32642bace0ec97a", "committedDate": "2020-02-21T15:47:53Z", "message": "Remove support for submitting to Kafka"}, "afterCommit": {"oid": "476253a1bf749af1f5105d1ec8848c5d54c0f792", "author": {"user": {"login": "colinhicks", "name": "Colin Hicks"}}, "url": "https://github.com/confluentinc/ksql/commit/476253a1bf749af1f5105d1ec8848c5d54c0f792", "committedDate": "2020-02-24T14:57:13Z", "message": "Remove support for submitting to Kafka"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4959, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}