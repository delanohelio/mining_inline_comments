{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODg1Mzg5", "number": 4942, "title": "fix: do not allow grouping sets", "bodyText": "Description\nNOTE: this PR is stacked on top of #4940. Only review the second commit onwards.\nfixes: #4941\nChange the ksqlDB syntax to not allow grouping sets, which aren't supported yet.\nThis is backwards compatible for already running queries, as they are built from the query plan, not the syntax.\nTesting done\nusual.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-03-30T20:32:02Z", "url": "https://github.com/confluentinc/ksql/pull/4942", "merged": true, "mergeCommit": {"oid": "51bb9f6f4bcef2d75f6d6d96c4c883559a21999b"}, "closed": true, "closedAt": "2020-03-31T16:02:25Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS0A1xAH2gAyMzk1ODg1Mzg5OmZkMzViMTNhNDY4ZGVhMmJmODg3NmJmZWI1YzRkZTVjMDJiNTVmMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTEtVjgFqTM4NDg0MTcxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd35b13a468dea2bf8876bfeb5c4de5c02b55f23", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/fd35b13a468dea2bf8876bfeb5c4de5c02b55f23", "committedDate": "2020-03-30T19:52:42Z", "message": "fix: do not allow GROUP BY and PARTITION BY on boolean expressions\n\nfixes: https://github.com/confluentinc/ksql/issues/4939\n\nChange to SQL syntax to not allow GROUP BY and PARTITION BY on boolean expressions. Only value expressions will be allowed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17833d2da49e320c29a97819fd34c4c0d153483c", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/17833d2da49e320c29a97819fd34c4c0d153483c", "committedDate": "2020-03-30T20:30:38Z", "message": "fix: do not allow grouping sets\n\nfixes: https://github.com/confluentinc/ksql/issues/4941\n\nChange the ksqlDB syntax to now allow grouping sets, which aren't supported yet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27ca851e19c656ea8906e7b2aee398b3968cb15c", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/27ca851e19c656ea8906e7b2aee398b3968cb15c", "committedDate": "2020-03-30T23:27:48Z", "message": "chore: merge from master\n\nConflicting files\nksqldb-parser/src/main/antlr4/io/confluent/ksql/parser/SqlBase.g4\nksqldb-parser/src/main/java/io/confluent/ksql/parser/AstBuilder.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzM0NDIy", "url": "https://github.com/confluentinc/ksql/pull/4942#pullrequestreview-384334422", "createdAt": "2020-03-31T01:00:17Z", "commit": {"oid": "17833d2da49e320c29a97819fd34c4c0d153483c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTowMDoxN1rOF-Blew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTowMDoxN1rOF-Blew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MjAxMQ==", "bodyText": "instead of removing this from our grammar, why not throw in the analyzing phase that \"KSQL does not support multiple grouping elements\" or whatever. That way the error message is much more understandable", "url": "https://github.com/confluentinc/ksql/pull/4942#discussion_r400582011", "createdAt": "2020-03-31T01:00:17Z", "author": {"login": "agavra"}, "path": "ksqldb-parser/src/main/antlr4/io/confluent/ksql/parser/SqlBase.g4", "diffHunk": "@@ -153,26 +153,14 @@ windowUnit\n     ;\n \n groupBy\n-    : groupingElement (',' groupingElement)*\n-    ;\n-\n-groupingElement\n-    : groupingExpressions                                               #singleGroupingSet\n-    ;\n-\n-groupingExpressions\n-    : '(' (valueExpression (',' valueExpression)*)? ')'\n-    | valueExpression", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17833d2da49e320c29a97819fd34c4c0d153483c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDg2NzA1", "url": "https://github.com/confluentinc/ksql/pull/4942#pullrequestreview-384486705", "createdAt": "2020-03-31T07:57:56Z", "commit": {"oid": "27ca851e19c656ea8906e7b2aee398b3968cb15c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo1Nzo1N1rOF-JoZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo1Nzo1N1rOF-JoZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcxMzgzMA==", "bodyText": "shouldn't grouping expressions be a unique set though ? what does it mean to group by a,a,b,a ?  it's possible i'm entirely misunderstanding what this piece of code does though, rusty on this stuff ;)   Comment applies regardless of whether the groupingExpression is retained (per Almog's suggestion) or not - i think....", "url": "https://github.com/confluentinc/ksql/pull/4942#discussion_r400713830", "createdAt": "2020-03-31T07:57:57Z", "author": {"login": "blueedgenick"}, "path": "ksqldb-engine/src/main/java/io/confluent/ksql/analyzer/Analysis.java", "diffHunk": "@@ -129,7 +129,7 @@ void setWhereExpression(final Expression whereExpression) {\n     return ImmutableList.copyOf(groupByExpressions);\n   }\n \n-  void addGroupByExpressions(final Set<Expression> expressions) {\n+  void addGroupByExpressions(final Collection<Expression> expressions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27ca851e19c656ea8906e7b2aee398b3968cb15c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45476674d85cda61e2af1080c37c5dac5ced43ff", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/45476674d85cda61e2af1080c37c5dac5ced43ff", "committedDate": "2020-03-31T09:56:20Z", "message": "chore: changes requested by Nick"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODQxNzE4", "url": "https://github.com/confluentinc/ksql/pull/4942#pullrequestreview-384841718", "createdAt": "2020-03-31T15:19:47Z", "commit": {"oid": "45476674d85cda61e2af1080c37c5dac5ced43ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4960, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}