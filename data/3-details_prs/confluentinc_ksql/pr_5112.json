{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1OTIwMDEx", "number": 5112, "title": "refactor: Migrate server metadata endpoints", "bodyText": "Description\nThis is a stacked PR, please only review top commit(s).\nThis PR migrates the server metadata endpoints ( /v1/metadata and /v1/metadata/id )from Jetty to Vert.x.\nAlso, there were zero integration tests for these endpoints so I added them.\nTesting done\nNon functional change, but I added some new tests.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-04-20T08:51:34Z", "url": "https://github.com/confluentinc/ksql/pull/5112", "merged": true, "mergeCommit": {"oid": "9020a750aa41763c55d4f6f81e57609ccd49475f"}, "closed": true, "closedAt": "2020-04-22T08:30:31Z", "author": {"login": "purplefox"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaDGDBAFqTM5Nzg5Mzc1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaD-s_gBqjMyNTk0MzY5NjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODkzNzU3", "url": "https://github.com/confluentinc/ksql/pull/5112#pullrequestreview-397893757", "createdAt": "2020-04-22T06:57:24Z", "commit": {"oid": "826e8301ef1688d766a8c7172505107b93f19183"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjo1NzoyNFrOGJmaJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjo1OToyOVrOGJme7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxOTY1Mg==", "bodyText": "Why are these tests being removed?", "url": "https://github.com/confluentinc/ksql/pull/5112#discussion_r412719652", "createdAt": "2020-04-22T06:57:24Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestApiTest.java", "diffHunk": "@@ -470,68 +488,6 @@ public void shouldFailToExecuteQueryUsingRestWithHttp2() throws Exception {\n     }\n   }\n \n-  @Test\n-  public void shouldExecuteStatementWithConnectionCloseHeaderHTTP1_1() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "826e8301ef1688d766a8c7172505107b93f19183"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxOTk1MA==", "bodyText": "nit: rename to executeServerClusterId()", "url": "https://github.com/confluentinc/ksql/pull/5112#discussion_r412719950", "createdAt": "2020-04-22T06:57:55Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/api/endpoints/KsqlServerEndpoints.java", "diffHunk": "@@ -219,6 +223,20 @@ public KsqlServerEndpoints(\n         .completedFuture(EndpointResponse.create(healthCheckResource.checkHealth()));\n   }\n \n+  @Override\n+  public CompletableFuture<EndpointResponse> executeServerMetadata(\n+      final ApiSecurityContext apiSecurityContext) {\n+    return CompletableFuture\n+        .completedFuture(EndpointResponse.create(serverMetadataResource.getServerMetadata()));\n+  }\n+\n+  @Override\n+  public CompletableFuture<EndpointResponse> executeServerMetadataClusterId(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "826e8301ef1688d766a8c7172505107b93f19183"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcyMDg3OA==", "bodyText": "nit: let's keep naming consistent throughout? If we go with the suggestion of executeServerClusterId() in the previous comment, then should be makeServerClusterIdRequest(), and RestApiTest, KsqlRestClient, and KsqlTarget should also be updated accordingly.", "url": "https://github.com/confluentinc/ksql/pull/5112#discussion_r412720878", "createdAt": "2020-04-22T06:59:29Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestIntegrationTestUtil.java", "diffHunk": "@@ -123,6 +125,28 @@ static CommandStatuses makeStatusesRequest(final TestKsqlRestApp restApp) {\n     }\n   }\n \n+  static ServerMetadata makeServerMetadataRequest(final TestKsqlRestApp restApp) {\n+    try (final KsqlRestClient restClient = restApp.buildKsqlClient(Optional.empty())) {\n+\n+      final RestResponse<ServerMetadata> res = restClient.getServerMetadata();\n+\n+      throwOnError(res);\n+\n+      return res.getResponse();\n+    }\n+  }\n+\n+  static ServerClusterId makeServerMetadataIdRequest(final TestKsqlRestApp restApp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "826e8301ef1688d766a8c7172505107b93f19183"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "826e8301ef1688d766a8c7172505107b93f19183", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/826e8301ef1688d766a8c7172505107b93f19183", "committedDate": "2020-04-20T09:59:44Z", "message": "do not create server metadata resource until configue as it requires kafka cluster"}, "afterCommit": {"oid": "cd6650c20ea208617abb3d0cbf99e9b745e17c1e", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/cd6650c20ea208617abb3d0cbf99e9b745e17c1e", "committedDate": "2020-04-22T07:26:11Z", "message": "migrate sever metadata endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "489512d12d69ed2148d5972480b37a33d2cc0e38", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/489512d12d69ed2148d5972480b37a33d2cc0e38", "committedDate": "2020-04-22T08:25:59Z", "message": "migrate sever metadata endpoints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd6650c20ea208617abb3d0cbf99e9b745e17c1e", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/cd6650c20ea208617abb3d0cbf99e9b745e17c1e", "committedDate": "2020-04-22T07:26:11Z", "message": "migrate sever metadata endpoints"}, "afterCommit": {"oid": "489512d12d69ed2148d5972480b37a33d2cc0e38", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/489512d12d69ed2148d5972480b37a33d2cc0e38", "committedDate": "2020-04-22T08:25:59Z", "message": "migrate sever metadata endpoints"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4860, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}