{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3OTM5OTMw", "number": 6212, "title": "test: extend serde benchmark to include all formats and key serde", "bodyText": "Description\nfixes: #6211\nEnhances the serde benchmarks beyond just testing AVRO and JSON formats via the GenericRowSerde to include KAFKA, DELIMITED and PROTOBUF formats and test key serde via the GenericKeySerde.\nBenchmark                                (params)  Mode  Cnt  Score   Error  Units\nSerdeBenchmark.deserialize   single-key/Delimited  avgt    2  2.784          us/op\nSerdeBenchmark.deserialize       single-key/Kafka  avgt    2  0.045          us/op\nSerdeBenchmark.deserialize        single-key/JSON  avgt    2  0.200          us/op\nSerdeBenchmark.deserialize        single-key/Avro  avgt    2  0.550          us/op\nSerdeBenchmark.deserialize  impressions/Delimited  avgt    2  2.840          us/op\nSerdeBenchmark.deserialize   impressions/Protobuf  avgt    2  1.928          us/op\nSerdeBenchmark.deserialize       impressions/JSON  avgt    2  1.218          us/op\nSerdeBenchmark.deserialize       impressions/Avro  avgt    2  1.474          us/op\nSerdeBenchmark.deserialize       metrics/Protobuf  avgt    2  5.259          us/op\nSerdeBenchmark.deserialize           metrics/JSON  avgt    2  5.687          us/op\nSerdeBenchmark.deserialize           metrics/Avro  avgt    2  4.674          us/op\nSerdeBenchmark.serialize     single-key/Delimited  avgt    2  0.200          us/op\nSerdeBenchmark.serialize         single-key/Kafka  avgt    2  0.010          us/op\nSerdeBenchmark.serialize          single-key/JSON  avgt    2  0.170          us/op\nSerdeBenchmark.serialize          single-key/Avro  avgt    2  0.245          us/op\nSerdeBenchmark.serialize    impressions/Delimited  avgt    2  0.521          us/op\nSerdeBenchmark.serialize     impressions/Protobuf  avgt    2  1.471          us/op\nSerdeBenchmark.serialize         impressions/JSON  avgt    2  0.683          us/op\nSerdeBenchmark.serialize         impressions/Avro  avgt    2  1.374          us/op\nSerdeBenchmark.serialize         metrics/Protobuf  avgt    2  6.321          us/op\nSerdeBenchmark.serialize             metrics/JSON  avgt    2  3.336          us/op\nSerdeBenchmark.serialize             metrics/Avro  avgt    2  5.179          us/op\n\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-09-16T12:03:15Z", "url": "https://github.com/confluentinc/ksql/pull/6212", "merged": true, "mergeCommit": {"oid": "25deb4ad795da0ab69865aabfc6c54de3463f8d1"}, "closed": true, "closedAt": "2020-09-17T09:29:28Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJbK25gH2gAyNDg3OTM5OTMwOmRmMjZmMTYzOTk2ZmY2NTc4MGVjZmRjYmJmOTg0MTg2NGQ4NTdhOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJtlL_AH2gAyNDg3OTM5OTMwOjA2ODE0Y2QyNTI1MmRiNzhlNmU3M2IwNzdiZWE5YmJmOGJlYjQwZDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "df26f163996ff65780ecfdcbbf9841864d857a96", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/df26f163996ff65780ecfdcbbf9841864d857a96", "committedDate": "2020-09-16T12:01:51Z", "message": "test: extend serde benchmark to include all formats and key serde\n\nfixes: https://github.com/confluentinc/ksql/issues/6211\n\nEnhances the serde benchmarks beyond just testing `AVRO` and `JSON` formats via the `GenericRowSerde` to include `KAFKA`, `DELIMITED` and `PROTOBUF` formats and test key serde via the `GenericKeySerde`.\n\n```\nBenchmark                                (params)  Mode  Cnt  Score   Error  Units\nSerdeBenchmark.deserialize   single-key/Delimited  avgt    2  2.784          us/op\nSerdeBenchmark.deserialize       single-key/Kafka  avgt    2  0.045          us/op\nSerdeBenchmark.deserialize        single-key/JSON  avgt    2  0.200          us/op\nSerdeBenchmark.deserialize        single-key/Avro  avgt    2  0.550          us/op\nSerdeBenchmark.deserialize  impressions/Delimited  avgt    2  2.840          us/op\nSerdeBenchmark.deserialize   impressions/Protobuf  avgt    2  1.928          us/op\nSerdeBenchmark.deserialize       impressions/JSON  avgt    2  1.218          us/op\nSerdeBenchmark.deserialize       impressions/Avro  avgt    2  1.474          us/op\nSerdeBenchmark.deserialize       metrics/Protobuf  avgt    2  5.259          us/op\nSerdeBenchmark.deserialize           metrics/JSON  avgt    2  5.687          us/op\nSerdeBenchmark.deserialize           metrics/Avro  avgt    2  4.674          us/op\nSerdeBenchmark.serialize     single-key/Delimited  avgt    2  0.200          us/op\nSerdeBenchmark.serialize         single-key/Kafka  avgt    2  0.010          us/op\nSerdeBenchmark.serialize          single-key/JSON  avgt    2  0.170          us/op\nSerdeBenchmark.serialize          single-key/Avro  avgt    2  0.245          us/op\nSerdeBenchmark.serialize    impressions/Delimited  avgt    2  0.521          us/op\nSerdeBenchmark.serialize     impressions/Protobuf  avgt    2  1.471          us/op\nSerdeBenchmark.serialize         impressions/JSON  avgt    2  0.683          us/op\nSerdeBenchmark.serialize         impressions/Avro  avgt    2  1.374          us/op\nSerdeBenchmark.serialize         metrics/Protobuf  avgt    2  6.321          us/op\nSerdeBenchmark.serialize             metrics/JSON  avgt    2  3.336          us/op\nSerdeBenchmark.serialize             metrics/Avro  avgt    2  5.179          us/op\n```"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODM4NDMx", "url": "https://github.com/confluentinc/ksql/pull/6212#pullrequestreview-489838431", "createdAt": "2020-09-16T17:20:41Z", "commit": {"oid": "df26f163996ff65780ecfdcbbf9841864d857a96"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyMDo0MVrOHS6x5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyMDo0MVrOHS6x5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU5OTQ2Mg==", "bodyText": "The separator is / and you have |.  Also, shouldn't be <schema-name/<format-name> ?", "url": "https://github.com/confluentinc/ksql/pull/6212#discussion_r489599462", "createdAt": "2020-09-16T17:20:41Z", "author": {"login": "spena"}, "path": "ksqldb-benchmark/src/main/java/io/confluent/ksql/benchmark/SerdeBenchmark.java", "diffHunk": "@@ -79,100 +82,166 @@\n   private static final String SCHEMA_FILE_SUFFIX = \".avro\";\n   private static final String TOPIC_NAME = \"serde_benchmark\";\n \n-  @State(Scope.Thread)\n-  public static class SchemaAndGenericRowState {\n-    LogicalSchema schema;\n-    GenericRow row;\n+  private static final String IMPRESSIONS_SCHEMA = \"impressions\";\n+  private static final String METRICS_SCHEMA = \"metrics\";\n+  private static final String SINGLE_KEY_SCHEMA = \"single-key\";\n \n-    @Param({\"impressions\", \"metrics\"})\n-    public String schemaName;\n+  private static final String SEPARATOR = \"/\";\n \n-    @Setup(Level.Iteration)\n-    public void setUp() throws Exception {\n-      final Generator generator = new Generator(getSchemaStream(), new Random());\n+  private static final String JSON_FORMAT = \"JSON\";\n+  private static final String AVRO_FORMAT = \"Avro\";\n+  private static final String PROTOBUF_FORMAT = \"Protobuf\";\n+  private static final String DELIMITED_FORMAT = \"Delimited\";\n+  private static final String KAFKA_FORMAT = \"Kafka\";\n \n-      // choose arbitrary key\n-      final String key = generator.schema().getFields().get(0).name();\n+  private static final class Params {\n \n-      final RowGenerator rowGenerator = new RowGenerator(generator, key, Optional.empty());\n+    final String schemaName;\n+    final String formatName;\n+\n+    static Params parse(final String text) {\n+      final String[] parts = text.split(SEPARATOR);\n+      if (parts.length != 2) {\n+        throw new IllegalArgumentException(\"Param should be in form \"\n+            + \"'<format-name>|<schema-name>', got: \" + text);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df26f163996ff65780ecfdcbbf9841864d857a96"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06814cd25252db78e6e73b077bea9bbf8beb40d8", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/06814cd25252db78e6e73b077bea9bbf8beb40d8", "committedDate": "2020-09-17T09:28:54Z", "message": "Update SerdeBenchmark.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4655, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}