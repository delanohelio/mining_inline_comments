{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODcyODcx", "number": 4498, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzozOToyNVrODetOQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzo0MDo1NVrODetPNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTI0ODAxOnYy", "diffSide": "RIGHT", "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/PullQueryExecutorDelegate.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzozOToyNVrOFn_bIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwOTowMzoxOVrOFoBPxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NzkyMg==", "bodyText": "To check my understanding: the problem with circular dependencies in this PR is that the new ksql-api module wants access to PullQueryExecutor and related files from ksql-rest-app, but that's not possible right now because ksql-rest-app depends on ksql-api, yes? And the reason you say this is temporary is because once the new API work is done, ksql-api and ksql-rest-app will be unified into a single module? Or did you have other plans", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377477922", "createdAt": "2020-02-11T07:39:25Z", "author": {"login": "vcrfxia"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/PullQueryExecutorDelegate.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.server.execution;\n+\n+import io.confluent.ksql.api.plugin.PullQueryApiExecutor;\n+import io.confluent.ksql.api.plugin.TableRows;\n+import io.confluent.ksql.parser.tree.Query;\n+import io.confluent.ksql.query.QueryId;\n+import io.confluent.ksql.rest.entity.TableRowsEntity;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.services.ServiceContext;\n+import io.confluent.ksql.statement.ConfiguredStatement;\n+import java.util.List;\n+\n+/**\n+ * Wrapper to break circular dependencies between modules. This is temporary until we migrate all", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwNzQ3Mg==", "bodyText": "Specifically, we need to call PullQueryExecutor from ksql-api, but that returns TableRowsEntity which is in ksql-rest-model. ksql-api can't depend on ksql-rest-model, as ksql-rest-app depends on ksql-rest-model and ksql-api. If it did depend on ksql-rest-model there would be a circular dep.", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377507472", "createdAt": "2020-02-11T09:02:36Z", "author": {"login": "purplefox"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/PullQueryExecutorDelegate.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.server.execution;\n+\n+import io.confluent.ksql.api.plugin.PullQueryApiExecutor;\n+import io.confluent.ksql.api.plugin.TableRows;\n+import io.confluent.ksql.parser.tree.Query;\n+import io.confluent.ksql.query.QueryId;\n+import io.confluent.ksql.rest.entity.TableRowsEntity;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.services.ServiceContext;\n+import io.confluent.ksql.statement.ConfiguredStatement;\n+import java.util.List;\n+\n+/**\n+ * Wrapper to break circular dependencies between modules. This is temporary until we migrate all", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NzkyMg=="}, "originalCommit": {"oid": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwNzc4MQ==", "bodyText": "This is temporary as ksql-rest-app and ksql-rest-model will disappear when KLIP-15 is complete.", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377507781", "createdAt": "2020-02-11T09:03:19Z", "author": {"login": "purplefox"}, "path": "ksql-rest-app/src/main/java/io/confluent/ksql/rest/server/execution/PullQueryExecutorDelegate.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.server.execution;\n+\n+import io.confluent.ksql.api.plugin.PullQueryApiExecutor;\n+import io.confluent.ksql.api.plugin.TableRows;\n+import io.confluent.ksql.parser.tree.Query;\n+import io.confluent.ksql.query.QueryId;\n+import io.confluent.ksql.rest.entity.TableRowsEntity;\n+import io.confluent.ksql.schema.ksql.LogicalSchema;\n+import io.confluent.ksql.services.ServiceContext;\n+import io.confluent.ksql.statement.ConfiguredStatement;\n+import java.util.List;\n+\n+/**\n+ * Wrapper to break circular dependencies between modules. This is temporary until we migrate all", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NzkyMg=="}, "originalCommit": {"oid": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTI1MDQ0OnYy", "diffSide": "RIGHT", "path": "ksql-api/src/main/java/io/confluent/ksql/api/server/BlockingQueryPublisher.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzo0MDo1NVrOFn_ckA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwOTowMzo0MlrOFoBQVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3ODI4OA==", "bodyText": "This change to call queryHandle::start in a worker thread is unrelated to the addition of pull query support, right? (Just an improvement from the PR this one builds on?)", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377478288", "createdAt": "2020-02-11T07:40:55Z", "author": {"login": "vcrfxia"}, "path": "ksql-api/src/main/java/io/confluent/ksql/api/server/BlockingQueryPublisher.java", "diffHunk": "@@ -132,7 +128,16 @@ protected void maybeSend() {\n \n   @Override\n   protected void afterSubscribe() {\n-    queryHandle.start();\n+    // Run async as it can block\n+    executeOnWorker(queryHandle::start);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwNzkyNg==", "bodyText": "Yep", "url": "https://github.com/confluentinc/ksql/pull/4498#discussion_r377507926", "createdAt": "2020-02-11T09:03:42Z", "author": {"login": "purplefox"}, "path": "ksql-api/src/main/java/io/confluent/ksql/api/server/BlockingQueryPublisher.java", "diffHunk": "@@ -132,7 +128,16 @@ protected void maybeSend() {\n \n   @Override\n   protected void afterSubscribe() {\n-    queryHandle.start();\n+    // Run async as it can block\n+    executeOnWorker(queryHandle::start);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3ODI4OA=="}, "originalCommit": {"oid": "5bb65ff798ff73d75842b1331e4ef9a8a79aa611"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2136, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}