{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3MzIyNTY1", "number": 6763, "title": "fix: client/server SSL settings fail when 'ssl.key.password' is set", "bodyText": "Description\nFixes #6719\nDifferent keystore and key passwords are not supported in Vert.x API. Internally. Vert.x always wants to decrypt the Private key using the keystore password. To fix this, this PR decrypts the Private key with the password specified in ssl.key.password, then re-encrypts it with the keystore password. The resulted encrypted bytes are then passed to Vert.x to handle the SSL communication.\nThe code has the re-encryption part in KeyStoreUtil.java already. I  just re-use the same keystore password when encrypting the key again.\nThe rest of the code in Server.java, KsqlClient.java and InternalKsqlClientFactory.java look for the ssl.key.password config, and passes the key password to the KeyStoreUtil. This is supported only when the keystore is a JKS type and when a key alias is found in the configs too. FYI, 'PKCS12` does not support a keystore with different key password (both must be the same).\nA new client config ssl.keystore.alias is added so that clients can configure the ssl.key.password.\nTesting done\nAdded unit tests\nVerified manually.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-12-11T19:42:56Z", "url": "https://github.com/confluentinc/ksql/pull/6763", "merged": true, "mergeCommit": {"oid": "3e48540fbe1a02ed02faa667e424b225f9d7ba20"}, "closed": true, "closedAt": "2021-01-15T17:33:38Z", "author": {"login": "spena"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmJaKogBqjQxMTA1NDMyNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwGLYsABqjQyMDY4NDI4Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "398b4ad4d46d7072d80d801fc61e456da8406841", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/398b4ad4d46d7072d80d801fc61e456da8406841", "committedDate": "2020-12-11T19:36:00Z", "message": "fix: client/server SSL settings fail when 'ssl.key.password' is set"}, "afterCommit": {"oid": "df80865d23ffd6ad365adf7b1126d9f949f9d0c0", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/df80865d23ffd6ad365adf7b1126d9f949f9d0c0", "committedDate": "2020-12-14T17:43:45Z", "message": "fix: client/server SSL settings fail when 'ssl.key.password' is set"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df80865d23ffd6ad365adf7b1126d9f949f9d0c0", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/df80865d23ffd6ad365adf7b1126d9f949f9d0c0", "committedDate": "2020-12-14T17:43:45Z", "message": "fix: client/server SSL settings fail when 'ssl.key.password' is set"}, "afterCommit": {"oid": "a28d97511f697ba007188138b6af7b16e250b0b0", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/a28d97511f697ba007188138b6af7b16e250b0b0", "committedDate": "2020-12-14T20:00:55Z", "message": "test: add test cases for VertxSslOptionsFactory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODU4ODA4", "url": "https://github.com/confluentinc/ksql/pull/6763#pullrequestreview-551858808", "createdAt": "2020-12-14T20:17:23Z", "commit": {"oid": "a28d97511f697ba007188138b6af7b16e250b0b0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a28d97511f697ba007188138b6af7b16e250b0b0", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/a28d97511f697ba007188138b6af7b16e250b0b0", "committedDate": "2020-12-14T20:00:55Z", "message": "test: add test cases for VertxSslOptionsFactory"}, "afterCommit": {"oid": "52187b89d9cc1a08d205edf516c2619847afd48a", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/52187b89d9cc1a08d205edf516c2619847afd48a", "committedDate": "2020-12-15T18:11:28Z", "message": "test: add tests and update integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52187b89d9cc1a08d205edf516c2619847afd48a", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/52187b89d9cc1a08d205edf516c2619847afd48a", "committedDate": "2020-12-15T18:11:28Z", "message": "test: add tests and update integration tests"}, "afterCommit": {"oid": "1f73ba8b7ebb0a01d15deecf8f3f44ede872f0f2", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/1f73ba8b7ebb0a01d15deecf8f3f44ede872f0f2", "committedDate": "2020-12-15T19:24:23Z", "message": "test: add tests and update integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f73ba8b7ebb0a01d15deecf8f3f44ede872f0f2", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/1f73ba8b7ebb0a01d15deecf8f3f44ede872f0f2", "committedDate": "2020-12-15T19:24:23Z", "message": "test: add tests and update integration tests"}, "afterCommit": {"oid": "231caa69ee44b0f28cb6bc329885442d943c5ddd", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/231caa69ee44b0f28cb6bc329885442d943c5ddd", "committedDate": "2020-12-15T19:38:03Z", "message": "test: add tests and update integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "231caa69ee44b0f28cb6bc329885442d943c5ddd", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/231caa69ee44b0f28cb6bc329885442d943c5ddd", "committedDate": "2020-12-15T19:38:03Z", "message": "test: add tests and update integration tests"}, "afterCommit": {"oid": "2832c7090c9edace4db0656cf3d3443897a91c28", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/2832c7090c9edace4db0656cf3d3443897a91c28", "committedDate": "2020-12-15T20:28:29Z", "message": "test: add tests and update integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2832c7090c9edace4db0656cf3d3443897a91c28", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/2832c7090c9edace4db0656cf3d3443897a91c28", "committedDate": "2020-12-15T20:28:29Z", "message": "test: add tests and update integration tests"}, "afterCommit": {"oid": "286a2bc5113b1a673c86a4a744b71b1f160125be", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/286a2bc5113b1a673c86a4a744b71b1f160125be", "committedDate": "2020-12-15T21:21:17Z", "message": "test: add tests and update integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "102cbc8a58e818889daa70fbd3bcf97a815ad9e0", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/102cbc8a58e818889daa70fbd3bcf97a815ad9e0", "committedDate": "2020-12-16T02:23:26Z", "message": "chore: add key password and alias to Java client"}, "afterCommit": {"oid": "46dacdfbd48259dc50db146e5059dcc8351e48e9", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/46dacdfbd48259dc50db146e5059dcc8351e48e9", "committedDate": "2021-01-06T22:53:23Z", "message": "chore: add key password and alias to Java client"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNjQ0MTkw", "url": "https://github.com/confluentinc/ksql/pull/6763#pullrequestreview-563644190", "createdAt": "2021-01-07T16:43:58Z", "commit": {"oid": "46dacdfbd48259dc50db146e5059dcc8351e48e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NDI4NDEw", "url": "https://github.com/confluentinc/ksql/pull/6763#pullrequestreview-567428410", "createdAt": "2021-01-13T16:55:54Z", "commit": {"oid": "46dacdfbd48259dc50db146e5059dcc8351e48e9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNjo1NTo1NFrOIS5CfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNjo1NTo1NFrOIS5CfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjY3OTgwNA==", "bodyText": "did you mean to pass in the DOC here?", "url": "https://github.com/confluentinc/ksql/pull/6763#discussion_r556679804", "createdAt": "2021-01-13T16:55:54Z", "author": {"login": "agavra"}, "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/KsqlRestConfig.java", "diffHunk": "@@ -413,6 +414,12 @@\n             SSL_KEYSTORE_PASSWORD_DEFAULT,\n             Importance.HIGH,\n             SslConfigs.SSL_KEYSTORE_PASSWORD_DOC\n+        ).define(\n+            SslConfigs.SSL_KEY_PASSWORD_CONFIG,\n+            Type.PASSWORD,\n+            SSL_KEY_PASSWORD_DEFAULT,\n+            Importance.HIGH,\n+            SslConfigs.SSL_KEY_PASSWORD_CONFIG", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46dacdfbd48259dc50db146e5059dcc8351e48e9"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f58bdc0ec35d00e40f971119f5e062da8f18e1c", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/1f58bdc0ec35d00e40f971119f5e062da8f18e1c", "committedDate": "2021-01-14T15:37:15Z", "message": "fix: client/server SSL settings fail when 'ssl.key.password' is set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeedf3f9be4950b4748e3e850b919e7fc4dcb7f7", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/eeedf3f9be4950b4748e3e850b919e7fc4dcb7f7", "committedDate": "2021-01-14T15:37:15Z", "message": "test: add tests and update integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e95a9d880278c51c8841e7e2711fb400acc59a5", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/3e95a9d880278c51c8841e7e2711fb400acc59a5", "committedDate": "2021-01-14T15:37:15Z", "message": "chore: add key password and alias to Java client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fc5594ab9a5a102f6e688fd25c6c4f55d446b30", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/2fc5594ab9a5a102f6e688fd25c6c4f55d446b30", "committedDate": "2021-01-14T15:37:15Z", "message": "chore: fix missing DOC config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46dacdfbd48259dc50db146e5059dcc8351e48e9", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/46dacdfbd48259dc50db146e5059dcc8351e48e9", "committedDate": "2021-01-06T22:53:23Z", "message": "chore: add key password and alias to Java client"}, "afterCommit": {"oid": "2fc5594ab9a5a102f6e688fd25c6c4f55d446b30", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/2fc5594ab9a5a102f6e688fd25c6c4f55d446b30", "committedDate": "2021-01-14T15:37:15Z", "message": "chore: fix missing DOC config"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4522, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}