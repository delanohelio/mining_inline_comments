{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MjY2OTIx", "number": 4580, "title": "refactor: Use JKS TLS config", "bodyText": "Description\nThe new API server is not configured with JKS key/trust stores which makes it more compatible with how the current ksql server is configured.\nAlso we now run api tests both with and without TLS\nTesting done\nNew tests\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-02-17T18:22:23Z", "url": "https://github.com/confluentinc/ksql/pull/4580", "merged": true, "mergeCommit": {"oid": "28288f484aeb18d4bece0531a1ca2b80263aab66"}, "closed": true, "closedAt": "2020-02-18T20:38:09Z", "author": {"login": "purplefox"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFR0CsAH2gAyMzc2MjY2OTIxOjFmMDYxNjk3ZTE4NjhjZDhmNGUwYWEwNWZmYmVjZDQ2ZWVjNjkxMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFmXhHgFqTM2MDU3NDU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f061697e1868cd8f4e0aa05ffbecd46eec69105", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/1f061697e1868cd8f4e0aa05ffbecd46eec69105", "committedDate": "2020-02-17T18:40:56Z", "message": "use JKS TLS config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "committedDate": "2020-02-17T18:40:56Z", "message": "tweaks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d40e47683cd13e3e4cdf7514cc97cadd6059a61", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/3d40e47683cd13e3e4cdf7514cc97cadd6059a61", "committedDate": "2020-02-17T18:37:50Z", "message": "tweaks"}, "afterCommit": {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "committedDate": "2020-02-17T18:40:56Z", "message": "tweaks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTc0NTg3", "url": "https://github.com/confluentinc/ksql/pull/4580#pullrequestreview-360574587", "createdAt": "2020-02-18T18:33:11Z", "commit": {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODozMzoxMVrOFrNsOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODozNjozMVrOFrNy1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NzQwMQ==", "bodyText": "Isn't client auth normally off, requested or required rather than simply on-off?", "url": "https://github.com/confluentinc/ksql/pull/4580#discussion_r380857401", "createdAt": "2020-02-18T18:33:11Z", "author": {"login": "big-andy-coates"}, "path": "ksql-api/src/main/java/io/confluent/ksql/api/server/ApiServerConfig.java", "diffHunk": "@@ -38,22 +37,40 @@\n           + \" as there are cores you want to use, as each instance is single threaded.\";\n \n   public static final String LISTEN_HOST = propertyName(\"listen.host\");\n-  public static final String DEFAULT_LISTEN_HOST = \"0.0.0.0\";\n+  public static final String DEFAULT_LISTEN_HOST = \"localhost\";\n   public static final String LISTEN_HOST_DOC =\n       \"The hostname to listen on\";\n \n   public static final String LISTEN_PORT = propertyName(\"listen.port\");\n-  public static final int DEFAULT_LISTEN_PORT = 8089;\n+  public static final int DEFAULT_LISTEN_PORT = 8088;\n   public static final String LISTEN_PORT_DOC =\n       \"The port to listen on\";\n \n-  public static final String KEY_PATH = propertyName(\"key.path\");\n-  public static final String KEY_PATH_DOC =\n-      \"Path to key file\";\n+  public static final String TLS_ENABLED = propertyName(\"tls.enabled\");\n+  public static final boolean DEFAULT_TLS_ENABLED = false;\n+  public static final String TLS_ENABLED_DOC =\n+      \"Is TLS enabled?\";\n \n-  public static final String CERT_PATH = propertyName(\"cert.path\");\n-  public static final String CERT_PATH_DOC =\n-      \"Path to cert file\";\n+  public static final String TLS_KEY_STORE_PATH = propertyName(\"tls.keystore.path\");\n+  public static final String TLS_KEY_STORE_PATH_DOC =\n+      \"Path to server key store\";\n+\n+  public static final String TLS_KEY_STORE_PASSWORD = propertyName(\"tls.keystore.password\");\n+  public static final String TLS_KEY_STORE_PASSWORD_DOC =\n+      \"Password for server key store\";\n+\n+  public static final String TLS_TRUST_STORE_PATH = propertyName(\"tls.truststore.path\");\n+  public static final String TLS_TRUST_STORE_PATH_DOC =\n+      \"Path to client trust store\";\n+\n+  public static final String TLS_TRUST_STORE_PASSWORD = propertyName(\"tls.truststore.password\");\n+  public static final String TLS_TRUST_STORE_PASSWORD_DOC =\n+      \"Password for client trust store\";\n+\n+  public static final String TLS_CLIENT_AUTH_REQUIRED = propertyName(\"tls.client.auth.required\");\n+  public static final boolean DEFAULT_TLS_CLIENT_AUTH_REQUIRED = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1OTA5NQ==", "bodyText": "Do we want to run all the tests in ApiTest with Tls enabled?  I would of thought that's a bit heavy weight given the number of tests in there will likely increase over time.  Is it not sufficient to test that a single pull query works, a single push query works, etc?", "url": "https://github.com/confluentinc/ksql/pull/4580#discussion_r380859095", "createdAt": "2020-02-18T18:36:31Z", "author": {"login": "big-andy-coates"}, "path": "ksql-api/src/test/java/io/confluent/ksql/api/TlsTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.api;\n+\n+import io.confluent.ksql.api.server.ApiServerConfig;\n+import io.confluent.ksql.test.util.secure.ServerKeyStore;\n+import io.vertx.core.http.HttpVersion;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.kafka.common.config.SslConfigs;\n+\n+public class TlsTest extends ApiTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 40, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}