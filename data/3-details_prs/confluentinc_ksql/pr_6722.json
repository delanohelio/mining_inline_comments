{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNzg2NzQx", "number": 6722, "title": "feat: expose support for array and struct keys", "bodyText": "Description\nThis PR adds more test coverage for array and struct keys, and exposes the feature to the world (by removing the relevant feature flag) \ud83c\udf89 (partial progress towards #824)\nFour commits for ease of reviewing:\n\nadditional QTT test coverage\nadds integration test coverage, via the HTTP2 API and Java client tests\nremoves the feature flag\nadds QTT historic plans\n\nTesting done\nSee above -- lots of new tests!\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-12-04T21:03:22Z", "url": "https://github.com/confluentinc/ksql/pull/6722", "merged": true, "mergeCommit": {"oid": "c7fc2b0df7b64bcd0370054eb9c82d2880a2de53"}, "closed": true, "closedAt": "2020-12-07T21:49:31Z", "author": {"login": "vcrfxia"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi8of8AH2gAyNTMyNzg2NzQxOmRlZTBjM2VlY2I1Nzg4MDc2MmY3MDI0NmY0NWQ4YjFiYTgwNzljZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj7a-jgH2gAyNTMyNzg2NzQxOjBmNTM4Y2FmODBlZmY5MmMxM2NjYmIzNjVmNTkxZDFjMWI4Y2NkODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dee0c3eecb57880762f70246f45d8b1ba8079cd7", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/dee0c3eecb57880762f70246f45d8b1ba8079cd7", "committedDate": "2020-12-04T19:09:12Z", "message": "test: additional qtt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "580a0c94bb555e77ff81c0ffbecf9c4f2f5eeb5d", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/580a0c94bb555e77ff81c0ffbecf9c4f2f5eeb5d", "committedDate": "2020-12-04T20:36:17Z", "message": "test: integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8178a761ee60038e957c0aa89a33cc7ad25db0fe", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/8178a761ee60038e957c0aa89a33cc7ad25db0fe", "committedDate": "2020-12-04T20:52:55Z", "message": "feat: expose support for array and struct keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9362eaac8018bf890b358e064b8db8d598d91a39", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/9362eaac8018bf890b358e064b8db8d598d91a39", "committedDate": "2020-12-04T21:00:16Z", "message": "chore: historic plans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00e0cbb6c7c8dd06ba0ab6493487f97117db79bb", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/00e0cbb6c7c8dd06ba0ab6493487f97117db79bb", "committedDate": "2020-12-04T22:15:53Z", "message": "test: fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzM5NTI0", "url": "https://github.com/confluentinc/ksql/pull/6722#pullrequestreview-546339524", "createdAt": "2020-12-07T16:51:49Z", "commit": {"oid": "8178a761ee60038e957c0aa89a33cc7ad25db0fe"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjo1MTo0OVrOIAwSxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjo1MTo0OVrOIAwSxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2MjE0OA==", "bodyText": "(from a previous PR) we might want to link to #6621 in the exception of the message if anyone needs to \"continue the conversation\"", "url": "https://github.com/confluentinc/ksql/pull/6722#discussion_r537662148", "createdAt": "2020-12-07T16:51:49Z", "author": {"login": "agavra"}, "path": "ksqldb-serde/src/main/java/io/confluent/ksql/serde/GenericKeySerDe.java", "diffHunk": "@@ -148,21 +148,12 @@ private static void checkUnsupportedSchema(\n       }\n     }\n \n-    if (config.getBoolean(KsqlConfig.KSQL_COMPLEX_KEY_FORMAT_ENABLED)) {\n-      for (final SimpleColumn column : columns) {\n-        if (containsMapType(column.type())) {\n-          throw new KsqlException(\"Map keys, including types that contain maps, are not supported \"\n-              + \"as they may lead to unexpected behavior due to inconsistent serialization. \"\n-              + \"Key column name: \" + column.name() + \". \"\n-              + \"Column type: \" + column.type().toString(FormatOptions.none()));\n-        }\n-      }\n-    } else {\n-      for (final SimpleColumn column : columns) {\n-        final SqlType sqlType = column.type();\n-        if (!(sqlType instanceof SqlPrimitiveType || sqlType instanceof SqlDecimal)) {\n-          throw new KsqlException(\"Unsupported key schema: \" + columns);\n-        }\n+    for (final SimpleColumn column : columns) {\n+      if (containsMapType(column.type())) {\n+        throw new KsqlException(\"Map keys, including types that contain maps, are not supported \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8178a761ee60038e957c0aa89a33cc7ad25db0fe"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dddbe16bbf2f4278ba77556fbb9151342d105ec0", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/dddbe16bbf2f4278ba77556fbb9151342d105ec0", "committedDate": "2020-12-07T18:08:19Z", "message": "Merge branch 'master' into complex-key-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13ccf39f7e7ccc9fc7a72755b3c49903d6deba86", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/13ccf39f7e7ccc9fc7a72755b3c49903d6deba86", "committedDate": "2020-12-07T18:20:23Z", "message": "chore: update map key error msg to link to github issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a269b7b6e70f88679fd98085827c9842038cf04c", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/a269b7b6e70f88679fd98085827c9842038cf04c", "committedDate": "2020-12-07T20:10:04Z", "message": "chore: new historic plans (in light of avro schema full name)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f538caf80eff92c13ccbb365f591d1c1b8ccd89", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/0f538caf80eff92c13ccbb365f591d1c1b8ccd89", "committedDate": "2020-12-07T20:18:27Z", "message": "chore: remove duplicate qtts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4572, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}