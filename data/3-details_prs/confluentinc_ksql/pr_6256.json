{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MzIxMzA3", "number": 6256, "title": "chore: finish wiring up unwrapped keys", "bodyText": "Description\nfixes: #6209\nThis finishes the wiring of the WRAP_SINGLE_KEYS option up. (Some bits were missed in the first PR)\nTesting done\nUsual\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-09-18T13:38:28Z", "url": "https://github.com/confluentinc/ksql/pull/6256", "merged": true, "mergeCommit": {"oid": "e905d29a5cd64be0d170ea4c8e9449118fe82a84"}, "closed": true, "closedAt": "2020-09-21T11:20:29Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKFvjwgH2gAyNDg5MzIxMzA3OjE5MzIxY2ZhZTZkNTBhYTFkNzM4NDU4MjVkNTFkMThmMWRlODJkMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLApFwgH2gAyNDg5MzIxMzA3OmE4ZjFjY2RjMWFkYThkNDFlNzA4YWE0YTNiOGU3MmViNTFkYjVhYjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/19321cfae6d50aa1d73845825d51d18f1de82d27", "committedDate": "2020-09-18T13:37:57Z", "message": "chore: finish wiring up unwrapped keys\n\nfixes: https://github.com/confluentinc/ksql/issues/6209\n\nThis finishes the wiring of the `WRAP_SINGLE_KEYS` option up."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNDczNjYw", "url": "https://github.com/confluentinc/ksql/pull/6256#pullrequestreview-491473660", "createdAt": "2020-09-18T13:39:31Z", "commit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzozOTozMVrOHUNkhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzozOTozMVrOHUNkhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk1NTkwOA==", "bodyText": "Dropped these in favour of findAny, which is more generic.", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r490955908", "createdAt": "2020-09-18T13:39:31Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/serde/SerdeOptions.java", "diffHunk": "@@ -60,33 +59,22 @@ private SerdeOptions(final ImmutableSet<SerdeOption> options) {\n     validate(this.options);\n   }\n \n-  @SuppressWarnings(\"MethodMayBeStatic\")\n   public EnabledSerdeFeatures keyFeatures() {\n-    // Currently there are no key features:\n-    return EnabledSerdeFeatures.of();\n+    return features(true);\n   }\n \n   public EnabledSerdeFeatures valueFeatures() {\n-    // Currently there are no key features, so all are value features:\n-    return EnabledSerdeFeatures.from(options.stream()\n-        .map(SerdeOption::requiredFeature)\n-        .collect(Collectors.toSet()));\n+    return features(false);\n   }\n \n   public Set<SerdeOption> all() {\n     return options;\n   }\n \n-  public Optional<SerdeOption> keyWrapping() {\n-    return Optional.ofNullable(\n-        Iterables.getFirst(Sets.intersection(options, KEY_WRAPPING_OPTIONS), null)\n-    );\n-  }\n-\n-  public Optional<SerdeOption> valueWrapping() {\n-    return Optional.ofNullable(\n-        Iterables.getFirst(Sets.intersection(options, VALUE_WRAPPING_OPTIONS), null)\n-    );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNDc0MTUx", "url": "https://github.com/confluentinc/ksql/pull/6256#pullrequestreview-491474151", "createdAt": "2020-09-18T13:40:07Z", "commit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzo0MDowN1rOHUNl9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzo0MDowN1rOHUNl9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk1NjI3Ng==", "bodyText": "key features are now returned as key features, not value features!", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r490956276", "createdAt": "2020-09-18T13:40:07Z", "author": {"login": "big-andy-coates"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/serde/SerdeOptions.java", "diffHunk": "@@ -111,6 +99,13 @@ public String toString() {\n     return options.toString();\n   }\n \n+  private EnabledSerdeFeatures features(final boolean key) {\n+    return EnabledSerdeFeatures.from(options.stream()\n+        .filter(option -> option.isKeyOption() == key)\n+        .map(SerdeOption::requiredFeature)\n+        .collect(Collectors.toSet()));\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzQzMjUy", "url": "https://github.com/confluentinc/ksql/pull/6256#pullrequestreview-491743252", "createdAt": "2020-09-18T19:55:22Z", "commit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo1NToyM1rOHUaE4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo1NToyM1rOHUaE4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE2MDgwMg==", "bodyText": "Does it make sense to assume all serde options will always be either key- or value-specific, never both nor neither? Can't think of why this wouldn't be true in the future but seemed worth double-checking.", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r491160802", "createdAt": "2020-09-18T19:55:23Z", "author": {"login": "vcrfxia"}, "path": "ksqldb-common/src/main/java/io/confluent/ksql/serde/SerdeOption.java", "diffHunk": "@@ -38,19 +38,25 @@\n    *\n    * @see SerdeOption#WRAP_SINGLE_VALUES\n    */\n-  UNWRAP_SINGLE_VALUES(SerdeFeature.UNWRAP_SINGLES),\n+  UNWRAP_SINGLE_VALUES(SerdeFeature.UNWRAP_SINGLES, false),\n \n   /**\n    * Key version of {@link #UNWRAP_SINGLE_VALUES}.\n    */\n-  UNWRAP_SINGLE_KEYS(SerdeFeature.UNWRAP_SINGLES);\n+  UNWRAP_SINGLE_KEYS(SerdeFeature.UNWRAP_SINGLES, true);\n \n+  private final boolean isKey;\n   private final SerdeFeature requiredFeature;\n \n-  SerdeOption(final SerdeFeature requiredFeature) {\n+  SerdeOption(final SerdeFeature requiredFeature, final boolean isKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8f1ccdc1ada8d41e708aa4a3b8e72eb51db5ab8", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/a8f1ccdc1ada8d41e708aa4a3b8e72eb51db5ab8", "committedDate": "2020-09-21T10:15:17Z", "message": "Merge branch 'master' into serde_options_wiring"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4662, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}