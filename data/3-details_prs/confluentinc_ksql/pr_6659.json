{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NzE4NzY2", "number": 6659, "title": "chore: switch to schema-less KsqlStruct", "bodyText": "Description\nNote: built on top of #6653, review that first.\nNo other sql instance types, (e.g. BigDecimal, String, Double, Map, List, etc), require the schema during instantiation. Only the Connect Struct type and the ksqlDB specific KsqlStruct type, which is to be Struct's replacement, require the schema during Construction.  This can make working with structs more tricky than other types.\nThis change removes the requirement to provide the schema when instantiating KsqlStruct. The aim is to make this type easier to use.\nThe Field type has also been moved into the SqlStruct class. The code base has many Field types. Field is specifically a struct field. Making this an inner class of SqlStruct helps avoid confusion as to which field type we are talking about.\nTesting done\nUsual.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-11-23T13:07:22Z", "url": "https://github.com/confluentinc/ksql/pull/6659", "merged": true, "mergeCommit": {"oid": "599c4eeba1b767914c73d0fa23fd629ce373986c"}, "closed": true, "closedAt": "2020-11-24T11:17:48Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdefTnpgH2gAyNTI1NzE4NzY2OmM5NzgyYjUyMzMzZTQ3NmE5YzBiOGMyYzE0N2ViNWUwODljZmMyZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfmnhfgH2gAyNTI1NzE4NzY2OmE1YzYwNThjMWI3YTQ2MGQzYjg1YWEwNTBjZDVkODlmZDhiMWQxOGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c9782b52333e476a9c0b8c2c147eb5e089cfc2f1", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/c9782b52333e476a9c0b8c2c147eb5e089cfc2f1", "committedDate": "2020-11-20T22:43:27Z", "message": "refactor: remove unused validation code\n\n`KsqlStruct` is not yet used. However, the code calls `validateValue` when setting the value of a field. This check is not free and is on the critical path.  ksqlDB is strongly typed, so the only way the type would be wrong would be if a function or deserializer where returning incorrect data, i.e. a bug.  We should not pay the production runtime cost of checking _every_ field we set during _every_ record we process.\n\nRather than validate here, we should add a `-debug` option to ksqlDB that validates the returned data from deserializers and functions against the expected schema, as suggested here: https://github.com/confluentinc/ksql/issues/3624#issuecomment-729532558"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d8afe824f346f700b4febcfb2f51e4604b91e93", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/4d8afe824f346f700b4febcfb2f51e4604b91e93", "committedDate": "2020-11-23T13:06:25Z", "message": "chore: switch to schema-less KsqlStruct\n\nNo other sql instance types, (e.g. BigDecimal, String, Double, Map, List, etc), require the schema during instantiation. Only the Connect `Struct` type and the ksqlDB specific `KsqlStruct` type, which is to be `Struct`'s replacement, require the schema during Construction.  This can make working with structs more tricky than other types.\n\nThis change removes the requirement to provide the schema when instantiating `KsqlStruct`. The aim is to make this type easier to use.\n\nThe `Field` type has also been moved into the `SqlStruct` class. The code base has many `Field` types. `Field` is specifically a struct field. Making this an inner class of `SqlStruct` helps avoid confusion as to which field type we are talking about."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2OTI5Mzk5", "url": "https://github.com/confluentinc/ksql/pull/6659#pullrequestreview-536929399", "createdAt": "2020-11-23T23:38:41Z", "commit": {"oid": "4d8afe824f346f700b4febcfb2f51e4604b91e93"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMzozODo0MVrOH4jqWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMzozODo0MVrOH4jqWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA2NjU4NA==", "bodyText": "I feel like if we're touting efficiency in this class, we should strive not to use optionals to avoid unnecessary wrapping/unwrapping - but that can be change for another time :)", "url": "https://github.com/confluentinc/ksql/pull/6659#discussion_r529066584", "createdAt": "2020-11-23T23:38:41Z", "author": {"login": "agavra"}, "path": "ksqldb-udf/src/main/java/io/confluent/ksql/types/KsqlStruct.java", "diffHunk": "@@ -35,36 +39,57 @@\n @Immutable\n public final class KsqlStruct {\n \n-  private final SqlStruct schema;\n   @EffectivelyImmutable\n   private final ImmutableList<Optional<?>> values;\n \n   public static Builder builder(final SqlStruct schema) {\n     return new Builder(schema);\n   }\n \n-  private KsqlStruct(\n-      final SqlStruct schema,\n-      final List<Optional<?>> values\n-  ) {\n-    this.schema = Objects.requireNonNull(schema, \"schema\");\n+  private KsqlStruct(final List<Optional<?>> values) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d8afe824f346f700b4febcfb2f51e4604b91e93"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9343f398fef2a21528632f24dd998572011fd1de", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/9343f398fef2a21528632f24dd998572011fd1de", "committedDate": "2020-11-23T23:50:44Z", "message": "Merge branch 'master' into schemaless-struct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5c6058c1b7a460d3b85aa050cd5d89fd8b1d18b", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/confluentinc/ksql/commit/a5c6058c1b7a460d3b85aa050cd5d89fd8b1d18b", "committedDate": "2020-11-24T09:48:27Z", "message": "chore: fix merge issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4551, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}