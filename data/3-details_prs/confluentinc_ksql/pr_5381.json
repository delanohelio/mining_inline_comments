{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4OTY2MjIz", "number": 5381, "title": "fix: Override Scala version in our build", "bodyText": "Description\nThe build is failing with java.lang.NoClassDefFoundError: scala/$less$colon$less\nThis is due to clash between scale 2.12 and 2.13 in our dependencies and is fixed with #5380\nHowever we still depend on multiple minor dependencies of Scala:\nWe depend on org.apache.kafka:kafka_2.13:jar:6.0.0-ccs-SNAPSHOT and it has been recently upgraded to Scala 2.13.2\nHowever io.confluent.ksql:ksqldb-common depends on io.confluent:kafka-schema-registry-client:jar:6.0.0-SNAPSHOT which indirectly depends on scala 2.13.1\nHaving two or more versions of the same jar on the classpath can lead to subtle failures and non deterministic behaviour as we don't know which version of a particular class is actually going to be loaded (this depends on classloader implementation). We could even have situation where one class is loaded from one jar and the other from another.\n2.13.1 and 2.13.2 are binary compatible so it's safe to explicitly declare dependencies on Scala 2.13.2 from our build to override derived versions and make sure there is only one version of Scala on the classpath.\nTesting done\nNon functional change.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-05-16T13:10:15Z", "url": "https://github.com/confluentinc/ksql/pull/5381", "merged": true, "mergeCommit": {"oid": "7cf82e443283bbd189944a15a8341646919cf01f"}, "closed": true, "closedAt": "2020-05-16T14:04:39Z", "author": {"login": "purplefox"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABch2WCwAH2gAyNDE4OTY2MjIzOjczNGZkYzU4ZTU3NDcxOTM2NjhkMjNmYTRmMWE1Y2NjYjc2MmQyMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABch9MbZAFqTQxMzEwODQ1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "734fdc58e5747193668d23fa4f1a5cccb762d20f", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/734fdc58e5747193668d23fa4f1a5cccb762d20f", "committedDate": "2020-05-16T13:04:32Z", "message": "fix scala version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "432cb43abf376307f5b98eef6a9b5759228f8520", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/432cb43abf376307f5b98eef6a9b5759228f8520", "committedDate": "2020-05-16T13:11:05Z", "message": "removed files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDc2MzMy", "url": "https://github.com/confluentinc/ksql/pull/5381#pullrequestreview-413076332", "createdAt": "2020-05-16T13:20:32Z", "commit": {"oid": "432cb43abf376307f5b98eef6a9b5759228f8520"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxMzoyMDozMlrOGWaUqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxMzoyMDozMlrOGWaUqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE1MzEzMQ==", "bodyText": "nit: can we update the comment to make it more clear that this is a temporary workaround?", "url": "https://github.com/confluentinc/ksql/pull/5381#discussion_r426153131", "createdAt": "2020-05-16T13:20:32Z", "author": {"login": "vcrfxia"}, "path": "pom.xml", "diffHunk": "@@ -433,6 +434,20 @@\n                 <version>${icu.version}</version>\n             </dependency>\n \n+            <!-- We need to fix our Scala versions as otherwise our depdendencies bring in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432cb43abf376307f5b98eef6a9b5759228f8520"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68f51a93ae70571ec545bf742c789c3b8ce06e65", "author": {"user": {"login": "purplefox", "name": "Tim Fox"}}, "url": "https://github.com/confluentinc/ksql/commit/68f51a93ae70571ec545bf742c789c3b8ce06e65", "committedDate": "2020-05-16T14:04:06Z", "message": "Added link to PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTA4NDU2", "url": "https://github.com/confluentinc/ksql/pull/5381#pullrequestreview-413108456", "createdAt": "2020-05-16T21:03:22Z", "commit": {"oid": "68f51a93ae70571ec545bf742c789c3b8ce06e65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQyMTowMzoyMlrOGWco_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQyMTowMzoyMlrOGWco_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5MTEwMQ==", "bodyText": "Can we add this to common instead? KSQL and Schema Registry both seem to depend on a Scala library now (mbknor-jackson-jsonschema), so we should set this in the dependencyManagement section of common. And the scala version should be kept in sync with the one in Kafka.", "url": "https://github.com/confluentinc/ksql/pull/5381#discussion_r426191101", "createdAt": "2020-05-16T21:03:22Z", "author": {"login": "ijuma"}, "path": "pom.xml", "diffHunk": "@@ -433,6 +434,21 @@\n                 <version>${icu.version}</version>\n             </dependency>\n \n+            <!-- We need to fix our Scala versions as otherwise our depdendencies bring in\n+            different versions via different routes\n+            https://github.com/confluentinc/common/pull/260 -->\n+            <dependency>\n+                <groupId>org.scala-lang</groupId>\n+                <artifactId>scala-library</artifactId>\n+                <version>${scala.version}</version>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>org.scala-lang</groupId>\n+                <artifactId>scala-reflect</artifactId>\n+                <version>${scala.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68f51a93ae70571ec545bf742c789c3b8ce06e65"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4778, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}