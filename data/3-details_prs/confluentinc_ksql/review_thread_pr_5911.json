{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NDM4MTgy", "number": 5911, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzo0OTo0NlrOETyF_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzo0OTo0NlrOETyF_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTc5MTMzOnYy", "diffSide": "RIGHT", "path": "ksqldb-engine/src/test/java/io/confluent/ksql/integration/JoinIntTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzo0OTo0NlrOG5tkkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODowNzoyMFrOG5uMgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE2ODY1Ng==", "bodyText": "Judging by your description, any stream event with timestamp greater than 0 shouldn't be able to join with this, right?\nAre you assuming that once you address the other bug, this should fail?  (That would validate the assertion that the join shouldn't happen with this timestamp)", "url": "https://github.com/confluentinc/ksql/pull/5911#discussion_r463168656", "createdAt": "2020-07-30T17:49:46Z", "author": {"login": "AlanConfluent"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/integration/JoinIntTest.java", "diffHunk": "@@ -82,8 +85,10 @@ public void before() {\n     TEST_HARNESS.ensureTopics(itemTableTopicJson, itemTableTopicAvro,\n         orderStreamTopicJson, orderStreamTopicAvro);\n \n-    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> now - 500);\n-    TEST_HARNESS.produceRows(itemTableTopicAvro, ITEM_DATA_PROVIDER, AVRO, () -> now - 500);\n+    // we want the table events to always be present (less than the ts in the stream\n+    // including the time extractor)\n+    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> 0L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "094f751d3719b1c2bcd2b0ed3779ba642b4e6db3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3MTA2Mg==", "bodyText": "Judging by your description, any stream event with timestamp greater than 0 shouldn't be able to join with this, right?\n\nI'm not sure I understand - it would logically be the opposite? If the timestamp of the table event is less than the stream event timestamp then it should be able to see the table entry.\n\nAre you assuming that once you address the other bug, this should fail? (That would validate the assertion that the join shouldn't happen with this timestamp)\n\nWhat other bug? I'm not sure there is a bug, something changed in behavior and I'm trying to understand if what changed is a bug or not.", "url": "https://github.com/confluentinc/ksql/pull/5911#discussion_r463171062", "createdAt": "2020-07-30T17:53:43Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/integration/JoinIntTest.java", "diffHunk": "@@ -82,8 +85,10 @@ public void before() {\n     TEST_HARNESS.ensureTopics(itemTableTopicJson, itemTableTopicAvro,\n         orderStreamTopicJson, orderStreamTopicAvro);\n \n-    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> now - 500);\n-    TEST_HARNESS.produceRows(itemTableTopicAvro, ITEM_DATA_PROVIDER, AVRO, () -> now - 500);\n+    // we want the table events to always be present (less than the ts in the stream\n+    // including the time extractor)\n+    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> 0L);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE2ODY1Ng=="}, "originalCommit": {"oid": "094f751d3719b1c2bcd2b0ed3779ba642b4e6db3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3NTk4OQ==", "bodyText": "You're right, I got that backward.\nThe other bug I was referring to was this:\n\nThe weird part, is that it works if we set the timestamp to anything less than 9L - meaning that if my stream event has timestamp 1L it can join with a table entry that has timestamp 8L only if there exists an event in the stream that has a timestamp greater than or equal to 8L.\n\nI was mainly pointing out that if this was a bug, it might make sense to set a value that should not work (but does!), so that if this is uncovered in the future, the test will break.  Or maybe that should be its own test.\nJust a thought.", "url": "https://github.com/confluentinc/ksql/pull/5911#discussion_r463175989", "createdAt": "2020-07-30T18:02:08Z", "author": {"login": "AlanConfluent"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/integration/JoinIntTest.java", "diffHunk": "@@ -82,8 +85,10 @@ public void before() {\n     TEST_HARNESS.ensureTopics(itemTableTopicJson, itemTableTopicAvro,\n         orderStreamTopicJson, orderStreamTopicAvro);\n \n-    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> now - 500);\n-    TEST_HARNESS.produceRows(itemTableTopicAvro, ITEM_DATA_PROVIDER, AVRO, () -> now - 500);\n+    // we want the table events to always be present (less than the ts in the stream\n+    // including the time extractor)\n+    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> 0L);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE2ODY1Ng=="}, "originalCommit": {"oid": "094f751d3719b1c2bcd2b0ed3779ba642b4e6db3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3ODg4MQ==", "bodyText": "I was mainly pointing out that if this was a bug, it might make sense to set a value that should not work (but does!), so that if this is uncovered in the future, the test will break. Or maybe that should be its own test.\n\nah, got it! yeah that would be a valuable test to add once we understand what's going on.", "url": "https://github.com/confluentinc/ksql/pull/5911#discussion_r463178881", "createdAt": "2020-07-30T18:07:20Z", "author": {"login": "agavra"}, "path": "ksqldb-engine/src/test/java/io/confluent/ksql/integration/JoinIntTest.java", "diffHunk": "@@ -82,8 +85,10 @@ public void before() {\n     TEST_HARNESS.ensureTopics(itemTableTopicJson, itemTableTopicAvro,\n         orderStreamTopicJson, orderStreamTopicAvro);\n \n-    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> now - 500);\n-    TEST_HARNESS.produceRows(itemTableTopicAvro, ITEM_DATA_PROVIDER, AVRO, () -> now - 500);\n+    // we want the table events to always be present (less than the ts in the stream\n+    // including the time extractor)\n+    TEST_HARNESS.produceRows(itemTableTopicJson, ITEM_DATA_PROVIDER, JSON, () -> 0L);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE2ODY1Ng=="}, "originalCommit": {"oid": "094f751d3719b1c2bcd2b0ed3779ba642b4e6db3"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3014, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}