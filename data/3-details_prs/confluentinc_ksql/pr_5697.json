{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMzQ3NDc5", "number": 5697, "title": "test: fix flaky ClientIntegrationTest#shouldListQueries() (MINOR)", "bodyText": "Description\nThe recently added ClientIntegrationTest#shouldListQueries() previously sometimes failed because queries started (and terminated) by other tests took time to actually be removed from the server's metastore, as this process is async after termination. This caused ClientIntegrationTest#shouldListQueries() to fail because the test checked that there was only one query in the metastore. This PR fixes the flakiness by switching to assertThatEventually() instead of assertThat().\nTesting done\nTest-only change. Ran the test a bunch of times locally and didn't see any failures.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-06-26T02:29:14Z", "url": "https://github.com/confluentinc/ksql/pull/5697", "merged": true, "mergeCommit": {"oid": "e602819fc461a02517b7123b57af1a24859ca37f"}, "closed": true, "closedAt": "2020-06-29T21:28:56Z", "author": {"login": "vcrfxia"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu50eLAH2gAyNDQwMzQ3NDc5OjQwYTE1ZDkwMTkwMGI3ZGEwYzAxZTE2NzUzNDdjZmVkZjdkNjlkOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwEgLigFqTQzOTM1NTcwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40a15d901900b7da0c01e1675347cfedf7d69d9f", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/40a15d901900b7da0c01e1675347cfedf7d69d9f", "committedDate": "2020-06-26T02:28:30Z", "message": "test: add print statements to debug list queries test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e8f02e1adaa8ff0f23e9d1754a630ca33351f03", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/6e8f02e1adaa8ff0f23e9d1754a630ca33351f03", "committedDate": "2020-06-26T04:56:39Z", "message": "test: update logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051f1cfc2d76b4130af236a5f95ec37517623ff8", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/051f1cfc2d76b4130af236a5f95ec37517623ff8", "committedDate": "2020-06-26T17:23:15Z", "message": "Merge branch 'master' into list-queries-debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b14dbcb9971d1c2fb188b0e3c9796d94da6802fb", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/b14dbcb9971d1c2fb188b0e3c9796d94da6802fb", "committedDate": "2020-06-26T17:23:34Z", "message": "test: undisable test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93bd30697b4a88517a2a96848ad18c65d5c9ce06", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/93bd30697b4a88517a2a96848ad18c65d5c9ce06", "committedDate": "2020-06-26T19:53:22Z", "message": "test: fix flaky test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ebeff085ea1ac7b68c3c52c3eae7ac035be0e39", "author": {"user": {"login": "vcrfxia", "name": "Victoria Xia"}}, "url": "https://github.com/confluentinc/ksql/commit/1ebeff085ea1ac7b68c3c52c3eae7ac035be0e39", "committedDate": "2020-06-26T19:55:09Z", "message": "test: improve debugability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MzU1NzA4", "url": "https://github.com/confluentinc/ksql/pull/5697#pullrequestreview-439355708", "createdAt": "2020-06-29T17:29:08Z", "commit": {"oid": "1ebeff085ea1ac7b68c3c52c3eae7ac035be0e39"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNzoyOTowOVrOGqa-1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNzoyOTowOVrOGqa-1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzNTQ0Ng==", "bodyText": "I wonder if this can affect stability of any of the other tests - is there a way to assert this in the @Before or @After methods?", "url": "https://github.com/confluentinc/ksql/pull/5697#discussion_r447135446", "createdAt": "2020-06-29T17:29:09Z", "author": {"login": "agavra"}, "path": "ksqldb-api-client/src/test/java/io/confluent/ksql/api/client/integration/ClientIntegrationTest.java", "diffHunk": "@@ -708,31 +707,38 @@ public void shouldListTopics() throws Exception {\n     final List<TopicInfo> topics = client.listTopics().get();\n \n     // Then\n-    assertThat(topics, containsInAnyOrder(\n+    assertThat(\"\" + topics, topics, containsInAnyOrder(\n         topicInfo(TEST_TOPIC),\n         topicInfo(EMPTY_TEST_TOPIC),\n         topicInfo(EMPTY_TEST_TOPIC_2),\n         topicInfo(AGG_TABLE)\n     ));\n   }\n \n-  @Ignore // temporarily disable while flakiness is being investigated\n   @Test\n-  public void shouldListQueries() throws Exception {\n+  public void shouldListQueries() {\n     // When\n-    final List<QueryInfo> queries = client.listQueries().get();\n+    // Try multiple times to allow time for queries started by the other tests to finish terminating", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebeff085ea1ac7b68c3c52c3eae7ac035be0e39"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 260, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}