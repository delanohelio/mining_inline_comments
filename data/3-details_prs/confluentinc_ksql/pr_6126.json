{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NTQ3MjM4", "number": 6126, "title": "fix: create /var/lib/kafka-streams directory on RPM installation", "bodyText": "Description\nWhen installing ksqlDB using RPM/DEB packages, the /var/lib/kafka-streams directory cannot be created because lack of write permissions in /var/lib. To fix this, this PR creates the streams directory during the RPM installation.\nTesting done\nDescribe the testing strategy. Unit and integration tests are expected for any behavior changes.\nReviewer checklist\n\n Ensure docs are updated if necessary. (eg. if a user visible feature is being added or changed).\n Ensure relevant issues are linked (description should include text like \"Fixes #\")", "createdAt": "2020-08-31T21:20:03Z", "url": "https://github.com/confluentinc/ksql/pull/6126", "merged": true, "mergeCommit": {"oid": "31ed3d3aca2de26fb44ca42bb651a1ddfc86f671"}, "closed": true, "closedAt": "2020-09-14T18:54:03Z", "author": {"login": "spena"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEZiFHgH2gAyNDc2NTQ3MjM4OmQ4MDg4MjI4M2UwZmE5MGZmNDlhZjVkOGE3MmJhMjQ2MjViY2VlNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI2yeTAH2gAyNDc2NTQ3MjM4OjRmNGE2MzE2OTExYzI2NWZjNzAzMTMxMDI2ZmE2MDBkY2RkODI4MWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/d80882283e0fa90ff49af5d8a72ba24625bcee66", "committedDate": "2020-08-31T21:17:47Z", "message": "fix: create /var/lib/kafka-streams directory on RPM installation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTY3Mzgw", "url": "https://github.com/confluentinc/ksql/pull/6126#pullrequestreview-478967380", "createdAt": "2020-08-31T21:28:00Z", "commit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODowMVrOHKJ07Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODozOFrOHKJ2BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODgxMw==", "bodyText": "any reason why we removed this?", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r480408813", "createdAt": "2020-08-31T21:28:01Z", "author": {"login": "agavra"}, "path": "debian/confluent-ksqldb.postinst", "diffHunk": "@@ -10,25 +10,28 @@ case \"$1\" in\n \t(getent group $_group 2>&1 >/dev/null) || addgroup --quiet --system $_group\n         adduser --system --disabled-password --disabled-login --home /var/empty \\\n                 --no-create-home --quiet --force-badname --ingroup $_group $_user\n+                \n+  # Set explicit kafka-streams directory if not set\n+  ksqldb_config=/etc/ksqldb/ksql-server.properties\n+  if [ -f $ksqldb_config ]; then\n+    if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+      echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+    fi\n+  fi                \n \n \t_permwarn=\n-\tfor dir in /var/log/confluent ; do\n-\t    if [ $dir = /var/log/confluent ]; then\n-\t\t# Confluent log directory should be writable by group\n+\tfor dir in /var/log/confluent /var/lib/kafka-streams ; do\n+\t\t# Confluent log and kafka-streams directories should be writable by group\n \t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-\t    else\n-\t\t# Other dirs are only readable by group\n-\t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODg3Mg==", "bodyText": "nit: indentation seems off?", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r480408872", "createdAt": "2020-08-31T21:28:09Z", "author": {"login": "agavra"}, "path": "debian/confluent-ksqldb.postinst", "diffHunk": "@@ -10,25 +10,28 @@ case \"$1\" in\n \t(getent group $_group 2>&1 >/dev/null) || addgroup --quiet --system $_group\n         adduser --system --disabled-password --disabled-login --home /var/empty \\\n                 --no-create-home --quiet --force-badname --ingroup $_group $_user\n+                \n+  # Set explicit kafka-streams directory if not set\n+  ksqldb_config=/etc/ksqldb/ksql-server.properties\n+  if [ -f $ksqldb_config ]; then\n+    if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+      echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+    fi\n+  fi                \n \n \t_permwarn=\n-\tfor dir in /var/log/confluent ; do\n-\t    if [ $dir = /var/log/confluent ]; then\n-\t\t# Confluent log directory should be writable by group\n+\tfor dir in /var/log/confluent /var/lib/kafka-streams ; do\n+\t\t# Confluent log and kafka-streams directories should be writable by group\n \t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-\t    else\n-\t\t# Other dirs are only readable by group\n-\t\t_perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"\n-\t    fi\n-\n-\t    if [ ! -d $dir ]; then\n-\t\techo \"Creating directory $dir with owner $_user:$_group\"\n-\t\tmkdir -p $dir\n-\t\teval $_perm\n-\t    else\n-\t\techo \"Notice: Not creating existing directory $dir, ensure proper permissions for user $_user group $_group\"\n-\t\t_permwarn=\"${_permwarn}${_perm}\\n\"\n-\t    fi\n+\n+    if [ ! -d $dir ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTA5Mg==", "bodyText": "same as above", "url": "https://github.com/confluentinc/ksql/pull/6126#discussion_r480409092", "createdAt": "2020-08-31T21:28:38Z", "author": {"login": "agavra"}, "path": "debian/confluent-ksqldb.spec.in", "diffHunk": "@@ -27,16 +27,19 @@ _group=confluent\n getent group $_group 2>&1 >/dev/null || groupadd -r $_group\n getent passwd $_user 2>&1 >/dev/null || \\\n     useradd -r -g $_group --home-dir /tmp --no-create-home -s /sbin/nologin -c \"Confluent KSQL\" $_user\n+    \n+# Set explicit kafka-streams directory if not set\n+ksqldb_config=/etc/ksqldb/ksql-server.properties\n+if [ -f $ksqldb_config ]; then\n+  if ! grep '^state.dir=' $ksqldb_config >/dev/null 2>&1; then\n+    echo \"state.dir=/var/lib/kafka-streams\" >> $ksqldb_config\n+  fi\n+fi    \n \n _permwarn=\n-for dir in /var/log/confluent ; do\n-    if [ $dir = /var/log/confluent ]; then\n-        # Confluent log directory should be writable by group\n-        _perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+wx,o= $dir\"\n-    else\n-        # Other dirs are only readable by group\n-        _perm=\"chown ${_user}:${_group} $dir && chmod u+wx,g+r,o= $dir\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80882283e0fa90ff49af5d8a72ba24625bcee66"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f4a6316911c265fc703131026fa600dcdd8281e", "author": {"user": {"login": "spena", "name": "Sergio Pe\u00f1a"}}, "url": "https://github.com/confluentinc/ksql/commit/4f4a6316911c265fc703131026fa600dcdd8281e", "committedDate": "2020-09-14T17:38:38Z", "message": "fix: fix indentation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4746, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}