{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NzY1MDU4", "number": 4072, "title": "Integrate OAuth authentication custom claim check", "bodyText": "Type of change\n\nEnhancement / new feature\n\nDescription\nAdds ability to add custom validation of JWT token during authentication by specifying a JsonPath filter query to pass or fail the access token based on its content. If introspection endpoint is used, the filter query is applied to the response of the introspection endpoint.\nThe following configuration option is added to the 'authentication' section of type 'oauth' of the Kafka CR:\n  authentication:\n    type: oauth\n    customClaimCheck: \"FILTER QUERY\"\n\nThis PR depends on strimzi/strimzi-kafka-oauth#87.\nThis PR is based on top of #4027.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-12-08T22:21:15Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4072", "merged": true, "mergeCommit": {"oid": "27cc997a6f5d09fefb5a5cce69e4db8880ac709c"}, "closed": true, "closedAt": "2021-02-15T14:54:14Z", "author": {"login": "mstruk"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdxUm-mABqjQyMTc1NTM4MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd6XW6QgBqjQzMzE3Mjk3ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a8c37102c9704d6d641606b2454a67030537223", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0a8c37102c9704d6d641606b2454a67030537223", "committedDate": "2020-12-08T22:08:02Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "e4f01dc5014917041163506858dfe370a33b62d3", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e4f01dc5014917041163506858dfe370a33b62d3", "committedDate": "2021-01-17T16:44:26Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39594c32a9c733102920a87a4de61a0944a96599", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/39594c32a9c733102920a87a4de61a0944a96599", "committedDate": "2021-01-18T17:27:45Z", "message": "Fix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "b4f62db3135f48838da50870918a6bc222900711", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b4f62db3135f48838da50870918a6bc222900711", "committedDate": "2021-02-04T10:25:47Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate Jayway JsonPath to 2.5.0 and include it in Kafka images\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4f62db3135f48838da50870918a6bc222900711", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b4f62db3135f48838da50870918a6bc222900711", "committedDate": "2021-02-04T10:25:47Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate Jayway JsonPath to 2.5.0 and include it in Kafka images\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "b9d77c4fef7228cd2b482e0f3018389637b560db", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b9d77c4fef7228cd2b482e0f3018389637b560db", "committedDate": "2021-02-09T06:49:02Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate Jayway JsonPath to 2.5.0 and include it in Kafka images\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3056509395dc458a187fbaa2694b93d9d1c08055", "committedDate": "2021-02-12T15:08:30Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate Jayway JsonPath to 2.5.0 and include it in Kafka images\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9d77c4fef7228cd2b482e0f3018389637b560db", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b9d77c4fef7228cd2b482e0f3018389637b560db", "committedDate": "2021-02-09T06:49:02Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate Jayway JsonPath to 2.5.0 and include it in Kafka images\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3056509395dc458a187fbaa2694b93d9d1c08055", "committedDate": "2021-02-12T15:08:30Z", "message": "Integrate OAuth authentication custom claim check\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate Jayway JsonPath to 2.5.0 and include it in Kafka images\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix conflict on net.minidev:json-smart dependency used by net.logstash.log4j:jsonevent-layout\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg5NTk5Mzc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4072#pullrequestreview-589599376", "createdAt": "2021-02-12T16:00:28Z", "commit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg5NjgwNDMw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4072#pullrequestreview-589680430", "createdAt": "2021-02-12T17:34:40Z", "commit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMlQxNzozNDo0MVrOIku-bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMlQxNzozNDo0MVrOIku-bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTM4OTI5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <10> Additional custom rules can be imposed on the JWT access token during validation by setting this to a JsonPath filter query. If matching fails, the access token is rejected. When using `introspectionEndpointUri` the custom check is applied to the introspection endpoint response JSON.\n          \n          \n            \n            <10> Additional custom rules can be imposed on the JWT access token during validation by setting this to a JsonPath filter query. If the access token does not contain the necessary data, it is rejected. When using the `introspectionEndpointUri`, the custom check is applied to the introspection endpoint response JSON.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4072#discussion_r575389292", "createdAt": "2021-02-12T17:34:41Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -135,6 +136,7 @@ Depending on how you apply OAuth 2.0 authentication, and the type of authorizati\n <7> Set this to `false` in order to disable the SASL_OAUTHBEARER mechanism on the listener. At least one of SASL_PLAIN or SASL_OAUTHBEARER has to be enabled. Default is `true`.\n <8> Set this to `true` in order to enable the SASL_PLAIN mechanism on the listener, which is supported by all clients on all platforms. The Kafka client has to enable the SASL_PLAIN mechanism and set the `username` and the `password`. This mechanism can be used to authenticate either by using the OAuth access token, or by using the OAuth clientId and secret (client credentials). If the client sets `username` to `access-token` then the password is interpreted as access token on the server, otherwise the user is interpreted as the clientId, and password as the client secret. Default is `false`.\n <9> This has to be set to support the client credentials authentication when `enablePlain` is set to true, as described in previous point.\n+<10> Additional custom rules can be imposed on the JWT access token during validation by setting this to a JsonPath filter query. If matching fails, the access token is rejected. When using `introspectionEndpointUri` the custom check is applied to the introspection endpoint response JSON.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg5NjgyMjkx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4072#pullrequestreview-589682291", "createdAt": "2021-02-12T17:35:35Z", "commit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTkwMDI3NDYz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4072#pullrequestreview-590027463", "createdAt": "2021-02-14T08:59:57Z", "commit": {"oid": "3056509395dc458a187fbaa2694b93d9d1c08055"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f448eb74ce3726b10426be08780f7548bd1549", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d3f448eb74ce3726b10426be08780f7548bd1549", "committedDate": "2021-02-15T12:58:39Z", "message": "Update documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56abe4cfbf36f099742cef9a2daa468155a213ad", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/56abe4cfbf36f099742cef9a2daa468155a213ad", "committedDate": "2021-02-15T12:55:15Z", "message": "Update documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>"}, "afterCommit": {"oid": "d3f448eb74ce3726b10426be08780f7548bd1549", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d3f448eb74ce3726b10426be08780f7548bd1549", "committedDate": "2021-02-15T12:58:39Z", "message": "Update documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 716, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}