{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0MzcxNjk4", "number": 3348, "title": "Fixed NPEs related to dynamic configuration", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nBugfix\n\nDescription\nAfter the Kafka dynamic broker configuration has been merged, few NPEs emerged.\nFirst of them was related to null string configuration fetched from starting broker.\nSecond NPE was about wrong composition (we dereferenced io.strimzi.operator.cluster.operator.assembly.KafkaAssemblyOperator.ReconciliationState#kafkaCluster in io.strimzi.operator.cluster.operator.assembly.KafkaAssemblyOperator.ReconciliationState#rollingUpdateForNewCaKey before it was defined (in io.strimzi.operator.cluster.operator.assembly.KafkaAssemblyOperator.ReconciliationState#getKafkaClusterDescription)).\nChecklist\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-07-21T10:39:28Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348", "merged": true, "mergeCommit": {"oid": "88c402b122597216897cfa2aaf35ada931cfc9d0"}, "closed": true, "closedAt": "2020-07-22T11:04:36Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3DybngH2gAyNDU0MzcxNjk4OmIzNzE2ZDY1MTM3MTc3ZDBiYmExMzQ1MWE0ODUxN2Q3Mjk3YjE3YTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3Xy-sgFqTQ1MzE2ODcxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b3716d65137177d0bba13451a48517d7297b17a8", "committedDate": "2020-07-21T10:36:43Z", "message": "Fixes\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMzM4MDU4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#pullrequestreview-452338058", "createdAt": "2020-07-21T10:46:18Z", "commit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMDo0NjoxOFrOG0ybAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMDo0NjoxOFrOG0ybAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAwNTI0OA==", "bodyText": "Why do we need to move the get on the Kafka cluster description?\nMaybe add a comment for the context why this breaks convention.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#discussion_r458005248", "createdAt": "2020-07-21T10:46:18Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaAssemblyOperator.java", "diffHunk": "@@ -265,6 +265,7 @@ public KafkaAssemblyOperator(Vertx vertx, PlatformFeaturesAvailability pfa,\n         reconcileState.initialStatus()\n                 .compose(state -> state.reconcileCas(this::dateSupplier))\n                 .compose(state -> state.clusterOperatorSecret(this::dateSupplier))\n+                .compose(state -> state.getKafkaClusterDescription())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMzM5MDA2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#pullrequestreview-452339006", "createdAt": "2020-07-21T10:47:50Z", "commit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMDo0Nzo1MFrOG0ydxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMDo0Nzo1MFrOG0ydxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAwNTk1OA==", "bodyText": "It might be worth documenting a null desired state does not mean an empty broker state but is indeed a shortcut for saying no changes required.\nThis can not be assumed and should be in the javadoc", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#discussion_r458005958", "createdAt": "2020-07-21T10:47:50Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/KafkaBrokerConfigurationDiff.java", "diffHunk": "@@ -139,7 +139,7 @@ private static boolean isIgnorableProperty(String key) {\n     private static Collection<AlterConfigOp> diff(int brokerId, String desired,\n                                                   Config brokerConfigs,\n                                                   Map<String, ConfigModel> configModel) {\n-        if (brokerConfigs == null) {\n+        if (brokerConfigs == null || desired == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTk1MjIz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#pullrequestreview-452595223", "createdAt": "2020-07-21T15:48:59Z", "commit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzIzMjY0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#pullrequestreview-452723264", "createdAt": "2020-07-21T18:28:53Z", "commit": {"oid": "b3716d65137177d0bba13451a48517d7297b17a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9317511b2c5612bc38eb658327af95b6ca122fb8", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9317511b2c5612bc38eb658327af95b6ca122fb8", "committedDate": "2020-07-22T06:26:23Z", "message": "Sam's comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTY4NzEz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3348#pullrequestreview-453168713", "createdAt": "2020-07-22T09:55:25Z", "commit": {"oid": "9317511b2c5612bc38eb658327af95b6ca122fb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1340, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}