{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwODA2Njk4", "number": 3776, "title": "Fix DeploymentConfig readiness check to actually wait", "bodyText": "Type of change\n\nBugfix\n\nDescription\nThe latest Fabric8 used in Strimzi master has a bug (fabric8io/kubernetes-client#2537) which breaks the readiness check (isReady()). This PR provides a workaround until it is fixed in Fabric8.\nIt adds the isReady() method to DeploymentConfigOperator and uses OpenShiftReadiness.isDeploymentConfigReady(...). Since the static call to OpenShiftReadiness is not so easy to mock, I disabled 3 tests relying on it. After the original issue is fixed, we should be able to use resourceOp.isReady(resource) and should be able to enable these tests again.\nIt also adds warning to AbstractReadyResourceOperator.isReady when called for resource not supporting readiness to alert us better on issues like this.\nChecklist\n\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging", "createdAt": "2020-10-09T20:32:33Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3776", "merged": true, "mergeCommit": {"oid": "d4299e3002b0a0e246907ac95e602ff7bd711422"}, "closed": true, "closedAt": "2020-10-10T20:09:51Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRHXYGgFqTUwNjA4Mjc0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdROUoMgBqjM4NjI5NjM2MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDgyNzQy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3776#pullrequestreview-506082742", "createdAt": "2020-10-10T09:26:39Z", "commit": {"oid": "2591f208fa57e6c25b67107fe5a544c8cdba1e61"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOToyNjozOVrOHfenIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOToyNjozOVrOHfenIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2OTQ0MA==", "bodyText": "typos \"is\"", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3776#discussion_r502769440", "createdAt": "2020-10-10T09:26:39Z", "author": {"login": "ppatierno"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/operator/resource/DeploymentConfigOperator.java", "diffHunk": "@@ -104,4 +105,26 @@ private DeploymentCondition getProgressingCondition(DeploymentConfig dep)  {\n             return null;\n         }\n     }\n+\n+    /**\n+     * Due to the separation of Fabric8 Kubernetes and OpenShift clients, the DeploymentConfig needs its own isReady()\n+     * method instead of using isReady() from AbstractReadyResourceOperator because it would not pass Readiness.isReadinessApplicable()\n+     *\n+     * @param namespace The namespace.\n+     * @param name The resource name.\n+     * @return Whether the resource in in the Ready state.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2591f208fa57e6c25b67107fe5a544c8cdba1e61"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDg5MTU3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3776#pullrequestreview-506089157", "createdAt": "2020-10-10T11:05:48Z", "commit": {"oid": "2591f208fa57e6c25b67107fe5a544c8cdba1e61"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxMTowNTo0OFrOHffKww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxMTowNTo0OFrOHffKww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3ODU2Mw==", "bodyText": "Missing @Override annotation.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3776#discussion_r502778563", "createdAt": "2020-10-10T11:05:48Z", "author": {"login": "tombentley"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/operator/resource/DeploymentConfigOperator.java", "diffHunk": "@@ -104,4 +105,26 @@ private DeploymentCondition getProgressingCondition(DeploymentConfig dep)  {\n             return null;\n         }\n     }\n+\n+    /**\n+     * Due to the separation of Fabric8 Kubernetes and OpenShift clients, the DeploymentConfig needs its own isReady()\n+     * method instead of using isReady() from AbstractReadyResourceOperator because it would not pass Readiness.isReadinessApplicable()\n+     *\n+     * @param namespace The namespace.\n+     * @param name The resource name.\n+     * @return Whether the resource in in the Ready state.\n+     */\n+    public boolean isReady(String namespace, String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2591f208fa57e6c25b67107fe5a544c8cdba1e61"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02ab8b81447dbddcd612cce078982b0786859746", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/02ab8b81447dbddcd612cce078982b0786859746", "committedDate": "2020-10-10T17:09:30Z", "message": "Fix DeploymentConfig readiness check to actually wait\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99fa95cca08258fe5b2dea48a21117a734889826", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/99fa95cca08258fe5b2dea48a21117a734889826", "committedDate": "2020-10-10T17:09:30Z", "message": "Fix JavaDoc and comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "621a728b8238eb13057e3a6c87774aa050d533f8", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/621a728b8238eb13057e3a6c87774aa050d533f8", "committedDate": "2020-10-10T17:09:30Z", "message": "Review comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e05fd93805b9eb308977dc221f1404552ba51e1e", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e05fd93805b9eb308977dc221f1404552ba51e1e", "committedDate": "2020-10-10T17:34:59Z", "message": "Add stupid listener names forgoten by other PR\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a08cb853261751f96bd7be7db3705bf46d1db584", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a08cb853261751f96bd7be7db3705bf46d1db584", "committedDate": "2020-10-10T14:17:12Z", "message": "Review comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}, "afterCommit": {"oid": "e05fd93805b9eb308977dc221f1404552ba51e1e", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e05fd93805b9eb308977dc221f1404552ba51e1e", "committedDate": "2020-10-10T17:34:59Z", "message": "Add stupid listener names forgoten by other PR\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 788, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}