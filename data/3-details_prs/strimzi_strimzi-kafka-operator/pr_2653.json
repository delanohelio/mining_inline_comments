{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0ODA0Mjk4", "number": 2653, "title": "[MO] - [system test] -> oauth authorization superuser breaks rules", "bodyText": "Signed-off-by: see-quick xorsak02@stud.fit.vutbr.cz\nType of change\n\nEnhancement / new feature\nRefactoring\n\nDescription\nThis PR:\n\nadding test case for oauth authorization with combination of superusers, which breaks all rules defined in the authorization server.\nchanging communication inside OauthAuthorizationST to plain for simplicity.\n\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-03-06T12:49:44Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653", "merged": true, "mergeCommit": {"oid": "e6815ff4c215083187ffb93bba4c42e7a08be1ff"}, "closed": true, "closedAt": "2020-03-18T21:59:57Z", "author": {"login": "see-quick"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLmvuNAFqTM3MDgxOTMzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOxc9UAFqTM3NjU5NTQyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODE5MzMz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#pullrequestreview-370819333", "createdAt": "2020-03-08T10:23:26Z", "commit": {"oid": "d76d88436dcf189d66c1231b12a397486bd927bc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxMDoyMzoyN1rOFzUXpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxMDoyNzo0MFrOFzUYxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1NTQzMA==", "bodyText": "It would make reviews of ST PRs lot easier if every PR didn't contain bunch of removals of throws Exception. Is this in any way related to the actual PR or is it just something you noticed while doing the PR? If it is related to the PR it is of course ok. But if not, please open one PR to fix all of these to make the reviews easier.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#discussion_r389355430", "createdAt": "2020-03-08T10:23:27Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1364,7 +1364,7 @@ void verifyVolumeNamesAndLabels(int kafkaReplicas, int diskCountPerReplica, int\n     }\n \n     @Test\n-    void testPersistentStorageSize() throws Exception {\n+    void testPersistentStorageSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d76d88436dcf189d66c1231b12a397486bd927bc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1NTUxMw==", "bodyText": "What is the reason to move so massively to not using TLS? Again, it looks a bit unrelated to the main PR.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#discussion_r389355513", "createdAt": "2020-03-08T10:24:27Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/oauth/OauthAuthorizationST.java", "diffHunk": "@@ -61,11 +61,11 @@\n     @Description(\"As a member of team A, I should be able to read and write to all topics starting with a-\")\n     @Test\n     void smokeTestForClients() throws IOException, InterruptedException, ExecutionException, TimeoutException {\n-        Future<Integer> producer = teamAOauthKafkaClient.sendMessagesTls(TOPIC_A, NAMESPACE, CLUSTER_NAME, TEAM_A_CLIENT,\n-                MESSAGE_COUNT, \"SSL\");\n+        Future<Integer> producer = teamAOauthKafkaClient.sendMessages(TOPIC_A, NAMESPACE, CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d76d88436dcf189d66c1231b12a397486bd927bc"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1NTcxNw==", "bodyText": "I think this tests the super users well. But this test it self doesn't contain any verifications that the authorization alone works. Do you think it is sufficient that it is coverd in other tests? Or should we have something like:\n\nSetup the clusetr without super users\nTest that they cannot read and write\n3 Modify the cluster to add super users\nTest that they can now read and write.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#discussion_r389355717", "createdAt": "2020-03-08T10:27:40Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/oauth/OauthAuthorizationST.java", "diffHunk": "@@ -161,15 +159,81 @@ void testTeamAWriteToTopicStartingWithXAndTeamBReadFromTopicStartingWithX() thro\n \n         KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n \n-        Future<Integer> producer = teamAOauthKafkaClient.sendMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, TEAM_A_CLIENT,\n-                MESSAGE_COUNT, \"SSL\");\n+        Future<Integer> producer = teamAOauthKafkaClient.sendMessages(topicName, NAMESPACE, CLUSTER_NAME,\n+                MESSAGE_COUNT);\n+\n+        assertThat(producer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+\n+        Future<Integer> consumer = teamBOauthKafkaClient.receiveMessages(topicName, NAMESPACE, CLUSTER_NAME,\n+                MESSAGE_COUNT, \"x_consumer_group_b\");\n+\n+        assertThat(consumer.get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS), is(MESSAGE_COUNT));\n+    }\n+\n+    @Description(\"As a superuser of team A and team B, i am able to break defined authorization rules\")\n+    @Test\n+    void testSuperUserWithOauthAuthorization() throws InterruptedException, ExecutionException, TimeoutException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d76d88436dcf189d66c1231b12a397486bd927bc"}, "originalPosition": 141}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "434fd36619541a542ad2e57ef97acecd4f80fc1d", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/434fd36619541a542ad2e57ef97acecd4f80fc1d", "committedDate": "2020-03-09T14:53:19Z", "message": "[MO] - [system test] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}, "afterCommit": {"oid": "918838043b18f852f54d3e9ddba25c3522120c89", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/918838043b18f852f54d3e9ddba25c3522120c89", "committedDate": "2020-03-09T15:01:57Z", "message": "[MO] - [system test] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTYwOTk1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#pullrequestreview-371960995", "createdAt": "2020-03-10T13:42:54Z", "commit": {"oid": "6e4d67bc20e5f4bf469f04609fb97aaf0cb8b6d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjA1MTgx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#pullrequestreview-372205181", "createdAt": "2020-03-10T18:14:13Z", "commit": {"oid": "6e4d67bc20e5f4bf469f04609fb97aaf0cb8b6d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2677adbbcd823ea6863f1f4c1d4732b9b0bb62e7", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2677adbbcd823ea6863f1f4c1d4732b9b0bb62e7", "committedDate": "2020-03-12T05:37:18Z", "message": "[MO] - [system test] -> oauth authorization superuser breaks rules\n\nSigned-off-by: see-quick <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876957a50edc2367a7c5fa46c16a0fa24720bb92", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/876957a50edc2367a7c5fa46c16a0fa24720bb92", "committedDate": "2020-03-12T05:41:19Z", "message": "[MO] - [system test] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deda5267956432ec0693bbb49639e46b8fcbe3af", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/deda5267956432ec0693bbb49639e46b8fcbe3af", "committedDate": "2020-03-12T05:42:54Z", "message": "[MO] - [system test] -> update to new\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ea892f387e334916d4302bb2f3ee9807567692f", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6ea892f387e334916d4302bb2f3ee9807567692f", "committedDate": "2020-03-12T05:42:54Z", "message": "[MO] - [system test] -> up\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd5e12e294c136e9dc3e3a6a7fa118528541639d", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bd5e12e294c136e9dc3e3a6a7fa118528541639d", "committedDate": "2020-03-12T05:57:39Z", "message": "[MO] - [rebase] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e4d67bc20e5f4bf469f04609fb97aaf0cb8b6d9", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6e4d67bc20e5f4bf469f04609fb97aaf0cb8b6d9", "committedDate": "2020-03-10T12:01:39Z", "message": "[MO] - [system test] -> up\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}, "afterCommit": {"oid": "bd5e12e294c136e9dc3e3a6a7fa118528541639d", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bd5e12e294c136e9dc3e3a6a7fa118528541639d", "committedDate": "2020-03-12T05:57:39Z", "message": "[MO] - [rebase] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9d980d4e462b21b2739a8e42d3995b066409f21", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e9d980d4e462b21b2739a8e42d3995b066409f21", "committedDate": "2020-03-12T06:06:38Z", "message": "[MO] - [update] -ss\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d2f561ce1bc5820795f834fc5eae9bb3b20940b", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9d2f561ce1bc5820795f834fc5eae9bb3b20940b", "committedDate": "2020-03-12T08:28:27Z", "message": "[MO] - [update] -> up\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTk1NDIz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2653#pullrequestreview-376595423", "createdAt": "2020-03-18T06:38:00Z", "commit": {"oid": "9d2f561ce1bc5820795f834fc5eae9bb3b20940b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1754, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}