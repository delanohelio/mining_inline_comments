{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NDIyNDM5", "number": 3654, "title": "[DOC] upgrade update to describe switch to generic listener config", "bodyText": "Signed-off-by: prmellor pmellor@redhat.com\nDocumentation\nUpdate to the Upgrade section of the Deploying guide.\n\nconcepts for new GenericKafkaListener config and example\nupdate of Upgrading Kafka brokers and client applications procedure to include generic listener switch\n\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-09-15T16:41:32Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654", "merged": true, "mergeCommit": {"oid": "291e421ccda9e4cc9b042bcd5ee2d180d4bd1873"}, "closed": true, "closedAt": "2020-09-25T12:46:55Z", "author": {"login": "PaulRMellor"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJKiVBAH2gAyNDg3NDIyNDM5OjgxNjE1OGNhNzlhMDk1NDc0Y2VlMzljODMxNDg3MmFhZTVhYTA0ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL8c4RgFqTQ5NTMwOTg4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "816158ca79a095474cee39c8314872aae5aa0481", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/816158ca79a095474cee39c8314872aae5aa0481", "committedDate": "2020-09-15T16:39:06Z", "message": "[DOC] upgrade update to describe switch to generic listener config\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTg5MDU0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#pullrequestreview-488989054", "createdAt": "2020-09-15T19:13:28Z", "commit": {"oid": "816158ca79a095474cee39c8314872aae5aa0481"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxMzoyOFrOHSQczA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxODo0MFrOHSQnRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTkzMg==", "bodyText": "After the upgrade would be better I guess since it gives the reader a clear time window.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r488905932", "createdAt": "2020-09-15T19:13:28Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,63 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+The `GenericKafkaListener` schema is backwards compatible.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The listener configuration is defined as an array.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+As part of your upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "816158ca79a095474cee39c8314872aae5aa0481"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwODQ2MQ==", "bodyText": "Can we please stress out two points:\n\nThe name and port numbers here are really important for the backwards compatibility. Using other names will possibly result in differently named listeners in Kafka or services in Kubernetes which will cause problems.\nThe options in configuration or overrides of the old listeners need to be adjusted into the new configuration format", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r488908461", "createdAt": "2020-09-15T19:18:23Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,63 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+The `GenericKafkaListener` schema is backwards compatible.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The listener configuration is defined as an array.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+As part of your upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.\n+\n+For example, if you are currently using the following configuration in your `Kafka` configuration:\n+\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  plain:\n+    # ...\n+  tls:\n+    # ...\n+  external:\n+    type: loadbalancer\n+    # ...\n+----\n+\n+Convert the listeners into the new format using:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "816158ca79a095474cee39c8314872aae5aa0481"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwODYxMw==", "bodyText": "I don't think this is really true. The listeners field supports both the old deprecated form and the new array form. would be a better way to put it.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r488908613", "createdAt": "2020-09-15T19:18:40Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,63 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+The `GenericKafkaListener` schema is backwards compatible.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "816158ca79a095474cee39c8314872aae5aa0481"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cde793188e7a77e5ce756f403ff0a53e02e0b84", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1cde793188e7a77e5ce756f403ff0a53e02e0b84", "committedDate": "2020-09-17T15:21:11Z", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwOTE3Mzk0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#pullrequestreview-490917394", "createdAt": "2020-09-17T19:23:13Z", "commit": {"oid": "1cde793188e7a77e5ce756f403ff0a53e02e0b84"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxOToyMzoxM1rOHTxv2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxOToyMzo1M1rOHTxyFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUwMDA1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Using any other values will cause problems with the naming of Kafka listeners and Kubernetes services.\n          \n          \n            \n            Using any other values will cause renaming of Kafka listeners and Kubernetes services.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490500058", "createdAt": "2020-09-17T19:23:13Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,111 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The `listeners` configuration is defined as an array, but the deprecated format is also supported.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+After the Kafka upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.\n+\n+For example, if you are currently using the following configuration in your `Kafka` configuration:\n+\n+.Old listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  plain:\n+    # ...\n+  tls:\n+    # ...\n+  external:\n+    type: loadbalancer\n+    # ...\n+----\n+\n+Convert the listeners into the new format using:\n+\n+.New listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  #...\n+  - name: plain\n+    port: 9092\n+    type: internal\n+    tls: false <1>\n+  - name: tls\n+    port: 9093\n+    type: internal\n+    tls: true\n+  - name: external\n+    port: 9094\n+    type: _EXTERNAL-LISTENER-TYPE_ <2>\n+    tls: true\n+----\n+<1> The TLS property is now required for all listeners.\n+<2> Options: `ingress`, `loadbalancer`, `nodeport`, `route`.\n+\n+Make sure to use the the *exact* names and port numbers shown.\n+\n+For any additional `configuration` or `overrides` properties used with the old format, you need to update them to the new format.\n+\n+Changes introduced to the listener `configuration`:\n+\n+* `overrides` is merged with the `configuration` section\n+* `dnsAnnotations` has been renamed `annotations`\n+* `preferredAddressType` has been renamed `preferredNodePortAddressType`\n+* `address` has been renamed `alternativenames`\n+* `loadBalancerSourceRanges` and `externalTrafficPolicy` move to the listener configuration from the now deprecated `template`\n+\n+For example, this configuration:\n+\n+.Old additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  external:\n+    type: loadbalancer\n+    authentication:\n+      type: tls\n+    overrides:\n+      bootstrap:\n+        dnsAnnotations:\n+          #...\n+----\n+\n+Changes to:\n+\n+.New additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+    #...\n+  - name: external\n+    port: 9094\n+    type:loadbalancer\n+    tls: true\n+    configuration:\n+      bootstrap:\n+        annotations:\n+          #...\n+----\n+\n+IMPORTANT: The name and port numbers shown in the new listener configuration *must* be used for backwards compatibility.\n+Using any other values will cause problems with the naming of Kafka listeners and Kubernetes services.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cde793188e7a77e5ce756f403ff0a53e02e0b84"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUwMDYyOA==", "bodyText": "Just to make it more clear and identical with the old example above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            listeners:\n          \n          \n            \n                #...\n          \n          \n            \n              - name: external\n          \n          \n            \n                port: 9094\n          \n          \n            \n                type:loadbalancer\n          \n          \n            \n                tls: true\n          \n          \n            \n                configuration:\n          \n          \n            \n                  bootstrap:\n          \n          \n            \n                    annotations:\n          \n          \n            \n                      #...\n          \n          \n            \n            listeners:\n          \n          \n            \n                #...\n          \n          \n            \n              - name: external\n          \n          \n            \n                port: 9094\n          \n          \n            \n                type:loadbalancer\n          \n          \n            \n                tls: true\n          \n          \n            \n                authentication:\n          \n          \n            \n                  type: tls\n          \n          \n            \n                configuration:\n          \n          \n            \n                  bootstrap:\n          \n          \n            \n                    annotations:\n          \n          \n            \n                      #...", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490500628", "createdAt": "2020-09-17T19:23:53Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,111 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The `listeners` configuration is defined as an array, but the deprecated format is also supported.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+After the Kafka upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.\n+\n+For example, if you are currently using the following configuration in your `Kafka` configuration:\n+\n+.Old listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  plain:\n+    # ...\n+  tls:\n+    # ...\n+  external:\n+    type: loadbalancer\n+    # ...\n+----\n+\n+Convert the listeners into the new format using:\n+\n+.New listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  #...\n+  - name: plain\n+    port: 9092\n+    type: internal\n+    tls: false <1>\n+  - name: tls\n+    port: 9093\n+    type: internal\n+    tls: true\n+  - name: external\n+    port: 9094\n+    type: _EXTERNAL-LISTENER-TYPE_ <2>\n+    tls: true\n+----\n+<1> The TLS property is now required for all listeners.\n+<2> Options: `ingress`, `loadbalancer`, `nodeport`, `route`.\n+\n+Make sure to use the the *exact* names and port numbers shown.\n+\n+For any additional `configuration` or `overrides` properties used with the old format, you need to update them to the new format.\n+\n+Changes introduced to the listener `configuration`:\n+\n+* `overrides` is merged with the `configuration` section\n+* `dnsAnnotations` has been renamed `annotations`\n+* `preferredAddressType` has been renamed `preferredNodePortAddressType`\n+* `address` has been renamed `alternativenames`\n+* `loadBalancerSourceRanges` and `externalTrafficPolicy` move to the listener configuration from the now deprecated `template`\n+\n+For example, this configuration:\n+\n+.Old additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  external:\n+    type: loadbalancer\n+    authentication:\n+      type: tls\n+    overrides:\n+      bootstrap:\n+        dnsAnnotations:\n+          #...\n+----\n+\n+Changes to:\n+\n+.New additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+    #...\n+  - name: external\n+    port: 9094\n+    type:loadbalancer\n+    tls: true\n+    configuration:\n+      bootstrap:\n+        annotations:\n+          #...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cde793188e7a77e5ce756f403ff0a53e02e0b84"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0836b57e286e1e0c22c0db4d55140ff95ddc8e81", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0836b57e286e1e0c22c0db4d55140ff95ddc8e81", "committedDate": "2020-09-18T14:13:15Z", "message": "review edits JS + overview update\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzQ0Mjc5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#pullrequestreview-491744279", "createdAt": "2020-09-18T19:57:11Z", "commit": {"oid": "0836b57e286e1e0c22c0db4d55140ff95ddc8e81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzA5ODg4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#pullrequestreview-495309888", "createdAt": "2020-09-24T07:56:15Z", "commit": {"oid": "0836b57e286e1e0c22c0db4d55140ff95ddc8e81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 979, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}