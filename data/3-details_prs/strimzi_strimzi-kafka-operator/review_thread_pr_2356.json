{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4OTI0OTUx", "number": 2356, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMDowNDo1OVrODV25Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMDowNTo0N1rODV25YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjQ2MDgyOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMDowNDo1OVrOFaSuLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDozMjozOFrOFaaWZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA==", "bodyText": "I'm not sure I understand the logic why this is here. It doesn't seem to belong to this cluster and the actual Connect cluster is anyway not ready. I think the test with invalid lbel should be done when the Connect is ready.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363114030", "createdAt": "2020-01-05T20:04:59Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE3NDI1OQ==", "bodyText": "Connector itself doesn't reflect status of Kafka Connect so I think it doesn't matter where this code is. I can move to test phase, where connect is ready with same results I think. Or I can create completely new test case, but I wanted to save some time during execution.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363174259", "createdAt": "2020-01-06T06:40:33Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NDA1MA==", "bodyText": "Why does it not reflect it? I do not think there is any guarantee that the connector can be Ready if the Connect is not Ready.\nI understand why saving the time might be nice. But you should do this test when the Connect is Ready. That does not have to be different test case, or? You can just move it few lines up or down.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363194050", "createdAt": "2020-01-06T08:17:43Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwNTA1MA==", "bodyText": "It's better question for @tombentley. After our last discussion I understood that Connector doesn't reflect connect status atm. Sure, I will change it.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363205050", "createdAt": "2020-01-06T08:56:42Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwNTUwMQ==", "bodyText": "It doesn't have to reflect Connect status. But there is a clear relationship. The Connector runs inside Connectc, so when Connect is not ready, where would you expect it to run?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363205501", "createdAt": "2020-01-06T08:58:19Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwODc4OA==", "bodyText": "If the connector status is ready then it's very likely that the connect status is ready. If the connector status is not ready then you cannot infer anything about the connect status.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363208788", "createdAt": "2020-01-06T09:09:38Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxNDk4NA==", "bodyText": "It is more the other direction: Does it make sense to test how new connector deployes when Connect is not ready?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363214984", "createdAt": "2020-01-06T09:27:37Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzOTAxMg==", "bodyText": "Moved to phase when Kafka Connect is ready", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363239012", "createdAt": "2020-01-06T10:32:38Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDAzMA=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjQ2MTEzOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMDowNTo0N1rOFaSuWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDozMjozNlrOFaaWWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDA3NQ==", "bodyText": "Same as above.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363114075", "createdAt": "2020-01-05T20:05:47Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,\n+            kc -> kc.getMetadata().setLabels(Collections.singletonMap(\"strimzi.io/cluster\", \"non-existing-connect-cluster\")));\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"NotReady\");\n+\n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"10m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"Ready\");\n         assertKafkaConnectStatus(3, connectUrl);\n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,\n+            kc -> kc.getMetadata().setLabels(Collections.singletonMap(\"strimzi.io/cluster\", CLUSTER_NAME)));\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n     }\n \n     @Test\n     void testKafkaConnectS2IStatus() {\n         String connectS2IUrl = \"http://my-cluster-s2i-connect-api.status-cluster-test.svc:8083\";\n         String connectS2IDeploymentConfigName = CONNECTS2I_CLUSTER_NAME + \"-connect\";\n-        KafkaConnectS2IResource.kafkaConnectS2I(CONNECTS2I_CLUSTER_NAME, CLUSTER_NAME, 1).done();\n+        KafkaConnectS2IResource.kafkaConnectS2I(CONNECTS2I_CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectS2IStatus(\"Ready\");\n         assertKafkaConnectS2IStatus(1, connectS2IUrl, connectS2IDeploymentConfigName);\n+        KafkaConnectorResource.kafkaConnector(CONNECTS2I_CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CONNECTS2I_CLUSTER_NAME, \"Ready\");\n \n         KafkaConnectS2IResource.replaceConnectS2IResource(CONNECTS2I_CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectS2IStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CONNECTS2I_CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzOTAwMg==", "bodyText": "Moved to phase when Kafka Connect is ready", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2356#discussion_r363239002", "createdAt": "2020-01-06T10:32:36Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/CustomResourceStatusST.java", "diffHunk": "@@ -170,40 +173,64 @@ void testKafkaBridgeStatus() {\n     @Test\n     void testKafkaConnectStatus() {\n         String connectUrl = \"http://my-cluster-connect-api.status-cluster-test.svc:8083\";\n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1).done();\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectStatus(\"Ready\");\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n         assertKafkaConnectStatus(1, connectUrl);\n \n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,\n+            kc -> kc.getMetadata().setLabels(Collections.singletonMap(\"strimzi.io/cluster\", \"non-existing-connect-cluster\")));\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"NotReady\");\n+\n         KafkaConnectResource.replaceKafkaConnectResource(CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"10m\"))\n                 .build()));\n         waitForKafkaConnectStatus(\"Ready\");\n         assertKafkaConnectStatus(3, connectUrl);\n+        KafkaConnectorResource.replaceKafkaConnectorResource(CLUSTER_NAME,\n+            kc -> kc.getMetadata().setLabels(Collections.singletonMap(\"strimzi.io/cluster\", CLUSTER_NAME)));\n+        waitForKafkaConnectorStatus(CLUSTER_NAME, \"Ready\");\n     }\n \n     @Test\n     void testKafkaConnectS2IStatus() {\n         String connectS2IUrl = \"http://my-cluster-s2i-connect-api.status-cluster-test.svc:8083\";\n         String connectS2IDeploymentConfigName = CONNECTS2I_CLUSTER_NAME + \"-connect\";\n-        KafkaConnectS2IResource.kafkaConnectS2I(CONNECTS2I_CLUSTER_NAME, CLUSTER_NAME, 1).done();\n+        KafkaConnectS2IResource.kafkaConnectS2I(CONNECTS2I_CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata().done();\n         waitForKafkaConnectS2IStatus(\"Ready\");\n         assertKafkaConnectS2IStatus(1, connectS2IUrl, connectS2IDeploymentConfigName);\n+        KafkaConnectorResource.kafkaConnector(CONNECTS2I_CLUSTER_NAME, TOPIC_NAME).done();\n+        waitForKafkaConnectorStatus(CONNECTS2I_CLUSTER_NAME, \"Ready\");\n \n         KafkaConnectS2IResource.replaceConnectS2IResource(CONNECTS2I_CLUSTER_NAME, kb -> kb.getSpec().setResources(new ResourceRequirementsBuilder()\n                 .addToRequests(\"cpu\", new Quantity(\"100000000m\"))\n                 .build()));\n         waitForKafkaConnectS2IStatus(\"NotReady\");\n \n+        KafkaConnectorResource.replaceKafkaConnectorResource(CONNECTS2I_CLUSTER_NAME,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExNDA3NQ=="}, "originalCommit": {"oid": "96d7bd000245c97daa847f9d9fbc540ffccac34b"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 545, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}