{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NTQ2MTgy", "number": 2974, "title": "New configuration options for Strimzi OAuth 0.5.0 features", "bodyText": "Type of change\nSelect the type of your PR\n\nEnhancement / new feature\n\nDescription\nThis PR adds to oauth broker authentication the following new config options that make it possible to integrate with a wider set of authorization servers:\n\nuserInfoEndpointUri\ncheckIssuer\nfallbackUserNameClaim\nfallbackUserNamePrefix\nvalidTokenType\nscope\n\nIt also adds scope to oauth authentication configuration of clients.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Update/write design documentation in ./design\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md", "createdAt": "2020-05-07T08:46:01Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974", "merged": true, "mergeCommit": {"oid": "e903b3c971a75d812cf0b5b70b12b3efe87634f1"}, "closed": true, "closedAt": "2020-05-14T15:35:59Z", "author": {"login": "mstruk"}, "timelineItems": {"totalCount": 61, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce5hnbgFqTQwNzI4MDA0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchMbfKABqjMzMzYzMDk2MTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjgwMDQx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-407280041", "createdAt": "2020-05-07T09:00:01Z", "commit": {"oid": "9abb7e64af21038fff12eecc5b986b48249b15ca"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwOTowMDowMVrOGR1Jvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwOTowMzozNlrOGR1SAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0OTgyMg==", "bodyText": "Can you please use the annotation in the class it self instead of addint it here?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r421349822", "createdAt": "2020-05-07T09:00:01Z", "author": {"login": "scholzj"}, "path": ".checkstyle/suppressions.xml", "diffHunk": "@@ -57,4 +57,6 @@\n     <suppress checks=\".*\"\n               files=\"io[/\\\\]strimzi[/\\\\]api[/\\\\]kafka[/\\\\]model[/\\\\](Doneable).*\\.java\"/>\n \n+    <suppress checks=\"NPathComplexity|CyclomaticComplexity\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9abb7e64af21038fff12eecc5b986b48249b15ca"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM1MTkzNw==", "bodyText": "Why is this whole fallback structure needed? Maybe we should explain a bit more in the description when to use it?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r421351937", "createdAt": "2020-05-07T09:03:36Z", "author": {"login": "scholzj"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +168,26 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e99f7bf9c8800eecc332e7db8cad432573c00572"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTYxMjE1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409561215", "createdAt": "2020-05-11T21:58:46Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzQ2Nzg2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409746786", "createdAt": "2020-05-12T06:54:02Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1NDowMlrOGT4eqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1NDowMlrOGT4eqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMTQ4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +\n          \n          \n            \n                @Description(\"The fallback username claim to be used for the user id if the claim specified by `userNameClaim` is not present. \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423501482", "createdAt": "2020-05-12T06:54:02Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +157,28 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzQ3MjIy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409747222", "createdAt": "2020-05-12T06:54:50Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1NDo1MVrOGT4gJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1NDo1MVrOGT4gJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMTg2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"Useful when `client_credentials` authentication only results in client id being provided in another claim. \" +\n          \n          \n            \n                        \"Useful when `client_credentials` authentication only results in the client id being provided in another claim. \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423501860", "createdAt": "2020-05-12T06:54:51Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +157,28 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in client id being provided in another claim. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzQ5MDk1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409749095", "createdAt": "2020-05-12T06:57:56Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1Nzo1NlrOGT4mLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1Nzo1NlrOGT4mLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMzQwNQ==", "bodyText": "Not sure of the possible outcomes here: 'only results in the client if being provided in another claim'", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423503405", "createdAt": "2020-05-12T06:57:56Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +157,28 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in client id being provided in another claim. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc0NzEw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409774710", "createdAt": "2020-05-12T07:37:06Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozNzowNlrOGT52Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozNzowNlrOGT52Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyMzkyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"Useful to be able to map usernames and client ids into the same user id space, preventing name collisions.\")\n          \n          \n            \n                        \"Mapping usernames and client ids into the same user id space is useful in preventing name collisions.\")", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423523927", "createdAt": "2020-05-12T07:37:06Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +157,28 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in client id being provided in another claim. \" +\n+            \"It only takes effect if `userNameClaim` is set.\")\n+    public String getFallbackUserNameClaim() {\n+        return fallbackUserNameClaim;\n+    }\n+\n+    public void setFallbackUserNameClaim(String fallbackUserNameClaim) {\n+        this.fallbackUserNameClaim = fallbackUserNameClaim;\n+    }\n+\n+    @Description(\"The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. \" +\n+            \"It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. \" +\n+            \"Useful to be able to map usernames and client ids into the same user id space, preventing name collisions.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc1MjE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409775218", "createdAt": "2020-05-12T07:37:50Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozNzo1MFrOGT53wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozNzo1MFrOGT53wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNDI4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Description(\"Configure whether the access token type check should be performed or not. This should be set to `false` \" +\n          \n          \n            \n                @Description(\"Configure whether the access token type check is performed or not. This should be set to `false` \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423524288", "createdAt": "2020-05-12T07:37:50Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +157,28 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in client id being provided in another claim. \" +\n+            \"It only takes effect if `userNameClaim` is set.\")\n+    public String getFallbackUserNameClaim() {\n+        return fallbackUserNameClaim;\n+    }\n+\n+    public void setFallbackUserNameClaim(String fallbackUserNameClaim) {\n+        this.fallbackUserNameClaim = fallbackUserNameClaim;\n+    }\n+\n+    @Description(\"The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. \" +\n+            \"It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. \" +\n+            \"Useful to be able to map usernames and client ids into the same user id space, preventing name collisions.\")\n+    public String getFallbackUserNamePrefix() {\n+        return fallbackUserNamePrefix;\n+    }\n+\n+    public void setFallbackUserNamePrefix(String fallbackUserNamePrefix) {\n+        this.fallbackUserNamePrefix = fallbackUserNamePrefix;\n+    }\n+\n     @Description(\"Configure whether the access token type check should be performed or not. This should be set to `false` \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc1NjM4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409775638", "createdAt": "2020-05-12T07:38:22Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozODoyMlrOGT547g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozODoyMlrOGT547g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNDU5MA==", "bodyText": "Set to 'false' in any situation?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423524590", "createdAt": "2020-05-12T07:38:22Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,6 +157,28 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n+    @Description(\"The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in client id being provided in another claim. \" +\n+            \"It only takes effect if `userNameClaim` is set.\")\n+    public String getFallbackUserNameClaim() {\n+        return fallbackUserNameClaim;\n+    }\n+\n+    public void setFallbackUserNameClaim(String fallbackUserNameClaim) {\n+        this.fallbackUserNameClaim = fallbackUserNameClaim;\n+    }\n+\n+    @Description(\"The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. \" +\n+            \"It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. \" +\n+            \"Useful to be able to map usernames and client ids into the same user id space, preventing name collisions.\")\n+    public String getFallbackUserNamePrefix() {\n+        return fallbackUserNamePrefix;\n+    }\n+\n+    public void setFallbackUserNamePrefix(String fallbackUserNamePrefix) {\n+        this.fallbackUserNamePrefix = fallbackUserNamePrefix;\n+    }\n+\n     @Description(\"Configure whether the access token type check should be performed or not. This should be set to `false` \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc2NDY3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409776467", "createdAt": "2020-05-12T07:39:37Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozOTozN1rOGT57Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozOTozN1rOGT57Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNTIyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Description(\"Valid value for `token_type` attribute returned by Introspection Endpoint. No default value, and not checked by default.\")\n          \n          \n            \n                @Description(\"Valid value for the `token_type` attribute returned by the Introspection Endpoint. No default value, and not checked by default.\")", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423525222", "createdAt": "2020-05-12T07:39:37Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -152,6 +190,16 @@ public void setCheckAccessTokenType(boolean checkAccessTokenType) {\n         this.checkAccessTokenType = checkAccessTokenType;\n     }\n \n+    @Description(\"Valid value for `token_type` attribute returned by Introspection Endpoint. No default value, and not checked by default.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc3Mjcy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409777272", "createdAt": "2020-05-12T07:40:42Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MDo0MlrOGT59-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MDo0MlrOGT59-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNTg4MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Description(\"Configure whether the access token should be treated as JWT. This should be set to `false` if \" +\n          \n          \n            \n                @Description(\"Configure whether the access token is treated as JWT. This must be set to `false` if \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423525880", "createdAt": "2020-05-12T07:40:42Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -152,6 +190,16 @@ public void setCheckAccessTokenType(boolean checkAccessTokenType) {\n         this.checkAccessTokenType = checkAccessTokenType;\n     }\n \n+    @Description(\"Valid value for `token_type` attribute returned by Introspection Endpoint. No default value, and not checked by default.\")\n+    @JsonInclude(JsonInclude.Include.NON_DEFAULT)\n+    public String getValidTokenType() {\n+        return validTokenType;\n+    }\n+\n+    public void setValidTokenType(String validTokenType) {\n+        this.validTokenType = validTokenType;\n+    }\n+\n     @Description(\"Configure whether the access token should be treated as JWT. This should be set to `false` if \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc3NjA2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409777606", "createdAt": "2020-05-12T07:41:09Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MTowOVrOGT5-_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MTowOVrOGT5-_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNjE0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Description(\"URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint \" +\n          \n          \n            \n                @Description(\"URI of the User Info Endpoint to use as a fallback to obtaining the user id when the Introspection Endpoint \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423526143", "createdAt": "2020-05-12T07:41:09Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -194,4 +242,15 @@ public boolean isEnableECDSA() {\n     public void setEnableECDSA(boolean enableECDSA) {\n         this.enableECDSA = enableECDSA;\n     }\n+\n+    @Description(\"URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc3ODMx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409777831", "createdAt": "2020-05-12T07:41:27Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MToyN1rOGT5_sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MToyN1rOGT5_sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNjMyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"does not return information that could be used for user id. \")\n          \n          \n            \n                        \"does not return information that can be used for the user id. \")", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423526320", "createdAt": "2020-05-12T07:41:27Z", "author": {"login": "PaulRMellor"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -194,4 +242,15 @@ public boolean isEnableECDSA() {\n     public void setEnableECDSA(boolean enableECDSA) {\n         this.enableECDSA = enableECDSA;\n     }\n+\n+    @Description(\"URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint \" +\n+            \"does not return information that could be used for user id. \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 99}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc4ODgx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409778881", "createdAt": "2020-05-12T07:42:56Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0Mjo1NlrOGT6C4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0Mjo1NlrOGT6C4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNzEzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new InvalidResourceException(listener + \": User Info Endpoint URI can only be used if Introspection Endpoint URI is also configured\");\n          \n          \n            \n                        throw new InvalidResourceException(listener + \": User Info Endpoint URI can only be used if the Introspection Endpoint URI is also configured\");", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423527137", "createdAt": "2020-05-12T07:42:56Z", "author": {"login": "PaulRMellor"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java", "diffHunk": "@@ -1864,16 +1864,21 @@ private static void validateOauth(KafkaListenerAuthenticationOAuth oAuth, String\n             throw new InvalidResourceException(listener + \": Introspection endpoint URI or JWKS endpoint URI has to be specified\");\n         }\n \n-        if (oAuth.getValidIssuerUri() == null) {\n-            log.error(\"{}: Valid Issuer URI has to be specified\", listener);\n-            throw new InvalidResourceException(listener + \": Valid Issuer URI has to be specified\");\n+        if (oAuth.getValidIssuerUri() == null && oAuth.isCheckIssuer()) {\n+            log.error(\"{}: Valid Issuer URI has to be specified or 'checkIssuer' set to false\", listener);\n+            throw new InvalidResourceException(listener + \": Valid Issuer URI has to be specified or 'checkIssuer' set to false\");\n         }\n \n         if (oAuth.getIntrospectionEndpointUri() != null && (oAuth.getClientId() == null || oAuth.getClientSecret() == null)) {\n             log.error(\"{}: Introspection Endpoint URI needs to be configured together with clientId and clientSecret\", listener);\n             throw new InvalidResourceException(listener + \": Introspection Endpoint URI needs to be configured together with clientId and clientSecret\");\n         }\n \n+        if (oAuth.getUserInfoEndpointUri() != null && oAuth.getIntrospectionEndpointUri() == null) {\n+            log.error(\"{}: User Info Endpoint URI can only be used if Introspection Endpoint URI is also configured\", listener);\n+            throw new InvalidResourceException(listener + \": User Info Endpoint URI can only be used if Introspection Endpoint URI is also configured\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzgwMDU4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409780058", "createdAt": "2020-05-12T07:44:40Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NDo0MFrOGT6GoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NDo0MFrOGT6GoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyODA5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |checkAccessTokenType            1.2+<.<|Configure whether the access token type check should be performed or not. This should be set to `false` if the authorization server does not include 'typ' claim in JWT token. Defaults to `true`.\n          \n          \n            \n            |checkAccessTokenType            1.2+<.<|Configure whether the access token type check is performed or not. This must be set to `false` if the authorization server does not include 'typ' claim in JWT token. Defaults to `true`.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423528097", "createdAt": "2020-05-12T07:44:40Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -257,6 +257,8 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |boolean\n |checkAccessTokenType            1.2+<.<|Configure whether the access token type check should be performed or not. This should be set to `false` if the authorization server does not include 'typ' claim in JWT token. Defaults to `true`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzgwNTEz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409780513", "createdAt": "2020-05-12T07:45:14Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NToxNFrOGT6IIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NToxNFrOGT6IIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyODQ4MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |checkIssuer                     1.2+<.<|Enable or disable issuer checking. By default issuer is checked using the value configured by `validIssuerUri`. Default value is `true`.\n          \n          \n            \n            |checkIssuer                     1.2+<.<|Enable or disable issuer checking. By default, the issuer is checked using the value configured for `validIssuerUri`. Default value is `true`.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423528480", "createdAt": "2020-05-12T07:45:14Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -257,6 +257,8 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |boolean\n |checkAccessTokenType            1.2+<.<|Configure whether the access token type check should be performed or not. This should be set to `false` if the authorization server does not include 'typ' claim in JWT token. Defaults to `true`.\n |boolean\n+|checkIssuer                     1.2+<.<|Enable or disable issuer checking. By default issuer is checked using the value configured by `validIssuerUri`. Default value is `true`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzgxMDkz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409781093", "createdAt": "2020-05-12T07:46:03Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NjowNFrOGT6J8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NjowNFrOGT6J8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyODk0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |fallbackUserNameClaim           1.2+<.<|The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. Useful when `client_credentials` authentication only results in client id being provided in another claim. It only takes effect if `userNameClaim` is set.\n          \n          \n            \n            |fallbackUserNameClaim           1.2+<.<|The fallback username claim used for the user id if the claim specified by `userNameClaim` is not present. Useful when `client_credentials` authentication only results in a client id being provided in another claim. It only takes effect if `userNameClaim` is set.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423528947", "createdAt": "2020-05-12T07:46:04Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -265,6 +267,10 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |boolean\n |enableECDSA                     1.2+<.<|Enable or disable ECDSA support by installing BouncyCastle crypto provider. Default value is `false`.\n |boolean\n+|fallbackUserNameClaim           1.2+<.<|The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. Useful when `client_credentials` authentication only results in client id being provided in another claim. It only takes effect if `userNameClaim` is set.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzgyNjk1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409782695", "createdAt": "2020-05-12T07:48:19Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0ODoxOVrOGT6O_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0ODoxOVrOGT6O_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzMDIzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |fallbackUserNamePrefix          1.2+<.<|The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. Useful to be able to map usernames and client ids into the same user id space, preventing name collisions.\n          \n          \n            \n            |fallbackUserNamePrefix          1.2+<.<|The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. Mapping usernames and client ids into the same user id space is useful in preventing name collisions.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423530237", "createdAt": "2020-05-12T07:48:19Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -265,6 +267,10 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |boolean\n |enableECDSA                     1.2+<.<|Enable or disable ECDSA support by installing BouncyCastle crypto provider. Default value is `false`.\n |boolean\n+|fallbackUserNameClaim           1.2+<.<|The fallback username claim to be used for user id if the claim specified by `userNameClaim` is not present. Useful when `client_credentials` authentication only results in client id being provided in another claim. It only takes effect if `userNameClaim` is set.\n+|string\n+|fallbackUserNamePrefix          1.2+<.<|The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. Useful to be able to map usernames and client ids into the same user id space, preventing name collisions.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzg4MTk5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409788199", "createdAt": "2020-05-12T07:55:39Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo1NTo0MFrOGT6gVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo1NTo0MFrOGT6gVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzNDY3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |userInfoEndpointUri             1.2+<.<|URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint does not return information that could be used for user id. \n          \n          \n            \n            |userInfoEndpointUri             1.2+<.<|URI of the User Info Endpoint to use as a fallback when obtaining a user id and the Introspection Endpoint has not returned information that can be used.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423534679", "createdAt": "2020-05-12T07:55:40Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -277,10 +283,14 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |xref:type-CertSecretSource-{context}[`CertSecretSource`] array\n |type                            1.2+<.<|Must be `oauth`.\n |string\n-|userNameClaim                   1.2+<.<|Name of the claim from the authentication token which will be used as the user principal. Defaults to `sub`.\n+|userInfoEndpointUri             1.2+<.<|URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint does not return information that could be used for user id. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzkwNTk1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409790595", "createdAt": "2020-05-12T07:58:41Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo1ODo0MVrOGT6n6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo1ODo0MVrOGT6n6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzNjYxNg==", "bodyText": "'User Info Endpoint'  -- In terms of consistency, we haven't been capitalising endpoint names in the doc. Maybe we could express as: 'userinfo endpoint'  or 'user info endpoint' instead. Same comment applies throughout the descriptions.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423536616", "createdAt": "2020-05-12T07:58:41Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -277,10 +283,14 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |xref:type-CertSecretSource-{context}[`CertSecretSource`] array\n |type                            1.2+<.<|Must be `oauth`.\n |string\n-|userNameClaim                   1.2+<.<|Name of the claim from the authentication token which will be used as the user principal. Defaults to `sub`.\n+|userInfoEndpointUri             1.2+<.<|URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint does not return information that could be used for user id. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzkyMTI1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409792125", "createdAt": "2020-05-12T08:00:37Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowMDozN1rOGT6sdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowMDozN1rOGT6sdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzNzc4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |userNameClaim                   1.2+<.<|Name of the claim from the JWT authentication token, Introspection Endpoint response or User Info Endpoint response which will be used to extract the user id. Defaults to `sub`.\n          \n          \n            \n            |userNameClaim                   1.2+<.<|Name of the claim from the JWT authentication token, Introspection Endpoint response or User Info Endpoint response used to extract the user id. Defaults to `sub`.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423537782", "createdAt": "2020-05-12T08:00:37Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -277,10 +283,14 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |xref:type-CertSecretSource-{context}[`CertSecretSource`] array\n |type                            1.2+<.<|Must be `oauth`.\n |string\n-|userNameClaim                   1.2+<.<|Name of the claim from the authentication token which will be used as the user principal. Defaults to `sub`.\n+|userInfoEndpointUri             1.2+<.<|URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint does not return information that could be used for user id. \n+|string\n+|userNameClaim                   1.2+<.<|Name of the claim from the JWT authentication token, Introspection Endpoint response or User Info Endpoint response which will be used to extract the user id. Defaults to `sub`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzk0MjY5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409794269", "createdAt": "2020-05-12T08:03:31Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowMzozMVrOGT6y0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowMzozMVrOGT6y0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzOTQxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |validTokenType                  1.2+<.<|Valid value for `token_type` attribute returned by Introspection Endpoint. No default value, and not checked by default.\n          \n          \n            \n            |validTokenType                  1.2+<.<|Valid value for the `token_type` attribute returned by the Introspection Endpoint. No default value, and not checked by default.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423539410", "createdAt": "2020-05-12T08:03:31Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -277,10 +283,14 @@ It must have the value `oauth` for the type `KafkaListenerAuthenticationOAuth`.\n |xref:type-CertSecretSource-{context}[`CertSecretSource`] array\n |type                            1.2+<.<|Must be `oauth`.\n |string\n-|userNameClaim                   1.2+<.<|Name of the claim from the authentication token which will be used as the user principal. Defaults to `sub`.\n+|userInfoEndpointUri             1.2+<.<|URI of the User Info Endpoint to use as a fallback to obtaining user id when Introspection Endpoint does not return information that could be used for user id. \n+|string\n+|userNameClaim                   1.2+<.<|Name of the claim from the JWT authentication token, Introspection Endpoint response or User Info Endpoint response which will be used to extract the user id. Defaults to `sub`.\n |string\n |validIssuerUri                  1.2+<.<|URI of the token issuer used for authentication.\n |string\n+|validTokenType                  1.2+<.<|Valid value for `token_type` attribute returned by Introspection Endpoint. No default value, and not checked by default.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODAwMjIx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409800221", "createdAt": "2020-05-12T08:11:14Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODoxMToxNFrOGT7FCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODoxMToxNFrOGT7FCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0NDA3NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <1> Some authorization servers may not provide `iss` claim making it impossible to perform an issuer check. In that case do not specify `validIssuerUri` and set `checkIssuer` to `false`. Default is `true`.\n          \n          \n            \n            <1> If your authorization server does not provide an `iss` claim, it is not possible to perform an issuer check. In this situation, set `checkIssuer` to `false` and do not specify a `validIssuerUri`. Default is `true`.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423544074", "createdAt": "2020-05-12T08:11:14Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -88,11 +88,33 @@ external:\n     clientSecret: <3>\n       secretName: my-cluster-oauth\n       key: clientSecret\n+    userNameClaim: preferred_username <4>\n ----\n --\n <1> URI of the token introspection endpoint.\n <2> Client ID to identify the client.\n <3> Client Secret and client ID is used for authentication.\n+<4> The token claim (or key) that contains the actual user name in the token. The user name is the _principal_ used to identify the user. The `userNameClaim` value will depend on the authorization server used.\n++\n+Depending on how you apply {oauth} authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:\n++\n+[source,yaml,subs=\"+quotes,attributes\"]\n+----\n+  # ...\n+  authentication:\n+    type: oauth\n+    # ...\n+    checkIssuer: false <1>\n+    fallbackUserNameClaim: client_id <2>\n+    fallbackUserNamePrefix: client-account- <3>\n+    validTokenType: bearer <4>\n+    userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__> <5>\n+----\n+<1> Some authorization servers may not provide `iss` claim making it impossible to perform an issuer check. In that case do not specify `validIssuerUri` and set `checkIssuer` to `false`. Default is `true`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODIxMTY5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409821169", "createdAt": "2020-05-12T08:37:11Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODozNzoxMVrOGT8F3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODozNzoxMVrOGT8F3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2MDY2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <2> Some authorization servers may not provide a single attribute that can be used to identify both regular users, and clients. If client authenticates in its own name `client_id` may be provided, but if user is authenticated using username and password to obtain a refresh token or an access token, some `username` attribute may be provided in addition to `client_id`. This config option specifies the claim (attribute) to use id primary user id attribute is not available.\n          \n          \n            \n            <2> An authorization server may not provide a single attribute to identify both regular users and clients. A client authenticating in its own name might provide a `client_id`. But a user authenticating using a username and password, to obtain a refresh token or an access token, might provide a `username` attribute in addition to a `client_id`. Use this fallback option to specify the username claim (attribute) to use if a primary user id attribute is not available.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423560668", "createdAt": "2020-05-12T08:37:11Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -88,11 +88,33 @@ external:\n     clientSecret: <3>\n       secretName: my-cluster-oauth\n       key: clientSecret\n+    userNameClaim: preferred_username <4>\n ----\n --\n <1> URI of the token introspection endpoint.\n <2> Client ID to identify the client.\n <3> Client Secret and client ID is used for authentication.\n+<4> The token claim (or key) that contains the actual user name in the token. The user name is the _principal_ used to identify the user. The `userNameClaim` value will depend on the authorization server used.\n++\n+Depending on how you apply {oauth} authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:\n++\n+[source,yaml,subs=\"+quotes,attributes\"]\n+----\n+  # ...\n+  authentication:\n+    type: oauth\n+    # ...\n+    checkIssuer: false <1>\n+    fallbackUserNameClaim: client_id <2>\n+    fallbackUserNamePrefix: client-account- <3>\n+    validTokenType: bearer <4>\n+    userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__> <5>\n+----\n+<1> Some authorization servers may not provide `iss` claim making it impossible to perform an issuer check. In that case do not specify `validIssuerUri` and set `checkIssuer` to `false`. Default is `true`.\n+<2> Some authorization servers may not provide a single attribute that can be used to identify both regular users, and clients. If client authenticates in its own name `client_id` may be provided, but if user is authenticated using username and password to obtain a refresh token or an access token, some `username` attribute may be provided in addition to `client_id`. This config option specifies the claim (attribute) to use id primary user id attribute is not available.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODIzOTM4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409823938", "createdAt": "2020-05-12T08:40:35Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo0MDozNVrOGT8O0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo0MDozNVrOGT8O0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2Mjk2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <3> In situations where `fallbackUserNameClaim` is applicable it may also be necessary to prevent name collisions between the values of username claim, and those of fallback username claim. Consider a situaction where a client called `producer` exists, but also a regular user called `producer` exists. We must be able to differenciate between the two, which we do by prefixing the user id for client.\n          \n          \n            \n            <3> In situations where `fallbackUserNameClaim` is applicable, it may also be necessary to prevent name collisions between the values of the username claim, and those of the fallback username claim. Consider a situation where a client called `producer` exists, but also a regular user called `producer` exists. In order to differentiate between the two, you can use this property to add a prefix to the user id of the client.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423562961", "createdAt": "2020-05-12T08:40:35Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -88,11 +88,33 @@ external:\n     clientSecret: <3>\n       secretName: my-cluster-oauth\n       key: clientSecret\n+    userNameClaim: preferred_username <4>\n ----\n --\n <1> URI of the token introspection endpoint.\n <2> Client ID to identify the client.\n <3> Client Secret and client ID is used for authentication.\n+<4> The token claim (or key) that contains the actual user name in the token. The user name is the _principal_ used to identify the user. The `userNameClaim` value will depend on the authorization server used.\n++\n+Depending on how you apply {oauth} authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:\n++\n+[source,yaml,subs=\"+quotes,attributes\"]\n+----\n+  # ...\n+  authentication:\n+    type: oauth\n+    # ...\n+    checkIssuer: false <1>\n+    fallbackUserNameClaim: client_id <2>\n+    fallbackUserNamePrefix: client-account- <3>\n+    validTokenType: bearer <4>\n+    userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__> <5>\n+----\n+<1> Some authorization servers may not provide `iss` claim making it impossible to perform an issuer check. In that case do not specify `validIssuerUri` and set `checkIssuer` to `false`. Default is `true`.\n+<2> Some authorization servers may not provide a single attribute that can be used to identify both regular users, and clients. If client authenticates in its own name `client_id` may be provided, but if user is authenticated using username and password to obtain a refresh token or an access token, some `username` attribute may be provided in addition to `client_id`. This config option specifies the claim (attribute) to use id primary user id attribute is not available.\n+<3> In situations where `fallbackUserNameClaim` is applicable it may also be necessary to prevent name collisions between the values of username claim, and those of fallback username claim. Consider a situaction where a client called `producer` exists, but also a regular user called `producer` exists. We must be able to differenciate between the two, which we do by prefixing the user id for client.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODI3MDQ5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409827049", "createdAt": "2020-05-12T08:44:28Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo0NDoyOFrOGT8YaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo0NDoyOFrOGT8YaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2NTQxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <4> (Only applicable when using `introspectionEndpointUri`) Depending on your authorization server, the Introspection Endpoint may or may not return `token_type` attribute. Also, it may contain different values. If this configuration setting is specified the Introspection Endpoint response has to contain the `token_type` attribute having the specified value.\n          \n          \n            \n            <4> (Only applicable when using `introspectionEndpointUri`) Depending on the authorization server you are using, the Introspection Endpoint may or may not return the `token_type` attribute., or it may contain different values. You can specify a valid token type value that the response from the Introspection Endpoint has to contain.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423565416", "createdAt": "2020-05-12T08:44:28Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -88,11 +88,33 @@ external:\n     clientSecret: <3>\n       secretName: my-cluster-oauth\n       key: clientSecret\n+    userNameClaim: preferred_username <4>\n ----\n --\n <1> URI of the token introspection endpoint.\n <2> Client ID to identify the client.\n <3> Client Secret and client ID is used for authentication.\n+<4> The token claim (or key) that contains the actual user name in the token. The user name is the _principal_ used to identify the user. The `userNameClaim` value will depend on the authorization server used.\n++\n+Depending on how you apply {oauth} authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:\n++\n+[source,yaml,subs=\"+quotes,attributes\"]\n+----\n+  # ...\n+  authentication:\n+    type: oauth\n+    # ...\n+    checkIssuer: false <1>\n+    fallbackUserNameClaim: client_id <2>\n+    fallbackUserNamePrefix: client-account- <3>\n+    validTokenType: bearer <4>\n+    userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__> <5>\n+----\n+<1> Some authorization servers may not provide `iss` claim making it impossible to perform an issuer check. In that case do not specify `validIssuerUri` and set `checkIssuer` to `false`. Default is `true`.\n+<2> Some authorization servers may not provide a single attribute that can be used to identify both regular users, and clients. If client authenticates in its own name `client_id` may be provided, but if user is authenticated using username and password to obtain a refresh token or an access token, some `username` attribute may be provided in addition to `client_id`. This config option specifies the claim (attribute) to use id primary user id attribute is not available.\n+<3> In situations where `fallbackUserNameClaim` is applicable it may also be necessary to prevent name collisions between the values of username claim, and those of fallback username claim. Consider a situaction where a client called `producer` exists, but also a regular user called `producer` exists. We must be able to differenciate between the two, which we do by prefixing the user id for client.\n+<4> (Only applicable when using `introspectionEndpointUri`) Depending on your authorization server, the Introspection Endpoint may or may not return `token_type` attribute. Also, it may contain different values. If this configuration setting is specified the Introspection Endpoint response has to contain the `token_type` attribute having the specified value.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODI4MTk3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409828197", "createdAt": "2020-05-12T08:45:52Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo0NTo1MlrOGT8cLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo0NTo1MlrOGT8cLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2NjM4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <5> (Only applicable when using `introspectionEndpointUri`) The authorization server may be configured or implemented in such a way to not provide any identifiable information in Introspection Endpoint response. In order to obtain the user id you can configure the User Info Endpoint Uri as a fallback. The `userNameClaim`, `fallbackUserNameClaim`, and `fallbackUserNamePrefix` settings would the be applied to the response of User Info Endpoint.\n          \n          \n            \n            <5> (Only applicable when using `introspectionEndpointUri`) The authorization server may be configured or implemented in such a way to not provide any identifiable information in an Introspection Endpoint response. In order to obtain the user id, you can configure the URI of the User Info Endpoint as a fallback. The `userNameClaim`, `fallbackUserNameClaim`, and `fallbackUserNamePrefix` settings are applied to the response of User Info Endpoint.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423566382", "createdAt": "2020-05-12T08:45:52Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -88,11 +88,33 @@ external:\n     clientSecret: <3>\n       secretName: my-cluster-oauth\n       key: clientSecret\n+    userNameClaim: preferred_username <4>\n ----\n --\n <1> URI of the token introspection endpoint.\n <2> Client ID to identify the client.\n <3> Client Secret and client ID is used for authentication.\n+<4> The token claim (or key) that contains the actual user name in the token. The user name is the _principal_ used to identify the user. The `userNameClaim` value will depend on the authorization server used.\n++\n+Depending on how you apply {oauth} authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:\n++\n+[source,yaml,subs=\"+quotes,attributes\"]\n+----\n+  # ...\n+  authentication:\n+    type: oauth\n+    # ...\n+    checkIssuer: false <1>\n+    fallbackUserNameClaim: client_id <2>\n+    fallbackUserNamePrefix: client-account- <3>\n+    validTokenType: bearer <4>\n+    userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__> <5>\n+----\n+<1> Some authorization servers may not provide `iss` claim making it impossible to perform an issuer check. In that case do not specify `validIssuerUri` and set `checkIssuer` to `false`. Default is `true`.\n+<2> Some authorization servers may not provide a single attribute that can be used to identify both regular users, and clients. If client authenticates in its own name `client_id` may be provided, but if user is authenticated using username and password to obtain a refresh token or an access token, some `username` attribute may be provided in addition to `client_id`. This config option specifies the claim (attribute) to use id primary user id attribute is not available.\n+<3> In situations where `fallbackUserNameClaim` is applicable it may also be necessary to prevent name collisions between the values of username claim, and those of fallback username claim. Consider a situaction where a client called `producer` exists, but also a regular user called `producer` exists. We must be able to differenciate between the two, which we do by prefixing the user id for client.\n+<4> (Only applicable when using `introspectionEndpointUri`) Depending on your authorization server, the Introspection Endpoint may or may not return `token_type` attribute. Also, it may contain different values. If this configuration setting is specified the Introspection Endpoint response has to contain the `token_type` attribute having the specified value.\n+<5> (Only applicable when using `introspectionEndpointUri`) The authorization server may be configured or implemented in such a way to not provide any identifiable information in Introspection Endpoint response. In order to obtain the user id you can configure the User Info Endpoint Uri as a fallback. The `userNameClaim`, `fallbackUserNameClaim`, and `fallbackUserNamePrefix` settings would the be applied to the response of User Info Endpoint.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODMyMTgw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409832180", "createdAt": "2020-05-12T08:50:33Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1MDozNFrOGT8pZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1MDozNFrOGT8pZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2OTc2Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <4> If the authorization server requires the client to specify the `scope` when requesting the token from the token endpoint, you can provide it - in this case it is 'any'.\n          \n          \n            \n            <4> If the authorization server requires the client to specify the `scope` when requesting the token from the token endpoint, you can provide it - in this case it is `any`.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423569767", "createdAt": "2020-05-12T08:50:34Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-kafka-config.adoc", "diffHunk": "@@ -95,10 +95,12 @@ spec:\n     disableTlsHostnameVerification: true <1>\n     checkAccessTokenType: false <2>\n     accessTokenIsJwt: false <3>\n+    scope: any <4>\n ----\n <1> (Optional) Disable TLS hostname verification. Default is `false`.\n <2> If the authorization server does not return a `typ` (type) claim inside the JWT token, you can apply `checkAccessTokenType: false` to skip the token type check. Default is `true`.\n <3> If you are using opaque tokens, you can apply `accessTokenIsJwt: false` so that access tokens are not treated as JWT tokens.\n+<4> If the authorization server requires the client to specify the `scope` when requesting the token from the token endpoint, you can provide it - in this case it is 'any'.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODMzMDAw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409833000", "createdAt": "2020-05-12T08:51:34Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1MTozNFrOGT8r8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1MTozNFrOGT8r8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MDQxNw==", "bodyText": "Can we use any with any authorization server that requires a scope? Or is any the default for authorizationservers that don't need a specific value?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423570417", "createdAt": "2020-05-12T08:51:34Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/oauth/proc-oauth-kafka-config.adoc", "diffHunk": "@@ -95,10 +95,12 @@ spec:\n     disableTlsHostnameVerification: true <1>\n     checkAccessTokenType: false <2>\n     accessTokenIsJwt: false <3>\n+    scope: any <4>\n ----\n <1> (Optional) Disable TLS hostname verification. Default is `false`.\n <2> If the authorization server does not return a `typ` (type) claim inside the JWT token, you can apply `checkAccessTokenType: false` to skip the token type check. Default is `true`.\n <3> If you are using opaque tokens, you can apply `accessTokenIsJwt: false` so that access tokens are not treated as JWT tokens.\n+<4> If the authorization server requires the client to specify the `scope` when requesting the token from the token endpoint, you can provide it - in this case it is 'any'.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM0NTMx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409834531", "createdAt": "2020-05-12T08:53:22Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1MzoyMlrOGT8wow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1MzoyMlrOGT8wow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MTYxOQ==", "bodyText": "Don't need to wrap in quotes", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423571619", "createdAt": "2020-05-12T08:53:22Z", "author": {"login": "PaulRMellor"}, "path": "helm-charts/strimzi-kafka-operator/templates/040-Crd-kafka.yaml", "diffHunk": "@@ -279,14 +300,26 @@ spec:\n                                 uses SASL SCRAM-SHA-512 Authentication. `tls` type\n                                 uses TLS Client Authentication. `tls` type is supported\n                                 only on TLS listeners.\n+                            userInfoEndpointUri:\n+                              type: string\n+                              description: 'URI of the User Info Endpoint to use as", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM1MDc4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409835078", "createdAt": "2020-05-12T08:54:02Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NDowMlrOGT8yUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NDowMlrOGT8yUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MjA0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            used for user id. '\n          \n          \n            \n                                            used for user id.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423572049", "createdAt": "2020-05-12T08:54:02Z", "author": {"login": "PaulRMellor"}, "path": "helm-charts/strimzi-kafka-operator/templates/040-Crd-kafka.yaml", "diffHunk": "@@ -451,14 +505,26 @@ spec:\n                                 uses SASL SCRAM-SHA-512 Authentication. `tls` type\n                                 uses TLS Client Authentication. `tls` type is supported\n                                 only on TLS listeners.\n+                            userInfoEndpointUri:\n+                              type: string\n+                              description: 'URI of the User Info Endpoint to use as\n+                                a fallback to obtaining user id when Introspection\n+                                Endpoint does not return information that could be\n+                                used for user id. '", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM1NTQ4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409835548", "createdAt": "2020-05-12T08:54:35Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NDozNVrOGT8z1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NDozNVrOGT8z1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MjQzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            used for user id. '\n          \n          \n            \n                                            used for user id.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423572439", "createdAt": "2020-05-12T08:54:35Z", "author": {"login": "PaulRMellor"}, "path": "helm-charts/strimzi-kafka-operator/templates/040-Crd-kafka.yaml", "diffHunk": "@@ -647,14 +734,26 @@ spec:\n                                 uses SASL SCRAM-SHA-512 Authentication. `tls` type\n                                 uses TLS Client Authentication. `tls` type is supported\n                                 only on TLS listeners.\n+                            userInfoEndpointUri:\n+                              type: string\n+                              description: 'URI of the User Info Endpoint to use as\n+                                a fallback to obtaining user id when Introspection\n+                                Endpoint does not return information that could be\n+                                used for user id. '", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 174}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM2MzI4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409836328", "createdAt": "2020-05-12T08:55:33Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NTozNFrOGT82ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NTozNFrOGT82ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MzA5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            used for user id. '\n          \n          \n            \n                                            used for user id.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423573098", "createdAt": "2020-05-12T08:55:34Z", "author": {"login": "PaulRMellor"}, "path": "install/cluster-operator/040-Crd-kafka.yaml", "diffHunk": "@@ -274,14 +295,26 @@ spec:\n                                 uses SASL SCRAM-SHA-512 Authentication. `tls` type\n                                 uses TLS Client Authentication. `tls` type is supported\n                                 only on TLS listeners.\n+                            userInfoEndpointUri:\n+                              type: string\n+                              description: 'URI of the User Info Endpoint to use as\n+                                a fallback to obtaining user id when Introspection\n+                                Endpoint does not return information that could be\n+                                used for user id. '", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM2OTIx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409836921", "createdAt": "2020-05-12T08:56:17Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NjoxOFrOGT84Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1NjoxOFrOGT84Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3MzU5NQ==", "bodyText": "Quotes can be removed", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423573595", "createdAt": "2020-05-12T08:56:18Z", "author": {"login": "PaulRMellor"}, "path": "install/cluster-operator/040-Crd-kafka.yaml", "diffHunk": "@@ -446,14 +500,26 @@ spec:\n                                 uses SASL SCRAM-SHA-512 Authentication. `tls` type\n                                 uses TLS Client Authentication. `tls` type is supported\n                                 only on TLS listeners.\n+                            userInfoEndpointUri:\n+                              type: string\n+                              description: 'URI of the User Info Endpoint to use as", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM3NDE5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409837419", "createdAt": "2020-05-12T08:56:55Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1Njo1NVrOGT852g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODo1Njo1NVrOGT852g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU3Mzk3OA==", "bodyText": "Quotes can be removed", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r423573978", "createdAt": "2020-05-12T08:56:55Z", "author": {"login": "PaulRMellor"}, "path": "install/cluster-operator/040-Crd-kafka.yaml", "diffHunk": "@@ -642,14 +729,26 @@ spec:\n                                 uses SASL SCRAM-SHA-512 Authentication. `tls` type\n                                 uses TLS Client Authentication. `tls` type is supported\n                                 only on TLS listeners.\n+                            userInfoEndpointUri:\n+                              type: string\n+                              description: 'URI of the User Info Endpoint to use as", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "originalPosition": 171}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODM5NjMy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-409839632", "createdAt": "2020-05-12T08:59:33Z", "commit": {"oid": "30b7b8a9436242b55ac10c5fb7c0d4a9a9f399a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76600a82a4247c767f65e89d559b89a17d952885", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/76600a82a4247c767f65e89d559b89a17d952885", "committedDate": "2020-05-12T14:41:31Z", "message": "Apply suggestions from code review\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>"}, "afterCommit": {"oid": "04fe0d197f306c84e8f3abe2de79321a34bbeee6", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/04fe0d197f306c84e8f3abe2de79321a34bbeee6", "committedDate": "2020-05-12T14:44:29Z", "message": "Apply suggestions from code review\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNjczNjAx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-410673601", "createdAt": "2020-05-13T07:53:03Z", "commit": {"oid": "5f8268a5d4ee14609fbfc6dc6b8e9a85839775bd"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNzo1MzowM1rOGUlp3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwODoxNzo0OFrOGUmjUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MTYzMQ==", "bodyText": "Can you explain in the description the effect of not defining this, since there's \"no default\".", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r424241631", "createdAt": "2020-05-13T07:53:03Z", "author": {"login": "tombentley"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/authentication/KafkaClientAuthenticationOAuth.java", "diffHunk": "@@ -56,6 +57,16 @@ public void setClientId(String clientId) {\n         this.clientId = clientId;\n     }\n \n+    @Description(\"OAuth scope to use when authenticating against the authorization server. No default value.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8268a5d4ee14609fbfc6dc6b8e9a85839775bd"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MjQyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"Useful when `client_credentials` authentication only results in the client id being provided in another claim. \" +\n          \n          \n            \n                        \"This is useful when `client_credentials` authentication only results in the client id being provided in another claim. \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r424242427", "createdAt": "2020-05-13T07:54:24Z", "author": {"login": "tombentley"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,7 +157,29 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n-    @Description(\"Configure whether the access token type check should be performed or not. This should be set to `false` \" +\n+    @Description(\"The fallback username claim to be used for the user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in the client id being provided in another claim. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8268a5d4ee14609fbfc6dc6b8e9a85839775bd"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0Mjg3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. \" +\n          \n          \n            \n                        \"This only takes effect if `fallbackUserNameClaim` is true, and the value is present for the claim. \" +", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r424242876", "createdAt": "2020-05-13T07:55:10Z", "author": {"login": "tombentley"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -141,7 +157,29 @@ public void setUserNameClaim(String userNameClaim) {\n         this.userNameClaim = userNameClaim;\n     }\n \n-    @Description(\"Configure whether the access token type check should be performed or not. This should be set to `false` \" +\n+    @Description(\"The fallback username claim to be used for the user id if the claim specified by `userNameClaim` is not present. \" +\n+            \"Useful when `client_credentials` authentication only results in the client id being provided in another claim. \" +\n+            \"It only takes effect if `userNameClaim` is set.\")\n+    public String getFallbackUserNameClaim() {\n+        return fallbackUserNameClaim;\n+    }\n+\n+    public void setFallbackUserNameClaim(String fallbackUserNameClaim) {\n+        this.fallbackUserNameClaim = fallbackUserNameClaim;\n+    }\n+\n+    @Description(\"The prefix to use with the value of `fallbackUserNameClaim` to construct the user id. \" +\n+            \"It only takes effect if `fallbackUserNameClaim` is set, and the value is present for the claim. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8268a5d4ee14609fbfc6dc6b8e9a85839775bd"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI1MjA5Mw==", "bodyText": "There's no need for the @SuppressWarnings if you factor out\n    static void addOption(List<String> options, String option, String value) {\n        if (value != null) options.add(String.format(\"%s=\\\"%s\\\"\", option, value));\n    }\nWhich works for all the String-valued options. For the boolean ones, is there anything to be gained by only adding the option when the value is true/false, or would it work as well if we always added the option? If the latter then the same method should work for those too.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r424252093", "createdAt": "2020-05-13T08:10:45Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java", "diffHunk": "@@ -370,19 +370,25 @@ private String getSecurityProtocol(boolean tls, boolean sasl)   {\n      * @param oauth     OAuth type authentication object\n      * @return  Returns the builder instance\n      */\n+    @SuppressWarnings({\"checkstyle:CyclomaticComplexity\", \"checkstyle:NPathComplexity\"})\n     /*test*/ static List<String> getOAuthOptions(KafkaListenerAuthenticationOAuth oauth)  {\n         List<String> options = new ArrayList<>(5);\n \n         if (oauth.getClientId() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_CLIENT_ID, oauth.getClientId()));\n         if (oauth.getValidIssuerUri() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_VALID_ISSUER_URI, oauth.getValidIssuerUri()));\n+        if (!oauth.isCheckIssuer()) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_CHECK_ISSUER, false));\n         if (oauth.getJwksEndpointUri() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_JWKS_ENDPOINT_URI, oauth.getJwksEndpointUri()));\n         if (oauth.getJwksRefreshSeconds() != null && oauth.getJwksRefreshSeconds() > 0) options.add(String.format(\"%s=\\\"%d\\\"\", ServerConfig.OAUTH_JWKS_REFRESH_SECONDS, oauth.getJwksRefreshSeconds()));\n         if (oauth.getJwksRefreshSeconds() != null && oauth.getJwksExpirySeconds() > 0) options.add(String.format(\"%s=\\\"%d\\\"\", ServerConfig.OAUTH_JWKS_EXPIRY_SECONDS, oauth.getJwksExpirySeconds()));\n         if (oauth.isEnableECDSA()) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_CRYPTO_PROVIDER_BOUNCYCASTLE, true));\n         if (oauth.getIntrospectionEndpointUri() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_INTROSPECTION_ENDPOINT_URI, oauth.getIntrospectionEndpointUri()));\n+        if (oauth.getUserInfoEndpointUri() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_USERINFO_ENDPOINT_URI, oauth.getUserInfoEndpointUri()));\n         if (oauth.getUserNameClaim() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_USERNAME_CLAIM, oauth.getUserNameClaim()));\n+        if (oauth.getFallbackUserNameClaim() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_FALLBACK_USERNAME_CLAIM, oauth.getFallbackUserNameClaim()));\n+        if (oauth.getFallbackUserNamePrefix() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_FALLBACK_USERNAME_PREFIX, oauth.getFallbackUserNamePrefix()));\n         if (!oauth.isAccessTokenIsJwt()) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_ACCESS_TOKEN_IS_JWT, false));\n         if (!oauth.isCheckAccessTokenType()) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_CHECK_ACCESS_TOKEN_TYPE, false));\n+        if (oauth.getValidTokenType() != null) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_VALID_TOKEN_TYPE, oauth.getValidTokenType()));\n         if (oauth.isDisableTlsHostnameVerification()) options.add(String.format(\"%s=\\\"%s\\\"\", ServerConfig.OAUTH_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM, \"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8268a5d4ee14609fbfc6dc6b8e9a85839775bd"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI1NjMzOA==", "bodyText": "This does make me wonder if this flat map approach is ideal, or whether we should be expressing these dependencies between parameters structurally:\nintrospectionEndpoint:\n   uri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/token/introspect__>\n  validTokenType: bearer\n  userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__>\nThis could be done compatibly by deprecating the introspectionEndpointUri, validTokenType and userInfoEndpointUri and adding the introspectionEndpoint as their replacement. It's not worth doing in this PR, for sure, but it might be worth considering if these dependencies get more complex in the future.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#discussion_r424256338", "createdAt": "2020-05-13T08:17:48Z", "author": {"login": "tombentley"}, "path": "documentation/modules/oauth/proc-oauth-authentication-broker-config.adoc", "diffHunk": "@@ -88,11 +88,33 @@ external:\n     clientSecret: <3>\n       secretName: my-cluster-oauth\n       key: clientSecret\n+    userNameClaim: preferred_username <4>\n ----\n --\n <1> URI of the token introspection endpoint.\n <2> Client ID to identify the client.\n <3> Client Secret and client ID is used for authentication.\n+<4> The token claim (or key) that contains the actual user name in the token. The user name is the _principal_ used to identify the user. The `userNameClaim` value will depend on the authorization server used.\n++\n+Depending on how you apply {oauth} authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:\n++\n+[source,yaml,subs=\"+quotes,attributes\"]\n+----\n+  # ...\n+  authentication:\n+    type: oauth\n+    # ...\n+    checkIssuer: false <1>\n+    fallbackUserNameClaim: client_id <2>\n+    fallbackUserNamePrefix: client-account- <3>\n+    validTokenType: bearer <4>\n+    userInfoEndpointUri: <__https://<auth-server-address>/auth/realms/external/protocol/openid-connect/userinfo__> <5>\n+----\n+<1> If your authorization server does not provide an `iss` claim, it is not possible to perform an issuer check. In this situation, set `checkIssuer` to `false` and do not specify a `validIssuerUri`. Default is `true`.\n+<2> An authorization server may not provide a single attribute to identify both regular users and clients. A client authenticating in its own name might provide a `client_id`. But a user authenticating using a username and password, to obtain a refresh token or an access token, might provide a `username` attribute in addition to a `client_id`. Use this fallback option to specify the username claim (attribute) to use if a primary user id attribute is not available.\n+<3> In situations where `fallbackUserNameClaim` is applicable, it may also be necessary to prevent name collisions between the values of the username claim, and those of the fallback username claim. Consider a situation where a client called `producer` exists, but also a regular user called `producer` exists. In order to differentiate between the two, you can use this property to add a prefix to the user id of the client.\n+<4> (Only applicable when using `introspectionEndpointUri`) Depending on the authorization server you are using, the Introspection Endpoint may or may not return the `token_type` attribute., or it may contain different values. You can specify a valid token type value that the response from the Introspection Endpoint has to contain.\n+<5> (Only applicable when using `introspectionEndpointUri`) The authorization server may be configured or implemented in such a way to not provide any identifiable information in an Introspection Endpoint response. In order to obtain the user id, you can configure the URI of the User Info Endpoint as a fallback. The `userNameClaim`, `fallbackUserNameClaim`, and `fallbackUserNamePrefix` settings are applied to the response of User Info Endpoint.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8268a5d4ee14609fbfc6dc6b8e9a85839775bd"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "121c2f6407db721c6f36a90debee82b81a6731bf", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/121c2f6407db721c6f36a90debee82b81a6731bf", "committedDate": "2020-05-13T16:19:57Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "f2475722fffd8e9319188f6885d78f2d88ec6a4d", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f2475722fffd8e9319188f6885d78f2d88ec6a4d", "committedDate": "2020-05-13T18:27:03Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2475722fffd8e9319188f6885d78f2d88ec6a4d", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f2475722fffd8e9319188f6885d78f2d88ec6a4d", "committedDate": "2020-05-13T18:27:03Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "984496049653b4dc821d0a17cb9a4bc084cb0efa", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/984496049653b4dc821d0a17cb9a4bc084cb0efa", "committedDate": "2020-05-13T19:26:30Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "984496049653b4dc821d0a17cb9a4bc084cb0efa", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/984496049653b4dc821d0a17cb9a4bc084cb0efa", "committedDate": "2020-05-13T19:26:30Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "202d86113d0805fa221deb9d3a75b38905e39249", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/202d86113d0805fa221deb9d3a75b38905e39249", "committedDate": "2020-05-13T19:30:23Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTU3MzI5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2974#pullrequestreview-411557329", "createdAt": "2020-05-14T08:03:06Z", "commit": {"oid": "3908355a315f486ae4bf53fcda3413a45b2d6973"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d83571fc7638f808321de7847ecd6974e7c58de7", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d83571fc7638f808321de7847ecd6974e7c58de7", "committedDate": "2020-05-14T12:12:42Z", "message": "Add additional config options available in Strimzi Kafka OAuth 0.5.0\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06da8af82cfc075a5ba7ca1452a0725afbcd5365", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/06da8af82cfc075a5ba7ca1452a0725afbcd5365", "committedDate": "2020-05-14T12:12:48Z", "message": "Add Helm charts\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6c2db6293f73084292a7393337a884a1b0a716", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4b6c2db6293f73084292a7393337a884a1b0a716", "committedDate": "2020-05-14T12:12:48Z", "message": "Relax the oauth config constraints for some options\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1576bddda3fe3bb05d3ab6a0fb85982043e8d3bc", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1576bddda3fe3bb05d3ab6a0fb85982043e8d3bc", "committedDate": "2020-05-14T12:12:48Z", "message": "Add staging repo for strimzi-kafka-oauth 0.5.0\n\nTODO: Remove this before merging the PR\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29a7d5988c4aa9270ecc680a50ff4c6441795611", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/29a7d5988c4aa9270ecc680a50ff4c6441795611", "committedDate": "2020-05-14T12:12:48Z", "message": "Update staging repo for strimzi-kafka-oauth 0.5.0 (RC2)\n\nTODO: Remove this before merging the PR\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "981a29dbcee5b0841cc21571d696d94bd36ab74a", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/981a29dbcee5b0841cc21571d696d94bd36ab74a", "committedDate": "2020-05-14T12:12:48Z", "message": "Systemtests failures\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd5e8f1acca9aed0c7e33fdc1597c7c8664ab19f", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fd5e8f1acca9aed0c7e33fdc1597c7c8664ab19f", "committedDate": "2020-05-14T12:12:49Z", "message": "Remove scope from listener config, and improve CRD docs.\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dedcedc72213d7a5ca7eb9bd9ea50613e10c3be", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3dedcedc72213d7a5ca7eb9bd9ea50613e10c3be", "committedDate": "2020-05-14T12:12:49Z", "message": "Fix error found by spotbugs\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc6aa3526c1fb4f2a28b6b73f58c7a75ce006ac8", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bc6aa3526c1fb4f2a28b6b73f58c7a75ce006ac8", "committedDate": "2020-05-14T12:12:49Z", "message": "Some documentation\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2910a812f2eecc1abdc7f42efdaf700d1feeb08c", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2910a812f2eecc1abdc7f42efdaf700d1feeb08c", "committedDate": "2020-05-14T12:12:49Z", "message": "Remove strimzi-kafka-oauth-0.5.0 staging repo\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1adec81ad855afb4ceeb289caf719e4a5d2dcbcd", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1adec81ad855afb4ceeb289caf719e4a5d2dcbcd", "committedDate": "2020-05-14T12:12:49Z", "message": "Fix documentation\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddcc23504026eee06da9f2b1202b06866ff0e7d2", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ddcc23504026eee06da9f2b1202b06866ff0e7d2", "committedDate": "2020-05-14T12:12:49Z", "message": "Add @SuppressWarnings rather than use suppressions.xml\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "054ca8a3fea8bc9617e7bc81c96c9d947c4a4bb1", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/054ca8a3fea8bc9617e7bc81c96c9d947c4a4bb1", "committedDate": "2020-05-14T12:12:49Z", "message": "Apply suggestions from code review\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "493c367dcab5a0eb4b0e97fb986cd1fe8181b1ef", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/493c367dcab5a0eb4b0e97fb986cd1fe8181b1ef", "committedDate": "2020-05-14T12:12:49Z", "message": "Documentation fixes\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e248f68cbc29d0af52d4c5ecc362269e2a6257e", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9e248f68cbc29d0af52d4c5ecc362269e2a6257e", "committedDate": "2020-05-14T12:12:49Z", "message": "Documentation fixes\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "295df105cba60f01b7d4fa777f3487bd061460cc", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/295df105cba60f01b7d4fa777f3487bd061460cc", "committedDate": "2020-05-14T12:12:49Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Tom Bentley <tombentley@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c9038d68765f602d56e514ef9ba131eddc6601", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/99c9038d68765f602d56e514ef9ba131eddc6601", "committedDate": "2020-05-14T12:12:49Z", "message": "Documentation fixes\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b74c2591ab98f29399e7497340be31438b6d8bf", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9b74c2591ab98f29399e7497340be31438b6d8bf", "committedDate": "2020-05-14T12:12:49Z", "message": "More proper fix for NPathComplexity warning\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00b10806e988a0f43b3b215f8fd0a4a340eb8126", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/00b10806e988a0f43b3b215f8fd0a4a340eb8126", "committedDate": "2020-05-14T12:12:49Z", "message": "Fix test failures for KafkaBrokerConfigurationBuilder\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3908355a315f486ae4bf53fcda3413a45b2d6973", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3908355a315f486ae4bf53fcda3413a45b2d6973", "committedDate": "2020-05-14T07:51:44Z", "message": "Fix test failures for KafkaBrokerConfigurationBuilder\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}, "afterCommit": {"oid": "00b10806e988a0f43b3b215f8fd0a4a340eb8126", "author": {"user": {"login": "mstruk", "name": "Marko Strukelj"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/00b10806e988a0f43b3b215f8fd0a4a340eb8126", "committedDate": "2020-05-14T12:12:49Z", "message": "Fix test failures for KafkaBrokerConfigurationBuilder\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1653, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}