{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzOTY4Mzkx", "number": 3468, "title": "[MO] - [system test] -> cruise control metrics", "bodyText": "Signed-off-by: morsak xorsak02@stud.fit.vutbr.cz\nType of change\n\nEnhancement / new feature\n\nDescription\nThis PR adding the 2 tests for verification of presence metrics inside the CruiseControl component.\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-08-06T11:32:05Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468", "merged": true, "mergeCommit": {"oid": "31e7429d62efa6539b2773ec15b2bd893921b7a0"}, "closed": true, "closedAt": "2020-08-10T19:19:43Z", "author": {"login": "see-quick"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8OI05gH2gAyNDYzOTY4MzkxOjJiZjlhOTRhMzAyMTgwN2IwMWM0MzBjZmJjYjZmMjRiMTJjZDYwYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9loGagFqTQ2NDQyOTI0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2bf9a94a3021807b01c430cfbcb6f24b12cd60b0", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2bf9a94a3021807b01c430cfbcb6f24b12cd60b0", "committedDate": "2020-08-06T11:29:51Z", "message": "[MO] - [system test] -> cruise control meetrics\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNDQyNzI3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#pullrequestreview-462442727", "createdAt": "2020-08-06T11:46:39Z", "commit": {"oid": "2bf9a94a3021807b01c430cfbcb6f24b12cd60b0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMTo0NjozOVrOG8wDEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMTo0NjozOVrOG8wDEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM1NDk2Mg==", "bodyText": "Just a question -> shouldn't be this test in MetricsST? I know you already added test to this suite, but I'm curious. It can be really confusing for the first time.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#discussion_r466354962", "createdAt": "2020-08-06T11:46:39Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlApiST.java", "diffHunk": "@@ -121,15 +122,30 @@ void testUserTasks() {\n         assertThat(response, containsString(CruiseControlUserTaskStatus.COMPLETED.toString()));\n     }\n \n+    @Order(5)\n+    @Test\n+    void testMetrics() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bf9a94a3021807b01c430cfbcb6f24b12cd60b0"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNDY5NTU0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#pullrequestreview-462469554", "createdAt": "2020-08-06T12:28:02Z", "commit": {"oid": "2bf9a94a3021807b01c430cfbcb6f24b12cd60b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMjoyODowMlrOG8xTmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMjoyODowMlrOG8xTmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM3NTU3Ng==", "bodyText": "Could you put a comment above this entry and state that this is not provided by Cruise Control and instead comes from the JMX Exporter.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#discussion_r466375576", "createdAt": "2020-08-06T12:28:02Z", "author": {"login": "tomncooper"}, "path": "operator-common/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlEndpoints.java", "diffHunk": "@@ -9,7 +9,9 @@\n     STATE(\"/kafkacruisecontrol/state\"),\n     REBALANCE(\"/kafkacruisecontrol/rebalance\"),\n     STOP(\"/kafkacruisecontrol/stop_proposal_execution\"),\n-    USER_TASKS(\"/kafkacruisecontrol/user_tasks\");\n+    USER_TASKS(\"/kafkacruisecontrol/user_tasks\"),\n+\n+    METRICS(\"/metrics\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bf9a94a3021807b01c430cfbcb6f24b12cd60b0"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d410559eedecc032c4b0aac03c0505c7c982e832", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d410559eedecc032c4b0aac03c0505c7c982e832", "committedDate": "2020-08-06T12:43:03Z", "message": "[MO] - commend\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6fc362973c482b0471c05a59b109294677efa6b", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b6fc362973c482b0471c05a59b109294677efa6b", "committedDate": "2020-08-06T13:37:56Z", "message": "commends\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDUzMDUw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#pullrequestreview-464053050", "createdAt": "2020-08-10T08:49:03Z", "commit": {"oid": "b6fc362973c482b0471c05a59b109294677efa6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDY1MDc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#pullrequestreview-464065076", "createdAt": "2020-08-10T09:07:45Z", "commit": {"oid": "b6fc362973c482b0471c05a59b109294677efa6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwOTowNzo0NVrOG-Gv8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwOTowNzo0NVrOG-Gv8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc3NTQ3Mw==", "bodyText": "Might we want to assert that we pass through this more than 0 times? If the interface changes the regex will immediately not find and this test becomes a no-op if I am not mistaken.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#discussion_r467775473", "createdAt": "2020-08-10T09:07:45Z", "author": {"login": "samuel-hawker"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/metrics/MetricsST.java", "diffHunk": "@@ -329,6 +333,26 @@ void testKafkaBridgeMetrics() {\n         assertThat(values.stream().mapToDouble(i -> i).sum(), is((double) 1));\n     }\n \n+    @Test\n+    @Tag(CRUISE_CONTROL)\n+    void testCruiseControlMetrics() {\n+\n+        String cruiseControlMetrics = CruiseControlUtils.callApi(CruiseControlUtils.SupportedHttpMethods.GET, \"/metrics\");\n+\n+        Matcher regex = Pattern.compile(\"^([^#].*)\\\\s+([^\\\\s]*)$\", Pattern.MULTILINE).matcher(cruiseControlMetrics);\n+\n+        while (regex.find()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6fc362973c482b0471c05a59b109294677efa6b"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDc0OTc0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#pullrequestreview-464074974", "createdAt": "2020-08-10T09:22:51Z", "commit": {"oid": "b6fc362973c482b0471c05a59b109294677efa6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6ba6959c6525d8618263896fdb8c6fd699e0b3f", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c6ba6959c6525d8618263896fdb8c6fd699e0b3f", "committedDate": "2020-08-10T10:52:38Z", "message": "add assert\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3e4130f5e81f24070cc5276d59b5a510fde9986", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d3e4130f5e81f24070cc5276d59b5a510fde9986", "committedDate": "2020-08-10T11:54:46Z", "message": "assert changed\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDI5MjQ3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3468#pullrequestreview-464429247", "createdAt": "2020-08-10T17:25:45Z", "commit": {"oid": "d3e4130f5e81f24070cc5276d59b5a510fde9986"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1103, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}