{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMzI1Nzcz", "number": 2712, "title": "[systemtest] ConnectS2IST: fix tests", "bodyText": "Signed-off-by: Lukas Kral lkral@redhat.com\nType of change\n\nBugfix\n\nDescription\nThis PR fix some of ConnectS2IST tests:\ntestJvmAndResources - added dynamic wait for resource deletion\ntestDeployS2IWithMongoDBPlugin - remove wait for log and add wait for ready state in status\n\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-03-18T09:40:01Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712", "merged": true, "mergeCommit": {"oid": "b29bfa0e171f94c7c704b49ee064179997b18719"}, "closed": true, "closedAt": "2020-03-23T22:42:43Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPBpwyABqjMxNDM3MzM3ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQb1YkgBqjMxNTQ1OTg3MTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6979987a82e463c4938e8a9f86c14019f2f9ac18", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6979987a82e463c4938e8a9f86c14019f2f9ac18", "committedDate": "2020-03-18T09:35:46Z", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}, "afterCommit": {"oid": "31d15bb105b8f6fd303b99c37aacf9f490af583a", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/31d15bb105b8f6fd303b99c37aacf9f490af583a", "committedDate": "2020-03-19T01:30:10Z", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31d15bb105b8f6fd303b99c37aacf9f490af583a", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/31d15bb105b8f6fd303b99c37aacf9f490af583a", "committedDate": "2020-03-19T01:30:10Z", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}, "afterCommit": {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5506d55f85a8249fd942e05dfd679b69958ee050", "committedDate": "2020-03-19T10:30:31Z", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDc3NDYy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712#pullrequestreview-378077462", "createdAt": "2020-03-19T20:41:03Z", "commit": {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjYzNjE2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712#pullrequestreview-378263616", "createdAt": "2020-03-20T07:05:28Z", "commit": {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzUwODg4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712#pullrequestreview-378350888", "createdAt": "2020-03-20T09:58:30Z", "commit": {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwOTo1ODozMVrOF5NhjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwOTo1ODozMVrOF5NhjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzNDczMw==", "bodyText": "Isn't this line useless ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2712#discussion_r395534733", "createdAt": "2020-03-20T09:58:31Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -89,17 +90,19 @@ void testDeployS2IWithMongoDBPlugin() throws InterruptedException, IOException {\n \n         KafkaConnectS2IUtils.waitForConnectS2IStatus(kafkaConnectS2IName, \"Ready\");\n \n-        // Make sure that Connenct API is ready\n-        KafkaConnectS2IUtils.waitForRebalancingDone(kafkaConnectS2IName);\n-\n-        String createConnectorOutput = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"POST\", \"-H\", \"Accept:application/json\", \"-H\", \"Content-Type:application/json\",\n-                \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\", \"-d\", mongoDbConfig).out();\n-        LOGGER.info(\"Create Connector result: {}\", createConnectorOutput);\n+        TestUtils.waitFor(\"ConnectS2I will be ready and POST will be executed\", Constants.GLOBAL_POLL_INTERVAL, Constants.TIMEOUT_FOR_RESOURCE_CREATION, () -> {\n+            String createConnectorOutput = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"POST\", \"-H\", \"Accept:application/json\", \"-H\", \"Content-Type:application/json\",\n+                    \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\", \"-d\", mongoDbConfig).out();\n+            LOGGER.info(\"Create Connector result: {}\", createConnectorOutput);\n+            return !createConnectorOutput.contains(\"error_code\");\n+        });\n \n         // Make sure that connector is really created\n         Thread.sleep(10_000);\n \n         String connectorStatus = cmdKubeClient().execInPod(kafkaClientsPodName, \"curl\", \"-X\", \"GET\", \"http://\" + KafkaConnectS2IResources.serviceName(kafkaConnectS2IName) + \":8083/connectors/\" + kafkaConnectS2IName + \"/status\").out();\n+\n+        KafkaConnectS2IUtils.waitForConnectS2IStatus(kafkaConnectS2IName, \"Ready\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65cfa667df3ca6b21beb428c83b0ddb1db0fbd95", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/65cfa667df3ca6b21beb428c83b0ddb1db0fbd95", "committedDate": "2020-03-23T10:34:02Z", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81348db65c501595b7fd157d7b6bb80e92da9b70", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/81348db65c501595b7fd157d7b6bb80e92da9b70", "committedDate": "2020-03-23T10:34:02Z", "message": "fixup! ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5506d55f85a8249fd942e05dfd679b69958ee050", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5506d55f85a8249fd942e05dfd679b69958ee050", "committedDate": "2020-03-19T10:30:31Z", "message": "ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}, "afterCommit": {"oid": "81348db65c501595b7fd157d7b6bb80e92da9b70", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/81348db65c501595b7fd157d7b6bb80e92da9b70", "committedDate": "2020-03-23T10:34:02Z", "message": "fixup! ConnectS2IST: fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2074, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}