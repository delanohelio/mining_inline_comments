{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwODY5Njcw", "number": 3334, "title": "Single node kafka with CC fix", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nBugfix\n\nDescription\nWhen the single node Kafka is deployed together with Cruise Control, CC fails to start with errors in the log.\nFixes #3316\nChecklist\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-07-17T07:36:12Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334", "merged": true, "mergeCommit": {"oid": "7ec81b4a18b609343b32208e488e0628cb17dffc"}, "closed": true, "closedAt": "2020-07-17T19:54:03Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1uvl0gH2gAyNDUwODY5NjcwOjA3OWE5OGMyOWU3MzE0YWQyNDU0ZmFlOTBmMzQ0NDE0YmJmMDg3ZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc129j7gFqTQ1MDgyMTI1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "079a98c29e7314ad2454fae90f344414bbf087f4", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/079a98c29e7314ad2454fae90f344414bbf087f4", "committedDate": "2020-07-17T07:31:41Z", "message": "Single node kafka with CC fix\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNDQ2MTUw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#pullrequestreview-450446150", "createdAt": "2020-07-17T07:51:43Z", "commit": {"oid": "079a98c29e7314ad2454fae90f344414bbf087f4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNzo1MTo0M1rOGzJDqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNzo1MTo0M1rOGzJDqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3ODk1Mg==", "bodyText": "Not sure the the should be there. Maybe some native speaker can comment.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#discussion_r456278952", "createdAt": "2020-07-17T07:51:43Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java", "diffHunk": "@@ -479,6 +479,11 @@ public static KafkaCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup vers\n             addAll(metricReporterList, configuration.getConfigOption(KAFKA_METRIC_REPORTERS_CONFIG_FIELD).split(\",\"));\n         }\n \n+        if (kafkaClusterSpec.getReplicas() < 2 && kafkaSpec.getCruiseControl() != null) {\n+            throw new InvalidResourceException(\"Kafka \" +\n+                    kafkaAssembly.getMetadata().getNamespace() + \"/\" + kafkaAssembly.getMetadata().getName() +\n+                    \" has invalid configuration. Cruise Control cannot be deployed with the single node Kafka cluster.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079a98c29e7314ad2454fae90f344414bbf087f4"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be23214b761e63a389af2555c68a73ef275b6b27", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/be23214b761e63a389af2555c68a73ef275b6b27", "committedDate": "2020-07-17T08:13:13Z", "message": "English\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTE4NDEz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#pullrequestreview-450518413", "createdAt": "2020-07-17T09:40:12Z", "commit": {"oid": "be23214b761e63a389af2555c68a73ef275b6b27"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOTo0MDoxM1rOGzMgvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOTo0MDoxM1rOGzMgvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMzNTU0OQ==", "bodyText": "sorry to be picky, I would invert the conditions in the if. Logically you should check the number of replicas only if CC is deployed otherwise it's useless :-)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#discussion_r456335549", "createdAt": "2020-07-17T09:40:13Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java", "diffHunk": "@@ -479,6 +479,11 @@ public static KafkaCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup vers\n             addAll(metricReporterList, configuration.getConfigOption(KAFKA_METRIC_REPORTERS_CONFIG_FIELD).split(\",\"));\n         }\n \n+        if (kafkaClusterSpec.getReplicas() < 2 && kafkaSpec.getCruiseControl() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be23214b761e63a389af2555c68a73ef275b6b27"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2f8c03759e4b486020bb92e327b382448bef75e8", "committedDate": "2020-07-17T09:42:14Z", "message": "Paolo's comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTYzNjU1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#pullrequestreview-450563655", "createdAt": "2020-07-17T10:55:07Z", "commit": {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ee9870860d78fdbfbf69bbdd5813177cf83e676", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5ee9870860d78fdbfbf69bbdd5813177cf83e676", "committedDate": "2020-07-17T11:22:43Z", "message": "what\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}, "afterCommit": {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2f8c03759e4b486020bb92e327b382448bef75e8", "committedDate": "2020-07-17T09:42:14Z", "message": "Paolo's comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTgwNjM3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#pullrequestreview-450580637", "createdAt": "2020-07-17T11:27:46Z", "commit": {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwODIxMjUz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3334#pullrequestreview-450821253", "createdAt": "2020-07-17T17:06:11Z", "commit": {"oid": "2f8c03759e4b486020bb92e327b382448bef75e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1319, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}