{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMDgyNzM5", "number": 3170, "title": "[MO] - [system test] -> cruise control race-condition", "bodyText": "Signed-off-by: morsak xorsak02@stud.fit.vutbr.cz\nType of change\n\nBugfix\n\nDescription\nThis PR fixing the race-condition related to the cruise control. The test was failing sometimes 1 from 5 runs and now with the change it is stable.", "createdAt": "2020-06-08T12:02:31Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170", "merged": true, "mergeCommit": {"oid": "9a846c9b5e361061b5a3c1ee0ec54c8028052e45"}, "closed": true, "closedAt": "2020-06-09T07:47:54Z", "author": {"login": "see-quick"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpP6DpAFqTQyNjE5MzAzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpfVCogFqTQyNjgzMjcyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTkzMDM4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#pullrequestreview-426193038", "createdAt": "2020-06-08T12:48:58Z", "commit": {"oid": "248d91f449bf0adac870e38984ce96d18d14530d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjE2ODAx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#pullrequestreview-426216801", "createdAt": "2020-06-08T13:09:50Z", "commit": {"oid": "248d91f449bf0adac870e38984ce96d18d14530d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzowOTo1MFrOGgdDkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoxMDo1OFrOGgdIAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4MzY2Nw==", "bodyText": "typo expectedPods", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#discussion_r436683667", "createdAt": "2020-06-08T13:09:50Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kubeUtils/objects/PodUtils.java", "diffHunk": "@@ -187,17 +187,32 @@ public static void waitUntilMessageIsInLogs(String podName, String containerName\n \n     public static void waitUntilPodContainersCount(String podNamePrefix, int numberOfContainers) {\n         LOGGER.info(\"Wait until Pod {} will have {} containers\", podNamePrefix, numberOfContainers);\n-        TestUtils.waitFor(\"Pod\" + podNamePrefix + \" will have \" + numberOfContainers + \" containers\",\n+        TestUtils.waitFor(\"Pod \" + podNamePrefix + \" will have \" + numberOfContainers + \" containers\",\n             Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_STATUS_TIMEOUT,\n             () -> kubeClient().listPodsByPrefixInName(podNamePrefix).get(0).getSpec().getContainers().size() == numberOfContainers);\n         LOGGER.info(\"Pod {} has {} containers\", podNamePrefix, numberOfContainers);\n     }\n \n-    public static void waitUntilPodReplicasCount(String podNamePrefix, int exceptedPods) {\n-        LOGGER.info(\"Wait until Pod {} will have {} replicas\", podNamePrefix, exceptedPods);\n+    public static void waitUntilPodStabilityReplicasCount(String podNamePrefix, int exceptedPods) {\n+        LOGGER.info(\"Wait until Pod {} will have stable {} replicas\", podNamePrefix, exceptedPods);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "248d91f449bf0adac870e38984ce96d18d14530d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4NDgwMQ==", "bodyText": "I guess you are using this one element array because otherwise, you cannot increment the variable in the lambda. Maybe you can use an AtomicInteger? Or there is a specific reason for using the array?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#discussion_r436684801", "createdAt": "2020-06-08T13:10:58Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kubeUtils/objects/PodUtils.java", "diffHunk": "@@ -187,17 +187,32 @@ public static void waitUntilMessageIsInLogs(String podName, String containerName\n \n     public static void waitUntilPodContainersCount(String podNamePrefix, int numberOfContainers) {\n         LOGGER.info(\"Wait until Pod {} will have {} containers\", podNamePrefix, numberOfContainers);\n-        TestUtils.waitFor(\"Pod\" + podNamePrefix + \" will have \" + numberOfContainers + \" containers\",\n+        TestUtils.waitFor(\"Pod \" + podNamePrefix + \" will have \" + numberOfContainers + \" containers\",\n             Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_STATUS_TIMEOUT,\n             () -> kubeClient().listPodsByPrefixInName(podNamePrefix).get(0).getSpec().getContainers().size() == numberOfContainers);\n         LOGGER.info(\"Pod {} has {} containers\", podNamePrefix, numberOfContainers);\n     }\n \n-    public static void waitUntilPodReplicasCount(String podNamePrefix, int exceptedPods) {\n-        LOGGER.info(\"Wait until Pod {} will have {} replicas\", podNamePrefix, exceptedPods);\n+    public static void waitUntilPodStabilityReplicasCount(String podNamePrefix, int exceptedPods) {\n+        LOGGER.info(\"Wait until Pod {} will have stable {} replicas\", podNamePrefix, exceptedPods);\n+        int[] stableCounter = {0};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "248d91f449bf0adac870e38984ce96d18d14530d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Mjg0Mjc3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#pullrequestreview-426284277", "createdAt": "2020-06-08T14:12:56Z", "commit": {"oid": "5e44f0877d1629748d04ca4b0b05598424719d1a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eefe891ecb73bc15f923fb2a5954413460527c85", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eefe891ecb73bc15f923fb2a5954413460527c85", "committedDate": "2020-06-08T15:28:04Z", "message": "[MO] - [system test] -> cruise control race-condition\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79439bf92abc3dc3f3451db305d1e1e9c89d2a8", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f79439bf92abc3dc3f3451db305d1e1e9c89d2a8", "committedDate": "2020-06-08T15:28:04Z", "message": "[MO] - ipdate\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45757944dbbe87c4e053f494e7ef0290df82097a", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/45757944dbbe87c4e053f494e7ef0290df82097a", "committedDate": "2020-06-08T15:28:04Z", "message": "[MO] - update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1b0e57461712565d65e647f558217f7f0fef37", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1d1b0e57461712565d65e647f558217f7f0fef37", "committedDate": "2020-06-08T15:28:04Z", "message": "update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c31c3e2ff533686249a6002b1a2d1b854cb28e59", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c31c3e2ff533686249a6002b1a2d1b854cb28e59", "committedDate": "2020-06-08T15:28:04Z", "message": "update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e44f0877d1629748d04ca4b0b05598424719d1a", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5e44f0877d1629748d04ca4b0b05598424719d1a", "committedDate": "2020-06-08T13:51:26Z", "message": "update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}, "afterCommit": {"oid": "c31c3e2ff533686249a6002b1a2d1b854cb28e59", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c31c3e2ff533686249a6002b1a2d1b854cb28e59", "committedDate": "2020-06-08T15:28:04Z", "message": "update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDM4NTIz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#pullrequestreview-426438523", "createdAt": "2020-06-08T17:02:05Z", "commit": {"oid": "c31c3e2ff533686249a6002b1a2d1b854cb28e59"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b27f4e86b08b4a235890761c46217448cff88935", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b27f4e86b08b4a235890761c46217448cff88935", "committedDate": "2020-06-08T19:14:31Z", "message": "fix\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2ODMyNzI2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3170#pullrequestreview-426832726", "createdAt": "2020-06-09T06:47:01Z", "commit": {"oid": "b27f4e86b08b4a235890761c46217448cff88935"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1501, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}