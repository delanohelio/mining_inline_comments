{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NDY0NzI5", "number": 3197, "title": "[systemtest][cleanup] Kafka resource, DeploymentConfig util and ST cleanup ", "bodyText": "Type of change\n\nRefactoring\n\nDescription\nThis PR gonna:\n\n\nchange wait for Kafka CR to be ready (we will not wait for StatefulSet and Deployments anymore) -> the Kafka CR is Ready when all StatefulSets and Deployments (like EO, CruiseControl..) are ready (also with pods).\n\n\nchange names of three Kafka util methods to be same as others -> to match the pattern\n\n\nsplit DeploymentUtils to two classes -> DeploymentUtils and DeploymentConfigUtils -> now we will have separated classes so it will be more readable and cleaner.\n\n\nclean STs\n\n\nThis is also prerequisite for #3187 -> I'm gonna split one problem to several PRs so it will better for review.\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-06-15T11:08:09Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3197", "merged": true, "mergeCommit": {"oid": "ecaee7236472fb6f6a79f4be1bb24eac334c1945"}, "closed": true, "closedAt": "2020-06-16T18:48:04Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrekOsgH2gAyNDM0NDY0NzI5OjQ4Y2E4MjBkYmUzMmMyOTA0N2JhNGVlOWI1OTM3ODk3Yjk2NWUyY2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr496WAFqTQzMTc0ODQ3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48ca820dbe32c29047ba4ee9b5937897b965e2cc", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/48ca820dbe32c29047ba4ee9b5937897b965e2cc", "committedDate": "2020-06-15T11:01:33Z", "message": "add new deployment config util class\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2f371cb1d1d95ac72ca655c0be4b1d6b4b08139", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c2f371cb1d1d95ac72ca655c0be4b1d6b4b08139", "committedDate": "2020-06-15T11:01:33Z", "message": "change naming of kafka status method and ...\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTY0MTc5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3197#pullrequestreview-430564179", "createdAt": "2020-06-15T11:43:38Z", "commit": {"oid": "c2f371cb1d1d95ac72ca655c0be4b1d6b4b08139"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMTo0MzozOFrOGjul8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMTo0MzozOFrOGjul8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNjcyMA==", "bodyText": "I wonder if we really need this. In general, the operator would be waiting the operation timeout several times:\n\nfor Zoo pods\nfor Kafka pods\nfor EO pod\nfor KE pod\nfor CC pod\n\nIn the code you seem to take the 3 as one block valid for single TIMEOUT_FOR_RESOURCE_READINESS. And then for some reason you think the KE and CC pods are worth each TIMEOUT_FOR_RESOURCE_READINESS again.\nIf you think it is needed I'm fine with it. But it seems a bit weird why should KE and CC get this special treatment.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3197#discussion_r440116720", "createdAt": "2020-06-15T11:43:38Z", "author": {"login": "scholzj"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "diffHunk": "@@ -234,29 +230,17 @@ private static Kafka getKafkaFromYaml(String yamlPath) {\n      * Wait until the ZK, Kafka and EO are all ready\n      */\n     private static Kafka waitFor(Kafka kafka) {\n-        String kafkaCrName = kafka.getMetadata().getName();\n-        String namespace = kafka.getMetadata().getNamespace();\n+        long timeout = Constants.TIMEOUT_FOR_RESOURCE_READINESS;\n \n-        LOGGER.info(\"Waiting for Kafka {} in namespace {}\", kafkaCrName, namespace);\n-\n-        StatefulSetUtils.waitForAllStatefulSetPodsReady(KafkaResources.zookeeperStatefulSetName(kafkaCrName), kafka.getSpec().getZookeeper().getReplicas());\n-        StatefulSetUtils.waitForAllStatefulSetPodsReady(KafkaResources.kafkaStatefulSetName(kafkaCrName), kafka.getSpec().getKafka().getReplicas());\n-\n-        // EO should not be deployed if it does not contain UO and TO\n-        if (kafka.getSpec().getEntityOperator().getTopicOperator() != null || kafka.getSpec().getEntityOperator().getUserOperator() != null) {\n-            DeploymentUtils.waitForDeploymentReady(KafkaResources.entityOperatorDeploymentName(kafkaCrName));\n-        }\n         // Kafka Exporter is not setup every time\n         if (kafka.getSpec().getKafkaExporter() != null) {\n-            DeploymentUtils.waitForDeploymentReady(KafkaExporterResources.deploymentName(kafkaCrName));\n+            timeout += Constants.TIMEOUT_FOR_RESOURCE_CREATION;\n         }\n         // Cruise Control is not setup every time\n         if (kafka.getSpec().getCruiseControl() != null) {\n-            LOGGER.info(\"Waiting for Cruise Control pods\");\n-            DeploymentUtils.waitForDeploymentReady(CruiseControlResources.deploymentName(kafkaCrName));\n-            LOGGER.info(\"Cruise Control pods are ready\");\n+            timeout += Constants.TIMEOUT_FOR_RESOURCE_CREATION;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2f371cb1d1d95ac72ca655c0be4b1d6b4b08139"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTkwMDgy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3197#pullrequestreview-430590082", "createdAt": "2020-06-15T12:21:50Z", "commit": {"oid": "c2f371cb1d1d95ac72ca655c0be4b1d6b4b08139"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fced5ec41f3519e12c63257fc3d5390c3f3ef337", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fced5ec41f3519e12c63257fc3d5390c3f3ef337", "committedDate": "2020-06-15T12:55:19Z", "message": "fixup! change naming of kafka status method and ...\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7c3cd6f38599ba517fb95e2316ca1f8b0b33ed4", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f7c3cd6f38599ba517fb95e2316ca1f8b0b33ed4", "committedDate": "2020-06-15T12:53:20Z", "message": "fixup! change naming of kafka status method and ...\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "fced5ec41f3519e12c63257fc3d5390c3f3ef337", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fced5ec41f3519e12c63257fc3d5390c3f3ef337", "committedDate": "2020-06-15T12:55:19Z", "message": "fixup! change naming of kafka status method and ...\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzQ4NDc5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3197#pullrequestreview-431748479", "createdAt": "2020-06-16T17:47:08Z", "commit": {"oid": "fced5ec41f3519e12c63257fc3d5390c3f3ef337"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1551, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}