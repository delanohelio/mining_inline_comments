{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MTMzNTg2", "number": 3671, "title": "ST: Add strimzi_resources_state metric check to MetricsST", "bodyText": "Signed-off-by: Jakub Stejskal xstejs24@gmail.com\nType of change\n\nEnhancement / new feature\n\nDescription\nThis PR adds checks into MetricsST to cover changes delivered in #3652 .\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-09-18T07:30:05Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3671", "merged": true, "mergeCommit": {"oid": "1cdda96c414fa8b3da61b3c1f2ad364ff53dfc90"}, "closed": true, "closedAt": "2020-09-29T21:51:43Z", "author": {"login": "Frawless"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKDVtFAFqTQ5MTM1NDAwMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNtyBcgFqTQ5ODgzMzAxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMzU0MDAz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3671#pullrequestreview-491354003", "createdAt": "2020-09-18T10:49:54Z", "commit": {"oid": "d547714b5c19d6ce7e46bf935af9fce5ab9d1bb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6301ebbba460fa0a08b08ab9b2be33cea49546aa", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6301ebbba460fa0a08b08ab9b2be33cea49546aa", "committedDate": "2020-09-21T07:06:04Z", "message": "Add strimzi_resources_state metric check to MetricsST\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d547714b5c19d6ce7e46bf935af9fce5ab9d1bb8", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d547714b5c19d6ce7e46bf935af9fce5ab9d1bb8", "committedDate": "2020-09-18T07:28:22Z", "message": "Add strimzi_resources_state metric check to MetricsST\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}, "afterCommit": {"oid": "6301ebbba460fa0a08b08ab9b2be33cea49546aa", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6301ebbba460fa0a08b08ab9b2be33cea49546aa", "committedDate": "2020-09-21T07:06:04Z", "message": "Add strimzi_resources_state metric check to MetricsST\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDIzMTUz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3671#pullrequestreview-492423153", "createdAt": "2020-09-21T09:34:40Z", "commit": {"oid": "6301ebbba460fa0a08b08ab9b2be33cea49546aa"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwOTozNDo0MFrOHVHnhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwOTozNjozMlrOHVHrcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkwNjk1MA==", "bodyText": "should we add the new one strimzi_resource_state to the check in this list as well?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3671#discussion_r491906950", "createdAt": "2020-09-21T09:34:40Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/metrics/MetricsST.java", "diffHunk": "@@ -228,33 +236,30 @@ void testClusterOperatorMetrics() {\n             assertCoMetricNotNull(\"strimzi_reconciliations_failed_total\", resource, clusterOperatorMetricsData);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6301ebbba460fa0a08b08ab9b2be33cea49546aa"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkwNzk1NA==", "bodyText": "if there is no resource of a specific kind, the corresponding state_resource_state metric should not exist. Do you see it existing but with 0 value?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3671#discussion_r491907954", "createdAt": "2020-09-21T09:36:32Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/metrics/MetricsST.java", "diffHunk": "@@ -228,33 +236,30 @@ void testClusterOperatorMetrics() {\n             assertCoMetricNotNull(\"strimzi_reconciliations_failed_total\", resource, clusterOperatorMetricsData);\n         }\n \n-        Pattern connectResponse = Pattern.compile(\"strimzi_resources\\\\{kind=\\\"Kafka\\\",} ([\\\\d.][^\\\\n]+)\");\n-        ArrayList<Double> values = MetricsUtils.collectSpecificMetric(connectResponse, clusterOperatorMetricsData);\n-        assertThat(values.stream().mapToDouble(i -> i).sum(), is((double) 2));\n+        assertCoMetricResources(Kafka.RESOURCE_KIND, 2);\n+        assertCoMetricResourceState(Kafka.RESOURCE_KIND, CLUSTER_NAME, 1);\n+        assertCoMetricResourceState(Kafka.RESOURCE_KIND, SECOND_CLUSTER, 1);\n \n-        connectResponse = Pattern.compile(\"strimzi_resources\\\\{kind=\\\"KafkaBridge\\\",} ([\\\\d.][^\\\\n]+)\");\n-        values = MetricsUtils.collectSpecificMetric(connectResponse, clusterOperatorMetricsData);\n-        assertThat(values.stream().mapToDouble(i -> i).sum(), is((double) 1));\n+        assertCoMetricResources(KafkaBridge.RESOURCE_KIND, 1);\n+        assertCoMetricResourceState(KafkaBridge.RESOURCE_KIND, BRIDGE_CLUSTER, 1);\n \n-        connectResponse = Pattern.compile(\"strimzi_resources\\\\{kind=\\\"KafkaConnect\\\",} ([\\\\d.][^\\\\n]+)\");\n-        values = MetricsUtils.collectSpecificMetric(connectResponse, clusterOperatorMetricsData);\n-        assertThat(values.stream().mapToDouble(i -> i).sum(), is((double) 1));\n+        assertCoMetricResources(KafkaConnect.RESOURCE_KIND, 1);\n+        assertCoMetricResourceState(KafkaConnect.RESOURCE_KIND, CLUSTER_NAME, 1);\n \n-        connectResponse = Pattern.compile(\"strimzi_resources\\\\{kind=\\\"KafkaConnectS2I\\\",} ([\\\\d.][^\\\\n]+)\");\n-        values = MetricsUtils.collectSpecificMetric(connectResponse, clusterOperatorMetricsData);\n-        assertThat(values.stream().mapToDouble(i -> i).sum(), is((double) 0));\n+        assertCoMetricResources(KafkaConnectS2I.RESOURCE_KIND, 0);\n+        assertCoMetricResourceState(KafkaConnectS2I.RESOURCE_KIND, CLUSTER_NAME, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6301ebbba460fa0a08b08ab9b2be33cea49546aa"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60a081ea063157265c332c53880a63deb4c466cc", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/60a081ea063157265c332c53880a63deb4c466cc", "committedDate": "2020-09-21T11:29:00Z", "message": "comments\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODMzMDE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3671#pullrequestreview-498833018", "createdAt": "2020-09-29T19:58:37Z", "commit": {"oid": "60a081ea063157265c332c53880a63deb4c466cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 992, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}