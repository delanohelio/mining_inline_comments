{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NDE0NjY5", "number": 2777, "title": "Fix NPE during RU ST", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nBugfix\n\nDescription\n@im-konge found a NPE during RollingUpdate ST. This is simple fix, but it might need deeper look from @tombentley\nChecklist\n\n Update/write design documentation in ./design\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md", "createdAt": "2020-04-02T07:54:06Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777", "merged": true, "mergeCommit": {"oid": "c74265e5f86257d48a9d10e8db9aecea380f7fb8"}, "closed": true, "closedAt": "2020-04-21T07:57:07Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTnpe1gFqTM4NjE5MDYyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZu0tuAFqTM5NzA3MTcxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MTkwNjI5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-386190629", "createdAt": "2020-04-02T08:02:14Z", "commit": {"oid": "49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwODowMjoxNVrOF_fr2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwODowMjoxNVrOF_fr2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjEyMzczOA==", "bodyText": "It would be good to understand how we can get into this situation. My concern is that maybe it's fine not to roll the pod if it (momentarily) doesn't exist. But does that mean we don't wait for its readiness (I think we would wait for it's readiness, but will an NPE pop up in that code)?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#discussion_r402123738", "createdAt": "2020-04-02T08:02:15Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaAssemblyOperator.java", "diffHunk": "@@ -733,7 +733,10 @@ public void checkCustomCaSecret(CertificateAuthority ca, Secret certSecret, Secr\n                         if (Annotations.booleanAnnotation(sts, Annotations.ANNO_STRIMZI_IO_MANUAL_ROLLING_UPDATE,\n                                 false, Annotations.ANNO_OP_STRIMZI_IO_MANUAL_ROLLING_UPDATE)) {\n                             return kafkaSetOperations.maybeRollingUpdate(sts, pod -> {\n-\n+                                if (pod == null) {\n+                                    log.debug(\"Pod not found, no need to roll\");\n+                                    return \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MzI4NDcw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-386328470", "createdAt": "2020-04-02T11:16:52Z", "commit": {"oid": "49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2OTgxNDE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-386981418", "createdAt": "2020-04-03T07:05:33Z", "commit": {"oid": "49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDE0OTkx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-388414991", "createdAt": "2020-04-06T16:24:27Z", "commit": {"oid": "49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/49da61c5a9fe8bc3b2a6fb95806f78d738fe79ff", "committedDate": "2020-04-02T07:49:50Z", "message": "Fix NPE during RU ST\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}, "afterCommit": {"oid": "7974567ed476440f034b275d61ae1910b64afac0", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7974567ed476440f034b275d61ae1910b64afac0", "committedDate": "2020-04-08T14:10:57Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMDYzMzkw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-390063390", "createdAt": "2020-04-08T15:05:07Z", "commit": {"oid": "7974567ed476440f034b275d61ae1910b64afac0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNTowNTowN1rOGCzkYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNTowNTowN1rOGCzkYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU5NTIzMg==", "bodyText": "I think you should adapt the message both here and the log. It does not make sense in relation to the exception which essentially kills the reocnciliation.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#discussion_r405595232", "createdAt": "2020-04-08T15:05:07Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaAssemblyOperator.java", "diffHunk": "@@ -733,7 +734,10 @@ public void checkCustomCaSecret(CertificateAuthority ca, Secret certSecret, Secr\n                         if (Annotations.booleanAnnotation(sts, Annotations.ANNO_STRIMZI_IO_MANUAL_ROLLING_UPDATE,\n                                 false, Annotations.ANNO_OP_STRIMZI_IO_MANUAL_ROLLING_UPDATE)) {\n                             return kafkaSetOperations.maybeRollingUpdate(sts, pod -> {\n-\n+                                if (pod == null) {\n+                                    log.debug(\"Pod not found, no need to roll\");\n+                                    throw new ConcurrentDeletionException(\"Pod not found, no need to roll\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7974567ed476440f034b275d61ae1910b64afac0"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwODU1MzIw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-390855320", "createdAt": "2020-04-09T14:40:05Z", "commit": {"oid": "746471eb9f286e9a14f31817f5b126f0725be236"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTE2MzUy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-390916352", "createdAt": "2020-04-09T15:48:45Z", "commit": {"oid": "746471eb9f286e9a14f31817f5b126f0725be236"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "281b89e3a4895689cd9d183a22fcfd9b02d31fbe", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/281b89e3a4895689cd9d183a22fcfd9b02d31fbe", "committedDate": "2020-04-17T12:07:51Z", "message": "Fix NPE during RU ST\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "508287cb800406cbc5f9432cf36c432ed48930e2", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/508287cb800406cbc5f9432cf36c432ed48930e2", "committedDate": "2020-04-17T12:08:37Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8482645147d6aee72e84717ddde53ff562d1034e", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8482645147d6aee72e84717ddde53ff562d1034e", "committedDate": "2020-04-17T12:08:37Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "746471eb9f286e9a14f31817f5b126f0725be236", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/746471eb9f286e9a14f31817f5b126f0725be236", "committedDate": "2020-04-09T07:12:53Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}, "afterCommit": {"oid": "8482645147d6aee72e84717ddde53ff562d1034e", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8482645147d6aee72e84717ddde53ff562d1034e", "committedDate": "2020-04-17T12:08:37Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDcxNzEx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2777#pullrequestreview-397071711", "createdAt": "2020-04-21T07:47:24Z", "commit": {"oid": "8482645147d6aee72e84717ddde53ff562d1034e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2174, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}