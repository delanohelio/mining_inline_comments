{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMDM1OTA4", "number": 4058, "title": "Add check for inter.broker.protocol.version and warning to status conditions", "bodyText": "Type of change\n\nEnhancement / new feature\n\nDescription\nIn #4044 we added inter.broker.protocol.version to the YAML files used by users. After upgrades, users will be responsible for updating this value. this PR checks the version and adds a warning if it lacks behind the Kafka version to make sure users are aware of this limitation. This follows the same principle as the existing check of log.message.format.version.\nIn addition, the .spec.kafka.version is not specified, the check is done against the default version to make sure users get this warning even when they just use the default version.\nChecklist\n\n Write tests\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally", "createdAt": "2020-12-05T15:49:55Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4058", "merged": true, "mergeCommit": {"oid": "916c5b68b165227705a3f7faa12b769797611be3"}, "closed": true, "closedAt": "2020-12-08T22:29:43Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjOT6GAH2gAyNTMzMDM1OTA4OjFmNWNlMWYzMmMzYTdkZTkyOWNjZDMxOTVjOWE3OWI3MDkxNzk3ZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkMInlgH2gAyNTMzMDM1OTA4OjRmYmE5NDYxMzBmOTFjNDQ3MDJiM2RkOTgxNjA4NGUxMGFiOTI0NmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f5ce1f32c3a7de929ccd3195c9a79b7091797d8", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1f5ce1f32c3a7de929ccd3195c9a79b7091797d8", "committedDate": "2020-12-05T15:45:00Z", "message": "Add check for inter.broker.protocol.version and warning to status conditions\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84fe7a3faedf0814330af6e1c9db0de22a8180de", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/84fe7a3faedf0814330af6e1c9db0de22a8180de", "committedDate": "2020-12-05T16:06:23Z", "message": "Fix spotbugs\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MTc3NzU4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4058#pullrequestreview-546177758", "createdAt": "2020-12-07T14:05:57Z", "commit": {"oid": "84fe7a3faedf0814330af6e1c9db0de22a8180de"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNDowNTo1OFrOIAoTPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNDowNTo1OFrOIAoTPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzMTE5Ng==", "bodyText": "I know it's not part of this PR, but this regex looks dodgy to me. I would expect it to be \\d+(\\.\\d+)+.* (not quoted for use in a String literal) (see kafka.api.ApiVersion#apply for how they're actually validated).", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4058#discussion_r537531196", "createdAt": "2020-12-07T14:05:58Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/KafkaSpecChecker.java", "diffHunk": "@@ -25,31 +26,37 @@\n  * lead to problems.\n  */\n public class KafkaSpecChecker {\n-\n-    private KafkaSpec spec;\n-    private KafkaCluster kafkaCluster;\n-    private ZookeeperCluster zkCluster;\n+    private final KafkaCluster kafkaCluster;\n+    private final ZookeeperCluster zkCluster;\n+    private final String kafkaBrokerVersion;\n \n     private final static Pattern VERSION_REGEX = Pattern.compile(\"(\\\\d\\\\.\\\\d+).*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84fe7a3faedf0814330af6e1c9db0de22a8180de"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b88588aa98a6c494399af260adcc38cf0a5b7a", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/80b88588aa98a6c494399af260adcc38cf0a5b7a", "committedDate": "2020-12-07T17:21:15Z", "message": "Fix the version matching\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fba946130f91c44702b3dd9816084e10ab9246f", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4fba946130f91c44702b3dd9816084e10ab9246f", "committedDate": "2020-12-08T15:46:47Z", "message": "Add comment and rename the pattern to make its purpose more clear\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 705, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}