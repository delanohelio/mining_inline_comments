{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNTEyNzc1", "number": 2815, "title": "[MO] - [system test] -> creating topics via adminclient", "bodyText": "Signed-off-by: morsak xorsak02@stud.fit.vutbr.cz\nType of change\n\nEnhancement / new feature\n\nDescription\nThis PR adding new scalabillity test for the topics with using of AdminClient API.\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-04-09T16:07:39Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815", "merged": true, "mergeCommit": {"oid": "9186e68d358f4bf9f30cddd2fe246495565d0df6"}, "closed": true, "closedAt": "2020-04-29T11:22:58Z", "author": {"login": "see-quick"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV-7ABgFqTM5MDkzNTM4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABccDIYhAH2gAyNDAxNTEyNzc1OjgwOTM3MWM3NjVjYzQzODUyYTE1YjMxNDUzMGRhZjY1M2Q3NzljOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTM1Mzgz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#pullrequestreview-390935383", "createdAt": "2020-04-09T16:12:07Z", "commit": {"oid": "c5076cf5eb473d20b588a4df33acdf99f33b2424"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxMjowN1rOGDfnpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNjozMFrOGDfx1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxNjk2NA==", "bodyText": "why the admin client goes through an external listener? Can you use the internal plain port for this test?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#discussion_r406316964", "createdAt": "2020-04-09T16:12:07Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/TopicST.java", "diffHunk": "@@ -181,6 +195,45 @@ void testBigAmountOfTopicsCreatingViaKafka() {\n         }\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(SCALABILITY)\n+    @Test\n+    void testBigAmountOfTopicsCreatingViaAdminClient() throws ExecutionException, InterruptedException, TimeoutException {\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 1)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withTls(false)\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec()\n+            .done();\n+\n+        Properties properties = new Properties();\n+        properties.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, AbstractKafkaClient.getExternalBootstrapConnect(NAMESPACE, CLUSTER_NAME));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5076cf5eb473d20b588a4df33acdf99f33b2424"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTU3Mg==", "bodyText": "I would say \"Verify that corresponding {} KafkaTopic custom resources were created\"", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#discussion_r406319572", "createdAt": "2020-04-09T16:16:30Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/TopicST.java", "diffHunk": "@@ -181,6 +195,45 @@ void testBigAmountOfTopicsCreatingViaKafka() {\n         }\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(SCALABILITY)\n+    @Test\n+    void testBigAmountOfTopicsCreatingViaAdminClient() throws ExecutionException, InterruptedException, TimeoutException {\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 1)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withTls(false)\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec()\n+            .done();\n+\n+        Properties properties = new Properties();\n+        properties.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, AbstractKafkaClient.getExternalBootstrapConnect(NAMESPACE, CLUSTER_NAME));\n+\n+        try (AdminClient adminClient = AdminClient.create(properties)) {\n+\n+            for (int i = 0; i < NUMBER_OF_TOPICS; i++) {\n+                String topicName = TOPIC_NAME + \"-\" + i;\n+                LOGGER.debug(\"Creating async topic {} via Admin client\", topicName);\n+                CreateTopicsResult crt = adminClient.createTopics(singletonList(new NewTopic(topicName, 1, (short) 1)));\n+                crt.all().get();\n+            }\n+\n+            Set<String> topics = adminClient.listTopics().names().get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS);\n+\n+            LOGGER.info(\"Verify that in Kafka cluster contains {} topics\", NUMBER_OF_TOPICS);\n+            assertThat(topics.size(), is(NUMBER_OF_TOPICS));\n+        }\n+\n+        LOGGER.info(\"Verify that {} topics are inside Kubernetes CR\", NUMBER_OF_TOPICS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5076cf5eb473d20b588a4df33acdf99f33b2424"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDEzMDc3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#pullrequestreview-391013077", "createdAt": "2020-04-09T18:00:11Z", "commit": {"oid": "c5076cf5eb473d20b588a4df33acdf99f33b2424"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxODowMDoxMVrOGDjeVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxODowMDoxMVrOGDjeVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM4MDExOA==", "bodyText": "Is that single Zookeeper node?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#discussion_r406380118", "createdAt": "2020-04-09T18:00:11Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/TopicST.java", "diffHunk": "@@ -181,6 +195,45 @@ void testBigAmountOfTopicsCreatingViaKafka() {\n         }\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(SCALABILITY)\n+    @Test\n+    void testBigAmountOfTopicsCreatingViaAdminClient() throws ExecutionException, InterruptedException, TimeoutException {\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5076cf5eb473d20b588a4df33acdf99f33b2424"}, "originalPosition": 61}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5467637d4e14d40d20c2483e2669f1e8246e1256", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5467637d4e14d40d20c2483e2669f1e8246e1256", "committedDate": "2020-04-14T08:39:34Z", "message": "[MO] - [paolo] -> commend\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}, "afterCommit": {"oid": "4588f590645bbf6e93d173f2fb98ff49f2dbe0d8", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4588f590645bbf6e93d173f2fb98ff49f2dbe0d8", "committedDate": "2020-04-21T10:18:21Z", "message": "[MO] - [system test] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzc0NDcy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#pullrequestreview-401374472", "createdAt": "2020-04-27T22:33:35Z", "commit": {"oid": "d9a9a6cf3cfe9dd65aea398d8b82440888932a99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDk4NzM5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#pullrequestreview-401498739", "createdAt": "2020-04-28T05:01:52Z", "commit": {"oid": "d9a9a6cf3cfe9dd65aea398d8b82440888932a99"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNTowMTo1MlrOGNCp7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNTowMjozMVrOGNCqqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjMyODE3NQ==", "bodyText": "asserThat it contains exactly TOPIC_NAME other than just the size?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#discussion_r416328175", "createdAt": "2020-04-28T05:01:52Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicST.java", "diffHunk": "@@ -106,6 +118,41 @@ void testCreateTopicViaKafka() {\n         verifyTopicViaKafka(TOPIC_NAME, topicPartitions);\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Test\n+    void testCreateTopicViaAdminClient() throws ExecutionException, InterruptedException, TimeoutException {\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 3)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withTls(false)\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec()\n+            .done();\n+\n+        Properties properties = new Properties();\n+        properties.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, AbstractKafkaClient.getExternalBootstrapConnect(NAMESPACE, CLUSTER_NAME));\n+\n+        try (AdminClient adminClient = AdminClient.create(properties)) {\n+\n+            LOGGER.info(\"Creating async topic {} via Admin client\", TOPIC_NAME);\n+            CreateTopicsResult crt = adminClient.createTopics(singletonList(new NewTopic(TOPIC_NAME, 1, (short) 1)));\n+            crt.all().get();\n+\n+            Set<String> topics = adminClient.listTopics().names().get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS);\n+\n+            LOGGER.info(\"Verify that in Kafka cluster contains {} topics\", 1);\n+            assertThat(topics.size(), is(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9a9a6cf3cfe9dd65aea398d8b82440888932a99"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjMyODM2MA==", "bodyText": "the same, assertThat the metadata.name is TOPIC_NAME?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#discussion_r416328360", "createdAt": "2020-04-28T05:02:31Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicST.java", "diffHunk": "@@ -106,6 +118,41 @@ void testCreateTopicViaKafka() {\n         verifyTopicViaKafka(TOPIC_NAME, topicPartitions);\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Test\n+    void testCreateTopicViaAdminClient() throws ExecutionException, InterruptedException, TimeoutException {\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 3)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withTls(false)\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec()\n+            .done();\n+\n+        Properties properties = new Properties();\n+        properties.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, AbstractKafkaClient.getExternalBootstrapConnect(NAMESPACE, CLUSTER_NAME));\n+\n+        try (AdminClient adminClient = AdminClient.create(properties)) {\n+\n+            LOGGER.info(\"Creating async topic {} via Admin client\", TOPIC_NAME);\n+            CreateTopicsResult crt = adminClient.createTopics(singletonList(new NewTopic(TOPIC_NAME, 1, (short) 1)));\n+            crt.all().get();\n+\n+            Set<String> topics = adminClient.listTopics().names().get(Constants.GLOBAL_CLIENTS_TIMEOUT, TimeUnit.MILLISECONDS);\n+\n+            LOGGER.info(\"Verify that in Kafka cluster contains {} topics\", 1);\n+            assertThat(topics.size(), is(1));\n+        }\n+\n+        LOGGER.info(\"Verify that corresponding {} KafkaTopic custom resources were created\", 1);\n+        assertThat(KafkaTopicResource.kafkaTopicClient().inNamespace(NAMESPACE).list().getItems().size(), is(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9a9a6cf3cfe9dd65aea398d8b82440888932a99"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNTg4MTQ0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#pullrequestreview-401588144", "createdAt": "2020-04-28T07:59:04Z", "commit": {"oid": "fd2a138a35018db2db990d53c3505aea6b3c868a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21583edf6ca19bac8ed53e3f7e58358e5878bdd1", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/21583edf6ca19bac8ed53e3f7e58358e5878bdd1", "committedDate": "2020-04-28T07:59:48Z", "message": "[MO] - [system test] -> creating topics via adminclient\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91f496e541cb6dc0f6d88bbf4e3dd6e34a7c5026", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/91f496e541cb6dc0f6d88bbf4e3dd6e34a7c5026", "committedDate": "2020-04-28T07:59:48Z", "message": "[MO] - [paolo] -> commend\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bcd465802ff986ed8dca6e0e1cd1b99a50379fd", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3bcd465802ff986ed8dca6e0e1cd1b99a50379fd", "committedDate": "2020-04-28T07:59:48Z", "message": "[MO] - [system test] -> update\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4f97242c52972183c61ee02a71b3f3a31b32253", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c4f97242c52972183c61ee02a71b3f3a31b32253", "committedDate": "2020-04-28T07:59:48Z", "message": "[MO] - [jakub] -> commends\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17c3876d04eed7009a99e2239cf741fff45b902c", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/17c3876d04eed7009a99e2239cf741fff45b902c", "committedDate": "2020-04-28T07:59:48Z", "message": "[MO] - [commends] -> done\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ee2be983d4e4bbec0f59f7776b87461bc7aa0a", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/74ee2be983d4e4bbec0f59f7776b87461bc7aa0a", "committedDate": "2020-04-28T08:29:18Z", "message": "s;\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd2a138a35018db2db990d53c3505aea6b3c868a", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fd2a138a35018db2db990d53c3505aea6b3c868a", "committedDate": "2020-04-28T07:57:58Z", "message": "[MO] - [commends] -> done\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}, "afterCommit": {"oid": "74ee2be983d4e4bbec0f59f7776b87461bc7aa0a", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/74ee2be983d4e4bbec0f59f7776b87461bc7aa0a", "committedDate": "2020-04-28T08:29:18Z", "message": "s;\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNjUwOTYz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2815#pullrequestreview-401650963", "createdAt": "2020-04-28T09:18:53Z", "commit": {"oid": "74ee2be983d4e4bbec0f59f7776b87461bc7aa0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "809371c765cc43852a15b314530daf653d779c98", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/809371c765cc43852a15b314530daf653d779c98", "committedDate": "2020-04-28T12:34:50Z", "message": "ss\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1833, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}