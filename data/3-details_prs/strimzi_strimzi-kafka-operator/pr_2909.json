{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMzgxMjYx", "number": 2909, "title": "Mask passwords in while printing environment variables in our operators", "bodyText": "Type of change\n\nBugfix\n\nDescription\nOur operators are at startup always printing the environment variables or other configurations. This is useful for analysing issues etc. But currently they are this way also printing variables with things such as passwords. This issue tires to detect them and mask them with ********.\nThe new masked output could look for example like this:\n[2020-04-28 21:46:33,763] INFO  <Session     :71> [main        ] Using config:\n        STRIMZI_TRUSTSTORE_LOCATION: /tmp/topic-operator/replication.truststore.p12\n        STRIMZI_RESOURCE_LABELS: strimzi.io/cluster=my-cluster\n        STRIMZI_KAFKA_BOOTSTRAP_SERVERS: my-cluster-kafka-bootstrap:9091\n        STRIMZI_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: HTTPS\n        STRIMZI_NAMESPACE: myproject\n        STRIMZI_ZOOKEEPER_SESSION_TIMEOUT_MS: 20000\n        STRIMZI_TOPICS_PATH: /strimzi/topics\n        STRIMZI_FULL_RECONCILIATION_INTERVAL_MS: 90000\n        STRIMZI_ZOOKEEPER_CONNECT: localhost:2181\n        STRIMZI_TLS_ENABLED: true\n        STRIMZI_KEYSTORE_PASSWORD: ********\n        STRIMZI_TOPIC_METADATA_MAX_ATTEMPTS: 6\n        STRIMZI_REASSIGN_VERIFY_INTERVAL_MS: 120000\n        STRIMZI_KEYSTORE_LOCATION: /tmp/topic-operator/replication.keystore.p12\n        TC_ZK_CONNECTION_TIMEOUT_MS: 20000\n        STRIMZI_TRUSTSTORE_PASSWORD: ********\n        STRIMZI_REASSIGN_THROTTLE: 9223372036854775807\n\nChecklist\n\n Write tests\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally", "createdAt": "2020-04-28T21:54:07Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2909", "merged": true, "mergeCommit": {"oid": "b083f9aa41ca75c023261a0564badeb0703007a0"}, "closed": true, "closedAt": "2020-04-29T22:49:04Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccLFvJgH2gAyNDEwMzgxMjYxOjk4OTkxNTJkZTM2ZGE1Y2Y0ZTc0NjAxMDNlNzIyNmZhOTNhOTlkOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccge2MgFqTQwMzA5Mjg0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9899152de36da5cf4e7460103e7226fa93a99d9a", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9899152de36da5cf4e7460103e7226fa93a99d9a", "committedDate": "2020-04-28T21:51:11Z", "message": "Mask passwords in while printing environment variables in our operators\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNDY3NDUz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2909#pullrequestreview-402467453", "createdAt": "2020-04-29T08:39:57Z", "commit": {"oid": "9899152de36da5cf4e7460103e7226fa93a99d9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNTUyODA5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2909#pullrequestreview-402552809", "createdAt": "2020-04-29T10:45:53Z", "commit": {"oid": "9899152de36da5cf4e7460103e7226fa93a99d9a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxMDo0NTo1M1rOGN5UZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxMDo0ODoyNlrOGN5Zfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIyMzc4MQ==", "bodyText": "This seems like an unrelated change, I guess this was missed in the Connectors Exception fixes PR?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2909#discussion_r417223781", "createdAt": "2020-04-29T10:45:53Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperator.java", "diffHunk": "@@ -151,8 +151,8 @@ public KafkaMirrorMaker2AssemblyOperator(Vertx vertx, PlatformFeaturesAvailabili\n                 .compose(i -> deploymentOperations.reconcile(namespace, mirrorMaker2Cluster.getName(), mirrorMaker2Cluster.generateDeployment(annotations, pfa.isOpenshift(), imagePullPolicy, imagePullSecrets)))\n                 .compose(i -> deploymentOperations.scaleUp(namespace, mirrorMaker2Cluster.getName(), mirrorMaker2Cluster.getReplicas()))\n                 .compose(i -> deploymentOperations.waitForObserved(namespace, mirrorMaker2Cluster.getName(), 1_000, operationTimeoutMs))\n-                .compose(i -> deploymentOperations.readiness(namespace, mirrorMaker2Cluster.getName(), 1_000, operationTimeoutMs))\n-                .compose(i -> reconcileConnectors(reconciliation, kafkaMirrorMaker2, mirrorMaker2Cluster, kafkaMirrorMaker2Status))\n+                .compose(i -> mirrorMaker2Cluster.getReplicas() > 0 ? deploymentOperations.readiness(namespace, mirrorMaker2Cluster.getName(), 1_000, operationTimeoutMs) : Future.succeededFuture())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9899152de36da5cf4e7460103e7226fa93a99d9a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIyNTA4Ng==", "bodyText": "Should we only be hiding passwords, might we want to hide apikeys or certificates as well?\nDo let me know if I am wrong on this though...", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2909#discussion_r417225086", "createdAt": "2020-04-29T10:48:26Z", "author": {"login": "samuel-hawker"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/Util.java", "diffHunk": "@@ -223,4 +222,35 @@ private static File store(String prefix, String suffix, KeyStore trustStore, cha\n             throw e;\n         }\n     }\n+\n+    /**\n+     * Logs environment variables into the regular log file.\n+     */\n+    public static void printEnvInfo() {\n+        Map<String, String> env = new HashMap<>(System.getenv());\n+        StringBuilder sb = new StringBuilder();\n+\n+        for (Map.Entry<String, String> entry: env.entrySet()) {\n+            sb.append(\"\\t\").append(entry.getKey()).append(\": \").append(maskPassword(entry.getKey(), entry.getValue())).append(\"\\n\");\n+        }\n+\n+        LOGGER.info(\"Using config:\\n\" + sb.toString());\n+    }\n+\n+    /**\n+     * Gets environment variable, checks if it contains a password and in case it does it masks the output. It expects\n+     * environment variables with passwords to contain `PASSWORD` in their name.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9899152de36da5cf4e7460103e7226fa93a99d9a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58911c3bcb1c56fe485457befd69b039700878cb", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/58911c3bcb1c56fe485457befd69b039700878cb", "committedDate": "2020-04-29T11:29:10Z", "message": "Revert incorrectly commited file\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDkyODQy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2909#pullrequestreview-403092842", "createdAt": "2020-04-29T22:46:37Z", "commit": {"oid": "58911c3bcb1c56fe485457befd69b039700878cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1981, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}