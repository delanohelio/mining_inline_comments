{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NTkzNDc2", "number": 3013, "title": "Pass HTTP Proxy configuration from Cluster Operator to operands", "bodyText": "Type of change\n\nEnhancement / new feature\n\nDescription\nIn some situation, the Kafka cluster might be runnign behing a HTTP proxy. In geenral that should not be a problem since the compoenents in general don't communicate with open internet. But there are some cases it might be useful to support such environments for example:\n\nKafka Connect running connectors which pull/push data from/to outside through the proxy\nMaybe also JMXTrans pushing the data or OAuth authentication talking with OAuth server from behind the proxy\n\nWith this PR, the usual environment variables - HTTP_PROXY, HTTPS_PROXY and NO_PROXY can be passed to the Cluster operator which will in turn set them on all created containers. This is also in sync with OpenShift Operator Hub which sets these environment variables automatically when proxy is configured in the cluster.\nThis PR is hard to test because environment variables cannot be easily changed from within the unit tests. And without support for things such as Dependency Injection it is hard to deal with it in a way when we can easily test it but also don't go through the environment variables every single reconciliation. So there are currently no tests. But the functionality is very primitive, so I hope this should be fine.\nChecklist\n\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Update CHANGELOG.md", "createdAt": "2020-05-13T20:25:09Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3013", "merged": true, "mergeCommit": {"oid": "0d3aa313e7c283177daa042351b436e7eb5cf7ee"}, "closed": true, "closedAt": "2020-05-14T21:06:32Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg-vcwAH2gAyNDE3NTkzNDc2OjkzMDcyNzU1MDEwN2E2NzU4NGUwZTY0ZWQ4ZTJmNWJiY2M0MTc5YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchTsHfAFqTQxMjE2ODU4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "930727550107a67584e0e64ed8e2f5bbcc4179ad", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/930727550107a67584e0e64ed8e2f5bbcc4179ad", "committedDate": "2020-05-13T20:17:36Z", "message": "Pass HTTP Proxy configuration from Cluster Operator to operands\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59a02b94383d50e3e145639b2ef7e60037a1ef2b", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59a02b94383d50e3e145639b2ef7e60037a1ef2b", "committedDate": "2020-05-13T21:09:52Z", "message": "Fix spotbugs - use unmodifiable list\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDEwNTk4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3013#pullrequestreview-412010598", "createdAt": "2020-05-14T17:03:56Z", "commit": {"oid": "59a02b94383d50e3e145639b2ef7e60037a1ef2b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzowMzo1NlrOGVl7Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzowMzo1NlrOGVl7Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI5NDU5OA==", "bodyText": "Collections.emptyList()", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3013#discussion_r425294598", "createdAt": "2020-05-14T17:03:56Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/AbstractModel.java", "diffHunk": "@@ -107,6 +107,30 @@\n     public static final String ANNO_STRIMZI_CM_GENERATION = Annotations.STRIMZI_DOMAIN + \"cm-generation\";\n     public static final String ANNO_STRIMZI_LOGGING_HASH = Annotations.STRIMZI_DOMAIN + \"logging-hash\";\n \n+    protected static final List<EnvVar> PROXY_ENV_VARS;\n+\n+    static {\n+        List<EnvVar> envVars = new ArrayList<>(3);\n+\n+        if (System.getenv(\"HTTP_PROXY\") != null)    {\n+            envVars.add(buildEnvVar(\"HTTP_PROXY\", System.getenv(\"HTTP_PROXY\")));\n+        }\n+\n+        if (System.getenv(\"HTTPS_PROXY\") != null)    {\n+            envVars.add(buildEnvVar(\"HTTPS_PROXY\", System.getenv(\"HTTPS_PROXY\")));\n+        }\n+\n+        if (System.getenv(\"NO_PROXY\") != null)    {\n+            envVars.add(buildEnvVar(\"NO_PROXY\", System.getenv(\"NO_PROXY\")));\n+        }\n+\n+        if (envVars.size() > 0) {\n+            PROXY_ENV_VARS = Collections.unmodifiableList(envVars);\n+        } else {\n+            PROXY_ENV_VARS = Collections.unmodifiableList(new ArrayList<>(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59a02b94383d50e3e145639b2ef7e60037a1ef2b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef6f97926b93d1bada23081622233ad263d4245", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/cef6f97926b93d1bada23081622233ad263d4245", "committedDate": "2020-05-14T18:25:48Z", "message": "Review comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDk0MzQy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3013#pullrequestreview-412094342", "createdAt": "2020-05-14T18:53:00Z", "commit": {"oid": "cef6f97926b93d1bada23081622233ad263d4245"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTY4NTgz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3013#pullrequestreview-412168583", "createdAt": "2020-05-14T20:41:58Z", "commit": {"oid": "cef6f97926b93d1bada23081622233ad263d4245"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1706, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}