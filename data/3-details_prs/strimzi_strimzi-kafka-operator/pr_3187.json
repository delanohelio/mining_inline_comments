{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMDI2OTcy", "number": 3187, "title": "[systemtest][enhancement] Variable timeout part 1 - resource readiness", "bodyText": "Type of change\n\nEnhancement\n\nDescription\nIn this PR (1/3) I'm gonna add new methods for calculating timeout for resource readiness by resource kind - we discussed that we don't really want to wait for example 28-40 minutes for Kafka readiness -> if there is some problem (like ImagePullBackOff etc) the test can fail much sooner than in 30 minutes when the time runs out.\nI also added new \"resources\" types to Constants class so I can use it in ResourceReadiness enum.\nI needed to change timeouts for resource creation/ready in our utils classes.\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-06-11T11:56:00Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187", "merged": true, "mergeCommit": {"oid": "b7d1519453e83fb7546c82d006d45b9174fff472"}, "closed": true, "closedAt": "2020-06-25T09:40:01Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqU5tNABqjM0MzU5NzIxNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcubO_2gFqTQzNjcyNDc3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a8aa4850bab51f937276db7534282cf0e3bea62", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4a8aa4850bab51f937276db7534282cf0e3bea62", "committedDate": "2020-06-11T11:51:48Z", "message": "change timeout in resource manager and change wait for kafka readiness\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "1b70234f756ce01be83658bc22f02702baf4d614", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1b70234f756ce01be83658bc22f02702baf4d614", "committedDate": "2020-06-11T21:11:52Z", "message": "fix the STs\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b70234f756ce01be83658bc22f02702baf4d614", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1b70234f756ce01be83658bc22f02702baf4d614", "committedDate": "2020-06-11T21:11:52Z", "message": "fix the STs\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "11a90745bbd31f8ee5d24fdcf01b54ca78e62858", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/11a90745bbd31f8ee5d24fdcf01b54ca78e62858", "committedDate": "2020-06-22T19:14:41Z", "message": "fix the STs\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33c1f6838a2a4321ae7c9cd88c2faed3e6250317", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/33c1f6838a2a4321ae7c9cd88c2faed3e6250317", "committedDate": "2020-06-23T13:47:57Z", "message": "add enum and methods\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9a6e4240a9620e9798b2158ec54804c5531dd96", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e9a6e4240a9620e9798b2158ec54804c5531dd96", "committedDate": "2020-06-23T13:47:57Z", "message": "add more resources for readiness and method to get timeout for pods\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b28be11fe748cd347c53eaec3a1f04257fa837d0", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b28be11fe748cd347c53eaec3a1f04257fa837d0", "committedDate": "2020-06-23T13:47:57Z", "message": "edit timeouts in utils classes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb79739fd7a762db7b2a3051d17c9f141185b696", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/cb79739fd7a762db7b2a3051d17c9f141185b696", "committedDate": "2020-06-23T13:47:57Z", "message": "add more resource types to Constants class\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e0b4f5fd7d9e9b392368070b6023b5c46d75b46", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8e0b4f5fd7d9e9b392368070b6023b5c46d75b46", "committedDate": "2020-06-23T13:47:57Z", "message": "fix the STs\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "760ba02f413336c09f591d12704e1b8ec42fb4b7", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/760ba02f413336c09f591d12704e1b8ec42fb4b7", "committedDate": "2020-06-23T13:47:57Z", "message": "rebase\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1a03e7d9a7a3f0f3f9a51dc9d00c352d5a3c800", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f1a03e7d9a7a3f0f3f9a51dc9d00c352d5a3c800", "committedDate": "2020-06-23T13:47:57Z", "message": "fixup! rebase\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTI5ODQz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#pullrequestreview-435929843", "createdAt": "2020-06-23T16:00:30Z", "commit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowMDozMVrOGnwFnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowMDozMVrOGnwFnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzNTUxNw==", "bodyText": "CruiseControl and Exporter are part of Kafka. Wouldn't be btter to use Deployment timeout here?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#discussion_r444335517", "createdAt": "2020-06-23T16:00:31Z", "author": {"login": "Frawless"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/ResourceOperation.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.resources;\n+\n+import io.strimzi.api.kafka.model.Kafka;\n+import io.strimzi.api.kafka.model.KafkaBridge;\n+import io.strimzi.api.kafka.model.KafkaConnect;\n+import io.strimzi.api.kafka.model.KafkaConnectS2I;\n+import io.strimzi.api.kafka.model.KafkaConnector;\n+import io.strimzi.api.kafka.model.KafkaMirrorMaker;\n+import io.strimzi.api.kafka.model.KafkaMirrorMaker2;\n+import io.strimzi.api.kafka.model.KafkaRebalance;\n+import io.strimzi.systemtest.Constants;\n+\n+import java.time.Duration;\n+\n+public class ResourceOperation {\n+    public static long getTimeoutForResourceReadiness(String kind) {\n+        long timeout;\n+\n+        switch (kind) {\n+            case Kafka.RESOURCE_KIND:\n+                timeout = Duration.ofMinutes(14).toMillis();\n+                break;\n+            case KafkaConnect.RESOURCE_KIND:\n+            case KafkaConnectS2I.RESOURCE_KIND:\n+            case KafkaMirrorMaker2.RESOURCE_KIND:\n+            case Constants.DEPLOYMENT_CONFIG:\n+                timeout = Duration.ofMinutes(10).toMillis();\n+                break;\n+            case KafkaRebalance.RESOURCE_KIND:\n+            case KafkaMirrorMaker.RESOURCE_KIND:\n+            case KafkaBridge.RESOURCE_KIND:\n+            case KafkaConnector.RESOURCE_KIND:\n+            case Constants.STATEFUL_SET:\n+            case Constants.DEPLOYMENT:\n+                timeout = Duration.ofMinutes(8).toMillis();\n+                break;\n+            case Constants.KAFKA_CRUISE_CONTROL:\n+            case Constants.KAFKA_EXPORTER:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTMwMzE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#pullrequestreview-435930318", "createdAt": "2020-06-23T16:01:02Z", "commit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowMTowMlrOGnwHCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowMTowMlrOGnwHCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzNTg4Mg==", "bodyText": "Rebalance and Connector readiness will take much less time than others", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#discussion_r444335882", "createdAt": "2020-06-23T16:01:02Z", "author": {"login": "Frawless"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/ResourceOperation.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.resources;\n+\n+import io.strimzi.api.kafka.model.Kafka;\n+import io.strimzi.api.kafka.model.KafkaBridge;\n+import io.strimzi.api.kafka.model.KafkaConnect;\n+import io.strimzi.api.kafka.model.KafkaConnectS2I;\n+import io.strimzi.api.kafka.model.KafkaConnector;\n+import io.strimzi.api.kafka.model.KafkaMirrorMaker;\n+import io.strimzi.api.kafka.model.KafkaMirrorMaker2;\n+import io.strimzi.api.kafka.model.KafkaRebalance;\n+import io.strimzi.systemtest.Constants;\n+\n+import java.time.Duration;\n+\n+public class ResourceOperation {\n+    public static long getTimeoutForResourceReadiness(String kind) {\n+        long timeout;\n+\n+        switch (kind) {\n+            case Kafka.RESOURCE_KIND:\n+                timeout = Duration.ofMinutes(14).toMillis();\n+                break;\n+            case KafkaConnect.RESOURCE_KIND:\n+            case KafkaConnectS2I.RESOURCE_KIND:\n+            case KafkaMirrorMaker2.RESOURCE_KIND:\n+            case Constants.DEPLOYMENT_CONFIG:\n+                timeout = Duration.ofMinutes(10).toMillis();\n+                break;\n+            case KafkaRebalance.RESOURCE_KIND:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTMxNTUz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#pullrequestreview-435931553", "createdAt": "2020-06-23T16:02:28Z", "commit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowMjoyOVrOGnwKsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowMjoyOVrOGnwKsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzNjgxNg==", "bodyText": "I dont think this is a good aproach. The pods are ready after some time after creation, the number of pods doesn't affect it I think. It make sense for rolling updates", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#discussion_r444336816", "createdAt": "2020-06-23T16:02:29Z", "author": {"login": "Frawless"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/ResourceOperation.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.resources;\n+\n+import io.strimzi.api.kafka.model.Kafka;\n+import io.strimzi.api.kafka.model.KafkaBridge;\n+import io.strimzi.api.kafka.model.KafkaConnect;\n+import io.strimzi.api.kafka.model.KafkaConnectS2I;\n+import io.strimzi.api.kafka.model.KafkaConnector;\n+import io.strimzi.api.kafka.model.KafkaMirrorMaker;\n+import io.strimzi.api.kafka.model.KafkaMirrorMaker2;\n+import io.strimzi.api.kafka.model.KafkaRebalance;\n+import io.strimzi.systemtest.Constants;\n+\n+import java.time.Duration;\n+\n+public class ResourceOperation {\n+    public static long getTimeoutForResourceReadiness(String kind) {\n+        long timeout;\n+\n+        switch (kind) {\n+            case Kafka.RESOURCE_KIND:\n+                timeout = Duration.ofMinutes(14).toMillis();\n+                break;\n+            case KafkaConnect.RESOURCE_KIND:\n+            case KafkaConnectS2I.RESOURCE_KIND:\n+            case KafkaMirrorMaker2.RESOURCE_KIND:\n+            case Constants.DEPLOYMENT_CONFIG:\n+                timeout = Duration.ofMinutes(10).toMillis();\n+                break;\n+            case KafkaRebalance.RESOURCE_KIND:\n+            case KafkaMirrorMaker.RESOURCE_KIND:\n+            case KafkaBridge.RESOURCE_KIND:\n+            case KafkaConnector.RESOURCE_KIND:\n+            case Constants.STATEFUL_SET:\n+            case Constants.DEPLOYMENT:\n+                timeout = Duration.ofMinutes(8).toMillis();\n+                break;\n+            case Constants.KAFKA_CRUISE_CONTROL:\n+            case Constants.KAFKA_EXPORTER:\n+                timeout = Duration.ofMinutes(4).toMillis();\n+                break;\n+            default:\n+                timeout = Duration.ofMinutes(2).toMillis();\n+        }\n+\n+        return timeout;\n+    }\n+\n+    public static long getTimeoutForPodsReadiness(int expectPods) {\n+        return Duration.ofMinutes(4).toMillis() * expectPods;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bb50f2d35f614420aa3eadd25d5666cde886f4e", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9bb50f2d35f614420aa3eadd25d5666cde886f4e", "committedDate": "2020-06-23T17:33:29Z", "message": "comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d52381308b41750bfda47cbeae251be36267e8a9", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d52381308b41750bfda47cbeae251be36267e8a9", "committedDate": "2020-06-23T13:04:37Z", "message": "fixup! rebase\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "9bb50f2d35f614420aa3eadd25d5666cde886f4e", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9bb50f2d35f614420aa3eadd25d5666cde886f4e", "committedDate": "2020-06-23T17:33:29Z", "message": "comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Njk4NzA5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#pullrequestreview-436698709", "createdAt": "2020-06-24T14:24:34Z", "commit": {"oid": "9bb50f2d35f614420aa3eadd25d5666cde886f4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzI0Nzc4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3187#pullrequestreview-436724778", "createdAt": "2020-06-24T14:50:25Z", "commit": {"oid": "9bb50f2d35f614420aa3eadd25d5666cde886f4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1529, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}