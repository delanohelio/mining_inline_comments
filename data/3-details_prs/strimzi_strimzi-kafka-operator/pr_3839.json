{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1ODg0Mjg5", "number": 3839, "title": "[systemtest] Add tests with mounting secrets and CM as volumes to ConnectS2I and improve the base test with doted names", "bodyText": "Signed-off-by: Lukas Kral lukywill16@gmail.com\nType of change\n\nNew test\nNew checks\n\nDescription\nAfter #3820 where the names of the volumes/config maps and secrets was fixed, we are able to name them with doted names (like my.secret or my.config.map). This PR also adds test which we had only in Connect also to ConnectS2IST to have it properly covered.\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-10-19T11:07:45Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839", "merged": true, "mergeCommit": {"oid": "f48062e3fec329c48e12e2c947d7c476df19f877"}, "closed": true, "closedAt": "2020-10-19T21:48:28Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUCFdxAH2gAyNTA1ODg0Mjg5OjM4YmVlMjk1MjIyOGRkMDZkNTlmZTE1MjEyOWQ5ODA5OTQ3Mzc1ZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUJI-QAFqTUxMjA4MjEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/38bee2952228dd06d59fe152129d9809947375e1", "committedDate": "2020-10-19T11:01:30Z", "message": "add test with volumes to connects2i, also add to the test volumes with doted names\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjU4NjEw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#pullrequestreview-511658610", "createdAt": "2020-10-19T11:22:16Z", "commit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMToyMjoxN1rOHkJpMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMToyMzo0M1rOHkJsAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODc4Nw==", "bodyText": "Maybe put name into var?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668787", "createdAt": "2020-10-19T11:22:17Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODg0Ng==", "bodyText": "Indent", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668846", "createdAt": "2020-10-19T11:22:23Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODkwNA==", "bodyText": "Maybe put name into var?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668904", "createdAt": "2020-10-19T11:22:31Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")\n+            .endMetadata()\n+            .withType(\"Opaque\")\n+            .addToData(secretKey, encodedPassword)\n+            .build();\n+\n+        ConfigMap configMap = new ConfigMapBuilder()\n+            .editOrNewMetadata()\n+            .withName(\"my-config-map\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODk1NQ==", "bodyText": "Maybe put value into var?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668955", "createdAt": "2020-10-19T11:22:38Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")\n+            .endMetadata()\n+            .withType(\"Opaque\")\n+            .addToData(secretKey, encodedPassword)\n+            .build();\n+\n+        ConfigMap configMap = new ConfigMapBuilder()\n+            .editOrNewMetadata()\n+            .withName(\"my-config-map\")\n+            .endMetadata()\n+            .addToData(configMapKey, \"my-value\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2OTUwNA==", "bodyText": "Maybe we should put this into some method? It's the same for ConnectST and ConnectS2IST. Same with creation of serets/cm", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507669504", "createdAt": "2020-10-19T11:23:43Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectST.java", "diffHunk": "@@ -1031,16 +1031,23 @@ void testScaleConnectAndConnectorSubresource() {\n     }\n \n     @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n     void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n         String secretPassword = \"password\";\n         String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n \n         String secretEnv = \"MY_CONNECTOR_SECRET\";\n         String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n \n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n         String configMapVolumeName = \"connect-config-map\";\n         String secretVolumeName = \"connect-secret\";\n \n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjYwMzA0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#pullrequestreview-511660304", "createdAt": "2020-10-19T11:24:41Z", "commit": {"oid": "38bee2952228dd06d59fe152129d9809947375e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f18ff07d1e1cad4f98f6c443d2cd3ea3b26f953e", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f18ff07d1e1cad4f98f6c443d2cd3ea3b26f953e", "committedDate": "2020-10-19T18:26:37Z", "message": "comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMDgyMTIz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#pullrequestreview-512082123", "createdAt": "2020-10-19T19:14:40Z", "commit": {"oid": "f18ff07d1e1cad4f98f6c443d2cd3ea3b26f953e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 823, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}