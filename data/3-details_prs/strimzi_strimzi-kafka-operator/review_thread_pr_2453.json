{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2OTM4NDAy", "number": 2453, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMjoyNjo1N1rODbjcxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo1NDoyNVrODbn8AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMjE4OTQ4OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMjoyNjo1N1rOFjGpWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMjoyNjo1N1rOFjGpWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1MzM3MQ==", "bodyText": "You have the comments from the oposite case - here is now S2I and on line 376 is regular connect.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2453#discussion_r372353371", "createdAt": "2020-01-29T12:26:57Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -332,6 +335,91 @@ void testJvmAndResources() {\n         KafkaConnectS2IResource.deleteKafkaConnectS2IWithoutWait(kafkaConnectS2i);\n     }\n \n+    @Test\n+    void testKafkaConnectorWithConnectS2IAndConnectWithSameName() {\n+        String topicName = \"test-topic-\" + new Random().nextInt(Integer.MAX_VALUE);\n+        String connectClusterName = \"connect-cluster\";\n+        String connectS2IClusterName = \"connect-s2i-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n+        // Crate connect cluster with default connect image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61468f0e12f286494fde47d7724324b78a903351"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMjE5NjYxOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMjoyOTo0NVrOFjGt2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo1Njo1MVrOFjNx9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1NDUyMw==", "bodyText": "Right now both this and the connect test are in following order:\n\nCreate ConnectS2I\nCreate Connector\nCreate conflicting Connect with the same name.\n\nI wonder if the better order would be:\n\nCreate ConnectS2I\nCreate conflicting Connect with the same name.\nCreate Connector\n\nOr mybe at least try that for example connector update still works after you create the conflicting Connect.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2453#discussion_r372354523", "createdAt": "2020-01-29T12:29:45Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -332,6 +335,91 @@ void testJvmAndResources() {\n         KafkaConnectS2IResource.deleteKafkaConnectS2IWithoutWait(kafkaConnectS2i);\n     }\n \n+    @Test\n+    void testKafkaConnectorWithConnectS2IAndConnectWithSameName() {\n+        String topicName = \"test-topic-\" + new Random().nextInt(Integer.MAX_VALUE);\n+        String connectClusterName = \"connect-cluster\";\n+        String connectS2IClusterName = \"connect-s2i-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n+        // Crate connect cluster with default connect image\n+        KafkaConnectS2IResource.kafkaConnectS2I(CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToLabels(\"type\", \"kafka-connect-s2i\")\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata()\n+                .editSpec()\n+                .addToConfig(\"group.id\", connectClusterName)\n+                .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+            .endSpec().done();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61468f0e12f286494fde47d7724324b78a903351"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1NDgyMA==", "bodyText": "That make sense, I will update it.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2453#discussion_r372354820", "createdAt": "2020-01-29T12:30:31Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -332,6 +335,91 @@ void testJvmAndResources() {\n         KafkaConnectS2IResource.deleteKafkaConnectS2IWithoutWait(kafkaConnectS2i);\n     }\n \n+    @Test\n+    void testKafkaConnectorWithConnectS2IAndConnectWithSameName() {\n+        String topicName = \"test-topic-\" + new Random().nextInt(Integer.MAX_VALUE);\n+        String connectClusterName = \"connect-cluster\";\n+        String connectS2IClusterName = \"connect-s2i-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n+        // Crate connect cluster with default connect image\n+        KafkaConnectS2IResource.kafkaConnectS2I(CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToLabels(\"type\", \"kafka-connect-s2i\")\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata()\n+                .editSpec()\n+                .addToConfig(\"group.id\", connectClusterName)\n+                .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+            .endSpec().done();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1NDUyMw=="}, "originalCommit": {"oid": "61468f0e12f286494fde47d7724324b78a903351"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ3MDI2Mg==", "bodyText": "You probably need to test both to ensure the first-created-resource-wins strategy.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2453#discussion_r372470262", "createdAt": "2020-01-29T15:56:51Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -332,6 +335,91 @@ void testJvmAndResources() {\n         KafkaConnectS2IResource.deleteKafkaConnectS2IWithoutWait(kafkaConnectS2i);\n     }\n \n+    @Test\n+    void testKafkaConnectorWithConnectS2IAndConnectWithSameName() {\n+        String topicName = \"test-topic-\" + new Random().nextInt(Integer.MAX_VALUE);\n+        String connectClusterName = \"connect-cluster\";\n+        String connectS2IClusterName = \"connect-s2i-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n+        // Crate connect cluster with default connect image\n+        KafkaConnectS2IResource.kafkaConnectS2I(CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToLabels(\"type\", \"kafka-connect-s2i\")\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata()\n+                .editSpec()\n+                .addToConfig(\"group.id\", connectClusterName)\n+                .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+            .endSpec().done();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1NDUyMw=="}, "originalCommit": {"oid": "61468f0e12f286494fde47d7724324b78a903351"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMjkyMjM1OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo1Mzo0OFrOFjNqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo1Mzo0OFrOFjNqIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2ODI1Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Crate connect cluster with default connect image\n          \n          \n            \n                    // Create connect cluster with default connect image", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2453#discussion_r372468256", "createdAt": "2020-01-29T15:53:48Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -332,6 +335,101 @@ void testJvmAndResources() {\n         KafkaConnectS2IResource.deleteKafkaConnectS2IWithoutWait(kafkaConnectS2i);\n     }\n \n+    @Test\n+    void testKafkaConnectorWithConnectS2IAndConnectWithSameName() {\n+        String topicName = \"test-topic-\" + new Random().nextInt(Integer.MAX_VALUE);\n+        String connectClusterName = \"connect-cluster\";\n+        String connectS2IClusterName = \"connect-s2i-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n+        // Create different connect cluster via S2I resources\n+        KafkaConnectS2IResource.kafkaConnectS2I(CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToLabels(\"type\", \"kafka-connect-s2i\")\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata()\n+                .editSpec()\n+                .addToConfig(\"group.id\", connectClusterName)\n+                .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+            .endSpec().done();\n+\n+        // Crate connect cluster with default connect image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d580813a6c0672e80601bfc7ae9cc2a32f294e3a"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMjkyNDgwOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo1NDoyNVrOFjNrtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo1NDoyNVrOFjNrtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2ODY2Mg==", "bodyText": "Reconciliation of what?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2453#discussion_r372468662", "createdAt": "2020-01-29T15:54:25Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectS2IST.java", "diffHunk": "@@ -332,6 +335,101 @@ void testJvmAndResources() {\n         KafkaConnectS2IResource.deleteKafkaConnectS2IWithoutWait(kafkaConnectS2i);\n     }\n \n+    @Test\n+    void testKafkaConnectorWithConnectS2IAndConnectWithSameName() {\n+        String topicName = \"test-topic-\" + new Random().nextInt(Integer.MAX_VALUE);\n+        String connectClusterName = \"connect-cluster\";\n+        String connectS2IClusterName = \"connect-s2i-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n+        // Create different connect cluster via S2I resources\n+        KafkaConnectS2IResource.kafkaConnectS2I(CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToLabels(\"type\", \"kafka-connect-s2i\")\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata()\n+                .editSpec()\n+                .addToConfig(\"group.id\", connectClusterName)\n+                .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+            .endSpec().done();\n+\n+        // Crate connect cluster with default connect image\n+        KafkaConnectResource.kafkaConnectWithoutWait(KafkaConnectResource.defaultKafkaConnect(CLUSTER_NAME, CLUSTER_NAME, 1)\n+            .editMetadata()\n+                .addToLabels(\"type\", \"kafka-connect\")\n+                .addToAnnotations(\"strimzi.io/use-connector-resources\", \"true\")\n+            .endMetadata()\n+            .editSpec()\n+                .addToConfig(\"group.id\", connectS2IClusterName)\n+                .addToConfig(\"offset.storage.topic\", connectS2IClusterName + \"-offsets\")\n+                .addToConfig(\"config.storage.topic\", connectS2IClusterName + \"-config\")\n+                .addToConfig(\"status.storage.topic\", connectS2IClusterName + \"-status\")\n+            .endSpec().build());\n+\n+        KafkaConnectUtils.waitForConnectStatus(CLUSTER_NAME, \"NotReady\");\n+\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME)\n+            .editSpec()\n+                .withClassName(\"org.apache.kafka.connect.file.FileStreamSinkConnector\")\n+                .addToConfig(\"topics\", topicName)\n+                .addToConfig(\"file\", \"/tmp/test-file-sink.txt\")\n+                .addToConfig(\"key.converter\", \"org.apache.kafka.connect.storage.StringConverter\")\n+                .addToConfig(\"value.converter\", \"org.apache.kafka.connect.storage.StringConverter\")\n+            .endSpec().done();\n+        KafkaConnectUtils.waitForConnectorReady(CLUSTER_NAME);\n+\n+        // Wait for first reconciliation\n+        StUtils.waitForReconciliation(testClass, testName, NAMESPACE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d580813a6c0672e80601bfc7ae9cc2a32f294e3a"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 667, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}