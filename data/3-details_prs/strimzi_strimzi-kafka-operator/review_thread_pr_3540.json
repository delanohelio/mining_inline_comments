{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNDczNDgw", "number": 3540, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDoxMTozMVrOEblvwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDoyNDo1NFrOEbmHAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MzY1NDQxOnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/KafkaRoller.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDoxMTozMVrOHFm3cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDoxMTozMVrOHFm3cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY0MTcxNA==", "bodyText": "Force-rolled suggests something went wrong. But in case of the controller this might be the first actual check of whether it can be restarted because before it was always deferred. So I think this message is right for other pods but not for the controller.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3540#discussion_r475641714", "createdAt": "2020-08-24T14:11:31Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/KafkaRoller.java", "diffHunk": "@@ -346,8 +343,13 @@ private void restartIfNecessary(int podId, RestartContext restartContext)\n             }\n         } catch (ForceableProblem e) {\n             if (restartContext.backOff.done() || e.forceNow) {\n-                log.warn(\"{}: Pod {} will be force-rolled\", reconciliation, podName(podId));\n-                restartAndAwaitReadiness(pod, operationTimeoutMs, TimeUnit.MILLISECONDS);\n+                if (canRoll(allClient, podId, 60_000, TimeUnit.MILLISECONDS)) {\n+                    log.warn(\"{}: Pod {} will be force-rolled\", reconciliation, podName(podId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37dbe54904c82db5798708779049c24eee04c0ad"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MzcxMzk0OnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/KafkaRoller.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDoyNDo1NFrOHFnbYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDoyNDo1NFrOHFnbYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1MDkxNQ==", "bodyText": "This does not make sense to me. You should not respond to ForceableProblem thrown from canRoll by running canRoll again. Maybe canRoll should not throw ForceableProblem then?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3540#discussion_r475650915", "createdAt": "2020-08-24T14:24:54Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/KafkaRoller.java", "diffHunk": "@@ -346,8 +343,13 @@ private void restartIfNecessary(int podId, RestartContext restartContext)\n             }\n         } catch (ForceableProblem e) {\n             if (restartContext.backOff.done() || e.forceNow) {\n-                log.warn(\"{}: Pod {} will be force-rolled\", reconciliation, podName(podId));\n-                restartAndAwaitReadiness(pod, operationTimeoutMs, TimeUnit.MILLISECONDS);\n+                if (canRoll(allClient, podId, 60_000, TimeUnit.MILLISECONDS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37dbe54904c82db5798708779049c24eee04c0ad"}, "originalPosition": 101}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1349, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}