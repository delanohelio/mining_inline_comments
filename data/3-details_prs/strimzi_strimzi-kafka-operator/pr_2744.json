{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjYwODE1", "number": 2744, "title": "Make zoo scaler not need p12 of Cluster Ca in 0.17.0", "bodyText": "Type of change\n\nBugfix\n\nDescription\nThis PR makes sure that the ZookeeperScaler in 0.17.0 does not require the Cluster CA certificate to be available in the P12 form but use it from PEM instead. This makes it easier for users with custom CAs who do not have to manually create the P12 file.\nChecklist\n\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally", "createdAt": "2020-03-23T22:00:44Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2744", "merged": true, "mergeCommit": {"oid": "d49895189a2f8abdf4f770f0cfa436c1b5fd2b14"}, "closed": true, "closedAt": "2020-03-24T11:01:54Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQlmPyAH2gAyMzkyNjYwODE1OjYxODEzMDRiNGVlYzY0Y2VkNmZlYWJhMDQ4YmU1MzZiNWYxOGY2NjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQvvghAH2gAyMzkyNjYwODE1OmJhNDdjYWJlNDE0ZmVkYzBmZDRmZGFhNTU0N2U3OWExNmEwNTc0MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6181304b4eec64ced6feaba048be536b5f18f660", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6181304b4eec64ced6feaba048be536b5f18f660", "committedDate": "2020-03-23T21:57:08Z", "message": "Make sure ZookeeperScler does not need ClusterCa P12 file in 0.17 branch\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4606b65601ba647561922c35b5c104de488ff482", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4606b65601ba647561922c35b5c104de488ff482", "committedDate": "2020-03-23T23:53:56Z", "message": "Fix sportbugs\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDUxNzg4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2744#pullrequestreview-380051788", "createdAt": "2020-03-24T07:26:08Z", "commit": {"oid": "4606b65601ba647561922c35b5c104de488ff482"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNzoyNjowOFrOF6jn_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNzoyNjowOFrOF6jn_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NTQwNw==", "bodyText": "remove commented line", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2744#discussion_r396945407", "createdAt": "2020-03-24T07:26:08Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/ZookeeperScaler.java", "diffHunk": "@@ -64,12 +73,51 @@ protected ZookeeperScaler(Vertx vertx, ZooKeeperAdminProvider zooAdminProvider,\n         this.zooAdminProvider = zooAdminProvider;\n         this.zookeeperConnectionString = zookeeperConnectionString;\n         this.operationTimeoutMs = operationTimeoutMs;\n-        trustStorePassword = new String(Util.decodeFromSecret(clusterCaCertSecret, Ca.CA_STORE_PASSWORD), StandardCharsets.US_ASCII);\n-        trustStoreFile = Util.createFileStore(getClass().getName(), \"p12\", Util.decodeFromSecret(clusterCaCertSecret, Ca.CA_STORE));\n+\n+        // Setup truststore from PEM file in cluster CA secret\n+        // We cannot use P12 because of custom CAs which for simplicity provide only PEM\n+        PasswordGenerator pg = new PasswordGenerator(12);\n+        trustStorePassword = pg.generate();\n+        trustStoreFile = setupTrustStore(getClass().getName(), \"p12\", trustStorePassword.toCharArray(), Ca.cert(clusterCaCertSecret, Ca.CA_CRT));\n+        //trustStoreFile = Util.createFileStore(getClass().getName(), \"p12\", Util.decodeFromSecret(clusterCaCertSecret, Ca.CA_STORE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4606b65601ba647561922c35b5c104de488ff482"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba47cabe414fedc0fd4fdaa5547e79a16a057404", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ba47cabe414fedc0fd4fdaa5547e79a16a057404", "committedDate": "2020-03-24T09:46:18Z", "message": "Review comments I\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2128, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}