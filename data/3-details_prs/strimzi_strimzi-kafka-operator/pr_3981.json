{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MDYyMDgx", "number": 3981, "title": "[DOC] Guidelines for downgrade", "bodyText": "Signed-off-by: prmellor pmellor@redhat.com\nDocumentation\nNew section in the Deploying and Upgrading guide to provide guidance on how to revert to previous versions of Operators and Kafka.\nDescribed in two stages like the upgrade: Cluster Operator, then Kafka downgrade (optionally). The CO procedure reverses the upgrade steps. Downgrade of Kafka mentions reverting genericKafkaListener as a step (but no mention of API versions).\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-11-19T16:06:32Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981", "merged": true, "mergeCommit": {"oid": "727a0f3e303a31f6d2108b3d861e093c23fc16ed"}, "closed": true, "closedAt": "2021-01-06T23:21:16Z", "author": {"login": "PaulRMellor"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeE956AH2gAyNTI0MDYyMDgxOjA1NzFjY2Y1MzNlN2M2MDdhZmY3ZmMwNjNkZmE0ZDlmMzZjOTVhNmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtIsJIgH2gAyNTI0MDYyMDgxOmVmNTQwZTU1MDY4NzU4Mjk4MDIzMDk4YmYxNmE0NjFmNmE3M2RhY2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0571ccf533e7c607aff7fc063dfa4d9f36c95a6c", "committedDate": "2020-11-19T16:02:12Z", "message": "[DOC] Guidelines for downgrade\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjE4NDM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-534618435", "createdAt": "2020-11-19T16:21:20Z", "commit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjoyMToyMFrOH2mpIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjoyMToyMFrOH2mpIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxODI3NA==", "bodyText": "Should this still be here?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r527018274", "createdAt": "2020-11-19T16:21:20Z", "author": {"login": "scholzj"}, "path": "documentation/assemblies/upgrading/assembly-downgrade-kafka-versions.adoc", "diffHunk": "@@ -1,20 +1,13 @@\n // This assembly is included in the following assemblies:\n //\n-// assembly-upgrade.adoc\n-\n-\n-[id='assembly-downgrading-kafka-versions-{context}']\n+// assembly-downgrade.adoc\n \n+[id='assembly-downgrade-kafka-versions-{context}']\n = Downgrading Kafka\n \n Kafka version downgrades are performed using the Cluster Operator.\n \n-Whether and how the Cluster Operator performs a downgrade depends on the differences between versions of:\n-\n-* Interbroker protocol\n-* Log message format\n-* ZooKeeper\n-\n+//Version constraints on the downgrade", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzYxNTY4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-535361568", "createdAt": "2020-11-20T11:51:05Z", "commit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTo1MTowNVrOH3MoPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTo1ODoxMlrOH3M1yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0MDYzOA==", "bodyText": "Suggested change:\nperformed by the Cluster Operator.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r527640638", "createdAt": "2020-11-20T11:51:05Z", "author": {"login": "laidan6000"}, "path": "documentation/assemblies/upgrading/assembly-downgrade-kafka-versions.adoc", "diffHunk": "@@ -1,20 +1,13 @@\n // This assembly is included in the following assemblies:\n //\n-// assembly-upgrade.adoc\n-\n-\n-[id='assembly-downgrading-kafka-versions-{context}']\n+// assembly-downgrade.adoc\n \n+[id='assembly-downgrade-kafka-versions-{context}']\n = Downgrading Kafka\n \n Kafka version downgrades are performed using the Cluster Operator.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0MTU3Mg==", "bodyText": "I'm not sure about the square bracket convention here. Perhaps bold is better?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r527641572", "createdAt": "2020-11-20T11:53:01Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-downgrade-brokers-older-kafka.adoc", "diffHunk": "@@ -8,30 +8,11 @@\n \n This procedure describes how you can downgrade a Strimzi Kafka cluster to a lower (previous) version of Kafka, such as downgrading from {KafkaVersionHigher} to {KafkaVersionLower}.\n \n-[IMPORTANT]\n-====\n-Downgrading is _not possible_ if the new version has ever used a `log.message.format.version` that is not supported by the previous version, including when the default value for `log.message.format.version` is used. For example, this resource can be downgraded to Kafka version {KafkaVersionLower} because the `log.message.format.version` has not been changed:\n-\n-[source,yaml,subs=attributes+]\n-----\n-apiVersion: v1alpha1\n-kind: Kafka\n-spec:\n-  # ...\n-  kafka:\n-    version: {KafkaVersionHigher}\n-    config:\n-      log.message.format.version: \"{LogMsgVersLower}\"\n-      # ...\n-----\n-\n-The downgrade would not be possible if the `log.message.format.version` was set at `\"{LogMsgVersHigher}\"` or a value was absent (so that the parameter took the default value for a {KafkaVersionHigher} broker of {LogMsgVersHigher}).\n-====\n-\n .Prerequisites\n \n For the `Kafka` resource to be downgraded, check:\n \n+* [IMPORTANT] xref:com-target-downgrade-version-{context}[Compatibility of Kafka versions].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0MjI1MQ==", "bodyText": "Suggested change:\nUse the same wording in lines 17 and 18:\nKafka version being downgraded to", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r527642251", "createdAt": "2020-11-20T11:54:25Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-downgrade-brokers-older-kafka.adoc", "diffHunk": "@@ -8,30 +8,11 @@\n \n This procedure describes how you can downgrade a Strimzi Kafka cluster to a lower (previous) version of Kafka, such as downgrading from {KafkaVersionHigher} to {KafkaVersionLower}.\n \n-[IMPORTANT]\n-====\n-Downgrading is _not possible_ if the new version has ever used a `log.message.format.version` that is not supported by the previous version, including when the default value for `log.message.format.version` is used. For example, this resource can be downgraded to Kafka version {KafkaVersionLower} because the `log.message.format.version` has not been changed:\n-\n-[source,yaml,subs=attributes+]\n-----\n-apiVersion: v1alpha1\n-kind: Kafka\n-spec:\n-  # ...\n-  kafka:\n-    version: {KafkaVersionHigher}\n-    config:\n-      log.message.format.version: \"{LogMsgVersLower}\"\n-      # ...\n-----\n-\n-The downgrade would not be possible if the `log.message.format.version` was set at `\"{LogMsgVersHigher}\"` or a value was absent (so that the parameter took the default value for a {KafkaVersionHigher} broker of {LogMsgVersHigher}).\n-====\n-\n .Prerequisites\n \n For the `Kafka` resource to be downgraded, check:\n \n+* [IMPORTANT] xref:com-target-downgrade-version-{context}[Compatibility of Kafka versions].\n * The Cluster Operator, which supports both versions of Kafka, is up and running.\n * The `Kafka.spec.kafka.config` does not contain options that are not supported in the version of Kafka you are downgrading to.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0MzI1NQ==", "bodyText": "I would just remove \"What to do next\" from this module.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r527643255", "createdAt": "2020-11-20T11:56:22Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-upgrade-cluster-operator.adoc", "diffHunk": "@@ -52,4 +52,4 @@ You now have an updated Cluster Operator, but the version of Kafka running in th\n \n .What to do next\n \n-Following the Cluster Operator upgrade, you can perform a xref:assembly-upgrading-kafka-versions-str[Kafka upgrade].\n+Following the Cluster Operator upgrade, you can perform a xref:assembly-upgrading-kafka-versions-str[Kafka downgrade].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0NDEwNA==", "bodyText": "You can or you must?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r527644104", "createdAt": "2020-11-20T11:58:12Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-downgrade-cluster-operator.adoc", "diffHunk": "@@ -0,0 +1,51 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-downgrade.adoc\n+\n+[id='proc-downgrade-cluster-operator-{context}']\n+= Downgrading the Cluster Operator to a previous version\n+\n+This procedure describes how to downgrade a Cluster Operator deployment to a previous version.\n+\n+.Prerequisites\n+\n+* An existing Cluster Operator deployment is available.\n+* You have xref:downloads-{context}[downloaded the installation files for the previous version].\n+\n+.Procedure\n+\n+. Take note of any configuration changes made to the existing Cluster Operator resources (in the `/install/cluster-operator` directory).\n+Any changes will be *overwritten* by the previous version of the Cluster Operator.\n+\n+. Update the Cluster Operator.\n+\n+.. Modify the installation files for the previous version according to the namespace the Cluster Operator is running in.\n++\n+include::snip-cluster-operator-namespace-sed.adoc[]\n++\n+.. If you modified one or more environment variables in your existing Cluster Operator `Deployment`, edit the\n+`install/cluster-operator/060-Deployment-cluster-operator.yaml` file to use those environment variables.\n+\n+. When you have an updated configuration, deploy it along with the rest of the installation resources:\n++\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+kubectl apply -f install/cluster-operator\n+----\n++\n+Wait for the rolling updates to complete.\n+\n+. Get the image for the Kafka pod to ensure the downgrade was successful:\n++\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+kubectl get po my-cluster-kafka-0 -o jsonpath='{.spec.containers[0].image}'\n+----\n++\n+The image tag shows the new Strimzi version followed by the Kafka version. For example, `_NEW-STRIMZI-VERSION_-kafka-_CURRENT-KAFKA-VERSION_`.\n+\n+You now have an updated Cluster Operator, but the version of Kafka running in the cluster it manages is unchanged.\n+\n+.What to do next\n+\n+Following the Cluster Operator downgrade, you can perform a xref:assembly-downgrade-kafka-versions-{context}[Kafka downgrade].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0571ccf533e7c607aff7fc063dfa4d9f36c95a6c"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b67586c573bf4156f2d3b2bb3b4db024981fe83f", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b67586c573bf4156f2d3b2bb3b4db024981fe83f", "committedDate": "2020-11-20T17:06:07Z", "message": "review edits DL\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2Mzk5ODA3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-536399807", "createdAt": "2020-11-23T11:48:51Z", "commit": {"oid": "b67586c573bf4156f2d3b2bb3b4db024981fe83f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMTo0ODo1MVrOH4KCMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMTo0ODo1MVrOH4KCMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY0NjcwNg==", "bodyText": "This is not correct. The operator currently takes charge of the interbroker protocol, and updates it automatically. That means that the user cannot safely downgrade the brokers, even if they didn't complete the upgrade. I.e. once they've started to upgrade the Kafka cluster then they can't currently safely back out. They can upgrade and downgrade the operator.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r528646706", "createdAt": "2020-11-23T11:48:51Z", "author": {"login": "tombentley"}, "path": "documentation/assemblies/upgrading/assembly-downgrade.adoc", "diffHunk": "@@ -0,0 +1,26 @@\n+// This assembly is included in the following assemblies:\n+//\n+// deploying/master.adoc\n+\n+[id='assembly-downgrade-{context}']\n+= Downgrading Strimzi\n+\n+If you are encountering issues with the latest version of Strimzi,\n+you can revert your installation to the previous version.\n+\n+As with the Strimzi upgrade process, you can perform your downgrade in two stages:\n+\n+. Revert your Cluster Operator to the previous Strimzi version.\n+** xref:proc-downgrade-cluster-operator-{context}[]\n+\n+. Downgrade all Kafka brokers and client applications to the previous Kafka version.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b67586c573bf4156f2d3b2bb3b4db024981fe83f"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a000f70e889c31d2c400072b41c53a0033a9dd2", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2a000f70e889c31d2c400072b41c53a0033a9dd2", "committedDate": "2020-11-25T12:07:38Z", "message": "remove kafka downgrade sections\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNzA4MDM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-540708035", "createdAt": "2020-11-30T09:01:03Z", "commit": {"oid": "2a000f70e889c31d2c400072b41c53a0033a9dd2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowMTowM1rOH7xYpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowMjoyM1rOH7xbxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzNzE1OA==", "bodyText": "It's not just this, it's used to gate other persistent data too (such as the versions of JSON persisted in zookeeper).", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r532437158", "createdAt": "2020-11-30T09:01:03Z", "author": {"login": "tombentley"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -4,15 +4,40 @@\n \n [id='com-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added\n+to message logs that use a newer `log.message.format.version`.\n+\n+The `inter.broker.protocol.version` determines the schema used in the messages written to `__consumer_offsets`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a000f70e889c31d2c400072b41c53a0033a9dd2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzNzk1OQ==", "bodyText": "While that's true, it doesn't inform the reader about what the consequences of that will be. We should be clear that, in general, it  basically results in a \"broker cluster\". The rest of this concept then goes into detailed talk about the log message format version which could easily mislead people into thinking this sentence is not really a problem. I think we should probably omit the following sentences because they're mostly irrelevant due to a broker cluster generally being a \"game over\" situation.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r532437959", "createdAt": "2020-11-30T09:02:23Z", "author": {"login": "tombentley"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -4,15 +4,40 @@\n \n [id='com-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added\n+to message logs that use a newer `log.message.format.version`.\n+\n+The `inter.broker.protocol.version` determines the schema used in the messages written to `__consumer_offsets`.\n+If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the broker will not understand the messages.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a000f70e889c31d2c400072b41c53a0033a9dd2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/365b588a20010b605b8a81b0a126a7d53ca97d8c", "committedDate": "2020-11-30T15:36:35Z", "message": "review edits TB\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNjMxODkz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-542631893", "createdAt": "2020-12-02T09:15:07Z", "commit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOToxNTowOFrOH9RPNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOToyNTo0NlrOH9Rsag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAwNzYwNg==", "bodyText": "The latest version of Strimzi sounds weird given the documentation is for the latest Strimzi version for a month or two but then it is for some older version but might be still use. Can we maybe rephrase it to say something like If you are encountering issues with the version of Strimzi you upgraded to?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r534007606", "createdAt": "2020-12-02T09:15:08Z", "author": {"login": "scholzj"}, "path": "documentation/assemblies/upgrading/assembly-downgrade.adoc", "diffHunk": "@@ -0,0 +1,26 @@\n+// This assembly is included in the following assemblies:\n+//\n+// deploying/master.adoc\n+\n+[id='assembly-downgrade-{context}']\n+= Downgrading Strimzi\n+\n+If you are encountering issues with the latest version of Strimzi,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxMTQxOQ==", "bodyText": "I think this will be confusing ... saying it happens in two stages for me gives it a particular order. But the order is not so simple. For example, I'm running Strimzi 0.19.0 with Kafka 2.5. And I upgrade first to Strimzi 0.20 + Kafka 2.5 and then to Kafka 2.6. In that case, the order here is actually first to downgrade Kafka 2.6 to 2.5 if still possible and then to downgrade Strimzi 0.20 to 0.19.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r534011419", "createdAt": "2020-12-02T09:20:32Z", "author": {"login": "scholzj"}, "path": "documentation/assemblies/upgrading/assembly-downgrade.adoc", "diffHunk": "@@ -0,0 +1,26 @@\n+// This assembly is included in the following assemblies:\n+//\n+// deploying/master.adoc\n+\n+[id='assembly-downgrade-{context}']\n+= Downgrading Strimzi\n+\n+If you are encountering issues with the latest version of Strimzi,\n+you can revert your installation to the previous version.\n+\n+As with the Strimzi upgrade process, you can perform your downgrade in two stages:\n+\n+. Revert your Cluster Operator to the previous Strimzi version.\n+** xref:proc-downgrade-cluster-operator-{context}[]\n+\n+. Downgrade all Kafka brokers and client applications to the previous Kafka version.\n+** xref:assembly-downgrade-kafka-versions-{context}[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNDIzNQ==", "bodyText": "This has to be part of the Cluster Operator downgrade. It does not have to be changed with Kafka downgrade. The operator supports the new format with any Kafka version it supports.\nI also wonder if we should make it more generic: Revert any changes to the CRs or something. As there are more new things in each release. E.g. rack awareness in Connect, host aliases and other things are not supported after the operator downgrade and need to be removed. So making it more generic would be IMHO a plus.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r534014235", "createdAt": "2020-12-02T09:24:38Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/proc-downgrade-brokers-older-kafka.adoc", "diffHunk": "@@ -70,6 +51,11 @@ NOTE: You must format the value of `log.message.format.version` as a string to p\n +\n See xref:con-versions-and-images-str[]\n \n+.. If you changed the Kafka listener configuration to use the array format of the `GenericKafkaListener` schema,\n+revert the `Kafka.spec.kafka.listeners` to use the old format.\n++\n+See xref:con-upgrade-listeners-str[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNDUxOQ==", "bodyText": "Same as earlier ... the latest version sounds weird and confusing here.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r534014519", "createdAt": "2020-12-02T09:25:01Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/proc-downgrade-cluster-operator.adoc", "diffHunk": "@@ -0,0 +1,50 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-downgrade.adoc\n+\n+[id='proc-downgrade-cluster-operator-{context}']\n+= Downgrading the Cluster Operator to a previous version\n+\n+If you are encountering issues with the latest version of Strimzi,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNTA4Mg==", "bodyText": "Is this because of the inter.broker.protocol.version? Or why is it the case?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r534015082", "createdAt": "2020-12-02T09:25:46Z", "author": {"login": "scholzj"}, "path": "documentation/modules/upgrading/proc-upgrade-brokers-newer-kafka.adoc", "diffHunk": "@@ -67,6 +68,10 @@ spec:\n ----\n <1> This is changed to the new version\n <2> This remains at the current version\n+--\n++\n+WARNING: You cannot downgrade Kafka once `spec.kafka.version` has changed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365b588a20010b605b8a81b0a126a7d53ca97d8c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e50e52b6abdf4302b6b581400f31fdd4f395bac", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8e50e52b6abdf4302b6b581400f31fdd4f395bac", "committedDate": "2020-12-02T17:36:07Z", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d312c15e5a911bb24d2d5bd501ce0e7f0b56069a", "committedDate": "2020-12-02T18:00:02Z", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDc4NDQ2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-544078446", "createdAt": "2020-12-03T15:29:09Z", "commit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0OTA0MjE0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-544904214", "createdAt": "2020-12-04T12:09:55Z", "commit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjowOTo1NVrOH_OLBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjoyNTowMVrOH_Oq0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NDUzNQ==", "bodyText": "Just checking that the correct module is included in the master.adoc?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r536054535", "createdAt": "2020-12-04T12:09:55Z", "author": {"login": "laidan6000"}, "path": "documentation/deploying/master.adoc", "diffHunk": "@@ -20,3 +20,5 @@ include::assemblies/deploying/assembly-deploy-verify.adoc[leveloffset=+1]\n include::assemblies/metrics/assembly-metrics.adoc[leveloffset=+1]\n //Upgrading the deployment\n include::assemblies/upgrading/assembly-upgrade.adoc[leveloffset=+1]\n+//Downgrading the deployment\n+include::modules/upgrading/proc-downgrade-cluster-operator.adoc[leveloffset=+1]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NzMzNQ==", "bodyText": "In Strimzi 0.19.0, this file is named 050-Deployment-strimzi-cluster-operator.yaml.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r536057335", "createdAt": "2020-12-04T12:15:14Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-downgrade-cluster-operator.adoc", "diffHunk": "@@ -0,0 +1,52 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-downgrade.adoc\n+\n+[id='proc-downgrade-cluster-operator-{context}']\n+= Downgrading the Cluster Operator to a previous version\n+\n+If you are encountering issues with Strimzi,\n+you can revert your installation.\n+\n+This procedure describes how to downgrade a Cluster Operator deployment to a previous version.\n+\n+.Prerequisites\n+\n+* An existing Cluster Operator deployment is available.\n+* You have xref:downloads-{context}[downloaded the installation files for the previous version].\n+\n+.Procedure\n+\n+. Take note of any configuration changes made to the existing Cluster Operator resources (in the `/install/cluster-operator` directory).\n+Any changes will be *overwritten* by the previous version of the Cluster Operator.\n++\n+. Revert your custom resources to reflect the supported configuration options available for the version of Strimzi you are downgrading to.\n+\n+. Update the Cluster Operator.\n+\n+.. Modify the installation files for the previous version according to the namespace the Cluster Operator is running in.\n++\n+include::snip-cluster-operator-namespace-sed.adoc[]\n++\n+.. If you modified one or more environment variables in your existing Cluster Operator `Deployment`, edit the\n+`install/cluster-operator/060-Deployment-cluster-operator.yaml` file to use those environment variables.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1ODI2Mg==", "bodyText": "Suggested change:\nYour Cluster Operator was downgraded to the previous version.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r536058262", "createdAt": "2020-12-04T12:17:01Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-downgrade-cluster-operator.adoc", "diffHunk": "@@ -0,0 +1,52 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-downgrade.adoc\n+\n+[id='proc-downgrade-cluster-operator-{context}']\n+= Downgrading the Cluster Operator to a previous version\n+\n+If you are encountering issues with Strimzi,\n+you can revert your installation.\n+\n+This procedure describes how to downgrade a Cluster Operator deployment to a previous version.\n+\n+.Prerequisites\n+\n+* An existing Cluster Operator deployment is available.\n+* You have xref:downloads-{context}[downloaded the installation files for the previous version].\n+\n+.Procedure\n+\n+. Take note of any configuration changes made to the existing Cluster Operator resources (in the `/install/cluster-operator` directory).\n+Any changes will be *overwritten* by the previous version of the Cluster Operator.\n++\n+. Revert your custom resources to reflect the supported configuration options available for the version of Strimzi you are downgrading to.\n+\n+. Update the Cluster Operator.\n+\n+.. Modify the installation files for the previous version according to the namespace the Cluster Operator is running in.\n++\n+include::snip-cluster-operator-namespace-sed.adoc[]\n++\n+.. If you modified one or more environment variables in your existing Cluster Operator `Deployment`, edit the\n+`install/cluster-operator/060-Deployment-cluster-operator.yaml` file to use those environment variables.\n+\n+. When you have an updated configuration, deploy it along with the rest of the installation resources:\n++\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+kubectl apply -f install/cluster-operator\n+----\n++\n+Wait for the rolling updates to complete.\n+\n+. Get the image for the Kafka pod to ensure the downgrade was successful:\n++\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+kubectl get po my-cluster-kafka-0 -o jsonpath='{.spec.containers[0].image}'\n+----\n++\n+The image tag shows the new Strimzi version followed by the Kafka version. For example, `_NEW-STRIMZI-VERSION_-kafka-_CURRENT-KAFKA-VERSION_`.\n+\n+You now have an updated Cluster Operator.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1OTAzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            WARNING: You cannot downgrade Kafka once `spec.kafka.version` has changed, as the `inter.broker.protocol.version` for the new Kafka version will differ. The protocol version determines the schemas used for persistent metadata stored by the broker, including messages written to `__consumer_offsets`. The cluster will not understand the messages.\n          \n          \n            \n            WARNING: You cannot downgrade Kafka after `spec.kafka.version` has changed, because the `inter.broker.protocol.version` for the new Kafka version will differ. The inter-broker protocol version determines the schemas used for persistent metadata stored by the broker, including messages written to `__consumer_offsets`. The downgraded cluster will not understand the messages.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r536059031", "createdAt": "2020-12-04T12:18:29Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/proc-upgrade-brokers-newer-kafka.adoc", "diffHunk": "@@ -67,6 +68,9 @@ spec:\n ----\n <1> This is changed to the new version\n <2> This remains at the current version\n+--\n++\n+WARNING: You cannot downgrade Kafka once `spec.kafka.version` has changed, as the `inter.broker.protocol.version` for the new Kafka version will differ. The protocol version determines the schemas used for persistent metadata stored by the broker, including messages written to `__consumer_offsets`. The cluster will not understand the messages.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1OTQ3OQ==", "bodyText": "Typo in module ID: con.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r536059479", "createdAt": "2020-12-04T12:19:19Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -4,15 +4,40 @@\n \n [id='com-target-downgrade-version-{context}']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2MjY3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the cluster will not work as it will not understand the messages.\n          \n          \n            \n            If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the cluster will not work because it will not understand the messages.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r536062673", "createdAt": "2020-12-04T12:25:01Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -4,15 +4,40 @@\n \n [id='com-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added\n+to message logs that use a newer `log.message.format.version`.\n+\n+The `inter.broker.protocol.version` determines the schemas used for persistent metadata stored by the broker, such as the schema for messages written to `__consumer_offsets`.\n+If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the cluster will not work as it will not understand the messages.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d312c15e5a911bb24d2d5bd501ce0e7f0b56069a"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b33df6773492c654f46c825ffc18f00ee22d189", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7b33df6773492c654f46c825ffc18f00ee22d189", "committedDate": "2020-12-07T13:51:42Z", "message": "review edits DL\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MjQyODQ0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-546242844", "createdAt": "2020-12-07T15:11:30Z", "commit": {"oid": "7b33df6773492c654f46c825ffc18f00ee22d189"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ea3fdcfecd766c051fcddbcd5218ebe9f6a213e", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7ea3fdcfecd766c051fcddbcd5218ebe9f6a213e", "committedDate": "2020-12-07T16:27:30Z", "message": "typo fix\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfb1b7c989f76d96619d0bed5bf09ba862216c0f", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/dfb1b7c989f76d96619d0bed5bf09ba862216c0f", "committedDate": "2020-12-09T12:00:56Z", "message": "review edits - reintroducing downgrade of kafka\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDM3MzQ0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-550037344", "createdAt": "2020-12-11T11:58:48Z", "commit": {"oid": "dfb1b7c989f76d96619d0bed5bf09ba862216c0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMTo1ODo0OFrOID1wGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMTo1ODo0OFrOID1wGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg5NzMwNw==", "bodyText": "@tombentley - we do the check on the Kafka pod for the CO upgrade?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r540897307", "createdAt": "2020-12-11T11:58:48Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/upgrading/proc-upgrade-cluster-operator.adoc", "diffHunk": "@@ -42,14 +44,12 @@ Wait for the rolling updates to complete.\n kubectl get po my-cluster-kafka-0 -o jsonpath='{.spec.containers[0].image}'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb1b7c989f76d96619d0bed5bf09ba862216c0f"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMjE5NDAy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-550219402", "createdAt": "2020-12-11T15:51:51Z", "commit": {"oid": "dfb1b7c989f76d96619d0bed5bf09ba862216c0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNTo1MTo1MVrOID-w9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNTo1MTo1MVrOID-w9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA0NDk4MQ==", "bodyText": "@scholzj api version check on the upgrade and downgrade procedures. We have v1alpha1 in our examples", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r541044981", "createdAt": "2020-12-11T15:51:51Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -2,17 +2,42 @@\n //\n // assembly-downgrading-kafka-versions.adoc\n \n-[id='com-target-downgrade-version-{context}']\n+[id='con-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added\n+to message logs that use a newer `log.message.format.version`.\n+\n+The `inter.broker.protocol.version` determines the schemas used for persistent metadata stored by the broker, such as the schema for messages written to `__consumer_offsets`.\n+If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the cluster will not work because it will not understand the messages.\n+\n+If the target downgrade version of Kafka has:\n+\n+* The _same_ `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n+* A _different_ `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n This is typically only the case if the upgrade procedure was aborted before the `log.message.format.version` was changed.\n In this case, the downgrade requires:\n-+\n+\n ** Two rolling restarts of the brokers if the interbroker protocol of the two versions is different\n ** A single rolling restart if they are the same\n+\n+Downgrading is _not possible_ if the new version has ever used a `log.message.format.version` that is not supported by the previous version, including when the default value for `log.message.format.version` is used. For example, this resource can be downgraded to Kafka version {KafkaVersionLower} because the `log.message.format.version` has not been changed:\n+\n+[source,yaml,subs=attributes+]\n+----\n+apiVersion: v1alpha1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb1b7c989f76d96619d0bed5bf09ba862216c0f"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0672d30067060e134de191823bdcb40d886e4107", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0672d30067060e134de191823bdcb40d886e4107", "committedDate": "2020-12-11T16:12:21Z", "message": "review edits MT\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de6657af322fec9b639853295abcab2ba2264e85", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/de6657af322fec9b639853295abcab2ba2264e85", "committedDate": "2020-12-15T17:03:00Z", "message": "review edits - api version update\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Mzg5ODQ4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-554389848", "createdAt": "2020-12-17T08:51:21Z", "commit": {"oid": "de6657af322fec9b639853295abcab2ba2264e85"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwODo1MToyMlrOIHq3wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwODo1NzoyMlrOIHrGqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkxMzM0NQ==", "bodyText": "An \"earlier IBP\" isn't quite the right language. Each version of Kafka supports a range of IBPs, so \"earlier\" is a little ambiguous (it could be taken to mean earlier in the range of IBPs supported by a particular version).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the cluster will not work because it will not understand the messages.\n          \n          \n            \n            If you downgrade to a version of Kafka that doesn't understand an `inter.broker.protocol.version` that has (ever) been previously used in the cluster the broker will encounter data they cannot understand.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r544913345", "createdAt": "2020-12-17T08:51:22Z", "author": {"login": "tombentley"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -2,17 +2,42 @@\n //\n // assembly-downgrading-kafka-versions.adoc\n \n-[id='com-target-downgrade-version-{context}']\n+[id='con-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added\n+to message logs that use a newer `log.message.format.version`.\n+\n+The `inter.broker.protocol.version` determines the schemas used for persistent metadata stored by the broker, such as the schema for messages written to `__consumer_offsets`.\n+If you downgrade to a version of Kafka that uses an earlier `inter.broker.protocol.version`, the cluster will not work because it will not understand the messages.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de6657af322fec9b639853295abcab2ba2264e85"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkxNDQxMg==", "bodyText": "This sentence on its own (I know is clarified in a couple of sentences time) might make the reader think they can just change the IBP first.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added\n          \n          \n            \n            You cannot revert to the previous Kafka version if that version don't support any of the `inter.broker.protocol.version` settings which have ever been used in that cluster, or messages have been added", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r544914412", "createdAt": "2020-12-17T08:53:08Z", "author": {"login": "tombentley"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -2,17 +2,42 @@\n //\n // assembly-downgrading-kafka-versions.adoc\n \n-[id='com-target-downgrade-version-{context}']\n+[id='con-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if the `inter.broker.protocol.version` differs, or messages have been added", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de6657af322fec9b639853295abcab2ba2264e85"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkxNzE2Mw==", "bodyText": "Still not understanding this. get po and get pod are the same thing. Or are you referring to the quay.io/strimzi/operator:latest% bit?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r544917163", "createdAt": "2020-12-17T08:57:22Z", "author": {"login": "tombentley"}, "path": "documentation/modules/upgrading/proc-upgrade-cluster-operator.adoc", "diffHunk": "@@ -42,14 +44,12 @@ Wait for the rolling updates to complete.\n kubectl get po my-cluster-kafka-0 -o jsonpath='{.spec.containers[0].image}'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg5NzMwNw=="}, "originalCommit": {"oid": "dfb1b7c989f76d96619d0bed5bf09ba862216c0f"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b47a1467c5c70ce86975285d2aa6ce9c7e42b83c", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b47a1467c5c70ce86975285d2aa6ce9c7e42b83c", "committedDate": "2020-12-21T17:47:37Z", "message": "review edits TB\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTczOTc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#pullrequestreview-556973976", "createdAt": "2020-12-22T10:24:19Z", "commit": {"oid": "b47a1467c5c70ce86975285d2aa6ce9c7e42b83c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDoyNDoxOVrOIJ2GIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDoyNDoxOVrOIJ2GIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE5NDQwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You cannot revert to the previous Kafka version if that version don't support any of the `inter.broker.protocol.version` settings which have ever been used in that cluster,\n          \n          \n            \n            You cannot revert to the previous Kafka version if that version don't support any of the `inter.broker.protocol.version` settings which have _ever been used_ in that cluster,", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3981#discussion_r547194400", "createdAt": "2020-12-22T10:24:19Z", "author": {"login": "tombentley"}, "path": "documentation/modules/upgrading/con-downgrade-target-version.adoc", "diffHunk": "@@ -2,17 +2,42 @@\n //\n // assembly-downgrading-kafka-versions.adoc\n \n-[id='com-target-downgrade-version-{context}']\n+[id='con-target-downgrade-version-{context}']\n \n-= Target downgrade version\n+= Kafka version compatibility for downgrades\n \n-How the Cluster Operator handles a downgrade operation depends on the `log.message.format.version`.\n+Kafka downgrades are dependent on compatible current and target xref:ref-kafka-versions-{context}[Kafka versions],\n+and the state at which messages have been logged.\n \n-* If the target downgrade version of Kafka has the same `log.message.format.version` as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.\n-* If the target downgrade version of Kafka has a different `log.message.format.version`, downgrading is only possible if the running cluster has _always_ had `log.message.format.version` set to the version used by the downgraded version.\n-+\n+You cannot revert to the previous Kafka version if that version don't support any of the `inter.broker.protocol.version` settings which have ever been used in that cluster,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b47a1467c5c70ce86975285d2aa6ce9c7e42b83c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bc77af9711dddd7731edfd9be91ac8ff80297ea", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5bc77af9711dddd7731edfd9be91ac8ff80297ea", "committedDate": "2021-01-05T10:04:07Z", "message": "review edits TB\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef540e55068758298023098bf16a461f6a73dace", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ef540e55068758298023098bf16a461f6a73dace", "committedDate": "2021-01-05T10:51:17Z", "message": "build fix -- contraction\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 660, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}