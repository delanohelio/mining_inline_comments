{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjAzMTQ2", "number": 3528, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNDozNTozOFrOEaAfUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozOTo0NVrOEaGqbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NzA2NDQ4OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNDozNTozOFrOHDKavQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNDo1MDowN1rOHDLFFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3ODQ2MQ==", "bodyText": "Question: Why do we use kubectl commands over using the fabric8 api?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473078461", "createdAt": "2020-08-19T14:35:38Z", "author": {"login": "samuel-hawker"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -421,12 +421,10 @@ protected void verifyLabelsOnPods(String clusterName, String podType, String app\n \n     void verifyLabelsForCRDs() {\n         LOGGER.info(\"Verifying labels for CRDs\");\n-        kubeClient().listCustomResourceDefinition().stream()\n-            .filter(crd -> crd.getMetadata().getName().startsWith(\"kafka\"))\n-            .forEach(crd -> {\n-                LOGGER.info(\"Verifying labels for custom resource {}\", crd.getMetadata().getName());\n-                assertThat(crd.getMetadata().getLabels().get(\"app\"), is(\"strimzi\"));\n-            });\n+        String crds = cmdKubeClient().exec(\"get\", \"crds\", \"--selector=app=strimzi\", \"-o\", \"jsonpath='{.items[*].metadata.name}'\").out();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3OTgwNg==", "bodyText": "As I mentioned in description, the only problem here was that f8 returns this exception: https://gist.github.com/im-konge/2c184783f0f3daebb4e5e4e89b6d5b07", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473079806", "createdAt": "2020-08-19T14:37:21Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -421,12 +421,10 @@ protected void verifyLabelsOnPods(String clusterName, String podType, String app\n \n     void verifyLabelsForCRDs() {\n         LOGGER.info(\"Verifying labels for CRDs\");\n-        kubeClient().listCustomResourceDefinition().stream()\n-            .filter(crd -> crd.getMetadata().getName().startsWith(\"kafka\"))\n-            .forEach(crd -> {\n-                LOGGER.info(\"Verifying labels for custom resource {}\", crd.getMetadata().getName());\n-                assertThat(crd.getMetadata().getLabels().get(\"app\"), is(\"strimzi\"));\n-            });\n+        String crds = cmdKubeClient().exec(\"get\", \"crds\", \"--selector=app=strimzi\", \"-o\", \"jsonpath='{.items[*].metadata.name}'\").out();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3ODQ2MQ=="}, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MDQ3Mw==", "bodyText": "So after @stanlyDoge upgrade the fabric8 to new version, I hope it will be fixed and this will be changed back", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473080473", "createdAt": "2020-08-19T14:38:11Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -421,12 +421,10 @@ protected void verifyLabelsOnPods(String clusterName, String podType, String app\n \n     void verifyLabelsForCRDs() {\n         LOGGER.info(\"Verifying labels for CRDs\");\n-        kubeClient().listCustomResourceDefinition().stream()\n-            .filter(crd -> crd.getMetadata().getName().startsWith(\"kafka\"))\n-            .forEach(crd -> {\n-                LOGGER.info(\"Verifying labels for custom resource {}\", crd.getMetadata().getName());\n-                assertThat(crd.getMetadata().getLabels().get(\"app\"), is(\"strimzi\"));\n-            });\n+        String crds = cmdKubeClient().exec(\"get\", \"crds\", \"--selector=app=strimzi\", \"-o\", \"jsonpath='{.items[*].metadata.name}'\").out();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3ODQ2MQ=="}, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4OTMwMg==", "bodyText": "Absolutely, sorry missed the description :P", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473089302", "createdAt": "2020-08-19T14:50:07Z", "author": {"login": "samuel-hawker"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -421,12 +421,10 @@ protected void verifyLabelsOnPods(String clusterName, String podType, String app\n \n     void verifyLabelsForCRDs() {\n         LOGGER.info(\"Verifying labels for CRDs\");\n-        kubeClient().listCustomResourceDefinition().stream()\n-            .filter(crd -> crd.getMetadata().getName().startsWith(\"kafka\"))\n-            .forEach(crd -> {\n-                LOGGER.info(\"Verifying labels for custom resource {}\", crd.getMetadata().getName());\n-                assertThat(crd.getMetadata().getLabels().get(\"app\"), is(\"strimzi\"));\n-            });\n+        String crds = cmdKubeClient().exec(\"get\", \"crds\", \"--selector=app=strimzi\", \"-o\", \"jsonpath='{.items[*].metadata.name}'\").out();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3ODQ2MQ=="}, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODA3NTk3OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/strimzi/api/kafka/Crds.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozOTo0NVrOHDUeZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxODowMzozMlrOHENS-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0MzIzNg==", "bodyText": "I have to say that somehow the getCrdsCount seems weird. Wouldn't getCrdCount be more natural? WDYT @samuel-hawker?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473243236", "createdAt": "2020-08-19T18:39:45Z", "author": {"login": "scholzj"}, "path": "api/src/main/java/io/strimzi/api/kafka/Crds.java", "diffHunk": "@@ -373,4 +373,8 @@ public static CustomResourceDefinition kafkaRebalance() {\n             throw new RuntimeException(e);\n         }\n     }\n+\n+    public static int getCrdsCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk1MzEzMw==", "bodyText": "getNumCrds()", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473953133", "createdAt": "2020-08-20T13:04:47Z", "author": {"login": "tombentley"}, "path": "api/src/main/java/io/strimzi/api/kafka/Crds.java", "diffHunk": "@@ -373,4 +373,8 @@ public static CustomResourceDefinition kafkaRebalance() {\n             throw new RuntimeException(e);\n         }\n     }\n+\n+    public static int getCrdsCount() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0MzIzNg=="}, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE3MjY3NQ==", "bodyText": "See whilst I was reviewing this, I thought the same, but then went through the class and realized that it has some a large number of functions that being as explicit as getCrdsCount was fine, I do agree though with Tom's suggestion getNumCrds is good too.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r474172675", "createdAt": "2020-08-20T18:00:38Z", "author": {"login": "samuel-hawker"}, "path": "api/src/main/java/io/strimzi/api/kafka/Crds.java", "diffHunk": "@@ -373,4 +373,8 @@ public static CustomResourceDefinition kafkaRebalance() {\n             throw new RuntimeException(e);\n         }\n     }\n+\n+    public static int getCrdsCount() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0MzIzNg=="}, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE3NDIwMA==", "bodyText": "I might add that\ngetKnownNumCrds may be marginally better as it is more accurate, (the crds known to the class), as opposed to say number of Crds total, but a javadoc comment would be fine for clarifying this, I am happy with it as you have changed it..", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r474174200", "createdAt": "2020-08-20T18:03:32Z", "author": {"login": "samuel-hawker"}, "path": "api/src/main/java/io/strimzi/api/kafka/Crds.java", "diffHunk": "@@ -373,4 +373,8 @@ public static CustomResourceDefinition kafkaRebalance() {\n             throw new RuntimeException(e);\n         }\n     }\n+\n+    public static int getCrdsCount() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0MzIzNg=="}, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1335, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}