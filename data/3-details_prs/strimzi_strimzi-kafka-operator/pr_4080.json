{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NTA3NDM5", "number": 4080, "title": "Do not use ownerReference in UO and TO bindings into a different namespace", "bodyText": "Type of change\n\nBugfix\n\nDescription\nStrimzi is using ownerReferences to delete resources through Kubernetes garbage collection. The owner references should however be used only within the same scope as the the owner resource. E.g. be in the same namespace or be cluster scoped for cluster scoped resources.\nBut when TO or UO are configured to watch different namespace, they are actually created in the other namespace. So we should not use there the owner reference. As a side-effect, without the owner reference the role bindings will never be deleted. We cannot delete them manually like the ClusterRoleBindings because we do not know in which namespace they might be once the Kafka CR is deleted. Tis is not a new problem. When the user changes the custom resource and changes the watched namespace, we also cannot delete it anymore. So I do not think it should be considered as a blocker.\nThe PR #4077 fixes similar issue with ClusterRoleBindings. Both PRs are related to the discussion in #3577.\nChecklist\n\n Write tests\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging", "createdAt": "2020-12-09T22:35:37Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4080", "merged": true, "mergeCommit": {"oid": "e1e1035babc697e2b6fae34554c4503823ef5531"}, "closed": true, "closedAt": "2020-12-10T19:05:41Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkmQuPAH2gAyNTM1NTA3NDM5OmJlYzgwODhjZjJlZjM3OGY5Yzc2OWY5ZTUxMTFkNDU0ZjkwNDZhMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk2lz-gFqTU0OTQyMzMxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bec8088cf2ef378f9c769f9e5111d454f9046a25", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bec8088cf2ef378f9c769f9e5111d454f9046a25", "committedDate": "2020-12-09T22:13:10Z", "message": "Do not use ownerReference in UO and TO bindings into a different namespace\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MzM4MzY0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4080#pullrequestreview-549338364", "createdAt": "2020-12-10T15:51:01Z", "commit": {"oid": "bec8088cf2ef378f9c769f9e5111d454f9046a25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNTo1MTowMVrOIDQFdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNTo1MTowMVrOIDQFdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI4MDE4Mw==", "bodyText": "Do we need this for the (deprecated) spec.topicOperator at well?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4080#discussion_r540280183", "createdAt": "2020-12-10T15:51:01Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/EntityTopicOperator.java", "diffHunk": "@@ -299,13 +299,17 @@ public RoleBinding generateRoleBinding(String namespace, String watchedNamespace\n                 .withNewMetadata()\n                     .withName(roleBindingName(cluster))\n                     .withNamespace(watchedNamespace)\n-                    .withOwnerReferences(createOwnerReference())\n                     .withLabels(labels.toMap())\n                 .endMetadata()\n                 .withRoleRef(roleRef)\n                 .withSubjects(singletonList(ks))\n                 .build();\n \n+        // We set OwnerReference only within the same namespace since it does nto work cross-namespace\n+        if (namespace.equals(watchedNamespace)) {\n+            rb.getMetadata().setOwnerReferences(singletonList(createOwnerReference()));\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bec8088cf2ef378f9c769f9e5111d454f9046a25"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDIzMzEz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4080#pullrequestreview-549423313", "createdAt": "2020-12-10T17:14:41Z", "commit": {"oid": "bec8088cf2ef378f9c769f9e5111d454f9046a25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 734, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}