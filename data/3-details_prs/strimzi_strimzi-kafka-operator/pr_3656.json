{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3Nzg0NDA2", "number": 3656, "title": "ST: Add test which do downgrade to older log message format", "bodyText": "Signed-off-by: Jakub Stejskal xstejs24@gmail.com\nType of change\n\nEnhancement / new feature\n\nDescription\nThis PR adds ST coverage for #3639\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-09-16T07:16:01Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656", "merged": true, "mergeCommit": {"oid": "b8d1444fff53cfe5082af8b9b1ffb833999be75d"}, "closed": true, "closedAt": "2020-09-17T11:22:36Z", "author": {"login": "Frawless"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJXC4XgH2gAyNDg3Nzg0NDA2OjQzYmY4OGVkOWQzM2JhYzBhMmU2ZmQ3MmQ2MDU3YWJmMzIzZjI2MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJsw4VAFqTQ5MDM2MzM0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/43bf88ed9d33bac0a2e6fd72d6057abf323f2620", "committedDate": "2020-09-16T07:13:31Z", "message": "add test which do downgrade to older log message format\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDMyMjI3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#pullrequestreview-489432227", "createdAt": "2020-09-16T09:16:10Z", "commit": {"oid": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOToxNjoxMFrOHSn1Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOToxNzozMFrOHSn47w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4ODk3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (initialVersion.compareTo(newVersion) < 0) {\n          \n          \n            \n                            // If it is an upgrade test we keep the message format as the lower version number\n          \n          \n            \n                            logMsgFormat = initialVersion.messageVersion();\n          \n          \n            \n                        } else {\n          \n          \n            \n                            // If it is a downgrade then we make sure to use the lower version number for the message format\n          \n          \n            \n                            logMsgFormat = newVersion.messageVersion();\n          \n          \n            \n                       String logMsgFormat = initialVersion.compareTo(newVersion) < 0 ? \n          \n          \n            \n                       // If it is an upgrade test we keep the message format as the lower version number\n          \n          \n            \n                       initialVersion.messageVersion() : \n          \n          \n            \n                       // If it is a downgrade then we make sure to use the lower version number for the message format\n          \n          \n            \n                       newVersion.messageVersion()", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#discussion_r489288970", "createdAt": "2020-09-16T09:16:10Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -52,7 +52,16 @@ void testKafkaClusterUpgrade(ExtensionContext testContext) {\n             TestKafkaVersion initialVersion = sortedVersions.get(x);\n             TestKafkaVersion newVersion = sortedVersions.get(x + 1);\n \n-            runVersionChange(initialVersion, newVersion, 3, 3, testContext);\n+            String logMsgFormat;\n+            if (initialVersion.compareTo(newVersion) < 0) {\n+                // If it is an upgrade test we keep the message format as the lower version number\n+                logMsgFormat = initialVersion.messageVersion();\n+            } else {\n+                // If it is a downgrade then we make sure to use the lower version number for the message format\n+                logMsgFormat = newVersion.messageVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4OTk2Nw==", "bodyText": "same with that", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#discussion_r489289967", "createdAt": "2020-09-16T09:17:30Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -70,7 +79,16 @@ void testKafkaClusterDowngrade(ExtensionContext testContext) {\n             TestKafkaVersion initialVersion = sortedVersions.get(x);\n             TestKafkaVersion newVersion = sortedVersions.get(x - 1);\n \n-            runVersionChange(initialVersion, newVersion, 3, 3, testContext);\n+            String logMsgFormat;\n+            if (initialVersion.compareTo(newVersion) < 0) {\n+                // If it is an upgrade test we keep the message format as the lower version number\n+                logMsgFormat = initialVersion.messageVersion();\n+            } else {\n+                // If it is a downgrade then we make sure to use the lower version number for the message format\n+                logMsgFormat = newVersion.messageVersion();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32d6c58644eeaeddf39c6ec709579f91c705ab22", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/32d6c58644eeaeddf39c6ec709579f91c705ab22", "committedDate": "2020-09-16T10:24:26Z", "message": "fixup! add test which do downgrade to older log message format\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTMyNTkx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#pullrequestreview-489532591", "createdAt": "2020-09-16T11:33:48Z", "commit": {"oid": "32d6c58644eeaeddf39c6ec709579f91c705ab22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzYzMzQ0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#pullrequestreview-490363344", "createdAt": "2020-09-17T08:31:46Z", "commit": {"oid": "32d6c58644eeaeddf39c6ec709579f91c705ab22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 982, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}