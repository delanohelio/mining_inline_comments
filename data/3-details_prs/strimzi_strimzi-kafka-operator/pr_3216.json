{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MTExMzg4", "number": 3216, "title": "Add rebalance performance tuning options and documentation", "bodyText": "Type of change\nEnhancement\nDescription\nThis PR adds additional options to the KafkaRebalance resource that allow performance tuning of a whole cluster rebalance. Documentation is added describing the configurations, their meaning and how to set them at the CC server or individual rebalance level.\nChecklist\n\n Make sure all tests pass\n Update documentation\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Update CHANGELOG.md", "createdAt": "2020-06-19T13:46:37Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216", "merged": true, "mergeCommit": {"oid": "7c9bfb0221be63c50a392dd3c16f91c09e159e23"}, "closed": true, "closedAt": "2020-06-30T15:40:17Z", "author": {"login": "tomncooper"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcszcRFgFqTQzNDA5MjMxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwTAKKgFqTQzOTg3NjI4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MDkyMzE5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-434092319", "createdAt": "2020-06-19T13:49:32Z", "commit": {"oid": "a8a805e2158eb3dfb387d6ef7d24b9df277cd887"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo0OTozMlrOGmVhpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo1MjowNlrOGmVnHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MTc0OA==", "bodyText": "what's kind of \"leadership\" this is referring? \"leader\" partition movements? can you make it clear?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r442851748", "createdAt": "2020-06-19T13:49:32Z", "author": {"login": "ppatierno"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaRebalanceSpec.java", "diffHunk": "@@ -55,6 +64,47 @@ public void setSkipHardGoalCheck(boolean skipHardGoalCheck) {\n         this.skipHardGoalCheck = skipHardGoalCheck;\n     }\n \n+    @Description(\"The upper bound of ongoing replica movements going into/out of each broker\")\n+    @Minimum(0)\n+    public int getConcurrentPartitionMovementsPerBroker() {\n+        return concurrentPartitionMovementsPerBroker;\n+    }\n+\n+    public void setConcurrentPartitionMovementsPerBroker(int movements) {\n+        this.concurrentPartitionMovementsPerBroker = movements;\n+    }\n+\n+    @Description(\"The upper bound of ongoing replica movements between disks within each broker\")\n+    @Minimum(0)\n+    public int getConcurrentIntraBrokerPartitionMovements() {\n+        return concurrentIntraBrokerPartitionMovements;\n+    }\n+\n+    public void setConcurrentIntraBrokerPartitionMovements(int movements) {\n+        this.concurrentIntraBrokerPartitionMovements = movements;\n+    }\n+\n+    @Description(\"The upper bound of ongoing leadership movements\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a805e2158eb3dfb387d6ef7d24b9df277cd887"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MzE1MA==", "bodyText": "can you have just the version with long and using cast to int of the parameter when it's safe to do it?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r442853150", "createdAt": "2020-06-19T13:52:06Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/PathBuilder.java", "diffHunk": "@@ -61,12 +61,29 @@ public PathBuilder addParameter(CruiseControlParameters param, List<String> valu\n         return this;\n     }\n \n+    private void addIfNotZero(PathBuilder builder, CruiseControlParameters param, int value) {\n+        if (value > 0) {\n+            builder.addParameter(param, String.valueOf(value));\n+        }\n+    }\n+\n+    private void addIfNotZero(PathBuilder builder, CruiseControlParameters param, long value) {\n+        if (value > 0) {\n+            builder.addParameter(param, String.valueOf(value));\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a805e2158eb3dfb387d6ef7d24b9df277cd887"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8a805e2158eb3dfb387d6ef7d24b9df277cd887", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a8a805e2158eb3dfb387d6ef7d24b9df277cd887", "committedDate": "2020-06-19T13:24:10Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "d97e104db6382ac587343d2d9b9b1cb298b9cae8", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d97e104db6382ac587343d2d9b9b1cb298b9cae8", "committedDate": "2020-06-19T15:07:03Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d97e104db6382ac587343d2d9b9b1cb298b9cae8", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d97e104db6382ac587343d2d9b9b1cb298b9cae8", "committedDate": "2020-06-19T15:07:03Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/375ceb7abdedacf091760f6f1a6e988fec579678", "committedDate": "2020-06-19T15:18:25Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjU2MTk5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-434656199", "createdAt": "2020-06-22T07:12:39Z", "commit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzoxMjozOVrOGm0a9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzoxNjowMlrOGm0gvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1Nzk0Mg==", "bodyText": "do all these parameters have defaults? Are we forcing the user to set them even at 0? How was it working until today without this configuration?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r443357942", "createdAt": "2020-06-22T07:12:39Z", "author": {"login": "ppatierno"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaRebalanceSpec.java", "diffHunk": "@@ -55,6 +64,47 @@ public void setSkipHardGoalCheck(boolean skipHardGoalCheck) {\n         this.skipHardGoalCheck = skipHardGoalCheck;\n     }\n \n+    @Description(\"The upper bound of ongoing partition replica movements going into/out of each broker\")\n+    @Minimum(0)\n+    public int getConcurrentPartitionMovementsPerBroker() {\n+        return concurrentPartitionMovementsPerBroker;\n+    }\n+\n+    public void setConcurrentPartitionMovementsPerBroker(int movements) {\n+        this.concurrentPartitionMovementsPerBroker = movements;\n+    }\n+\n+    @Description(\"The upper bound of ongoing partition replica movements between disks within each broker\")\n+    @Minimum(0)\n+    public int getConcurrentIntraBrokerPartitionMovements() {\n+        return concurrentIntraBrokerPartitionMovements;\n+    }\n+\n+    public void setConcurrentIntraBrokerPartitionMovements(int movements) {\n+        this.concurrentIntraBrokerPartitionMovements = movements;\n+    }\n+\n+    @Description(\"The upper bound of ongoing partition leadership movements\")\n+    @Minimum(0)\n+    public int getConcurrentLeaderMovements() {\n+        return concurrentLeaderMovements;\n+    }\n+\n+    public void setConcurrentLeaderMovements(int movements) {\n+        this.concurrentLeaderMovements = movements;\n+    }\n+\n+    @Description(\"The upper bound, in bytes per second, on the bandwidth used to move replicas\")\n+    @Minimum(0)\n+    public long getReplicationThrottle() {\n+        return replicationThrottle;\n+    }\n+\n+    public void setReplicationThrottle(long bandwidth) {\n+        this.replicationThrottle = bandwidth;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1OTQyMw==", "bodyText": "I think that with the latest documentation updates we are avoiding to replicate what we already have in the CRD and the related doc autogenerated in the appendix. Should we just add a link to the appendix here? @laidan6000 @PaulRMellor am I wrong?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r443359423", "createdAt": "2020-06-22T07:16:02Z", "author": {"login": "ppatierno"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+\n+The Cruise Control server setting can be set in the Kafka custom resource under\n+`Kafka.spec.kafka.spec.cruiseControl.spec`. The individual rebalance performance configurations can be set under `KafkaRebalance.spec`. The relevant configurations are summarised below:\n+\n+|==========================================================================================================================\n+| Server Configuration                              | KafkaRebalance Configuration            | Description | Default Value \n+\n+| `num.concurrent.partition.movements.per.broker`   | `concurrentPartitionMovementsPerBroker` | \n+  The maximum number of inter-broker partition movements in each partition reassignment batch | 10\n+\n+| `num.concurrent.intra.broker.partition.movements` | `concurrentIntraBrokerPartitionMovements`     | \n+  The maximum number of intra-broker partition movements in each partition reassignment batch | 2\n+\n+\n+| `num.concurrent.leader.movements`                 | `concurrentLeaderMovements`             | \n+  The maximum number of partition leadership changes in each partition reassignment batch     | 1000        \n+\n+\n+| `default.replication.throttle`                    | `replicationThrottle`                   |\n+  The bandwidth (in bytes per second) to be assigned to the reassigning of partitions         | No Limit    \n+|==========================================================================================================================", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/375ceb7abdedacf091760f6f1a6e988fec579678", "committedDate": "2020-06-19T15:18:25Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9e6b05cc1346d6e21c494e0a5872a69b1c909796", "committedDate": "2020-06-22T15:15:19Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzI0NDcz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-435324473", "createdAt": "2020-06-22T22:46:18Z", "commit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMjo0Njo1NFrOGnTcPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMjo0OTo1MVrOGnTftQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NjE3NA==", "bodyText": "weather -> whether", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r443866174", "createdAt": "2020-06-22T22:46:54Z", "author": {"login": "kyguy"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/RebalanceOptions.java", "diffHunk": "@@ -8,11 +8,24 @@\n \n public class RebalanceOptions {\n \n+    /** Sets weather this rebalance only provides an optimisation proposal (true) or starts a rebalance (false) */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2NzA2MQ==", "bodyText": "weather -> whether", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r443867061", "createdAt": "2020-06-22T22:49:51Z", "author": {"login": "kyguy"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/RebalanceOptions.java", "diffHunk": "@@ -8,11 +8,24 @@\n \n public class RebalanceOptions {\n \n+    /** Sets weather this rebalance only provides an optimisation proposal (true) or starts a rebalance (false) */\n     private boolean isDryRun;\n+    /** List of optimisation goal class names, must be a sub-set of the configured master goals and include all hard.goals unless skipHardGoals=true */\n     private List<String> goals;\n+    /** Include additional information in the response from the Cruise Control Server */\n     private boolean verbose;\n+    /** Allows specifying a custom goals list that does not incude all configured hard.goals */\n     private boolean skipHardGoalCheck;\n+    /** Sets weather the response should be JSON formatted or formated for readibility on the command line */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NDk2NTE5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-435496519", "createdAt": "2020-06-23T07:05:29Z", "commit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNzowNToyOVrOGnb8iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNzowNToyOVrOGnb8iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAwNTUxMw==", "bodyText": "@tombentley ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444005513", "createdAt": "2020-06-23T07:05:29Z", "author": {"login": "ppatierno"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+\n+The Cruise Control server setting can be set in the Kafka custom resource under\n+`Kafka.spec.kafka.spec.cruiseControl.spec`. The individual rebalance performance configurations can be set under `KafkaRebalance.spec`. The relevant configurations are summarised below:\n+\n+|==========================================================================================================================\n+| Server Configuration                              | KafkaRebalance Configuration            | Description | Default Value \n+\n+| `num.concurrent.partition.movements.per.broker`   | `concurrentPartitionMovementsPerBroker` | \n+  The maximum number of inter-broker partition movements in each partition reassignment batch | 10\n+\n+| `num.concurrent.intra.broker.partition.movements` | `concurrentIntraBrokerPartitionMovements`     | \n+  The maximum number of intra-broker partition movements in each partition reassignment batch | 2\n+\n+\n+| `num.concurrent.leader.movements`                 | `concurrentLeaderMovements`             | \n+  The maximum number of partition leadership changes in each partition reassignment batch     | 1000        \n+\n+\n+| `default.replication.throttle`                    | `replicationThrottle`                   |\n+  The bandwidth (in bytes per second) to be assigned to the reassigning of partitions         | No Limit    \n+|==========================================================================================================================", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1OTQyMw=="}, "originalCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTM0MDk2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-435934096", "createdAt": "2020-06-23T16:05:23Z", "commit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowNToyM1rOGnwSXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNzowNzozNVrOGnypEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzODc4MA==", "bodyText": "Use sentence case for titles.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444338780", "createdAt": "2020-06-23T16:05:23Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MDY0MQ==", "bodyText": "Suggested changes:\nthat make up the proposal > that comprise the proposal\ntwo distinct operations > two types of operations", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444340641", "createdAt": "2020-06-23T16:07:56Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MDg1NQ==", "bodyText": "One sentence per line is usually preferred by reviewers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444340855", "createdAt": "2020-06-23T16:08:15Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0NDkwNw==", "bodyText": "Suggested change:\nPartition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n>>>\nPartition movement: Involves transferring the partition replica and its data to a new location. Partition movements are in one of two forms:", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444344907", "createdAt": "2020-06-23T16:14:24Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0NTMyOQ==", "bodyText": "Suggested change:\nanother broker > a different broker", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444345329", "createdAt": "2020-06-23T16:15:05Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0NTc2MA==", "bodyText": "Suggested change:\nThis involves switching the leader of a set of partition replicas.\n>>>\nThe leader of a set of partition replicas is switched to a different broker.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444345760", "createdAt": "2020-06-23T16:15:44Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0Njg2Mw==", "bodyText": "Suggest using present tense.\nCruise Control will batch up these reassignment commands and issue them to the Kafka cluster.\n>>>\nCruise Control batches up these reassignment commands and issues them to the Kafka cluster.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444346863", "createdAt": "2020-06-23T16:17:30Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM1MzM0Ng==", "bodyText": "A tricky sentence. Suggested rewording:\nThe number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them.\n>>>\nThe performance of the cluster during the rebalance is affected by the quantities of each type of movement contained in each batch.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444353346", "createdAt": "2020-06-23T16:27:51Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2MjAyOQ==", "bodyText": "Suggested rewording:\nCruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level.\n>>>\nCruise Control provides several configuration options for tuning a cluster rebalance for optimal performance. You can set these tuning options at either the xref:ref-cruise-control-configuration-{context}[Cruise Control server] or xref:proc-generating-optimization-proposals-{context}[optimization proposal] levels.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444362029", "createdAt": "2020-06-23T16:41:55Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM1MzM0Ng=="}, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2ODg1Mg==", "bodyText": "Suggest using an unordered list:\n\n\nAt the Cruise Control server level, set tuning options in the spec.cruiseControl property of the Kafka resource.\n\n\nAt the optimization proposal level, set tuning options in the spec property of KafkaRebalance resources.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444368852", "createdAt": "2020-06-23T16:53:05Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+\n+The Cruise Control server setting can be set in the Kafka custom resource under", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM3MTU5Mg==", "bodyText": "Yes, we are moving towards having the configs only documented in the appendix. However, I think you should list the names of the configs here and then add links to the appendix (for both Kafka and KafkaRebalance) to get more information.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444371592", "createdAt": "2020-06-23T16:57:44Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+\n+The Cruise Control server setting can be set in the Kafka custom resource under\n+`Kafka.spec.kafka.spec.cruiseControl.spec`. The individual rebalance performance configurations can be set under `KafkaRebalance.spec`. The relevant configurations are summarised below:\n+\n+|==========================================================================================================================\n+| Server Configuration                              | KafkaRebalance Configuration            | Description | Default Value \n+\n+| `num.concurrent.partition.movements.per.broker`   | `concurrentPartitionMovementsPerBroker` | \n+  The maximum number of inter-broker partition movements in each partition reassignment batch | 10\n+\n+| `num.concurrent.intra.broker.partition.movements` | `concurrentIntraBrokerPartitionMovements`     | \n+  The maximum number of intra-broker partition movements in each partition reassignment batch | 2\n+\n+\n+| `num.concurrent.leader.movements`                 | `concurrentLeaderMovements`             | \n+  The maximum number of partition leadership changes in each partition reassignment batch     | 1000        \n+\n+\n+| `default.replication.throttle`                    | `replicationThrottle`                   |\n+  The bandwidth (in bytes per second) to be assigned to the reassigning of partitions         | No Limit    \n+|==========================================================================================================================", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1OTQyMw=="}, "originalCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM3NzM2MQ==", "bodyText": "Suggested change:\nChanging these settings will effect the length of time the rebalance takes to complete as well as the load placed on the Kafka cluster whilst it is being enacted. Lower values will reduce the load but extend the time taken to complete and visa versa.\n>>>\nChanging the default settings affects the length of time that the rebalance takes to complete, as well as the load placed on the Kafka cluster during the rebalance. Using lower values reduces the load but increases the amount of time taken, and vice versa.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444377361", "createdAt": "2020-06-23T17:07:35Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+\n+The Cruise Control server setting can be set in the Kafka custom resource under\n+`Kafka.spec.kafka.spec.cruiseControl.spec`. The individual rebalance performance configurations can be set under `KafkaRebalance.spec`. The relevant configurations are summarised below:\n+\n+|==========================================================================================================================\n+| Server Configuration                              | KafkaRebalance Configuration            | Description | Default Value \n+\n+| `num.concurrent.partition.movements.per.broker`   | `concurrentPartitionMovementsPerBroker` | \n+  The maximum number of inter-broker partition movements in each partition reassignment batch | 10\n+\n+| `num.concurrent.intra.broker.partition.movements` | `concurrentIntraBrokerPartitionMovements`     | \n+  The maximum number of intra-broker partition movements in each partition reassignment batch | 2\n+\n+\n+| `num.concurrent.leader.movements`                 | `concurrentLeaderMovements`             | \n+  The maximum number of partition leadership changes in each partition reassignment batch     | 1000        \n+\n+\n+| `default.replication.throttle`                    | `replicationThrottle`                   |\n+  The bandwidth (in bytes per second) to be assigned to the reassigning of partitions         | No Limit    \n+|==========================================================================================================================\n+\n+Changing these settings will effect the length of time the rebalance takes to complete as well as the load placed on the Kafka cluster whilst it is being enacted. Lower values will reduce the load but extend the time taken to complete and visa versa.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e6b05cc1346d6e21c494e0a5872a69b1c909796", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9e6b05cc1346d6e21c494e0a5872a69b1c909796", "committedDate": "2020-06-22T15:15:19Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "703ed73eb33cc4960abd263809656a657ea90592", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/703ed73eb33cc4960abd263809656a657ea90592", "committedDate": "2020-06-24T10:24:58Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTM3Nzk2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-436537796", "createdAt": "2020-06-24T10:55:43Z", "commit": {"oid": "703ed73eb33cc4960abd263809656a657ea90592"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMDo1NTo0NFrOGoNJAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTowNDoyMlrOGoNaMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxMTUyMw==", "bodyText": "Please use a colon.\nPartition movements can take one of two forms:", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444811523", "createdAt": "2020-06-24T10:55:44Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,54 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance performance tuning overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that comprise the proposal are applied to the Kafka cluster by the Cruise Control server. \n+These commands consist of two types of operations:\n+\n+* Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "703ed73eb33cc4960abd263809656a657ea90592"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxMzA4Ng==", "bodyText": "Start a new paragraph at line 20.\nUse italics for tuning.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444813086", "createdAt": "2020-06-24T10:58:52Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,54 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance performance tuning overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that comprise the proposal are applied to the Kafka cluster by the Cruise Control server. \n+These commands consist of two types of operations:\n+\n+* Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on a different broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of the partition's replicas.\n+\n+Cruise Control batches up these reassignment commands and issues them to the Kafka cluster. \n+The performance of the cluster during the rebalance is affected by the quantities of each type of movement contained in each batch.\n+Cruise Control provides several configuration options for tuning a cluster rebalance for optimal performance. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "703ed73eb33cc4960abd263809656a657ea90592"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxNTE4Mg==", "bodyText": "Is the lead-in sentence before the bullets correct?\nThe Cruise Control server setting can be set in either:\nAre both of them related to to the server settings?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444815182", "createdAt": "2020-06-24T11:03:01Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,54 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance performance tuning overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that comprise the proposal are applied to the Kafka cluster by the Cruise Control server. \n+These commands consist of two types of operations:\n+\n+* Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on a different broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of the partition's replicas.\n+\n+Cruise Control batches up these reassignment commands and issues them to the Kafka cluster. \n+The performance of the cluster during the rebalance is affected by the quantities of each type of movement contained in each batch.\n+Cruise Control provides several configuration options for tuning a cluster rebalance for optimal performance. \n+You can set these tuning options at either the xref:ref-cruise-control-configuration-{context}[Cruise Control server] or xref:proc-generating-optimization-proposals-{context}[optimization proposal] levels.\n+\n+The Cruise Control server setting can be set in either:\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "703ed73eb33cc4960abd263809656a657ea90592"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxNTkyMw==", "bodyText": "Noted.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r444815923", "createdAt": "2020-06-24T11:04:22Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance Performance Tuning Overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that make up the proposal are applied to the Kafka cluster by the Cruise Control server. These commands consist of two distinct operations:\n+\n+* Partition movement: This involves physically transferring the partition replica and its data to a new location and can take one of two forms.\n+    ** Inter-broker movement: The partition replica is moved to a log directory on another broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of a set of partition replicas.\n+\n+Cruise Control will batch up these reassignment commands and issue them to the Kafka cluster. The number of each type of these movements in these batches can effect the performance impact of the rebalance on the Kafka cluster whilst it is enacting them. Cruise control offers several configuration options for tuning the rebalance which can be set at the xref:ref-cruise-control-configuration-{context}[server] or xref:proc-generating-optimization-proposals-{context}[individual rebalance request] level. \n+\n+The Cruise Control server setting can be set in the Kafka custom resource under\n+`Kafka.spec.kafka.spec.cruiseControl.spec`. The individual rebalance performance configurations can be set under `KafkaRebalance.spec`. The relevant configurations are summarised below:\n+\n+|==========================================================================================================================\n+| Server Configuration                              | KafkaRebalance Configuration            | Description | Default Value \n+\n+| `num.concurrent.partition.movements.per.broker`   | `concurrentPartitionMovementsPerBroker` | \n+  The maximum number of inter-broker partition movements in each partition reassignment batch | 10\n+\n+| `num.concurrent.intra.broker.partition.movements` | `concurrentIntraBrokerPartitionMovements`     | \n+  The maximum number of intra-broker partition movements in each partition reassignment batch | 2\n+\n+\n+| `num.concurrent.leader.movements`                 | `concurrentLeaderMovements`             | \n+  The maximum number of partition leadership changes in each partition reassignment batch     | 1000        \n+\n+\n+| `default.replication.throttle`                    | `replicationThrottle`                   |\n+  The bandwidth (in bytes per second) to be assigned to the reassigning of partitions         | No Limit    \n+|==========================================================================================================================", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1OTQyMw=="}, "originalCommit": {"oid": "375ceb7abdedacf091760f6f1a6e988fec579678"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "703ed73eb33cc4960abd263809656a657ea90592", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/703ed73eb33cc4960abd263809656a657ea90592", "committedDate": "2020-06-24T10:24:58Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "14225ee8aa4da70b88ecbd5c1a6e1cbcdb5e6859", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/14225ee8aa4da70b88ecbd5c1a6e1cbcdb5e6859", "committedDate": "2020-06-24T12:15:27Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjkwNjgz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-437290683", "createdAt": "2020-06-25T08:45:59Z", "commit": {"oid": "14225ee8aa4da70b88ecbd5c1a6e1cbcdb5e6859"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14225ee8aa4da70b88ecbd5c1a6e1cbcdb5e6859", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/14225ee8aa4da70b88ecbd5c1a6e1cbcdb5e6859", "committedDate": "2020-06-24T12:15:27Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "ea1ffad27fb6cc541b92af2d1323cf3b17d5cc48", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ea1ffad27fb6cc541b92af2d1323cf3b17d5cc48", "committedDate": "2020-06-29T15:54:29Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea1ffad27fb6cc541b92af2d1323cf3b17d5cc48", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ea1ffad27fb6cc541b92af2d1323cf3b17d5cc48", "committedDate": "2020-06-29T15:54:29Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59", "committedDate": "2020-06-29T16:57:45Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NzQwODQ4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-439740848", "createdAt": "2020-06-30T07:28:34Z", "commit": {"oid": "fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzoyODozNVrOGqvVDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzozNTozMVrOGqvkGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ2ODgxMg==", "bodyText": "Do you mean the number, rather than the quantity?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The performance of the cluster during the rebalance is affected by the quantities of each type of movement contained in each batch.\n          \n          \n            \n            The performance of the cluster during the rebalance is affected by the number of each type of movement contained in each batch.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r447468812", "createdAt": "2020-06-30T07:28:35Z", "author": {"login": "tombentley"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,53 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance performance tuning overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that comprise the proposal are applied to the Kafka cluster by the Cruise Control server. \n+These commands consist of two types of operations:\n+\n+* Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms:\n+    ** Inter-broker movement: The partition replica is moved to a log directory on a different broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of the partition's replicas.\n+\n+Cruise Control batches up these reassignment commands and issues them to the Kafka cluster. \n+The performance of the cluster during the rebalance is affected by the quantities of each type of movement contained in each batch.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ3MDUzMg==", "bodyText": "I'm surprised by this default. Perhaps naively I would have expected that since intrabroker movement is \"just copying some files around\" (i.e. not requiring any network) it would be less burdensome on the cluster and therefore the default could be higher than the interbroker case.Is my intuition wrong, or is it just a weird default?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r447470532", "createdAt": "2020-06-30T07:31:36Z", "author": {"login": "tombentley"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,53 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance performance tuning overview \n+\n+When an xref:con-optimization-proposals-{context}[optimization proposal] is xref:proc-approving-optimization-proposal-{context}[approved], the partition reassignment commands that comprise the proposal are applied to the Kafka cluster by the Cruise Control server. \n+These commands consist of two types of operations:\n+\n+* Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms:\n+    ** Inter-broker movement: The partition replica is moved to a log directory on a different broker.\n+    ** Intra-broker movement: The partition replica is moved to a different log directory on the same broker.\n+\n+* Leadership movement: This involves switching the leader of the partition's replicas.\n+\n+Cruise Control batches up these reassignment commands and issues them to the Kafka cluster. \n+The performance of the cluster during the rebalance is affected by the quantities of each type of movement contained in each batch.\n+Cruise Control provides several configuration options for tuning a cluster rebalance for optimal performance. \n+\n+You can set these _tuning_ options at either the xref:ref-cruise-control-configuration-{context}[Cruise Control server] or xref:proc-generating-optimization-proposals-{context}[optimization proposal] levels:\n+\n+* The Cruise Control server setting can be set in the Kafka custom resource under `Kafka.spec.kafka.spec.cruiseControl.spec`. \n+* The individual rebalance performance configurations can be set under `KafkaRebalance.spec`. \n+\n+The relevant configurations are summarised below:\n+\n+|==========================================================================================================================\n+| Server Configuration                              | KafkaRebalance Configuration            | Description | Default Value \n+\n+| `num.concurrent.partition.movements.per.broker`   | `concurrentPartitionMovementsPerBroker` | \n+  The maximum number of inter-broker partition movements in each partition reassignment batch | 10\n+\n+| `num.concurrent.intra.broker.partition.movements` | `concurrentIntraBrokerPartitionMovements`     | \n+  The maximum number of intra-broker partition movements in each partition reassignment batch | 2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ3MjY2NA==", "bodyText": "Do we need two blank lines?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r447472664", "createdAt": "2020-06-30T07:35:31Z", "author": {"login": "tombentley"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaRebalanceSpec.java", "diffHunk": "@@ -55,6 +64,47 @@ public void setSkipHardGoalCheck(boolean skipHardGoalCheck) {\n         this.skipHardGoalCheck = skipHardGoalCheck;\n     }\n \n+    @Description(\"The upper bound of ongoing partition replica movements going into/out of each broker. Default is 10.\")\n+    @Minimum(0)\n+    public int getConcurrentPartitionMovementsPerBroker() {\n+        return concurrentPartitionMovementsPerBroker;\n+    }\n+\n+    public void setConcurrentPartitionMovementsPerBroker(int movements) {\n+        this.concurrentPartitionMovementsPerBroker = movements;\n+    }\n+\n+    @Description(\"The upper bound of ongoing partition replica movements between disks within each broker. Default is 2.\")\n+    @Minimum(0)\n+    public int getConcurrentIntraBrokerPartitionMovements() {\n+        return concurrentIntraBrokerPartitionMovements;\n+    }\n+\n+    public void setConcurrentIntraBrokerPartitionMovements(int movements) {\n+        this.concurrentIntraBrokerPartitionMovements = movements;\n+    }\n+\n+    @Description(\"The upper bound of ongoing partition leadership movements. Default is 1000.\")\n+    @Minimum(0)\n+    public int getConcurrentLeaderMovements() {\n+        return concurrentLeaderMovements;\n+    }\n+\n+    public void setConcurrentLeaderMovements(int movements) {\n+        this.concurrentLeaderMovements = movements;\n+    }\n+\n+    @Description(\"The upper bound, in bytes per second, on the bandwidth used to move replicas. There is no limit by default.\")\n+    @Minimum(0)\n+    public long getReplicationThrottle() {\n+        return replicationThrottle;\n+    }\n+\n+    public void setReplicationThrottle(long bandwidth) {\n+        this.replicationThrottle = bandwidth;\n+    }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b06678e59d22bd9bd4f7c562b9119881d1b19bc", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5b06678e59d22bd9bd4f7c562b9119881d1b19bc", "committedDate": "2020-06-30T09:55:56Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fd00a2a97e226a6c8bdf9752be8a61a73eaf4a59", "committedDate": "2020-06-29T16:57:45Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "5b06678e59d22bd9bd4f7c562b9119881d1b19bc", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5b06678e59d22bd9bd4f7c562b9119881d1b19bc", "committedDate": "2020-06-30T09:55:56Z", "message": "Added rebalance performance tuning options and documentation\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODc2Mjg5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#pullrequestreview-439876289", "createdAt": "2020-06-30T10:19:15Z", "commit": {"oid": "5b06678e59d22bd9bd4f7c562b9119881d1b19bc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMDoxOToxNVrOGq10jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMDoxOToxNVrOGq10jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3NTE4MQ==", "bodyText": "I wonder if this should be in the APi reference (added usin the @DescriptionFile annotation). WDYT @PaulRMellor ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3216#discussion_r447575181", "createdAt": "2020-06-30T10:19:15Z", "author": {"login": "scholzj"}, "path": "documentation/modules/cruise-control/con-rebalance-performance.adoc", "diffHunk": "@@ -0,0 +1,53 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-cruise-control-concepts.adoc\n+\n+[id='con-rebalance-{context}']\n+\n+= Rebalance performance tuning overview ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b06678e59d22bd9bd4f7c562b9119881d1b19bc"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1573, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}