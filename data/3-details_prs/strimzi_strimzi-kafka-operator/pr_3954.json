{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwOTI2NTg5", "number": 3954, "title": "[systemtest] Test for owner reference of CA secrets", "bodyText": "Signed-off-by: Lukas Kral lukywill16@gmail.com\nType of change\n\nNew test\n\nDescription\nAfter #3453 we are able to not delete secrets of Kafka cluster after deletion of whole Kafka cluster. Originally when we deployed Kafka, some cluster-ca and clients-ca secrets are created as well, deleted always on Kafka deletion (also secrets which are bound to Kafka cluster, not just the automatically created ones) . This feature allow us to keep the secrets even if the Kafka cluster is deleted, which can come handy in some cases.\nThis PR adds test for this feature.\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-11-14T00:58:04Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3954", "merged": true, "mergeCommit": {"oid": "a547519d4eae659c733db9c5875f76093f61d15f"}, "closed": true, "closedAt": "2020-11-18T15:24:57Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddBpV3AH2gAyNTIwOTI2NTg5Ojc1M2JkYjk2ZmU4NmZhMDdhM2M2OGRjYmQ4MGQ0NWI5M2YzMzFmMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddq0oEAH2gAyNTIwOTI2NTg5OmRmN2VhYjg1MjZmZGQ5NWUyYzZlMmYzZDBiYjIxYjc0ZTM0MWVlNGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "753bdb96fe86fa07a3c68dcbd80d45b93f331f0d", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/753bdb96fe86fa07a3c68dcbd80d45b93f331f0d", "committedDate": "2020-11-16T09:36:06Z", "message": "add wait for Kafka deletion and test for owner reference of CA secrets\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80709f47eb3f5eaed22625fa581da2cf445f4f2d", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/80709f47eb3f5eaed22625fa581da2cf445f4f2d", "committedDate": "2020-11-16T11:08:17Z", "message": "some improvements\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05efe137ba2d098104adda2cb113f60eae1c7470", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/05efe137ba2d098104adda2cb113f60eae1c7470", "committedDate": "2020-11-14T00:57:13Z", "message": "add wait for Kafka deletion and test for owner reference of CA secrets\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "80709f47eb3f5eaed22625fa581da2cf445f4f2d", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/80709f47eb3f5eaed22625fa581da2cf445f4f2d", "committedDate": "2020-11-16T11:08:17Z", "message": "some improvements\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMjQyNDE5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3954#pullrequestreview-531242419", "createdAt": "2020-11-16T11:38:45Z", "commit": {"oid": "80709f47eb3f5eaed22625fa581da2cf445f4f2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTAyNTc0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3954#pullrequestreview-531902574", "createdAt": "2020-11-16T23:21:08Z", "commit": {"oid": "80709f47eb3f5eaed22625fa581da2cf445f4f2d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoyMTowOVrOH0bklg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoyMTowOVrOH0bklg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczOTczNA==", "bodyText": "I wonder if we should use here cmd client instead of fabric8 to avoid some issues with future upgrades. It's more just a question/idea. WDYT?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3954#discussion_r524739734", "createdAt": "2020-11-16T23:21:09Z", "author": {"login": "Frawless"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kafkaUtils/KafkaUtils.java", "diffHunk": "@@ -354,4 +357,21 @@ public static String getVersionFromKafkaPodLibs(String kafkaPodName) {\n             command\n         ).out().trim();\n     }\n+\n+    public static void waitForKafkaDeletion(String kafkaClusterName) {\n+        LOGGER.info(\"Waiting for deletion of Kafka:{}\", kafkaClusterName);\n+        TestUtils.waitFor(\"Kafka deletion \" + kafkaClusterName, Constants.POLL_INTERVAL_FOR_RESOURCE_READINESS, DELETION_TIMEOUT,\n+            () -> {\n+                if (KafkaResource.kafkaClient().inNamespace(kubeClient().getNamespace()).withName(kafkaClusterName).get() == null &&\n+                    kubeClient().getStatefulSet(KafkaResources.kafkaStatefulSetName(kafkaClusterName)) == null &&\n+                    kubeClient().getStatefulSet(KafkaResources.zookeeperStatefulSetName(kafkaClusterName)) == null &&\n+                    kubeClient().getDeployment(KafkaResources.entityOperatorDeploymentName(kafkaClusterName)) == null) {\n+                    return true;\n+                } else {\n+                    KafkaResource.kafkaClient().inNamespace(kubeClient().getNamespace()).withName(kafkaClusterName).withPropagationPolicy(DeletionPropagation.FOREGROUND).delete();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80709f47eb3f5eaed22625fa581da2cf445f4f2d"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed2b122b3ff42ed79640e247e0ea6a16aa84b379", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ed2b122b3ff42ed79640e247e0ea6a16aa84b379", "committedDate": "2020-11-18T09:05:27Z", "message": "comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df7eab8526fdd95e2c6e2f3d0bb21b74e341ee4d", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/df7eab8526fdd95e2c6e2f3d0bb21b74e341ee4d", "committedDate": "2020-11-18T09:34:32Z", "message": "fixup! comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 654, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}