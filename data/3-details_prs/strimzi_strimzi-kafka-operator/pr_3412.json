{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NjI3MDI1", "number": 3412, "title": "Make sure KafkaMirrorMaker can be scaled to zero", "bodyText": "Type of change\n\nBugfix\n\nDescription\nWhen KafkaMirrorMaker is sclaed to 0 (replicas=0), they currently start failing. This PR updates the behavior to:\n\nMake sure the MirrorMaker reconciliations are passing in such situation\n\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-07-29T19:04:55Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412", "merged": true, "mergeCommit": {"oid": "fb3b57b95d82d7d089afad51bda466707cf41481"}, "closed": true, "closedAt": "2020-08-02T09:27:55Z", "author": {"login": "klalafaryan"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5v_RmgBqjM2MDA0NjU0MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc65X9fgFqTQ1OTYzMTg5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63dd1c9bb80afd776859d0c23d298d70dccc9c78", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/63dd1c9bb80afd776859d0c23d298d70dccc9c78", "committedDate": "2020-07-29T18:59:03Z", "message": "Make sure KafkaMirrorMaker can be scaled to zero"}, "afterCommit": {"oid": "7179bdabbe58bd956cf8fe10e54cfc0873650ee9", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7179bdabbe58bd956cf8fe10e54cfc0873650ee9", "committedDate": "2020-07-29T19:13:48Z", "message": "Make sure KafkaMirrorMaker can be scaled to zero\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODE3MTU2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-457817156", "createdAt": "2020-07-29T19:18:44Z", "commit": {"oid": "7179bdabbe58bd956cf8fe10e54cfc0873650ee9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxODo0NFrOG5Gn7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxODo0NFrOG5Gn7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzMDU0Mg==", "bodyText": "Can we do this like in all the other cases and leave the condition as ready? If user requests 0 replicas and gets 0 replicas it should not be treated as exception.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462530542", "createdAt": "2020-07-29T19:18:44Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMakerAssemblyOperator.java", "diffHunk": "@@ -103,9 +105,15 @@ public KafkaMirrorMakerAssemblyOperator(Vertx vertx, PlatformFeaturesAvailabilit\n                 .compose(i -> deploymentOperations.reconcile(namespace, mirror.getName(), mirror.generateDeployment(annotations, pfa.isOpenshift(), imagePullPolicy, imagePullSecrets)))\n                 .compose(i -> deploymentOperations.scaleUp(namespace, mirror.getName(), mirror.getReplicas()))\n                 .compose(i -> deploymentOperations.waitForObserved(namespace, mirror.getName(), 1_000, operationTimeoutMs))\n-                .compose(i -> deploymentOperations.readiness(namespace, mirror.getName(), 1_000, operationTimeoutMs))\n+                .compose(i -> mirrorHasZeroReplicas ? Future.succeededFuture() : deploymentOperations.readiness(namespace, mirror.getName(), 1_000, operationTimeoutMs))\n                 .onComplete(reconciliationResult -> {\n-                        StatusUtils.setStatusConditionAndObservedGeneration(assemblyResource, kafkaMirrorMakerStatus, reconciliationResult);\n+\n+                        if (mirrorHasZeroReplicas) {\n+                            StatusUtils.setStatusConditionAndObservedGeneration(assemblyResource, kafkaMirrorMakerStatus, new RuntimeException(\n+                                    \"Kafka Mirror Maker cluster '\" + assemblyResource.getMetadata().getName() + \"' in namespace \" + assemblyResource.getMetadata().getNamespace() + \" has 0 replicas.\"));\n+                        } else {\n+                            StatusUtils.setStatusConditionAndObservedGeneration(assemblyResource, kafkaMirrorMakerStatus, reconciliationResult);\n+                        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7179bdabbe58bd956cf8fe10e54cfc0873650ee9"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07aa95584ea60bd88d722075ed01039c4add455c", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/07aa95584ea60bd88d722075ed01039c4add455c", "committedDate": "2020-07-29T21:39:10Z", "message": "Make sure KafkaMirrorMaker can be scaled to zero\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6873672029a5b1dd5548b896b7cb267a901c724", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c6873672029a5b1dd5548b896b7cb267a901c724", "committedDate": "2020-07-29T21:39:10Z", "message": "Implement unit test\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bc6a1c42d95fa41c6c02e7901abde4398c2385e", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5bc6a1c42d95fa41c6c02e7901abde4398c2385e", "committedDate": "2020-07-29T21:39:10Z", "message": "Fix code style\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5b0df3b65f64e4e9aa2776a369684bdaefcf042a", "committedDate": "2020-07-29T21:39:10Z", "message": "Changing cluster cmName\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d179620e597d66b2be31790814da9ffe7dbe210b", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d179620e597d66b2be31790814da9ffe7dbe210b", "committedDate": "2020-07-29T21:38:42Z", "message": "Changing cluster cmName"}, "afterCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5b0df3b65f64e4e9aa2776a369684bdaefcf042a", "committedDate": "2020-07-29T21:39:10Z", "message": "Changing cluster cmName\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTIzODg0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-457923884", "createdAt": "2020-07-29T21:51:19Z", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTo1MToxOVrOG5Lhnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTo1MToxOVrOG5Lhnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYxMDg0Nw==", "bodyText": "Should I change protected static final int DEFAULT_REPLICAS = 3; into public in KafkaMirrorMakerCluster class, and use it here, just to avoid having the default value defined multiple places ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462610847", "createdAt": "2020-07-29T21:51:19Z", "author": {"login": "klalafaryan"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaMirrorMakerSpec.java", "diffHunk": "@@ -41,7 +41,10 @@\n \n     private static final long serialVersionUID = 1L;\n \n-    private int replicas;\n+    private static final int DEFAULT_REPLICAS = 3;\n+\n+    private int replicas = DEFAULT_REPLICAS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTI1MDA0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-457925004", "createdAt": "2020-07-29T21:53:26Z", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTo1MzoyN1rOG5LlFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTo1MzoyN1rOG5LlFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYxMTczNQ==", "bodyText": "To be honest, I am not sure, if we need this check (spec != null) here ? For example in KafkaConnectCluster and in KafkaBridgeCluster  spec is not checked. (if it is null or not)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462611735", "createdAt": "2020-07-29T21:53:27Z", "author": {"login": "klalafaryan"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaMirrorMakerCluster.java", "diffHunk": "@@ -133,8 +133,8 @@ public static KafkaMirrorMakerCluster fromCrd(KafkaMirrorMaker kafkaMirrorMaker,\n         KafkaMirrorMakerCluster kafkaMirrorMakerCluster = new KafkaMirrorMakerCluster(kafkaMirrorMaker);\n \n         KafkaMirrorMakerSpec spec = kafkaMirrorMaker.getSpec();\n-        kafkaMirrorMakerCluster.setReplicas(spec != null && spec.getReplicas() > 0 ? spec.getReplicas() : DEFAULT_REPLICAS);\n         if (spec != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTQ2MjYz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-457946263", "createdAt": "2020-07-29T22:37:53Z", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjozNzo1NFrOG5MswQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjozNzo1NFrOG5MswQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzMDA4MQ==", "bodyText": "I think this would work fine. But maybe it would be easier to read the code if you keep the one big blog with the Builder, build the KafkaMirrorMaker, then change the replicas and return it.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462630081", "createdAt": "2020-07-29T22:37:54Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "diffHunk": "@@ -505,19 +506,29 @@ public static KafkaMirrorMaker createEmptyKafkaMirrorMakerCluster(String cluster\n     }\n \n     public static KafkaMirrorMaker createKafkaMirrorMakerCluster(String clusterCmNamespace, String clusterCmName, String image, KafkaMirrorMakerProducerSpec producer, KafkaMirrorMakerConsumerSpec consumer, String whitelist, Map<String, Object> metricsCm) {\n-        return new KafkaMirrorMakerBuilder()\n+        return createKafkaMirrorMakerCluster(clusterCmNamespace, clusterCmName, image, null, producer, consumer, whitelist, metricsCm);\n+    }\n+\n+    public static KafkaMirrorMaker createKafkaMirrorMakerCluster(String clusterCmNamespace, String clusterCmName, String image, Integer replicas, KafkaMirrorMakerProducerSpec producer, KafkaMirrorMakerConsumerSpec consumer, String whitelist, Map<String, Object> metricsCm) {\n+        KafkaMirrorMakerFluent.SpecNested<KafkaMirrorMakerBuilder> kafkaMirrorMakerBuilder = new KafkaMirrorMakerBuilder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTQ2OTQ0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-457946944", "createdAt": "2020-07-29T22:39:34Z", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjozOTozNVrOG5MvDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjozOTozNVrOG5MvDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzMDY3MA==", "bodyText": "When you change something in the api module, it is not enough to just build the images. You have to at the end run make crd_install to make sure the new CRD definitions are copied to all the different places. This is why right now the CI builds are failing.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462630670", "createdAt": "2020-07-29T22:39:35Z", "author": {"login": "scholzj"}, "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaMirrorMakerSpec.java", "diffHunk": "@@ -60,7 +63,7 @@\n     private Map<String, Object> additionalProperties = new HashMap<>(0);\n \n     @Description(\"The number of pods in the `Deployment`.\")\n-    @Minimum(1)\n+    @Minimum(0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjkwMjg0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-458290284", "createdAt": "2020-07-30T10:48:32Z", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDo0ODozMlrOG5d7ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDo0ODozMlrOG5d7ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxMjQ1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    KafkaMirrorMakerFluent.SpecNested<KafkaMirrorMakerBuilder> kafkaMirrorMakerBuilder = new KafkaMirrorMakerBuilder()\n          \n          \n            \n                            .withMetadata(new ObjectMetaBuilder()\n          \n          \n            \n                                    .withName(clusterCmName)\n          \n          \n            \n                                    .withNamespace(clusterCmNamespace)\n          \n          \n            \n                                    .withLabels(TestUtils.map(Labels.KUBERNETES_DOMAIN + \"part-of\", \"tests\",\n          \n          \n            \n                                            \"my-user-label\", \"cromulent\"))\n          \n          \n            \n                                    .build())\n          \n          \n            \n                            .withNewSpec()\n          \n          \n            \n                   KafkaMirrorMakerBuilder builder = new KafkaMirrorMakerBuilder()\n          \n          \n            \n                            .withMetadata(new ObjectMetaBuilder()\n          \n          \n            \n                                    .withName(clusterCmName)\n          \n          \n            \n                                    .withNamespace(clusterCmNamespace)\n          \n          \n            \n                                    .withLabels(TestUtils.map(Labels.KUBERNETES_DOMAIN + \"part-of\", \"tests\",\n          \n          \n            \n                                            \"my-user-label\", \"cromulent\"))\n          \n          \n            \n                                    .build())\n          \n          \n            \n                            .withNewSpec()\n          \n          \n            \n                              .withImage(image)\n          \n          \n            \n                              .withProducer(producer)\n          \n          \n            \n                               .withConsumer(consumer)\n          \n          \n            \n                               .withWhitelist(whitelist)\n          \n          \n            \n                               .withMetrics(metricsCm)\n          \n          \n            \n                            .endSpec();\n          \n          \n            \n                            \n          \n          \n            \n                             if (replicas != null) {\n          \n          \n            \n                                builder.editOrNewSpec()\n          \n          \n            \n                                       .withReplicas(replicas)\n          \n          \n            \n                                     .endSpec()\n          \n          \n            \n                             }\n          \n          \n            \n                             \n          \n          \n            \n                             return builder.build();", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462912451", "createdAt": "2020-07-30T10:48:32Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "diffHunk": "@@ -505,19 +506,29 @@ public static KafkaMirrorMaker createEmptyKafkaMirrorMakerCluster(String cluster\n     }\n \n     public static KafkaMirrorMaker createKafkaMirrorMakerCluster(String clusterCmNamespace, String clusterCmName, String image, KafkaMirrorMakerProducerSpec producer, KafkaMirrorMakerConsumerSpec consumer, String whitelist, Map<String, Object> metricsCm) {\n-        return new KafkaMirrorMakerBuilder()\n+        return createKafkaMirrorMakerCluster(clusterCmNamespace, clusterCmName, image, null, producer, consumer, whitelist, metricsCm);\n+    }\n+\n+    public static KafkaMirrorMaker createKafkaMirrorMakerCluster(String clusterCmNamespace, String clusterCmName, String image, Integer replicas, KafkaMirrorMakerProducerSpec producer, KafkaMirrorMakerConsumerSpec consumer, String whitelist, Map<String, Object> metricsCm) {\n+        KafkaMirrorMakerFluent.SpecNested<KafkaMirrorMakerBuilder> kafkaMirrorMakerBuilder = new KafkaMirrorMakerBuilder()\n                 .withMetadata(new ObjectMetaBuilder()\n                         .withName(clusterCmName)\n                         .withNamespace(clusterCmNamespace)\n                         .withLabels(TestUtils.map(Labels.KUBERNETES_DOMAIN + \"part-of\", \"tests\",\n                                 \"my-user-label\", \"cromulent\"))\n                         .build())\n                 .withNewSpec()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjkxNjgx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-458291681", "createdAt": "2020-07-30T10:50:53Z", "commit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDo1MDo1M1rOG5eAFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDo1MDo1M1rOG5eAFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxMzU1OA==", "bodyText": "This is a good check, but do we also want to check that the Custom resource status gets set to ready?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#discussion_r462913558", "createdAt": "2020-07-30T10:50:53Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMakerAssemblyOperatorTest.java", "diffHunk": "@@ -688,4 +688,55 @@ public void testCreateClusterStatusNotReady(VertxTestContext context) throws Int\n                 async.flag();\n             })));\n     }\n+\n+    @Test\n+    public void testCreateOrUpdateZeroReplica(VertxTestContext context) {\n+        ResourceOperatorSupplier supplier = ResourceUtils.supplierWithMocks(true);\n+        CrdOperator mockMirrorOps = supplier.mirrorMakerOperator;\n+        DeploymentOperator mockDcOps = supplier.deploymentOperations;\n+        PodDisruptionBudgetOperator mockPdbOps = supplier.podDisruptionBudgetOperator;\n+        ConfigMapOperator mockCmOps = supplier.configMapOperations;\n+\n+        String clusterCmName = \"foo\";\n+        String clusterCmNamespace = \"test\";\n+        KafkaMirrorMakerConsumerSpec consumer = new KafkaMirrorMakerConsumerSpecBuilder()\n+                .withBootstrapServers(consumerBootstrapServers)\n+                .withGroupId(groupId)\n+                .withNumStreams(numStreams)\n+                .build();\n+        KafkaMirrorMakerProducerSpec producer = new KafkaMirrorMakerProducerSpecBuilder()\n+                .withBootstrapServers(producerBootstrapServers)\n+                .build();\n+        Map<String, Object> metricsCm = new HashMap<>();\n+        metricsCm.put(\"foo\", \"bar\");\n+\n+        KafkaMirrorMaker clusterCm = ResourceUtils.createKafkaMirrorMakerCluster(clusterCmNamespace, clusterCmName, image, 0, producer, consumer, whitelist, metricsCm);\n+\n+        when(mockMirrorOps.get(clusterCmNamespace, clusterCmName)).thenReturn(clusterCm);\n+        when(mockMirrorOps.getAsync(anyString(), anyString())).thenReturn(Future.succeededFuture(clusterCm));\n+        when(mockDcOps.reconcile(anyString(), anyString(), any())).thenReturn(Future.succeededFuture());\n+        when(mockDcOps.scaleUp(anyString(), anyString(), anyInt())).thenReturn(Future.succeededFuture(42));\n+        when(mockDcOps.scaleDown(anyString(), anyString(), anyInt())).thenReturn(Future.succeededFuture(42));\n+        when(mockDcOps.waitForObserved(anyString(), anyString(), anyLong(), anyLong())).thenReturn(Future.succeededFuture());\n+        when(mockPdbOps.reconcile(anyString(), any(), any())).thenReturn(Future.succeededFuture());\n+        when(mockCmOps.reconcile(anyString(), any(), any())).thenReturn(Future.succeededFuture(ReconcileResult.created(new ConfigMap())));\n+\n+        ArgumentCaptor<KafkaMirrorMaker> mirrorMakerCaptor = ArgumentCaptor.forClass(KafkaMirrorMaker.class);\n+        when(mockMirrorOps.updateStatusAsync(mirrorMakerCaptor.capture())).thenReturn(Future.succeededFuture());\n+\n+        KafkaMirrorMakerAssemblyOperator ops = new KafkaMirrorMakerAssemblyOperator(vertx,\n+                new PlatformFeaturesAvailability(true, kubernetesVersion),\n+                new MockCertManager(), new PasswordGenerator(10, \"a\", \"a\"),\n+                supplier,\n+                ResourceUtils.dummyClusterOperatorConfig(VERSIONS));\n+\n+        Checkpoint async = context.checkpoint();\n+        ops.createOrUpdate(new Reconciliation(\"test-trigger\", KafkaMirrorMaker.RESOURCE_KIND, clusterCmNamespace, clusterCmName), clusterCm)\n+                .onComplete(context.succeeding(v -> context.verify(() -> {\n+                    // 0 Replicas - readiness should never get called.\n+                    verify(mockDcOps, never()).readiness(anyString(), anyString(), anyLong(), anyLong());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0df3b65f64e4e9aa2776a369684bdaefcf042a"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c2b0251175d92b9ee0b23d10a200b940416e4b", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8c2b0251175d92b9ee0b23d10a200b940416e4b", "committedDate": "2020-07-30T21:18:47Z", "message": "Fix code review comments\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a4b13e1cf03603d8d9a8e99c6457bf7d0a46990", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7a4b13e1cf03603d8d9a8e99c6457bf7d0a46990", "committedDate": "2020-07-30T21:15:58Z", "message": "Fix code review comments"}, "afterCommit": {"oid": "f8c2b0251175d92b9ee0b23d10a200b940416e4b", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8c2b0251175d92b9ee0b23d10a200b940416e4b", "committedDate": "2020-07-30T21:18:47Z", "message": "Fix code review comments\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5dc9ecff1de56993c20edb5c625d4e9637eb91a", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a5dc9ecff1de56993c20edb5c625d4e9637eb91a", "committedDate": "2020-07-30T21:25:58Z", "message": "Remove unused import\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "607cef5e3aa48e8146d1112e93bdde29c02fadfb", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/607cef5e3aa48e8146d1112e93bdde29c02fadfb", "committedDate": "2020-07-30T21:25:08Z", "message": "Remove unused import"}, "afterCommit": {"oid": "a5dc9ecff1de56993c20edb5c625d4e9637eb91a", "author": {"user": {"login": "klalafaryan", "name": "Konstantin Lalafaryan"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a5dc9ecff1de56993c20edb5c625d4e9637eb91a", "committedDate": "2020-07-30T21:25:58Z", "message": "Remove unused import\n\nSigned-off-by: klalafaryan <konstantin.lalafaryan@blacklane.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NzcxNzk5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-458771799", "createdAt": "2020-07-30T21:33:03Z", "commit": {"oid": "a5dc9ecff1de56993c20edb5c625d4e9637eb91a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NjMxODk2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3412#pullrequestreview-459631896", "createdAt": "2020-08-02T08:44:27Z", "commit": {"oid": "a5dc9ecff1de56993c20edb5c625d4e9637eb91a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1041, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}