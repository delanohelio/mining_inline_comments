{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxODYzNTEw", "number": 4044, "title": "Add inter.broker.protocol.version to all examples and to Upgrade STs", "bodyText": "Type of change\n\nEnhancement / new feature\n\nDescription\nAfter the inter.broker.protocol.version is changed during the upgrade to the new version, it might happen that downgrade is not possibly anymore. Today, the operator is responsible for updating this version automatically. But that seems to not be the optimal solution. Instead, users should drive this them self => that gives them better options to roll back / downgrade. To drive this, we should set the inter.broker.protocol.version in all our examples to make sure it is fixed there and not left to the operator.\nThis also adds this as an option to the STs in the upgrade tests since they will need to handle this change as well during the upgrade tests.", "createdAt": "2020-12-03T15:23:05Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4044", "merged": true, "mergeCommit": {"oid": "115a96734ebbf02ca7e252e32fbfc73db9fad064"}, "closed": true, "closedAt": "2020-12-05T15:40:47Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdikmnIgH2gAyNTMxODYzNTEwOmQzN2M5M2JkNmY4Nzk2ZDUyYzQ1ZjJjOWNmNzIxMzUzOTEzMDIwZjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi_skxAFqTU0NTM0NjYxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d37c93bd6f8796d52c45f2c9cf721353913020f9", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d37c93bd6f8796d52c45f2c9cf721353913020f9", "committedDate": "2020-12-03T15:09:25Z", "message": "Add inter.broker.protocol.version to all examples and to Upgrade STs\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8883174a99e339929cf399d9f9132b9e5fc77242", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8883174a99e339929cf399d9f9132b9e5fc77242", "committedDate": "2020-12-03T15:17:58Z", "message": "Update CHANGELog.md\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56ec43385bd1b8770620a2b3dbb71894a5beb05d", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/56ec43385bd1b8770620a2b3dbb71894a5beb05d", "committedDate": "2020-12-04T00:43:44Z", "message": "Fix Zoo tests\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzkzMDQ3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4044#pullrequestreview-544793047", "createdAt": "2020-12-04T09:33:55Z", "commit": {"oid": "56ec43385bd1b8770620a2b3dbb71894a5beb05d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOTozMzo1NVrOH_IeXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOTozNTozOFrOH_Ii3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MTE4Mw==", "bodyText": "This looks wrong. Is messageVersion() really the IBP, or is it the log.message.format.version?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4044#discussion_r535961183", "createdAt": "2020-12-04T09:33:55Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -98,11 +100,19 @@ void testKafkaClusterDowngradeToOlderMessageFormat(ExtensionContext testContext)\n             initLogMsgFormat = tmp.toString();\n         }\n \n+        String interBrokerProtocol = sortedVersions.get(0).messageVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56ec43385bd1b8770620a2b3dbb71894a5beb05d"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MjMzNQ==", "bodyText": "This looks a bit fragile. Maybe we should parse it as dotted decimals and not assume that the 3rd character is the whole minor number.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4044#discussion_r535962335", "createdAt": "2020-12-04T09:35:38Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -98,11 +100,19 @@ void testKafkaClusterDowngradeToOlderMessageFormat(ExtensionContext testContext)\n             initLogMsgFormat = tmp.toString();\n         }\n \n+        String interBrokerProtocol = sortedVersions.get(0).messageVersion();\n+\n+        if (interBrokerProtocol.charAt(2) + 1 >= sortedVersions.get(sortedVersions.size() - 1).messageVersion().charAt(2)) {\n+            StringBuilder tmp = new StringBuilder(interBrokerProtocol);\n+            tmp.setCharAt(2, (char) (interBrokerProtocol.charAt(2) - 1));\n+            interBrokerProtocol = tmp.toString();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56ec43385bd1b8770620a2b3dbb71894a5beb05d"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "980295999231bedc42df4d4642d7d1ed589671a0", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/980295999231bedc42df4d4642d7d1ed589671a0", "committedDate": "2020-12-04T09:49:07Z", "message": "Review comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0OTU5NzI4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4044#pullrequestreview-544959728", "createdAt": "2020-12-04T13:31:18Z", "commit": {"oid": "980295999231bedc42df4d4642d7d1ed589671a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzQ2NjE3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4044#pullrequestreview-545346617", "createdAt": "2020-12-04T22:43:22Z", "commit": {"oid": "980295999231bedc42df4d4642d7d1ed589671a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 697, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}