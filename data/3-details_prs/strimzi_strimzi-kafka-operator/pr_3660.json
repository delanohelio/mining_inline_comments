{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MTU4MzQ2", "number": 3660, "title": "[systemtest] Fixes of tests in shared profile", "bodyText": "Signed-off-by: Lukas Kral lukywill16@gmail.com\nType of change\n\nTests fixes\n\nDescription\nThis PR gonna fix currently failing tests in our shared profile:\n\nin ResourceManager we waited wrong for the resource deletion -> this was problem when we have ST with more than just one resource (CustomResourceStatusST) it could break next test\nadded KafkaTopics created via cli to pointerResource -> for deleting after tests\nchanged delay in KafkaMirrorMaker2ST#testMirrorMaker2CorrectlyMirrorsHeaders, because when we had delay set to 0, the log doesn't contain anything, when we set it to 1000ms, it will log each message every second\nalso changed the number of messages to avoid waiting too long for the message send/receive\nadded deletion of topics in TopicST that are created via cli or auto-creation\n\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-09-16T18:02:44Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660", "merged": true, "mergeCommit": {"oid": "030f7b8946b1598b830783002ec2396a98b1dc4a"}, "closed": true, "closedAt": "2020-09-18T18:03:40Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJgR9eAH2gAyNDg4MTU4MzQ2OjY1NjM5Y2JiNzUwNmZmZDhhYzU3ZjExZmYxZjEzMjcwMmZkYTVjNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKI916AFqTQ5MTY1MDc1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/65639cbb7506ffd8ac57f11ff1f132702fda5c71", "committedDate": "2020-09-16T17:59:08Z", "message": "fixes for shared vol.1\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY4Mzc1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#pullrequestreview-490368375", "createdAt": "2020-09-17T08:38:08Z", "commit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODowOFrOHTXjTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODowOFrOHTXjTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDg2Mw==", "bodyText": "I don't have better solution in mind atm, but in case if creation will fail, the deletion will not be executed. Can we delete topic based on name and maybe move this code before wait of line 37?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#discussion_r490070863", "createdAt": "2020-09-17T08:38:08Z", "author": {"login": "Frawless"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/cli/KafkaCmdClient.java", "diffHunk": "@@ -25,9 +30,16 @@ public KafkaCmdClient() { }\n \n     public static String createTopicUsingPodCli(String clusterName, int zkPodId, String topic, int replicationFactor, int partitions) {\n         String podName = KafkaResources.zookeeperPodName(clusterName, zkPodId);\n-        return cmdKubeClient().execInPod(podName, \"/bin/bash\", \"-c\",\n+        String response = cmdKubeClient().execInPod(podName, \"/bin/bash\", \"-c\",\n             \"bin/kafka-topics.sh --zookeeper localhost:\" + PORT + \" --create \" + \" --topic \" + topic +\n                 \" --replication-factor \" + replicationFactor + \" --partitions \" + partitions).out();\n+\n+        KafkaTopicUtils.waitForKafkaTopicCreation(topic);\n+\n+        KafkaTopic kafkaTopic = KafkaTopicResource.kafkaTopicClient().inNamespace(kubeClient().getNamespace()).withName(topic).get();\n+        ResourceManager.getPointerResources().push(() -> ResourceManager.deleteLater(KafkaTopicResource.kafkaTopicClient(), kafkaTopic));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY5MDUw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#pullrequestreview-490369050", "createdAt": "2020-09-17T08:38:56Z", "commit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODo1NlrOHTXlaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODo1NlrOHTXlaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTQwMA==", "bodyText": "Did you update the message count for this test? I just want to avoid waiting there 500 seconds for example instead of 5 seconds.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#discussion_r490071400", "createdAt": "2020-09-17T08:38:56Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/mirrormaker/MirrorMaker2ST.java", "diffHunk": "@@ -650,11 +650,11 @@ void testMirrorMaker2CorrectlyMirrorsHeaders() {\n         //deploying example clients for checking if mm2 will mirror messages with headers\n \n         KafkaBasicClientResource targetKafkaClientsJob = new KafkaBasicClientResource(\"\", targetConsumerName,\n-            KafkaResources.plainBootstrapAddress(kafkaClusterTargetName), targetExampleTopic, MESSAGE_COUNT, \"\", ClientUtils.generateRandomConsumerGroup(), 0);\n+            KafkaResources.plainBootstrapAddress(kafkaClusterTargetName), targetExampleTopic, MESSAGE_COUNT, \"\", ClientUtils.generateRandomConsumerGroup(), 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY5MTQ1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#pullrequestreview-490369145", "createdAt": "2020-09-17T08:39:04Z", "commit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozOTowNFrOHTXltg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozOTowNFrOHTXltg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTQ3OA==", "bodyText": "Same as above", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#discussion_r490071478", "createdAt": "2020-09-17T08:39:04Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/mirrormaker/MirrorMaker2ST.java", "diffHunk": "@@ -650,11 +650,11 @@ void testMirrorMaker2CorrectlyMirrorsHeaders() {\n         //deploying example clients for checking if mm2 will mirror messages with headers\n \n         KafkaBasicClientResource targetKafkaClientsJob = new KafkaBasicClientResource(\"\", targetConsumerName,\n-            KafkaResources.plainBootstrapAddress(kafkaClusterTargetName), targetExampleTopic, MESSAGE_COUNT, \"\", ClientUtils.generateRandomConsumerGroup(), 0);\n+            KafkaResources.plainBootstrapAddress(kafkaClusterTargetName), targetExampleTopic, MESSAGE_COUNT, \"\", ClientUtils.generateRandomConsumerGroup(), 1000);\n         targetKafkaClientsJob.consumerStrimzi().done();\n \n         KafkaBasicClientResource sourceKafkaClientsJob = new KafkaBasicClientResource(sourceProducerName, \"\",\n-            KafkaResources.plainBootstrapAddress(kafkaClusterSourceName), sourceExampleTopic, MESSAGE_COUNT, \"\", ClientUtils.generateRandomConsumerGroup(), 0);\n+            KafkaResources.plainBootstrapAddress(kafkaClusterSourceName), sourceExampleTopic, MESSAGE_COUNT, \"\", ClientUtils.generateRandomConsumerGroup(), 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65639cbb7506ffd8ac57f11ff1f132702fda5c71"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d60bd295031aca0f39b5defb25909fba4b3653e", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5d60bd295031aca0f39b5defb25909fba4b3653e", "committedDate": "2020-09-17T12:05:11Z", "message": "another fixes + comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODkzMjAz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#pullrequestreview-490893203", "createdAt": "2020-09-17T18:53:56Z", "commit": {"oid": "5d60bd295031aca0f39b5defb25909fba4b3653e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a85a2cdb661475e0b2d80a42e305532e0d6e1119", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a85a2cdb661475e0b2d80a42e305532e0d6e1119", "committedDate": "2020-09-17T19:39:05Z", "message": "fixup! another fixes + comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ada5f8bf07437fe9a7b20ea404c0c5263a90d531", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ada5f8bf07437fe9a7b20ea404c0c5263a90d531", "committedDate": "2020-09-18T07:27:59Z", "message": "fixup! fixup! another fixes + comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37789107532b001bad1f2d36ec76357c02face4f", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/37789107532b001bad1f2d36ec76357c02face4f", "committedDate": "2020-09-18T07:32:12Z", "message": "fixup! fixup! fixup! another fixes + comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjI4NTE2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#pullrequestreview-491628516", "createdAt": "2020-09-18T16:49:50Z", "commit": {"oid": "37789107532b001bad1f2d36ec76357c02face4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjUwNzU3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3660#pullrequestreview-491650757", "createdAt": "2020-09-18T17:23:16Z", "commit": {"oid": "37789107532b001bad1f2d36ec76357c02face4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 984, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}