{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NDQxMDg3", "number": 2899, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODowOToyOFrOD3hUqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODowOToyOFrOD3hUqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NTQ0MjMyOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicScalabilityST.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODowOToyOFrOGN0H1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMjoxNDo1OFrOGOmjag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzODY0NA==", "bodyText": "Do we know how long this actually takes? The fact that you're having to change this suggests that the TO isn't really scaling very well the large numbers of topics, which is a problem.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2899#discussion_r417138644", "createdAt": "2020-04-29T08:09:28Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicScalabilityST.java", "diffHunk": "@@ -31,6 +32,13 @@ void testBigAmountOfTopicsCreatingViaK8s() {\n                 currentTopic, 3, 1, 1).build());\n         }\n \n+        for (int i = 0; i < NUMBER_OF_TOPICS; i = i + SAMPLE_OFFSET) {\n+            String currentTopic = topicName + i;\n+            LOGGER.debug(\"Verifying that {} topic CR has Ready status\", currentTopic);\n+\n+            KafkaTopicUtils.waitForKafkaTopicStatus(currentTopic, \"Ready\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "459331945d2a81f50c10f886c146c8ce069698c1"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2MzUwNQ==", "bodyText": "1000 TOPICS -> ~ 13 mins. The problem was that I was creating 2500 topics and do not wait on Ready status like in this change.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2899#discussion_r417263505", "createdAt": "2020-04-29T12:05:42Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicScalabilityST.java", "diffHunk": "@@ -31,6 +32,13 @@ void testBigAmountOfTopicsCreatingViaK8s() {\n                 currentTopic, 3, 1, 1).build());\n         }\n \n+        for (int i = 0; i < NUMBER_OF_TOPICS; i = i + SAMPLE_OFFSET) {\n+            String currentTopic = topicName + i;\n+            LOGGER.debug(\"Verifying that {} topic CR has Ready status\", currentTopic);\n+\n+            KafkaTopicUtils.waitForKafkaTopicStatus(currentTopic, \"Ready\");\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzODY0NA=="}, "originalCommit": {"oid": "459331945d2a81f50c10f886c146c8ce069698c1"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI5MTQxMg==", "bodyText": "I wonder how quickly you can create 1000 topics in the same cluster without using the TO. Is there any chance you could find out? My feeling is that the ZK writes which TO does will slow it down, but IDK the difference as a factor. If it was 2\u00d7 slower that might be OK. If it was 10\u00d7 slower I think we'd definitely need to look into it more.\nAnother thing is how long is takes to do periodic reconciliation when there are 1000 topics. It shouldn't really affect the (eventual) correctness, but again it would be good to get a feel for these numbers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2899#discussion_r417291412", "createdAt": "2020-04-29T12:54:42Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicScalabilityST.java", "diffHunk": "@@ -31,6 +32,13 @@ void testBigAmountOfTopicsCreatingViaK8s() {\n                 currentTopic, 3, 1, 1).build());\n         }\n \n+        for (int i = 0; i < NUMBER_OF_TOPICS; i = i + SAMPLE_OFFSET) {\n+            String currentTopic = topicName + i;\n+            LOGGER.debug(\"Verifying that {} topic CR has Ready status\", currentTopic);\n+\n+            KafkaTopicUtils.waitForKafkaTopicStatus(currentTopic, \"Ready\");\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzODY0NA=="}, "originalCommit": {"oid": "459331945d2a81f50c10f886c146c8ce069698c1"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk2MzkxNA==", "bodyText": "I have tried to create 1000 topics via AdminClient and it was in approximately ~9 mins.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2899#discussion_r417963914", "createdAt": "2020-04-30T12:13:10Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicScalabilityST.java", "diffHunk": "@@ -31,6 +32,13 @@ void testBigAmountOfTopicsCreatingViaK8s() {\n                 currentTopic, 3, 1, 1).build());\n         }\n \n+        for (int i = 0; i < NUMBER_OF_TOPICS; i = i + SAMPLE_OFFSET) {\n+            String currentTopic = topicName + i;\n+            LOGGER.debug(\"Verifying that {} topic CR has Ready status\", currentTopic);\n+\n+            KafkaTopicUtils.waitForKafkaTopicStatus(currentTopic, \"Ready\");\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzODY0NA=="}, "originalCommit": {"oid": "459331945d2a81f50c10f886c146c8ce069698c1"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk2NDkwNg==", "bodyText": "@see-quick thanks for that, it's a useful datapoint.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2899#discussion_r417964906", "createdAt": "2020-04-30T12:14:58Z", "author": {"login": "tombentley"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/topic/TopicScalabilityST.java", "diffHunk": "@@ -31,6 +32,13 @@ void testBigAmountOfTopicsCreatingViaK8s() {\n                 currentTopic, 3, 1, 1).build());\n         }\n \n+        for (int i = 0; i < NUMBER_OF_TOPICS; i = i + SAMPLE_OFFSET) {\n+            String currentTopic = topicName + i;\n+            LOGGER.debug(\"Verifying that {} topic CR has Ready status\", currentTopic);\n+\n+            KafkaTopicUtils.waitForKafkaTopicStatus(currentTopic, \"Ready\");\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzODY0NA=="}, "originalCommit": {"oid": "459331945d2a81f50c10f886c146c8ce069698c1"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 240, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}