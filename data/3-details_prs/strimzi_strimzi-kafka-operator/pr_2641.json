{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNDEwNjY1", "number": 2641, "title": "[MO] - [refactor] -> fileutils reworked to try with resource", "bodyText": "Signed-off-by: see-quick xorsak02@stud.fit.vutbr.cz\nType of change\n\nRefactoring\n\nDescription\nThis PR changing way how to close streams. Instead of using finally block just use contructor inside try block and let compiler do the closing phase for us.\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-03-04T08:38:52Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641", "merged": true, "mergeCommit": {"oid": "eba0cce2716d22ef400fcf32b35b6f60bce31e16"}, "closed": true, "closedAt": "2020-03-05T17:39:46Z", "author": {"login": "see-quick"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKSvj_AH2gAyMzgzNDEwNjY1OjBmOWEzMTg1MTdmZDhmMTc5MDdmNWZlNWIyZWU5NzMzN2QxYjQwYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKnUUcgFqTM2OTM3NDkyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0f9a318517fd8f17907f5fe5b2ee97337d1b40aa", "committedDate": "2020-03-04T08:35:34Z", "message": "[MO] - [refactor] -> fileutils reworked to try with resource\n\nSigned-off-by: see-quick <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af056d662d33d1ee52b7f11ff95e2583a974e86", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1af056d662d33d1ee52b7f11ff95e2583a974e86", "committedDate": "2020-03-04T08:47:53Z", "message": "[MO] - [update] -ss\n\nSigned-off-by: see-quick <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTkxNzcw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#pullrequestreview-368591770", "createdAt": "2020-03-04T08:46:37Z", "commit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0NjozN1rOFxkXnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0OTo0MFrOFxkdRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDQxMw==", "bodyText": "This case of the zip entry being a directory is no longer handled.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387520413", "createdAt": "2020-03-04T08:46:37Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDcyMw==", "bodyText": "I guess we should fix the captialization NameSpace \u2192 Namespace", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387520723", "createdAt": "2020-03-04T08:47:16Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTM1MA==", "bodyText": "Wrapping into a RuntimeException is preferred, because it's much less easily overlooked.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521350", "createdAt": "2020-03-04T08:48:36Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             BufferedReader br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+             OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8)){\n \n-        try {\n-            bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n             StringBuilder sb = new StringBuilder();\n-            br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+\n             String read;\n             while ((read = br.readLine()) != null) {\n-                sb.append(read + \"\\n\");\n+                sb.append(read);\n+                sb.append(\"\\n\");\n             }\n-            br.close();\n             String yaml = sb.toString();\n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n             yaml = yaml.replace(\"securityContext:\\n\" +\n                 \"        runAsNonRoot: true\\n\" +\n                 \"        runAsUser: 65534\", \"\");\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile;\n \n         } catch (IOException e) {\n             e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTUzNg==", "bodyText": "I don't think you need the ;", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521536", "createdAt": "2020-03-04T08:49:01Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             BufferedReader br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+             OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8)){\n \n-        try {\n-            bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n             StringBuilder sb = new StringBuilder();\n-            br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+\n             String read;\n             while ((read = br.readLine()) != null) {\n-                sb.append(read + \"\\n\");\n+                sb.append(read);\n+                sb.append(\"\\n\");\n             }\n-            br.close();\n             String yaml = sb.toString();\n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n             yaml = yaml.replace(\"securityContext:\\n\" +\n                 \"        runAsNonRoot: true\\n\" +\n                 \"        runAsUser: 65534\", \"\");\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile;\n \n         } catch (IOException e) {\n             e.printStackTrace();\n-        } finally {\n-            if (bais != null) {\n-                try {\n-                    bais.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (br != null) {\n-                try {\n-                    br.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (osw != null) {\n-                try {\n-                    osw.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n         }\n         return null;\n     }\n \n-    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) {\n+    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) throws IOException {\n         byte[] encoded;\n-        OutputStreamWriter osw = null;\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n \n-        try {\n+        try (OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 129}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTczMA==", "bodyText": "Again, throw a RuntimeException", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521730", "createdAt": "2020-03-04T08:49:24Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             BufferedReader br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+             OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8)){\n \n-        try {\n-            bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n             StringBuilder sb = new StringBuilder();\n-            br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+\n             String read;\n             while ((read = br.readLine()) != null) {\n-                sb.append(read + \"\\n\");\n+                sb.append(read);\n+                sb.append(\"\\n\");\n             }\n-            br.close();\n             String yaml = sb.toString();\n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n             yaml = yaml.replace(\"securityContext:\\n\" +\n                 \"        runAsNonRoot: true\\n\" +\n                 \"        runAsUser: 65534\", \"\");\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile;\n \n         } catch (IOException e) {\n             e.printStackTrace();\n-        } finally {\n-            if (bais != null) {\n-                try {\n-                    bais.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (br != null) {\n-                try {\n-                    br.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (osw != null) {\n-                try {\n-                    osw.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n         }\n         return null;\n     }\n \n-    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) {\n+    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) throws IOException {\n         byte[] encoded;\n-        OutputStreamWriter osw = null;\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n \n-        try {\n+        try (OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);) {\n             encoded = Files.readAllBytes(Paths.get(pathToOrigin));\n \n             String yaml = new String(encoded, StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n \n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile.toPath().toFile();\n         } catch (IOException e) {\n             e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTg2Mg==", "bodyText": "Is this still needed?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521862", "createdAt": "2020-03-04T08:49:40Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjUwOTU3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#pullrequestreview-368650957", "createdAt": "2020-03-04T10:12:12Z", "commit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ffb13b78f8910cea9067a5ceec525bff924bf4e", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5ffb13b78f8910cea9067a5ceec525bff924bf4e", "committedDate": "2020-03-04T11:35:46Z", "message": "[MO] - [update] -> last values\n\nSigned-off-by: see-quick <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NzU2NzA3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#pullrequestreview-368756707", "createdAt": "2020-03-04T13:01:18Z", "commit": {"oid": "5ffb13b78f8910cea9067a5ceec525bff924bf4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16f76abcfacff676143b2ecae20f0de70110aad8", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/16f76abcfacff676143b2ecae20f0de70110aad8", "committedDate": "2020-03-04T14:44:24Z", "message": "[MO] - [update] -> add\n\nSigned-off-by: see-quick <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODYzNTIy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#pullrequestreview-368863522", "createdAt": "2020-03-04T15:15:39Z", "commit": {"oid": "16f76abcfacff676143b2ecae20f0de70110aad8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToxNTozOVrOFxxTEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToxNTozOVrOFxxTEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczMjI0MQ==", "bodyText": "file is a filename in a temp directory you just created, so it wouldn't normally exist. I think you want something like this:\nif (entry.isDirectory()) {\n    if (file.exists()) {\n        if (!file.isDirectory()) {\n            throw new IOException(\"Malformed zip file\");\n        }\n    } else {\n        if (!file.mkdirs()) {\n            throw new IOException(\"Could not create directory \" + file);\n        }\n    }\n} else {\n    file.getParentFile().mkdirs(); // create parent; in case zip file is malformed\n    try (FileOutputStream fout = new FileOutputStream(file)) {\n    while ((len = zin.read(buffer)) != -1) {\n        fout.write(buffer, 0, len);\n    }\n}\nYou could have similar logic for the 2nd mkdirs() as for the first (and maybe factor into a maybeCreateDirectory() method).", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387732241", "createdAt": "2020-03-04T15:15:39Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -28,134 +28,82 @@\n \n     private FileUtils() { }\n \n-    @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n-    public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+    @SuppressFBWarnings(\"RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE\")\n+    public static File downloadAndUnzip(String url) throws IOException {\n+        File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+            ZipInputStream zin = new ZipInputStream(bais)) {\n+\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n-                    while ((len = zin.read(buffer)) != -1) {\n-                        fout.write(buffer, 0, len);\n+                boolean isDirectoryCreated = file.exists();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f76abcfacff676143b2ecae20f0de70110aad8"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35775a3ae2b4023959b869965e0ccca211230060", "author": {"user": {"login": "see-quick", "name": "Ors\u00e1k Maro\u0161"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/35775a3ae2b4023959b869965e0ccca211230060", "committedDate": "2020-03-04T21:46:02Z", "message": "[MO] - [update] -> s\n\nSigned-off-by: see-quick <xorsak02@stud.fit.vutbr.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzc0OTIx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#pullrequestreview-369374921", "createdAt": "2020-03-05T08:33:49Z", "commit": {"oid": "35775a3ae2b4023959b869965e0ccca211230060"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1751, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}