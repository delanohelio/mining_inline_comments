{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjAzMTQ2", "number": 3528, "title": "[systemtest] Fix tests failing on ocp4.x", "bodyText": "Signed-off-by: Lukas Kral lukywill16@gmail.com\nType of change\n\nBugfix\n\nDescription\nThis PR fixes testDeployKafkaClusterViaTemplate where the client.customResourceDefinitions().list().getItems() throws exception about k8s list. It seems like there is some problem with Fabric8 version (this will be hopefully fixed by @stanlyDoge). So I made a small workaround to get number of CRDs that contains label app=strimzi -> for this I needed the exact number of CRDs that we are applying -> so for this I created the getCrdsCount() method.\nThe testDeployKafkaClusterViaTemplate affected these two tests: testLabelsAndAnnotationForPVC and testEODeletion.\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-08-19T14:27:48Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528", "merged": true, "mergeCommit": {"oid": "ee12d9bdd102d0d1eaf9b476f8e0a3e883b59a1f"}, "closed": true, "closedAt": "2020-08-20T18:12:15Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAciiVAFqTQ3MDUxOTQxMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA0KaGAFqTQ3MTg1OTUxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTE5NDEw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-470519410", "createdAt": "2020-08-19T14:32:18Z", "commit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTIyOTA0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-470522904", "createdAt": "2020-08-19T14:35:37Z", "commit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNDozNTozOFrOHDKavQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNDozNTozOFrOHDKavQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3ODQ2MQ==", "bodyText": "Question: Why do we use kubectl commands over using the fabric8 api?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473078461", "createdAt": "2020-08-19T14:35:38Z", "author": {"login": "samuel-hawker"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -421,12 +421,10 @@ protected void verifyLabelsOnPods(String clusterName, String podType, String app\n \n     void verifyLabelsForCRDs() {\n         LOGGER.info(\"Verifying labels for CRDs\");\n-        kubeClient().listCustomResourceDefinition().stream()\n-            .filter(crd -> crd.getMetadata().getName().startsWith(\"kafka\"))\n-            .forEach(crd -> {\n-                LOGGER.info(\"Verifying labels for custom resource {}\", crd.getMetadata().getName());\n-                assertThat(crd.getMetadata().getLabels().get(\"app\"), is(\"strimzi\"));\n-            });\n+        String crds = cmdKubeClient().exec(\"get\", \"crds\", \"--selector=app=strimzi\", \"-o\", \"jsonpath='{.items[*].metadata.name}'\").out();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTM3MzE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-470537318", "createdAt": "2020-08-19T14:50:19Z", "commit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzM4ODMy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-470738832", "createdAt": "2020-08-19T18:39:45Z", "commit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozOTo0NVrOHDUeZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozOTo0NVrOHDUeZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0MzIzNg==", "bodyText": "I have to say that somehow the getCrdsCount seems weird. Wouldn't getCrdCount be more natural? WDYT @samuel-hawker?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#discussion_r473243236", "createdAt": "2020-08-19T18:39:45Z", "author": {"login": "scholzj"}, "path": "api/src/main/java/io/strimzi/api/kafka/Crds.java", "diffHunk": "@@ -373,4 +373,8 @@ public static CustomResourceDefinition kafkaRebalance() {\n             throw new RuntimeException(e);\n         }\n     }\n+\n+    public static int getCrdsCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTI3NDMw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-471527430", "createdAt": "2020-08-20T12:06:56Z", "commit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0c882a3c8e589ec5ba992c051b0ebb580c00510", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b0c882a3c8e589ec5ba992c051b0ebb580c00510", "committedDate": "2020-08-20T13:17:20Z", "message": "fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11053ff1263334631d660941888ae85648996cfa", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/11053ff1263334631d660941888ae85648996cfa", "committedDate": "2020-08-20T13:20:57Z", "message": "comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8845f70d7a9735ecb8a240faadc9e033142abb0a", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8845f70d7a9735ecb8a240faadc9e033142abb0a", "committedDate": "2020-08-19T14:17:45Z", "message": "fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "11053ff1263334631d660941888ae85648996cfa", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/11053ff1263334631d660941888ae85648996cfa", "committedDate": "2020-08-20T13:20:57Z", "message": "comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjI2MjEx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-471626211", "createdAt": "2020-08-20T13:41:52Z", "commit": {"oid": "11053ff1263334631d660941888ae85648996cfa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxODU5NTE5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3528#pullrequestreview-471859519", "createdAt": "2020-08-20T18:03:41Z", "commit": {"oid": "11053ff1263334631d660941888ae85648996cfa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1180, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}