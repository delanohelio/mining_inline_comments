{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMjQzMDc4", "number": 2391, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoxMDowOFrODaFQFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0OTo1MVrODaF3hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc1NjA0OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoxMDowOFrOFg1kCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoxMDowOFrOFg1kCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk3NjMzMQ==", "bodyText": "I'd use caCertName for this variable.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369976331", "createdAt": "2020-01-23T08:10:08Z", "author": {"login": "sknot-rh"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "diffHunk": "@@ -68,17 +73,24 @@ public void close() {\n     @Override\n     public Future<Integer> sendMessagesTls(String topicName, String namespace, String clusterName, String kafkaUsername, int messageCount, String securityProtocol) {\n         String clientName = \"sender-ssl\" + clusterName;\n+        vertx = Vertx.vertx();\n         CompletableFuture<Integer> resultPromise = new CompletableFuture<>();\n \n         IntPredicate msgCntPredicate = x -> x == messageCount;\n \n-        vertx.deployVerticle(new Producer(KafkaClientProperties.createProducerProperties(namespace, clusterName, kafkaUsername, securityProtocol, EClientType.BASIC, null), resultPromise, msgCntPredicate, topicName, clientName));\n+        String clientSecretName = getCaCertName() == null ? KafkaResource.getKafkaExternalListenerCaCertName(namespace, clusterName) : getCaCertName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc1ODgwOnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoxMToxNlrOFg1lmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoxMToxNlrOFg1lmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk3NjczMQ==", "bodyText": "I'd use caCertName for this variable.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369976731", "createdAt": "2020-01-23T08:11:16Z", "author": {"login": "sknot-rh"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "diffHunk": "@@ -196,17 +212,24 @@ public void sendMessagesExternalScramSha(String clusterName, String namespace, S\n     @Override\n     public Future<Integer> receiveMessagesTls(String topicName, String namespace, String clusterName, String kafkaUsername, int messageCount, String securityProtocol, String consumerGroup) {\n         String clientName = \"receiver-ssl-\" + clusterName;\n+        vertx = Vertx.vertx();\n         CompletableFuture<Integer> resultPromise = new CompletableFuture<>();\n \n         IntPredicate msgCntPredicate = x -> x == messageCount;\n \n-        vertx.deployVerticle(new Consumer(KafkaClientProperties.createConsumerProperties(namespace, clusterName, kafkaUsername, securityProtocol, consumerGroup), resultPromise, msgCntPredicate, topicName, clientName));\n+        String clientSecretName = getCaCertName() == null ? KafkaResource.getKafkaExternalListenerCaCertName(namespace, clusterName) : getCaCertName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc3ODM0OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kubeUtils/objects/PodUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMDoxMVrOFg1xdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMDoxMVrOFg1xdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk3OTc2Nw==", "bodyText": "Why is this value set to 10? :O", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369979767", "createdAt": "2020-01-23T08:20:11Z", "author": {"login": "sknot-rh"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kubeUtils/objects/PodUtils.java", "diffHunk": "@@ -82,7 +85,8 @@ public static void waitForPodsReady(LabelSelector selector, int expectPods, bool\n             }\n             LOGGER.debug(\"Pods {} are ready\",\n                 pods.stream().map(p -> p.getMetadata().getName()).collect(Collectors.joining(\", \")));\n-            return true;\n+            int c = count.getAndIncrement();\n+            return c > 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc4MTMyOnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/resources/log4j2.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMToyOVrOFg1zYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMToyOVrOFg1zYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4MDI1Ng==", "bodyText": "I know it is annoying but I'd split this to separate PR", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369980256", "createdAt": "2020-01-23T08:21:29Z", "author": {"login": "sknot-rh"}, "path": "systemtest/src/main/resources/log4j2.properties", "diffHunk": "@@ -5,7 +5,7 @@ appender.console.name = STDOUT\n appender.console.layout.type = PatternLayout\n appender.console.layout.pattern = [%d] %highlight{%-5p} %m (%c:%L)%n\n \n-rootLogger.level = ${env:STRIMZI_LOG_LEVEL:-INFO}\n+rootLogger.level = ${env:STRIMZI_TEST_LOG_LEVEL:-INFO}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc4Mjk2OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMjoxOVrOFg10Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMjoxOVrOFg10Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4MDUxOA==", "bodyText": "Just a detail, by java convention there is no need to use getters unless we perfoming some control logic inside getters. Change getCaCertName() --> caCertName or this.caCertName\n\nThe reason for hiding is mainly to hide the implementation (and there's no need to hide the implementation from the class itself)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369980518", "createdAt": "2020-01-23T08:22:19Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "diffHunk": "@@ -68,17 +73,24 @@ public void close() {\n     @Override\n     public Future<Integer> sendMessagesTls(String topicName, String namespace, String clusterName, String kafkaUsername, int messageCount, String securityProtocol) {\n         String clientName = \"sender-ssl\" + clusterName;\n+        vertx = Vertx.vertx();\n         CompletableFuture<Integer> resultPromise = new CompletableFuture<>();\n \n         IntPredicate msgCntPredicate = x -> x == messageCount;\n \n-        vertx.deployVerticle(new Producer(KafkaClientProperties.createProducerProperties(namespace, clusterName, kafkaUsername, securityProtocol, EClientType.BASIC, null), resultPromise, msgCntPredicate, topicName, clientName));\n+        String clientSecretName = getCaCertName() == null ? KafkaResource.getKafkaExternalListenerCaCertName(namespace, clusterName) : getCaCertName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc4NDE5OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMjo0OVrOFg11JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyMjo0OVrOFg11JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4MDcwOA==", "bodyText": "here also", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369980708", "createdAt": "2020-01-23T08:22:49Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/kafkaclients/internalclients/KafkaClient.java", "diffHunk": "@@ -196,17 +212,24 @@ public void sendMessagesExternalScramSha(String clusterName, String namespace, S\n     @Override\n     public Future<Integer> receiveMessagesTls(String topicName, String namespace, String clusterName, String kafkaUsername, int messageCount, String securityProtocol, String consumerGroup) {\n         String clientName = \"receiver-ssl-\" + clusterName;\n+        vertx = Vertx.vertx();\n         CompletableFuture<Integer> resultPromise = new CompletableFuture<>();\n \n         IntPredicate msgCntPredicate = x -> x == messageCount;\n \n-        vertx.deployVerticle(new Consumer(KafkaClientProperties.createConsumerProperties(namespace, clusterName, kafkaUsername, securityProtocol, consumerGroup), resultPromise, msgCntPredicate, topicName, clientName));\n+        String clientSecretName = getCaCertName() == null ? KafkaResource.getKafkaExternalListenerCaCertName(namespace, clusterName) : getCaCertName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njc5NDMzOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/resources/log4j2.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyNjo0NVrOFg17Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODoyNjo0NVrOFg17Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4MjI0Mg==", "bodyText": "Dito", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369982242", "createdAt": "2020-01-23T08:26:45Z", "author": {"login": "sknot-rh"}, "path": "systemtest/src/test/resources/log4j2.properties", "diffHunk": "@@ -5,7 +5,7 @@ appender.console.name = STDOUT\n appender.console.layout.type = PatternLayout\n appender.console.layout.pattern = %d{yyyy-MM-dd HH:mm:ss}{GMT} %highlight{%-5p} [%c{1}:%L] %m%n\n \n-rootLogger.level = ${env:STRIMZI_LOG_LEVEL:-INFO}\n+rootLogger.level = ${env:STRIMZI_TEST_LOG_LEVEL:-INFO}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjgxMzU4OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODozMzozMlrOFg2GOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODozMzozMlrOFg2GOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4NTA4MQ==", "bodyText": "Can you specify in default new value for example like KafkaListenerExternalIngress.TYPE_NONE, basically use it instead of null when you comparing in return or it isn't possible?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369985081", "createdAt": "2020-01-23T08:33:32Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "diffHunk": "@@ -199,4 +207,35 @@ public static void replaceKafkaResource(String resourceName, Consumer<Kafka> edi\n         ResourceManager.replaceCrdResource(Kafka.class, KafkaList.class, DoneableKafka.class, resourceName, editor);\n     }\n \n+    public static String getKafkaTlsListenerCaCertName(String namespace, String clusterName) {\n+        KafkaListenerTls kafkaListenerTls = kafkaClient().inNamespace(namespace).withName(clusterName).get().getSpec().getKafka().getListeners().getTls();\n+        return kafkaListenerTls.getConfiguration() == null ?\n+                KafkaResources.clusterCaCertificateSecretName(clusterName) : kafkaListenerTls.getConfiguration().getBrokerCertChainAndKey().getSecretName();\n+    }\n+\n+    public static String getKafkaExternalListenerCaCertName(String namespace, String clusterName) {\n+        KafkaListenerExternal kafkaListenerExternal = kafkaClient().inNamespace(namespace).withName(clusterName).get().getSpec().getKafka().getListeners().getExternal();\n+\n+        KafkaListenerExternalConfiguration kafkaListenerExternalConfiguration = null;\n+\n+        switch (kafkaListenerExternal.getType()) {\n+            case KafkaListenerExternalRoute.TYPE_ROUTE:\n+                kafkaListenerExternalConfiguration = ((KafkaListenerExternalRoute) kafkaListenerExternal).getConfiguration();\n+                break;\n+            case KafkaListenerExternalNodePort.TYPE_NODEPORT:\n+                kafkaListenerExternalConfiguration = ((KafkaListenerExternalNodePort) kafkaListenerExternal).getConfiguration();\n+                break;\n+            case KafkaListenerExternalLoadBalancer.TYPE_LOADBALANCER:\n+                kafkaListenerExternalConfiguration = ((KafkaListenerExternalLoadBalancer) kafkaListenerExternal).getConfiguration();\n+                break;\n+            case KafkaListenerExternalIngress.TYPE_INGRESS:\n+                kafkaListenerExternalConfiguration = ((KafkaListenerExternalIngress) kafkaListenerExternal).getConfiguration();\n+                break;\n+            default:\n+                break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjgyMjQ2OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODozNzowNFrOFg2Llw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODozNzowNFrOFg2Llw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4NjQ1NQ==", "bodyText": "as we discussed yesterday, you will change this parameters to have only username instead of CLUSTER_NAME, NAMESPACE parameters right ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369986455", "createdAt": "2020-01-23T08:37:04Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -493,7 +493,7 @@ void testSendMessagesPlainAnonymous() throws InterruptedException {\n         KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n         KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n \n-        KafkaClientsResource.deployKafkaClients(CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS).done();\n+        KafkaClientsResource.deployKafkaClients(false, CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS, CLUSTER_NAME, NAMESPACE).done();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjgzNjYxOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/ListenersST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0MjoyOVrOFg2UBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0MjoyOVrOFg2UBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4ODYxMw==", "bodyText": "Move this method variable userName to class variable, because you are using mostly in all  test cases as i can see.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369988613", "createdAt": "2020-01-23T08:42:29Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/ListenersST.java", "diffHunk": "@@ -0,0 +1,822 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.kafka;\n+\n+import io.strimzi.api.kafka.model.KafkaResources;\n+import io.strimzi.api.kafka.model.KafkaUser;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerExternalLoadBalancerBuilder;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerExternalNodePortBuilder;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerExternalRouteBuilder;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerTlsBuilder;\n+import io.strimzi.systemtest.BaseST;\n+import io.strimzi.systemtest.Constants;\n+import io.strimzi.systemtest.annotations.OpenShiftOnly;\n+import io.strimzi.systemtest.resources.KubernetesResource;\n+import io.strimzi.systemtest.resources.ResourceManager;\n+import io.strimzi.systemtest.resources.crd.KafkaClientsResource;\n+import io.strimzi.systemtest.resources.crd.KafkaResource;\n+import io.strimzi.systemtest.resources.crd.KafkaUserResource;\n+import io.strimzi.systemtest.utils.kafkaUtils.KafkaUtils;\n+import io.strimzi.systemtest.utils.kubeUtils.controllers.StatefulSetUtils;\n+import io.strimzi.systemtest.utils.kubeUtils.objects.SecretUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Tag;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.Map;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.strimzi.systemtest.Constants.LOADBALANCER_SUPPORTED;\n+import static io.strimzi.systemtest.Constants.NODEPORT_SUPPORTED;\n+import static io.strimzi.systemtest.Constants.REGRESSION;\n+import static io.strimzi.test.k8s.KubeClusterResource.kubeClient;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+\n+@Tag(REGRESSION)\n+public class ListenersST extends BaseST {\n+    private static final Logger LOGGER = LogManager.getLogger(ListenersST.class);\n+\n+    public static final String NAMESPACE = \"kafka-listeners-cluster-test\";\n+\n+    private String customCertChain1 = \"custom-certificate-chain-1\";\n+    private String customCertChain2 = \"custom-certificate-chain-2\";\n+    private String customCertServer1 = \"custom-certificate-server-1\";\n+    private String customCertServer2 = \"custom-certificate-server-2\";\n+    private String customRootCA1 = \"custom-certificate-root-1\";\n+    private String customRootCA2 = \"custom-certificate-root-2\";\n+\n+    @Test\n+    @Tag(NODEPORT_SUPPORTED)\n+    void testCustomSoloCertificatesForNodePort() throws Exception {\n+        String topicName = \"test-topic-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 3)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewTls()\n+                            .withNewConfiguration()\n+                                .withNewBrokerCertChainAndKey()\n+                                    .withSecretName(customCertServer1)\n+                                    .withKey(\"ca.key\")\n+                                    .withCertificate(\"ca.crt\")\n+                                .endBrokerCertChainAndKey()\n+                            .endConfiguration()\n+                        .endTls()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withNewConfiguration()\n+                                .withNewBrokerCertChainAndKey()\n+                                    .withSecretName(customCertServer1)\n+                                    .withKey(\"ca.key\")\n+                                    .withCertificate(\"ca.crt\")\n+                                .endBrokerCertChainAndKey()\n+                            .endConfiguration()\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec().done();\n+\n+        String userName = \"alice\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njg0NjMwOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/ListenersST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0NjowMFrOFg2Ztw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0NjowMFrOFg2Ztw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MDA3MQ==", "bodyText": "Would it be good to create method verifyCommunicationWIthExternalClient and change it in all test cases? Same method applicable in internal.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369990071", "createdAt": "2020-01-23T08:46:00Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/ListenersST.java", "diffHunk": "@@ -0,0 +1,822 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.kafka;\n+\n+import io.strimzi.api.kafka.model.KafkaResources;\n+import io.strimzi.api.kafka.model.KafkaUser;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerExternalLoadBalancerBuilder;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerExternalNodePortBuilder;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerExternalRouteBuilder;\n+import io.strimzi.api.kafka.model.listener.KafkaListenerTlsBuilder;\n+import io.strimzi.systemtest.BaseST;\n+import io.strimzi.systemtest.Constants;\n+import io.strimzi.systemtest.annotations.OpenShiftOnly;\n+import io.strimzi.systemtest.resources.KubernetesResource;\n+import io.strimzi.systemtest.resources.ResourceManager;\n+import io.strimzi.systemtest.resources.crd.KafkaClientsResource;\n+import io.strimzi.systemtest.resources.crd.KafkaResource;\n+import io.strimzi.systemtest.resources.crd.KafkaUserResource;\n+import io.strimzi.systemtest.utils.kafkaUtils.KafkaUtils;\n+import io.strimzi.systemtest.utils.kubeUtils.controllers.StatefulSetUtils;\n+import io.strimzi.systemtest.utils.kubeUtils.objects.SecretUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Tag;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.Map;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.strimzi.systemtest.Constants.LOADBALANCER_SUPPORTED;\n+import static io.strimzi.systemtest.Constants.NODEPORT_SUPPORTED;\n+import static io.strimzi.systemtest.Constants.REGRESSION;\n+import static io.strimzi.test.k8s.KubeClusterResource.kubeClient;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+\n+@Tag(REGRESSION)\n+public class ListenersST extends BaseST {\n+    private static final Logger LOGGER = LogManager.getLogger(ListenersST.class);\n+\n+    public static final String NAMESPACE = \"kafka-listeners-cluster-test\";\n+\n+    private String customCertChain1 = \"custom-certificate-chain-1\";\n+    private String customCertChain2 = \"custom-certificate-chain-2\";\n+    private String customCertServer1 = \"custom-certificate-server-1\";\n+    private String customCertServer2 = \"custom-certificate-server-2\";\n+    private String customRootCA1 = \"custom-certificate-root-1\";\n+    private String customRootCA2 = \"custom-certificate-root-2\";\n+\n+    @Test\n+    @Tag(NODEPORT_SUPPORTED)\n+    void testCustomSoloCertificatesForNodePort() throws Exception {\n+        String topicName = \"test-topic-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 3)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewTls()\n+                            .withNewConfiguration()\n+                                .withNewBrokerCertChainAndKey()\n+                                    .withSecretName(customCertServer1)\n+                                    .withKey(\"ca.key\")\n+                                    .withCertificate(\"ca.crt\")\n+                                .endBrokerCertChainAndKey()\n+                            .endConfiguration()\n+                        .endTls()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withNewConfiguration()\n+                                .withNewBrokerCertChainAndKey()\n+                                    .withSecretName(customCertServer1)\n+                                    .withKey(\"ca.key\")\n+                                    .withCertificate(\"ca.crt\")\n+                                .endBrokerCertChainAndKey()\n+                            .endConfiguration()\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec().done();\n+\n+        String userName = \"alice\";\n+        KafkaUser aliceUser = KafkaUserResource.tlsUser(CLUSTER_NAME, userName).done();\n+\n+        kafkaClient.setCaCertName(customCertServer1);\n+        Future producer = kafkaClient.sendMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 10, \"SSL\");\n+        Future consumer = kafkaClient.receiveMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 10, \"SSL\");\n+\n+        assertThat(\"Producer didn't produce all messages\", producer.get(1, TimeUnit.MINUTES), is(10));\n+        assertThat(\"Consumer didn't consume all messages\", consumer.get(1, TimeUnit.MINUTES), is(10));\n+\n+        // Deploy client pod with custom certificates and collect messages from internal TLS listener\n+        KafkaClientsResource.deployKafkaClients(true, CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS, CLUSTER_NAME, NAMESPACE, false, aliceUser).done();\n+\n+        externalKafkaClient.setPodName(kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS).get(0).getMetadata().getName());\n+        int sent = externalKafkaClient.sendMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 10, \"TLS\");\n+        assertThat(sent, is(10));\n+        int received = externalKafkaClient.receiveMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 20, \"TLS\", \"consumer-group-certs-1\");\n+        assertThat(received, is(20));\n+    }\n+\n+    @Test\n+    @Tag(NODEPORT_SUPPORTED)\n+    void testCustomChainCertificatesForNodePort() throws Exception {\n+        String topicName = \"test-topic-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3, 3)\n+            .editSpec()\n+                .editKafka()\n+                    .editListeners()\n+                        .withNewTls()\n+                            .withNewConfiguration()\n+                                .withNewBrokerCertChainAndKey()\n+                                    .withSecretName(customCertChain1)\n+                                    .withKey(\"ca.key\")\n+                                    .withCertificate(\"ca.crt\")\n+                                .endBrokerCertChainAndKey()\n+                            .endConfiguration()\n+                        .endTls()\n+                        .withNewKafkaListenerExternalNodePort()\n+                            .withNewConfiguration()\n+                                .withNewBrokerCertChainAndKey()\n+                                    .withSecretName(customCertChain1)\n+                                    .withKey(\"ca.key\")\n+                                    .withCertificate(\"ca.crt\")\n+                                .endBrokerCertChainAndKey()\n+                            .endConfiguration()\n+                        .endKafkaListenerExternalNodePort()\n+                    .endListeners()\n+                .endKafka()\n+            .endSpec().done();\n+\n+        String userName = \"alice\";\n+        KafkaUser aliceUser = KafkaUserResource.tlsUser(CLUSTER_NAME, userName).done();\n+\n+        kafkaClient.setCaCertName(customRootCA1);\n+        Future producer = kafkaClient.sendMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 10, \"SSL\");\n+        Future consumer = kafkaClient.receiveMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 10, \"SSL\");\n+\n+        assertThat(\"Producer didn't produce all messages\", producer.get(1, TimeUnit.MINUTES), is(10));\n+        assertThat(\"Consumer didn't consume all messages\", consumer.get(1, TimeUnit.MINUTES), is(10));\n+\n+        // Deploy client pod with custom certificates and collect messages from internal TLS listener\n+        KafkaClientsResource.deployKafkaClients(true, CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS, CLUSTER_NAME, NAMESPACE, false, aliceUser).done();\n+\n+        externalKafkaClient.setPodName(kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS).get(0).getMetadata().getName());\n+        int sent = externalKafkaClient.sendMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 10, \"TLS\");\n+        assertThat(sent, is(10));\n+        int received = externalKafkaClient.receiveMessagesTls(topicName, NAMESPACE, CLUSTER_NAME, userName, 20, \"TLS\", \"consumer-group-certs-2\");\n+        assertThat(received, is(20));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njg1NzAwOnYy", "diffSide": "RIGHT", "path": "test/src/main/java/io/strimzi/test/k8s/KubeClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0OTo1MVrOFg2gPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0OTo1MVrOFg2gPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTc0MA==", "bodyText": "Hmmm, why do we need this operation createOrReplace instead of create? Shouldn't we be warned that if we in test case create one secret with name secret-example and if we try create again same secret we should get error or?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2391#discussion_r369991740", "createdAt": "2020-01-23T08:49:51Z", "author": {"login": "see-quick"}, "path": "test/src/main/java/io/strimzi/test/k8s/KubeClient.java", "diffHunk": "@@ -347,7 +347,7 @@ public boolean getDeploymentConfigStatus(String deploymentConfigName) {\n     }\n \n     public Secret createSecret(Secret secret) {\n-        return client.secrets().inNamespace(getNamespace()).create(secret);\n+        return client.secrets().inNamespace(getNamespace()).createOrReplace(secret);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b682a9c13b1c69b2e31862a0bd1aa8403e8a77a8"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 590, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}