{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MDg4Mzg4", "number": 3722, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMToxMTo1OVrOEo-1Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMjoxMTozMlrOEpOPfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNDA3ODgzOnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMToxMTo1OVrOHaYk4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMTo0MDowN1rOHaZcpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQyNzY4Mg==", "bodyText": "I think I getting your point here. You are using the kafkaReplicas parameter that is dependent on the zookeeperReplicas. Wouldn't be better using some Math.min(kafkaReplicas / 3, 3) meaning if we specify 3 Kafka replicas we will deploy 1 zookeeper instead of 3, which are not needed? WDYT?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3722#discussion_r497427682", "createdAt": "2020-09-30T11:11:59Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "diffHunk": "@@ -55,7 +55,7 @@ public static DoneableKafka kafkaEphemeral(String name, int kafkaReplicas, int z\n     }\n \n     public static DoneableKafka kafkaPersistent(String name, int kafkaReplicas) {\n-        return kafkaPersistent(name, kafkaReplicas, 3);\n+        return kafkaPersistent(name, kafkaReplicas, Math.min(kafkaReplicas, 3));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3f85e2ea58a118cef4f9dead4357f065b122253"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0MTk1OQ==", "bodyText": "Well in that case we will need at least 9 brokers to have 3 zk. It doesn't sound me like a good idea. You always can specify zk replicas by third param.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3722#discussion_r497441959", "createdAt": "2020-09-30T11:40:07Z", "author": {"login": "Frawless"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "diffHunk": "@@ -55,7 +55,7 @@ public static DoneableKafka kafkaEphemeral(String name, int kafkaReplicas, int z\n     }\n \n     public static DoneableKafka kafkaPersistent(String name, int kafkaReplicas) {\n-        return kafkaPersistent(name, kafkaReplicas, 3);\n+        return kafkaPersistent(name, kafkaReplicas, Math.min(kafkaReplicas, 3));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQyNzY4Mg=="}, "originalCommit": {"oid": "d3f85e2ea58a118cef4f9dead4357f065b122253"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjYwNDEyOnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMjoxMTozMlrOHaxIOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNTo0NjozNVrOHa7SOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgyOTk0Ng==", "bodyText": "Why are we using the min(...) here and on line 58? I think it deserves some explanation.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3722#discussion_r497829946", "createdAt": "2020-09-30T22:11:32Z", "author": {"login": "scholzj"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "diffHunk": "@@ -46,7 +46,7 @@\n     }\n \n     public static DoneableKafka kafkaEphemeral(String name, int kafkaReplicas) {\n-        return kafkaEphemeral(name, kafkaReplicas, 3);\n+        return kafkaEphemeral(name, kafkaReplicas, Math.min(kafkaReplicas, 3));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3f85e2ea58a118cef4f9dead4357f065b122253"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk5NjM0Ng==", "bodyText": "AFAIK, It is because sometimes, we deploy Kafka cluster with only 1 Kafka broker and if we don't specify zookeeper replicas it will create the cluster with 1 Kafka and 3 zookeepers. So, for instance. with this change we will deploy only 1 Kafka and 1 zookeeper.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3722#discussion_r497996346", "createdAt": "2020-10-01T05:46:35Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaResource.java", "diffHunk": "@@ -46,7 +46,7 @@\n     }\n \n     public static DoneableKafka kafkaEphemeral(String name, int kafkaReplicas) {\n-        return kafkaEphemeral(name, kafkaReplicas, 3);\n+        return kafkaEphemeral(name, kafkaReplicas, Math.min(kafkaReplicas, 3));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgyOTk0Ng=="}, "originalCommit": {"oid": "d3f85e2ea58a118cef4f9dead4357f065b122253"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1163, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}