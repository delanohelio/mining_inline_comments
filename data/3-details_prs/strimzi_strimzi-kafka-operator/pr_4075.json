{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MTUxNzIz", "number": 4075, "title": "CO should be more verbose when resource name is missing", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nEnhancement\n\nDescription\nWhen the resource name in the CR is not specified, operation().inNamespace(namespace).withName(name) returns an exception Name must be provided.(coming from the fabric8). In the large CR it can be tricky to find, what name is missing. This PR adds information, what resource does have an empty name specified.\nOutput after these changes:\njava.lang.IllegalArgumentException: Secret with an empty name cannot be configured. Please provide a name.\n\nFixes #4022\nChecklist\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-12-09T12:41:10Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075", "merged": true, "mergeCommit": {"oid": "d4cec8a381d6a37df6982050864cca6f060d92de"}, "closed": true, "closedAt": "2020-12-14T11:09:43Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkeACTAH2gAyNTM1MTUxNzIzOjlhMDlhNzgxZTI0YzJkYWJjNjFjYzU5MDAzMzJkNjlmMGJjYzdkZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmC2XcgH2gAyNTM1MTUxNzIzOjY3M2I2NTk3ZDI3ZjYwOTg1YjYyNzc2YjA0MTY2NjZhOGZiODNhYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a09a781e24c2dabc61cc5900332d69f0bcc7ddc", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9a09a781e24c2dabc61cc5900332d69f0bcc7ddc", "committedDate": "2020-12-09T12:35:42Z", "message": "CO should be more verbose when resource name is missing\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MTc4ODM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#pullrequestreview-548178835", "createdAt": "2020-12-09T13:26:15Z", "commit": {"oid": "9a09a781e24c2dabc61cc5900332d69f0bcc7ddc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzoyNjoxNVrOICUfHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzoyNjoxNVrOICUfHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMwMzcwOA==", "bodyText": "What about in the synchronous get above? And in the AbstractNonNamespacedResourceOperator?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r539303708", "createdAt": "2020-12-09T13:26:15Z", "author": {"login": "tombentley"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/operator/resource/AbstractResourceOperator.java", "diffHunk": "@@ -240,6 +240,9 @@ public T get(String namespace, String name) {\n      * @return A Future for the result.\n      */\n     public Future<T> getAsync(String namespace, String name) {\n+        if (name == null || name.isEmpty()) {\n+            throw new IllegalArgumentException(resourceKind + \" with an empty name cannot be configured. Please provide a name.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a09a781e24c2dabc61cc5900332d69f0bcc7ddc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f02bc28a08f87d70943c3ad43ad0a67a9068f3dc", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f02bc28a08f87d70943c3ad43ad0a67a9068f3dc", "committedDate": "2020-12-09T13:32:11Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjI1MDM3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#pullrequestreview-548225037", "createdAt": "2020-12-09T14:15:57Z", "commit": {"oid": "f02bc28a08f87d70943c3ad43ad0a67a9068f3dc"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3872c7143ef2ad96274dcf53d87dc5ba93785495", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3872c7143ef2ad96274dcf53d87dc5ba93785495", "committedDate": "2020-12-10T11:30:50Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42e2a1abedbfa132588a15ea479e2087e505ff6a", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/42e2a1abedbfa132588a15ea479e2087e505ff6a", "committedDate": "2020-12-10T12:22:10Z", "message": "priority\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MjYwMjY3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#pullrequestreview-549260267", "createdAt": "2020-12-10T14:38:52Z", "commit": {"oid": "42e2a1abedbfa132588a15ea479e2087e505ff6a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNDozODo1M1rOIDMbRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNDozODo1M1rOIDMbRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIyMDIzMQ==", "bodyText": "Looks good. just one quick idea ... it might read better if you move it into separate method like the other validation. Plus ... would it make sense to validate the other fields as well if we already access the object?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r540220231", "createdAt": "2020-12-10T14:38:53Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ListenersValidator.java", "diffHunk": "@@ -92,6 +92,12 @@ public static void validate(int replicas, List<GenericKafkaListener> listeners)\n                         validateBrokerDnsAnnotations(errors, listener, broker);\n                     }\n                 }\n+\n+                if (listener.getConfiguration().getBrokerCertChainAndKey() != null\n+                    && (listener.getConfiguration().getBrokerCertChainAndKey().getSecretName() == null\n+                    || listener.getConfiguration().getBrokerCertChainAndKey().getSecretName().isEmpty())) {\n+                    errors.add(\"listener '\" + listener.getName() + \"' cannot have empty secret name in the brokerCertChainAndKey\");\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42e2a1abedbfa132588a15ea479e2087e505ff6a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76d4dc93ab2fc17405897afa521fcb3747f9c324", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/76d4dc93ab2fc17405897afa521fcb3747f9c324", "committedDate": "2020-12-10T14:49:13Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5Mjk5NjQ5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#pullrequestreview-549299649", "createdAt": "2020-12-10T15:15:16Z", "commit": {"oid": "76d4dc93ab2fc17405897afa521fcb3747f9c324"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/22f2e15e9fad85c947ed89df5bc60f132af44cc9", "committedDate": "2020-12-10T17:44:04Z", "message": "test\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTQxMzMx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#pullrequestreview-551141331", "createdAt": "2020-12-14T08:35:29Z", "commit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODozNToyOVrOIFFNKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODozNzowN1rOIFFQ9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTA4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        errors.add(\"listener '\" + listener.getName() + \"' cannot have empty secret name in the brokerCertChainAndKey\");\n          \n          \n            \n                        errors.add(\"listener '\" + listener.getName() + \"' cannot have an empty secret name in the brokerCertChainAndKey\");", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r542199081", "createdAt": "2020-12-14T08:35:29Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ListenersValidator.java", "diffHunk": "@@ -101,6 +105,29 @@ public static void validate(int replicas, List<GenericKafkaListener> listeners)\n \n         return errors;\n     }\n+    /**\n+     * Validates that the listener has a BrokerCertChainAndKey with non-empty values\n+     *\n+     * @param errors    List where any found errors will be added\n+     * @param listener  Listener which needs to be validated\n+     */\n+    private static void validateBrokerCertChainAndKey(Set<String> errors, GenericKafkaListener listener) {\n+        if (listener.getConfiguration().getBrokerCertChainAndKey().getSecretName() == null\n+                || listener.getConfiguration().getBrokerCertChainAndKey().getSecretName().isEmpty()) {\n+            errors.add(\"listener '\" + listener.getName() + \"' cannot have empty secret name in the brokerCertChainAndKey\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTE5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        errors.add(\"listener '\" + listener.getName() + \"' cannot have empty key in the brokerCertChainAndKey\");\n          \n          \n            \n                        errors.add(\"listener '\" + listener.getName() + \"' cannot have an empty key in the brokerCertChainAndKey\");", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r542199197", "createdAt": "2020-12-14T08:35:42Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ListenersValidator.java", "diffHunk": "@@ -101,6 +105,29 @@ public static void validate(int replicas, List<GenericKafkaListener> listeners)\n \n         return errors;\n     }\n+    /**\n+     * Validates that the listener has a BrokerCertChainAndKey with non-empty values\n+     *\n+     * @param errors    List where any found errors will be added\n+     * @param listener  Listener which needs to be validated\n+     */\n+    private static void validateBrokerCertChainAndKey(Set<String> errors, GenericKafkaListener listener) {\n+        if (listener.getConfiguration().getBrokerCertChainAndKey().getSecretName() == null\n+                || listener.getConfiguration().getBrokerCertChainAndKey().getSecretName().isEmpty()) {\n+            errors.add(\"listener '\" + listener.getName() + \"' cannot have empty secret name in the brokerCertChainAndKey\");\n+        }\n+\n+        if (listener.getConfiguration().getBrokerCertChainAndKey().getKey() == null\n+                || listener.getConfiguration().getBrokerCertChainAndKey().getKey().isEmpty()) {\n+            errors.add(\"listener '\" + listener.getName() + \"' cannot have empty key in the brokerCertChainAndKey\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTI5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        errors.add(\"listener '\" + listener.getName() + \"' cannot have empty certificate in the brokerCertChainAndKey\");\n          \n          \n            \n                        errors.add(\"listener '\" + listener.getName() + \"' cannot have an empty certificate in the brokerCertChainAndKey\");", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r542199294", "createdAt": "2020-12-14T08:35:54Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ListenersValidator.java", "diffHunk": "@@ -101,6 +105,29 @@ public static void validate(int replicas, List<GenericKafkaListener> listeners)\n \n         return errors;\n     }\n+    /**\n+     * Validates that the listener has a BrokerCertChainAndKey with non-empty values\n+     *\n+     * @param errors    List where any found errors will be added\n+     * @param listener  Listener which needs to be validated\n+     */\n+    private static void validateBrokerCertChainAndKey(Set<String> errors, GenericKafkaListener listener) {\n+        if (listener.getConfiguration().getBrokerCertChainAndKey().getSecretName() == null\n+                || listener.getConfiguration().getBrokerCertChainAndKey().getSecretName().isEmpty()) {\n+            errors.add(\"listener '\" + listener.getName() + \"' cannot have empty secret name in the brokerCertChainAndKey\");\n+        }\n+\n+        if (listener.getConfiguration().getBrokerCertChainAndKey().getKey() == null\n+                || listener.getConfiguration().getBrokerCertChainAndKey().getKey().isEmpty()) {\n+            errors.add(\"listener '\" + listener.getName() + \"' cannot have empty key in the brokerCertChainAndKey\");\n+        }\n+\n+        if (listener.getConfiguration().getBrokerCertChainAndKey().getCertificate() == null\n+                || listener.getConfiguration().getBrokerCertChainAndKey().getCertificate().isEmpty()) {\n+            errors.add(\"listener '\" + listener.getName() + \"' cannot have empty certificate in the brokerCertChainAndKey\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTgzMQ==", "bodyText": "We should include the namespace in the message.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r542199831", "createdAt": "2020-12-14T08:36:46Z", "author": {"login": "tombentley"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/operator/resource/AbstractResourceOperator.java", "diffHunk": "@@ -230,6 +230,9 @@ protected boolean wasChanged(T oldVersion, T newVersion) {\n      * @return The resource, or null if it doesn't exist.\n      */\n     public T get(String namespace, String name) {\n+        if (name == null || name.isEmpty()) {\n+            throw new IllegalArgumentException(resourceKind + \" with an empty name cannot be configured. Please provide a name.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIwMDA1Mw==", "bodyText": "Again, can we include the namespace in the message?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#discussion_r542200053", "createdAt": "2020-12-14T08:37:07Z", "author": {"login": "tombentley"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/operator/resource/AbstractResourceOperator.java", "diffHunk": "@@ -240,6 +243,9 @@ public T get(String namespace, String name) {\n      * @return A Future for the result.\n      */\n     public Future<T> getAsync(String namespace, String name) {\n+        if (name == null || name.isEmpty()) {\n+            throw new IllegalArgumentException(resourceKind + \" with an empty name cannot be configured. Please provide a name.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTQ4MDM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4075#pullrequestreview-551148035", "createdAt": "2020-12-14T08:44:15Z", "commit": {"oid": "22f2e15e9fad85c947ed89df5bc60f132af44cc9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "673b6597d27f60985b62776b0416666a8fb83aa8", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/673b6597d27f60985b62776b0416666a8fb83aa8", "committedDate": "2020-12-14T10:05:33Z", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 721, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}