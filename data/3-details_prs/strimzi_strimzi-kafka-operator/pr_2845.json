{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0NTQxMzA4", "number": 2845, "title": "[systemtest] Add process method and update OpenShift template tests", "bodyText": "Type of change\n\nBugfix\n\nDescription\nIn this PR I'm gonna introduce new method to cmdKubeClient() for oc process .. to get yaml of template and then apply it.\nThis way I fixed our failing test testDeployKafkaClusterViaTemplate in KafkaST and updated our tests in OpenShiftTemplateST to prevent future failures.\nChecklist\n\n Write tests\n Make sure all tests pass", "createdAt": "2020-04-16T17:10:16Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845", "merged": true, "mergeCommit": {"oid": "02a3467518e587ee40ba797c2ed6e849df4fc213"}, "closed": true, "closedAt": "2020-04-17T13:36:11Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYPxkbgH2gAyNDA0NTQxMzA4OjliNTg2ZWI4MGQyZmJkN2M0N2UzNzFmNGUxY2JiOTA5ZWY3NWNmYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYe-EqgFqTM5NTM1MDc1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9b586eb80d2fbd7c47e371f4e1cbb909ef75cfaa", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9b586eb80d2fbd7c47e371f4e1cbb909ef75cfaa", "committedDate": "2020-04-16T17:02:59Z", "message": "add new method for process and apply yaml\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7777940a8c63d9a3e55e0f26c25e4364f4f7b555", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7777940a8c63d9a3e55e0f26c25e4364f4f7b555", "committedDate": "2020-04-16T17:03:29Z", "message": "update tests with templates\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0ODM2ODQ3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845#pullrequestreview-394836847", "createdAt": "2020-04-16T17:11:46Z", "commit": {"oid": "7777940a8c63d9a3e55e0f26c25e4364f4f7b555"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzoxMTo0NlrOGGvKZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzoxMzo0OFrOGGvO6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxNzM0OA==", "bodyText": "I think we can remove this cast", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845#discussion_r409717348", "createdAt": "2020-04-16T17:11:46Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -124,10 +124,11 @@\n     @OpenShiftOnly\n     void testDeployKafkaClusterViaTemplate() {\n         cluster.createCustomResources(\"../examples/templates/cluster-operator\");\n-        String appName = \"strimzi-ephemeral\";\n+        String templateName = \"strimzi-ephemeral\";\n         Oc oc = (Oc) cmdKubeClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7777940a8c63d9a3e55e0f26c25e4364f4f7b555"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxODUwNQ==", "bodyText": "why we cannot apply (instead of create) the created yaml content?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845#discussion_r409718505", "createdAt": "2020-04-16T17:13:48Z", "author": {"login": "Frawless"}, "path": "test/src/main/java/io/strimzi/test/k8s/cmdClient/BaseCmdKubeClient.java", "diffHunk": "@@ -342,6 +351,18 @@ public String getResourceAsYaml(String resourceType, String resourceName) {\n         return Exec.exec(namespacedCommand(\"get\", resourceType, resourceName, \"-o\", \"yaml\")).out();\n     }\n \n+    @Override\n+    public void createResourceAndApply(String template, Map<String, String> params) {\n+        List<String> cmd = namespacedCommand(\"process\", template, \"-l\", \"app=\" + template, \"-o\", \"yaml\");\n+        for (Map.Entry<String, String> entry : params.entrySet()) {\n+            cmd.add(\"-p\");\n+            cmd.add(entry.getKey() + \"=\" + entry.getValue());\n+        }\n+\n+        String yaml = Exec.exec(cmd).out();\n+        createContent(yaml);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7777940a8c63d9a3e55e0f26c25e4364f4f7b555"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e756f4be9f8753c2a66816bb3894c962686dd0b", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6e756f4be9f8753c2a66816bb3894c962686dd0b", "committedDate": "2020-04-16T18:04:04Z", "message": "fixup! update tests with templates\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f1891c71a39a07b01bfcab29d8de2b4ea6771e7", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6f1891c71a39a07b01bfcab29d8de2b4ea6771e7", "committedDate": "2020-04-16T18:14:58Z", "message": "fixup! fixup! update tests with templates\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDMyMDAy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845#pullrequestreview-395032002", "createdAt": "2020-04-16T22:05:07Z", "commit": {"oid": "6f1891c71a39a07b01bfcab29d8de2b4ea6771e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MTgxNTAx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845#pullrequestreview-395181501", "createdAt": "2020-04-17T06:04:17Z", "commit": {"oid": "6f1891c71a39a07b01bfcab29d8de2b4ea6771e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzUwNzUx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2845#pullrequestreview-395350751", "createdAt": "2020-04-17T10:45:13Z", "commit": {"oid": "6f1891c71a39a07b01bfcab29d8de2b4ea6771e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1879, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}