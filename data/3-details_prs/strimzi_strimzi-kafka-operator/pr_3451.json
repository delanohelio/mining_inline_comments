{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDMyMjQ2", "number": 3451, "title": "[systemtest][refactor] \"Generator\" for random consumer group names and cleanup", "bodyText": "Signed-off-by: Lukas Kral lukywill16@gmail.com\nType of change\n\nRefactoring\n\nDescription\nThis PR gonna add \"generator\" of random consumer group names to ClientUtils and refactoring the all classes. Main idea of doing this is, that I didn't wanted to have all these consumer names hard-coded in tests/utils. This is more clear and readable solution FMPOV.\nOther than this I also changed all lines with hard-coded topic generation to use our KafkaTopicUtils.generateRandomTopicName() method - we forgot to change it on some places.\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-08-04T22:06:10Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451", "merged": true, "mergeCommit": {"oid": "efe66ea4f371b6b87d6076819e5e031135ed410b"}, "closed": true, "closedAt": "2020-08-06T15:19:30Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7uFirAFqTQ2MTIwODM3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8RRIPAFqTQ2MjYxMjE3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjA4Mzc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#pullrequestreview-461208376", "createdAt": "2020-08-04T22:09:17Z", "commit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjowOToxN1rOG7zMxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjowOToxN1rOG7zMxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM1ODAyMw==", "bodyText": "Maybe add a comment explaining its format e.g. my-consumer-group-*-*", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#discussion_r465358023", "createdAt": "2020-08-04T22:09:17Z", "author": {"login": "samuel-hawker"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/ClientUtils.java", "diffHunk": "@@ -61,5 +63,11 @@ private static long timeoutForClientFinishJob(int messagesCount) {\n         // need to add at least 1-2minutes for finishing the job\n         return (long) messagesCount * 1000 + Duration.ofMinutes(2).toMillis();\n     }\n+\n+    public static String generateRandomConsumerGroup() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMzc5NTI0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#pullrequestreview-461379524", "createdAt": "2020-08-05T06:40:15Z", "commit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjo0MDoxNVrOG78OfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjo0NDozN1rOG78Vlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwNTkxNg==", "bodyText": "I had the same discussion with @see-quick about using two \"salts\" somehow. I don't think it's useful.\nThe Random class implements a PRNG (Pseudorandom number generator) so it means that when you use a nextXXX method, it's going to generate the next pseudorandom number in the \"sequence\", so every nextXXX in the same execution will return you a different number. There is no way it returns the same number as before.\nThe same sequence could be generated in two different runs of the tests if the \"seed\" used for initializing the pseudorandom sequence generation is the same. It doesn't happen with the default Random constructor because internally it uses system time as part of the seed, so it's different for every run so the generated sequence of random numbers is different every run.\nAnyway, I think that concatenating two random numbers is useless.\nAnother point is that you should define one Random instance in the class using it. Why creating a new instance every time generateRandomConsumerGroup is called? As I said, it provides you a sequence of random number so each call to nextXXX on the same Random instance cannot return an already generated random number.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#discussion_r465505916", "createdAt": "2020-08-05T06:40:15Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/ClientUtils.java", "diffHunk": "@@ -61,5 +63,11 @@ private static long timeoutForClientFinishJob(int messagesCount) {\n         // need to add at least 1-2minutes for finishing the job\n         return (long) messagesCount * 1000 + Duration.ofMinutes(2).toMillis();\n     }\n+\n+    public static String generateRandomConsumerGroup() {\n+        String salt = new Random().nextInt(Integer.MAX_VALUE) + \"-\" + new Random().nextInt(Integer.MAX_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwNzczNQ==", "bodyText": "ditto as above, I see you have a rng instance, please use it to generated random numbers and not new instances of Random.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#discussion_r465507735", "createdAt": "2020-08-05T06:44:37Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -87,19 +88,22 @@\n     protected static final String TLS_SIDECAR_KAFKA_IMAGE = \"STRIMZI_DEFAULT_TLS_SIDECAR_KAFKA_IMAGE\";\n     protected static final String TLS_SIDECAR_EO_IMAGE = \"STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE\";\n     protected static final String TEST_TOPIC_NAME = \"test-topic\";\n-    protected static final String CONSUMER_GROUP_NAME = \"my-consumer-group\";\n \n     protected String testClass;\n     protected String testName;\n \n     protected Random rng = new Random();\n \n     public static final int MESSAGE_COUNT = 100;\n+\n     public static final String TOPIC_NAME = KafkaTopicUtils.generateRandomNameOfTopic();\n     public static final String EXAMPLE_TOPIC_NAME = \"my-topic\";\n-\n+    public static final String AVAILABILITY_TOPIC_SOURCE_NAME = \"availability-topic-source-\" + new Random().nextInt(Integer.MAX_VALUE);\n+    public static final String AVAILABILITY_TOPIC_TARGET_NAME = \"availability-topic-target-\" + new Random().nextInt(Integer.MAX_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNDk4MDU1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#pullrequestreview-461498055", "createdAt": "2020-08-05T09:34:07Z", "commit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f7e212fe2c139afe6e64278dabadbad219270cb", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5f7e212fe2c139afe6e64278dabadbad219270cb", "committedDate": "2020-08-05T11:11:21Z", "message": "add generator for consumer group names and refactor classes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91ab0c3d86c8f851738349fdfcfde532911e2082", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/91ab0c3d86c8f851738349fdfcfde532911e2082", "committedDate": "2020-08-05T12:04:27Z", "message": "comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e6fd17909134862a1b65ed387336ea33f6d0e16", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8e6fd17909134862a1b65ed387336ea33f6d0e16", "committedDate": "2020-08-04T22:01:40Z", "message": "add generator for consumer group names and refactor classes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "91ab0c3d86c8f851738349fdfcfde532911e2082", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/91ab0c3d86c8f851738349fdfcfde532911e2082", "committedDate": "2020-08-05T12:04:27Z", "message": "comments\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjA0NjIy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#pullrequestreview-461604622", "createdAt": "2020-08-05T12:13:15Z", "commit": {"oid": "91ab0c3d86c8f851738349fdfcfde532911e2082"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjA3MTYz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#pullrequestreview-461607163", "createdAt": "2020-08-05T12:16:58Z", "commit": {"oid": "91ab0c3d86c8f851738349fdfcfde532911e2082"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMjoxNjo1OFrOG8HEzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMjoxNjo1OFrOG8HEzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY4MzY2MQ==", "bodyText": "Please update also AbstractKafkaClient. There we are using the same method. So remove it  from AbstractKafkaClient and use this one from ClientUtils :)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#discussion_r465683661", "createdAt": "2020-08-05T12:16:58Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/ClientUtils.java", "diffHunk": "@@ -61,5 +64,15 @@ private static long timeoutForClientFinishJob(int messagesCount) {\n         // need to add at least 1-2minutes for finishing the job\n         return (long) messagesCount * 1000 + Duration.ofMinutes(2).toMillis();\n     }\n+\n+    /**\n+     * Method which generates random consumer group name\n+     * @return consumer group name with pattern: my-consumer-group-*-*\n+     */\n+    public static String generateRandomConsumerGroup() {\n+        int salt = rng.nextInt(Integer.MAX_VALUE);\n+\n+        return CONSUMER_GROUP_NAME + salt;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91ab0c3d86c8f851738349fdfcfde532911e2082"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a709a988d9a17deed652127f1403f807022184f3", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a709a988d9a17deed652127f1403f807022184f3", "committedDate": "2020-08-05T13:18:40Z", "message": "comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjEyMTcz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3451#pullrequestreview-462612173", "createdAt": "2020-08-06T15:08:38Z", "commit": {"oid": "a709a988d9a17deed652127f1403f807022184f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1084, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}