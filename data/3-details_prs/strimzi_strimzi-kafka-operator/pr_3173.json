{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMjk1NDEy", "number": 3173, "title": "Upgraded CC to 2.0.108 ", "bodyText": "Type of change\n\nEnhancement\n\nDescription\nThis upgrades CC to 2.0.108 which pulls in a few upstream PR from the Strimzi team. These include fixes for errors on the user_tasks endpoint (which require changes to the CC client) and configurable metrics topic creation.\nChecklist\n\n Write tests\n Make sure all tests pass\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Update CHANGELOG.md", "createdAt": "2020-06-08T17:41:53Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173", "merged": true, "mergeCommit": {"oid": "9de161235816c7213859d3d95d7be45bdd6a677a"}, "closed": true, "closedAt": "2020-06-10T21:41:30Z", "author": {"login": "tomncooper"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpUHW_gBqjM0MjEyNzk3NTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp3Ac9gBqjM0Mjg5NTEyMDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75c16560a9143dda13e6f89dc6fce2b562b52c03", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/75c16560a9143dda13e6f89dc6fce2b562b52c03", "committedDate": "2020-06-08T15:42:43Z", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "29eba83febc84f3dbba924ac0ebd1e444fa780c4", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/29eba83febc84f3dbba924ac0ebd1e444fa780c4", "committedDate": "2020-06-08T17:42:57Z", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDgyOTI2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-426482926", "createdAt": "2020-06-08T17:57:50Z", "commit": {"oid": "29eba83febc84f3dbba924ac0ebd1e444fa780c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo1Nzo1MFrOGgpveg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo1Nzo1MFrOGgpveg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MTUxNA==", "bodyText": "I'm not sure this is worth mentioning. If something, I would probably rather mention what makes this upgrade interesting for users.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r436891514", "createdAt": "2020-06-08T17:57:50Z", "author": {"login": "scholzj"}, "path": "CHANGELOG.md", "diffHunk": "@@ -5,6 +5,7 @@\n \n * Remove deprecated `Kafka.spec.topicOperator` classes and deployment logic\n * Use Java 11 as the Java runtime\n+* Upgrade to Cruise Control version 2.0.108", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29eba83febc84f3dbba924ac0ebd1e444fa780c4"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29eba83febc84f3dbba924ac0ebd1e444fa780c4", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/29eba83febc84f3dbba924ac0ebd1e444fa780c4", "committedDate": "2020-06-08T17:42:57Z", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/01c08d0d31047b3ec3be89bce09b5c76515aed40", "committedDate": "2020-06-09T09:21:19Z", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f6d74e6885a428bb076258a06be1149a52b177f", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7f6d74e6885a428bb076258a06be1149a52b177f", "committedDate": "2020-06-09T09:29:52Z", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTczOTE1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-426973915", "createdAt": "2020-06-09T09:47:01Z", "commit": {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwOTo0NzowMVrOGhBpew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwOTo0OTozMVrOGhBvPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4MzE5NQ==", "bodyText": "typo \"the status\"", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437283195", "createdAt": "2020-06-09T09:47:01Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlApiImpl.java", "diffHunk": "@@ -204,36 +204,36 @@ public CruiseControlApiImpl(Vertx vertx, int idleTimeout) {\n                             JsonObject statusJson = new JsonObject();\n                             String taskStatus = jsonUserTask.getString(\"Status\");\n                             statusJson.put(\"Status\", taskStatus);\n-                            // The status could be ACTIVE in which case there will not be a \"summary\" so we check that we are\n-                            // in a state that actually has that key.\n-                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) ||\n-                                    taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n-                                // We now need to extract the original response which is in a raw string (not nicely formatted JSON)\n+\n+                            CruiseControlUserTaskResponse ccResponse;\n+                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) || taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n+                                // Tasks in execution will be rebalance tasks, so their original response will contain the summary of the rebalance they are executing\n+                                // Completed tasks likewise will have the original rebalance summary in their original response\n                                 statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                                ccResponse = new CruiseControlUserTaskResponse(userTaskID, statusJson);\n+                            } else if (taskStatus.equals(CruiseControlUserTaskStatus.ACTIVE.toString())) {\n+                                // If he status is ACTIVE there will not be a \"summary\" so we skip pulling the summary key", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4NDY2OQ==", "bodyText": "I would not remove everything. The summary and description about what topics are in place are useful I think. I would remove the parts where creating the metrics topic is mentioned.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437284669", "createdAt": "2020-06-09T09:49:31Z", "author": {"login": "ppatierno"}, "path": "documentation/modules/cruise-control/ref-cruise-control-configuration.adoc", "diffHunk": "@@ -97,49 +97,6 @@ spec:\n .Additional resources\n For more information, refer to the xref:type-BrokerCapacity-reference[].\n \n-[#auto-created-topics-logs]\n-[discrete]\n-== Auto-created topics and log compaction\n-\n-Cruise Control requires the following three topics in order to work:\n-\n-* `strimzi.cruisecontrol.partitionmetricsamples`\n-* `strimzi.cruisecontrol.modeltrainingsamples`\n-* `strimzi.cruisecontrol.metrics`\n-\n-These three topics are usually auto-created by Strimzi and Cruise Control. First, the metric reporters create the `strimzi.cruisecontrol.metrics` topic. \n-Then, Cruise Control creates the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics.\n-\n-However, if automatic topic creation is _disabled_ in Kafka (`auto.create.topics.enable: false` is configured in `spec.kafka.config` when starting a new Kafka cluster) the Cruise Control metric reporters are unable to create the `strimzi.cruisecontrol.metrics` topic.\n-In this situation, you need to manually create the `strimzi.cruisecontrol.metrics` topic before deploying Cruise Control. \n-You can do this using the following command:\n-\n-[source,shell,subs=\"attributes+\"]\n-----\n-kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n-----\n-\n-Log compaction might remove records that are needed by Cruise Control; therefore, all auto-created topics must be configured with `cleanup.policy=delete` to disable log compaction. \n-Cruise Control will automatically disable log compaction for the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics.\n-The Cruise Control metric reporters attempt to disable log compaction for the `strimzi.cruisecontrol.metrics` topic, but fail if they are started with a new Kafka cluster.\n-This is only a problem if log compaction is enabled in Kafka with the setting `log.cleanup.policy=compact` in `spec.kafka.config`. \n-In this situation, log compaction will be enabled for the `strimzi.cruisecontrol.metrics` topic and will need to be overridden with `cleanup.policy=delete` in the `strimzi.cruisecontrol.metrics` topic.\n-\n-Here is an example where log compaction is disabled in a topic that was auto-created by Cruise Control:\n-\n-[source,yaml,subs=\"+quotes,attributes\"]\n-----\n-apiVersion: kafka.strimzi.io/v1beta1\n-kind: KafkaTopic\n-metadata:\n-  name: strimzi.cruisecontrol.metrics\n-spec:\n-  partitions: 1\n-  replicas: 1\n-  config:\n-    cleanup.policy: delete\n-----\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTQyOTU5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427142959", "createdAt": "2020-06-09T13:27:47Z", "commit": {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/01c08d0d31047b3ec3be89bce09b5c76515aed40", "committedDate": "2020-06-09T09:21:19Z", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "committedDate": "2020-06-09T13:41:52Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTk0ODE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427194818", "createdAt": "2020-06-09T14:13:56Z", "commit": {"oid": "3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDoxMzo1NlrOGhMLlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDoxMzo1NlrOGhMLlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTc2NA==", "bodyText": "How is it reflected in the resource status? The user will see the \"summary\" with the original proposal and the final state will be Ready but no evidence that it's completed with error?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437455764", "createdAt": "2020-06-09T14:13:56Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlApiImpl.java", "diffHunk": "@@ -202,38 +202,40 @@ public CruiseControlApiImpl(Vertx vertx, int idleTimeout) {\n                                                 json.getString(CC_REST_API_ERROR_KEY)));\n                             }\n                             JsonObject statusJson = new JsonObject();\n-                            String taskStatus = jsonUserTask.getString(\"Status\");\n-                            statusJson.put(\"Status\", taskStatus);\n-                            // The status could be ACTIVE in which case there will not be a \"summary\" so we check that we are\n-                            // in a state that actually has that key.\n-                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) ||\n-                                    taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n-                                // We now need to extract the original response which is in a raw string (not nicely formatted JSON)\n-                                statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                            String taskStatusStr = jsonUserTask.getString(\"Status\");\n+                            statusJson.put(\"Status\", taskStatusStr);\n+                            CruiseControlUserTaskStatus taskStatus = CruiseControlUserTaskStatus.lookup(taskStatusStr);\n+                            switch (taskStatus) {\n+                                case ACTIVE:\n+                                    // If the status is ACTIVE there will not be a \"summary\" so we skip pulling the summary key\n+                                    break;\n+                                case IN_EXECUTION:\n+                                    // Tasks in execution will be rebalance tasks, so their original response will contain the summary of the rebalance they are executing\n+                                    // We handle these in the same way as COMPLETED tasks so we drop down to that case.\n+                                case COMPLETED:\n+                                    // Completed tasks will have the original rebalance proposal summary in their original response\n+                                    statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                                    break;\n+                                case COMPLETED_WITH_ERROR:\n+                                    // Completed with error tasks will have \"CompletedWithError\" as their original response, which is not Json.\n+                                    statusJson.put(\"summary\", jsonUserTask.getString(\"originalResponse\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "committedDate": "2020-06-09T13:41:52Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8ebe79d88835979d975eb71b7488f371e0fa96ef", "committedDate": "2020-06-09T14:54:57Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjQxNjU3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427241657", "createdAt": "2020-06-09T14:57:51Z", "commit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo1Nzo1MVrOGhORxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo1Nzo1MVrOGhORxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDExOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Upgraded to Cruise Control version 2.0.108 - This removes the need to manually create metrics topics if topic auto creation is disabled.\n          \n          \n            \n            * Remove the need to manually create Cruise Control topics if topic auto creation is disabled.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437490119", "createdAt": "2020-06-09T14:57:51Z", "author": {"login": "scholzj"}, "path": "CHANGELOG.md", "diffHunk": "@@ -5,6 +5,7 @@\n \n * Remove deprecated `Kafka.spec.topicOperator` classes and deployment logic\n * Use Java 11 as the Java runtime\n+* Upgraded to Cruise Control version 2.0.108 - This removes the need to manually create metrics topics if topic auto creation is disabled.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjQ3NjYw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427247660", "createdAt": "2020-06-09T15:01:14Z", "commit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTowMToxNFrOGhOcJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTowMjowM1rOGhOedQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5Mjc3Mw==", "bodyText": "Following the new and less strict documentation rules ... maybe you can remove the proceudure structure (The prerequisites heading, the procedure heading etc.) which seem to have lot more noise than value.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437492773", "createdAt": "2020-06-09T15:01:14Z", "author": {"login": "scholzj"}, "path": "documentation/modules/cruise-control/proc-deploying-cruise-control.adoc", "diffHunk": "@@ -9,23 +9,13 @@ To deploy Cruise Control to your Strimzi cluster, define the configuration using\n \n Deploy one instance of Cruise Control per Kafka cluster.\n \n-NOTE: Step one is only required if automatic topic creation is disabled in the Kafka cluster.\n-\n .Prerequisites\n \n * A Kubernetes cluster\n * A running Cluster Operator\n-* You are aware of the guidance on xref:#auto-created-topics-logs[Auto-created topics and log compaction].\n \n .Procedure\n \n-. If automatic topic creation is disabled (`auto.create.topics.enable: false` is configured in `spec.kafka.config`), first create the `strimzi.cruisecontrol.metrics` topic:\n-+\n-[source,shell,subs=\"attributes+\"]\n-----\n-kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n-----\n-\n . Edit the `cruiseControl` property of the `Kafka` resource.\n +\n The properties you can configure are shown in this example configuration:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MzM2NQ==", "bodyText": "Should this say something like _Edit the Kafka resource and add cruideControl property?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437493365", "createdAt": "2020-06-09T15:02:03Z", "author": {"login": "scholzj"}, "path": "documentation/modules/cruise-control/proc-deploying-cruise-control.adoc", "diffHunk": "@@ -9,23 +9,13 @@ To deploy Cruise Control to your Strimzi cluster, define the configuration using\n \n Deploy one instance of Cruise Control per Kafka cluster.\n \n-NOTE: Step one is only required if automatic topic creation is disabled in the Kafka cluster.\n-\n .Prerequisites\n \n * A Kubernetes cluster\n * A running Cluster Operator\n-* You are aware of the guidance on xref:#auto-created-topics-logs[Auto-created topics and log compaction].\n \n .Procedure\n \n-. If automatic topic creation is disabled (`auto.create.topics.enable: false` is configured in `spec.kafka.config`), first create the `strimzi.cruisecontrol.metrics` topic:\n-+\n-[source,shell,subs=\"attributes+\"]\n-----\n-kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n-----\n-\n . Edit the `cruiseControl` property of the `Kafka` resource.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8ebe79d88835979d975eb71b7488f371e0fa96ef", "committedDate": "2020-06-09T14:54:57Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "a611e63d213610b305718f0d0bf8d7540ac408a0", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a611e63d213610b305718f0d0bf8d7540ac408a0", "committedDate": "2020-06-09T15:14:23Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a611e63d213610b305718f0d0bf8d7540ac408a0", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a611e63d213610b305718f0d0bf8d7540ac408a0", "committedDate": "2020-06-09T15:14:23Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "committedDate": "2020-06-09T16:56:13Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzcwODQ5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427370849", "createdAt": "2020-06-09T17:08:33Z", "commit": {"oid": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzowODozM1rOGhUNuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzowODozM1rOGhUNuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4NzM4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Removed the need to manually create Cruise Control  metrics topics if topic auto creation is disabled.\n          \n          \n            \n            * Removed the need to manually create Cruise Control metrics topics if topic auto creation is disabled.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437587385", "createdAt": "2020-06-09T17:08:33Z", "author": {"login": "scholzj"}, "path": "CHANGELOG.md", "diffHunk": "@@ -5,6 +5,7 @@\n \n * Remove deprecated `Kafka.spec.topicOperator` classes and deployment logic\n * Use Java 11 as the Java runtime\n+* Removed the need to manually create Cruise Control  metrics topics if topic auto creation is disabled.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzgyMjg5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427382289", "createdAt": "2020-06-09T17:23:18Z", "commit": {"oid": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "committedDate": "2020-06-09T16:56:13Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/727259319118d3aacbc24917dd1ec8b33d27e602", "committedDate": "2020-06-09T17:25:36Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODIzOTA1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427823905", "createdAt": "2020-06-10T08:23:39Z", "commit": {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwODoyMzo0MFrOGhqQMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwODoyNzo1NVrOGhqanw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0ODQ2Ng==", "bodyText": "We use this Status string a few times, maybe worth making it a constant somewhere?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437948466", "createdAt": "2020-06-10T08:23:40Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlApiImpl.java", "diffHunk": "@@ -202,38 +202,40 @@ public CruiseControlApiImpl(Vertx vertx, int idleTimeout) {\n                                                 json.getString(CC_REST_API_ERROR_KEY)));\n                             }\n                             JsonObject statusJson = new JsonObject();\n-                            String taskStatus = jsonUserTask.getString(\"Status\");\n-                            statusJson.put(\"Status\", taskStatus);\n-                            // The status could be ACTIVE in which case there will not be a \"summary\" so we check that we are\n-                            // in a state that actually has that key.\n-                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) ||\n-                                    taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n-                                // We now need to extract the original response which is in a raw string (not nicely formatted JSON)\n-                                statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                            String taskStatusStr = jsonUserTask.getString(\"Status\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk1MTEzNQ==", "bodyText": "Missing a context.succeeding", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437951135", "createdAt": "2020-06-10T08:27:55Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaRebalanceStateMachineTest.java", "diffHunk": "@@ -190,8 +192,8 @@ public String cruiseControlHost(String clusterName, String clusterNamespace) {\n         when(mockRebalanceOps.get(CLUSTER_NAMESPACE, RESOURCE_NAME)).thenReturn(kcRebalance);\n         when(mockRebalanceOps.getAsync(CLUSTER_NAMESPACE, RESOURCE_NAME)).thenReturn(Future.succeededFuture(kcRebalance));\n \n-        return kcrao.computeNextStatus(\n-                recon, HOST, client, kcRebalance, currentState, initialAnnotation, rbOptions).compose(result -> {\n+        return kcrao.computeNextStatus(recon, HOST, client, kcRebalance, currentState, initialAnnotation, rbOptions)\n+                .compose(result -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODI4Mzcx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#pullrequestreview-427828371", "createdAt": "2020-06-10T08:29:08Z", "commit": {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe9dd08c3146eaa811f52ac97785b1d71812b325", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fe9dd08c3146eaa811f52ac97785b1d71812b325", "committedDate": "2020-06-10T10:22:04Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/727259319118d3aacbc24917dd1ec8b33d27e602", "committedDate": "2020-06-09T17:25:36Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "fe9dd08c3146eaa811f52ac97785b1d71812b325", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fe9dd08c3146eaa811f52ac97785b1d71812b325", "committedDate": "2020-06-10T10:22:04Z", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1504, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}