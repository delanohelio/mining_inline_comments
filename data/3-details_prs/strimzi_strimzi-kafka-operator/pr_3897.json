{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNjg2MjI5", "number": 3897, "title": "Only extra strimzi relevant pod labels", "bodyText": "Many environments have labels on pods with potentially high cardinality that you don't want in your prometheus environment. This changes the podmonitor to only include the strimzi.io labels.\nType of change\n\nBugfix\n\nDescription\nThe existing podmonitor in the repo pulls all the labels from a pod into prometheus. This was a problem in my cluster as I have a lot of pod labels with relatively high cardinality. So I changed the pod monitor to only pull in the strimzi_(.+) labels. This is working in my cluster with the stock dashboards.", "createdAt": "2020-10-30T00:42:05Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897", "merged": true, "mergeCommit": {"oid": "b378cc6653446d91f8d5759a9f7640dbda141f89"}, "closed": true, "closedAt": "2020-11-09T17:13:50Z", "author": {"login": "brokenjacobs"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXi0J9AFqTUyMDQ3MTg3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABda3bbMAFqTUyNjQzNTg3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDcxODc3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#pullrequestreview-520471877", "createdAt": "2020-10-30T08:51:10Z", "commit": {"oid": "8045546b5a4f5937968ec958070e13685c67b152"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwODo1MToxMFrOHrF_Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwODo1MToxMFrOHrF_Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk0ODg5NQ==", "bodyText": "I'm not sure if this change was intended or not - but all the other example files use myproject. So I think we should try to keep it.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r514948895", "createdAt": "2020-10-30T08:51:10Z", "author": {"login": "scholzj"}, "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -10,7 +10,7 @@ spec:\n       strimzi.io/kind: cluster-operator\n   namespaceSelector:\n     matchNames:\n-      - myproject\n+      - my-project", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045546b5a4f5937968ec958070e13685c67b152"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDgzMjQy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#pullrequestreview-520483242", "createdAt": "2020-10-30T09:07:56Z", "commit": {"oid": "8045546b5a4f5937968ec958070e13685c67b152"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwOTowNzo1NlrOHrGgbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwOTowNzo1NlrOHrGgbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk1NzQyMg==", "bodyText": "why adding the strimzi_ prefix? the strimzi label matched by the regex should already have it. Doesn't it add the prefix twice? I haven't an installation with Prometheus handy, can you verify?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r514957422", "createdAt": "2020-10-30T09:07:56Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -63,14 +63,14 @@ spec:\n         values: [\"Kafka\", \"KafkaConnect\"]\n   namespaceSelector:\n     matchNames:\n-      - myproject\n+      - my-project\n   podMetricsEndpoints:\n   - path: /metrics\n     port: tcp-prometheus\n     relabelings:\n     - separator: ;\n-      regex: __meta_kubernetes_pod_label_(.+)\n-      replacement: $1\n+      regex: __meta_kubernetes_pod_label_strimzi_(.+)\n+      replacement: strimzi_$1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045546b5a4f5937968ec958070e13685c67b152"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8692568a90e4862677cd5c84d2500f4bdce3690e", "author": {"user": {"login": "brokenjacobs", "name": "Steve Jacobs"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8692568a90e4862677cd5c84d2500f4bdce3690e", "committedDate": "2020-11-02T18:35:04Z", "message": "Only extra strimzi relevant pod labels\n\nMany environments have labels on pods with potentially high cardinality that you don't want in your prometheus environment. This changes the podmonitor to only include the strimzi.io labels.\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1cda1e4532016ee2d824342baf8e8e12f5495da", "author": {"user": {"login": "brokenjacobs", "name": "Steve Jacobs"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e1cda1e4532016ee2d824342baf8e8e12f5495da", "committedDate": "2020-11-02T18:35:04Z", "message": "Put namespace settings back to the example settings\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831", "author": {"user": {"login": "brokenjacobs", "name": "Steve Jacobs"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/35d0d92e1ab81c6b27c71406dca06613b6198831", "committedDate": "2020-11-02T18:35:04Z", "message": "changed namespace to myproject. Updated regex to be clearer\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7eb20cc77f14a54516d1704cc61e3f3142f1b6fb", "author": {"user": {"login": "brokenjacobs", "name": "Steve Jacobs"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7eb20cc77f14a54516d1704cc61e3f3142f1b6fb", "committedDate": "2020-11-02T18:30:05Z", "message": "changed namespace to myproject. Updated regex to be clearer"}, "afterCommit": {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831", "author": {"user": {"login": "brokenjacobs", "name": "Steve Jacobs"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/35d0d92e1ab81c6b27c71406dca06613b6198831", "committedDate": "2020-11-02T18:35:04Z", "message": "changed namespace to myproject. Updated regex to be clearer\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTg3Njgw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#pullrequestreview-521987680", "createdAt": "2020-11-02T20:58:49Z", "commit": {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTkwMzM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#pullrequestreview-521990335", "createdAt": "2020-11-02T21:03:17Z", "commit": {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMTowMzoxN1rOHsVizw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMTowMzoxN1rOHsVizw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI1MjM2Nw==", "bodyText": "at this point I would match strimzi_io_.+", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r516252367", "createdAt": "2020-11-02T21:03:17Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -69,7 +69,7 @@ spec:\n     port: tcp-prometheus\n     relabelings:\n     - separator: ;\n-      regex: __meta_kubernetes_pod_label_(.+)\n+      regex: __meta_kubernetes_pod_label_(strimzi_.+)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9ee365a64d615af68c2aba600ac8ab7a4f64027", "author": {"user": {"login": "stevejbat", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d9ee365a64d615af68c2aba600ac8ab7a4f64027", "committedDate": "2020-11-09T16:27:48Z", "message": "Changed strimzi regex to match strimzi_io_+\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddb39d345768165b59103b04c0cadf2a33ac4b64", "author": {"user": {"login": "stevejbat", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ddb39d345768165b59103b04c0cadf2a33ac4b64", "committedDate": "2020-11-09T16:27:20Z", "message": "Changed strimzi regex to match strimzi_io_+"}, "afterCommit": {"oid": "d9ee365a64d615af68c2aba600ac8ab7a4f64027", "author": {"user": {"login": "stevejbat", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d9ee365a64d615af68c2aba600ac8ab7a4f64027", "committedDate": "2020-11-09T16:27:48Z", "message": "Changed strimzi regex to match strimzi_io_+\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NDM1ODcz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#pullrequestreview-526435873", "createdAt": "2020-11-09T16:34:00Z", "commit": {"oid": "d9ee365a64d615af68c2aba600ac8ab7a4f64027"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 864, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}