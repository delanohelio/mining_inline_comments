{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODQ1MjQz", "number": 2355, "title": "Use an actual node address in KafkaStatus for NodePorts", "bodyText": "Type of change\n\nEnhancement / new feature\n\nDescription\nWhen node ports are being used to expose the Kafka cluster, we currently dom't list a proper address for the cluster's external listener in the Kafka status. We just list a placeholder. This PR fixes this issue and lists addresses of the nodes hosting the broker in the status instead of the placeholder. That should allow users to use the address form the status to connect to the broker.\nIt is a bit questionable which nodes should be listed in the Status for node ports. In theory the node ports could work with all nodes. But should it be all nodes? All nodes without master? Only some nodes based on selector? For the time being, I decided to implement this based on the nodes where the Kafka pods were scheduled. That will guarantee the most efficient way for the communication (less forwarding between nodes) since these nodes have a Kafka pod locally. It also means we do not need to bother with detecting the masters etc. right now. If we receive feedback to include also other nodes int he future, we can extend it to include also other addresses.\nChecklist\n\n Write tests\n Make sure all tests pass\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally", "createdAt": "2020-01-03T01:16:45Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2355", "merged": true, "mergeCommit": {"oid": "df3259e8fcb0e19b6025592770e062f710043783"}, "closed": true, "closedAt": "2020-01-08T10:55:44Z", "author": {"login": "scholzj"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4JrB5AH2gAyMzU4ODQ1MjQzOjU2ZjM2NWUzYTFmNTQ5MjVjNzNjMDUyZjQ0Mjg2ZDk0MzY1YjgyZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4SCnPAH2gAyMzU4ODQ1MjQzOjliMTEyNjE3YmRmMmEzNDYwYWM3N2JlYWQ1NDhiYTQ2ZmFlOWE4NWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56f365e3a1f54925c73c052f44286d94365b82de", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/56f365e3a1f54925c73c052f44286d94365b82de", "committedDate": "2020-01-07T23:50:50Z", "message": "Use an actual node address in KafkaStatus for NodePorts\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a6cf06b45c9828cfa0ee07b6d6c9ad5fc2762fe", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8a6cf06b45c9828cfa0ee07b6d6c9ad5fc2762fe", "committedDate": "2020-01-07T23:50:50Z", "message": "Fix unused import\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4af8e087e22975106e82442bb81071ea42fb49e", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f4af8e087e22975106e82442bb81071ea42fb49e", "committedDate": "2020-01-07T23:50:50Z", "message": "Fix NodeOperatorIT tests\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca6e53456bf9e2bd18a8f2e31d39a85f9096f4c4", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ca6e53456bf9e2bd18a8f2e31d39a85f9096f4c4", "committedDate": "2020-01-07T23:50:50Z", "message": "Fix imports\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb8b50801a52f9e7eda134f2570eed35403e0793", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/cb8b50801a52f9e7eda134f2570eed35403e0793", "committedDate": "2020-01-07T23:50:50Z", "message": "Update cluster role in CO\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3840878630d586a3917e37cfc108134ec1629d2", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c3840878630d586a3917e37cfc108134ec1629d2", "committedDate": "2020-01-07T23:53:30Z", "message": "Fix some rebase glitches\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7579b77e13301e9c86c90254e5e89ac3393f224", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e7579b77e13301e9c86c90254e5e89ac3393f224", "committedDate": "2020-01-03T10:40:37Z", "message": "Update cluster role in CO\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}, "afterCommit": {"oid": "c3840878630d586a3917e37cfc108134ec1629d2", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c3840878630d586a3917e37cfc108134ec1629d2", "committedDate": "2020-01-07T23:53:30Z", "message": "Fix some rebase glitches\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2b2df5a6c4e824bd80cffaf86caf2d539610f5", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ac2b2df5a6c4e824bd80cffaf86caf2d539610f5", "committedDate": "2020-01-08T00:43:19Z", "message": "Fix some more rebase gliches\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5Njk4Nzcw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2355#pullrequestreview-339698770", "createdAt": "2020-01-08T08:11:03Z", "commit": {"oid": "ac2b2df5a6c4e824bd80cffaf86caf2d539610f5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwODoxMTowM1rOFbPNkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwODoyODozNVrOFbPkBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEwNTEwNA==", "bodyText": "I guess it's \"...type if...\"", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2355#discussion_r364105104", "createdAt": "2020-01-08T08:11:03Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaCluster.java", "diffHunk": "@@ -2355,4 +2355,21 @@ public boolean isJmxAuthenticated() {\n     public void setJmxAuthenticated(boolean jmxAuthenticated) {\n         isJmxAuthenticated = jmxAuthenticated;\n     }\n+\n+    /**\n+     * Returns the preferred node address type is configured by the user. Returns null otherwise.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac2b2df5a6c4e824bd80cffaf86caf2d539610f5"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDExMDg1Mg==", "bodyText": "additional blank line", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2355#discussion_r364110852", "createdAt": "2020-01-08T08:28:35Z", "author": {"login": "ppatierno"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/operator/resource/NodeOperator.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.operator.common.operator.resource;\n+\n+import io.fabric8.kubernetes.api.model.DoneableNode;\n+import io.fabric8.kubernetes.api.model.Node;\n+import io.fabric8.kubernetes.api.model.NodeList;\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+import io.fabric8.kubernetes.client.dsl.NonNamespaceOperation;\n+import io.fabric8.kubernetes.client.dsl.Resource;\n+import io.vertx.core.Vertx;\n+\n+public class NodeOperator extends AbstractNonNamespacedResourceOperator<KubernetesClient,\n+        Node, NodeList, DoneableNode, Resource<Node, DoneableNode>> {\n+\n+    /**\n+     * Constructor.\n+     * @param vertx The Vertx instance.\n+     * @param client The Kubernetes client.\n+     * @param operationTimeoutMs The timeout in milliseconds.\n+     */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac2b2df5a6c4e824bd80cffaf86caf2d539610f5"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b112617bdf2a3460ac77bead548ba46fae9a85b", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9b112617bdf2a3460ac77bead548ba46fae9a85b", "committedDate": "2020-01-08T09:35:50Z", "message": "Review comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1764, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}