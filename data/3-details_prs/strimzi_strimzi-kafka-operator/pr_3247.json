{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTUyOTEx", "number": 3247, "title": "[DOC] Update of steps for renewing custom CA", "bodyText": "Signed-off-by: prmellor pmellor@redhat.com\nDocumentation\n\nUpdated Renewing your own CA certificates to include a missing step and make the steps clearer\nUpdated Installing your own CA certificates to be consistent\nMentioned possibility of using certificates in PKCS #12 format -- procedures currently describe install/renewal in PRM format\n\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Update/write design documentation in ./design\n Write tests\n Make sure all tests pass\n[x ] Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md", "createdAt": "2020-06-26T12:17:56Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3247", "merged": true, "mergeCommit": {"oid": "4d6a60fcd4d4e4b141a62296ac1a677a28f2217b"}, "closed": true, "closedAt": "2020-07-01T18:28:58Z", "author": {"login": "PaulRMellor"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvCOCeAH2gAyNDQwNTUyOTExOmMzMjVjZDQxNjdlODQ4ZDczMDg2NjBkYjM3ZjQ0NDk0N2JkMTFlZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvCcw2gFqTQzODI1NTE4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c325cd4167e848d7308660db37f444947bd11ed2", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c325cd4167e848d7308660db37f444947bd11ed2", "committedDate": "2020-06-26T12:15:40Z", "message": "[DOC] Update of steps for renewing custom CA\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjUxMjIx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3247#pullrequestreview-438251221", "createdAt": "2020-06-26T12:25:06Z", "commit": {"oid": "c325cd4167e848d7308660db37f444947bd11ed2"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyNTowNlrOGpe7jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyNTowNlrOGpe7jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1MTU2NQ==", "bodyText": "Missing underscore - _Z?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3247#discussion_r446151565", "createdAt": "2020-06-26T12:25:06Z", "author": {"login": "laidan6000"}, "path": "documentation/modules/security/proc-renewing-your-own-ca-certificates.adoc", "diffHunk": "@@ -5,80 +5,104 @@\n [id='renewing-your-own-ca-certificates-{context}']\n = Renewing your own CA certificates\n \n-This procedure describes how to renew CA certificates and private keys that you previously installed.\n-You will need to follow this procedure during the renewal period in order to replace CA certificates which will soon expire.\n+This procedure describes how to renew CA certificates and keys that you previously installed.\n+You need to follow this procedure during the renewal period in order to replace CA certificates which will soon expire.\n+\n+You can use this procedure to install your own cluster or client CA certificates.\n+\n+The procedure describes renewal of CA certificates in PEM format.\n+You can also use certificates in PKCS #12 format.\n \n .Prerequisites\n \n * The Cluster Operator is running.\n * A Kafka cluster in which you previously installed your own CA certificates and private keys.\n-* New cluster and clients X.509 certificates and keys in PEM format. These could be generated using `openssl` using a command such as:\n-+\n+* New cluster and clients X.509 certificates and keys in PEM format.\n+\n+These could be generated using `openssl` using a command such as:\n+\n [source,shell,subs=\"+quotes\"]\n-openssl req -x509 -new -days _<validity>_ --nodes -out ca.crt -keyout ca.key\n+openssl req -x509 -new -days _NUMBER-OF-DAYS-VALID_ --nodes -out ca.crt -keyout ca.key\n \n .Procedure\n \n-. Establish what CA certificates already exist in the `Secret`:\n-+\n-Use the following commands:\n+. Check the details of the current CA certificates in the `Secret`:\n +\n [source,shell,subs=\"+quotes\"]\n-kubectl describe secret _<ca-cert-secret>_\n+kubectl describe secret _CA-CERTIFICATE-SECRET_\n +\n+_CA-CERTIFICATE-SECRET_ is the name of the `Secret`, which is `_CLUSTER-NAME_-cluster-ca-cert` for the cluster CA certificate and `_CLUSTER-NAME_-clients-ca-cert` for the clients CA certificate.\n \n-. Prepare a directory containing the existing CA certificates in the secret.\n+. Create a directory to contain the existing CA certificates in the secret.\n +\n [source,shell,subs=\"+quotes\"]\n ----\n mkdir new-ca-cert-secret\n cd new-ca-cert-secret\n ----\n-For each certificate _<ca-certificate>_ from the previous step, run:\n+\n+. Fetch the secret for each CA certificate you wish to renew:\n +\n [source,shell,subs=\"+quotes\"]\n-----\n-# Fetch the existing secret\n-kubectl get secret _<ca-cert-secret>_ -o 'jsonpath={.data._<ca-certificate>_}' | base64 -d > _<ca-certificate>_\n-----\n+kubectl get secret _CA-CERTIFICATE-SECRET_ -o 'jsonpath={.data._CA-CERTIFICATE_}' | base64 -d > _CA-CERTIFICATE_\n++\n+Replace _CA-CERTIFICATE_ with the name of each CA certificate.\n \n-. Rename the old `ca.crt` file to `ca_<date>_.crt`, where _<date>_ is the certificate expiry date in the format _<year>_-_<month>_-_<day>_T_<hour>_-_<minute>_-_<second>_Z, for example `ca-2018-09-27T17-32-00Z.crt`. \n+. Rename the old `ca.crt` file as `ca-__DATE__.crt`,\n+where _DATE_ is the certificate expiry date in the format _YEAR-MONTH-DAYTHOUR-MINUTE-SECONDZ_.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c325cd4167e848d7308660db37f444947bd11ed2"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjUyMDg0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3247#pullrequestreview-438252084", "createdAt": "2020-06-26T12:26:32Z", "commit": {"oid": "c325cd4167e848d7308660db37f444947bd11ed2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjU1MTg5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3247#pullrequestreview-438255189", "createdAt": "2020-06-26T12:31:45Z", "commit": {"oid": "c325cd4167e848d7308660db37f444947bd11ed2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1234, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}