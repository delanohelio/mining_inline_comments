{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMjM2MjQ5", "number": 3804, "title": "Run ConnectS2I with tini", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nBugfix\n\nDescription\nThe ConnectS2I deployment is not run with tini as PID 1. It is caused by the composition of scripts. Connect S2I is run by /docker-images/kafka/s2i-scripts/run which runs /opt/kafka/kafka_connect_run.sh which runs tini. So first process in Connect is tini, but in ConnectS2I it is bash.\nAfter the change:\n[sknot@localhost productizedf8]$ oc exec -ti my-s2i-connect-cluster-connect-1-7wllq -- ps aux\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n1000150+     1  0.0  0.0   4360   360 ?        Ss   10:00   0:00 /usr/bin/tini -w -e \n1000150+    31 47.0  3.5 8166700 578940 ?      Sl   10:00   0:34 java -Xms128M -serve\n1000150+   511  0.0  0.0  51756  1656 ?        Rs+  10:01   0:00 ps aux\n\n\nOne question for @im-konge : Why is test testCheckContainersHaveProcessOneAsTini in LogSettingST class? It does not test any logging or?\nFixes #3282\nChecklist\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-10-14T09:25:40Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3804", "merged": true, "mergeCommit": {"oid": "7da8bd07366c9ed60afb7e5ebda8266f6e39fc76"}, "closed": true, "closedAt": "2020-10-14T15:31:33Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSZncfgH2gAyNTAzMjM2MjQ5OmUzODU0YTY4OGYzNjU2NGMyOWRjMWI2ODNjNDIwOWQxOWQxYTczZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSa-X-AFqTUwODIyNTQ5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3854a688f36564c29dc1b683c4209d19d1a73f8", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e3854a688f36564c29dc1b683c4209d19d1a73f8", "committedDate": "2020-10-14T09:18:35Z", "message": "Run ConnectS2I with tini\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTYzNDA2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3804#pullrequestreview-508163406", "createdAt": "2020-10-14T09:30:44Z", "commit": {"oid": "e3854a688f36564c29dc1b683c4209d19d1a73f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTc0NzQz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3804#pullrequestreview-508174743", "createdAt": "2020-10-14T09:44:38Z", "commit": {"oid": "e3854a688f36564c29dc1b683c4209d19d1a73f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTo0NDozOFrOHhK9TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTo0NDozOFrOHhK9TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU0NDU4OQ==", "bodyText": "Can't you source the script instead?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3804#discussion_r504544589", "createdAt": "2020-10-14T09:44:38Z", "author": {"login": "scholzj"}, "path": "docker-images/kafka/s2i-scripts/run", "diffHunk": "@@ -11,5 +11,6 @@ then\n fi\n \n export KAFKA_CONNECT_PLUGIN_PATH=/tmp/kafka-plugins\n+export KAFKA_CONNECT_S2I=true\n echo \"Starting Kafka Connect with custom plugin directory $KAFKA_CONNECT_PLUGIN_PATH\"\n-/opt/kafka/kafka_connect_run.sh\n\\ No newline at end of file\n+exec /usr/bin/tini -w -e 143 -- /opt/kafka/kafka_connect_run.sh", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3854a688f36564c29dc1b683c4209d19d1a73f8"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MjAyMjU4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3804#pullrequestreview-508202258", "createdAt": "2020-10-14T10:20:22Z", "commit": {"oid": "3130db7b181199eac6bfec4fa874a05e0d88c314"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ff27a54b00acfedb8f26f5b99c47cc88856b60", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b9ff27a54b00acfedb8f26f5b99c47cc88856b60", "committedDate": "2020-10-14T10:22:46Z", "message": "use source\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3130db7b181199eac6bfec4fa874a05e0d88c314", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3130db7b181199eac6bfec4fa874a05e0d88c314", "committedDate": "2020-10-14T10:03:02Z", "message": "use source\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}, "afterCommit": {"oid": "b9ff27a54b00acfedb8f26f5b99c47cc88856b60", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b9ff27a54b00acfedb8f26f5b99c47cc88856b60", "committedDate": "2020-10-14T10:22:46Z", "message": "use source\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MjI1NDk2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3804#pullrequestreview-508225496", "createdAt": "2020-10-14T10:53:32Z", "commit": {"oid": "b9ff27a54b00acfedb8f26f5b99c47cc88856b60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 800, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}