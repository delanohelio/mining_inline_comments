{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NTE4Njk2", "number": 3351, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1ODozM1rOEQourw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMTo0MDo1MlrOERAitg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODc5OTgzOnYy", "diffSide": "RIGHT", "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "isResolved": true, "comments": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1ODozM1rOG05T3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTo1MDo1M1rOG0-jUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA==", "bodyText": "I think this is confusing - the metrics do not come from the service but from the pod. Is there any reason we don't use PodMonitors to scrape all pods? Why do we use ServiceMonitor somewhere and PodMonitor elsewhere?\nIn a sense this also impacts backwards compatibility.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458118110", "createdAt": "2020-07-21T13:58:33Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyOTU0NQ==", "bodyText": "The ServiceMonitor is translated into endpoints role discovery which actually really scrapes from the backed pods.\nAbout PodMonitor vs ServiceMonitor you can read more here [2]\n[1] https://prometheus.io/docs/prometheus/latest/configuration/configuration/#endpoints\n[2] prometheus-operator/prometheus-operator#3119\n\nIn a sense this also impacts backwards compatibility.\n\nWhat kind of backwards compatibility are you talking about? We were using the kubernetes-services which was a scraping job with endpoints role as well.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458129545", "createdAt": "2020-07-21T14:13:56Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNjIzNw==", "bodyText": "What kind of backwards compatibility are you talking about? We were using the kubernetes-services which was a scraping job with endpoints role as well.\n\nWell, you are clearly changing the labels. So users will need to update the Prometheus settings to be able to use the new dashboards. Right? Not saying this is a blocker, but it is for sure not user friendly and might be worth pointing out in change log. But keeping the old labels would for sure be better as it creates less disruption.\n\nThe ServiceMonitor is translated into endpoints role discovery which actually really scrapes from the backed pods.\n\nI know that, but if the ServiceMonitor means changes to labels, I would see PodMonitor as better option if it keeps the labels the same as we had before this change. I do not think the links list any actual reasons why one would be preferred over the other.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458136237", "createdAt": "2020-07-21T14:22:40Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0MDExNw==", "bodyText": "The usage of the new dashboards come with the usage with the new Prometheus configuration, users should not apply new dashboards leaving ServiceMonitor and additional configuration as they are today, for sure it would brake compatibility.\nRegarding ServiceMonitor, it's clear to me that it came before PodMonitor and that the last one was added only for scraping pods that are not behind a service. People should prefer ServiceMonitor when you have service as in our case. At the end it doesn't scrape the service actually, but the endpoints behind it.\nSee this as well prometheus-operator/prometheus-operator#38", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458140117", "createdAt": "2020-07-21T14:27:35Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NTM5Nw==", "bodyText": "Regarding ServiceMonitor, it's clear to me that it came before PodMonitor and that the last one was added only for scraping pods that are not behind a service. People should prefer ServiceMonitor when you have service as in our case. At the end it doesn't scrape the service actually, but the endpoints behind it.\n\nBut why should people prefer ServiceMonitor? It is IMHO important - should we create services and use service monitors where we now use PodMonitors? If it doesn't have any negative consequences and we are fine to use PodMonitors there, maybe we can use them here as well instead of changing the labels and breaking the compatibility?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458145397", "createdAt": "2020-07-21T14:34:14Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1MDUwMQ==", "bodyText": "Tbh I think it makes sense to use PodMonitor for things like CO and EO because there are actually no services backed by them.\nI was wondering that maybe the bridge as well should be moved to use ServiceMonitor instead of PodMonitor.\nAnd if it's all about backward compatibility I can try to relable in the way to not change the dashboard ... but I don't agree tbh. I don't see any problem. I think that a dashboard update is really tight to a Prometheus configuration update if needed.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458150501", "createdAt": "2020-07-21T14:40:49Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1Mjc1Ng==", "bodyText": "Ok. Then please add docs for the upgrade of the Prometheus configuration and the dashboards. We had issues in the past with this, so we need to start doing it better. We should either in the docs or in the CHANGELOG cover what changed for users using their own Prometheus deployments + explain the changes to the users using the deployment we provide (what to delete, what to create etc.).", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458152756", "createdAt": "2020-07-21T14:43:41Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1NjU5MQ==", "bodyText": "When you say \"their own Prometheus deployments\" what do you mean exactly?\nI agree that users can create their Prometheus instance in the way they want but if they are using our stuff then it means they are using the Prometheus operator at least translating PodMonitor and ServiceMonitor to \"pod\" and \"endpoints\" configs + additional config we provide. These files already provide some relabeling like kubernetes_pod_name so if they are using our dashboards they should anyway use our PodMonitor, ServiceMonitor, etc etc. This is the reason why I see dashboard and scraping jobs really tight.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458156591", "createdAt": "2020-07-21T14:48:31Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1ODY3Mg==", "bodyText": "I think there is from the beginning an assumption that users do not have to deploy Strimzi Prometheus but just plugin Strimzi into their own Prometheus whatever way they deploy it. So I think we need to have a note somewhere saying that from 0.19.0, the Grafana dashboards expect the metrics to be scraped with the service labels and not pod labels as it was before.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458158672", "createdAt": "2020-07-21T14:51:07Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE2MDAwNQ==", "bodyText": "I mean you cannot expect the users to have one Prometheus deployed for Strimzi this way and another Prometheus deployed for some SQL database with some other tooling they use etc. That does not make sense. We promise integration with Prometheus not with CoreOS Prometheus Operator.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458160005", "createdAt": "2020-07-21T14:52:50Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3Mzg4NA==", "bodyText": "I agree but plugging our metrics into their Prometheus instance actually mean deploy our PodMonitor and our ServiceMonitor (this is also why the additional configuration should go away and that is only about node related stuff). So one more time this is why I see PM and SM related to dashboards; you need the ones we provided to scrape Strimzi related metrics.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458173884", "createdAt": "2020-07-21T15:11:00Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3ODM0Nw==", "bodyText": "But they are coupled to a particular operator when you create that as a CR. There might be users configuring it all in a single Prometheus config map with their own deployment not based on any operators for example.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458178347", "createdAt": "2020-07-21T15:17:09Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE4MjA0Ng==", "bodyText": "I see your point now, for people not using the Prometheus operator to configure the Prometheus instance.\nTbh I would continue to use the ServiceMonitor but I can tune the relabeling configured there to have the strimzi_io_name still as <cluster>-zookeeper and <cluster>-kafka and having the service name available with a new label.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458182046", "createdAt": "2020-07-21T15:21:44Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIwMzk4NQ==", "bodyText": "That sounds good. The label change is really what changes the compatibility ... apart form that Service Monitor does not matter to me. And since that does not change I do not think we need some special docs about it - just the new users can install the new setup.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458203985", "createdAt": "2020-07-21T15:50:53Z", "author": {"login": "scholzj"}, "path": "examples/metrics/grafana-dashboards/strimzi-kafka.json", "diffHunk": "@@ -1027,7 +1027,7 @@\n       \"steppedLine\": false,\n       \"targets\": [\n         {\n-          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka\\\"}) by (kubernetes_pod_name)\",\n+          \"expr\": \"sum(jvm_memory_bytes_used{namespace=\\\"$kubernetes_namespace\\\",kubernetes_pod_name=~\\\"$strimzi_cluster_name-$kafka_broker\\\",strimzi_io_name=\\\"$strimzi_cluster_name-kafka-bootstrap\\\"}) by (kubernetes_pod_name)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExODExMA=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTAyMTY0OnYy", "diffSide": "LEFT", "path": "examples/metrics/prometheus-install/strimzi-service-monitor.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDo0NTowMlrOG07fcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDo1MDo0NVrOG07xJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1Mzg0MQ==", "bodyText": "Who does not the scraping of the node exporter information? Or do we not use any information from node exporter in the dashboards and it is not needed?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458153841", "createdAt": "2020-07-21T14:45:02Z", "author": {"login": "scholzj"}, "path": "examples/metrics/prometheus-install/strimzi-service-monitor.yaml", "diffHunk": "@@ -40,58 +32,10 @@ spec:\n       targetLabel: namespace\n       replacement: $1\n       action: replace\n-    - sourceLabels: [__meta_kubernetes_namespace]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: kubernetes_namespace\n-      replacement: $1\n-      action: replace\n-    - sourceLabels: [__meta_kubernetes_service_name]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: kubernetes_name\n-      replacement: $1\n-      action: replace\n-    - sourceLabels: [__meta_kubernetes_pod_node_name]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: node_name\n-      replacement: $1\n-      action: replace\n-    - sourceLabels: [__meta_kubernetes_pod_host_ip]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: node_ip\n-      replacement: $1\n-      action: replace\n-\n-  #### job_name: node-exporter\n-  - port: tcp-prometheus", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1ODM3NA==", "bodyText": "We don't use anything from it as far as I can see, and it was useless. I retested ALL the dashboards and they still work fine with the scraping jobs we have now. I think too much copy/paste was done in the paste getting this configuration from \"somewhere\" without really understanding what it was doing.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458158374", "createdAt": "2020-07-21T14:50:45Z", "author": {"login": "ppatierno"}, "path": "examples/metrics/prometheus-install/strimzi-service-monitor.yaml", "diffHunk": "@@ -40,58 +32,10 @@ spec:\n       targetLabel: namespace\n       replacement: $1\n       action: replace\n-    - sourceLabels: [__meta_kubernetes_namespace]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: kubernetes_namespace\n-      replacement: $1\n-      action: replace\n-    - sourceLabels: [__meta_kubernetes_service_name]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: kubernetes_name\n-      replacement: $1\n-      action: replace\n-    - sourceLabels: [__meta_kubernetes_pod_node_name]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: node_name\n-      replacement: $1\n-      action: replace\n-    - sourceLabels: [__meta_kubernetes_pod_host_ip]\n-      separator: ;\n-      regex: (.*)\n-      targetLabel: node_ip\n-      replacement: $1\n-      action: replace\n-\n-  #### job_name: node-exporter\n-  - port: tcp-prometheus", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1Mzg0MQ=="}, "originalCommit": {"oid": "bf8efeda74fa5372fd49aa91cbd9e674888705de"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MjcwMTM0OnYy", "diffSide": "RIGHT", "path": "CHANGELOG.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMTo0MDo1MlrOG1eocA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMTo0MDo1MlrOG1eocA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODcyOTU4NA==", "bodyText": "I would add this:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This port will be removed in the next release.\n          \n          \n            \n            This port will be removed in the next release.\n          \n          \n            \n            Together with it we will also remove the Prometheus annotation from the service.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3351#discussion_r458729584", "createdAt": "2020-07-22T11:40:52Z", "author": {"login": "scholzj"}, "path": "CHANGELOG.md", "diffHunk": "@@ -45,6 +45,12 @@ We removed the old ones from the Prometheus scraping configuration/alerts and on\n It means that the charts related to memory and CPU usage are not going to work on Kuvbernetes version previous 1.14.\n For more information on what is changed: https://github.com/strimzi/strimzi-kafka-operator/pull/3312\n \n+#### Deprecation of monitoring port on Kafka and ZooKeeper related services\n+\n+The `PodMonitor` resource is now used instead of the `ServiceMonitor` for scraping metrics from Kafka, ZooKeeper, Kafka Connect and so on.\n+For this reason, we are deprecating the monitoring port `tcp-prometheus` (9404) on all the services where it is declared (Kafka bootstrap, ZooKeeper client and so on).\n+This port will be removed in the next release.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6473268c71887560722dde5453fda56ea3b7d2b"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1489, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}