{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1OTg0OTEx", "number": 2863, "title": "Maybe fix ZK leader test", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nbugfix\n\nDescription\nThe test ZookeeperLeaderFinderTest.testLeaderFoundFirstAttempt is flaky for some reason. This is an attempt to fix it. I cannot test it locally (it never fails there) thus I need to open this PR to run the test on the azure.", "createdAt": "2020-04-20T10:50:14Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2863", "merged": true, "mergeCommit": {"oid": "78bdbb0f23c74d3290be55106407b1021856fd90"}, "closed": true, "closedAt": "2020-04-21T13:44:57Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZwmi4AFqTM5NzE3MTQxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZzdZBgFqTM5NzMxNDA0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MTcxNDE3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2863#pullrequestreview-397171417", "createdAt": "2020-04-21T09:51:44Z", "commit": {"oid": "7921ec2424bbf1857839c33e73bc70939b1c0ea6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwOTo1MTo0NFrOGI9C5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwOTo1MTo0NFrOGI9C5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA0MTk1Ng==", "bodyText": "It seems a bit weird/ugly to me that the text context can be completed in two different ways, one via completeNow(), if zks is empty, and the other by the checkpoints getting flagged when zks is nonempty. Is there a simple way we can just make the call to zk.stop() be synchronous? That way you could just call completeNow() after the loop, no matter the emptiness of zks.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2863#discussion_r412041956", "createdAt": "2020-04-21T09:51:44Z", "author": {"login": "tombentley"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/resource/ZookeeperLeaderFinderTest.java", "diffHunk": "@@ -190,9 +193,12 @@ public void stop() {\n     }\n \n     @AfterEach\n-    public void stopZks() {\n+    public void stopZks(VertxTestContext vertxTestContext) {\n+        if (zks.isEmpty()) {\n+            vertxTestContext.completeNow();\n+        }\n         for (FakeZk zk : zks) {\n-            zk.stop();\n+            zk.stop(vertxTestContext);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7921ec2424bbf1857839c33e73bc70939b1c0ea6"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "678e656d4d38f524691b4e46419580fb40bfa932", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/678e656d4d38f524691b4e46419580fb40bfa932", "committedDate": "2020-04-21T11:38:44Z", "message": "WIP: Maybe fix ZK leader test\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "733b6916ba4ce02e274aec8d79a8ced2513605cd", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/733b6916ba4ce02e274aec8d79a8ced2513605cd", "committedDate": "2020-04-21T11:41:01Z", "message": "comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7921ec2424bbf1857839c33e73bc70939b1c0ea6", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7921ec2424bbf1857839c33e73bc70939b1c0ea6", "committedDate": "2020-04-20T10:48:18Z", "message": "WIP: Maybe fix ZK leader test\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}, "afterCommit": {"oid": "733b6916ba4ce02e274aec8d79a8ced2513605cd", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/733b6916ba4ce02e274aec8d79a8ced2513605cd", "committedDate": "2020-04-21T11:41:01Z", "message": "comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MzA1NDM4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2863#pullrequestreview-397305438", "createdAt": "2020-04-21T13:01:19Z", "commit": {"oid": "733b6916ba4ce02e274aec8d79a8ced2513605cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MzE0MDQ0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2863#pullrequestreview-397314044", "createdAt": "2020-04-21T13:11:27Z", "commit": {"oid": "733b6916ba4ce02e274aec8d79a8ced2513605cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1904, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}