{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3Mzc3NTU3", "number": 3652, "title": "Add reconcile resource state metric", "bodyText": "Type of change\n\nEnhancement / new feature\n\nDescription\nThis PR fixes #3642.\nIt adds a new metric exposed by operators and defined as:\nstrimzi_resource_state{kind=\"Kafka\", name=\"my-cluster\", resource-namespace=\"my-kafka-namespace\"}\nproviding the information on the latest reconcile state so a kind of information if the Kafka cluster was created and ready at the end of reconciling something failed (more info to check in the status of the custom resource). The possible values are just 1.0 and 0.0.\nOf course, it's not just about Kafka but even the other resources.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md", "createdAt": "2020-09-15T15:25:32Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3652", "merged": true, "mergeCommit": {"oid": "89d07578243bc86a35746ca6bac4934a716a1d11"}, "closed": true, "closedAt": "2020-09-16T20:07:37Z", "author": {"login": "ppatierno"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJFop0gH2gAyNDg3Mzc3NTU3OjE0NDhhZjg1N2Q4ZGE2OGRhMzhjOWE5MjkyZTZlYjNiYzdlNTRjMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJfOaOgH2gAyNDg3Mzc3NTU3OjE1NTQ4MjM5ZTAyM2NkMzRiNjUxZWNlMTc0ZWM4YTc3ZmFkOGQ5ZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1448af857d8da68da38c9a9292e6eb3bc7e54c39", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1448af857d8da68da38c9a9292e6eb3bc7e54c39", "committedDate": "2020-09-15T10:56:29Z", "message": "Added logic for a resource state metric\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4834f16a36bbb999f7e210ead8ff9608cfe94ae", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b4834f16a36bbb999f7e210ead8ff9608cfe94ae", "committedDate": "2020-09-15T12:30:42Z", "message": "Fixed some imports\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ca1bf9cc0eff8fcad653f3d3bd1874a2d59f102", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5ca1bf9cc0eff8fcad653f3d3bd1874a2d59f102", "committedDate": "2020-09-15T14:50:09Z", "message": "Added check of resource state metric in unit tests\nUpdated resource state metric list to a concurrent one (more reconcile\nin parallel could try to update the list)\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3548925be399364855bdaa35d2c88d583fa06bcf", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3548925be399364855bdaa35d2c88d583fa06bcf", "committedDate": "2020-09-15T14:57:18Z", "message": "Updated CHANGELOG\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTg1Nzk3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3652#pullrequestreview-488985797", "createdAt": "2020-09-15T19:08:34Z", "commit": {"oid": "5ca1bf9cc0eff8fcad653f3d3bd1874a2d59f102"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTowODozNFrOHSQSqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTowODozNFrOHSQSqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMzMzOA==", "bodyText": "I wonder if this would be more readable with boolean ready instead of int state. If nothing else, the Javadoc should list the supported states and explain them.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3652#discussion_r488903338", "createdAt": "2020-09-15T19:08:34Z", "author": {"login": "scholzj"}, "path": "operator-common/src/main/java/io/strimzi/operator/common/AbstractOperator.java", "diffHunk": "@@ -339,4 +348,39 @@ public Counter getPeriodicReconciliationsCounter() {\n     public AtomicInteger getResourceCounter() {\n         return resourceCounter;\n     }\n+\n+    /**\n+     * Updates the resource state metric for the provided reconciliation which brings kind, name and namespace\n+     * of the custom resource.\n+     *\n+     * @param reconciliation reconciliation to use to update the resource state metric\n+     * @param state metric value\n+     */\n+    private void updateResourceState(Reconciliation reconciliation, int state) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca1bf9cc0eff8fcad653f3d3bd1874a2d59f102"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15548239e023cd34b651ece174ec8a77fad8d9d2", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/15548239e023cd34b651ece174ec8a77fad8d9d2", "committedDate": "2020-09-16T16:45:21Z", "message": "Fixed comment\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 972, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}