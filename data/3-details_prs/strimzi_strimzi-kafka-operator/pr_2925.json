{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMjkzMzA0", "number": 2925, "title": "Fix mm2 status ordering", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nBugfix\n\nDescription\nContacting REST API to get connectors does not guarantee the same order. We should patch it.\nChecklist\n\n Update/write design documentation in ./design\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md", "createdAt": "2020-04-30T09:36:53Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925", "merged": true, "mergeCommit": {"oid": "ef2f10b5efb2755cd4fb61afc556448b7b993958"}, "closed": true, "closedAt": "2020-05-05T15:55:00Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccpvaBgH2gAyNDExMjkzMzA0OjkyZDAzMWM4ZmQxMzEyNTIwYTM4NjVlMDM1YmRkYTY4MGZiZDZjMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceWLi-AFqTQwNTkyNTQzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "92d031c8fd1312520a3865e035bdda680fbd6c23", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/92d031c8fd1312520a3865e035bdda680fbd6c23", "committedDate": "2020-04-30T09:33:51Z", "message": "Fix mm2 status ordering\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d0abbfab7888d94c7eb42514064bda4608be12cf", "committedDate": "2020-04-30T10:30:28Z", "message": "spotbugs\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTExMzQ3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-404111347", "createdAt": "2020-05-01T10:54:47Z", "commit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDo1NDo0N1rOGPHJhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDo1NDo0N1rOGPHJhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODk1MQ==", "bodyText": "I've been enjoying the Optional class recently - these lines could be updated to:\nString name1 = Optional.ofNullable(props1.get(\"name\")).map(Object::toString).orElse(\"\");\nString name2 = Optional.ofNullable(props2.get(\"name\")).map(Object::toString).orElse(\"\");", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418498951", "createdAt": "2020-05-01T10:54:47Z", "author": {"login": "ajborley"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperator.java", "diffHunk": "@@ -371,11 +373,23 @@ private static String addTLSConfigToMirrorMaker2ConnectorConfig(Map<String, Obje\n         return securityProtocol;\n     }\n \n+    static class ConnectorsComparator implements Comparator<Map<String, Object>>, Serializable {\n+        private static final long serialVersionUID = 1L;\n+\n+        @Override\n+        public int compare(Map<String, Object> m1, Map<String, Object> m2) {\n+            String name1 = m1.get(\"name\") == null ? \"\" : m1.get(\"name\").toString();\n+            String name2 = m2.get(\"name\") == null ? \"\" : m2.get(\"name\").toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTM2NzMx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-404136731", "createdAt": "2020-05-01T12:30:45Z", "commit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjozMDo0NVrOGPIjKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjozMDo0NVrOGPIjKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyMTg5OQ==", "bodyText": "It does seems strange to me that the processing of the current and desired statuses is not the same before the comparison.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418521899", "createdAt": "2020-05-01T12:30:45Z", "author": {"login": "AndrewJSchofield"}, "path": "operator-common/src/main/java/io/strimzi/operator/cluster/model/StatusDiff.java", "diffHunk": "@@ -24,7 +25,7 @@\n     private final boolean isEmpty;\n \n     public StatusDiff(Status current, Status desired) {\n-        JsonNode source = patchMapper().valueToTree(current == null ? \"{}\" : current);\n+        JsonNode source = patchMapper().configure(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS, true).valueToTree(current == null ? \"{}\" : current);\n         JsonNode target = patchMapper().valueToTree(desired == null ? \"{}\" : desired);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MjI4Mjg1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-404228285", "createdAt": "2020-05-01T15:38:03Z", "commit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNTozODowM1rOGPNHGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNTo0MTo0MVrOGPNNuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5NjYzMw==", "bodyText": "I agree with Andrew here, the use of the Optional makes the intent of the line slightly clearer. Though by convention Strimzi as a project does tend to use null checks over optionals...\nPerhaps one of the other maintainers has an opinion on this, @ppatierno ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418596633", "createdAt": "2020-05-01T15:38:03Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperator.java", "diffHunk": "@@ -371,11 +373,23 @@ private static String addTLSConfigToMirrorMaker2ConnectorConfig(Map<String, Obje\n         return securityProtocol;\n     }\n \n+    static class ConnectorsComparator implements Comparator<Map<String, Object>>, Serializable {\n+        private static final long serialVersionUID = 1L;\n+\n+        @Override\n+        public int compare(Map<String, Object> m1, Map<String, Object> m2) {\n+            String name1 = m1.get(\"name\") == null ? \"\" : m1.get(\"name\").toString();\n+            String name2 = m2.get(\"name\") == null ? \"\" : m2.get(\"name\").toString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODk1MQ=="}, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5NzQxMw==", "bodyText": "I'm in agreement here, @stanlyDoge is there a reason line 29 is not as below?\nJsonNode target = patchMapper().configure(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS, true).valueToTree(desired == null ? \"{}\" : desired);\n\nIt would make sense to me that we should be sorting both the source and the target for comparison?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418597413", "createdAt": "2020-05-01T15:39:47Z", "author": {"login": "samuel-hawker"}, "path": "operator-common/src/main/java/io/strimzi/operator/cluster/model/StatusDiff.java", "diffHunk": "@@ -24,7 +25,7 @@\n     private final boolean isEmpty;\n \n     public StatusDiff(Status current, Status desired) {\n-        JsonNode source = patchMapper().valueToTree(current == null ? \"{}\" : current);\n+        JsonNode source = patchMapper().configure(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS, true).valueToTree(current == null ? \"{}\" : current);\n         JsonNode target = patchMapper().valueToTree(desired == null ? \"{}\" : desired);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyMTg5OQ=="}, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5ODMyOQ==", "bodyText": "* @return true when the diffed statuses match\nMight be a slight improvement", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418598329", "createdAt": "2020-05-01T15:41:41Z", "author": {"login": "samuel-hawker"}, "path": "operator-common/src/main/java/io/strimzi/operator/cluster/model/StatusDiff.java", "diffHunk": "@@ -53,7 +54,7 @@ public StatusDiff(Status current, Status desired) {\n     /**\n      * Returns whether the Diff is empty or not\n      *\n-     * @return true when the storage configurations are the same\n+     * @return true when the statuses are the same", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTM2NDM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-404536435", "createdAt": "2020-05-02T15:21:13Z", "commit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNToyMToxM1rOGPj8YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNToyNDoyM1rOGPj94Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk3MDcyMQ==", "bodyText": "Is this something we should also use in other places where we use the JsonDiff?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418970721", "createdAt": "2020-05-02T15:21:13Z", "author": {"login": "scholzj"}, "path": "operator-common/src/main/java/io/strimzi/operator/cluster/model/StatusDiff.java", "diffHunk": "@@ -24,7 +25,7 @@\n     private final boolean isEmpty;\n \n     public StatusDiff(Status current, Status desired) {\n-        JsonNode source = patchMapper().valueToTree(current == null ? \"{}\" : current);\n+        JsonNode source = patchMapper().configure(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS, true).valueToTree(current == null ? \"{}\" : current);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk3MTEwNQ==", "bodyText": "I wonder if the name properly describes what it does. All it compares is the names of the connectors. Not the connectors them self - for example their settings etc. If nothing else, this should have some javadoc describing what it does in more detail.\nMaybe we could also move the class to the end of the file? I find it a bit weird to have it in the middle.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#discussion_r418971105", "createdAt": "2020-05-02T15:24:23Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperator.java", "diffHunk": "@@ -371,11 +373,23 @@ private static String addTLSConfigToMirrorMaker2ConnectorConfig(Map<String, Obje\n         return securityProtocol;\n     }\n \n+    static class ConnectorsComparator implements Comparator<Map<String, Object>>, Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0abbfab7888d94c7eb42514064bda4608be12cf"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72da45e0ac1863a362cb4f78ff1af67a59519ab0", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/72da45e0ac1863a362cb4f78ff1af67a59519ab0", "committedDate": "2020-05-04T05:56:39Z", "message": "review comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTI0MjQx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-405524241", "createdAt": "2020-05-05T06:37:41Z", "commit": {"oid": "72da45e0ac1863a362cb4f78ff1af67a59519ab0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTUzNDg2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-405553486", "createdAt": "2020-05-05T07:35:59Z", "commit": {"oid": "72da45e0ac1863a362cb4f78ff1af67a59519ab0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODM2OTg1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-405836985", "createdAt": "2020-05-05T14:21:02Z", "commit": {"oid": "72da45e0ac1863a362cb4f78ff1af67a59519ab0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16d086e069beebdad170c7e732068d7c428b7d26", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/16d086e069beebdad170c7e732068d7c428b7d26", "committedDate": "2020-05-05T14:31:38Z", "message": "comment\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODg5NDEy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-405889412", "createdAt": "2020-05-05T15:14:50Z", "commit": {"oid": "16d086e069beebdad170c7e732068d7c428b7d26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTI1NDM5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2925#pullrequestreview-405925439", "createdAt": "2020-05-05T15:54:20Z", "commit": {"oid": "16d086e069beebdad170c7e732068d7c428b7d26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2012, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}