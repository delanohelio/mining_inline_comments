{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NjEyNzE2", "number": 3162, "title": "Fixed Cruise Control metrics reporter bootstrap server", "bodyText": "Signed-off-by: Paolo Patierno ppatierno@live.com\nType of change\nSelect the type of your PR\n\nBugfix\n\nDescription\nWhen the Cruise Control metrics topic has to be created, the Admin client, in the Cruise Control metrics reporter, is not able to connect to the brokers on starting up because they are not ready yet (behind the -bootstrap service) when the metrics topic has to be created.\nEven when retrying (thanks to this fix we got merged in Cruise Control, linkedin/cruise-control#1225) it's not able to connect to the brokers when they come online. It could be something related to the usage of the -bootstrap service. Finally, after a couple of minutes, it's able to connect and creates the topic but the cluster is running fine since one minute and the cruise control crashes loop a few times because it doesn't find the metrics topic.\nThis PR addresses this problem using the -brokers service which is immediately resolved to the pods IPs as it is a headless one. It's the same mechanism used by the \"replication\" for example.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Update/write design documentation in ./design\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md", "createdAt": "2020-06-05T17:41:02Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162", "merged": true, "mergeCommit": {"oid": "9d404a4099971136e16ab293973893154c3631c4"}, "closed": true, "closedAt": "2020-06-09T09:27:05Z", "author": {"login": "ppatierno"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoXLE1ABqjM0MTI3MDM5NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpgvljgBqjM0MjM2NjM1NDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "813a81cef3bdae179ce96e02cc0054836b4f559d", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/813a81cef3bdae179ce96e02cc0054836b4f559d", "committedDate": "2020-06-05T17:42:28Z", "message": "Fixed tests"}, "afterCommit": {"oid": "c02fa554114698655f09e78fa7eb6d38b626f6ba", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c02fa554114698655f09e78fa7eb6d38b626f6ba", "committedDate": "2020-06-05T18:42:32Z", "message": "Fixed tests\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NTQ0OTU3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#pullrequestreview-425544957", "createdAt": "2020-06-05T18:49:47Z", "commit": {"oid": "c02fa554114698655f09e78fa7eb6d38b626f6ba"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxODo0OTo0N1rOGf5tKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxODo0OTo0N1rOGf5tKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNDQ4OQ==", "bodyText": "Could you add a comment similar to what you wrote in the commit/PR to make clear why we are using the service with unready endpoint resolvability?\nCan imagine someone coming back to this later may be confused why the boostrap config property is not set to the bootstrap ;)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#discussion_r436104489", "createdAt": "2020-06-05T18:49:47Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/KafkaBrokerConfigurationBuilder.java", "diffHunk": "@@ -78,7 +78,7 @@ public KafkaBrokerConfigurationBuilder withCruiseControl(String clusterName, Cru\n             printSectionHeader(\"Cruise Control configuration\");\n             writer.println(\"cruise.control.metrics.topic=strimzi.cruisecontrol.metrics\");\n             writer.println(\"cruise.control.metrics.reporter.ssl.endpoint.identification.algorithm=HTTPS\");\n-            writer.println(\"cruise.control.metrics.reporter.bootstrap.servers=\" + KafkaResources.bootstrapServiceName(clusterName) + \":9091\");\n+            writer.println(\"cruise.control.metrics.reporter.bootstrap.servers=\" + KafkaResources.brokersServiceName(clusterName) + \":9091\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c02fa554114698655f09e78fa7eb6d38b626f6ba"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NTUyMzIx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#pullrequestreview-425552321", "createdAt": "2020-06-05T19:01:51Z", "commit": {"oid": "c483e2638a5a9015e9ee18e059f500b637a2d3bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzQ0MDA1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#pullrequestreview-425744005", "createdAt": "2020-06-06T14:26:29Z", "commit": {"oid": "c483e2638a5a9015e9ee18e059f500b637a2d3bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzEyNTky", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3162#pullrequestreview-426312592", "createdAt": "2020-06-08T14:42:27Z", "commit": {"oid": "c483e2638a5a9015e9ee18e059f500b637a2d3bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46e091266ecbab932ab590c69144ba158cda0cd5", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/46e091266ecbab932ab590c69144ba158cda0cd5", "committedDate": "2020-06-09T06:42:55Z", "message": "Disable manual topic creation test"}, "afterCommit": {"oid": "7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "committedDate": "2020-06-09T06:45:06Z", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37766de8eeff16f5ed904af02d63d573bacfa95", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b37766de8eeff16f5ed904af02d63d573bacfa95", "committedDate": "2020-06-09T08:25:25Z", "message": "Fixed Cruise Control metrics reporter bootstrap server\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b6a70fb6e3ce71071478ffa068115566a6804a", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/12b6a70fb6e3ce71071478ffa068115566a6804a", "committedDate": "2020-06-09T08:25:25Z", "message": "Fixed tests\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21a723fe7ee259a1b8e8d60ca4167d4b38abb816", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/21a723fe7ee259a1b8e8d60ca4167d4b38abb816", "committedDate": "2020-06-09T08:25:25Z", "message": "Fixed comment\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929060d05dee722a6636febcd8a8d2ccce5ab5c5", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/929060d05dee722a6636febcd8a8d2ccce5ab5c5", "committedDate": "2020-06-09T08:25:25Z", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7afedd1dd2ec4139fea36ab88c7950be444d7fb3", "committedDate": "2020-06-09T06:45:06Z", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}, "afterCommit": {"oid": "929060d05dee722a6636febcd8a8d2ccce5ab5c5", "author": {"user": {"login": "ppatierno", "name": "Paolo Patierno"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/929060d05dee722a6636febcd8a8d2ccce5ab5c5", "committedDate": "2020-06-09T08:25:25Z", "message": "Disable manual topic creation test\n\nSigned-off-by: Paolo Patierno <ppatierno@live.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1492, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}