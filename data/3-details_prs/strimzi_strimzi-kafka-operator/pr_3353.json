{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NjIzMTAw", "number": 3353, "title": "[DOC] Updates to external listener config procedures", "bodyText": "Documentation\nUpdates to the procedures describing how to connect to the Kafka cluster using an external listener.\n\nNode port procedure updated to use single step retrieval of addresses used in connection\nMore context on what's created when each listener config is applied\nMade the procedures more consistent\n\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-07-21T16:42:24Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353", "merged": true, "mergeCommit": {"oid": "dd7e3c67a318c6b98dd70f3571d222cb73b3f0f5"}, "closed": true, "closedAt": "2020-07-27T07:57:07Z", "author": {"login": "PaulRMellor"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3I5pBgH2gAyNDU0NjIzMTAwOmUyZTM2YjFkMzYzOGUyM2M2YTQ2NWQ3MDk2MzBkOWM5ODJkMWZmODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc471BKgFqTQ1NTUwMTcxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2e36b1d3638e23c6a465d709630d9c982d1ff87", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e2e36b1d3638e23c6a465d709630d9c982d1ff87", "committedDate": "2020-07-21T16:34:07Z", "message": "[DOC] Updates to external listener config procedures\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fae46685413e3a060595f1a1dda81c0c2dab4ebb", "committedDate": "2020-07-21T16:43:16Z", "message": "edit step 1\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjQ4NDQy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#pullrequestreview-452648442", "createdAt": "2020-07-21T16:51:06Z", "commit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjo1MTowNlrOG1BB-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjo1MTowNlrOG1BB-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0NDYwMA==", "bodyText": "@scholzj - Not sure what this step is meant to do. So added some placeholder commands!", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458244600", "createdAt": "2020-07-21T16:51:06Z", "author": {"login": "PaulRMellor"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.\n \n-. Make sure the hosts in the `configuration` section properly resolve to the Ingress endpoints.\n+. Make sure the hosts in the `configuration` resolve to the Ingress endpoints.\n++\n+[source,shell,subs=+quotes]\n+kubectl get services\n+kubectl describe service _INGRESS-NAME_", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjk2NjU2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#pullrequestreview-452696656", "createdAt": "2020-07-21T17:53:30Z", "commit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "state": "COMMENTED", "comments": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo1MzozMFrOG1DX1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODoxMDo1MVrOG1EAyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4Mjk2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.\n          \n          \n            \n            This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Nginx Ingress.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458282964", "createdAt": "2020-07-21T17:53:30Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -5,19 +5,26 @@\n [id='proc-accessing-kafka-using-ingress-{context}']\n = Accessing Kafka using ingress\n \n-This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.\n+This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MzYyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Ingress is used for HTTP access, so the port used to connect is always 443.\n          \n          \n            \n            For access using Ingress, the port is always 443.\n          \n      \n    \n    \n  \n\nI think the HTTP reference here is rather confusing since Kafka is not HTTP. So I would leave it out.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458283622", "createdAt": "2020-07-21T17:54:37Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -5,19 +5,26 @@\n [id='proc-accessing-kafka-using-ingress-{context}']\n = Accessing Kafka using ingress\n \n-This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.\n+This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.\n+\n+To connect to a broker, you need a hostname (advertised address) for the Ingress _bootstrap address_,\n+as well as the certificate used for authentication.\n+\n+Ingress is used for HTTP access, so the port used to connect is always 443.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MzkxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Specify the Ingress hosts for the bootstrap service and kafka brokers.\n          \n          \n            \n            Specify the Ingress hosts for the bootstrap service and Kafka brokers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458283910", "createdAt": "2020-07-21T17:55:04Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -5,19 +5,26 @@\n [id='proc-accessing-kafka-using-ingress-{context}']\n = Accessing Kafka using ingress\n \n-This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.\n+This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.\n+\n+To connect to a broker, you need a hostname (advertised address) for the Ingress _bootstrap address_,\n+as well as the certificate used for authentication.\n+\n+Ingress is used for HTTP access, so the port used to connect is always 443.\n \n .Prerequisites\n \n-* An Kubernetes cluster\n+* Kubernetes cluster\n * Deployed {NginxIngressController} with TLS passthrough enabled\n * A running Cluster Operator\n \n .Procedure\n \n-. Deploy Kafka cluster with an external listener enabled and configured to the type `ingress`.\n+. Configure a `Kafka` resource with an external listener set to the `ingress` type.\n +\n-An example configuration with an external listener configured to use `Ingress`:\n+Specify the Ingress hosts for the bootstrap service and kafka brokers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NDYyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <1> Ingress hosts for the bootstrap service and kafka brokers.\n          \n          \n            \n            <1> Ingress hosts for the bootstrap service and Kafka brokers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458284626", "createdAt": "2020-07-21T17:56:15Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NjA1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `ingress` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n          \n          \n            \n            `ClusterIP` type services are created for each Kafka broker, as well as an additional _bootstrap service_.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458286056", "createdAt": "2020-07-21T17:58:33Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.\n \n-. Make sure the hosts in the `configuration` section properly resolve to the Ingress endpoints.\n+. Make sure the hosts in the `configuration` resolve to the Ingress endpoints.\n++\n+[source,shell,subs=+quotes]\n+kubectl get services\n+kubectl describe service _INGRESS-NAME_\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`ingress` type services are created for each Kafka broker, as well as an external _bootstrap service_.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NjM0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The bootstrap service routes external traffic to the Kafka brokers.\n          \n          \n            \n            These services are used by the Ingress controller to route traffic to the Kafka brokers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458286346", "createdAt": "2020-07-21T17:58:58Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.\n \n-. Make sure the hosts in the `configuration` section properly resolve to the Ingress endpoints.\n+. Make sure the hosts in the `configuration` resolve to the Ingress endpoints.\n++\n+[source,shell,subs=+quotes]\n+kubectl get services\n+kubectl describe service _INGRESS-NAME_\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`ingress` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NzYyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To connect to a broker, you need a hostname (advertised address) for the loadbalancer _bootstrap address_,\n          \n          \n            \n            To connect to a broker, you need the address of the _bootstrap loadbalancer_,", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458287625", "createdAt": "2020-07-21T18:00:57Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-loadbalancers-{context}']\n = Accessing Kafka using loadbalancers\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client using loadbalancers.\n+\n+To connect to a broker, you need a hostname (advertised address) for the loadbalancer _bootstrap address_,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NzgxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            as well as the certificate used for authentication.\n          \n          \n            \n            as well as the certificate used for TLS encryption.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458287810", "createdAt": "2020-07-21T18:01:15Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-loadbalancers-{context}']\n = Accessing Kafka using loadbalancers\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client using loadbalancers.\n+\n+To connect to a broker, you need a hostname (advertised address) for the loadbalancer _bootstrap address_,\n+as well as the certificate used for authentication.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4ODA0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The bootstrap service routes external traffic to the Kafka brokers.\n          \n          \n            \n            The bootstrap service routes external traffic to all Kafka brokers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458288047", "createdAt": "2020-07-21T18:01:40Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -36,27 +43,28 @@ spec:\n \n . Create or update the resource.\n +\n-This can be done using `kubectl apply`:\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`loadbalancer` type services and loadbalancers are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDA0OQ==", "bodyText": "This whole section / bullet point should be replaced with something like this\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Retrieve the address of the bootstrap service to access the Kafka cluster.\n          \n          \n            \n            . Retrieve the address of the bootstrap service to access the Kafka cluster.\n          \n          \n            \n            \n          \n          \n            \n            [source,shell,subs=+quotes]\n          \n          \n            \n            kubectl get kafka _KAFKA-CLUSTER-NAME_ -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}'", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458290049", "createdAt": "2020-07-21T18:05:11Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -36,27 +43,28 @@ spec:\n \n . Create or update the resource.\n +\n-This can be done using `kubectl apply`:\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`loadbalancer` type services and loadbalancers are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+DNS names and IP addresses used for connection are propagated to the `status` of each service.\n \n-. Find the hostname of the bootstrap loadbalancer.\n+. Retrieve the address of the bootstrap service to access the Kafka cluster.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDU1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To connect to a broker, you need a hostname (advertised address) and port number for the Kafka _bootstrap address_,\n          \n          \n            \n            To connect to a broker, you need a hostname and port number for the Kafka _bootstrap address_,", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458290557", "createdAt": "2020-07-21T18:06:02Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -7,7 +7,7 @@\n \n This procedure describes how to access a Strimzi Kafka cluster from an external client using node ports.\n \n-To connect to a broker, you need the hostname (advertised address) and port number for the Kafka _bootstrap_ address,\n+To connect to a broker, you need a hostname (advertised address) and port number for the Kafka _bootstrap address_,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDkwNw==", "bodyText": "This is unrelated to the nodeports. MAybe we should remove it from this procedure?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458290907", "createdAt": "2020-07-21T18:06:41Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -35,36 +35,38 @@ spec:\n         authentication:\n           type: tls\n         configuration:\n-          brokerCertChainAndKey: <1>\n+          brokerCertChainAndKey: <2>\n             secretName: my-secret\n             certificate: my-certificate.crt\n             key: my-key.key", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTQxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Node addresses used for connection are propagated to the `status` of each service.\n          \n          \n            \n            Node addresses used for connection are propagated to the `status` of the Kafka custom resource.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458291418", "createdAt": "2020-07-21T18:07:31Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -35,36 +35,38 @@ spec:\n         authentication:\n           type: tls\n         configuration:\n-          brokerCertChainAndKey: <1>\n+          brokerCertChainAndKey: <2>\n             secretName: my-secret\n             certificate: my-certificate.crt\n             key: my-key.key\n-          preferredAddressType: InternalDNS <2>\n+          preferredAddressType: InternalDNS <3>\n     # ...\n   zookeeper:\n     # ...\n ----\n-<1> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n-<2> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n+<2> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n+<3> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`NodePort` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+Node addresses used for connection are propagated to the `status` of each service.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTk0NA==", "bodyText": "From this point on the rest of the Retrieve the connection details to access the Kafka cluster. section should be removed.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458291944", "createdAt": "2020-07-21T18:08:20Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -35,36 +35,38 @@ spec:\n         authentication:\n           type: tls\n         configuration:\n-          brokerCertChainAndKey: <1>\n+          brokerCertChainAndKey: <2>\n             secretName: my-secret\n             certificate: my-certificate.crt\n             key: my-key.key\n-          preferredAddressType: InternalDNS <2>\n+          preferredAddressType: InternalDNS <3>\n     # ...\n   zookeeper:\n     # ...\n ----\n-<1> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n-<2> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n+<2> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n+<3> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`NodePort` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+Node addresses used for connection are propagated to the `status` of each service.\n \n-. Find the port number of the bootstrap service.\n+. Retrieve the connection details to access the Kafka cluster.\n +\n [source,shell,subs=+quotes]\n-kubectl get service _KAFKA-CLUSTER-NAME_-kafka-external-bootstrap -o=jsonpath='{.spec.ports[0].nodePort}{\"\\n\"}'\n+kubectl get kafka _KAFKA-CLUSTER-NAME_ -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}'\n +\n-The port is used in the Kafka _bootstrap_ address.\n-\n-. Find the address of the Kubernetes node.\n+You need:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjEwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,\n          \n          \n            \n            To connect to a broker, you need a hostname for the route _bootstrap address_,", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458292107", "createdAt": "2020-07-21T18:08:39Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-routes-{context}']\n = Accessing Kafka using OpenShift routes\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.\n+\n+To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjI3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            as well as the certificate used for authentication.\n          \n          \n            \n            as well as the certificate used for TLS encryption.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458292275", "createdAt": "2020-07-21T18:08:57Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-routes-{context}']\n = Accessing Kafka using OpenShift routes\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.\n+\n+To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,\n+as well as the certificate used for authentication.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjYwMQ==", "bodyText": "Again, we should either remove the HTTP reference or explain the details about TLS passthrough masking the Kafka traffic as HTTPS.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458292601", "createdAt": "2020-07-21T18:09:30Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-routes-{context}']\n = Accessing Kafka using OpenShift routes\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.\n+\n+To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,\n+as well as the certificate used for authentication.\n+\n+Routes are used for HTTP access, so the port used to connect is always 443.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MzAzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The bootstrap service routes external traffic to the Kafka brokers.\n          \n          \n            \n            The services route the traffic from the OpenShift Routes to the Kafka brokers.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458293033", "createdAt": "2020-07-21T18:10:06Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -36,13 +43,20 @@ spec:\n +\n [source,shell,subs=+quotes]\n oc apply -f _KAFKA-CONFIG-FILE_\n++\n+`ClusterIP` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MzMyMA==", "bodyText": "Again, you can just use the command kubectl get kafka my-cluster -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}'", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458293320", "createdAt": "2020-07-21T18:10:36Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -36,13 +43,20 @@ spec:\n +\n [source,shell,subs=+quotes]\n oc apply -f _KAFKA-CONFIG-FILE_\n++\n+`ClusterIP` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+An OpenShift `Route` resource is also created for each service to expose them using the HAProxy load balancer.\n+DNS addresses used for connection are propagated to the `status` of each service.\n \n-. Find the address of the bootstrap `Route`.\n+. Retrieve the address of the bootstrap service to access the Kafka cluster.\n +\n [source,shell,subs=+quotes]\n oc get routes _KAFKA-CLUSTER-NAME_-kafka-bootstrap -o=jsonpath='{.status.ingress[0].host}{\"\\n\"}'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MzQ1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You need the address of the `Route` bootstrap service (`_KAFKA-CLUSTER-NAME_-kafka-bootstrap`).\n          \n          \n            \n            +\n          \n          \n            \n            Use the route service address and port 443 (_ROUTE-ADDRESS:443_) in your Kafka client as the _bootstrap address_ to connect to the Kafka cluster.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458293450", "createdAt": "2020-07-21T18:10:51Z", "author": {"login": "scholzj"}, "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -36,13 +43,20 @@ spec:\n +\n [source,shell,subs=+quotes]\n oc apply -f _KAFKA-CONFIG-FILE_\n++\n+`ClusterIP` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+An OpenShift `Route` resource is also created for each service to expose them using the HAProxy load balancer.\n+DNS addresses used for connection are propagated to the `status` of each service.\n \n-. Find the address of the bootstrap `Route`.\n+. Retrieve the address of the bootstrap service to access the Kafka cluster.\n +\n [source,shell,subs=+quotes]\n oc get routes _KAFKA-CLUSTER-NAME_-kafka-bootstrap -o=jsonpath='{.status.ingress[0].host}{\"\\n\"}'\n +\n-Use the address together with port 443 in your Kafka client as the _bootstrap_ address.\n+You need the address of the `Route` bootstrap service (`_KAFKA-CLUSTER-NAME_-kafka-bootstrap`).\n++\n+Use the route service address and port 443 (_ROUTE-ADDRESS:443_) in your Kafka client as the _bootstrap address_ to connect to the Kafka cluster.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMjA4MzQz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#pullrequestreview-453208343", "createdAt": "2020-07-22T10:55:27Z", "commit": {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NzExMzk1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#pullrequestreview-454711395", "createdAt": "2020-07-24T08:22:19Z", "commit": {"oid": "58fe4a7c3c49a605bf10f3e7eec17d90ca93a009"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de84bd0bf274ef8750d687aa10ff6b83c4d00570", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/de84bd0bf274ef8750d687aa10ff6b83c4d00570", "committedDate": "2020-07-24T16:44:08Z", "message": "review edits\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e724880e13d41d6e5c7a6168a21f857b24f7e8e", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7e724880e13d41d6e5c7a6168a21f857b24f7e8e", "committedDate": "2020-07-24T16:44:29Z", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c00d1458223685815c63f29a1cceaeb9b42f333", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1c00d1458223685815c63f29a1cceaeb9b42f333", "committedDate": "2020-07-24T16:34:29Z", "message": "add note used in deploying guide for CA cert"}, "afterCommit": {"oid": "0dc7fde38fc360221bdd72abd47038b88ec15eb1", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0dc7fde38fc360221bdd72abd47038b88ec15eb1", "committedDate": "2020-07-24T16:44:29Z", "message": "add note used in deploying guide for CA cert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "committedDate": "2020-07-24T16:47:27Z", "message": "review edit PM\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dc7fde38fc360221bdd72abd47038b88ec15eb1", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0dc7fde38fc360221bdd72abd47038b88ec15eb1", "committedDate": "2020-07-24T16:44:29Z", "message": "add note used in deploying guide for CA cert"}, "afterCommit": {"oid": "15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "author": {"user": {"login": "PaulRMellor", "name": null}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "committedDate": "2020-07-24T16:47:27Z", "message": "review edit PM\n\nSigned-off-by: prmellor <pmellor@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NTAxNzE4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#pullrequestreview-455501718", "createdAt": "2020-07-27T06:28:09Z", "commit": {"oid": "15c27877ea3ad8e451c5fef1e253e21ade1e39b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1351, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}