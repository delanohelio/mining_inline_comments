{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDAxMTUw", "number": 3579, "title": "[systemtest][fixes] Some fixes and add method for listing deployed resources", "bodyText": "Signed-off-by: Lukas Kral lukywill16@gmail.com\nType of change\n\nBugfix\n\nDescription\nIn nightlies we can see that in KafkaST if the testDeployKafkaClusterViaTemplate fails the template resources are not properly deleted, so I added the deletion for whole template and all pods with openshift name. The test failure and the skip of deletion caused that whole KafkaST was failing, so it ran again. This will (hopefully) fix this problem.\nSecond problem was with KafkaConnect topic deletion, where the CONNECT_TOPIC was bind to the connector created in the test, so the right after the .withPropagationPolicy(DeletionPropagation.FOREGROUND).delete() was executed, topic was recreated. So I changed the order of resource creation and removed the unnecessary deletions and waits, as this is done by ResourceManager\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-09-01T11:02:51Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579", "merged": true, "mergeCommit": {"oid": "2ae5f1313ecd83ffb502d4c9e61744a348251d91"}, "closed": true, "closedAt": "2020-09-03T13:58:01Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEmwrvAFqTQ3OTY5OTUzOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFNCa8AH2gAyNDc3MDAxMTUwOjdiNDlkNTg4ZDkyNDBlNTA3M2QxMzFlMTJjMGM3ODVlNDgwNTg3Zjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5Njk5NTM5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#pullrequestreview-479699539", "createdAt": "2020-09-01T12:40:31Z", "commit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjo0MDozMVrOHK0Z_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjo0MjoxOVrOHK0eAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNjQzMA==", "bodyText": "why it's global constant if it's used in one test?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#discussion_r481106430", "createdAt": "2020-09-01T12:40:31Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java", "diffHunk": "@@ -106,40 +106,39 @@\n class KafkaST extends AbstractST {\n \n     private static final Logger LOGGER = LogManager.getLogger(KafkaST.class);\n-\n+    private static final String TEMPLATE_PATH = TestUtils.USER_PATH + \"/../examples/templates/cluster-operator\";\n     public static final String NAMESPACE = \"kafka-cluster-test\";\n+    private static final String OPENSHIFT_CLUSTER_NAME = \"openshift-my-cluster\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNjUyMw==", "bodyText": "why it's global constant if it's used in one test?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#discussion_r481106523", "createdAt": "2020-09-01T12:40:40Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java", "diffHunk": "@@ -106,40 +106,39 @@\n class KafkaST extends AbstractST {\n \n     private static final Logger LOGGER = LogManager.getLogger(KafkaST.class);\n-\n+    private static final String TEMPLATE_PATH = TestUtils.USER_PATH + \"/../examples/templates/cluster-operator\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNzQ1Nw==", "bodyText": "Why is this moved from the one scenario where everything is deployed (and deleted) to afterEach?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#discussion_r481107457", "createdAt": "2020-09-01T12:42:19Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java", "diffHunk": "@@ -1957,6 +1956,14 @@ void setup() throws Exception {\n     @Override\n     protected void tearDownEnvironmentAfterEach() throws Exception {\n         super.tearDownEnvironmentAfterEach();\n+        if (cluster.getListOfDeployedResources().contains(TEMPLATE_PATH)) {\n+            cluster.deleteCustomResources(TEMPLATE_PATH);\n+        }\n+\n+        kubeClient().listPods().stream()\n+            .filter(p -> p.getMetadata().getName().startsWith(OPENSHIFT_CLUSTER_NAME))\n+            .forEach(p -> PodUtils.deletePodWithWait(p.getMetadata().getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NzIxMDMz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#pullrequestreview-479721033", "createdAt": "2020-09-01T13:06:30Z", "commit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20e0e1e85ad127203aa8db716803bf338379b366", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/20e0e1e85ad127203aa8db716803bf338379b366", "committedDate": "2020-09-01T16:55:19Z", "message": "fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDU0MTg3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#pullrequestreview-480054187", "createdAt": "2020-09-01T19:31:23Z", "commit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDU5MjQz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#pullrequestreview-480059243", "createdAt": "2020-09-01T19:39:13Z", "commit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3045a6815ca90ca772a6df6110a7753e6a9180b2", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3045a6815ca90ca772a6df6110a7753e6a9180b2", "committedDate": "2020-09-02T10:51:27Z", "message": "fixup! fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "251bc74eda2e3bc365bf0e3d249451b50a8fd209", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/251bc74eda2e3bc365bf0e3d249451b50a8fd209", "committedDate": "2020-09-01T10:55:01Z", "message": "fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}, "afterCommit": {"oid": "3045a6815ca90ca772a6df6110a7753e6a9180b2", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3045a6815ca90ca772a6df6110a7753e6a9180b2", "committedDate": "2020-09-02T10:51:27Z", "message": "fixup! fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwODMyMjcw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#pullrequestreview-480832270", "createdAt": "2020-09-02T13:42:55Z", "commit": {"oid": "3045a6815ca90ca772a6df6110a7753e6a9180b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjIxNjEz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3579#pullrequestreview-481221613", "createdAt": "2020-09-02T19:19:39Z", "commit": {"oid": "3045a6815ca90ca772a6df6110a7753e6a9180b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b49d588d9240e5073d131e12c0c785e480587f7", "author": {"user": {"login": "im-konge", "name": "Luk\u00e1\u0161 Kr\u00e1l"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7b49d588d9240e5073d131e12c0c785e480587f7", "committedDate": "2020-09-03T09:18:16Z", "message": "fixup! fixup! fixes\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 915, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}