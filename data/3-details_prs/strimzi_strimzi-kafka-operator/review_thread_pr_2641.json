{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNDEwNjY1", "number": 2641, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0NjozN1rODk9LUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToxNTozOVrODlFW3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc3NjUwOnYy", "diffSide": "LEFT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0NjozN1rOFxkXnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMTozMjoyN1rOFxpw2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDQxMw==", "bodyText": "This case of the zip entry being a directory is no longer handled.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387520413", "createdAt": "2020-03-04T08:46:37Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU4MDMwOA==", "bodyText": "So you propose to make something like that\n               if (entry.isDirectory()) {\n                    LOGGER.info(\"Entry is not directory...?\");\n                    file.mkdirs();\n                } else {\n                    try (FileOutputStream fout = new FileOutputStream(file)) {\n                        while ((len = zin.read(buffer)) != -1) {\n                            fout.write(buffer, 0, len);\n                        }\n                    }\n                }\n\nWhat actually file.mkdirs(); will do?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387580308", "createdAt": "2020-03-04T10:35:34Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDQxMw=="}, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU4NzAxNQ==", "bodyText": "There's this thing called Javadoc, you really should check it out \ud83d\ude09... It will create directories which don't exist. mkdir() (singular) will just create a single dir, failing if the parent doesn't exist. mkdirs() will create parent (and all the way up, as necessary).\nThe truth is that malformed zips are not unheard of (e.g. missing directory entries, or directory entries after file entries in that directory), so you probably should mkdirs(file.getParentFile()) even in the else block.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387587015", "createdAt": "2020-03-04T10:47:44Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDQxMw=="}, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwODc5Mw==", "bodyText": "Thanks for the exlanation and sorry for stupid question...Anyway i come up with the following sollution on this problem based on https://stackoverflow.com/questions/27904329/warning-file-mkdir-is-ignored", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387608793", "createdAt": "2020-03-04T11:32:27Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDQxMw=="}, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc3ODQ3OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0NzoxNlrOFxkY0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDozNzowOVrOFxoFEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDcyMw==", "bodyText": "I guess we should fix the captialization NameSpace \u2192 Namespace", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387520723", "createdAt": "2020-03-04T08:47:16Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU4MTIwMA==", "bodyText": "make sense )", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387581200", "createdAt": "2020-03-04T10:37:09Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMDcyMw=="}, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc4MjQyOnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0ODozNlrOFxkbRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0ODozNlrOFxkbRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTM1MA==", "bodyText": "Wrapping into a RuntimeException is preferred, because it's much less easily overlooked.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521350", "createdAt": "2020-03-04T08:48:36Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             BufferedReader br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+             OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8)){\n \n-        try {\n-            bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n             StringBuilder sb = new StringBuilder();\n-            br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+\n             String read;\n             while ((read = br.readLine()) != null) {\n-                sb.append(read + \"\\n\");\n+                sb.append(read);\n+                sb.append(\"\\n\");\n             }\n-            br.close();\n             String yaml = sb.toString();\n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n             yaml = yaml.replace(\"securityContext:\\n\" +\n                 \"        runAsNonRoot: true\\n\" +\n                 \"        runAsUser: 65534\", \"\");\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile;\n \n         } catch (IOException e) {\n             e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc4MzQ5OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0OTowMVrOFxkcAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0OTowMVrOFxkcAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTUzNg==", "bodyText": "I don't think you need the ;", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521536", "createdAt": "2020-03-04T08:49:01Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             BufferedReader br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+             OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8)){\n \n-        try {\n-            bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n             StringBuilder sb = new StringBuilder();\n-            br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+\n             String read;\n             while ((read = br.readLine()) != null) {\n-                sb.append(read + \"\\n\");\n+                sb.append(read);\n+                sb.append(\"\\n\");\n             }\n-            br.close();\n             String yaml = sb.toString();\n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n             yaml = yaml.replace(\"securityContext:\\n\" +\n                 \"        runAsNonRoot: true\\n\" +\n                 \"        runAsUser: 65534\", \"\");\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile;\n \n         } catch (IOException e) {\n             e.printStackTrace();\n-        } finally {\n-            if (bais != null) {\n-                try {\n-                    bais.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (br != null) {\n-                try {\n-                    br.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (osw != null) {\n-                try {\n-                    osw.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n         }\n         return null;\n     }\n \n-    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) {\n+    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) throws IOException {\n         byte[] encoded;\n-        OutputStreamWriter osw = null;\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n \n-        try {\n+        try (OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 129}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc4NDYzOnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0OToyNFrOFxkcwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0OToyNFrOFxkcwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTczMA==", "bodyText": "Again, throw a RuntimeException", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521730", "createdAt": "2020-03-04T08:49:24Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n     public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             ZipInputStream zin = new ZipInputStream(bais)){\n+\n+            File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n+                try (FileOutputStream fout = new FileOutputStream(file)) {\n                     while ((len = zin.read(buffer)) != -1) {\n                         fout.write(buffer, 0, len);\n                     }\n-                    fout.close();\n                 }\n                 entry = zin.getNextEntry();\n             }\n         } catch (IOException e) {\n             LOGGER.error(\"IOException {}\", e.getMessage());\n-        } finally {\n-            if (fout != null) {\n-                try {\n-                    fout.close();\n-                } catch (IOException e) {\n-                    LOGGER.error(\"IOException {}\", e.getMessage());\n-                }\n-            }\n-            if (zin != null) {\n-                try {\n-                    zin.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n         }\n-        return dir;\n+        return null;\n     }\n \n-    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) {\n-        InputStream bais = null;\n-        BufferedReader br = null;\n-        OutputStreamWriter osw = null;\n+    public static File downloadYamlAndReplaceNameSpace(String url, String namespace) throws IOException {\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+             BufferedReader br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+             OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8)){\n \n-        try {\n-            bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n             StringBuilder sb = new StringBuilder();\n-            br = new BufferedReader(new InputStreamReader(bais, StandardCharsets.UTF_8));\n+\n             String read;\n             while ((read = br.readLine()) != null) {\n-                sb.append(read + \"\\n\");\n+                sb.append(read);\n+                sb.append(\"\\n\");\n             }\n-            br.close();\n             String yaml = sb.toString();\n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n             yaml = yaml.replace(\"securityContext:\\n\" +\n                 \"        runAsNonRoot: true\\n\" +\n                 \"        runAsUser: 65534\", \"\");\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile;\n \n         } catch (IOException e) {\n             e.printStackTrace();\n-        } finally {\n-            if (bais != null) {\n-                try {\n-                    bais.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (br != null) {\n-                try {\n-                    br.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n-            if (osw != null) {\n-                try {\n-                    osw.close();\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-\n         }\n         return null;\n     }\n \n-    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) {\n+    public static File updateNamespaceOfYamlFile(String pathToOrigin, String namespace) throws IOException {\n         byte[] encoded;\n-        OutputStreamWriter osw = null;\n+        File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n \n-        try {\n+        try (OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);) {\n             encoded = Files.readAllBytes(Paths.get(pathToOrigin));\n \n             String yaml = new String(encoded, StandardCharsets.UTF_8);\n             yaml = yaml.replaceAll(\"namespace: .*\", \"namespace: \" + namespace);\n \n-            File yamlFile = File.createTempFile(\"temp-file\", \".yaml\");\n-            osw = new OutputStreamWriter(new FileOutputStream(yamlFile), StandardCharsets.UTF_8);\n             osw.write(yaml);\n-            osw.close();\n             return yamlFile.toPath().toFile();\n         } catch (IOException e) {\n             e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc4NTQ2OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0OTo0MFrOFxkdRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMTozMzoyNlrOFxpyfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTg2Mg==", "bodyText": "Is this still needed?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387521862", "createdAt": "2020-03-04T08:49:40Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwOTIxNA==", "bodyText": "I have changed that now i will use return value from file.mkdirs() so it is not longer needed.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387609214", "createdAt": "2020-03-04T11:33:26Z", "author": {"login": "see-quick"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -30,132 +30,73 @@ private FileUtils() { }\n \n     @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMTg2Mg=="}, "originalCommit": {"oid": "0f9a318517fd8f17907f5fe5b2ee97337d1b40aa"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjExNjc3OnYy", "diffSide": "RIGHT", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToxNTozOVrOFxxTEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToxNTozOVrOFxxTEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczMjI0MQ==", "bodyText": "file is a filename in a temp directory you just created, so it wouldn't normally exist. I think you want something like this:\nif (entry.isDirectory()) {\n    if (file.exists()) {\n        if (!file.isDirectory()) {\n            throw new IOException(\"Malformed zip file\");\n        }\n    } else {\n        if (!file.mkdirs()) {\n            throw new IOException(\"Could not create directory \" + file);\n        }\n    }\n} else {\n    file.getParentFile().mkdirs(); // create parent; in case zip file is malformed\n    try (FileOutputStream fout = new FileOutputStream(file)) {\n    while ((len = zin.read(buffer)) != -1) {\n        fout.write(buffer, 0, len);\n    }\n}\nYou could have similar logic for the 2nd mkdirs() as for the first (and maybe factor into a maybeCreateDirectory() method).", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2641#discussion_r387732241", "createdAt": "2020-03-04T15:15:39Z", "author": {"login": "tombentley"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/FileUtils.java", "diffHunk": "@@ -28,134 +28,82 @@\n \n     private FileUtils() { }\n \n-    @SuppressFBWarnings(\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\")\n-    public static File downloadAndUnzip(String url) {\n-        File dir = null;\n-        FileOutputStream fout = null;\n-        ZipInputStream zin = null;\n-        try {\n-            InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n-            dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+    @SuppressFBWarnings(\"RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE\")\n+    public static File downloadAndUnzip(String url) throws IOException {\n+        File dir = Files.createTempDirectory(FileUtils.class.getName()).toFile();\n+\n+        try (InputStream bais = (InputStream) URI.create(url).toURL().openConnection().getContent();\n+            ZipInputStream zin = new ZipInputStream(bais)) {\n+\n             dir.deleteOnExit();\n-            zin = new ZipInputStream(bais);\n+\n             ZipEntry entry = zin.getNextEntry();\n             byte[] buffer = new byte[8 * 1024];\n             int len;\n             while (entry != null) {\n                 File file = new File(dir, entry.getName());\n-                if (entry.isDirectory()) {\n-                    file.mkdirs();\n-                } else {\n-                    fout = new FileOutputStream(file);\n-                    while ((len = zin.read(buffer)) != -1) {\n-                        fout.write(buffer, 0, len);\n+                boolean isDirectoryCreated = file.exists();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f76abcfacff676143b2ecae20f0de70110aad8"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 522, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}