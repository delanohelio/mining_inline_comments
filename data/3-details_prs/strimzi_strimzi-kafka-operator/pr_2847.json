{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0NzUwMzU1", "number": 2847, "title": "[systemtest] Fix failing tests", "bodyText": "Signed-off-by: Lukas Kral lkral@redhat.com\nType of change\n\nBugfix\n\nDescription\nThis PR will fix these tests:\ntestRemoveUserAndTopicOperatorsFromEntityOperator - test waited for pod deletion with bad name\ntestCustomCertLoadBalancerAndTlsRollingUpdate - asserts with bad message counts\ntestJvmAndResources - update test - before changes were all `-D` and -`X..` options in env`STRIMZI_JAVA_SYSTEM_PROPERTIES`, now it's moved like this: `-D` opt in `STRIMZI_JAVA_SYSTEM_PROPERTIES` and `-X..` options in `STRIMZI_JAVA_OPTS`\n\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-04-16T21:27:16Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847", "merged": true, "mergeCommit": {"oid": "0b4e5a776a93e45d95f781f9d6bd2037ea589ab9"}, "closed": true, "closedAt": "2020-04-17T22:58:47Z", "author": {"login": "im-konge"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYTuXJAFqTM5NTAxNTEzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYoD85gBqjMyNDYwMTk5MDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDE1MTM1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#pullrequestreview-395015135", "createdAt": "2020-04-16T21:33:36Z", "commit": {"oid": "6a60954136a74d08a187807d42868edb4f058c90"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMTozMzozN1rOGG39Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMTozODozOVrOGG4GYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg2MTQ2Ng==", "bodyText": "Why 5 times?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#discussion_r409861466", "createdAt": "2020-04-16T21:33:37Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/kafka/ListenersST.java", "diffHunk": "@@ -657,12 +657,15 @@ void testCustomCertLoadBalancerAndTlsRollingUpdate() throws Exception {\n         );\n \n         internalKafkaClient.setConsumerGroup(\"consumer-group-certs-71\");\n-        internalKafkaClient.setMessageCount(MESSAGE_COUNT * 3);\n+        internalKafkaClient.setMessageCount(MESSAGE_COUNT);\n \n         sent = internalKafkaClient.sendMessagesTls();\n-        assertThat(sent, is(3 * MESSAGE_COUNT));\n+        assertThat(sent, is(MESSAGE_COUNT));\n+\n+        internalKafkaClient.setMessageCount(MESSAGE_COUNT * 5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a60954136a74d08a187807d42868edb4f058c90"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg2Mzc3Nw==", "bodyText": "Wouldn't it be better to check this list size in waitForPodDeletion() ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#discussion_r409863777", "createdAt": "2020-04-16T21:38:39Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1009,34 +1018,31 @@ void testRemoveUserAndTopicOperatorsFromEntityOperator() {\n         timeMeasuringSystem.setOperationID(timeMeasuringSystem.startTimeMeasuring(Operation.CLUSTER_DEPLOYMENT));\n         KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3).done();\n \n-        String eoPodName = kubeClient().listPodsByPrefixInName(KafkaResources.entityOperatorDeploymentName(CLUSTER_NAME))\n-                .get(0).getMetadata().getName();\n+        String eoDeploymentName = KafkaResources.entityOperatorDeploymentName(CLUSTER_NAME);\n \n         KafkaResource.replaceKafkaResource(CLUSTER_NAME, k -> {\n-            EntityOperatorSpec entityOperatorSpec = k.getSpec().getEntityOperator();\n-            entityOperatorSpec.setTopicOperator(null);\n-            entityOperatorSpec.setUserOperator(null);\n-            k.getSpec().setEntityOperator(entityOperatorSpec);\n+            k.getSpec().getEntityOperator().setTopicOperator(null);\n+            k.getSpec().getEntityOperator().setUserOperator(null);\n         });\n \n         //Waiting when EO pod will be deleted\n-        DeploymentUtils.waitForDeploymentDeletion(KafkaResources.entityOperatorDeploymentName(CLUSTER_NAME));\n-        ReplicaSetUtils.waitForReplicaSetDeletion(KafkaResources.entityOperatorDeploymentName(CLUSTER_NAME));\n-        PodUtils.waitForPodDeletion(eoPodName);\n+        DeploymentUtils.waitForDeploymentDeletion(eoDeploymentName);\n+        ReplicaSetUtils.waitForReplicaSetDeletion(eoDeploymentName);\n \n+        if (kubeClient().listPodsByPrefixInName(eoDeploymentName).size() != 0) {\n+            PodUtils.waitForPodDeletion(kubeClient().listPodsByPrefixInName(eoDeploymentName).get(0).getMetadata().getName());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a60954136a74d08a187807d42868edb4f058c90"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDM0NDAw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#pullrequestreview-395034400", "createdAt": "2020-04-16T22:09:57Z", "commit": {"oid": "6a60954136a74d08a187807d42868edb4f058c90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzY3NTAy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#pullrequestreview-395367502", "createdAt": "2020-04-17T11:14:47Z", "commit": {"oid": "5d37b93f4678f98acf1e0efd7566b137a320f458"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Mzk4MDE1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#pullrequestreview-395398015", "createdAt": "2020-04-17T12:10:02Z", "commit": {"oid": "5d37b93f4678f98acf1e0efd7566b137a320f458"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjoxMDowM1rOGHLbCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjoxMDowM1rOGHLbCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4MDM2Mw==", "bodyText": "this assert can be written just one time outside of the if(s), it's common to both.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#discussion_r410180363", "createdAt": "2020-04-17T12:10:03Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -845,12 +845,21 @@ void testJvmAndResources() {\n         kubeClient().getPod(eoPod).getSpec().getContainers().forEach(container -> {\n             if (!container.getName().equals(\"tls-sidecar\")) {\n                 LOGGER.info(\"Check if -D java options are present in {}\", container.getName());\n-                String value = container.getEnv().stream().filter(envVar ->\n-                        envVar.getName().equals(\"STRIMZI_JAVA_SYSTEM_PROPERTIES\")).findFirst().get().getValue();\n-                if (container.getName().equals(\"topic-operator\"))\n-                    assertThat(value, is(\"-Xms1024M -Xmx2G -Djavax.net.debug=verbose\"));\n-                if (container.getName().equals(\"user-operator\"))\n-                    assertThat(value, is(\"-Xms512M -Xmx1G -Djavax.net.debug=verbose\"));\n+\n+                String javaSystemProp = container.getEnv().stream().filter(envVar ->\n+                    envVar.getName().equals(\"STRIMZI_JAVA_SYSTEM_PROPERTIES\")).findFirst().get().getValue();\n+                String javaOpts = container.getEnv().stream().filter(envVar ->\n+                    envVar.getName().equals(\"STRIMZI_JAVA_OPTS\")).findFirst().get().getValue();\n+\n+                if (container.getName().equals(\"topic-operator\")) {\n+                    assertThat(javaSystemProp, is(\"-Djavax.net.debug=verbose\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d37b93f4678f98acf1e0efd7566b137a320f458"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52433b003606372d4c8ff411007b23178b6510dd", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/52433b003606372d4c8ff411007b23178b6510dd", "committedDate": "2020-04-17T12:47:27Z", "message": "fix failing tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8a7a6862df0ae8be750190b9f5b680493e2b94", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3d8a7a6862df0ae8be750190b9f5b680493e2b94", "committedDate": "2020-04-17T12:47:27Z", "message": "another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feeecb5efaefaaa396747a5ae6b8c0149c2d4a12", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/feeecb5efaefaaa396747a5ae6b8c0149c2d4a12", "committedDate": "2020-04-17T12:47:27Z", "message": "fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8618116a5c35eadefa3ee00e12494940cfc14120", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8618116a5c35eadefa3ee00e12494940cfc14120", "committedDate": "2020-04-17T12:47:27Z", "message": "fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d37b93f4678f98acf1e0efd7566b137a320f458", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5d37b93f4678f98acf1e0efd7566b137a320f458", "committedDate": "2020-04-17T11:09:42Z", "message": "fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}, "afterCommit": {"oid": "8618116a5c35eadefa3ee00e12494940cfc14120", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8618116a5c35eadefa3ee00e12494940cfc14120", "committedDate": "2020-04-17T12:47:27Z", "message": "fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDQxNDIw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2847#pullrequestreview-395441420", "createdAt": "2020-04-17T13:14:00Z", "commit": {"oid": "0ea09e9a3419fadeb4dd4ddd55589396ed9f4bdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ea09e9a3419fadeb4dd4ddd55589396ed9f4bdf", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0ea09e9a3419fadeb4dd4ddd55589396ed9f4bdf", "committedDate": "2020-04-17T13:09:40Z", "message": "fixup! fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}, "afterCommit": {"oid": "8a7907c845052f8d1b023ac8d8b7c736cafe1c79", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8a7907c845052f8d1b023ac8d8b7c736cafe1c79", "committedDate": "2020-04-17T20:33:08Z", "message": "fixup! fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05dcbd160edb27980ad20ba251116f757cf2206d", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/05dcbd160edb27980ad20ba251116f757cf2206d", "committedDate": "2020-04-17T21:20:24Z", "message": "fixup! fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a7907c845052f8d1b023ac8d8b7c736cafe1c79", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8a7907c845052f8d1b023ac8d8b7c736cafe1c79", "committedDate": "2020-04-17T20:33:08Z", "message": "fixup! fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}, "afterCommit": {"oid": "05dcbd160edb27980ad20ba251116f757cf2206d", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/05dcbd160edb27980ad20ba251116f757cf2206d", "committedDate": "2020-04-17T21:20:24Z", "message": "fixup! fixup! fixup! another one\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1883, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}