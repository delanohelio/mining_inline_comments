{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NTM1Nzcx", "number": 3919, "title": "Fix issue preventing the jmxtrans container from becoming ready", "bodyText": "Signed-off-by: John Beaven beavenj@uk.ibm.com\nType of change\n\nBugfix\n\nDescription\nFix the readiness check. The 'nc -z' does not return a value\nin either success or fail cases so you have to examine the\nresponse code in $?. As it stands, the test assumes that not\nhaving a value on the response indicates a connection failure.\nThis fix switches back to testing the value in $? as it was\nin the previous version and that allowed the container to\nstart when we tested it.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-11-04T17:31:10Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919", "merged": true, "mergeCommit": {"oid": "762d2b33027abc4211ad4d5c97e9e440a41fe6e9"}, "closed": true, "closedAt": "2020-11-05T16:22:39Z", "author": {"login": "beavenj"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZRBn1AH2gAyNTE1NTM1NzcxOmQxZDQ0Mzk1NTc3ODUzYzcwNDk0NWVlNjJjZjM3NTAxZTVkMWY1NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZk0WJAFqTUyNDQzMTIzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d1d44395577853c704945ee62cf37501e5d1f56a", "author": {"user": {"login": "beavenj", "name": "John Beaven"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d1d44395577853c704945ee62cf37501e5d1f56a", "committedDate": "2020-11-04T17:15:30Z", "message": "Fix the readiness check. The 'nc -z' does not return a value\nin either success or fail cases so you have to examine the\nreponse code in $?. As it stands, the test assumes that not\nhaving a value on the response indicates a connection failure.\nThis fix switches back to testing the value in $? as it was\nin the previous version.\n\nSigned-off-by: John Beaven <beavenj@uk.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzE1NzY4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#pullrequestreview-523715768", "createdAt": "2020-11-04T20:36:09Z", "commit": {"oid": "d1d44395577853c704945ee62cf37501e5d1f56a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzE2NDI4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#pullrequestreview-523716428", "createdAt": "2020-11-04T20:37:10Z", "commit": {"oid": "d1d44395577853c704945ee62cf37501e5d1f56a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDozNzoxMFrOHto0ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDozNzoxMFrOHto0ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxNjc5OA==", "bodyText": "The code looks good, but there seem to be some ShellCheck comments:\nif [ \"$?\" -ne 0 ]; then\n     ^--^ SC2181: Check exit code directly with e.g. 'if mycmd;', not indirectly with $?.\n\nCould you have a look at it?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#discussion_r517616798", "createdAt": "2020-11-04T20:37:10Z", "author": {"login": "scholzj"}, "path": "docker-images/jmxtrans/jmxtrans_readiness_check.sh", "diffHunk": "@@ -14,7 +14,8 @@ else\n     export KAFKA_METRICS_PORT=\"$2\"\n fi\n \n-if nc -z \"$KAFKA_HEADLESS_SERVICE\" \"$KAFKA_METRICS_PORT\"; then\n+nc -z \"$KAFKA_HEADLESS_SERVICE\" \"$KAFKA_METRICS_PORT\"\n+if [ \"$?\" -ne 0 ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1d44395577853c704945ee62cf37501e5d1f56a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c84536006882544c079e6a0691f3a45e39b5ff3", "author": {"user": {"login": "beavenj", "name": "John Beaven"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6c84536006882544c079e6a0691f3a45e39b5ff3", "committedDate": "2020-11-05T13:17:24Z", "message": "Adjusting to comply with the approach ShellCheck recommends\n\nSigned-off-by: John Beaven <beavenj@uk.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NDMxMjM4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#pullrequestreview-524431238", "createdAt": "2020-11-05T16:19:06Z", "commit": {"oid": "6c84536006882544c079e6a0691f3a45e39b5ff3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 883, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}