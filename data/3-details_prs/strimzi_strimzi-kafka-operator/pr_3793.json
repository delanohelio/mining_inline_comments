{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNjU3NDEx", "number": 3793, "title": "[Enhancement] ClusterCaCert - Pass labels to secrets", "bodyText": "Type of change\n\nEnhancement\n\nDescription\nIt would be useful to define annotations on cluster ca certificate, which will be passed/copied to the secrets created by the operator.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-10-12T15:39:02Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793", "merged": true, "mergeCommit": {"oid": "bdee3355fef26aefe54cf2b79449639d6fb8c2e7"}, "closed": true, "closedAt": "2020-10-22T10:03:36Z", "author": {"login": "javiercri"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR13-DgBqjM4NjcyMjQ3NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUtsfvgFqTUxMzcwODA0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e930b2ce06ff17ae03747238929768b6085f6eb", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1e930b2ce06ff17ae03747238929768b6085f6eb", "committedDate": "2020-10-12T15:36:11Z", "message": "[[Enhancement] ClusterCaCert - Pass labels to secrets]"}, "afterCommit": {"oid": "9a995c89e3242a686f2a44be121c9492d4fc926f", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9a995c89e3242a686f2a44be121c9492d4fc926f", "committedDate": "2020-10-12T15:39:39Z", "message": "[[Enhancement] ClusterCaCert - Pass labels to secrets]\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODU1MzM2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793#pullrequestreview-507855336", "createdAt": "2020-10-13T21:52:55Z", "commit": {"oid": "9a995c89e3242a686f2a44be121c9492d4fc926f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMTo1Mjo1NVrOHg60DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMTo1NTowN1rOHg63_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI4MDA3Ng==", "bodyText": "Could you use individual imports instead of this as it was before?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793#discussion_r504280076", "createdAt": "2020-10-13T21:52:55Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/assembly/KafkaAssemblyOperator.java", "diffHunk": "@@ -142,9 +143,7 @@\n import static io.strimzi.operator.cluster.model.KafkaConfiguration.INTERBROKER_PROTOCOL_VERSION;\n import static io.strimzi.operator.cluster.model.KafkaConfiguration.LOG_MESSAGE_FORMAT_VERSION;\n import static io.strimzi.operator.cluster.model.KafkaVersion.compareDottedVersions;\n-import static java.util.Collections.emptyList;\n-import static java.util.Collections.singletonList;\n-import static java.util.Collections.singletonMap;\n+import static java.util.Collections.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a995c89e3242a686f2a44be121c9492d4fc926f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI4MTA4NA==", "bodyText": "I'm not sure this works. First, it might run thousand times because of the parametrized test. So it would be better to add this to some of the existing tests and to the parameters. Also, this actually doesn't test the result. You set it up,  but you never compare the annotations and labels on the secrets.\nI will think how to fix the test / or where to run it to make it better.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793#discussion_r504281084", "createdAt": "2020-10-13T21:55:07Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaAssemblyOperatorTest.java", "diffHunk": "@@ -352,6 +354,33 @@ public void testCreateClusterWithJmxEnabled(Params params, VertxTestContext cont\n                 )); //getInitialCertificates(getKafkaAssembly(\"foo\").getMetadata().getName()));\n     }\n \n+    @ParameterizedTest\n+    @MethodSource(\"data\")\n+    public void testCreateClusterWithAnnotationsAndLabelsInCaCertSecret(Params params, VertxTestContext context) {\n+        setFields(params);\n+        Kafka kafka = getKafkaAssembly(\"foo\");\n+        kafka.getSpec()\n+                .getKafka()\n+                .setTemplate(new KafkaClusterTemplateBuilder()\n+                        .withClusterCaCert(\n+                                new ResourceTemplateBuilder()\n+                                        .withNewMetadata()\n+                                        .withLabels(Collections.singletonMap(\"foo\", \"bar\"))\n+                                        .withAnnotations(Collections.singletonMap(\"foo\", \"bar\"))\n+                                        .endMetadata()\n+                                        .build())\n+                        .build());\n+\n+        createCluster(context, kafka, Collections.singletonList(new SecretBuilder()\n+                .withNewMetadata()\n+                .withName(KafkaCluster.jmxSecretName(\"foo\"))\n+                .withNamespace(\"test\")\n+                .endMetadata()\n+                .withData(Collections.singletonMap(\"foo\", \"bar\"))\n+                .build()\n+        ));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a995c89e3242a686f2a44be121c9492d4fc926f"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b1363526818e25236a4136530e79f5c281d85ce", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2b1363526818e25236a4136530e79f5c281d85ce", "committedDate": "2020-10-19T21:40:22Z", "message": "[[Enhancement] ClusterCaCert - Pass labels to secrets]\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "927ef25e826f4365c7db2c6fbe879bfd20a9b610", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/927ef25e826f4365c7db2c6fbe879bfd20a9b610", "committedDate": "2020-10-19T21:40:22Z", "message": "Add a better test\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5da90ef5fe54ef45594624308388805fccb9f140", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5da90ef5fe54ef45594624308388805fccb9f140", "committedDate": "2020-10-19T21:40:22Z", "message": "Remove test and fix import comments\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b52f08456173fd660aa95fcad49f5cfded9d4f5b", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b52f08456173fd660aa95fcad49f5cfded9d4f5b", "committedDate": "2020-10-19T21:40:22Z", "message": "Remove unused import\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f0afd567c18b29d2eb2dbbf93dcd074f1641ace", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0f0afd567c18b29d2eb2dbbf93dcd074f1641ace", "committedDate": "2020-10-19T21:31:59Z", "message": "Remove unused import"}, "afterCommit": {"oid": "b52f08456173fd660aa95fcad49f5cfded9d4f5b", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b52f08456173fd660aa95fcad49f5cfded9d4f5b", "committedDate": "2020-10-19T21:40:22Z", "message": "Remove unused import\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3717239b8eff587712a1f332117bf8c375be6091", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3717239b8eff587712a1f332117bf8c375be6091", "committedDate": "2020-10-20T09:37:00Z", "message": "Checktype validate correctly\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07dabafae930761a201171728c7a12d3c72dbc68", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/07dabafae930761a201171728c7a12d3c72dbc68", "committedDate": "2020-10-20T09:36:39Z", "message": "Checktype validate correctly"}, "afterCommit": {"oid": "3717239b8eff587712a1f332117bf8c375be6091", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3717239b8eff587712a1f332117bf8c375be6091", "committedDate": "2020-10-20T09:37:00Z", "message": "Checktype validate correctly\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "501efd05de7e11539396d636d3ae3a747449686d", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/501efd05de7e11539396d636d3ae3a747449686d", "committedDate": "2020-10-20T10:38:03Z", "message": "FIX kafka assembly null when template is null\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88263cebfaf9b8f29b2819722aa3657851f8957c", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/88263cebfaf9b8f29b2819722aa3657851f8957c", "committedDate": "2020-10-20T10:37:37Z", "message": "FIX kafka assembly null when template is null"}, "afterCommit": {"oid": "501efd05de7e11539396d636d3ae3a747449686d", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/501efd05de7e11539396d636d3ae3a747449686d", "committedDate": "2020-10-20T10:38:03Z", "message": "FIX kafka assembly null when template is null\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee650e9a88af7a54ceb7aa1a6688d48d985f6e40", "author": {"user": null}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ee650e9a88af7a54ceb7aa1a6688d48d985f6e40", "committedDate": "2020-10-20T14:07:27Z", "message": "FIX checkstyle again\n\nSigned-off-by: javiercri <javier.criado@masmovil.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "270627abcecb403970a43ede833dd2e783f52629", "author": {"user": {"login": "scholzj", "name": "Jakub Scholz"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/270627abcecb403970a43ede833dd2e783f52629", "committedDate": "2020-10-20T15:32:25Z", "message": "Update derived resources\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTE1MTYy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793#pullrequestreview-512915162", "createdAt": "2020-10-20T16:22:04Z", "commit": {"oid": "270627abcecb403970a43ede833dd2e783f52629"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjkyNzkz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793#pullrequestreview-513692793", "createdAt": "2020-10-21T13:39:20Z", "commit": {"oid": "270627abcecb403970a43ede833dd2e783f52629"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNzA4MDQ5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3793#pullrequestreview-513708049", "createdAt": "2020-10-21T13:50:03Z", "commit": {"oid": "270627abcecb403970a43ede833dd2e783f52629"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 794, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}