{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMTIwMjE0", "number": 2710, "title": "fix: Allow MM2 cluster with empty tls property", "bodyText": "Type of change\nSelect the type of your PR\n\nBugfix\n\nDescription\n\nThis PR updates the MirrorMaker 2.0 assembly operator to support\nclusters with empty tls properties (i.e. no trustedCertificates list).\nThis allows the MM2 operator to connect to clusters that use SSL without\nrequiring the server certificates. For example:\n\napiVersion: kafka.strimzi.io/v1alpha1\nkind: KafkaMirrorMaker2\nmetadata:\n  name: my-cluster\nspec:\n  clusters:\n  - alias: on-cloud\n    bootstrapServers: broker-0.server.com:9093,broker-1.server.com:9093,broker-2.server.com:9093,\n    tls: {}\n    config:\n      ssl.endpoint.identification.algorithm: https\n    authentication:\n      passwordSecret:\n        secretName: my-cluster-oncloud-api-secret\n        password: password\n      username: token\n      type: plain\n...\n\nWithout this fix the above CR causes the following exception:\n2020-03-17 15:56:26,017 ERROR Modification time of key store could not be obtained: /tmp/kafka/clusters/on-cloud.truststore.p12 (org.apache.kafka.common.security.ssl.SslEngineBuilder) [creating internal topics]\njava.nio.file.NoSuchFileException: /tmp/kafka/clusters/on-cloud.truststore.p12\n\tat sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n\tat sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)\n\tat sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:144)\n\tat sun.nio.fs.LinuxFileSystemProvider.readAttributes(LinuxFileSystemProvider.java:99)\n\tat java.nio.file.Files.readAttributes(Files.java:1737)\n\tat java.nio.file.Files.getLastModifiedTime(Files.java:2266)\n\tat org.apache.kafka.common.security.ssl.SslEngineBuilder$SecurityStore.lastModifiedMs(SslEngineBuilder.java:298)\n\tat org.apache.kafka.common.security.ssl.SslEngineBuilder$SecurityStore.<init>(SslEngineBuilder.java:275)\n\tat org.apache.kafka.common.security.ssl.SslEngineBuilder.createTruststore(SslEngineBuilder.java:182)\n\tat org.apache.kafka.common.security.ssl.SslEngineBuilder.<init>(SslEngineBuilder.java:100)\n\tat org.apache.kafka.common.security.ssl.SslFactory.configure(SslFactory.java:95)\n\tat org.apache.kafka.common.network.SaslChannelBuilder.configure(SaslChannelBuilder.java:154)\n\tat org.apache.kafka.common.network.ChannelBuilders.create(ChannelBuilders.java:146)\n\tat org.apache.kafka.common.network.ChannelBuilders.clientChannelBuilder(ChannelBuilders.java:67)\n\tat org.apache.kafka.clients.ClientUtils.createChannelBuilder(ClientUtils.java:99)\n\tat org.apache.kafka.clients.admin.KafkaAdminClient.createInternal(KafkaAdminClient.java:426)\n\tat org.apache.kafka.clients.admin.Admin.create(Admin.java:69)\n\tat org.apache.kafka.connect.util.TopicAdmin.<init>(TopicAdmin.java:169)\n\tat org.apache.kafka.connect.mirror.MirrorUtils.createCompactedTopic(MirrorUtils.java:108)\n\tat org.apache.kafka.connect.mirror.MirrorUtils.createSinglePartitionCompactedTopic(MirrorUtils.java:114)\n\tat org.apache.kafka.connect.mirror.MirrorCheckpointConnector.createInternalTopics(MirrorCheckpointConnector.java:149)\n\n\nIt also fixes the Tini warning seen in the MM2 pod logs by exec'ing\nthe call to start Kafka Connect:\n\n[WARN  tini (41)] Tini is not running as PID 1 and isn't registered as\na child subreaper. Zombie processes will not be re-parented to Tini, so\nzombie reaping won't work\n\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n[ x ] Make sure all tests pass\n[ x ] Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally", "createdAt": "2020-03-17T22:57:31Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2710", "merged": true, "mergeCommit": {"oid": "1ec5e1f0326e311f1111e2c9ba2ad4dcb6b90a67"}, "closed": true, "closedAt": "2020-03-18T11:28:58Z", "author": {"login": "ajborley"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOquUxAH2gAyMzkwMTIwMjE0OmM4MTk5ZmZmZmIyMDAwZjcyODIxY2M4MGY5ZjJkYzY3ODhmYmFkNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO1PokAFqTM3Njc1OTcwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c8199ffffb2000f72821cc80f9f2dc6788fbad47", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c8199ffffb2000f72821cc80f9f2dc6788fbad47", "committedDate": "2020-03-17T22:47:38Z", "message": "fix: Allow MM2 cluster with empty tls property\n\n - This commit updates the MirrorMaker 2.0 assembly operator to support\ncluster with empty tls properties (i.e. no trustedCertificates list).\nThis allows the MM2 operator to connect to clusters that use SSL without\nrequiring the server certificates.\n - It also fixes the Tini warning seen in the MM2 pod logs by exec'ing\nthe call to start Kafka Connect:\n```\n[WARN  tini (41)] Tini is not running as PID 1 and isn't registered as\na child subreaper. Zombie processes will not be re-parented to Tini, so\nzombie reaping won't work\n```\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDYyMTEx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2710#pullrequestreview-376462111", "createdAt": "2020-03-17T23:00:19Z", "commit": {"oid": "c8199ffffb2000f72821cc80f9f2dc6788fbad47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjE0NzI0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2710#pullrequestreview-376614724", "createdAt": "2020-03-18T07:24:32Z", "commit": {"oid": "c8199ffffb2000f72821cc80f9f2dc6788fbad47"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNzoyNDozMlrOF3404A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNzoyNDozMlrOF3404A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE0NzA0MA==", "bodyText": "No tini?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2710#discussion_r394147040", "createdAt": "2020-03-18T07:24:32Z", "author": {"login": "tombentley"}, "path": "docker-images/kafka/scripts/kafka_mirror_maker_2_run.sh", "diffHunk": "@@ -63,4 +63,4 @@ if [ -n \"$STRIMZI_JAVA_SYSTEM_PROPERTIES\" ]; then\n     export KAFKA_OPTS=\"${KAFKA_OPTS} ${STRIMZI_JAVA_SYSTEM_PROPERTIES}\"\n fi\n \n-./kafka_connect_run.sh\n+exec ./kafka_connect_run.sh", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8199ffffb2000f72821cc80f9f2dc6788fbad47"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjcwNzQ5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2710#pullrequestreview-376670749", "createdAt": "2020-03-18T09:01:21Z", "commit": {"oid": "c8199ffffb2000f72821cc80f9f2dc6788fbad47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzU5NzAx", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2710#pullrequestreview-376759701", "createdAt": "2020-03-18T11:03:04Z", "commit": {"oid": "c8199ffffb2000f72821cc80f9f2dc6788fbad47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2067, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}