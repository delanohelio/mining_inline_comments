{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3ODQ0MzM4", "number": 3224, "title": "Switch to using yq version 3.3.1+", "bodyText": "Type of change\nRefactor\nDescription\nUpgrade the yq version to 3.3.1+ as this fixes issues with yaml indentation and other formatting issues. This will change the formatting of the generated helm files and other yaml.\nVersions of yq after 3.3.1 change the output of the --version command to go to STDERR instead of STDOUT (see yq issue 472). This causes the current prerequisites-check.sh script to fail. This PR makes so that either STDOUT or STDERR are captured. It also adds multi-platform support to the prerequistes-check.sh.", "createdAt": "2020-06-22T10:30:12Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224", "merged": true, "mergeCommit": {"oid": "4b192a8995485174d62d185d9605b423474e036a"}, "closed": true, "closedAt": "2020-06-25T09:41:41Z", "author": {"login": "tomncooper"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctuXSygFqTQzNDgwMDA0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuq_pkAFqTQzNzMxMDg0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODAwMDQ3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#pullrequestreview-434800047", "createdAt": "2020-06-22T10:32:36Z", "commit": {"oid": "e7aac11617bddc9fa28b88a4307a3e66747defc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDozMjozNlrOGm7B2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDozMjozNlrOGm7B2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ2NjIwMg==", "bodyText": "Thsi should probably use the GREP from the multi-platform-support.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#discussion_r443466202", "createdAt": "2020-06-22T10:32:36Z", "author": {"login": "scholzj"}, "path": "prerequisites-check.sh", "diffHunk": "@@ -13,7 +16,12 @@ check_command_present git\n check_command_present docker\n \n YQ_VERSION=\"$(yq --version | ${SED} 's/^.* //g')\"\n+# After version 3.3.1, yq --version sends the string to STDERR instead of STDOUT\n+if [ -z \"$YQ_VERSION\" ]; then\n+    YQ_VERSION=\"$(yq --version 2> >(grep -Po '\\d.\\d.\\d'))\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7aac11617bddc9fa28b88a4307a3e66747defc7"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7aac11617bddc9fa28b88a4307a3e66747defc7", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e7aac11617bddc9fa28b88a4307a3e66747defc7", "committedDate": "2020-06-22T10:26:15Z", "message": "Fix yq version check in prerequisties-check\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "50fe782d2a3fb6d383d355cca522078788c027df", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/50fe782d2a3fb6d383d355cca522078788c027df", "committedDate": "2020-06-22T14:16:49Z", "message": "Fix yq version check in prerequisties-check\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MTg5ODk0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#pullrequestreview-435189894", "createdAt": "2020-06-22T18:53:34Z", "commit": {"oid": "50fe782d2a3fb6d383d355cca522078788c027df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50fe782d2a3fb6d383d355cca522078788c027df", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/50fe782d2a3fb6d383d355cca522078788c027df", "committedDate": "2020-06-22T14:16:49Z", "message": "Fix yq version check in prerequisties-check\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "b53f49c5844db12aebc9d28cfb81a05222bd6577", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b53f49c5844db12aebc9d28cfb81a05222bd6577", "committedDate": "2020-06-23T10:22:53Z", "message": "Recreated helm charts with yq 3.3.1\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2deffbc32d416a4f2697d50366234f9bd9c41fc5", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2deffbc32d416a4f2697d50366234f9bd9c41fc5", "committedDate": "2020-06-23T10:28:02Z", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "4ec31209e56f71c91a8fe637b1e833c4c636e494", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4ec31209e56f71c91a8fe637b1e833c4c636e494", "committedDate": "2020-06-23T10:30:29Z", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ec31209e56f71c91a8fe637b1e833c4c636e494", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4ec31209e56f71c91a8fe637b1e833c4c636e494", "committedDate": "2020-06-23T10:30:29Z", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "59e5c4bc708a6487c3620a0c70df3551854d7f27", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59e5c4bc708a6487c3620a0c70df3551854d7f27", "committedDate": "2020-06-23T10:41:52Z", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTg4MDUw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#pullrequestreview-436588050", "createdAt": "2020-06-24T12:15:02Z", "commit": {"oid": "d90d6bd73f136d576388ee84dfa5be9bd75ebc35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMjoxNTowMlrOGoPfpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMjoxNTowMlrOGoPfpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg1MDA4NQ==", "bodyText": "Do we still need to be able to handle both 3.3.1 as well as the previous versions on line 18? Or could we just remove it?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#discussion_r444850085", "createdAt": "2020-06-24T12:15:02Z", "author": {"login": "scholzj"}, "path": "prerequisites-check.sh", "diffHunk": "@@ -13,7 +16,22 @@ check_command_present git\n check_command_present docker\n \n YQ_VERSION=\"$(yq --version | ${SED} 's/^.* //g')\"\n-if [[ ${YQ_VERSION} != \"3.\"* ]]; then\n-  echo -e \"${RED}yq vesion is ${YQ_VERSION}, version must be 3.*${NO_COLOUR}\"\n+# After version 3.3.1, yq --version sends the string to STDERR instead of STDOUT\n+if [ -z \"$YQ_VERSION\" ]; then\n+    YQ_VERSION=\"$(yq --version 2> >($GREP -Po '\\d.\\d.\\d'))\"\n+fi\n+\n+yq_array=($(echo \"$YQ_VERSION\" | tr '.' '\\n'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d90d6bd73f136d576388ee84dfa5be9bd75ebc35"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTkwMjY2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#pullrequestreview-436590266", "createdAt": "2020-06-24T12:18:21Z", "commit": {"oid": "d90d6bd73f136d576388ee84dfa5be9bd75ebc35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2489235b58f094f739a573d14f4353b866935ae0", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2489235b58f094f739a573d14f4353b866935ae0", "committedDate": "2020-06-24T15:14:14Z", "message": "Switch to using yq version 3.3.1 and mandate in prerequisties check\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "853151a18b082a9fac7b6a20b902797d10017e0d", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/853151a18b082a9fac7b6a20b902797d10017e0d", "committedDate": "2020-06-24T15:14:20Z", "message": "Recreated helm charts with yq 3.3.1\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcb5965eae59105114a933c3795083e20da68049", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/dcb5965eae59105114a933c3795083e20da68049", "committedDate": "2020-06-24T15:14:20Z", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a851dd0c4dca5d33f246cfacd91fc8bf24aeee3c", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a851dd0c4dca5d33f246cfacd91fc8bf24aeee3c", "committedDate": "2020-06-24T15:14:20Z", "message": "Updated cluster roles\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bae12b326c02decbde09d6f0cccb19eed21985a", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3bae12b326c02decbde09d6f0cccb19eed21985a", "committedDate": "2020-06-24T15:14:20Z", "message": "Update Jenkins pipeline\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d90d6bd73f136d576388ee84dfa5be9bd75ebc35", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d90d6bd73f136d576388ee84dfa5be9bd75ebc35", "committedDate": "2020-06-24T09:18:02Z", "message": "Update Jenkins pipeline\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "3bae12b326c02decbde09d6f0cccb19eed21985a", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3bae12b326c02decbde09d6f0cccb19eed21985a", "committedDate": "2020-06-24T15:14:20Z", "message": "Update Jenkins pipeline\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MzA2NzQ4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#pullrequestreview-437306748", "createdAt": "2020-06-25T09:06:36Z", "commit": {"oid": "3bae12b326c02decbde09d6f0cccb19eed21985a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MzEwODQ1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#pullrequestreview-437310845", "createdAt": "2020-06-25T09:12:08Z", "commit": {"oid": "3bae12b326c02decbde09d6f0cccb19eed21985a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1585, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}