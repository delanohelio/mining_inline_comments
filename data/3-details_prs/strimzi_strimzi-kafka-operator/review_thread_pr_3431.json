{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYxMzg3NTUx", "number": 3431, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwOTozOTozNFrOEUXYjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODoyMTo0NVrOEUgx-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NzkwMDkyOnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwOTozOTozNFrOG6ju3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQwOTozOTozNFrOG6ju3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1NjAyOQ==", "bodyText": "I think this might cause issues if in the future someone adds something to the spec in the initial block and doesn't notice this overrides the whole spec. Maybe you could use here editOrNewSpec instead of withNewSpec", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464056029", "createdAt": "2020-08-02T09:39:34Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "diffHunk": "@@ -545,16 +545,27 @@ public static KafkaBridge createKafkaBridgeCluster(String clusterCmNamespace, St\n     /**\n      * Generate empty Kafka MirrorMaker 2.0 ConfigMap\n      */\n-    public static KafkaMirrorMaker2 createEmptyKafkaMirrorMaker2Cluster(String clusterCmNamespace, String clusterCmName) {\n-        return new KafkaMirrorMaker2Builder()\n+    public static KafkaMirrorMaker2 createEmptyKafkaMirrorMaker2Cluster(String clusterCmNamespace, String clusterCmName, Integer replicas) {\n+        KafkaMirrorMaker2Builder kafkaMirrorMaker2Builder = new KafkaMirrorMaker2Builder()\n                 .withMetadata(new ObjectMetaBuilder()\n                         .withName(clusterCmName)\n                         .withNamespace(clusterCmNamespace)\n                         .withLabels(TestUtils.map(Labels.KUBERNETES_DOMAIN + \"part-of\", \"tests\",\n                                 \"my-user-label\", \"cromulent\"))\n-                        .build())\n-                .withNewSpec().endSpec()\n-                .build();\n+                        .build());\n+\n+        if (replicas != null) {\n+            kafkaMirrorMaker2Builder\n+                    .withNewSpec()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1cea8f8c745c6590deff71edfc9a0ffbbc6ceb"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NzkyMDY1OnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDowNjoxNFrOG6j4cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDowNzoyN1rOG6j4sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1ODQ4Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                .withNewSpec()\n          \n          \n            \n                                    .withReplicas(replicas)\n          \n          \n            \n                                .endSpec();\n          \n          \n            \n                                .editOrNewSpec()\n          \n          \n            \n                                    .withReplicas(replicas)\n          \n          \n            \n                                .endSpec();\n          \n      \n    \n    \n  \n\nAs Jakub suggests", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464058483", "createdAt": "2020-08-02T10:06:14Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "diffHunk": "@@ -545,16 +545,27 @@ public static KafkaBridge createKafkaBridgeCluster(String clusterCmNamespace, St\n     /**\n      * Generate empty Kafka MirrorMaker 2.0 ConfigMap\n      */\n-    public static KafkaMirrorMaker2 createEmptyKafkaMirrorMaker2Cluster(String clusterCmNamespace, String clusterCmName) {\n-        return new KafkaMirrorMaker2Builder()\n+    public static KafkaMirrorMaker2 createEmptyKafkaMirrorMaker2Cluster(String clusterCmNamespace, String clusterCmName, Integer replicas) {\n+        KafkaMirrorMaker2Builder kafkaMirrorMaker2Builder = new KafkaMirrorMaker2Builder()\n                 .withMetadata(new ObjectMetaBuilder()\n                         .withName(clusterCmName)\n                         .withNamespace(clusterCmNamespace)\n                         .withLabels(TestUtils.map(Labels.KUBERNETES_DOMAIN + \"part-of\", \"tests\",\n                                 \"my-user-label\", \"cromulent\"))\n-                        .build())\n-                .withNewSpec().endSpec()\n-                .build();\n+                        .build());\n+\n+        if (replicas != null) {\n+            kafkaMirrorMaker2Builder\n+                    .withNewSpec()\n+                        .withReplicas(replicas)\n+                    .endSpec();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1cea8f8c745c6590deff71edfc9a0ffbbc6ceb"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1ODU0NQ==", "bodyText": "The difference being that withNewSpec overrides, whereas edit or new, edits a pre-existing spec if it exists, or creates a new one if it doesn't.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464058545", "createdAt": "2020-08-02T10:07:27Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/ResourceUtils.java", "diffHunk": "@@ -545,16 +545,27 @@ public static KafkaBridge createKafkaBridgeCluster(String clusterCmNamespace, St\n     /**\n      * Generate empty Kafka MirrorMaker 2.0 ConfigMap\n      */\n-    public static KafkaMirrorMaker2 createEmptyKafkaMirrorMaker2Cluster(String clusterCmNamespace, String clusterCmName) {\n-        return new KafkaMirrorMaker2Builder()\n+    public static KafkaMirrorMaker2 createEmptyKafkaMirrorMaker2Cluster(String clusterCmNamespace, String clusterCmName, Integer replicas) {\n+        KafkaMirrorMaker2Builder kafkaMirrorMaker2Builder = new KafkaMirrorMaker2Builder()\n                 .withMetadata(new ObjectMetaBuilder()\n                         .withName(clusterCmName)\n                         .withNamespace(clusterCmNamespace)\n                         .withLabels(TestUtils.map(Labels.KUBERNETES_DOMAIN + \"part-of\", \"tests\",\n                                 \"my-user-label\", \"cromulent\"))\n-                        .build())\n-                .withNewSpec().endSpec()\n-                .build();\n+                        .build());\n+\n+        if (replicas != null) {\n+            kafkaMirrorMaker2Builder\n+                    .withNewSpec()\n+                        .withReplicas(replicas)\n+                    .endSpec();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1ODQ4Mw=="}, "originalCommit": {"oid": "de1cea8f8c745c6590deff71edfc9a0ffbbc6ceb"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NzkyMzAyOnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDowOTo1OFrOG6j5nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDowOTo1OFrOG6j5nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1ODc4MA==", "bodyText": "clusterCm is a relic of the past, from when the custom resource was actually a configmap, I planned to remove all references of this at some point, but there are stilla few left over.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String clusterCmName = \"foo\";\n          \n          \n            \n                    String kmm2Name = \"foo\";", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464058780", "createdAt": "2020-08-02T10:09:58Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "diffHunk": "@@ -644,4 +644,86 @@ public void testCreateClusterStatusNotReady(VertxTestContext context) {\n             })));\n     }\n \n+\n+    @Test\n+    public void testCreateClusterWithZeroReplicas(VertxTestContext context) {\n+        ResourceOperatorSupplier supplier = ResourceUtils.supplierWithMocks(true);\n+        CrdOperator mockMirrorMaker2Ops = supplier.mirrorMaker2Operator;\n+        DeploymentOperator mockDcOps = supplier.deploymentOperations;\n+        PodDisruptionBudgetOperator mockPdbOps = supplier.podDisruptionBudgetOperator;\n+        ConfigMapOperator mockCmOps = supplier.configMapOperations;\n+        ServiceOperator mockServiceOps = supplier.serviceOperations;\n+        NetworkPolicyOperator mockNetPolOps = supplier.networkPolicyOperator;\n+\n+        String clusterCmName = \"foo\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1cea8f8c745c6590deff71edfc9a0ffbbc6ceb"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NzkyMzIzOnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDoxMDoyMVrOG6j5tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDoxMDoyMVrOG6j5tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1ODgwNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String clusterCmNamespace = \"test\";\n          \n          \n            \n                    String kmm2Namespace = \"test\";", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464058807", "createdAt": "2020-08-02T10:10:21Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "diffHunk": "@@ -644,4 +644,86 @@ public void testCreateClusterStatusNotReady(VertxTestContext context) {\n             })));\n     }\n \n+\n+    @Test\n+    public void testCreateClusterWithZeroReplicas(VertxTestContext context) {\n+        ResourceOperatorSupplier supplier = ResourceUtils.supplierWithMocks(true);\n+        CrdOperator mockMirrorMaker2Ops = supplier.mirrorMaker2Operator;\n+        DeploymentOperator mockDcOps = supplier.deploymentOperations;\n+        PodDisruptionBudgetOperator mockPdbOps = supplier.podDisruptionBudgetOperator;\n+        ConfigMapOperator mockCmOps = supplier.configMapOperations;\n+        ServiceOperator mockServiceOps = supplier.serviceOperations;\n+        NetworkPolicyOperator mockNetPolOps = supplier.networkPolicyOperator;\n+\n+        String clusterCmName = \"foo\";\n+        String clusterCmNamespace = \"test\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1cea8f8c745c6590deff71edfc9a0ffbbc6ceb"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NzkyNDI3OnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDoxMTo0NFrOG6j6MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMDoxMTo0NFrOG6j6MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA1ODkyOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    KafkaMirrorMaker2 clusterCm = ResourceUtils.createEmptyKafkaMirrorMaker2Cluster(clusterCmNamespace, clusterCmName, 0);\n          \n          \n            \n                    KafkaMirrorMaker2 kmm2 = ResourceUtils.createEmptyKafkaMirrorMaker2Cluster(clusterCmNamespace, clusterCmName, 0);", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464058928", "createdAt": "2020-08-02T10:11:44Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "diffHunk": "@@ -644,4 +644,86 @@ public void testCreateClusterStatusNotReady(VertxTestContext context) {\n             })));\n     }\n \n+\n+    @Test\n+    public void testCreateClusterWithZeroReplicas(VertxTestContext context) {\n+        ResourceOperatorSupplier supplier = ResourceUtils.supplierWithMocks(true);\n+        CrdOperator mockMirrorMaker2Ops = supplier.mirrorMaker2Operator;\n+        DeploymentOperator mockDcOps = supplier.deploymentOperations;\n+        PodDisruptionBudgetOperator mockPdbOps = supplier.podDisruptionBudgetOperator;\n+        ConfigMapOperator mockCmOps = supplier.configMapOperations;\n+        ServiceOperator mockServiceOps = supplier.serviceOperations;\n+        NetworkPolicyOperator mockNetPolOps = supplier.networkPolicyOperator;\n+\n+        String clusterCmName = \"foo\";\n+        String clusterCmNamespace = \"test\";\n+        KafkaMirrorMaker2 clusterCm = ResourceUtils.createEmptyKafkaMirrorMaker2Cluster(clusterCmNamespace, clusterCmName, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de1cea8f8c745c6590deff71edfc9a0ffbbc6ceb"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTQzNDA3OnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODoxOTo1OFrOG6wWsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODoxOTo1OFrOG6wWsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI2MjgzNA==", "bodyText": "As with most of the other resources - can we make sure that the URL is listed only when it can be used? (i.e. when replicas > 0)?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464262834", "createdAt": "2020-08-03T08:19:58Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "diffHunk": "@@ -644,4 +644,86 @@ public void testCreateClusterStatusNotReady(VertxTestContext context) {\n             })));\n     }\n \n+\n+    @Test\n+    public void testCreateClusterWithZeroReplicas(VertxTestContext context) {\n+        ResourceOperatorSupplier supplier = ResourceUtils.supplierWithMocks(true);\n+        CrdOperator mockMirrorMaker2Ops = supplier.mirrorMaker2Operator;\n+        DeploymentOperator mockDcOps = supplier.deploymentOperations;\n+        PodDisruptionBudgetOperator mockPdbOps = supplier.podDisruptionBudgetOperator;\n+        ConfigMapOperator mockCmOps = supplier.configMapOperations;\n+        ServiceOperator mockServiceOps = supplier.serviceOperations;\n+        NetworkPolicyOperator mockNetPolOps = supplier.networkPolicyOperator;\n+\n+        String kmm2Name = \"foo\";\n+        String kmm2Namespace = \"test\";\n+        KafkaMirrorMaker2 kmm2 = ResourceUtils.createEmptyKafkaMirrorMaker2Cluster(kmm2Namespace, kmm2Name, 0);\n+\n+        when(mockMirrorMaker2Ops.get(kmm2Namespace, kmm2Name)).thenReturn(kmm2);\n+        when(mockMirrorMaker2Ops.getAsync(anyString(), anyString())).thenReturn(Future.succeededFuture(kmm2));\n+\n+        ArgumentCaptor<Service> serviceCaptor = ArgumentCaptor.forClass(Service.class);\n+        when(mockServiceOps.reconcile(anyString(), anyString(), serviceCaptor.capture())).thenReturn(Future.succeededFuture());\n+\n+        ArgumentCaptor<Deployment> dcCaptor = ArgumentCaptor.forClass(Deployment.class);\n+        when(mockDcOps.reconcile(anyString(), anyString(), dcCaptor.capture())).thenReturn(Future.succeededFuture());\n+        when(mockDcOps.scaleUp(anyString(), anyString(), anyInt())).thenReturn(Future.succeededFuture(42));\n+        when(mockDcOps.scaleDown(anyString(), anyString(), anyInt())).thenReturn(Future.succeededFuture(42));\n+        when(mockDcOps.readiness(anyString(), anyString(), anyLong(), anyLong())).thenReturn(Future.succeededFuture());\n+        when(mockDcOps.waitForObserved(anyString(), anyString(), anyLong(), anyLong())).thenReturn(Future.succeededFuture());\n+        when(mockCmOps.reconcile(anyString(), any(), any())).thenReturn(Future.succeededFuture(ReconcileResult.created(new ConfigMap())));\n+        when(mockNetPolOps.reconcile(eq(kmm2.getMetadata().getNamespace()), eq(KafkaMirrorMaker2Resources.deploymentName(kmm2.getMetadata().getName())), any())).thenReturn(Future.succeededFuture(ReconcileResult.created(new NetworkPolicy())));\n+\n+        ArgumentCaptor<PodDisruptionBudget> pdbCaptor = ArgumentCaptor.forClass(PodDisruptionBudget.class);\n+        when(mockPdbOps.reconcile(anyString(), any(), pdbCaptor.capture())).thenReturn(Future.succeededFuture());\n+\n+        ArgumentCaptor<KafkaMirrorMaker2> mirrorMaker2Captor = ArgumentCaptor.forClass(KafkaMirrorMaker2.class);\n+        when(mockMirrorMaker2Ops.updateStatusAsync(mirrorMaker2Captor.capture())).thenReturn(Future.succeededFuture());\n+\n+        KafkaConnectApi mockConnectClient = mock(KafkaConnectApi.class);\n+        when(mockConnectClient.list(anyString(), anyInt())).thenReturn(Future.succeededFuture(emptyList()));\n+\n+        KafkaMirrorMaker2AssemblyOperator ops = new KafkaMirrorMaker2AssemblyOperator(vertx, new PlatformFeaturesAvailability(true, kubernetesVersion),\n+                supplier, ResourceUtils.dummyClusterOperatorConfig(VERSIONS), x -> mockConnectClient);\n+\n+        KafkaMirrorMaker2Cluster mirrorMaker2 = KafkaMirrorMaker2Cluster.fromCrd(kmm2, VERSIONS);\n+\n+        Checkpoint async = context.checkpoint();\n+        ops.createOrUpdate(new Reconciliation(\"test-trigger\", KafkaMirrorMaker2.RESOURCE_KIND, kmm2Namespace, kmm2Name), kmm2)\n+                .onComplete(context.succeeding(v -> context.verify(() -> {\n+\n+                    // Verify service\n+                    List<Service> capturedServices = serviceCaptor.getAllValues();\n+                    assertThat(capturedServices, hasSize(1));\n+                    Service service = capturedServices.get(0);\n+                    assertThat(service.getMetadata().getName(), is(mirrorMaker2.getServiceName()));\n+                    assertThat(service, is(mirrorMaker2.generateService()));\n+\n+                    // Verify Deployment\n+                    List<Deployment> capturedDc = dcCaptor.getAllValues();\n+                    assertThat(capturedDc, hasSize(1));\n+                    Deployment dc = capturedDc.get(0);\n+                    assertThat(dc.getMetadata().getName(), is(mirrorMaker2.getName()));\n+                    Map<String, String> annotations = new HashMap<>();\n+                    annotations.put(Annotations.STRIMZI_LOGGING_ANNOTATION, LOGGING_CONFIG);\n+                    assertThat(dc, is(mirrorMaker2.generateDeployment(annotations, true, null, null)));\n+\n+                    // Verify PodDisruptionBudget\n+                    List<PodDisruptionBudget> capturedPdb = pdbCaptor.getAllValues();\n+                    assertThat(capturedPdb, hasSize(1));\n+                    PodDisruptionBudget pdb = capturedPdb.get(0);\n+                    assertThat(pdb.getMetadata().getName(), is(mirrorMaker2.getName()));\n+                    assertThat(pdb, is(mirrorMaker2.generatePodDisruptionBudget()));\n+\n+                    // Verify status\n+                    List<KafkaMirrorMaker2> capturedMirrorMaker2s = mirrorMaker2Captor.getAllValues();\n+                    assertThat(capturedMirrorMaker2s.get(0).getStatus().getUrl(), is(\"http://foo-mirrormaker2-api.test.svc:8083\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "818c86ecc87c69fc2ca0b1638ba37faa0659ce5d"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTQ0MDU2OnYy", "diffSide": "RIGHT", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODoyMTo0NVrOG6waeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODoyMTo0NVrOG6waeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI2MzgwMg==", "bodyText": "I think this will make sure that the readiness always returns true. This is why this test is passing even without any code changes. I think we need to remove this and fix the code.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3431#discussion_r464263802", "createdAt": "2020-08-03T08:21:45Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaMirrorMaker2AssemblyOperatorTest.java", "diffHunk": "@@ -644,4 +644,86 @@ public void testCreateClusterStatusNotReady(VertxTestContext context) {\n             })));\n     }\n \n+\n+    @Test\n+    public void testCreateClusterWithZeroReplicas(VertxTestContext context) {\n+        ResourceOperatorSupplier supplier = ResourceUtils.supplierWithMocks(true);\n+        CrdOperator mockMirrorMaker2Ops = supplier.mirrorMaker2Operator;\n+        DeploymentOperator mockDcOps = supplier.deploymentOperations;\n+        PodDisruptionBudgetOperator mockPdbOps = supplier.podDisruptionBudgetOperator;\n+        ConfigMapOperator mockCmOps = supplier.configMapOperations;\n+        ServiceOperator mockServiceOps = supplier.serviceOperations;\n+        NetworkPolicyOperator mockNetPolOps = supplier.networkPolicyOperator;\n+\n+        String kmm2Name = \"foo\";\n+        String kmm2Namespace = \"test\";\n+        KafkaMirrorMaker2 kmm2 = ResourceUtils.createEmptyKafkaMirrorMaker2Cluster(kmm2Namespace, kmm2Name, 0);\n+\n+        when(mockMirrorMaker2Ops.get(kmm2Namespace, kmm2Name)).thenReturn(kmm2);\n+        when(mockMirrorMaker2Ops.getAsync(anyString(), anyString())).thenReturn(Future.succeededFuture(kmm2));\n+\n+        ArgumentCaptor<Service> serviceCaptor = ArgumentCaptor.forClass(Service.class);\n+        when(mockServiceOps.reconcile(anyString(), anyString(), serviceCaptor.capture())).thenReturn(Future.succeededFuture());\n+\n+        ArgumentCaptor<Deployment> dcCaptor = ArgumentCaptor.forClass(Deployment.class);\n+        when(mockDcOps.reconcile(anyString(), anyString(), dcCaptor.capture())).thenReturn(Future.succeededFuture());\n+        when(mockDcOps.scaleUp(anyString(), anyString(), anyInt())).thenReturn(Future.succeededFuture(42));\n+        when(mockDcOps.scaleDown(anyString(), anyString(), anyInt())).thenReturn(Future.succeededFuture(42));\n+        when(mockDcOps.readiness(anyString(), anyString(), anyLong(), anyLong())).thenReturn(Future.succeededFuture());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "818c86ecc87c69fc2ca0b1638ba37faa0659ce5d"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1225, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}