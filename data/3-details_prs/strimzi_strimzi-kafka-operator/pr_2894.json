{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4ODc1NzI5", "number": 2894, "title": "ST: Update zk upgrade tests to run upgrade/downgrade for all versions", "bodyText": "Signed-off-by: Jakub Stejskal xstejs24@gmail.com\nType of change\n\nEnhancement / new feature\n\nDescription\nThis PR update zookeeper + kafka upgrade tests to run upgrade/downgrade for all versions defined in kafka-versions.yaml. I also included fix for waitUntilPodsStability. This method actually didn't check the stability of specific pods, but only wait for several seconds, because list of pods wasn't updated in the method.\nChecklist\n\n Make sure all tests pass", "createdAt": "2020-04-25T09:05:32Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894", "merged": true, "mergeCommit": {"oid": "3ce7c435cf24186bc92ec279e70e7f330ea7fb5b"}, "closed": true, "closedAt": "2020-04-27T20:09:46Z", "author": {"login": "Frawless"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbCPqGgH2gAyNDA4ODc1NzI5OmY1NGEyMmEyNTU4NDlmYmQxZjVmZjc3NDRjZmVlMDRkMzhjOTA1ZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcby7yuAFqTQwMTE4MTUwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f54a22a255849fbd1f5ff7744cfee04d38c905ef", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f54a22a255849fbd1f5ff7744cfee04d38c905ef", "committedDate": "2020-04-25T08:58:57Z", "message": "Update zk upgrade tests to run upgrade/downgrade for all versions\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f95e67d8ec2de4362f1cbd4ec43ae48a92ddba1f", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f95e67d8ec2de4362f1cbd4ec43ae48a92ddba1f", "committedDate": "2020-04-25T12:51:43Z", "message": "add debug info\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8bd591e60094630cfb6d4986331cffdabe886c9", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d8bd591e60094630cfb6d4986331cffdabe886c9", "committedDate": "2020-04-25T13:33:03Z", "message": "Remove reversing the list which is not working properly on jenkins\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15ccbff7777ffc6e4dc21055faae0c487684d450", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/15ccbff7777ffc6e4dc21055faae0c487684d450", "committedDate": "2020-04-25T14:36:17Z", "message": "fixup! Remove reversing the list which is not working properly on jenkins\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a28435837c317ffdf44405692301063ec9b2442", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4a28435837c317ffdf44405692301063ec9b2442", "committedDate": "2020-04-25T14:51:11Z", "message": "fixup! fixup! Remove reversing the list which is not working properly on jenkins\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa7faf3a0b9dea45d08d5763e0057bffd0787fc", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8aa7faf3a0b9dea45d08d5763e0057bffd0787fc", "committedDate": "2020-04-25T18:38:36Z", "message": "fixup! fixup! fixup! Remove reversing the list which is not working properly on jenkins\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f38ad2050712d3a64fdd44cefeace6beadcece57", "committedDate": "2020-04-27T06:30:33Z", "message": "fixup! fixup! fixup! fixup! Remove reversing the list which is not working properly on jenkins\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzY1NTQ1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#pullrequestreview-400765545", "createdAt": "2020-04-27T09:10:20Z", "commit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwODAwOTk3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#pullrequestreview-400800997", "createdAt": "2020-04-27T09:57:29Z", "commit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTo1NzoyOVrOGMa2YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTo1NzoyOVrOGMa2YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3NjAwMQ==", "bodyText": "Just a minor question. Why are you using an int[] here instead of just an int. You only ever refer to the first cell of the array and don't use the array outside of the lambda given to waitFor. Not saying you should change it, just interested why?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#discussion_r415676001", "createdAt": "2020-04-27T09:57:29Z", "author": {"login": "tomncooper"}, "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kubeUtils/objects/PodUtils.java", "diffHunk": "@@ -243,13 +243,16 @@ public static void waitUntilPodsStability(List<Pod> pods) {\n \n         TestUtils.waitFor(\"Pods stability\", Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_TIMEOUT,\n             () -> {\n-                for (Pod pod : pods) {\n+                List<Pod> actualPods = pods.stream().map(p -> kubeClient().getPod(p.getMetadata().getName())).collect(Collectors.toList());\n+\n+                for (Pod pod : actualPods) {\n                     if (pod.getStatus().getPhase().equals(\"Running\")) {\n                         LOGGER.info(\"Pod {} is in the {} state. Remaining seconds pod to be stable {}\",\n                             pod.getMetadata().getName(), pod.getStatus().getPhase(),\n                             Constants.GLOBAL_RECONCILIATION_COUNT - stabilityCounter[0]);\n                     } else {\n                         LOGGER.info(\"Pod {} is not stable with phase {}\", pod.getMetadata().getName(), pod.getStatus().getPhase());\n+                        stabilityCounter[0] = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwODAzNjY1", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#pullrequestreview-400803665", "createdAt": "2020-04-27T10:00:57Z", "commit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwODEwNDMz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#pullrequestreview-400810433", "createdAt": "2020-04-27T10:10:20Z", "commit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMDoxMDoyMFrOGMbXrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMDoxMDoyMFrOGMbXrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4NDUyNA==", "bodyText": "Should this be sameMinorVersion?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#discussion_r415684524", "createdAt": "2020-04-27T10:10:20Z", "author": {"login": "scholzj"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -66,16 +71,34 @@ void runVersionChange(TestKafkaVersion initialVersion, TestKafkaVersion newVersi\n             logMsgFormat = newVersion.messageVersion();\n         }\n \n-        LOGGER.info(\"Deploying initial Kafka version (\" + initialVersion.version() + \")\");\n+        boolean sameMajorVersion = initialVersion.protocolVersion().equals(newVersion.protocolVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwODk3OTk5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#pullrequestreview-400897999", "createdAt": "2020-04-27T12:22:22Z", "commit": {"oid": "f38ad2050712d3a64fdd44cefeace6beadcece57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7adf03c2910f80d37b6aff43119bd66bec27d717", "author": {"user": {"login": "Frawless", "name": "Jakub Stejskal"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7adf03c2910f80d37b6aff43119bd66bec27d717", "committedDate": "2020-04-27T13:21:08Z", "message": "fixup! fixup! fixup! fixup! fixup! Remove reversing the list which is not working properly on jenkins\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTgxNTAw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2894#pullrequestreview-401181500", "createdAt": "2020-04-27T17:42:36Z", "commit": {"oid": "7adf03c2910f80d37b6aff43119bd66bec27d717"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1956, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}