{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NjE4OTgz", "number": 3858, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzoyODo1M1rOExFfpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozOToxNlrOExFtBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA1NzAyOnYy", "diffSide": "RIGHT", "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzoyODo1M1rOHnB7JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNzo0MzozNlrOHnXcEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY4ODAzNg==", "bodyText": "The above HashMap size should be 2.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510688036", "createdAt": "2020-10-23T07:28:53Z", "author": {"login": "ppatierno"}, "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "diffHunk": "@@ -158,7 +159,8 @@ public Secret generateSecret()  {\n             return createSecret(data);\n         } else if (authentication instanceof KafkaUserScramSha512ClientAuthentication) {\n             Map<String, String> data = new HashMap<>(1);\n-            data.put(KafkaUserModel.KEY_PASSWORD, Base64.getEncoder().encodeToString(scramSha512Password.getBytes(StandardCharsets.US_ASCII)));\n+            data.put(KafkaUserModel.KEY_PASSWORD, Base64.getEncoder().encodeToString(this.scramSha512Password.getBytes(StandardCharsets.US_ASCII)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA0MDUzMQ==", "bodyText": "The HashMap size should be updated now with the last commit, together with docs and tests changes that you mentioned in other comments.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r511040531", "createdAt": "2020-10-23T17:43:36Z", "author": {"login": "allanmoso"}, "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "diffHunk": "@@ -158,7 +159,8 @@ public Secret generateSecret()  {\n             return createSecret(data);\n         } else if (authentication instanceof KafkaUserScramSha512ClientAuthentication) {\n             Map<String, String> data = new HashMap<>(1);\n-            data.put(KafkaUserModel.KEY_PASSWORD, Base64.getEncoder().encodeToString(scramSha512Password.getBytes(StandardCharsets.US_ASCII)));\n+            data.put(KafkaUserModel.KEY_PASSWORD, Base64.getEncoder().encodeToString(this.scramSha512Password.getBytes(StandardCharsets.US_ASCII)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY4ODAzNg=="}, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA1ODU4OnYy", "diffSide": "RIGHT", "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzoyOToxOVrOHnB8IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzoyOToxOVrOHnB8IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY4ODI4OQ==", "bodyText": "can you explicit KafkaUserModel.KEY_SASL_JAAS_CONFIG as for the other field please?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510688289", "createdAt": "2020-10-23T07:29:19Z", "author": {"login": "ppatierno"}, "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "diffHunk": "@@ -158,7 +159,8 @@ public Secret generateSecret()  {\n             return createSecret(data);\n         } else if (authentication instanceof KafkaUserScramSha512ClientAuthentication) {\n             Map<String, String> data = new HashMap<>(1);\n-            data.put(KafkaUserModel.KEY_PASSWORD, Base64.getEncoder().encodeToString(scramSha512Password.getBytes(StandardCharsets.US_ASCII)));\n+            data.put(KafkaUserModel.KEY_PASSWORD, Base64.getEncoder().encodeToString(this.scramSha512Password.getBytes(StandardCharsets.US_ASCII)));\n+            data.put(KEY_SASL_JAAS_CONFIG, Base64.getEncoder().encodeToString(getSaslJsonConfig().getBytes(StandardCharsets.US_ASCII)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA2NTA3OnYy", "diffSide": "RIGHT", "path": "documentation/modules/con-securing-client-authentication.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozMToxM1rOHnB__w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozMToxM1rOHnB__w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY4OTI3OQ==", "bodyText": "I would not use the field name to explain the field itself. It would be better saying something like \"The JAAS configuration string for SASL SCRAM-SHA-512 authentication\".", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510689279", "createdAt": "2020-10-23T07:31:13Z", "author": {"login": "ppatierno"}, "path": "documentation/modules/con-securing-client-authentication.adoc", "diffHunk": "@@ -103,8 +103,10 @@ metadata:\n type: Opaque\n data:\n   password: Z2VuZXJhdGVkcGFzc3dvcmQ= <1>\n+  sasl.jaas.config: b3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VjdXJpdHkuc2NyYW0uU2NyYW1Mb2dpbk1vZHVsZSByZXF1aXJlZCB1c2VybmFtZT0ibXktdXNlciIgcGFzc3dvcmQ9ImdlbmVyYXRlZHBhc3N3b3JkIjsK <2>\n ----\n <1> The generated password, base64 encoded.\n+<2> The `sasl.jaas.config` string, base64 encoded.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA2ODkxOnYy", "diffSide": "RIGHT", "path": "CHANGELOG.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozMjoyNFrOHnCCOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozMjoyNFrOHnCCOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY4OTg1MQ==", "bodyText": "It's better to not use just the field name but explaining what it is, so for example.\n\"Add the JAAS configuration string in the sasl.jaas.config property to the generated secrets for KafkaUser with SCRAM-SHA-512 authentication\"", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510689851", "createdAt": "2020-10-23T07:32:24Z", "author": {"login": "ppatierno"}, "path": "CHANGELOG.md", "diffHunk": "@@ -4,6 +4,7 @@\n \n * Add support for `secretPrefix` property for User Operator to prefix all secret names created from KafkaUser resource.\n * Allow configuring labels and annotations for Cluster CA certificate secrets\n+* Add `sasl.jaas.config` to generated secrets for KafkaUser with SCRAM-SHA-512 authentication.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA3ODM2OnYy", "diffSide": "RIGHT", "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozNToyMlrOHnCH_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozNToyMlrOHnCH_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5MTMyNQ==", "bodyText": "As usual not use the field name, explicit what the parameter represents.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510691325", "createdAt": "2020-10-23T07:35:22Z", "author": {"login": "ppatierno"}, "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "diffHunk": "@@ -394,6 +396,17 @@ public static String getSecretName(String secretPrefix, String username)    {\n         return secretPrefix + username;\n     }\n \n+    /**\n+     * Creates the sasl.jaas.config string for SASL/SCRAM authentication.\n+     *\n+     * @param username The SCRAM username.\n+     * @param password The SCRAM password.\n+     * @return The sasl.jaas.config string.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA3OTk1OnYy", "diffSide": "RIGHT", "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozNTo1MVrOHnCI_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozNTo1MVrOHnCI_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5MTU4MA==", "bodyText": "ditto as already mentioned both for description and parameter.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510691580", "createdAt": "2020-10-23T07:35:51Z", "author": {"login": "ppatierno"}, "path": "user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java", "diffHunk": "@@ -482,4 +495,14 @@ public boolean isScramUser()  {\n     public boolean isNoneUser()  {\n         return authentication == null;\n     }\n+\n+    /**\n+     * Creates the sasl.jaas.config string for SASL/SCRAM authentication.\n+     *\n+     * @return The sasl.jaas.config string.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTA5MTI0OnYy", "diffSide": "RIGHT", "path": "user-operator/src/test/java/io/strimzi/operator/user/model/KafkaUserModelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozOToxNlrOHnCPrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzozOToxNlrOHnCPrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5MzI5Mw==", "bodyText": "I think you are just testing that the base64 encoding (on Kafka user creation) and the decoding (in the assert) are working not that it returns the JAAS string you would expect. You should also have the expected string somewhere to do the assertation that it's corrected.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3858#discussion_r510693293", "createdAt": "2020-10-23T07:39:16Z", "author": {"login": "ppatierno"}, "path": "user-operator/src/test/java/io/strimzi/operator/user/model/KafkaUserModelTest.java", "diffHunk": "@@ -297,8 +298,12 @@ public void testGenerateSecretGeneratesPasswordWhenNoUserSecretExists()    {\n                         .withKubernetesManagedBy(KafkaUserModel.KAFKA_USER_OPERATOR_NAME)\n                         .toMap()));\n \n-        assertThat(generatedSecret.getData().keySet(), is(singleton(KafkaUserModel.KEY_PASSWORD)));\n-        assertThat(new String(Base64.getDecoder().decode(generatedSecret.getData().get(KafkaUserModel.KEY_PASSWORD))), is(\"aaaaaaaaaa\"));\n+        assertThat(generatedSecret.getData().keySet(), is(new HashSet<>(Arrays.asList(KafkaUserModel.KEY_PASSWORD, KafkaUserModel.KEY_SASL_JAAS_CONFIG))));\n+\n+        String password = \"aaaaaaaaaa\";\n+        assertThat(new String(Base64.getDecoder().decode(generatedSecret.getData().get(KafkaUserModel.KEY_PASSWORD))), is(password));\n+        assertThat(new String(Base64.getDecoder().decode(generatedSecret.getData().get(KafkaUserModel.KEY_SASL_JAAS_CONFIG))),\n+                is(KafkaUserModel.getSaslJsonConfig(ResourceUtils.NAME, password)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf627554715ff510ad30bafab6313bef6f94775"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 975, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}