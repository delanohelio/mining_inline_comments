{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzODg4MjU4", "number": 3811, "title": "Check ns and kafka cluster for existense", "bodyText": "Signed-off-by: Stanislav Knot sknot@redhat.com\nType of change\n\nEnhancement / new feature\n\nDescription\nRecently there were cases where users were supplying the wrong cluster name for the report tool. I added a check whether specified NS and kafka cluster exist.\nChecklist\n\n Write tests\n Make sure all tests pass\n Update documentation\n Check RBAC rights for Kubernetes / OpenShift roles\n Try your changes inside your Kubernetes and OpenShift cluster\n Reference relevant issue(s) and close them after merging\n Update CHANGELOG.md\n Supply screenshots for visual changes, such as Grafana dashboards", "createdAt": "2020-10-15T07:21:26Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811", "merged": true, "mergeCommit": {"oid": "95af57eb1023d3e72487ddb0d6a9eabe7e209373"}, "closed": true, "closedAt": "2020-10-15T14:07:05Z", "author": {"login": "sknot-rh"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSsjsegH2gAyNTAzODg4MjU4OjU5ZmU1NjY4OGM3NjBkYTI5ZTJjMGJlMzBiZDFiZWJlNTk3N2M3NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSu8tcgFqTUwOTIyMjE0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59fe56688c760da29e2c0be30bd1bebe5977c76f", "committedDate": "2020-10-15T07:22:41Z", "message": "Check ns and kafka cluster for existense\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40d7daff2a2d72b22172c86aee462369bd0af2e0", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/40d7daff2a2d72b22172c86aee462369bd0af2e0", "committedDate": "2020-10-15T07:18:36Z", "message": "Check ns and kafka cluster for existense\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}, "afterCommit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59fe56688c760da29e2c0be30bd1bebe5977c76f", "committedDate": "2020-10-15T07:22:41Z", "message": "Check ns and kafka cluster for existense\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MTA2NzY5", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#pullrequestreview-509106769", "createdAt": "2020-10-15T07:49:57Z", "commit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo0OTo1N1rOHh4ZPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo1MjoyOFrOHh4kMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI4OTAyMA==", "bodyText": "I think that we discussed this with @scholzj to keep the logs from the tls-sidecars for the previous versions of Strimzi. So I think you can keep it there, do you agree @scholzj ?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505289020", "createdAt": "2020-10-15T07:49:57Z", "author": {"login": "im-konge"}, "path": "tools/report.sh", "diffHunk": "@@ -191,18 +210,12 @@ for pod in $pods; do\n \t  $platform logs $pod -p -c topic-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-topic-operator.log\n \t  $platform logs $pod -p -c user-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-user-operator.log\n \telif [[ $pod =~ .*-kafka-[0-9]+ ]]; then\n-\t  $platform logs $pod -c tls-sidecar -n $namespace > $direct/reports/podLogs/\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -c kafka -n $namespace > $direct/reports/podLogs/\"$pod\"-kafka.log\n-\t  $platform logs $pod -p -c tls-sidecar -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -p -c kafka -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-kafka.log\n-\n \t  $platform exec -i $pod -n $namespace -c kafka -- cat /tmp/strimzi.properties > $direct/reports/configs/\"$pod\".cfg\n \telif [[ $pod =~ .*-zookeeper-[0-9]+ ]]; then\n-\t  $platform logs $pod -c tls-sidecar -n $namespace > $direct/reports/podLogs/\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -c zookeeper -n $namespace > $direct/reports/podLogs/\"$pod\"-zookeeper.log\n-\t  $platform logs $pod -p -c tls-sidecar -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -p -c zookeeper -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-zookeeper.log\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI5MTgyNw==", "bodyText": "It's just a nit, but i think that ` ` is \"deprecated\" and now we should use the $()... but maybe I'm wrong and it's only suggestion...", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505291827", "createdAt": "2020-10-15T07:52:28Z", "author": {"login": "im-konge"}, "path": "tools/report.sh", "diffHunk": "@@ -81,6 +81,25 @@ if [ -z $namespace ]; then\n    usage\n fi\n \n+available_namespaces=`$platform get ns -o name`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MTc2NzQ4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#pullrequestreview-509176748", "createdAt": "2020-10-15T09:14:03Z", "commit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwOToxNDowM1rOHh-Mww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwOToxNToxOVrOHh-Qxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NDEzMQ==", "bodyText": "I think you can just do kubectl get namespace <namespace> and check the return code.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505384131", "createdAt": "2020-10-15T09:14:03Z", "author": {"login": "scholzj"}, "path": "tools/report.sh", "diffHunk": "@@ -81,6 +81,25 @@ if [ -z $namespace ]; then\n    usage\n fi\n \n+available_namespaces=`$platform get ns -o name`\n+prefixed_ns=\"namespace/${namespace}\"\n+ns_avalailable=`printf '%s\\n' \"${available_namespaces[@]}\"  | grep -P \"^$prefixed_ns$\"`\n+\n+if [ -z \"${ns_avalailable}\" ]; then\n+\techo \"Namespace $namespace not found! Exiting\"\n+\texit 1\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NDYzNg==", "bodyText": "Same as above ... why not try to get it and check the return code?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505384636", "createdAt": "2020-10-15T09:14:38Z", "author": {"login": "scholzj"}, "path": "tools/report.sh", "diffHunk": "@@ -81,6 +81,25 @@ if [ -z $namespace ]; then\n    usage\n fi\n \n+available_namespaces=`$platform get ns -o name`\n+prefixed_ns=\"namespace/${namespace}\"\n+ns_avalailable=`printf '%s\\n' \"${available_namespaces[@]}\"  | grep -P \"^$prefixed_ns$\"`\n+\n+if [ -z \"${ns_avalailable}\" ]; then\n+\techo \"Namespace $namespace not found! Exiting\"\n+\texit 1\n+fi\n+\n+\n+available_clusters=`$platform get kafka -o name -n $namespace`\n+prefixed_cluster=\"kafka.kafka.strimzi.io/${cluster}\"\n+cluster_avalailable=`printf '%s\\n' \"${available_clusters[@]}\"  | grep -P \"^$prefixed_cluster$\"`\n+\n+if [ -z \"${cluster_avalailable}\" ]; then\n+\techo \"Kafka cluster $cluster in $namespace not found! Exiting\"\n+\texit 1\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NTE1OQ==", "bodyText": "Please keep these for the time being since this is not versioned and might be used even with older versions of Strimzi which have the sidecars.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505385159", "createdAt": "2020-10-15T09:15:19Z", "author": {"login": "scholzj"}, "path": "tools/report.sh", "diffHunk": "@@ -191,18 +210,12 @@ for pod in $pods; do\n \t  $platform logs $pod -p -c topic-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-topic-operator.log\n \t  $platform logs $pod -p -c user-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-user-operator.log\n \telif [[ $pod =~ .*-kafka-[0-9]+ ]]; then\n-\t  $platform logs $pod -c tls-sidecar -n $namespace > $direct/reports/podLogs/\"$pod\"-tls-sidecar.log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c716263dd03662f8ebd15826864b4ee0d7cad68", "author": {"user": {"login": "sknot-rh", "name": "Stanislav Knot"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0c716263dd03662f8ebd15826864b4ee0d7cad68", "committedDate": "2020-10-15T09:42:22Z", "message": "cleaner conditions\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MjA2ODQz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#pullrequestreview-509206843", "createdAt": "2020-10-15T09:50:38Z", "commit": {"oid": "0c716263dd03662f8ebd15826864b4ee0d7cad68"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MjIxNTMz", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#pullrequestreview-509221533", "createdAt": "2020-10-15T10:09:05Z", "commit": {"oid": "0c716263dd03662f8ebd15826864b4ee0d7cad68"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MjIyMTQ3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#pullrequestreview-509222147", "createdAt": "2020-10-15T10:09:49Z", "commit": {"oid": "0c716263dd03662f8ebd15826864b4ee0d7cad68"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 806, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}