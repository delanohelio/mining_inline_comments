{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2Mzg1OTU0", "number": 3212, "title": "Remove CPUCapacity Goal from default master goals and hard goals list", "bodyText": "Type of change\nBugfix\nDescription\nThis PR removes the Cruise Control CPUCapacity Goal from the master (goals) and hard.goals lists. The CPUCapacity goal is not currently supported as the CC metrics reporter does not report the CPU metrics correctly when running on Kubernetes. This is reflected in the docs but the goal class was not removed from default lists in the CruiseControlConfig. This means that a user who specifies custom goals that do not included CPUCapacity will hit an error unless they define their own hard.goals without it or use skipHardGoalsCheck: true.\nChecklist\nPlease go through this checklist and make sure all applicable tasks have been done\n\n Make sure all tests pass\n Update documentation\n Try your changes from Pod inside your Kubernetes and OpenShift cluster, not just locally\n Update CHANGELOG.md", "createdAt": "2020-06-18T10:42:39Z", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212", "merged": true, "mergeCommit": {"oid": "bf3c1d9fa31c66605ae2fc4712da1ef7c22c746d"}, "closed": true, "closedAt": "2020-06-19T11:43:21Z", "author": {"login": "tomncooper"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsc8R6AFqTQzMzE5ODA5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsv78pABqjM0NjE3NjAxODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTk4MDk4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433198098", "createdAt": "2020-06-18T11:41:16Z", "commit": {"oid": "abfe5f5aa8af4b9be878a33c0f1f59027d736e83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo0MToxNlrOGlrhfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo0MToxNlrOGlrhfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2MzU4Mg==", "bodyText": "Should we maybe add the same explnatory comment as we have above?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#discussion_r442163582", "createdAt": "2020-06-18T11:41:16Z", "author": {"login": "scholzj"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java", "diffHunk": "@@ -46,6 +47,23 @@\n \n     public static final String CRUISE_CONTROL_GOALS = String.join(\",\", CRUISE_CONTROL_GOALS_LIST);\n \n+    /**\n+     * A list of case insensitive goals that Cruise Control will use as hard goals that must all be met for an optimization\n+     * proppsal to be valid.\n+     */\n+    protected static final List<String> CRUISE_CONTROL_HARD_GOALS_LIST = Collections.unmodifiableList(\n+            Arrays.asList(\n+                    CruiseControl.RACK_AWARENESS_GOAL,\n+                    CruiseControl.REPLICA_CAPACITY_GOAL,\n+                    CruiseControl.DISK_CAPACITY_GOAL,\n+                    CruiseControl.NETWORK_INBOUND_CAPACITY_GOAL,\n+                    CruiseControl.NETWORK_OUTBOUND_CAPACITY_GOAL\n+                    //CruiseControl.CPU_CAPACITY_GOAL", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abfe5f5aa8af4b9be878a33c0f1f59027d736e83"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abfe5f5aa8af4b9be878a33c0f1f59027d736e83", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/abfe5f5aa8af4b9be878a33c0f1f59027d736e83", "committedDate": "2020-06-18T10:37:35Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "0428db2162ebc24faa82d365bff7188a6307a04b", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0428db2162ebc24faa82d365bff7188a6307a04b", "committedDate": "2020-06-18T12:13:31Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzA5NTc3", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433309577", "createdAt": "2020-06-18T13:56:46Z", "commit": {"oid": "0428db2162ebc24faa82d365bff7188a6307a04b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzQ1NTU0", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433345554", "createdAt": "2020-06-18T14:32:49Z", "commit": {"oid": "0428db2162ebc24faa82d365bff7188a6307a04b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzU3ODkw", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433357890", "createdAt": "2020-06-18T14:44:42Z", "commit": {"oid": "0428db2162ebc24faa82d365bff7188a6307a04b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDo0NDo0M1rOGlyxEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDo0NDo0M1rOGlyxEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI4MjI1Nw==", "bodyText": "if we have an upstream issue I would add the link here as well, otherwise we should open one and linking it here?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#discussion_r442282257", "createdAt": "2020-06-18T14:44:43Z", "author": {"login": "ppatierno"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java", "diffHunk": "@@ -30,7 +30,9 @@\n                 CruiseControl.DISK_CAPACITY_GOAL,\n                 CruiseControl.NETWORK_INBOUND_CAPACITY_GOAL,\n                 CruiseControl.NETWORK_OUTBOUND_CAPACITY_GOAL,\n-                CruiseControl.CPU_CAPACITY_GOAL,\n+                // TODO: The CPU metric are currently not reported correctly when running on Kubernetes\n+                //       we should add this back in once fixed upstream\n+                //CruiseControl.CPU_CAPACITY_GOAL,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0428db2162ebc24faa82d365bff7188a6307a04b"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0428db2162ebc24faa82d365bff7188a6307a04b", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0428db2162ebc24faa82d365bff7188a6307a04b", "committedDate": "2020-06-18T12:13:31Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "fa2e9eaf9fb879a1b03779d543a48fa43a111a23", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fa2e9eaf9fb879a1b03779d543a48fa43a111a23", "committedDate": "2020-06-18T15:02:53Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa2e9eaf9fb879a1b03779d543a48fa43a111a23", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fa2e9eaf9fb879a1b03779d543a48fa43a111a23", "committedDate": "2020-06-18T15:02:53Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "5274f3bb30a16bebfbe29013fe9f8af40feb38fa", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5274f3bb30a16bebfbe29013fe9f8af40feb38fa", "committedDate": "2020-06-18T16:36:38Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5274f3bb30a16bebfbe29013fe9f8af40feb38fa", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5274f3bb30a16bebfbe29013fe9f8af40feb38fa", "committedDate": "2020-06-18T16:36:38Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c418b8b46529d4acac58047df21af5fc67c2d1c4", "committedDate": "2020-06-18T16:40:01Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTEyMTgy", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433512182", "createdAt": "2020-06-18T17:46:27Z", "commit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzo0NjoyN1rOGl53pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzo0NjoyN1rOGl53pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5ODYzMA==", "bodyText": "Is there a Strimzi issue connected to this also?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#discussion_r442398630", "createdAt": "2020-06-18T17:46:27Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java", "diffHunk": "@@ -30,7 +30,9 @@\n                 CruiseControl.DISK_CAPACITY_GOAL,\n                 CruiseControl.NETWORK_INBOUND_CAPACITY_GOAL,\n                 CruiseControl.NETWORK_OUTBOUND_CAPACITY_GOAL,\n-                CruiseControl.CPU_CAPACITY_GOAL,\n+                // TODO: The CPU metric are currently not reported correctly when running on Kubernetes\n+                //       we should add this back in once fixed upstream, see https://github.com/linkedin/cruise-control/issues/1242", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTEyNDQ4", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433512448", "createdAt": "2020-06-18T17:46:49Z", "commit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzo0Njo0OVrOGl54fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzo0Njo0OVrOGl54fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5ODg0NA==", "bodyText": "*proposal", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#discussion_r442398844", "createdAt": "2020-06-18T17:46:49Z", "author": {"login": "samuel-hawker"}, "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/CruiseControlConfiguration.java", "diffHunk": "@@ -46,6 +48,25 @@\n \n     public static final String CRUISE_CONTROL_GOALS = String.join(\",\", CRUISE_CONTROL_GOALS_LIST);\n \n+    /**\n+     * A list of case insensitive goals that Cruise Control will use as hard goals that must all be met for an optimization\n+     * proppsal to be valid.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTEzMTc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3212#pullrequestreview-433513176", "createdAt": "2020-06-18T17:47:48Z", "commit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c342d4d7591e25fa7ca6a3854fe764bbd533fe90", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c342d4d7591e25fa7ca6a3854fe764bbd533fe90", "committedDate": "2020-06-19T09:48:12Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c418b8b46529d4acac58047df21af5fc67c2d1c4", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c418b8b46529d4acac58047df21af5fc67c2d1c4", "committedDate": "2020-06-18T16:40:01Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}, "afterCommit": {"oid": "c342d4d7591e25fa7ca6a3854fe764bbd533fe90", "author": {"user": {"login": "tomncooper", "name": "Thomas Cooper"}}, "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c342d4d7591e25fa7ca6a3854fe764bbd533fe90", "committedDate": "2020-06-19T09:48:12Z", "message": "Removed CPUCapacity Goal from default master goals and hard goals list\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1568, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}