{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNTI1ODky", "number": 2816, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo0Nzo1M1rODwrP2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzo0NjozOFrODy_Y2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzY2ODEwOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo0Nzo1M1rOGDztbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowNzoyMVrOGFayeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NjEyNQ==", "bodyText": "as far as I can see this will use an external client which will try to connect to the external node port listener via TLS but in the above configuration such external node port listener doesn't have TLS enabled. What am I missing?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r406646125", "createdAt": "2020-04-10T07:47:53Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +752,142 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() throws Exception {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                            .endKafkaListenerExternalNodePort()\n+                            .withNewTls()\n+                            .endTls()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+                    .withNewTls()\n+                        .withTrustedCertificates(certSecret)\n+                    .endTls()\n+                    .withBootstrapServers(CLUSTER_NAME + \"-kafka-bootstrap:9093\")\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SSL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8403bfa86cf6982cb800fe23c376bd504acec3c1"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzNTU3NQ==", "bodyText": "this is my fault, I'll take a look at it", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r407235575", "createdAt": "2020-04-12T18:28:52Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +752,142 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() throws Exception {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                            .endKafkaListenerExternalNodePort()\n+                            .withNewTls()\n+                            .endTls()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+                    .withNewTls()\n+                        .withTrustedCertificates(certSecret)\n+                    .endTls()\n+                    .withBootstrapServers(CLUSTER_NAME + \"-kafka-bootstrap:9093\")\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SSL);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NjEyNQ=="}, "originalCommit": {"oid": "8403bfa86cf6982cb800fe23c376bd504acec3c1"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNDk2OA==", "bodyText": "@ppatierno TLS is by default on true so I will not add that to external node port extra", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r408334968", "createdAt": "2020-04-14T18:07:21Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +752,142 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() throws Exception {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                            .endKafkaListenerExternalNodePort()\n+                            .withNewTls()\n+                            .endTls()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+                    .withNewTls()\n+                        .withTrustedCertificates(certSecret)\n+                    .endTls()\n+                    .withBootstrapServers(CLUSTER_NAME + \"-kafka-bootstrap:9093\")\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SSL);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NjEyNQ=="}, "originalCommit": {"oid": "8403bfa86cf6982cb800fe23c376bd504acec3c1"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzY3Njg0OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo1MTo1MFrOGDzykg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowOToxN1rOGFa3Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzQ0Mg==", "bodyText": "actually it's not just SCRAM-SHA but you are using TLS as well, right? Should we have a test where just SASL is used instead of SALS_SSL?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r406647442", "createdAt": "2020-04-10T07:51:50Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "diffHunk": "@@ -129,6 +129,59 @@ void testReceiveSimpleMessageTlsScramSha() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, name), is(true));\n     }\n \n+    @Test\n+    void testScramShaAuthWithWeirdNamedUser() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8403bfa86cf6982cb800fe23c376bd504acec3c1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNjEzMA==", "bodyText": "@ppatierno because we using TLS and SCRAM-SHA in whole HttpBridgeScramShaST i let it like that. We can add test with PLAINTEXT but I don't know if this is desired.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r408336130", "createdAt": "2020-04-14T18:09:17Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "diffHunk": "@@ -129,6 +129,59 @@ void testReceiveSimpleMessageTlsScramSha() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, name), is(true));\n     }\n \n+    @Test\n+    void testScramShaAuthWithWeirdNamedUser() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzQ0Mg=="}, "originalCommit": {"oid": "8403bfa86cf6982cb800fe23c376bd504acec3c1"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzQ3NTExOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTozNjowOVrOGFxsIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTozNjowOVrOGFxsIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxMDE3Ng==", "bodyText": "missing nodePort tag", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r408710176", "createdAt": "2020-04-15T09:36:09Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +750,136 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(EXTERNAL_CLIENTS_USED)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ea5594adcde9a252caa361a53d529c3152e2476"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzQ4MzE5OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTozODoxNVrOGFxxIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTozODoxNVrOGFxxIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxMTQ1Nw==", "bodyText": "same as above", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r408711457", "createdAt": "2020-04-15T09:38:15Z", "author": {"login": "Frawless"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +750,136 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() throws Exception {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                                .withAuth(new KafkaListenerAuthenticationTls())\n+                            .endKafkaListenerExternalNodePort()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+                    .withNewTls()\n+                        .withTrustedCertificates(certSecret)\n+                    .endTls()\n+                    .withBootstrapServers(CLUSTER_NAME + \"-kafka-bootstrap:9093\")\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SSL);\n+    }\n+\n+    @Tag(EXTERNAL_CLIENTS_USED)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ea5594adcde9a252caa361a53d529c3152e2476"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTcxNzA2OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODozNDowNlrOGGagjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODozNDowNlrOGGagjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM3ODk1OA==", "bodyText": "Do we need this config?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409378958", "createdAt": "2020-04-16T08:34:06Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +751,138 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                                .withAuth(new KafkaListenerAuthenticationTls())\n+                            .endKafkaListenerExternalNodePort()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTcyMzQzOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODozNTo1M1rOGGakyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODozNTo1M1rOGGakyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM4MDA0MQ==", "bodyText": "This property is redundant, you have already define it in the KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409380041", "createdAt": "2020-04-16T08:35:53Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +751,138 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                                .withAuth(new KafkaListenerAuthenticationTls())\n+                            .endKafkaListenerExternalNodePort()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+                    .withNewTls()\n+                        .withTrustedCertificates(certSecret)\n+                    .endTls()\n+                    .withBootstrapServers(CLUSTER_NAME + \"-kafka-bootstrap:9093\")\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SSL);\n+    }\n+\n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectScramShaAuthWithWeirdUserName() {\n+        // Create weird named user with . and more than 64 chars -> SCRAM-SHA\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasdsadasdasdasdasdgasgadfasdad\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .withNewListeners()\n+                            .withNewTls()\n+                                .withAuth(new KafkaListenerAuthenticationScramSha512())\n+                            .endTls()\n+                            .withNewKafkaListenerExternalNodePort()\n+                                .withAuth(new KafkaListenerAuthenticationScramSha512())\n+                            .endKafkaListenerExternalNodePort()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.scramShaUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withBootstrapServers(KafkaResources.tlsBootstrapAddress(CLUSTER_NAME))\n+                    .withNewKafkaClientAuthenticationScramSha512()\n+                        .withNewUsername(weirdUserName)\n+                        .withPasswordSecret(new PasswordSecretSourceBuilder()\n+                            .withSecretName(weirdUserName)\n+                            .withPassword(\"password\")\n+                            .build())\n+                    .endKafkaClientAuthenticationScramSha512()\n+                    .addToConfig(\"key.converter.schemas.enable\", false)\n+                    .addToConfig(\"value.converter.schemas.enable\", false)\n+                    .addToConfig(\"key.converter\", \"org.apache.kafka.connect.storage.StringConverter\")\n+                    .addToConfig(\"value.converter\", \"org.apache.kafka.connect.storage.StringConverter\")\n+                    .withVersion(Environment.ST_KAFKA_VERSION)\n+                    .withReplicas(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTczMDcwOnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODozNzo0NVrOGGapbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODozNzo0NVrOGGapbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM4MTIyOA==", "bodyText": "Please use only is(.....) without the prefix class. You will need to change the imports )", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409381228", "createdAt": "2020-04-16T08:37:45Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -745,6 +751,138 @@ void testMultiNodeKafkaConnectWithConnectorCreation() {\n         KafkaConnectUtils.waitForMessagesInKafkaConnectFileSink(connectorPodName, Constants.DEFAULT_SINK_FILE_PATH, \"99\");\n     }\n \n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectTlsAuthWithWeirdUserName() {\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+        String connectClusterName = \"connect-cluster\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .editListeners()\n+                            .withNewKafkaListenerExternalNodePort()\n+                                .withAuth(new KafkaListenerAuthenticationTls())\n+                            .endKafkaListenerExternalNodePort()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        // Initialize CertSecretSource with certificate and secret names for consumer\n+        CertSecretSource certSecret = new CertSecretSource();\n+        certSecret.setCertificate(\"ca.crt\");\n+        certSecret.setSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME));\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .editSpec()\n+                    .addToConfig(\"group.id\", connectClusterName)\n+                    .addToConfig(\"offset.storage.topic\", connectClusterName + \"-offsets\")\n+                    .addToConfig(\"config.storage.topic\", connectClusterName + \"-config\")\n+                    .addToConfig(\"status.storage.topic\", connectClusterName + \"-status\")\n+                    .withNewTls()\n+                        .withTrustedCertificates(certSecret)\n+                    .endTls()\n+                    .withBootstrapServers(CLUSTER_NAME + \"-kafka-bootstrap:9093\")\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SSL);\n+    }\n+\n+    @Tag(NODEPORT_SUPPORTED)\n+    @Tag(EXTERNAL_CLIENTS_USED)\n+    @Tag(CONNECTOR_OPERATOR)\n+    @Test\n+    void testConnectScramShaAuthWithWeirdUserName() {\n+        // Create weird named user with . and more than 64 chars -> SCRAM-SHA\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasdsadasdasdasdasdgasgadfasdad\";\n+\n+        KafkaResource.kafkaEphemeral(CLUSTER_NAME, 3)\n+                .editSpec()\n+                    .editKafka()\n+                        .withNewListeners()\n+                            .withNewTls()\n+                                .withAuth(new KafkaListenerAuthenticationScramSha512())\n+                            .endTls()\n+                            .withNewKafkaListenerExternalNodePort()\n+                                .withAuth(new KafkaListenerAuthenticationScramSha512())\n+                            .endKafkaListenerExternalNodePort()\n+                        .endListeners()\n+                    .endKafka()\n+                .endSpec()\n+                .done();\n+\n+        KafkaUserResource.scramShaUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+                .editMetadata()\n+                    .addToLabels(\"type\", \"kafka-connect\")\n+                    .addToAnnotations(Annotations.STRIMZI_IO_USE_CONNECTOR_RESOURCES, \"true\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withBootstrapServers(KafkaResources.tlsBootstrapAddress(CLUSTER_NAME))\n+                    .withNewKafkaClientAuthenticationScramSha512()\n+                        .withNewUsername(weirdUserName)\n+                        .withPasswordSecret(new PasswordSecretSourceBuilder()\n+                            .withSecretName(weirdUserName)\n+                            .withPassword(\"password\")\n+                            .build())\n+                    .endKafkaClientAuthenticationScramSha512()\n+                    .addToConfig(\"key.converter.schemas.enable\", false)\n+                    .addToConfig(\"value.converter.schemas.enable\", false)\n+                    .addToConfig(\"key.converter\", \"org.apache.kafka.connect.storage.StringConverter\")\n+                    .addToConfig(\"value.converter\", \"org.apache.kafka.connect.storage.StringConverter\")\n+                    .withVersion(Environment.ST_KAFKA_VERSION)\n+                    .withReplicas(1)\n+                    .withNewTls()\n+                        .withTrustedCertificates(new CertSecretSourceBuilder()\n+                                .withCertificate(\"ca.crt\")\n+                                .withNewSecretName(KafkaResources.clusterCaCertificateSecretName(CLUSTER_NAME))\n+                                .build())\n+                    .endTls()\n+                .endSpec()\n+                .done();\n+\n+        testConnectAuthorizationWithWeirdUserName(weirdUserName, SecurityProtocol.SASL_SSL);\n+    }\n+\n+    void testConnectAuthorizationWithWeirdUserName(String userName, SecurityProtocol securityProtocol) {\n+        String topicName = TOPIC_NAME + rng.nextInt(Integer.MAX_VALUE);\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        String connectorPodName = kubeClient().listPodsByPrefixInName(CLUSTER_NAME + \"-connect\").get(0).getMetadata().getName();\n+\n+        KafkaConnectorResource.kafkaConnector(CLUSTER_NAME)\n+                .editSpec()\n+                    .withClassName(\"org.apache.kafka.connect.file.FileStreamSinkConnector\")\n+                    .addToConfig(\"topics\", topicName)\n+                    .addToConfig(\"file\", Constants.DEFAULT_SINK_FILE_PATH)\n+                .endSpec().done();\n+\n+        BasicExternalKafkaClient basicExternalKafkaClient = new BasicExternalKafkaClient.Builder()\n+                .withNamespaceName(NAMESPACE)\n+                .withClusterName(CLUSTER_NAME)\n+                .withKafkaUsername(userName)\n+                .withMessageCount(MESSAGE_COUNT)\n+                .withConsumerGroupName(CONSUMER_GROUP_NAME + rng.nextInt(Integer.MAX_VALUE))\n+                .withSecurityProtocol(securityProtocol)\n+                .withTopicName(topicName)\n+                .build();\n+\n+        assertThat(basicExternalKafkaClient.sendMessagesTls(), CoreMatchers.is(MESSAGE_COUNT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 172}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTc0MDk1OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODo0MDoxNlrOGGavwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDoxMDoxMlrOGGeP2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM4Mjg1MA==", "bodyText": "indent in InteliJ set preferences -> editor -> code style -> java -> (set everything to 4 |tab size, indent, continuationn indent) to aviod all these 8's idents.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409382850", "createdAt": "2020-04-16T08:40:16Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "diffHunk": "@@ -129,6 +129,59 @@ void testReceiveSimpleMessageTlsScramSha() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, name), is(true));\n     }\n \n+    @Test\n+    void testScramShaAuthWithWeirdNamedUser() throws Exception {\n+        String topicName = \"topic\" + rng.nextInt(Integer.MAX_VALUE);\n+        String groupId = \"my-group-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        // Create weird named user with . and more than 64 chars -> SCRAM-SHA\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd.asdasidioiqweioqiweooioqieioqieoqieooi\";\n+\n+        // Create topic\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        // Create user\n+        KafkaUserResource.scramShaUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        JsonObject config = new JsonObject();\n+        config.put(\"name\", weirdUserName);\n+        config.put(\"format\", \"json\");\n+        config.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\");\n+\n+        // Create consumer\n+        JsonObject response = createBridgeConsumer(config, bridgeHost, bridgePort, groupId);\n+        assertThat(\"Consumer wasn't created correctly\", response.getString(\"instance_id\"), is(weirdUserName));\n+\n+        // Create topics json\n+        JsonArray topic = new JsonArray();\n+        topic.add(topicName);\n+        JsonObject topics = new JsonObject();\n+        topics.put(\"topics\", topic);\n+\n+        // Subscribe\n+        assertThat(HttpUtils.subscribeHttpConsumer(topics, bridgeHost, bridgePort, groupId, weirdUserName, client), is(true));\n+\n+        BasicExternalKafkaClient basicExternalKafkaClient = new BasicExternalKafkaClient.Builder()\n+                .withTopicName(topicName)\n+                .withNamespaceName(NAMESPACE)\n+                .withClusterName(CLUSTER_NAME)\n+                .withMessageCount(MESSAGE_COUNT)\n+                .withSecurityProtocol(SecurityProtocol.SASL_SSL)\n+                .withKafkaUsername(weirdUserName)\n+                .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n+                .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ0MDIxOQ==", "bodyText": "thanks for tip :)", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409440219", "createdAt": "2020-04-16T10:10:12Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "diffHunk": "@@ -129,6 +129,59 @@ void testReceiveSimpleMessageTlsScramSha() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, name), is(true));\n     }\n \n+    @Test\n+    void testScramShaAuthWithWeirdNamedUser() throws Exception {\n+        String topicName = \"topic\" + rng.nextInt(Integer.MAX_VALUE);\n+        String groupId = \"my-group-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        // Create weird named user with . and more than 64 chars -> SCRAM-SHA\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd.asdasidioiqweioqiweooioqieioqieoqieooi\";\n+\n+        // Create topic\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        // Create user\n+        KafkaUserResource.scramShaUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        JsonObject config = new JsonObject();\n+        config.put(\"name\", weirdUserName);\n+        config.put(\"format\", \"json\");\n+        config.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\");\n+\n+        // Create consumer\n+        JsonObject response = createBridgeConsumer(config, bridgeHost, bridgePort, groupId);\n+        assertThat(\"Consumer wasn't created correctly\", response.getString(\"instance_id\"), is(weirdUserName));\n+\n+        // Create topics json\n+        JsonArray topic = new JsonArray();\n+        topic.add(topicName);\n+        JsonObject topics = new JsonObject();\n+        topics.put(\"topics\", topic);\n+\n+        // Subscribe\n+        assertThat(HttpUtils.subscribeHttpConsumer(topics, bridgeHost, bridgePort, groupId, weirdUserName, client), is(true));\n+\n+        BasicExternalKafkaClient basicExternalKafkaClient = new BasicExternalKafkaClient.Builder()\n+                .withTopicName(topicName)\n+                .withNamespaceName(NAMESPACE)\n+                .withClusterName(CLUSTER_NAME)\n+                .withMessageCount(MESSAGE_COUNT)\n+                .withSecurityProtocol(SecurityProtocol.SASL_SSL)\n+                .withKafkaUsername(weirdUserName)\n+                .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n+                .build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM4Mjg1MA=="}, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTc0ODU2OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeTlsST.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODo0MjoyMlrOGGa0qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwOTozNjoxM1rOGGc9aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM4NDEwNg==", "bodyText": "I know that you did not write it but is it needed to receive 2 times? @ppatierno  is this behaviour in the Bridge excepted?", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409384106", "createdAt": "2020-04-16T08:42:22Z", "author": {"login": "see-quick"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeTlsST.java", "diffHunk": "@@ -125,6 +125,59 @@ void testReceiveSimpleMessageTls() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, USER_NAME), is(true));\n     }\n \n+    @Test\n+    void testTlsAuthWithWeirdNamedUser() throws Exception {\n+        String topicName = \"topic\" + rng.nextInt(Integer.MAX_VALUE);\n+        String groupId = \"my-group-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+\n+        // Create topic\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        // Create user\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        JsonObject config = new JsonObject();\n+        config.put(\"name\", weirdUserName);\n+        config.put(\"format\", \"json\");\n+        config.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\");\n+\n+        // Create consumer\n+        JsonObject response = createBridgeConsumer(config, bridgeHost, bridgePort, groupId);\n+        assertThat(\"Consumer wasn't created correctly\", response.getString(\"instance_id\"), is(weirdUserName));\n+\n+        // Create topics json\n+        JsonArray topic = new JsonArray();\n+        topic.add(topicName);\n+        JsonObject topics = new JsonObject();\n+        topics.put(\"topics\", topic);\n+\n+        // Subscribe\n+        assertThat(HttpUtils.subscribeHttpConsumer(topics, bridgeHost, bridgePort, groupId, weirdUserName, client), is(true));\n+\n+        BasicExternalKafkaClient basicExternalKafkaClient = new BasicExternalKafkaClient.Builder()\n+                .withTopicName(topicName)\n+                .withNamespaceName(NAMESPACE)\n+                .withClusterName(CLUSTER_NAME)\n+                .withMessageCount(MESSAGE_COUNT)\n+                .withSecurityProtocol(SecurityProtocol.SSL)\n+                .withKafkaUsername(weirdUserName)\n+                .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n+                .build();\n+\n+        assertThat(basicExternalKafkaClient.sendMessagesTls(), is(MESSAGE_COUNT));\n+        // Try to consume messages\n+        JsonArray bridgeResponse = HttpUtils.receiveMessagesHttpRequest(bridgeHost, bridgePort, groupId, weirdUserName, client);\n+        if (bridgeResponse.size() == 0) {\n+            // Real consuming\n+            bridgeResponse = HttpUtils.receiveMessagesHttpRequest(bridgeHost, bridgePort, groupId, weirdUserName, client);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQxOTExNQ==", "bodyText": "This question I had too. So I will be really glad for explanation.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r409419115", "createdAt": "2020-04-16T09:36:13Z", "author": {"login": "im-konge"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeTlsST.java", "diffHunk": "@@ -125,6 +125,59 @@ void testReceiveSimpleMessageTls() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, USER_NAME), is(true));\n     }\n \n+    @Test\n+    void testTlsAuthWithWeirdNamedUser() throws Exception {\n+        String topicName = \"topic\" + rng.nextInt(Integer.MAX_VALUE);\n+        String groupId = \"my-group-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+\n+        // Create topic\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        // Create user\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        JsonObject config = new JsonObject();\n+        config.put(\"name\", weirdUserName);\n+        config.put(\"format\", \"json\");\n+        config.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\");\n+\n+        // Create consumer\n+        JsonObject response = createBridgeConsumer(config, bridgeHost, bridgePort, groupId);\n+        assertThat(\"Consumer wasn't created correctly\", response.getString(\"instance_id\"), is(weirdUserName));\n+\n+        // Create topics json\n+        JsonArray topic = new JsonArray();\n+        topic.add(topicName);\n+        JsonObject topics = new JsonObject();\n+        topics.put(\"topics\", topic);\n+\n+        // Subscribe\n+        assertThat(HttpUtils.subscribeHttpConsumer(topics, bridgeHost, bridgePort, groupId, weirdUserName, client), is(true));\n+\n+        BasicExternalKafkaClient basicExternalKafkaClient = new BasicExternalKafkaClient.Builder()\n+                .withTopicName(topicName)\n+                .withNamespaceName(NAMESPACE)\n+                .withClusterName(CLUSTER_NAME)\n+                .withMessageCount(MESSAGE_COUNT)\n+                .withSecurityProtocol(SecurityProtocol.SSL)\n+                .withKafkaUsername(weirdUserName)\n+                .withConsumerGroupName(CONSUMER_GROUP_NAME + \"-\" + rng.nextInt(Integer.MAX_VALUE))\n+                .build();\n+\n+        assertThat(basicExternalKafkaClient.sendMessagesTls(), is(MESSAGE_COUNT));\n+        // Try to consume messages\n+        JsonArray bridgeResponse = HttpUtils.receiveMessagesHttpRequest(bridgeHost, bridgePort, groupId, weirdUserName, client);\n+        if (bridgeResponse.size() == 0) {\n+            // Real consuming\n+            bridgeResponse = HttpUtils.receiveMessagesHttpRequest(bridgeHost, bridgePort, groupId, weirdUserName, client);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM4NDEwNg=="}, "originalCommit": {"oid": "5bb6845e834dcfa127b7a14bcc9d1e1b0ea5f2c2"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NzkzODg2OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzo0NjozMFrOGHXYfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzo0NjozMFrOGHXYfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NjMxNg==", "bodyText": "I don't think it makes sense using the weirdUserName for creating a consumer on the bridge, it should be a different test. You are testing the how a KafkaUser username can be weird not the name of the consumer on the bridge. Just use a different simpler name here.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r410376316", "createdAt": "2020-04-17T17:46:30Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java", "diffHunk": "@@ -129,6 +129,59 @@ void testReceiveSimpleMessageTlsScramSha() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, name), is(true));\n     }\n \n+    @Test\n+    void testScramShaAuthWithWeirdNamedUser() throws Exception {\n+        String topicName = \"topic\" + rng.nextInt(Integer.MAX_VALUE);\n+        String groupId = \"my-group-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        // Create weird named user with . and more than 64 chars -> SCRAM-SHA\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd.asdasidioiqweioqiweooioqieioqieoqieooi\";\n+\n+        // Create topic\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        // Create user\n+        KafkaUserResource.scramShaUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        JsonObject config = new JsonObject();\n+        config.put(\"name\", weirdUserName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d01a605145aeacdbca98d120a9746ecfdcf8f9"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NzkzOTQ0OnYy", "diffSide": "RIGHT", "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeTlsST.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzo0NjozOVrOGHXYzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzo0NjozOVrOGHXYzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NjM5OA==", "bodyText": "Ditto as above.", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2816#discussion_r410376398", "createdAt": "2020-04-17T17:46:39Z", "author": {"login": "ppatierno"}, "path": "systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeTlsST.java", "diffHunk": "@@ -124,6 +125,59 @@ void testReceiveSimpleMessageTls() throws Exception {\n         assertThat(deleteConsumer(bridgeHost, bridgePort, groupId, USER_NAME), is(true));\n     }\n \n+    @Test\n+    void testTlsAuthWithWeirdNamedUser() throws Exception {\n+        String topicName = \"topic\" + rng.nextInt(Integer.MAX_VALUE);\n+        String groupId = \"my-group-\" + rng.nextInt(Integer.MAX_VALUE);\n+\n+        // Create weird named user with . and maximum of 64 chars -> TLS\n+        String weirdUserName = \"jjglmahyijoambryleyxjjglmahy.ijoambryleyxjjglmahyijoambryleyxasd\";\n+\n+        // Create topic\n+        KafkaTopicResource.topic(CLUSTER_NAME, topicName).done();\n+        // Create user\n+        KafkaUserResource.tlsUser(CLUSTER_NAME, weirdUserName).done();\n+\n+        JsonObject config = new JsonObject();\n+        config.put(\"name\", weirdUserName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d01a605145aeacdbca98d120a9746ecfdcf8f9"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 142, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}