{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjQ3ODU0", "number": 262, "title": "[MOB-1876] - Consume a message after click/back", "bodyText": "If a message is consume type, remove the message only after click events on in-app OR if pressed BACK_BUTTON.", "createdAt": "2020-08-24T17:02:31Z", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262", "merged": true, "mergeCommit": {"oid": "f8a459722a688ee1cc5eb1bb4fddaf4f908b746f"}, "closed": true, "closedAt": "2020-09-22T15:53:34Z", "author": {"login": "Ayyanchira"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCGm1gABqjM2ODY2MjM2OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLMwlmAFqTQ5MzA2MzUyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24779eabd010db47c75cfe7d4e9c9a0a485a0169", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/24779eabd010db47c75cfe7d4e9c9a0a485a0169", "committedDate": "2020-08-24T17:02:03Z", "message": "[MOB-1876] - Consume a message after click/back\n\nIf a message is consume type, remove the message only after click events on in-app OR if pressed BACK_BUTTON."}, "afterCommit": {"oid": "54ba34e0038c16becd11956c32447b0f8dcd2395", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/54ba34e0038c16becd11956c32447b0f8dcd2395", "committedDate": "2020-08-24T18:06:48Z", "message": "[MOB-1876] - Consume a message after click/back\n\nIf a message is consume type, remove the message only after click events on in-app OR if pressed BACK_BUTTON."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDA3Njk1", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#pullrequestreview-477007695", "createdAt": "2020-08-27T19:13:00Z", "commit": {"oid": "54ba34e0038c16becd11956c32447b0f8dcd2395"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOToxMzowMFrOHIdwEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOToxMzowMFrOHIdwEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzODA5Ng==", "bodyText": "Hmm at this point I think we should have a common method for handling both normal clicks and back click, since the handling for both is the same.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#discussion_r478638096", "createdAt": "2020-08-27T19:13:00Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -252,6 +252,11 @@ public void onUrlClicked(String url) {\n     public void onBackPressed() {\n         IterableApi.sharedInstance.trackInAppClick(messageId, BACK_BUTTON);\n         IterableApi.sharedInstance.trackInAppClose(messageId, BACK_BUTTON, IterableInAppCloseAction.BACK, location);\n+        IterableInAppMessage message = IterableApi.sharedInstance.getInAppManager().getMessageById(messageId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54ba34e0038c16becd11956c32447b0f8dcd2395"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDA4Mjg4", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#pullrequestreview-477008288", "createdAt": "2020-08-27T19:13:51Z", "commit": {"oid": "54ba34e0038c16becd11956c32447b0f8dcd2395"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOToxMzo1MlrOHIdx3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOToxMzo1MlrOHIdx3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzODU1Nw==", "bodyText": "I think doing setConsumed changes the semantics of what 'consumed' means. Previously it was an indicator that we've sent a consume API call to the server. Now it's not very clear what it means.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#discussion_r478638557", "createdAt": "2020-08-27T19:13:52Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppManager.java", "diffHunk": "@@ -235,8 +238,7 @@ public void execute(Uri url) {\n         })) {\n             setRead(message, true);\n             if (consume) {\n-                // Remove the message without tracking\n-                removeMessage(message);\n+                message.setConsumed(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54ba34e0038c16becd11956c32447b0f8dcd2395"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9efeae88082a0ea155d6be80c1f47ff4aa8d19a7", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/9efeae88082a0ea155d6be80c1f47ff4aa8d19a7", "committedDate": "2020-08-27T23:42:35Z", "message": "[MOB-1876] - Consume a message after click/back\n\nIf a message is consume type, remove the message only after click events on in-app OR if pressed BACK_BUTTON."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54ba34e0038c16becd11956c32447b0f8dcd2395", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/54ba34e0038c16becd11956c32447b0f8dcd2395", "committedDate": "2020-08-24T18:06:48Z", "message": "[MOB-1876] - Consume a message after click/back\n\nIf a message is consume type, remove the message only after click events on in-app OR if pressed BACK_BUTTON."}, "afterCommit": {"oid": "9efeae88082a0ea155d6be80c1f47ff4aa8d19a7", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/9efeae88082a0ea155d6be80c1f47ff4aa8d19a7", "committedDate": "2020-08-27T23:42:35Z", "message": "[MOB-1876] - Consume a message after click/back\n\nIf a message is consume type, remove the message only after click events on in-app OR if pressed BACK_BUTTON."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMjIyNDY3", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#pullrequestreview-490222467", "createdAt": "2020-09-17T03:46:21Z", "commit": {"oid": "9efeae88082a0ea155d6be80c1f47ff4aa8d19a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzo0NjoyMlrOHTPnDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzo0NjoyMlrOHTPnDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk0MDc0OQ==", "bodyText": "I think this will track a delete event, unlike the previous code that was calling removeMessage with just one parameter. Is there a reason to use another version of removeMessage here?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#discussion_r489940749", "createdAt": "2020-09-17T03:46:22Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -252,6 +253,14 @@ public void onUrlClicked(String url) {\n     public void onBackPressed() {\n         IterableApi.sharedInstance.trackInAppClick(messageId, BACK_BUTTON);\n         IterableApi.sharedInstance.trackInAppClose(messageId, BACK_BUTTON, IterableInAppCloseAction.BACK, location);\n+        processMessageRemoval();\n+    }\n+\n+    private void processMessageRemoval() {\n+        IterableInAppMessage message = IterableApi.sharedInstance.getInAppManager().getMessageById(messageId);\n+        if (message.isMarkedForDeletion() && !message.isConsumed()) {\n+            IterableApi.sharedInstance.getInAppManager().removeMessage(message, IterableInAppDeleteActionType.OTHER, location);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9efeae88082a0ea155d6be80c1f47ff4aa8d19a7"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a18c5d8bd790f1e7dbc7fc96e7e03862b9e0747e", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/a18c5d8bd790f1e7dbc7fc96e7e03862b9e0747e", "committedDate": "2020-09-18T16:56:45Z", "message": "Using remove message with single parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDYzNTIx", "url": "https://github.com/Iterable/iterable-android-sdk/pull/262#pullrequestreview-493063521", "createdAt": "2020-09-22T00:22:20Z", "commit": {"oid": "a18c5d8bd790f1e7dbc7fc96e7e03862b9e0747e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 664, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}