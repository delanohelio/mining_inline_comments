{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDg2OTc3", "number": 236, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NDoxNlrOEBjJ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowNDo1NlrOECUk3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDYwMDEyOnYy", "diffSide": "RIGHT", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NDoxNlrOGddrzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NDoxNlrOGddrzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0ODIzNw==", "bodyText": "Why not initialize it here?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r433548237", "createdAt": "2020-06-01T23:54:16Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -52,6 +55,7 @@\n \n     private IterableInAppManager inAppManager;\n     private String inboxSessionId;\n+    private HashMap<String, String> deviceAttributes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDYwMTA2OnYy", "diffSide": "RIGHT", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NDo0MFrOGddsTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NDo0MFrOGddsTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0ODM2NQ==", "bodyText": "You can remove these checks if you initialize it above.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r433548365", "createdAt": "2020-06-01T23:54:40Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -201,6 +205,23 @@ void setNotificationData(IterableNotificationData data) {\n             setAttributionInfo(new IterableAttributionInfo(data.getCampaignId(), data.getTemplateId(), data.getMessageId()));\n         }\n     }\n+\n+    HashMap getDeviceAttributes() {\n+        return deviceAttributes;\n+    }\n+\n+    public void setDeviceAttribute(String key, String value) {\n+        if (deviceAttributes == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDYwNjIyOnYy", "diffSide": "RIGHT", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NzozNlrOGddvdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1NzozNlrOGddvdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0OTE3NA==", "bodyText": "You can just do for(HashMap.Entry<String, String> entry : deviceAttributes.entrySet())", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r433549174", "createdAt": "2020-06-01T23:57:36Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -1114,6 +1135,15 @@ protected void registerDeviceToken(@Nullable String email, @Nullable String user\n             if (dataFields == null) {\n                 dataFields = new JSONObject();\n             }\n+\n+            if (deviceAttributes != null) {\n+                Iterator<HashMap.Entry<String, String>> deviceAttributesIterator = deviceAttributes.entrySet().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDYwODQ2OnYy", "diffSide": "RIGHT", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterablePushRegistration.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMzo1OTowNFrOGddw4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowNDowMFrOGetYaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0OTUzOA==", "bodyText": "Hmmm I'm wondering if we should put device attributes in iterablePushRegistrationData since we store everything else related to the push registration there.. I don't think this will make a significant difference, but could be better for consistency. Your call.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r433549538", "createdAt": "2020-06-01T23:59:04Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterablePushRegistration.java", "diffHunk": "@@ -33,7 +34,8 @@ protected Void doInBackground(IterablePushRegistrationData... params) {\n                             iterablePushRegistrationData.email,\n                             iterablePushRegistrationData.userId,\n                             iterablePushRegistrationData.pushIntegrationName,\n-                            pushRegistrationObject.token);\n+                            pushRegistrationObject.token,\n+                            IterableApi.getInstance().getDeviceAttributes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY4MDM0MQ==", "bodyText": "Sticking with current one. I had thought about it too. DeviceAttributes is something developer can set on later stage too apart from during a push registration state. PushRegistration felt more related to Push and Firebase side of functionality and didn't felt like adding it there. This looks fine to me :)", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r433680341", "createdAt": "2020-06-02T07:40:54Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterablePushRegistration.java", "diffHunk": "@@ -33,7 +34,8 @@ protected Void doInBackground(IterablePushRegistrationData... params) {\n                             iterablePushRegistrationData.email,\n                             iterablePushRegistrationData.userId,\n                             iterablePushRegistrationData.pushIntegrationName,\n-                            pushRegistrationObject.token);\n+                            pushRegistrationObject.token,\n+                            IterableApi.getInstance().getDeviceAttributes());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0OTUzOA=="}, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzA3Nw==", "bodyText": "The reason these properties are packed within the object is getting the token takes some time to get the token, so we capture the email, userId, push integration name at the time push registration was requested to make sure it is consistent.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r434853077", "createdAt": "2020-06-03T21:02:53Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterablePushRegistration.java", "diffHunk": "@@ -33,7 +34,8 @@ protected Void doInBackground(IterablePushRegistrationData... params) {\n                             iterablePushRegistrationData.email,\n                             iterablePushRegistrationData.userId,\n                             iterablePushRegistrationData.pushIntegrationName,\n-                            pushRegistrationObject.token);\n+                            pushRegistrationObject.token,\n+                            IterableApi.getInstance().getDeviceAttributes());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0OTUzOA=="}, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1Mzk5Mw==", "bodyText": "Oh, actually we should keep it this way to make sure device attributes can be set after initialization. :) Disregard this.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r434853993", "createdAt": "2020-06-03T21:04:00Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterablePushRegistration.java", "diffHunk": "@@ -33,7 +34,8 @@ protected Void doInBackground(IterablePushRegistrationData... params) {\n                             iterablePushRegistrationData.email,\n                             iterablePushRegistrationData.userId,\n                             iterablePushRegistrationData.pushIntegrationName,\n-                            pushRegistrationObject.token);\n+                            pushRegistrationObject.token,\n+                            IterableApi.getInstance().getDeviceAttributes());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU0OTUzOA=="}, "originalCommit": {"oid": "3ad48161970de903d9c93961d25831d91c0301fc"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwODY5NTEzOnYy", "diffSide": "RIGHT", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowNDozMVrOGetaVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowNDozMVrOGetaVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1NDQ4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void removeFromDeviceAttribute(String key) {\n          \n          \n            \n                public void removeDeviceAttribute(String key) {", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r434854484", "createdAt": "2020-06-03T21:04:31Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -201,6 +203,18 @@ void setNotificationData(IterableNotificationData data) {\n             setAttributionInfo(new IterableAttributionInfo(data.getCampaignId(), data.getTemplateId(), data.getMessageId()));\n         }\n     }\n+\n+    HashMap getDeviceAttributes() {\n+        return deviceAttributes;\n+    }\n+\n+    public void setDeviceAttribute(String key, String value) {\n+        deviceAttributes.put(key, value);\n+    }\n+\n+    public void removeFromDeviceAttribute(String key) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36ffccfe6231f22c2f49b5bcf3ceef0404f32263"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwODY5NzI0OnYy", "diffSide": "RIGHT", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowNDo1NlrOGetbtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowNDo1NlrOGetbtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1NDgzOQ==", "bodyText": "It is never null", "url": "https://github.com/Iterable/iterable-android-sdk/pull/236#discussion_r434854839", "createdAt": "2020-06-03T21:04:56Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -1114,6 +1128,13 @@ protected void registerDeviceToken(@Nullable String email, @Nullable String user\n             if (dataFields == null) {\n                 dataFields = new JSONObject();\n             }\n+\n+            if (deviceAttributes != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36ffccfe6231f22c2f49b5bcf3ceef0404f32263"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2280, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}