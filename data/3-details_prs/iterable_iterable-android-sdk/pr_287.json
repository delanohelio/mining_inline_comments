{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NzI4NDUw", "number": 287, "title": "[MOB-2002] - Request Processor - Online", "bodyText": "Introduced RequestProcessor interface\nImplemented OnlineRequestProcessor which now creates IterableRequest and executes it\nemails, userIds and authToken is now mainly fetched from authProvider from apiClient\nchanged/removed method signature for internal methods which had authToken or passed emailId or userId around\n5  Changed IterablePushRegistration classes to accomodate authHandler changes\nChanges in test method to make it pass.", "createdAt": "2020-11-25T22:51:50Z", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287", "merged": true, "mergeCommit": {"oid": "fdd5d9880b9ffaedf83810ca7c6abd540e873175"}, "closed": true, "closedAt": "2020-12-02T07:11:38Z", "author": {"login": "Ayyanchira"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgGcV8AFqTUzODg5MjM1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiF_lNAFqTU0MjQ3MjUwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4ODkyMzU5", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#pullrequestreview-538892359", "createdAt": "2020-11-25T22:53:11Z", "commit": {"oid": "d9c5be040ad79b59de7d56b760f7430523e7d098"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMjo1MzoxMlrOH6GR4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMjo1MzoxMlrOH6GR4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY4MjMzNg==", "bodyText": "Why did you remove email/userId/authToken?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#discussion_r530682336", "createdAt": "2020-11-25T22:53:12Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -429,14 +429,14 @@ public boolean isIterableIntent(@Nullable Intent intent) {\n      * @param deviceToken Push token obtained from GCM or FCM\n      */\n     public void registerDeviceToken(@NonNull String deviceToken) {\n-        registerDeviceToken(_email, _userId, _authToken, getPushIntegrationName(), deviceToken, deviceAttributes);\n+        registerDeviceToken(getPushIntegrationName(), deviceToken, deviceAttributes);\n     }\n \n-    protected void registerDeviceToken(final @Nullable String email, final @Nullable String userId, final @Nullable String authToken, final @NonNull String applicationName, final @NonNull String deviceToken, final HashMap<String, String> deviceAttributes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9c5be040ad79b59de7d56b760f7430523e7d098"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4ODkyNjQ0", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#pullrequestreview-538892644", "createdAt": "2020-11-25T22:54:03Z", "commit": {"oid": "d9c5be040ad79b59de7d56b760f7430523e7d098"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMjo1NDowM1rOH6GStw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMjo1NDowM1rOH6GStw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY4MjU1MQ==", "bodyText": "Do we need to create the request processor every time?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#discussion_r530682551", "createdAt": "2020-11-25T22:54:03Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApiClient.java", "diffHunk": "@@ -473,20 +473,12 @@ void tryAddArrayToJSON(JSONObject requestJSON, String key, Object[] value) {\n      * @param json\n      */\n     void sendPostRequest(@NonNull String resourcePath, @NonNull JSONObject json) {\n-        sendPostRequest(resourcePath, json, authProvider.getAuthToken());\n-    }\n-\n-    void sendPostRequest(@NonNull String resourcePath, @NonNull JSONObject json, @Nullable String authToken) {\n-        sendPostRequest(resourcePath, json, authToken, null, null);\n+        sendPostRequest(resourcePath, json, null, null);\n     }\n \n     void sendPostRequest(@NonNull String resourcePath, @NonNull JSONObject json, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n-        sendPostRequest(resourcePath, json, authProvider.getAuthToken(), onSuccess, onFailure);\n-    }\n-\n-    void sendPostRequest(@NonNull String resourcePath, @NonNull JSONObject json, @Nullable String authToken, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n-        IterableApiRequest request = new IterableApiRequest(authProvider.getApiKey(), resourcePath, json, IterableApiRequest.POST, authToken, onSuccess, onFailure);\n-        new IterableRequest().execute(request);\n+        RequestProcessor requestProcessor = new OnlineRequestProcessor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9c5be040ad79b59de7d56b760f7430523e7d098"}, "originalPosition": 64}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65bb9776908e9dafc940c117db1dae372989b636", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/65bb9776908e9dafc940c117db1dae372989b636", "committedDate": "2020-12-01T02:30:52Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}, "afterCommit": {"oid": "d0aa49ed94d667c9461fe720aacaa0687b4d8db1", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d0aa49ed94d667c9461fe720aacaa0687b4d8db1", "committedDate": "2020-12-01T02:47:36Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0aa49ed94d667c9461fe720aacaa0687b4d8db1", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d0aa49ed94d667c9461fe720aacaa0687b4d8db1", "committedDate": "2020-12-01T02:47:36Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}, "afterCommit": {"oid": "97aa0524c48e957420d25acf998dbf4d962a634a", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/97aa0524c48e957420d25acf998dbf4d962a634a", "committedDate": "2020-12-01T02:49:45Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97aa0524c48e957420d25acf998dbf4d962a634a", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/97aa0524c48e957420d25acf998dbf4d962a634a", "committedDate": "2020-12-01T02:49:45Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}, "afterCommit": {"oid": "515be0a21058275ceeac15093f503015f7c68f8a", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/515be0a21058275ceeac15093f503015f7c68f8a", "committedDate": "2020-12-01T02:50:50Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "515be0a21058275ceeac15093f503015f7c68f8a", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/515be0a21058275ceeac15093f503015f7c68f8a", "committedDate": "2020-12-01T02:50:50Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}, "afterCommit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/893ef7d7b41fbe344304b7a0d898629f8a6d5ae7", "committedDate": "2020-12-01T02:53:18Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMzc5OTgz", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#pullrequestreview-542379983", "createdAt": "2020-12-01T23:22:28Z", "commit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzoyMjoyOVrOH9D6lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzoyMjoyOVrOH9D6lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4OTMzMw==", "bodyText": "Rebase on latest master and maybe drop the merge commit to drop this change from the PR", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#discussion_r533789333", "createdAt": "2020-12-01T23:22:29Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/test/java/com/iterable/iterableapi/IterableApiIntegrationTest.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package com.iterable.iterableapi;\n+\n+import android.content.Context;\n+\n+import org.json.JSONObject;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.robolectric.shadows.ShadowPausedAsyncTask;\n+\n+import java.io.IOException;\n+import java.util.concurrent.TimeUnit;\n+\n+import okhttp3.mockwebserver.MockResponse;\n+import okhttp3.mockwebserver.MockWebServer;\n+import okhttp3.mockwebserver.RecordedRequest;\n+\n+import static android.os.Looper.getMainLooper;\n+import static junit.framework.Assert.assertEquals;\n+import static junit.framework.Assert.assertNotNull;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+public class IterableApiIntegrationTest extends BaseTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMzgwMTM5", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#pullrequestreview-542380139", "createdAt": "2020-12-01T23:22:50Z", "commit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzoyMjo1MFrOH9D7GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzoyMjo1MFrOH9D7GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4OTQ2NA==", "bodyText": "same, this should already be in master", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#discussion_r533789464", "createdAt": "2020-12-01T23:22:50Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/test/java/com/iterable/iterableapi/IterableApiTest.java", "diffHunk": "@@ -50,6 +50,7 @@\n     private MockWebServer server;\n     private IterableApiClient originalApiClient;\n     private IterableApiClient mockApiClient;\n+    private IterablePushRegistration.IterablePushRegistrationImpl originalPushRegistrationImpl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMzgwMzQ2", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#pullrequestreview-542380346", "createdAt": "2020-12-01T23:23:13Z", "commit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "777f5e43ef322e4293ee9bba4cd7578d38a0727c", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/777f5e43ef322e4293ee9bba4cd7578d38a0727c", "committedDate": "2020-12-01T23:47:05Z", "message": "[MOB-2002] - Request Processor - Online\n\n1. Introduced RequestProcessor interface\n2. Implemented OnlineRequestProcessor which now creates IterableRequest and executes it\n3. emails, userIds and authToken is now mainly fetched from authProvider from apiClient\n4. changed/removed method signature for internal methods which had authToken or passed emailId or userId around\n5  Changed IterablePushRegistration classes to accomodate authHandler changes\n6. Changes in test method to make it pass."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c76949d59b22515a4e10698370bb187bfbd612c6", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/c76949d59b22515a4e10698370bb187bfbd612c6", "committedDate": "2020-12-01T23:47:05Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "893ef7d7b41fbe344304b7a0d898629f8a6d5ae7", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/893ef7d7b41fbe344304b7a0d898629f8a6d5ae7", "committedDate": "2020-12-01T02:53:18Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}, "afterCommit": {"oid": "c76949d59b22515a4e10698370bb187bfbd612c6", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/c76949d59b22515a4e10698370bb187bfbd612c6", "committedDate": "2020-12-01T23:47:05Z", "message": "Revision 1\n\n1. Merged the test method branch\n2. Reverted the authhandler code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNDcyNTAz", "url": "https://github.com/Iterable/iterable-android-sdk/pull/287#pullrequestreview-542472503", "createdAt": "2020-12-02T03:29:38Z", "commit": {"oid": "c76949d59b22515a4e10698370bb187bfbd612c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 557, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}