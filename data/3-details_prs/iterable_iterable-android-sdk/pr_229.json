{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NDIyOTY3", "number": 229, "title": "[MOB-1424] InAppFragment improvements, delayed display", "bodyText": "Hide the webView instead of DecorView for compatibility with API 29+\nShow the dialog when the WebView is fully loaded, or after 500 ms, whichever happens earlier", "createdAt": "2020-05-07T02:17:22Z", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229", "merged": true, "mergeCommit": {"oid": "892c750631be3f4248715910ea19d020f8b94778"}, "closed": true, "closedAt": "2020-05-07T23:06:38Z", "author": {"login": "vbabenkoru"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce4odOgFqTQwNzIzNjgzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfFWVHgFqTQwNzg4OTkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjM2ODMx", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#pullrequestreview-407236831", "createdAt": "2020-05-07T08:02:40Z", "commit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowMjo0MVrOGRy__A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowMjo0MVrOGRy__A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMxNDU1Ng==", "bodyText": "\ud83d\udc4c", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#discussion_r421314556", "createdAt": "2020-05-07T08:02:41Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -190,20 +192,27 @@ public void run() {\n         if (savedInstanceState == null || !savedInstanceState.getBoolean(INAPP_OPEN_TRACKED, false)) {\n             IterableApi.sharedInstance.trackInAppOpen(messageId, location);\n         }\n+        hideDialogView();\n         return relativeLayout;\n     }\n \n-    private void hideDialogView(Dialog dialog) {\n+    private void hideDialogView() {\n         try {\n-            dialog.getWindow().getDecorView().setVisibility(View.INVISIBLE);\n+            webView.setVisibility(View.INVISIBLE);\n+            webView.postDelayed(new Runnable() {\n+                @Override\n+                public void run() {\n+                    showDialogView();\n+                }\n+            }, DELAY_THRESHOLD_MS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjM2ODU4", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#pullrequestreview-407236858", "createdAt": "2020-05-07T08:02:42Z", "commit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowMjo0M1rOGRzAEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowMjo0M1rOGRzAEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMxNDU3OA==", "bodyText": "Just a suggestion. With this approach the status bar on API 29 device seems to flash before hiding and showing.\ngetDialog().getWindow().getDecorView().setAlpha(0);\ncan be a good alternative and more closer to what we had achieved previously.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#discussion_r421314578", "createdAt": "2020-05-07T08:02:43Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -190,20 +192,27 @@ public void run() {\n         if (savedInstanceState == null || !savedInstanceState.getBoolean(INAPP_OPEN_TRACKED, false)) {\n             IterableApi.sharedInstance.trackInAppOpen(messageId, location);\n         }\n+        hideDialogView();\n         return relativeLayout;\n     }\n \n-    private void hideDialogView(Dialog dialog) {\n+    private void hideDialogView() {\n         try {\n-            dialog.getWindow().getDecorView().setVisibility(View.INVISIBLE);\n+            webView.setVisibility(View.INVISIBLE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjM3MTAy", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#pullrequestreview-407237102", "createdAt": "2020-05-07T08:03:05Z", "commit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowMzowNVrOGRzA5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowMzowNVrOGRzA5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMxNDc5MQ==", "bodyText": "getDialog().getWindow().getDecorView().setAlpha(1);\n?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#discussion_r421314791", "createdAt": "2020-05-07T08:03:05Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -190,20 +192,27 @@ public void run() {\n         if (savedInstanceState == null || !savedInstanceState.getBoolean(INAPP_OPEN_TRACKED, false)) {\n             IterableApi.sharedInstance.trackInAppOpen(messageId, location);\n         }\n+        hideDialogView();\n         return relativeLayout;\n     }\n \n-    private void hideDialogView(Dialog dialog) {\n+    private void hideDialogView() {\n         try {\n-            dialog.getWindow().getDecorView().setVisibility(View.INVISIBLE);\n+            webView.setVisibility(View.INVISIBLE);\n+            webView.postDelayed(new Runnable() {\n+                @Override\n+                public void run() {\n+                    showDialogView();\n+                }\n+            }, DELAY_THRESHOLD_MS);\n         } catch (NullPointerException e) {\n             IterableLogger.e(TAG, \"View not present. Failed to hide before resizing inapp\");\n         }\n     }\n \n-    private void showDialogView(Dialog dialog) {\n+    private void showDialogView() {\n         try {\n-            dialog.getWindow().getDecorView().setVisibility(View.VISIBLE);\n+            webView.setVisibility(View.VISIBLE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa3be890c6a00efda6cab6bbdf3e28b6adb2e071", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/aa3be890c6a00efda6cab6bbdf3e28b6adb2e071", "committedDate": "2020-05-07T22:50:36Z", "message": "InAppFragment improvements, delayed display\n\n* Hide the webView instead of DecorView for compatibility with API 29+\n* Show the dialog when the WebView is fully loaded, or after 500 ms, whichever happens earlier"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3bfd4a7d6845785284d72f15ad63e62528b26f4", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/e3bfd4a7d6845785284d72f15ad63e62528b26f4", "committedDate": "2020-05-07T02:15:52Z", "message": "InAppFragment improvements, delayed display\n\n* Hide the webView instead of DecorView for compatibility with API 29+\n* Show the dialog when the WebView is fully loaded, or after 500 ms, whichever happens earlier"}, "afterCommit": {"oid": "aa3be890c6a00efda6cab6bbdf3e28b6adb2e071", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/aa3be890c6a00efda6cab6bbdf3e28b6adb2e071", "committedDate": "2020-05-07T22:50:36Z", "message": "InAppFragment improvements, delayed display\n\n* Hide the webView instead of DecorView for compatibility with API 29+\n* Show the dialog when the WebView is fully loaded, or after 500 ms, whichever happens earlier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3ODg5OTM0", "url": "https://github.com/Iterable/iterable-android-sdk/pull/229#pullrequestreview-407889934", "createdAt": "2020-05-07T22:51:39Z", "commit": {"oid": "aa3be890c6a00efda6cab6bbdf3e28b6adb2e071"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 625, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}