{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNzk3NzI3", "number": 293, "title": "[MOB-2150] - Request Serialization", "bodyText": "Added from JSON and toJSON to IterableApiRequest class.\nAdded temporary task schedular code in offline request processor to see if it can form the request from the database", "createdAt": "2020-12-07T16:32:20Z", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293", "merged": true, "mergeCommit": {"oid": "a2accdc1d42230f3fc534a677d9cc491108b409b"}, "closed": true, "closedAt": "2020-12-09T23:13:05Z", "author": {"login": "Ayyanchira"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj5QcWABqjQwODA4OTA1NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdknHDxgFqTU0ODY5MTU2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6413f366e72f2deee9ebcc41bfa5be99b41828f7", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/6413f366e72f2deee9ebcc41bfa5be99b41828f7", "committedDate": "2020-12-07T16:31:11Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}, "afterCommit": {"oid": "04d3af9abaecbf23ed7e7f1dfe785b3b17795522", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/04d3af9abaecbf23ed7e7f1dfe785b3b17795522", "committedDate": "2020-12-07T17:46:54Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04d3af9abaecbf23ed7e7f1dfe785b3b17795522", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/04d3af9abaecbf23ed7e7f1dfe785b3b17795522", "committedDate": "2020-12-07T17:46:54Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}, "afterCommit": {"oid": "be68baaa4f40107b3a398dcbd1fdf796b4774d9d", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/be68baaa4f40107b3a398dcbd1fdf796b4774d9d", "committedDate": "2020-12-07T17:53:48Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/a421a559c0378eb79e1d5946bc23f64f6275b549", "committedDate": "2020-12-07T17:55:55Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be68baaa4f40107b3a398dcbd1fdf796b4774d9d", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/be68baaa4f40107b3a398dcbd1fdf796b4774d9d", "committedDate": "2020-12-07T17:53:48Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}, "afterCommit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/a421a559c0378eb79e1d5946bc23f64f6275b549", "committedDate": "2020-12-07T17:55:55Z", "message": "[MOB-2150] - Request Serialization\n\n1. Added from JSON and toJSON to IterableApiRequest class.\n2. Added temporary task schedular code in offline request processor to see if it can form the request from the database"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTI2MDIz", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546526023", "createdAt": "2020-12-07T20:52:06Z", "commit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1MjowN1rOIA6LAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1MjowN1rOIA6LAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyNDAwMw==", "bodyText": "The names auth and authToken imply different things.. I would expect auth to include email, userId and authToken.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r537824003", "createdAt": "2020-12-07T20:52:07Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableRequest.java", "diffHunk": "@@ -338,4 +340,31 @@ protected void setRetryCount(int count) {\n         this.authToken = authToken;\n         this.legacyCallback = callback;\n     }\n+\n+    public JSONObject toJSONObject() throws JSONException {\n+        JSONObject jsonObject = new JSONObject();\n+        jsonObject.put(\"apiKey\", this.apiKey);\n+        jsonObject.put(\"endPoint\", this.resourcePath);\n+        jsonObject.put(\"auth\", this.authToken);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTI3NTAw", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546527500", "createdAt": "2020-12-07T20:54:09Z", "commit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1NDowOVrOIA6QHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1NDowOVrOIA6QHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyNTMxMA==", "bodyText": "Is this deferred to a separate PR?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r537825310", "createdAt": "2020-12-07T20:54:09Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/OfflineRequestProcessor.java", "diffHunk": "@@ -3,17 +3,77 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import com.google.android.gms.tasks.Task;\n+\n+import org.json.JSONException;\n import org.json.JSONObject;\n \n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n public class OfflineRequestProcessor implements RequestProcessor {\n \n+\n     @Override\n     public void processGetRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.IterableActionHandler onCallback) {\n-\n+        //Invoke taskScheduler and add task to database", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTI4NTkw", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546528590", "createdAt": "2020-12-07T20:55:39Z", "commit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1NTozOVrOIA6Tpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1NTozOVrOIA6Tpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyNjIxNQ==", "bodyText": "Can we pass IterableTaskManager as a dependency to this class? This call looks weird.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r537826215", "createdAt": "2020-12-07T20:55:39Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/OfflineRequestProcessor.java", "diffHunk": "@@ -3,17 +3,77 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import com.google.android.gms.tasks.Task;\n+\n+import org.json.JSONException;\n import org.json.JSONObject;\n \n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n public class OfflineRequestProcessor implements RequestProcessor {\n \n+\n     @Override\n     public void processGetRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.IterableActionHandler onCallback) {\n-\n+        //Invoke taskScheduler and add task to database\n     }\n \n     @Override\n     public void processPostRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableApiRequest request = new IterableApiRequest(apiKey, resourcePath, json, IterableApiRequest.POST, authToken, onSuccess, onFailure);\n+        TaskScheduler taskScheduler = new TaskScheduler();\n+        taskScheduler.scheduleTask(request, onSuccess, onFailure);\n+    }\n+}\n+\n+\n+class TaskScheduler {\n+    private final String TAG = \"RequestProcessor\";\n+\n+    static HashMap<String, IterableHelper.SuccessHandler> successCallbackMap = new HashMap<>();\n+    static HashMap<String, IterableHelper.FailureHandler> failureCallbackMap = new HashMap<>();\n+\n+    void scheduleTask(IterableApiRequest request, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableTaskManager taskManager = IterableTaskManager.sharedInstance(IterableApi.getInstance().getMainActivityContext());\n+        JSONObject iterableRequestOffline = null;\n+        try {\n+            iterableRequestOffline = request.toJSONObject();\n+        } catch (JSONException e) {\n+            IterableLogger.e(TAG, \"Failed serializating the request for offline execution. Attempting to request the request now...\");\n+            new IterableRequest().execute(request);\n+            return;\n+        }\n+\n+        String taskId = taskManager.createTask(request.resourcePath, IterableTaskType.API, iterableRequestOffline.toString());\n+\n+        successCallbackMap.put(taskId, onSuccess);\n+        failureCallbackMap.put(taskId,onFailure);\n+\n+        processTask();\n+    }\n+\n+    //Temporary function to convert database offline task to ITerableReuqest and execute.\n+    void processTask() {\n+        IterableTaskManager taskManager = IterableTaskManager.sharedInstance(IterableApi.getInstance().getMainActivityContext());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTI5MTA2", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546529106", "createdAt": "2020-12-07T20:56:22Z", "commit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1NjoyMlrOIA6VOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1NjoyMlrOIA6VOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyNjYxOA==", "bodyText": "I like this approach", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r537826618", "createdAt": "2020-12-07T20:56:22Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/OfflineRequestProcessor.java", "diffHunk": "@@ -3,17 +3,77 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import com.google.android.gms.tasks.Task;\n+\n+import org.json.JSONException;\n import org.json.JSONObject;\n \n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n public class OfflineRequestProcessor implements RequestProcessor {\n \n+\n     @Override\n     public void processGetRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.IterableActionHandler onCallback) {\n-\n+        //Invoke taskScheduler and add task to database\n     }\n \n     @Override\n     public void processPostRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableApiRequest request = new IterableApiRequest(apiKey, resourcePath, json, IterableApiRequest.POST, authToken, onSuccess, onFailure);\n+        TaskScheduler taskScheduler = new TaskScheduler();\n+        taskScheduler.scheduleTask(request, onSuccess, onFailure);\n+    }\n+}\n+\n+\n+class TaskScheduler {\n+    private final String TAG = \"RequestProcessor\";\n+\n+    static HashMap<String, IterableHelper.SuccessHandler> successCallbackMap = new HashMap<>();\n+    static HashMap<String, IterableHelper.FailureHandler> failureCallbackMap = new HashMap<>();\n+\n+    void scheduleTask(IterableApiRequest request, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableTaskManager taskManager = IterableTaskManager.sharedInstance(IterableApi.getInstance().getMainActivityContext());\n+        JSONObject iterableRequestOffline = null;\n+        try {\n+            iterableRequestOffline = request.toJSONObject();\n+        } catch (JSONException e) {\n+            IterableLogger.e(TAG, \"Failed serializating the request for offline execution. Attempting to request the request now...\");\n+            new IterableRequest().execute(request);\n+            return;\n+        }\n+\n+        String taskId = taskManager.createTask(request.resourcePath, IterableTaskType.API, iterableRequestOffline.toString());\n+\n+        successCallbackMap.put(taskId, onSuccess);\n+        failureCallbackMap.put(taskId,onFailure);\n+\n+        processTask();\n+    }\n+\n+    //Temporary function to convert database offline task to ITerableReuqest and execute.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTI5NDk2", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546529496", "createdAt": "2020-12-07T20:56:54Z", "commit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1Njo1NFrOIA6WeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1Njo1NFrOIA6WeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyNjkzNw==", "bodyText": "The name of this variable isn't very clear", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r537826937", "createdAt": "2020-12-07T20:56:54Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/OfflineRequestProcessor.java", "diffHunk": "@@ -3,17 +3,77 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import com.google.android.gms.tasks.Task;\n+\n+import org.json.JSONException;\n import org.json.JSONObject;\n \n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n public class OfflineRequestProcessor implements RequestProcessor {\n \n+\n     @Override\n     public void processGetRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.IterableActionHandler onCallback) {\n-\n+        //Invoke taskScheduler and add task to database\n     }\n \n     @Override\n     public void processPostRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableApiRequest request = new IterableApiRequest(apiKey, resourcePath, json, IterableApiRequest.POST, authToken, onSuccess, onFailure);\n+        TaskScheduler taskScheduler = new TaskScheduler();\n+        taskScheduler.scheduleTask(request, onSuccess, onFailure);\n+    }\n+}\n+\n+\n+class TaskScheduler {\n+    private final String TAG = \"RequestProcessor\";\n+\n+    static HashMap<String, IterableHelper.SuccessHandler> successCallbackMap = new HashMap<>();\n+    static HashMap<String, IterableHelper.FailureHandler> failureCallbackMap = new HashMap<>();\n+\n+    void scheduleTask(IterableApiRequest request, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableTaskManager taskManager = IterableTaskManager.sharedInstance(IterableApi.getInstance().getMainActivityContext());\n+        JSONObject iterableRequestOffline = null;\n+        try {\n+            iterableRequestOffline = request.toJSONObject();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a421a559c0378eb79e1d5946bc23f64f6275b549"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b307462d433efe1c4621b35e908a90ffc6ebbc86", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/b307462d433efe1c4621b35e908a90ffc6ebbc86", "committedDate": "2020-12-08T01:50:44Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}, "afterCommit": {"oid": "c89b7a4a28ad7af02ba32bf3a85e18f572f164f2", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/c89b7a4a28ad7af02ba32bf3a85e18f572f164f2", "committedDate": "2020-12-08T01:52:35Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c89b7a4a28ad7af02ba32bf3a85e18f572f164f2", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/c89b7a4a28ad7af02ba32bf3a85e18f572f164f2", "committedDate": "2020-12-08T01:52:35Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}, "afterCommit": {"oid": "8f4c887e47de67c934e9f6c0fddc04e64fdc6a3b", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/8f4c887e47de67c934e9f6c0fddc04e64fdc6a3b", "committedDate": "2020-12-08T01:56:06Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f4c887e47de67c934e9f6c0fddc04e64fdc6a3b", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/8f4c887e47de67c934e9f6c0fddc04e64fdc6a3b", "committedDate": "2020-12-08T01:56:06Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}, "afterCommit": {"oid": "56a47ed4e80847158db219546b1bb441fe05530e", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/56a47ed4e80847158db219546b1bb441fe05530e", "committedDate": "2020-12-08T01:58:37Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56a47ed4e80847158db219546b1bb441fe05530e", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/56a47ed4e80847158db219546b1bb441fe05530e", "committedDate": "2020-12-08T01:58:37Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}, "afterCommit": {"oid": "2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a", "committedDate": "2020-12-08T02:02:02Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzU2ODE1", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546756815", "createdAt": "2020-12-08T05:30:38Z", "commit": {"oid": "2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwNTozMDozOFrOIBHw1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwNTozMDozOFrOIBHw1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA0NjY3Ng==", "bodyText": "Same as in the first review.. does it have to be auth?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r538046676", "createdAt": "2020-12-08T05:30:38Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableRequest.java", "diffHunk": "@@ -338,4 +340,31 @@ protected void setRetryCount(int count) {\n         this.authToken = authToken;\n         this.legacyCallback = callback;\n     }\n+\n+    public JSONObject toJSONObject() throws JSONException {\n+        JSONObject jsonObject = new JSONObject();\n+        jsonObject.put(\"apiKey\", this.apiKey);\n+        jsonObject.put(\"endPoint\", this.resourcePath);\n+        jsonObject.put(\"authToken\", this.authToken);\n+        jsonObject.put(\"requestType\", this.requestType);\n+        jsonObject.put(\"data\", this.json);\n+        return jsonObject;\n+    }\n+\n+    static IterableApiRequest fromJSON(JSONObject jsonData, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        try {\n+            String apikey = jsonData.getString(\"apiKey\");\n+            String resourcePath = jsonData.getString(\"endPoint\");\n+            String requestType = jsonData.getString(\"requestType\");\n+            String auth = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzU4MDM3", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-546758037", "createdAt": "2020-12-08T05:33:59Z", "commit": {"oid": "2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwNTozMzo1OVrOIBH1lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwNTozMzo1OVrOIBH1lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA0Nzg5Mg==", "bodyText": "Is this an iOS name? Why is it different than resourcePath?", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r538047892", "createdAt": "2020-12-08T05:33:59Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableRequest.java", "diffHunk": "@@ -338,4 +340,31 @@ protected void setRetryCount(int count) {\n         this.authToken = authToken;\n         this.legacyCallback = callback;\n     }\n+\n+    public JSONObject toJSONObject() throws JSONException {\n+        JSONObject jsonObject = new JSONObject();\n+        jsonObject.put(\"apiKey\", this.apiKey);\n+        jsonObject.put(\"endPoint\", this.resourcePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/2a4b22714a65fbbf2b82f4c797ffbfc31f9c6e2a", "committedDate": "2020-12-08T02:02:02Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}, "afterCommit": {"oid": "94ec5152f53a413cfa848299e0507796f1c58467", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/94ec5152f53a413cfa848299e0507796f1c58467", "committedDate": "2020-12-08T07:36:39Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODI4NTEz", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-547828513", "createdAt": "2020-12-09T04:35:08Z", "commit": {"oid": "94ec5152f53a413cfa848299e0507796f1c58467"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNDozNTowOFrOICB5QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNDozNTowOFrOICB5QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTEwNQ==", "bodyText": "formatting", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#discussion_r538999105", "createdAt": "2020-12-09T04:35:08Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/OfflineRequestProcessor.java", "diffHunk": "@@ -3,17 +3,74 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import org.json.JSONException;\n import org.json.JSONObject;\n \n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n public class OfflineRequestProcessor implements RequestProcessor {\n \n+\n     @Override\n     public void processGetRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.IterableActionHandler onCallback) {\n-\n+        //Invoke taskScheduler and add task to database\n     }\n \n     @Override\n     public void processPostRequest(@Nullable String apiKey, @NonNull String resourcePath, @NonNull JSONObject json, String authToken, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableApiRequest request = new IterableApiRequest(apiKey, resourcePath, json, IterableApiRequest.POST, authToken, onSuccess, onFailure);\n+        TaskScheduler taskScheduler = new TaskScheduler();\n+        taskScheduler.scheduleTask(request, onSuccess, onFailure);\n+    }\n+}\n+\n+//Placeholder Taskschedular for testing purpose.\n+class TaskScheduler {\n+\n+    static HashMap<String, IterableHelper.SuccessHandler> successCallbackMap = new HashMap<>();\n+    static HashMap<String, IterableHelper.FailureHandler> failureCallbackMap = new HashMap<>();\n+\n+    void scheduleTask(IterableApiRequest request, @Nullable IterableHelper.SuccessHandler onSuccess, @Nullable IterableHelper.FailureHandler onFailure) {\n+        IterableTaskManager taskManager = IterableTaskManager.sharedInstance(IterableApi.getInstance().getMainActivityContext());\n+        JSONObject serializedRequest = null;\n+        try {\n+            serializedRequest = request.toJSONObject();\n+        } catch (JSONException e) {\n+            IterableLogger.e(\"RequestProcessor\", \"Failed serializating the request for offline execution. Attempting to request the request now...\");\n+            new IterableRequest().execute(request);\n+            return;\n+        }\n+\n+        String taskId = taskManager.createTask(request.resourcePath, IterableTaskType.API, serializedRequest.toString());\n+\n+        successCallbackMap.put(taskId, onSuccess);\n+        failureCallbackMap.put(taskId, onFailure);\n+\n+        processTasks();\n+    }\n+\n+    //Temporary function to convert database offline task to ITerableReuqest and execute.\n+    void processTasks() {\n+        IterableTaskManager taskManager = IterableTaskManager.sharedInstance(IterableApi.getInstance().getMainActivityContext());\n+        ArrayList<String> taskIds = taskManager.getAllTaskIds();\n+        for (String id : taskIds\n+        ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94ec5152f53a413cfa848299e0507796f1c58467"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c43cd0a60a1484762be178c64985709cea5b986", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/7c43cd0a60a1484762be178c64985709cea5b986", "committedDate": "2020-12-09T19:45:50Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94ec5152f53a413cfa848299e0507796f1c58467", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/94ec5152f53a413cfa848299e0507796f1c58467", "committedDate": "2020-12-08T07:36:39Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}, "afterCommit": {"oid": "7c43cd0a60a1484762be178c64985709cea5b986", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/7c43cd0a60a1484762be178c64985709cea5b986", "committedDate": "2020-12-09T19:45:50Z", "message": "Revision 1\n\n1. Added test methods\n2. Renamed variables as discussed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NjkxNTYw", "url": "https://github.com/Iterable/iterable-android-sdk/pull/293#pullrequestreview-548691560", "createdAt": "2020-12-09T23:12:31Z", "commit": {"oid": "7c43cd0a60a1484762be178c64985709cea5b986"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 560, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}