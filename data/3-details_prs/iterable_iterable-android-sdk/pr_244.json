{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMzAzODI4", "number": 244, "title": "[MOB-1788] Clear in-app messages on logout", "bodyText": "Make sure we clear the in-app queue immediately on logout.", "createdAt": "2020-07-02T06:27:20Z", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244", "merged": true, "mergeCommit": {"oid": "cb79f80f208b962e38ce5f6d95ed028d8bb7debf"}, "closed": true, "closedAt": "2020-07-20T17:49:21Z", "author": {"login": "vbabenkoru"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw44tEABqjM1MDU1NjEyMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc21KdRgBqjM1NjcwMTcwMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a5697abc0c8aa2d34ad5256b03279297cf53f30", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/0a5697abc0c8aa2d34ad5256b03279297cf53f30", "committedDate": "2020-07-02T06:26:32Z", "message": "Clear in-app messages on logout"}, "afterCommit": {"oid": "d275915c51379fd0ee0e3d3c081f087cbb67d336", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d275915c51379fd0ee0e3d3c081f087cbb67d336", "committedDate": "2020-07-02T06:30:57Z", "message": "Clear in-app messages on logout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/fb02c1699670800de502e3eccdde6149be7ea840", "committedDate": "2020-07-02T06:40:20Z", "message": "Clear in-app messages on logout"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d275915c51379fd0ee0e3d3c081f087cbb67d336", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d275915c51379fd0ee0e3d3c081f087cbb67d336", "committedDate": "2020-07-02T06:30:57Z", "message": "Clear in-app messages on logout"}, "afterCommit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/fb02c1699670800de502e3eccdde6149be7ea840", "committedDate": "2020-07-02T06:40:20Z", "message": "Clear in-app messages on logout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDU0NTEw", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#pullrequestreview-442054510", "createdAt": "2020-07-02T22:35:45Z", "commit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjozNTo0NVrOGseyiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjozNTo0NVrOGseyiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5NDk4Nw==", "bodyText": "Even after login if we haven't initialized, shouldn\u2019t we attempt to initialize??", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#discussion_r449294987", "createdAt": "2020-07-02T22:35:45Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -1328,13 +1328,22 @@ private void retrieveEmailAndUserId() {\n     }\n \n     private void onLogOut() {\n-        if (config.autoPushRegistration && isInitialized()) {\n+        if (!isInitialized()) {\n+            return;\n+        }\n+\n+        if (config.autoPushRegistration) {\n             disablePush();\n         }\n+        getInAppManager().reset();\n     }\n \n     private void onLogIn() {\n-        if (config.autoPushRegistration && isInitialized()) {\n+        if (!isInitialized()) {\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDU1MTMz", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#pullrequestreview-442055133", "createdAt": "2020-07-02T22:37:41Z", "commit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjozNzo0MVrOGse0-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjozNzo0MVrOGse0-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5NTYxMQ==", "bodyText": "Feels like reset name should be for something which is resetting everything...\nMay be more specific name like clearAllMessagesFromLocalStorage()", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#discussion_r449295611", "createdAt": "2020-07-02T22:37:41Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppManager.java", "diffHunk": "@@ -167,6 +167,20 @@ public void execute(String payload) {\n         });\n     }\n \n+    /**\n+     * Clear all in-app messages.\n+     * Should be called on user logout.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDU1NTYz", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#pullrequestreview-442055563", "createdAt": "2020-07-02T22:39:03Z", "commit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjozOTowM1rOGse2Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjozOTowM1rOGse2Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5NTkxNA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#discussion_r449295914", "createdAt": "2020-07-02T22:39:03Z", "author": {"login": "Ayyanchira"}, "path": "iterableapi/src/test/java/com/iterable/iterableapi/IterableInAppManagerTest.java", "diffHunk": "@@ -150,6 +150,20 @@ public void testSyncInApp() throws Exception {\n         assertEquals(\"Q19mD2NlQUnxnmSGuQu9ujzkKR6c12TogeaGA29\", inAppManager.getMessages().get(0).getMessageId());\n     }\n \n+    @Test\n+    public void testReset() throws Exception {\n+        dispatcher.enqueueResponse(\"/inApp/getMessages\", new MockResponse().setBody(IterableTestUtils.getResourceString(\"inapp_payload_single.json\")));\n+        IterableInAppManager inAppManager = IterableApi.getInstance().getInAppManager();\n+        assertEquals(0, inAppManager.getMessages().size());\n+\n+        inAppManager.syncInApp();\n+        Robolectric.flushBackgroundThreadScheduler();\n+        Robolectric.flushForegroundThreadScheduler();\n+        assertEquals(1, inAppManager.getMessages().size());\n+        inAppManager.reset();\n+        assertEquals(0, inAppManager.getMessages().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjY2NTkw", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#pullrequestreview-443266590", "createdAt": "2020-07-06T17:15:48Z", "commit": {"oid": "fb02c1699670800de502e3eccdde6149be7ea840"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDM0ODcy", "url": "https://github.com/Iterable/iterable-android-sdk/pull/244#pullrequestreview-443434872", "createdAt": "2020-07-06T22:00:52Z", "commit": {"oid": "d10af378cbce5dfe4c6022d18df8c204fd7ca0c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d372a48bcfc75aea7420f4dee6a3c89fd2f2f7d5", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d372a48bcfc75aea7420f4dee6a3c89fd2f2f7d5", "committedDate": "2020-07-20T17:34:14Z", "message": "Reset in-app messages even if there is no user"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d10af378cbce5dfe4c6022d18df8c204fd7ca0c7", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d10af378cbce5dfe4c6022d18df8c204fd7ca0c7", "committedDate": "2020-07-06T17:25:42Z", "message": "Reset in-app messages even if there is no user"}, "afterCommit": {"oid": "d372a48bcfc75aea7420f4dee6a3c89fd2f2f7d5", "author": {"user": {"login": "vbabenkoru", "name": "Victor Babenko"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/d372a48bcfc75aea7420f4dee6a3c89fd2f2f7d5", "committedDate": "2020-07-20T17:34:14Z", "message": "Reset in-app messages even if there is no user"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 637, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}