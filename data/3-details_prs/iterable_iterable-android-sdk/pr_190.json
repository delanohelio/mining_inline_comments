{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNjEzNTI2", "number": 190, "title": "[MOB-1157] - Retain data during configuration change", "bodyText": "Globally saves urlCallBack and location.\nRetains if the view is going to reload. If not, it will assign the stored variable to null.", "createdAt": "2020-02-04T02:20:13Z", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190", "merged": true, "mergeCommit": {"oid": "9a6ca54bcf9125f4b6c6d48673ce4530e9621009"}, "closed": true, "closedAt": "2020-02-10T19:35:35Z", "author": {"login": "Ayyanchira"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBKXAPgFqTM1MzM4MTkyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDB9ougFqTM1NjE4NjkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzgxOTIx", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#pullrequestreview-353381921", "createdAt": "2020-02-04T23:44:11Z", "commit": {"oid": "81e0acefdf2a9aff505e50de404fe7d9eee62f22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMzo0NDoxMVrOFlnbjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMzo0NDoxMVrOFlnbjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk4NzY2Mw==", "bodyText": "Fragment itself does this\n        FragmentActivity activity = this.getActivity();\n        boolean isChangingConfigurations = activity != null && activity.isChangingConfigurations();\n        if (this.mViewModelStore != null && !isChangingConfigurations) {\n            this.mViewModelStore.clear();\n        }\n\nLooks like we can use a similar check for whether it's being destroyed because of a configuration change.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#discussion_r374987663", "createdAt": "2020-02-04T23:44:11Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -90,6 +91,25 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n             htmlString = args.getString(\"html\", null);\n             callbackOnCancel = args.getBoolean(\"callbackOnCancel\", false);\n         }\n+        isReloading = false;\n+        setCallback(IterableInAppDisplayer.urlCallBack);\n+        setLocation(IterableInAppDisplayer.location);\n+    }\n+\n+    @Override\n+    public void onSaveInstanceState(Bundle outState) {\n+        super.onSaveInstanceState(outState);\n+        isReloading = true;\n+        outState.putBoolean(\"isReloading\", true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81e0acefdf2a9aff505e50de404fe7d9eee62f22"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzgyMTM1", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#pullrequestreview-353382135", "createdAt": "2020-02-04T23:44:44Z", "commit": {"oid": "81e0acefdf2a9aff505e50de404fe7d9eee62f22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMzo0NDo0NFrOFlncKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMzo0NDo0NFrOFlncKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk4NzgxNw==", "bodyText": "This is not necessary, callbackOnCancel is already handled in IterableInAppFragmentHTMLNotification.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#discussion_r374987817", "createdAt": "2020-02-04T23:44:44Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppDisplayer.java", "diffHunk": "@@ -101,7 +105,16 @@ static boolean showIterableFragmentNotificationHTML(Context context, String html\n                 notification.setBackgroundAlpha(backgroundAlpha);\n                 notification.setPadding(padding);\n                 notification.setLocation(location);\n-\n+                \n+//                TODO: Callback on cancel for DialogFragment needs to be implemented", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81e0acefdf2a9aff505e50de404fe7d9eee62f22"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81e0acefdf2a9aff505e50de404fe7d9eee62f22", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/81e0acefdf2a9aff505e50de404fe7d9eee62f22", "committedDate": "2020-02-04T02:18:38Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}, "afterCommit": {"oid": "5ccd154520b264b7bee004c0b0dd536d2cdf41c5", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/5ccd154520b264b7bee004c0b0dd536d2cdf41c5", "committedDate": "2020-02-05T19:48:15Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ccd154520b264b7bee004c0b0dd536d2cdf41c5", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/5ccd154520b264b7bee004c0b0dd536d2cdf41c5", "committedDate": "2020-02-05T19:48:15Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}, "afterCommit": {"oid": "f49af43b621877fe0f9d7ace25a290b0bdc58da2", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/f49af43b621877fe0f9d7ace25a290b0bdc58da2", "committedDate": "2020-02-05T19:53:29Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTMxOTUy", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#pullrequestreview-354131952", "createdAt": "2020-02-06T00:22:02Z", "commit": {"oid": "f49af43b621877fe0f9d7ace25a290b0bdc58da2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoyMjowM1rOFmLsrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoyNTozMVrOFmLwQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MTg2OQ==", "bodyText": "This assigns the static variables before the checks that follow. It is possible that the callback will be assigned, but no in-app message will get spawned. I think it might be better to move these variables to IterableInAppFragmentHTMLNotification class instead and pass them through createInstance...", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#discussion_r375581869", "createdAt": "2020-02-06T00:22:03Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppDisplayer.java", "diffHunk": "@@ -87,6 +89,8 @@ public void onCancel(DialogInterface dialog) {\n      * @param padding\n      */\n     static boolean showIterableFragmentNotificationHTML(Context context, String htmlString, String messageId, final IterableHelper.IterableUrlCallback clickCallback, double backgroundAlpha, Rect padding, boolean callbackOnCancel, IterableInAppLocation location) {\n+        IterableInAppDisplayer.urlCallBack = clickCallback;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f49af43b621877fe0f9d7ace25a290b0bdc58da2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MjMxMA==", "bodyText": "isShowingInApp is still referencing the old class, so this line may not be safe to switch without changing it.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#discussion_r375582310", "createdAt": "2020-02-06T00:23:45Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppDisplayer.java", "diffHunk": "@@ -22,7 +24,7 @@ boolean showMessage(IterableInAppMessage message, IterableInAppLocation location\n         Activity currentActivity = activityMonitor.getCurrentActivity();\n         // Prevent double display\n         if (currentActivity != null) {\n-            return IterableInAppDisplayer.showIterableNotificationHTML(currentActivity,\n+            return IterableInAppDisplayer.showIterableFragmentNotificationHTML(currentActivity,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f49af43b621877fe0f9d7ace25a290b0bdc58da2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4Mjc4Ng==", "bodyText": "Might also be more correct to move notification = null; to onDestroy (and only reset it if the dialog isn't being recreated because of a configuration change).", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#discussion_r375582786", "createdAt": "2020-02-06T00:25:31Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppDisplayer.java", "diffHunk": "@@ -22,7 +24,7 @@ boolean showMessage(IterableInAppMessage message, IterableInAppLocation location\n         Activity currentActivity = activityMonitor.getCurrentActivity();\n         // Prevent double display\n         if (currentActivity != null) {\n-            return IterableInAppDisplayer.showIterableNotificationHTML(currentActivity,\n+            return IterableInAppDisplayer.showIterableFragmentNotificationHTML(currentActivity,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MjMxMA=="}, "originalCommit": {"oid": "f49af43b621877fe0f9d7ace25a290b0bdc58da2"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f49af43b621877fe0f9d7ace25a290b0bdc58da2", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/f49af43b621877fe0f9d7ace25a290b0bdc58da2", "committedDate": "2020-02-05T19:53:29Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}, "afterCommit": {"oid": "e4cc8173acf32fd40d03a8430b9432669a69b1ab", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/e4cc8173acf32fd40d03a8430b9432669a69b1ab", "committedDate": "2020-02-06T17:09:42Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1Njk3MjU4", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#pullrequestreview-355697258", "createdAt": "2020-02-10T05:27:09Z", "commit": {"oid": "e4cc8173acf32fd40d03a8430b9432669a69b1ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNToyNzowOVrOFnaiDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNToyNzowOVrOFnaiDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MzQ4Nw==", "bodyText": "I think we should only switch to IterableInAppFragmentHTMLNotification when all known issues are resolved. Right now it doesn't retain some properties on rotation and uses a default DialogFragment animation.", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#discussion_r376873487", "createdAt": "2020-02-10T05:27:09Z", "author": {"login": "vbabenkoru"}, "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppDisplayer.java", "diffHunk": "@@ -15,14 +15,14 @@\n     }\n \n     boolean isShowingInApp() {\n-        return IterableInAppHTMLNotification.getInstance() != null;\n+        return IterableInAppFragmentHTMLNotification.getInstance() != null;\n     }\n \n     boolean showMessage(IterableInAppMessage message, IterableInAppLocation location, final IterableHelper.IterableUrlCallback clickCallback) {\n         Activity currentActivity = activityMonitor.getCurrentActivity();\n         // Prevent double display\n         if (currentActivity != null) {\n-            return IterableInAppDisplayer.showIterableNotificationHTML(currentActivity,\n+            return IterableInAppDisplayer.showIterableFragmentNotificationHTML(currentActivity,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4cc8173acf32fd40d03a8430b9432669a69b1ab"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ecd3398b650ea7a0861f7af35cc6feb07cbb79e", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/9ecd3398b650ea7a0861f7af35cc6feb07cbb79e", "committedDate": "2020-02-10T18:20:40Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4cc8173acf32fd40d03a8430b9432669a69b1ab", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/e4cc8173acf32fd40d03a8430b9432669a69b1ab", "committedDate": "2020-02-06T17:09:42Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}, "afterCommit": {"oid": "9ecd3398b650ea7a0861f7af35cc6feb07cbb79e", "author": {"user": {"login": "Ayyanchira", "name": "Akshay Ayyanchira"}}, "url": "https://github.com/Iterable/iterable-android-sdk/commit/9ecd3398b650ea7a0861f7af35cc6feb07cbb79e", "committedDate": "2020-02-10T18:20:40Z", "message": "[MOB-1157] - Retain data for during configuration change\n\nGlobally saves urlCallBack and location.\nRetains if the view is going to reload. If not it will assign the stored variable to null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MTg2OTM0", "url": "https://github.com/Iterable/iterable-android-sdk/pull/190#pullrequestreview-356186934", "createdAt": "2020-02-10T19:05:05Z", "commit": {"oid": "9ecd3398b650ea7a0861f7af35cc6feb07cbb79e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 595, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}