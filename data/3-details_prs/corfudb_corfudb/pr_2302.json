{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMjAxMDc0", "number": 2302, "title": "State Transfer Codec overwrite fix", "bodyText": "Overview\nIn the case of data written with a different codec than that used by the State Transfer runtime, we would overwrite the codec of compressed data. Making it imposible for a runtime reader to decompress correctly.\nA test has been added to confirm this.", "createdAt": "2020-01-07T22:28:39Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302", "merged": true, "mergeCommit": {"oid": "21b2c576672c00b72c35962a6f20177ec433e552"}, "closed": true, "closedAt": "2020-01-08T00:38:34Z", "author": {"login": "annym"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4Ic0CAH2gAyMzYwMjAxMDc0OjJlZjE0NTk3YjU5NzUzYzJjNGY5NGIwYmUxNDZjMjViNTdjMzY5OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4I7i1AFqTMzOTU2MTI1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/2ef14597b59753c2c4f94b0be146c25b57c36996", "committedDate": "2020-01-07T22:25:24Z", "message": "State Transfer Codec overwrite fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTUwNTcy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#pullrequestreview-339550572", "createdAt": "2020-01-07T22:32:44Z", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTUxMjk1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#pullrequestreview-339551295", "createdAt": "2020-01-07T22:34:35Z", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjozNDozNVrOFbH4kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjozNDozNVrOFbH4kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk4NTA0MA==", "bodyText": "Issue found: Avoid really long methods.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#discussion_r363985040", "createdAt": "2020-01-07T22:34:35Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/runtime/view/StateTransferTest.java", "diffHunk": "@@ -632,4 +634,131 @@ public void verifyConcurrentStateTransferCompletion() throws Exception {\n         assertThat(corfuRuntime.getLayoutView().getLayout().getSegments().size())\n                 .isEqualTo(1);\n     }\n+\n+\n+    /**\n+     * Here we test the capability of state transfer mechanism to preserve codec info, regardless of the configuration\n+     * that state transfer runtime has.\n+     *\n+     * This test first writes data with none default codecs (default being ZSTD), in the following way:\n+     * 0-2 [inclusive] write data to Node0 with codec LZ4\n+     * 3-5 [inclusive] write data to Node 0, Node1 with NO codec (NONE)\n+     *\n+     * We then add a third node, and let state transfer complete. Finally, we read all the data to confirm\n+     * we are able to decompress all the data after state transfer.\n+     **/\n+    @Test\n+    public void testStateTransferWithNoneDefaultCodec() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTUxNDg3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#pullrequestreview-339551487", "createdAt": "2020-01-07T22:35:07Z", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTUxNTAw", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#pullrequestreview-339551500", "createdAt": "2020-01-07T22:35:10Z", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTU2ODY4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#pullrequestreview-339556868", "createdAt": "2020-01-07T22:48:00Z", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjo0ODowMFrOFbIKMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjo0ODowMFrOFbIKMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk4OTU1NQ==", "bodyText": "I actually did this intentionally; assuming that the client and the server bits have the same codecs. The reason is, to load the new server/client version with an old data log (i.e. uncompressed), and the data can be compressed by bouncing the servers one-by-one to trigger state transfer and compress the data without having to rewrite it via checkpoint. Maybe that's not a deal breaker, but its just something for you to consider.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#discussion_r363989555", "createdAt": "2020-01-07T22:48:00Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/orchestrator/actions/StateTransfer.java", "diffHunk": "@@ -221,7 +221,6 @@ private static void transferChunk(Layout layout,\n                 throw new IllegalStateException(\"Missing address\");\n             }\n             LogData ld = (LogData) dataMap.get(address);\n-            ld.setPayloadCodecType(Codec.Type.valueOf(runtime.getParameters().getCodecType()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTYxMjU1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2302#pullrequestreview-339561255", "createdAt": "2020-01-07T22:58:58Z", "commit": {"oid": "2ef14597b59753c2c4f94b0be146c25b57c36996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3387, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}