{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NTE1MTk4", "number": 2792, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo0Njo1N1rOEupYCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjozODozNlrOEus5Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MzQ3ODQ4OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/CorfuReplicationDiscoveryService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo0Njo1N1rOHjMKNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTowNjoxNlrOHjMt1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY2MTQyOA==", "bodyText": "can we add a logging warning if no Node Id file path is found?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2792#discussion_r506661428", "createdAt": "2020-10-16T18:46:57Z", "author": {"login": "annym"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/CorfuReplicationDiscoveryService.java", "diffHunk": "@@ -864,4 +875,20 @@ private void updateReplicationStatus() {\n             statusFlag = true;\n         }\n     }\n+\n+    private void setupLocalNodeId() {\n+        // Retrieve system-specific node id\n+        LogReplicationPluginConfig config = new LogReplicationPluginConfig(serverContext.getPluginConfigFilePath());\n+        String nodeIdFilePath = config.getNodeIdFilePath();\n+        if (nodeIdFilePath != null) {\n+            File nodeIdFile = new File(nodeIdFilePath);\n+            try (BufferedReader bufferedReader = new BufferedReader(new FileReader(nodeIdFile))) {\n+                String line = bufferedReader.readLine();\n+                localNodeId = Optional.of(line.split(\"=\")[1].trim().toLowerCase());\n+                log.info(\"setupLocalNodeId succeeded, node id is {}\", localNodeId);\n+            } catch (Exception e) {\n+                log.warn(\"setupLocalNodeId failed\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d32ba3151aeb089115ef9acc13343d2ed0a8cb32"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3MDU0OA==", "bodyText": "Added", "url": "https://github.com/CorfuDB/CorfuDB/pull/2792#discussion_r506670548", "createdAt": "2020-10-16T19:06:16Z", "author": {"login": "zhangn49"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/CorfuReplicationDiscoveryService.java", "diffHunk": "@@ -864,4 +875,20 @@ private void updateReplicationStatus() {\n             statusFlag = true;\n         }\n     }\n+\n+    private void setupLocalNodeId() {\n+        // Retrieve system-specific node id\n+        LogReplicationPluginConfig config = new LogReplicationPluginConfig(serverContext.getPluginConfigFilePath());\n+        String nodeIdFilePath = config.getNodeIdFilePath();\n+        if (nodeIdFilePath != null) {\n+            File nodeIdFile = new File(nodeIdFilePath);\n+            try (BufferedReader bufferedReader = new BufferedReader(new FileReader(nodeIdFile))) {\n+                String line = bufferedReader.readLine();\n+                localNodeId = Optional.of(line.split(\"=\")[1].trim().toLowerCase());\n+                log.info(\"setupLocalNodeId succeeded, node id is {}\", localNodeId);\n+            } catch (Exception e) {\n+                log.warn(\"setupLocalNodeId failed\", e);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY2MTQyOA=="}, "originalCommit": {"oid": "d32ba3151aeb089115ef9acc13343d2ed0a8cb32"}, "originalPosition": 134}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MzQ4NDMxOnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/plugins/LogReplicationPluginConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo0ODo1MVrOHjMNyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTowNzowNlrOHjMvUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY2MjM0Ng==", "bodyText": "Can you add a comment on the method that specifies the format in which the node must be written in this file? for future reference..", "url": "https://github.com/CorfuDB/CorfuDB/pull/2792#discussion_r506662346", "createdAt": "2020-10-16T18:48:51Z", "author": {"login": "annym"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/plugins/LogReplicationPluginConfig.java", "diffHunk": "@@ -83,6 +86,8 @@ public LogReplicationPluginConfig(String filepath) {\n \n             this.topologyManagerAdapterJARPath = prop.getProperty(\"topology_manager_adapter_JAR_path\");\n             this.topologyManagerAdapterName = prop.getProperty(\"topology_manager_adapter_class_name\");\n+\n+            this.nodeIdFilePath = prop.getProperty(\"local_node_id_path\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d32ba3151aeb089115ef9acc13343d2ed0a8cb32"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3MDkyOQ==", "bodyText": "Added file format :\n\nnode_id=99F30C42-F96D-A0A7-5531-468E52926A01", "url": "https://github.com/CorfuDB/CorfuDB/pull/2792#discussion_r506670929", "createdAt": "2020-10-16T19:07:06Z", "author": {"login": "zhangn49"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/plugins/LogReplicationPluginConfig.java", "diffHunk": "@@ -83,6 +86,8 @@ public LogReplicationPluginConfig(String filepath) {\n \n             this.topologyManagerAdapterJARPath = prop.getProperty(\"topology_manager_adapter_JAR_path\");\n             this.topologyManagerAdapterName = prop.getProperty(\"topology_manager_adapter_class_name\");\n+\n+            this.nodeIdFilePath = prop.getProperty(\"local_node_id_path\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY2MjM0Ng=="}, "originalCommit": {"oid": "d32ba3151aeb089115ef9acc13343d2ed0a8cb32"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3NDA1NDYyOnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/plugins/LogReplicationPluginConfig.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjozODozNlrOHjRk5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjozODozNlrOHjRk5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MDE4Mw==", "bodyText": "can we only say 'nodeId format'?  what does 'file' mean here?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2792#discussion_r506750183", "createdAt": "2020-10-16T22:38:36Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/plugins/LogReplicationPluginConfig.java", "diffHunk": "@@ -67,6 +67,11 @@\n     @Getter\n     private String snapshotSyncPluginCanonicalName;\n \n+    // nodeId file format:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47c5323c80c5e0dcf11430d27e36ff598dfd1cd1"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1726, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}