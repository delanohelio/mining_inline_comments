{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNjgzNjA5", "number": 2306, "title": "CorfuStoreBrowser: Support infoTable and dropTable", "bodyText": "Overview\nCallers want a way to clear the contents of a CorfuStore table via CLI.\nThey also want a way to just show the size of a table without actually dumping the whole content.", "createdAt": "2020-01-11T02:11:05Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306", "merged": true, "mergeCommit": {"oid": "671c55568feba427e327bdb89fa1f4409ca5bb2a"}, "closed": true, "closedAt": "2020-01-14T01:44:49Z", "author": {"login": "hisundar"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5j37tgFqTM0MTU2MTU3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6G4MqgFqTM0MjI0ODYxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTYxNTc0", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#pullrequestreview-341561574", "createdAt": "2020-01-12T08:52:48Z", "commit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwODo1Mjo0OFrOFcoc4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwODo1NDo1OVrOFcodag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2NzIwMQ==", "bodyText": "what if namespace or/and table doesn't exist?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#discussion_r365567201", "createdAt": "2020-01-12T08:52:48Z", "author": {"login": "xnull"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -81,10 +82,23 @@ public void listTables(String namespace)\n     {\n         log.info(\"\\n=====Tables=======\\n\");\n         for (CorfuStoreMetadata.TableName tableName : runtime.getTableRegistry()\n-            .listTables(namespace)) {\n+                .listTables(namespace)) {\n             log.info(\"Table: \" + tableName.getTableName());\n             log.info(\"Namespace: \" + tableName.getNamespace());\n         }\n         log.info(\"\\n======================\\n\");\n     }\n+\n+    /**\n+     * Print information about a specific table in CorfuStore\n+     */\n+    public void printTableInfo(String namespace, String tablename) {\n+        log.info(\"\\n======================\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2NzI4OA==", "bodyText": "let's use Optional here and avoid using null-s", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#discussion_r365567288", "createdAt": "2020-01-12T08:54:01Z", "author": {"login": "xnull"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowserMain.java", "diffHunk": "@@ -75,17 +75,23 @@ public static void main(String[] args) {\n             log.info(\"Successfully connected to {}\", singleNodeEndpoint);\n \n             CorfuStoreBrowser browser = new CorfuStoreBrowser(runtime);\n+            CorfuTable<CorfuDynamicKey, CorfuDynamicRecord> table;\n+            String namespace = opts.containsKey(\"--namespace\") ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2NzMwNA==", "bodyText": "same here", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#discussion_r365567304", "createdAt": "2020-01-12T08:54:19Z", "author": {"login": "xnull"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowserMain.java", "diffHunk": "@@ -75,17 +75,23 @@ public static void main(String[] args) {\n             log.info(\"Successfully connected to {}\", singleNodeEndpoint);\n \n             CorfuStoreBrowser browser = new CorfuStoreBrowser(runtime);\n+            CorfuTable<CorfuDynamicKey, CorfuDynamicRecord> table;\n+            String namespace = opts.containsKey(\"--namespace\") ?\n+                    opts.get(\"--namespace\").toString() : null;\n+            String tableName = opts.containsKey(\"--tablename\") ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2NzMzOA==", "bodyText": "please use an enum instead of strings", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#discussion_r365567338", "createdAt": "2020-01-12T08:54:59Z", "author": {"login": "xnull"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowserMain.java", "diffHunk": "@@ -75,17 +75,23 @@ public static void main(String[] args) {\n             log.info(\"Successfully connected to {}\", singleNodeEndpoint);\n \n             CorfuStoreBrowser browser = new CorfuStoreBrowser(runtime);\n+            CorfuTable<CorfuDynamicKey, CorfuDynamicRecord> table;\n+            String namespace = opts.containsKey(\"--namespace\") ?\n+                    opts.get(\"--namespace\").toString() : null;\n+            String tableName = opts.containsKey(\"--tablename\") ?\n+                    opts.get(\"--tablename\").toString() : null;\n             switch (operation) {\n                 case \"listTables\":\n-                    String namespace = opts.containsKey(\"--namespace\") ?\n-                        opts.get(\"--namespace\").toString() : null;\n                     browser.listTables(namespace);\n                     break;\n-\n+                case \"infoTable\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMTMxODYy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#pullrequestreview-342131862", "createdAt": "2020-01-13T20:54:40Z", "commit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMDo1NDo0MFrOFdEQbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMDo1NDo0MFrOFdEQbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjAyMjc2Ng==", "bodyText": "Use {} as a placeholder to make this statement clearer.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#discussion_r366022766", "createdAt": "2020-01-13T20:54:40Z", "author": {"login": "lixinchengdu"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -81,10 +82,23 @@ public void listTables(String namespace)\n     {\n         log.info(\"\\n=====Tables=======\\n\");\n         for (CorfuStoreMetadata.TableName tableName : runtime.getTableRegistry()\n-            .listTables(namespace)) {\n+                .listTables(namespace)) {\n             log.info(\"Table: \" + tableName.getTableName());\n             log.info(\"Namespace: \" + tableName.getNamespace());\n         }\n         log.info(\"\\n======================\\n\");\n     }\n+\n+    /**\n+     * Print information about a specific table in CorfuStore\n+     */\n+    public void printTableInfo(String namespace, String tablename) {\n+        log.info(\"\\n======================\\n\");\n+        String fullName = TableRegistry.getFullyQualifiedTableName(namespace, tablename);\n+        UUID streamUUID = UUID.nameUUIDFromBytes(fullName.getBytes());\n+        CorfuTable<CorfuDynamicKey, CorfuDynamicRecord> table = getTable(namespace, tablename);\n+        log.info(\"Table \" + tablename + \" in namespace \" + namespace", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27", "committedDate": "2020-01-13T23:39:41Z", "message": "CorfuStoreBrowser: Support infoTable and dropTable\n\ninfoTable prints the size without iterating the contents.\ndropTable allows clearing entries of a large table."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/5ba85c2ac4d354ffc8c8fda3465988b0eb0c4c94", "committedDate": "2020-01-11T02:09:55Z", "message": "CorfuStoreBrowser: Support infoTable and dropTable"}, "afterCommit": {"oid": "47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27", "committedDate": "2020-01-13T23:39:41Z", "message": "CorfuStoreBrowser: Support infoTable and dropTable\n\ninfoTable prints the size without iterating the contents.\ndropTable allows clearing entries of a large table."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjQ4MjA3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#pullrequestreview-342248207", "createdAt": "2020-01-14T01:41:33Z", "commit": {"oid": "47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMTo0MTozNFrOFdJ_pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMTo0MTozNFrOFdJ_pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExNjc3Mg==", "bodyText": "we can just call verifyNamespace here", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#discussion_r366116772", "createdAt": "2020-01-14T01:41:34Z", "author": {"login": "pankti-m"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowserMain.java", "diffHunk": "@@ -19,6 +20,28 @@\n  */\n @Slf4j\n public class CorfuStoreBrowserMain {\n+    private enum OperationType {\n+        listTables,\n+        infoTable,\n+        showTable,\n+        dropTable\n+    }\n+\n+    private static void verifyNamespace(String namespace) {\n+        if (namespace == null) {\n+            throw new IllegalArgumentException(\"Please specify --namespace\");\n+        }\n+    }\n+\n+    private static void verifyNamespaceAndTablename(String namespace, String tableName) {\n+        if (namespace == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjQ4NjE4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2306#pullrequestreview-342248618", "createdAt": "2020-01-14T01:43:21Z", "commit": {"oid": "47ac9cd42ea2b7a55c06e483ea5c348ae67f6c27"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3393, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}