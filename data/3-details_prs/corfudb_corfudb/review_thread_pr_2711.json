{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NjAxNDQ4", "number": 2711, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTo0MTo1MFrOEYPx2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowM1rOEZvVRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODU5ODAyOnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTo0MTo1MFrOHAeuCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0NTo0MVrOHB2rZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2NTM1NQ==", "bodyText": "I think we still need the catch block for TimeoutException.\nThere are two kinds of TimeoutException:\n\nFrom the actual sendMsg's CF, this type will be wrapped with the ExecutionException \nFrom anyOf(cfs).get(long timeout, TimeUnit unit)", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r470265355", "createdAt": "2020-08-13T21:41:50Z", "author": {"login": "zhangn49"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "diffHunk": "@@ -175,20 +175,20 @@ public void sendWithBuffering(List<LogReplicationEntry> dataToSend) {\n \n     /**\n      * Resend the messages in the queue if they have timed out.\n-     * @return false, if an entry has been resent MAX_RETRY.\n-     *         true, otherwise\n      */\n     public LogReplicationEntry resend() {\n-        //Enforce a resend or not\n         LogReplicationEntry ack = null;\n         boolean force = false;\n         try {\n             ack = processAcks();\n-        } catch (TimeoutException e) {\n-            log.warn(\"Caught a timeout exception \", e);\n-            force = true;\n+        } catch (ExecutionException ee) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bac6a4b6c6edee1e24da7b05b0ef2fddea68a0b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwNjQ2OQ==", "bodyText": "Yes, you're right. Added a catch on TimeoutException as well...", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r471706469", "createdAt": "2020-08-17T18:45:41Z", "author": {"login": "annym"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "diffHunk": "@@ -175,20 +175,20 @@ public void sendWithBuffering(List<LogReplicationEntry> dataToSend) {\n \n     /**\n      * Resend the messages in the queue if they have timed out.\n-     * @return false, if an entry has been resent MAX_RETRY.\n-     *         true, otherwise\n      */\n     public LogReplicationEntry resend() {\n-        //Enforce a resend or not\n         LogReplicationEntry ack = null;\n         boolean force = false;\n         try {\n             ack = processAcks();\n-        } catch (TimeoutException e) {\n-            log.warn(\"Caught a timeout exception \", e);\n-            force = true;\n+        } catch (ExecutionException ee) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2NTM1NQ=="}, "originalCommit": {"oid": "6bac6a4b6c6edee1e24da7b05b0ef2fddea68a0b"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MjM4NDE4OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNjozMDo0M1rOHCci_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNjozMDo0M1rOHCci_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMyNjkwOA==", "bodyText": "Can you add comments to explain what can lead this exception?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472326908", "createdAt": "2020-08-18T16:30:43Z", "author": {"login": "xiaoqin2012"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "diffHunk": "@@ -175,36 +174,32 @@ public void sendWithBuffering(List<LogReplicationEntry> dataToSend) {\n \n     /**\n      * Resend the messages in the queue if they have timed out.\n-     * @return false, if an entry has been resent MAX_RETRY.\n-     *         true, otherwise\n      */\n     public LogReplicationEntry resend() {\n-        //Enforce a resend or not\n         LogReplicationEntry ack = null;\n         boolean force = false;\n         try {\n             ack = processAcks();\n-        } catch (TimeoutException e) {\n-            log.warn(\"Caught a timeout exception \", e);\n+        } catch (TimeoutException te) {\n+            log.warn(\"Caught a timeout exception while processing ACKs\", te);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "129d491dd3a02c94b57917793b1251c93b191ad9"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MjM4Nzc4OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNjozMTozMVrOHCclIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNjozMTozMVrOHCclIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMyNzQ1Ng==", "bodyText": "Same as the above add some comments to explain.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472327456", "createdAt": "2020-08-18T16:31:31Z", "author": {"login": "xiaoqin2012"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/send/SenderBufferManager.java", "diffHunk": "@@ -175,36 +174,32 @@ public void sendWithBuffering(List<LogReplicationEntry> dataToSend) {\n \n     /**\n      * Resend the messages in the queue if they have timed out.\n-     * @return false, if an entry has been resent MAX_RETRY.\n-     *         true, otherwise\n      */\n     public LogReplicationEntry resend() {\n-        //Enforce a resend or not\n         LogReplicationEntry ack = null;\n         boolean force = false;\n         try {\n             ack = processAcks();\n-        } catch (TimeoutException e) {\n-            log.warn(\"Caught a timeout exception \", e);\n+        } catch (TimeoutException te) {\n+            log.warn(\"Caught a timeout exception while processing ACKs\", te);\n             force = true;\n+        } catch (ExecutionException ee) {\n+            log.warn(\"Caught an execution exception while processing ACKs\", ee);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "129d491dd3a02c94b57917793b1251c93b191ad9"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1Mjc3MjQ2OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/runtime/CorfuLogReplicationRuntime.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxODoxNDowNlrOHCgYeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxODoyNDoyOVrOHCgvxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM4OTc1Mw==", "bodyText": "Do we need to set thread name by a threadFactory?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472389753", "createdAt": "2020-08-18T18:14:06Z", "author": {"login": "zhangn49"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/runtime/CorfuLogReplicationRuntime.java", "diffHunk": "@@ -159,8 +161,8 @@ public CorfuLogReplicationRuntime(LogReplicationRuntimeParameters parameters, Lo\n         this.sourceManager = new LogReplicationSourceManager(parameters, new LogReplicationClient(router, remoteClusterId),\n             metadataManager);\n         this.connectedEndpoints = new HashSet<>();\n-        this.communicationFSMWorkers = Executors.newSingleThreadExecutor(new\n-                ThreadFactoryBuilder().setNameFormat(\"runtime-fsm-worker\").build());\n+        this.communicationFSMWorkers = new ThreadPoolExecutor(1, 1, 0L,\n+                TimeUnit.MILLISECONDS, new LinkedBlockingQueue<Runnable>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55493a55b5391b4043987259d6f7ad3061e73370"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM5NTcxOQ==", "bodyText": "Yes, I think this is a good idea, so we track it easier. Added.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472395719", "createdAt": "2020-08-18T18:24:29Z", "author": {"login": "annym"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/runtime/CorfuLogReplicationRuntime.java", "diffHunk": "@@ -159,8 +161,8 @@ public CorfuLogReplicationRuntime(LogReplicationRuntimeParameters parameters, Lo\n         this.sourceManager = new LogReplicationSourceManager(parameters, new LogReplicationClient(router, remoteClusterId),\n             metadataManager);\n         this.connectedEndpoints = new HashSet<>();\n-        this.communicationFSMWorkers = Executors.newSingleThreadExecutor(new\n-                ThreadFactoryBuilder().setNameFormat(\"runtime-fsm-worker\").build());\n+        this.communicationFSMWorkers = new ThreadPoolExecutor(1, 1, 0L,\n+                TimeUnit.MILLISECONDS, new LinkedBlockingQueue<Runnable>());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM4OTc1Mw=="}, "originalCommit": {"oid": "55493a55b5391b4043987259d6f7ad3061e73370"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NDI1MzIwOnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1ODo1OVrOHCuk7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1ODo1OVrOHCuk7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjMxOA==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.util.concurrent.TimeoutException'", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472622318", "createdAt": "2020-08-19T02:58:59Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "diffHunk": "@@ -16,9 +16,12 @@\n import java.util.Observer;\n import java.util.Set;\n import java.util.UUID;\n+import java.util.concurrent.CompletionException;\n import java.util.concurrent.Executors;\n import java.util.concurrent.ScheduledExecutorService;\n import java.util.concurrent.Semaphore;\n+import java.util.concurrent.TimeoutException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c626b249d5d74e5bb7f0c5c236b328425951cc7"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NDI1MzI1OnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMFrOHCuk-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMFrOHCuk-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjMzMA==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'org.junit.jupiter.api.Assertions'", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472622330", "createdAt": "2020-08-19T02:59:00Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "diffHunk": "@@ -42,6 +45,7 @@\n import org.corfudb.util.Utils;\n import org.corfudb.util.serializer.Serializers;\n import org.junit.Test;\n+import org.junit.jupiter.api.Assertions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c626b249d5d74e5bb7f0c5c236b328425951cc7"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NDI1MzMwOnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMVrOHCulAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMVrOHCulAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjMzNw==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.util.concurrent.CompletionException'", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472622337", "createdAt": "2020-08-19T02:59:01Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "diffHunk": "@@ -16,9 +16,12 @@\n import java.util.Observer;\n import java.util.Set;\n import java.util.UUID;\n+import java.util.concurrent.CompletionException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c626b249d5d74e5bb7f0c5c236b328425951cc7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NDI1MzM2OnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMlrOHCulCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMlrOHCulCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjM0NA==", "bodyText": "Codacy found an issue: Unused import - java.util.concurrent.TimeoutException.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472622344", "createdAt": "2020-08-19T02:59:02Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "diffHunk": "@@ -16,9 +16,12 @@\n import java.util.Observer;\n import java.util.Set;\n import java.util.UUID;\n+import java.util.concurrent.CompletionException;\n import java.util.concurrent.Executors;\n import java.util.concurrent.ScheduledExecutorService;\n import java.util.concurrent.Semaphore;\n+import java.util.concurrent.TimeoutException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c626b249d5d74e5bb7f0c5c236b328425951cc7"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NDI1MzQzOnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMlrOHCulEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowMlrOHCulEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjM1Mw==", "bodyText": "Codacy found an issue: Unused import - java.util.concurrent.CompletionException.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472622353", "createdAt": "2020-08-19T02:59:02Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "diffHunk": "@@ -16,9 +16,12 @@\n import java.util.Observer;\n import java.util.Set;\n import java.util.UUID;\n+import java.util.concurrent.CompletionException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c626b249d5d74e5bb7f0c5c236b328425951cc7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NDI1MzQ5OnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowM1rOHCulHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo1OTowM1rOHCulHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjM2Ng==", "bodyText": "Codacy found an issue: Unused import - org.junit.jupiter.api.Assertions.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2711#discussion_r472622366", "createdAt": "2020-08-19T02:59:03Z", "author": {"login": "corfudb-bot"}, "path": "test/src/test/java/org/corfudb/integration/LogReplicationIT.java", "diffHunk": "@@ -42,6 +45,7 @@\n import org.corfudb.util.Utils;\n import org.corfudb.util.serializer.Serializers;\n import org.junit.Test;\n+import org.junit.jupiter.api.Assertions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c626b249d5d74e5bb7f0c5c236b328425951cc7"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1939, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}