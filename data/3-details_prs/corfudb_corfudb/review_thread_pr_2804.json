{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExOTQ1MDg3", "number": 2804, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToxNDoxNFrOEzDyhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo1MDoyMFrOE1X6fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxOTc0OTE2OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToxNDoxNFrOHqDC8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToxNDoxNFrOHqDC8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjE0NA==", "bodyText": "Codacy found an issue: Use explicit scoping instead of the default package private level", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r513852144", "createdAt": "2020-10-29T01:14:14Z", "author": {"login": "corfudb-bot"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.\n      * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to a specific a table in a namespace or the entire namespace.\n+     * Objects returned will honor transactional boundaries\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n+     */\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMzg5MTQwOnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTo0MzozMlrOHqrzyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMToyNDo0NFrOHqvRJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDAxMQ==", "bodyText": "typo: Subscribe to a specific table in a namespace or all tables in the namespace", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514520011", "createdAt": "2020-10-29T19:43:32Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.\n      * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to a specific a table in a namespace or the entire namespace.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3NjY3OQ==", "bodyText": "Done.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514576679", "createdAt": "2020-10-29T21:24:44Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.\n      * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to a specific a table in a namespace or the entire namespace.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDAxMQ=="}, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMzg5MzEyOnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTo0NDowNFrOHqr00Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMToyNDo0OVrOHqvRXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDI3Mw==", "bodyText": "existing typo: Subscribe to a specific table in a namespace or to all tables in a namespace", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514520273", "createdAt": "2020-10-29T19:44:04Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3NjczNQ==", "bodyText": "Done.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514576735", "createdAt": "2020-10-29T21:24:49Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDI3Mw=="}, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNDQ4MjU1OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjo1MzozMFrOHqxeIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMzoxMToxOVrOHq6ldg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjc2OQ==", "bodyText": "If a table has not been opened, this would be null and line 145 would hit a null pointer exception right?\nDo you want to throw an exception instead?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514612769", "createdAt": "2020-10-29T22:53:30Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +123,33 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from\n+     */\n+    public synchronized <K extends Message, V extends Message, M extends Message>\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   long startAddress) {\n+        // The table should be opened full schema before subscription.\n+        TableRegistry registry = runtime.getTableRegistry();\n+        List<TableSchema<K, V, M>> tableSchemas = tablesOfInterest\n+                .stream()\n+                .map(tName -> {\n+                    Table<K, V, M> table = registry.getTable(namespace, tName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMzA0NQ==", "bodyText": "@hisundar If table is not opened, getTable() will throw NoSuchElementException or IllegalArgumentException", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514633045", "createdAt": "2020-10-29T23:56:29Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +123,33 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from\n+     */\n+    public synchronized <K extends Message, V extends Message, M extends Message>\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   long startAddress) {\n+        // The table should be opened full schema before subscription.\n+        TableRegistry registry = runtime.getTableRegistry();\n+        List<TableSchema<K, V, M>> tableSchemas = tablesOfInterest\n+                .stream()\n+                .map(tName -> {\n+                    Table<K, V, M> table = registry.getTable(namespace, tName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjc2OQ=="}, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc2MjEwMg==", "bodyText": "Right, so can we just mention that in the java doc of this method?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514762102", "createdAt": "2020-10-30T03:11:19Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +123,33 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from\n+     */\n+    public synchronized <K extends Message, V extends Message, M extends Message>\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   long startAddress) {\n+        // The table should be opened full schema before subscription.\n+        TableRegistry registry = runtime.getTableRegistry();\n+        List<TableSchema<K, V, M>> tableSchemas = tablesOfInterest\n+                .stream()\n+                .map(tName -> {\n+                    Table<K, V, M> table = registry.getTable(namespace, tName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjc2OQ=="}, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNDQ4MzQzOnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/integration/StreamingIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjo1Mzo1MFrOHqxeog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMDowNToxM1rOHqy21w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjg5OA==", "bodyText": "Can one of these tests still carry the old subscribe() api since some verticals may still need to use the old form without actually depending on the tables being opened?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514612898", "createdAt": "2020-10-29T22:53:50Z", "author": {"login": "hisundar"}, "path": "test/src/test/java/org/corfudb/integration/StreamingIT.java", "diffHunk": "@@ -142,8 +144,7 @@ public void testStreamingSingleTable() throws Exception {\n \n         // Subscribe to streaming updates from the table.\n         StreamListenerImpl s1n1t1 = new StreamListenerImpl(\"s1n1t1\");\n-        store.subscribe(s1n1t1, \"n1\",\n-                Collections.singletonList(new TableSchema(\"t1\", Uuid.class, Uuid.class, Uuid.class)), ts1);\n+        store.subscribe(s1n1t1, \"n1\", defaultStreamTag, Collections.singletonList(\"t1\"), ts1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNTQ3OQ==", "bodyText": "I expanded the last testcase to use both old and new subscribe api.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514635479", "createdAt": "2020-10-30T00:05:13Z", "author": {"login": "WenbinZhu"}, "path": "test/src/test/java/org/corfudb/integration/StreamingIT.java", "diffHunk": "@@ -142,8 +144,7 @@ public void testStreamingSingleTable() throws Exception {\n \n         // Subscribe to streaming updates from the table.\n         StreamListenerImpl s1n1t1 = new StreamListenerImpl(\"s1n1t1\");\n-        store.subscribe(s1n1t1, \"n1\",\n-                Collections.singletonList(new TableSchema(\"t1\", Uuid.class, Uuid.class, Uuid.class)), ts1);\n+        store.subscribe(s1n1t1, \"n1\", defaultStreamTag, Collections.singletonList(\"t1\"), ts1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjg5OA=="}, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNTg4NDk5OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDo1NDoyNlrOHrAeXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxODo0ODo0MVrOHrcBow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg1ODU5MA==", "bodyText": "why not pass TableSchema instead of these 3 parameters?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514858590", "createdAt": "2020-10-30T04:54:26Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -58,18 +58,35 @@\n     @Getter\n     private final TableMetrics metrics;\n \n+    @Getter\n+    private final Class<K> keyClass;\n+\n+    @Getter\n+    private final Class<V> valueClass;\n+\n+    @Getter\n+    private final Class<M> metadataClass;\n+\n     /**\n      * Returns a Table instance backed by a CorfuTable.\n      *\n-     * @param namespace               Namespace of the table.\n-     * @param fullyQualifiedTableName Fully qualified table name.\n-     * @param valueSchema             Value schema to identify secondary keys.\n-     * @param corfuRuntime            Connected instance of the Corfu Runtime.\n-     * @param serializer              Protobuf Serializer.\n+     * @param namespace               namespace of the table\n+     * @param fullyQualifiedTableName Fully qualified table name\n+     * @param kClass                  key class\n+     * @param vClass                  value class\n+     * @param mClass                  metadata class\n+     * @param valueSchema             value schema to identify secondary keys\n+     * @param corfuRuntime            connected instance of the Corfu Runtime\n+     * @param serializer              protobuf serializer\n+     * @param streamingMapSupplier    supplier of underlying map data structure\n+     * @param versionPolicy           versioning policy\n      */\n     @Nonnull\n     public Table(@Nonnull final String namespace,\n                  @Nonnull final String fullyQualifiedTableName,\n+                 @Nonnull final Class<K> kClass,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwOTk4Nw==", "bodyText": "These three parameters are same as what were passed in from the caller.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515309987", "createdAt": "2020-10-30T18:48:41Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -58,18 +58,35 @@\n     @Getter\n     private final TableMetrics metrics;\n \n+    @Getter\n+    private final Class<K> keyClass;\n+\n+    @Getter\n+    private final Class<V> valueClass;\n+\n+    @Getter\n+    private final Class<M> metadataClass;\n+\n     /**\n      * Returns a Table instance backed by a CorfuTable.\n      *\n-     * @param namespace               Namespace of the table.\n-     * @param fullyQualifiedTableName Fully qualified table name.\n-     * @param valueSchema             Value schema to identify secondary keys.\n-     * @param corfuRuntime            Connected instance of the Corfu Runtime.\n-     * @param serializer              Protobuf Serializer.\n+     * @param namespace               namespace of the table\n+     * @param fullyQualifiedTableName Fully qualified table name\n+     * @param kClass                  key class\n+     * @param vClass                  value class\n+     * @param mClass                  metadata class\n+     * @param valueSchema             value schema to identify secondary keys\n+     * @param corfuRuntime            connected instance of the Corfu Runtime\n+     * @param serializer              protobuf serializer\n+     * @param streamingMapSupplier    supplier of underlying map data structure\n+     * @param versionPolicy           versioning policy\n      */\n     @Nonnull\n     public Table(@Nonnull final String namespace,\n                  @Nonnull final String fullyQualifiedTableName,\n+                 @Nonnull final Class<K> kClass,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg1ODU5MA=="}, "originalCommit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODk3NDkzOnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxOTo1MToyOFrOHreFcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToyNjoyMFrOHrg6yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0MzcyOA==", "bodyText": "what happens if this address has been checkpointed and trimmed?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515343728", "createdAt": "2020-10-30T19:51:28Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +124,35 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM5MDE1Mg==", "bodyText": "Seek moves the pointer to this address, if it's trimmed, then in next polling cycle, the poller will get a TrimmedException, stop the subscription and restart. This part is not changed since initially implemented.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515390152", "createdAt": "2020-10-30T21:26:20Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +124,35 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0MzcyOA=="}, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTAwMTE4OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMDowMDo0M1rOHreVfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToyNjoyNVrOHrg65A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0NzgzNw==", "bodyText": "this method can be made default instead of public", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515347837", "createdAt": "2020-10-30T20:00:43Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -88,10 +89,10 @@ public void shutdown() {\n     /**\n      * Subscribe to updates.\n      *\n-     * @param streamListener   Client listener.\n-     * @param namespace        Namespace of interest.\n-     * @param tablesOfInterest Only updates from these tables will be returned.\n-     * @param startAddress     Address to start the notifications from.\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM5MDE4MA==", "bodyText": "Done.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515390180", "createdAt": "2020-10-30T21:26:25Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -88,10 +89,10 @@ public void shutdown() {\n     /**\n      * Subscribe to updates.\n      *\n-     * @param streamListener   Client listener.\n-     * @param namespace        Namespace of interest.\n-     * @param tablesOfInterest Only updates from these tables will be returned.\n-     * @param startAddress     Address to start the notifications from.\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0NzgzNw=="}, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTAyNzM4OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMDowOTozOVrOHreldQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToyODowN1rOHrg86g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM1MTkyNQ==", "bodyText": "can we derive value and metadata classes from the value and metadata schemas?  Also is the metadataSchema param missing in the comment?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515351925", "createdAt": "2020-10-30T20:09:39Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -58,18 +58,35 @@\n     @Getter\n     private final TableMetrics metrics;\n \n+    @Getter\n+    private final Class<K> keyClass;\n+\n+    @Getter\n+    private final Class<V> valueClass;\n+\n+    @Getter\n+    private final Class<M> metadataClass;\n+\n     /**\n      * Returns a Table instance backed by a CorfuTable.\n      *\n-     * @param namespace               Namespace of the table.\n-     * @param fullyQualifiedTableName Fully qualified table name.\n-     * @param valueSchema             Value schema to identify secondary keys.\n-     * @param corfuRuntime            Connected instance of the Corfu Runtime.\n-     * @param serializer              Protobuf Serializer.\n+     * @param namespace               namespace of the table\n+     * @param fullyQualifiedTableName Fully qualified table name\n+     * @param kClass                  key class\n+     * @param vClass                  value class", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM5MDY5OA==", "bodyText": "Yes we can, that's what I initially did, but later I think it's cleaner to pass them all then doing a  bunch of castings, as these params are the same as what were passed in from the caller.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515390698", "createdAt": "2020-10-30T21:28:07Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -58,18 +58,35 @@\n     @Getter\n     private final TableMetrics metrics;\n \n+    @Getter\n+    private final Class<K> keyClass;\n+\n+    @Getter\n+    private final Class<V> valueClass;\n+\n+    @Getter\n+    private final Class<M> metadataClass;\n+\n     /**\n      * Returns a Table instance backed by a CorfuTable.\n      *\n-     * @param namespace               Namespace of the table.\n-     * @param fullyQualifiedTableName Fully qualified table name.\n-     * @param valueSchema             Value schema to identify secondary keys.\n-     * @param corfuRuntime            Connected instance of the Corfu Runtime.\n-     * @param serializer              Protobuf Serializer.\n+     * @param namespace               namespace of the table\n+     * @param fullyQualifiedTableName Fully qualified table name\n+     * @param kClass                  key class\n+     * @param vClass                  value class", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM1MTkyNQ=="}, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjg1NTE2OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1NTozOVrOHsjOVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo0MDoyNVrOHtnAjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NjUwMw==", "bodyText": "Nit: the updates of tablesOfInterest will not be exactly 'returned', right? Considering that this method returns void, it might help people better understand by not saying 'return'. What about '... will be passed to streamListener'?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r516476503", "createdAt": "2020-11-03T07:55:39Z", "author": {"login": "Lujie1996"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -199,26 +200,48 @@ public Query query(@Nonnull final String namespace) {\n     }\n \n     /**\n-     * Subscribe to a specific a table in a namespace or the entire namespace.\n-     * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     * Subscribe to transaction updates on specific tables in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to transaction updates on specific tables with the streamTag in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be returned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "982fd5e90a74deacad196221249a087fc1198590"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU4NzA4NA==", "bodyText": "@Lujie1996 sure, done.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r517587084", "createdAt": "2020-11-04T19:40:25Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -199,26 +200,48 @@ public Query query(@Nonnull final String namespace) {\n     }\n \n     /**\n-     * Subscribe to a specific a table in a namespace or the entire namespace.\n-     * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     * Subscribe to transaction updates on specific tables in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to transaction updates on specific tables with the streamTag in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be returned", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NjUwMw=="}, "originalCommit": {"oid": "982fd5e90a74deacad196221249a087fc1198590"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDAxNzg4OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo1MDoyMFrOHtnVbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo1MDoyMFrOHtnVbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU5MjQyOQ==", "bodyText": "Can we use Optional instead of null checks?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r517592429", "createdAt": "2020-11-04T19:50:20Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -199,26 +200,48 @@ public Query query(@Nonnull final String namespace) {\n     }\n \n     /**\n-     * Subscribe to a specific a table in a namespace or the entire namespace.\n-     * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     * Subscribe to transaction updates on specific tables in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be sent to listener\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to transaction updates on specific tables with the streamTag in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be sent to listener\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n+     */\n+    public void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   @Nullable Timestamp timestamp) {\n+        runtime.getTableRegistry().getStreamManager()\n+                .subscribe(streamListener, namespace, streamTag, tablesOfInterest,\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2af0598cda210dd90d78983e01c9ce91a47584c1"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1740, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}