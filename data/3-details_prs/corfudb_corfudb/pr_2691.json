{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NjU0ODY1", "number": 2691, "title": "Flush logger context for LR on exit", "bodyText": "+Add in cleanshutdown too\nOverview\nDescription:\nWhy should this be merged:\nRelated issue(s) (if applicable): #\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-08-10T18:15:24Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691", "merged": true, "mergeCommit": {"oid": "e7b45a40d44317618b3f00529afac4a2889a5abe"}, "closed": true, "closedAt": "2020-08-11T00:53:19Z", "author": {"login": "hisundar"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9mZbpAFqTQ2NDQ2NjgxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9o0mTgFqTQ2NDU4OTc0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDY2ODE3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691#pullrequestreview-464466817", "createdAt": "2020-08-10T18:19:30Z", "commit": {"oid": "fa011a6f95c1bf586d9f8f22509e312fa3bd52bf"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxODoxOTozMFrOG-aEug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxODoxOTozMFrOG-aEug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5MjA5MA==", "bodyText": "can we move this to a flushAsyncAppender() function?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691#discussion_r468092090", "createdAt": "2020-08-10T18:19:30Z", "author": {"login": "annym"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/CorfuInterClusterReplicationServer.java", "diffHunk": "@@ -271,6 +272,9 @@ private void startServer() {\n         }\n \n         log.info(\"main: Server exiting due to shutdown\");\n+        // Flush the async appender before exiting to prevent the loss of logs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa011a6f95c1bf586d9f8f22509e312fa3bd52bf"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDY4NTU0", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691#pullrequestreview-464468554", "createdAt": "2020-08-10T18:22:04Z", "commit": {"oid": "fa011a6f95c1bf586d9f8f22509e312fa3bd52bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDcyMzIw", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691#pullrequestreview-464472320", "createdAt": "2020-08-10T18:27:45Z", "commit": {"oid": "fa011a6f95c1bf586d9f8f22509e312fa3bd52bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxODoyNzo0NVrOG-aVtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxODoyNzo0NVrOG-aVtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5NjQzOQ==", "bodyText": "Should we add a check to see if the activeServer is null?\nIf startDiscoveryService throws an exception, activeServer will be null and the shutdown hook hit NPE. Logger flush will be skipped.\n\n  \n    \n      CorfuDB/infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/CorfuInterClusterReplicationServer.java\n    \n    \n         Line 344\n      in\n      fa011a6\n    \n    \n    \n    \n\n        \n          \n           activeServer.close();", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691#discussion_r468096439", "createdAt": "2020-08-10T18:27:45Z", "author": {"login": "zhangn49"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/infrastructure/CorfuInterClusterReplicationServer.java", "diffHunk": "@@ -341,6 +345,9 @@ public void cleanShutdown() {\n         if (replicationDiscoveryService != null) {\n             replicationDiscoveryService.shutdown();\n         }\n+        // Flush the async appender before exiting to prevent the loss of logs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa011a6f95c1bf586d9f8f22509e312fa3bd52bf"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa011a6f95c1bf586d9f8f22509e312fa3bd52bf", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/fa011a6f95c1bf586d9f8f22509e312fa3bd52bf", "committedDate": "2020-08-10T18:04:57Z", "message": "Flush logger context for LR on exit\n\n+Add in cleanshutdown too"}, "afterCommit": {"oid": "36d90493b87a19ec622cfeffb1f9b7170f2cc091", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/36d90493b87a19ec622cfeffb1f9b7170f2cc091", "committedDate": "2020-08-10T20:12:39Z", "message": "Flush logger context for LR on exit\n\n+Add in cleanshutdown too\n+Increase retry attempts in openTable to 9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f56dc6ea745fc0f6e463447ab1bad28c63fc82", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/b7f56dc6ea745fc0f6e463447ab1bad28c63fc82", "committedDate": "2020-08-10T21:05:58Z", "message": "Flush logger context for LR on exit\n\n+Add in cleanshutdown too\n+Increase retry attempts in openTable to 9"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36d90493b87a19ec622cfeffb1f9b7170f2cc091", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/36d90493b87a19ec622cfeffb1f9b7170f2cc091", "committedDate": "2020-08-10T20:12:39Z", "message": "Flush logger context for LR on exit\n\n+Add in cleanshutdown too\n+Increase retry attempts in openTable to 9"}, "afterCommit": {"oid": "b7f56dc6ea745fc0f6e463447ab1bad28c63fc82", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/b7f56dc6ea745fc0f6e463447ab1bad28c63fc82", "committedDate": "2020-08-10T21:05:58Z", "message": "Flush logger context for LR on exit\n\n+Add in cleanshutdown too\n+Increase retry attempts in openTable to 9"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTg5NzQ0", "url": "https://github.com/CorfuDB/CorfuDB/pull/2691#pullrequestreview-464589744", "createdAt": "2020-08-10T21:09:07Z", "commit": {"oid": "b7f56dc6ea745fc0f6e463447ab1bad28c63fc82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4370, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}