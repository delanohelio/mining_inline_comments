{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2Mzg5NTQ3", "number": 2701, "title": "CorfuStoreBrowser: variable size records for loading data", "bodyText": "Use JsonFormat to display for future editing\nOverview\nDescription:\nWhy should this be merged:\nRelated issue(s) (if applicable): #\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-08-11T22:29:36Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701", "merged": true, "mergeCommit": {"oid": "6531c1185866996f698744fa8821d4751fa3f948"}, "closed": true, "closedAt": "2020-09-15T18:35:23Z", "author": {"login": "hisundar"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-AmgpgFqTQ2NTUyMTEyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJMLGGAFqTQ4ODk1NjQ2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTIxMTI1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#pullrequestreview-465521125", "createdAt": "2020-08-12T00:51:26Z", "commit": {"oid": "585b42086a276ed007f2d5d0b60be3a5c66595b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMDo1MToyNlrOG_OCzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMDo1MToyNlrOG_OCzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk0MzU2Nw==", "bodyText": "why we need this?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#discussion_r468943567", "createdAt": "2020-08-12T00:51:26Z", "author": {"login": "xnull"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -225,9 +238,12 @@ public int loadTable(String namespace, String tablename, int numItems, int batch\n                     TableName.getDefaultInstance().getClass(),\n                     optionsBuilder.build());\n \n-            TableName dummyVal = TableName.newBuilder().setNamespace(namespace).setTableName(tablename).build();\n-            log.info(\"Loading {} items in {} batchSized transactions into {}${}\",\n-                    numItems, batchSize, namespace, tablename);\n+            byte[] array = new byte[itemSize];\n+            new Random().nextBytes(array);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "585b42086a276ed007f2d5d0b60be3a5c66595b8"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTIxMzA3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#pullrequestreview-465521307", "createdAt": "2020-08-12T00:52:04Z", "commit": {"oid": "585b42086a276ed007f2d5d0b60be3a5c66595b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "585b42086a276ed007f2d5d0b60be3a5c66595b8", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/585b42086a276ed007f2d5d0b60be3a5c66595b8", "committedDate": "2020-08-11T22:28:38Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}, "afterCommit": {"oid": "0c07eec1c21c6d648e5dba2e63b5e812b6fb56dd", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/0c07eec1c21c6d648e5dba2e63b5e812b6fb56dd", "committedDate": "2020-08-13T07:04:11Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c07eec1c21c6d648e5dba2e63b5e812b6fb56dd", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/0c07eec1c21c6d648e5dba2e63b5e812b6fb56dd", "committedDate": "2020-08-13T07:04:11Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}, "afterCommit": {"oid": "186b43ae2fc74c962d52fbbcace68e11bdde0f97", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/186b43ae2fc74c962d52fbbcace68e11bdde0f97", "committedDate": "2020-08-13T19:09:26Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDc1MjIy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#pullrequestreview-467075222", "createdAt": "2020-08-13T19:40:33Z", "commit": {"oid": "186b43ae2fc74c962d52fbbcace68e11bdde0f97"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MDozM1rOHAa6Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo1NDoxMlrOHAbVfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMjk4Mw==", "bodyText": "can we print the protobuf type which caused the exception?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#discussion_r470202983", "createdAt": "2020-08-13T19:40:33Z", "author": {"login": "pankti-m"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -133,11 +138,18 @@ public int printTable(String namespace, String tablename) {\n                 Iterables.partition(entryStream::iterator, batchSize);\n         for (List<Map.Entry<CorfuDynamicKey, CorfuDynamicRecord>> partition : partitions) {\n             for (Map.Entry<CorfuDynamicKey, CorfuDynamicRecord> entry : partition) {\n-                builder = new StringBuilder(\"\\nKey:\\n\" + entry.getKey().getKey())\n-                        .append(\"\\nPayload:\\n\").append(entry.getValue().getPayload())\n-                        .append(\"\\nMetadata:\\n\").append(entry.getValue().getMetadata())\n-                        .append(\"\\n====================\\n\");\n-                log.info(builder.toString());\n+                try {\n+                    builder = new StringBuilder(\"\\nKey:\\n\")\n+                            .append(JsonFormat.printer().print(entry.getKey().getKey()))\n+                            .append(\"\\nPayload:\\n\")\n+                            .append(JsonFormat.printer().print(entry.getValue().getPayload()))\n+                            .append(\"\\nMetadata:\\n\")\n+                            .append(JsonFormat.printer().print(entry.getValue().getMetadata()))\n+                            .append(\"\\n====================\\n\");\n+                    log.info(builder.toString());\n+                } catch (InvalidProtocolBufferException e) {\n+                    log.error(\"invalid protobuf: \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "186b43ae2fc74c962d52fbbcace68e11bdde0f97"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwNjQ0MQ==", "bodyText": "how does adding random bytes solve it?  can we add a comment about this?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#discussion_r470206441", "createdAt": "2020-08-13T19:47:28Z", "author": {"login": "pankti-m"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -225,9 +238,12 @@ public int loadTable(String namespace, String tablename, int numItems, int batch\n                     TableName.getDefaultInstance().getClass(),\n                     optionsBuilder.build());\n \n-            TableName dummyVal = TableName.newBuilder().setNamespace(namespace).setTableName(tablename).build();\n-            log.info(\"Loading {} items in {} batchSized transactions into {}${}\",\n-                    numItems, batchSize, namespace, tablename);\n+            byte[] array = new byte[itemSize];\n+            new Random().nextBytes(array);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk0MzU2Nw=="}, "originalCommit": {"oid": "585b42086a276ed007f2d5d0b60be3a5c66595b8"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwOTM4MQ==", "bodyText": "I did not realize earlier, but in this operation we allow data to be loaded only in the schema of dummyKey and dummyVal, but the clients table can have a different schema, right?  Wont the load operation fail?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#discussion_r470209381", "createdAt": "2020-08-13T19:53:20Z", "author": {"login": "pankti-m"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -209,9 +221,10 @@ public int dropTable(String namespace, String tablename) {\n      * @param tablename - table name without the namespace\n      * @param numItems - total number of items to load\n      * @param batchSize - number of items in each transaction\n+     * @param itemSize - size of each item - a random string array\n      * @return - number of entries in the table\n      */\n-    public int loadTable(String namespace, String tablename, int numItems, int batchSize) {\n+    public int loadTable(String namespace, String tablename, int numItems, int batchSize, int itemSize) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "186b43ae2fc74c962d52fbbcace68e11bdde0f97"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwOTkxNg==", "bodyText": "why namespace+tablename?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#discussion_r470209916", "createdAt": "2020-08-13T19:54:12Z", "author": {"login": "pankti-m"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -225,9 +238,12 @@ public int loadTable(String namespace, String tablename, int numItems, int batch\n                     TableName.getDefaultInstance().getClass(),\n                     optionsBuilder.build());\n \n-            TableName dummyVal = TableName.newBuilder().setNamespace(namespace).setTableName(tablename).build();\n-            log.info(\"Loading {} items in {} batchSized transactions into {}${}\",\n-                    numItems, batchSize, namespace, tablename);\n+            byte[] array = new byte[itemSize];\n+            new Random().nextBytes(array);\n+            TableName dummyVal = TableName.newBuilder().setNamespace(namespace+tablename)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "186b43ae2fc74c962d52fbbcace68e11bdde0f97"}, "originalPosition": 71}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edc419438297756bd1794a141eaa8406c4959fbf", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/edc419438297756bd1794a141eaa8406c4959fbf", "committedDate": "2020-08-14T22:52:57Z", "message": "Merge branch 'master' into ufo-queue1"}, "afterCommit": {"oid": "cdfe8b18997300e4687e5564928027e0696280ea", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/cdfe8b18997300e4687e5564928027e0696280ea", "committedDate": "2020-09-09T16:28:36Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdfe8b18997300e4687e5564928027e0696280ea", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/cdfe8b18997300e4687e5564928027e0696280ea", "committedDate": "2020-09-09T16:28:36Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}, "afterCommit": {"oid": "210f1f30ddf5beda2c102042cff28fa7f8bb39c9", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/210f1f30ddf5beda2c102042cff28fa7f8bb39c9", "committedDate": "2020-09-09T16:34:53Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92a6bbdb6b48b941efe3544eebb1e06653709832", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/92a6bbdb6b48b941efe3544eebb1e06653709832", "committedDate": "2020-09-15T05:40:44Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "210f1f30ddf5beda2c102042cff28fa7f8bb39c9", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/210f1f30ddf5beda2c102042cff28fa7f8bb39c9", "committedDate": "2020-09-09T16:34:53Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}, "afterCommit": {"oid": "92a6bbdb6b48b941efe3544eebb1e06653709832", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/92a6bbdb6b48b941efe3544eebb1e06653709832", "committedDate": "2020-09-15T05:40:44Z", "message": "CorfuStoreBrowser: variable size records for loading data\n\nUse JsonFormat to display for future editing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTU2NDY3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#pullrequestreview-488956467", "createdAt": "2020-09-15T18:33:25Z", "commit": {"oid": "92a6bbdb6b48b941efe3544eebb1e06653709832"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODozMzoyNlrOHSO2EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODozMzoyNlrOHSO2EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3OTYzMw==", "bodyText": "dint find the comments...", "url": "https://github.com/CorfuDB/CorfuDB/pull/2701#discussion_r488879633", "createdAt": "2020-09-15T18:33:26Z", "author": {"login": "pankti-m"}, "path": "corfudb-tools/src/main/java/org/corfudb/browser/CorfuStoreBrowser.java", "diffHunk": "@@ -209,9 +221,10 @@ public int dropTable(String namespace, String tablename) {\n      * @param tablename - table name without the namespace\n      * @param numItems - total number of items to load\n      * @param batchSize - number of items in each transaction\n+     * @param itemSize - size of each item - a random string array\n      * @return - number of entries in the table\n      */\n-    public int loadTable(String namespace, String tablename, int numItems, int batchSize) {\n+    public int loadTable(String namespace, String tablename, int numItems, int batchSize, int itemSize) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwOTM4MQ=="}, "originalCommit": {"oid": "186b43ae2fc74c962d52fbbcace68e11bdde0f97"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4393, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}