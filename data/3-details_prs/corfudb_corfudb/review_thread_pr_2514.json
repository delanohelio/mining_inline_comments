{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NDQ4OTU2", "number": 2514, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNDoxNDowNlrODziQ_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoyMDo0MVrOD15hKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MzY1MzczOnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNDoxNDowNlrOGICYyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjoxNDozN1rOGK-TMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA4MDkwNA==", "bodyText": "Can you replace this with a function call? For now, we suppose there is no performance impact if number of streams in a transaction is less than 10 tables? But if there are more tables, it may decrease the performance. Please put comments to the function and check how many streams in the map, if it is bigger than a threshold like 20, print a warn log.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r411080904", "createdAt": "2020-04-20T04:14:06Z", "author": {"login": "xiaoqin2012"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "diffHunk": "@@ -27,7 +29,8 @@\n     public LogUnitServerCache(LogUnitServerConfig config, StreamLog streamLog) {\n         this.streamLog = streamLog;\n         this.dataCache = Caffeine.newBuilder()\n-                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate())\n+                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate() +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7ff161b6a1729716c4f5568168986c42c871bd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1OTY2NA==", "bodyText": "done", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r414159664", "createdAt": "2020-04-23T22:14:37Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "diffHunk": "@@ -27,7 +29,8 @@\n     public LogUnitServerCache(LogUnitServerConfig config, StreamLog streamLog) {\n         this.streamLog = streamLog;\n         this.dataCache = Caffeine.newBuilder()\n-                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate())\n+                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate() +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA4MDkwNA=="}, "originalCommit": {"oid": "3e7ff161b6a1729716c4f5568168986c42c871bd"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2OTI3NzY3OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMDowMToyMlrOGKQwyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjoxNDo1MlrOGK-Tig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxMzU3OA==", "bodyText": "Remove this.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r413413578", "createdAt": "2020-04-23T00:01:22Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "diffHunk": "@@ -91,6 +94,7 @@ public ILogData get(long address) {\n      */\n     public void put(long address, ILogData entry) {\n         log.trace(\"LogUnitServerCache.put: Cache write[{} : {}]\", address, entry);\n+        //System.out.println(\"Metadata map deep size - \" + sizeOf.deepSizeOf(entry.getMetadataMap()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7ff161b6a1729716c4f5568168986c42c871bd"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1OTc1NA==", "bodyText": "done", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r414159754", "createdAt": "2020-04-23T22:14:52Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "diffHunk": "@@ -91,6 +94,7 @@ public ILogData get(long address) {\n      */\n     public void put(long address, ILogData entry) {\n         log.trace(\"LogUnitServerCache.put: Cache write[{} : {}]\", address, entry);\n+        //System.out.println(\"Metadata map deep size - \" + sizeOf.deepSizeOf(entry.getMetadataMap()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxMzU3OA=="}, "originalCommit": {"oid": "3e7ff161b6a1729716c4f5568168986c42c871bd"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2OTI3ODk0OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMDowMTo0N1rOGKQxeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjoxNDo0NVrOGK-TYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxMzc1Mg==", "bodyText": "Add 8 bytes for the key", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r413413752", "createdAt": "2020-04-23T00:01:47Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "diffHunk": "@@ -27,7 +29,8 @@\n     public LogUnitServerCache(LogUnitServerConfig config, StreamLog streamLog) {\n         this.streamLog = streamLog;\n         this.dataCache = Caffeine.newBuilder()\n-                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate())\n+                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate() +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7ff161b6a1729716c4f5568168986c42c871bd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1OTcxMg==", "bodyText": "done", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r414159712", "createdAt": "2020-04-23T22:14:45Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/LogUnitServerCache.java", "diffHunk": "@@ -27,7 +29,8 @@\n     public LogUnitServerCache(LogUnitServerConfig config, StreamLog streamLog) {\n         this.streamLog = streamLog;\n         this.dataCache = Caffeine.newBuilder()\n-                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate())\n+                .<Long, ILogData>weigher((addr, logData) -> logData.getSizeEstimate() +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxMzc1Mg=="}, "originalCommit": {"oid": "3e7ff161b6a1729716c4f5568168986c42c871bd"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODQzNDk4OnYy", "diffSide": "RIGHT", "path": "test/src/test/java/org/corfudb/infrastructure/LogUnitServerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoyMDo0MVrOGLjy_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoyMDo0MVrOGLjy_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NDAxMw==", "bodyText": "Expand", "url": "https://github.com/CorfuDB/CorfuDB/pull/2514#discussion_r414774013", "createdAt": "2020-04-24T18:20:41Z", "author": {"login": "WenbinZhu"}, "path": "test/src/test/java/org/corfudb/infrastructure/LogUnitServerTest.java", "diffHunk": "@@ -19,10 +19,7 @@\n import java.io.RandomAccessFile;\n import java.nio.ByteBuffer;\n import java.nio.channels.FileChannel;\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.Map;\n-import java.util.UUID;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab37b3b7a7fee928b2028125c5e8586da3cf63a"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1970, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}