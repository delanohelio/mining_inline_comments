{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NDIxOTY2", "number": 2702, "title": "If layoutHelper returns a WrongClusterException best to shutdown", "bodyText": "Overview\nDescription:\nWhy should this be merged:\nRelated issue(s) (if applicable): #\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-08-12T00:08:50Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702", "merged": true, "mergeCommit": {"oid": "5583cc0c04912343764efb6ba4eddee9a660357e"}, "closed": true, "closedAt": "2020-08-18T21:57:35Z", "author": {"login": "hisundar"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-AS4ygFqTQ2NTUxNTIxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAMcRzgFqTQ2OTc3MDc1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTE1MjE5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#pullrequestreview-465515219", "createdAt": "2020-08-12T00:30:01Z", "commit": {"oid": "d0c656f7f33822f651a4d7b64bfc9681218b6c45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMDozMDowMVrOG_NskQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMDozMDowMVrOG_NskQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzNzg3Mw==", "bodyText": "Should the exception still be thrown after the handler is called ?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#discussion_r468937873", "createdAt": "2020-08-12T00:30:01Z", "author": {"login": "Maithem"}, "path": "runtime/src/main/java/org/corfudb/runtime/CorfuRuntime.java", "diffHunk": "@@ -1140,6 +1140,7 @@ private void pruneRemovedRouters(@Nonnull Layout layout) {\n                     } catch (WrongClusterException we) {\n                         // It is futile trying to re-connect to the wrong cluster\n                         log.warn(\"Giving up since cluster is incorrect or reconfigured!\");\n+                        parameters.getSystemDownHandler().run();\n                         throw we;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0c656f7f33822f651a4d7b64bfc9681218b6c45"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTIwODU3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#pullrequestreview-465520857", "createdAt": "2020-08-12T00:50:25Z", "commit": {"oid": "d0c656f7f33822f651a4d7b64bfc9681218b6c45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMDo1MDoyNVrOG_OB3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMDo1MDoyNVrOG_OB3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk0MzMyNQ==", "bodyText": "Should we change the layoutHelper instead of here? Here it's fetchLayout, but other operations can still hit WCE", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#discussion_r468943325", "createdAt": "2020-08-12T00:50:25Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/CorfuRuntime.java", "diffHunk": "@@ -1140,6 +1140,7 @@ private void pruneRemovedRouters(@Nonnull Layout layout) {\n                     } catch (WrongClusterException we) {\n                         // It is futile trying to re-connect to the wrong cluster\n                         log.warn(\"Giving up since cluster is incorrect or reconfigured!\");\n+                        parameters.getSystemDownHandler().run();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0c656f7f33822f651a4d7b64bfc9681218b6c45"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0c656f7f33822f651a4d7b64bfc9681218b6c45", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/d0c656f7f33822f651a4d7b64bfc9681218b6c45", "committedDate": "2020-08-12T00:08:01Z", "message": "If layoutHelper returns a WrongClusterException best to shutdown"}, "afterCommit": {"oid": "1917b8bf05a45e1e74509591c0d4b6001a1b2d98", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/1917b8bf05a45e1e74509591c0d4b6001a1b2d98", "committedDate": "2020-08-13T07:05:42Z", "message": "If layoutHelper returns a WrongClusterException best to shutdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NTI2MDQ0", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#pullrequestreview-466526044", "createdAt": "2020-08-13T07:55:14Z", "commit": {"oid": "1917b8bf05a45e1e74509591c0d4b6001a1b2d98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b38389d35694744088fbf71f26c922c8ea4c3724", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/b38389d35694744088fbf71f26c922c8ea4c3724", "committedDate": "2020-08-13T19:04:30Z", "message": "If layoutHelper returns a WrongClusterException best to shutdown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1917b8bf05a45e1e74509591c0d4b6001a1b2d98", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/1917b8bf05a45e1e74509591c0d4b6001a1b2d98", "committedDate": "2020-08-13T07:05:42Z", "message": "If layoutHelper returns a WrongClusterException best to shutdown"}, "afterCommit": {"oid": "b38389d35694744088fbf71f26c922c8ea4c3724", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/b38389d35694744088fbf71f26c922c8ea4c3724", "committedDate": "2020-08-13T19:04:30Z", "message": "If layoutHelper returns a WrongClusterException best to shutdown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3139cc4858e15085277707242a9eb31f3823865", "author": {"user": {"login": "PavelZaytsev", "name": "Pavel Zaytsev"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/c3139cc4858e15085277707242a9eb31f3823865", "committedDate": "2020-08-17T19:08:44Z", "message": "Fix WCE invocation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcd3fda2742bd703699b8da20e615411574709c7", "author": {"user": {"login": "PavelZaytsev", "name": "Pavel Zaytsev"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/fcd3fda2742bd703699b8da20e615411574709c7", "committedDate": "2020-08-17T20:35:18Z", "message": "Call system down handler in fetch layout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODU3Nzgy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#pullrequestreview-468857782", "createdAt": "2020-08-17T21:53:31Z", "commit": {"oid": "fcd3fda2742bd703699b8da20e615411574709c7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd41b436811c309e08bd1e20f3409fce34a96e9b", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/cd41b436811c309e08bd1e20f3409fce34a96e9b", "committedDate": "2020-08-18T04:52:36Z", "message": "Merge branch 'master' into invokeSysDownOnWE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NzY4NDY5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#pullrequestreview-469768469", "createdAt": "2020-08-18T19:43:24Z", "commit": {"oid": "cd41b436811c309e08bd1e20f3409fce34a96e9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NzcwNzUz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2702#pullrequestreview-469770753", "createdAt": "2020-08-18T19:46:59Z", "commit": {"oid": "cd41b436811c309e08bd1e20f3409fce34a96e9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4396, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}