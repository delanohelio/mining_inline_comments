{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNjI4ODcx", "number": 2380, "title": "Redundant stamped lock validation.", "bodyText": "Overview\nRemove redundant lock validation as the exclusive write lock is already held.\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-02-07T22:31:14Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2380", "merged": true, "mergeCommit": {"oid": "f1868382f8b7b8d7913cba8902b2d8f796abfb6e"}, "closed": true, "closedAt": "2020-02-11T06:17:57Z", "author": {"login": "WenbinZhu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCHlpNgFqTM1NTQ4Nzk3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDLlisgFqTM1NjQzMzI3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDg3OTcz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2380#pullrequestreview-355487973", "createdAt": "2020-02-07T23:04:22Z", "commit": {"oid": "0dd2ce900d22a0254fd1eff359f6f0f49613cb03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMzowNDoyMlrOFnMyZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMzowNDoyMlrOFnMyZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY0ODI5Mg==", "bodyText": "I don't think you need to check if direct access is possible since it is called right after the write lock is acquired.\nRemove it?\nIts possible that from the time the optimistic read happened to the time the lock was acquired the version can change back to the original access version, but this if-call is not necessary because if the VLO is at the right version then updateFunction.accept(this); will just be a no-op", "url": "https://github.com/CorfuDB/CorfuDB/pull/2380#discussion_r376648292", "createdAt": "2020-02-07T23:04:22Z", "author": {"login": "Maithem"}, "path": "runtime/src/main/java/org/corfudb/runtime/object/VersionLockedObject.java", "diffHunk": "@@ -243,13 +243,7 @@ public void gc(long trimMark) {\n             // Check if direct access is possible (unlikely).\n             if (directAccessCheckFunction.apply(this)) {\n                 log.trace(\"Access [{}] Direct (writelock) access at {}\", this, getVersionUnsafe());\n-                R ret = accessFunction.apply(object.getContext(ICorfuExecutionContext.DEFAULT));\n-\n-                long versionForCorrectness = getVersionUnsafe();\n-                if (lock.validate(ts)) {\n-                    correctnessLogger.trace(\"Version, {}\", versionForCorrectness);\n-                    return ret;\n-                }\n+                return accessFunction.apply(object.getContext(ICorfuExecutionContext.DEFAULT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd2ce900d22a0254fd1eff359f6f0f49613cb03"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDk1MDc0", "url": "https://github.com/CorfuDB/CorfuDB/pull/2380#pullrequestreview-355495074", "createdAt": "2020-02-07T23:28:30Z", "commit": {"oid": "0dd2ce900d22a0254fd1eff359f6f0f49613cb03"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTI1OTgw", "url": "https://github.com/CorfuDB/CorfuDB/pull/2380#pullrequestreview-355525980", "createdAt": "2020-02-08T03:07:37Z", "commit": {"oid": "0dd2ce900d22a0254fd1eff359f6f0f49613cb03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "130d7e70f8ee82b16624bd803d92a268f846461a", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/130d7e70f8ee82b16624bd803d92a268f846461a", "committedDate": "2020-02-11T01:07:02Z", "message": "Remove redundant stamped lock validation."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "372853ee4317dcb65f24e4a74e30499fa9e88269", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/372853ee4317dcb65f24e4a74e30499fa9e88269", "committedDate": "2020-02-10T23:40:35Z", "message": "Merge branch 'master' into redundant_lock_validate"}, "afterCommit": {"oid": "130d7e70f8ee82b16624bd803d92a268f846461a", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/130d7e70f8ee82b16624bd803d92a268f846461a", "committedDate": "2020-02-11T01:07:02Z", "message": "Remove redundant stamped lock validation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NDMzMjc3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2380#pullrequestreview-356433277", "createdAt": "2020-02-11T06:17:49Z", "commit": {"oid": "130d7e70f8ee82b16624bd803d92a268f846461a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3324, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}