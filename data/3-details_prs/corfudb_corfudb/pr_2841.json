{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MDE3NjU0", "number": 2841, "title": "Remove deps on logback", "bodyText": "Overview\nDescription:\nFixes log binding issues.\nRelated issue(s) (if applicable): #\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-12-07T23:37:13Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841", "merged": true, "mergeCommit": {"oid": "8b48eaea9ffc59f7dda56938e0cfde1998ffb2a5"}, "closed": true, "closedAt": "2020-12-08T18:45:09Z", "author": {"login": "PavelZaytsev"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkAEdngFqTU0NjY4MDU0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkA7CyABqjQwODI1ODM0OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjgwNTQy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#pullrequestreview-546680542", "createdAt": "2020-12-08T01:43:23Z", "commit": {"oid": "c0b98e4a1585842049a444fdb181f9bcd34dc02d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjgxMjMw", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#pullrequestreview-546681230", "createdAt": "2020-12-08T01:45:16Z", "commit": {"oid": "c0b98e4a1585842049a444fdb181f9bcd34dc02d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMTo0NToxNlrOIBC-TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMTo0NToxNlrOIBC-TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk2ODIwNQ==", "bodyText": "You can probably check if a logger was defined or not with Logger::isInfoEnabled", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#discussion_r537968205", "createdAt": "2020-12-08T01:45:16Z", "author": {"login": "Maithem"}, "path": "runtime/src/main/java/org/corfudb/runtime/CorfuRuntime.java", "diffHunk": "@@ -847,13 +848,9 @@ private CorfuRuntime(@Nonnull CorfuRuntimeParameters parameters) {\n                 this.parameters.getMicroMeterRuntimeConfig();\n \n         if (microMeterRuntimeConfig.metricsEnabled) {\n-            LoggerContext context =  (LoggerContext) LoggerFactory.getILoggerFactory();\n-            registry = Optional.ofNullable(context.exists(microMeterRuntimeConfig.configuredLoggerName))\n-                    .map(logger -> MeterRegistryProvider.MeterRegistryInitializer.newInstance(logger,\n+            Logger logger = LoggerFactory.getLogger(microMeterRuntimeConfig.configuredLoggerName);\n+            registry = Optional.of(MeterRegistryInitializer.newInstance(logger,\n                             microMeterRuntimeConfig.loggingInterval, parameters.clientId));\n-            if (!registry.isPresent()) {\n-                log.warn(\"Logger was not found to enable metrics.\");\n-            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b98e4a1585842049a444fdb181f9bcd34dc02d"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2Njg5MzMy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#pullrequestreview-546689332", "createdAt": "2020-12-08T02:05:27Z", "commit": {"oid": "c0b98e4a1585842049a444fdb181f9bcd34dc02d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjowNToyN1rOIBDfAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjowNToyN1rOIBDfAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk3NjU3OA==", "bodyText": "What if two different suppliers are passed?\nI don't think its a good idea to just silently print a warning message.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#discussion_r537976578", "createdAt": "2020-12-08T02:05:27Z", "author": {"login": "Maithem"}, "path": "common/src/main/java/org/corfudb/common/metrics/micrometer/MeterRegistryProvider.java", "diffHunk": "@@ -70,7 +72,8 @@ public static synchronized void init(Logger logger, Duration loggingInterval, St\n \n         private static void init(Supplier<Optional<MeterRegistry>> meterRegistrySupplier) {\n             if (meterRegistry.isPresent()) {\n-                throw new IllegalStateException(\"Registry has already been initialized.\");\n+                log.warn(\"Registry has already been initialized.\");\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b98e4a1585842049a444fdb181f9bcd34dc02d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2Njk1OTU2", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#pullrequestreview-546695956", "createdAt": "2020-12-08T02:24:02Z", "commit": {"oid": "c0b98e4a1585842049a444fdb181f9bcd34dc02d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzAxNzE5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#pullrequestreview-546701719", "createdAt": "2020-12-08T02:40:06Z", "commit": {"oid": "fd270fe8a09f61cf8378c7878004bf21038a9639"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjo0MDowNlrOIBEPtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjo0MDowNlrOIBEPtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk4OTA0NA==", "bodyText": "Should these updates also be made to the RequestHandlerMethods class? This class is only responsible for CorfuMsg types and does not take into account the server handler methods that handle Protobuf messages.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2841#discussion_r537989044", "createdAt": "2020-12-08T02:40:06Z", "author": {"login": "zfrenette"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/HandlerMethods.java", "diffHunk": "@@ -207,10 +207,14 @@ private void registerMethod(@Nonnull final MethodHandles.Lookup caller,\n     // Create a timer using cached timer name for the corresponding type\n     private Optional<Timer> getTimer(@Nonnull CorfuMsgType type) {\n         timerNameCache.computeIfAbsent(type,\n-                                       aType -> (CorfuComponent.INFRA_MSG_HANDLER +\n-                                                 aType.name().toLowerCase()));\n+                aType -> (CorfuComponent.INFRA_MSG_HANDLER +\n+                        aType.name().toLowerCase()));\n+        double[] percentiles = new double[]{0.50, 0.95, 0.99};\n \n         return MeterRegistryProvider.getInstance()\n-                .map(registry -> Timer.builder(timerNameCache.get(type)).register(registry));\n+                .map(registry -> Timer.builder(timerNameCache.get(type))\n+                        .publishPercentiles(percentiles)\n+                        .publishPercentileHistogram(true)\n+                        .register(registry));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd270fe8a09f61cf8378c7878004bf21038a9639"}, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07a09b1ad85759cb2b2caab064e1e5a7dea105de", "author": {"user": {"login": "PavelZaytsev", "name": "Pavel Zaytsev"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/07a09b1ad85759cb2b2caab064e1e5a7dea105de", "committedDate": "2020-12-08T02:41:24Z", "message": "Remove dep on logback for runtime metrics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5b87430865d1b7f9cab9d043e9edb545c9b8bf3", "author": {"user": {"login": "PavelZaytsev", "name": "Pavel Zaytsev"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/f5b87430865d1b7f9cab9d043e9edb545c9b8bf3", "committedDate": "2020-12-08T02:39:41Z", "message": "Fix"}, "afterCommit": {"oid": "07a09b1ad85759cb2b2caab064e1e5a7dea105de", "author": {"user": {"login": "PavelZaytsev", "name": "Pavel Zaytsev"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/07a09b1ad85759cb2b2caab064e1e5a7dea105de", "committedDate": "2020-12-08T02:41:24Z", "message": "Remove dep on logback for runtime metrics"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3977, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}