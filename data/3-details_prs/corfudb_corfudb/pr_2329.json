{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NzQ3NTEx", "number": 2329, "title": "Remove Parent Filesystem read-only check for LogUnitServer", "bodyText": "Overview\nDescription:\nWhy should this be merged:\nStarting with Mac OS X 10.15 the parent filesystem returned\nby the System.getProperty(\"java.io.tmpdir\") is marked as\nread-only. However this does not mean that the returned\ntemporary directory itself is read-only.\nSo given that this can happen in production as well,\nremoving the redundant parent filesystem read-only\ncheck would prevent false panics and allow IT tests\nto run on Mac as well.\nRelated issue(s) (if applicable): #2328\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-01-27T23:03:27Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329", "merged": true, "mergeCommit": {"oid": "81f25cdf7cdfdc59fc9ba8ec63ae182c1a6ab310"}, "closed": true, "closedAt": "2020-02-05T02:25:28Z", "author": {"login": "hisundar"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-nDa4AFqTM0OTA4NDgwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBI6adgH2gAyMzY3NzQ3NTExOmU0ZmFkNjc4ZTlmYjdhYjRlY2FjNzJkNWZjYzI1ZTA2ZTUxMmMyYjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MDg0ODAy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#pullrequestreview-349084802", "createdAt": "2020-01-28T01:28:16Z", "commit": {"oid": "47df9b05c40225e44a0d456ba6847c986b27f6cb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzAzMTQw", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#pullrequestreview-350303140", "createdAt": "2020-01-29T17:48:06Z", "commit": {"oid": "47df9b05c40225e44a0d456ba6847c986b27f6cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzo0ODowNlrOFjRtcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzo0ODowNlrOFjRtcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUzNDY0Mw==", "bodyText": "We skip this check if it is MAC os by checking OS property.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#discussion_r372534643", "createdAt": "2020-01-29T17:48:06Z", "author": {"login": "xiaoqin2012"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/log/StreamLogFiles.java", "diffHunk": "@@ -168,10 +168,6 @@ private long initStreamLogDirectory() {\n             String corfuDir = logDir.getParent().toString();\n             FileStore corfuDirBackend = Files.getFileStore(Paths.get(corfuDir));\n \n-            if (corfuDirBackend.isReadOnly()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47df9b05c40225e44a0d456ba6847c986b27f6cb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjA1OTA3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#pullrequestreview-351205907", "createdAt": "2020-01-30T23:11:17Z", "commit": {"oid": "7090990c7785877c98ab47bc7c96bbbd71614e19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjE3NDQ4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#pullrequestreview-351217448", "createdAt": "2020-01-30T23:43:26Z", "commit": {"oid": "7090990c7785877c98ab47bc7c96bbbd71614e19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMzo0MzoyNlrOFj9jiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMzo0MzoyNlrOFj9jiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI1MzAwMA==", "bodyText": "Just saw this comment in JDK source code:\nhttps://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/io/File.java#L780\nLooks like the parent filesystem check may still be necessary  in some cases in addition to the directory check here, though I understand it's still not 100% guarantee.\nCan we try to increase JVM privilege to overcome this issue? Or use another directory check API with stronger guarantee?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#discussion_r373253000", "createdAt": "2020-01-30T23:43:26Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/log/StreamLogFiles.java", "diffHunk": "@@ -168,10 +168,6 @@ private long initStreamLogDirectory() {\n             String corfuDir = logDir.getParent().toString();\n             FileStore corfuDirBackend = Files.getFileStore(Paths.get(corfuDir));\n \n-            if (corfuDirBackend.isReadOnly()) {\n-                throw new LogUnitException(\"Cannot start Corfu on a read-only filesystem:\" + corfuDir);\n-            }\n-\n             File corfuDirFile = new File(corfuDir);\n             if (!corfuDirFile.canWrite()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7090990c7785877c98ab47bc7c96bbbd71614e19"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMzE3MjIy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2329#pullrequestreview-351317222", "createdAt": "2020-01-31T06:44:35Z", "commit": {"oid": "7090990c7785877c98ab47bc7c96bbbd71614e19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fad91140c32494675700a76e3e904c4fa47a104c", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/fad91140c32494675700a76e3e904c4fa47a104c", "committedDate": "2020-02-04T20:33:49Z", "message": "Remove Parent Filesystem read-only check for LogUnitServer\n\nStarting with Mac OS X 10.15 the parent filesystem returned\nby the System.getProperty(\"java.io.tmpdir\") is marked as\nread-only. However this does not mean that the returned\ntemporary directory itself is read-only.\nSo given that this can happen in production as well,\nremoving the redundant parent filesystem read-only\ncheck would prevent false panics and allow IT tests\nto run on Mac as well."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8752ef22fdd3fe6d086ef61c3063a73d53b03cea", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/8752ef22fdd3fe6d086ef61c3063a73d53b03cea", "committedDate": "2020-02-04T07:34:19Z", "message": "Merge branch 'master' into catalinaLogUnitFix"}, "afterCommit": {"oid": "fad91140c32494675700a76e3e904c4fa47a104c", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/fad91140c32494675700a76e3e904c4fa47a104c", "committedDate": "2020-02-04T20:33:49Z", "message": "Remove Parent Filesystem read-only check for LogUnitServer\n\nStarting with Mac OS X 10.15 the parent filesystem returned\nby the System.getProperty(\"java.io.tmpdir\") is marked as\nread-only. However this does not mean that the returned\ntemporary directory itself is read-only.\nSo given that this can happen in production as well,\nremoving the redundant parent filesystem read-only\ncheck would prevent false panics and allow IT tests\nto run on Mac as well."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4fad678e9fb7ab4ecac72d5fcc25e06e512c2b0", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/e4fad678e9fb7ab4ecac72d5fcc25e06e512c2b0", "committedDate": "2020-02-04T22:03:03Z", "message": "Merge branch 'master' into catalinaLogUnitFix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3434, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}