{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NDY4NzE5", "number": 2492, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODo1MzowMFrODsktsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODo1MzowMFrODsktsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MDY1NDU4OnYy", "diffSide": "RIGHT", "path": "runtime/src/main/java/org/corfudb/runtime/view/stream/AbstractQueuedStreamView.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODo1MzowMFrOF9fvRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzo0MzoxNFrOF91CSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAyNzQ2MA==", "bodyText": "Actually for raw streams, looks like we never load the checkpoints: in line 356 there is a filter .filter(x -> x.containsStream(context.id)), which filters out the entries on checkpoint stream, but we still read it because the filter is applied after the read, which is unnecessary. If that is the case, I think we need a clean up, otherwise it's ineffiecient and the logic is fragile, but maybe be can do later as we are short of time now.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2492#discussion_r400027460", "createdAt": "2020-03-30T08:53:00Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/stream/AbstractQueuedStreamView.java", "diffHunk": "@@ -370,6 +371,7 @@ private void processTrimmedException(TrimmedException te) {\n         } else {\n             // Clear the entries which were read\n             context.readQueue.headSet(maxGlobal, true).clear();\n+            context.readCpQueue.headSet(maxGlobal, true).clear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc5e512c3ffa1e7c5c98ac011c788377f273f3ac"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3NjM5NQ==", "bodyText": "so, that's the comment I added as I reminder for us to discuss on what is the right behavior. We do \"load\" the checkpoint (in the sense that we get the addresses for it and we read them, but we don't return them to the consumer of the remaining API). So we need to define the correct behavior, if we decide not to return them we should do a bit of refactoring, cause that means that trying to reuse the stream layer In the same way for object consumption vs. raw consumption was actually not correct and is inefficient, as they behave differently.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2492#discussion_r400376395", "createdAt": "2020-03-30T17:43:14Z", "author": {"login": "annym"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/stream/AbstractQueuedStreamView.java", "diffHunk": "@@ -370,6 +371,7 @@ private void processTrimmedException(TrimmedException te) {\n         } else {\n             // Clear the entries which were read\n             context.readQueue.headSet(maxGlobal, true).clear();\n+            context.readCpQueue.headSet(maxGlobal, true).clear();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAyNzQ2MA=="}, "originalCommit": {"oid": "dc5e512c3ffa1e7c5c98ac011c788377f273f3ac"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1956, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}