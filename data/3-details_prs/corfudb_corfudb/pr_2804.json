{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExOTQ1MDg3", "number": 2804, "title": "CorfuStore streaming redesign part 1 - interfaces.", "bodyText": "Overview\nDescription:\nImplements backward compatible interfaces for CorfuStore streaming redeisgn.\nRelated issue(s) (if applicable): #\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-10-29T01:09:48Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804", "merged": true, "mergeCommit": {"oid": "d2fd1509ba0b8a72cf602db3b8b3c7386e53c313"}, "closed": true, "closedAt": "2020-11-06T03:15:58Z", "author": {"login": "WenbinZhu"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXHrZnAFqTUxOTI2NDYxOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZqfUnABqjM5NjQ3MzgzODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MjY0NjE4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-519264618", "createdAt": "2020-10-29T01:14:14Z", "commit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToxNDoxNFrOHqDC8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToxNDoxNFrOHqDC8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjE0NA==", "bodyText": "Codacy found an issue: Use explicit scoping instead of the default package private level", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r513852144", "createdAt": "2020-10-29T01:14:14Z", "author": {"login": "corfudb-bot"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.\n      * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to a specific a table in a namespace or the entire namespace.\n+     * Objects returned will honor transactional boundaries\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n+     */\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDE0NDE2", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-520014416", "createdAt": "2020-10-29T19:43:31Z", "commit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTo0MzozMlrOHqrzyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTo0NDowNFrOHqr00Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDAxMQ==", "bodyText": "typo: Subscribe to a specific table in a namespace or all tables in the namespace", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514520011", "createdAt": "2020-10-29T19:43:32Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.\n      * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to a specific a table in a namespace or the entire namespace.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDI3Mw==", "bodyText": "existing typo: Subscribe to a specific table in a namespace or to all tables in a namespace", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514520273", "createdAt": "2020-10-29T19:44:04Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -201,24 +202,46 @@ public Query query(@Nonnull final String namespace) {\n     /**\n      * Subscribe to a specific a table in a namespace or the entire namespace.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15b00756ba11d45e7d4812289864d623d3837a46", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/15b00756ba11d45e7d4812289864d623d3837a46", "committedDate": "2020-10-29T01:05:40Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/1f47ce020e219c442c5895109839492865df6e37", "committedDate": "2020-10-29T21:24:20Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTQ0NDIx", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-520144421", "createdAt": "2020-10-29T22:53:30Z", "commit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjo1MzozMFrOHqxeIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjo1Mzo1MFrOHqxeog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjc2OQ==", "bodyText": "If a table has not been opened, this would be null and line 145 would hit a null pointer exception right?\nDo you want to throw an exception instead?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514612769", "createdAt": "2020-10-29T22:53:30Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +123,33 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from\n+     */\n+    public synchronized <K extends Message, V extends Message, M extends Message>\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   long startAddress) {\n+        // The table should be opened full schema before subscription.\n+        TableRegistry registry = runtime.getTableRegistry();\n+        List<TableSchema<K, V, M>> tableSchemas = tablesOfInterest\n+                .stream()\n+                .map(tName -> {\n+                    Table<K, V, M> table = registry.getTable(namespace, tName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjg5OA==", "bodyText": "Can one of these tests still carry the old subscribe() api since some verticals may still need to use the old form without actually depending on the tables being opened?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514612898", "createdAt": "2020-10-29T22:53:50Z", "author": {"login": "hisundar"}, "path": "test/src/test/java/org/corfudb/integration/StreamingIT.java", "diffHunk": "@@ -142,8 +144,7 @@ public void testStreamingSingleTable() throws Exception {\n \n         // Subscribe to streaming updates from the table.\n         StreamListenerImpl s1n1t1 = new StreamListenerImpl(\"s1n1t1\");\n-        store.subscribe(s1n1t1, \"n1\",\n-                Collections.singletonList(new TableSchema(\"t1\", Uuid.class, Uuid.class, Uuid.class)), ts1);\n+        store.subscribe(s1n1t1, \"n1\", defaultStreamTag, Collections.singletonList(\"t1\"), ts1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/1f47ce020e219c442c5895109839492865df6e37", "committedDate": "2020-10-29T21:24:20Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/da4891d3975df9e6b7b75fbabd66f8fd16f3f793", "committedDate": "2020-10-30T00:04:19Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzUwMDM5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-520350039", "createdAt": "2020-10-30T03:11:18Z", "commit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMzoxMToxOVrOHq6ldg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMzoxMToxOVrOHq6ldg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc2MjEwMg==", "bodyText": "Right, so can we just mention that in the java doc of this method?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514762102", "createdAt": "2020-10-30T03:11:19Z", "author": {"login": "hisundar"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +123,33 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from\n+     */\n+    public synchronized <K extends Message, V extends Message, M extends Message>\n+    void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   long startAddress) {\n+        // The table should be opened full schema before subscription.\n+        TableRegistry registry = runtime.getTableRegistry();\n+        List<TableSchema<K, V, M>> tableSchemas = tablesOfInterest\n+                .stream()\n+                .map(tName -> {\n+                    Table<K, V, M> table = registry.getTable(namespace, tName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYxMjc2OQ=="}, "originalCommit": {"oid": "1f47ce020e219c442c5895109839492865df6e37"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzc2MTc5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-520376179", "createdAt": "2020-10-30T04:54:26Z", "commit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDo1NDoyNlrOHrAeXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDo1NDoyNlrOHrAeXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg1ODU5MA==", "bodyText": "why not pass TableSchema instead of these 3 parameters?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r514858590", "createdAt": "2020-10-30T04:54:26Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -58,18 +58,35 @@\n     @Getter\n     private final TableMetrics metrics;\n \n+    @Getter\n+    private final Class<K> keyClass;\n+\n+    @Getter\n+    private final Class<V> valueClass;\n+\n+    @Getter\n+    private final Class<M> metadataClass;\n+\n     /**\n      * Returns a Table instance backed by a CorfuTable.\n      *\n-     * @param namespace               Namespace of the table.\n-     * @param fullyQualifiedTableName Fully qualified table name.\n-     * @param valueSchema             Value schema to identify secondary keys.\n-     * @param corfuRuntime            Connected instance of the Corfu Runtime.\n-     * @param serializer              Protobuf Serializer.\n+     * @param namespace               namespace of the table\n+     * @param fullyQualifiedTableName Fully qualified table name\n+     * @param kClass                  key class\n+     * @param vClass                  value class\n+     * @param mClass                  metadata class\n+     * @param valueSchema             value schema to identify secondary keys\n+     * @param corfuRuntime            connected instance of the Corfu Runtime\n+     * @param serializer              protobuf serializer\n+     * @param streamingMapSupplier    supplier of underlying map data structure\n+     * @param versionPolicy           versioning policy\n      */\n     @Nonnull\n     public Table(@Nonnull final String namespace,\n                  @Nonnull final String fullyQualifiedTableName,\n+                 @Nonnull final Class<K> kClass,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da4891d3975df9e6b7b75fbabd66f8fd16f3f793", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/da4891d3975df9e6b7b75fbabd66f8fd16f3f793", "committedDate": "2020-10-30T00:04:19Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "aeb26853b6d69372c4bc352a5741c702fe7973f5", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/aeb26853b6d69372c4bc352a5741c702fe7973f5", "committedDate": "2020-10-30T18:45:37Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aeb26853b6d69372c4bc352a5741c702fe7973f5", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/aeb26853b6d69372c4bc352a5741c702fe7973f5", "committedDate": "2020-10-30T18:45:37Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/5662634902f3603e04cac5c2bdb7bd89add1238d", "committedDate": "2020-10-30T18:46:16Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwOTkwMzU1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-520990355", "createdAt": "2020-10-30T19:51:28Z", "commit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxOTo1MToyOFrOHreFcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMDowOTozOVrOHreldQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0MzcyOA==", "bodyText": "what happens if this address has been checkpointed and trimmed?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515343728", "createdAt": "2020-10-30T19:51:28Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -123,6 +124,35 @@ void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace\n         subscriptions.put(streamListener, new StreamSubscriber(task, scheduledFuture));\n     }\n \n+    /**\n+     * Subscribe to updates.\n+     *\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0NzgzNw==", "bodyText": "this method can be made default instead of public", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515347837", "createdAt": "2020-10-30T20:00:43Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/StreamManager.java", "diffHunk": "@@ -88,10 +89,10 @@ public void shutdown() {\n     /**\n      * Subscribe to updates.\n      *\n-     * @param streamListener   Client listener.\n-     * @param namespace        Namespace of interest.\n-     * @param tablesOfInterest Only updates from these tables will be returned.\n-     * @param startAddress     Address to start the notifications from.\n+     * @param streamListener   client listener\n+     * @param namespace        namespace of interest\n+     * @param tablesOfInterest only updates from these tables will be returned\n+     * @param startAddress     address to start the notifications from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM1MTkyNQ==", "bodyText": "can we derive value and metadata classes from the value and metadata schemas?  Also is the metadataSchema param missing in the comment?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r515351925", "createdAt": "2020-10-30T20:09:39Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -58,18 +58,35 @@\n     @Getter\n     private final TableMetrics metrics;\n \n+    @Getter\n+    private final Class<K> keyClass;\n+\n+    @Getter\n+    private final Class<V> valueClass;\n+\n+    @Getter\n+    private final Class<M> metadataClass;\n+\n     /**\n      * Returns a Table instance backed by a CorfuTable.\n      *\n-     * @param namespace               Namespace of the table.\n-     * @param fullyQualifiedTableName Fully qualified table name.\n-     * @param valueSchema             Value schema to identify secondary keys.\n-     * @param corfuRuntime            Connected instance of the Corfu Runtime.\n-     * @param serializer              Protobuf Serializer.\n+     * @param namespace               namespace of the table\n+     * @param fullyQualifiedTableName Fully qualified table name\n+     * @param kClass                  key class\n+     * @param vClass                  value class", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5662634902f3603e04cac5c2bdb7bd89add1238d", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/5662634902f3603e04cac5c2bdb7bd89add1238d", "committedDate": "2020-10-30T18:46:16Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "fa1ad344c3ed59e279ee336f02ebd9d1aa887cfb", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/fa1ad344c3ed59e279ee336f02ebd9d1aa887cfb", "committedDate": "2020-10-30T21:25:14Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa1ad344c3ed59e279ee336f02ebd9d1aa887cfb", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/fa1ad344c3ed59e279ee336f02ebd9d1aa887cfb", "committedDate": "2020-10-30T21:25:14Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "db4453053aa9e5beff5905c563c59823b898333c", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/db4453053aa9e5beff5905c563c59823b898333c", "committedDate": "2020-10-30T21:41:51Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDY2MTkz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-521066193", "createdAt": "2020-10-30T22:19:39Z", "commit": {"oid": "db4453053aa9e5beff5905c563c59823b898333c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db4453053aa9e5beff5905c563c59823b898333c", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/db4453053aa9e5beff5905c563c59823b898333c", "committedDate": "2020-10-30T21:41:51Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "982fd5e90a74deacad196221249a087fc1198590", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/982fd5e90a74deacad196221249a087fc1198590", "committedDate": "2020-11-03T01:17:40Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjQ4ODky", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-522248892", "createdAt": "2020-11-03T07:55:38Z", "commit": {"oid": "982fd5e90a74deacad196221249a087fc1198590"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1NTozOVrOHsjOVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1NTozOVrOHsjOVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NjUwMw==", "bodyText": "Nit: the updates of tablesOfInterest will not be exactly 'returned', right? Considering that this method returns void, it might help people better understand by not saying 'return'. What about '... will be passed to streamListener'?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r516476503", "createdAt": "2020-11-03T07:55:39Z", "author": {"login": "Lujie1996"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -199,26 +200,48 @@ public Query query(@Nonnull final String namespace) {\n     }\n \n     /**\n-     * Subscribe to a specific a table in a namespace or the entire namespace.\n-     * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     * Subscribe to transaction updates on specific tables in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be returned\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to transaction updates on specific tables with the streamTag in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be returned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "982fd5e90a74deacad196221249a087fc1198590"}, "originalPosition": 57}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "982fd5e90a74deacad196221249a087fc1198590", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/982fd5e90a74deacad196221249a087fc1198590", "committedDate": "2020-11-03T01:17:40Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}, "afterCommit": {"oid": "2af0598cda210dd90d78983e01c9ce91a47584c1", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/2af0598cda210dd90d78983e01c9ce91a47584c1", "committedDate": "2020-11-04T19:40:08Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redeisgn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjg1NjA4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#pullrequestreview-523685608", "createdAt": "2020-11-04T19:50:20Z", "commit": {"oid": "2af0598cda210dd90d78983e01c9ce91a47584c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo1MDoyMFrOHtnVbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo1MDoyMFrOHtnVbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU5MjQyOQ==", "bodyText": "Can we use Optional instead of null checks?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2804#discussion_r517592429", "createdAt": "2020-11-04T19:50:20Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuStore.java", "diffHunk": "@@ -199,26 +200,48 @@ public Query query(@Nonnull final String namespace) {\n     }\n \n     /**\n-     * Subscribe to a specific a table in a namespace or the entire namespace.\n-     * Objects returned will honor transactional boundaries\n-     * @param streamListener - callback context.\n-     * @param namespace - the CorfuStore namespace to subscribe to.\n-     * @param tablesOfInterest - If specified, only updates from these tables will be returned.\n-     * @param timestamp - If specified, all stream updates from this timestamp will be returned\n-     *                  - if null, only future updates will be returned.\n+     * Subscribe to transaction updates on specific tables in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param tablesOfInterest only updates from these tables of interest will be sent to listener\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n      */\n+    @Deprecated\n     public <K extends Message, V extends Message, M extends Message>\n     void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n                    @Nonnull List<TableSchema<K, V, M>> tablesOfInterest,\n                    @Nullable Timestamp timestamp) {\n         runtime.getTableRegistry().getStreamManager()\n                 .subscribe(streamListener, namespace, tablesOfInterest,\n-                (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());\n+    }\n+\n+    /**\n+     * Subscribe to transaction updates on specific tables with the streamTag in the namespace.\n+     * Objects returned will honor transactional boundaries.\n+     *\n+     * @param streamListener   callback context\n+     * @param namespace        the CorfuStore namespace to subscribe to\n+     * @param streamTag        only updates of tables with the stream tag will be polled\n+     * @param tablesOfInterest only updates from these tables of interest will be sent to listener\n+     * @param timestamp        if specified, all stream updates from this timestamp will be returned\n+     *                         if null, only future updates will be returned\n+     */\n+    public void subscribe(@Nonnull StreamListener streamListener, @Nonnull String namespace,\n+                   @Nonnull String streamTag, @Nonnull List<String> tablesOfInterest,\n+                   @Nullable Timestamp timestamp) {\n+        runtime.getTableRegistry().getStreamManager()\n+                .subscribe(streamListener, namespace, streamTag, tablesOfInterest,\n+                        (timestamp == null) ? getTimestamp().getSequence() : timestamp.getSequence());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2af0598cda210dd90d78983e01c9ce91a47584c1"}, "originalPosition": 66}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc01c2ce911bcebcec4ebd828322528429691f28", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/bc01c2ce911bcebcec4ebd828322528429691f28", "committedDate": "2020-11-04T20:57:52Z", "message": "Merge branch 'master' into ufo_stream_redesign_interface"}, "afterCommit": {"oid": "bf05ad48ff5abd86b3f515811567f6e391ce8279", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/bf05ad48ff5abd86b3f515811567f6e391ce8279", "committedDate": "2020-11-05T03:25:56Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redesign."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e34e58ff259f8f1721d9659a4525b3100844d2b", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/3e34e58ff259f8f1721d9659a4525b3100844d2b", "committedDate": "2020-11-05T22:55:07Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redesign."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77699e6a7e81829b1958ee6a22e48d30994e2917", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/77699e6a7e81829b1958ee6a22e48d30994e2917", "committedDate": "2020-11-05T21:24:29Z", "message": "Merge branch 'master' into ufo_stream_redesign_interface"}, "afterCommit": {"oid": "3e34e58ff259f8f1721d9659a4525b3100844d2b", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/3e34e58ff259f8f1721d9659a4525b3100844d2b", "committedDate": "2020-11-05T22:55:07Z", "message": "CorfuStore streaming redesign part 1 - interfaces.\n\nImplements backward compatible interfaces for CorfuStore streaming redesign."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4116, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}