{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyODg1OTU1", "number": 2839, "title": "Collect Metrics for JVM Safe Point Stats", "bodyText": "Overview\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process.\nWhy should this be merged: Improves debugging cluster instability and performance issues.\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-12-05T03:26:08Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839", "merged": true, "mergeCommit": {"oid": "d30836f8d4a28e98d7b4ca3957206497aaf918f9"}, "closed": true, "closedAt": "2020-12-09T22:54:05Z", "author": {"login": "Maithem"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj8apwAFqTU0NjU1MDc1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkizAyAH2gAyNTMyODg1OTU1OjU4NDQwMjkyZGMyMTg1NDNiYzRhMTU2ZDQ4YmY3ZWVkMzVkMGI4MGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTUwNzUz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#pullrequestreview-546550753", "createdAt": "2020-12-07T21:28:00Z", "commit": {"oid": "537f5f1a7bb4fe46d5432cdb24750862206549c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzE4MDA2", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#pullrequestreview-546718006", "createdAt": "2020-12-08T03:27:46Z", "commit": {"oid": "537f5f1a7bb4fe46d5432cdb24750862206549c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMzoyNzo0NlrOIBFR-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMzoyNzo0NlrOIBFR-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNjAxMA==", "bodyText": "maybe we should use micrometer's JVM metrics? https://micrometer.io/docs/ref/jvm", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#discussion_r538006010", "createdAt": "2020-12-08T03:27:46Z", "author": {"login": "xnull"}, "path": "common/src/main/java/org/corfudb/common/metrics/micrometer/JVMMetrics.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.corfudb.common.metrics.micrometer;\n+\n+import io.micrometer.core.instrument.Gauge;\n+import io.micrometer.core.instrument.MeterRegistry;\n+import java.util.Optional;\n+import lombok.Data;\n+import lombok.Getter;\n+import sun.management.HotspotRuntimeMBean;\n+import sun.management.ManagementFactoryHelper;\n+\n+/** Provides JVM level metrics. */\n+\n+public final class JVMMetrics {\n+\n+    @Getter(lazy=true)\n+    private final static HotspotRuntimeMBean runtimeMBean = ManagementFactoryHelper.getHotspotRuntimeMBean();\n+\n+    @Data\n+    private static class SafePointStats {\n+        long safepointTime;\n+        long safepointCount;\n+    }\n+\n+    public static void register(Optional<MeterRegistry> metricsRegistry) {\n+\n+        if (metricsRegistry.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "537f5f1a7bb4fe46d5432cdb24750862206549c5"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzE4MjMy", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#pullrequestreview-546718232", "createdAt": "2020-12-08T03:28:29Z", "commit": {"oid": "537f5f1a7bb4fe46d5432cdb24750862206549c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "537f5f1a7bb4fe46d5432cdb24750862206549c5", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/537f5f1a7bb4fe46d5432cdb24750862206549c5", "committedDate": "2020-12-05T03:18:35Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}, "afterCommit": {"oid": "680c163f98dadfbcbd94b12c7bbcc05a3d2832b4", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/680c163f98dadfbcbd94b12c7bbcc05a3d2832b4", "committedDate": "2020-12-08T21:53:58Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NjcyNzMx", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#pullrequestreview-547672731", "createdAt": "2020-12-08T22:06:54Z", "commit": {"oid": "680c163f98dadfbcbd94b12c7bbcc05a3d2832b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMjowNjo1NFrOIB4Ypg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMjowNjo1NFrOIB4Ypg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg0MzMwMg==", "bodyText": "@PavelZaytsev this is a bug right? PR #2841 will disable the server metrics.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#discussion_r538843302", "createdAt": "2020-12-08T22:06:54Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/resources/logback.prod.xml", "diffHunk": "@@ -50,7 +50,7 @@\n     <root level=\"info\">\n         <appender-ref ref=\"async_file\"/>\n     </root>\n-    <logger additivity=\"false\" level=\"info\" name=\"org.corfudb.metricsdata\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "680c163f98dadfbcbd94b12c7bbcc05a3d2832b4"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "680c163f98dadfbcbd94b12c7bbcc05a3d2832b4", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/680c163f98dadfbcbd94b12c7bbcc05a3d2832b4", "committedDate": "2020-12-08T21:53:58Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}, "afterCommit": {"oid": "05c8115b947b0efb8c964638330f63a49abc3e66", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/05c8115b947b0efb8c964638330f63a49abc3e66", "committedDate": "2020-12-08T22:08:03Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "committedDate": "2020-12-08T22:15:14Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05c8115b947b0efb8c964638330f63a49abc3e66", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/05c8115b947b0efb8c964638330f63a49abc3e66", "committedDate": "2020-12-08T22:08:03Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}, "afterCommit": {"oid": "72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "committedDate": "2020-12-08T22:15:14Z", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5469324f35183aeb2348b7a94ed548617cdd0cb8", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/5469324f35183aeb2348b7a94ed548617cdd0cb8", "committedDate": "2020-12-09T00:15:58Z", "message": "Merge branch 'master' into stwGCPauseMetric"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8e1e59b78a2ecee1927ec0337e4f7d152a26d66", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/e8e1e59b78a2ecee1927ec0337e4f7d152a26d66", "committedDate": "2020-12-09T06:03:43Z", "message": "Merge branch 'master' into stwGCPauseMetric"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58440292dc218543bc4a156d48bf7eed35d0b80d", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/58440292dc218543bc4a156d48bf7eed35d0b80d", "committedDate": "2020-12-09T18:11:00Z", "message": "Merge branch 'master' into stwGCPauseMetric"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4187, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}