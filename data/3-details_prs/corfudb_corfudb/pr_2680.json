{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMzc5OTEy", "number": 2680, "title": "Allowing retries when RuntimeException gets raised during AddNode workflow", "bodyText": "Overview\nDescription:\nHitting the bug in the AddNode() where we need to retry when RuntimeException is raised from bootstrapManagementServer(). bootstrapManagementServer() wraps TimeoutException as RuntimeException.\nCurrently, RuntimeException gets trickled down to the clients. There should be a retry logic when there is a TimeoutException in bootstrapManagementServer().\nWhy should this be merged:\nEnabling the retry logic during RuntimeException\nRelated issue(s) (if applicable): #\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-08-03T20:25:20Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680", "merged": true, "mergeCommit": {"oid": "41197977d17d39cd4a04d918709d720d7db130f2"}, "closed": true, "closedAt": "2020-08-15T03:52:59Z", "author": {"login": "achinmishra"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7aCAMAFqTQ2MDM4NzI3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-9bxmAH2gAyNDYyMzc5OTEyOmNjYzAxMjAxZmM0N2E4NTBlMmUwY2U2ZjdlN2UxMmY4ZTAzOTRiZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzg3Mjc4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-460387278", "createdAt": "2020-08-03T22:46:54Z", "commit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMjo0Njo1NFrOG7LGpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMjo0Njo1NFrOG7LGpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMTA5NQ==", "bodyText": "This catch will mask the next catch block, because NetworkException and IllegalStateException are also RuntimeException, you need to put it after the next catch block. Please also check with @PavelZaytsev if initially he intentionally wanted to not retry on other runtime exceptions, as there might be some edge cases.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r464701095", "createdAt": "2020-08-03T22:46:54Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -141,6 +141,9 @@ public void invoke() {\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n \n+            } catch(RuntimeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzkxNTI5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-460391529", "createdAt": "2020-08-03T22:59:06Z", "commit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMjo1OTowN1rOG7LVaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMzowMzo1MlrOG7LbHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwNDg3Mg==", "bodyText": "Style -- missing space.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r464704872", "createdAt": "2020-08-03T22:59:07Z", "author": {"login": "vjeko"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -141,6 +141,9 @@ public void invoke() {\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n \n+            } catch(RuntimeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwNjMzNA==", "bodyText": "You need to check for the root cause. If the root cause is not an instance of TImeoutException, you will want to re-throw.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r464706334", "createdAt": "2020-08-03T23:03:52Z", "author": {"login": "vjeko"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -141,6 +141,9 @@ public void invoke() {\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n \n+            } catch(RuntimeException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwNDg3Mg=="}, "originalCommit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDYzOTA4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-461063908", "createdAt": "2020-08-04T18:27:44Z", "commit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODoyNzo0NFrOG7sYvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODoyNzo0NFrOG7sYvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI0NjM5OA==", "bodyText": "Minor thing. Since you touched this piece of code, would be great if you rename x to retryIteration", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r465246398", "createdAt": "2020-08-04T18:27:44Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -141,6 +141,9 @@ public void invoke() {\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n \n+            } catch(RuntimeException e) {\n+                log.warn(\"WorkflowRequest: Additional handling of the exception wrapped herein.\" +\n+                        \" Running {} on attempt {},  cause:\", this, x, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02a9c2c24cd18cb727ec3225e9771732fea88989"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e48646f601f7a852bfc91e1f6d2da9464917864", "author": {"user": {"login": "achinmishra", "name": null}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/7e48646f601f7a852bfc91e1f6d2da9464917864", "committedDate": "2020-08-04T20:47:48Z", "message": "Merge branch 'bugRuntimeExceptionWorkflowRequest' of https://github.com/CorfuDB/CorfuDB into bugRuntimeExceptionWorkflowRequest"}, "afterCommit": {"oid": "f481ad5500c803abeb46f78ced0c434fce37d459", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/f481ad5500c803abeb46f78ced0c434fce37d459", "committedDate": "2020-08-04T20:47:14Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f481ad5500c803abeb46f78ced0c434fce37d459", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/f481ad5500c803abeb46f78ced0c434fce37d459", "committedDate": "2020-08-04T20:47:14Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}, "afterCommit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/e8342e670bf5f7b266313d93e3a5fedf79fa2758", "committedDate": "2020-08-05T18:51:58Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTY2NTI4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-461966528", "createdAt": "2020-08-05T19:38:21Z", "commit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTc1Mjg3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-461975287", "createdAt": "2020-08-05T19:51:54Z", "commit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxOTo1MTo1NFrOG8YRrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxOTo1MTo1NFrOG8YRrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk2NTQ4Ng==", "bodyText": "TimeoutException can't appear here, because it already handled in invoke method", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r465965486", "createdAt": "2020-08-05T19:51:54Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -119,6 +120,20 @@ private void waitForWorkflow(@NonNull UUID workflow, @NonNull ManagementClient c\n         throw new TimeoutException();\n     }\n \n+    /*\n+     * private method to handle exceptions while sendRequest()\n+     */\n+    private void handleException(RuntimeException runtimeException) {\n+        final Throwable cause = ExceptionUtils.getRootCause(runtimeException);\n+        if (cause instanceof TimeoutException ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDIzNjI1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-462023625", "createdAt": "2020-08-05T21:06:09Z", "commit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNzcyMzM3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-462772337", "createdAt": "2020-08-06T18:26:18Z", "commit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODoyNjoxOFrOG8_TFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODoyNzozNVrOG8_Vpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwNDgyMA==", "bodyText": "another curly bracket needed for runtimeException", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r466604820", "createdAt": "2020-08-06T18:26:18Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -119,6 +120,20 @@ private void waitForWorkflow(@NonNull UUID workflow, @NonNull ManagementClient c\n         throw new TimeoutException();\n     }\n \n+    /*\n+     * private method to handle exceptions while sendRequest()\n+     */\n+    private void handleException(RuntimeException runtimeException) {\n+        final Throwable cause = ExceptionUtils.getRootCause(runtimeException);\n+        if (cause instanceof TimeoutException ||\n+                cause instanceof IllegalStateException ||\n+                cause instanceof NetworkException) {\n+            log.warn(\"WorkflowRequest: Error while running {} with cause:\", this, runtimeException);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwNTQ3OA==", "bodyText": "another curly bracket required for exception", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r466605478", "createdAt": "2020-08-06T18:27:35Z", "author": {"login": "pankti-m"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -141,8 +156,10 @@ public void invoke() {\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n \n-            } catch (NetworkException | TimeoutException | IllegalStateException e) {\n-                log.warn(\"WorkflowRequest: Error while running {} on attempt {}, cause:\", this, x, e);\n+            } catch (TimeoutException e) {\n+                log.warn(\"WorkflowRequest: Error while running {} on attempt {}, cause:\", this, retryIteration, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTEzMjk1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-463513295", "createdAt": "2020-08-07T18:18:46Z", "commit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODoxODo0NlrOG9jhjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODoxODo0NlrOG9jhjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5ODM1MQ==", "bodyText": "For your consideration - I personally vote for getting rid of handleException method, it reduces the complexity of the code if you make it flat", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r467198351", "createdAt": "2020-08-07T18:18:46Z", "author": {"login": "xnull"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -141,8 +156,10 @@ public void invoke() {\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n \n-            } catch (NetworkException | TimeoutException | IllegalStateException e) {\n-                log.warn(\"WorkflowRequest: Error while running {} on attempt {}, cause:\", this, x, e);\n+            } catch (TimeoutException e) {\n+                log.warn(\"WorkflowRequest: Error while running {} on attempt {}, cause:\", this, retryIteration, e);\n+            } catch (RuntimeException e) {\n+                handleException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8342e670bf5f7b266313d93e3a5fedf79fa2758", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/e8342e670bf5f7b266313d93e3a5fedf79fa2758", "committedDate": "2020-08-05T18:51:58Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}, "afterCommit": {"oid": "bdb87e3441c356ff0a00f98bd23d13948d1b20c8", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/bdb87e3441c356ff0a00f98bd23d13948d1b20c8", "committedDate": "2020-08-11T21:27:56Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NDcwNDQx", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-465470441", "createdAt": "2020-08-11T22:25:45Z", "commit": {"oid": "bdb87e3441c356ff0a00f98bd23d13948d1b20c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTU1MDk3", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-465555097", "createdAt": "2020-08-12T02:46:49Z", "commit": {"oid": "bdb87e3441c356ff0a00f98bd23d13948d1b20c8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMjo0Njo0OVrOG_P3kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwMjo1MTowMlrOG_P7tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk3MzQ1OQ==", "bodyText": "This logic here is kind of weird, why not just catch RuntimeException and check \"instance of\" and cause in side the catch? IllegalStateException is a RuntimeException, and TimeoutException should not be thrown without being wrapped in RuntimeException, because it's a checked exception.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r468973459", "createdAt": "2020-08-12T02:46:49Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -140,9 +155,10 @@ public void invoke() {\n                 else{\n                     throw new IllegalStateException(\"Orchestrator can not be selected\");\n                 }\n-\n-            } catch (NetworkException | TimeoutException | IllegalStateException e) {\n-                log.warn(\"WorkflowRequest: Error while running {} on attempt {}, cause:\", this, x, e);\n+            } catch (IllegalStateException | TimeoutException e) {\n+                log.warn(\"WorkflowRequest: Error while running {} on attempt {}, cause:\", this, retryIteration, e);\n+            } catch (RuntimeException e) {\n+                handleException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb87e3441c356ff0a00f98bd23d13948d1b20c8"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk3NDUxOQ==", "bodyText": "This seems incorrect. IllegalStateException and NetworkException are RuntimeException, so the cause returned by ExceptionUtils.getRootCause() is null, so \"instance of\" will fail, and exception will be thrown without being retried.\nHere is a quick example for reference:\n@Test\n    public void xxx() {\n        try {\n            throw new NetworkException(\"s\", \"t\");\n        } catch (RuntimeException e) {\n            final Throwable cause = ExceptionUtils.getRootCause(e);\n            if (cause instanceof NetworkException) {\n                System.out.println(1111);\n            } else {\n                System.out.println(2222);\n            }\n        }\n    }\nThe code prints 222 because cause is actually null.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r468974519", "createdAt": "2020-08-12T02:51:02Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -119,6 +120,20 @@ private void waitForWorkflow(@NonNull UUID workflow, @NonNull ManagementClient c\n         throw new TimeoutException();\n     }\n \n+    /*\n+     * private method to handle exceptions while sendRequest()\n+     */\n+    private void handleException(RuntimeException runtimeException) {\n+        final Throwable cause = ExceptionUtils.getRootCause(runtimeException);\n+        if (cause instanceof TimeoutException ||\n+                cause instanceof IllegalStateException ||\n+                cause instanceof NetworkException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb87e3441c356ff0a00f98bd23d13948d1b20c8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02d9ccc49ef519848b6b81afa6c939bfac582b0c", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/02d9ccc49ef519848b6b81afa6c939bfac582b0c", "committedDate": "2020-08-12T23:41:52Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1d7c28d86a48996f6c5410ba837054dac9f36f2", "author": {"user": {"login": "PavelZaytsev", "name": "Pavel Zaytsev"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/f1d7c28d86a48996f6c5410ba837054dac9f36f2", "committedDate": "2020-08-12T19:06:15Z", "message": "Merge branch 'master' into bugRuntimeExceptionWorkflowRequest"}, "afterCommit": {"oid": "02d9ccc49ef519848b6b81afa6c939bfac582b0c", "author": {"user": null}, "url": "https://github.com/CorfuDB/CorfuDB/commit/02d9ccc49ef519848b6b81afa6c939bfac582b0c", "committedDate": "2020-08-12T23:41:52Z", "message": "Allowing retries when RuntimeException gets raised during AddNode workflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NDMyMjQz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#pullrequestreview-466432243", "createdAt": "2020-08-13T04:15:09Z", "commit": {"oid": "02d9ccc49ef519848b6b81afa6c939bfac582b0c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDoxNTowOVrOG_7YiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDoxNTowOVrOG_7YiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY4NjQwOQ==", "bodyText": "You may need to add the number of attemp in the log, same as what it does when we catch the exception.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2680#discussion_r469686409", "createdAt": "2020-08-13T04:15:09Z", "author": {"login": "WenbinZhu"}, "path": "runtime/src/main/java/org/corfudb/runtime/view/workflows/WorkflowRequest.java", "diffHunk": "@@ -130,19 +142,20 @@ private void waitForWorkflow(@NonNull UUID workflow, @NonNull ManagementClient c\n      * verified.\n      */\n     public void invoke() {\n-        for (int x = 0; x < retry; x++) {\n+        for (int retryIteration = 0; retryIteration < retry; retryIteration++) {\n             try {\n                 Optional<ManagementClient> orchestrator = getOrchestrator();\n                 if(orchestrator.isPresent()){\n                     UUID workflowId = sendRequest(orchestrator.get());\n                     waitForWorkflow(workflowId, orchestrator.get(), timeout, pollPeriod);\n                 }\n-                else{\n-                    throw new IllegalStateException(\"Orchestrator can not be selected\");\n+                else {\n+                    log.warn(\"Orchestrator can not be selected\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02d9ccc49ef519848b6b81afa6c939bfac582b0c"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a3dbe8f1f2ea0a6c449160e0d529516e49ac813", "author": {"user": {"login": "achinmishra", "name": null}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/1a3dbe8f1f2ea0a6c449160e0d529516e49ac813", "committedDate": "2020-08-13T20:11:46Z", "message": "Merge branch 'master' into bugRuntimeExceptionWorkflowRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f8f54afea0497805a5385bfeee2222668235428", "author": {"user": {"login": "WenbinZhu", "name": "Wenbin Zhu"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/6f8f54afea0497805a5385bfeee2222668235428", "committedDate": "2020-08-14T07:46:54Z", "message": "Merge branch 'master' into bugRuntimeExceptionWorkflowRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccc01201fc47a850e2e0ce6f7e7e12f8e0394be8", "author": {"user": {"login": "Maithem", "name": "Maithem"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/ccc01201fc47a850e2e0ce6f7e7e12f8e0394be8", "committedDate": "2020-08-14T23:43:56Z", "message": "Merge branch 'master' into bugRuntimeExceptionWorkflowRequest"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4345, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}