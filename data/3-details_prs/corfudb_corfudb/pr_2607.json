{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NTE1NzMw", "number": 2607, "title": "Add Logging around Negotiation Response Processing", "bodyText": "Overview\nAdd logging around negotiation response processing for debugging.", "createdAt": "2020-07-08T22:23:50Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607", "merged": true, "mergeCommit": {"oid": "df2af034e19708852742e9821749b919498c4902"}, "closed": true, "closedAt": "2020-07-10T00:18:17Z", "author": {"login": "annym"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczCDGcgH2gAyNDQ2NTE1NzMwOmQ4NDI0NTU1NGYzODMwNjcxNDM1MGE1ZWI2MTkyMjExNzY4MDE5NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczYFn4gFqTQ0NjA0MzAyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d84245554f38306714350a5eb619221176801956", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/d84245554f38306714350a5eb619221176801956", "committedDate": "2020-07-08T22:19:25Z", "message": "Add Logging around Negotiation Response Processing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MTY5OTIz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#pullrequestreview-445169923", "createdAt": "2020-07-08T22:24:48Z", "commit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMjoyNDo0OFrOGu7QbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMjoyNDo0OFrOGu7QbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg1ODU0MA==", "bodyText": "@xiaoqin2012 can you please confirm this TODO note? To be sure keeping it around for future work.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#discussion_r451858540", "createdAt": "2020-07-08T22:24:48Z", "author": {"login": "annym"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/runtime/fsm/NegotiatingState.java", "diffHunk": "@@ -256,11 +264,20 @@ private void processNegotiationResponse(LogReplicationNegotiationResponse negoti\n              * otherwise, start snapshot full sync.\n              */\n             if (logHead <= negotiationResponse.getLastLogProcessed() + 1) {\n+                log.info(\"Resume LOG ENTRY sync. Address space has not been trimmed, deltas are guaranteed to be available. \" +\n+                        \"logHead={}, lastLogProcessed={}\", logHead, negotiationResponse.getLastLogProcessed());\n                 fsm.input(new LogReplicationRuntimeEvent(LogReplicationRuntimeEvent.LogReplicationRuntimeEventType.NEGOTIATION_COMPLETE,\n                         new LogReplicationEvent(LogReplicationEvent.LogReplicationEventType.REPLICATION_START,\n                                 new LogReplicationEventMetadata(LogReplicationEventMetadata.getNIL_UUID(), negotiationResponse.getLastLogProcessed())\n                         )));\n             } else {\n+                // TODO: it is OK for a first phase, but this might not be efficient/accurate, as the next (+1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODQxNTA5", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#pullrequestreview-445841509", "createdAt": "2020-07-09T17:52:44Z", "commit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzo1Mjo0NFrOGvbv0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzo1NjowN1rOGvb2lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM5MDg2NA==", "bodyText": "Debug logs also get printed in the logs.  Do we want to see the response from each node?  If not can we make it trace instead?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#discussion_r452390864", "createdAt": "2020-07-09T17:52:44Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/runtime/fsm/NegotiatingState.java", "diffHunk": "@@ -142,6 +143,9 @@ public void setLeaderEndpoint(String endpoint) {\n      */\n     private void processNegotiationResponse(LogReplicationNegotiationResponse negotiationResponse)\n             throws LogReplicationNegotiationException {\n+\n+        log.debug(\"Process negotiation response {} from {}\", negotiationResponse, fsm.getRemoteClusterId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM5MjU5OQ==", "bodyText": "how can snapshotStart > snapshotTransferred?  Should the comment be updated to make it clearer?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#discussion_r452392599", "createdAt": "2020-07-09T17:56:07Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/runtime/fsm/NegotiatingState.java", "diffHunk": "@@ -200,14 +205,14 @@ private void processNegotiationResponse(LogReplicationNegotiationResponse negoti\n          * \"topologyConfigId\": \"10\"\n          * \"version\": \"release-1.0\"\n          * \"snapshotStart\": \"100\"\n-         * \"snapshotSeqNum\": \" 88\"\n+         * \"snapshotSeqNum\": \"88\"\n          * \"snapshotTransferred\": \"-1\"\n          * \"snapshotApplied\": \"-1\"\n          * \"lastLogEntryProcessed\": \"-1\"\n          */\n         if (negotiationResponse.getSnapshotStart() > negotiationResponse.getSnapshotTransferred()) {\n-            log.info(\"Get the negotiation response {} and will start replication.\",\n-                    negotiationResponse);\n+            log.info(\"Previous Snapshot Sync transfer did not complete. Restart SNAPSHOT sync, snapshotStart={}, snapshotTransferred={}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTY0NTgz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#pullrequestreview-445964583", "createdAt": "2020-07-09T20:58:50Z", "commit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MDQzMDI1", "url": "https://github.com/CorfuDB/CorfuDB/pull/2607#pullrequestreview-446043025", "createdAt": "2020-07-10T00:00:05Z", "commit": {"oid": "d84245554f38306714350a5eb619221176801956"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4225, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}