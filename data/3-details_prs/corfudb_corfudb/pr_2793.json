{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MDk2NjEy", "number": 2793, "title": "CorfuStore option Tx Logging Disabled", "bodyText": "Overview\nLR does require TX Logging to be disabled on the standby site to avoid\ngeneration of DCNs on replicated data and CorfuStore enforces it to be enabled.\nChecklist (Definition of Done):\n\n There are no TODOs left in the code\n Coding conventions (e.g. for logging, unit tests) have been followed\n Change is covered by automated tests\n Public API has Javadoc", "createdAt": "2020-10-16T20:51:58Z", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793", "merged": true, "mergeCommit": {"oid": "b5e26bc15968dcb8abeb85295c7a99d3a31d8f1c"}, "closed": true, "closedAt": "2020-10-21T03:22:33Z", "author": {"login": "annym"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTNQj1gFqTUxMDgwODUyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUf1ZVABqjM5MDA5MTU1Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODA4NTI4", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793#pullrequestreview-510808528", "createdAt": "2020-10-16T21:28:39Z", "commit": {"oid": "f4241125554818f46c01c9ccb1ef628f3d559e1f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODIyNDAx", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793#pullrequestreview-510822401", "createdAt": "2020-10-16T22:04:25Z", "commit": {"oid": "f4241125554818f46c01c9ccb1ef628f3d559e1f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjowNDoyNVrOHjQ_zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjowNDoyNVrOHjQ_zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc0MDY4Nw==", "bodyText": "It will be good to add a comment here that LR simply replicates the streams and does not need it to be added to the transaction log", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793#discussion_r506740687", "createdAt": "2020-10-16T22:04:25Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/receive/LogReplicationMetadataManager.java", "diffHunk": "@@ -59,7 +59,7 @@\n \n     public LogReplicationMetadataManager(CorfuRuntime rt, long topologyConfigId, String localClusterId) {\n         this.runtime = rt;\n-        this.corfuStore = new CorfuStore(runtime);\n+        this.corfuStore = new CorfuStore(runtime, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4241125554818f46c01c9ccb1ef628f3d559e1f"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4241125554818f46c01c9ccb1ef628f3d559e1f", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/f4241125554818f46c01c9ccb1ef628f3d559e1f", "committedDate": "2020-10-16T20:49:39Z", "message": "CorfuStore option Tx Logging Disabled\n\nLR does require TX Logging to be disabled on the standby site to avoid\ngeneration of DCNs on replicated data and CorfuStore enforces it to be enabled."}, "afterCommit": {"oid": "f5572c18e2768249f9f49296256faac9c1f97395", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/f5572c18e2768249f9f49296256faac9c1f97395", "committedDate": "2020-10-17T01:39:50Z", "message": "CorfuStore option Tx Logging Disabled\n\nLR does require TX Logging to be disabled on the standby site to avoid\ngeneration of DCNs on replicated data and CorfuStore enforces it to be enabled."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODY1Njgz", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793#pullrequestreview-510865683", "createdAt": "2020-10-17T02:10:36Z", "commit": {"oid": "f5572c18e2768249f9f49296256faac9c1f97395"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QwMjoxMDozN1rOHjThMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QwMjoxNDo0OFrOHjTicg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4MjAwMg==", "bodyText": "is the relation between data change notification and tx stream general to corfu?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793#discussion_r506782002", "createdAt": "2020-10-17T02:10:37Z", "author": {"login": "pankti-m"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/logreplication/replication/receive/LogReplicationMetadataManager.java", "diffHunk": "@@ -59,7 +59,9 @@\n \n     public LogReplicationMetadataManager(CorfuRuntime rt, long topologyConfigId, String localClusterId) {\n         this.runtime = rt;\n-        this.corfuStore = new CorfuStore(runtime);\n+        // LR does not require transaction logging as we don't want data change notifications on the replicated data", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5572c18e2768249f9f49296256faac9c1f97395"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4MjMyMg==", "bodyText": "slightly unrelated to this change, but do we need to create multiple runtimes?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2793#discussion_r506782322", "createdAt": "2020-10-17T02:14:48Z", "author": {"login": "pankti-m"}, "path": "test/src/test/java/org/corfudb/integration/CorfuReplicationReconfigurationIT.java", "diffHunk": "@@ -179,6 +196,88 @@ public void testSnapshotSyncApplyInterrupted() throws Exception {\n         }\n     }\n \n+    /**\n+     * Validate that no data is written into the Standby's Transaction Log during replication\n+     * of 5K objects.\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void testStandbyTransactionLogging() throws Exception {\n+        final long timeout = 30;\n+\n+        replicationEnded.set(false);\n+\n+        // (1) Subscribe Client to Standby Transaction Log\n+        log.debug(\">>> (1) Subscribe to Transaction Stream on Standby\");\n+        Future<Boolean> consumerState = subscribeTransactionStream();\n+\n+        // (2) Snapshot and Log Entry Sync\n+        log.debug(\">>> (2) Start Snapshot and Log Entry Sync\");\n+        testEndToEndSnapshotAndLogEntrySync();\n+\n+        replicationEnded.set(true);\n+\n+        Boolean txStreamEmpty = consumerState.get(timeout, TimeUnit.SECONDS);\n+        assertThat(txStreamEmpty).isTrue();\n+    }\n+\n+    private Future<Boolean>  subscribeTransactionStream() {\n+\n+        ExecutorService consumer = Executors.newSingleThreadExecutor();\n+        List<CorfuRuntime> consumerRts = new ArrayList<>();\n+\n+        // A thread that starts and consumes transaction updates via the Transaction Stream.\n+        return consumer.submit(() -> {\n+\n+            CorfuRuntime consumerRt = CorfuRuntime.fromParameters(CorfuRuntime.CorfuRuntimeParameters", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5572c18e2768249f9f49296256faac9c1f97395"}, "originalPosition": 85}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea04b5e663e0803a276a63691cbf1cd9aefb8810", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/ea04b5e663e0803a276a63691cbf1cd9aefb8810", "committedDate": "2020-10-20T04:46:17Z", "message": "Make Serializer Non-Static / per Runtime"}, "afterCommit": {"oid": "b7de26fd8d4d0d15d7c9cd732801a5fba49680e9", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/b7de26fd8d4d0d15d7c9cd732801a5fba49680e9", "committedDate": "2020-10-20T04:58:46Z", "message": "Make Serializer Non-Static / per Runtime"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7de26fd8d4d0d15d7c9cd732801a5fba49680e9", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/b7de26fd8d4d0d15d7c9cd732801a5fba49680e9", "committedDate": "2020-10-20T04:58:46Z", "message": "Make Serializer Non-Static / per Runtime"}, "afterCommit": {"oid": "9f1d7446c7879d5a9e4e2339f0a82b9f8be3484e", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/9f1d7446c7879d5a9e4e2339f0a82b9f8be3484e", "committedDate": "2020-10-20T05:18:01Z", "message": "Make Serializer Non-Static / per Runtime"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f1d7446c7879d5a9e4e2339f0a82b9f8be3484e", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/9f1d7446c7879d5a9e4e2339f0a82b9f8be3484e", "committedDate": "2020-10-20T05:18:01Z", "message": "Make Serializer Non-Static / per Runtime"}, "afterCommit": {"oid": "64bccb312f4e30e7d3d812b82b5e617fe69d0f36", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/64bccb312f4e30e7d3d812b82b5e617fe69d0f36", "committedDate": "2020-10-20T17:17:03Z", "message": "Make Serializer Non-Static / per Runtime"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64bccb312f4e30e7d3d812b82b5e617fe69d0f36", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/64bccb312f4e30e7d3d812b82b5e617fe69d0f36", "committedDate": "2020-10-20T17:17:03Z", "message": "Make Serializer Non-Static / per Runtime"}, "afterCommit": {"oid": "9ec1f806046aa0e991ddd4b50ab8abfd2b67d3ce", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/9ec1f806046aa0e991ddd4b50ab8abfd2b67d3ce", "committedDate": "2020-10-20T19:53:22Z", "message": "ProtobufSerializer: Reuse existing classMap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2955e6deaeb810f18e296ab0d5474ae1d1c7946e", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/2955e6deaeb810f18e296ab0d5474ae1d1c7946e", "committedDate": "2020-10-20T20:07:30Z", "message": "CorfuStore option Tx Logging Disabled\n\nLR does require TX Logging to be disabled on the standby site to avoid\ngeneration of DCNs on replicated data and CorfuStore enforces it to be enabled."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "873c63ffdea2a83066fe8f33a9d8867053d41af1", "author": {"user": {"login": "annym", "name": "Anny Martinez"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/873c63ffdea2a83066fe8f33a9d8867053d41af1", "committedDate": "2020-10-20T20:07:30Z", "message": "Add Runtime TX Logging Enabled for Force Snapshot Sync Use Case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ec1f806046aa0e991ddd4b50ab8abfd2b67d3ce", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/9ec1f806046aa0e991ddd4b50ab8abfd2b67d3ce", "committedDate": "2020-10-20T19:53:22Z", "message": "ProtobufSerializer: Reuse existing classMap"}, "afterCommit": {"oid": "273497f68fcab71cfbef53f5cced4dc97dce0c2d", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/273497f68fcab71cfbef53f5cced4dc97dce0c2d", "committedDate": "2020-10-20T20:07:30Z", "message": "ProtobufSerializer: Reuse existing classMap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "273497f68fcab71cfbef53f5cced4dc97dce0c2d", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/273497f68fcab71cfbef53f5cced4dc97dce0c2d", "committedDate": "2020-10-20T20:07:30Z", "message": "ProtobufSerializer: Reuse existing classMap"}, "afterCommit": {"oid": "ce4a03cbf678b33fe826d1b3d0427307347c1e31", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/ce4a03cbf678b33fe826d1b3d0427307347c1e31", "committedDate": "2020-10-20T21:38:08Z", "message": "ProtobufSerializer: Reuse existing classMap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f5fd28acdc077c5f9e90c038a9d851127919c84", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/9f5fd28acdc077c5f9e90c038a9d851127919c84", "committedDate": "2020-10-20T21:40:57Z", "message": "ProtobufSerializer: Reuse existing classMap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce4a03cbf678b33fe826d1b3d0427307347c1e31", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/ce4a03cbf678b33fe826d1b3d0427307347c1e31", "committedDate": "2020-10-20T21:38:08Z", "message": "ProtobufSerializer: Reuse existing classMap"}, "afterCommit": {"oid": "9f5fd28acdc077c5f9e90c038a9d851127919c84", "author": {"user": {"login": "hisundar", "name": "Sundar Sridharan"}}, "url": "https://github.com/CorfuDB/CorfuDB/commit/9f5fd28acdc077c5f9e90c038a9d851127919c84", "committedDate": "2020-10-20T21:40:57Z", "message": "ProtobufSerializer: Reuse existing classMap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4102, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}