{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1ODM1MzYx", "number": 2769, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwMDowNToxM1rOEi0giw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xOFQyMTozODo1MFrOFcFJVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0OTQ3MzM5OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwMDowNToxM1rOHQ4Tfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwNzozMTowOFrOHQ6Rmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTc1OQ==", "bodyText": "You can use putBytes(ByteBuffer bytes) directly", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487461759", "createdAt": "2020-09-13T00:05:13Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -93,18 +97,15 @@ public DataStore(@Nonnull Map<String, Object> opts,\n         return Caffeine.newBuilder().build(k -> null);\n     }\n \n-\n-    public static int getChecksum(byte[] bytes) {\n+    private static int getChecksum(byte[] bytes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5NDA0Mg==", "bodyText": "See below comments.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487494042", "createdAt": "2020-09-13T07:31:08Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -93,18 +97,15 @@ public DataStore(@Nonnull Map<String, Object> opts,\n         return Caffeine.newBuilder().build(k -> null);\n     }\n \n-\n-    public static int getChecksum(byte[] bytes) {\n+    private static int getChecksum(byte[] bytes) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTc1OQ=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0OTQ3NDU5OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwMDowNzoxM1rOHQ4UDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwNzoyOTo1OFrOHQ6RLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTkwMg==", "bodyText": "String.getBytes will create a new buffer, you can eliminate it by using the String instead.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487461902", "createdAt": "2020-09-13T00:07:13Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -129,12 +133,19 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             String jsonPayload = JsonUtils.parser.toJson(value, value.getClass());\n                             byte[] bytes = jsonPayload.getBytes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5MzkzMw==", "bodyText": "See below comments.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487493933", "createdAt": "2020-09-13T07:29:58Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -129,12 +133,19 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             String jsonPayload = JsonUtils.parser.toJson(value, value.getClass());\n                             byte[] bytes = jsonPayload.getBytes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTkwMg=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0OTQ3NTM1OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwMDowODo0MFrOHQ4UZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMDoyNTozMlrOHRAoxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTk5MQ==", "bodyText": "To eliminate the other buffer copy you can just use buffer.writeCharSequence(jsonPayload, Charset.defaultCharset()); , or maybe explicitly set it to UTF-8", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487461991", "createdAt": "2020-09-13T00:08:40Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -129,12 +133,19 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             String jsonPayload = JsonUtils.parser.toJson(value, value.getClass());\n                             byte[] bytes = jsonPayload.getBytes();\n \n-                            ByteBuffer buffer = ByteBuffer.allocate(bytes.length\n-                                    + Integer.BYTES);\n-                            buffer.putInt(getChecksum(bytes));\n-                            buffer.put(bytes);\n-                            Files.write(tmpPath, buffer.array(), StandardOpenOption.CREATE,\n+                            buffer = Unpooled.directBuffer(bytes.length + Integer.BYTES);\n+                            buffer.writeInt(getChecksum(bytes));\n+                            buffer.writeBytes(bytes);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5Mzc1MQ==", "bodyText": "There are some implementation problems if we do buffer.writeCharSequence. 1) depending on the charset, the final capacity of byte buffer is usually not equal to string.length(), so there might be overheads to scale the the initial capacity. 2) the  checksum needs to be serialized before the payload, so we need to rewind the index and rewrite checksum, and the hasher.putBytes(ByteBuffer bytes) takes a nio buffer instead of a netty bytebuf, which requires more index manipulation, seems a bit unclean and error prone...", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487493751", "createdAt": "2020-09-13T07:28:25Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -129,12 +133,19 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             String jsonPayload = JsonUtils.parser.toJson(value, value.getClass());\n                             byte[] bytes = jsonPayload.getBytes();\n \n-                            ByteBuffer buffer = ByteBuffer.allocate(bytes.length\n-                                    + Integer.BYTES);\n-                            buffer.putInt(getChecksum(bytes));\n-                            buffer.put(bytes);\n-                            Files.write(tmpPath, buffer.array(), StandardOpenOption.CREATE,\n+                            buffer = Unpooled.directBuffer(bytes.length + Integer.BYTES);\n+                            buffer.writeInt(getChecksum(bytes));\n+                            buffer.writeBytes(bytes);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTk5MQ=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU5ODI3Nw==", "bodyText": "Its actually not variable for Layout.java, it can be fixed to UTF-8. You're already using a direct buffer.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487598277", "createdAt": "2020-09-14T00:25:32Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -129,12 +133,19 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             String jsonPayload = JsonUtils.parser.toJson(value, value.getClass());\n                             byte[] bytes = jsonPayload.getBytes();\n \n-                            ByteBuffer buffer = ByteBuffer.allocate(bytes.length\n-                                    + Integer.BYTES);\n-                            buffer.putInt(getChecksum(bytes));\n-                            buffer.put(bytes);\n-                            Files.write(tmpPath, buffer.array(), StandardOpenOption.CREATE,\n+                            buffer = Unpooled.directBuffer(bytes.length + Integer.BYTES);\n+                            buffer.writeInt(getChecksum(bytes));\n+                            buffer.writeBytes(bytes);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTk5MQ=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0OTQ3ODQyOnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwMDoxMzozNlrOHQ4VyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwNzoyODo0NlrOHQ6QmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MjM0NA==", "bodyText": "This is failing the build.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487462344", "createdAt": "2020-09-13T00:13:36Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -143,27 +154,28 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             cleanupTask.accept(dsFileName);\n                         } catch (IOException e) {\n                             throw new RuntimeException(e);\n+                        } finally {\n+                            if (buffer != null) {\n+                                buffer.release();\n+                            }\n+                            IOUtils.closeQuietly(writeChannel);\n                         }\n                     }\n \n                     @Override\n-                    public synchronized void delete(@Nonnull String key,\n-                                                    @Nullable Object value,\n-                                                    @Nonnull RemovalCause cause) {\n-                        try {\n-                            Path path = Paths.get(logDirPath, key);\n-                            Files.deleteIfExists(path);\n-                        } catch (IOException e) {\n-                            throw new RuntimeException(e);\n-                        }\n+                    public void delete(@Nonnull String key,\n+                                       @Nullable Object value,\n+                                       @Nonnull RemovalCause cause) {\n+                        // Delete should not remove the underlying file.\n+                        // Removal of underlying file is done by cleanupTask.\n                     }\n                 })\n-                .maximumSize(dsCacheSize)\n                 .build();\n     }\n \n     private <T> T load(Class<T> tClass, String key) {\n         try {\n+            System.out.println(1111);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 148}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5Mzc4NA==", "bodyText": "good catch! removed.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487493784", "createdAt": "2020-09-13T07:28:46Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -143,27 +154,28 @@ public synchronized void write(@Nonnull String key, @Nonnull Object value) {\n                             cleanupTask.accept(dsFileName);\n                         } catch (IOException e) {\n                             throw new RuntimeException(e);\n+                        } finally {\n+                            if (buffer != null) {\n+                                buffer.release();\n+                            }\n+                            IOUtils.closeQuietly(writeChannel);\n                         }\n                     }\n \n                     @Override\n-                    public synchronized void delete(@Nonnull String key,\n-                                                    @Nullable Object value,\n-                                                    @Nonnull RemovalCause cause) {\n-                        try {\n-                            Path path = Paths.get(logDirPath, key);\n-                            Files.deleteIfExists(path);\n-                        } catch (IOException e) {\n-                            throw new RuntimeException(e);\n-                        }\n+                    public void delete(@Nonnull String key,\n+                                       @Nullable Object value,\n+                                       @Nonnull RemovalCause cause) {\n+                        // Delete should not remove the underlying file.\n+                        // Removal of underlying file is done by cleanupTask.\n                     }\n                 })\n-                .maximumSize(dsCacheSize)\n                 .build();\n     }\n \n     private <T> T load(Class<T> tClass, String key) {\n         try {\n+            System.out.println(1111);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MjM0NA=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 148}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0OTQ4NDkzOnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwMDoyNDoyNlrOHQ4Ytg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMDo1NzowNVrOHRmTCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MzA5NA==", "bodyText": "Calling delete and not doing anything is a little weird. I would rather just delete the method from the interface. It's not used anyways.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487463094", "createdAt": "2020-09-13T00:24:26Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -223,7 +233,7 @@ public synchronized void delete(@Nonnull String key,\n     }\n \n     @Override\n-    public synchronized <T> void delete(KvRecord<T> key) {\n+    public <T> void delete(KvRecord<T> key) {\n         cache.invalidate(key.getFullKeyName());\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5Mzg3NQ==", "bodyText": "Delete will remove the in-memory cache entry, but not remove the underlying file. This is being used in tests.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487493875", "createdAt": "2020-09-13T07:29:34Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -223,7 +233,7 @@ public synchronized void delete(@Nonnull String key,\n     }\n \n     @Override\n-    public synchronized <T> void delete(KvRecord<T> key) {\n+    public <T> void delete(KvRecord<T> key) {\n         cache.invalidate(key.getFullKeyName());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MzA5NA=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU5ODAxNQ==", "bodyText": "It's only used in the test. I think CacheWriter is not needed here, you can probably use a loading cache.\nIf you really want to keep it then maybe call it invalidate.\n/**\n   * Deletes the value corresponding to the {@code key} from the external resource. The cache will\n   * communicate a delete when the entry is explicitly removed or evicted.\n   *\n   * @param key the non-null key whose value was removed\n   * @param value the value associated with {@code key}, or {@code null} if collected\n   * @param cause the reason for which the entry was removed\n   * @throws RuntimeException or Error, in which case the mapping is unchanged\n   */\n  void delete(@Nonnull K key, @Nullable V value, @Nonnull RemovalCause cause);", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487598015", "createdAt": "2020-09-14T00:23:42Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -223,7 +233,7 @@ public synchronized void delete(@Nonnull String key,\n     }\n \n     @Override\n-    public synchronized <T> void delete(KvRecord<T> key) {\n+    public <T> void delete(KvRecord<T> key) {\n         cache.invalidate(key.getFullKeyName());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MzA5NA=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY2MTc1Mw==", "bodyText": "@Maithem I think the reason that we need a CacheWriter is because the write to cache and disk needs to be atomic. And since the interface is a generic kv datastore instead of a cache, maybe it's better to still call it delete?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487661753", "createdAt": "2020-09-14T05:37:37Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -223,7 +233,7 @@ public synchronized void delete(@Nonnull String key,\n     }\n \n     @Override\n-    public synchronized <T> void delete(KvRecord<T> key) {\n+    public <T> void delete(KvRecord<T> key) {\n         cache.invalidate(key.getFullKeyName());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MzA5NA=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcwNTAyMQ==", "bodyText": "I see. You can just use the cache as a concurrent hash map if you need per-key atomicity. My only point is why keep it if you dont need it.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r487705021", "createdAt": "2020-09-14T07:29:25Z", "author": {"login": "Maithem"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -223,7 +233,7 @@ public synchronized void delete(@Nonnull String key,\n     }\n \n     @Override\n-    public synchronized <T> void delete(KvRecord<T> key) {\n+    public <T> void delete(KvRecord<T> key) {\n         cache.invalidate(key.getFullKeyName());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MzA5NA=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNTMwNA==", "bodyText": "Yea, right now we need this interface for tests, and since it's a generic kv store interface, maybe later there will be another impl that actually does delete for purposes other than tests.", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r488215304", "createdAt": "2020-09-14T20:57:05Z", "author": {"login": "WenbinZhu"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -223,7 +233,7 @@ public synchronized void delete(@Nonnull String key,\n     }\n \n     @Override\n-    public synchronized <T> void delete(KvRecord<T> key) {\n+    public <T> void delete(KvRecord<T> key) {\n         cache.invalidate(key.getFullKeyName());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MzA5NA=="}, "originalCommit": {"oid": "6dbe9a92e1f55bcd66dd0bcfbc14fe2e72a4a666"}, "originalPosition": 192}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0OTg4NzU2OnYy", "diffSide": "RIGHT", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xOFQyMTozODo1MFrOIn84uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xOFQyMTozODo1MFrOIn84uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODc2MjkzNg==", "bodyText": "Replace 4 with Integer.BYTES?", "url": "https://github.com/CorfuDB/CorfuDB/pull/2769#discussion_r578762936", "createdAt": "2021-02-18T21:38:50Z", "author": {"login": "Lujie1996"}, "path": "infrastructure/src/main/java/org/corfudb/infrastructure/datastore/DataStore.java", "diffHunk": "@@ -171,14 +185,12 @@ public synchronized void delete(@Nonnull String key,\n             byte[] bytes = Files.readAllBytes(path);\n             ByteBuffer buf = ByteBuffer.wrap(bytes);\n             int checksum = buf.getInt();\n-            byte[] strBytes = Arrays.copyOfRange(bytes, 4, bytes.length);\n-            if (checksum != getChecksum(strBytes)) {\n+            if (checksum != getChecksum(bytes, 4, bytes.length - 4)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9d519272e015e0ff6b7209dd2a280e091f6a11a"}, "originalPosition": 157}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1696, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}