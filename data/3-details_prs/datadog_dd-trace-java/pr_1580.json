{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNjY2Nzk1", "number": 1580, "title": "avoid creating new strings prior to jar lookup", "bodyText": "Uses the name we will lookup by as the key in the HashMap during building, which has two effects:\n\nDon't need to allocate - this explains some of the unreferenced strings I found in a heap dump taken with EpsilonGC\nMight not need to compute the hash code during the lookup\n\nI don't think this changes behaviour, but I'm not entirely sure.", "createdAt": "2020-06-12T13:02:01Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1580", "merged": true, "mergeCommit": {"oid": "2f36d6f7ca8728f816ae8852b047e03c3fa13baa"}, "closed": true, "closedAt": "2020-06-12T15:39:01Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqi3iSAH2gAyNDMzNjY2Nzk1OmEwMTQ0NjhhMmEyYmI5NDA3MmRjZGM4ZjNjZTk4ODVjZDUxNzBiMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqkRQeAFqTQyOTgxODcyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "committedDate": "2020-06-12T13:28:20Z", "message": "improve InternalJarURLHandler lookup, avoid creating new strings prior to lookup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f892c7ea066f08ea088dad6c45158f249130dff9", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f892c7ea066f08ea088dad6c45158f249130dff9", "committedDate": "2020-06-12T12:41:55Z", "message": "improve InternalJarURLHandler lookup, avoid creating new strings prior to lookup"}, "afterCommit": {"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "committedDate": "2020-06-12T13:28:20Z", "message": "improve InternalJarURLHandler lookup, avoid creating new strings prior to lookup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NzYxNjAx", "url": "https://github.com/DataDog/dd-trace-java/pull/1580#pullrequestreview-429761601", "createdAt": "2020-06-12T13:56:21Z", "commit": {"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5ODEwMjky", "url": "https://github.com/DataDog/dd-trace-java/pull/1580#pullrequestreview-429810292", "createdAt": "2020-06-12T14:55:39Z", "commit": {"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo1NTozOVrOGjHHew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo1NTozOVrOGjHHew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ2OTk0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        int end = name.endsWith(\"data\") ? name.length() - 4 : name.length();\n          \n          \n            \n                        int end = name.endsWith(\".classdata\") ? name.length() - 4 : name.length();", "url": "https://github.com/DataDog/dd-trace-java/pull/1580#discussion_r439469947", "createdAt": "2020-06-12T14:55:39Z", "author": {"login": "randomanderson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java", "diffHunk": "@@ -33,7 +33,10 @@\n           final JarEntry entry = entries.nextElement();\n \n           if (!entry.isDirectory() && entry.getName().startsWith(filePrefix)) {\n-            filenameToEntry.put(entry.getName().substring(internalJarFileName.length()), entry);\n+            String name = entry.getName();\n+            // remove data suffix\n+            int end = name.endsWith(\"data\") ? name.length() - 4 : name.length();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5412d3410c36bbfe34592a8e696d8715a8ba715a", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5412d3410c36bbfe34592a8e696d8715a8ba715a", "committedDate": "2020-06-12T15:04:52Z", "message": "Update dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java\n\nCo-authored-by: Laplie Anderson <randomanderson@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5ODE4NzI2", "url": "https://github.com/DataDog/dd-trace-java/pull/1580#pullrequestreview-429818726", "createdAt": "2020-06-12T15:06:20Z", "commit": {"oid": "5412d3410c36bbfe34592a8e696d8715a8ba715a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2160, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}