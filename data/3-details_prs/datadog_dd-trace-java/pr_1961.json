{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5OTkwODc4", "number": 1961, "title": "specialised Java FJT/FJP instrumentation and context propagation tests", "bodyText": "Smaller change set peeled off #1956", "createdAt": "2020-10-08T15:01:31Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1961", "merged": true, "mergeCommit": {"oid": "cf841fce1402f9c02f079dfdc7b5c907bef58544"}, "closed": true, "closedAt": "2020-10-09T17:57:35Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQjlkQABqjM4NTYxNjkyNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ5NUzABqjM4NjEwNDExOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef2627aa3e82b2b23f51a0f881858eeec356727a", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ef2627aa3e82b2b23f51a0f881858eeec356727a", "committedDate": "2020-10-08T15:00:49Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}, "afterCommit": {"oid": "e280d85c305ecec0a4518255045ab67e6ce33361", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e280d85c305ecec0a4518255045ab67e6ce33361", "committedDate": "2020-10-08T15:47:20Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e280d85c305ecec0a4518255045ab67e6ce33361", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e280d85c305ecec0a4518255045ab67e6ce33361", "committedDate": "2020-10-08T15:47:20Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}, "afterCommit": {"oid": "034e68989c3f220fc13ef69e22583a7bcda8cea7", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/034e68989c3f220fc13ef69e22583a7bcda8cea7", "committedDate": "2020-10-08T16:05:55Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "034e68989c3f220fc13ef69e22583a7bcda8cea7", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/034e68989c3f220fc13ef69e22583a7bcda8cea7", "committedDate": "2020-10-08T16:05:55Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}, "afterCommit": {"oid": "e4b115431046d386ce30a885a0df9f736c1aee46", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e4b115431046d386ce30a885a0df9f736c1aee46", "committedDate": "2020-10-08T16:20:59Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4b115431046d386ce30a885a0df9f736c1aee46", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e4b115431046d386ce30a885a0df9f736c1aee46", "committedDate": "2020-10-08T16:20:59Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}, "afterCommit": {"oid": "3e03b44ed30044ef5798cead6f2fb65e65246ea7", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3e03b44ed30044ef5798cead6f2fb65e65246ea7", "committedDate": "2020-10-08T16:35:58Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdb706ad6f5224061060ab9bb73d49e5e7648e7b", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cdb706ad6f5224061060ab9bb73d49e5e7648e7b", "committedDate": "2020-10-08T16:40:56Z", "message": "check java.version when specifying ForkJoinPool entry points"}, "afterCommit": {"oid": "5e91792d6f7853bbd46f620ec47d5c033d471175", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5e91792d6f7853bbd46f620ec47d5c033d471175", "committedDate": "2020-10-08T16:44:25Z", "message": "check java.version when specifying ForkJoinPool entry points"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e91792d6f7853bbd46f620ec47d5c033d471175", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5e91792d6f7853bbd46f620ec47d5c033d471175", "committedDate": "2020-10-08T16:44:25Z", "message": "check java.version when specifying ForkJoinPool entry points"}, "afterCommit": {"oid": "cd1e20cc86f7d9682d59f900683b1fa11386dda0", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cd1e20cc86f7d9682d59f900683b1fa11386dda0", "committedDate": "2020-10-08T16:58:52Z", "message": "check java.version when specifying ForkJoinPool entry points"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd1e20cc86f7d9682d59f900683b1fa11386dda0", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cd1e20cc86f7d9682d59f900683b1fa11386dda0", "committedDate": "2020-10-08T16:58:52Z", "message": "check java.version when specifying ForkJoinPool entry points"}, "afterCommit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15", "committedDate": "2020-10-08T17:12:37Z", "message": "check java.version when specifying ForkJoinPool entry points"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTk2OTI3", "url": "https://github.com/DataDog/dd-trace-java/pull/1961#pullrequestreview-504996927", "createdAt": "2020-10-08T17:14:14Z", "commit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNDoxNFrOHeobZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNDoxNFrOHeobZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg4MTcwMQ==", "bodyText": "Something like this might be valuable if we start needing to add this in other places: https://github.com/openzipkin/brave/blob/master/brave/src/main/java/brave/internal/Platform.java", "url": "https://github.com/DataDog/dd-trace-java/pull/1961#discussion_r501881701", "createdAt": "2020-10-08T17:14:14Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/instrumentation/java-concurrent/src/main/java/datadog/trace/instrumentation/java/concurrent/JavaForkJoinPoolInstrumentation.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package datadog.trace.instrumentation.java.concurrent;\n+\n+import static datadog.trace.agent.tooling.bytebuddy.matcher.NameMatchers.namedOneOf;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activeScope;\n+import static datadog.trace.bootstrap.instrumentation.java.concurrent.ExcludeFilter.ExcludeType.FORK_JOIN_TASK;\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.isMethod;\n+import static net.bytebuddy.matcher.ElementMatchers.named;\n+\n+import com.google.auto.service.AutoService;\n+import datadog.trace.agent.tooling.Instrumenter;\n+import datadog.trace.bootstrap.InstrumentationContext;\n+import datadog.trace.bootstrap.instrumentation.java.concurrent.ExcludeFilter;\n+import datadog.trace.bootstrap.instrumentation.java.concurrent.State;\n+import datadog.trace.context.TraceScope;\n+import java.util.Map;\n+import java.util.concurrent.ForkJoinTask;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+\n+@AutoService(Instrumenter.class)\n+public class JavaForkJoinPoolInstrumentation extends Instrumenter.Default {\n+\n+  public JavaForkJoinPoolInstrumentation() {\n+    super(\"java_concurrent\", \"fjp\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<? super TypeDescription> typeMatcher() {\n+    return named(\"java.util.concurrent.ForkJoinPool\");\n+  }\n+\n+  @Override\n+  public Map<String, String> contextStore() {\n+    return singletonMap(\"java.util.concurrent.ForkJoinTask\", State.class.getName());\n+  }\n+\n+  @Override\n+  public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n+    if (System.getProperty(\"java.version\").startsWith(\"1.7\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTk4MjE3", "url": "https://github.com/DataDog/dd-trace-java/pull/1961#pullrequestreview-504998217", "createdAt": "2020-10-08T17:15:51Z", "commit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MDIzMjQ4", "url": "https://github.com/DataDog/dd-trace-java/pull/1961#pullrequestreview-505023248", "createdAt": "2020-10-08T17:47:07Z", "commit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a20d1eda624b5b245354bcc71c3846f262f2b48", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3a20d1eda624b5b245354bcc71c3846f262f2b48", "committedDate": "2020-10-09T09:03:52Z", "message": "capture context and wrap runnables on entry to scala execution context in case batching is performed"}, "afterCommit": {"oid": "116d68bcb8c2550c83bf2de87bd0e11bcf0434b2", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/116d68bcb8c2550c83bf2de87bd0e11bcf0434b2", "committedDate": "2020-10-09T10:34:38Z", "message": "capture context and wrap runnables on entry to scala execution context in case batching is performed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "116d68bcb8c2550c83bf2de87bd0e11bcf0434b2", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/116d68bcb8c2550c83bf2de87bd0e11bcf0434b2", "committedDate": "2020-10-09T10:34:38Z", "message": "capture context and wrap runnables on entry to scala execution context in case batching is performed"}, "afterCommit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15", "committedDate": "2020-10-08T17:12:37Z", "message": "check java.version when specifying ForkJoinPool entry points"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e9bceeacf87d3d9cb9ed3549ce94bd75e6198c15", "committedDate": "2020-10-08T17:12:37Z", "message": "check java.version when specifying ForkJoinPool entry points"}, "afterCommit": {"oid": "6936fa3f9b5fb77248d4eb7e19c97976e40477df", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6936fa3f9b5fb77248d4eb7e19c97976e40477df", "committedDate": "2020-10-09T15:18:07Z", "message": "make scala-concurrent latestDepTest depend on promise instrumentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "595dd830bfde7d1da695f7ee5356c316180f5b83", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/595dd830bfde7d1da695f7ee5356c316180f5b83", "committedDate": "2020-10-09T16:58:52Z", "message": "specialised Java FJT/FJP instrumentation and context propagation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bec7f90198a4ba16b83883d6c4da579cb5dbe71e", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bec7f90198a4ba16b83883d6c4da579cb5dbe71e", "committedDate": "2020-10-09T16:58:52Z", "message": "check java.version when specifying ForkJoinPool entry points"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b34e0ed0f049576905d65cd44e7340f6ccca1ab", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9b34e0ed0f049576905d65cd44e7340f6ccca1ab", "committedDate": "2020-10-09T16:58:52Z", "message": "make scala-concurrent latestDepTest depend on promise instrumentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6936fa3f9b5fb77248d4eb7e19c97976e40477df", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6936fa3f9b5fb77248d4eb7e19c97976e40477df", "committedDate": "2020-10-09T15:18:07Z", "message": "make scala-concurrent latestDepTest depend on promise instrumentation"}, "afterCommit": {"oid": "9b34e0ed0f049576905d65cd44e7340f6ccca1ab", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9b34e0ed0f049576905d65cd44e7340f6ccca1ab", "committedDate": "2020-10-09T16:58:52Z", "message": "make scala-concurrent latestDepTest depend on promise instrumentation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2942, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}