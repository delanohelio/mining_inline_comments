{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MDQ3Njg0", "number": 1444, "title": "prevent DDSpan.this escaping before constructor complete", "bodyText": "", "createdAt": "2020-05-11T11:35:30Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1444", "merged": true, "mergeCommit": {"oid": "8b52988a683672e3f3c16431c524c5775f207888"}, "closed": true, "closedAt": "2020-05-11T13:53:02Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgOdxfgH2gAyNDE2MDQ3Njg0OmUzN2RiOGUxYjhjMjlhNWMwNzE5YWFlMDg2OThiNDQ3ZDY2YWI1Y2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgP3BaAFqTQwOTE4MTQ5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e37db8e1b8c29a5c0719aae08698b447d66ab5cf", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e37db8e1b8c29a5c0719aae08698b447d66ab5cf", "committedDate": "2020-05-11T12:02:51Z", "message": "prevent DDSpan.this escaping before constructor complete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f3170ab8ac1364b1843c5171954ab7fb4acdf6b", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4f3170ab8ac1364b1843c5171954ab7fb4acdf6b", "committedDate": "2020-05-11T11:34:23Z", "message": "prevent DDSpan.this escaping before constructor complete"}, "afterCommit": {"oid": "e37db8e1b8c29a5c0719aae08698b447d66ab5cf", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e37db8e1b8c29a5c0719aae08698b447d66ab5cf", "committedDate": "2020-05-11T12:02:51Z", "message": "prevent DDSpan.this escaping before constructor complete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTE2NDQx", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#pullrequestreview-409116441", "createdAt": "2020-05-11T12:16:28Z", "commit": {"oid": "e37db8e1b8c29a5c0719aae08698b447d66ab5cf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjoxNjoyOFrOGTZrwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjoxODoxMlrOGTZvVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk5NjkyOA==", "bodyText": "Nice catch!", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#discussion_r422996928", "createdAt": "2020-05-11T12:16:28Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/DDSpan.java", "diffHunk": "@@ -67,8 +73,6 @@\n       // Timestamp have come from an external clock, so use startTimeNano as a flag\n       startTimeNano = 0;\n     }\n-\n-    context.getTrace().registerSpan(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37db8e1b8c29a5c0719aae08698b447d66ab5cf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk5Nzg0Ng==", "bodyText": "Should this have package reachability like the constructor, and should the constructor become private to avoid creating without registering?", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#discussion_r422997846", "createdAt": "2020-05-11T12:18:12Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/DDSpan.java", "diffHunk": "@@ -24,6 +24,12 @@\n @Slf4j\n public class DDSpan implements MutableSpan, AgentSpan {\n \n+  public static DDSpan create(final long timestampMicro, final DDSpanContext context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37db8e1b8c29a5c0719aae08698b447d66ab5cf"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97abaf504457e6fd312c2c682ba4cbfa705422dc", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/97abaf504457e6fd312c2c682ba4cbfa705422dc", "committedDate": "2020-05-11T12:21:18Z", "message": "update visibility"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTQxMjMw", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#pullrequestreview-409141230", "createdAt": "2020-05-11T12:51:38Z", "commit": {"oid": "97abaf504457e6fd312c2c682ba4cbfa705422dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59feb49e25d1351411f6946e9cab1443b3bedfff", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/59feb49e25d1351411f6946e9cab1443b3bedfff", "committedDate": "2020-05-11T12:53:19Z", "message": "fix this leak in PendingTrace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTQ3NjIx", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#pullrequestreview-409147621", "createdAt": "2020-05-11T13:00:02Z", "commit": {"oid": "59feb49e25d1351411f6946e9cab1443b3bedfff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTU3OTg5", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#pullrequestreview-409157989", "createdAt": "2020-05-11T13:13:30Z", "commit": {"oid": "59feb49e25d1351411f6946e9cab1443b3bedfff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMzoxMzozMFrOGTbomA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMzoxMzozMFrOGTbomA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAyODg4OA==", "bodyText": "This should probably not be a static import since there are multiple $CLASS.create methods used in this class", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#discussion_r423028888", "createdAt": "2020-05-11T13:13:30Z", "author": {"login": "devinsba"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -479,7 +481,7 @@ public CoreSpanBuilder ignoreActiveSpan() {\n     }\n \n     private DDSpan buildSpan() {\n-      return new DDSpan(timestampMicro, buildSpanContext());\n+      return create(timestampMicro, buildSpanContext());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59feb49e25d1351411f6946e9cab1443b3bedfff"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "146d589a55684eae3928a38b0cfc1ef616bf2e35", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/146d589a55684eae3928a38b0cfc1ef616bf2e35", "committedDate": "2020-05-11T13:20:14Z", "message": "remove static import of DDSpan.create"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTgxNDk4", "url": "https://github.com/DataDog/dd-trace-java/pull/1444#pullrequestreview-409181498", "createdAt": "2020-05-11T13:40:20Z", "commit": {"oid": "146d589a55684eae3928a38b0cfc1ef616bf2e35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2486, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}