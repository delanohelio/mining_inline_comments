{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMTYxMjM1", "number": 2222, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxODowMDo1OVrOFOyWzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNTo0MDowNlrOFRfGTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMDQ5NDIzOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxODowMDo1OVrOITwcTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNzoxMzowNVrOIYBAYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4NzUzNA==", "bodyText": "If there is already a trace in progress when the job gets scheduled, does it get propagated? (I'm not suggesting it should behave one way or another, but rather wanting to understand the behavior.)", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557587534", "createdAt": "2021-01-14T18:00:59Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,106 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"* * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzcxNzA4OQ==", "bodyText": "I believe that the trace will be propagated when there exists a trace in progress. I will add a test to verify this behavior.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557717089", "createdAt": "2021-01-14T21:42:39Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,106 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"* * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4NzUzNA=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODUyODk1OQ==", "bodyText": "Upon further investigation, it seems that the spans actually don't get propagated when creating new jobs. I have been trying to investigate the cause of this behavior but haven't found a reason for it. When running runUnderTrace, the callable instance successfully creates an active span but there is no active span on the thread that the job is running on (with setAsyncPropogation set to true). From your experience, do you know what might have caused this?\nI have added a test to assert a new trace being created for now.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r558528959", "createdAt": "2021-01-15T19:10:44Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,106 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"* * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4NzUzNA=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjA1MzIxNw==", "bodyText": "I don't think it should get propagated.  If it does, you can end up with the job span being part of a trace that started a long time ago.  I would go so far as to say you should ignore the parent explicitly with:\nstartSpan(SCHEDULED_CALL, null)", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r562053217", "createdAt": "2021-01-21T17:13:05Z", "author": {"login": "randomanderson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,106 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    jobDetail.getJobDataMap().put(\"latch\", latch)\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"* * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4NzUzNA=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMDUwMzA2OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzSchedulingInstrumentation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxODowMzozMVrOITwh9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMTo0NDo0NVrOIT4aag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4ODk4Mw==", "bodyText": "Are there common ways to use quartz that would bypass this mechanism? (For example, is a job still created if quartz is configured via xml.)", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557588983", "createdAt": "2021-01-14T18:03:31Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzSchedulingInstrumentation.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.agent.tooling.bytebuddy.matcher.DDElementMatchers.implementsInterface;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.DECORATE;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.JOB_INSTANCE;\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.*;\n+import static net.bytebuddy.matcher.ElementMatchers.isPublic;\n+\n+import com.google.auto.service.AutoService;\n+import datadog.trace.agent.tooling.Instrumenter;\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import java.util.Map;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+import org.quartz.JobExecutionContext;\n+\n+@AutoService(Instrumenter.class)\n+public final class QuartzSchedulingInstrumentation extends Instrumenter.Tracing {\n+\n+  public QuartzSchedulingInstrumentation() {\n+    super(\"quartz\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    return implementsInterface(named(\"org.quartz.Job\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzcxODEyMg==", "bodyText": "I think the way jobs are specified is pretty consistent so it is unlikely that there is an exception. I will also add a test for this to verify it against XML configs, to be extra careful.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557718122", "createdAt": "2021-01-14T21:44:45Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzSchedulingInstrumentation.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.agent.tooling.bytebuddy.matcher.DDElementMatchers.implementsInterface;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.DECORATE;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.JOB_INSTANCE;\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.*;\n+import static net.bytebuddy.matcher.ElementMatchers.isPublic;\n+\n+import com.google.auto.service.AutoService;\n+import datadog.trace.agent.tooling.Instrumenter;\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import java.util.Map;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+import org.quartz.JobExecutionContext;\n+\n+@AutoService(Instrumenter.class)\n+public final class QuartzSchedulingInstrumentation extends Instrumenter.Tracing {\n+\n+  public QuartzSchedulingInstrumentation() {\n+    super(\"quartz\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    return implementsInterface(named(\"org.quartz.Job\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4ODk4Mw=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMDUwNzAyOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/quartz-2.gradle", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxODowNDo0MVrOITwkoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMjozODo1OVrOIT6DBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4OTY2NA==", "bodyText": "Can this instead be +?", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557589664", "createdAt": "2021-01-14T18:04:41Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/quartz-2.gradle", "diffHunk": "@@ -0,0 +1,27 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = 'org.quartz-scheduler'\n+    module = 'quartz'\n+    versions = \"[2.0.0,)\"\n+    assertInverse = true\n+  }\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+testSets {\n+  latestDepTest {\n+    dirName = 'test'\n+  }\n+}\n+\n+dependencies {\n+  compileOnly group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  testCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  latestDepTestCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.+'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzcxOTMxOQ==", "bodyText": "I think that the instrumentation only works for anything above version 2.0.0", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557719319", "createdAt": "2021-01-14T21:47:00Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/quartz-2.gradle", "diffHunk": "@@ -0,0 +1,27 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = 'org.quartz-scheduler'\n+    module = 'quartz'\n+    versions = \"[2.0.0,)\"\n+    assertInverse = true\n+  }\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+testSets {\n+  latestDepTest {\n+    dirName = 'test'\n+  }\n+}\n+\n+dependencies {\n+  compileOnly group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  testCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  latestDepTestCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.+'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4OTY2NA=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Nzc0MzAwOA==", "bodyText": "2.+ means the last version before 3.0 (but doesn't include 3.0). + means the latest release of any major version.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557743008", "createdAt": "2021-01-14T22:34:51Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/quartz-2.gradle", "diffHunk": "@@ -0,0 +1,27 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = 'org.quartz-scheduler'\n+    module = 'quartz'\n+    versions = \"[2.0.0,)\"\n+    assertInverse = true\n+  }\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+testSets {\n+  latestDepTest {\n+    dirName = 'test'\n+  }\n+}\n+\n+dependencies {\n+  compileOnly group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  testCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  latestDepTestCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.+'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4OTY2NA=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Nzc0NDkwMA==", "bodyText": "Ah got it, thanks for the clarification. Will make the change", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r557744900", "createdAt": "2021-01-14T22:38:59Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/quartz-2.gradle", "diffHunk": "@@ -0,0 +1,27 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = 'org.quartz-scheduler'\n+    module = 'quartz'\n+    versions = \"[2.0.0,)\"\n+    assertInverse = true\n+  }\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+testSets {\n+  latestDepTest {\n+    dirName = 'test'\n+  }\n+}\n+\n+dependencies {\n+  compileOnly group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  testCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.0.0'\n+  latestDepTestCompile group: 'org.quartz-scheduler', name: 'quartz', version: '2.+'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzU4OTY2NA=="}, "originalCommit": {"oid": "fe0e707bcc6ffaad697cf2179ab89d9e7c8cb587"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxNTQwNTk5OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/test/resources/testConfig.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxNToyNzozMlrOIUg3jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxNToyNzozMlrOIUg3jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM4MDk0Mw==", "bodyText": "If the test runs on a slow machine and takes longer than a few seconds to finish the test, there is risk of producing multiple traces which would cause the test to fail. If possible, configure it to run the first job immediately, but delay the subsequent jobs much longer to reduce that risk.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r558380943", "createdAt": "2021-01-15T15:27:32Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/resources/testConfig.xml", "diffHunk": "@@ -0,0 +1,25 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<job-scheduling-data\n+  xmlns=\"http://www.quartz-scheduler.org/xml/JobSchedulingData\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://www.quartz-scheduler.org/xml/JobSchedulingData\n+        http://www.quartz-scheduler.org/xml/job_scheduling_data_1_8.xsd\"\n+  version=\"1.8\">\n+  <schedule>\n+    <job>\n+      <name>job</name>\n+      <group>group</group>\n+      <job-class>QuartzTestJob</job-class>\n+    </job>\n+    <trigger>\n+      <cron>\n+        <name>trigger</name>\n+        <group>group</group>\n+        <job-name>job</job-name>\n+        <job-group>group</job-group>\n+        <!-- It will run every second -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80864f151c126c27492a7208a3cf0059934fca31"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjkyNDkzOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNToxNTowOFrOIXDTiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNToxNTowOFrOIXDTiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0MjMxMg==", "bodyText": "this can instead be basicSpan(it, \"root\")", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561042312", "createdAt": "2021-01-20T15:15:08Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -105,6 +105,38 @@ class QuartzTest extends AgentTestRunner {\n     scheduler.shutdown()\n   }\n \n+  def \"Test creating a new trace when starting a job\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    runUnderTrace(\"root\") {\n+      JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+      Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+      scheduler.scheduleJob(jobDetail, trigger)\n+      scheduler.start()\n+    }\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(2) {\n+      trace(1) {\n+        span {\n+          resourceName \"root\"\n+          operationName \"root\"\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjkzMjA5OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/test/resources/testConfig.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNToxNjoxNlrOIXDX2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNTo0OTozOVrOIXFCmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0MzQxOA==", "bodyText": "What does this new schedule mean? please update the comments (here and elsewhere with the new meaning).", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561043418", "createdAt": "2021-01-20T15:16:16Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/resources/testConfig.xml", "diffHunk": "@@ -18,7 +18,7 @@\n         <job-name>job</job-name>\n         <job-group>group</job-group>\n         <!-- It will run every second -->\n-        <cron-expression>* * * ? * *</cron-expression>\n+        <cron-expression>0/5 * * ? * *</cron-expression>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA3MDc0Nw==", "bodyText": "Ah sorry about the confusion, I couldn't find a way to make the job scheduler run jobs in uneven intervals. Instead, I just increased the interval between each job to every 5 secs. Let me know if that is sufficient time in between. Will change the comments to reflect that.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561070747", "createdAt": "2021-01-20T15:49:39Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/resources/testConfig.xml", "diffHunk": "@@ -18,7 +18,7 @@\n         <job-name>job</job-name>\n         <job-group>group</job-group>\n         <!-- It will run every second -->\n-        <cron-expression>* * * ? * *</cron-expression>\n+        <cron-expression>0/5 * * ? * *</cron-expression>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0MzQxOA=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjk1Nzk4OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNToyMDo1MVrOIXDnog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxODowMDo1NlrOIXK1gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0NzQ1OA==", "bodyText": "@andrewsouthard1 do you have opinions on what the operation name for this should be?  I'm thinking quartz.execute, job.execute, or scheduled.execute might be better.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561047458", "createdAt": "2021-01-20T15:20:51Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"job.instance\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTE1MjIxOA==", "bodyText": "What does spring scheduling do today or other schedulers? If we have a consistency my thought is we stick to that.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561152218", "createdAt": "2021-01-20T17:39:48Z", "author": {"login": "andrewsouthard1"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"job.instance\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0NzQ1OA=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTE2NTY5Ng==", "bodyText": "Looks like we use scheduled.call in spring scheduling, so perhaps replace with that?", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561165696", "createdAt": "2021-01-20T18:00:56Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"job.instance\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0NzQ1OA=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjk2MjY4OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNToyMTo1M1rOIXDqqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNTo0NTowMVrOIXE0eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0ODIzMw==", "bodyText": "Do we need to associate it with a method name too or will it always be just execute?", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561048233", "createdAt": "2021-01-20T15:21:53Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"job.instance\");\n+  public static final QuartzDecorator DECORATE = new QuartzDecorator();\n+\n+  private QuartzDecorator() {}\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"quartz\"};\n+  }\n+\n+  @Override\n+  protected CharSequence spanType() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected CharSequence component() {\n+    return \"quartz\";\n+  }\n+\n+  public AgentSpan onExecute(final AgentSpan span, JobExecutionContext context) {\n+    if (context != null) {\n+      span.setTag(DDTags.RESOURCE_NAME, context.getJobInstance().getClass()).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA2NzEzMA==", "bodyText": "I believe for Quartz, it will always be execute since all Job classes have to implement the function.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561067130", "createdAt": "2021-01-20T15:45:01Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"job.instance\");\n+  public static final QuartzDecorator DECORATE = new QuartzDecorator();\n+\n+  private QuartzDecorator() {}\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"quartz\"};\n+  }\n+\n+  @Override\n+  protected CharSequence spanType() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected CharSequence component() {\n+    return \"quartz\";\n+  }\n+\n+  public AgentSpan onExecute(final AgentSpan span, JobExecutionContext context) {\n+    if (context != null) {\n+      span.setTag(DDTags.RESOURCE_NAME, context.getJobInstance().getClass()).toString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA0ODIzMw=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjk3OTM2OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNToyNToxNVrOIXD1UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNzo1OTowOVrOIXKxAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA1MDk2MQ==", "bodyText": "Some of these might not be all that useful.  I would suggest pare it down to the minimum, and comment out the rest and they can be easily added back later if we wish. For example, the scheduler and the execution times are prob not super useful.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561050961", "createdAt": "2021-01-20T15:25:15Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,159 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+import static datadog.trace.agent.test.utils.TraceUtils.runUnderTrace\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"0/5 * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test XML job and trigger configuration\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory(\"testConfig.properties\").getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test creating a new trace when starting a job\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    runUnderTrace(\"root\") {\n+      JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+      Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+      scheduler.scheduleJob(jobDetail, trigger)\n+      scheduler.start()\n+    }\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(2) {\n+      trace(1) {\n+        span {\n+          resourceName \"root\"\n+          operationName \"root\"\n+        }\n+      }\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  void jobSpan(TraceAssert trace, String schedulerName) {\n+    trace.span {\n+      operationName \"job.instance\"\n+      resourceName QuartzTestJob.toString()\n+      errored false\n+\n+      tags {\n+        \"$Tags.COMPONENT\" \"quartz\"\n+        \"$QUARTZ_SCHEDULER\" schedulerName\n+        \"$QUARTZ_TRIGGER_NAME\" TRIGGER_NAME\n+        \"$QUARTZ_TRIGGER_GROUP\" GROUP_NAME\n+        \"$QUARTZ_JOB_NAME\" JOB_NAME\n+        \"$QUARTZ_JOB_GROUP\" GROUP_NAME\n+        \"$QUARTZ_SCHEDULER_FIRED_TIME\" String\n+        \"$QUARTZ_SCHEDULER_ACTUAL_TIME\" String", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA2NTk2Nw==", "bodyText": "Understood, will comment out the ones you highlighted", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561065967", "createdAt": "2021-01-20T15:43:32Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,159 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+import static datadog.trace.agent.test.utils.TraceUtils.runUnderTrace\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"0/5 * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test XML job and trigger configuration\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory(\"testConfig.properties\").getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test creating a new trace when starting a job\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    runUnderTrace(\"root\") {\n+      JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+      Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+      scheduler.scheduleJob(jobDetail, trigger)\n+      scheduler.start()\n+    }\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(2) {\n+      trace(1) {\n+        span {\n+          resourceName \"root\"\n+          operationName \"root\"\n+        }\n+      }\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  void jobSpan(TraceAssert trace, String schedulerName) {\n+    trace.span {\n+      operationName \"job.instance\"\n+      resourceName QuartzTestJob.toString()\n+      errored false\n+\n+      tags {\n+        \"$Tags.COMPONENT\" \"quartz\"\n+        \"$QUARTZ_SCHEDULER\" schedulerName\n+        \"$QUARTZ_TRIGGER_NAME\" TRIGGER_NAME\n+        \"$QUARTZ_TRIGGER_GROUP\" GROUP_NAME\n+        \"$QUARTZ_JOB_NAME\" JOB_NAME\n+        \"$QUARTZ_JOB_GROUP\" GROUP_NAME\n+        \"$QUARTZ_SCHEDULER_FIRED_TIME\" String\n+        \"$QUARTZ_SCHEDULER_ACTUAL_TIME\" String", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA1MDk2MQ=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA3ODE2Nw==", "bodyText": "I wonder if any of the job|trigger group|name elements would make more sense as a resource name than the class name...", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561078167", "createdAt": "2021-01-20T15:58:57Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,159 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+import static datadog.trace.agent.test.utils.TraceUtils.runUnderTrace\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"0/5 * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test XML job and trigger configuration\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory(\"testConfig.properties\").getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test creating a new trace when starting a job\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    runUnderTrace(\"root\") {\n+      JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+      Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+      scheduler.scheduleJob(jobDetail, trigger)\n+      scheduler.start()\n+    }\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(2) {\n+      trace(1) {\n+        span {\n+          resourceName \"root\"\n+          operationName \"root\"\n+        }\n+      }\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  void jobSpan(TraceAssert trace, String schedulerName) {\n+    trace.span {\n+      operationName \"job.instance\"\n+      resourceName QuartzTestJob.toString()\n+      errored false\n+\n+      tags {\n+        \"$Tags.COMPONENT\" \"quartz\"\n+        \"$QUARTZ_SCHEDULER\" schedulerName\n+        \"$QUARTZ_TRIGGER_NAME\" TRIGGER_NAME\n+        \"$QUARTZ_TRIGGER_GROUP\" GROUP_NAME\n+        \"$QUARTZ_JOB_NAME\" JOB_NAME\n+        \"$QUARTZ_JOB_GROUP\" GROUP_NAME\n+        \"$QUARTZ_SCHEDULER_FIRED_TIME\" String\n+        \"$QUARTZ_SCHEDULER_ACTUAL_TIME\" String", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA1MDk2MQ=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTExOTkwOQ==", "bodyText": "Hmm, I was thinking that job name would work as well, but I also thought that leaving it as a class name might give the user more insight into what got called in execute.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561119909", "createdAt": "2021-01-20T16:50:46Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,159 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+import static datadog.trace.agent.test.utils.TraceUtils.runUnderTrace\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"0/5 * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test XML job and trigger configuration\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory(\"testConfig.properties\").getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test creating a new trace when starting a job\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    runUnderTrace(\"root\") {\n+      JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+      Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+      scheduler.scheduleJob(jobDetail, trigger)\n+      scheduler.start()\n+    }\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(2) {\n+      trace(1) {\n+        span {\n+          resourceName \"root\"\n+          operationName \"root\"\n+        }\n+      }\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  void jobSpan(TraceAssert trace, String schedulerName) {\n+    trace.span {\n+      operationName \"job.instance\"\n+      resourceName QuartzTestJob.toString()\n+      errored false\n+\n+      tags {\n+        \"$Tags.COMPONENT\" \"quartz\"\n+        \"$QUARTZ_SCHEDULER\" schedulerName\n+        \"$QUARTZ_TRIGGER_NAME\" TRIGGER_NAME\n+        \"$QUARTZ_TRIGGER_GROUP\" GROUP_NAME\n+        \"$QUARTZ_JOB_NAME\" JOB_NAME\n+        \"$QUARTZ_JOB_GROUP\" GROUP_NAME\n+        \"$QUARTZ_SCHEDULER_FIRED_TIME\" String\n+        \"$QUARTZ_SCHEDULER_ACTUAL_TIME\" String", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA1MDk2MQ=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTE2NDU0NA==", "bodyText": "That's a reasonable conclusion.  \ud83d\udc4d", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561164544", "createdAt": "2021-01-20T17:59:09Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/test/groovy/QuartzTest.groovy", "diffHunk": "@@ -0,0 +1,159 @@\n+import datadog.trace.agent.test.AgentTestRunner\n+import datadog.trace.agent.test.asserts.TraceAssert\n+import datadog.trace.bootstrap.instrumentation.api.Tags\n+import org.quartz.CronScheduleBuilder\n+import org.quartz.JobBuilder\n+import org.quartz.JobDetail\n+import org.quartz.Scheduler\n+import org.quartz.Trigger\n+import org.quartz.TriggerBuilder\n+import org.quartz.impl.StdSchedulerFactory\n+import spock.lang.Shared\n+import java.util.concurrent.CountDownLatch\n+import java.util.concurrent.TimeUnit\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME\n+import static datadog.trace.agent.test.utils.TraceUtils.runUnderTrace\n+\n+class QuartzTest extends AgentTestRunner {\n+  public static final String JOB_NAME = \"job\"\n+  public static final String GROUP_NAME = \"group\"\n+  public static final String TRIGGER_NAME = \"trigger\"\n+\n+  @Shared\n+  Scheduler scheduler\n+\n+  def \"Test simple trigger scheduling\" () {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+    Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+    scheduler.scheduleJob(jobDetail, trigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+          jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test cron trigger scheduling\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+\n+    Trigger cronTrigger = TriggerBuilder.newTrigger()\n+      .withIdentity(TRIGGER_NAME, GROUP_NAME)\n+      .forJob(jobDetail)\n+      .withSchedule(CronScheduleBuilder.cronSchedule(\"0/5 * * ? * *\")).build() // run every second\n+    scheduler.scheduleJob(jobDetail, cronTrigger)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test XML job and trigger configuration\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory(\"testConfig.properties\").getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    scheduler.start()\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+\n+    assertTraces(1) {\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  def \"Test creating a new trace when starting a job\"() {\n+    setup:\n+    scheduler = new StdSchedulerFactory().getScheduler()\n+    def latch = new CountDownLatch(1)\n+    scheduler.getContext().put(\"latch\", latch)\n+\n+    when:\n+    runUnderTrace(\"root\") {\n+      JobDetail jobDetail = JobBuilder.newJob(QuartzTestJob).withIdentity(JOB_NAME, GROUP_NAME).build()\n+      Trigger trigger = TriggerBuilder.newTrigger().withIdentity(TRIGGER_NAME, GROUP_NAME).startNow().build()\n+      scheduler.scheduleJob(jobDetail, trigger)\n+      scheduler.start()\n+    }\n+\n+    then:\n+    latch.await(10L, TimeUnit.SECONDS)\n+    assertTraces(2) {\n+      trace(1) {\n+        span {\n+          resourceName \"root\"\n+          operationName \"root\"\n+        }\n+      }\n+      trace(1) {\n+        jobSpan(it, scheduler.getSchedulerName())\n+      }\n+    }\n+\n+    cleanup:\n+    scheduler.shutdown()\n+  }\n+\n+  void jobSpan(TraceAssert trace, String schedulerName) {\n+    trace.span {\n+      operationName \"job.instance\"\n+      resourceName QuartzTestJob.toString()\n+      errored false\n+\n+      tags {\n+        \"$Tags.COMPONENT\" \"quartz\"\n+        \"$QUARTZ_SCHEDULER\" schedulerName\n+        \"$QUARTZ_TRIGGER_NAME\" TRIGGER_NAME\n+        \"$QUARTZ_TRIGGER_GROUP\" GROUP_NAME\n+        \"$QUARTZ_JOB_NAME\" JOB_NAME\n+        \"$QUARTZ_JOB_GROUP\" GROUP_NAME\n+        \"$QUARTZ_SCHEDULER_FIRED_TIME\" String\n+        \"$QUARTZ_SCHEDULER_ACTUAL_TIME\" String", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA1MDk2MQ=="}, "originalCommit": {"oid": "ba9b493b3942f649c361d7c0487abe79252dd84b"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMzk3MDU3OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxOToxMjoyNVrOIXNhIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxOToxMjoyNVrOIXNhIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIwOTYzNQ==", "bodyText": "Update the field name too please...", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561209635", "createdAt": "2021-01-20T19:12:25Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n @Slf4j\n public class QuartzDecorator extends BaseDecorator {\n-  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"job.instance\");\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"scheduled.call\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73e07f603a8e3e88c2debf39e366d3e9ae0d5d84"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMzk3NDQxOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxOToxMzozN1rOIXNjjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxOToyNjowM1rOIXOJ2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIxMDI1NQ==", "bodyText": "Do you think this will be useful to users?", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561210255", "createdAt": "2021-01-20T19:13:37Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"scheduled.call\");\n+  public static final QuartzDecorator DECORATE = new QuartzDecorator();\n+\n+  private QuartzDecorator() {}\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"quartz\"};\n+  }\n+\n+  @Override\n+  protected CharSequence spanType() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected CharSequence component() {\n+    return \"quartz\";\n+  }\n+\n+  public AgentSpan onExecute(final AgentSpan span, JobExecutionContext context) {\n+    if (context != null) {\n+      span.setTag(DDTags.RESOURCE_NAME, context.getJobInstance().getClass()).toString();\n+      try {\n+        span.setTag(QUARTZ_SCHEDULER, context.getScheduler().getSchedulerName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73e07f603a8e3e88c2debf39e366d3e9ae0d5d84"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIyMDA1Ng==", "bodyText": "I was thinking it might help uniquely identify a scheduler if multiple scheduler instances are running. On second thought, it shouldn't be too important.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561220056", "createdAt": "2021-01-20T19:26:03Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzDecorator.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_JOB_NAME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_ACTUAL_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_SCHEDULER_FIRED_TIME;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_GROUP;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.QUARTZ_TRIGGER_NAME;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.SchedulerException;\n+\n+@Slf4j\n+public class QuartzDecorator extends BaseDecorator {\n+  public static final CharSequence JOB_INSTANCE = UTF8BytesString.createConstant(\"scheduled.call\");\n+  public static final QuartzDecorator DECORATE = new QuartzDecorator();\n+\n+  private QuartzDecorator() {}\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"quartz\"};\n+  }\n+\n+  @Override\n+  protected CharSequence spanType() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected CharSequence component() {\n+    return \"quartz\";\n+  }\n+\n+  public AgentSpan onExecute(final AgentSpan span, JobExecutionContext context) {\n+    if (context != null) {\n+      span.setTag(DDTags.RESOURCE_NAME, context.getJobInstance().getClass()).toString();\n+      try {\n+        span.setTag(QUARTZ_SCHEDULER, context.getScheduler().getSchedulerName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTIxMDI1NQ=="}, "originalCommit": {"oid": "73e07f603a8e3e88c2debf39e366d3e9ae0d5d84"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzODc4OTcwOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzSchedulingInstrumentation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNTozODo1MVrOIX8hiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNTo0NjowM1rOIX84XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk3OTc4Nw==", "bodyText": "I'm not sure this comment is accurate.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561979787", "createdAt": "2021-01-21T15:38:51Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzSchedulingInstrumentation.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.agent.tooling.bytebuddy.matcher.DDElementMatchers.implementsInterface;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.DECORATE;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.SCHEDULED_CALL;\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.*;\n+import static net.bytebuddy.matcher.ElementMatchers.isPublic;\n+\n+import com.google.auto.service.AutoService;\n+import datadog.trace.agent.tooling.Instrumenter;\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import java.util.Map;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+import org.quartz.JobExecutionContext;\n+\n+@AutoService(Instrumenter.class)\n+public final class QuartzSchedulingInstrumentation extends Instrumenter.Tracing {\n+\n+  public QuartzSchedulingInstrumentation() {\n+    super(\"quartz\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    return implementsInterface(named(\"org.quartz.Job\"));\n+  }\n+\n+  @Override\n+  public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n+    return singletonMap(\n+        isMethod()\n+            .and(isPublic())\n+            .and(named(\"execute\"))\n+            .and(takesArgument(0, named(\"org.quartz.JobExecutionContext\"))),\n+        QuartzSchedulingInstrumentation.class.getName() + \"$QuartzSchedulingAdvice\");\n+  }\n+\n+  @Override\n+  public String[] helperClassNames() {\n+    return new String[] {packageName + \".QuartzDecorator\"};\n+  }\n+\n+  public static class QuartzSchedulingAdvice {\n+    @Advice.OnMethodEnter(suppress = Throwable.class)\n+    public static AgentScope enter(@Advice.Argument(0) JobExecutionContext context) {\n+      //      ignore active span", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc41aef62c99f47ce201aeb71bf101ded974bd50"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk4NTYyOQ==", "bodyText": "Will remove the comment", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561985629", "createdAt": "2021-01-21T15:46:03Z", "author": {"login": "kevinfwl"}, "path": "dd-java-agent/instrumentation/quartz-2/src/main/java/datadog/trace/instrumentation/quartz/QuartzSchedulingInstrumentation.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package datadog.trace.instrumentation.quartz;\n+\n+import static datadog.trace.agent.tooling.bytebuddy.matcher.DDElementMatchers.implementsInterface;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.DECORATE;\n+import static datadog.trace.instrumentation.quartz.QuartzDecorator.SCHEDULED_CALL;\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.*;\n+import static net.bytebuddy.matcher.ElementMatchers.isPublic;\n+\n+import com.google.auto.service.AutoService;\n+import datadog.trace.agent.tooling.Instrumenter;\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import java.util.Map;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+import org.quartz.JobExecutionContext;\n+\n+@AutoService(Instrumenter.class)\n+public final class QuartzSchedulingInstrumentation extends Instrumenter.Tracing {\n+\n+  public QuartzSchedulingInstrumentation() {\n+    super(\"quartz\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    return implementsInterface(named(\"org.quartz.Job\"));\n+  }\n+\n+  @Override\n+  public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n+    return singletonMap(\n+        isMethod()\n+            .and(isPublic())\n+            .and(named(\"execute\"))\n+            .and(takesArgument(0, named(\"org.quartz.JobExecutionContext\"))),\n+        QuartzSchedulingInstrumentation.class.getName() + \"$QuartzSchedulingAdvice\");\n+  }\n+\n+  @Override\n+  public String[] helperClassNames() {\n+    return new String[] {packageName + \".QuartzDecorator\"};\n+  }\n+\n+  public static class QuartzSchedulingAdvice {\n+    @Advice.OnMethodEnter(suppress = Throwable.class)\n+    public static AgentScope enter(@Advice.Argument(0) JobExecutionContext context) {\n+      //      ignore active span", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk3OTc4Nw=="}, "originalCommit": {"oid": "dc41aef62c99f47ce201aeb71bf101ded974bd50"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzODc5NjI5OnYy", "diffSide": "RIGHT", "path": "internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/InstrumentationTags.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNTo0MDowNlrOIX8loA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNTo0MDowNlrOIX8loA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk4MDgzMg==", "bodyText": "I think these should be removed.", "url": "https://github.com/DataDog/dd-trace-java/pull/2222#discussion_r561980832", "createdAt": "2021-01-21T15:40:06Z", "author": {"login": "tylerbenson"}, "path": "internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/InstrumentationTags.java", "diffHunk": "@@ -69,6 +69,14 @@\n   public static final String EVENT = \"event\";\n   public static final String MESSAGE = \"message\";\n   public static final String HANDLER_TYPE = \"handler.type\";\n+  public static final String QUARTZ_JOB_DETAIL = \"quartz.job.detail\";\n+  public static final String QUARTZ_JOB_NAME = \"quartz.job.name\";\n+  public static final String QUARTZ_JOB_GROUP = \"quartz.job.group\";\n+  public static final String QUARTZ_SCHEDULER_ACTUAL_TIME = \"quartz.time.actualFireTime\";\n+  public static final String QUARTZ_SCHEDULER_FIRED_TIME = \"quartz.time.scheduledFireTime\";\n+  public static final String QUARTZ_SCHEDULER = \"quartz.scheduler\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc41aef62c99f47ce201aeb71bf101ded974bd50"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4564, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}