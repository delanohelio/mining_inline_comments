{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNjE5NDEx", "number": 1562, "title": "Cache span names derived from class and method names", "bodyText": "", "createdAt": "2020-06-09T08:23:37Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1562", "merged": true, "mergeCommit": {"oid": "dc8e19b5a80d17d5eb08260c1e5c9990da60b98e"}, "closed": true, "closedAt": "2020-06-09T15:53:00Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpgvTAABqjM0MjM2NjIyNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpnHn0AFqTQyNzMwMjMwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c38779d4ddcc36666e4a92241b172bec1ac13f1a", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c38779d4ddcc36666e4a92241b172bec1ac13f1a", "committedDate": "2020-06-09T08:22:50Z", "message": "cache class and method based span names"}, "afterCommit": {"oid": "f1ce920ee60901b202b01573c32caecedf9f5761", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f1ce920ee60901b202b01573c32caecedf9f5761", "committedDate": "2020-06-09T08:25:23Z", "message": "cache class and method based span names"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1ce920ee60901b202b01573c32caecedf9f5761", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f1ce920ee60901b202b01573c32caecedf9f5761", "committedDate": "2020-06-09T08:25:23Z", "message": "cache class and method based span names"}, "afterCommit": {"oid": "fade6ad9365b8422b9398411bbe2a03f044e4d69", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fade6ad9365b8422b9398411bbe2a03f044e4d69", "committedDate": "2020-06-09T08:28:58Z", "message": "cache class and method based span names"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fade6ad9365b8422b9398411bbe2a03f044e4d69", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fade6ad9365b8422b9398411bbe2a03f044e4d69", "committedDate": "2020-06-09T08:28:58Z", "message": "cache class and method based span names"}, "afterCommit": {"oid": "18ea28fb7f7c36749986e869af91fd2de7cc5f11", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/18ea28fb7f7c36749986e869af91fd2de7cc5f11", "committedDate": "2020-06-09T08:42:05Z", "message": "cache class and method based span names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTE3Mjkx", "url": "https://github.com/DataDog/dd-trace-java/pull/1562#pullrequestreview-426917291", "createdAt": "2020-06-09T08:44:29Z", "commit": {"oid": "18ea28fb7f7c36749986e869af91fd2de7cc5f11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "accaffc497baa73615d1ad732735eac48e54eb87", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/accaffc497baa73615d1ad732735eac48e54eb87", "committedDate": "2020-06-09T09:25:47Z", "message": "use enclosing class name for anonymous classes"}, "afterCommit": {"oid": "d4dffc4f1bd29fc7c1775473142405b0ef1790e4", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d4dffc4f1bd29fc7c1775473142405b0ef1790e4", "committedDate": "2020-06-09T09:30:35Z", "message": "use enclosing class name for anonymous classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4dffc4f1bd29fc7c1775473142405b0ef1790e4", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d4dffc4f1bd29fc7c1775473142405b0ef1790e4", "committedDate": "2020-06-09T09:30:35Z", "message": "use enclosing class name for anonymous classes"}, "afterCommit": {"oid": "bb2f6366042c92c4180c92a280c5b33f931b048e", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bb2f6366042c92c4180c92a280c5b33f931b048e", "committedDate": "2020-06-09T09:49:36Z", "message": "use enclosing class name for anonymous classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTgyMTkw", "url": "https://github.com/DataDog/dd-trace-java/pull/1562#pullrequestreview-426982190", "createdAt": "2020-06-09T09:57:37Z", "commit": {"oid": "bb2f6366042c92c4180c92a280c5b33f931b048e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwOTo1NzozOFrOGhCBgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwOTo1NzozOFrOGhCBgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4OTM0Ng==", "bodyText": "I'm wondering if this really is desirable, since the method names will be attributed to the enclosing class instead of where they are actually defined, which could lead to confusion.", "url": "https://github.com/DataDog/dd-trace-java/pull/1562#discussion_r437289346", "createdAt": "2020-06-09T09:57:38Z", "author": {"login": "bantonsson"}, "path": "dd-java-agent/agent-bootstrap/src/test/groovy/datadog/trace/bootstrap/instrumentation/decorator/BaseDecoratorTest.groovy", "diffHunk": "@@ -198,7 +198,8 @@ class BaseDecoratorTest extends DDSpecification {\n     target                         | name\n     SomeInnerClass                 | \"SomeInnerClass\"\n     SomeNestedClass                | \"SomeNestedClass\"\n-    SampleJavaClass.anonymousClass | \"SampleJavaClass\\$1\"\n+    SampleJavaClass                | \"SampleJavaClass\"\n+    SampleJavaClass.anonymousClass | \"SampleJavaClass\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb2f6366042c92c4180c92a280c5b33f931b048e"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb2f6366042c92c4180c92a280c5b33f931b048e", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bb2f6366042c92c4180c92a280c5b33f931b048e", "committedDate": "2020-06-09T09:49:36Z", "message": "use enclosing class name for anonymous classes"}, "afterCommit": {"oid": "0a250680aa171aeea89a62dc527c3464d51b6311", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0a250680aa171aeea89a62dc527c3464d51b6311", "committedDate": "2020-06-09T10:04:45Z", "message": "use enclosing class name for anonymous classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a250680aa171aeea89a62dc527c3464d51b6311", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0a250680aa171aeea89a62dc527c3464d51b6311", "committedDate": "2020-06-09T10:04:45Z", "message": "use enclosing class name for anonymous classes"}, "afterCommit": {"oid": "bce3221e542ea4d542897991a86a157f01cabf5f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bce3221e542ea4d542897991a86a157f01cabf5f", "committedDate": "2020-06-09T10:35:31Z", "message": "use enclosing class name for anonymous classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bce3221e542ea4d542897991a86a157f01cabf5f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bce3221e542ea4d542897991a86a157f01cabf5f", "committedDate": "2020-06-09T10:35:31Z", "message": "use enclosing class name for anonymous classes"}, "afterCommit": {"oid": "1e862589f84b51a59871bb027a17bb31169db39e", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1e862589f84b51a59871bb027a17bb31169db39e", "committedDate": "2020-06-09T10:42:15Z", "message": "use enclosing class name for anonymous classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MDE0Mzk0", "url": "https://github.com/DataDog/dd-trace-java/pull/1562#pullrequestreview-427014394", "createdAt": "2020-06-09T10:42:24Z", "commit": {"oid": "bce3221e542ea4d542897991a86a157f01cabf5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81b77e14be9af0d8785a27e87f46f60c488b0721", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/81b77e14be9af0d8785a27e87f46f60c488b0721", "committedDate": "2020-06-09T11:14:19Z", "message": "make Rediscala instrumentation resource name consistent with other instrumentations"}, "afterCommit": {"oid": "0c8ed9c6a9f478aa504e5113a91cfe514432a1a0", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0c8ed9c6a9f478aa504e5113a91cfe514432a1a0", "committedDate": "2020-06-09T11:41:00Z", "message": "make Rediscala instrumentation resource name consistent with other instrumentations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a5e1a42349ae251de0a28fa233e366da7bc0fad", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0a5e1a42349ae251de0a28fa233e366da7bc0fad", "committedDate": "2020-06-09T11:48:32Z", "message": "cache class and method based span names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d098ae3704d2d8bb89952a715e7f2d2a3acf2c6d", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d098ae3704d2d8bb89952a715e7f2d2a3acf2c6d", "committedDate": "2020-06-09T11:48:32Z", "message": "make Rediscala instrumentation resource name consistent with other instrumentations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c8ed9c6a9f478aa504e5113a91cfe514432a1a0", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0c8ed9c6a9f478aa504e5113a91cfe514432a1a0", "committedDate": "2020-06-09T11:41:00Z", "message": "make Rediscala instrumentation resource name consistent with other instrumentations"}, "afterCommit": {"oid": "d098ae3704d2d8bb89952a715e7f2d2a3acf2c6d", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d098ae3704d2d8bb89952a715e7f2d2a3acf2c6d", "committedDate": "2020-06-09T11:48:32Z", "message": "make Rediscala instrumentation resource name consistent with other instrumentations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzAyMzA4", "url": "https://github.com/DataDog/dd-trace-java/pull/1562#pullrequestreview-427302308", "createdAt": "2020-06-09T15:48:52Z", "commit": {"oid": "d098ae3704d2d8bb89952a715e7f2d2a3acf2c6d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0ODo1MlrOGhRFvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0ODo1MlrOGhRFvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNjE5MA==", "bodyText": "Nice use of ClassValue again.", "url": "https://github.com/DataDog/dd-trace-java/pull/1562#discussion_r437536190", "createdAt": "2020-06-09T15:48:52Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/BaseDecorator.java", "diffHunk": "@@ -12,10 +12,19 @@\n import java.net.InetSocketAddress;\n import java.util.Arrays;\n import java.util.TreeSet;\n+import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ExecutionException;\n \n public abstract class BaseDecorator {\n \n+  private static final ClassValue<ClassName> CLASS_NAMES =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d098ae3704d2d8bb89952a715e7f2d2a3acf2c6d"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2391, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}