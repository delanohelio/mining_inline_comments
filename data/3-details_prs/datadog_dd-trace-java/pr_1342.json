{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MDY3NzE0", "number": 1342, "title": "Add copy_artifact script", "bodyText": "", "createdAt": "2020-03-26T09:59:46Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1342", "merged": true, "mergeCommit": {"oid": "c6485099b1cef3117903c8ae7774b2b560a6685e"}, "closed": true, "closedAt": "2020-03-26T16:28:02Z", "author": {"login": "3as-DD"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRZHq8AH2gAyMzk0MDY3NzE0OmI2M2QwYzY4MjYxZTIzNjEwMjc1MDQxYjU4YWJhMjJlMDNiMDQwMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRdfNkAFqTM4MjEwMDE5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b63d0c68261e23610275041b58aba22e03b0401e", "author": {"user": {"login": "3as-DD", "name": "Amine Mesbahi"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b63d0c68261e23610275041b58aba22e03b0401e", "committedDate": "2020-03-26T09:58:48Z", "message": "Add copy_artifact script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a30faa8ffbacc916d2909af7c8b53ae5c25f32d", "author": {"user": {"login": "3as-DD", "name": "Amine Mesbahi"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4a30faa8ffbacc916d2909af7c8b53ae5c25f32d", "committedDate": "2020-03-26T10:18:30Z", "message": "Add copy_artifact script to config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxODg5MTQ5", "url": "https://github.com/DataDog/dd-trace-java/pull/1342#pullrequestreview-381889149", "createdAt": "2020-03-26T10:45:53Z", "commit": {"oid": "4a30faa8ffbacc916d2909af7c8b53ae5c25f32d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4083212814b3bf2b85aeeae6dbb821fc5f39c643", "author": {"user": {"login": "3as-DD", "name": "Amine Mesbahi"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4083212814b3bf2b85aeeae6dbb821fc5f39c643", "committedDate": "2020-03-26T12:44:57Z", "message": "Apply copy artifact to only master and *-reliability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTAwMTk5", "url": "https://github.com/DataDog/dd-trace-java/pull/1342#pullrequestreview-382100199", "createdAt": "2020-03-26T15:03:57Z", "commit": {"oid": "4083212814b3bf2b85aeeae6dbb821fc5f39c643"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTowMzo1N1rOF8LTYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTowMzo1N1rOF8LTYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY0NDA2NQ==", "bodyText": "Just checking that we want to completely overwrite this file everytime", "url": "https://github.com/DataDog/dd-trace-java/pull/1342#discussion_r398644065", "createdAt": "2020-03-26T15:03:57Z", "author": {"login": "devinsba"}, "path": ".circleci/copy_artifact_s3.py", "diffHunk": "@@ -0,0 +1,23 @@\n+import boto3\n+import re\n+import os\n+import tempfile\n+\n+LIBS_PATH = './workspace/dd-java-agent/build/libs'\n+p = re.compile(r\"dd-java-agent.*jar$\")\n+\n+S3_BUCKET_NAME = 'datadog-reliability-env'\n+client = boto3.client('s3', aws_access_key_id=os.getenv('AWS_ACCESS_KEY_ID'),aws_secret_access_key=os.getenv('AWS_SECRET_ACCESS_KEY'))\n+transfer = boto3.s3.transfer.S3Transfer(client)\n+\n+for path, sub_dirs, files in os.walk(LIBS_PATH):\n+    for name in files:\n+      if p.match(name):\n+        # Write the artifact to S3\n+        transfer.upload_file(os.path.join(path, name), S3_BUCKET_NAME, f'java/{name}')\n+        # write additional information used by the build\n+        with tempfile.NamedTemporaryFile(mode='w') as fp:\n+          for line in [os.getenv('CIRCLE_BRANCH'), os.getenv('CIRCLE_SHA1'), name, os.getenv('CIRCLE_USERNAME')]:\n+            fp.write(f'{line}\\n')\n+          fp.seek(0)\n+          transfer.upload_file(fp.name, S3_BUCKET_NAME, 'java/index.txt')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4083212814b3bf2b85aeeae6dbb821fc5f39c643"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2611, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}