{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNjE4NzE2", "number": 1273, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1NTowOFrODkWBiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxMDozMFrODkaCjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDM2MTY4OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1NTowOFrOFwnOqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzoyNTo0MlrOFwoSNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUxODY5OQ==", "bodyText": "Please add some comments here why this is ok to initialize \"first\" then retry again later.", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386518699", "createdAt": "2020-03-02T16:55:08Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -46,6 +46,9 @@\n \n   public static void start(final Instrumentation inst, final URL bootstrapURL) {\n     createParentClassloader(bootstrapURL);\n+\n+    startProfilingAgent(bootstrapURL, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzNTk5MA==", "bodyText": "Updated", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386535990", "createdAt": "2020-03-02T17:25:42Z", "author": {"login": "mar-kolya"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -46,6 +46,9 @@\n \n   public static void start(final Instrumentation inst, final URL bootstrapURL) {\n     createParentClassloader(bootstrapURL);\n+\n+    startProfilingAgent(bootstrapURL, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUxODY5OQ=="}, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDM3MjA1OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1NzozM1rOFwnU3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1NzozM1rOFwnU3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUyMDI4NQ==", "bodyText": "early isn't very descriptive... maybe isBeforeTracing?", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386520285", "createdAt": "2020-03-02T16:57:33Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -275,29 +278,29 @@ private static synchronized void startJmxFetch(final URL bootstrapURL) {\n     }\n   }\n \n-  private static synchronized void startProfilingAgent(final URL bootstrapURL) {\n-    if (PROFILING_CLASSLOADER == null) {\n-      final ClassLoader contextLoader = Thread.currentThread().getContextClassLoader();\n-      try {\n-        final ClassLoader profilingClassLoader =\n+  private static synchronized void startProfilingAgent(\n+      final URL bootstrapURL, final boolean early) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDM3NTMxOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-profiling/profiling-controller/src/main/java/com/datadog/profiling/controller/ProfilingSystem.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1ODoxOFrOFwnWxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1ODoxOFrOFwnWxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUyMDc3NA==", "bodyText": "perhaps startProfilingBeforeTracing?", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386520774", "createdAt": "2020-03-02T16:58:18Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-profiling/profiling-controller/src/main/java/com/datadog/profiling/controller/ProfilingSystem.java", "diffHunk": "@@ -38,6 +38,7 @@\n \n   private final Duration startupDelay;\n   private final Duration uploadPeriod;\n+  private final boolean forceEarly;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTAxOTY0OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-profiling/src/main/java/com/datadog/profiling/agent/ProfilingAgent.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxMDozMFrOFwtmVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDo1MTozMFrOFwuzLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMzA2MQ==", "bodyText": "debug?", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386623061", "createdAt": "2020-03-02T20:10:30Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-profiling/src/main/java/com/datadog/profiling/agent/ProfilingAgent.java", "diffHunk": "@@ -19,13 +19,14 @@\n \n   /**\n    * Main entry point into profiling Note: this must be reentrant because we may want to start\n-   * profiling early, and then attempt to start it again at normal time\n+   * profiling before any other tool, and then attempt to start it again at normal time\n    */\n-  public static synchronized void run(final boolean early) throws IllegalArgumentException {\n+  public static synchronized void run(final boolean isStartingFirst)\n+      throws IllegalArgumentException {\n     if (PROFILER == null) {\n       final Config config = Config.get();\n-      if (early && !config.isProfilingStartForceEarly()) {\n-        log.info(\"Profiling: not starting early\");\n+      if (isStartingFirst && !config.isProfilingStartForceFirst()) {\n+        log.info(\"Profiling: not starting first\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ff723e19171ebaa7522e2d5b6aadc1b3014953a"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY0MjczMg==", "bodyText": "fixed", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386642732", "createdAt": "2020-03-02T20:51:30Z", "author": {"login": "mar-kolya"}, "path": "dd-java-agent/agent-profiling/src/main/java/com/datadog/profiling/agent/ProfilingAgent.java", "diffHunk": "@@ -19,13 +19,14 @@\n \n   /**\n    * Main entry point into profiling Note: this must be reentrant because we may want to start\n-   * profiling early, and then attempt to start it again at normal time\n+   * profiling before any other tool, and then attempt to start it again at normal time\n    */\n-  public static synchronized void run(final boolean early) throws IllegalArgumentException {\n+  public static synchronized void run(final boolean isStartingFirst)\n+      throws IllegalArgumentException {\n     if (PROFILER == null) {\n       final Config config = Config.get();\n-      if (early && !config.isProfilingStartForceEarly()) {\n-        log.info(\"Profiling: not starting early\");\n+      if (isStartingFirst && !config.isProfilingStartForceFirst()) {\n+        log.info(\"Profiling: not starting first\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMzA2MQ=="}, "originalCommit": {"oid": "6ff723e19171ebaa7522e2d5b6aadc1b3014953a"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 359, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}