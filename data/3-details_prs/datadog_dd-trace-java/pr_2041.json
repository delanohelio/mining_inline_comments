{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMjgzNDM0", "number": 2041, "title": "move TraceProcessor to CoreTracer", "bodyText": "The idea here is to create a point in CoreTracer after all interceptors and rules have run where the contents of the the traces can't change. This will allow metrics to be computed against an immutable aggregation key. This also affects sampling decisions meaning transformations are applied before sampling which may depend on span attributes", "createdAt": "2020-10-29T13:41:04Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2041", "merged": true, "mergeCommit": {"oid": "0bed4d565245009919a1bf5b8946762b7dfd54c3"}, "closed": true, "closedAt": "2020-10-30T14:13:09Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXSkmtABqjM5MzY0NjM4ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXnaSLAFqTUyMDcwNjczOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98601f16b64611502cd68dc652aa39b2b3ac2e6e", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/98601f16b64611502cd68dc652aa39b2b3ac2e6e", "committedDate": "2020-10-29T13:39:57Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}, "afterCommit": {"oid": "b97eebced6df94e9329ad869c50f46f719a4f63a", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b97eebced6df94e9329ad869c50f46f719a4f63a", "committedDate": "2020-10-29T13:55:29Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b97eebced6df94e9329ad869c50f46f719a4f63a", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b97eebced6df94e9329ad869c50f46f719a4f63a", "committedDate": "2020-10-29T13:55:29Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}, "afterCommit": {"oid": "510aca9da43a83b76b9cbd47323409704c6a65cb", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/510aca9da43a83b76b9cbd47323409704c6a65cb", "committedDate": "2020-10-29T14:00:25Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NzY0MTA2", "url": "https://github.com/DataDog/dd-trace-java/pull/2041#pullrequestreview-519764106", "createdAt": "2020-10-29T15:04:34Z", "commit": {"oid": "510aca9da43a83b76b9cbd47323409704c6a65cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTowNDozNFrOHqgRKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTowNDozNFrOHqgRKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMzMDkyMg==", "bodyText": "I forget the expected behavior here, but I think there's some interaction with the agent's obfuscation...", "url": "https://github.com/DataDog/dd-trace-java/pull/2041#discussion_r514330922", "createdAt": "2020-10-29T15:04:34Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -56,7 +56,7 @@ public AgentSpan onConnection(final AgentSpan span, final CONNECTION connection)\n \n   public AgentSpan onStatement(final AgentSpan span, final CharSequence statement) {\n     assert span != null;\n-    span.setTag(Tags.DB_STATEMENT, statement);\n+    span.setResourceName(statement);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "510aca9da43a83b76b9cbd47323409704c6a65cb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469aca4201502cf3da6092ac3bab14f70405846b", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/469aca4201502cf3da6092ac3bab14f70405846b", "committedDate": "2020-10-30T08:26:33Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "510aca9da43a83b76b9cbd47323409704c6a65cb", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/510aca9da43a83b76b9cbd47323409704c6a65cb", "committedDate": "2020-10-29T14:00:25Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}, "afterCommit": {"oid": "469aca4201502cf3da6092ac3bab14f70405846b", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/469aca4201502cf3da6092ac3bab14f70405846b", "committedDate": "2020-10-30T08:26:33Z", "message": "move trace processor into CoreTracer so that it is applied before sampling and potential metrics collection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjY4MTM0", "url": "https://github.com/DataDog/dd-trace-java/pull/2041#pullrequestreview-520668134", "createdAt": "2020-10-30T13:30:42Z", "commit": {"oid": "469aca4201502cf3da6092ac3bab14f70405846b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNzA2NzM4", "url": "https://github.com/DataDog/dd-trace-java/pull/2041#pullrequestreview-520706738", "createdAt": "2020-10-30T14:12:30Z", "commit": {"oid": "469aca4201502cf3da6092ac3bab14f70405846b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3063, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}