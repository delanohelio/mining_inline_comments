{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNTI2ODQx", "number": 1561, "title": "disable agent if we may append wrong jar to boot classpath", "bodyText": "If someone by mistake adds content of dd-java-agent.jar to application level \"uber.jar\" dd agent installer will add this \"uber.jar\" to bootstrap classpath. And if some application level classes are loaded by bootstrap classpath we see random NPEs in user code where we never expect MyAppClass.getClassLoader() returns null .", "createdAt": "2020-06-09T04:23:43Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1561", "merged": true, "mergeCommit": {"oid": "244c5e0ac8f2c8366d1b7aca6bff2c5fd8d4899c"}, "closed": true, "closedAt": "2020-06-09T16:53:35Z", "author": {"login": "lpriima"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpdTpYgBqjM0MjI5NTc5NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpnlkzgFqTQyNzMzNDk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "efcd3ee6a6d35472751dfe43926b915f18197b93", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/efcd3ee6a6d35472751dfe43926b915f18197b93", "committedDate": "2020-06-09T04:16:15Z", "message": "disable agent if we may append wrong jar to bootcp"}, "afterCommit": {"oid": "bfaef76924fd4d00a8a4d6bf3f16a91b36776354", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bfaef76924fd4d00a8a4d6bf3f16a91b36776354", "committedDate": "2020-06-09T04:25:34Z", "message": "disable agent if we may append wrong jar to bootcp"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfaef76924fd4d00a8a4d6bf3f16a91b36776354", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bfaef76924fd4d00a8a4d6bf3f16a91b36776354", "committedDate": "2020-06-09T04:25:34Z", "message": "disable agent if we may append wrong jar to bootcp"}, "afterCommit": {"oid": "e675036dc1f9f626f43bdaab5f17fee07e2e8767", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e675036dc1f9f626f43bdaab5f17fee07e2e8767", "committedDate": "2020-06-09T04:27:09Z", "message": "disable agent if we may append wrong jar to bootcp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/000f342dbd773a268f979fd1938ca1b026737f9c", "committedDate": "2020-06-09T05:33:17Z", "message": "disable agent if we may append wrong jar to bootcp"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e675036dc1f9f626f43bdaab5f17fee07e2e8767", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e675036dc1f9f626f43bdaab5f17fee07e2e8767", "committedDate": "2020-06-09T04:27:09Z", "message": "disable agent if we may append wrong jar to bootcp"}, "afterCommit": {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/000f342dbd773a268f979fd1938ca1b026737f9c", "committedDate": "2020-06-09T05:33:17Z", "message": "disable agent if we may append wrong jar to bootcp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTk3NzA0", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#pullrequestreview-427197704", "createdAt": "2020-06-09T14:16:42Z", "commit": {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDoxNjo0MlrOGhMUBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDoxNjo0MlrOGhMUBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg==", "bodyText": "Would this be different if the class was subclassed or something?  Maybe make AgentBootstrap final instead?", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437457926", "createdAt": "2020-06-09T14:16:42Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/src/main/java/datadog/trace/bootstrap/AgentBootstrap.java", "diffHunk": "@@ -40,6 +41,7 @@\n  * </ul>\n  */\n public class AgentBootstrap {\n+  private static final Class<?> thisClass = MethodHandles.lookup().lookupClass();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzM0OTcw", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#pullrequestreview-427334970", "createdAt": "2020-06-09T16:24:14Z", "commit": {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNjoyNDoxNFrOGhSjlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNjoyNDoxNFrOGhSjlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2MDIxMw==", "bodyText": "Either is fine with me.", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437560213", "createdAt": "2020-06-09T16:24:14Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/src/main/java/datadog/trace/bootstrap/AgentBootstrap.java", "diffHunk": "@@ -40,6 +41,7 @@\n  * </ul>\n  */\n public class AgentBootstrap {\n+  private static final Class<?> thisClass = MethodHandles.lookup().lookupClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg=="}, "originalCommit": {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2389, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}