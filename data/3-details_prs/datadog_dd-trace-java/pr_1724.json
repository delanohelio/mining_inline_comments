{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MTg4ODA0", "number": 1724, "title": "Axway API integration", "bodyText": "Auto instrumentation for axway api.\nIt's only tested manually:\n\nThere is no way I'm aware of, how I can extract HTTP library form apigateway to create unit test. Moreover, com.vordel.dwe.http.ServerTransaction and other parts of axway http plugin are java frontend to native closed source implementation.\nTodo:\n\nhttp status code extraction\nintegration test", "createdAt": "2020-07-29T04:41:03Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1724", "merged": true, "mergeCommit": {"oid": "4be0ec4d83e4221a421c50b4c88951a3a402905b"}, "closed": true, "closedAt": "2021-03-18T19:06:03Z", "author": {"login": "lpriima"}, "timelineItems": {"totalCount": 69, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5kI7bABqjM1OTczMjE1MTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeEZvv8AFqTYxNTY5NjM1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dc17cd87b6038fae9fae8016927bfa54eb48920", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6dc17cd87b6038fae9fae8016927bfa54eb48920", "committedDate": "2020-07-29T05:15:30Z", "message": "Update axway-api.gradle"}, "afterCommit": {"oid": "fd4b18aafab08a2f4607ba255e357cd9d6466959", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fd4b18aafab08a2f4607ba255e357cd9d6466959", "committedDate": "2020-07-29T05:25:54Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd4b18aafab08a2f4607ba255e357cd9d6466959", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fd4b18aafab08a2f4607ba255e357cd9d6466959", "committedDate": "2020-07-29T05:25:54Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "7d798c6203dc0e190dfe91abc0c9eb699ee80652", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7d798c6203dc0e190dfe91abc0c9eb699ee80652", "committedDate": "2020-08-02T20:42:25Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d798c6203dc0e190dfe91abc0c9eb699ee80652", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7d798c6203dc0e190dfe91abc0c9eb699ee80652", "committedDate": "2020-08-02T20:42:25Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "f40eca6067ab53298f8896e79a8d178f40c0365e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f40eca6067ab53298f8896e79a8d178f40c0365e", "committedDate": "2020-08-04T04:22:28Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f40eca6067ab53298f8896e79a8d178f40c0365e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f40eca6067ab53298f8896e79a8d178f40c0365e", "committedDate": "2020-08-04T04:22:28Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "0786c22eb7e366a8472638bf5bff7d17ea16d847", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0786c22eb7e366a8472638bf5bff7d17ea16d847", "committedDate": "2020-08-05T02:11:03Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0786c22eb7e366a8472638bf5bff7d17ea16d847", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0786c22eb7e366a8472638bf5bff7d17ea16d847", "committedDate": "2020-08-05T02:11:03Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "14f4c8c10909e4d32a1a588b0eceb01295c9dc92", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/14f4c8c10909e4d32a1a588b0eceb01295c9dc92", "committedDate": "2020-08-05T02:43:02Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14f4c8c10909e4d32a1a588b0eceb01295c9dc92", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/14f4c8c10909e4d32a1a588b0eceb01295c9dc92", "committedDate": "2020-08-05T02:43:02Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "f73197de0189e8fe1ccb10d9d14246fd6d28cff6", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f73197de0189e8fe1ccb10d9d14246fd6d28cff6", "committedDate": "2020-08-05T03:43:34Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f73197de0189e8fe1ccb10d9d14246fd6d28cff6", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f73197de0189e8fe1ccb10d9d14246fd6d28cff6", "committedDate": "2020-08-05T03:43:34Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "6e60182033ca94438e9e1ab98fab2036b42954b1", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6e60182033ca94438e9e1ab98fab2036b42954b1", "committedDate": "2020-11-24T05:05:08Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e60182033ca94438e9e1ab98fab2036b42954b1", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6e60182033ca94438e9e1ab98fab2036b42954b1", "committedDate": "2020-11-24T05:05:08Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "15581e9b490553a725ad27bec97f1467c7342826", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/15581e9b490553a725ad27bec97f1467c7342826", "committedDate": "2020-11-30T10:45:22Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15581e9b490553a725ad27bec97f1467c7342826", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/15581e9b490553a725ad27bec97f1467c7342826", "committedDate": "2020-11-30T10:45:22Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "cbf29823127ad776992475e149c510a29acb73e1", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cbf29823127ad776992475e149c510a29acb73e1", "committedDate": "2020-11-30T11:42:52Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cbf29823127ad776992475e149c510a29acb73e1", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cbf29823127ad776992475e149c510a29acb73e1", "committedDate": "2020-11-30T11:42:52Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "90588d798d6ae1fc7b6310ffe008916def55bb23", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/90588d798d6ae1fc7b6310ffe008916def55bb23", "committedDate": "2020-12-01T07:57:26Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90588d798d6ae1fc7b6310ffe008916def55bb23", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/90588d798d6ae1fc7b6310ffe008916def55bb23", "committedDate": "2020-12-01T07:57:26Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "997bfcdcb22ce39310bb87627bda8147122eb0cf", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/997bfcdcb22ce39310bb87627bda8147122eb0cf", "committedDate": "2020-12-01T08:26:58Z", "message": "Axway API integration draft"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "997bfcdcb22ce39310bb87627bda8147122eb0cf", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/997bfcdcb22ce39310bb87627bda8147122eb0cf", "committedDate": "2020-12-01T08:26:58Z", "message": "Axway API integration draft"}, "afterCommit": {"oid": "394775b5d58807217d69f9fe6c7fce0f25132ea5", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/394775b5d58807217d69f9fe6c7fce0f25132ea5", "committedDate": "2020-12-17T09:28:16Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "394775b5d58807217d69f9fe6c7fce0f25132ea5", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/394775b5d58807217d69f9fe6c7fce0f25132ea5", "committedDate": "2020-12-17T09:28:16Z", "message": "Axway API integration"}, "afterCommit": {"oid": "764e89e40472fd26db800ceedbdfe56d734395fe", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/764e89e40472fd26db800ceedbdfe56d734395fe", "committedDate": "2020-12-30T04:55:24Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "764e89e40472fd26db800ceedbdfe56d734395fe", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/764e89e40472fd26db800ceedbdfe56d734395fe", "committedDate": "2020-12-30T04:55:24Z", "message": "Axway API integration"}, "afterCommit": {"oid": "1e1ee1851e2b07f424e94b9e8b6a7d6569b08702", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1e1ee1851e2b07f424e94b9e8b6a7d6569b08702", "committedDate": "2021-01-08T20:30:02Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e1ee1851e2b07f424e94b9e8b6a7d6569b08702", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1e1ee1851e2b07f424e94b9e8b6a7d6569b08702", "committedDate": "2021-01-08T20:30:02Z", "message": "Axway API integration"}, "afterCommit": {"oid": "26b1ca10dfba4cf9929ff325eae8d5dad7d91cd5", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/26b1ca10dfba4cf9929ff325eae8d5dad7d91cd5", "committedDate": "2021-01-14T06:47:00Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26b1ca10dfba4cf9929ff325eae8d5dad7d91cd5", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/26b1ca10dfba4cf9929ff325eae8d5dad7d91cd5", "committedDate": "2021-01-14T06:47:00Z", "message": "Axway API integration"}, "afterCommit": {"oid": "3e8063808dc3b293622662cb4bc225a9899e7af9", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3e8063808dc3b293622662cb4bc225a9899e7af9", "committedDate": "2021-01-14T11:06:40Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e8063808dc3b293622662cb4bc225a9899e7af9", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3e8063808dc3b293622662cb4bc225a9899e7af9", "committedDate": "2021-01-14T11:06:40Z", "message": "Axway API integration"}, "afterCommit": {"oid": "7fbc23b9fe98a94f2f0e2e5ef86a1e7382c61a79", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7fbc23b9fe98a94f2f0e2e5ef86a1e7382c61a79", "committedDate": "2021-01-20T06:26:12Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fbc23b9fe98a94f2f0e2e5ef86a1e7382c61a79", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7fbc23b9fe98a94f2f0e2e5ef86a1e7382c61a79", "committedDate": "2021-01-20T06:26:12Z", "message": "Axway API integration"}, "afterCommit": {"oid": "910cf5aa3b260383bb2abdff52e0d9928b7ad46e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/910cf5aa3b260383bb2abdff52e0d9928b7ad46e", "committedDate": "2021-01-25T03:01:09Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "910cf5aa3b260383bb2abdff52e0d9928b7ad46e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/910cf5aa3b260383bb2abdff52e0d9928b7ad46e", "committedDate": "2021-01-25T03:01:09Z", "message": "Axway API integration"}, "afterCommit": {"oid": "071d54882ff587eedc5c0b62efcbda7fb0f421d8", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/071d54882ff587eedc5c0b62efcbda7fb0f421d8", "committedDate": "2021-01-27T10:20:24Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "071d54882ff587eedc5c0b62efcbda7fb0f421d8", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/071d54882ff587eedc5c0b62efcbda7fb0f421d8", "committedDate": "2021-01-27T10:20:24Z", "message": "Axway API integration"}, "afterCommit": {"oid": "1172c09061d152bbc5f3e589015a9643dcb802ce", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1172c09061d152bbc5f3e589015a9643dcb802ce", "committedDate": "2021-01-28T09:50:10Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1172c09061d152bbc5f3e589015a9643dcb802ce", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1172c09061d152bbc5f3e589015a9643dcb802ce", "committedDate": "2021-01-28T09:50:10Z", "message": "Axway API integration"}, "afterCommit": {"oid": "38e993a42dc87cc002eaaa967d90154d63d9471e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/38e993a42dc87cc002eaaa967d90154d63d9471e", "committedDate": "2021-02-02T10:48:54Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38e993a42dc87cc002eaaa967d90154d63d9471e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/38e993a42dc87cc002eaaa967d90154d63d9471e", "committedDate": "2021-02-02T10:48:54Z", "message": "Axway API integration"}, "afterCommit": {"oid": "d05f7dc68a2e6a06d9c2f9c0038b0c7d6a0aa20f", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d05f7dc68a2e6a06d9c2f9c0038b0c7d6a0aa20f", "committedDate": "2021-02-03T01:45:41Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d05f7dc68a2e6a06d9c2f9c0038b0c7d6a0aa20f", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d05f7dc68a2e6a06d9c2f9c0038b0c7d6a0aa20f", "committedDate": "2021-02-03T01:45:41Z", "message": "Axway API integration"}, "afterCommit": {"oid": "0e7787e6011ad88922678b876ff7a21447cc6588", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0e7787e6011ad88922678b876ff7a21447cc6588", "committedDate": "2021-02-03T07:43:17Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e7787e6011ad88922678b876ff7a21447cc6588", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0e7787e6011ad88922678b876ff7a21447cc6588", "committedDate": "2021-02-03T07:43:17Z", "message": "Axway API integration"}, "afterCommit": {"oid": "753c5cc2884215cc1c10ac2ae4c5ee598df50fd0", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/753c5cc2884215cc1c10ac2ae4c5ee598df50fd0", "committedDate": "2021-02-03T10:06:19Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "753c5cc2884215cc1c10ac2ae4c5ee598df50fd0", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/753c5cc2884215cc1c10ac2ae4c5ee598df50fd0", "committedDate": "2021-02-03T10:06:19Z", "message": "Axway API integration"}, "afterCommit": {"oid": "84118ae990736c2e1de1ee4789f7aea2a9b646df", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/84118ae990736c2e1de1ee4789f7aea2a9b646df", "committedDate": "2021-02-03T11:02:43Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84118ae990736c2e1de1ee4789f7aea2a9b646df", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/84118ae990736c2e1de1ee4789f7aea2a9b646df", "committedDate": "2021-02-03T11:02:43Z", "message": "Axway API integration"}, "afterCommit": {"oid": "4d17eb373275ecc3faea406770c7bfef0cdb22ab", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4d17eb373275ecc3faea406770c7bfef0cdb22ab", "committedDate": "2021-02-03T11:20:31Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d17eb373275ecc3faea406770c7bfef0cdb22ab", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4d17eb373275ecc3faea406770c7bfef0cdb22ab", "committedDate": "2021-02-03T11:20:31Z", "message": "Axway API integration"}, "afterCommit": {"oid": "fbc9f0ef8e700f9ebc0b619af362996e741c2697", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fbc9f0ef8e700f9ebc0b619af362996e741c2697", "committedDate": "2021-02-03T16:47:46Z", "message": "Axway API integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb91aa60044d9104b9aa7e00e39bf4b196258788", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/eb91aa60044d9104b9aa7e00e39bf4b196258788", "committedDate": "2021-02-03T22:20:26Z", "message": "Move reflection util methods to Decorator"}, "afterCommit": {"oid": "1bb642ca13f585f57b91c6a87b8e7d17f1f93b9c", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1bb642ca13f585f57b91c6a87b8e7d17f1f93b9c", "committedDate": "2021-02-04T00:05:55Z", "message": "Move reflection utils methods to Decorator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bb642ca13f585f57b91c6a87b8e7d17f1f93b9c", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1bb642ca13f585f57b91c6a87b8e7d17f1f93b9c", "committedDate": "2021-02-04T00:05:55Z", "message": "Move reflection utils methods to Decorator"}, "afterCommit": {"oid": "6cb3226bdc34db52c2ee20a51677c9955d23057f", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6cb3226bdc34db52c2ee20a51677c9955d23057f", "committedDate": "2021-02-04T06:55:13Z", "message": "Move reflection utils methods to Decorator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzMTk2Mjcz", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583196273", "createdAt": "2021-02-04T09:34:50Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQwOTozNDo1MFrOIfqmSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQwOTozNDo1MFrOIfqmSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDA3NDY5Ng==", "bodyText": "This doesn't look correct. Should there be an if (null != throwable) { ... } else { ... } here?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570074696", "createdAt": "2021-02-04T09:34:50Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/HTTPPluginAdvice.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.AXWAY_REQUEST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import net.bytebuddy.asm.Advice;\n+\n+public class HTTPPluginAdvice {\n+\n+  @Advice.OnMethodEnter(suppress = Throwable.class)\n+  public static AgentScope onEnter(\n+      @Advice.This final Object stateInstance,\n+      @Advice.Argument(value = 2) final Object serverTransaction) {\n+    final AgentSpan span = startSpan(AXWAY_REQUEST);\n+    final AgentScope scope = activateSpan(span);\n+    span.setMeasured(true);\n+    DECORATE.afterStart(span);\n+    DECORATE.onConnection(span, serverTransaction);\n+    DECORATE.onRequest(span, serverTransaction);\n+    return scope;\n+  }\n+\n+  @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n+  public static void onExit(\n+      @Advice.Enter final AgentScope scope,\n+      @Advice.Argument(value = 2) final Object serverTransaction,\n+      @Advice.This final Object httpPlugin,\n+      // @Advice.Local(\"responseCode\") Integer responseCode,\n+      @Advice.Thrown final Throwable throwable) {\n+    if (scope == null) {\n+      return;\n+    }\n+    final AgentSpan span = scope.span();\n+    try {\n+      // manual DECORATE.onResponse(span, serverTransaction):\n+      // span.setTag(Tags.HTTP_STATUS, responseCode); //TODO\n+      DECORATE.onError(span, throwable);\n+      DECORATE.beforeFinish(span);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzMTk2OTQy", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583196942", "createdAt": "2021-02-04T09:35:36Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQwOTozNTozN1rOIfqoSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQwOTozNTozN1rOIfqoSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDA3NTIxMQ==", "bodyText": "Is it worth doing this with method handles?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570075211", "createdAt": "2021-02-04T09:35:37Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import org.slf4j.Logger;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final String METHOD = \"method\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final Logger log =\n+      org.slf4j.LoggerFactory.getLogger(AxwayHTTPPluginDecorator.class);\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    return invokeNoArgDeclaredMethod(serverTransaction, \"getMethod\").toString();\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter((URI) invokeNoArgDeclaredMethod(serverTransaction, \"getURI\"));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return ((InetSocketAddress)\n+            invokeNoArgsSuperSuperClassMethod(serverTransaction, \"getLocalAddr\"))\n+        .getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return ((InetSocketAddress)\n+            invokeNoArgsSuperSuperClassMethod(serverTransaction, \"getLocalAddr\"))\n+        .getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // done manually\n+    return 0;\n+  }\n+\n+  public static Object invokeNoArgDeclaredMethod(Object obj, String methodName) {\n+    try {\n+      Method m = obj.getClass().getDeclaredMethod(methodName);\n+      m.setAccessible(true);\n+      Object v = m.invoke(obj);\n+      log.debug(\"{}(): {}\", methodName, v);\n+      return v;\n+    } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {\n+      log.debug(\"Can't find method '\" + methodName + \"' in object \" + obj, e);\n+    }\n+    return \"\";\n+  }\n+\n+  public static Object invokeNoArgsSuperSuperClassMethod(Object obj, String methodName) {\n+    try {\n+      Method m = obj.getClass().getSuperclass().getSuperclass().getMethod(methodName);\n+      Object v = m.invoke(obj);\n+      log.debug(\"{}(): {}\", methodName, v);\n+      return v;\n+    } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {\n+      log.debug(\"Can't find method '\" + methodName + \"' in object \" + obj, e);\n+    }\n+    return \"\";\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNTczMzc2", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583573376", "createdAt": "2021-02-04T16:22:27Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjoyMjoyOFrOIf79_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjoyMjoyOFrOIf79_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM1OTI5NQ==", "bodyText": "since this test is ignored and looks incomplete, I'd be OK with just dropping it from this initial PR", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570359295", "createdAt": "2021-02-04T16:22:28Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/test/groovy/datadog/trace/instrumentation/axway/AxwayAPITest.groovy", "diffHunk": "@@ -0,0 +1,34 @@\n+package datadog.trace.instrumentation.axway\n+\n+import datadog.trace.agent.test.base.HttpClientTest\n+import org.junit.Ignore\n+import spock.lang.Shared\n+import spock.lang.Timeout\n+\n+@Ignore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNTc4NDcw", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583578470", "createdAt": "2021-02-04T16:27:14Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjoyNzoxNFrOIf8MVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjoyNzoxNFrOIf8MVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM2Mjk2Ng==", "bodyText": "What's the reason for using the super-super-class to get the method? Is this a static or instance method?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570362966", "createdAt": "2021-02-04T16:27:14Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import org.slf4j.Logger;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final String METHOD = \"method\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final Logger log =\n+      org.slf4j.LoggerFactory.getLogger(AxwayHTTPPluginDecorator.class);\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    return invokeNoArgDeclaredMethod(serverTransaction, \"getMethod\").toString();\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter((URI) invokeNoArgDeclaredMethod(serverTransaction, \"getURI\"));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return ((InetSocketAddress)\n+            invokeNoArgsSuperSuperClassMethod(serverTransaction, \"getLocalAddr\"))\n+        .getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return ((InetSocketAddress)\n+            invokeNoArgsSuperSuperClassMethod(serverTransaction, \"getLocalAddr\"))\n+        .getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // done manually\n+    return 0;\n+  }\n+\n+  public static Object invokeNoArgDeclaredMethod(Object obj, String methodName) {\n+    try {\n+      Method m = obj.getClass().getDeclaredMethod(methodName);\n+      m.setAccessible(true);\n+      Object v = m.invoke(obj);\n+      log.debug(\"{}(): {}\", methodName, v);\n+      return v;\n+    } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {\n+      log.debug(\"Can't find method '\" + methodName + \"' in object \" + obj, e);\n+    }\n+    return \"\";\n+  }\n+\n+  public static Object invokeNoArgsSuperSuperClassMethod(Object obj, String methodName) {\n+    try {\n+      Method m = obj.getClass().getSuperclass().getSuperclass().getMethod(methodName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNTY4NjA5", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583568609", "createdAt": "2021-02-04T16:17:50Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjoxNzo1MFrOIf7wAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjozNDo0MlrOIf8ikA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM1NTcxMw==", "bodyText": "I don't think we need this since we can't actually verify the axway jars.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570355713", "createdAt": "2021-02-04T16:17:50Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/axway-api.gradle", "diffHunk": "@@ -0,0 +1,16 @@\n+muzzle {\n+  pass {\n+    coreJdk()\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM1NjkzNw==", "bodyText": "I think this warrants a bigger comment.  If we need to revisit the instrumentation, how do we go about obtaining the jars and making it so we can verify the behavior?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570356937", "createdAt": "2021-02-04T16:19:23Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/axway-api.gradle", "diffHunk": "@@ -0,0 +1,16 @@\n+muzzle {\n+  pass {\n+    coreJdk()\n+  }\n+}\n+apply from: \"$rootDir/gradle/java.gradle\"\n+\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+dependencies {\n+  //// Can't split jars from axway apigateway monolith:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM2MTY0MQ==", "bodyText": "This doesn't seem to be reading incoming headers to propagate the trace?  Is this an acceptable tradeoff?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570361641", "createdAt": "2021-02-04T16:25:33Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/HTTPPluginAdvice.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.AXWAY_REQUEST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import net.bytebuddy.asm.Advice;\n+\n+public class HTTPPluginAdvice {\n+\n+  @Advice.OnMethodEnter(suppress = Throwable.class)\n+  public static AgentScope onEnter(\n+      @Advice.This final Object stateInstance,\n+      @Advice.Argument(value = 2) final Object serverTransaction) {\n+    final AgentSpan span = startSpan(AXWAY_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM2MzI5Mw==", "bodyText": "constant?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570363293", "createdAt": "2021-02-04T16:27:36Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/StateAdvice.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.HOST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.PORT;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import java.lang.reflect.Field;\n+import net.bytebuddy.asm.Advice;\n+import org.slf4j.Logger;\n+\n+public class StateAdvice {\n+  public static final Logger log = org.slf4j.LoggerFactory.getLogger(StateAdvice.class);\n+\n+  @Advice.OnMethodEnter(suppress = Throwable.class)\n+  public static AgentScope onEnter(@Advice.This final Object stateInstance) {\n+    final AgentSpan span = startSpan(\"axway.trytransaction\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM2NTExNA==", "bodyText": "Advice classes shouldn't have fields, nor should they be logging like this.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570365114", "createdAt": "2021-02-04T16:29:52Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/StateAdvice.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.HOST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.PORT;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import java.lang.reflect.Field;\n+import net.bytebuddy.asm.Advice;\n+import org.slf4j.Logger;\n+\n+public class StateAdvice {\n+  public static final Logger log = org.slf4j.LoggerFactory.getLogger(StateAdvice.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM2NjY4OQ==", "bodyText": "Please add a comment (for someone that is unfamiliar with axway) indicating what this advice is for and why it's useful to the user.  The HTTPPluginAdvice seems fairly straightforward, but I don't understand how this relates to it.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570366689", "createdAt": "2021-02-04T16:32:01Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/StateAdvice.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.HOST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.PORT;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import java.lang.reflect.Field;\n+import net.bytebuddy.asm.Advice;\n+import org.slf4j.Logger;\n+\n+public class StateAdvice {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM2ODY1Ng==", "bodyText": "this class doesn't seem useful.  delete?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570368656", "createdAt": "2021-02-04T16:34:42Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/axway-api/src/test/groovy/datadog/trace/instrumentation/axway/AxwayAPITest.groovy", "diffHunk": "@@ -0,0 +1,34 @@\n+package datadog.trace.instrumentation.axway\n+\n+import datadog.trace.agent.test.base.HttpClientTest\n+import org.junit.Ignore\n+import spock.lang.Shared\n+import spock.lang.Timeout\n+\n+@Ignore\n+@Timeout(5)\n+class AxwayAPITest extends HttpClientTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNTkwMDk1", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583590095", "createdAt": "2021-02-04T16:38:20Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjozODoyMFrOIf8uVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjozODoyMFrOIf8uVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM3MTY3MQ==", "bodyText": "where is the status set? - the manual line in the advice appears commented out", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570371671", "createdAt": "2021-02-04T16:38:20Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import org.slf4j.Logger;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final String METHOD = \"method\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final Logger log =\n+      org.slf4j.LoggerFactory.getLogger(AxwayHTTPPluginDecorator.class);\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    return invokeNoArgDeclaredMethod(serverTransaction, \"getMethod\").toString();\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter((URI) invokeNoArgDeclaredMethod(serverTransaction, \"getURI\"));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return ((InetSocketAddress)\n+            invokeNoArgsSuperSuperClassMethod(serverTransaction, \"getLocalAddr\"))\n+        .getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return ((InetSocketAddress)\n+            invokeNoArgsSuperSuperClassMethod(serverTransaction, \"getLocalAddr\"))\n+        .getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // done manually", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNTkxNDQ5", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583591449", "createdAt": "2021-02-04T16:39:38Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjozOTozOVrOIf8yJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjozOTozOVrOIf8yJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM3MjY0NA==", "bodyText": "if you put @Slf4j on the class then lombok will add this for you", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570372644", "createdAt": "2021-02-04T16:39:39Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import org.slf4j.Logger;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final String METHOD = \"method\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final Logger log =\n+      org.slf4j.LoggerFactory.getLogger(AxwayHTTPPluginDecorator.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNTkzNjgy", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-583593682", "createdAt": "2021-02-04T16:41:47Z", "commit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjo0MTo0N1rOIf84bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxNjo0MTo0N1rOIf84bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM3NDI1Mg==", "bodyText": "this parameter appears unused and could be removed", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570374252", "createdAt": "2021-02-04T16:41:47Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/HTTPPluginAdvice.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.AXWAY_REQUEST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import net.bytebuddy.asm.Advice;\n+\n+public class HTTPPluginAdvice {\n+\n+  @Advice.OnMethodEnter(suppress = Throwable.class)\n+  public static AgentScope onEnter(\n+      @Advice.This final Object stateInstance,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38968b0cf420914302634985addba97663e524a4"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTg1NjM5", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584185639", "createdAt": "2021-02-05T09:58:52Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQwOTo1ODo1M1rOIgaDUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQwOTo1ODo1M1rOIgaDUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg1MjE3Ng==", "bodyText": "minor typo, should be AXWAY_TRY_TRANSACTION", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570852176", "createdAt": "2021-02-05T09:58:53Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTg4Nzcz", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584188773", "createdAt": "2021-02-05T10:02:42Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowMjo0MlrOIgaMdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowMjo0MlrOIgaMdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg1NDUxNg==", "bodyText": "make private since it's only used by this class", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570854516", "createdAt": "2021-02-05T10:02:42Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't invoke com.vordel.dwe.http.ServerTransaction::getMethod(): \", throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter(getUri(serverTransaction));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // TODO will be done manually\n+    return 0;\n+  }\n+\n+  public static URI getUri(Object obj) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTg5NDE3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584189417", "createdAt": "2021-02-05T10:03:33Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowMzozM1rOIgaONw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowMzozM1rOIgaONw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg1NDk2Nw==", "bodyText": "make private since it's only used by this class", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570854967", "createdAt": "2021-02-05T10:03:33Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't invoke com.vordel.dwe.http.ServerTransaction::getMethod(): \", throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter(getUri(serverTransaction));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // TODO will be done manually\n+    return 0;\n+  }\n+\n+  public static URI getUri(Object obj) {\n+    try {\n+      return (URI) getURI_mh.invoke(obj);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke 'getUri' in object \" + obj, e);\n+    }\n+    return URI.create(\"\");\n+  }\n+\n+  private static InetSocketAddress getRemoteAddr(Object obj) {\n+    try {\n+      return (InetSocketAddress) getRemoteAddr_mh.invoke(obj);\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't com.vordel.dwe.http.ServerTransaction::getRemoteAddr() : \", throwable);\n+    }\n+    return new InetSocketAddress(0);\n+  }\n+\n+  public static void setTagFromField(AgentSpan span, String tag, Object obj, String field) {\n+    span.setTag(tag, getFieldValue(obj, field).toString());\n+  }\n+\n+  public static Object getFieldValue(Object obj, String fieldName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTkwNTUx", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584190551", "createdAt": "2021-02-05T10:04:58Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowNDo1OFrOIgaRgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowNDo1OFrOIgaRgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg1NTgwOQ==", "bodyText": "Missing invoke in log text?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570855809", "createdAt": "2021-02-05T10:04:58Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't invoke com.vordel.dwe.http.ServerTransaction::getMethod(): \", throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter(getUri(serverTransaction));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // TODO will be done manually\n+    return 0;\n+  }\n+\n+  public static URI getUri(Object obj) {\n+    try {\n+      return (URI) getURI_mh.invoke(obj);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke 'getUri' in object \" + obj, e);\n+    }\n+    return URI.create(\"\");\n+  }\n+\n+  private static InetSocketAddress getRemoteAddr(Object obj) {\n+    try {\n+      return (InetSocketAddress) getRemoteAddr_mh.invoke(obj);\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't com.vordel.dwe.http.ServerTransaction::getRemoteAddr() : \", throwable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 105}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTkyMjc3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584192277", "createdAt": "2021-02-05T10:07:11Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowNzoxMVrOIgaW3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDowNzoxMVrOIgaW3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg1NzE4Mg==", "bodyText": "log.debug(\"Can't invoke 'getUri' in object {}\", obj, e);  would be better", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570857182", "createdAt": "2021-02-05T10:07:11Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't invoke com.vordel.dwe.http.ServerTransaction::getMethod(): \", throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter(getUri(serverTransaction));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // TODO will be done manually\n+    return 0;\n+  }\n+\n+  public static URI getUri(Object obj) {\n+    try {\n+      return (URI) getURI_mh.invoke(obj);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke 'getUri' in object \" + obj, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTk2NDM3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584196437", "createdAt": "2021-02-05T10:12:41Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDoxMjo0MVrOIgaj0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDoxMjo0MVrOIgaj0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg2MDQ5Ng==", "bodyText": "Looking up the field handle on every call will be expensive, because it involves various checks - could these field handles be cached? If we know which classes are involved then we could always do this in the static initializer like we're doing with the method handles.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570860496", "createdAt": "2021-02-05T10:12:41Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't invoke com.vordel.dwe.http.ServerTransaction::getMethod(): \", throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter(getUri(serverTransaction));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // TODO will be done manually\n+    return 0;\n+  }\n+\n+  public static URI getUri(Object obj) {\n+    try {\n+      return (URI) getURI_mh.invoke(obj);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke 'getUri' in object \" + obj, e);\n+    }\n+    return URI.create(\"\");\n+  }\n+\n+  private static InetSocketAddress getRemoteAddr(Object obj) {\n+    try {\n+      return (InetSocketAddress) getRemoteAddr_mh.invoke(obj);\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't com.vordel.dwe.http.ServerTransaction::getRemoteAddr() : \", throwable);\n+    }\n+    return new InetSocketAddress(0);\n+  }\n+\n+  public static void setTagFromField(AgentSpan span, String tag, Object obj, String field) {\n+    span.setTag(tag, getFieldValue(obj, field).toString());\n+  }\n+\n+  public static Object getFieldValue(Object obj, String fieldName) {\n+    try {\n+      Field field = obj.getClass().getDeclaredField(fieldName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 116}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTk5MTk3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584199197", "createdAt": "2021-02-05T10:16:05Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDoxNjowNVrOIgarjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDoxNjowNVrOIgarjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg2MjQ3Ng==", "bodyText": "log.debug(\"Can't find field '{}': \", fieldName, e);\n... maybe also mention the class we were looking in?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570862476", "createdAt": "2021-02-05T10:16:05Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't invoke com.vordel.dwe.http.ServerTransaction::getMethod(): \", throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    return new DefaultURIDataAdapter(getUri(serverTransaction));\n+  }\n+\n+  @Override\n+  protected String peerHostIP(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getHostString();\n+  }\n+\n+  @Override\n+  protected int peerPort(Object serverTransaction) {\n+    return getRemoteAddr(serverTransaction).getPort();\n+  }\n+\n+  @Override\n+  protected int status(final Object serverTransaction) {\n+    // TODO will be done manually\n+    return 0;\n+  }\n+\n+  public static URI getUri(Object obj) {\n+    try {\n+      return (URI) getURI_mh.invoke(obj);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke 'getUri' in object \" + obj, e);\n+    }\n+    return URI.create(\"\");\n+  }\n+\n+  private static InetSocketAddress getRemoteAddr(Object obj) {\n+    try {\n+      return (InetSocketAddress) getRemoteAddr_mh.invoke(obj);\n+    } catch (Throwable throwable) {\n+      log.debug(\"Can't com.vordel.dwe.http.ServerTransaction::getRemoteAddr() : \", throwable);\n+    }\n+    return new InetSocketAddress(0);\n+  }\n+\n+  public static void setTagFromField(AgentSpan span, String tag, Object obj, String field) {\n+    span.setTag(tag, getFieldValue(obj, field).toString());\n+  }\n+\n+  public static Object getFieldValue(Object obj, String fieldName) {\n+    try {\n+      Field field = obj.getClass().getDeclaredField(fieldName);\n+      field.setAccessible(true);\n+      Object v = field.get(obj);\n+      log.debug(\"field '{}': {}\", fieldName, v);\n+      return v;\n+    } catch (NoSuchFieldException | IllegalAccessException e) {\n+      log.debug(\"Can't find field '\" + fieldName + \"': \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MjAyMTk5", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584202199", "createdAt": "2021-02-05T10:19:47Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDoxOTo0OFrOIga0ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxMDoxOTo0OFrOIga0ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDg2NDc5OA==", "bodyText": "These 4 methods could be moved into a DECORATE.onTransaction method in the decorator - then you could keep the setTagFromField method private.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570864798", "createdAt": "2021-02-05T10:19:48Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/StateAdvice.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.AXWAY_TRY_TRAMSACTION;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.HOST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.PORT;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.setTagFromField;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import net.bytebuddy.asm.Advice;\n+\n+/**\n+ * Axway apigateway server gathers responses from 1 or more services, aggregates them and sends\n+ * response(s) to client(s). Apigateway is just reverse proxy. com.vordel.circuit.net.State class\n+ * represents connection(s) and \"state\" of communication to one or more of the services from which\n+ * axway apigateway needs to get reply to prepare aggregates response to customer. This\n+ * instrumentation intends to see to which services apigateway goes to prepare it response.\n+ */\n+public class StateAdvice {\n+  @Advice.OnMethodEnter(suppress = Throwable.class)\n+  public static AgentScope onEnter(@Advice.This final Object stateInstance) {\n+    final AgentSpan span = startSpan(AXWAY_TRY_TRAMSACTION);\n+    final AgentScope scope = activateSpan(span);\n+    span.setMeasured(true);\n+    // manually DECORATE.onRequest(span, stateInstance) :\n+    setTagFromField(span, Tags.HTTP_METHOD, stateInstance, \"verb\");\n+    setTagFromField(span, Tags.HTTP_URL, stateInstance, \"uri\");\n+    setTagFromField(span, Tags.PEER_HOSTNAME, stateInstance, HOST);\n+    setTagFromField(span, Tags.PEER_PORT, stateInstance, PORT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MzYyMDI1", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584362025", "createdAt": "2021-02-05T14:00:38Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxNDowMDozOFrOIgiQRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxNDowMDozOFrOIgiQRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDk4NjU2Nw==", "bodyText": "It would be to make these all final -- then the JIT will be able to constant propagate the MH and might have easier time inlining through it as well.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570986567", "createdAt": "2021-02-05T14:00:38Z", "author": {"login": "dougqh"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MzY3MjUx", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584367251", "createdAt": "2021-02-05T14:06:45Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxNDowNjo0NVrOIgie6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxNDowNjo0NVrOIgie6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDk5MDMxNQ==", "bodyText": "I believe the preferred way to do this with a MethodHandle is...\nreturn (String)methodHandle.invoke(serverTransaction);\nThe MethodHandle.invoke and invokeExact are magic signature polymorphic methods, so they adapt to accept the type of their arguments and return the type specified by the cast of the return type.\nhttps://docs.oracle.com/javase/8/docs/api/java/lang/invoke/MethodHandle.html#invokeExact-java.lang.Object...-\nIn this case, since we cannot statically reference the arg type, you probably do need invoke rather than invokeExact, but I believe it is still safe to cast the return.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570990315", "createdAt": "2021-02-05T14:06:45Z", "author": {"login": "dougqh"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final String HOST = \"host\";\n+  public static final String PORT = \"port\";\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.createConstant(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRAMSACTION =\n+      UTF8BytesString.createConstant(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+  private static MethodHandle getRemoteAddr_mh;\n+  private static MethodHandle getMethod_mh;\n+  private static MethodHandle getURI_mh;\n+\n+  static {\n+    try {\n+      Class<?> classServerTransaction = Class.forName(\"com.vordel.dwe.http.ServerTransaction\");\n+      getRemoteAddr_mh =\n+          lookup.findVirtual(\n+              classServerTransaction, \"getRemoteAddr\", methodType(InetSocketAddress.class));\n+      getMethod_mh =\n+          lookup.findVirtual(classServerTransaction, \"getMethod\", methodType(String.class));\n+\n+      Method m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      getURI_mh = lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find 'com.vordel.dwe.http.ServerTransaction::getRemoteAddr' method: \", e);\n+    }\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-api\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-api\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return getMethod_mh.invoke(serverTransaction).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MzY4NTU3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-584368557", "createdAt": "2021-02-05T14:08:17Z", "commit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxNDowODoxOFrOIgiirA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQxNDowODoxOFrOIgiirA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDk5MTI3Ng==", "bodyText": "If / when, we responseCode working we should make sure to use the Http code boxing cache.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r570991276", "createdAt": "2021-02-05T14:08:18Z", "author": {"login": "dougqh"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/HTTPPluginAdvice.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.activateSpan;\n+import static datadog.trace.bootstrap.instrumentation.api.AgentTracer.startSpan;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.AXWAY_REQUEST;\n+import static datadog.trace.instrumentation.axway.AxwayHTTPPluginDecorator.DECORATE;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentScope;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import net.bytebuddy.asm.Advice;\n+\n+public class HTTPPluginAdvice {\n+\n+  @Advice.OnMethodEnter(suppress = Throwable.class)\n+  public static AgentScope onEnter(@Advice.Argument(value = 2) final Object serverTransaction) {\n+    final AgentSpan span = startSpan(AXWAY_REQUEST);\n+    final AgentScope scope = activateSpan(span);\n+    span.setMeasured(true);\n+    DECORATE.afterStart(span);\n+    DECORATE.onConnection(span, serverTransaction);\n+    DECORATE.onRequest(span, serverTransaction);\n+    return scope;\n+  }\n+\n+  @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n+  public static void onExit(\n+      @Advice.Enter final AgentScope scope,\n+      // TODO getting local variable by name doens't work for axway\n+      // @Advice.Local(\"responseCode\") Integer responseCode,\n+      @Advice.Thrown final Throwable throwable) {\n+    if (scope == null) {\n+      return;\n+    }\n+    final AgentSpan span = scope.span();\n+    try {\n+      // manual DECORATE.onResponse(span, serverTransaction):\n+      // span.setTag(Tags.HTTP_STATUS, responseCode); //TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f76e569463724da273b663b635ebebde0d3a3de"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e54e5dfd1cb04da38faf1c17c4ef5851efd2ec7", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3e54e5dfd1cb04da38faf1c17c4ef5851efd2ec7", "committedDate": "2021-02-06T08:37:08Z", "message": "axway doc typos"}, "afterCommit": {"oid": "291cef9b6d25170714cb33b8606d13283af300c0", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/291cef9b6d25170714cb33b8606d13283af300c0", "committedDate": "2021-02-26T20:41:46Z", "message": "axway doc typos"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef9c147960098876857cfa62fec1fb1d894e5f55", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ef9c147960098876857cfa62fec1fb1d894e5f55", "committedDate": "2021-03-03T09:39:49Z", "message": "Axway http sttus code"}, "afterCommit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/994c629b375cf0745a13100a1722a2d237af3900", "committedDate": "2021-03-10T09:50:51Z", "message": "Axway http status code possible solution scheme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyMjY5NDAw", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-612269400", "createdAt": "2021-03-15T14:38:45Z", "commit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQxNDozODo0NlrOI224NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQxNDozODo0NlrOI224NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDM5MzE0MA==", "bodyText": "This form of forName will initialize the class.  It is safer to use the other forName(name, initialized, ClassLoader) instead with initialized=false.", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r594393140", "createdAt": "2021-03-15T14:38:46Z", "author": {"login": "dougqh"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,236 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.create(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRANSACTION =\n+      UTF8BytesString.create(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+\n+  private static final String SERVERTRANSACTION_CLASSNAME = \"com.vordel.dwe.http.ServerTransaction\";\n+  private static final Class<?> classServerTransaction;\n+  private static final MethodHandle getRemoteAddr_mh;\n+  private static final MethodHandle getMethod_mh;\n+  private static final MethodHandle getURI_mh;\n+\n+  private static final String STATE_CLASSNAME = \"com.vordel.circuit.net.State\";\n+  private static final Class<?> classState;\n+  private static final MethodHandle hostField_mh;\n+  private static final MethodHandle portField_mh;\n+  private static final MethodHandle methodField_mh;\n+  private static final MethodHandle uriField_mh;\n+\n+  static final String SERVER_TRANSACTION_CLASSNAME = \"com.vordel.dwe.http.ServerTransaction\";\n+  static final Class<Object> SERVER_TRANSACTION_CLASS = getServerTransactionClass();\n+\n+  private static Class<Object> getServerTransactionClass() {\n+    try {\n+      return (Class<Object>) Class.forName(SERVER_TRANSACTION_CLASSNAME);\n+    } catch (ClassNotFoundException e) {\n+      log.debug(\"Can't get ServerTransaction class name\", e);\n+    }\n+    return null;\n+  }\n+\n+  static {\n+    classServerTransaction = initClass(SERVERTRANSACTION_CLASSNAME);\n+    getRemoteAddr_mh =\n+        initNoArgServerTransactionMethodHandle(\"getRemoteAddr\", InetSocketAddress.class);\n+    getMethod_mh = initNoArgServerTransactionMethodHandle(\"getMethod\", String.class);\n+    getURI_mh = initGetURI();\n+\n+    classState = initClass(STATE_CLASSNAME);\n+    hostField_mh = initStateFieldGetter(\"host\");\n+    portField_mh = initStateFieldGetter(\"port\");\n+    methodField_mh = initStateFieldGetter(\"verb\");\n+    uriField_mh = initStateFieldGetter(\"uri\");\n+  }\n+\n+  private static Class<?> initClass(final String name) {\n+    try {\n+      return Class.forName(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyMjcxOTM2", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-612271936", "createdAt": "2021-03-15T14:40:55Z", "commit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQxNDo0MDo1NVrOI22_uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQxNDo0MDo1NVrOI22_uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDM5NTA2Nw==", "bodyText": "Can we not just return null?  Or does, the caller not support that?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r594395067", "createdAt": "2021-03-15T14:40:55Z", "author": {"login": "dougqh"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,236 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.create(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRANSACTION =\n+      UTF8BytesString.create(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+\n+  private static final String SERVERTRANSACTION_CLASSNAME = \"com.vordel.dwe.http.ServerTransaction\";\n+  private static final Class<?> classServerTransaction;\n+  private static final MethodHandle getRemoteAddr_mh;\n+  private static final MethodHandle getMethod_mh;\n+  private static final MethodHandle getURI_mh;\n+\n+  private static final String STATE_CLASSNAME = \"com.vordel.circuit.net.State\";\n+  private static final Class<?> classState;\n+  private static final MethodHandle hostField_mh;\n+  private static final MethodHandle portField_mh;\n+  private static final MethodHandle methodField_mh;\n+  private static final MethodHandle uriField_mh;\n+\n+  static final String SERVER_TRANSACTION_CLASSNAME = \"com.vordel.dwe.http.ServerTransaction\";\n+  static final Class<Object> SERVER_TRANSACTION_CLASS = getServerTransactionClass();\n+\n+  private static Class<Object> getServerTransactionClass() {\n+    try {\n+      return (Class<Object>) Class.forName(SERVER_TRANSACTION_CLASSNAME);\n+    } catch (ClassNotFoundException e) {\n+      log.debug(\"Can't get ServerTransaction class name\", e);\n+    }\n+    return null;\n+  }\n+\n+  static {\n+    classServerTransaction = initClass(SERVERTRANSACTION_CLASSNAME);\n+    getRemoteAddr_mh =\n+        initNoArgServerTransactionMethodHandle(\"getRemoteAddr\", InetSocketAddress.class);\n+    getMethod_mh = initNoArgServerTransactionMethodHandle(\"getMethod\", String.class);\n+    getURI_mh = initGetURI();\n+\n+    classState = initClass(STATE_CLASSNAME);\n+    hostField_mh = initStateFieldGetter(\"host\");\n+    portField_mh = initStateFieldGetter(\"port\");\n+    methodField_mh = initStateFieldGetter(\"verb\");\n+    uriField_mh = initStateFieldGetter(\"uri\");\n+  }\n+\n+  private static Class<?> initClass(final String name) {\n+    try {\n+      return Class.forName(name);\n+    } catch (ClassNotFoundException e) {\n+      log.debug(\n+          \"Can't find class '{}': Axaway integration failed. \", SERVERTRANSACTION_CLASSNAME, e);\n+    }\n+    return null;\n+  }\n+\n+  private static MethodHandle initNoArgServerTransactionMethodHandle(String name, Class<?> rtype) {\n+    try {\n+      return lookup.findVirtual(classServerTransaction, name, methodType(rtype));\n+    } catch (NoSuchMethodException | IllegalAccessException e) {\n+      log.debug(\"Can't find method handler '{}' \", name, e);\n+    }\n+    return null;\n+  }\n+\n+  private static MethodHandle initGetURI() {\n+    Method m = null;\n+    try {\n+      m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      return lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't unreflect method '{}': \", m, e);\n+    }\n+    return null;\n+  }\n+\n+  private static MethodHandle initStateFieldGetter(String fieldName) {\n+    Field field = null;\n+    MethodHandle mh = null;\n+    try {\n+      field = classState.getDeclaredField(fieldName);\n+      field.setAccessible(true);\n+      mh = lookup.unreflectGetter(field);\n+      log.debug(\n+          \"Initialized field '{}' of class '{}' unreflected to {}\", fieldName, classState, mh);\n+    } catch (NoSuchFieldException | IllegalAccessException e) {\n+      log.debug(\n+          \"Can't find and unreflect declared field '{}' with name '{}' for class '{}' to mh: '{}'\",\n+          field,\n+          fieldName,\n+          classState,\n+          mh,\n+          e);\n+    }\n+    return mh;\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-http\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-http\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return (String) getMethod_mh.invoke(serverTransaction);\n+    } catch (Throwable throwable) {\n+      log.debug(\n+          \"Can't invoke invoke '{}' on instance '{}' of class '{}'\",\n+          getMethod_mh,\n+          serverTransaction,\n+          serverTransaction.getClass(),\n+          throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    try {\n+      return new DefaultURIDataAdapter((URI) getURI_mh.invoke(serverTransaction));\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke '{}}' on '{}': \", getURI_mh, serverTransaction, e);\n+    }\n+    return new DefaultURIDataAdapter(URI.create(\"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "originalPosition": 153}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyMjcyNTY3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-612272567", "createdAt": "2021-03-15T14:41:24Z", "commit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQxNDo0MToyNFrOI23BXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQxNDo0MToyNFrOI23BXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDM5NTQ4Ng==", "bodyText": "If this happens, should we stop trying to the URL extraction?", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#discussion_r594395486", "createdAt": "2021-03-15T14:41:24Z", "author": {"login": "dougqh"}, "path": "dd-java-agent/instrumentation/axway-api/src/main/java/datadog/trace/instrumentation/axway/AxwayHTTPPluginDecorator.java", "diffHunk": "@@ -0,0 +1,236 @@\n+package datadog.trace.instrumentation.axway;\n+\n+import static java.lang.invoke.MethodType.methodType;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.DefaultURIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.Tags;\n+import datadog.trace.bootstrap.instrumentation.api.URIDataAdapter;\n+import datadog.trace.bootstrap.instrumentation.api.UTF8BytesString;\n+import datadog.trace.bootstrap.instrumentation.decorator.HttpServerDecorator;\n+import java.lang.invoke.MethodHandle;\n+import java.lang.invoke.MethodHandles;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Method;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import lombok.extern.slf4j.Slf4j;\n+\n+// request = is com.vordel.circuit.net.State,  connection = com.vordel.dwe.http.ServerTransaction\n+@Slf4j\n+public class AxwayHTTPPluginDecorator extends HttpServerDecorator<Object, Object, Object> {\n+  public static final CharSequence AXWAY_REQUEST = UTF8BytesString.create(\"axway.request\");\n+  public static final CharSequence AXWAY_TRY_TRANSACTION =\n+      UTF8BytesString.create(\"axway.trytransaction\");\n+\n+  public static final AxwayHTTPPluginDecorator DECORATE = new AxwayHTTPPluginDecorator();\n+\n+  private static final MethodHandles.Lookup lookup = MethodHandles.lookup();\n+\n+  private static final String SERVERTRANSACTION_CLASSNAME = \"com.vordel.dwe.http.ServerTransaction\";\n+  private static final Class<?> classServerTransaction;\n+  private static final MethodHandle getRemoteAddr_mh;\n+  private static final MethodHandle getMethod_mh;\n+  private static final MethodHandle getURI_mh;\n+\n+  private static final String STATE_CLASSNAME = \"com.vordel.circuit.net.State\";\n+  private static final Class<?> classState;\n+  private static final MethodHandle hostField_mh;\n+  private static final MethodHandle portField_mh;\n+  private static final MethodHandle methodField_mh;\n+  private static final MethodHandle uriField_mh;\n+\n+  static final String SERVER_TRANSACTION_CLASSNAME = \"com.vordel.dwe.http.ServerTransaction\";\n+  static final Class<Object> SERVER_TRANSACTION_CLASS = getServerTransactionClass();\n+\n+  private static Class<Object> getServerTransactionClass() {\n+    try {\n+      return (Class<Object>) Class.forName(SERVER_TRANSACTION_CLASSNAME);\n+    } catch (ClassNotFoundException e) {\n+      log.debug(\"Can't get ServerTransaction class name\", e);\n+    }\n+    return null;\n+  }\n+\n+  static {\n+    classServerTransaction = initClass(SERVERTRANSACTION_CLASSNAME);\n+    getRemoteAddr_mh =\n+        initNoArgServerTransactionMethodHandle(\"getRemoteAddr\", InetSocketAddress.class);\n+    getMethod_mh = initNoArgServerTransactionMethodHandle(\"getMethod\", String.class);\n+    getURI_mh = initGetURI();\n+\n+    classState = initClass(STATE_CLASSNAME);\n+    hostField_mh = initStateFieldGetter(\"host\");\n+    portField_mh = initStateFieldGetter(\"port\");\n+    methodField_mh = initStateFieldGetter(\"verb\");\n+    uriField_mh = initStateFieldGetter(\"uri\");\n+  }\n+\n+  private static Class<?> initClass(final String name) {\n+    try {\n+      return Class.forName(name);\n+    } catch (ClassNotFoundException e) {\n+      log.debug(\n+          \"Can't find class '{}': Axaway integration failed. \", SERVERTRANSACTION_CLASSNAME, e);\n+    }\n+    return null;\n+  }\n+\n+  private static MethodHandle initNoArgServerTransactionMethodHandle(String name, Class<?> rtype) {\n+    try {\n+      return lookup.findVirtual(classServerTransaction, name, methodType(rtype));\n+    } catch (NoSuchMethodException | IllegalAccessException e) {\n+      log.debug(\"Can't find method handler '{}' \", name, e);\n+    }\n+    return null;\n+  }\n+\n+  private static MethodHandle initGetURI() {\n+    Method m = null;\n+    try {\n+      m = classServerTransaction.getDeclaredMethod(\"getURI\"); // private method\n+      m.setAccessible(true);\n+      return lookup.unreflect(m);\n+    } catch (Throwable e) {\n+      log.debug(\"Can't unreflect method '{}': \", m, e);\n+    }\n+    return null;\n+  }\n+\n+  private static MethodHandle initStateFieldGetter(String fieldName) {\n+    Field field = null;\n+    MethodHandle mh = null;\n+    try {\n+      field = classState.getDeclaredField(fieldName);\n+      field.setAccessible(true);\n+      mh = lookup.unreflectGetter(field);\n+      log.debug(\n+          \"Initialized field '{}' of class '{}' unreflected to {}\", fieldName, classState, mh);\n+    } catch (NoSuchFieldException | IllegalAccessException e) {\n+      log.debug(\n+          \"Can't find and unreflect declared field '{}' with name '{}' for class '{}' to mh: '{}'\",\n+          field,\n+          fieldName,\n+          classState,\n+          mh,\n+          e);\n+    }\n+    return mh;\n+  }\n+\n+  @Override\n+  protected String[] instrumentationNames() {\n+    return new String[] {\"axway-http\"};\n+  }\n+\n+  @Override\n+  protected String component() {\n+    return \"axway-http\";\n+  }\n+\n+  @Override\n+  protected String method(final Object serverTransaction) {\n+    try {\n+      return (String) getMethod_mh.invoke(serverTransaction);\n+    } catch (Throwable throwable) {\n+      log.debug(\n+          \"Can't invoke invoke '{}' on instance '{}' of class '{}'\",\n+          getMethod_mh,\n+          serverTransaction,\n+          serverTransaction.getClass(),\n+          throwable);\n+    }\n+    return \"UNKNOWN\";\n+  }\n+\n+  @Override\n+  protected URIDataAdapter url(final Object serverTransaction) {\n+    try {\n+      return new DefaultURIDataAdapter((URI) getURI_mh.invoke(serverTransaction));\n+    } catch (Throwable e) {\n+      log.debug(\"Can't find invoke '{}}' on '{}': \", getURI_mh, serverTransaction, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "originalPosition": 151}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyMjc5NzQ0", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-612279744", "createdAt": "2021-03-15T14:47:18Z", "commit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "546f8dbb3ecb95791fd04b9a02b9aecab22435ff", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/546f8dbb3ecb95791fd04b9a02b9aecab22435ff", "committedDate": "2021-03-15T19:39:00Z", "message": "Axway API integration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d14221f23bfa0bb1ea7112ecdf00d479570cd41", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4d14221f23bfa0bb1ea7112ecdf00d479570cd41", "committedDate": "2021-03-15T19:39:00Z", "message": "Decorate onrequest manually"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e5cb1fa1f3e263735841d9dc596539a3ee2a352", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6e5cb1fa1f3e263735841d9dc596539a3ee2a352", "committedDate": "2021-03-15T19:39:01Z", "message": "Move reflection utils methods to Decorator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05167f4359911de4953c8dddc529b49f6b14a60f", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/05167f4359911de4953c8dddc529b49f6b14a60f", "committedDate": "2021-03-15T19:39:01Z", "message": "Don't add headers to State.header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a7e7f3c2162a282b7db609ac6e4cfa268ab5bea", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7a7e7f3c2162a282b7db609ac6e4cfa268ab5bea", "committedDate": "2021-03-15T19:39:01Z", "message": "AxwayHTTPPluginDecorator: replace reflection calls to MH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34c889b97cf46b8d28bc19d45f66a3d39abfeb7e", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/34c889b97cf46b8d28bc19d45f66a3d39abfeb7e", "committedDate": "2021-03-15T19:39:01Z", "message": "axway.StateAdvice: documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a70312e57f04958cc2a9d2c61237494d26485eae", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a70312e57f04958cc2a9d2c61237494d26485eae", "committedDate": "2021-03-15T19:39:01Z", "message": "axway-api: docs typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b6ce4669518664839358414c2dad830606527b", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/71b6ce4669518664839358414c2dad830606527b", "committedDate": "2021-03-15T19:39:01Z", "message": "Access fields via method handles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c0ed7d719f2c350401a0a53848966b33f48ed19", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2c0ed7d719f2c350401a0a53848966b33f48ed19", "committedDate": "2021-03-15T19:39:01Z", "message": "Name component 'axway-http'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f393238e3b6c1cb34ad6adc3025702862aec99a4", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f393238e3b6c1cb34ad6adc3025702862aec99a4", "committedDate": "2021-03-15T19:39:01Z", "message": "axway doc typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3e7b5373c5f10533ca73169cd6a080b6ce86701", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c3e7b5373c5f10533ca73169cd6a080b6ce86701", "committedDate": "2021-03-15T19:39:01Z", "message": "Axway http status code possible solution scheme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0816c51448e4f26be333806fb559a39414119b", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9b0816c51448e4f26be333806fb559a39414119b", "committedDate": "2021-03-15T20:14:37Z", "message": "avoid axway classes initialization at instrumentation time"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "994c629b375cf0745a13100a1722a2d237af3900", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/994c629b375cf0745a13100a1722a2d237af3900", "committedDate": "2021-03-10T09:50:51Z", "message": "Axway http status code possible solution scheme"}, "afterCommit": {"oid": "9b0816c51448e4f26be333806fb559a39414119b", "author": {"user": {"login": "lpriima", "name": "Lev"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9b0816c51448e4f26be333806fb559a39414119b", "committedDate": "2021-03-15T20:14:37Z", "message": "avoid axway classes initialization at instrumentation time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE0NDc2NTQ3", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-614476547", "createdAt": "2021-03-17T15:39:18Z", "commit": {"oid": "9b0816c51448e4f26be333806fb559a39414119b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE1Njk2MzU0", "url": "https://github.com/DataDog/dd-trace-java/pull/1724#pullrequestreview-615696354", "createdAt": "2021-03-18T17:43:52Z", "commit": {"oid": "9b0816c51448e4f26be333806fb559a39414119b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2053, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}