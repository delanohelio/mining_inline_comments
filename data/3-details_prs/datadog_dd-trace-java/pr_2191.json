{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2ODI5NzA5", "number": 2191, "title": "Enable instrumentation when only profiling is active", "bodyText": "Currently, when tracing is disabled the exception profiling is also not active.\nThis PR allows installing of the bytebuddy agent when either of profiling or tracing is active. When tracing is disabled all integrations are by default disabled (unless they override defaultEnabled() method) to make sure that no tracing is happening.", "createdAt": "2020-12-11T11:38:54Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2191", "merged": true, "mergeCommit": {"oid": "13d2ccdbfa6c22f9a2b2a09959f657fb9f37d4f7"}, "closed": true, "closedAt": "2020-12-14T13:06:55Z", "author": {"login": "jbachorik"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlGSfyAH2gAyNTM2ODI5NzA5OmQ3MDY0YTJjZmYwYjcxN2ZmMDk1ODZjNGJhOWRmM2RkY2NjY2FmYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmEuzdAFqTU1MTMxMjYwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d7064a2cff0b717ff09586c4ba9df3ddccccafc3", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d7064a2cff0b717ff09586c4ba9df3ddccccafc3", "committedDate": "2020-12-11T11:32:04Z", "message": "Enable instrumentation when only profiling is active"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDMwNTM2", "url": "https://github.com/DataDog/dd-trace-java/pull/2191#pullrequestreview-550030536", "createdAt": "2020-12-11T11:48:11Z", "commit": {"oid": "d7064a2cff0b717ff09586c4ba9df3ddccccafc3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDU2NDYw", "url": "https://github.com/DataDog/dd-trace-java/pull/2191#pullrequestreview-550056460", "createdAt": "2020-12-11T12:29:20Z", "commit": {"oid": "d7064a2cff0b717ff09586c4ba9df3ddccccafc3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMjoyOToyMFrOID2uNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMjoyOToyMFrOID2uNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkxMzIwNA==", "bodyText": "So this can be and is overridden in some instrumentations, e.g. datadog.trace.instrumentation.slf4j.mdc.MDCInjectionInstrumentation, meaning that they could be installed even though the tracing is off. It feels like there should be a separate flag for profiling, and some more logic where the enabled field is being set.", "url": "https://github.com/DataDog/dd-trace-java/pull/2191#discussion_r540913204", "createdAt": "2020-12-11T12:29:20Z", "author": {"login": "bantonsson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/Instrumenter.java", "diffHunk": "@@ -294,7 +294,9 @@ public void postMatch(\n     }\n \n     protected boolean defaultEnabled() {\n-      return Config.get().isIntegrationsEnabled();\n+      // by default an instrumentation is guarded by both tracing and the particular integration\n+      // being active\n+      return Config.get().isTraceEnabled() && Config.get().isIntegrationsEnabled();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7064a2cff0b717ff09586c4ba9df3ddccccafc3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82aff75dbbdb887a28bd0c8d6d73e6f927934241", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/82aff75dbbdb887a28bd0c8d6d73e6f927934241", "committedDate": "2020-12-11T16:59:22Z", "message": "Make sure tracing instrumentation does not get enabled in profiling-only mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4cc6e1cb4fb8dd687d1a1f401d0c5beea302c28", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a4cc6e1cb4fb8dd687d1a1f401d0c5beea302c28", "committedDate": "2020-12-11T17:11:12Z", "message": "Fix test instrumenters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e09b40ba970b5b0fe8f3d23683310aed8b9b3c89", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e09b40ba970b5b0fe8f3d23683310aed8b9b3c89", "committedDate": "2020-12-11T17:29:28Z", "message": "Merge branch 'master' into jb/exceptions_wo_tracing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb72d67fa672833e211713454508dd789470a6bd", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fb72d67fa672833e211713454508dd789470a6bd", "committedDate": "2020-12-11T17:30:42Z", "message": "Merge and fix a newly added test instrumenter"}, "afterCommit": {"oid": "6491ba2e9b913c09737d3d82550b82ca2505ff88", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6491ba2e9b913c09737d3d82550b82ca2505ff88", "committedDate": "2020-12-14T08:40:31Z", "message": "Merge and fix a newly added test instrumenter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "782452c5802145e9a6dcf660460dc071dbede034", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/782452c5802145e9a6dcf660460dc071dbede034", "committedDate": "2020-12-14T09:06:43Z", "message": "Merge and fix a newly added test instrumenter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6491ba2e9b913c09737d3d82550b82ca2505ff88", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6491ba2e9b913c09737d3d82550b82ca2505ff88", "committedDate": "2020-12-14T08:40:31Z", "message": "Merge and fix a newly added test instrumenter"}, "afterCommit": {"oid": "782452c5802145e9a6dcf660460dc071dbede034", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/782452c5802145e9a6dcf660460dc071dbede034", "committedDate": "2020-12-14T09:06:43Z", "message": "Merge and fix a newly added test instrumenter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a16cca309811bce84a94208402a1cf1d7e2ef3d", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7a16cca309811bce84a94208402a1cf1d7e2ef3d", "committedDate": "2020-12-14T09:44:05Z", "message": "Fix a strange spock failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a408291f3c0a108c88ca3ee7e4fb507e4752d05", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0a408291f3c0a108c88ca3ee7e4fb507e4752d05", "committedDate": "2020-12-14T10:01:26Z", "message": "Spotless!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMzEyNjAx", "url": "https://github.com/DataDog/dd-trace-java/pull/2191#pullrequestreview-551312601", "createdAt": "2020-12-14T12:17:06Z", "commit": {"oid": "0a408291f3c0a108c88ca3ee7e4fb507e4752d05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2739, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}