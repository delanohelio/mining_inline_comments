{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDg3MTE0", "number": 2183, "title": "Extend JMS Integration to support Time Spent in Queue", "bodyText": "When consuming messages via JMS, messages sometimes includes a creation timestamp\nIf this is available, add the time spent in queue span tag in the consume calls", "createdAt": "2020-12-09T21:52:14Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2183", "merged": true, "mergeCommit": {"oid": "1118e86959f6b00f54a873e566d2b66566e16b98"}, "closed": true, "closedAt": "2020-12-11T16:30:10Z", "author": {"login": "ziquanmiao"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkl6w9gH2gAyNTM1NDg3MTE0OjJjN2I2OGFhZWZlYTNhMTg5NDJlNDViNTc3M2U5NTY4OWMzZTU2Mzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlKUyDgFqTU1MDIzODQ0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c7b68aaefea3a18942e45b5773e95689c3e5639", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/2c7b68aaefea3a18942e45b5773e95689c3e5639", "committedDate": "2020-12-09T21:49:11Z", "message": "add jmsdecorator change and jms1 change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "094a542874c0248d800f5900442650ec3eae9f8f", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/094a542874c0248d800f5900442650ec3eae9f8f", "committedDate": "2020-12-09T21:49:33Z", "message": "extend JMS2Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa7f94d0fbca575d20ee64443d07fdf8666ea44f", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/fa7f94d0fbca575d20ee64443d07fdf8666ea44f", "committedDate": "2020-12-09T21:50:56Z", "message": "add support for SpringSAListener test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "894014650d6eed82c35d4a1aa9ee3300aa0b75b1", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/894014650d6eed82c35d4a1aa9ee3300aa0b75b1", "committedDate": "2020-12-10T02:11:31Z", "message": "spotlessapply"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDYyMjkx", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#pullrequestreview-549062291", "createdAt": "2020-12-10T10:36:05Z", "commit": {"oid": "894014650d6eed82c35d4a1aa9ee3300aa0b75b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDozNjowNlrOIDCjXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDozNjowNlrOIDCjXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1ODQ2MA==", "bodyText": "This assertion doesn't appear to check much - it doesn't check the time exists when we expect it to, or check that it doesn't exist when we don't expect it to. What do you think about adding a parameter to say when we expect there to be a time?\nWhen I do this I usually provide a default value to avoid having to update all the calls to the method: http://groovy-lang.org/objectorientation.html#_default_arguments - ie. only the calls that need the extra check then need to set the flag.", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540058460", "createdAt": "2020-12-10T10:36:06Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/jms/src/latestDepTest/groovy/JMS2Test.groovy", "diffHunk": "@@ -253,6 +275,9 @@ class JMS2Test extends AgentTestRunner {\n         tags {\n           \"${Tags.COMPONENT}\" \"jms\"\n           \"${Tags.SPAN_KIND}\" \"consumer\"\n+          if (!messageListener && \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "894014650d6eed82c35d4a1aa9ee3300aa0b75b1"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1", "committedDate": "2020-12-10T16:06:04Z", "message": "modify tests have explicit expectations when timestamp is missing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDg0Mjg1", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#pullrequestreview-549484285", "createdAt": "2020-12-10T18:26:23Z", "commit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNjoyM1rOIDXVVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNzozOVrOIDXYkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5ODkzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      } else if (isTimestampDisabled){\n          \n          \n            \n                        \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null }\n          \n      \n    \n    \n  \n\nI think these two lines are unnecessary since it will automatically verify such.", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540398932", "createdAt": "2020-12-10T18:26:23Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/jms/src/latestDepTest/groovy/JMS2Test.groovy", "diffHunk": "@@ -253,6 +277,11 @@ class JMS2Test extends AgentTestRunner {\n         tags {\n           \"${Tags.COMPONENT}\" \"jms\"\n           \"${Tags.SPAN_KIND}\" \"consumer\"\n+          if (!messageListener && !isTimestampDisabled) {\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it >= 0 }\n+          } else if (isTimestampDisabled){\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5OTQxNQ==", "bodyText": "?", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540399415", "createdAt": "2020-12-10T18:27:08Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/jms/src/test/groovy/JMS1Test.groovy", "diffHunk": "@@ -34,6 +35,8 @@ class JMS1Test extends AgentTestRunner {\n     final Connection connection = connectionFactory.createConnection()\n     connection.start()\n     session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE)\n+\n+//    final Connection connectionDisabledTimestamp = connectionFactory.createConnection()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5OTc2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      } else if (isTimestampDisabled) {\n          \n          \n            \n                        \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null}\n          \n      \n    \n    \n  \n\nSame here.", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540399760", "createdAt": "2020-12-10T18:27:39Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/jms/src/test/groovy/JMS1Test.groovy", "diffHunk": "@@ -269,6 +296,11 @@ class JMS1Test extends AgentTestRunner {\n         tags {\n           \"$Tags.COMPONENT\" \"jms\"\n           \"$Tags.SPAN_KIND\" Tags.SPAN_KIND_CONSUMER\n+          if (!messageListener && !isTimestampDisabled) {\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it >= 0 }\n+          } else if (isTimestampDisabled) {\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7a83653a201b3915da8558353e84e9d290e6936", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/e7a83653a201b3915da8558353e84e9d290e6936", "committedDate": "2020-12-10T19:51:22Z", "message": "modify tests based on feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDA2MjQ0", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#pullrequestreview-550006244", "createdAt": "2020-12-11T11:10:13Z", "commit": {"oid": "e7a83653a201b3915da8558353e84e9d290e6936"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMjM4NDQw", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#pullrequestreview-550238440", "createdAt": "2020-12-11T16:14:11Z", "commit": {"oid": "e7a83653a201b3915da8558353e84e9d290e6936"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2733, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}