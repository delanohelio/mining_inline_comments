{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNTEyMDU4", "number": 2207, "title": "represent sampling priority as a byte", "bodyText": "This avoids storing the sampling priority in a map. I chose to represent it as a byte since PrioritySampling.UNSET is a constant local to the tracer. Currently DDSpanContext is already at 80 bytes, so because of alignment it will grow to 88 bytes whether we choose byte or int, but assuming we can remove fields in the future, choosing a byte will pay off. The main aim of this PR is not to need to store or access the value in the map.", "createdAt": "2020-12-15T18:14:14Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2207", "merged": true, "mergeCommit": {"oid": "1c264c465d4db92d7c06daff087a2711b959998a"}, "closed": true, "closedAt": "2020-12-16T11:24:32Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmedNkgBqjQxMTU5ODM4MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdms_qZgFqTU1MzU4MzQwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e41fa3cd63389c05f0e2f85a3796d0ff0803679", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9e41fa3cd63389c05f0e2f85a3796d0ff0803679", "committedDate": "2020-12-15T18:10:18Z", "message": "represent sampling priority as a byte, so it doesn't lead to the metrics map being populated"}, "afterCommit": {"oid": "6b8c0b8e4d6ebfdcd0d4df2a1d5f32bf3c7409d1", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6b8c0b8e4d6ebfdcd0d4df2a1d5f32bf3c7409d1", "committedDate": "2020-12-15T18:15:16Z", "message": "represent sampling priority as a byte, so it doesn't lead to the metrics map being populated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODc4Mjk3", "url": "https://github.com/DataDog/dd-trace-java/pull/2207#pullrequestreview-552878297", "createdAt": "2020-12-15T21:09:46Z", "commit": {"oid": "6b8c0b8e4d6ebfdcd0d4df2a1d5f32bf3c7409d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96feac163a2b1b08ff02b53fca4aae61e9c2316c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/96feac163a2b1b08ff02b53fca4aae61e9c2316c", "committedDate": "2020-12-15T21:31:40Z", "message": "represent sampling priority as a byte, so it doesn't lead to the metrics map being populated"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b8c0b8e4d6ebfdcd0d4df2a1d5f32bf3c7409d1", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6b8c0b8e4d6ebfdcd0d4df2a1d5f32bf3c7409d1", "committedDate": "2020-12-15T18:15:16Z", "message": "represent sampling priority as a byte, so it doesn't lead to the metrics map being populated"}, "afterCommit": {"oid": "96feac163a2b1b08ff02b53fca4aae61e9c2316c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/96feac163a2b1b08ff02b53fca4aae61e9c2316c", "committedDate": "2020-12-15T21:31:40Z", "message": "represent sampling priority as a byte, so it doesn't lead to the metrics map being populated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNTgwMzA3", "url": "https://github.com/DataDog/dd-trace-java/pull/2207#pullrequestreview-553580307", "createdAt": "2020-12-16T11:07:35Z", "commit": {"oid": "96feac163a2b1b08ff02b53fca4aae61e9c2316c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTowNzozNVrOIG_6bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTowNzozNVrOIG_6bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIwOTUxOQ==", "bodyText": "is this extra debug check still needed now that getMetric is no longer called below?", "url": "https://github.com/DataDog/dd-trace-java/pull/2207#discussion_r544209519", "createdAt": "2020-12-16T11:07:35Z", "author": {"login": "mcculls"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java", "diffHunk": "@@ -249,14 +251,18 @@ public boolean setSamplingPriority(final int newPriority) {\n     // sync with lockSamplingPriority\n     synchronized (this) {\n       if (samplingPriorityLocked) {\n-        log.debug(\n-            \"samplingPriority locked at {}. Refusing to set to {}\",\n-            getMetric(PRIORITY_SAMPLING_KEY),\n-            newPriority);\n+        if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96feac163a2b1b08ff02b53fca4aae61e9c2316c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNTgzNDAz", "url": "https://github.com/DataDog/dd-trace-java/pull/2207#pullrequestreview-553583403", "createdAt": "2020-12-16T11:11:43Z", "commit": {"oid": "96feac163a2b1b08ff02b53fca4aae61e9c2316c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2765, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}