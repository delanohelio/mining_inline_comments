{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDU3Mzc5", "number": 1955, "title": "Write out a trace as soon as possible", "bodyText": "This change ensures that we write out a trace as soon as its reference count reaches zero.", "createdAt": "2020-10-06T11:10:36Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1955", "merged": true, "mergeCommit": {"oid": "6523c3a20ea2d3db11dc8d1cb4e9b68518941410"}, "closed": true, "closedAt": "2020-10-07T13:19:25Z", "author": {"login": "bantonsson"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP48n6AFqTUwMzAwMjE0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQMrDzgFqTUwMzg1NjI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDAyMTQ2", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503002146", "createdAt": "2020-10-06T14:06:30Z", "commit": {"oid": "386536fd170d2f85536c757586327b616f47697e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowNjozMFrOHdImYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowNjozMFrOHdImYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMxMTY1MQ==", "bodyText": "Please update the class comment with the new flow.", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#discussion_r500311651", "createdAt": "2020-10-06T14:06:30Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/PendingTrace.java", "diffHunk": "@@ -281,32 +281,32 @@ private void expireReference(boolean isRootSpan) {\n       return;\n     }\n     final int count = pendingReferenceCount.decrementAndGet();\n-    if (isRootSpan) {\n-      if (0 < count) {\n+    if (count == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386536fd170d2f85536c757586327b616f47697e"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDMzNDY1", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503033465", "createdAt": "2020-10-06T14:34:37Z", "commit": {"oid": "386536fd170d2f85536c757586327b616f47697e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTAzNDYx", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503103461", "createdAt": "2020-10-06T15:39:53Z", "commit": {"oid": "386536fd170d2f85536c757586327b616f47697e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "386536fd170d2f85536c757586327b616f47697e", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/386536fd170d2f85536c757586327b616f47697e", "committedDate": "2020-10-06T11:07:01Z", "message": "Write out a trace as soon as possible"}, "afterCommit": {"oid": "817f7bde1aa8635fe47661386d1dea62f3249727", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/817f7bde1aa8635fe47661386d1dea62f3249727", "committedDate": "2020-10-06T15:47:47Z", "message": "Write out a trace as soon as possible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTIxOTQx", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503121941", "createdAt": "2020-10-06T15:58:00Z", "commit": {"oid": "817f7bde1aa8635fe47661386d1dea62f3249727"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1ODowMFrOHdO4pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1ODowMFrOHdO4pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxNDYzMQ==", "bodyText": "Think it'd be worth capturing this detail in a field?", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#discussion_r500414631", "createdAt": "2020-10-06T15:58:00Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/scopemanager/ContinuableScopeManager.java", "diffHunk": "@@ -415,6 +415,11 @@ public void cancel(final Set<WeakReference<AgentScope.Continuation>> weakReferen\n       ref = null;\n     }\n \n+    protected boolean isRootSpan() {\n+      AgentSpan span = this.spanUnderScope;\n+      return span == span.getLocalRootSpan();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "817f7bde1aa8635fe47661386d1dea62f3249727"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTI1NDM5", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503125439", "createdAt": "2020-10-06T16:01:33Z", "commit": {"oid": "817f7bde1aa8635fe47661386d1dea62f3249727"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNjE3NTYx", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503617561", "createdAt": "2020-10-07T07:59:27Z", "commit": {"oid": "817f7bde1aa8635fe47661386d1dea62f3249727"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "817f7bde1aa8635fe47661386d1dea62f3249727", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/817f7bde1aa8635fe47661386d1dea62f3249727", "committedDate": "2020-10-06T15:47:47Z", "message": "Write out a trace as soon as possible"}, "afterCommit": {"oid": "c449b5a06143ee5bf5251074c901d8bf24fa1c4f", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c449b5a06143ee5bf5251074c901d8bf24fa1c4f", "committedDate": "2020-10-07T09:50:01Z", "message": "Write out a trace as soon as possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c8310fc3bc4c32d3e74bdbc04453882601a57ef", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5c8310fc3bc4c32d3e74bdbc04453882601a57ef", "committedDate": "2020-10-07T12:24:41Z", "message": "Write out a trace as soon as possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c449b5a06143ee5bf5251074c901d8bf24fa1c4f", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c449b5a06143ee5bf5251074c901d8bf24fa1c4f", "committedDate": "2020-10-07T09:50:01Z", "message": "Write out a trace as soon as possible"}, "afterCommit": {"oid": "5c8310fc3bc4c32d3e74bdbc04453882601a57ef", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5c8310fc3bc4c32d3e74bdbc04453882601a57ef", "committedDate": "2020-10-07T12:24:41Z", "message": "Write out a trace as soon as possible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzODU2MjQw", "url": "https://github.com/DataDog/dd-trace-java/pull/1955#pullrequestreview-503856240", "createdAt": "2020-10-07T13:05:55Z", "commit": {"oid": "5c8310fc3bc4c32d3e74bdbc04453882601a57ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2933, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}