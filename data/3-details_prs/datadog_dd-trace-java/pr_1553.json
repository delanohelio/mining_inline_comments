{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NTcwMDk4", "number": 1553, "title": "PROF-1618: Decouple method level tracer from profiling", "bodyText": "This is an attempt to decouple the MLT code from profiling and also provide a shared library for MLT binary format handling which could be used also from the backend code.\nI couldn't use the recommended dd-trace-core project since the MLT code requires Java 8. Instead, I have created a new utils/mlt-support module with the shared MLT binary format support and dd-java-agent/agent-mlt module containing the sampler implementation.\nI have also removed the JFR support which became dead code (at least for now).", "createdAt": "2020-06-05T16:39:13Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1553", "merged": true, "mergeCommit": {"oid": "095d72675e0b6752ea7b539fcb3f3b09b271a1f4"}, "closed": true, "closedAt": "2020-06-11T09:47:10Z", "author": {"login": "jbachorik"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpNF8TAFqTQyNjA2MTIwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqKZUAAH2gAyNDI4NTcwMDk4OjZhNzE1OTQyODIyZjdhM2M1ZTU3ODQwMWEzODgwZDk3MTAxZDEyMGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDYxMjA5", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#pullrequestreview-426061209", "createdAt": "2020-06-08T09:32:14Z", "commit": {"oid": "2ac4516732250870bc23fd889612dfe19d060576"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDczMjEz", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#pullrequestreview-426473213", "createdAt": "2020-06-08T17:45:13Z", "commit": {"oid": "2ac4516732250870bc23fd889612dfe19d060576"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0NToxM1rOGgpSVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0NToxM1rOGgpSVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg4NDA1Mg==", "bodyText": "Why do we want the isJavaBefore9()?", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#discussion_r436884052", "createdAt": "2020-06-08T17:45:13Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -100,6 +101,17 @@ public static void start(final Instrumentation inst, final URL bootstrapURL) {\n     } else {\n       startProfilingAgent(bootstrapURL, false);\n     }\n+\n+    /*\n+     * And yet another block for method-level tracer which is using JMX behind the scenes and\n+     * can mess with LogManager.\n+     */\n+    if (isJavaBefore9() && appUsingCustomLogManager) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac4516732250870bc23fd889612dfe19d060576"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTkxNjQw", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#pullrequestreview-426591640", "createdAt": "2020-06-08T20:23:22Z", "commit": {"oid": "2ac4516732250870bc23fd889612dfe19d060576"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDoyMzoyMlrOGgvA9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDoyMzoyMlrOGgvA9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk3NzkxMA==", "bodyText": "I tried it locally and this doesn't actually work because dd-trace-core isn't accessible to this classloader.  Can the required classes be extracted out of dd-trace-core or do we need to move dd-trace-core to the shared classloader?", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#discussion_r436977910", "createdAt": "2020-06-08T20:23:22Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-mlt/agent-mlt.gradle", "diffHunk": "@@ -0,0 +1,30 @@\n+plugins {\n+  id \"com.github.johnrengelman.shadow\"\n+}\n+apply from: \"$rootDir/gradle/java.gradle\"\n+\n+dependencies {\n+  compile deps.slf4j\n+  compile project(':dd-trace-core')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac4516732250870bc23fd889612dfe19d060576"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDYzMDEy", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#pullrequestreview-428063012", "createdAt": "2020-06-10T13:40:21Z", "commit": {"oid": "b54dd07f45099928af1d9879346ace53cf287db8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzo0MDoyMVrOGh1U3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzo0MDoyMVrOGh1U3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyOTg4NQ==", "bodyText": "final useless here", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#discussion_r438129885", "createdAt": "2020-06-10T13:40:21Z", "author": {"login": "jpbempel"}, "path": "dd-java-agent/agent-mlt/src/main/java/com/datadog/mlt/sampler/ThreadStackAccess.java", "diffHunk": "@@ -1,9 +1,9 @@\n-package datadog.trace.core.util;\n+package com.datadog.mlt.sampler;\n \n import lombok.extern.slf4j.Slf4j;\n \n @Slf4j\n-public class ThreadStackAccess {\n+public final class ThreadStackAccess {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b54dd07f45099928af1d9879346ace53cf287db8"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDYzMTg1", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#pullrequestreview-428063185", "createdAt": "2020-06-10T13:40:31Z", "commit": {"oid": "3c6362b0e657eb628386c94b8900b2af8230537b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85ec96dec1d2ba7c10816fccac810cede712fedf", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/85ec96dec1d2ba7c10816fccac810cede712fedf", "committedDate": "2020-06-10T15:56:48Z", "message": "Remove JFR writer support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e840bfcecd54e1322104c68632b8ea7fd8e2f879", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e840bfcecd54e1322104c68632b8ea7fd8e2f879", "committedDate": "2020-06-10T15:56:48Z", "message": "Grep the smoke test report log file for ERROR and WARN and make it fail if there are any"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ec3ae6cf8ac0ebc2e5e421f071e8bc0dd167a09", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5ec3ae6cf8ac0ebc2e5e421f071e8bc0dd167a09", "committedDate": "2020-06-10T15:56:48Z", "message": "Move out the MLT binary format support to a separate module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee17cecebb629fab7c7a59565db177cca52c367", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6ee17cecebb629fab7c7a59565db177cca52c367", "committedDate": "2020-06-10T15:56:48Z", "message": "Create a new agent-mlt project containing the MLT sampler and support\n\nCreate a new agent-mlt project containing the MLT sampler and support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1163ac23659d936526df6c4833f04908668681ea", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1163ac23659d936526df6c4833f04908668681ea", "committedDate": "2020-06-10T15:56:48Z", "message": "Make formatter happy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32cebee13c67e5d26f28ea4af7535ded6fe0af4c", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/32cebee13c67e5d26f28ea4af7535ded6fe0af4c", "committedDate": "2020-06-10T15:56:48Z", "message": "Fix MLT initialization callback condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a900400c853aaf4e00788042608e24f316b15cb5", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a900400c853aaf4e00788042608e24f316b15cb5", "committedDate": "2020-06-10T15:56:48Z", "message": "Various fixes related to restructuring of MLT impl\n\n- remove duplicated classes in shadowed jars\n- move ThreadStackAccess related classes to mlt-agent (solves class loading issues)\n- fix MLT initialization in Agent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d424480b7ba2b0dfca029ea5c84ec767c082ad5b", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d424480b7ba2b0dfca029ea5c84ec767c082ad5b", "committedDate": "2020-06-10T15:56:48Z", "message": "Remove unused callback class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c6362b0e657eb628386c94b8900b2af8230537b", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3c6362b0e657eb628386c94b8900b2af8230537b", "committedDate": "2020-06-10T12:44:23Z", "message": "Remove unused callback class"}, "afterCommit": {"oid": "d424480b7ba2b0dfca029ea5c84ec767c082ad5b", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d424480b7ba2b0dfca029ea5c84ec767c082ad5b", "committedDate": "2020-06-10T15:56:48Z", "message": "Remove unused callback class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07e244dcbe98af27d0b7c1b7b31d6ebe59e7da8a", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/07e244dcbe98af27d0b7c1b7b31d6ebe59e7da8a", "committedDate": "2020-06-10T17:24:28Z", "message": "Attempt to fix the test errors related to Java version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDcwMTI3", "url": "https://github.com/DataDog/dd-trace-java/pull/1553#pullrequestreview-428470127", "createdAt": "2020-06-10T22:25:19Z", "commit": {"oid": "07e244dcbe98af27d0b7c1b7b31d6ebe59e7da8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb2ec7c90bacb069568e4dd54e95dc935c9d7309", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/eb2ec7c90bacb069568e4dd54e95dc935c9d7309", "committedDate": "2020-06-11T08:29:22Z", "message": "Fix the profiling smoke tests to work with the agent.jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33ad76de4571d3619fdc5de57da2d1dee176eefc", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/33ad76de4571d3619fdc5de57da2d1dee176eefc", "committedDate": "2020-06-11T08:46:21Z", "message": "Add check for JMXSampler actually collecting stacktraces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a715942822f7a3c5e578401a3880d97101d120b", "author": {"user": {"login": "jbachorik", "name": "Jaroslav Bachorik"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6a715942822f7a3c5e578401a3880d97101d120b", "committedDate": "2020-06-11T08:57:36Z", "message": "Reformat"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2376, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}