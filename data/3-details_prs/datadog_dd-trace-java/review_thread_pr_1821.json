{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MjI5NjA3", "number": 1821, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNjo1ODo1MFrOEfTE9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzozMzoxN1rOEfUG4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjUzODc5OnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/TraceStructureWriter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNjo1ODo1MFrOHLfJDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODoxNjo0NVrOHLjKVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgwNjYwNw==", "bodyText": "Could we add a check for a broken traceId as well? I know it shouldn't happen, but who knows...", "url": "https://github.com/DataDog/dd-trace-java/pull/1821#discussion_r481806607", "createdAt": "2020-09-02T06:58:50Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/TraceStructureWriter.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package datadog.trace.common.writer;\n+\n+import datadog.trace.api.DDId;\n+import datadog.trace.core.DDSpan;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.PrintStream;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class TraceStructureWriter implements Writer {\n+\n+  private final PrintStream out;\n+\n+  public TraceStructureWriter() {\n+    this(\"\");\n+  }\n+\n+  public TraceStructureWriter(String outputFile) {\n+    try {\n+      this.out =\n+          outputFile.isEmpty() || outputFile.equals(\":\")\n+              ? System.err\n+              : new PrintStream(new FileOutputStream(new File(outputFile.replace(\":\", \"\"))));\n+    } catch (IOException e) {\n+      throw new RuntimeException(\"Failed to create trace structure writer from \" + outputFile, e);\n+    }\n+  }\n+\n+  @Override\n+  public void write(List<DDSpan> trace) {\n+    if (trace.isEmpty()) {\n+      out.println(\"[]\");\n+    } else {\n+      DDId traceId = trace.get(0).getTraceId();\n+      DDId rootSpanId = trace.get(0).getSpanId();\n+      Map<DDId, Node> nodesById = new HashMap<>();\n+      // index the tree\n+      for (DDSpan span : trace) {\n+        if (DDId.ZERO.equals(span.getParentId())) {\n+          rootSpanId = span.getSpanId();\n+        }\n+        nodesById.put(span.getSpanId(), new Node(span));\n+      }\n+      // build the tree\n+      for (DDSpan span : trace) {\n+        if (!rootSpanId.equals(span.getSpanId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "249bbd7a56c7ee3feb53d25365d9b7714ba237a5"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg3MjQ2OQ==", "bodyText": "If CI were a little more reliable and it wouldn't cost me quite some time to do that and get it built, I would do it. I'll batch it in with more tests I want to build on this.", "url": "https://github.com/DataDog/dd-trace-java/pull/1821#discussion_r481872469", "createdAt": "2020-09-02T08:16:45Z", "author": {"login": "richardstartin"}, "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/TraceStructureWriter.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package datadog.trace.common.writer;\n+\n+import datadog.trace.api.DDId;\n+import datadog.trace.core.DDSpan;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.PrintStream;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class TraceStructureWriter implements Writer {\n+\n+  private final PrintStream out;\n+\n+  public TraceStructureWriter() {\n+    this(\"\");\n+  }\n+\n+  public TraceStructureWriter(String outputFile) {\n+    try {\n+      this.out =\n+          outputFile.isEmpty() || outputFile.equals(\":\")\n+              ? System.err\n+              : new PrintStream(new FileOutputStream(new File(outputFile.replace(\":\", \"\"))));\n+    } catch (IOException e) {\n+      throw new RuntimeException(\"Failed to create trace structure writer from \" + outputFile, e);\n+    }\n+  }\n+\n+  @Override\n+  public void write(List<DDSpan> trace) {\n+    if (trace.isEmpty()) {\n+      out.println(\"[]\");\n+    } else {\n+      DDId traceId = trace.get(0).getTraceId();\n+      DDId rootSpanId = trace.get(0).getSpanId();\n+      Map<DDId, Node> nodesById = new HashMap<>();\n+      // index the tree\n+      for (DDSpan span : trace) {\n+        if (DDId.ZERO.equals(span.getParentId())) {\n+          rootSpanId = span.getSpanId();\n+        }\n+        nodesById.put(span.getSpanId(), new Node(span));\n+      }\n+      // build the tree\n+      for (DDSpan span : trace) {\n+        if (!rootSpanId.equals(span.getSpanId())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgwNjYwNw=="}, "originalCommit": {"oid": "249bbd7a56c7ee3feb53d25365d9b7714ba237a5"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjcwNzUyOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/opentelemetry/opentelemetry.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzozMzoxN1rOHLg2Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzozMzoxN1rOHLg2Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgzNDU3OA==", "bodyText": "Looks like they broke API and muzzle started failing :(", "url": "https://github.com/DataDog/dd-trace-java/pull/1821#discussion_r481834578", "createdAt": "2020-09-02T07:33:17Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/instrumentation/opentelemetry/opentelemetry.gradle", "diffHunk": "@@ -5,7 +5,7 @@ muzzle {\n   pass {\n     module = 'opentelemetry-api'\n     group = 'io.opentelemetry'\n-    versions = \"[$otelVersion,]\"\n+    versions = \"[$otelVersion,0.8.0)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12fa93c4e75781270d81d8a6c08a6fbdb98ed442"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4921, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}