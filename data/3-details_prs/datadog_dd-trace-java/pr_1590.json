{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTY1NTQz", "number": 1590, "title": "Increase agent communication timeouts and add more logging", "bodyText": "This PR has two parts:\n\nIt increase the timeouts for communicating to the agent from 1 second to 10 seconds, since the communication happens on a separate thread and won't block application. It also tries to connect to the agent as soon as the writer is started, again on the separate thread, to get the http client creation out of the way of normal sending.\nIt makes logging the results of agent communication more uniform, adds more information, and also logs the first success after a failure on info level. The first success after failure logging is subject to the same quiet period as failure logging.\n\nHave tested and verified logging locally, since I can't figure out how to test that in unit tests in a nice way.\nThe timeout configuration option should be added to the docs. Where is that done?", "createdAt": "2020-06-15T14:08:23Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1590", "merged": true, "mergeCommit": {"oid": "724de7cf1c76408d0ea92ebaec97ea48e110ed7b"}, "closed": true, "closedAt": "2020-06-15T16:20:35Z", "author": {"login": "bantonsson"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrhfn3AFqTQzMDY5MzM3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcri2mRABqjM0NDUxMDkyOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjkzMzc0", "url": "https://github.com/DataDog/dd-trace-java/pull/1590#pullrequestreview-430693374", "createdAt": "2020-06-15T14:23:21Z", "commit": {"oid": "2fedf7d7c4a9b52b634ecf74fd0b1c272a861560"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDoyMzoyMVrOGj0dwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDoyMzoyMVrOGj0dwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIxMjkzMA==", "bodyText": "Instead of removing this, can I suggest the following API instead?\nDaemonThreadFactory threadFactory = TRACE_WRITER.withInitializer(new Runnable()...)", "url": "https://github.com/DataDog/dd-trace-java/pull/1590#discussion_r440212930", "createdAt": "2020-06-15T14:23:21Z", "author": {"login": "tylerbenson"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/DaemonThreadFactory.java", "diffHunk": "@@ -6,24 +6,49 @@\n public final class DaemonThreadFactory implements ThreadFactory {\n   public static final DaemonThreadFactory TRACE_PROCESSOR =\n       new DaemonThreadFactory(\"dd-trace-processor\");\n-  public static final DaemonThreadFactory TRACE_WRITER = new DaemonThreadFactory(\"dd-trace-writer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fedf7d7c4a9b52b634ecf74fd0b1c272a861560"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjk5Nzcx", "url": "https://github.com/DataDog/dd-trace-java/pull/1590#pullrequestreview-430699771", "createdAt": "2020-06-15T14:30:09Z", "commit": {"oid": "2fedf7d7c4a9b52b634ecf74fd0b1c272a861560"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fedf7d7c4a9b52b634ecf74fd0b1c272a861560", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2fedf7d7c4a9b52b634ecf74fd0b1c272a861560", "committedDate": "2020-06-15T13:56:46Z", "message": "Add more information to log messages and log success after failure"}, "afterCommit": {"oid": "ee74e78c3a8868068ebc4cbb4aa133485ed1f162", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ee74e78c3a8868068ebc4cbb4aa133485ed1f162", "committedDate": "2020-06-15T14:58:01Z", "message": "Add more information to log messages and log success after failure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee74e78c3a8868068ebc4cbb4aa133485ed1f162", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ee74e78c3a8868068ebc4cbb4aa133485ed1f162", "committedDate": "2020-06-15T14:58:01Z", "message": "Add more information to log messages and log success after failure"}, "afterCommit": {"oid": "353eba9379535d6ce46ff1001e04e4d8ee394f93", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/353eba9379535d6ce46ff1001e04e4d8ee394f93", "committedDate": "2020-06-15T15:00:51Z", "message": "Add more information to log messages and log success after failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzQzNjI0", "url": "https://github.com/DataDog/dd-trace-java/pull/1590#pullrequestreview-430743624", "createdAt": "2020-06-15T15:15:35Z", "commit": {"oid": "353eba9379535d6ce46ff1001e04e4d8ee394f93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "353eba9379535d6ce46ff1001e04e4d8ee394f93", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/353eba9379535d6ce46ff1001e04e4d8ee394f93", "committedDate": "2020-06-15T15:00:51Z", "message": "Add more information to log messages and log success after failure"}, "afterCommit": {"oid": "75541cae06c0ad692af0cc39849ede5a73b49172", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/75541cae06c0ad692af0cc39849ede5a73b49172", "committedDate": "2020-06-15T15:36:07Z", "message": "Add more information to log messages and log success after failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "147a59d10064a134f6445f633789f172c005e97a", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/147a59d10064a134f6445f633789f172c005e97a", "committedDate": "2020-06-15T16:00:16Z", "message": "Increase agent timeout and try to open connection early"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f52f6b5106201a5f35115e22af7d32a14b14fe4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7f52f6b5106201a5f35115e22af7d32a14b14fe4", "committedDate": "2020-06-15T16:00:31Z", "message": "Add more information to log messages and log success after failure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75541cae06c0ad692af0cc39849ede5a73b49172", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/75541cae06c0ad692af0cc39849ede5a73b49172", "committedDate": "2020-06-15T15:36:07Z", "message": "Add more information to log messages and log success after failure"}, "afterCommit": {"oid": "7f52f6b5106201a5f35115e22af7d32a14b14fe4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7f52f6b5106201a5f35115e22af7d32a14b14fe4", "committedDate": "2020-06-15T16:00:31Z", "message": "Add more information to log messages and log success after failure"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2170, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}