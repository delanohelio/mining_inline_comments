{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NTY5NjEz", "number": 1943, "title": "Add `peer.hostname` to database spans", "bodyText": "Adds peer.hostname to database spans, specifically JDBC.\nIn other instances, where hostname was immediately available, I also added it.  Many of the decorators (eg jedis) are generic on the wrong type, or generic on Object.  These can be fixed in another pull request.", "createdAt": "2020-10-01T21:59:16Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1943", "merged": true, "mergeCommit": {"oid": "d43425a63cac8346a31ca04d46154ece00e2ea95"}, "closed": true, "closedAt": "2020-10-02T16:46:27Z", "author": {"login": "randomanderson"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOYv1ugH2gAyNDk2NTY5NjEzOjFmMzQ5ODJjNmMxMjExNzA4NzBhMzA5NmU2Yzk2YTg0Zjg1ZjljNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOoSSQgFqTUwMTI2NTY0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1f34982c6c121170870a3096e6c96a84f85f9c5c", "committedDate": "2020-10-01T22:02:09Z", "message": "Add `peer.hostname` to database spans"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5dd77cb002bbc88486e6ea113eef5e31a0b67173", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5dd77cb002bbc88486e6ea113eef5e31a0b67173", "committedDate": "2020-10-01T21:47:00Z", "message": "Add `peer.hostname` to database spans"}, "afterCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1f34982c6c121170870a3096e6c96a84f85f9c5c", "committedDate": "2020-10-01T22:02:09Z", "message": "Add `peer.hostname` to database spans"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTY5Nzg0", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#pullrequestreview-500969784", "createdAt": "2020-10-02T09:00:01Z", "commit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMDowMVrOHbmQ6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMDowMVrOHbmQ6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwMDUyMw==", "bodyText": "Use hostName instead of calling the method again.", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498700523", "createdAt": "2020-10-02T09:00:01Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -43,6 +45,11 @@ public AgentSpan onConnection(final AgentSpan span, final CONNECTION connection)\n       if (instanceName != null && Config.get().isDbClientSplitByInstance()) {\n         span.setTag(DDTags.SERVICE_NAME, instanceName);\n       }\n+\n+      String hostName = dbHostname(connection);\n+      if (hostName != null) {\n+        span.setTag(Tags.PEER_HOSTNAME, dbHostname(connection));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTcxNDg0", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#pullrequestreview-500971484", "createdAt": "2020-10-02T09:02:31Z", "commit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMjozMVrOHbmV8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMjozMVrOHbmV8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwMTgxMA==", "bodyText": "If this returned CharSequence there would be the option not to use String and use something we can serialise faster.", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498701810", "createdAt": "2020-10-02T09:02:31Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -26,6 +26,8 @@\n \n   protected abstract String dbInstance(CONNECTION connection);\n \n+  protected abstract String dbHostname(CONNECTION connection);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTUyMzI0", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#pullrequestreview-501152324", "createdAt": "2020-10-02T13:49:51Z", "commit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTU0MDI0", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#pullrequestreview-501154024", "createdAt": "2020-10-02T13:51:53Z", "commit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzo1MTo1M1rOHbueBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzo1MTo1M1rOHbueBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgzNDk0OA==", "bodyText": "I wonder if this should be brought up to the ClientDecorator.  Wouldn't this make sense for all clients?  (Maybe not necessary since http clients provide the full URL)", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498834948", "createdAt": "2020-10-02T13:51:53Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -26,6 +26,8 @@\n \n   protected abstract String dbInstance(CONNECTION connection);\n \n+  protected abstract String dbHostname(CONNECTION connection);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c209306af017747e7bc6da31b9b60ee9c82b56d7", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c209306af017747e7bc6da31b9b60ee9c82b56d7", "committedDate": "2020-10-02T15:39:49Z", "message": "Review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjY1NjQ2", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#pullrequestreview-501265646", "createdAt": "2020-10-02T16:08:21Z", "commit": {"oid": "c209306af017747e7bc6da31b9b60ee9c82b56d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3193, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}