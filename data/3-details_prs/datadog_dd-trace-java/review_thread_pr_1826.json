{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MDE4ODE3", "number": 1826, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMDozNVrOEgQhvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODoxMzo0NlrOEge36g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjYwNjcwOnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMDozNVrOHNBRFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMDozNVrOHNBRFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQxNDI5Mg==", "bodyText": "Not a big thing, but could you call config.getMergedSpanTags() only once? It actually creates a new Map and merge the tags every time it's called.", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#discussion_r483414292", "createdAt": "2020-09-04T06:30:35Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -568,16 +569,27 @@ private static StatsDClient createStatsDClient(final Config config) {\n         port = config.getJmxFetchStatsdPort();\n       }\n \n-      final String[] constantTags =\n-          new String[] {\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"),\n-            statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION),\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME),\n-            statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR),\n-            statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION)\n-          };\n+      final List<String> constantTags = new ArrayList<>();\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"));\n+      constantTags.add(statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION));\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME));\n+      constantTags.add(\n+          statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR));\n+      constantTags.add(statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION));\n+      constantTags.add(statsdTag(\"service\", config.getServiceName()));\n+\n+      final String version = config.getMergedSpanTags().get(GeneralConfig.VERSION);\n+      if (version != null && !version.isEmpty()) {\n+        constantTags.add(statsdTag(\"version\", version));\n+      }\n+\n+      final String env = config.getMergedSpanTags().get(GeneralConfig.ENV);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "507331e76073651d93d74cb10d7980123df01a47"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjYwODk1OnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMToyOVrOHNBSbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMToyOVrOHNBSbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQxNDYzNg==", "bodyText": "Is this version supposed to be env?", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#discussion_r483414636", "createdAt": "2020-09-04T06:31:29Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -568,16 +569,27 @@ private static StatsDClient createStatsDClient(final Config config) {\n         port = config.getJmxFetchStatsdPort();\n       }\n \n-      final String[] constantTags =\n-          new String[] {\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"),\n-            statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION),\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME),\n-            statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR),\n-            statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION)\n-          };\n+      final List<String> constantTags = new ArrayList<>();\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"));\n+      constantTags.add(statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION));\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME));\n+      constantTags.add(\n+          statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR));\n+      constantTags.add(statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION));\n+      constantTags.add(statsdTag(\"service\", config.getServiceName()));\n+\n+      final String version = config.getMergedSpanTags().get(GeneralConfig.VERSION);\n+      if (version != null && !version.isEmpty()) {\n+        constantTags.add(statsdTag(\"version\", version));\n+      }\n+\n+      final String env = config.getMergedSpanTags().get(GeneralConfig.ENV);\n+      if (version != null && !version.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "507331e76073651d93d74cb10d7980123df01a47"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNDk1NzIyOnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/test/groovy/datadog/trace/core/CoreTracerTest.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODoxMzo0NlrOHNXkiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODoxMzo0NlrOHNXkiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc3OTcyMA==", "bodyText": "nice", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#discussion_r483779720", "createdAt": "2020-09-04T18:13:46Z", "author": {"login": "richardstartin"}, "path": "dd-trace-core/src/test/groovy/datadog/trace/core/CoreTracerTest.groovy", "diffHunk": "@@ -64,6 +67,62 @@ class CoreTracerTest extends DDSpecification {\n     tracer.statsDClient instanceof NonBlockingStatsDClient\n   }\n \n+  def \"verify service, env, and version are added as stats tags\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da570dda18303e3a21c21f716ac96c8f818330ce"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4923, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}