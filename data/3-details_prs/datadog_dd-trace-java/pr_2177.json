{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MjM3NjYw", "number": 2177, "title": "capture top level status", "bodyText": "This prevents the trace agent from needing to detect the same property of spans when it is configured to compute metrics, which is a costly operation.\nTop level does not have the same definition as local root. It means that the span's service name differs from its parents.", "createdAt": "2020-12-09T14:55:08Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2177", "merged": true, "mergeCommit": {"oid": "3e2745819d5759577b3a7fcbbe14b206775b9714"}, "closed": true, "closedAt": "2020-12-09T18:13:06Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkgMO9AH2gAyNTM1MjM3NjYwOmRiMWM4ZDZhY2FhODQ4MzQwZDI0YzAzNmVlZWY5Y2QwY2UzMjE4YTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkiNGBgBqjQwOTExMjMzNDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "db1c8d6acaa848340d24c036eeef9cd0ce3218a6", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/db1c8d6acaa848340d24c036eeef9cd0ce3218a6", "committedDate": "2020-12-09T15:08:50Z", "message": "capture top level status"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4d66f160301953dad0452b74ff7c635568fc0b7", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e4d66f160301953dad0452b74ff7c635568fc0b7", "committedDate": "2020-12-09T14:54:40Z", "message": "capture top level status"}, "afterCommit": {"oid": "10e960eaa40a2dd1e633279f5f1b0796d28bd6d0", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/10e960eaa40a2dd1e633279f5f1b0796d28bd6d0", "committedDate": "2020-12-09T15:08:50Z", "message": "track metrics on top level spans"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzIzNzY0", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#pullrequestreview-548323764", "createdAt": "2020-12-09T15:48:28Z", "commit": {"oid": "10e960eaa40a2dd1e633279f5f1b0796d28bd6d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTo0ODoyOFrOICbm7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTo0ODoyOFrOICbm7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQyMDM5Ng==", "bodyText": "I assume \"top level\" means that the resulting service name is different from the parent?\nI think that is something that might warrant clarification otherwise it might be confused with \"local root\".", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#discussion_r539420396", "createdAt": "2020-12-09T15:48:28Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreSpan.java", "diffHunk": "@@ -55,6 +55,8 @@\n \n   boolean isMeasured();\n \n+  boolean isTopLevel();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10e960eaa40a2dd1e633279f5f1b0796d28bd6d0"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "581c814d564e7fffbdaef30928295ae02533970c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/581c814d564e7fffbdaef30928295ae02533970c", "committedDate": "2020-12-09T16:00:03Z", "message": "send top level status to agent"}, "afterCommit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3334433cd13ae165eb98f22fd4edaf2b905a9d25", "committedDate": "2020-12-09T16:22:59Z", "message": "send top level status to agent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzYxMzM0", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#pullrequestreview-548361334", "createdAt": "2020-12-09T16:23:58Z", "commit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzY4NDIw", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#pullrequestreview-548368420", "createdAt": "2020-12-09T16:30:40Z", "commit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzgzMzYw", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#pullrequestreview-548383360", "createdAt": "2020-12-09T16:45:33Z", "commit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0NTozNFrOICek8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0NTozNFrOICek8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2OTA0MQ==", "bodyText": "High level understanding of last clause looks difficult to me. But seems like you covered all cases with tests: https://github.com/DataDog/dd-trace-java/pull/2177/files#diff-c0f34fdf7aab5b82e441f40c6c5f1931cace8e6ea59d82d7831dd575c4eb18a9R459 :)", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#discussion_r539469041", "createdAt": "2020-12-09T16:45:34Z", "author": {"login": "lpriima"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java", "diffHunk": "@@ -215,6 +222,16 @@ public void setMeasured(boolean measured) {\n     }\n   }\n \n+  public boolean isTopLevel() {\n+    return topLevel;\n+  }\n+\n+  private static boolean isTopLevel(CharSequence parentServiceName, String serviceName) {\n+    return parentServiceName == null\n+        || parentServiceName.length() == 0\n+        || !serviceName.equals(parentServiceName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Mzg5OTM5", "url": "https://github.com/DataDog/dd-trace-java/pull/2177#pullrequestreview-548389939", "createdAt": "2020-12-09T16:52:18Z", "commit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b6c510b75a191f2f718c8c907fc49ca8b413d8f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1b6c510b75a191f2f718c8c907fc49ca8b413d8f", "committedDate": "2020-12-09T17:29:27Z", "message": "track metrics on top level spans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14b5d42bfc19a45a3df4e9553fb7f750f683155c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/14b5d42bfc19a45a3df4e9553fb7f750f683155c", "committedDate": "2020-12-09T17:29:27Z", "message": "send top level status to agent"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3334433cd13ae165eb98f22fd4edaf2b905a9d25", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3334433cd13ae165eb98f22fd4edaf2b905a9d25", "committedDate": "2020-12-09T16:22:59Z", "message": "send top level status to agent"}, "afterCommit": {"oid": "14b5d42bfc19a45a3df4e9553fb7f750f683155c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/14b5d42bfc19a45a3df4e9553fb7f750f683155c", "committedDate": "2020-12-09T17:29:27Z", "message": "send top level status to agent"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2720, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}