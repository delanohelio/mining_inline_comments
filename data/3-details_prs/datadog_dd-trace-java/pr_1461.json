{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3OTU4ODU2", "number": 1461, "title": "JMX StackTrace provider", "bodyText": "provides a safe way to access stacktraces through JMX getThreadInfo\ncall", "createdAt": "2020-05-14T12:20:23Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1461", "merged": true, "mergeCommit": {"oid": "aa2562b454ca87b92616caf8331f1d3f4e25e290"}, "closed": true, "closedAt": "2020-05-15T19:07:02Z", "author": {"login": "jpbempel"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchO7UpgFqTQxMTkwMzAxOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchmVhagFqTQxMjg3Mjc3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExOTAzMDE4", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#pullrequestreview-411903018", "createdAt": "2020-05-14T15:09:02Z", "commit": {"oid": "5be1b2390e5a1bc73913c49a3bc873812ae845cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTowOTowM1rOGVg4AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTowOTowM1rOGVg4AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIxMTkwNA==", "bodyText": "Coul you please explain why it mutates parameter instead of just returning a new list?", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#discussion_r425211904", "createdAt": "2020-05-14T15:09:03Z", "author": {"login": "mar-kolya"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/util/ThreadStackProvider.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package datadog.trace.core.util;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+public interface ThreadStackProvider {\n+  void getStackTrace(Set<Long> threadIds, List<StackTraceElement[]> stackTraces);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5be1b2390e5a1bc73913c49a3bc873812ae845cd"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExOTAzNzE3", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#pullrequestreview-411903717", "createdAt": "2020-05-14T15:09:41Z", "commit": {"oid": "5be1b2390e5a1bc73913c49a3bc873812ae845cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTowOTo0MlrOGVg6BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTowOTo0MlrOGVg6BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIxMjQyMA==", "bodyText": "Why to just use toArray?", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#discussion_r425212420", "createdAt": "2020-05-14T15:09:42Z", "author": {"login": "mar-kolya"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/util/JmxThreadStackProvider.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package datadog.trace.core.util;\n+\n+import java.lang.management.ManagementFactory;\n+import java.lang.management.ThreadInfo;\n+import java.lang.management.ThreadMXBean;\n+import java.util.List;\n+import java.util.Set;\n+\n+public class JmxThreadStackProvider implements ThreadStackProvider {\n+  private final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();\n+\n+  public static final ThreadStackProvider INSTANCE = new JmxThreadStackProvider();\n+\n+  @Override\n+  public void getStackTrace(Set<Long> threadIds, List<StackTraceElement[]> stackTraces) {\n+    long[] ids = new long[threadIds.size()];\n+    int idx = 0;\n+    for (Long id : threadIds) {\n+      ids[idx] = id;\n+      idx++;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5be1b2390e5a1bc73913c49a3bc873812ae845cd"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExOTA1Mzk2", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#pullrequestreview-411905396", "createdAt": "2020-05-14T15:11:25Z", "commit": {"oid": "5be1b2390e5a1bc73913c49a3bc873812ae845cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNToxMToyNVrOGVg_OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNToxMToyNVrOGVg_OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIxMzc1Mg==", "bodyText": "FWIW: if you didn't have this static instance the whole class could be GCed once real thing is loaded...", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#discussion_r425213752", "createdAt": "2020-05-14T15:11:25Z", "author": {"login": "mar-kolya"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/util/NoneThreadStackProvider.java", "diffHunk": "@@ -0,0 +1,12 @@\n+package datadog.trace.core.util;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+public class NoneThreadStackProvider implements ThreadStackProvider {\n+\n+  public static final ThreadStackProvider INSTANCE = new NoneThreadStackProvider();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5be1b2390e5a1bc73913c49a3bc873812ae845cd"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDcwNzI5", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#pullrequestreview-412470729", "createdAt": "2020-05-15T09:01:15Z", "commit": {"oid": "94f81182900741c55a27989264581a721de87951"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODQ5MzI1", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#pullrequestreview-412849325", "createdAt": "2020-05-15T17:48:41Z", "commit": {"oid": "94f81182900741c55a27989264581a721de87951"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNzo0ODo0MVrOGWOUhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNzo0ODo0MVrOGWOUhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk1NjQ4NQ==", "bodyText": "I have a concern about this API . We can have 2 different Sets with all same elements, but iteration order over these elements will be different.  As a result of this method, we can have a list with stack traces ordered in a different way for equal Sets. So, it requires user of this API strictly rely on iteration order of the set which we pass as an argument. Moreover, there is no guarantee, that iteration by one iterator will return the same order for another iterator for some instance of Set. It means even having the same instance of the Set, we won't necessarily be able to understand which stacktrace correspond to which thread ID.", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#discussion_r425956485", "createdAt": "2020-05-15T17:48:41Z", "author": {"login": "lpriima"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/util/ThreadStackProvider.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package datadog.trace.core.util;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+public interface ThreadStackProvider {\n+  List<StackTraceElement[]> getStackTrace(Set<Long> threadIds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94f81182900741c55a27989264581a721de87951"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6b1fbd8aa45729d832bf14c48ef935fd896f213", "author": {"user": {"login": "jpbempel", "name": "Jean-Philippe Bempel"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a6b1fbd8aa45729d832bf14c48ef935fd896f213", "committedDate": "2020-05-15T17:55:55Z", "message": "JMX StackTrace provider\n\nprovides a safe way to access stacktraces through JMX getThreadInfo\ncall"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dbb380ce165e7541cf0091a7c33844427893f17", "author": {"user": {"login": "jpbempel", "name": "Jean-Philippe Bempel"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9dbb380ce165e7541cf0091a7c33844427893f17", "committedDate": "2020-05-15T17:55:55Z", "message": "remove static None instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c58596a39e41ab7732882cb3833cd31542376703", "author": {"user": {"login": "jpbempel", "name": "Jean-Philippe Bempel"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c58596a39e41ab7732882cb3833cd31542376703", "committedDate": "2020-05-15T17:55:55Z", "message": "Change provider signature\n\nadd test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d983c2e392d583d811a84ddc012bc210d4d50bf2", "author": {"user": {"login": "jpbempel", "name": "Jean-Philippe Bempel"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d983c2e392d583d811a84ddc012bc210d4d50bf2", "committedDate": "2020-05-15T18:01:58Z", "message": "Change Set to list"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94f81182900741c55a27989264581a721de87951", "author": {"user": {"login": "jpbempel", "name": "Jean-Philippe Bempel"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/94f81182900741c55a27989264581a721de87951", "committedDate": "2020-05-15T08:34:12Z", "message": "Change provider signature\n\nadd test"}, "afterCommit": {"oid": "d983c2e392d583d811a84ddc012bc210d4d50bf2", "author": {"user": {"login": "jpbempel", "name": "Jean-Philippe Bempel"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d983c2e392d583d811a84ddc012bc210d4d50bf2", "committedDate": "2020-05-15T18:01:58Z", "message": "Change Set to list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODcyNzc1", "url": "https://github.com/DataDog/dd-trace-java/pull/1461#pullrequestreview-412872775", "createdAt": "2020-05-15T18:25:29Z", "commit": {"oid": "d983c2e392d583d811a84ddc012bc210d4d50bf2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2500, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}