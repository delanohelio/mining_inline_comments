{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMjE2MjA4", "number": 1421, "title": "Do not stop profiling on fatal exceptions", "bodyText": "Make sure that profiling continues to run even after fatal exceptions in its loop - e.g. OutOfMemoryError", "createdAt": "2020-05-01T17:13:55Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1421", "merged": true, "mergeCommit": {"oid": "b3782fa6040afabef6a3d6ea4e94a776c9a2be0f"}, "closed": true, "closedAt": "2020-05-04T12:03:05Z", "author": {"login": "mar-kolya"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdE6HXgH2gAyNDEyMjE2MjA4OjAxNGNiOTJkYzdhYjc0NTg2OWJkMjEwNGIwZWMwNzdlZWQ4ZGRhMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd9itAAFqTQwNDg5MzY4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "014cb92dc7ab745869bd2104b0ec077eed8dda02", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/014cb92dc7ab745869bd2104b0ec077eed8dda02", "committedDate": "2020-05-01T17:12:59Z", "message": "Do not stop profiling on fatal exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0Nzg4NjI0", "url": "https://github.com/DataDog/dd-trace-java/pull/1421#pullrequestreview-404788624", "createdAt": "2020-05-04T08:22:18Z", "commit": {"oid": "014cb92dc7ab745869bd2104b0ec077eed8dda02"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODE5NTY1", "url": "https://github.com/DataDog/dd-trace-java/pull/1421#pullrequestreview-404819565", "createdAt": "2020-05-04T09:10:02Z", "commit": {"oid": "014cb92dc7ab745869bd2104b0ec077eed8dda02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwOToxMDowMlrOGP4QpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwOToxMDowMlrOGP4QpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwMzU4OQ==", "bodyText": "For OOME usually it is not really good to try and and log exception - the memory is stretched already and the logging statement can throw its own OOME and propagate the exception we are trying to mask to the caller.\nI would suggest handling OOME differently and just silently ignore it.", "url": "https://github.com/DataDog/dd-trace-java/pull/1421#discussion_r419303589", "createdAt": "2020-05-04T09:10:02Z", "author": {"login": "jbachorik"}, "path": "dd-java-agent/agent-profiling/profiling-controller/src/main/java/com/datadog/profiling/controller/ProfilingSystem.java", "diffHunk": "@@ -199,8 +199,13 @@ public void run() {\n       } catch (final Exception e) {\n         log.error(\"Exception in profiling thread, continuing\", e);\n       } catch (final Throwable t) {\n-        log.error(\"Fatal exception in profiling thread, exiting\", t);\n-        throw t;\n+        /*\n+        Try to continue even after fatal exception. It seems to be useful to attempt to store profile when this happens.\n+        For example JVM maybe out of heap and throwing OutOfMemoryError - we probably still would want to continue and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "014cb92dc7ab745869bd2104b0ec077eed8dda02"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3295f19e27e98e9f809545475db47895fce487f8", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/3295f19e27e98e9f809545475db47895fce487f8", "committedDate": "2020-05-04T11:10:19Z", "message": "Catch and ignore exceptions in logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODkzNjg0", "url": "https://github.com/DataDog/dd-trace-java/pull/1421#pullrequestreview-404893684", "createdAt": "2020-05-04T11:12:00Z", "commit": {"oid": "3295f19e27e98e9f809545475db47895fce487f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2456, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}