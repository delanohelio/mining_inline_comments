{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNjE4NzE2", "number": 1273, "title": "Add an option to force profiling right in the beginning of premain", "bodyText": "Currently this blows up JVMs before 14", "createdAt": "2020-02-28T22:11:22Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1273", "merged": true, "mergeCommit": {"oid": "5b4c7f8c92fa1d74e3405bfb2480c59a0219aa0b"}, "closed": true, "closedAt": "2020-03-02T21:18:05Z", "author": {"login": "mar-kolya"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI4PDSABqjMwODM4MjQ2Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJztU2AH2gAyMzgxNjE4NzE2OmQ0NmEzYmUxMjM2ODU1NWNhZmNjMDIzYjFmMmM2NjI4MzQ4OTYyNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9d4871e382893a59d0b6bf23c6ecf7bf8da148e", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b9d4871e382893a59d0b6bf23c6ecf7bf8da148e", "committedDate": "2020-02-28T22:10:30Z", "message": "Add an option to force profiling right in the beginning of premain\n\nCurrently this blows up JVMs before 14"}, "afterCommit": {"oid": "0a4b5236ba8cfaf5ccaef3bbc9c5cb60c6bd85a0", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0a4b5236ba8cfaf5ccaef3bbc9c5cb60c6bd85a0", "committedDate": "2020-02-28T23:08:10Z", "message": "Add an option to force profiling right in the beginning of premain\n\nCurrently this blows up JVMs before 14"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2c33f0ace768a0d0a5eee61f7a104cc493879602", "committedDate": "2020-02-28T23:36:50Z", "message": "Add an option to force profiling right in the beginning of premain\n\nCurrently this blows up JVMs before 14"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a4b5236ba8cfaf5ccaef3bbc9c5cb60c6bd85a0", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0a4b5236ba8cfaf5ccaef3bbc9c5cb60c6bd85a0", "committedDate": "2020-02-28T23:08:10Z", "message": "Add an option to force profiling right in the beginning of premain\n\nCurrently this blows up JVMs before 14"}, "afterCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2c33f0ace768a0d0a5eee61f7a104cc493879602", "committedDate": "2020-02-28T23:36:50Z", "message": "Add an option to force profiling right in the beginning of premain\n\nCurrently this blows up JVMs before 14"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDU2Mzg4", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#pullrequestreview-367056388", "createdAt": "2020-03-02T09:35:42Z", "commit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MzYxMjEw", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#pullrequestreview-367361210", "createdAt": "2020-03-02T16:55:08Z", "commit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1NTowOFrOFwnOqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjo1ODoxOFrOFwnWxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUxODY5OQ==", "bodyText": "Please add some comments here why this is ok to initialize \"first\" then retry again later.", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386518699", "createdAt": "2020-03-02T16:55:08Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -46,6 +46,9 @@\n \n   public static void start(final Instrumentation inst, final URL bootstrapURL) {\n     createParentClassloader(bootstrapURL);\n+\n+    startProfilingAgent(bootstrapURL, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUyMDI4NQ==", "bodyText": "early isn't very descriptive... maybe isBeforeTracing?", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386520285", "createdAt": "2020-03-02T16:57:33Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -275,29 +278,29 @@ private static synchronized void startJmxFetch(final URL bootstrapURL) {\n     }\n   }\n \n-  private static synchronized void startProfilingAgent(final URL bootstrapURL) {\n-    if (PROFILING_CLASSLOADER == null) {\n-      final ClassLoader contextLoader = Thread.currentThread().getContextClassLoader();\n-      try {\n-        final ClassLoader profilingClassLoader =\n+  private static synchronized void startProfilingAgent(\n+      final URL bootstrapURL, final boolean early) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUyMDc3NA==", "bodyText": "perhaps startProfilingBeforeTracing?", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386520774", "createdAt": "2020-03-02T16:58:18Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-profiling/profiling-controller/src/main/java/com/datadog/profiling/controller/ProfilingSystem.java", "diffHunk": "@@ -38,6 +38,7 @@\n \n   private final Duration startupDelay;\n   private final Duration uploadPeriod;\n+  private final boolean forceEarly;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c33f0ace768a0d0a5eee61f7a104cc493879602"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ff723e19171ebaa7522e2d5b6aadc1b3014953a", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6ff723e19171ebaa7522e2d5b6aadc1b3014953a", "committedDate": "2020-03-02T17:25:20Z", "message": "CR changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDkyODgz", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#pullrequestreview-367492883", "createdAt": "2020-03-02T20:10:30Z", "commit": {"oid": "6ff723e19171ebaa7522e2d5b6aadc1b3014953a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxMDozMFrOFwtmVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxMDozMFrOFwtmVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMzA2MQ==", "bodyText": "debug?", "url": "https://github.com/DataDog/dd-trace-java/pull/1273#discussion_r386623061", "createdAt": "2020-03-02T20:10:30Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-profiling/src/main/java/com/datadog/profiling/agent/ProfilingAgent.java", "diffHunk": "@@ -19,13 +19,14 @@\n \n   /**\n    * Main entry point into profiling Note: this must be reentrant because we may want to start\n-   * profiling early, and then attempt to start it again at normal time\n+   * profiling before any other tool, and then attempt to start it again at normal time\n    */\n-  public static synchronized void run(final boolean early) throws IllegalArgumentException {\n+  public static synchronized void run(final boolean isStartingFirst)\n+      throws IllegalArgumentException {\n     if (PROFILER == null) {\n       final Config config = Config.get();\n-      if (early && !config.isProfilingStartForceEarly()) {\n-        log.info(\"Profiling: not starting early\");\n+      if (isStartingFirst && !config.isProfilingStartForceFirst()) {\n+        log.info(\"Profiling: not starting first\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ff723e19171ebaa7522e2d5b6aadc1b3014953a"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d46a3be12368555cafcc023b1f2c662834896278", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d46a3be12368555cafcc023b1f2c662834896278", "committedDate": "2020-03-02T20:26:04Z", "message": "Reduce log verbocity"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2537, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}