{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MzkyOTA3", "number": 1816, "title": "Make agent connect timeout less aggressive", "bodyText": "Reported repeated failures to probe the agent endpoints because of too low connect timeout.", "createdAt": "2020-08-31T16:09:20Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1816", "merged": true, "mergeCommit": {"oid": "1e6dd5820c60457e9da8591c2bf220dca083493f"}, "closed": true, "closedAt": "2020-09-01T06:08:36Z", "author": {"login": "bantonsson"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEVGKOAH2gAyNDc2MzkyOTA3OjcxYjNkYTM1YWQ0N2I3MDEyMDc2YTRhODA2MGMzNzZlZGQ4MDkyNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEXuaxgFqTQ3ODg4MjUxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/71b3da35ad47b7012076a4a8060c376edd809261", "committedDate": "2020-08-31T16:07:40Z", "message": "Make agent connect timeout less aggressive"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NzQ5MjEx", "url": "https://github.com/DataDog/dd-trace-java/pull/1816#pullrequestreview-478749211", "createdAt": "2020-08-31T16:10:01Z", "commit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjoxMDowMlrOHJ_LRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjoxMDowMlrOHJ_LRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIzNDMwOQ==", "bodyText": "Actually use the timeout when trying to connect.", "url": "https://github.com/DataDog/dd-trace-java/pull/1816#discussion_r480234309", "createdAt": "2020-08-31T16:10:02Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/ddagent/DDAgentApi.java", "diffHunk": "@@ -397,16 +397,15 @@ String detectEndpointAndBuildClient() {\n     } else {\n       log.warn(\"No connectivity to datadog agent\");\n     }\n-    if (null == detectedVersion) {\n-      log.debug(\"Tried all of {}, no connectivity to datadog agent\", endpoints);\n+    if (null == detectedVersion && log.isDebugEnabled()) {\n+      log.debug(\"Tried all of {}, no connectivity to datadog agent\", Arrays.asList(endpoints));\n     }\n     return detectedVersion;\n   }\n \n-  private boolean isAgentRunning() {\n+  private boolean isAgentRunning(final long timeoutMillis) {\n     try (Socket socket = new Socket()) {\n-      socket.setSoTimeout(CONNECT_TIMEOUT_MS);\n-      socket.connect(new InetSocketAddress(host, port));\n+      socket.connect(new InetSocketAddress(host, port), (int) timeoutMillis);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NzUwNTg2", "url": "https://github.com/DataDog/dd-trace-java/pull/1816#pullrequestreview-478750586", "createdAt": "2020-08-31T16:11:58Z", "commit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjoxMTo1OVrOHJ_Pgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjoxMTo1OVrOHJ_Pgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIzNTM5NA==", "bodyText": "This only logged the first element of the endpoints array.", "url": "https://github.com/DataDog/dd-trace-java/pull/1816#discussion_r480235394", "createdAt": "2020-08-31T16:11:59Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/ddagent/DDAgentApi.java", "diffHunk": "@@ -397,16 +397,15 @@ String detectEndpointAndBuildClient() {\n     } else {\n       log.warn(\"No connectivity to datadog agent\");\n     }\n-    if (null == detectedVersion) {\n-      log.debug(\"Tried all of {}, no connectivity to datadog agent\", endpoints);\n+    if (null == detectedVersion && log.isDebugEnabled()) {\n+      log.debug(\"Tried all of {}, no connectivity to datadog agent\", Arrays.asList(endpoints));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODAzOTIx", "url": "https://github.com/DataDog/dd-trace-java/pull/1816#pullrequestreview-478803921", "createdAt": "2020-08-31T17:28:24Z", "commit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODgyNTEz", "url": "https://github.com/DataDog/dd-trace-java/pull/1816#pullrequestreview-478882513", "createdAt": "2020-08-31T19:11:27Z", "commit": {"oid": "71b3da35ad47b7012076a4a8060c376edd809261"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1986, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}