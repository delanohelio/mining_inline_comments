{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzOTM1NTQ1", "number": 2171, "title": "Extend DD_TRACE_METHODS to support wildcarded method argument", "bodyText": "PR to extend support of DD_TRACE_METHODS configuration to support wildcards in method calls\nEX: ClassName[*]", "createdAt": "2020-12-07T20:40:47Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2171", "merged": true, "mergeCommit": {"oid": "feed497dac660b26085ea534d4ab88237a2395d2"}, "closed": true, "closedAt": "2020-12-14T20:35:08Z", "author": {"login": "ziquanmiao"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj2oMxAH2gAyNTMzOTM1NTQ1OjJkOTU3MmNiNGEzYjZhNGExYTk0ZDQ1ZGI0NGVmZDllNGYyMjUwYzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmAmGDAFqTU1MTA5OTYxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d9572cb4a3b6a4a1a94d45db44efd9e4f2250c7", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/2d9572cb4a3b6a4a1a94d45db44efd9e4f2250c7", "committedDate": "2020-12-07T14:43:22Z", "message": "add support for wildcards in place of method names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b52bf35d59013908ce1965105ebe800445312071", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/b52bf35d59013908ce1965105ebe800445312071", "committedDate": "2020-12-07T15:19:45Z", "message": "update warning message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f4aa9692c1fc929143a8ddea9963f0a8c7f3fc8", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/9f4aa9692c1fc929143a8ddea9963f0a8c7f3fc8", "committedDate": "2020-12-07T20:38:05Z", "message": "update transformer to support wildcard method config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f92321762c017e1fb2e79fc518ca877941712c6e", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/f92321762c017e1fb2e79fc518ca877941712c6e", "committedDate": "2020-12-07T20:39:40Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2953126bca8da2546f5414b06dd1512a3fa2f2e8", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/2953126bca8da2546f5414b06dd1512a3fa2f2e8", "committedDate": "2020-12-07T22:34:25Z", "message": "add private method support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1b7c077f8a816332c0593bc51de89e414326ac4", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/e1b7c077f8a816332c0593bc51de89e414326ac4", "committedDate": "2020-12-08T22:39:26Z", "message": "fix instrumentation and add initial test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c36c63f4baff6c06722e77b94d0f90bcd5a9578", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/6c36c63f4baff6c06722e77b94d0f90bcd5a9578", "committedDate": "2020-12-09T03:04:12Z", "message": "add configtest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55b930ce5c66d9cdc192c91b18e8d9cf6b4efbb3", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/55b930ce5c66d9cdc192c91b18e8d9cf6b4efbb3", "committedDate": "2020-12-09T16:08:09Z", "message": "experiment with any()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Mzk1NTc3", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-548395577", "createdAt": "2020-12-09T16:57:55Z", "commit": {"oid": "6c36c63f4baff6c06722e77b94d0f90bcd5a9578"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo1Nzo1NVrOICfL4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo1Nzo1NVrOICfL4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ3OTAwOA==", "bodyText": "I think toString should also be included, along with getters and setters.", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#discussion_r539479008", "createdAt": "2020-12-09T16:57:55Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/trace-annotation/src/main/java/datadog/trace/instrumentation/trace_annotation/TraceConfigInstrumentation.java", "diffHunk": "@@ -147,7 +148,11 @@ public TracerClassInstrumentation(final String className, final Set<String> meth\n       ElementMatcher.Junction<MethodDescription> methodMatchers = null;\n       for (final String methodName : methodNames) {\n         if (methodMatchers == null) {\n-          methodMatchers = named(methodName);\n+          if (methodName.equals(\"*\")) {\n+            methodMatchers = not(isAbstract()).and(noneOf(\"hashCode\", \"equals\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c36c63f4baff6c06722e77b94d0f90bcd5a9578"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0400ec31b8510ff4f571ed0f18890f49b67963b", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/b0400ec31b8510ff4f571ed0f18890f49b67963b", "committedDate": "2020-12-09T19:48:16Z", "message": "modify element matchers and add initial tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e03d8d51303ad04feafb134a90f0536cf1a0beba", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/e03d8d51303ad04feafb134a90f0536cf1a0beba", "committedDate": "2020-12-09T21:05:04Z", "message": "add testing for interfaces and abstract classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa87428e2d64e715193a267b708f3e083c61411", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/4fa87428e2d64e715193a267b708f3e083c61411", "committedDate": "2020-12-09T22:29:53Z", "message": "accommodate codenarc tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/d05ba728d9b1eb9cab05b64952483b174817770c", "committedDate": "2020-12-10T00:32:54Z", "message": "codenarc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4ODIyNDk1", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-548822495", "createdAt": "2020-12-10T05:09:26Z", "commit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNTowOToyN1rOIC1yrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNTowOToyN1rOIC1yrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg0OTM5MQ==", "bodyText": "I thought spotless check should fail on star imports ...", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#discussion_r539849391", "createdAt": "2020-12-10T05:09:27Z", "author": {"login": "lpriima"}, "path": "dd-java-agent/instrumentation/trace-annotation/src/main/java/datadog/trace/instrumentation/trace_annotation/TraceConfigInstrumentation.java", "diffHunk": "@@ -2,7 +2,7 @@\n \n import static datadog.trace.agent.tooling.ClassLoaderMatcher.hasClassesNamed;\n import static datadog.trace.agent.tooling.bytebuddy.matcher.DDElementMatchers.safeHasSuperType;\n-import static net.bytebuddy.matcher.ElementMatchers.named;\n+import static net.bytebuddy.matcher.ElementMatchers.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDcxODk1", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-549071895", "createdAt": "2020-12-10T10:48:23Z", "commit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo0ODoyNFrOIDDD_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo0ODoyNFrOIDDD_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA2NjgxNA==", "bodyText": "This now accepts spaces in package/class names which doesn't sound right", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#discussion_r540066814", "createdAt": "2020-12-10T10:48:24Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/trace-annotation/src/main/java/datadog/trace/instrumentation/trace_annotation/TraceConfigInstrumentation.java", "diffHunk": "@@ -32,8 +32,9 @@\n @AutoService(Instrumenter.class)\n public class TraceConfigInstrumentation implements Instrumenter {\n \n-  static final String PACKAGE_CLASS_NAME_REGEX = \"[\\\\w.\\\\$]+\";\n-  private static final String METHOD_LIST_REGEX = \"\\\\s*(?:\\\\w+\\\\s*,)*\\\\s*(?:\\\\w+\\\\s*,?)\\\\s*\";\n+  static final String PACKAGE_CLASS_NAME_REGEX = \"[\\\\w .\\\\$]+\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDc2NTY5", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-549076569", "createdAt": "2020-12-10T10:54:18Z", "commit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo1NDoxOFrOIDDTsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo1NDoxOFrOIDDTsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA3MDgzNA==", "bodyText": "I'd also add isFinalizer because I've seen issues intercepting that in the past on other AOP systems", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#discussion_r540070834", "createdAt": "2020-12-10T10:54:18Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/trace-annotation/src/main/java/datadog/trace/instrumentation/trace_annotation/TraceConfigInstrumentation.java", "diffHunk": "@@ -147,7 +148,17 @@ public TracerClassInstrumentation(final String className, final Set<String> meth\n       ElementMatcher.Junction<MethodDescription> methodMatchers = null;\n       for (final String methodName : methodNames) {\n         if (methodMatchers == null) {\n-          methodMatchers = named(methodName);\n+          if (methodName.equals(\"*\")) {\n+            methodMatchers =\n+                not(\n+                    isHashCode()\n+                        .or(isEquals())\n+                        .or(isToString())\n+                        .or(isConstructor())\n+                        .or(isSynthetic()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec3295ee4e3ec265f79adf228de8f240359b00d1", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/ec3295ee4e3ec265f79adf228de8f240359b00d1", "committedDate": "2020-12-10T14:35:33Z", "message": "explicit imports, remove whitespace, add finalizer support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5Mjc0OTE5", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-549274919", "createdAt": "2020-12-10T14:52:39Z", "commit": {"oid": "ec3295ee4e3ec265f79adf228de8f240359b00d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7ed8609fb728047ed706e1ea31e2b89e44ecb22", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/b7ed8609fb728047ed706e1ea31e2b89e44ecb22", "committedDate": "2020-12-10T21:18:03Z", "message": "ignore getters and setters and update test for abstract classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8154b28be90bce063299bf52386aab50d2e3b0d7", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/8154b28be90bce063299bf52386aab50d2e3b0d7", "committedDate": "2020-12-10T22:47:14Z", "message": "accommodate interface tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4ODI5MzEy", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-548829312", "createdAt": "2020-12-10T05:28:43Z", "commit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNToyODo0M1rOIC2LQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNjowODo1OFrOIDqhUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1NTY4MA==", "bodyText": "Do getters suppose to be instrumented under '*' pattern or no ?", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#discussion_r539855680", "createdAt": "2020-12-10T05:28:43Z", "author": {"login": "lpriima"}, "path": "dd-java-agent/instrumentation/trace-annotation/src/test/groovy/TraceConfigTest.groovy", "diffHunk": "@@ -19,18 +19,135 @@ class TraceConfigTest extends AgentTestRunner {\n     }\n   }\n \n+  class ConfigTracedCallable2 implements Callable<String> {\n+    @Override\n+    String call() throws Exception {\n+      return call_helper()\n+    }\n+\n+    String call_helper() throws Exception {\n+      return \"Hello2!\"\n+    }\n+  }\n+\n+  interface Mammal {\n+    void setName(String newName)\n+    void setHeight(int newHeight)\n+  }\n+\n+  class Human implements Mammal {\n+    String name\n+    String height\n+\n+    void setName(String newName){\n+      name = newName\n+    }\n+    void setHeight(int newHeight){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcxMzI5OQ==", "bodyText": "and test that calls each of these method types and no span is created", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#discussion_r540713299", "createdAt": "2020-12-11T06:08:58Z", "author": {"login": "lpriima"}, "path": "dd-java-agent/instrumentation/trace-annotation/src/main/java/datadog/trace/instrumentation/trace_annotation/TraceConfigInstrumentation.java", "diffHunk": "@@ -147,7 +148,17 @@ public TracerClassInstrumentation(final String className, final Set<String> meth\n       ElementMatcher.Junction<MethodDescription> methodMatchers = null;\n       for (final String methodName : methodNames) {\n         if (methodMatchers == null) {\n-          methodMatchers = named(methodName);\n+          if (methodName.equals(\"*\")) {\n+            methodMatchers =\n+                not(\n+                    isHashCode()\n+                        .or(isEquals())\n+                        .or(isToString())\n+                        .or(isConstructor())\n+                        .or(isSynthetic()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA3MDgzNA=="}, "originalCommit": {"oid": "d05ba728d9b1eb9cab05b64952483b174817770c"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd8de9e3b842821099670c76eff811e7ac864fd1", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/dd8de9e3b842821099670c76eff811e7ac864fd1", "committedDate": "2020-12-11T16:27:59Z", "message": "add more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a34065a97293c18cddf3ccff60d7fe5cb4fc3a35", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/a34065a97293c18cddf3ccff60d7fe5cb4fc3a35", "committedDate": "2020-12-11T18:58:07Z", "message": "fix codenarc test failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjY1OTMw", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-550665930", "createdAt": "2020-12-12T00:41:36Z", "commit": {"oid": "a34065a97293c18cddf3ccff60d7fe5cb4fc3a35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDk5NjE1", "url": "https://github.com/DataDog/dd-trace-java/pull/2171#pullrequestreview-551099615", "createdAt": "2020-12-14T07:27:58Z", "commit": {"oid": "a34065a97293c18cddf3ccff60d7fe5cb4fc3a35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2709, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}