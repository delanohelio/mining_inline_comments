{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2Njc1MDkz", "number": 2116, "title": "Automatically inject missing serialVersionUIDs when field-injecting Serializables", "bodyText": "The generated serialVersionUID is based on the class shape before field-injection.\nSome performance numbers of the additional cost of generating missing serialVersionUIDs, all values in milliseconds:\n\n\n\nMin.\n1st Qu.\nMedian\nMean\n3rd Qu.\nMax.\n\n\n\n\n0.001167\n0.022716\n0.037376\n0.065079\n0.060000\n5.454832\n\n\n\n(captured by accumulating elapsed System.nanoTime() around the additional work for each serializable class)\nThis cost happens once per field-injected class.\nThis PR leaves the new feature off by default, but we could consider changing the default if this cost is acceptable.\nThe system property to turn on this feature is:\n-Ddd.trace.serialversionuid.field.injection=true\n\nit can also be enabled by environment variable:\nDD_TRACE_SERIALVERSIONUID_FIELD_INJECTION=true", "createdAt": "2020-11-24T18:26:55Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2116", "merged": true, "mergeCommit": {"oid": "e10ef28ccb5b678f860a20ed69e43eff661c0fcd"}, "closed": true, "closedAt": "2020-11-30T17:33:30Z", "author": {"login": "mcculls"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfuEYDABqjQwMzQyNjEwOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhiiO7AFqTU0MDc2MjU1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2121d416e07490188a355340886fa0fe459abab", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f2121d416e07490188a355340886fa0fe459abab", "committedDate": "2020-11-24T18:19:21Z", "message": "Automatically inject missing serialVersionUIDs when field-injecting Serializables.\nThe generated serialVersionUID is based on the class shape before field-injection."}, "afterCommit": {"oid": "71a8b687be2bbcc40e6d49db3e068a4f747d6b5e", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/71a8b687be2bbcc40e6d49db3e068a4f747d6b5e", "committedDate": "2020-11-24T18:29:00Z", "message": "Automatically inject missing serialVersionUIDs when field-injecting Serializables.\nThe generated serialVersionUID is based on the class shape before field-injection."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71a8b687be2bbcc40e6d49db3e068a4f747d6b5e", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/71a8b687be2bbcc40e6d49db3e068a4f747d6b5e", "committedDate": "2020-11-24T18:29:00Z", "message": "Automatically inject missing serialVersionUIDs when field-injecting Serializables.\nThe generated serialVersionUID is based on the class shape before field-injection."}, "afterCommit": {"oid": "7ccc2915f4451dbbc35dcc84fd9baab7cca15457", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7ccc2915f4451dbbc35dcc84fd9baab7cca15457", "committedDate": "2020-11-24T23:32:50Z", "message": "Automatically inject missing serialVersionUIDs when field-injecting Serializables.\nThe generated serialVersionUID is based on the class shape before field-injection."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ccc2915f4451dbbc35dcc84fd9baab7cca15457", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7ccc2915f4451dbbc35dcc84fd9baab7cca15457", "committedDate": "2020-11-24T23:32:50Z", "message": "Automatically inject missing serialVersionUIDs when field-injecting Serializables.\nThe generated serialVersionUID is based on the class shape before field-injection."}, "afterCommit": {"oid": "18b5443101cb671f3d502af45d32614471e87078", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/18b5443101cb671f3d502af45d32614471e87078", "committedDate": "2020-11-25T16:46:06Z", "message": "Turn off injection of missing serialVersionUids by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68baf2a68f978d0f2e1aebd5dec30a99463a6b0d", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/68baf2a68f978d0f2e1aebd5dec30a99463a6b0d", "committedDate": "2020-11-25T17:13:43Z", "message": "Automatically inject missing serialVersionUIDs when field-injecting Serializables.\nThe generated serialVersionUID is based on the class shape before field-injection."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f97b7e1eb0575eb8355ace873270c43df6a49f00", "committedDate": "2020-11-25T17:13:46Z", "message": "Turn off injection of missing serialVersionUids by default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18b5443101cb671f3d502af45d32614471e87078", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/18b5443101cb671f3d502af45d32614471e87078", "committedDate": "2020-11-25T16:46:06Z", "message": "Turn off injection of missing serialVersionUids by default"}, "afterCommit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f97b7e1eb0575eb8355ace873270c43df6a49f00", "committedDate": "2020-11-25T17:13:46Z", "message": "Turn off injection of missing serialVersionUids by default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NTQxNDkz", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#pullrequestreview-539541493", "createdAt": "2020-11-26T20:35:05Z", "commit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDozNTowNVrOH6m43A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDozNTowNVrOH6m43A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIxNjYwNA==", "bodyText": "Can you inject this flag instead and capture it from config as far up as possible please?", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#discussion_r531216604", "createdAt": "2020-11-26T20:35:05Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/context/FieldInjectionVisitor.java", "diffHunk": "@@ -82,6 +87,11 @@ public void visit(\n         final Set<String> set = new LinkedHashSet<>(Arrays.asList(interfaces));\n         set.add(INJECTED_FIELDS_MARKER_CLASS_NAME);\n         set.add(interfaceType.getInternalName());\n+        if (Config.get().isSerialVersionUIDFieldInjection()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NTQyMjY0", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#pullrequestreview-539542264", "createdAt": "2020-11-26T20:38:10Z", "commit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDozODoxMVrOH6m7ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDozODoxMVrOH6m7ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIxNzM0Nw==", "bodyText": "Don't we have a dependency on ASM with this class in it?", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#discussion_r531217347", "createdAt": "2020-11-26T20:38:11Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/context/asm/SerialVersionUIDAdder.java", "diffHunk": "@@ -0,0 +1,493 @@\n+// ASM: a very small and fast Java bytecode manipulation framework", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NTQyNjUw", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#pullrequestreview-539542650", "createdAt": "2020-11-26T20:39:44Z", "commit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDozOTo0NFrOH6m9UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDozOTo0NFrOH6m9UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIxNzc0NA==", "bodyText": "I know this is an existing pattern, but I'm struggling to see the benefit of it. Can't we just static import  TraceInstrumentationConfig.SERIALVERSIONUID_FIELD_INJECTION?", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#discussion_r531217744", "createdAt": "2020-11-26T20:39:44Z", "author": {"login": "richardstartin"}, "path": "internal-api/src/main/java/datadog/trace/api/Config.java", "diffHunk": "@@ -181,6 +182,8 @@\n   public static final String PARTIAL_FLUSH_MIN_SPANS = TracerConfig.PARTIAL_FLUSH_MIN_SPANS;\n   public static final String RUNTIME_CONTEXT_FIELD_INJECTION =\n       TraceInstrumentationConfig.RUNTIME_CONTEXT_FIELD_INJECTION;\n+  public static final String SERIALVERSIONUID_FIELD_INJECTION =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NzYxODYw", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#pullrequestreview-539761860", "createdAt": "2020-11-27T07:43:50Z", "commit": {"oid": "f97b7e1eb0575eb8355ace873270c43df6a49f00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "064fb09efe29b7acabf37ce5d6e251e7c385f0f0", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/064fb09efe29b7acabf37ce5d6e251e7c385f0f0", "committedDate": "2020-11-30T09:52:53Z", "message": "Capture serialVersionUIDFieldInjection flag when creating field-injection visitor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "399a72092398ec817e9e8833852fed41b1b9583f", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/399a72092398ec817e9e8833852fed41b1b9583f", "committedDate": "2020-11-30T09:55:46Z", "message": "DRY: prefer static import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNzYyNTU4", "url": "https://github.com/DataDog/dd-trace-java/pull/2116#pullrequestreview-540762558", "createdAt": "2020-11-30T10:10:54Z", "commit": {"oid": "399a72092398ec817e9e8833852fed41b1b9583f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2874, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}