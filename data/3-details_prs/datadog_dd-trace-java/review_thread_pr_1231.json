{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDExNjI4", "number": 1231, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMjoxMToxMlrODhPZFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjo1OTo1MFrODhmsTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTgxNzgwOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMjoxMToxMlrOFr5g5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMjoxMToxMlrOFr5g5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU3NTM5OA==", "bodyText": "This should be applied even if debug is not enabled, otherwise previously loaded classes won't be retransformed.", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#discussion_r381575398", "createdAt": "2020-02-19T22:11:12Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "diffHunk": "@@ -139,6 +136,14 @@ public static ResettableClassFileTransformer installBytebuddyAgent(\n             .or(isAnnotatedWith(named(\"javax.decorator.Decorator\")))\n             .or(matchesConfiguredExcludes());\n \n+    if (log.isDebugEnabled()) {\n+      agentBuilder =\n+          agentBuilder\n+              .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa546a444aa30b0dd619886ae744cb22c1412895"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTYzNTMzOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjo1OTo1MFrOFsbfIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODowODo0OVrOFsdvcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMjAwMA==", "bodyText": "You should remove this line from here now that it is back in the other builder", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#discussion_r382132000", "createdAt": "2020-02-20T16:59:50Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "diffHunk": "@@ -139,6 +137,14 @@ public static ResettableClassFileTransformer installBytebuddyAgent(\n             .or(isAnnotatedWith(named(\"javax.decorator.Decorator\")))\n             .or(matchesConfiguredExcludes());\n \n+    if (log.isDebugEnabled()) {\n+      agentBuilder =\n+          agentBuilder\n+              .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzODY0Mg==", "bodyText": "That line is required to add the RedefinitionLoggingListener because .with(new RedefinitionLoggingListener()) can only be applied to an instance of type RedefinitionListenable.  .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION) returns an instance of that type. I'm a bit confused as to why this is necessary though because the agentBuilder should already be of type RedefinitionListenable.", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#discussion_r382138642", "createdAt": "2020-02-20T17:11:40Z", "author": {"login": "heathkd"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "diffHunk": "@@ -139,6 +137,14 @@ public static ResettableClassFileTransformer installBytebuddyAgent(\n             .or(isAnnotatedWith(named(\"javax.decorator.Decorator\")))\n             .or(matchesConfiguredExcludes());\n \n+    if (log.isDebugEnabled()) {\n+      agentBuilder =\n+          agentBuilder\n+              .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMjAwMA=="}, "originalCommit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE2ODk0Nw==", "bodyText": "Got it, makes sense!\nI pulled the code up, its that the with method changes the return type depending on the input type, and RedefinitionListenable extends AgentBuilder which allows all the normal methods to work and adds on the ones you need.", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#discussion_r382168947", "createdAt": "2020-02-20T18:08:49Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "diffHunk": "@@ -139,6 +137,14 @@ public static ResettableClassFileTransformer installBytebuddyAgent(\n             .or(isAnnotatedWith(named(\"javax.decorator.Decorator\")))\n             .or(matchesConfiguredExcludes());\n \n+    if (log.isDebugEnabled()) {\n+      agentBuilder =\n+          agentBuilder\n+              .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMjAwMA=="}, "originalCommit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 522, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}