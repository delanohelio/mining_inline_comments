{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDM3NTE4", "number": 1200, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNjowOVrODdPaxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo0MDo0MFrODeCszA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTg3OTA5OnYy", "diffSide": "RIGHT", "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNjowOVrOFlus4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNzo0NDoyMlrOFmBEWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNjc4Ng==", "bodyText": "executorService.shutdownNow() ?", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r375106786", "createdAt": "2020-02-05T08:06:09Z", "author": {"login": "jpbempel"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));\n+    } catch (final IllegalStateException ex) {\n+      // The JVM is already shutting down.\n+    }\n+  }\n+\n+  public static ScheduledExecutorService taskScheduler() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE;\n+  }\n+\n+  public static ScheduledFuture<?> scheduleTaskAtFixedRate(\n+      final Runnable command, final long initialDelay, final long period, final TimeUnit unit) {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.scheduleAtFixedRate(command, initialDelay, period, unit);\n+  }\n+\n+  public static boolean isTaskSchedulerShutdown() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.isShutdown();\n+  }\n+\n+  private static final class ShutdownCallback extends Thread {\n+\n+    private final ScheduledExecutorService executorService;\n+\n+    private ShutdownCallback(final ScheduledExecutorService executorService) {\n+      super(\"dd-exec-shutdown-hook\");\n+      this.executorService = executorService;\n+    }\n+\n+    @Override\n+    public void run() {\n+      try {\n+        executorService.shutdown();\n+        executorService.awaitTermination(SHUTDOWN_WAIT_SECONDS, TimeUnit.SECONDS);\n+      } catch (final InterruptedException e) {\n+        // Don't bother waiting then...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08515857a7cfd9998975e2a7a2932d20e1f6dc76"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2ODU0NA==", "bodyText": "Originally it was shutdownNow but I changed it because I wasn't sure if that was overly harsh.  Do you think shutdownNow() is better?", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r375368544", "createdAt": "2020-02-05T16:34:28Z", "author": {"login": "tylerbenson"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));\n+    } catch (final IllegalStateException ex) {\n+      // The JVM is already shutting down.\n+    }\n+  }\n+\n+  public static ScheduledExecutorService taskScheduler() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE;\n+  }\n+\n+  public static ScheduledFuture<?> scheduleTaskAtFixedRate(\n+      final Runnable command, final long initialDelay, final long period, final TimeUnit unit) {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.scheduleAtFixedRate(command, initialDelay, period, unit);\n+  }\n+\n+  public static boolean isTaskSchedulerShutdown() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.isShutdown();\n+  }\n+\n+  private static final class ShutdownCallback extends Thread {\n+\n+    private final ScheduledExecutorService executorService;\n+\n+    private ShutdownCallback(final ScheduledExecutorService executorService) {\n+      super(\"dd-exec-shutdown-hook\");\n+      this.executorService = executorService;\n+    }\n+\n+    @Override\n+    public void run() {\n+      try {\n+        executorService.shutdown();\n+        executorService.awaitTermination(SHUTDOWN_WAIT_SECONDS, TimeUnit.SECONDS);\n+      } catch (final InterruptedException e) {\n+        // Don't bother waiting then...", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNjc4Ng=="}, "originalCommit": {"oid": "08515857a7cfd9998975e2a7a2932d20e1f6dc76"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2OTYyMA==", "bodyText": "I mean not replacing what you have with shutdown + awaitTermination but as a fallback in case of timeout (catch clause)", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r375369620", "createdAt": "2020-02-05T16:36:15Z", "author": {"login": "jpbempel"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));\n+    } catch (final IllegalStateException ex) {\n+      // The JVM is already shutting down.\n+    }\n+  }\n+\n+  public static ScheduledExecutorService taskScheduler() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE;\n+  }\n+\n+  public static ScheduledFuture<?> scheduleTaskAtFixedRate(\n+      final Runnable command, final long initialDelay, final long period, final TimeUnit unit) {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.scheduleAtFixedRate(command, initialDelay, period, unit);\n+  }\n+\n+  public static boolean isTaskSchedulerShutdown() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.isShutdown();\n+  }\n+\n+  private static final class ShutdownCallback extends Thread {\n+\n+    private final ScheduledExecutorService executorService;\n+\n+    private ShutdownCallback(final ScheduledExecutorService executorService) {\n+      super(\"dd-exec-shutdown-hook\");\n+      this.executorService = executorService;\n+    }\n+\n+    @Override\n+    public void run() {\n+      try {\n+        executorService.shutdown();\n+        executorService.awaitTermination(SHUTDOWN_WAIT_SECONDS, TimeUnit.SECONDS);\n+      } catch (final InterruptedException e) {\n+        // Don't bother waiting then...", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNjc4Ng=="}, "originalCommit": {"oid": "08515857a7cfd9998975e2a7a2932d20e1f6dc76"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNzcwNw==", "bodyText": "Ok, I understand now.  Thanks for the suggestion.", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r375407707", "createdAt": "2020-02-05T17:44:22Z", "author": {"login": "tylerbenson"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));\n+    } catch (final IllegalStateException ex) {\n+      // The JVM is already shutting down.\n+    }\n+  }\n+\n+  public static ScheduledExecutorService taskScheduler() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE;\n+  }\n+\n+  public static ScheduledFuture<?> scheduleTaskAtFixedRate(\n+      final Runnable command, final long initialDelay, final long period, final TimeUnit unit) {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.scheduleAtFixedRate(command, initialDelay, period, unit);\n+  }\n+\n+  public static boolean isTaskSchedulerShutdown() {\n+    return TASK_SCHEDULER_EXECUTOR_SERVICE.isShutdown();\n+  }\n+\n+  private static final class ShutdownCallback extends Thread {\n+\n+    private final ScheduledExecutorService executorService;\n+\n+    private ShutdownCallback(final ScheduledExecutorService executorService) {\n+      super(\"dd-exec-shutdown-hook\");\n+      this.executorService = executorService;\n+    }\n+\n+    @Override\n+    public void run() {\n+      try {\n+        executorService.shutdown();\n+        executorService.awaitTermination(SHUTDOWN_WAIT_SECONDS, TimeUnit.SECONDS);\n+      } catch (final InterruptedException e) {\n+        // Don't bother waiting then...", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNjc4Ng=="}, "originalCommit": {"oid": "08515857a7cfd9998975e2a7a2932d20e1f6dc76"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODI2ODkwOnYy", "diffSide": "RIGHT", "path": "dd-trace-ot/src/main/java/datadog/trace/common/writer/ddagent/TraceProcessingDisruptor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDozNzowNVrOFm_Aww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo0MDozNFrOFm_H3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyMjU5NQ==", "bodyText": "Without context as to what this is, this looks kind of weird.\nI get that it is the TRACE_PROCESSOR ThreadFactory, but without an affix on the variable name or the class qualifying the static access it still looks strange at first glance.", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r376422595", "createdAt": "2020-02-07T14:37:05Z", "author": {"login": "dougqh"}, "path": "dd-trace-ot/src/main/java/datadog/trace/common/writer/ddagent/TraceProcessingDisruptor.java", "diffHunk": "@@ -29,8 +30,8 @@ public TraceProcessingDisruptor(\n   }\n \n   @Override\n-  protected ThreadFactory getThreadFactory() {\n-    return new DaemonThreadFactory(\"dd-trace-processor\");\n+  protected DaemonThreadFactory getThreadFactory() {\n+    return TRACE_PROCESSOR;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNDQxMw==", "bodyText": "That's the beauty of import static isn't it? \ud83d\ude1b", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r376424413", "createdAt": "2020-02-07T14:40:34Z", "author": {"login": "jpbempel"}, "path": "dd-trace-ot/src/main/java/datadog/trace/common/writer/ddagent/TraceProcessingDisruptor.java", "diffHunk": "@@ -29,8 +30,8 @@ public TraceProcessingDisruptor(\n   }\n \n   @Override\n-  protected ThreadFactory getThreadFactory() {\n-    return new DaemonThreadFactory(\"dd-trace-processor\");\n+  protected DaemonThreadFactory getThreadFactory() {\n+    return TRACE_PROCESSOR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyMjU5NQ=="}, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODI3MDgwOnYy", "diffSide": "RIGHT", "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDozNzo0MFrOFm_B4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDozNzo0MFrOFm_B4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyMjg4MQ==", "bodyText": "Logging?", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r376422881", "createdAt": "2020-02-07T14:37:40Z", "author": {"login": "dougqh"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));\n+    } catch (final IllegalStateException ex) {\n+      // The JVM is already shutting down.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODI3Njc0OnYy", "diffSide": "RIGHT", "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDozOToxOVrOFm_FXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDozOToxOVrOFm_FXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyMzc3NQ==", "bodyText": "I'd personally prefer a singleton object without the static wrapper methods, but I'll leave it to the group to decide.", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r376423775", "createdAt": "2020-02-07T14:39:19Z", "author": {"login": "dougqh"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));\n+    } catch (final IllegalStateException ex) {\n+      // The JVM is already shutting down.\n+    }\n+  }\n+\n+  public static ScheduledExecutorService taskScheduler() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODI4MTA4OnYy", "diffSide": "RIGHT", "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo0MDo0MFrOFm_IGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzozODoxMFrOFnvOdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNDQ3NQ==", "bodyText": "At some point, we should revisit whether we really need the shutdown hooks.\nThey aren't guaranteed to work and they cause problems with SecurityManagers.\nBut this PR is probably not the right place to make such a change.", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r376424475", "createdAt": "2020-02-07T14:40:40Z", "author": {"login": "dougqh"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNjk2NA==", "bodyText": "+1 shutdown hooks are most of the time useless, as they guarantee nothing, eventually they may close some resources, but destruction of the process will close those resources, at OS level anyway.", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r376426964", "createdAt": "2020-02-07T14:45:07Z", "author": {"login": "jpbempel"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNDQ3NQ=="}, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMDA5OQ==", "bodyText": "I don't have a deep understanding of them, so I would tend to defer to you.", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r377200099", "createdAt": "2020-02-10T17:14:46Z", "author": {"login": "tylerbenson"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNDQ3NQ=="}, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwOTU5MA==", "bodyText": "just 2 cents: I think part of the reason we have these is to actually give process a chance to flush traces - i.e. to prevent premature shutdown, not to close resources properly... I'm not sure if that still works this way - but that would have been my reasoning for using shutdown hooks", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r377209590", "createdAt": "2020-02-10T17:32:21Z", "author": {"login": "mar-kolya"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNDQ3NQ=="}, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIxMjUzMg==", "bodyText": "Yes makes sense here, but still no guarantees, it's best effort :)", "url": "https://github.com/DataDog/dd-trace-java/pull/1200#discussion_r377212532", "createdAt": "2020-02-10T17:38:10Z", "author": {"login": "jpbempel"}, "path": "utils/thread-utils/src/main/java/datadog/common/exec/SharedExecutors.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package datadog.common.exec;\n+\n+import static datadog.common.exec.DaemonThreadFactory.TASK_SCHEDULER;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class SharedExecutors {\n+  private static final long SHUTDOWN_WAIT_SECONDS = 5;\n+\n+  private static final ScheduledExecutorService TASK_SCHEDULER_EXECUTOR_SERVICE =\n+      Executors.newSingleThreadScheduledExecutor(TASK_SCHEDULER);\n+\n+  static {\n+    try {\n+      Runtime.getRuntime().addShutdownHook(new ShutdownCallback(TASK_SCHEDULER_EXECUTOR_SERVICE));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQyNDQ3NQ=="}, "originalCommit": {"oid": "1c6e3e685a6ecfd4b4b91ebb4e07e62386f350cf"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 498, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}