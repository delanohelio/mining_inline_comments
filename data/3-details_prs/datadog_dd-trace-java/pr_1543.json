{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTQ3OTYw", "number": 1543, "title": "Send data to trace agent when no API key is given", "bodyText": "", "createdAt": "2020-06-04T16:17:14Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1543", "merged": true, "mergeCommit": {"oid": "9e19a57bd099c11b750182bc90805d6b0b17b78c"}, "closed": true, "closedAt": "2020-06-11T16:46:51Z", "author": {"login": "cimi"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoBX50AFqTQyNDY2NTI5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqRGNOAFqTQyOTA5ODM2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjY1Mjky", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-424665292", "createdAt": "2020-06-04T17:19:04Z", "commit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoxOTowNFrOGfQACw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoxOTowNFrOGfQACw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyMTE5NQ==", "bodyText": "Thanks for fixing all the typos! :)", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r435421195", "createdAt": "2020-06-04T17:19:04Z", "author": {"login": "mar-kolya"}, "path": "dd-java-agent/agent-profiling/profiling-uploader/src/main/java/com/datadog/profiling/uploader/ProfileUploader.java", "diffHunk": "@@ -128,7 +128,7 @@ public ProfileUploader(final Config config) {\n     * PID (see PidHelper for details),\n     * Profiler version\n     Since Config returns unmodifiable map we have to do copy here.\n-    Ideally we should improve this logic and avoid copy, but performace impact is very limtied\n+    Ideally we should improve this logic and avoid copy, but performance impact is very limited", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjY3MDkx", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-424667091", "createdAt": "2020-06-04T17:21:28Z", "commit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoyMToyOFrOGfQFhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoyMToyOFrOGfQFhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyMjU5Nw==", "bodyText": "You probably would want to return profilingUrl if it was configured... in fact regardless of apiKey status if user forced profilingUrl that is probably what should be used.", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r435422597", "createdAt": "2020-06-04T17:21:28Z", "author": {"login": "mar-kolya"}, "path": "dd-trace-api/src/main/java/datadog/trace/api/Config.java", "diffHunk": "@@ -848,10 +849,20 @@ public float getInstrumentationAnalyticsSampleRate(final String... aliases) {\n   }\n \n   public String getFinalProfilingUrl() {\n-    if (profilingUrl == null) {\n-      return String.format(PROFILING_URL_TEMPLATE, site);\n+    // TODO: how does precedence work?\n+    //  we have the profilingUrl configuration, the local trace agent default and the apiKey\n+    // if there's no API key we return the local trace agent\n+    // if there's an API key we check the profile URL setting\n+    // OR\n+    // we check if there's a URL\n+    if (apiKey != null) {\n+      if (profilingUrl == null) {\n+        return String.format(PROFILING_REMOTE_URL_TEMPLATE, site);\n+      } else {\n+        return profilingUrl;\n+      }\n     } else {\n-      return profilingUrl;\n+      return String.format(PROFILING_LOCAL_URL_TEMPLATE, agentHost, agentPort);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjY3MzEz", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-424667313", "createdAt": "2020-06-04T17:21:46Z", "commit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoyMTo0NlrOGfQGKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoyMTo0NlrOGfQGKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyMjc2MQ==", "bodyText": "I think there is logic that disables profiling completely if there is no key...", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r435422761", "createdAt": "2020-06-04T17:21:46Z", "author": {"login": "mar-kolya"}, "path": "dd-trace-api/src/main/java/datadog/trace/api/Config.java", "diffHunk": "@@ -848,10 +849,20 @@ public float getInstrumentationAnalyticsSampleRate(final String... aliases) {\n   }\n \n   public String getFinalProfilingUrl() {\n-    if (profilingUrl == null) {\n-      return String.format(PROFILING_URL_TEMPLATE, site);\n+    // TODO: how does precedence work?\n+    //  we have the profilingUrl configuration, the local trace agent default and the apiKey\n+    // if there's no API key we return the local trace agent\n+    // if there's an API key we check the profile URL setting\n+    // OR\n+    // we check if there's a URL\n+    if (apiKey != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33af4c388e14b6510116e9a5c0e306a0518d4e0a", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/33af4c388e14b6510116e9a5c0e306a0518d4e0a", "committedDate": "2020-06-04T16:14:08Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "bfc41beec1479fac77a32a087f8a61db09f5e802", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bfc41beec1479fac77a32a087f8a61db09f5e802", "committedDate": "2020-06-08T16:52:08Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfc41beec1479fac77a32a087f8a61db09f5e802", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bfc41beec1479fac77a32a087f8a61db09f5e802", "committedDate": "2020-06-08T16:52:08Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "a5fe45de39b46c373d618ba28b65b8ccece0df17", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a5fe45de39b46c373d618ba28b65b8ccece0df17", "committedDate": "2020-06-09T15:28:10Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5fe45de39b46c373d618ba28b65b8ccece0df17", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a5fe45de39b46c373d618ba28b65b8ccece0df17", "committedDate": "2020-06-09T15:28:10Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "5fd590b12bc76c942a9d2933a1fcbfe0bd60b450", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5fd590b12bc76c942a9d2933a1fcbfe0bd60b450", "committedDate": "2020-06-09T16:56:11Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fd590b12bc76c942a9d2933a1fcbfe0bd60b450", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5fd590b12bc76c942a9d2933a1fcbfe0bd60b450", "committedDate": "2020-06-09T16:56:11Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "54f4c151565027d54531c63ad3ba9b6fe1e976c4", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/54f4c151565027d54531c63ad3ba9b6fe1e976c4", "committedDate": "2020-06-09T17:17:31Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTU1MTEw", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-427955110", "createdAt": "2020-06-10T11:20:05Z", "commit": {"oid": "aaa8512d85c7d743c8f24c563e3949c895bddf76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToyMDowNVrOGhwUgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToyMDowNVrOGhwUgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0Nzg3NA==", "bodyText": "Tests should be updated for these changes", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r438047874", "createdAt": "2020-06-10T11:20:05Z", "author": {"login": "mar-kolya"}, "path": "dd-java-agent/agent-profiling/profiling-uploader/src/main/java/com/datadog/profiling/uploader/ProfileUploader.java", "diffHunk": "@@ -301,16 +302,20 @@ private void makeUploadRequest(final RecordingType type, final RecordingData dat\n     bodyBuilder.addPart(DATA_HEADERS, body);\n     final RequestBody requestBody = bodyBuilder.build();\n \n-    final Request request =\n+    final Request.Builder requestBuilder =\n         new Request.Builder()\n             .url(url)\n-            .addHeader(HEADER_DD_API_KEY, apiKey)\n             // Note: this header is used to disable tracing of profiling requests\n             .addHeader(DATADOG_META_LANG, JAVA_LANG)\n-            .post(requestBody)\n-            .build();\n-\n-    client.newCall(request).enqueue(RESPONSE_CALLBACK);\n+            .post(requestBody);\n+    if (apiKey != null) {\n+      requestBuilder.addHeader(HEADER_DD_API_KEY, apiKey);\n+    }\n+    final String containerId = ContainerInfo.get().getContainerId();\n+    if (containerId != null) {\n+      requestBuilder.addHeader(HEADER_DD_CONTAINER_ID, containerId);\n+    }\n+    client.newCall(requestBuilder.build()).enqueue(RESPONSE_CALLBACK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaa8512d85c7d743c8f24c563e3949c895bddf76"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTU1NTk1", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-427955595", "createdAt": "2020-06-10T11:20:54Z", "commit": {"oid": "aaa8512d85c7d743c8f24c563e3949c895bddf76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToyMDo1NFrOGhwWEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToyMDo1NFrOGhwWEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0ODI3NA==", "bodyText": "Do we have to do copy-pasting?", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r438048274", "createdAt": "2020-06-10T11:20:54Z", "author": {"login": "mar-kolya"}, "path": "dd-java-agent/agent-profiling/profiling-uploader/src/main/java/com/datadog/profiling/uploader/ContainerInfo.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package com.datadog.profiling.uploader;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.ParseException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+\n+/**\n+ * Parses container information from /proc/self/cgroup.\n+ *\n+ * <p>Copied from dd-trace-core/src/main/java/datadog/trace/core/ContainerInfo.java", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaa8512d85c7d743c8f24c563e3949c895bddf76"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTU2NjY0", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-427956664", "createdAt": "2020-06-10T11:22:31Z", "commit": {"oid": "aaa8512d85c7d743c8f24c563e3949c895bddf76"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aaa8512d85c7d743c8f24c563e3949c895bddf76", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/aaa8512d85c7d743c8f24c563e3949c895bddf76", "committedDate": "2020-06-09T17:48:03Z", "message": "Add container id header to profile uploads"}, "afterCommit": {"oid": "28a83c93fefb3f93bfb7dfd449bb92dcde12e497", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/28a83c93fefb3f93bfb7dfd449bb92dcde12e497", "committedDate": "2020-06-10T15:32:07Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28a83c93fefb3f93bfb7dfd449bb92dcde12e497", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/28a83c93fefb3f93bfb7dfd449bb92dcde12e497", "committedDate": "2020-06-10T15:32:07Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "1e88bb8bfda0e87daffc0df6a27ad698b8c74606", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1e88bb8bfda0e87daffc0df6a27ad698b8c74606", "committedDate": "2020-06-10T16:42:23Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1253cce0bb965a101c7322fea397cad8ebf13106", "committedDate": "2020-06-10T16:56:50Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e88bb8bfda0e87daffc0df6a27ad698b8c74606", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1e88bb8bfda0e87daffc0df6a27ad698b8c74606", "committedDate": "2020-06-10T16:42:23Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1253cce0bb965a101c7322fea397cad8ebf13106", "committedDate": "2020-06-10T16:56:50Z", "message": "Send data to trace agent when no API key is given"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzcwNDA1", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-428370405", "createdAt": "2020-06-10T19:38:43Z", "commit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NzEzNzEy", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-428713712", "createdAt": "2020-06-11T08:47:59Z", "commit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo0ODowMFrOGiUPPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo0ODowMFrOGiUPPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYzNjM0OA==", "bodyText": "Nit: Given that this will become the default, I'm not sure this log line is very useful", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r438636348", "createdAt": "2020-06-11T08:48:00Z", "author": {"login": "AlexJF"}, "path": "dd-java-agent/agent-profiling/src/main/java/com/datadog/profiling/agent/ProfilingAgent.java", "diffHunk": "@@ -40,10 +40,9 @@ public static synchronized void run(final boolean isStartingFirst)\n         return;\n       }\n       if (config.getApiKey() == null) {\n-        log.info(\"Profiling: no API key. Profiling is disabled.\");\n-        return;\n-      }\n-      if (!API_KEY_REGEX.test(config.getApiKey())) {\n+        log.info(\n+            \"Profiling: no API key configured. An API key is not required for profiling when sending data to the local datadog-agent.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NzcyMTc2", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-428772176", "createdAt": "2020-06-11T10:08:37Z", "commit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDowODozN1rOGiW8tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDowODozN1rOGiW8tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY4MDc1Nw==", "bodyText": "Can we add a helpful message in case we're hitting the agent and the response is 404?\nLike dd-trace-go is doing here: https://github.com/DataDog/dd-trace-go/blob/v1/profiler/upload.go#L113\nWhich looks like this in logs:\n2020/06/11 10:06:21 Datadog Tracer v1.25.0 ERROR: Failed to upload profile: Datadog Agent is not accepting profiles. Agent-based profiling deployments require Datadog Agent >= 7.20", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r438680757", "createdAt": "2020-06-11T10:08:37Z", "author": {"login": "AlexJF"}, "path": "dd-java-agent/agent-profiling/profiling-uploader/src/main/java/com/datadog/profiling/uploader/ProfileUploader.java", "diffHunk": "@@ -301,16 +301,17 @@ private void makeUploadRequest(final RecordingType type, final RecordingData dat\n     bodyBuilder.addPart(DATA_HEADERS, body);\n     final RequestBody requestBody = bodyBuilder.build();\n \n-    final Request request =\n+    final Request.Builder requestBuilder =\n         new Request.Builder()\n             .url(url)\n-            .addHeader(HEADER_DD_API_KEY, apiKey)\n             // Note: this header is used to disable tracing of profiling requests\n             .addHeader(DATADOG_META_LANG, JAVA_LANG)\n-            .post(requestBody)\n-            .build();\n+            .post(requestBody);\n+    if (apiKey != null) {\n+      requestBuilder.addHeader(HEADER_DD_API_KEY, apiKey);\n+    }\n \n-    client.newCall(request).enqueue(RESPONSE_CALLBACK);\n+    client.newCall(requestBuilder.build()).enqueue(RESPONSE_CALLBACK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1253cce0bb965a101c7322fea397cad8ebf13106", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1253cce0bb965a101c7322fea397cad8ebf13106", "committedDate": "2020-06-10T16:56:50Z", "message": "Send data to trace agent when no API key is given"}, "afterCommit": {"oid": "8c63d722884c2e9c7b1e237b312747ee0efa3e9a", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8c63d722884c2e9c7b1e237b312747ee0efa3e9a", "committedDate": "2020-06-10T14:29:56Z", "message": "Merge pull request #1550 from DataDog/bantonsson/scopevent-long-ids\n\nSwitch DDScopeEvent ids to long and remove hex String caching"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTM5OTg3", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-428939987", "createdAt": "2020-06-11T13:57:17Z", "commit": {"oid": "edcf34808e5f4a4a60bdbb4e04b0f2682224c663"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1NzoxN1rOGieoog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1NzoxN1rOGieoog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNjY5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      } else {\n          \n          \n            \n                      } else if (config.getApiKey() == null && response.getStatusCode() == 404) {\n          \n      \n    \n    \n  \n\nOr whatever is the equivalent code to get to the statuscode.\nIf it is deemed to help with readability we could also add a config.isProfilingAgentless() function that basically returns the result of config.apiKey != null", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#discussion_r438806690", "createdAt": "2020-06-11T13:57:17Z", "author": {"login": "AlexJF"}, "path": "dd-java-agent/agent-profiling/profiling-uploader/src/main/java/com/datadog/profiling/uploader/ProfileUploader.java", "diffHunk": "@@ -90,14 +91,16 @@\n       new Callback() {\n         @Override\n         public void onFailure(final Call call, final IOException e) {\n-          log.warn(\"Failed to upload profile\", e);\n+          HttpUrl url = call.request().url();\n+          log.warn(\"Failed to upload profile to {}\", url, e);\n         }\n \n         @Override\n         public void onResponse(final Call call, final Response response) {\n           if (response.isSuccessful()) {\n             log.debug(\"Upload done\");\n           } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edcf34808e5f4a4a60bdbb4e04b0f2682224c663"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edcf34808e5f4a4a60bdbb4e04b0f2682224c663", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/edcf34808e5f4a4a60bdbb4e04b0f2682224c663", "committedDate": "2020-06-11T13:43:40Z", "message": "Improve logging for failed profile uploads"}, "afterCommit": {"oid": "05d1d983f34faa98674e514c1f4cfd2f22666f89", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/05d1d983f34faa98674e514c1f4cfd2f22666f89", "committedDate": "2020-06-11T14:16:00Z", "message": "Improve logging for failed profile uploads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35734f79f4b44950aa4baaa725f8d00c188b3d6a", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/35734f79f4b44950aa4baaa725f8d00c188b3d6a", "committedDate": "2020-06-11T15:57:38Z", "message": "Improve logging for failed profile uploads"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05d1d983f34faa98674e514c1f4cfd2f22666f89", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/05d1d983f34faa98674e514c1f4cfd2f22666f89", "committedDate": "2020-06-11T14:16:00Z", "message": "Improve logging for failed profile uploads"}, "afterCommit": {"oid": "35734f79f4b44950aa4baaa725f8d00c188b3d6a", "author": {"user": {"login": "cimi", "name": "Alex Ciminian"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/35734f79f4b44950aa4baaa725f8d00c188b3d6a", "committedDate": "2020-06-11T15:57:38Z", "message": "Improve logging for failed profile uploads"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDk4MzY5", "url": "https://github.com/DataDog/dd-trace-java/pull/1543#pullrequestreview-429098369", "createdAt": "2020-06-11T16:46:04Z", "commit": {"oid": "35734f79f4b44950aa4baaa725f8d00c188b3d6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2363, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}