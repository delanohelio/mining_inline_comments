{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1ODc1MzMy", "number": 1598, "title": "route classloads to classloader by package", "bodyText": "Looking at EpsilonGC heap dumps I noticed patterns of repeated classload attempts, where classloads for classes in our private classloaders would be attempted multiple times in a top down fashion. Each time this happened, URLClassLoader would create several new String objects building up classfile URL paths, which we would then use to lookup a JarEntry. If a class is in \"inst\" we would miss the first time in shared and throw a NoSuchFileException, then hit once in inst and then hit inst again. This pattern looks like this:\n\nThis PR changes the classloading mechanism to attempt a load at the child level first, delegating to the shared classloader if no match is found, before reverting to the default, top down, mechanism if the class is one we don't manage. In order to do this, when our jars are indexed by InternalJarURLHandler, the set of packages is extracted. When class loads are attempted, the package is extracted and the class load is not attempted unless the package is present. Almost all class misses in InternalJarURLHandler are avoided this way.\nThere are some class loads for agent tooling and bytebuddy classes which I don't understand fully which bypass this mechanism. For example:\n[dd.trace 2020-06-17 14:55:28:194 +0100] [main] INFO datadog.trace.bootstrap.InternalJarURLHandler - /datadog/trace/instrumentation/http_url_connection/UrlInstrumentation$ConnectionErrorAdvice.class not found in shared\n[dd.trace 2020-06-17 14:55:28:194 +0100] [main] INFO datadog.trace.bootstrap.InternalJarURLHandler - /datadog/trace/instrumentation/http_url_connection/UrlInstrumentation$ConnectionErrorAdvice.class found in inst\n[dd.trace 2020-06-17 14:55:28:194 +0100] [main] INFO datadog.trace.bootstrap.InternalJarURLHandler - /datadog/trace/instrumentation/http_url_connection/UrlInstrumentation$ConnectionErrorAdvice.class hit cache in inst\n....\n[dd.trace 2020-06-17 14:55:28:193 +0100] [main] INFO datadog.trace.bootstrap.InternalJarURLHandler - /net/bytebuddy/asm/Advice$OnMethodExit.class not found in shared\n[dd.trace 2020-06-17 14:55:28:193 +0100] [main] INFO datadog.trace.bootstrap.InternalJarURLHandler - /net/bytebuddy/asm/Advice$OnMethodExit.class found in inst\n[dd.trace 2020-06-17 14:55:28:193 +0100] [main] INFO datadog.trace.bootstrap.InternalJarURLHandler - /net/bytebuddy/asm/Advice$OnMethodExit.class hit cache in inst\n\nTo reduce the impact of these there are two mitigations:\n\nthe last jar entry is cached and dismissed on the second access.\nthe exception is preallocated and does not produce a stack trace.\n\nThis improves the time to install the agent (i.e. the time taken to exit AgentInstaller.installBytebuddyAgent) for the first time by a few hundred milliseconds on spring-petclinic.\n./start.sh epsilon  5.29s user 0.29s system 274% cpu 2.031 total\n./start.sh epsilon  4.84s user 0.24s system 284% cpu 1.782 total\n./start.sh epsilon  5.05s user 0.26s system 287% cpu 1.844 total\n./start.sh epsilon  5.34s user 0.26s system 291% cpu 1.924 total\n./start.sh epsilon  4.69s user 0.25s system 294% cpu 1.676 total\n./start.sh epsilon  5.24s user 0.26s system 295% cpu 1.860 total\n./start.sh epsilon  4.86s user 0.24s system 285% cpu 1.786 total\n./start.sh epsilon  5.16s user 0.25s system 298% cpu 1.814 total\n./start.sh epsilon  4.90s user 0.26s system 300% cpu 1.719 total\n./start.sh epsilon  5.08s user 0.27s system 286% cpu 1.868 total\n\n./start.sh epsilon  4.15s user 0.23s system 280% cpu 1.559 total\n./start.sh epsilon  4.34s user 0.23s system 290% cpu 1.572 total\n./start.sh epsilon  4.15s user 0.24s system 281% cpu 1.560 total\n./start.sh epsilon  4.41s user 0.24s system 290% cpu 1.602 total\n./start.sh epsilon  4.24s user 0.23s system 283% cpu 1.578 total\n./start.sh epsilon  4.28s user 0.23s system 282% cpu 1.592 total\n./start.sh epsilon  4.39s user 0.22s system 287% cpu 1.606 total\n./start.sh epsilon  4.37s user 0.23s system 287% cpu 1.597 total\n./start.sh epsilon  4.44s user 0.23s system 288% cpu 1.622 total\n./start.sh epsilon  4.33s user 0.24s system 280% cpu 1.626 total", "createdAt": "2020-06-17T14:05:11Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1598", "merged": true, "mergeCommit": {"oid": "03ec987180f3f79bb355690ac080c344e9bee906"}, "closed": true, "closedAt": "2020-06-18T15:52:35Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsLNBqAFqTQzMjQ5NDcxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsgf_JgFqTQzMzQyMDQyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDk0NzE3", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-432494717", "createdAt": "2020-06-17T15:01:56Z", "commit": {"oid": "7031cb13374dcbf7fe061c7fb6524d58767ad686"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7031cb13374dcbf7fe061c7fb6524d58767ad686", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7031cb13374dcbf7fe061c7fb6524d58767ad686", "committedDate": "2020-06-17T14:01:17Z", "message": "find classloader for type by class package"}, "afterCommit": {"oid": "04432714f0f6fd22b63cb80d073835ce1d11bf46", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/04432714f0f6fd22b63cb80d073835ce1d11bf46", "committedDate": "2020-06-17T15:49:17Z", "message": "find classloader for type by class package"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04432714f0f6fd22b63cb80d073835ce1d11bf46", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/04432714f0f6fd22b63cb80d073835ce1d11bf46", "committedDate": "2020-06-17T15:49:17Z", "message": "find classloader for type by class package"}, "afterCommit": {"oid": "46e79fd2271c55996eb91143b2675396f8afb0fa", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/46e79fd2271c55996eb91143b2675396f8afb0fa", "committedDate": "2020-06-17T16:14:43Z", "message": "find classloader for type by class package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTY3NjU5", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-432567659", "createdAt": "2020-06-17T16:23:53Z", "commit": {"oid": "46e79fd2271c55996eb91143b2675396f8afb0fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjoyMzo1M1rOGlNcew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjoyMzo1M1rOGlNcew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3MDc3OQ==", "bodyText": "So, cache is caching the last requested packageName?", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#discussion_r441670779", "createdAt": "2020-06-17T16:23:53Z", "author": {"login": "jbachorik"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/DatadogClassLoader.java", "diffHunk": "@@ -77,6 +67,24 @@ public boolean hasLoadedClass(final String className) {\n     return findLoadedClass(className) != null;\n   }\n \n+  Class<?> loadFromPackage(String packageName, String name) throws ClassNotFoundException {\n+    if (internalJarURLHandler.getPackages().contains(packageName)) {\n+      Class<?> loaded = findLoadedClass(name);\n+      return null == loaded ? findClass(name) : loaded;\n+    }\n+    return super.loadClass(name);\n+  }\n+\n+  String getPackageName(final String className) {\n+    // intentionally not thread-safe: the worst case scenario is excess allocation/lookups\n+    String packageName = this.cache.get();\n+    if (null == packageName || !className.startsWith(packageName)) {\n+      packageName = className.substring(0, className.lastIndexOf('.'));\n+      this.cache = new WeakReference<>(packageName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e79fd2271c55996eb91143b2675396f8afb0fa"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTc2MDMy", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-432576032", "createdAt": "2020-06-17T16:33:57Z", "commit": {"oid": "46e79fd2271c55996eb91143b2675396f8afb0fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjozMzo1N1rOGlN0Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjozMzo1N1rOGlN0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3Njg1NA==", "bodyText": "This should probably account for 'no-package' classes as well - eg. lastIndexOf('/') == -1", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#discussion_r441676854", "createdAt": "2020-06-17T16:33:57Z", "author": {"login": "jbachorik"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java", "diffHunk": "@@ -1,42 +1,61 @@\n package datadog.trace.bootstrap;\n \n+import datadog.trace.bootstrap.instrumentation.api.Pair;\n import java.io.ByteArrayInputStream;\n import java.io.File;\n import java.io.IOException;\n import java.io.InputStream;\n+import java.lang.ref.WeakReference;\n import java.net.URISyntaxException;\n import java.net.URL;\n import java.net.URLConnection;\n import java.net.URLStreamHandler;\n-import java.nio.file.NoSuchFileException;\n import java.security.Permission;\n import java.util.Enumeration;\n import java.util.HashMap;\n+import java.util.HashSet;\n import java.util.Map;\n+import java.util.Set;\n import java.util.jar.JarEntry;\n import java.util.jar.JarFile;\n import lombok.extern.slf4j.Slf4j;\n \n @Slf4j\n public class InternalJarURLHandler extends URLStreamHandler {\n+\n+  private static final WeakReference<Pair<String, JarEntry>> NULL = new WeakReference<>(null);\n+\n+  private final String name;\n+  private final FileNotInInternalJar notFound;\n   private final Map<String, JarEntry> filenameToEntry = new HashMap<>();\n-  private JarFile bootstrapJarFile;\n+  private final Set<String> packages = new HashSet<>();\n+  private final JarFile bootstrapJarFile;\n+\n+  private WeakReference<Pair<String, JarEntry>> cache = NULL;\n \n   InternalJarURLHandler(final String internalJarFileName, final URL bootstrapJarLocation) {\n+    this.name = internalJarFileName;\n+    this.notFound = new FileNotInInternalJar(internalJarFileName);\n     final String filePrefix = internalJarFileName + \"/\";\n-\n+    JarFile jarFile = null;\n+    String currentDir = \"$\";\n     try {\n       if (bootstrapJarLocation != null) {\n-        bootstrapJarFile = new JarFile(new File(bootstrapJarLocation.toURI()), false);\n-        final Enumeration<JarEntry> entries = bootstrapJarFile.entries();\n+        jarFile = new JarFile(new File(bootstrapJarLocation.toURI()), false);\n+        final Enumeration<JarEntry> entries = jarFile.entries();\n         while (entries.hasMoreElements()) {\n           final JarEntry entry = entries.nextElement();\n-\n           if (!entry.isDirectory() && entry.getName().startsWith(filePrefix)) {\n             String name = entry.getName();\n             // remove data suffix\n             int end = name.endsWith(\".classdata\") ? name.length() - 4 : name.length();\n-            filenameToEntry.put(name.substring(internalJarFileName.length(), end), entry);\n+            String fileName = name.substring(internalJarFileName.length(), end);\n+            filenameToEntry.put(fileName, entry);\n+            if (fileName.endsWith(\".class\") && !fileName.startsWith(currentDir)) {\n+              currentDir = fileName.substring(1, fileName.lastIndexOf('/'));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e79fd2271c55996eb91143b2675396f8afb0fa"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ff3c3950781f2479b8f8a748cfda04c43a77914", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5ff3c3950781f2479b8f8a748cfda04c43a77914", "committedDate": "2020-06-17T16:29:53Z", "message": "access bootstrap proxy via method"}, "afterCommit": {"oid": "b063bfd96bb3690f800339981b354a269f5f5f0f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b063bfd96bb3690f800339981b354a269f5f5f0f", "committedDate": "2020-06-17T16:35:33Z", "message": "access bootstrap proxy via method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edc2e370c1f3de152257e92bfa486ed51a14a0f7", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/edc2e370c1f3de152257e92bfa486ed51a14a0f7", "committedDate": "2020-06-17T16:39:46Z", "message": "find classloader for type by class package"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b063bfd96bb3690f800339981b354a269f5f5f0f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b063bfd96bb3690f800339981b354a269f5f5f0f", "committedDate": "2020-06-17T16:35:33Z", "message": "access bootstrap proxy via method"}, "afterCommit": {"oid": "68c1013d19f250057401ebbd726769bd0bd64372", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/68c1013d19f250057401ebbd726769bd0bd64372", "committedDate": "2020-06-17T16:39:46Z", "message": "access bootstrap proxy via method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTg1MjAw", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-432585200", "createdAt": "2020-06-17T16:44:47Z", "commit": {"oid": "68c1013d19f250057401ebbd726769bd0bd64372"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68c1013d19f250057401ebbd726769bd0bd64372", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/68c1013d19f250057401ebbd726769bd0bd64372", "committedDate": "2020-06-17T16:39:46Z", "message": "access bootstrap proxy via method"}, "afterCommit": {"oid": "647e9f48b265e1a5a4ec48f71cd4d68fe1e0fe97", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/647e9f48b265e1a5a4ec48f71cd4d68fe1e0fe97", "committedDate": "2020-06-17T16:56:25Z", "message": "access bootstrap proxy via method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e254602abb9b4062f86a911aa0589802cb973ce5", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e254602abb9b4062f86a911aa0589802cb973ce5", "committedDate": "2020-06-17T17:06:15Z", "message": "access bootstrap proxy via method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "647e9f48b265e1a5a4ec48f71cd4d68fe1e0fe97", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/647e9f48b265e1a5a4ec48f71cd4d68fe1e0fe97", "committedDate": "2020-06-17T16:56:25Z", "message": "access bootstrap proxy via method"}, "afterCommit": {"oid": "e254602abb9b4062f86a911aa0589802cb973ce5", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e254602abb9b4062f86a911aa0589802cb973ce5", "committedDate": "2020-06-17T17:06:15Z", "message": "access bootstrap proxy via method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTAxNDQw", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-432501440", "createdAt": "2020-06-17T15:08:15Z", "commit": {"oid": "7031cb13374dcbf7fe061c7fb6524d58767ad686"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNTowODoxNVrOGlKV_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNTowODoxNVrOGlKV_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYxOTk2NQ==", "bodyText": "are we sure this is the case for all JVMs?", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#discussion_r441619965", "createdAt": "2020-06-17T15:08:15Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java", "diffHunk": "@@ -59,12 +83,26 @@ protected URLConnection openConnection(final URL url) throws IOException {\n       // nullInputStream() is not available until Java 11\n       return new InternalJarURLConnection(url, new ByteArrayInputStream(new byte[0]));\n     }\n-    final JarEntry entry = filenameToEntry.get(filename);\n-    if (null != entry) {\n-      return new InternalJarURLConnection(url, bootstrapJarFile.getInputStream(entry));\n+    // believe it or not, we're going to get called twice for this,\n+    // and the key will be a new object each time.\n+    Pair<String, JarEntry> pair = cache.get();\n+    if (null == pair || !filename.equals(pair.getLeft())) {\n+      final JarEntry entry = filenameToEntry.get(filename);\n+      if (null != entry) { // jar live\n+        pair = Pair.of(filename, entry);\n+        // this mechanism intentionally does not ensure visibility of this write, because it doesn't\n+        // matter\n+        this.cache = new WeakReference<>(pair);\n+      } else {\n+        log.debug(\"{} not found in {}\", filename, name);\n+        throw notFound;\n+      }\n     } else {\n-      throw new NoSuchFileException(url.getFile(), null, url.getFile() + \" not in internal jar\");\n+      // hack: just happen to know this only ever happens twice,\n+      // so dismiss cache after a hit\n+      this.cache = NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7031cb13374dcbf7fe061c7fb6524d58767ad686"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMDQ5NTYx", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-433049561", "createdAt": "2020-06-18T08:21:47Z", "commit": {"oid": "e254602abb9b4062f86a911aa0589802cb973ce5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c634071591a6167e36023720eac9bb383a08845c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c634071591a6167e36023720eac9bb383a08845c", "committedDate": "2020-06-18T11:38:35Z", "message": "don't cache empty package name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzEwMTQ0", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-433310144", "createdAt": "2020-06-18T13:57:20Z", "commit": {"oid": "13ff7ef72a3c777362100e55d4e395bbdda77e60"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMzo1NzoyMVrOGlwk1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMzo1NzoyMVrOGlwk1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0NjM1Nw==", "bodyText": "A bit confusing that it's named parent in the jar and the test name, but shared in the code.", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#discussion_r442246357", "createdAt": "2020-06-18T13:57:21Z", "author": {"login": "bantonsson"}, "path": "dd-java-agent/agent-bootstrap/src/test/groovy/datadog/trace/bootstrap/DatadogClassLoaderTest.groovy", "diffHunk": "@@ -49,4 +53,50 @@ class DatadogClassLoaderTest extends Specification {\n     then:\n     applicationDidNotDeadlock\n   }\n+\n+\n+  def \"test delegate class load to parent\"() {\n+    setup:\n+    DatadogClassLoader.BootstrapClassLoaderProxy bootstrapProxy =\n+      new DatadogClassLoader.BootstrapClassLoaderProxy()\n+    DatadogClassLoader shared = new DatadogClassLoader(testJarLocation, \"parent\", bootstrapProxy, null)\n+    DatadogClassLoader.DelegateClassLoader child = new DatadogClassLoader.DelegateClassLoader(testJarLocation,\n+      \"child\", bootstrapProxy, null, shared)\n+\n+    when:\n+    Class<?> c = child.loadClass(\"a.b.c.C\")\n+\n+    then:\n+    c.getClassLoader() == shared", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13ff7ef72a3c777362100e55d4e395bbdda77e60"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzExMTEw", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-433311110", "createdAt": "2020-06-18T13:58:20Z", "commit": {"oid": "13ff7ef72a3c777362100e55d4e395bbdda77e60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13ff7ef72a3c777362100e55d4e395bbdda77e60", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/13ff7ef72a3c777362100e55d4e395bbdda77e60", "committedDate": "2020-06-18T13:37:04Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}, "afterCommit": {"oid": "16cfd58230bb2171bba7d1ee509e692cd1b0527f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/16cfd58230bb2171bba7d1ee509e692cd1b0527f", "committedDate": "2020-06-18T14:08:22Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16cfd58230bb2171bba7d1ee509e692cd1b0527f", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/16cfd58230bb2171bba7d1ee509e692cd1b0527f", "committedDate": "2020-06-18T14:08:22Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}, "afterCommit": {"oid": "ba94801898b79c1f26e40f3cdb1c82ce42b0b648", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ba94801898b79c1f26e40f3cdb1c82ce42b0b648", "committedDate": "2020-06-18T14:13:50Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e108ce238509ba1460308c778dad471c159ae101", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e108ce238509ba1460308c778dad471c159ae101", "committedDate": "2020-06-18T14:22:01Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba94801898b79c1f26e40f3cdb1c82ce42b0b648", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ba94801898b79c1f26e40f3cdb1c82ce42b0b648", "committedDate": "2020-06-18T14:13:50Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}, "afterCommit": {"oid": "e108ce238509ba1460308c778dad471c159ae101", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e108ce238509ba1460308c778dad471c159ae101", "committedDate": "2020-06-18T14:22:01Z", "message": "add tests for InternalJarURLHandler and DatadogClassLoader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNDIwNDI0", "url": "https://github.com/DataDog/dd-trace-java/pull/1598#pullrequestreview-433420424", "createdAt": "2020-06-18T15:50:39Z", "commit": {"oid": "e108ce238509ba1460308c778dad471c159ae101"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2181, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}