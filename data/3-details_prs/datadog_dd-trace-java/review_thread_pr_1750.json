{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzI3NzYw", "number": 1750, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzowMToxNFrOEVZzbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0MjowMlrOEVcbeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwODc4MzE3OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/java/LambdaTaskConfigurer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzowMToxNFrOG8IoLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzowMToxNFrOG8IoLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTcwOTEwMQ==", "bodyText": "Not really necessary I guess...", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465709101", "createdAt": "2020-08-05T13:01:14Z", "author": {"login": "bantonsson"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/java/LambdaTaskConfigurer.java", "diffHunk": "@@ -0,0 +1,21 @@\n+import org.springframework.scheduling.annotation.SchedulingConfigurer;\n+import org.springframework.scheduling.config.ScheduledTaskRegistrar;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+@Service\n+public class LambdaTaskConfigurer implements SchedulingConfigurer {\n+\n+  public final CountDownLatch singleUseLatch = new CountDownLatch(1);\n+\n+  @Override\n+  public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {\n+    taskRegistrar.addFixedDelayTask(\n+      () -> {\n+        System.out.println(\"lambda task\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d324a75a5caad116081a0e324a4bd66d0ba611d5"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwODg5NDA3OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/java/LambdaTaskConfigurer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzoyOToyMVrOG8JtTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzoyOToyMVrOG8JtTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTcyNjc5Ng==", "bodyText": "Nice", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465726796", "createdAt": "2020-08-05T13:29:21Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/java/LambdaTaskConfigurer.java", "diffHunk": "@@ -0,0 +1,15 @@\n+import java.util.concurrent.CountDownLatch;\n+import org.springframework.scheduling.annotation.SchedulingConfigurer;\n+import org.springframework.scheduling.config.ScheduledTaskRegistrar;\n+import org.springframework.stereotype.Service;\n+\n+@Service\n+public class LambdaTaskConfigurer implements SchedulingConfigurer {\n+\n+  public final CountDownLatch singleUseLatch = new CountDownLatch(1);\n+\n+  @Override\n+  public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {\n+    taskRegistrar.addFixedDelayTask(singleUseLatch::countDown, 500);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTIxMzM3OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/groovy/SpringSchedulingTest.groovy", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0MjowMlrOG8M2cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNToxMzo1NlrOG8OSLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3ODI4OA==", "bodyText": "What does the full resource name look like?", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465778288", "createdAt": "2020-08-05T14:42:02Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/groovy/SpringSchedulingTest.groovy", "diffHunk": "@@ -54,4 +56,31 @@ class SpringSchedulingTest extends AgentTestRunner {\n     }\n \n   }\n+\n+  def \"schedule lambda test\"() {\n+    setup:\n+    def context = new AnnotationConfigApplicationContext(LambdaTaskConfig)\n+    def configurer = context.getBean(LambdaTaskConfigurer)\n+\n+    configurer.singleUseLatch.await(2000, TimeUnit.MILLISECONDS)\n+\n+    expect:\n+    assertTraces(1) {\n+      trace(0, 1) {\n+        span(0) {\n+          resourceNameContains(\"LambdaTaskConfigurer\\$\\$Lambda\\$\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc5MzI0Nw==", "bodyText": "whatever the VM assigns to it", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465793247", "createdAt": "2020-08-05T15:02:04Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/groovy/SpringSchedulingTest.groovy", "diffHunk": "@@ -54,4 +56,31 @@ class SpringSchedulingTest extends AgentTestRunner {\n     }\n \n   }\n+\n+  def \"schedule lambda test\"() {\n+    setup:\n+    def context = new AnnotationConfigApplicationContext(LambdaTaskConfig)\n+    def configurer = context.getBean(LambdaTaskConfigurer)\n+\n+    configurer.singleUseLatch.await(2000, TimeUnit.MILLISECONDS)\n+\n+    expect:\n+    assertTraces(1) {\n+      trace(0, 1) {\n+        span(0) {\n+          resourceNameContains(\"LambdaTaskConfigurer\\$\\$Lambda\\$\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3ODI4OA=="}, "originalCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgwMTc3NA==", "bodyText": "@dougqh The cardinality of this might be problematic and something we should investigate at a broader level.", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465801774", "createdAt": "2020-08-05T15:13:56Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/groovy/SpringSchedulingTest.groovy", "diffHunk": "@@ -54,4 +56,31 @@ class SpringSchedulingTest extends AgentTestRunner {\n     }\n \n   }\n+\n+  def \"schedule lambda test\"() {\n+    setup:\n+    def context = new AnnotationConfigApplicationContext(LambdaTaskConfig)\n+    def configurer = context.getBean(LambdaTaskConfigurer)\n+\n+    configurer.singleUseLatch.await(2000, TimeUnit.MILLISECONDS)\n+\n+    expect:\n+    assertTraces(1) {\n+      trace(0, 1) {\n+        span(0) {\n+          resourceNameContains(\"LambdaTaskConfigurer\\$\\$Lambda\\$\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3ODI4OA=="}, "originalCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4996, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}