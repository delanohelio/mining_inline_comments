{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NjgzMjc3", "number": 2237, "title": "Small test changes to make tests more robust", "bodyText": "", "createdAt": "2020-12-23T09:53:33Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2237", "merged": true, "mergeCommit": {"oid": "92777945546de351529f7862e0d82ed505d01ee3"}, "closed": true, "closedAt": "2021-01-04T09:06:23Z", "author": {"login": "bantonsson"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdo8H0ZgFqTU1Nzc2MzI1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsxp0sABqjQxNjM3Njg2OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NzYzMjUw", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#pullrequestreview-557763250", "createdAt": "2020-12-23T09:57:03Z", "commit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwOTo1NzowM1rOIKfm8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwOTo1NzowM1rOIKfm8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg3NDU0NQ==", "bodyText": "If the task starts executing and is executing when we call taskCount, it will return 0.", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#discussion_r547874545", "createdAt": "2020-12-23T09:57:03Z", "author": {"login": "bantonsson"}, "path": "internal-api/src/test/groovy/datadog/trace/util/AgentTaskSchedulerTest.groovy", "diffHunk": "@@ -39,12 +39,11 @@ class AgentTaskSchedulerTest extends DDSpecification {\n     !scheduler.isShutdown()\n \n     when:\n-    scheduler.scheduleAtFixedRate(task, latch, 10, 10, MILLISECONDS)\n+    scheduler.scheduleAtFixedRate(task, latch, 50, 10, MILLISECONDS)\n     scheduler.taskCount() == 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NzYzNTgw", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#pullrequestreview-557763580", "createdAt": "2020-12-23T09:57:37Z", "commit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwOTo1NzozN1rOIKfoBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwOTo1NzozN1rOIKfoBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg3NDgyMQ==", "bodyText": "If the task is executing taskCount will return 0. I think it's enough that the task counts down the latch more than once.", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#discussion_r547874821", "createdAt": "2020-12-23T09:57:37Z", "author": {"login": "bantonsson"}, "path": "internal-api/src/test/groovy/datadog/trace/util/AgentTaskSchedulerTest.groovy", "diffHunk": "@@ -39,12 +39,11 @@ class AgentTaskSchedulerTest extends DDSpecification {\n     !scheduler.isShutdown()\n \n     when:\n-    scheduler.scheduleAtFixedRate(task, latch, 10, 10, MILLISECONDS)\n+    scheduler.scheduleAtFixedRate(task, latch, 50, 10, MILLISECONDS)\n     scheduler.taskCount() == 1\n \n     then:\n     latch.await(500, MILLISECONDS)\n-    scheduler.taskCount() == 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3Nzg4MzU5", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#pullrequestreview-557788359", "createdAt": "2020-12-23T10:42:42Z", "commit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3ODMyMzU2", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#pullrequestreview-557832356", "createdAt": "2020-12-23T12:15:25Z", "commit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/37dbb4ef69e72a6095230103ea6e451a4a45d0b4", "committedDate": "2020-12-23T09:52:01Z", "message": "Avoid small test races when reading scheduler queue size"}, "afterCommit": {"oid": "873ca538517e47a9e6a0f4d1ba68378041a7d6da", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/873ca538517e47a9e6a0f4d1ba68378041a7d6da", "committedDate": "2020-12-23T13:01:26Z", "message": "Avoid small test races when reading scheduler queue size"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "873ca538517e47a9e6a0f4d1ba68378041a7d6da", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/873ca538517e47a9e6a0f4d1ba68378041a7d6da", "committedDate": "2020-12-23T13:01:26Z", "message": "Avoid small test races when reading scheduler queue size"}, "afterCommit": {"oid": "38db60e031e232dc22d0e6ff1811f8e0b1e5ca36", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/38db60e031e232dc22d0e6ff1811f8e0b1e5ca36", "committedDate": "2020-12-23T14:44:52Z", "message": "Avoid small test races when reading scheduler queue size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "337fef0499c60b3a1c3bdffabc5c0897b6229da1", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/337fef0499c60b3a1c3bdffabc5c0897b6229da1", "committedDate": "2021-01-04T07:57:57Z", "message": "Try to wait until the TestHttpServer has started properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69f86dbef87e0fc21b876b516073e08832d17e2c", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/69f86dbef87e0fc21b876b516073e08832d17e2c", "committedDate": "2021-01-04T07:58:18Z", "message": "Avoid small test races when reading scheduler queue size"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38db60e031e232dc22d0e6ff1811f8e0b1e5ca36", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/38db60e031e232dc22d0e6ff1811f8e0b1e5ca36", "committedDate": "2020-12-23T14:44:52Z", "message": "Avoid small test races when reading scheduler queue size"}, "afterCommit": {"oid": "69f86dbef87e0fc21b876b516073e08832d17e2c", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/69f86dbef87e0fc21b876b516073e08832d17e2c", "committedDate": "2021-01-04T07:58:18Z", "message": "Avoid small test races when reading scheduler queue size"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2804, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}