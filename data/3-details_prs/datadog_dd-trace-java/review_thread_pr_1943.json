{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NTY5NjEz", "number": 1943, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMDowMVrOEpvfFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzo1MTo1M1rOEp0niQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjA1MDc5OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMDowMVrOHbmQ6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMDowMVrOHbmQ6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwMDUyMw==", "bodyText": "Use hostName instead of calling the method again.", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498700523", "createdAt": "2020-10-02T09:00:01Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -43,6 +45,11 @@ public AgentSpan onConnection(final AgentSpan span, final CONNECTION connection)\n       if (instanceName != null && Config.get().isDbClientSplitByInstance()) {\n         span.setTag(DDTags.SERVICE_NAME, instanceName);\n       }\n+\n+      String hostName = dbHostname(connection);\n+      if (hostName != null) {\n+        span.setTag(Tags.PEER_HOSTNAME, dbHostname(connection));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjA1ODQ3OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMjozMVrOHbmV8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTowMjozMVrOHbmV8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwMTgxMA==", "bodyText": "If this returned CharSequence there would be the option not to use String and use something we can serialise faster.", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498701810", "createdAt": "2020-10-02T09:02:31Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -26,6 +26,8 @@\n \n   protected abstract String dbInstance(CONNECTION connection);\n \n+  protected abstract String dbHostname(CONNECTION connection);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjg5MTYxOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzo1MTo1M1rOHbueBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTo0NTowN1rOHbymJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgzNDk0OA==", "bodyText": "I wonder if this should be brought up to the ClientDecorator.  Wouldn't this make sense for all clients?  (Maybe not necessary since http clients provide the full URL)", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498834948", "createdAt": "2020-10-02T13:51:53Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -26,6 +26,8 @@\n \n   protected abstract String dbInstance(CONNECTION connection);\n \n+  protected abstract String dbHostname(CONNECTION connection);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkwMjU2NQ==", "bodyText": "Looking at the clients, I don't think it would work well now.  The 2 main derived classes are HttpClientDecorator and DatabaseClientDecorator.  HttpClientDecorator uses URL.  The others are Kafka, JMS, Rabbit, Twilio, Rmi, Grpc, Spring, and KafkaStreams.  They all do things too differently.\nI think if we:\n\nFix the generics in database client decorators to make sense (many of them seem aren't correct so I couldn't add peer)\nAdd a better hierarchy around the other clients (perhaps a QueueClientDecorator?)\n\nWe might be able to revisit later", "url": "https://github.com/DataDog/dd-trace-java/pull/1943#discussion_r498902565", "createdAt": "2020-10-02T15:45:07Z", "author": {"login": "randomanderson"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -26,6 +26,8 @@\n \n   protected abstract String dbInstance(CONNECTION connection);\n \n+  protected abstract String dbHostname(CONNECTION connection);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgzNDk0OA=="}, "originalCommit": {"oid": "1f34982c6c121170870a3096e6c96a84f85f9c5c"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4881, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}