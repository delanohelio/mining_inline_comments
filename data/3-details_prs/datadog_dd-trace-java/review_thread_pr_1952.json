{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTQzMjQy", "number": 1952, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNToxNToxNVrOEqyk5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNToxNDo0M1rOErOpLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzA0MjkzOnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/main/java/datadog/trace/core/PendingTrace.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNToxNToxNVrOHdMpOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzo1Mjo0NVrOHdTVbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM3NzkxMw==", "bodyText": "Now that there is no reference, should we change the name of expiredReference?", "url": "https://github.com/DataDog/dd-trace-java/pull/1952#discussion_r500377913", "createdAt": "2020-10-06T15:15:15Z", "author": {"login": "dougqh"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/PendingTrace.java", "diffHunk": "@@ -250,30 +201,16 @@ long oldestFinishedTime() {\n    */\n   @Override\n   public void registerContinuation(final AgentScope.Continuation continuation) {\n-    synchronized (continuation) {\n-      if (!continuation.isRegistered()) {\n-        weakContinuations.add(continuation.register(continuationReferenceQueue));\n-        final int count = pendingReferenceCount.incrementAndGet();\n-        if (log.isDebugEnabled()) {\n-          log.debug(\n-              \"t_id={} -> registered continuation {} -- count = {}\", traceId, continuation, count);\n-        }\n-      } else {\n-        log.debug(\"continuation {} already registered in trace {}\", continuation, traceId);\n-      }\n+    final int count = pendingReferenceCount.incrementAndGet();\n+    if (log.isDebugEnabled()) {\n+      log.debug(\n+          \"t_id={} -> registered continuation {} -- count = {}\", traceId, continuation, count);\n     }\n   }\n \n   @Override\n   public void cancelContinuation(final AgentScope.Continuation continuation) {\n-    synchronized (continuation) {\n-      if (continuation.isRegistered()) {\n-        continuation.cancel(weakContinuations);\n-        expireReference(false);\n-      } else {\n-        log.debug(\"t_id={} -> not registered in trace: {}\", traceId, continuation);\n-      }\n-    }\n+    expireReference(false);\n   }\n \n   private void expireReference(boolean isRootSpan) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06e4c04897938ff56d8d3c5cbceeec67ba2eff76"}, "originalPosition": 167}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NzUzNQ==", "bodyText": "I renamed it, but not in love with the new name.", "url": "https://github.com/DataDog/dd-trace-java/pull/1952#discussion_r500487535", "createdAt": "2020-10-06T17:52:45Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/PendingTrace.java", "diffHunk": "@@ -250,30 +201,16 @@ long oldestFinishedTime() {\n    */\n   @Override\n   public void registerContinuation(final AgentScope.Continuation continuation) {\n-    synchronized (continuation) {\n-      if (!continuation.isRegistered()) {\n-        weakContinuations.add(continuation.register(continuationReferenceQueue));\n-        final int count = pendingReferenceCount.incrementAndGet();\n-        if (log.isDebugEnabled()) {\n-          log.debug(\n-              \"t_id={} -> registered continuation {} -- count = {}\", traceId, continuation, count);\n-        }\n-      } else {\n-        log.debug(\"continuation {} already registered in trace {}\", continuation, traceId);\n-      }\n+    final int count = pendingReferenceCount.incrementAndGet();\n+    if (log.isDebugEnabled()) {\n+      log.debug(\n+          \"t_id={} -> registered continuation {} -- count = {}\", traceId, continuation, count);\n     }\n   }\n \n   @Override\n   public void cancelContinuation(final AgentScope.Continuation continuation) {\n-    synchronized (continuation) {\n-      if (continuation.isRegistered()) {\n-        continuation.cancel(weakContinuations);\n-        expireReference(false);\n-      } else {\n-        log.debug(\"t_id={} -> not registered in trace: {}\", traceId, continuation);\n-      }\n-    }\n+    expireReference(false);\n   }\n \n   private void expireReference(boolean isRootSpan) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM3NzkxMw=="}, "originalCommit": {"oid": "06e4c04897938ff56d8d3c5cbceeec67ba2eff76"}, "originalPosition": 167}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNzY0MTQwOnYy", "diffSide": "RIGHT", "path": ".palantir/revapi.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNToxNDo0M1rOHd4bYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNToxNDo0M1rOHd4bYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA5NTI2NA==", "bodyText": "let's bin revapi already", "url": "https://github.com/DataDog/dd-trace-java/pull/1952#discussion_r501095264", "createdAt": "2020-10-07T15:14:43Z", "author": {"login": "richardstartin"}, "path": ".palantir/revapi.yml", "diffHunk": "@@ -759,6 +759,12 @@ acceptedBreaks:\n       old: \"method E java.util.concurrent.ConcurrentLinkedDeque<E>::removeLast() @\\\n         \\ datadog.trace.core.PendingTrace\"\n       justification: \"encapsulate PendingTrace better\"\n+    - code: \"java.method.removed\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3361392a9b80dc3f222bb8c708abb84540191084"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4671, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}