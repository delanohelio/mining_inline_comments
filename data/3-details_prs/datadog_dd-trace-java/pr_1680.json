{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4OTM5OTUx", "number": 1680, "title": "Add Service Name Detection (#1649) back in", "bodyText": "Reverts #1663\nWas originally reverted because we suspected it as the problem for the build instability.  We've identified the source of the problem, so this can be added back in.\nDescription\n\nAutomatic detection of the service name based on either JAR or main class.", "createdAt": "2020-07-14T15:05:56Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1680", "merged": true, "mergeCommit": {"oid": "838363f6826f22a783f7f4ca2f6fb0828092faa7"}, "closed": true, "closedAt": "2020-07-22T08:42:12Z", "author": {"login": "tylerbenson"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc03zbpAFqTQ0ODIyMDM5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3Vu9egH2gAyNDQ4OTM5OTUxOjc5Yzc1YTI0ZjA2ZTQ5NDYwNDUwNzk1OTk0YTcwYzkwOWM0NTdkMDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MjIwMzk0", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#pullrequestreview-448220394", "createdAt": "2020-07-14T15:31:06Z", "commit": {"oid": "e74f342027827ddaba40103dfd7caae99b65718d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MjQyNTE4", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#pullrequestreview-448242518", "createdAt": "2020-07-14T15:56:00Z", "commit": {"oid": "e74f342027827ddaba40103dfd7caae99b65718d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNTo1NjowMFrOGxaN4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNTo1NjowMFrOGxaN4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2Mjk0NA==", "bodyText": "Not sure if load this class using this.getClassLoader() is the best approach.", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#discussion_r454462944", "createdAt": "2020-07-14T15:56:00Z", "author": {"login": "drodriguezhdez"}, "path": "utils/test-utils/src/main/groovy/datadog/trace/util/test/DDSpecification.groovy", "diffHunk": "@@ -51,4 +53,19 @@ abstract class DDSpecification extends Specification {\n       .installOn(instrumentation)\n     isConfigInstanceModifiable = true\n   }\n+\n+  //Clean captured environment to avoid affecting Config settings with platform dependant properties.\n+  static void cleanCapturedEnvironment() {\n+    try {\n+      def capturedEnvClass = this.getClassLoader().loadClass(CAPTURED_ENV)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e74f342027827ddaba40103dfd7caae99b65718d"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d7ad6fbd2028bc4a74dda1044c59a51f37045c8", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8d7ad6fbd2028bc4a74dda1044c59a51f37045c8", "committedDate": "2020-07-15T08:31:31Z", "message": "Assert serviceName is not empty"}, "afterCommit": {"oid": "50248c6ede5e6179209f767ed4861f166ed5d8ea", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/50248c6ede5e6179209f767ed4861f166ed5d8ea", "committedDate": "2020-07-15T08:55:59Z", "message": "Assert serviceName is not empty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50248c6ede5e6179209f767ed4861f166ed5d8ea", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/50248c6ede5e6179209f767ed4861f166ed5d8ea", "committedDate": "2020-07-15T08:55:59Z", "message": "Assert serviceName is not empty"}, "afterCommit": {"oid": "bc02ea1a5a5b3df3c69573be7e452814636c96a5", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/bc02ea1a5a5b3df3c69573be7e452814636c96a5", "committedDate": "2020-07-15T15:27:03Z", "message": "Assert serviceName is not empty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "367602488af1a440f8a4ac9266400bf68f796835", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/367602488af1a440f8a4ac9266400bf68f796835", "committedDate": "2020-07-16T07:42:41Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}, "afterCommit": {"oid": "d4f6915ba10627ba959a42c2d33ece47ed8511d2", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d4f6915ba10627ba959a42c2d33ece47ed8511d2", "committedDate": "2020-07-16T08:10:47Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4f6915ba10627ba959a42c2d33ece47ed8511d2", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d4f6915ba10627ba959a42c2d33ece47ed8511d2", "committedDate": "2020-07-16T08:10:47Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}, "afterCommit": {"oid": "367602488af1a440f8a4ac9266400bf68f796835", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/367602488af1a440f8a4ac9266400bf68f796835", "committedDate": "2020-07-16T07:42:41Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "367602488af1a440f8a4ac9266400bf68f796835", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/367602488af1a440f8a4ac9266400bf68f796835", "committedDate": "2020-07-16T07:42:41Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}, "afterCommit": {"oid": "9485cd1e6a0a7e27a3dbb719f3871b98bfeaf2fd", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9485cd1e6a0a7e27a3dbb719f3871b98bfeaf2fd", "committedDate": "2020-07-20T06:33:26Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9485cd1e6a0a7e27a3dbb719f3871b98bfeaf2fd", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9485cd1e6a0a7e27a3dbb719f3871b98bfeaf2fd", "committedDate": "2020-07-20T06:33:26Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}, "afterCommit": {"oid": "6b4e8c047ec4b9301d1906bc7910ebbf15b0bc08", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6b4e8c047ec4b9301d1906bc7910ebbf15b0bc08", "committedDate": "2020-07-20T08:12:03Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNjU0NTI4", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#pullrequestreview-451654528", "createdAt": "2020-07-20T14:22:54Z", "commit": {"oid": "6b4e8c047ec4b9301d1906bc7910ebbf15b0bc08"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNDoyMjo1NFrOG0PdnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNDozMjoxNVrOG0QBXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQzMjQ3Nw==", "bodyText": "What will the new value of this be?", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#discussion_r457432477", "createdAt": "2020-07-20T14:22:54Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/akka-http-10.0/src/lagomTest/groovy/LagomTest.groovy", "diffHunk": "@@ -59,7 +59,7 @@ class LagomTest extends AgentTestRunner {\n     assertTraces(1) {\n       trace(0, 2) {\n         span(0) {\n-          serviceName \"unnamed-java-app\"\n+          hasServiceName()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b4e8c047ec4b9301d1906bc7910ebbf15b0bc08"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQzNDY4Nw==", "bodyText": "When would this ever not be the case?", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#discussion_r457434687", "createdAt": "2020-07-20T14:25:06Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/testing/src/main/groovy/datadog/trace/agent/test/asserts/SpanAssert.groovy", "diffHunk": "@@ -41,6 +41,10 @@ class SpanAssert {\n     }\n   }\n \n+  def hasServiceName() {\n+    assert span.serviceName != null && !span.serviceName.isEmpty()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b4e8c047ec4b9301d1906bc7910ebbf15b0bc08"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ0MTYyOA==", "bodyText": "Could we add a comment to indicate this class should be considered internal, and not depended on directly?  I'd like to avoid adding more classes we have to maintain in the public API.", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#discussion_r457441628", "createdAt": "2020-07-20T14:32:15Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-api/src/main/java/datadog/trace/api/env/CapturedEnvironment.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package datadog.trace.api.env;\n+\n+import datadog.trace.api.config.GeneralConfig;\n+import java.io.File;\n+import java.util.HashMap;\n+import java.util.Map;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+\n+/**\n+ * The {@code CapturedEnvironment} instance keeps those {@code Config} values which are platform\n+ * dependant.\n+ */\n+@Slf4j\n+public class CapturedEnvironment {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b4e8c047ec4b9301d1906bc7910ebbf15b0bc08"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzE1ODk0", "url": "https://github.com/DataDog/dd-trace-java/pull/1680#pullrequestreview-452715894", "createdAt": "2020-07-21T18:18:29Z", "commit": {"oid": "4932666086f7d80d2228001f9213e28a2993c1f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdf1254c494206509b24ef98a3a39d41da929f04", "author": {"user": {"login": "tylerbenson", "name": "Tyler Benson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cdf1254c494206509b24ef98a3a39d41da929f04", "committedDate": "2020-07-22T06:55:48Z", "message": "Rebase master to branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d135c705ad8e3cb82ca2d57f3a03ffcf0f18aed8", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d135c705ad8e3cb82ca2d57f3a03ffcf0f18aed8", "committedDate": "2020-07-22T06:56:34Z", "message": "Assert serviceName is not empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd982cc9a1ecfcd4156c55f995c4f6efdf0962c5", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/fd982cc9a1ecfcd4156c55f995c4f6efdf0962c5", "committedDate": "2020-07-22T06:56:34Z", "message": "Assert serviceName is not empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbce2965ff931dd1e5a6b4e1c520fbaf89f59131", "author": {"user": {"login": "tylerbenson", "name": "Tyler Benson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/dbce2965ff931dd1e5a6b4e1c520fbaf89f59131", "committedDate": "2020-07-22T07:03:33Z", "message": "Revert \"Revert \"Merge pull request #1649 from DataDog/drodriguezhdez/automati\u2026\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be55c25d5bd0f229e61ea3363bdbf9b98cdf66b8", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/be55c25d5bd0f229e61ea3363bdbf9b98cdf66b8", "committedDate": "2020-07-22T07:03:39Z", "message": "Assert serviceName is not empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c165a90a7d4a901fd1b837d785d52ec69d8128d", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2c165a90a7d4a901fd1b837d785d52ec69d8128d", "committedDate": "2020-07-22T07:03:39Z", "message": "Assert serviceName is not empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72d743aeeb020dadb1b369af3e67512665954b92", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/72d743aeeb020dadb1b369af3e67512665954b92", "committedDate": "2020-07-22T07:03:39Z", "message": "Adapt test dd-trace-core to assert serviceName is present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "600d520b5e3c90c777fbf4b9aefaee1ba70818ef", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/600d520b5e3c90c777fbf4b9aefaee1ba70818ef", "committedDate": "2020-07-22T07:03:39Z", "message": "Apply suggestions from PR feedback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c340651ba734f617f58e42e4ab4a09ef83c61368", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c340651ba734f617f58e42e4ab4a09ef83c61368", "committedDate": "2020-07-22T07:03:39Z", "message": "hasServiceName is asserted in assertDefaults() at SpanAssert"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4932666086f7d80d2228001f9213e28a2993c1f4", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/4932666086f7d80d2228001f9213e28a2993c1f4", "committedDate": "2020-07-21T06:41:34Z", "message": "Apply suggestions from PR feedback."}, "afterCommit": {"oid": "c340651ba734f617f58e42e4ab4a09ef83c61368", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c340651ba734f617f58e42e4ab4a09ef83c61368", "committedDate": "2020-07-22T07:03:39Z", "message": "hasServiceName is asserted in assertDefaults() at SpanAssert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79c75a24f06e49460450795994a70c909c457d06", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/79c75a24f06e49460450795994a70c909c457d06", "committedDate": "2020-07-22T07:31:13Z", "message": "Assert serviceName is not empty in LogContextInjectionTestBase"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2259, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}