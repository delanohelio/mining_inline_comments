{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxODgwODc5", "number": 1564, "title": "Circleci config cleanup", "bodyText": "General refactor of the CircleCI config.  Removes ~100 lines and gets rid of a lot of repetition.\n\nUse a matrix build instead of defining each job separately (test_7, test_11, etc )\nHave agent_integration_tests extend default_test_job\nextract common gradle flags\nsplit gradle commands over multiple lines for easier readability\n\nFuture work\n\nunifying GRADLE_OPS and --max-workers .  That will require some experimentation but I think we can use a global values for all instead of slightly different versions for each job\nExperimenting with different resource_class values for higher job throughput\nPulling out \"collect reports\" and \"collect test results\" into reusable commands", "createdAt": "2020-06-09T15:22:09Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1564", "merged": true, "mergeCommit": {"oid": "277ff364d18688f08a133ac8f09c97b4ce09b838"}, "closed": true, "closedAt": "2020-06-09T18:33:03Z", "author": {"login": "randomanderson"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpl7TDAH2gAyNDMxODgwODc5OjJjNGFhMjEzZmNjMWZmMGUyMTMwZWI4OTJiMTY3OWViYjZjMGFlNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpoZOeAFqTQyNzM3OTgyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c4aa213fcc1ff0e2130eb892b1679ebb6c0ae60", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2c4aa213fcc1ff0e2130eb892b1679ebb6c0ae60", "committedDate": "2020-06-09T14:28:14Z", "message": "Refactor circleci config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a0b0db827a4eec890fb151afba05a28fa2fceda", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8a0b0db827a4eec890fb151afba05a28fa2fceda", "committedDate": "2020-06-09T14:49:20Z", "message": "split gradle lines up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzA2OTgw", "url": "https://github.com/DataDog/dd-trace-java/pull/1564#pullrequestreview-427306980", "createdAt": "2020-06-09T15:52:45Z", "commit": {"oid": "8a0b0db827a4eec890fb151afba05a28fa2fceda"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a6275a11eb2df287abf04d0336395587d7c070", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/77a6275a11eb2df287abf04d0336395587d7c070", "committedDate": "2020-06-09T16:26:48Z", "message": "extract gradle flags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3Mzc5ODI1", "url": "https://github.com/DataDog/dd-trace-java/pull/1564#pullrequestreview-427379825", "createdAt": "2020-06-09T17:20:10Z", "commit": {"oid": "77a6275a11eb2df287abf04d0336395587d7c070"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyMDoxMFrOGhUn9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyMDoxMFrOGhUn9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDEwMQ==", "bodyText": "Any reason you made these UPPERCASE?", "url": "https://github.com/DataDog/dd-trace-java/pull/1564#discussion_r437594101", "createdAt": "2020-06-09T17:20:10Z", "author": {"login": "tylerbenson"}, "path": ".circleci/config.yml", "diffHunk": "@@ -229,99 +165,63 @@ jobs:\n \n       - run:\n           name: Gather muzzle tasks\n-          command: SKIP_BUILDSCAN=\"true\" ./gradlew writeMuzzleTasksToFile --stacktrace --no-daemon\n+          command: >-\n+            SKIP_BUILDSCAN=\"true\"\n+            ./gradlew writeMuzzleTasksToFile\n+            << pipeline.parameters.gradle_flags >>\n+            --max-workers=8\n+\n       - run:\n           name: Verify Muzzle\n           command: >-\n             SKIP_BUILDSCAN=\"true\"\n             GRADLE_OPTS=\"-Dorg.gradle.jvmargs='-Xmx4G -Xms64M' -Ddatadog.forkedMaxHeapSize=4G -Ddatadog.forkedMinHeapSize=64M\"\n-            ./gradlew `circleci tests split workspace/build/muzzleTasks | xargs` --parallel --stacktrace --no-daemon --max-workers=16\n+            ./gradlew `circleci tests split workspace/build/muzzleTasks | xargs`\n+            << pipeline.parameters.gradle_flags >>\n+            --max-workers=16\n \n workflows:\n-  version: 2\n   build_test_deploy:\n     jobs:\n       - build:\n           filters:\n             tags:\n               only: /.*/\n \n-      - test_7:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_latest8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_ibm8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_zulu8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_11:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_zulu11:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_12:\n+      - default_test_job:\n           requires:\n             - build\n+          prefixTestTask: true\n+          name: test_<< matrix.testTask >>\n+          matrix:\n+            parameters:\n+              testTask: [\"7\", \"IBM8\", \"ZULU8\", \"11\", \"ZULU11\", \"12\", \"13\", \"ZULU13\", \"14\", \"ZULU14\" ]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a6275a11eb2df287abf04d0336395587d7c070"}, "originalPosition": 250}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2392, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}