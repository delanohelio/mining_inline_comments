{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NjE0MzE3", "number": 1759, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzo0ODoyNlrOEWOOpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNjozMTo1N1rOEWR4sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzM3MjUyOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/aws-java-sdk-1.11.0/src/main/java/datadog/trace/instrumentation/aws/v0/AwsSdkClientDecorator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzo0ODoyNlrOG9aldw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNTozMDowN1rOG9eTCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA1MTg5NQ==", "bodyText": "I noticed based on the contents of serviceNames and operationNames in a customer heap dump, and afterwards consulting the AWS SDK, that caching the resource name would be very low cardinality and a quick win.", "url": "https://github.com/DataDog/dd-trace-java/pull/1759#discussion_r467051895", "createdAt": "2020-08-07T13:48:26Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/instrumentation/aws-java-sdk-1.11.0/src/main/java/datadog/trace/instrumentation/aws/v0/AwsSdkClientDecorator.java", "diffHunk": "@@ -7,18 +7,34 @@\n import datadog.trace.api.DDTags;\n import datadog.trace.bootstrap.ContextStore;\n import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.Function;\n+import datadog.trace.bootstrap.instrumentation.api.Functions;\n import datadog.trace.bootstrap.instrumentation.api.InstrumentationTags;\n+import datadog.trace.bootstrap.instrumentation.api.QualifiedClassNameCache;\n import datadog.trace.bootstrap.instrumentation.decorator.HttpClientDecorator;\n import java.net.URI;\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n \n public class AwsSdkClientDecorator extends HttpClientDecorator<Request, Response> {\n \n   static final String COMPONENT_NAME = \"java-aws-sdk\";\n \n-  private final Map<String, String> serviceNames = new ConcurrentHashMap<>();\n-  private final Map<Class, String> operationNames = new ConcurrentHashMap<>();\n+  private final QualifiedClassNameCache cache =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71406e734589995bd59e850aeff6af1aff6c6fb4"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzExMjcxMw==", "bodyText": "Nice catch!", "url": "https://github.com/DataDog/dd-trace-java/pull/1759#discussion_r467112713", "createdAt": "2020-08-07T15:30:07Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/aws-java-sdk-1.11.0/src/main/java/datadog/trace/instrumentation/aws/v0/AwsSdkClientDecorator.java", "diffHunk": "@@ -7,18 +7,34 @@\n import datadog.trace.api.DDTags;\n import datadog.trace.bootstrap.ContextStore;\n import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.Function;\n+import datadog.trace.bootstrap.instrumentation.api.Functions;\n import datadog.trace.bootstrap.instrumentation.api.InstrumentationTags;\n+import datadog.trace.bootstrap.instrumentation.api.QualifiedClassNameCache;\n import datadog.trace.bootstrap.instrumentation.decorator.HttpClientDecorator;\n import java.net.URI;\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n \n public class AwsSdkClientDecorator extends HttpClientDecorator<Request, Response> {\n \n   static final String COMPONENT_NAME = \"java-aws-sdk\";\n \n-  private final Map<String, String> serviceNames = new ConcurrentHashMap<>();\n-  private final Map<Class, String> operationNames = new ConcurrentHashMap<>();\n+  private final QualifiedClassNameCache cache =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA1MTg5NQ=="}, "originalCommit": {"oid": "71406e734589995bd59e850aeff6af1aff6c6fb4"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzk3MTcxOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/api/Function.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNjozMTo1N1rOG9gVig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNjo0MzoxMVrOG9grRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE0NjEyMg==", "bodyText": "why you called this just Function ?\nIn disregard your comment:\nhttps://github.com/DataDog/dd-trace-java/pull/1759/files#diff-3438fdfbe14e3ba1c3a3e78ef37f7637R3", "url": "https://github.com/DataDog/dd-trace-java/pull/1759#discussion_r467146122", "createdAt": "2020-08-07T16:31:57Z", "author": {"login": "lpriima"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/api/Function.java", "diffHunk": "@@ -0,0 +1,5 @@\n+package datadog.trace.bootstrap.instrumentation.api;\n+\n+public interface Function<T, U> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1adaa7480ba3e51e45868ac7d24168e8c7859da9"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE1MTY4NQ==", "bodyText": "It's different. This is a function. We will search and replace datadog.trace.bootstrap.instrumentation.api.Function with java.util.function.Function when we drop JDK7. The other one differs to BiFunction in its interface.", "url": "https://github.com/DataDog/dd-trace-java/pull/1759#discussion_r467151685", "createdAt": "2020-08-07T16:43:11Z", "author": {"login": "richardstartin"}, "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/api/Function.java", "diffHunk": "@@ -0,0 +1,5 @@\n+package datadog.trace.bootstrap.instrumentation.api;\n+\n+public interface Function<T, U> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE0NjEyMg=="}, "originalCommit": {"oid": "1adaa7480ba3e51e45868ac7d24168e8c7859da9"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 5, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}