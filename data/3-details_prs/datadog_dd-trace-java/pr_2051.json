{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDQxMjI1", "number": 2051, "title": "Added configuration to embed exception in message instead of using printStackTrace", "bodyText": "To avoid receiving the stack trace over multiple lines and send receive it as a single message I have added an option (embedException, which defaults to false for backward compatibility).\nThe format in case this feature is enabled looks like\n<usual logline> <message> [exception:<exception type>: <message> <stack frame>, <stack frame>, ..]\n\nwhere the content of the exception tag can be pasted in IntelliJ stack analyzer too.", "createdAt": "2020-11-04T14:59:04Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2051", "merged": true, "mergeCommit": {"oid": "85da4b6e399471f0d5efaa93de917e87d1c6b37f"}, "closed": true, "closedAt": "2020-11-10T07:57:09Z", "author": {"login": "mellon85"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZPFdigH2gAyNTE1NDQxMjI1OmQyMGE0N2QyMzE4N2NlNTgwNjM4N2QyNzQyYmViMTUzMWI2ZDFmMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda2XoUgFqTUyNjM2MDc5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d20a47d23187ce5806387d2742beb1531b6d1f0f", "author": {"user": {"login": "mellon85", "name": "Dario Meloni"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d20a47d23187ce5806387d2742beb1531b6d1f0f", "committedDate": "2020-11-04T14:59:53Z", "message": "Added configuration to embed exception in message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46bcf9b52d47d479ed97ba6bceeccda7d3c31c41", "author": {"user": {"login": "mellon85", "name": "Dario Meloni"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/46bcf9b52d47d479ed97ba6bceeccda7d3c31c41", "committedDate": "2020-11-04T13:41:41Z", "message": "Added configuration to embed exception in message"}, "afterCommit": {"oid": "d20a47d23187ce5806387d2742beb1531b6d1f0f", "author": {"user": {"login": "mellon85", "name": "Dario Meloni"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d20a47d23187ce5806387d2742beb1531b6d1f0f", "committedDate": "2020-11-04T14:59:53Z", "message": "Added configuration to embed exception in message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjY4OTUy", "url": "https://github.com/DataDog/dd-trace-java/pull/2051#pullrequestreview-524268952", "createdAt": "2020-11-05T13:40:47Z", "commit": {"oid": "d20a47d23187ce5806387d2742beb1531b6d1f0f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMzo0MDo0N1rOHuDvCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMzo0MDo0N1rOHuDvCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NzczNw==", "bodyText": "just curious: will this format be compatible with IntelliJ analyse window?", "url": "https://github.com/DataDog/dd-trace-java/pull/2051#discussion_r518057737", "createdAt": "2020-11-05T13:40:47Z", "author": {"login": "lb5tr"}, "path": "dd-java-agent/agent-logging/src/test/groovy/datadog/trace/logging/simplelogger/SLCompatHelperTest.groovy", "diffHunk": "@@ -97,6 +97,24 @@ class SLCompatHelperTest extends Specification {\n     outputStream.toString() == \"[$thread] ERROR foo - log\\n${NoStackException.getName()}: wrong\\n\"\n   }\n \n+  def \"test logging with an embedded exception in the message\"() {\n+    setup:\n+    def outputStream = new ByteArrayOutputStream()\n+    def printStream = new PrintStream(outputStream, true)\n+    def props = new Properties()\n+    props.setProperty(SLCompatSettings.Keys.EMBED_EXCEPTION, \"true\")\n+    def settings = new SLCompatSettings(props, new Properties(), printStream)\n+    def helper = new SLCompatHelper(\"foo\", settings)\n+    try {\n+      throw new IOException(\"wrong\")\n+    } catch(Exception exception) {\n+      helper.log(LogLevel.ERROR, \"log\", exception)\n+    }\n+\n+    expect:\n+    outputStream.toString() ==~ /^.* ERROR foo - log \\[exception:java\\.io\\.IOException: wrong\\]\\[stack:\\[.*\\]\\]\\n$/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d20a47d23187ce5806387d2742beb1531b6d1f0f"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c298611970f8c1a5e3369940735c67a09f359fdf", "author": {"user": {"login": "mellon85", "name": "Dario Meloni"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c298611970f8c1a5e3369940735c67a09f359fdf", "committedDate": "2020-11-06T12:02:57Z", "message": "Formatted the stack trace for IntelliJ\n\nChanged the structure of the log to support pasting it in IntelliJ stack\nstrace analyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c9d7756c007b3144914b1b2ae8fe11fffa388dd", "author": {"user": {"login": "mellon85", "name": "Dario Meloni"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8c9d7756c007b3144914b1b2ae8fe11fffa388dd", "committedDate": "2020-11-06T15:15:54Z", "message": "Fixed test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MzYwNzkz", "url": "https://github.com/DataDog/dd-trace-java/pull/2051#pullrequestreview-526360793", "createdAt": "2020-11-09T15:19:57Z", "commit": {"oid": "8c9d7756c007b3144914b1b2ae8fe11fffa388dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3078, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}