{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MjE4Njk4", "number": 2022, "title": "Elasticsearch 7 instrumentation", "bodyText": "", "createdAt": "2020-10-22T11:27:05Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2022", "merged": true, "mergeCommit": {"oid": "097284d8749920c03978b501fa0a4e83378aedf0"}, "closed": true, "closedAt": "2020-10-23T22:29:28Z", "author": {"login": "mcculls"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVBVAvAFqTUxNDY4MTM0Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVcKinAFqTUxNTk3Mjc5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjgxMzQz", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#pullrequestreview-514681343", "createdAt": "2020-10-22T12:42:30Z", "commit": {"oid": "f5e23acadaa06995e369636ac40c79a47d017add"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjo0MjozMFrOHmfx0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjo0MjozMFrOHmfx0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyODU5NA==", "bodyText": "I'm a bit confused about this (to be honest about muzzle in general), but this seems to say that it should fail for no versions, since (,) is non inclusive, and then pass for all versions, because of the assertInverse = true. Is this correct, and if so, is there no clearer way to write it?", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#discussion_r510128594", "createdAt": "2020-10-22T12:42:30Z", "author": {"login": "bantonsson"}, "path": "dd-java-agent/instrumentation/elasticsearch/rest-7/rest-7.gradle", "diffHunk": "@@ -0,0 +1,51 @@\n+// Set properties before any plugins get loaded\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = \"org.elasticsearch.client\"\n+    module = \"elasticsearch-rest-client\"\n+    versions = \"[7,)\"\n+    assertInverse = true\n+  }\n+\n+  fail {\n+    group = \"org.elasticsearch.client\"\n+    module = \"rest\"\n+    versions = \"(,)\"\n+    assertInverse = true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5e23acadaa06995e369636ac40c79a47d017add"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57c7341fe9e5295760cdf02c1d04fe4377fb3dd2", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/57c7341fe9e5295760cdf02c1d04fe4377fb3dd2", "committedDate": "2020-10-23T11:46:56Z", "message": "Elasticsearch 7 instrumentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e2355fc1893353e092c3184ba0cfed933146ed6", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0e2355fc1893353e092c3184ba0cfed933146ed6", "committedDate": "2020-10-23T11:46:56Z", "message": "unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e45754c0e4b4b8925df738b55ac8c1313581b6c9", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e45754c0e4b4b8925df738b55ac8c1313581b6c9", "committedDate": "2020-10-23T11:46:56Z", "message": "Map AutoPutMappingAction back to PutMappingAction on ES 7.9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d008406b07ce5d298389838eb344b5b5e561b39", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8d008406b07ce5d298389838eb344b5b5e561b39", "committedDate": "2020-10-23T11:46:56Z", "message": "Add classloader matcher to make sure the new advice only applies to ES7\n\nThis is because the client in ES7 has been simplified so the best place\nto intercept is the public top-level methods. Since these methods also\nexisted in previous releases we don't want our ES7 advice to also apply\nthere otherwise we'd get duplicated spans."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5614320e646a08547562e87812c8b2bd20f8e6b", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c5614320e646a08547562e87812c8b2bd20f8e6b", "committedDate": "2020-10-23T11:46:56Z", "message": "Cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5fbf6447da926b264d8e32d28a47140bdca4ad1", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e5fbf6447da926b264d8e32d28a47140bdca4ad1", "committedDate": "2020-10-23T11:25:06Z", "message": "Cleanup"}, "afterCommit": {"oid": "c5614320e646a08547562e87812c8b2bd20f8e6b", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c5614320e646a08547562e87812c8b2bd20f8e6b", "committedDate": "2020-10-23T11:46:56Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/01eeba6f39673d75e5522f8130eed048213c7ffb", "committedDate": "2020-10-23T13:31:35Z", "message": "Apply ElasticsearchBreakTraceInstrumentation workaround ES 7 transport tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1Nzk4ODg2", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#pullrequestreview-515798886", "createdAt": "2020-10-23T15:53:16Z", "commit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODExMDQy", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#pullrequestreview-515811042", "createdAt": "2020-10-23T16:08:29Z", "commit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjowODoyOVrOHnUWhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjoxNTo1MVrOHnUnQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4OTk1OA==", "bodyText": "General comment, I would love for us to use testcontainers or something else off-jvm so don't have to worry about things like this", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#discussion_r510989958", "createdAt": "2020-10-23T16:08:29Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/instrumentation/elasticsearch/rest-7/rest-7.gradle", "diffHunk": "@@ -0,0 +1,52 @@\n+// Set properties before any plugins get loaded\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = \"org.elasticsearch.client\"\n+    module = \"elasticsearch-rest-client\"\n+    versions = \"[7,)\"\n+    assertInverse = true\n+  }\n+\n+  fail {\n+    group = \"org.elasticsearch.client\"\n+    module = \"rest\"\n+    versions = \"[,]\" // legacy artifact, all versions should fail\n+  }\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+testSets {\n+  latestDepTest {\n+    dirName = 'test'\n+  }\n+}\n+\n+dependencies {\n+  compileOnly group: 'org.elasticsearch.client', name: 'elasticsearch-rest-client', version: '7.0.0'\n+\n+  compile project(':dd-java-agent:instrumentation:elasticsearch')\n+\n+  testCompile project(':dd-java-agent:instrumentation:apache-httpclient-4')\n+  testCompile project(':dd-java-agent:instrumentation:apache-httpasyncclient-4')\n+  // Netty is used, but it adds complexity to the tests since we're using embedded ES.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5NDI0MQ==", "bodyText": "Is there another version of the transport instrumentation that covers the earlier 7.x versions?", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#discussion_r510994241", "createdAt": "2020-10-23T16:15:51Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/instrumentation/elasticsearch/transport-7.3/transport-7.3.gradle", "diffHunk": "@@ -0,0 +1,50 @@\n+// Set properties before any plugins get loaded\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_8\n+}\n+\n+muzzle {\n+  pass {\n+    group = \"org.elasticsearch.client\"\n+    module = \"transport\"\n+    versions = \"[7.3,]\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTcyNzk4", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#pullrequestreview-515972798", "createdAt": "2020-10-23T19:55:37Z", "commit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOTo1NTozN1rOHnctOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOTo1NTozN1rOHnctOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEyNjg0MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/DataDog/dd-trace-java/pull/2022#discussion_r511126841", "createdAt": "2020-10-23T19:55:37Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/elasticsearch/rest-7/src/main/java/datadog/trace/instrumentation/elasticsearch7/RestResponseListener.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package datadog.trace.instrumentation.elasticsearch7;\n+\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.instrumentation.elasticsearch.ElasticsearchRestClientDecorator;\n+import org.elasticsearch.client.Response;\n+import org.elasticsearch.client.ResponseListener;\n+\n+/** This class is identical to version 6's instrumentation. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01eeba6f39673d75e5522f8130eed048213c7ffb"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3036, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}