{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MjI0ODUx", "number": 1769, "title": "add more testing around dictionary encoding of traces", "bodyText": "", "createdAt": "2020-08-13T08:14:18Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1769", "merged": true, "mergeCommit": {"oid": "1bae0fb69508eaa9f8b1ff9238e0a662c12f7f2d"}, "closed": true, "closedAt": "2020-08-13T12:15:35Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-bhjEAH2gAyNDY3MjI0ODUxOmE3ODA3YWVlN2YyODFhN2EwZGZhOTNhZDRkZmRhODBjYzc1ZDQzZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-ejuzAH2gAyNDY3MjI0ODUxOjYxMGVlZDBiODk1ZDE0Zjc4YTNjMDUxZWUyYjM0NDcxMDU5NmRmYTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7807aee7f281a7a0dfa93ad4dfda80cc75d43d7", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a7807aee7f281a7a0dfa93ad4dfda80cc75d43d7", "committedDate": "2020-08-13T08:13:28Z", "message": "add more testing around dictionary encoding of traces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7764a96b1ad567795f1d72017dec293bd2c061ef", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/7764a96b1ad567795f1d72017dec293bd2c061ef", "committedDate": "2020-08-13T08:53:15Z", "message": "add randomised serialisation test for v0.4 traces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f020a02b96e4db09ec1744c219e9089be4dbe6c2", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f020a02b96e4db09ec1744c219e9089be4dbe6c2", "committedDate": "2020-08-13T09:01:30Z", "message": "generate long tag values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d5e03bc1bd83f87b0afe1e7b2c4df508131e486", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/2d5e03bc1bd83f87b0afe1e7b2c4df508131e486", "committedDate": "2020-08-13T09:34:22Z", "message": "codenarc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4273a5a23d69112067b75d1dbace3fc6120a5b3", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a4273a5a23d69112067b75d1dbace3fc6120a5b3", "committedDate": "2020-08-13T09:40:30Z", "message": "test with UTF8ByteString"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NjcxMzg1", "url": "https://github.com/DataDog/dd-trace-java/pull/1769#pullrequestreview-466671385", "createdAt": "2020-08-13T11:23:24Z", "commit": {"oid": "a4273a5a23d69112067b75d1dbace3fc6120a5b3"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToyMzoyNFrOHAHQYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMTozMToxOFrOHAHe3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4MDkzMQ==", "bodyText": "import static org.msgpack.core.MessageFormat.*?", "url": "https://github.com/DataDog/dd-trace-java/pull/1769#discussion_r469880931", "createdAt": "2020-08-13T11:23:24Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/test/groovy/datadog/trace/common/writer/ddagent/TraceMapperV04PayloadTest.groovy", "diffHunk": "@@ -0,0 +1,224 @@\n+package datadog.trace.common.writer.ddagent\n+\n+\n+import datadog.trace.core.DDSpanData\n+import datadog.trace.core.serialization.msgpack.ByteBufferConsumer\n+import datadog.trace.core.serialization.msgpack.Packer\n+import datadog.trace.util.test.DDSpecification\n+import org.junit.Assert\n+import org.msgpack.core.MessageFormat\n+import org.msgpack.core.MessagePack\n+import org.msgpack.core.MessageUnpacker\n+\n+import java.nio.BufferOverflowException\n+import java.nio.ByteBuffer\n+import java.nio.channels.WritableByteChannel\n+\n+import static datadog.trace.common.writer.ddagent.TraceGenerator.generateRandomTraces\n+import static org.junit.Assert.assertEquals\n+import static org.msgpack.core.MessageFormat.FLOAT32\n+import static org.msgpack.core.MessageFormat.FLOAT64\n+import static org.msgpack.core.MessageFormat.INT16\n+import static org.msgpack.core.MessageFormat.INT32\n+import static org.msgpack.core.MessageFormat.INT64\n+import static org.msgpack.core.MessageFormat.INT8\n+import static org.msgpack.core.MessageFormat.NEGFIXINT\n+import static org.msgpack.core.MessageFormat.POSFIXINT\n+import static org.msgpack.core.MessageFormat.UINT16\n+import static org.msgpack.core.MessageFormat.UINT32\n+import static org.msgpack.core.MessageFormat.UINT64\n+import static org.msgpack.core.MessageFormat.UINT8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4273a5a23d69112067b75d1dbace3fc6120a5b3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4MTQyMg==", "bodyText": "Why change this?", "url": "https://github.com/DataDog/dd-trace-java/pull/1769#discussion_r469881422", "createdAt": "2020-08-13T11:24:31Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/test/groovy/datadog/trace/common/writer/ddagent/TraceMapperV05PayloadTest.groovy", "diffHunk": "@@ -13,22 +12,30 @@ import org.msgpack.core.MessageUnpacker\n \n import java.nio.ByteBuffer\n import java.nio.channels.WritableByteChannel\n-import java.util.concurrent.ThreadLocalRandom\n-import java.util.concurrent.TimeUnit\n \n+import static datadog.trace.common.writer.ddagent.TraceGenerator.generateRandomTraces\n import static org.junit.Assert.assertEquals\n-\n-import static org.msgpack.core.MessageFormat.*\n+import static org.msgpack.core.MessageFormat.FLOAT32", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4273a5a23d69112067b75d1dbace3fc6120a5b3"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4MTk3Mg==", "bodyText": "Wrong test name?", "url": "https://github.com/DataDog/dd-trace-java/pull/1769#discussion_r469881972", "createdAt": "2020-08-13T11:25:37Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/test/groovy/datadog/trace/common/writer/ddagent/TraceMapperV04PayloadTest.groovy", "diffHunk": "@@ -0,0 +1,224 @@\n+package datadog.trace.common.writer.ddagent\n+\n+\n+import datadog.trace.core.DDSpanData\n+import datadog.trace.core.serialization.msgpack.ByteBufferConsumer\n+import datadog.trace.core.serialization.msgpack.Packer\n+import datadog.trace.util.test.DDSpecification\n+import org.junit.Assert\n+import org.msgpack.core.MessageFormat\n+import org.msgpack.core.MessagePack\n+import org.msgpack.core.MessageUnpacker\n+\n+import java.nio.BufferOverflowException\n+import java.nio.ByteBuffer\n+import java.nio.channels.WritableByteChannel\n+\n+import static datadog.trace.common.writer.ddagent.TraceGenerator.generateRandomTraces\n+import static org.junit.Assert.assertEquals\n+import static org.msgpack.core.MessageFormat.FLOAT32\n+import static org.msgpack.core.MessageFormat.FLOAT64\n+import static org.msgpack.core.MessageFormat.INT16\n+import static org.msgpack.core.MessageFormat.INT32\n+import static org.msgpack.core.MessageFormat.INT64\n+import static org.msgpack.core.MessageFormat.INT8\n+import static org.msgpack.core.MessageFormat.NEGFIXINT\n+import static org.msgpack.core.MessageFormat.POSFIXINT\n+import static org.msgpack.core.MessageFormat.UINT16\n+import static org.msgpack.core.MessageFormat.UINT32\n+import static org.msgpack.core.MessageFormat.UINT64\n+import static org.msgpack.core.MessageFormat.UINT8\n+\n+class TraceMapperV04PayloadTest extends DDSpecification {\n+\n+  def \"test dictionary compressed traces written correctly\" () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4273a5a23d69112067b75d1dbace3fc6120a5b3"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4NDYzOA==", "bodyText": "Why the shifts here? I don't get them.", "url": "https://github.com/DataDog/dd-trace-java/pull/1769#discussion_r469884638", "createdAt": "2020-08-13T11:31:18Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/test/groovy/datadog/trace/common/writer/ddagent/TraceMapperV05PayloadTest.groovy", "diffHunk": "@@ -39,15 +46,42 @@ class TraceMapperV05PayloadTest extends DDSpecification {\n     verifier.verifyTracesConsumed()\n \n     where:\n-    bufferSize    |   traceCount\n-    100 << 10     |       0\n-    100 << 10     |       1\n-    100 << 10     |       10\n-    100 << 10     |       100\n+    bufferSize    | dictionarySize |   traceCount   | lowCardinality\n+    10 << 10      |   10 << 10     |       0        | true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4273a5a23d69112067b75d1dbace3fc6120a5b3"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "610eed0b895d14f78a3c051ee2b344710596dfa5", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/610eed0b895d14f78a3c051ee2b344710596dfa5", "committedDate": "2020-08-13T11:45:34Z", "message": "nitpicks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2124, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}