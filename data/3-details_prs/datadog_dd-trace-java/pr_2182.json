{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDY5NDQ5", "number": 2182, "title": "Exception in TraceInterceptor crashes PendingTraceBuffer", "bodyText": "In the ScopeManager Audit PR, I discovered that throwing an exception in a TraceInterceptor crashes the PendingTraceBuffer thread and delayed reported traces never get reported again.\nThis PR fixes that problem with a simple try..catch around the interceptor call.", "createdAt": "2020-12-09T21:15:48Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2182", "merged": true, "mergeCommit": {"oid": "ddb22b399014a068b588d5bf3e8479d0f021680c"}, "closed": true, "closedAt": "2020-12-10T21:42:21Z", "author": {"login": "randomanderson"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdklXuxgH2gAyNTM1NDY5NDQ5OmE5MjhiNzcyMjQxNzQ3OGRmZjAwMWZjNWJhNjA2ZDFkMTU4NjBkMmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk0gqfgFqTU0OTI3MTMzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a928b7722417478dff001fc5ba606d1d15860d2e", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/a928b7722417478dff001fc5ba606d1d15860d2e", "committedDate": "2020-12-09T21:10:55Z", "message": "Exception in TraceInterceptor crashes PendingTraceBuffer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NjI4MDcy", "url": "https://github.com/DataDog/dd-trace-java/pull/2182#pullrequestreview-548628072", "createdAt": "2020-12-09T21:33:33Z", "commit": {"oid": "a928b7722417478dff001fc5ba606d1d15860d2e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMTozMzozM1rOICqfWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMTozMzozM1rOICqfWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2NDIxOA==", "bodyText": "Should this be inverted, so that interceptors which run after the failing interceptor are still run?", "url": "https://github.com/DataDog/dd-trace-java/pull/2182#discussion_r539664218", "createdAt": "2020-12-09T21:33:33Z", "author": {"login": "richardstartin"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -417,8 +417,14 @@ void write(final List<DDSpan> trace) {\n     List<DDSpan> writtenTrace = trace;\n     if (!interceptors.isEmpty()) {\n       Collection<? extends MutableSpan> interceptedTrace = new ArrayList<>(trace);\n-      for (final TraceInterceptor interceptor : interceptors) {\n-        interceptedTrace = interceptor.onTraceComplete(interceptedTrace);\n+\n+      try {\n+        for (final TraceInterceptor interceptor : interceptors) {\n+          interceptedTrace = interceptor.onTraceComplete(interceptedTrace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a928b7722417478dff001fc5ba606d1d15860d2e"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDE1NjM5", "url": "https://github.com/DataDog/dd-trace-java/pull/2182#pullrequestreview-549015639", "createdAt": "2020-12-10T09:45:18Z", "commit": {"oid": "a928b7722417478dff001fc5ba606d1d15860d2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDQ5ODkw", "url": "https://github.com/DataDog/dd-trace-java/pull/2182#pullrequestreview-549049890", "createdAt": "2020-12-10T10:20:48Z", "commit": {"oid": "a928b7722417478dff001fc5ba606d1d15860d2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MjcxMzMz", "url": "https://github.com/DataDog/dd-trace-java/pull/2182#pullrequestreview-549271333", "createdAt": "2020-12-10T14:49:15Z", "commit": {"oid": "a928b7722417478dff001fc5ba606d1d15860d2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2729, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}