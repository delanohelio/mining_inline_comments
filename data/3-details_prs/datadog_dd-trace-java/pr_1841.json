{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNDc3NjIy", "number": 1841, "title": "Add the EnsureTrace prioritization strategy.", "bodyText": "Added a new PrioritizationStrategy tries to offer the trace to the primary queue until the queue.offer(...) method returns true. This type can be configured via Config.\nThis new type is needed to avoid losing spans in CI/Tests traces. It should not be used in applications in production mode.", "createdAt": "2020-09-07T15:14:37Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1841", "merged": true, "mergeCommit": {"oid": "372d494bbaa13a74ace745853eb3cb956bf0c700"}, "closed": true, "closedAt": "2020-09-10T07:07:45Z", "author": {"login": "drodriguezhdez"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGlBZwAFqTQ4MzY0MTYxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHPvUdAFqTQ4NTI1MDQ1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjQxNjEz", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#pullrequestreview-483641613", "createdAt": "2020-09-07T15:47:09Z", "commit": {"oid": "6e86396e8cb79e9bbc9533c451f5817fff915516"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNTo0NzowOVrOHODk7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNTo0ODoyMFrOHODmrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwMDcxNw==", "bodyText": "If you rebase off master there is a configProvider.getEnum which would clean this up I think. The configuration parameter would be defined by the enum values themselves.", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#discussion_r484500717", "createdAt": "2020-09-07T15:47:09Z", "author": {"login": "richardstartin"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -537,8 +539,20 @@ private static Writer createWriter(\n             TimeUnit.SECONDS.toMillis(config.getAgentTimeout()),\n             Config.get().isTraceAgentV05Enabled());\n \n+    final String prioritizationType = config.getPrioritizationType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e86396e8cb79e9bbc9533c451f5817fff915516"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwMTE2Ng==", "bodyText": "Please use the enum instead", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#discussion_r484501166", "createdAt": "2020-09-07T15:48:20Z", "author": {"login": "richardstartin"}, "path": "internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/PrioritizationConstants.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package datadog.trace.bootstrap.instrumentation.api;\n+\n+public final class PrioritizationConstants {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e86396e8cb79e9bbc9533c451f5817fff915516"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f74f520171c76792a924716af204295cc072d80c", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f74f520171c76792a924716af204295cc072d80c", "committedDate": "2020-09-07T15:49:33Z", "message": "Add the EnsureTrace prioritization strategy."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e86396e8cb79e9bbc9533c451f5817fff915516", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6e86396e8cb79e9bbc9533c451f5817fff915516", "committedDate": "2020-09-07T15:08:41Z", "message": "Add the EnsureTrace prioritization strategy."}, "afterCommit": {"oid": "f74f520171c76792a924716af204295cc072d80c", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f74f520171c76792a924716af204295cc072d80c", "committedDate": "2020-09-07T15:49:33Z", "message": "Add the EnsureTrace prioritization strategy."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjQ2NTE1", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#pullrequestreview-483646515", "createdAt": "2020-09-07T15:57:37Z", "commit": {"oid": "f74f520171c76792a924716af204295cc072d80c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjUwMjcz", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#pullrequestreview-483650273", "createdAt": "2020-09-07T16:06:31Z", "commit": {"oid": "f74f520171c76792a924716af204295cc072d80c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35716c71a702db06b6b394d2bf15b56d29412472", "author": {"user": {"login": "drodriguezhdez", "name": "Daniel Rodriguez Hernandez"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/35716c71a702db06b6b394d2bf15b56d29412472", "committedDate": "2020-09-08T07:28:24Z", "message": "Fix EnsureTrace flush test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjU3MjYz", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#pullrequestreview-484257263", "createdAt": "2020-09-08T15:28:24Z", "commit": {"oid": "35716c71a702db06b6b394d2bf15b56d29412472"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNToyODoyNFrOHOiqbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNToyODoyNFrOHOiqbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAxMDAzMA==", "bodyText": "I think rather than Queue; this should either be...\n create(Queue primary, Queue secondary)\nOR\ncreate(Queue<List> primary, Queue<List> secondary)", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#discussion_r485010030", "createdAt": "2020-09-08T15:28:24Z", "author": {"login": "dougqh"}, "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/ddagent/Prioritization.java", "diffHunk": "@@ -10,33 +10,87 @@\n import java.util.concurrent.TimeUnit;\n \n public enum Prioritization {\n+  ENSURE_TRACE {\n+    @Override\n+    public PrioritizationStrategy create(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35716c71a702db06b6b394d2bf15b56d29412472"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjUwNDUw", "url": "https://github.com/DataDog/dd-trace-java/pull/1841#pullrequestreview-485250450", "createdAt": "2020-09-09T17:34:58Z", "commit": {"oid": "35716c71a702db06b6b394d2bf15b56d29412472"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2006, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}