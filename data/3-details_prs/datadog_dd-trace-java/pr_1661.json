{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzUyNjkw", "number": 1661, "title": "Strict mode and health metrics for scope close failures", "bodyText": "This pull requests addresses silent failures when trying to close scopes by:\n\nIncrementing a statsd counter when a scope is not closed because it is not on top\nAdding the dd.trace.scope.strict.mode flag where this error throws a RuntimeException instead of being silent\n\nTo accomplish this, ContinuableScope now tracks whether the scope was created manually or through automatic instrumentation.  This change is completely internal.  No instrumentation or external APIs changed.", "createdAt": "2020-07-08T16:25:27Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1661", "merged": true, "mergeCommit": {"oid": "cfb974db5808bee81b7137ccb28b6ca000f57d13"}, "closed": true, "closedAt": "2020-07-09T15:22:46Z", "author": {"login": "randomanderson"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyqu3hAH2gAyNDQ2MzUyNjkwOmQ2NDRmM2Q0ODljNDQ3MWM1MWRkMjA5YWEwNTY3M2E3ZDJlZWJjY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczQgdGgFqTQ0NTY3MjA0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d644f3d489c4471c51dd209aa05673a7d2eebccb", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d644f3d489c4471c51dd209aa05673a7d2eebccb", "committedDate": "2020-07-07T19:09:30Z", "message": "Strict mode config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9d69542b2d31439ca0b39ec8af47177e3f8bdf1", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c9d69542b2d31439ca0b39ec8af47177e3f8bdf1", "committedDate": "2020-07-07T19:58:40Z", "message": "Add ScopeSource to scope creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76c3af12b0e0679f48bb16577105ae50d5f36f6f", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/76c3af12b0e0679f48bb16577105ae50d5f36f6f", "committedDate": "2020-07-07T20:00:20Z", "message": "Add health metrics and strict mode exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebdbbc6c0738b5cfd08c094f57513d72a4fbc9b2", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ebdbbc6c0738b5cfd08c094f57513d72a4fbc9b2", "committedDate": "2020-07-08T14:31:53Z", "message": "Tests and StatsDClient mocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3880ba757307a0126e10e6f9ce844c4200528b", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cf3880ba757307a0126e10e6f9ce844c4200528b", "committedDate": "2020-07-08T16:19:00Z", "message": "OpenTelemetry test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fbb2e3c789506aa8b48b8b42db8bf7dfc1c26a2", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0fbb2e3c789506aa8b48b8b42db8bf7dfc1c26a2", "committedDate": "2020-07-08T16:55:33Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72ed7084e20fc3cec42b4746bc7107e447442e15", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/72ed7084e20fc3cec42b4746bc7107e447442e15", "committedDate": "2020-07-08T17:57:53Z", "message": "Exclude ScopeSource because jacoco limitations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDgzOTM0", "url": "https://github.com/DataDog/dd-trace-java/pull/1661#pullrequestreview-445483934", "createdAt": "2020-07-09T10:20:53Z", "commit": {"oid": "72ed7084e20fc3cec42b4746bc7107e447442e15"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NjcyMDQ2", "url": "https://github.com/DataDog/dd-trace-java/pull/1661#pullrequestreview-445672046", "createdAt": "2020-07-09T14:28:47Z", "commit": {"oid": "72ed7084e20fc3cec42b4746bc7107e447442e15"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyODo0N1rOGvTv8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyODo0N1rOGvTv8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1OTgyNw==", "bodyText": "interesting... what is a detached mock?", "url": "https://github.com/DataDog/dd-trace-java/pull/1661#discussion_r452259827", "createdAt": "2020-07-09T14:28:47Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/testing/src/main/groovy/datadog/trace/agent/test/AgentTestRunner.java", "diffHunk": "@@ -102,7 +108,9 @@ public boolean add(final List<DDSpan> trace) {\n             return result;\n           }\n         };\n-    TEST_TRACER = CoreTracer.builder().writer(TEST_WRITER).build();\n+\n+    STATS_D_CLIENT = new DetachedMockFactory().Mock(StatsDClient.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ed7084e20fc3cec42b4746bc7107e447442e15"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2245, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}