{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODQ3NTU1", "number": 1173, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNjoxODowOVrODYOyHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxOTozNzoyMFrODYSgaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NzM0NjIzOnYy", "diffSide": "RIGHT", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/DDCachingPoolStrategy.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNjoxODowOVrOFd-DIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNzoyMTozNlrOFeAKxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk2OTYzMg==", "bodyText": "What is the benefit in having this class (and others in this PR) implement the ValueSupplier interface when they didn't previously?  Not really understanding the motivation for this change.", "url": "https://github.com/DataDog/dd-trace-java/pull/1173#discussion_r366969632", "createdAt": "2020-01-15T16:18:09Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/DDCachingPoolStrategy.java", "diffHunk": "@@ -28,7 +29,13 @@\n  *\n  * <p>See eviction policy below.\n  */\n-public class DDCachingPoolStrategy implements PoolStrategy {\n+public class DDCachingPoolStrategy\n+    implements PoolStrategy, WeakMap.ValueSupplier<ClassLoader, TypePool.CacheProvider> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbe9de320b68dbba663644d4a2744fdf70785f4"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAwNDM1OA==", "bodyText": "Simplicity:\nThe interface for users of WeakMap is much simpler.  See the difference in ReferenceMatcher: the 3 levels of nesting go away.  If/when we switch to Java 8, the interface can be replace by a method reference or lambda.\nConsistency:\nDDCachingPoolStrategy was doing something slightly different: it synchronized on the classloader instead of on the cache.  This is something we know may cause issues (#1126).  The point of the synchronized audit was to catch things like this.  By removing the external synchronization need, this bug class is eliminated.\nCentralizing for easier changes:\nIf we later decide to use a different implementation (read/write locks, Unsafe, etc), there's only one place to change.", "url": "https://github.com/DataDog/dd-trace-java/pull/1173#discussion_r367004358", "createdAt": "2020-01-15T17:21:36Z", "author": {"login": "randomanderson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/DDCachingPoolStrategy.java", "diffHunk": "@@ -28,7 +29,13 @@\n  *\n  * <p>See eviction policy below.\n  */\n-public class DDCachingPoolStrategy implements PoolStrategy {\n+public class DDCachingPoolStrategy\n+    implements PoolStrategy, WeakMap.ValueSupplier<ClassLoader, TypePool.CacheProvider> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk2OTYzMg=="}, "originalCommit": {"oid": "9bbe9de320b68dbba663644d4a2744fdf70785f4"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2Nzk1NjI0OnYy", "diffSide": "LEFT", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/ClassLoaderMatcher.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxOTozNzoyMFrOFeEDuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxOTozNzoyMFrOFeEDuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA2ODA4OA==", "bodyText": "These are what we had to use before muzzle...  I assume they're no longer used anywhere?", "url": "https://github.com/DataDog/dd-trace-java/pull/1173#discussion_r367068088", "createdAt": "2020-01-15T19:37:20Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/ClassLoaderMatcher.java", "diffHunk": "@@ -30,18 +30,9 @@ private ClassLoaderMatcher() {\n     return new ClassLoaderHasClassMatcher(names);\n   }\n \n-  public static ElementMatcher.Junction.AbstractBase<ClassLoader> classLoaderHasClassWithField(\n-      final String className, final String fieldName) {\n-    return new ClassLoaderHasClassWithFieldMatcher(className, fieldName);\n-  }\n-\n-  public static ElementMatcher.Junction.AbstractBase<ClassLoader> classLoaderHasClassWithMethod(\n-      final String className, final String methodName, final String... methodArgs) {\n-    return new ClassLoaderHasClassWithMethodMatcher(className, methodName, methodArgs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68ed1da9c61f7c457bd42182b86c7ca92a161be4"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 480, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}