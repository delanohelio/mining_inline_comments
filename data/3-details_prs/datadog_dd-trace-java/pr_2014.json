{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2ODU0MTE5", "number": 2014, "title": "Miscellaneous agent thread cleanup", "bodyText": "Rename DaemonThreadFactory to AgentThreadFactory\nCreate startup and JMX threads as agent threads\nReplace ProfilingThreadFactory with AgentThreadFactory\nAvoid creating a thread factory just for single agent threads\nPlace shutdown hooks under the agent thread group", "createdAt": "2020-10-20T14:31:58Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2014", "merged": true, "mergeCommit": {"oid": "a551cc09dc7993139d0196d7e7ee44de3c951561"}, "closed": true, "closedAt": "2020-10-21T19:28:15Z", "author": {"login": "mcculls"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUX3UzAH2gAyNTA2ODU0MTE5OjU1OTc3NjM4N2JlZDlhZjM5YWZmNzNjMjMxYmU3NGUxZTUxNWYxMmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUgsAcgH2gAyNTA2ODU0MTE5OjM0NTMwNmVlNzFhM2M4MWY3ODQ0NGRmNGFhNGRiNDM0ZmQzN2M1MTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "559776387bed9af39aff73c231be74e1e515f12c", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/559776387bed9af39aff73c231be74e1e515f12c", "committedDate": "2020-10-20T12:23:58Z", "message": "Rename DaemonThreadFactory to AgentThreadFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99b85a665ae9359ffe68ed79d4a393e5df39c263", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/99b85a665ae9359ffe68ed79d4a393e5df39c263", "committedDate": "2020-10-20T12:27:14Z", "message": "Remove unused feature to simplify task creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b9ba2a2ee4afb42ee6c38522a8455bd65ca977", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f6b9ba2a2ee4afb42ee6c38522a8455bd65ca977", "committedDate": "2020-10-20T12:55:33Z", "message": "Give each thread from the factory a unique name, and allow single threads to be created without needing a factory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7e3151cd640405f6e292bfe2e9b50e6a02b5eaa", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f7e3151cd640405f6e292bfe2e9b50e6a02b5eaa", "committedDate": "2020-10-20T12:58:58Z", "message": "Reorder arguments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "173853aba0427d16b49746703f042a1b408eda1b", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/173853aba0427d16b49746703f042a1b408eda1b", "committedDate": "2020-10-20T13:07:12Z", "message": "Create startup and JMX threads as agent threads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc91288f4f74f957ad1c12a13335d9e088f5aebe", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/dc91288f4f74f957ad1c12a13335d9e088f5aebe", "committedDate": "2020-10-20T13:10:47Z", "message": "Replace ProfilingThreadFactory with AgentThreadFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25e2111e8f243678ec3d6a37fb53681b35368d26", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/25e2111e8f243678ec3d6a37fb53681b35368d26", "committedDate": "2020-10-20T13:14:27Z", "message": "Avoid creating a thread factory just for single threads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20e7ac1385786a01caf35227da05588879f86e3f", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/20e7ac1385786a01caf35227da05588879f86e3f", "committedDate": "2020-10-20T13:17:31Z", "message": "Cleanup javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c6c459d15ec3239846bb1134f1e8538f25a9de6", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5c6c459d15ec3239846bb1134f1e8538f25a9de6", "committedDate": "2020-10-20T13:27:16Z", "message": "Avoid creating a thread factory just for our single thread scheduler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64537a4ef7a6c4cdb0468fd68c5debbd92f8e62a", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/64537a4ef7a6c4cdb0468fd68c5debbd92f8e62a", "committedDate": "2020-10-20T13:35:42Z", "message": "Add support for simple delayed one-shot agent threads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c03c6e5992de32af078ec363c3bc560523c8be3f", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c03c6e5992de32af078ec363c3bc560523c8be3f", "committedDate": "2020-10-20T13:56:29Z", "message": "Place agent shutdown hooks under the same agent thread group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1ef57dbd294d1393f18eeec8f1df4898bebd439", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c1ef57dbd294d1393f18eeec8f1df4898bebd439", "committedDate": "2020-10-20T13:58:21Z", "message": "Remove use of @SneakyThrows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNzg5MTAz", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#pullrequestreview-512789103", "createdAt": "2020-10-20T14:35:26Z", "commit": {"oid": "c1ef57dbd294d1393f18eeec8f1df4898bebd439"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNzkxNzcz", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#pullrequestreview-512791773", "createdAt": "2020-10-20T14:37:47Z", "commit": {"oid": "c1ef57dbd294d1393f18eeec8f1df4898bebd439"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNzk2MzMx", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#pullrequestreview-512796331", "createdAt": "2020-10-20T14:41:51Z", "commit": {"oid": "c1ef57dbd294d1393f18eeec8f1df4898bebd439"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDo0MTo1MVrOHlAlUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDo0MTo1MVrOHlAlUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2ODkxMw==", "bodyText": "I think there is value in having all the expected threads enumerated in a single place...", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#discussion_r508568913", "createdAt": "2020-10-20T14:41:51Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/ddagent/TraceProcessingWorker.java", "diffHunk": "@@ -74,7 +74,7 @@ public TraceProcessingWorker(\n             dispatcher,\n             flushInterval,\n             timeUnit);\n-    this.serializerThread = DaemonThreadFactory.TRACE_PROCESSOR.newThread(serializingHandler);\n+    this.serializerThread = newAgentThread(\"dd-trace-processor\", serializingHandler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1ef57dbd294d1393f18eeec8f1df4898bebd439"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODIyNTkz", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#pullrequestreview-512822593", "createdAt": "2020-10-20T15:05:12Z", "commit": {"oid": "c1ef57dbd294d1393f18eeec8f1df4898bebd439"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "388f95dad0036eaaaaf533ec2094a320e6eaa312", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/388f95dad0036eaaaaf533ec2094a320e6eaa312", "committedDate": "2020-10-20T17:10:29Z", "message": "Use enum to list known agent threads"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTkxNTYw", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#pullrequestreview-512991560", "createdAt": "2020-10-20T17:54:51Z", "commit": {"oid": "388f95dad0036eaaaaf533ec2094a320e6eaa312"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNzo1NDo1MVrOHlKM1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNzo1NDo1MVrOHlKM1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcyNjQ4Nw==", "bodyText": "Does this result in any new/different thread names from previous releases?", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#discussion_r508726487", "createdAt": "2020-10-20T17:54:51Z", "author": {"login": "tylerbenson"}, "path": "internal-api/src/main/java/datadog/trace/util/AgentThreadFactory.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package datadog.trace.util;\n+\n+import java.util.concurrent.ThreadFactory;\n+import java.util.concurrent.TimeUnit;\n+\n+/** A {@link ThreadFactory} implementation that starts all agent {@link Thread}s as daemons. */\n+public final class AgentThreadFactory implements ThreadFactory {\n+  public static final ThreadGroup AGENT_THREAD_GROUP = new ThreadGroup(\"dd-trace-java\");\n+\n+  // known agent threads\n+  public enum AgentThread {\n+    TASK_SCHEDULER,\n+    TRACE_STARTUP,\n+    TRACE_MONITOR,\n+    TRACE_PROCESSOR,\n+    TRACE_CASSANDRA_ASYNC_SESSION,\n+    JMX_STARTUP,\n+    JMX_COLLECTOR,\n+    PROFILER_STARTUP,\n+    PROFILER_RECORDING_STARTUP,\n+    PROFILER_RECORDING_SCHEDULER,\n+    PROFILER_HTTP_DISPATCHER;\n+\n+    public String threadName() {\n+      return \"dd-\" + name().toLowerCase().replace('_', '-');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "388f95dad0036eaaaaf533ec2094a320e6eaa312"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "311be2177d12836410e65b7b32b34dc9c76acfac", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/311be2177d12836410e65b7b32b34dc9c76acfac", "committedDate": "2020-10-20T18:34:33Z", "message": "Maintain previous agent thread names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDQ0MTg5", "url": "https://github.com/DataDog/dd-trace-java/pull/2014#pullrequestreview-513044189", "createdAt": "2020-10-20T19:00:28Z", "commit": {"oid": "311be2177d12836410e65b7b32b34dc9c76acfac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e13ae0706cf91ef309a446ba9cd844f9b748bac", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8e13ae0706cf91ef309a446ba9cd844f9b748bac", "committedDate": "2020-10-20T21:03:45Z", "message": "Update excludedClassesCoverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d66461c9ec63434a0476cf169f1a181a93d1aae", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5d66461c9ec63434a0476cf169f1a181a93d1aae", "committedDate": "2020-10-20T21:19:58Z", "message": "Revert \"Add support for simple delayed one-shot agent threads\"\n\n(moving this to a follow-up PR to rework the profiler scheduler)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "345306ee71a3c81f78444df4aa4db434fd37c519", "author": {"user": {"login": "mcculls", "name": "Stuart McCulloch"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/345306ee71a3c81f78444df4aa4db434fd37c519", "committedDate": "2020-10-20T22:40:45Z", "message": "Update excludedClassesCoverage"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3017, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}