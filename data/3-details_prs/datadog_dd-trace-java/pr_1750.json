{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzI3NzYw", "number": 1750, "title": "verify spring-scheduling supports lambdas", "bodyText": "", "createdAt": "2020-08-05T11:38:15Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1750", "merged": true, "mergeCommit": {"oid": "032bf254b6c68175bee4dc4ecc7c0f620b746b6f"}, "closed": true, "closedAt": "2020-08-05T15:29:46Z", "author": {"login": "richardstartin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc76TxLABqjM2MjQ0MjA2NjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc78SggAFqTQ2MTczMzA4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31bf426da389c1e49cf250aea778bd471cfb611c", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/31bf426da389c1e49cf250aea778bd471cfb611c", "committedDate": "2020-08-05T11:37:42Z", "message": "verify spring-scheduling supports lambdas"}, "afterCommit": {"oid": "d324a75a5caad116081a0e324a4bd66d0ba611d5", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d324a75a5caad116081a0e324a4bd66d0ba611d5", "committedDate": "2020-08-05T12:23:33Z", "message": "verify spring-scheduling supports lambdas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjM5ODEx", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#pullrequestreview-461639811", "createdAt": "2020-08-05T13:01:14Z", "commit": {"oid": "d324a75a5caad116081a0e324a4bd66d0ba611d5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzowMToxNFrOG8IoLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzowMToxNFrOG8IoLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTcwOTEwMQ==", "bodyText": "Not really necessary I guess...", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465709101", "createdAt": "2020-08-05T13:01:14Z", "author": {"login": "bantonsson"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/java/LambdaTaskConfigurer.java", "diffHunk": "@@ -0,0 +1,21 @@\n+import org.springframework.scheduling.annotation.SchedulingConfigurer;\n+import org.springframework.scheduling.config.ScheduledTaskRegistrar;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+@Service\n+public class LambdaTaskConfigurer implements SchedulingConfigurer {\n+\n+  public final CountDownLatch singleUseLatch = new CountDownLatch(1);\n+\n+  @Override\n+  public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {\n+    taskRegistrar.addFixedDelayTask(\n+      () -> {\n+        System.out.println(\"lambda task\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d324a75a5caad116081a0e324a4bd66d0ba611d5"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d324a75a5caad116081a0e324a4bd66d0ba611d5", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/d324a75a5caad116081a0e324a4bd66d0ba611d5", "committedDate": "2020-08-05T12:23:33Z", "message": "verify spring-scheduling supports lambdas"}, "afterCommit": {"oid": "847081020faae780a9e7d48f35c971ba29ae7b10", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/847081020faae780a9e7d48f35c971ba29ae7b10", "committedDate": "2020-08-05T13:14:20Z", "message": "verify spring-scheduling supports lambdas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04", "committedDate": "2020-08-05T13:26:53Z", "message": "verify spring-scheduling supports lambdas"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "847081020faae780a9e7d48f35c971ba29ae7b10", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/847081020faae780a9e7d48f35c971ba29ae7b10", "committedDate": "2020-08-05T13:14:20Z", "message": "verify spring-scheduling supports lambdas"}, "afterCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04", "author": {"user": {"login": "richardstartin", "name": "Richard Startin"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04", "committedDate": "2020-08-05T13:26:53Z", "message": "verify spring-scheduling supports lambdas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjY0MTgx", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#pullrequestreview-461664181", "createdAt": "2020-08-05T13:29:21Z", "commit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzoyOToyMVrOG8JtTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzoyOToyMVrOG8JtTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTcyNjc5Ng==", "bodyText": "Nice", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465726796", "createdAt": "2020-08-05T13:29:21Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/java/LambdaTaskConfigurer.java", "diffHunk": "@@ -0,0 +1,15 @@\n+import java.util.concurrent.CountDownLatch;\n+import org.springframework.scheduling.annotation.SchedulingConfigurer;\n+import org.springframework.scheduling.config.ScheduledTaskRegistrar;\n+import org.springframework.stereotype.Service;\n+\n+@Service\n+public class LambdaTaskConfigurer implements SchedulingConfigurer {\n+\n+  public final CountDownLatch singleUseLatch = new CountDownLatch(1);\n+\n+  @Override\n+  public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {\n+    taskRegistrar.addFixedDelayTask(singleUseLatch::countDown, 500);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzMzMDg5", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#pullrequestreview-461733089", "createdAt": "2020-08-05T14:42:02Z", "commit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0MjowMlrOG8M2cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0MjowMlrOG8M2cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3ODI4OA==", "bodyText": "What does the full resource name look like?", "url": "https://github.com/DataDog/dd-trace-java/pull/1750#discussion_r465778288", "createdAt": "2020-08-05T14:42:02Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/spring-scheduling-3.1/src/test/groovy/SpringSchedulingTest.groovy", "diffHunk": "@@ -54,4 +56,31 @@ class SpringSchedulingTest extends AgentTestRunner {\n     }\n \n   }\n+\n+  def \"schedule lambda test\"() {\n+    setup:\n+    def context = new AnnotationConfigApplicationContext(LambdaTaskConfig)\n+    def configurer = context.getBean(LambdaTaskConfigurer)\n+\n+    configurer.singleUseLatch.await(2000, TimeUnit.MILLISECONDS)\n+\n+    expect:\n+    assertTraces(1) {\n+      trace(0, 1) {\n+        span(0) {\n+          resourceNameContains(\"LambdaTaskConfigurer\\$\\$Lambda\\$\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3d8b5e7cfe5a7af71e72cf8bf963771abf52a04"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2091, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}