{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5ODY2NDU0", "number": 2030, "title": "Update CircleCI caching", "bodyText": "Our CircleCI build always build every commit to a PR completely from scratch and without any cached artifacts. This PR tries to fix that, by saving caches under two different keys, one used by the dependent steps, and one that acts as a base for future commits to the PR. As a fallback, we also try to use a cache from the main branch, that is updated daily.", "createdAt": "2020-10-26T08:32:24Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2030", "merged": true, "mergeCommit": {"oid": "e8f3b241a6c04d90b33ea2c8cdb416b6101e7e40"}, "closed": true, "closedAt": "2020-10-27T12:40:55Z", "author": {"login": "bantonsson"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWR5XkgBqjM5MjAwMDUxOTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWnOY5gBqjM5MjUzODIyMjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f1dde028df75afc76eb980ef57ff81a95cf1167", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6f1dde028df75afc76eb980ef57ff81a95cf1167", "committedDate": "2020-10-26T08:59:20Z", "message": "where in the world is the workspace?"}, "afterCommit": {"oid": "398b91e1a08b0387fdd429844bda38d4285a5f74", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/398b91e1a08b0387fdd429844bda38d4285a5f74", "committedDate": "2020-10-26T10:33:12Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "398b91e1a08b0387fdd429844bda38d4285a5f74", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/398b91e1a08b0387fdd429844bda38d4285a5f74", "committedDate": "2020-10-26T10:33:12Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "5baafe1ca1985a61a7b529af6ac68dd999b8aeaa", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5baafe1ca1985a61a7b529af6ac68dd999b8aeaa", "committedDate": "2020-10-26T10:55:36Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5baafe1ca1985a61a7b529af6ac68dd999b8aeaa", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/5baafe1ca1985a61a7b529af6ac68dd999b8aeaa", "committedDate": "2020-10-26T10:55:36Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "50b9e192901c4ade591dd0d877b23c141ed6bba7", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/50b9e192901c4ade591dd0d877b23c141ed6bba7", "committedDate": "2020-10-26T11:16:24Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50b9e192901c4ade591dd0d877b23c141ed6bba7", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/50b9e192901c4ade591dd0d877b23c141ed6bba7", "committedDate": "2020-10-26T11:16:24Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "664f152f074f0a0959a40c623fa86275bd02fd50", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/664f152f074f0a0959a40c623fa86275bd02fd50", "committedDate": "2020-10-26T11:21:27Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "664f152f074f0a0959a40c623fa86275bd02fd50", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/664f152f074f0a0959a40c623fa86275bd02fd50", "committedDate": "2020-10-26T11:21:27Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "44647f91941236f61663908027c4f299161b3fd4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/44647f91941236f61663908027c4f299161b3fd4", "committedDate": "2020-10-26T11:42:28Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44647f91941236f61663908027c4f299161b3fd4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/44647f91941236f61663908027c4f299161b3fd4", "committedDate": "2020-10-26T11:42:28Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "58a9c6f01b964e53e067aa8035375fbe3a16c55f", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/58a9c6f01b964e53e067aa8035375fbe3a16c55f", "committedDate": "2020-10-26T14:03:10Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58a9c6f01b964e53e067aa8035375fbe3a16c55f", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/58a9c6f01b964e53e067aa8035375fbe3a16c55f", "committedDate": "2020-10-26T14:03:10Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "9658f57c499dc8ffc2547801f435968c879df283", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9658f57c499dc8ffc2547801f435968c879df283", "committedDate": "2020-10-26T14:14:56Z", "message": "Test CircleCI Caching"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9658f57c499dc8ffc2547801f435968c879df283", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/9658f57c499dc8ffc2547801f435968c879df283", "committedDate": "2020-10-26T14:14:56Z", "message": "Test CircleCI Caching"}, "afterCommit": {"oid": "268ea3061b8c7f43f09530eff995bbe7f0f605de", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/268ea3061b8c7f43f09530eff995bbe7f0f605de", "committedDate": "2020-10-26T14:52:35Z", "message": "Have PRs start from a cache from the main branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTM0NzYw", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#pullrequestreview-516934760", "createdAt": "2020-10-26T16:04:45Z", "commit": {"oid": "268ea3061b8c7f43f09530eff995bbe7f0f605de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjowNDo0NVrOHoW0rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjowNDo0NVrOHoW0rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA3OTAyMg==", "bodyText": "Can this have a comment for folks like me that are not familiar with cron syntax?", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#discussion_r512079022", "createdAt": "2020-10-26T16:04:45Z", "author": {"login": "tylerbenson"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,3 +277,14 @@ workflows:\n           filters:\n             branches:\n               ignore: master\n+\n+  daily:\n+    triggers:\n+      - schedule:\n+          cron: \"0 5 * * *\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "268ea3061b8c7f43f09530eff995bbe7f0f605de"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "268ea3061b8c7f43f09530eff995bbe7f0f605de", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/268ea3061b8c7f43f09530eff995bbe7f0f605de", "committedDate": "2020-10-26T14:52:35Z", "message": "Have PRs start from a cache from the main branch"}, "afterCommit": {"oid": "957181083e4aec669693deb183c20345808da6d4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/957181083e4aec669693deb183c20345808da6d4", "committedDate": "2020-10-26T16:24:51Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTYxNTAz", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#pullrequestreview-516961503", "createdAt": "2020-10-26T16:32:38Z", "commit": {"oid": "957181083e4aec669693deb183c20345808da6d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTY0MDkz", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#pullrequestreview-516964093", "createdAt": "2020-10-26T16:35:24Z", "commit": {"oid": "957181083e4aec669693deb183c20345808da6d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTk1MDQz", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#pullrequestreview-516995043", "createdAt": "2020-10-26T17:05:43Z", "commit": {"oid": "957181083e4aec669693deb183c20345808da6d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTg1ODkz", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#pullrequestreview-516985893", "createdAt": "2020-10-26T16:56:06Z", "commit": {"oid": "957181083e4aec669693deb183c20345808da6d4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjo1NjowN1rOHoZSjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjo1NjowN1rOHoZSjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExOTQzNg==", "bodyText": "What is this one?", "url": "https://github.com/DataDog/dd-trace-java/pull/2030#discussion_r512119436", "createdAt": "2020-10-26T16:56:07Z", "author": {"login": "tylerbenson"}, "path": ".circleci/config.yml", "diffHunk": "@@ -8,12 +8,23 @@ defaults: &defaults\n \n cache_keys: &cache_keys\n   keys:\n-    # Rev the version when the cache gets too big\n+    # Rev the version when the cache gets too big, and don't forget to change the save_cache steps\n+    # Dependent steps will find this cache\n     - dd-trace-java-v1-{{ .Branch }}-{{ .Revision }}\n-    - dd-trace-java-v1-{{ .Branch }}\n+    # New branch commits will find this cache\n+    - dd-trace-java-v1-{{ .Branch }}-{{ checksum \"_circle_ci_cache_id\" }}\n+    # New branches fall back on main build caches\n+    - dd-trace-java-v1-master-{{ checksum \"_circle_ci_cache_base_id\" }}\n+\n+save_cache_paths: &save_cache_paths\n+  paths:\n+    - ~/.gradle\n+    - ~/.sbt\n+    - ~/.cache/coursier", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "957181083e4aec669693deb183c20345808da6d4"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f7ba1d164e80b799e90431ce1f8d4dd296ce0d3", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1f7ba1d164e80b799e90431ce1f8d4dd296ce0d3", "committedDate": "2020-10-27T08:20:18Z", "message": "Test moving the build cache into the workspace"}, "afterCommit": {"oid": "66256d64166d7dd99ad119106568c89441f9aa58", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/66256d64166d7dd99ad119106568c89441f9aa58", "committedDate": "2020-10-27T09:23:41Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66256d64166d7dd99ad119106568c89441f9aa58", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/66256d64166d7dd99ad119106568c89441f9aa58", "committedDate": "2020-10-27T09:23:41Z", "message": "Have PR builds start from a cache from the main branch"}, "afterCommit": {"oid": "c2b1c32c4d6ade867acbe8bb8722f2448225b286", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c2b1c32c4d6ade867acbe8bb8722f2448225b286", "committedDate": "2020-10-27T09:27:40Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2b1c32c4d6ade867acbe8bb8722f2448225b286", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c2b1c32c4d6ade867acbe8bb8722f2448225b286", "committedDate": "2020-10-27T09:27:40Z", "message": "Have PR builds start from a cache from the main branch"}, "afterCommit": {"oid": "ca7aa1165295d97fcb654095f6f237107a4dd311", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ca7aa1165295d97fcb654095f6f237107a4dd311", "committedDate": "2020-10-27T09:35:31Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca7aa1165295d97fcb654095f6f237107a4dd311", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/ca7aa1165295d97fcb654095f6f237107a4dd311", "committedDate": "2020-10-27T09:35:31Z", "message": "Have PR builds start from a cache from the main branch"}, "afterCommit": {"oid": "74957d2b86baaf7cc1e69dfe26d8b48b9f004a10", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/74957d2b86baaf7cc1e69dfe26d8b48b9f004a10", "committedDate": "2020-10-27T09:39:51Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74957d2b86baaf7cc1e69dfe26d8b48b9f004a10", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/74957d2b86baaf7cc1e69dfe26d8b48b9f004a10", "committedDate": "2020-10-27T09:39:51Z", "message": "Have PR builds start from a cache from the main branch"}, "afterCommit": {"oid": "06397e0c2b186c9f43ea0afcc32965a2ff27b2d7", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/06397e0c2b186c9f43ea0afcc32965a2ff27b2d7", "committedDate": "2020-10-27T09:48:31Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06397e0c2b186c9f43ea0afcc32965a2ff27b2d7", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/06397e0c2b186c9f43ea0afcc32965a2ff27b2d7", "committedDate": "2020-10-27T09:48:31Z", "message": "Have PR builds start from a cache from the main branch"}, "afterCommit": {"oid": "c42dd8068cce4a6165f1253d3a2751b614dcba24", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c42dd8068cce4a6165f1253d3a2751b614dcba24", "committedDate": "2020-10-27T11:01:40Z", "message": "Make sbt based Play tests use Ivy over Coursier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aec5bc1eed413fc28cc5fd660e40932ca5bfe3dd", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/aec5bc1eed413fc28cc5fd660e40932ca5bfe3dd", "committedDate": "2020-10-27T11:14:36Z", "message": "Have PR builds start from a cache from the main branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f072c259d1819e16b61a2992e98e2d4b1dbab428", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f072c259d1819e16b61a2992e98e2d4b1dbab428", "committedDate": "2020-10-27T11:14:47Z", "message": "Make sbt based Play tests use Ivy over Coursier"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c42dd8068cce4a6165f1253d3a2751b614dcba24", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/c42dd8068cce4a6165f1253d3a2751b614dcba24", "committedDate": "2020-10-27T11:01:40Z", "message": "Make sbt based Play tests use Ivy over Coursier"}, "afterCommit": {"oid": "f072c259d1819e16b61a2992e98e2d4b1dbab428", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/f072c259d1819e16b61a2992e98e2d4b1dbab428", "committedDate": "2020-10-27T11:14:47Z", "message": "Make sbt based Play tests use Ivy over Coursier"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3050, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}