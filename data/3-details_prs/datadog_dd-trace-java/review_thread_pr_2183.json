{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDg3MTE0", "number": 2183, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDozNjowNlrOFDaAkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNzozOVrOFDnxGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MTE2MTc2OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/jms/src/latestDepTest/groovy/JMS2Test.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDozNjowNlrOIDCjXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDozNjowNlrOIDCjXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1ODQ2MA==", "bodyText": "This assertion doesn't appear to check much - it doesn't check the time exists when we expect it to, or check that it doesn't exist when we don't expect it to. What do you think about adding a parameter to say when we expect there to be a time?\nWhen I do this I usually provide a default value to avoid having to update all the calls to the method: http://groovy-lang.org/objectorientation.html#_default_arguments - ie. only the calls that need the extra check then need to set the flag.", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540058460", "createdAt": "2020-12-10T10:36:06Z", "author": {"login": "mcculls"}, "path": "dd-java-agent/instrumentation/jms/src/latestDepTest/groovy/JMS2Test.groovy", "diffHunk": "@@ -253,6 +275,9 @@ class JMS2Test extends AgentTestRunner {\n         tags {\n           \"${Tags.COMPONENT}\" \"jms\"\n           \"${Tags.SPAN_KIND}\" \"consumer\"\n+          if (!messageListener && \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "894014650d6eed82c35d4a1aa9ee3300aa0b75b1"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzQxMDQ3OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/jms/src/latestDepTest/groovy/JMS2Test.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNjoyM1rOIDXVVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNjoyM1rOIDXVVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5ODkzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      } else if (isTimestampDisabled){\n          \n          \n            \n                        \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null }\n          \n      \n    \n    \n  \n\nI think these two lines are unnecessary since it will automatically verify such.", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540398932", "createdAt": "2020-12-10T18:26:23Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/jms/src/latestDepTest/groovy/JMS2Test.groovy", "diffHunk": "@@ -253,6 +277,11 @@ class JMS2Test extends AgentTestRunner {\n         tags {\n           \"${Tags.COMPONENT}\" \"jms\"\n           \"${Tags.SPAN_KIND}\" \"consumer\"\n+          if (!messageListener && !isTimestampDisabled) {\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it >= 0 }\n+          } else if (isTimestampDisabled){\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzQxMzc0OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/jms/src/test/groovy/JMS1Test.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNzowOFrOIDXXNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNzowOFrOIDXXNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5OTQxNQ==", "bodyText": "?", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540399415", "createdAt": "2020-12-10T18:27:08Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/jms/src/test/groovy/JMS1Test.groovy", "diffHunk": "@@ -34,6 +35,8 @@ class JMS1Test extends AgentTestRunner {\n     final Connection connection = connectionFactory.createConnection()\n     connection.start()\n     session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE)\n+\n+//    final Connection connectionDisabledTimestamp = connectionFactory.createConnection()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzQxNTk1OnYy", "diffSide": "RIGHT", "path": "dd-java-agent/instrumentation/jms/src/test/groovy/JMS1Test.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNzozOVrOIDXYkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNzozOVrOIDXYkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5OTc2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      } else if (isTimestampDisabled) {\n          \n          \n            \n                        \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null}\n          \n      \n    \n    \n  \n\nSame here.", "url": "https://github.com/DataDog/dd-trace-java/pull/2183#discussion_r540399760", "createdAt": "2020-12-10T18:27:39Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/instrumentation/jms/src/test/groovy/JMS1Test.groovy", "diffHunk": "@@ -269,6 +296,11 @@ class JMS1Test extends AgentTestRunner {\n         tags {\n           \"$Tags.COMPONENT\" \"jms\"\n           \"$Tags.SPAN_KIND\" Tags.SPAN_KIND_CONSUMER\n+          if (!messageListener && !isTimestampDisabled) {\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it >= 0 }\n+          } else if (isTimestampDisabled) {\n+            \"$InstrumentationTags.RECORD_QUEUE_TIME_MS\" {it == null}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb3fbd82b453f23f6a845109a71cf8a0c5a27ce1"}, "originalPosition": 71}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4524, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}