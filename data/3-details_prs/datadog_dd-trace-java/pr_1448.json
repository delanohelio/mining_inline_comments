{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2Mzk2Mjc2", "number": 1448, "title": "Adding an option to manually disable Kafka headers", "bodyText": "In environments with mixed kafka-client versions, there can be errors when a producer that has the kafka integration enabled creates a message to be sent to brokers that use the kafka-client > 0.11. This causes the magic version (apiVersions.maxUsableProduceMagic()) to be 2 and the DD trace library injects headers into the record.\nConsumer is using a version of kafka-client < 0.11 will fail when attempting to consume this record with an IllegalArgumentException\nThis change allows organizations that have a mixed kafka-client environment to keep the kafka integration enabled and manually disable the injection of headers by setting a JVM option or environment variable.\nIt's possibly related to the issue here. #944", "createdAt": "2020-05-11T23:13:15Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1448", "merged": true, "mergeCommit": {"oid": "38417de6553774a4b8b6a2655f35731d58fdd06c"}, "closed": true, "closedAt": "2020-05-12T22:04:25Z", "author": {"login": "shields478"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgXqWcAH2gAyNDE2Mzk2Mjc2OmFiNjdhN2IyOTI2NTI5NjVmMTg4NTM0ZTNjOTI4OTYxNWE5NzcwMmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgrqm9gFqTQxMDQ1NTgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab67a7b292652965f188534e3c9289615a97702f", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/ab67a7b292652965f188534e3c9289615a97702f", "committedDate": "2020-05-11T22:45:44Z", "message": "Adding an option to manually disable Kafka headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b82831c0ee6e4181c06b00c97c831738a32c715", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/9b82831c0ee6e4181c06b00c97c831738a32c715", "committedDate": "2020-05-12T12:37:36Z", "message": "Fixing checkstyle error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMDM3MjY2", "url": "https://github.com/DataDog/dd-trace-java/pull/1448#pullrequestreview-410037266", "createdAt": "2020-05-12T13:25:14Z", "commit": {"oid": "9b82831c0ee6e4181c06b00c97c831738a32c715"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMzoyNToxNFrOGUGa-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMzoyNToxNFrOGUGa-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcyOTkxNQ==", "bodyText": "Hey @shields478, thanks for the explanation of the problem and the contribution.  I think this setting might be generally useful, so my proposal is that we change the format a bit to be usable for other things in the future.  My suggestion is dd.<integration>.<client/server>.propagation.enabled.  That means instead of kafka.headers.enabled the setting you would use here is kafka.client.propagation.enabled which as an env var would be DD_KAFKA_CLIENT_PROPAGATION_ENABLED (sys props and env vars have the dd prefix).  An alternate option would be to change client/server to inject/extract since that is more directly relevant.", "url": "https://github.com/DataDog/dd-trace-java/pull/1448#discussion_r423729915", "createdAt": "2020-05-12T13:25:14Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-api/src/main/java/datadog/trace/api/Config.java", "diffHunk": "@@ -148,6 +148,8 @@\n   public static final String PROFILING_EXCEPTION_HISTOGRAM_MAX_COLLECTION_SIZE =\n       \"profiling.exception.histogram.max-collection-size\";\n \n+  public static final String KAFKA_HEADERS_ENABLED = \"kafka.headers.enabled\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b82831c0ee6e4181c06b00c97c831738a32c715"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c8a9a8df532e3c34891dc9ccefc6a9b8ac3fb05", "author": {"user": null}, "url": "https://github.com/DataDog/dd-trace-java/commit/0c8a9a8df532e3c34891dc9ccefc6a9b8ac3fb05", "committedDate": "2020-05-12T13:57:45Z", "message": "Updating naming convention"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDU1ODI4", "url": "https://github.com/DataDog/dd-trace-java/pull/1448#pullrequestreview-410455828", "createdAt": "2020-05-12T22:04:07Z", "commit": {"oid": "0c8a9a8df532e3c34891dc9ccefc6a9b8ac3fb05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2490, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}