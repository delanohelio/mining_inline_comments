{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDExNjI4", "number": 1231, "title": "Create AgentBuilder with logging listeners only if in debug mode", "bodyText": "To test the effectiveness of this change, a sample spring app was run multiple times with tracer 0.43.0 and 0.44.0 (the tracer with these changes) on non-debug mode. The average start-up time is shown below:\n0.43.0 -> 12.996 s\n0.44.0 -> 12.196 s\nNot adding the listener on non-debug mode shaves a bit of time off start-up.", "createdAt": "2020-02-19T21:42:58Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1231", "merged": true, "mergeCommit": {"oid": "c0baa48487b3f7fd681d5cf31e0fadb0ebc6f2b0"}, "closed": true, "closedAt": "2020-02-20T22:07:18Z", "author": {"login": "heathkd"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF-BbvgFqTM2MTQ3NjIyNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGSjw7gFqTM2MjI2ODk4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNDc2MjI0", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#pullrequestreview-361476224", "createdAt": "2020-02-19T22:11:12Z", "commit": {"oid": "aa546a444aa30b0dd619886ae744cb22c1412895"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMjoxMToxMlrOFr5g5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMjoxMToxMlrOFr5g5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU3NTM5OA==", "bodyText": "This should be applied even if debug is not enabled, otherwise previously loaded classes won't be retransformed.", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#discussion_r381575398", "createdAt": "2020-02-19T22:11:12Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "diffHunk": "@@ -139,6 +136,14 @@ public static ResettableClassFileTransformer installBytebuddyAgent(\n             .or(isAnnotatedWith(named(\"javax.decorator.Decorator\")))\n             .or(matchesConfiguredExcludes());\n \n+    if (log.isDebugEnabled()) {\n+      agentBuilder =\n+          agentBuilder\n+              .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa546a444aa30b0dd619886ae744cb22c1412895"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa546a444aa30b0dd619886ae744cb22c1412895", "author": {"user": {"login": "heathkd", "name": "Heather D'Souza"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/aa546a444aa30b0dd619886ae744cb22c1412895", "committedDate": "2020-02-19T21:40:50Z", "message": "create AgentBuilder instance with logging listeners only if debug mode is enabled"}, "afterCommit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733", "author": {"user": {"login": "heathkd", "name": "Heather D'Souza"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1be2f2398b70834f22a5ae4599aee27097de8733", "committedDate": "2020-02-20T15:11:15Z", "message": "create AgentBuilder instance with logging listeners only if debug mode is enabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMDcyODYy", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#pullrequestreview-362072862", "createdAt": "2020-02-20T16:59:50Z", "commit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjo1OTo1MFrOFsbfIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjo1OTo1MFrOFsbfIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMjAwMA==", "bodyText": "You should remove this line from here now that it is back in the other builder", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#discussion_r382132000", "createdAt": "2020-02-20T16:59:50Z", "author": {"login": "devinsba"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/AgentInstaller.java", "diffHunk": "@@ -139,6 +137,14 @@ public static ResettableClassFileTransformer installBytebuddyAgent(\n             .or(isAnnotatedWith(named(\"javax.decorator.Decorator\")))\n             .or(matchesConfiguredExcludes());\n \n+    if (log.isDebugEnabled()) {\n+      agentBuilder =\n+          agentBuilder\n+              .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTIwMjI2", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#pullrequestreview-362120226", "createdAt": "2020-02-20T18:09:01Z", "commit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b46caaa8dd2b09ada22b85728766161cae2900", "author": {"user": {"login": "heathkd", "name": "Heather D'Souza"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b7b46caaa8dd2b09ada22b85728766161cae2900", "committedDate": "2020-02-20T21:29:27Z", "message": "create AgentBuilder instance with logging listeners only if debug mode is enabled"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1be2f2398b70834f22a5ae4599aee27097de8733", "author": {"user": {"login": "heathkd", "name": "Heather D'Souza"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/1be2f2398b70834f22a5ae4599aee27097de8733", "committedDate": "2020-02-20T15:11:15Z", "message": "create AgentBuilder instance with logging listeners only if debug mode is enabled"}, "afterCommit": {"oid": "b7b46caaa8dd2b09ada22b85728766161cae2900", "author": {"user": {"login": "heathkd", "name": "Heather D'Souza"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/b7b46caaa8dd2b09ada22b85728766161cae2900", "committedDate": "2020-02-20T21:29:27Z", "message": "create AgentBuilder instance with logging listeners only if debug mode is enabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjY4OTgz", "url": "https://github.com/DataDog/dd-trace-java/pull/1231#pullrequestreview-362268983", "createdAt": "2020-02-20T22:06:59Z", "commit": {"oid": "b7b46caaa8dd2b09ada22b85728766161cae2900"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2728, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}