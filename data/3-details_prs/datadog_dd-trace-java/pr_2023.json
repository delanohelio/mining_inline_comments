{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzMxMDI4", "number": 2023, "title": "Add internal testing option to exit JVM on advice failure", "bodyText": "Added an option to let the advice exception handler log as error, and exit the JVM when there is a failure in the an advice, to make it easier to find issues when running other projects test suites.", "createdAt": "2020-10-22T14:23:23Z", "url": "https://github.com/DataDog/dd-trace-java/pull/2023", "merged": true, "mergeCommit": {"oid": "bf9c1a41ac5aa0dfa39df331043ab0ec41cdd911"}, "closed": true, "closedAt": "2020-10-23T14:16:41Z", "author": {"login": "bantonsson"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVC3wEgFqTUxNDc5Mjc1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVWm0_AFqTUxNTY2NzM4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NzkyNzU3", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#pullrequestreview-514792757", "createdAt": "2020-10-22T14:30:21Z", "commit": {"oid": "76a6a847c702a16b2b6a1e4306066d16baa0f3c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDozMDoyMVrOHmkvHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDozMDoyMVrOHmkvHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwOTgyMA==", "bodyText": "Should this be a more interesting exit code than just 1?", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510209820", "createdAt": "2020-10-22T14:30:21Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/bytebuddy/ExceptionHandlers.java", "diffHunk": "@@ -70,9 +84,13 @@ public Size apply(final MethodVisitor mv, final Implementation.Context context)\n               mv.visitMethodInsn(\n                   Opcodes.INVOKEINTERFACE,\n                   LOGGER_NAME,\n-                  \"debug\",\n+                  logMethod,\n                   \"(Ljava/lang/String;Ljava/lang/Throwable;)V\",\n                   true);\n+              if (exitOnFailure) {\n+                mv.visitInsn(Opcodes.ICONST_1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76a6a847c702a16b2b6a1e4306066d16baa0f3c1"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76a6a847c702a16b2b6a1e4306066d16baa0f3c1", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/76a6a847c702a16b2b6a1e4306066d16baa0f3c1", "committedDate": "2020-10-22T14:19:27Z", "message": "Add internal testing option to exit JVM on advice failure"}, "afterCommit": {"oid": "6105285fec5f9bcb61c05f6f37fe5be72775e362", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6105285fec5f9bcb61c05f6f37fe5be72775e362", "committedDate": "2020-10-22T15:56:55Z", "message": "Add internal testing option to exit JVM on advice failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0OTMwMjEz", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#pullrequestreview-514930213", "createdAt": "2020-10-22T16:50:32Z", "commit": {"oid": "6105285fec5f9bcb61c05f6f37fe5be72775e362"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDc5MjQ2", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#pullrequestreview-515079246", "createdAt": "2020-10-22T20:07:40Z", "commit": {"oid": "6105285fec5f9bcb61c05f6f37fe5be72775e362"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDowNzo0MFrOHmx7mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDowNzo0MFrOHmx7mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNjAxMA==", "bodyText": "Where do you intend to enable this config?", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510426010", "createdAt": "2020-10-22T20:07:40Z", "author": {"login": "tylerbenson"}, "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/bytebuddy/ExceptionHandlers.java", "diffHunk": "@@ -33,13 +34,26 @@ public boolean isValid() {\n             public Size apply(final MethodVisitor mv, final Implementation.Context context) {\n               final String name = context.getInstrumentedType().getName();\n               final ClassLoader classLoader = Thread.currentThread().getContextClassLoader();\n+              final boolean exitOnFailure = Config.get().isInternalExitOnFailure();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6105285fec5f9bcb61c05f6f37fe5be72775e362"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04ae9707728f26ce3c7229899c61e3320db970d8", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/04ae9707728f26ce3c7229899c61e3320db970d8", "committedDate": "2020-10-23T08:30:13Z", "message": "Add internal testing option to exit JVM on advice failure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6105285fec5f9bcb61c05f6f37fe5be72775e362", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/6105285fec5f9bcb61c05f6f37fe5be72775e362", "committedDate": "2020-10-22T15:56:55Z", "message": "Add internal testing option to exit JVM on advice failure"}, "afterCommit": {"oid": "04ae9707728f26ce3c7229899c61e3320db970d8", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/04ae9707728f26ce3c7229899c61e3320db970d8", "committedDate": "2020-10-23T08:30:13Z", "message": "Add internal testing option to exit JVM on advice failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cebe8c1f37a6c28cfffec55f8931e7d286b58856", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cebe8c1f37a6c28cfffec55f8931e7d286b58856", "committedDate": "2020-10-23T12:54:27Z", "message": "Make it possible to fork a new JVM for individual test classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8382aa5625b26ed4ebaf7f98c321cf4ef50316d4", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/8382aa5625b26ed4ebaf7f98c321cf4ef50316d4", "committedDate": "2020-10-23T10:09:00Z", "message": "test forking"}, "afterCommit": {"oid": "cebe8c1f37a6c28cfffec55f8931e7d286b58856", "author": {"user": {"login": "bantonsson", "name": "Bj\u00f6rn Antonsson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/cebe8c1f37a6c28cfffec55f8931e7d286b58856", "committedDate": "2020-10-23T12:54:27Z", "message": "Make it possible to fork a new JVM for individual test classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NjY3Mzg0", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#pullrequestreview-515667384", "createdAt": "2020-10-23T13:29:58Z", "commit": {"oid": "cebe8c1f37a6c28cfffec55f8931e7d286b58856"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3039, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}