{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNzkyNDE4", "number": 1263, "title": "Introduce dd.tags", "bodyText": "Introduce dd.tags system property and DD_TAGS env variable to configure tags that are applied to all parts of the agent", "createdAt": "2020-02-27T11:27:48Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1263", "merged": true, "mergeCommit": {"oid": "bc85e69aadc232c577d7160a843328f7d6ef4621"}, "closed": true, "closedAt": "2020-02-27T16:28:55Z", "author": {"login": "mar-kolya"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIZl4ogH2gAyMzgwNzkyNDE4OjA3NTJiMDdkOTJiYWJhOTY2NDM1NjIwMmU1Mjg3ODI1YTUxZmRhNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIdt4JAFqTM2NTc5MzgzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0752b07d92baba9664356202e5287825a51fda5e", "author": {"user": {"login": "mar-kolya", "name": "Nikolay Martynov"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/0752b07d92baba9664356202e5287825a51fda5e", "committedDate": "2020-02-27T11:26:29Z", "message": "Introduce dd.tags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjEyNzUz", "url": "https://github.com/DataDog/dd-trace-java/pull/1263#pullrequestreview-365612753", "createdAt": "2020-02-27T11:39:20Z", "commit": {"oid": "0752b07d92baba9664356202e5287825a51fda5e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMTozOToyMVrOFvPByQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMTozOToyMVrOFvPByQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3MzYwOQ==", "bodyText": "\ud83d\udc4f \ud83d\udc4f \ud83d\udc4f", "url": "https://github.com/DataDog/dd-trace-java/pull/1263#discussion_r385073609", "createdAt": "2020-02-27T11:39:21Z", "author": {"login": "dbenamydd"}, "path": "dd-trace-api/src/test/groovy/datadog/trace/api/ConfigTest.groovy", "diffHunk": "@@ -1033,4 +1038,65 @@ class ConfigTest extends DDSpecification {\n     then:\n     config.profilingApiKey == \"test-api-key\"\n   }\n+\n+  def \"verify dd.tags overrides global tags in properties\"() {\n+    setup:\n+    def prop = new Properties()\n+    prop.setProperty(TAGS, \"a:1\")\n+    prop.setProperty(GLOBAL_TAGS, \"b:2\")\n+    prop.setProperty(SPAN_TAGS, \"c:3\")\n+    prop.setProperty(JMX_TAGS, \"d:4\")\n+    prop.setProperty(HEADER_TAGS, \"e:5\")\n+    prop.setProperty(PROFILING_TAGS, \"f:6\")\n+\n+    when:\n+    Config config = Config.get(prop)\n+\n+    then:\n+    config.mergedSpanTags == [a: \"1\", c: \"3\"]\n+    config.mergedJmxTags == [a: \"1\", d: \"4\", (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName]\n+    config.headerTags == [e: \"5\"]\n+\n+    config.mergedProfilingTags == [a: \"1\", f: \"6\", (HOST_TAG): config.getHostName(), (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName, (LANGUAGE_TAG_KEY): LANGUAGE_TAG_VALUE]\n+  }\n+\n+  def \"verify dd.tags overrides global tags in system properties\"() {\n+    setup:\n+    System.setProperty(PREFIX + TAGS, \"a:1\")\n+    System.setProperty(PREFIX + GLOBAL_TAGS, \"b:2\")\n+    System.setProperty(PREFIX + SPAN_TAGS, \"c:3\")\n+    System.setProperty(PREFIX + JMX_TAGS, \"d:4\")\n+    System.setProperty(PREFIX + HEADER_TAGS, \"e:5\")\n+    System.setProperty(PREFIX + PROFILING_TAGS, \"f:6\")\n+\n+    when:\n+    Config config = new Config()\n+\n+    then:\n+    config.mergedSpanTags == [a: \"1\", c: \"3\"]\n+    config.mergedJmxTags == [a: \"1\", d: \"4\", (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName]\n+    config.headerTags == [e: \"5\"]\n+\n+    config.mergedProfilingTags == [a: \"1\", f: \"6\", (HOST_TAG): config.getHostName(), (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName, (LANGUAGE_TAG_KEY): LANGUAGE_TAG_VALUE]\n+  }\n+\n+  def \"verify dd.tags overrides global tags in env variables\"() {\n+    setup:\n+    environmentVariables.set(DD_TAGS_ENV, \"a:1\")\n+    environmentVariables.set(DD_GLOBAL_TAGS_ENV, \"b:2\")\n+    environmentVariables.set(DD_SPAN_TAGS_ENV, \"c:3\")\n+    environmentVariables.set(DD_JMX_TAGS_ENV, \"d:4\")\n+    environmentVariables.set(DD_HEADER_TAGS_ENV, \"e:5\")\n+    environmentVariables.set(DD_PROFILING_TAGS_ENV, \"f:6\")\n+\n+    when:\n+    Config config = new Config()\n+\n+    then:\n+    config.mergedSpanTags == [a: \"1\", c: \"3\"]\n+    config.mergedJmxTags == [a: \"1\", d: \"4\", (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName]\n+    config.headerTags == [e: \"5\"]\n+\n+    config.mergedProfilingTags == [a: \"1\", f: \"6\", (HOST_TAG): config.getHostName(), (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName, (LANGUAGE_TAG_KEY): LANGUAGE_TAG_VALUE]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0752b07d92baba9664356202e5287825a51fda5e"}, "originalPosition": 124}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NzkzODMy", "url": "https://github.com/DataDog/dd-trace-java/pull/1263#pullrequestreview-365793832", "createdAt": "2020-02-27T16:14:50Z", "commit": {"oid": "0752b07d92baba9664356202e5287825a51fda5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2531, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}