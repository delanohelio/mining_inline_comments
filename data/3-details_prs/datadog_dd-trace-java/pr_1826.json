{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MDE4ODE3", "number": 1826, "title": "Tag health metrics with service, env, and version", "bodyText": "Adds service, env, and version tags to health metrics", "createdAt": "2020-09-03T22:00:48Z", "url": "https://github.com/DataDog/dd-trace-java/pull/1826", "merged": true, "mergeCommit": {"oid": "55ecf25093f2cc2bff6e4a71b136a22a6532f5e9"}, "closed": true, "closedAt": "2020-09-04T17:21:45Z", "author": {"login": "randomanderson"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFX7IyAH2gAyNDc5MDE4ODE3OjUwNzMzMWU3NjA3MzY1MWQ5M2Q3NGNiMTBkNzk4MDEyM2RmMDFhNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFpTC5AFqTQ4Mjg1ODc5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "507331e76073651d93d74cb10d7980123df01a47", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/507331e76073651d93d74cb10d7980123df01a47", "committedDate": "2020-09-03T21:59:16Z", "message": "Tag health metrics with service, env, and version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzkwOTE1", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#pullrequestreview-482390915", "createdAt": "2020-09-04T06:30:35Z", "commit": {"oid": "507331e76073651d93d74cb10d7980123df01a47"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMDozNVrOHNBRFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjozMToyOVrOHNBSbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQxNDI5Mg==", "bodyText": "Not a big thing, but could you call config.getMergedSpanTags() only once? It actually creates a new Map and merge the tags every time it's called.", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#discussion_r483414292", "createdAt": "2020-09-04T06:30:35Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -568,16 +569,27 @@ private static StatsDClient createStatsDClient(final Config config) {\n         port = config.getJmxFetchStatsdPort();\n       }\n \n-      final String[] constantTags =\n-          new String[] {\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"),\n-            statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION),\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME),\n-            statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR),\n-            statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION)\n-          };\n+      final List<String> constantTags = new ArrayList<>();\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"));\n+      constantTags.add(statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION));\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME));\n+      constantTags.add(\n+          statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR));\n+      constantTags.add(statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION));\n+      constantTags.add(statsdTag(\"service\", config.getServiceName()));\n+\n+      final String version = config.getMergedSpanTags().get(GeneralConfig.VERSION);\n+      if (version != null && !version.isEmpty()) {\n+        constantTags.add(statsdTag(\"version\", version));\n+      }\n+\n+      final String env = config.getMergedSpanTags().get(GeneralConfig.ENV);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "507331e76073651d93d74cb10d7980123df01a47"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQxNDYzNg==", "bodyText": "Is this version supposed to be env?", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#discussion_r483414636", "createdAt": "2020-09-04T06:31:29Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -568,16 +569,27 @@ private static StatsDClient createStatsDClient(final Config config) {\n         port = config.getJmxFetchStatsdPort();\n       }\n \n-      final String[] constantTags =\n-          new String[] {\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"),\n-            statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION),\n-            statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME),\n-            statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR),\n-            statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION)\n-          };\n+      final List<String> constantTags = new ArrayList<>();\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, \"java\"));\n+      constantTags.add(statsdTag(LANG_VERSION_STATSD_TAG, DDTraceCoreInfo.JAVA_VERSION));\n+      constantTags.add(statsdTag(LANG_INTERPRETER_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_NAME));\n+      constantTags.add(\n+          statsdTag(LANG_INTERPRETER_VENDOR_STATSD_TAG, DDTraceCoreInfo.JAVA_VM_VENDOR));\n+      constantTags.add(statsdTag(TRACER_VERSION_STATSD_TAG, DDTraceCoreInfo.VERSION));\n+      constantTags.add(statsdTag(\"service\", config.getServiceName()));\n+\n+      final String version = config.getMergedSpanTags().get(GeneralConfig.VERSION);\n+      if (version != null && !version.isEmpty()) {\n+        constantTags.add(statsdTag(\"version\", version));\n+      }\n+\n+      final String env = config.getMergedSpanTags().get(GeneralConfig.ENV);\n+      if (version != null && !version.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "507331e76073651d93d74cb10d7980123df01a47"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da570dda18303e3a21c21f716ac96c8f818330ce", "author": {"user": {"login": "randomanderson", "name": "Laplie Anderson"}}, "url": "https://github.com/DataDog/dd-trace-java/commit/da570dda18303e3a21c21f716ac96c8f818330ce", "committedDate": "2020-09-04T16:31:27Z", "message": "Address comments, add test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODEzMTk1", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#pullrequestreview-482813195", "createdAt": "2020-09-04T16:51:54Z", "commit": {"oid": "da570dda18303e3a21c21f716ac96c8f818330ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODU4Nzk2", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#pullrequestreview-482858796", "createdAt": "2020-09-04T18:13:45Z", "commit": {"oid": "da570dda18303e3a21c21f716ac96c8f818330ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODoxMzo0NlrOHNXkiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODoxMzo0NlrOHNXkiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc3OTcyMA==", "bodyText": "nice", "url": "https://github.com/DataDog/dd-trace-java/pull/1826#discussion_r483779720", "createdAt": "2020-09-04T18:13:46Z", "author": {"login": "richardstartin"}, "path": "dd-trace-core/src/test/groovy/datadog/trace/core/CoreTracerTest.groovy", "diffHunk": "@@ -64,6 +67,62 @@ class CoreTracerTest extends DDSpecification {\n     tracer.statsDClient instanceof NonBlockingStatsDClient\n   }\n \n+  def \"verify service, env, and version are added as stats tags\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da570dda18303e3a21c21f716ac96c8f818330ce"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1995, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}