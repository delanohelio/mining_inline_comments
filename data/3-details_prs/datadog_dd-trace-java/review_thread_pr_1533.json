{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NzQ2MDc1", "number": 1533, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMzozODo1MlrOECkHbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozNDo0MFrOECniaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTI0MzM1OnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMzozODo1M1rOGfGNhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMzozODo1M1rOGfGNhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI2MDgwNA==", "bodyText": "Oops, I see misunderstood.  This is covering the value.  Nice.", "url": "https://github.com/DataDog/dd-trace-java/pull/1533#discussion_r435260804", "createdAt": "2020-06-04T13:38:53Z", "author": {"login": "dougqh"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "diffHunk": "@@ -107,7 +126,21 @@ private static void writeUTF8Tag(final String value, final MessagePacker destina\n         destination.packRawStringHeader(interned.length);\n         destination.addPayload(interned);\n       } else {\n-        destination.packString(value);\n+        byte[] bytes = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92214502f61ff4012fccd13ea7d5558e90a41357"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTgwMzk1OnYy", "diffSide": "RIGHT", "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozNDo0MFrOGfLzZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0NTozOFrOGfMY6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1MjQyMA==", "bodyText": "When would this ever be null?", "url": "https://github.com/DataDog/dd-trace-java/pull/1533#discussion_r435352420", "createdAt": "2020-06-04T15:34:40Z", "author": {"login": "tylerbenson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "diffHunk": "@@ -107,7 +126,21 @@ private static void writeUTF8Tag(final String value, final MessagePacker destina\n         destination.packRawStringHeader(interned.length);\n         destination.addPayload(interned);\n       } else {\n-        destination.packString(value);\n+        byte[] bytes = null;\n+        if (value.length() > 0) {\n+          try {\n+            bytes = tagCache.get(value);\n+\n+          } catch (ExecutionException e) {\n+            // Something went wrong. We will write out the string the normal way.\n+          }\n+        }\n+        if (bytes != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92214502f61ff4012fccd13ea7d5558e90a41357"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MjAyNA==", "bodyText": "If the string is \"\" or if the tagCache.get throws an exception.", "url": "https://github.com/DataDog/dd-trace-java/pull/1533#discussion_r435362024", "createdAt": "2020-06-04T15:45:38Z", "author": {"login": "bantonsson"}, "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "diffHunk": "@@ -107,7 +126,21 @@ private static void writeUTF8Tag(final String value, final MessagePacker destina\n         destination.packRawStringHeader(interned.length);\n         destination.addPayload(interned);\n       } else {\n-        destination.packString(value);\n+        byte[] bytes = null;\n+        if (value.length() > 0) {\n+          try {\n+            bytes = tagCache.get(value);\n+\n+          } catch (ExecutionException e) {\n+            // Something went wrong. We will write out the string the normal way.\n+          }\n+        }\n+        if (bytes != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1MjQyMA=="}, "originalCommit": {"oid": "92214502f61ff4012fccd13ea7d5558e90a41357"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 200, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}