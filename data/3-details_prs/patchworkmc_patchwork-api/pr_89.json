{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1ODAzNTkw", "number": 89, "title": "Add the PlayerXpEvent events (add XP points/level, pickup XP orb)", "bodyText": "Required for Curios, See #84.\nI can't remember if it is in Forge, but I've marked PlayerPickupXpEvent as deprecated as it's removed in Forge for 1.15. It seems to have been the original event for interacting with XP pickups, until it was superseded by the PlayerXpEvent family of events.\nWhen PlayerXpEvent.XpChange is cancelled, there is a very small behavioural difference to Forge: PlayerEntity.addScore (with zero as an argument) and PlayerEntity.getNextLevelExperience are called. The former calls get and set on a DataTracker, the latter doesn't call any other methods (and while other mods hooking getNextLevelExperience is plausible, one would expect those not to have any side-effects).\nSince a @ModifyVariable mixin is used, it's not (as far as I know) straightforward to also properly cancel this event, though of course it can be done if you think it might make a difference.", "createdAt": "2020-06-17T11:58:58Z", "url": "https://github.com/PatchworkMC/patchwork-api/pull/89", "merged": true, "mergeCommit": {"oid": "b9e96152ad908ac8d0111b61711c5307eb27feac"}, "closed": true, "closedAt": "2020-06-20T01:28:31Z", "author": {"login": "ZNixian"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsIchwgH2gAyNDM1ODAzNTkwOmM1ZGY4MWNiN2QwYzc0NjgyZTgzOTUxNDA3YWQ3NTI5MmEzZTdlMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs9NdyAH2gAyNDM1ODAzNTkwOmVkOGM4ZDRkOWE0MWU3NDU2YzU4OGQzYjRiZTlhMzc0MTdlMDMyN2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c5df81cb7d0c74682e83951407ad75292a3e7e0c", "author": {"user": {"login": "ZNixian", "name": "Campbell Suter"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/c5df81cb7d0c74682e83951407ad75292a3e7e0c", "committedDate": "2020-06-17T11:49:09Z", "message": "Add the PlayerXpEvent events (add XP points/level, pickup XP orb)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyODY1MDAy", "url": "https://github.com/PatchworkMC/patchwork-api/pull/89#pullrequestreview-432865002", "createdAt": "2020-06-18T00:37:03Z", "commit": {"oid": "c5df81cb7d0c74682e83951407ad75292a3e7e0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMDozNzowNFrOGlbygg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMDo0Mjo0NVrOGlb3uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNTc5NA==", "bodyText": "This should be a javadoc.", "url": "https://github.com/PatchworkMC/patchwork-api/pull/89#discussion_r441905794", "createdAt": "2020-06-18T00:37:04Z", "author": {"login": "TheGlitch76"}, "path": "patchwork-events-entity/src/main/java/net/minecraftforge/event/entity/player/PlayerXpEvent.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.event.entity.player;\n+\n+import net.minecraft.entity.ExperienceOrbEntity;\n+import net.minecraft.entity.player.PlayerEntity;\n+\n+public abstract class PlayerXpEvent extends PlayerEvent {\n+\tpublic PlayerXpEvent(PlayerEntity player) {\n+\t\tsuper(player);\n+\t}\n+\n+\t// For legacy reasons, the instances of this class should actually be of\n+\t// type PlayerPickupXpEvent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5df81cb7d0c74682e83951407ad75292a3e7e0c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNjczMw==", "bodyText": "This Handle opcode looks suspicious. Have you tested this mixin and confirmed it works?", "url": "https://github.com/PatchworkMC/patchwork-api/pull/89#discussion_r441906733", "createdAt": "2020-06-18T00:40:59Z", "author": {"login": "TheGlitch76"}, "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinExperienceOrbEntity.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import net.minecraftforge.common.MinecraftForge;\n+import net.minecraftforge.event.entity.player.PlayerPickupXpEvent;\n+import org.objectweb.asm.Opcodes;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.ExperienceOrbEntity;\n+\n+@Mixin(ExperienceOrbEntity.class)\n+public class MixinExperienceOrbEntity {\n+\t// After checking we're on the server and the player is ready to pick up the orb, the first\n+\t// thing the target method does is set experiencePickUpDelay, hence hook just before that.\n+\t@Inject(method = \"onPlayerCollision\", cancellable = true, at = @At(value = \"FIELD\", opcode = Opcodes.H_PUTFIELD, ordinal = 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5df81cb7d0c74682e83951407ad75292a3e7e0c"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNzEyOA==", "bodyText": "While you're at it please make sure this launches in a reobf environment (compiled and in MultiMC/vanilla launcher)", "url": "https://github.com/PatchworkMC/patchwork-api/pull/89#discussion_r441907128", "createdAt": "2020-06-18T00:42:45Z", "author": {"login": "TheGlitch76"}, "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinExperienceOrbEntity.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import net.minecraftforge.common.MinecraftForge;\n+import net.minecraftforge.event.entity.player.PlayerPickupXpEvent;\n+import org.objectweb.asm.Opcodes;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.ExperienceOrbEntity;\n+\n+@Mixin(ExperienceOrbEntity.class)\n+public class MixinExperienceOrbEntity {\n+\t// After checking we're on the server and the player is ready to pick up the orb, the first\n+\t// thing the target method does is set experiencePickUpDelay, hence hook just before that.\n+\t@Inject(method = \"onPlayerCollision\", cancellable = true, at = @At(value = \"FIELD\", opcode = Opcodes.H_PUTFIELD, ordinal = 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNjczMw=="}, "originalCommit": {"oid": "c5df81cb7d0c74682e83951407ad75292a3e7e0c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5f0ff4b0601a6e3276212a44f36c7824f66e43c", "author": {"user": {"login": "ZNixian", "name": "Campbell Suter"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/d5f0ff4b0601a6e3276212a44f36c7824f66e43c", "committedDate": "2020-06-19T05:54:20Z", "message": "Fix the Javadoc for PlayerXpEvent.PickupXp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MzEyNzI1", "url": "https://github.com/PatchworkMC/patchwork-api/pull/89#pullrequestreview-434312725", "createdAt": "2020-06-19T19:58:50Z", "commit": {"oid": "d5f0ff4b0601a6e3276212a44f36c7824f66e43c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "647854a59252512ff32930783ffd3476b30412ef", "author": {"user": {"login": "ZNixian", "name": "Campbell Suter"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/647854a59252512ff32930783ffd3476b30412ef", "committedDate": "2020-06-20T01:15:46Z", "message": "Merge remote-tracking branch 'origin/master' into player-xp-events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed8c8d4d9a41e7456c588d3b4be9a37417e0327f", "author": {"user": {"login": "ZNixian", "name": "Campbell Suter"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/ed8c8d4d9a41e7456c588d3b4be9a37417e0327f", "committedDate": "2020-06-20T01:17:40Z", "message": "Bump patchwork-events-entity from v0.3.0 to v0.4.0"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1153, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}