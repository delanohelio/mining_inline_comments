{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NTQwMTUw", "number": 158, "title": "Impl ServerTickEvent and RenderTickEvent", "bodyText": "Contained herein are my efforts to eliminate every TODO from the TickEvent class!\nA few things of note here:\n\nFabric API's START_SERVER_TICK event, which is what I've used to implement ServerTickEvent (trying not to reinvent the wheel here), fires slightly later than the START phase of Forge's ServerTickEvent. Here's what I mean:\n\n    protected void tick(BooleanSupplier booleanSupplier) {\n        long l = Util.getMeasuringTimeNano();\n        // Forge fires here\n        ++this.ticks;\n        // Fabric API fires here\n        this.tickWorlds(booleanSupplier);\n        ...\nIf this is problematic, I could create a custom inject to match Forge. (This issue does not exist with Fabric API's END_SERVER_TICK, which I've also used, as both Forge and Fabric API fire their respective events at the very end of the method.)\n\nAs Fabric API has no render tick events, I wrote mixins to cover that territory. This about sums up the results of that endeavor:\n\n        ...\n        if (!this.skipGameRender) {\n            // RenderTickEvent START phase fires here with both stock Forge and the mixin\n            this.profiler.swap(\"gameRenderer\");\n            this.gameRenderer.render(this.paused ? this.pausedTickDelta : this.renderTickCounter.tickDelta, l, tick);\n            this.profiler.swap(\"toasts\");\n            this.toastManager.draw();\n            // RenderTickEvent END phase fires here with the mixin\n            this.profiler.pop();\n            // RenderTickEvent END phase fires here with stock Forge\n        }\n        // Could potentially mixin another (!this.skipGameRender) conditional here as a workaround\n        this.profiler.endTick();\n        ...\nFrankly, I'm not quite sure how to mixin where Forge patches it in. However, if the event firing before this.profiler.pop() is problematic, then the workaround specified above would theoretically accomplish the same thing - albeit in a way that isn't as clean. (How important is the profiler in relation to this event?)", "createdAt": "2020-07-28T04:31:40Z", "url": "https://github.com/PatchworkMC/patchwork-api/pull/158", "merged": true, "mergeCommit": {"oid": "f76e5dbd1a72fcbcecd549d1f09f63c0123f8db4"}, "closed": true, "closedAt": "2020-07-30T02:24:26Z", "author": {"login": "GammaWhiskey"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5LE_FAH2gAyNDU3NTQwMTUwOmVkYTk3ODYyOGY0ZjYyOTBiODkyOTc1YTIwOTBhNTY2Y2Y2NzM3OWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc52I3DgFqTQ1ODAyODE4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eda978628f4f6290b892975a2090a566cf67379d", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/eda978628f4f6290b892975a2090a566cf67379d", "committedDate": "2020-07-28T00:14:10Z", "message": "Impl TickEvent.ServerTickEvent with FAPI Lifecycle Events V1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e50391bde4030625803732b62d83f8b565bb02a", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/0e50391bde4030625803732b62d83f8b565bb02a", "committedDate": "2020-07-28T03:37:11Z", "message": "Impl TickEvent.RenderTickEvent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzY2NzYy", "url": "https://github.com/PatchworkMC/patchwork-api/pull/158#pullrequestreview-456366762", "createdAt": "2020-07-28T07:23:44Z", "commit": {"oid": "0e50391bde4030625803732b62d83f8b565bb02a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNzoyMzo0NFrOG3_6VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNzoyMzo0NFrOG3_6VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM3MTk4OA==", "bodyText": "Are either of these methods present in ForgeHooks/ForgeEventFactory? or BasicEventHooks or something? If they are, you should add them to the relevant class in patchwork.", "url": "https://github.com/PatchworkMC/patchwork-api/pull/158#discussion_r461371988", "createdAt": "2020-07-28T07:23:44Z", "author": {"login": "kitlith"}, "path": "patchwork-events-lifecycle/src/main/java/net/patchworkmc/impl/event/lifecycle/LifecycleEvents.java", "diffHunk": "@@ -57,6 +58,15 @@ public static void fireClientTickEvent(TickEvent.Phase phase) {\n \t\tMinecraftForge.EVENT_BUS.post(new TickEvent.ClientTickEvent(phase));\n \t}\n \n+\tpublic static void fireRenderTickEvent(TickEvent.Phase phase, float renderTickTime) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e50391bde4030625803732b62d83f8b565bb02a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b2a680df5d3a5b7d97b318ca86b891f6027eb8", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/42b2a680df5d3a5b7d97b318ca86b891f6027eb8", "committedDate": "2020-07-28T07:43:20Z", "message": "Add ServerTick and RenderTick events to BasicEventHooks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4620a8611b6cc3961d62f7529c48ae8119fad66", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/b4620a8611b6cc3961d62f7529c48ae8119fad66", "committedDate": "2020-07-28T07:50:34Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aae8e39521ab29fbe4a73ec76b387b9eff890fb4", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/aae8e39521ab29fbe4a73ec76b387b9eff890fb4", "committedDate": "2020-07-28T23:33:44Z", "message": "Shift hookRenderTickEnd to match Forge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1e16de81872f588c3017fbadc94895a62c4314", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/2e1e16de81872f588c3017fbadc94895a62c4314", "committedDate": "2020-07-29T21:21:48Z", "message": "Merge branch 'master' into feature/tickevents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c5835d29eae469f92419524d40ee21e04966078", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/2c5835d29eae469f92419524d40ee21e04966078", "committedDate": "2020-07-29T21:28:40Z", "message": "Fix style after merge conflict resolution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTg1MTgz", "url": "https://github.com/PatchworkMC/patchwork-api/pull/158#pullrequestreview-457985183", "createdAt": "2020-07-30T00:27:14Z", "commit": {"oid": "2c5835d29eae469f92419524d40ee21e04966078"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMDoyNzoxNVrOG5Ox4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMDoyNzoxNVrOG5Ox4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY2NDE2Mg==", "bodyText": "Could you use an @slice with a INVOKE_STRING to bring this ordinal down?", "url": "https://github.com/PatchworkMC/patchwork-api/pull/158#discussion_r462664162", "createdAt": "2020-07-30T00:27:15Z", "author": {"login": "TheGlitch76"}, "path": "patchwork-events-lifecycle/src/main/java/net/patchworkmc/mixin/event/lifecycle/MixinMinecraftClient.java", "diffHunk": "@@ -51,4 +54,28 @@ private void hookClientTickEnd(CallbackInfo info) {\n \tprivate void hookClientInit(CallbackInfo ci) {\n \t\tLifecycleEvents.handleLoadComplete();\n \t}\n+\n+\t@Shadow\n+\t@Final\n+\tprivate RenderTickCounter renderTickCounter;\n+\n+\t// Note: for some reason, ordinal does not consider ldc, which means ldc is completely useless here.\n+\t// It's kept here for the sake of reference/readability only.\n+\t@Inject(method = \"render\", at = @At(\n+\t\t\tvalue = \"INVOKE_STRING\",\n+\t\t\ttarget = \"net/minecraft/util/profiler/DisableableProfiler.swap(Ljava/lang/String;)V\",\n+\t\t\targs = \"ldc=gameRenderer\",\n+\t\t\tordinal = 1))\n+\tprivate void hookRenderTickStart(CallbackInfo ci) {\n+\t\tLifecycleEvents.fireRenderTickEvent(TickEvent.Phase.START, this.renderTickCounter.tickDelta);\n+\t}\n+\n+\t@Inject(method = \"render\", at = @At(\n+\t\t\tvalue = \"INVOKE\",\n+\t\t\ttarget = \"net/minecraft/util/profiler/DisableableProfiler.pop()V\",\n+\t\t\tshift = At.Shift.AFTER,\n+\t\t\tordinal = 3))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c5835d29eae469f92419524d40ee21e04966078"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "780a9a5e355f046b0e54b1e8ba735a0edf9e8476", "author": {"user": {"login": "GammaWhiskey", "name": "Gamma"}}, "url": "https://github.com/PatchworkMC/patchwork-api/commit/780a9a5e355f046b0e54b1e8ba735a0edf9e8476", "committedDate": "2020-07-30T01:20:27Z", "message": "Reduce ordinal on hookRenderTickEvent with slice"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MDI4MTg2", "url": "https://github.com/PatchworkMC/patchwork-api/pull/158#pullrequestreview-458028186", "createdAt": "2020-07-30T02:24:19Z", "commit": {"oid": "780a9a5e355f046b0e54b1e8ba735a0edf9e8476"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 947, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}