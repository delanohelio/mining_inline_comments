{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjk0NDkw", "number": 2337, "title": "pscanrules: Use Alert Builder", "bodyText": "Now that all three packages are targeting 2.9.0 switch all scan rules to leverage the Alert Builder pattern.\nSigned-off-by: kingthorin kingthorin@users.noreply.github.com", "createdAt": "2020-03-18T22:22:55Z", "url": "https://github.com/zaproxy/zap-extensions/pull/2337", "merged": true, "mergeCommit": {"oid": "a2f7c391a0ff5b274363500bff1dc40fa37c87ab"}, "closed": true, "closedAt": "2020-03-25T09:38:04Z", "author": {"login": "kingthorin"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPgl1ZAFqTM3ODQ4NDY5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcREONSAFqTM4MDk4NTMyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NDg0Njkw", "url": "https://github.com/zaproxy/zap-extensions/pull/2337#pullrequestreview-378484690", "createdAt": "2020-03-20T13:33:14Z", "commit": {"oid": "a449552da0ca8e6064d74bd470234ff5d4300cfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzozMzoxNFrOF5T0rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzozMzoxNFrOF5T0rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzkzMg==", "bodyText": "Note the original specified RISK twice, so I'm assuming this is correct.", "url": "https://github.com/zaproxy/zap-extensions/pull/2337#discussion_r395637932", "createdAt": "2020-03-20T13:33:14Z", "author": {"login": "kingthorin"}, "path": "addOns/pscanrules/src/main/java/org/zaproxy/zap/extension/pscanrules/ViewstateScanner.java", "diffHunk": "@@ -80,122 +79,68 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n \n     private void alertViewstateAnalyzerResult(\n             HttpMessage msg, int id, ViewstateAnalyzerResult var) {\n-        Alert alert =\n-                new Alert(\n-                        getPluginId(),\n-                        Alert.RISK_MEDIUM,\n-                        Alert.CONFIDENCE_MEDIUM,\n-                        var.pattern.getAlertHeader());\n-\n-        alert.setDetail(\n-                var.pattern.getAlertDescription(),\n-                msg.getRequestHeader().getURI().toString(),\n-                \"\",\n-                \"\",\n-                var.getResultExtract().toString(),\n-                getSolution(), // Solution\n-                \"\",\n-                \"\", // No Evidence\n-                16, // CWE Id 16 - Configuration\n-                14, // WASC Id - Server Misconfiguration\n-                msg);\n-\n-        parent.raiseAlert(id, alert);\n+        newAlert()\n+                .setName(var.pattern.getAlertHeader())\n+                .setRisk(Alert.RISK_MEDIUM)\n+                .setConfidence(Alert.CONFIDENCE_MEDIUM)\n+                .setDescription(var.pattern.getAlertDescription())\n+                .setOtherInfo(var.getResultExtract().toString())\n+                .setSolution(getSolution())\n+                .setCweId(16) // CWE Id 16 - Configuration\n+                .setWascId(14) // WASC Id - Server Misconfiguration\n+                .raise();\n     }\n \n     private void alertOldAspVersion(HttpMessage msg, int id) {\n-        Alert alert =\n-                new Alert(\n-                        getPluginId(),\n-                        Alert.RISK_LOW,\n-                        Alert.CONFIDENCE_MEDIUM,\n-                        Constant.messages.getString(MESSAGE_PREFIX + \"oldver.name\"));\n-\n-        alert.setDetail(\n-                Constant.messages.getString(MESSAGE_PREFIX + \"oldver.desc\"),\n-                msg.getRequestHeader().getURI().toString(),\n-                \"\",\n-                \"\",\n-                \"\",\n-                Constant.messages.getString(MESSAGE_PREFIX + \"oldver.soln\"),\n-                \"\",\n-                \"\", // No Evidence\n-                16, // CWE Id 16 - Configuration\n-                14, // WASC Id - Server Misconfiguration\n-                msg);\n-\n-        parent.raiseAlert(id, alert);\n+        newAlert()\n+                .setName(Constant.messages.getString(MESSAGE_PREFIX + \"oldver.name\"))\n+                .setRisk(Alert.RISK_LOW)\n+                .setConfidence(Alert.CONFIDENCE_MEDIUM)\n+                .setDescription(Constant.messages.getString(MESSAGE_PREFIX + \"oldver.desc\"))\n+                .setSolution(Constant.messages.getString(MESSAGE_PREFIX + \"oldver.soln\"))\n+                .setCweId(16) // CWE Id 16 - Configuration\n+                .setWascId(14) // WASC Id - Server Misconfiguration\n+                .raise();\n     }\n \n     // TODO: see if this alert triggers too often, as the detection rule is far from being robust\n     // for the moment\n     private void alertNoMACUnsure(HttpMessage msg, int id) {\n-        Alert alert =\n-                new Alert(\n-                        getPluginId(),\n-                        Alert.RISK_HIGH,\n-                        Alert.CONFIDENCE_LOW,\n-                        Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.name\"));\n-        alert.setDetail(\n-                Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.desc\"),\n-                msg.getRequestHeader().getURI().toString(),\n-                \"\",\n-                \"\",\n-                \"\",\n-                Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.soln\"),\n-                Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.refs\"),\n-                \"\", // No Evidence\n-                642, // CWE Id 642 - External Control of Critical State Data\n-                14, // WASC Id 14 - Server Misconfiguration\n-                msg);\n-\n-        parent.raiseAlert(id, alert);\n+        newAlert()\n+                .setName(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.name\"))\n+                .setRisk(Alert.RISK_HIGH)\n+                .setConfidence(Alert.CONFIDENCE_LOW)\n+                .setDescription(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.desc\"))\n+                .setSolution(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.soln\"))\n+                .setReference(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.unsure.refs\"))\n+                .setCweId(642) // CWE Id 642 - External Control of Critical State Data\n+                .setWascId(14) // WASC Id - Server Misconfiguration\n+                .raise();\n     }\n \n     private void alertNoMACforSure(HttpMessage msg, int id) {\n-        Alert alert =\n-                new Alert(\n-                        getPluginId(),\n-                        Alert.RISK_HIGH,\n-                        Alert.CONFIDENCE_MEDIUM,\n-                        Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.name\"));\n-        alert.setDetail(\n-                Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.desc\"),\n-                msg.getRequestHeader().getURI().toString(),\n-                \"\",\n-                \"\",\n-                \"\",\n-                Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.soln\"),\n-                Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.refs\"),\n-                \"\", // No Evidence\n-                642, // CWE Id 642 - External Control of Critical State Data\n-                14, // WASC Id 14 - Server Misconfiguration\n-                msg);\n-\n-        parent.raiseAlert(id, alert);\n+        newAlert()\n+                .setName(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.name\"))\n+                .setRisk(Alert.RISK_HIGH)\n+                .setConfidence(Alert.CONFIDENCE_MEDIUM)\n+                .setDescription(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.desc\"))\n+                .setSolution(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.soln\"))\n+                .setReference(Constant.messages.getString(MESSAGE_PREFIX + \"nomac.sure.refs\"))\n+                .setCweId(642) // CWE Id 642 - External Control of Critical State Data\n+                .setWascId(14) // WASC Id - Server Misconfiguration\n+                .raise();\n     }\n \n     private void alertSplitViewstate(HttpMessage msg, int id) {\n-        Alert alert =\n-                new Alert(\n-                        getPluginId(),\n-                        Alert.RISK_INFO,\n-                        Alert.RISK_INFO,\n-                        Constant.messages.getString(MESSAGE_PREFIX + \"split.name\"));\n-        alert.setDetail(\n-                Constant.messages.getString(MESSAGE_PREFIX + \"split.desc\"),\n-                msg.getRequestHeader().getURI().toString(),\n-                \"\",\n-                \"\",\n-                \"\",\n-                Constant.messages.getString(MESSAGE_PREFIX + \"split.soln\"),\n-                \"\",\n-                \"\", // No Evidence\n-                16, // CWE Id 16 - Configuration\n-                14, // WASC Id - Server Misconfiguration\n-                msg);\n-\n-        parent.raiseAlert(id, alert);\n+        newAlert()\n+                .setName(Constant.messages.getString(MESSAGE_PREFIX + \"split.name\"))\n+                .setRisk(Alert.RISK_INFO)\n+                .setConfidence(Alert.CONFIDENCE_LOW)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a449552da0ca8e6064d74bd470234ff5d4300cfb"}, "originalPosition": 170}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTAyNTE3", "url": "https://github.com/zaproxy/zap-extensions/pull/2337#pullrequestreview-378502517", "createdAt": "2020-03-20T13:54:54Z", "commit": {"oid": "a449552da0ca8e6064d74bd470234ff5d4300cfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzo1NDo1NFrOF5UqSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzo1NDo1NFrOF5UqSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY1MTY1Nw==", "bodyText": "I didn't set the name as the original could have leveraged getName() instead of using i18n a second time.", "url": "https://github.com/zaproxy/zap-extensions/pull/2337#discussion_r395651657", "createdAt": "2020-03-20T13:54:54Z", "author": {"login": "kingthorin"}, "path": "addOns/pscanrulesBeta/src/main/java/org/zaproxy/zap/extension/pscanrulesBeta/RetrievedFromCacheScanner.java", "diffHunk": "@@ -96,27 +95,15 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n                                     logger.debug(\n                                             msg.getRequestHeader().getURI().getURI()\n                                                     + \" was served from a cache, due to presence of a 'HIT' in the 'X-Cache' response header\");\n-                                Alert alert =\n-                                        new Alert(\n-                                                getPluginId(),\n-                                                Alert.RISK_INFO,\n-                                                Alert.CONFIDENCE_MEDIUM,\n-                                                Constant.messages.getString(\n-                                                        MESSAGE_PREFIX + \"name\"));\n                                 // could be from HTTP/1.0 or HTTP/1.1. We don't know which.\n-                                alert.setDetail(\n-                                        getDescription(), // Description\n-                                        msg.getRequestHeader().getURI().toString(), // URI\n-                                        \"\", // Param\n-                                        \"\", // Attack\n-                                        \"\", // Other info:\n-                                        getSolution(), // Solution\n-                                        getReference(), // References\n-                                        evidence, // Evidence\n-                                        0, // 0 - not necessarily an issue at all\n-                                        0, // 0 - not necessarily an issue at all\n-                                        msg); // HttpMessage\n-                                parent.raiseAlert(id, alert);\n+                                newAlert()\n+                                        .setRisk(Alert.RISK_INFO)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a449552da0ca8e6064d74bd470234ff5d4300cfb"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a449552da0ca8e6064d74bd470234ff5d4300cfb", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/a449552da0ca8e6064d74bd470234ff5d4300cfb", "committedDate": "2020-03-18T22:21:56Z", "message": "pscanrules: Use Alert Builder\n\nNow that all three packages are targeting 2.9.0 switch all scan rules to\nleverage the Alert Builder pattern.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "fa695850de5e1f1d206c5641751b1c2973794127", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/fa695850de5e1f1d206c5641751b1c2973794127", "committedDate": "2020-03-20T14:10:54Z", "message": "pscanrules: Use Alert Builder\n\nNow that all three packages are targeting 2.9.0 switch all scan rules to\nleverage the Alert Builder pattern.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1187bf068e4d59cc5abc81c25b310bebb16e151", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/a1187bf068e4d59cc5abc81c25b310bebb16e151", "committedDate": "2020-03-20T22:47:55Z", "message": "pscanrules: Use Alert Builder\n\nNow that all three packages are targeting 2.9.0 switch all scan rules to\nleverage the Alert Builder pattern.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa695850de5e1f1d206c5641751b1c2973794127", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/fa695850de5e1f1d206c5641751b1c2973794127", "committedDate": "2020-03-20T14:10:54Z", "message": "pscanrules: Use Alert Builder\n\nNow that all three packages are targeting 2.9.0 switch all scan rules to\nleverage the Alert Builder pattern.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "6050297737008535fd5093b64023fe3791d66ed4", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/6050297737008535fd5093b64023fe3791d66ed4", "committedDate": "2020-03-20T22:59:43Z", "message": "Add JSFunctionPassiveScanner\n\nAfter the associated PR include the new JSFunctionPassiveScanner scan\nrule.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "669e6fde8d00bf0a52d348fac02666df7d79faff", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/669e6fde8d00bf0a52d348fac02666df7d79faff", "committedDate": "2020-03-21T02:06:57Z", "message": "Add JSFunctionPassiveScanner\n\nAfter the associated PR include the new JSFunctionPassiveScanner scan\nrule.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6050297737008535fd5093b64023fe3791d66ed4", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/6050297737008535fd5093b64023fe3791d66ed4", "committedDate": "2020-03-20T22:59:43Z", "message": "Add JSFunctionPassiveScanner\n\nAfter the associated PR include the new JSFunctionPassiveScanner scan\nrule.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "669e6fde8d00bf0a52d348fac02666df7d79faff", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/669e6fde8d00bf0a52d348fac02666df7d79faff", "committedDate": "2020-03-21T02:06:57Z", "message": "Add JSFunctionPassiveScanner\n\nAfter the associated PR include the new JSFunctionPassiveScanner scan\nrule.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfa0841dcb9f3daaca65222698dff21a24697be2", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/bfa0841dcb9f3daaca65222698dff21a24697be2", "committedDate": "2020-03-24T18:55:45Z", "message": "Review Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64e277a3e7b3d101a8fca51c0bcff450b1cc3de2", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/64e277a3e7b3d101a8fca51c0bcff450b1cc3de2", "committedDate": "2020-03-24T19:03:16Z", "message": "rule.scan tweaks\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjI4MjIz", "url": "https://github.com/zaproxy/zap-extensions/pull/2337#pullrequestreview-380628223", "createdAt": "2020-03-24T19:24:04Z", "commit": {"oid": "64e277a3e7b3d101a8fca51c0bcff450b1cc3de2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTg1MzI4", "url": "https://github.com/zaproxy/zap-extensions/pull/2337#pullrequestreview-380985328", "createdAt": "2020-03-25T09:37:56Z", "commit": {"oid": "64e277a3e7b3d101a8fca51c0bcff450b1cc3de2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 405, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}