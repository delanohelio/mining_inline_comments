{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNTgyMDE2", "number": 2570, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNjo0NTo1NFrOEuUsZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NzoyMFrOEwzwSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MDA4OTk5OnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNjo0NTo1NFrOHipgfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNjo0NTo1NFrOHipgfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA5MzY5Mg==", "bodyText": "Either this or the help should be updated, they both show different values...", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r506093692", "createdAt": "2020-10-16T06:45:54Z", "author": {"login": "ricekot"}, "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "diffHunk": "@@ -526,14 +530,14 @@ public void scan() {\n \n         switch (this.getAttackStrength()) {\n             case LOW:\n-                numberOfAttackStrings = 3;\n+                numberOfAttackStrings = 1;\n                 break;\n             case MEDIUM:\n             default:\n-                numberOfAttackStrings = 5;\n+                numberOfAttackStrings = 3;\n                 break;\n             case HIGH:\n-                numberOfAttackStrings = 7;\n+                numberOfAttackStrings = 6;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 169}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjExNzc1OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MDozOVrOHmlujw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MDozOVrOHmlujw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNjA2Mw==", "bodyText": "This should no longer be needed, there's a warning in Travis CI: \"deprecated key sudo (The key sudo has no effect anymore.)\".", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510226063", "createdAt": "2020-10-22T14:50:39Z", "author": {"login": "thc202"}, "path": ".travis.yml", "diffHunk": "@@ -1,9 +1,15 @@\n language: java\n+# Sudo required for chrome as per https://docs.travis-ci.com/user/chrome\n+sudo: required", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjExODY0OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MDo0OFrOHmlvFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjoyNToyMlrOHnU8Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNjE5OA==", "bodyText": "Use specific versions? This might break the builds on updates. (At least for Chrome which requires a specific WebDriver version.)", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510226198", "createdAt": "2020-10-22T14:50:48Z", "author": {"login": "thc202"}, "path": ".travis.yml", "diffHunk": "@@ -1,9 +1,15 @@\n language: java\n+# Sudo required for chrome as per https://docs.travis-ci.com/user/chrome\n+sudo: required\n \n jdk:\n   - openjdk8\n   - openjdk11\n \n+addons:\n+  firefox: latest\n+  chrome: stable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5OTYyMg==", "bodyText": "As per irc we'll stick with this for now and see which is more painful.", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510999622", "createdAt": "2020-10-23T16:25:22Z", "author": {"login": "psiinon"}, "path": ".travis.yml", "diffHunk": "@@ -1,9 +1,15 @@\n language: java\n+# Sudo required for chrome as per https://docs.travis-ci.com/user/chrome\n+sudo: required\n \n jdk:\n   - openjdk8\n   - openjdk11\n \n+addons:\n+  firefox: latest\n+  chrome: stable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNjE5OA=="}, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjExOTgzOnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MTowNFrOHmlv4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MTowNFrOHmlv4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNjQwMw==", "bodyText": "Could be renamed too.", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510226403", "createdAt": "2020-10-22T14:51:04Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "diffHunk": "@@ -249,12 +250,12 @@ private WebDriver createWebDriver() {\n     private WebDriverWrapper getWebDriver() {\n         WebDriverWrapper fxDriver;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjEyMDUyOnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MToxM1rOHmlwUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MToxM1rOHmlwUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNjUxMg==", "bodyText": "This needs to take into account the browser set, otherwise it might return a previous browser (e.g. if the user later changed to Chrome).", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510226512", "createdAt": "2020-10-22T14:51:13Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "diffHunk": "@@ -249,12 +250,12 @@ private WebDriver createWebDriver() {\n     private WebDriverWrapper getWebDriver() {\n         WebDriverWrapper fxDriver;\n         try {\n-            fxDriver = freeFirefoxDrivers.pop();\n+            fxDriver = freeDrivers.pop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjEyMjkxOnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MTo0MFrOHmlxwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MTo0MFrOHmlxwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNjg4MA==", "bodyText": "Could be renamed.", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510226880", "createdAt": "2020-10-22T14:51:40Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/main/java/org/zaproxy/zap/extension/domxss/DomXssScanRule.java", "diffHunk": "@@ -326,12 +326,16 @@ private void returnFirefoxDriver(WebDriverWrapper fxDriver) {\n     @Override\n     public void setTimeFinished() {\n         super.setTimeFinished();\n+        tidyUp();\n+    }\n+\n+    static void tidyUp() {\n         // Tidy up...\n         // Dont kill drivers in the 'taken' list as there may be multiple scans\n         WebDriverWrapper fxDriver;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 146}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjEzOTU1OnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NTowN1rOHml8YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NTowN1rOHml8YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyOTYwMQ==", "bodyText": "Should call the equivalent for Chrome. It should also check that Chrome (and Firefox?) is really available (and return or not in testBrowsers).", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510229601", "createdAt": "2020-10-22T14:55:07Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Zed Attack Proxy (ZAP) and its related class files.\n+ *\n+ * ZAP is an HTTP/HTTPS proxy for assessing web application security.\n+ *\n+ * Copyright 2020 The ZAP Development Team\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.zaproxy.zap.extension.domxss;\n+\n+import static fi.iki.elonen.NanoHTTPD.newFixedLengthResponse;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+import fi.iki.elonen.NanoHTTPD.IHTTPSession;\n+import fi.iki.elonen.NanoHTTPD.Response;\n+import io.github.bonigarcia.wdm.WebDriverManager;\n+import java.io.IOException;\n+import java.util.stream.Stream;\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.parosproxy.paros.core.scanner.Alert;\n+import org.parosproxy.paros.network.HttpMessage;\n+import org.zaproxy.zap.extension.selenium.Browser;\n+import org.zaproxy.zap.extension.selenium.SeleniumOptions;\n+import org.zaproxy.zap.testutils.ActiveScannerTestUtils;\n+import org.zaproxy.zap.testutils.NanoServerHandler;\n+\n+public class DomXssScanRuleUnitTest extends ActiveScannerTestUtils<DomXssScanRule> {\n+\n+    @BeforeAll\n+    static void setup() {\n+        WebDriverManager.firefoxdriver().setup();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjEzOTcwOnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NTowOVrOHml8eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NTowOVrOHml8eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyOTYyNQ==", "bodyText": "Should not be needed.", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510229625", "createdAt": "2020-10-22T14:55:09Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Zed Attack Proxy (ZAP) and its related class files.\n+ *\n+ * ZAP is an HTTP/HTTPS proxy for assessing web application security.\n+ *\n+ * Copyright 2020 The ZAP Development Team\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.zaproxy.zap.extension.domxss;\n+\n+import static fi.iki.elonen.NanoHTTPD.newFixedLengthResponse;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+import fi.iki.elonen.NanoHTTPD.IHTTPSession;\n+import fi.iki.elonen.NanoHTTPD.Response;\n+import io.github.bonigarcia.wdm.WebDriverManager;\n+import java.io.IOException;\n+import java.util.stream.Stream;\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.parosproxy.paros.core.scanner.Alert;\n+import org.parosproxy.paros.network.HttpMessage;\n+import org.zaproxy.zap.extension.selenium.Browser;\n+import org.zaproxy.zap.extension.selenium.SeleniumOptions;\n+import org.zaproxy.zap.testutils.ActiveScannerTestUtils;\n+import org.zaproxy.zap.testutils.NanoServerHandler;\n+\n+public class DomXssScanRuleUnitTest extends ActiveScannerTestUtils<DomXssScanRule> {\n+\n+    @BeforeAll\n+    static void setup() {\n+        WebDriverManager.firefoxdriver().setup();\n+        System.setProperty(\n+                SeleniumOptions.FIREFOX_DRIVER_SYSTEM_PROPERTY,\n+                System.getProperty(\"webdriver.gecko.driver\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjEzOTkxOnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NToxMlrOHml8lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NToxMlrOHml8lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyOTY1NA==", "bodyText": "Remove?", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510229654", "createdAt": "2020-10-22T14:55:12Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Zed Attack Proxy (ZAP) and its related class files.\n+ *\n+ * ZAP is an HTTP/HTTPS proxy for assessing web application security.\n+ *\n+ * Copyright 2020 The ZAP Development Team\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.zaproxy.zap.extension.domxss;\n+\n+import static fi.iki.elonen.NanoHTTPD.newFixedLengthResponse;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+import fi.iki.elonen.NanoHTTPD.IHTTPSession;\n+import fi.iki.elonen.NanoHTTPD.Response;\n+import io.github.bonigarcia.wdm.WebDriverManager;\n+import java.io.IOException;\n+import java.util.stream.Stream;\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.parosproxy.paros.core.scanner.Alert;\n+import org.parosproxy.paros.network.HttpMessage;\n+import org.zaproxy.zap.extension.selenium.Browser;\n+import org.zaproxy.zap.extension.selenium.SeleniumOptions;\n+import org.zaproxy.zap.testutils.ActiveScannerTestUtils;\n+import org.zaproxy.zap.testutils.NanoServerHandler;\n+\n+public class DomXssScanRuleUnitTest extends ActiveScannerTestUtils<DomXssScanRule> {\n+\n+    @BeforeAll\n+    static void setup() {\n+        WebDriverManager.firefoxdriver().setup();\n+        System.setProperty(\n+                SeleniumOptions.FIREFOX_DRIVER_SYSTEM_PROPERTY,\n+                System.getProperty(\"webdriver.gecko.driver\"));\n+    }\n+\n+    static Stream<String> testBrowsers() {\n+        return Stream.of(\"firefox-headless\", \"chrome-headless\");\n+    }\n+\n+    @AfterAll\n+    static void tidyUp() {\n+        DomXssScanRule.tidyUp();\n+    }\n+\n+    @Override\n+    protected DomXssScanRule createScanner() {\n+        return new DomXssScanRule();\n+    }\n+\n+    @Override\n+    protected void setUpMessages() {\n+        mockMessages(new ExtensionDomXSS());\n+    }\n+\n+    @Test\n+    public void shouldUseDefaultWhenUnsupportedBrowser() throws IOException {\n+        // Given\n+        HttpMessage msg = this.getHttpMessage(\"\");\n+        this.rule.getConfig().setProperty(\"rules.domxss.browserid\", \"opera\");\n+        this.rule.init(msg, this.parent);\n+\n+        // When / Then\n+        assertThat(this.rule.getBrowser(), equalTo(Browser.FIREFOX_HEADLESS));\n+    }\n+\n+    @Test\n+    public void shouldUseDefaultWhenUnknownBrowser() throws IOException {\n+        // Given\n+        HttpMessage msg = this.getHttpMessage(\"\");\n+        this.rule.getConfig().setProperty(\"rules.domxss.browserid\", \"invalid\");\n+        this.rule.init(msg, this.parent);\n+\n+        // When / Then\n+        assertThat(this.rule.getBrowser(), equalTo(Browser.FIREFOX_HEADLESS));\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"testBrowsers\")\n+    public void shouldUseCorrectBrowser(String browser) throws IOException {\n+        // Given\n+        HttpMessage msg = this.getHttpMessage(\"\");\n+        // this.rule.setDefaultBrowser(Browser.getBrowserWithId(browser));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjE1MDQ5OnYy", "diffSide": "RIGHT", "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NzoyMFrOHmmDUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1NzoyMFrOHmmDUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzMTM3OQ==", "bodyText": "Worth extracting a class.", "url": "https://github.com/zaproxy/zap-extensions/pull/2570#discussion_r510231379", "createdAt": "2020-10-22T14:57:20Z", "author": {"login": "thc202"}, "path": "addOns/domxss/src/test/java/org/zaproxy/zap/extension/domxss/DomXssScanRuleUnitTest.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Zed Attack Proxy (ZAP) and its related class files.\n+ *\n+ * ZAP is an HTTP/HTTPS proxy for assessing web application security.\n+ *\n+ * Copyright 2020 The ZAP Development Team\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.zaproxy.zap.extension.domxss;\n+\n+import static fi.iki.elonen.NanoHTTPD.newFixedLengthResponse;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+import fi.iki.elonen.NanoHTTPD.IHTTPSession;\n+import fi.iki.elonen.NanoHTTPD.Response;\n+import io.github.bonigarcia.wdm.WebDriverManager;\n+import java.io.IOException;\n+import java.util.stream.Stream;\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.parosproxy.paros.core.scanner.Alert;\n+import org.parosproxy.paros.network.HttpMessage;\n+import org.zaproxy.zap.extension.selenium.Browser;\n+import org.zaproxy.zap.extension.selenium.SeleniumOptions;\n+import org.zaproxy.zap.testutils.ActiveScannerTestUtils;\n+import org.zaproxy.zap.testutils.NanoServerHandler;\n+\n+public class DomXssScanRuleUnitTest extends ActiveScannerTestUtils<DomXssScanRule> {\n+\n+    @BeforeAll\n+    static void setup() {\n+        WebDriverManager.firefoxdriver().setup();\n+        System.setProperty(\n+                SeleniumOptions.FIREFOX_DRIVER_SYSTEM_PROPERTY,\n+                System.getProperty(\"webdriver.gecko.driver\"));\n+    }\n+\n+    static Stream<String> testBrowsers() {\n+        return Stream.of(\"firefox-headless\", \"chrome-headless\");\n+    }\n+\n+    @AfterAll\n+    static void tidyUp() {\n+        DomXssScanRule.tidyUp();\n+    }\n+\n+    @Override\n+    protected DomXssScanRule createScanner() {\n+        return new DomXssScanRule();\n+    }\n+\n+    @Override\n+    protected void setUpMessages() {\n+        mockMessages(new ExtensionDomXSS());\n+    }\n+\n+    @Test\n+    public void shouldUseDefaultWhenUnsupportedBrowser() throws IOException {\n+        // Given\n+        HttpMessage msg = this.getHttpMessage(\"\");\n+        this.rule.getConfig().setProperty(\"rules.domxss.browserid\", \"opera\");\n+        this.rule.init(msg, this.parent);\n+\n+        // When / Then\n+        assertThat(this.rule.getBrowser(), equalTo(Browser.FIREFOX_HEADLESS));\n+    }\n+\n+    @Test\n+    public void shouldUseDefaultWhenUnknownBrowser() throws IOException {\n+        // Given\n+        HttpMessage msg = this.getHttpMessage(\"\");\n+        this.rule.getConfig().setProperty(\"rules.domxss.browserid\", \"invalid\");\n+        this.rule.init(msg, this.parent);\n+\n+        // When / Then\n+        assertThat(this.rule.getBrowser(), equalTo(Browser.FIREFOX_HEADLESS));\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"testBrowsers\")\n+    public void shouldUseCorrectBrowser(String browser) throws IOException {\n+        // Given\n+        HttpMessage msg = this.getHttpMessage(\"\");\n+        // this.rule.setDefaultBrowser(Browser.getBrowserWithId(browser));\n+        this.rule.getConfig().setProperty(\"rules.domxss.browserid\", browser);\n+        this.rule.init(msg, this.parent);\n+\n+        // When / Then\n+        assertThat(this.rule.getBrowser(), equalTo(Browser.getBrowserWithId(browser)));\n+    }\n+\n+    /** Test based on http://public-firing-range.appspot.com/address/location.hash/assign */\n+    @ParameterizedTest\n+    @MethodSource(\"testBrowsers\")\n+    public void shouldReportXssInLocationHashAssign(String browser)\n+            throws NullPointerException, IOException {\n+        // Given\n+        String test = \"/shouldReportXssInLocationHashAssign/\";\n+\n+        this.nano.addHandler(\n+                new NanoServerHandler(test) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "677246beeab171f3c7bf74e3a15c8d3151136fda"}, "originalPosition": 117}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 680, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}