{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NjA0MjE1", "number": 2463, "title": "Avoid flagging missing SRI attribute when HTML asset is inline", "bodyText": "Resolves zaproxy/zaproxy#6047.", "createdAt": "2020-06-25T01:41:05Z", "url": "https://github.com/zaproxy/zap-extensions/pull/2463", "merged": true, "mergeCommit": {"oid": "6097336752a119decbfc9b9b30add85c7bf4cf3c"}, "closed": true, "closedAt": "2020-06-29T21:00:33Z", "author": {"login": "kishorbhat"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcukrpHgFqTQzNzExNTExMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwHhiigFqTQzOTQ5NjY5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTE1MTEy", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-437115112", "createdAt": "2020-06-25T01:42:35Z", "commit": {"oid": "52a31d2f39c9aadeb91a3e12f8e5d1a7d8c7eed9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMTo0MjozNVrOGoopGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMTo0MjozNVrOGoopGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI2MjEwNQ==", "bodyText": "Please move this up into the Unreleased block, you'll likely need to add a ### Fixed sub-heading as well.", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445262105", "createdAt": "2020-06-25T01:42:35Z", "author": {"login": "kingthorin"}, "path": "addOns/pscanrulesAlpha/CHANGELOG.md", "diffHunk": "@@ -22,6 +22,7 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n - Fixed NullPointerException in Sub Resource Integrity Attribute Missing scan rule (Issue 5789).\n - Minor spacing issue in help content.\n - Base64 Disclosure do not keep looping after identifying a disclosure (Issue 5856), unless the Threshold is set to Low.\n+- Fixed bug where Sub Resource Integrity Attribute Missing scan rule alerts even when HTML asset is inline (Issue 6047).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52a31d2f39c9aadeb91a3e12f8e5d1a7d8c7eed9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTE4OTI2", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-437118926", "createdAt": "2020-06-25T01:55:45Z", "commit": {"oid": "52a31d2f39c9aadeb91a3e12f8e5d1a7d8c7eed9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMTo1NTo0NVrOGoo1jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMTo1NTo0NVrOGoo1jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI2NTI5Mg==", "bodyText": "The build is failing because of a missing semi-colon here.\n> Task :addOns:pscanrulesAlpha:compileJava FAILED\n/home/travis/build/zaproxy/zap-extensions/addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java:139: error: ';' expected\n        }\n         ^\n1 error", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445265292", "createdAt": "2020-06-25T01:55:45Z", "author": {"login": "kingthorin"}, "path": "addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java", "diffHunk": "@@ -124,6 +125,20 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n         };\n     }\n \n+    private static Predicate<Element> htmlNotInline() {\n+        // 'else' branch won't ever execute since everything evaluated is a SCRIPT/LINK.\n+        // Leaving it in place for clarity.\n+        return element -> {\n+            if (element.getName() == HTMLElementName.SCRIPT) {\n+                return !element.getAttributeValue(\"src\").startsWith(\"data:\");\n+            } else if (element.getName() == HTMLElementName.LINK) {\n+                return !element.getAttributeValue(\"href\").startsWith(\"data:\");\n+            } else {\n+                return true;\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52a31d2f39c9aadeb91a3e12f8e5d1a7d8c7eed9"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTUxNjIy", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-437151622", "createdAt": "2020-06-25T03:59:56Z", "commit": {"oid": "4cc919f1e9fc42ed003321ba8fe043250007dacd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMzo1OTo1NlrOGoqj3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMzo1OTo1NlrOGoqj3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5MzUzNQ==", "bodyText": "The test fails on this line with a NullPointerException. Not sure why, since the test HTML message includes a \"src\" attribute inside the script. What am I missing?", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445293535", "createdAt": "2020-06-25T03:59:56Z", "author": {"login": "kishorbhat"}, "path": "addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java", "diffHunk": "@@ -124,6 +125,20 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n         };\n     }\n \n+    private static Predicate<Element> htmlNotInline() {\n+        // 'else' branch won't ever execute since everything evaluated is a SCRIPT/LINK.\n+        // Leaving it in place for clarity.\n+        return element -> {\n+            if (element.getName() == HTMLElementName.SCRIPT) {\n+                return !element.getAttributeValue(\"src\").startsWith(\"data:\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cc919f1e9fc42ed003321ba8fe043250007dacd"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MzgxNjYy", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-437381662", "createdAt": "2020-06-25T10:53:46Z", "commit": {"oid": "437e24f1496ee33349a329f959448824f08fb9b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDo1Mzo0NlrOGo1i1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDo1Mzo0NlrOGo1i1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3MzQ5NA==", "bodyText": "The Base64 value can be trimmed/removed, not meaningful for the test.", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445473494", "createdAt": "2020-06-25T10:53:46Z", "author": {"login": "thc202"}, "path": "addOns/pscanrulesAlpha/src/test/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScannerTest.java", "diffHunk": "@@ -208,6 +208,23 @@ public void shouldIgnoreInvalidFormattedHostname() throws HttpMalformedHeaderExc\n         assertThat(alertsRaised.size(), equalTo(1));\n     }\n \n+    @Test\n+    public void shouldNotRaiseAlertGivenHtmlAssetIsInline() throws HttpMalformedHeaderException {\n+        // Given\n+        HttpMessage msg =\n+                buildMessage(\n+                        \"<html><head>\"\n+                                + \"<script src=\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlPM0jRW/QAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=\\\"></script>\"\n+                                + \"<link href=\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlPM0jRW/QAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=\\\">\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "437e24f1496ee33349a329f959448824f08fb9b3"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NjAyODM1", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-437602835", "createdAt": "2020-06-25T15:20:55Z", "commit": {"oid": "0e5574e5f558e75f746270c4742434e55c0eff46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNToyMDo1NVrOGo_t2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNToyMDo1NVrOGo_t2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MDE1NQ==", "bodyText": "Can be merged to the above if.\ndata: would be more accurate.", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445640155", "createdAt": "2020-06-25T15:20:55Z", "author": {"login": "thc202"}, "path": "addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java", "diffHunk": "@@ -71,6 +71,8 @@ public static boolean contains(String tag) {\n                                     .attribute);\n             if (url == null) {\n                 return Optional.of(origin);\n+            } else if (url.startsWith(\"data\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e5574e5f558e75f746270c4742434e55c0eff46"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bacd81164eaa238dddc70dba5306a853cc4ac3f", "author": {"user": {"login": "kishorbhat", "name": "Kishor Bhat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/1bacd81164eaa238dddc70dba5306a853cc4ac3f", "committedDate": "2020-06-29T14:44:10Z", "message": "Avoid flagging missing SRI attribute when HTML asset is inline\n\nSigned-off-by: Kishor Bhat <kishorbhat@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDg1Mjgx", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-439485281", "createdAt": "2020-06-29T20:42:50Z", "commit": {"oid": "1bacd81164eaa238dddc70dba5306a853cc4ac3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDk2Njk4", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#pullrequestreview-439496698", "createdAt": "2020-06-29T21:00:25Z", "commit": {"oid": "1bacd81164eaa238dddc70dba5306a853cc4ac3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 381, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}