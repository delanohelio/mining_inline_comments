{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzMDM5MjU1", "number": 2666, "title": "Solved XSS false positive issue", "bodyText": "Fixes zaproxy/zaproxy#5958\nSigned-off-by: Aman Rawat rawataman6525@gmail.com", "createdAt": "2020-12-20T09:03:12Z", "url": "https://github.com/zaproxy/zap-extensions/pull/2666", "merged": true, "mergeCommit": {"oid": "38805d7be4d3ceefb8ae035b2f0a5eac9e7f5869"}, "closed": true, "closedAt": "2021-04-17T15:43:11Z", "author": {"login": "theamanrawat"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdn9sr7ABqjQxMzMxMzkyNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeOBlK7AFqTYzODIzNDcyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d42aefaccc56a8f96ac3e6fbff75879b83e6e07", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/1d42aefaccc56a8f96ac3e6fbff75879b83e6e07", "committedDate": "2020-12-20T08:52:08Z", "message": "Solved XSS false positive issue\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}, "afterCommit": {"oid": "e50dd58c307b04aa1022665a3f0f48b9e0ef805e", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/e50dd58c307b04aa1022665a3f0f48b9e0ef805e", "committedDate": "2020-12-20T09:12:34Z", "message": "Solved XSS false positive issue\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MzA1MzQ3", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-556305347", "createdAt": "2020-12-21T11:15:01Z", "commit": {"oid": "e50dd58c307b04aa1022665a3f0f48b9e0ef805e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e50dd58c307b04aa1022665a3f0f48b9e0ef805e", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/e50dd58c307b04aa1022665a3f0f48b9e0ef805e", "committedDate": "2020-12-20T09:12:34Z", "message": "Solved XSS false positive issue\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}, "afterCommit": {"oid": "5b43499114dc775ea9136294cda628f10bbab77f", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/5b43499114dc775ea9136294cda628f10bbab77f", "committedDate": "2021-03-15T12:46:27Z", "message": "Solved XSS false positive\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE4NDAyNzQ4", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-618402748", "createdAt": "2021-03-23T10:03:03Z", "commit": {"oid": "2dbe4afb8616c1c39e82ab9874aa18296d3c9904"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yM1QxMDowMzowM1rOI7qHMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yM1QxMDowMzowM1rOI7qHMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTQyNjg2NA==", "bodyText": "The size check is redundant here.\nThis will lead to more alerts being raised than before (assuming more than one context) and always with the details of the first context. Do you meant to add a break?", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#discussion_r599426864", "createdAt": "2021-03-23T10:03:03Z", "author": {"login": "thc202"}, "path": "addOns/ascanrules/src/main/java/org/zaproxy/zap/extension/ascanrules/CrossSiteScriptingScanRule.java", "diffHunk": "@@ -588,16 +588,18 @@ public void scan(HttpMessage msg, String param, String value) {\n                             if (contexts2 == null) {\n                                 return;\n                             }\n-                            if (contexts2.size() > 0) {\n-                                // Yep, its vulnerable\n-                                newAlert()\n-                                        .setConfidence(Alert.CONFIDENCE_MEDIUM)\n-                                        .setParam(param)\n-                                        .setAttack(contexts2.get(0).getTarget())\n-                                        .setEvidence(contexts2.get(0).getTarget())\n-                                        .setMessage(contexts2.get(0).getMsg())\n-                                        .raise();\n-                                attackWorked = true;\n+                            for (HtmlContext ctx : contexts2) {\n+                                if (contexts2.size() > 0 && ctx.getSurroundingQuote().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dbe4afb8616c1c39e82ab9874aa18296d3c9904"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM3OTQ0NTk0", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-637944594", "createdAt": "2021-04-16T17:32:44Z", "commit": {"oid": "6048e65e0863b0bf405d29628f34d4a818d29dcd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM3OTU0ODc5", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-637954879", "createdAt": "2021-04-16T17:47:05Z", "commit": {"oid": "6048e65e0863b0bf405d29628f34d4a818d29dcd"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNlQxNzo0NzowNlrOJKiFEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNlQxNzo0Nzo1NVrOJKiG5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTAyMzg4OQ==", "bodyText": "This could be removed, or moved to the end of the file.", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#discussion_r615023889", "createdAt": "2021-04-16T17:47:06Z", "author": {"login": "thc202"}, "path": "addOns/ascanrules/src/test/resources/org/zaproxy/zap/extension/ascanrules/crosssitescriptingscanrule/MultipleInput.html", "diffHunk": "@@ -0,0 +1,12 @@\n+<html>\n+<head>\n+<script>\n+@@@name@@@\n+</script>\n+<body>\n+</body>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6048e65e0863b0bf405d29628f34d4a818d29dcd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTAyNDAzOQ==", "bodyText": "Remove one empty line.", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#discussion_r615024039", "createdAt": "2021-04-16T17:47:24Z", "author": {"login": "thc202"}, "path": "addOns/ascanrules/CHANGELOG.md", "diffHunk": "@@ -7,6 +7,10 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n ### Changed\n - Now using 2.10 logging infrastructure (Log4j 2.x).\n \n+### Fixed\n+- Fix XSS false positive (Issue 5958).\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6048e65e0863b0bf405d29628f34d4a818d29dcd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTAyNDM1OQ==", "bodyText": "One \u2192 Once?\nContext \u2192 Contexts", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#discussion_r615024359", "createdAt": "2021-04-16T17:47:55Z", "author": {"login": "thc202"}, "path": "addOns/ascanrules/src/test/java/org/zaproxy/zap/extension/ascanrules/CrossSiteScriptingScanRuleUnitTest.java", "diffHunk": "@@ -1183,6 +1183,69 @@ protected Response serve(IHTTPSession session) {\n         assertThat(alertsRaised.get(0).getConfidence(), equalTo(Alert.CONFIDENCE_MEDIUM));\n     }\n \n+    @Test\n+    public void shouldNotAlertXssInJsVariableWithEncoding() throws HttpMalformedHeaderException {\n+        // Given\n+        String path = \"/user/search\";\n+        this.nano.addHandler(\n+                new NanoServerHandler(path) {\n+\n+                    @Override\n+                    protected Response serve(IHTTPSession session) {\n+                        String name = getFirstParamValue(session, \"name\");\n+                        String response;\n+                        if (name != null) {\n+                            name = name.replaceAll(\"\\\"\", \"&quot;\");\n+                            response =\n+                                    getHtml(\"InputInScript.html\", new String[][] {{\"name\", name}});\n+                        } else {\n+                            response = getHtml(\"NoInput.html\");\n+                        }\n+                        return newFixedLengthResponse(response);\n+                    }\n+                });\n+\n+        HttpMessage msg = this.getHttpMessage(path + \"?name=test\");\n+        this.rule.init(msg, this.parent);\n+\n+        // When\n+        this.rule.scan();\n+\n+        // Then\n+        assertThat(alertsRaised.size(), equalTo(0));\n+    }\n+\n+    @Test\n+    public void shouldAlertOneWithMultipleContext() throws HttpMalformedHeaderException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6048e65e0863b0bf405d29628f34d4a818d29dcd"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6048e65e0863b0bf405d29628f34d4a818d29dcd", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/6048e65e0863b0bf405d29628f34d4a818d29dcd", "committedDate": "2021-03-26T16:20:06Z", "message": "Solved XSS false positive\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}, "afterCommit": {"oid": "3d90da54db5deae29c96a89d1980cd8047529d42", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/3d90da54db5deae29c96a89d1980cd8047529d42", "committedDate": "2021-04-17T11:44:36Z", "message": "Solved XSS false positive\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM4MjIxMjIw", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-638221220", "createdAt": "2021-04-17T11:47:20Z", "commit": {"oid": "3d90da54db5deae29c96a89d1980cd8047529d42"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM4MjIzNjI4", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-638223628", "createdAt": "2021-04-17T12:25:27Z", "commit": {"oid": "3d90da54db5deae29c96a89d1980cd8047529d42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xN1QxMjoyNToyN1rOJKv1og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xN1QxMjoyNToyN1rOJKv1og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTI0OTMxNA==", "bodyText": "Since this is looping through a list shouldn\u2019t ctx be used instead of the zero\u2019th element?", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#discussion_r615249314", "createdAt": "2021-04-17T12:25:27Z", "author": {"login": "kingthorin"}, "path": "addOns/ascanrules/src/main/java/org/zaproxy/zap/extension/ascanrules/CrossSiteScriptingScanRule.java", "diffHunk": "@@ -588,16 +588,19 @@ public void scan(HttpMessage msg, String param, String value) {\n                             if (contexts2 == null) {\n                                 return;\n                             }\n-                            if (contexts2.size() > 0) {\n-                                // Yep, its vulnerable\n-                                newAlert()\n-                                        .setConfidence(Alert.CONFIDENCE_MEDIUM)\n-                                        .setParam(param)\n-                                        .setAttack(contexts2.get(0).getTarget())\n-                                        .setEvidence(contexts2.get(0).getTarget())\n-                                        .setMessage(contexts2.get(0).getMsg())\n-                                        .raise();\n-                                attackWorked = true;\n+                            for (HtmlContext ctx : contexts2) {\n+                                if (ctx.getSurroundingQuote().isEmpty()) {\n+                                    // Yep, its vulnerable\n+                                    newAlert()\n+                                            .setConfidence(Alert.CONFIDENCE_MEDIUM)\n+                                            .setParam(param)\n+                                            .setAttack(contexts2.get(0).getTarget())\n+                                            .setEvidence(contexts2.get(0).getTarget())\n+                                            .setMessage(contexts2.get(0).getMsg())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d90da54db5deae29c96a89d1980cd8047529d42"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ee576f07d8f0d1b092c815db45f4ef087566c8", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/e5ee576f07d8f0d1b092c815db45f4ef087566c8", "committedDate": "2021-04-17T15:11:44Z", "message": "Solved XSS false positive\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d90da54db5deae29c96a89d1980cd8047529d42", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/3d90da54db5deae29c96a89d1980cd8047529d42", "committedDate": "2021-04-17T11:44:36Z", "message": "Solved XSS false positive\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}, "afterCommit": {"oid": "e5ee576f07d8f0d1b092c815db45f4ef087566c8", "author": {"user": {"login": "theamanrawat", "name": "Aman Rawat"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/e5ee576f07d8f0d1b092c815db45f4ef087566c8", "committedDate": "2021-04-17T15:11:44Z", "message": "Solved XSS false positive\n\nSigned-off-by: Aman Rawat <rawataman6525@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM4MjM0NzI0", "url": "https://github.com/zaproxy/zap-extensions/pull/2666#pullrequestreview-638234724", "createdAt": "2021-04-17T15:13:50Z", "commit": {"oid": "e5ee576f07d8f0d1b092c815db45f4ef087566c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 270, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}