{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODU1NzAx", "number": 2454, "title": "testutils: Partially revert 2448 prevent setup and creation of the log", "bodyText": "Otherwise on some platforms (Win10) zap.log might seem to be in use.\n\nException prior to fix (Click the triangle/control to the left to expand)\nJun 18, 2020 10:35:32 PM org.junit.jupiter.engine.execution.JupiterEngineExecutionContext close\nSEVERE: Caught exception while closing extension context: org.junit.jupiter.engine.descriptor.ClassExtensionContext@546e61d5\njava.io.IOException: Failed to delete temp directory C:\\Users\\someuser\\AppData\\Local\\Temp\\junit1073536641428285888. The following paths could not be deleted (see suppressed exceptions for details): , home, home\\zap.log\n\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.createIOExceptionWithAttachedFailures(TempDirectory.java:249)\n\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.close(TempDirectory.java:182)\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n\tat org.junit.jupiter.engine.execution.ExtensionValuesStore.closeAllStoredCloseableValues(ExtensionValuesStore.java:61)\n\tat org.junit.jupiter.engine.descriptor.AbstractExtensionContext.close(AbstractExtensionContext.java:73)\n\tat org.junit.jupiter.engine.execution.JupiterEngineExecutionContext.close(JupiterEngineExecutionContext.java:53)\n\tat org.junit.jupiter.engine.descriptor.JupiterTestDescriptor.cleanUp(JupiterTestDescriptor.java:222)\n\tat org.junit.jupiter.engine.descriptor.JupiterTestDescriptor.cleanUp(JupiterTestDescriptor.java:57)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$cleanUp$9(NodeTestTask.java:151)\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.cleanUp(NodeTestTask.java:151)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:83)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1540)\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:38)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$5(NodeTestTask.java:139)\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$7(NodeTestTask.java:125)\n\tat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:135)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:123)\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:122)\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:80)\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:32)\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:51)\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:248)\n\tat org.junit.platform.launcher.core.DefaultLauncher.lambda$execute$5(DefaultLauncher.java:211)\n\tat org.junit.platform.launcher.core.DefaultLauncher.withInterceptedStreams(DefaultLauncher.java:226)\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:199)\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:141)\n\tat org.eclipse.jdt.internal.junit5.runner.JUnit5TestReference.run(JUnit5TestReference.java:98)\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:41)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:542)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:770)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:464)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:210)\n\tSuppressed: java.nio.file.DirectoryNotEmptyException: C:\\Users\\someuser\\AppData\\Local\\Temp\\junit1073536641428285888\n\t\tat java.base/sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:271)\n\t\tat java.base/sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:105)\n\t\tat java.base/java.nio.file.Files.delete(Files.java:1141)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.deleteAndContinue(TempDirectory.java:206)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.postVisitDirectory(TempDirectory.java:201)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.postVisitDirectory(TempDirectory.java:192)\n\t\tat java.base/java.nio.file.Files.walkFileTree(Files.java:2742)\n\t\tat java.base/java.nio.file.Files.walkFileTree(Files.java:2796)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.deleteAllFilesAndDirectories(TempDirectory.java:192)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.close(TempDirectory.java:180)\n\t\t... 34 more\n\tSuppressed: java.nio.file.DirectoryNotEmptyException: C:\\Users\\someuser\\AppData\\Local\\Temp\\junit1073536641428285888\\home\n\t\tat java.base/sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:271)\n\t\tat java.base/sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:105)\n\t\tat java.base/java.nio.file.Files.delete(Files.java:1141)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.deleteAndContinue(TempDirectory.java:206)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.postVisitDirectory(TempDirectory.java:201)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.postVisitDirectory(TempDirectory.java:192)\n\t\tat java.base/java.nio.file.Files.walkFileTree(Files.java:2742)\n\t\tat java.base/java.nio.file.Files.walkFileTree(Files.java:2796)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.deleteAllFilesAndDirectories(TempDirectory.java:192)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.close(TempDirectory.java:180)\n\t\t... 34 more\n\tSuppressed: java.nio.file.FileSystemException: C:\\Users\\someuser\\AppData\\Local\\Temp\\junit1073536641428285888\\home\\zap.log: The process cannot access the file because it is being used by another process.\n\n\t\tat java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:92)\n\t\tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103)\n\t\tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108)\n\t\tat java.base/sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:274)\n\t\tat java.base/sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:105)\n\t\tat java.base/java.nio.file.Files.delete(Files.java:1141)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.deleteAndContinue(TempDirectory.java:206)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.visitFile(TempDirectory.java:196)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.visitFile(TempDirectory.java:192)\n\t\tat java.base/java.nio.file.Files.walkFileTree(Files.java:2724)\n\t\tat java.base/java.nio.file.Files.walkFileTree(Files.java:2796)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.deleteAllFilesAndDirectories(TempDirectory.java:192)\n\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath.close(TempDirectory.java:180)\n\t\t... 34 more\n\t\tSuppressed: java.nio.file.FileSystemException: C:\\Users\\someuser\\AppData\\Local\\Temp\\junit1073536641428285888\\home\\zap.log: The process cannot access the file because it is being used by another process.\n\n\t\t\tat java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:92)\n\t\t\tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103)\n\t\t\tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108)\n\t\t\tat java.base/sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:274)\n\t\t\tat java.base/sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:105)\n\t\t\tat java.base/java.nio.file.Files.delete(Files.java:1141)\n\t\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.makeWritableAndTryToDeleteAgain(TempDirectory.java:223)\n\t\t\tat org.junit.jupiter.engine.extension.TempDirectory$CloseablePath$1.deleteAndContinue(TempDirectory.java:215)\n\t\t\t... 40 more\n\n\n\nAfter fix applied, unit tests complete as expected.\nI was working on some pscan CSP scan rule changes when this came up. I'm not sure if I missed this when we worked through the JUnit 5 changes or if it has something to do specifically with recent Windows updates. Looking elsewhere I'm guessing this is something I somehow missed, not something new (here's a similar issue for example dated back to Mar 2019).\nSigned-off-by: kingthorin kingthorin@users.noreply.github.com", "createdAt": "2020-06-19T02:40:36Z", "url": "https://github.com/zaproxy/zap-extensions/pull/2454", "merged": true, "mergeCommit": {"oid": "7564980e43fadd42592ca88f60041f29c9ee39a8"}, "closed": true, "closedAt": "2020-06-19T15:24:24Z", "author": {"login": "kingthorin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcszdmDABqjM0NjI1NzM3MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs0uONAFqTQzNDE2Mjc3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "123448f237bce7bfa937d1c7211ee006b4619987", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/123448f237bce7bfa937d1c7211ee006b4619987", "committedDate": "2020-06-19T02:38:26Z", "message": "testutils: Remove appenders before deleting the temporary dir\n\nOtherwise on some platforms (Win10) zap.log might seem to be in use.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "3ec03c7a58fa7ec54bf605f829646f21c918c783", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/3ec03c7a58fa7ec54bf605f829646f21c918c783", "committedDate": "2020-06-19T13:55:57Z", "message": "testutils: Partially revert 2448 prevent setup and creation of the log\n\nOtherwise on some platforms (Win10) zap.log might seem to be in use.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MDk4MTgz", "url": "https://github.com/zaproxy/zap-extensions/pull/2454#pullrequestreview-434098183", "createdAt": "2020-06-19T13:57:19Z", "commit": {"oid": "3ec03c7a58fa7ec54bf605f829646f21c918c783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo1NzoxOVrOGmVyGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo1NzoxOVrOGmVyGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1NTk2MA==", "bodyText": "Better as?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Path xmlDir = Files.createDirectory(tempDir.resolve(\"install/xml\"));\n          \n          \n            \n                    Path xmlDir = Files.createDirectory(tempDir.resolve(zapInstallDir + \"/xml\"));", "url": "https://github.com/zaproxy/zap-extensions/pull/2454#discussion_r442855960", "createdAt": "2020-06-19T13:57:19Z", "author": {"login": "kingthorin"}, "path": "testutils/src/main/java/org/zaproxy/zap/testutils/TestUtils.java", "diffHunk": "@@ -121,6 +121,8 @@\n     public static void beforeClass() throws Exception {\n         zapInstallDir =\n                 Files.createDirectory(tempDir.resolve(\"install\")).toAbsolutePath().toString();\n+        Path xmlDir = Files.createDirectory(tempDir.resolve(\"install/xml\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ec03c7a58fa7ec54bf605f829646f21c918c783"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a91f22c0aa015462923c8433df3dbbce62eeffbb", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/a91f22c0aa015462923c8433df3dbbce62eeffbb", "committedDate": "2020-06-19T14:10:21Z", "message": "testutils: Partially revert 2448 prevent setup and creation of the log\n\nOtherwise on some platforms (Win10) zap.log might seem to be in use.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ec03c7a58fa7ec54bf605f829646f21c918c783", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/3ec03c7a58fa7ec54bf605f829646f21c918c783", "committedDate": "2020-06-19T13:55:57Z", "message": "testutils: Partially revert 2448 prevent setup and creation of the log\n\nOtherwise on some platforms (Win10) zap.log might seem to be in use.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "a91f22c0aa015462923c8433df3dbbce62eeffbb", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zap-extensions/commit/a91f22c0aa015462923c8433df3dbbce62eeffbb", "committedDate": "2020-06-19T14:10:21Z", "message": "testutils: Partially revert 2448 prevent setup and creation of the log\n\nOtherwise on some platforms (Win10) zap.log might seem to be in use.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTA5OTEz", "url": "https://github.com/zaproxy/zap-extensions/pull/2454#pullrequestreview-434109913", "createdAt": "2020-06-19T14:13:12Z", "commit": {"oid": "a91f22c0aa015462923c8433df3dbbce62eeffbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTYyNzcx", "url": "https://github.com/zaproxy/zap-extensions/pull/2454#pullrequestreview-434162771", "createdAt": "2020-06-19T15:24:18Z", "commit": {"oid": "a91f22c0aa015462923c8433df3dbbce62eeffbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 374, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}