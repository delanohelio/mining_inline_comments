{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NjMzNDUz", "number": 578, "title": "Bump to IntelliJ 2020.3", "bodyText": "Commit 1\nSwitch host pants to a custom one with updated Zinc\nThe pants version we've been using was using an old Zinc version that did not support Scala 2.13.\nSince this commit, we build by ourselves pants with bumped Zinc version, so upgrade to 2.13 is\npossible.\nCommit 2\nBump to IntelliJ 2020.3\n\nScala Plugin 2020.3 is based on Scala 2.13, so we need to bump it, too\nisBspProject required reimplementation (same as in scala plugin)\nOpenProjectTask constructor signature has changed in 2020.3 (new argument)\nModule setOption/getOption methods are deprecated, so it was required to\nmodule.setOption(EXTERNAL_SYSTEM_ID_KEY, ...) manually. IJ Core not doing it\nany more\nallowRootAccess doesn't allow / argument any more\nTest Fixtures sometimes add MockSDKs so it was needed to clean it manually\n2.13 contains new collection converters - we needed to adapt", "createdAt": "2020-10-06T15:21:06Z", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578", "merged": true, "mergeCommit": {"oid": "dbdaa62755e9392ebb34ffc3b2e21096d60bc447"}, "closed": true, "closedAt": "2021-01-26T17:53:41Z", "author": {"login": "tpasternak"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdynalZgH2gAyNDk4NjMzNDUzOjdmOGJlODg5YjQxNWJiZGQzMzhhNzU4YjMxN2EyYzJkY2ZhZTE4ZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdz_TtNgFqTU3NjYwOTcxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7f8be889b415bbdd338a758b317a2c2dcfae18f0", "author": {"user": {"login": "tpasternak", "name": "Tomasz Pasternak"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/7f8be889b415bbdd338a758b317a2c2dcfae18f0", "committedDate": "2021-01-22T11:28:47Z", "message": "Switch host pants to a custom one with updated Zinc\n\nThe pants version we've been using was using an old Zinc version that did not support Scala 2.13.\nSince this commit, we build by ourselves pants with bumped Zinc version, so upgrade to 2.13 is\npossible."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd8f4216d932b7af919036696a89f18dcaf0d8d", "author": {"user": {"login": "tpasternak", "name": "Tomasz Pasternak"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/bbd8f4216d932b7af919036696a89f18dcaf0d8d", "committedDate": "2021-01-22T12:57:33Z", "message": "Bump to IntelliJ 2020.3\n\n* Scala Plugin 2020.3 is based on Scala 2.13, so we need to bump it, too\n* `isBspProject` required reimplementation (same as in scala plugin)\n* `OpenProjectTask` constructor signature has changed in 2020.3 (new argument)\n* Module setOption/getOption methods are deprecated, so it was required to\n  `module.setOption(EXTERNAL_SYSTEM_ID_KEY, ...)` manually. IJ Core not doing it\n  any more\n* `allowRootAccess` doesn't allow `/` argument any more\n* Test Fixtures sometimes add `MockSDK`s so it was needed to clean it manually\n* 2.13 contains new collection converters - we needed to adapt\n* Do not call `isPythonModule` which has been removed from IJ Core\n\n    Luckily, we have been using this method only to get facets from the modules, and it turns out that `isPythonModule` was returning `true` fore every module that contained at least one python facet.\n    https://github.com/JetBrains/intellij-community/commit/3d31f690f38ff0fab4435f48d0f2d70d64684b4a#diff-73e06f16dda15376df16c70a1a1c60d93da0cb09bbf000b3d6706d1655293134\n* Right scala plugin link and checksum checks\n* Clean cache\n* Use external-system-etst-api.jar built in CI instead of local machine"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0NTMwODgy", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-574530882", "createdAt": "2021-01-22T18:52:51Z", "commit": {"oid": "bbd8f4216d932b7af919036696a89f18dcaf0d8d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxODo1Mjo1MVrOIYxCAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxOToyNTo1M1rOIYyHfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjg0MDA2Nw==", "bodyText": "The command sha256sum is missing on Mac OS. You can use shasum -a 256, but that command, in turn, is missing on a typical Linux OS.", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r562840067", "createdAt": "2021-01-22T18:52:51Z", "author": {"login": "odisseus"}, "path": "scripts/setup-ci-environment.sh", "diffHunk": "@@ -37,6 +37,7 @@ if [ ! -d .cache/intellij/$FULL_IJ_BUILD_NUMBER/idea-dist ]; then\n   echo \"Loading $IJ_BUILD...\"\n   wget -q -O $IJ_TAR_NAME \"https://download.jetbrains.com/idea/$IJ_TAR_NAME\"\n   {\n+    echo \"$IJ_SHA $IJ_TAR_NAME\" | sha256sum -c - &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd8f4216d932b7af919036696a89f18dcaf0d8d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjg0MjAzNA==", "bodyText": "The command wget is missing in the standard Mac OS, though it may be installed by Homebrew or by other means.", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r562842034", "createdAt": "2021-01-22T18:56:29Z", "author": {"login": "odisseus"}, "path": "scripts/setup-ci-environment.sh", "diffHunk": "@@ -54,12 +55,16 @@ if [ ! -d .cache/intellij/$FULL_IJ_BUILD_NUMBER/plugins ]; then\n   pushd plugins\n \n   # wget -q --no-check-certificate -O Scala.zip \"https://plugins.jetbrains.com/pluginManager/?action=download&id=$SCALA_PLUGIN_ID&build=$FULL_IJ_BUILD_NUMBER\"\n-  wget -q --no-check-certificate -O Scala.zip \"https://plugins.jetbrains.com/plugin/download?pluginId=$SCALA_PLUGIN_ID&version=$SCALA_PLUGIN_VERSION&channel=$SCALA_PLUGIN_CHANNEL\"\n-  unzip -q Scala.zip\n+  if [ \"$SCALA_PLUGIN_CHANNEL\" == \"stable\" ]; then\n+      wget -q -O Scala.zip \"https://plugins.jetbrains.com/plugin/download?pluginId=$SCALA_PLUGIN_ID&version=$SCALA_PLUGIN_VERSION\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd8f4216d932b7af919036696a89f18dcaf0d8d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjg0NTA2Mg==", "bodyText": "I think the previous style is much more readable. It could be still better if all these variables had been final.\nIt's a shame that Java doesn't support named arguments.", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r562845062", "createdAt": "2021-01-22T19:01:45Z", "author": {"login": "odisseus"}, "path": "src/com/twitter/intellij/pants/service/project/PantsOpenProjectProvider.java", "diffHunk": "@@ -82,38 +82,27 @@ public Project openProject(@NotNull VirtualFile projectFile, @Nullable Project p\n   }\n \n   public static OpenProjectTask openTask(Project projectToClose, Project project, boolean forceOpenInNewFrame) {\n-    boolean useDefaultTemplate = false;\n-    boolean isNewProject = true;\n-    boolean sendFrameBack = false;\n-    boolean showWelcomeScreen = false;\n-    ProjectOpenedCallback callback = null;\n-    String projectWorkspaceId = null;\n-    FrameInfo frame = null;\n-    boolean runConfigurators = false;\n-    boolean runConversionsBeforeOpen = false;\n-    boolean isProjectCreatedWithWizard = false;\n-    boolean isRefreshVfsNeeded = false;\n     return new OpenProjectTask(\n       forceOpenInNewFrame,\n       projectToClose,\n-      isNewProject,\n-      useDefaultTemplate,\n+      true, // isNewProject", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd8f4216d932b7af919036696a89f18dcaf0d8d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjg1Nzg1NA==", "bodyText": "Why?", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r562857854", "createdAt": "2021-01-22T19:25:53Z", "author": {"login": "odisseus"}, "path": "testFramework/com/twitter/intellij/pants/testFramework/performance/PantsPerformanceBenchmark.scala", "diffHunk": "@@ -4,19 +4,19 @@\n package com.twitter.intellij.pants.testFramework.performance\n \n import java.io.File\n-import java.util.Collections\n \n import com.intellij.ProjectTopics\n import com.intellij.ide.plugins.PluginManagerCore\n import com.intellij.openapi.project.DumbService\n-import com.intellij.openapi.roots.{ModuleRootAdapter, ModuleRootEvent, ModuleRootListener}\n+import com.intellij.openapi.roots.{ModuleRootEvent, ModuleRootListener}\n import com.intellij.openapi.util.Ref\n import com.intellij.openapi.util.io.FileUtil\n import com.twitter.intellij.pants.model.PantsTargetAddress\n import com.twitter.intellij.pants.testFramework.PantsIntegrationTestCase\n import com.twitter.intellij.pants.util.PantsUtil\n \n-import scala.collection.JavaConversions.collectionAsScalaIterable\n+import scala.jdk.CollectionConverters._\n+// import scala.collection.convert.ImplicitConversions.`collection AsScalaIterable`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd8f4216d932b7af919036696a89f18dcaf0d8d"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28", "author": {"user": {"login": "tpasternak", "name": "Tomasz Pasternak"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/15874cc7e0653275a3fafca8b4243bb444621a28", "committedDate": "2021-01-25T10:58:35Z", "message": "Remove commented-out code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1MzQ1NDYw", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-575345460", "createdAt": "2021-01-25T12:25:03Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxMjoyNTowM1rOIZkjFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxMjoyNTowM1rOIZkjFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzY4NDExNw==", "bodyText": "Perhaps it is safer to define it as \"ProjectSystemId.findById(\"BSP\")\". I am not sure if the identity of project id is compared by the id value (string) or object reference. The actual object for project system id is created in scala plugin.", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r563684117", "createdAt": "2021-01-25T12:25:03Z", "author": {"login": "lukaszwawrzyk"}, "path": "common/com/twitter/intellij/pants/util/PantsConstants.java", "diffHunk": "@@ -15,6 +15,7 @@\n \n   @NotNull\n   public static final ProjectSystemId SYSTEM_ID = new ProjectSystemId(PANTS);\n+  public static final ProjectSystemId BSP_SYSTEM_ID = new ProjectSystemId(\"BSP\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1MzQ1ODY4", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-575345868", "createdAt": "2021-01-25T12:25:35Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxMjoyNTozNVrOIZkkVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxMjoyNTozNVrOIZkkVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzY4NDQzOQ==", "bodyText": "why was that wrong?", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r563684439", "createdAt": "2021-01-25T12:25:35Z", "author": {"login": "lukaszwawrzyk"}, "path": "common/com/twitter/intellij/pants/util/PantsUtil.java", "diffHunk": "@@ -673,9 +673,13 @@ else if (isBspProject(project)) {\n     }\n   }\n \n+  public static boolean isBspModule(Module module) {\n+    return ExternalSystemApiUtil.isExternalSystemAwareModule(PantsConstants.BSP_SYSTEM_ID, module);\n+  }\n+\n+\n   public static boolean isBspProject(Project project) {\n-    ProjectSystemId id = ProjectSystemId.findById(\"BSP\");\n-    return id != null && ExternalProjectUtil.isExternalProject(project, id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1MzkxNzc0", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-575391774", "createdAt": "2021-01-25T13:25:37Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2NTU0MTM0", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-576554134", "createdAt": "2021-01-26T16:52:34Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQxNjo1MjozNFrOIagq9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQxNjo1MjozNFrOIagq9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDY2OTE3NA==", "bodyText": "Why?", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r564669174", "createdAt": "2021-01-26T16:52:34Z", "author": {"login": "odisseus"}, "path": "scripts/deploy/deploy.py", "diffHunk": "@@ -69,7 +69,7 @@ def get_head_sha():\n   with open(os.devnull, 'w') as devnull:\n     try:\n       build_cmd = 'rm -rf dist;' \\\n-                  './pants binary scripts/sdk:intellij-pants-plugin-publish'\n+                  '.cache/pants-host/pants binary scripts/sdk:intellij-pants-plugin-publish'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2NTU2MDAx", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-576556001", "createdAt": "2021-01-26T16:54:29Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQxNjo1NDoyOVrOIagwdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQxNjo1NDoyOVrOIagwdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDY3MDU4MQ==", "bodyText": "Why is this cast required?", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#discussion_r564670581", "createdAt": "2021-01-26T16:54:29Z", "author": {"login": "odisseus"}, "path": "src/com/twitter/intellij/pants/service/project/FastpassOpenProjectProvider.java", "diffHunk": "@@ -97,7 +97,8 @@ private Project link(@NotNull VirtualFile projectFile) {\n         public void run(@NotNull ProgressIndicator indicator) {\n           BspProjectImportBuilder builder = new BspProjectImportBuilder();\n           try {\n-            Try<FastpassConfigSetup> fastpassConfigSetup = FastpassConfigSetup.create(new File(projectFile.getPath()));\n+            Try<FastpassConfigSetup> fastpassConfigSetup = FastpassConfigSetup.create(new File(projectFile.getPath()))\n+              .map(x -> (FastpassConfigSetup) x);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2NTczMTMz", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-576573133", "createdAt": "2021-01-26T17:12:07Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2NjA5NzE2", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/578#pullrequestreview-576609716", "createdAt": "2021-01-26T17:52:55Z", "commit": {"oid": "15874cc7e0653275a3fafca8b4243bb444621a28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1921, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}