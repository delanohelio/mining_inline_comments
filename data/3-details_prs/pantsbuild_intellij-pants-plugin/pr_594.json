{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1MTMyNzc0", "number": 594, "title": "Use the venv_builder tool to prepare a Python virtual environment", "bodyText": "", "createdAt": "2020-12-24T04:34:58Z", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594", "merged": true, "mergeCommit": {"oid": "cde93c011d87b050af51d3fb760ba073021e2de4"}, "closed": true, "closedAt": "2021-01-14T16:33:18Z", "author": {"login": "odisseus"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjy9fSAH2gAyNTQ1MTMyNzc0OjFjNDY3MWQzNWUyODk2ZDU0Y2ZiZGJiMTE4OTZjOTZlYjM4M2RlNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwGC10AFqTU2ODI5NjcwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c4671d35e2896d54cfbdbb11896c96eb383de76", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/1c4671d35e2896d54cfbdbb11896c96eb383de76", "committedDate": "2020-12-07T10:27:00Z", "message": "Use Python from .venv if present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01b5b8d5681ce4e9c4c500920c8e37664ed2075", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/b01b5b8d5681ce4e9c4c500920c8e37664ed2075", "committedDate": "2020-12-07T10:27:00Z", "message": "Set Python as the SDK for modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74614648c1d187f638f1b6fc217798fac33298a5", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/74614648c1d187f638f1b6fc217798fac33298a5", "committedDate": "2020-12-11T15:45:06Z", "message": "Detect and invoke the venv_builder tool when importing a Pants project with Python targets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e8c619e8a1cd6c5bb2d512417965e0119f3734b", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/2e8c619e8a1cd6c5bb2d512417965e0119f3734b", "committedDate": "2020-12-14T12:06:04Z", "message": "isMainTarget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d73f5535b1edc7e691be35b6ba72b62253ecc0d", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/6d73f5535b1edc7e691be35b6ba72b62253ecc0d", "committedDate": "2020-12-14T13:38:37Z", "message": "associateWithModulePath"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68bb97154d165c320d5b5582b908befed8f08b4f", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/68bb97154d165c320d5b5582b908befed8f08b4f", "committedDate": "2020-12-15T12:38:36Z", "message": "sdkName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74703e79728cf2ecc2413a2ffa2af13b93f294ad", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/74703e79728cf2ecc2413a2ffa2af13b93f294ad", "committedDate": "2020-12-15T14:20:33Z", "message": "project.getName()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d65a05d43e911eef4b48354efe0f35fc80cea717", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/d65a05d43e911eef4b48354efe0f35fc80cea717", "committedDate": "2020-12-15T15:03:56Z", "message": ".getExternalName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5495d5124ce01504e52614710d9af6df34c1ed5", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/b5495d5124ce01504e52614710d9af6df34c1ed5", "committedDate": "2020-12-18T13:36:37Z", "message": "projectData.getExternalName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eb94f8a98d68c61c54d79d9bb45ddc8afab3067", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/2eb94f8a98d68c61c54d79d9bb45ddc8afab3067", "committedDate": "2020-12-22T11:11:52Z", "message": "mainTargetName(List<String> selectedTargets)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed1019c304db708af8113246d2139f734663c051", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/ed1019c304db708af8113246d2139f734663c051", "committedDate": "2020-12-22T17:10:58Z", "message": "GeneralCommandLine buildAndRunVenvBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da8d3602c6fbd208c0357d50e89a4d63afb8c1b8", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/da8d3602c6fbd208c0357d50e89a4d63afb8c1b8", "committedDate": "2020-12-22T19:00:45Z", "message": "smol changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0479331f7e1bca1958ab90d2b0ac726e1b3eb9a6", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/0479331f7e1bca1958ab90d2b0ac726e1b3eb9a6", "committedDate": "2020-12-23T15:59:07Z", "message": "PythonVenvBuilder.processAdapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c144d7bdb4094f2689dd2962c0341532c232cea0", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/c144d7bdb4094f2689dd2962c0341532c232cea0", "committedDate": "2020-12-23T22:47:43Z", "message": "PythonVenvBuilder.forProjectPath"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2197d3f19fbfccb442fd50c46c2e3378aeda982b", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/2197d3f19fbfccb442fd50c46c2e3378aeda982b", "committedDate": "2020-12-26T06:47:55Z", "message": "Removed PythonVenvFinder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MTY1MDc2", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#pullrequestreview-559165076", "createdAt": "2020-12-28T14:23:23Z", "commit": {"oid": "d0a99a5816893c209544802b50c9f5cbd146ba6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoyMzoyM1rOIL6lzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoyMzoyM1rOIL6lzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM2NTE5Nw==", "bodyText": "+1", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#discussion_r549365197", "createdAt": "2020-12-28T14:23:23Z", "author": {"login": "tpasternak"}, "path": "src/com/twitter/intellij/pants/service/project/PantsResolver.java", "diffHunk": "@@ -93,6 +100,30 @@ public void resolve(\n     }\n   }\n \n+  public void resolvePythonEnvironment(\n+    ProjectData projectData,\n+    List<String> selectedTargets,\n+    ProcessAdapter processAdapter\n+  ) {\n+    PythonSetup pythonSetup = myProjectInfo.getPythonSetup();\n+    boolean needsPython = myProjectInfo.getTargets().values().stream().anyMatch(t -> t.isPythonTarget());\n+    if (needsPython && pythonSetup != null) {\n+      PythonVenvBuilder.forProjectPath(myExecutor.getBuildRoot().toString(), processAdapter).ifPresent(builder -> {\n+        String target = mainTargetName(selectedTargets);\n+        Path venvDir = Paths.get(projectData.getIdeProjectFileDirectoryPath(), \"venv\");\n+        PythonInterpreterInfo python = builder.build(target, venvDir);\n+        String environmentName = \"Python virtual environment from venv_builder\";\n+        pythonSetup.getInterpreters().put(environmentName, python);\n+        pythonSetup.setDefaultInterpreter(environmentName);\n+      });\n+    }\n+  }\n+\n+  private String mainTargetName(List<String> selectedTargets){\n+    //FIXME can there be more than one target?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a99a5816893c209544802b50c9f5cbd146ba6d"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0a99a5816893c209544802b50c9f5cbd146ba6d", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/d0a99a5816893c209544802b50c9f5cbd146ba6d", "committedDate": "2020-12-24T04:31:04Z", "message": "Removed PythonVenvFinder"}, "afterCommit": {"oid": "1c3b5da3a8e55544f664463b8dc9804b3b6da759", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/1c3b5da3a8e55544f664463b8dc9804b3b6da759", "committedDate": "2020-12-29T00:25:36Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c3b5da3a8e55544f664463b8dc9804b3b6da759", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/1c3b5da3a8e55544f664463b8dc9804b3b6da759", "committedDate": "2020-12-29T00:25:36Z", "message": "PantsUtil.listMatchingTargets"}, "afterCommit": {"oid": "0b5758c76ceea3c54cd71160e86a58f963cf15f6", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/0b5758c76ceea3c54cd71160e86a58f963cf15f6", "committedDate": "2020-12-29T22:49:39Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b5758c76ceea3c54cd71160e86a58f963cf15f6", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/0b5758c76ceea3c54cd71160e86a58f963cf15f6", "committedDate": "2020-12-29T22:49:39Z", "message": "PantsUtil.listMatchingTargets"}, "afterCommit": {"oid": "1a0468f0eab2b501b5b9553309c784dd9290c686", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/1a0468f0eab2b501b5b9553309c784dd9290c686", "committedDate": "2020-12-29T23:03:10Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a0468f0eab2b501b5b9553309c784dd9290c686", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/1a0468f0eab2b501b5b9553309c784dd9290c686", "committedDate": "2020-12-29T23:03:10Z", "message": "PantsUtil.listMatchingTargets"}, "afterCommit": {"oid": "b95ae6133613dc513a8e6c8b1b4f8d4c57930787", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/b95ae6133613dc513a8e6c8b1b4f8d4c57930787", "committedDate": "2020-12-30T02:16:11Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b95ae6133613dc513a8e6c8b1b4f8d4c57930787", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/b95ae6133613dc513a8e6c8b1b4f8d4c57930787", "committedDate": "2020-12-30T02:16:11Z", "message": "PantsUtil.listMatchingTargets"}, "afterCommit": {"oid": "034c5c235f6b199ed5c2c072d4a4ea9235baf078", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/034c5c235f6b199ed5c2c072d4a4ea9235baf078", "committedDate": "2020-12-30T05:41:04Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "034c5c235f6b199ed5c2c072d4a4ea9235baf078", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/034c5c235f6b199ed5c2c072d4a4ea9235baf078", "committedDate": "2020-12-30T05:41:04Z", "message": "PantsUtil.listMatchingTargets"}, "afterCommit": {"oid": "75cbc803a578b110a15b51be7d5be34d71553924", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/75cbc803a578b110a15b51be7d5be34d71553924", "committedDate": "2020-12-30T06:25:35Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/0fdf5dd13218ffb9478ebea37ef936f468d59a64", "committedDate": "2020-12-30T13:29:49Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75cbc803a578b110a15b51be7d5be34d71553924", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/75cbc803a578b110a15b51be7d5be34d71553924", "committedDate": "2020-12-30T06:25:35Z", "message": "PantsUtil.listMatchingTargets"}, "afterCommit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64", "author": {"user": {"login": "odisseus", "name": "Myroslav"}}, "url": "https://github.com/pantsbuild/intellij-pants-plugin/commit/0fdf5dd13218ffb9478ebea37ef936f468d59a64", "committedDate": "2020-12-30T13:29:49Z", "message": "PantsUtil.listMatchingTargets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MjI4OTM4", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#pullrequestreview-565228938", "createdAt": "2021-01-11T10:32:20Z", "commit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MTc2MzY0", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#pullrequestreview-568176364", "createdAt": "2021-01-14T12:13:03Z", "commit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMjoxMzowM1rOITiCVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMjoxMzowM1rOITiCVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM1MTUxMA==", "bodyText": "I think we could use com.twitter.intellij.pants.bsp.PantsTargetAddress class here instead of String for selector\n(and it could be moved from bsp package)", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#discussion_r557351510", "createdAt": "2021-01-14T12:13:03Z", "author": {"login": "tpasternak"}, "path": "common/com/twitter/intellij/pants/util/PantsUtil.java", "diffHunk": "@@ -421,6 +422,54 @@ public static GeneralCommandLine defaultCommandLine(@NotNull File pantsExecutabl\n     }\n   }\n \n+  public static Collection<String> listMatchingTargets(@NotNull String projectPath, String selector) throws PantsException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MTc3NTMw", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#pullrequestreview-568177530", "createdAt": "2021-01-14T12:14:50Z", "commit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMjoxNDo1MFrOITiFsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMjoxNDo1MFrOITiFsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM1MjM2OQ==", "bodyText": "Shouldn't the target name be configurable?", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#discussion_r557352369", "createdAt": "2021-01-14T12:14:50Z", "author": {"login": "tpasternak"}, "path": "src/com/twitter/intellij/pants/service/project/PythonVenvBuilder.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Pants project contributors (see CONTRIBUTORS.md).\n+// Licensed under the Apache License, Version 2.0 (see LICENSE).\n+\n+package com.twitter.intellij.pants.service.project;\n+\n+import com.intellij.execution.ExecutionException;\n+import com.intellij.execution.configurations.GeneralCommandLine;\n+import com.intellij.execution.process.ProcessAdapter;\n+import com.intellij.execution.process.ProcessOutput;\n+import com.intellij.openapi.diagnostic.Logger;\n+import com.twitter.intellij.pants.service.project.model.PythonInterpreterInfo;\n+import com.twitter.intellij.pants.util.PantsUtil;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.nio.file.Path;\n+import java.util.Collection;\n+import java.util.Optional;\n+\n+public class PythonVenvBuilder {\n+\n+  protected static final Logger LOG = Logger.getInstance(PythonVenvBuilder.class);\n+\n+  private final String projectPath;\n+  private final ProcessAdapter processAdapter;\n+\n+  private PythonVenvBuilder(String projectPath, ProcessAdapter processAdapter) {\n+    this.projectPath = projectPath;\n+    this.processAdapter = processAdapter;\n+  }\n+\n+  public static Optional<PythonVenvBuilder> forProjectPath(String projectPath, ProcessAdapter processAdapter){\n+    Collection<String> allTargets = PantsUtil.listMatchingTargets(projectPath, \"entsec/venv_builder:venv_builder\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4Mjk2NzA1", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#pullrequestreview-568296705", "createdAt": "2021-01-14T14:41:17Z", "commit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDo0MToxN1rOITnpZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDo0MToxN1rOITnpZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQ0MzQzMQ==", "bodyText": "Again, this should be configurable", "url": "https://github.com/pantsbuild/intellij-pants-plugin/pull/594#discussion_r557443431", "createdAt": "2021-01-14T14:41:17Z", "author": {"login": "tpasternak"}, "path": "src/com/twitter/intellij/pants/service/project/PythonVenvBuilder.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Pants project contributors (see CONTRIBUTORS.md).\n+// Licensed under the Apache License, Version 2.0 (see LICENSE).\n+\n+package com.twitter.intellij.pants.service.project;\n+\n+import com.intellij.execution.ExecutionException;\n+import com.intellij.execution.configurations.GeneralCommandLine;\n+import com.intellij.execution.process.ProcessAdapter;\n+import com.intellij.execution.process.ProcessOutput;\n+import com.intellij.openapi.diagnostic.Logger;\n+import com.twitter.intellij.pants.service.project.model.PythonInterpreterInfo;\n+import com.twitter.intellij.pants.util.PantsUtil;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.nio.file.Path;\n+import java.util.Collection;\n+import java.util.Optional;\n+\n+public class PythonVenvBuilder {\n+\n+  protected static final Logger LOG = Logger.getInstance(PythonVenvBuilder.class);\n+\n+  private final String projectPath;\n+  private final ProcessAdapter processAdapter;\n+\n+  private PythonVenvBuilder(String projectPath, ProcessAdapter processAdapter) {\n+    this.projectPath = projectPath;\n+    this.processAdapter = processAdapter;\n+  }\n+\n+  public static Optional<PythonVenvBuilder> forProjectPath(String projectPath, ProcessAdapter processAdapter){\n+    Collection<String> allTargets = PantsUtil.listMatchingTargets(projectPath, \"entsec/venv_builder:venv_builder\");\n+    if(!allTargets.isEmpty())\n+      return Optional.of(new PythonVenvBuilder(projectPath, processAdapter));\n+    else\n+      return Optional.empty();\n+  }\n+\n+  public PythonInterpreterInfo build(String target, Path venvDir) {\n+    LOG.info(String.format(\"Invoking the .venv builder with target %s at %s\", target, venvDir));\n+    try {\n+      GeneralCommandLine command = buildAndRunVenvBuilder(target, venvDir);\n+      final ProcessOutput processOutput = getProcessOutput(command);\n+      if(processOutput.checkSuccess(LOG)) {\n+        PythonInterpreterInfo result = new PythonInterpreterInfo();\n+        result.setBinary(venvDir.resolve(\"bin/python\").toString());\n+        result.setChroot(venvDir.toString());\n+        return result;\n+      }\n+      else {\n+        throw new RuntimeException(String.format(\"Failed to create a Python virtual environment in %s\", venvDir));\n+      }\n+    } catch(ExecutionException ee) {\n+      throw new RuntimeException(\"An error occurred while running the .venv builder\", ee);\n+    }\n+  }\n+\n+  private GeneralCommandLine buildAndRunVenvBuilder(String target, Path venvDir) {\n+    //TODO Use PantsTaskManager.executeTasks?\n+    final GeneralCommandLine commandLine = PantsUtil.defaultCommandLine(projectPath)\n+      .withEnvironment(\"PANTS_CONCURRENT\", \"true\");\n+    commandLine.addParameters(\"run\", \"entsec/venv_builder:venv_builder\", \"--\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fdf5dd13218ffb9478ebea37ef936f468d59a64"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1936, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}