{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTEzMDQw", "number": 790, "title": "Add path parameter sanitization", "bodyText": "Added path parameter sanitization. So all IDs or other path parameters that should be numeric are checked to be numeric. If they are not, the SDK throws an error. In addition, all IDs that should be alphanumeric are checked to be alphanumeric. If they are not, the SDK throws an error.", "createdAt": "2020-04-08T22:31:41Z", "url": "https://github.com/box/box-java-sdk/pull/790", "merged": true, "mergeCommit": {"oid": "1e3abcb1dacd0db7eaeabca90f6d4571e2447283"}, "closed": true, "closedAt": "2020-04-09T16:54:25Z", "author": {"login": "sujaygarlanka"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVvobHgH2gAyNDAxMTEzMDQwOmEwNTMwNTkxN2U5MzJjNDNmOTZkYTc4MTZhMjQ1M2UwYjkzOWJjNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV-l_TAFqTM5MDkyMDgzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a05305917e932c43f96da7816a2453e0b939bc42", "author": {"user": {"login": "sujaygarlanka", "name": "Sujay Garlanka"}}, "url": "https://github.com/box/box-java-sdk/commit/a05305917e932c43f96da7816a2453e0b939bc42", "committedDate": "2020-04-08T22:28:11Z", "message": "added sanitization and some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6", "author": {"user": {"login": "sujaygarlanka", "name": "Sujay Garlanka"}}, "url": "https://github.com/box/box-java-sdk/commit/9059b52e2c1d742be87c5ccb8db6f92b281feda6", "committedDate": "2020-04-08T22:32:35Z", "message": "Update CHANGELOG.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDk0NjY1", "url": "https://github.com/box/box-java-sdk/pull/790#pullrequestreview-390494665", "createdAt": "2020-04-09T05:11:09Z", "commit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNToxMTowOVrOGDJz2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNToyMjozMFrOGDJ-5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk1OTY0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assert false : \"An invalid URL template indicates a bug in the SDK.\";\n          \n          \n            \n                        assert false : \"A valid URL could not be constructed from the provided parameters.\";", "url": "https://github.com/box/box-java-sdk/pull/790#discussion_r405959643", "createdAt": "2020-04-09T05:11:09Z", "author": {"login": "PJSimon"}, "path": "src/main/java/com/box/sdk/URLTemplate.java", "diffHunk": "@@ -18,12 +21,45 @@ public URLTemplate(String template) {\n     }\n \n     /**\n-     * Build a URL with URL Parameters.\n+     * Build a URL with numeric URL Parameters.\n      * @param base base URL\n      * @param values URL parameters\n      * @return URL\n      */\n     public URL build(String base, Object... values) {\n+        for (Object value: values) {\n+            String valueString = String.valueOf(value);\n+            Boolean test = NUMERIC.matcher(valueString).matches();\n+            if (!NUMERIC.matcher(valueString).matches()) {\n+                assert false : \"An invalid path parameter passed in. It must be numeric.\";\n+            }\n+        }\n+        String urlString = String.format(base + this.template, values);\n+\n+        URL url = null;\n+        try {\n+            url = new URL(urlString);\n+        } catch (MalformedURLException e) {\n+            assert false : \"An invalid URL template indicates a bug in the SDK.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk1OTY5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assert false : \"An invalid URL template indicates a bug in the SDK.\";\n          \n          \n            \n                        assert false : \"A valid URL could not be constructed from the provided parameters.\";", "url": "https://github.com/box/box-java-sdk/pull/790#discussion_r405959691", "createdAt": "2020-04-09T05:11:23Z", "author": {"login": "PJSimon"}, "path": "src/main/java/com/box/sdk/URLTemplate.java", "diffHunk": "@@ -37,13 +73,44 @@ public URL build(String base, Object... values) {\n     }\n \n     /**\n-     * Build a URL with Query String and URL Parameters.\n+     * Build a URL with Query String and numeric URL Parameters.\n      * @param base base URL\n      * @param queryString query string\n      * @param values URL Parameters\n      * @return URL\n      */\n     public URL buildWithQuery(String base, String queryString, Object... values) {\n+        for (Object value: values) {\n+            String valueString = String.valueOf(value);\n+            if (!NUMERIC.matcher(valueString).matches()) {\n+                assert false : \"An invalid path param passed in. It must be numeric.\";\n+            }\n+        }\n+        String urlString = String.format(base + this.template, values) + queryString;\n+        URL url = null;\n+        try {\n+            url = new URL(urlString);\n+        } catch (MalformedURLException e) {\n+            assert false : \"An invalid URL template indicates a bug in the SDK.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk2MDE4NA==", "bodyText": "I don't think this is true, now that we have the new sanitization logic.  If there's a malformed URL, it's due to the parameters' values, right?", "url": "https://github.com/box/box-java-sdk/pull/790#discussion_r405960184", "createdAt": "2020-04-09T05:13:18Z", "author": {"login": "PJSimon"}, "path": "src/main/java/com/box/sdk/URLTemplate.java", "diffHunk": "@@ -18,12 +21,45 @@ public URLTemplate(String template) {\n     }\n \n     /**\n-     * Build a URL with URL Parameters.\n+     * Build a URL with numeric URL Parameters.\n      * @param base base URL\n      * @param values URL parameters\n      * @return URL\n      */\n     public URL build(String base, Object... values) {\n+        for (Object value: values) {\n+            String valueString = String.valueOf(value);\n+            Boolean test = NUMERIC.matcher(valueString).matches();\n+            if (!NUMERIC.matcher(valueString).matches()) {\n+                assert false : \"An invalid path parameter passed in. It must be numeric.\";\n+            }\n+        }\n+        String urlString = String.format(base + this.template, values);\n+\n+        URL url = null;\n+        try {\n+            url = new URL(urlString);\n+        } catch (MalformedURLException e) {\n+            assert false : \"An invalid URL template indicates a bug in the SDK.\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk1OTY0Mw=="}, "originalCommit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk2MDMyMg==", "bodyText": "Also fix the other three instances of this verbiage in this class.", "url": "https://github.com/box/box-java-sdk/pull/790#discussion_r405960322", "createdAt": "2020-04-09T05:13:45Z", "author": {"login": "PJSimon"}, "path": "src/main/java/com/box/sdk/URLTemplate.java", "diffHunk": "@@ -18,12 +21,45 @@ public URLTemplate(String template) {\n     }\n \n     /**\n-     * Build a URL with URL Parameters.\n+     * Build a URL with numeric URL Parameters.\n      * @param base base URL\n      * @param values URL parameters\n      * @return URL\n      */\n     public URL build(String base, Object... values) {\n+        for (Object value: values) {\n+            String valueString = String.valueOf(value);\n+            Boolean test = NUMERIC.matcher(valueString).matches();\n+            if (!NUMERIC.matcher(valueString).matches()) {\n+                assert false : \"An invalid path parameter passed in. It must be numeric.\";\n+            }\n+        }\n+        String urlString = String.format(base + this.template, values);\n+\n+        URL url = null;\n+        try {\n+            url = new URL(urlString);\n+        } catch (MalformedURLException e) {\n+            assert false : \"An invalid URL template indicates a bug in the SDK.\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk1OTY0Mw=="}, "originalCommit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk2MjQ3MQ==", "bodyText": "If this.getID() returns, say, \"12345abc\", then this call would NOT return \"An invalid path parameter passed in. It must be numeric.\" error message, even though that would be an invalid ID.\nI can't think of any alternatives, but just calling out to start the discussion.\nThe API would handle the error in that case, so it's probably a minor concern, right?", "url": "https://github.com/box/box-java-sdk/pull/790#discussion_r405962471", "createdAt": "2020-04-09T05:22:30Z", "author": {"login": "PJSimon"}, "path": "src/main/java/com/box/sdk/BoxFile.java", "diffHunk": "@@ -1051,7 +1051,7 @@ public Metadata createMetadata(String typeName, Metadata metadata) {\n      * @return the metadata returned from the server.\n      */\n     public Metadata createMetadata(String typeName, String scope, Metadata metadata) {\n-        URL url = METADATA_URL_TEMPLATE.build(this.getAPI().getBaseURL(), this.getID(), scope, typeName);\n+        URL url = METADATA_URL_TEMPLATE.buildAlpha(this.getAPI().getBaseURL(), this.getID(), scope, typeName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9059b52e2c1d742be87c5ccb8db6f92b281feda6"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1765a6acba96b0c1dd50598786cb5933892bc6d3", "author": {"user": {"login": "sujaygarlanka", "name": "Sujay Garlanka"}}, "url": "https://github.com/box/box-java-sdk/commit/1765a6acba96b0c1dd50598786cb5933892bc6d3", "committedDate": "2020-04-09T14:36:21Z", "message": "Update src/main/java/com/box/sdk/URLTemplate.java\n\nCo-Authored-By: Patrick Simon <patrick@box.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eabcd5d81a76c86f6b00213f63e769e997eced84", "author": {"user": {"login": "sujaygarlanka", "name": "Sujay Garlanka"}}, "url": "https://github.com/box/box-java-sdk/commit/eabcd5d81a76c86f6b00213f63e769e997eced84", "committedDate": "2020-04-09T14:42:13Z", "message": "Update src/main/java/com/box/sdk/URLTemplate.java\n\nCo-Authored-By: Patrick Simon <patrick@box.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db481a1b47740116f5cfdbfbb82c24e183c047fd", "author": {"user": {"login": "sujaygarlanka", "name": "Sujay Garlanka"}}, "url": "https://github.com/box/box-java-sdk/commit/db481a1b47740116f5cfdbfbb82c24e183c047fd", "committedDate": "2020-04-09T14:46:47Z", "message": "Update URLTemplate.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTIwODM3", "url": "https://github.com/box/box-java-sdk/pull/790#pullrequestreview-390920837", "createdAt": "2020-04-09T15:54:06Z", "commit": {"oid": "db481a1b47740116f5cfdbfbb82c24e183c047fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2947, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}