{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MDIyMjEy", "number": 7427, "title": "Fixed Configs not correcting when hot-loaded from changes on disk", "bodyText": "Closes #7367", "createdAt": "2020-10-22T05:25:36Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427", "merged": true, "mergeCommit": {"oid": "d2cfda3fb47d2006adbbe8ee3289f7218ba77f1e"}, "closed": true, "closedAt": "2021-02-16T00:40:00Z", "author": {"login": "DaemonUmbra"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdU7GYCgBqjM5MDcxMjAwNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdaChAuAH2gAyNTA4MDIyMjEyOmMxOTc0NmY4NTA4YjA2NDhjNGNiYjU4ODE1OGNiNTE4ZGQ0MzdmOTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "571c034d2a9fc04c90edd39117b723ab955823d0", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/571c034d2a9fc04c90edd39117b723ab955823d0", "committedDate": "2020-10-22T05:25:04Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}, "afterCommit": {"oid": "0c2fdca9772b2c8e9560f2c60c41bdd1b06a4c75", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/0c2fdca9772b2c8e9560f2c60c41bdd1b06a4c75", "committedDate": "2020-10-22T05:26:54Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c2fdca9772b2c8e9560f2c60c41bdd1b06a4c75", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/0c2fdca9772b2c8e9560f2c60c41bdd1b06a4c75", "committedDate": "2020-10-22T05:26:54Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}, "afterCommit": {"oid": "7a93b73026002b4c440fa29a1310ea10512d8548", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7a93b73026002b4c440fa29a1310ea10512d8548", "committedDate": "2020-10-22T05:30:24Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a93b73026002b4c440fa29a1310ea10512d8548", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7a93b73026002b4c440fa29a1310ea10512d8548", "committedDate": "2020-10-22T05:30:24Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}, "afterCommit": {"oid": "ef398626450e11a6255e62d0a6963901255cf990", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ef398626450e11a6255e62d0a6963901255cf990", "committedDate": "2020-10-22T05:31:24Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eca5092dd8146ef0d47633b76906c00eb721fa0b", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/eca5092dd8146ef0d47633b76906c00eb721fa0b", "committedDate": "2020-10-22T23:40:35Z", "message": "Log messages when backups fail"}, "afterCommit": {"oid": "e8a2a31cdaf428e5d528881e2d504a5f323ad4aa", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/e8a2a31cdaf428e5d528881e2d504a5f323ad4aa", "committedDate": "2020-11-01T22:19:27Z", "message": "Log messages when backups fail"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNjgxODU2", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#pullrequestreview-521681856", "createdAt": "2020-11-02T14:33:49Z", "commit": {"oid": "68e010520afb1c1f8d51dee587901faaeb54026f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDozMzo0OVrOHsG4Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDozNzozNlrOHsHCTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAxMjEwNg==", "bodyText": "Braces on newlines, please.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#discussion_r516012106", "createdAt": "2020-11-02T14:33:49Z", "author": {"login": "sciwhiz12"}, "path": "src/main/java/net/minecraftforge/fml/config/ConfigFileTypeHandler.java", "diffHunk": "@@ -91,6 +93,35 @@ private boolean setupConfigFile(final ModConfig modConfig, final Path file, fina\n         return true;\n     }\n \n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig) {\n+        int maxBackups = 5;\n+        File bakFileLocation = commentedFileConfig.getFile().getParentFile();\n+        String bakFileName = FilenameUtils.removeExtension(commentedFileConfig.getFile().getName());\n+        String bakFileExtension = FilenameUtils.getExtension(commentedFileConfig.getFile().getName()) + \".bak\";\n+        File bakFile = new File(bakFileLocation, bakFileName + \"-1\" + \".\" + bakFileExtension);\n+        try\n+        {\n+            for(int i = maxBackups; i > 0; i--){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68e010520afb1c1f8d51dee587901faaeb54026f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAxMjE5Ng==", "bodyText": "Braces on newlines, please.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#discussion_r516012196", "createdAt": "2020-11-02T14:33:58Z", "author": {"login": "sciwhiz12"}, "path": "src/main/java/net/minecraftforge/fml/config/ConfigFileTypeHandler.java", "diffHunk": "@@ -91,6 +93,35 @@ private boolean setupConfigFile(final ModConfig modConfig, final Path file, fina\n         return true;\n     }\n \n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig) {\n+        int maxBackups = 5;\n+        File bakFileLocation = commentedFileConfig.getFile().getParentFile();\n+        String bakFileName = FilenameUtils.removeExtension(commentedFileConfig.getFile().getName());\n+        String bakFileExtension = FilenameUtils.getExtension(commentedFileConfig.getFile().getName()) + \".bak\";\n+        File bakFile = new File(bakFileLocation, bakFileName + \"-1\" + \".\" + bakFileExtension);\n+        try\n+        {\n+            for(int i = maxBackups; i > 0; i--){\n+                File oldBak = new File(bakFileLocation, bakFileName + \"-\" + i + \".\" + bakFileExtension);\n+                if(oldBak.exists()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68e010520afb1c1f8d51dee587901faaeb54026f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAxNDY2OA==", "bodyText": "Just asking, wouldn't this be better as a static constant, instead of a local constant?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#discussion_r516014668", "createdAt": "2020-11-02T14:37:36Z", "author": {"login": "sciwhiz12"}, "path": "src/main/java/net/minecraftforge/fml/config/ConfigFileTypeHandler.java", "diffHunk": "@@ -91,6 +93,35 @@ private boolean setupConfigFile(final ModConfig modConfig, final Path file, fina\n         return true;\n     }\n \n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig) {\n+        int maxBackups = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68e010520afb1c1f8d51dee587901faaeb54026f"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTQ4MjYy", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#pullrequestreview-522148262", "createdAt": "2020-11-03T01:53:24Z", "commit": {"oid": "7ad08caca2bc3f4e80307b13390ff3e86af09370"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo1MzoyNFrOHsd5oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo1MzoyNFrOHsd5oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4OTI4MQ==", "bodyText": "Use NIO, not java.io.File. This will be a lot cleaner..", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#discussion_r516389281", "createdAt": "2020-11-03T01:53:24Z", "author": {"login": "cpw"}, "path": "src/main/java/net/minecraftforge/fml/config/ConfigFileTypeHandler.java", "diffHunk": "@@ -91,6 +93,42 @@ private boolean setupConfigFile(final ModConfig modConfig, final Path file, fina\n         return true;\n     }\n \n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig)\n+    {\n+        backUpConfig(commentedFileConfig, 5); //TODO: Think of a way for mods to set their own preference (include a sanity check as well, no disk stuffing)\n+    }\n+\n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig, final int maxBackups)\n+    {\n+        File bakFileLocation = commentedFileConfig.getFile().getParentFile();\n+        String bakFileName = FilenameUtils.removeExtension(commentedFileConfig.getFile().getName());\n+        String bakFileExtension = FilenameUtils.getExtension(commentedFileConfig.getFile().getName()) + \".bak\";\n+        File bakFile = new File(bakFileLocation, bakFileName + \"-1\" + \".\" + bakFileExtension);\n+        try\n+        {\n+            for(int i = maxBackups; i > 0; i--)\n+            {\n+                File oldBak = new File(bakFileLocation, bakFileName + \"-\" + i + \".\" + bakFileExtension);\n+                if(oldBak.exists())\n+                {\n+                    if(i == maxBackups)\n+                    {\n+                        if (oldBak.delete()) continue;\n+                        LOGGER.warn(CONFIG, \"Failed to back up config file {} as the oldest backup, {}, could not be deleted\", commentedFileConfig.getFile().getName(), oldBak.getAbsolutePath());\n+                        return;\n+                    }\n+                    if (!oldBak.renameTo(new File(bakFileLocation, bakFileName + \"-\" + (i + 1) + \".\" + bakFileExtension)))\n+                        LOGGER.warn(CONFIG, \"Failed to back up config file {} as an old backup, {}, could not be renamed\", commentedFileConfig.getFile().getName(), oldBak.getAbsolutePath());\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ad08caca2bc3f4e80307b13390ff3e86af09370"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae8bebd77389d922884b3c0269b18f8b9084c6bb", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ae8bebd77389d922884b3c0269b18f8b9084c6bb", "committedDate": "2020-11-07T02:32:00Z", "message": "Fixed Configs not correcting when hot-loaded from changes on disk\n\nCloses #7367"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d93c07998c0ce57b567b9babd5312d4d43f8444c", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/d93c07998c0ce57b567b9babd5312d4d43f8444c", "committedDate": "2020-11-07T02:32:01Z", "message": "Modify backups to operate in a similar manner to log archives\n\nbak files will now be numbered from new -> old with the oldest backup being deleted upon the maximum (currently 5, again similar to the current log config) being reached"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb7377db9cad18c16868ff94349f3e802f2aa551", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/cb7377db9cad18c16868ff94349f3e802f2aa551", "committedDate": "2020-11-07T02:32:01Z", "message": "Log messages when backups fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4434e7ed5f1e5878e347948c53ea1f17c4eba88e", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4434e7ed5f1e5878e347948c53ea1f17c4eba88e", "committedDate": "2020-11-07T02:32:02Z", "message": "Clean up unnecessary imports I didn't notice before"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0284c6bb89c622888ad218b66218d49a9e2fc0d7", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/0284c6bb89c622888ad218b66218d49a9e2fc0d7", "committedDate": "2020-11-07T02:32:02Z", "message": "Remove unnecessary \"CORE\" import\n\nand use CONFIG like everything else"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97150b49ff30e189d7218aba4ac69512e66d9c06", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/97150b49ff30e189d7218aba4ac69512e66d9c06", "committedDate": "2020-11-07T02:32:03Z", "message": "Address comment relating to brace placement\n\nAnd provide possible solution to comment relating to maxBackups value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5821c153f7a5373325977e1699cbb987c688f0", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2e5821c153f7a5373325977e1699cbb987c688f0", "committedDate": "2020-11-07T02:34:35Z", "message": "Addressed comment regarding using NIO instead of IO"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ad08caca2bc3f4e80307b13390ff3e86af09370", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7ad08caca2bc3f4e80307b13390ff3e86af09370", "committedDate": "2020-11-02T16:09:14Z", "message": "Address comment relating to brace placement\n\nAnd provide possible solution to comment relating to maxBackups value"}, "afterCommit": {"oid": "2e5821c153f7a5373325977e1699cbb987c688f0", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2e5821c153f7a5373325977e1699cbb987c688f0", "committedDate": "2020-11-07T02:34:35Z", "message": "Addressed comment regarding using NIO instead of IO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTg1MTY5", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#pullrequestreview-525585169", "createdAt": "2020-11-07T02:37:27Z", "commit": {"oid": "2e5821c153f7a5373325977e1699cbb987c688f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMjozNzoyN1rOHvCajg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMjozNzoyN1rOHvCajg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA4NDY4Ng==", "bodyText": "Before anyone comments on this part, Log4J doesn't seem to have a method for both {} params and throwable printing at the same time.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7427#discussion_r519084686", "createdAt": "2020-11-07T02:37:27Z", "author": {"login": "DaemonUmbra"}, "path": "src/main/java/net/minecraftforge/fml/config/ConfigFileTypeHandler.java", "diffHunk": "@@ -91,6 +92,38 @@ private boolean setupConfigFile(final ModConfig modConfig, final Path file, fina\n         return true;\n     }\n \n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig)\n+    {\n+        backUpConfig(commentedFileConfig, 5); //TODO: Think of a way for mods to set their own preference (include a sanity check as well, no disk stuffing)\n+    }\n+\n+    public static void backUpConfig(final CommentedFileConfig commentedFileConfig, final int maxBackups)\n+    {\n+        Path bakFileLocation = commentedFileConfig.getNioPath().getParent();\n+        String bakFileName = FilenameUtils.removeExtension(commentedFileConfig.getFile().getName());\n+        String bakFileExtension = FilenameUtils.getExtension(commentedFileConfig.getFile().getName()) + \".bak\";\n+        Path bakFile = bakFileLocation.resolve(bakFileName + \"-1\" + \".\" + bakFileExtension);\n+        try\n+        {\n+            for(int i = maxBackups; i > 0; i--)\n+            {\n+                Path oldBak = bakFileLocation.resolve(bakFileName + \"-\" + i + \".\" + bakFileExtension);\n+                if(Files.exists(oldBak))\n+                {\n+                    if(i >= maxBackups)\n+                        Files.delete(oldBak);\n+                    else\n+                        Files.move(oldBak, bakFileLocation.resolve(bakFileName + \"-\" + (i + 1) + \".\" + bakFileExtension));\n+                }\n+            }\n+            Files.copy(commentedFileConfig.getNioPath(), bakFile);\n+        }\n+        catch (IOException exception)\n+        {\n+            LOGGER.warn(CONFIG, \"Failed to back up config file \" + commentedFileConfig.getNioPath(), exception);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e5821c153f7a5373325977e1699cbb987c688f0"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c19746f8508b0648c4cbb588158cb518dd437f99", "author": {"user": {"login": "DaemonUmbra", "name": "DaemonUmbra"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/c19746f8508b0648c4cbb588158cb518dd437f99", "committedDate": "2020-11-07T02:55:08Z", "message": "Adjusted to utilize the undocumented feature of using both {} and throwable printing in Log4j"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2347, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}