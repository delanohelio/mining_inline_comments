{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNzUyMzUz", "number": 7532, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToxMDozMFrOFATNMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToxMDozMFrOFATNMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1ODU4OTkzOnYy", "diffSide": "RIGHT", "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToxMDozMFrOH-hFwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMjoyMzowMlrOH-940Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMxNTkwNA==", "bodyText": "If you don't change the indentation of this inner stuff the patch will be a lot cleaner/smaller.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7532#discussion_r535315904", "createdAt": "2020-12-03T15:10:30Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "diffHunk": "@@ -8,23 +8,58 @@\n                 }\n  \n                 this.func_219229_a(p_219185_5_);\n-@@ -601,6 +602,7 @@\n-                if (list != null) {\n-                   list.forEach(chunk::func_76622_b);\n-                }\n-+               net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.ChunkEvent.Load(chunk));\n+@@ -582,25 +583,28 @@\n+             if (this.field_219254_h.add(chunkpos.func_201841_a())) {\n+                chunk.func_177417_c(true);\n+                this.field_219255_i.func_147448_a(chunk.func_177434_r().values());\n+-               List<Entity> list = null;\n+-               ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n+-               int i = aclassinheritancemultimap.length;\n++               p_219200_1_.func_219276_a(ChunkStatus.field_222617_m, this).thenRun(() -> { //Forge: Delay EntityJoinWorld events until chunk is available to prevent deadlocks\n++                  List<Entity> list = null;\n++                  ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n++                  int i = aclassinheritancemultimap.length;\n+ \n+-               for(int j = 0; j < i; ++j) {\n+-                  for(Entity entity : aclassinheritancemultimap[j]) {\n+-                     if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n+-                        if (list == null) {\n+-                           list = Lists.newArrayList(entity);\n+-                        } else {\n+-                           list.add(entity);\n++                  for(int j = 0; j < i; ++j) {\n++                     for(Entity entity : aclassinheritancemultimap[j]) {\n++                        if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n++                           if (list == null) {\n++                              list = Lists.newArrayList(entity);\n++                           } else {\n++                              list.add(entity);\n++                           }\n+                         }\n+                      }\n+                   }\n+-               }\n+ \n+-               if (list != null) {\n+-                  list.forEach(chunk::func_76622_b);\n+-               }\n++                  if (list != null) {\n++                     list.forEach(chunk::func_76622_b);\n++                  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9487ac35043c4b9e9b6693e77fa67cd0b4cd677d"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM0MzE5OA==", "bodyText": "Changed and pushed", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7532#discussion_r535343198", "createdAt": "2020-12-03T15:39:36Z", "author": {"login": "AterAnimAvis"}, "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "diffHunk": "@@ -8,23 +8,58 @@\n                 }\n  \n                 this.func_219229_a(p_219185_5_);\n-@@ -601,6 +602,7 @@\n-                if (list != null) {\n-                   list.forEach(chunk::func_76622_b);\n-                }\n-+               net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.ChunkEvent.Load(chunk));\n+@@ -582,25 +583,28 @@\n+             if (this.field_219254_h.add(chunkpos.func_201841_a())) {\n+                chunk.func_177417_c(true);\n+                this.field_219255_i.func_147448_a(chunk.func_177434_r().values());\n+-               List<Entity> list = null;\n+-               ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n+-               int i = aclassinheritancemultimap.length;\n++               p_219200_1_.func_219276_a(ChunkStatus.field_222617_m, this).thenRun(() -> { //Forge: Delay EntityJoinWorld events until chunk is available to prevent deadlocks\n++                  List<Entity> list = null;\n++                  ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n++                  int i = aclassinheritancemultimap.length;\n+ \n+-               for(int j = 0; j < i; ++j) {\n+-                  for(Entity entity : aclassinheritancemultimap[j]) {\n+-                     if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n+-                        if (list == null) {\n+-                           list = Lists.newArrayList(entity);\n+-                        } else {\n+-                           list.add(entity);\n++                  for(int j = 0; j < i; ++j) {\n++                     for(Entity entity : aclassinheritancemultimap[j]) {\n++                        if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n++                           if (list == null) {\n++                              list = Lists.newArrayList(entity);\n++                           } else {\n++                              list.add(entity);\n++                           }\n+                         }\n+                      }\n+                   }\n+-               }\n+ \n+-               if (list != null) {\n+-                  list.forEach(chunk::func_76622_b);\n+-               }\n++                  if (list != null) {\n++                     list.forEach(chunk::func_76622_b);\n++                  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMxNTkwNA=="}, "originalCommit": {"oid": "9487ac35043c4b9e9b6693e77fa67cd0b4cd677d"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM0OTIxMg==", "bodyText": "I think your change of this might have lost something? The description of the PR says you moved the load event, but it seems you are only adding a new one now, instead of also removing the old one.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7532#discussion_r535349212", "createdAt": "2020-12-03T15:45:05Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "diffHunk": "@@ -8,23 +8,58 @@\n                 }\n  \n                 this.func_219229_a(p_219185_5_);\n-@@ -601,6 +602,7 @@\n-                if (list != null) {\n-                   list.forEach(chunk::func_76622_b);\n-                }\n-+               net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.ChunkEvent.Load(chunk));\n+@@ -582,25 +583,28 @@\n+             if (this.field_219254_h.add(chunkpos.func_201841_a())) {\n+                chunk.func_177417_c(true);\n+                this.field_219255_i.func_147448_a(chunk.func_177434_r().values());\n+-               List<Entity> list = null;\n+-               ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n+-               int i = aclassinheritancemultimap.length;\n++               p_219200_1_.func_219276_a(ChunkStatus.field_222617_m, this).thenRun(() -> { //Forge: Delay EntityJoinWorld events until chunk is available to prevent deadlocks\n++                  List<Entity> list = null;\n++                  ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n++                  int i = aclassinheritancemultimap.length;\n+ \n+-               for(int j = 0; j < i; ++j) {\n+-                  for(Entity entity : aclassinheritancemultimap[j]) {\n+-                     if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n+-                        if (list == null) {\n+-                           list = Lists.newArrayList(entity);\n+-                        } else {\n+-                           list.add(entity);\n++                  for(int j = 0; j < i; ++j) {\n++                     for(Entity entity : aclassinheritancemultimap[j]) {\n++                        if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n++                           if (list == null) {\n++                              list = Lists.newArrayList(entity);\n++                           } else {\n++                              list.add(entity);\n++                           }\n+                         }\n+                      }\n+                   }\n+-               }\n+ \n+-               if (list != null) {\n+-                  list.forEach(chunk::func_76622_b);\n+-               }\n++                  if (list != null) {\n++                     list.forEach(chunk::func_76622_b);\n++                  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMxNTkwNA=="}, "originalCommit": {"oid": "9487ac35043c4b9e9b6693e77fa67cd0b4cd677d"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1NzUwMw==", "bodyText": "I think your reading the patch wrong. There's only one post of ChunkEvent.Load?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7532#discussion_r535357503", "createdAt": "2020-12-03T15:53:21Z", "author": {"login": "AterAnimAvis"}, "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "diffHunk": "@@ -8,23 +8,58 @@\n                 }\n  \n                 this.func_219229_a(p_219185_5_);\n-@@ -601,6 +602,7 @@\n-                if (list != null) {\n-                   list.forEach(chunk::func_76622_b);\n-                }\n-+               net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.ChunkEvent.Load(chunk));\n+@@ -582,25 +583,28 @@\n+             if (this.field_219254_h.add(chunkpos.func_201841_a())) {\n+                chunk.func_177417_c(true);\n+                this.field_219255_i.func_147448_a(chunk.func_177434_r().values());\n+-               List<Entity> list = null;\n+-               ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n+-               int i = aclassinheritancemultimap.length;\n++               p_219200_1_.func_219276_a(ChunkStatus.field_222617_m, this).thenRun(() -> { //Forge: Delay EntityJoinWorld events until chunk is available to prevent deadlocks\n++                  List<Entity> list = null;\n++                  ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n++                  int i = aclassinheritancemultimap.length;\n+ \n+-               for(int j = 0; j < i; ++j) {\n+-                  for(Entity entity : aclassinheritancemultimap[j]) {\n+-                     if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n+-                        if (list == null) {\n+-                           list = Lists.newArrayList(entity);\n+-                        } else {\n+-                           list.add(entity);\n++                  for(int j = 0; j < i; ++j) {\n++                     for(Entity entity : aclassinheritancemultimap[j]) {\n++                        if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n++                           if (list == null) {\n++                              list = Lists.newArrayList(entity);\n++                           } else {\n++                              list.add(entity);\n++                           }\n+                         }\n+                      }\n+                   }\n+-               }\n+ \n+-               if (list != null) {\n+-                  list.forEach(chunk::func_76622_b);\n+-               }\n++                  if (list != null) {\n++                     list.forEach(chunk::func_76622_b);\n++                  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMxNTkwNA=="}, "originalCommit": {"oid": "9487ac35043c4b9e9b6693e77fa67cd0b4cd677d"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM2MDI0Mw==", "bodyText": "Ya nevermind I was reading it wrong, because there was an extra line I think just because of all the lines earlier that I think was showing removed.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7532#discussion_r535360243", "createdAt": "2020-12-03T15:56:35Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "diffHunk": "@@ -8,23 +8,58 @@\n                 }\n  \n                 this.func_219229_a(p_219185_5_);\n-@@ -601,6 +602,7 @@\n-                if (list != null) {\n-                   list.forEach(chunk::func_76622_b);\n-                }\n-+               net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.ChunkEvent.Load(chunk));\n+@@ -582,25 +583,28 @@\n+             if (this.field_219254_h.add(chunkpos.func_201841_a())) {\n+                chunk.func_177417_c(true);\n+                this.field_219255_i.func_147448_a(chunk.func_177434_r().values());\n+-               List<Entity> list = null;\n+-               ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n+-               int i = aclassinheritancemultimap.length;\n++               p_219200_1_.func_219276_a(ChunkStatus.field_222617_m, this).thenRun(() -> { //Forge: Delay EntityJoinWorld events until chunk is available to prevent deadlocks\n++                  List<Entity> list = null;\n++                  ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n++                  int i = aclassinheritancemultimap.length;\n+ \n+-               for(int j = 0; j < i; ++j) {\n+-                  for(Entity entity : aclassinheritancemultimap[j]) {\n+-                     if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n+-                        if (list == null) {\n+-                           list = Lists.newArrayList(entity);\n+-                        } else {\n+-                           list.add(entity);\n++                  for(int j = 0; j < i; ++j) {\n++                     for(Entity entity : aclassinheritancemultimap[j]) {\n++                        if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n++                           if (list == null) {\n++                              list = Lists.newArrayList(entity);\n++                           } else {\n++                              list.add(entity);\n++                           }\n+                         }\n+                      }\n+                   }\n+-               }\n+ \n+-               if (list != null) {\n+-                  list.forEach(chunk::func_76622_b);\n+-               }\n++                  if (list != null) {\n++                     list.forEach(chunk::func_76622_b);\n++                  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMxNTkwNA=="}, "originalCommit": {"oid": "9487ac35043c4b9e9b6693e77fa67cd0b4cd677d"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc4NzcyOQ==", "bodyText": "Literally woke up in the middle of the night and realised I missed a line from my fix. I\u2019ll fix this in the morning (If I\u2019m actually right) - Thankfully the current patch doesn't need the fix (Prevents CME on iterating the entities for removal) which was necessary for a previous version.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7532#discussion_r535787729", "createdAt": "2020-12-04T02:23:02Z", "author": {"login": "AterAnimAvis"}, "path": "patches/minecraft/net/minecraft/world/server/ChunkManager.java.patch", "diffHunk": "@@ -8,23 +8,58 @@\n                 }\n  \n                 this.func_219229_a(p_219185_5_);\n-@@ -601,6 +602,7 @@\n-                if (list != null) {\n-                   list.forEach(chunk::func_76622_b);\n-                }\n-+               net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.ChunkEvent.Load(chunk));\n+@@ -582,25 +583,28 @@\n+             if (this.field_219254_h.add(chunkpos.func_201841_a())) {\n+                chunk.func_177417_c(true);\n+                this.field_219255_i.func_147448_a(chunk.func_177434_r().values());\n+-               List<Entity> list = null;\n+-               ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n+-               int i = aclassinheritancemultimap.length;\n++               p_219200_1_.func_219276_a(ChunkStatus.field_222617_m, this).thenRun(() -> { //Forge: Delay EntityJoinWorld events until chunk is available to prevent deadlocks\n++                  List<Entity> list = null;\n++                  ClassInheritanceMultiMap<Entity>[] aclassinheritancemultimap = chunk.func_177429_s();\n++                  int i = aclassinheritancemultimap.length;\n+ \n+-               for(int j = 0; j < i; ++j) {\n+-                  for(Entity entity : aclassinheritancemultimap[j]) {\n+-                     if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n+-                        if (list == null) {\n+-                           list = Lists.newArrayList(entity);\n+-                        } else {\n+-                           list.add(entity);\n++                  for(int j = 0; j < i; ++j) {\n++                     for(Entity entity : aclassinheritancemultimap[j]) {\n++                        if (!(entity instanceof PlayerEntity) && !this.field_219255_i.func_217440_f(entity)) {\n++                           if (list == null) {\n++                              list = Lists.newArrayList(entity);\n++                           } else {\n++                              list.add(entity);\n++                           }\n+                         }\n+                      }\n+                   }\n+-               }\n+ \n+-               if (list != null) {\n+-                  list.forEach(chunk::func_76622_b);\n+-               }\n++                  if (list != null) {\n++                     list.forEach(chunk::func_76622_b);\n++                  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMxNTkwNA=="}, "originalCommit": {"oid": "9487ac35043c4b9e9b6693e77fa67cd0b4cd677d"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 786, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}