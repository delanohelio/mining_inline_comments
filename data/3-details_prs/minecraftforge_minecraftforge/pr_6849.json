{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODQ4OTI0", "number": 6849, "title": "Fix and tweak how resource reload listeners are added", "bodyText": "From #6838, the new resource manager is DataPackRegistries. However instead of creating it once, it is created on each reload.\nNot sure if my fix is proper/in line with how forge does things.", "createdAt": "2020-06-27T02:34:56Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849", "merged": true, "mergeCommit": {"oid": "ff86201523a1f5a2af4559911b3de51358743f82"}, "closed": true, "closedAt": "2020-07-06T19:41:58Z", "author": {"login": "Cyborgmas"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvOY2OAH2gAyNDQwODQ4OTI0OjYwMjllNjdjMjRmY2JmYzVkMDQ4Y2E4MDFjYTk0MjJhMjQwNWMyZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwdgM6AH2gAyNDQwODQ4OTI0OjYzNDIwY2E5OTEwMzE0ZjUxZGY1MWZlNWZiN2IyMzdkMTFkZjdhOTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6029e67c24fcbfc5d048ca801ca9422a2405c2d6", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/6029e67c24fcbfc5d048ca801ca9422a2405c2d6", "committedDate": "2020-06-27T02:26:20Z", "message": "Fix adding reload listeners"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Njc5Nzcy", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#pullrequestreview-438679772", "createdAt": "2020-06-27T07:23:03Z", "commit": {"oid": "6029e67c24fcbfc5d048ca801ca9422a2405c2d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNzoyMzowM1rOGpz-Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNzoyMzowM1rOGpz-Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5NjMzMA==", "bodyText": "Because this is in an interface, this is public, it should not be.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#discussion_r446496330", "createdAt": "2020-06-27T07:23:03Z", "author": {"login": "covers1624"}, "path": "src/main/java/net/minecraftforge/resource/IForgeDataPackRegistries.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package net.minecraftforge.resource;\n+\n+import net.minecraft.resources.IFutureReloadListener;\n+import net.minecraftforge.common.loot.LootModifierManager;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+public interface IForgeDataPackRegistries {\n+   List<IFutureReloadListener> resources = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6029e67c24fcbfc5d048ca801ca9422a2405c2d6"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2631f08bc2826ba6cd7d316d910d606fb58117ec", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2631f08bc2826ba6cd7d316d910d606fb58117ec", "committedDate": "2020-06-27T13:03:47Z", "message": "Event way"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzA1MTU1", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#pullrequestreview-438705155", "createdAt": "2020-06-27T15:20:08Z", "commit": {"oid": "2631f08bc2826ba6cd7d316d910d606fb58117ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNToyMDowOFrOGp2cWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNToyMDowOFrOGp2cWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzNjc5NA==", "bodyText": "Wasn't this getter used by Global Loot Modifiers ? I think they are broken right now though.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#discussion_r446536794", "createdAt": "2020-06-27T15:20:08Z", "author": {"login": "Nukeologist"}, "path": "patches/minecraft/net/minecraft/resources/DataPackRegistries.java.patch", "diffHunk": "@@ -1,28 +1,10 @@\n --- a/net/minecraft/resources/DataPackRegistries.java\n +++ b/net/minecraft/resources/DataPackRegistries.java\n-@@ -22,6 +22,8 @@\n-    private final AdvancementManager field_240958_h_ = new AdvancementManager(this.field_240956_f_);\n-    private final FunctionReloader field_240959_i_;\n- \n-+   private final net.minecraftforge.common.loot.LootModifierManager lootManager = new net.minecraftforge.common.loot.LootModifierManager();\n-+\n-    public DataPackRegistries(Commands.EnvironmentType p_i232598_1_, int p_i232598_2_) {\n-       this.field_240953_c_ = new Commands(p_i232598_1_);\n-       this.field_240959_i_ = new FunctionReloader(p_i232598_2_, this.field_240953_c_.func_197054_a());\n-@@ -31,6 +33,7 @@\n+@@ -31,6 +31,7 @@\n        this.field_240952_b_.func_219534_a(this.field_240957_g_);\n        this.field_240952_b_.func_219534_a(this.field_240959_i_);\n        this.field_240952_b_.func_219534_a(this.field_240958_h_);\n-+      this.field_240952_b_.func_219534_a(this.lootManager);\n++      net.minecraftforge.event.ForgeEventFactory.onResourceReload().forEach(field_240952_b_::func_219534_a);\n     }\n  \n     public FunctionReloader func_240960_a_() {\n-@@ -85,4 +88,8 @@\n-    public void close() {\n-       this.field_240952_b_.close();\n-    }\n-+\n-+   public net.minecraftforge.common.loot.LootModifierManager getLootModifierManager() {\n-+      return lootManager;\n-+   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2631f08bc2826ba6cd7d316d910d606fb58117ec"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzE2Njcw", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#pullrequestreview-438716670", "createdAt": "2020-06-27T18:39:58Z", "commit": {"oid": "2631f08bc2826ba6cd7d316d910d606fb58117ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxODozOTo1OFrOGp3iaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxODozOTo1OFrOGp3iaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU1NDcyOQ==", "bodyText": "Why are the imports in this file changing?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#discussion_r446554729", "createdAt": "2020-06-27T18:39:58Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/ForgeMod.java", "diffHunk": "@@ -23,8 +23,8 @@\n import net.minecraft.entity.ai.attributes.RangedAttribute;\n import net.minecraft.util.SoundEvent;\n import net.minecraft.world.storage.IServerConfiguration;\n-import net.minecraft.world.storage.IWorldInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2631f08bc2826ba6cd7d316d910d606fb58117ec"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a601fc93bc52ca56b10c688b8d3f0b764762ddc", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1a601fc93bc52ca56b10c688b8d3f0b764762ddc", "committedDate": "2020-06-27T23:08:59Z", "message": "Add docs + fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4ee329e63b986ddfdb583faf8e6ff95a146d93e", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/a4ee329e63b986ddfdb583faf8e6ff95a146d93e", "committedDate": "2020-06-27T23:14:29Z", "message": "damn imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzMzMzkx", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#pullrequestreview-438733391", "createdAt": "2020-06-28T00:38:33Z", "commit": {"oid": "a4ee329e63b986ddfdb583faf8e6ff95a146d93e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMDozODozM1rOGp5TZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMDozODozM1rOGp5TZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MzY1NA==", "bodyText": "Might want to emphasize this is for server reload listeners. Only clue in the javadoc is the link to data pack registries, but I could see someone getting confused and trying to use this for the client side resource pack reload listeners.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#discussion_r446583654", "createdAt": "2020-06-28T00:38:33Z", "author": {"login": "KnightMiner"}, "path": "src/main/java/net/minecraftforge/event/AddReloadListenerEvent.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package net.minecraftforge.event;\n+\n+import com.google.common.collect.ImmutableList;\n+import net.minecraft.resources.DataPackRegistries;\n+import net.minecraft.resources.IFutureReloadListener;\n+import net.minecraftforge.common.MinecraftForge;\n+import net.minecraftforge.eventbus.api.Event;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * The main ResourceManager is recreated on each reload, through {@link DataPackRegistries}'s creation.\n+ *\n+ * The event is fired on each reload and lets modders add their own ReloadListeners.\n+ * The event is fired on the {@link MinecraftForge#EVENT_BUS}\n+ */\n+public class AddReloadListenerEvent extends Event", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4ee329e63b986ddfdb583faf8e6ff95a146d93e"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4950447c05e29dbed1ba0bf273dc28073810ad77", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4950447c05e29dbed1ba0bf273dc28073810ad77", "committedDate": "2020-06-28T01:28:31Z", "message": "specify only server ride"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzM4NDYz", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#pullrequestreview-440338463", "createdAt": "2020-06-30T19:54:32Z", "commit": {"oid": "4950447c05e29dbed1ba0bf273dc28073810ad77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxOTo1NDozMlrOGrMLsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxOTo1NDozMlrOGrMLsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk0MTU1NA==", "bodyText": "Forge has its own internal handler, so this shouldn't have this weird meta instance thing...\nWhat is the point of people having access to the instance?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6849#discussion_r447941554", "createdAt": "2020-06-30T19:54:32Z", "author": {"login": "LexManos"}, "path": "src/main/java/net/minecraftforge/common/loot/LootModifierManager.java", "diffHunk": "@@ -154,4 +161,17 @@ private IGlobalLootModifier deserializeModifier(ResourceLocation location, JsonE\n         return registeredLootModifiers.values();\n     }\n \n+    @SubscribeEvent\n+    public static void onResourceReload(AddReloadListenerEvent event)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4950447c05e29dbed1ba0bf273dc28073810ad77"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eb51f8089d330db58173203d9b69e683719400b", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2eb51f8089d330db58173203d9b69e683719400b", "committedDate": "2020-06-30T21:08:07Z", "message": "move LootModifierManager instance, getter & reloader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2105ad3ed918f1c368145fa91d5db2add395eec", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/c2105ad3ed918f1c368145fa91d5db2add395eec", "committedDate": "2020-06-30T21:11:38Z", "message": "diff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82a999f1baffbd41eab2beb745c73b25ade45f59", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/82a999f1baffbd41eab2beb745c73b25ade45f59", "committedDate": "2020-06-30T21:13:01Z", "message": "ugh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dac6d23d5fdcf4f15f2dfee44a5a524586ae3814", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/dac6d23d5fdcf4f15f2dfee44a5a524586ae3814", "committedDate": "2020-06-30T21:13:45Z", "message": "ugh v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63420ca9910314f51df51fe5fb7b237d11df7a90", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/63420ca9910314f51df51fe5fb7b237d11df7a90", "committedDate": "2020-06-30T22:36:52Z", "message": "re enable global loot modifiers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1981, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}