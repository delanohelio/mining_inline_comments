{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MzA3MTU5", "number": 7294, "title": "[1.16] Optionally add milk as a fluid to the vanilla bucket", "bodyText": "This pull request supersedes #6840, in order to fix #6769. After discussion on Discord, it was determined the best solution for mods to add milk as a fluid was for Forge to register the fluid, while mods just set a Forge flag to enable it, similar to the universal bucket back in 1.12\nTo enable Forge adding milk, you simply need to call ForgeMod.enableMilkFluid() during mod construction. We can move this function to a different location if there is a better one, but this location kept the logic behind the flag clean.\nA few details on implementation:\n\nIt was suggested on Discord that we use minecraft:milk and alike rather than the forge namespace for the fluids.\nA tag forge:milk was added containing the still and flowing milk like the vanilla water and lava tags. I am not sure if we want to add the tag to the minecraft namespace instead for consistency with the fluid's namespace, but I know some mods are using forge:milk for compat right now so it probably is better to stick with that.\nNo fluid block is included to prevent the need for Forge to change the behavior of the vanilla bucket. I could add one that is simply unused by default if preferred.\nI had to add a listener to the texture stitch event to ensure fluid textures are registered (KingLemming can give more details on why that is required). I am not sure if there is a better place than a client event listener subclass of ForgeMod, but I can say it does not cause issues when launching a server there.\nI did a bit of cleanup regarding milk in the bucket wrapper logic as the checks for milk are redundant to the fallback. The water and lava checks there really are redundant as well, but as they are just field lookups instead of object creation and are unrelated to this PR, I left them as is.\n\nIncluded in this PR is ForgeMilkTest that will enable the Forge milk fluid and cause a milk bucket to display the name of the contained fluid on right click. You can enable the test mod using the boolean ENABLE flag.\nFinally, credits to Rorax for the textures for the milk fluid. Used for this PR with permission.", "createdAt": "2020-09-01T20:11:44Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7294", "merged": true, "mergeCommit": {"oid": "19f8d2a7937dc7968ecbef2f9785687193fcd210"}, "closed": true, "closedAt": "2021-01-17T21:05:25Z", "author": {"login": "KnightMiner"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFS3uigBqjM3MjU0OTE1NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh-zb_ABqjQwNTg3NzY0Mjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1aa0e2147484490396c05e601cf4d0c735010071", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1aa0e2147484490396c05e601cf4d0c735010071", "committedDate": "2020-09-01T20:05:12Z", "message": "Optionally add milk as a fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}, "afterCommit": {"oid": "979a7196a9af22b23b8335fcc9848390a017ceb6", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/979a7196a9af22b23b8335fcc9848390a017ceb6", "committedDate": "2020-09-03T16:01:39Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "979a7196a9af22b23b8335fcc9848390a017ceb6", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/979a7196a9af22b23b8335fcc9848390a017ceb6", "committedDate": "2020-09-03T16:01:39Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}, "afterCommit": {"oid": "183c44ecb1fcaa1e495e3e0bc54a259a20607643", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/183c44ecb1fcaa1e495e3e0bc54a259a20607643", "committedDate": "2020-09-17T18:11:48Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTczMDE4", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7294#pullrequestreview-497573018", "createdAt": "2020-09-28T14:31:27Z", "commit": {"oid": "183c44ecb1fcaa1e495e3e0bc54a259a20607643"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDozMToyN1rOHZAfzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDozMToyN1rOHZAfzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk4NDU4OQ==", "bodyText": "Why is this needed? FluidModel#getTextures calls ForgeHooksClient#getFluidMaterials which gets the textures from the FluidAttributes.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7294#discussion_r495984589", "createdAt": "2020-09-28T14:31:27Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/ForgeMod.java", "diffHunk": "@@ -229,4 +278,18 @@ public void registerRecipeSerialziers(RegistryEvent.Register<IRecipeSerializer<?\n         event.getRegistry().register(new ConditionalRecipe.Serializer<IRecipe<?>>().setRegistryName(new ResourceLocation(\"forge\", \"conditional\")));\n \n     }\n+\n+    @EventBusSubscriber(value = Dist.CLIENT, modid = \"forge\", bus = Mod.EventBusSubscriber.Bus.MOD)\n+    public static class ClientEvents\n+    {\n+        @SubscribeEvent\n+        public static void registerFluidTextures(TextureStitchEvent.Pre event)\n+        {\n+            if (enableMilkFluid && PlayerContainer.LOCATION_BLOCKS_TEXTURE.equals(event.getMap().getTextureLocation()))\n+            {\n+                event.addSprite(STILL_MILK_TEXTURE);\n+                event.addSprite(FLOWING_MILK_TEXTURE);\n+            }\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "183c44ecb1fcaa1e495e3e0bc54a259a20607643"}, "originalPosition": 126}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6cf1e25f3b069b6a0c2a4ff1fc918650f53c9010", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/6cf1e25f3b069b6a0c2a4ff1fc918650f53c9010", "committedDate": "2020-09-29T17:37:56Z", "message": "Now unused imports"}, "afterCommit": {"oid": "93ba03ac67204d2158e4984c805dd672c504fdc5", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/93ba03ac67204d2158e4984c805dd672c504fdc5", "committedDate": "2020-10-27T18:40:47Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93ba03ac67204d2158e4984c805dd672c504fdc5", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/93ba03ac67204d2158e4984c805dd672c504fdc5", "committedDate": "2020-10-27T18:40:47Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}, "afterCommit": {"oid": "fc6e96714f4c164cf20cfb86dde67b28ff55e710", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/fc6e96714f4c164cf20cfb86dde67b28ff55e710", "committedDate": "2020-11-11T01:53:27Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "757b80c066c3ead52d831df80a67af10d007ad9d", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/757b80c066c3ead52d831df80a67af10d007ad9d", "committedDate": "2020-12-01T19:06:31Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc6e96714f4c164cf20cfb86dde67b28ff55e710", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/fc6e96714f4c164cf20cfb86dde67b28ff55e710", "committedDate": "2020-11-11T01:53:27Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}, "afterCommit": {"oid": "757b80c066c3ead52d831df80a67af10d007ad9d", "author": {"user": {"login": "KnightMiner", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/757b80c066c3ead52d831df80a67af10d007ad9d", "committedDate": "2020-12-01T19:06:31Z", "message": "Optionally add a milk fluid to the vanilla bucket\n\nFixes the previous broken code that was supposed to make mod registered milk returned by the vanilla bucket by allowing mods to enable a milk fluid."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2466, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}