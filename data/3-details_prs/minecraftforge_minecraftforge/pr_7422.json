{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1NTI3NTI3", "number": 7422, "title": "Fix a few FluidUtil issues that were causing DispenseFluidContainer to not function properly", "bodyText": "This PR addresses #7421 for 1.16 by ATing the two constructors that allow for nullable players in ItemUseContext and BlockItemUseContext to be public so that modders (and forge) can make use of them. Additionally this PR fixes some other issues throughout FluidUtil that caused DispenseFluidContainer to not properly work.\n\nFixed FluidUtil#getFluidContained so that if the contained fluid is empty it returns an empty optional instead of an optional with an empty fluid stack, as all places that call this method assume this implementation.\nMade FluidUtil#tryPickUpFluid properly handle calling the methods of IFluidBlock instead of just looking at the tile in that position, and also make it able to handle IBucketPickupHandler so that it can properly de-fluidlog blocks\nMade FluidUtil#tryPlaceFluid properly be able to handle ILiquidContainers so that it can properly place fluids into fluid loggable blocks.", "createdAt": "2020-10-18T19:33:34Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7422", "merged": true, "mergeCommit": {"oid": "d97f28141cb6bd4ffd0b232343f2975da8e1915f"}, "closed": true, "closedAt": "2021-02-16T01:08:06Z", "author": {"login": "pupnewfster"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdT01H0gFqTUxMTE3NDgzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdftciPgBqjQwMzQwODc2MTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTc0ODM1", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7422#pullrequestreview-511174835", "createdAt": "2020-10-18T19:34:49Z", "commit": {"oid": "c5eba911b9ab43c697fafa72908a83ab9bd19c20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxOTozNDo1MFrOHjtPpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxOTozNDo1MFrOHjtPpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIwMzQ5NQ==", "bodyText": "I moved this handling from IFluidBlock (as it is not the proper handling for an IFluidBlock) to here in an else branch, but I am unsure if this branch should not just be removed instead as querying a tile for its fluid handler doesn't seem like it has to do with getting a fluid from in world.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7422#discussion_r507203495", "createdAt": "2020-10-18T19:34:50Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/fluids/FluidUtil.java", "diffHunk": "@@ -481,20 +488,29 @@ public static FluidActionResult tryPickUpFluid(@Nonnull ItemStack emptyContainer\n \n         BlockState state = worldIn.getBlockState(pos);\n         Block block = state.getBlock();\n-\n+        IFluidHandler targetFluidHandler;\n         if (block instanceof IFluidBlock)\n         {\n-            IFluidHandler targetFluidHandler = getFluidHandler(worldIn, pos, side).orElse(null);\n-            if (targetFluidHandler != null)\n+            targetFluidHandler = new FluidBlockWrapper((IFluidBlock) block, worldIn, pos);\n+        }\n+        else if (block instanceof IBucketPickupHandler)\n+        {\n+            targetFluidHandler = new BucketPickupHandlerWrapper((IBucketPickupHandler) block, worldIn, pos);\n+        }\n+        else\n+        {\n+            Optional<IFluidHandler> fluidHandler = getFluidHandler(worldIn, pos, side).resolve();\n+            if (!fluidHandler.isPresent())\n             {\n-                return tryFillContainer(emptyContainer, targetFluidHandler, Integer.MAX_VALUE, playerIn, true);\n+                return FluidActionResult.FAILURE;\n             }\n+            targetFluidHandler = fluidHandler.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eba911b9ab43c697fafa72908a83ab9bd19c20"}, "originalPosition": 64}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5eba911b9ab43c697fafa72908a83ab9bd19c20", "author": {"user": {"login": "pupnewfster", "name": "Sara Freimer"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/c5eba911b9ab43c697fafa72908a83ab9bd19c20", "committedDate": "2020-10-18T19:27:19Z", "message": "Fix a few FluidUtil issues that were causing DispenseFluidContainer to not function properly"}, "afterCommit": {"oid": "a1569479085213c4004a5126f99a31335b92cfb9", "author": {"user": {"login": "pupnewfster", "name": "Sara Freimer"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/a1569479085213c4004a5126f99a31335b92cfb9", "committedDate": "2020-10-29T00:45:36Z", "message": "Rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "682cbe37aa83835b922e044b82f3ed88d994a0fe", "author": {"user": {"login": "pupnewfster", "name": "Sara Freimer"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/682cbe37aa83835b922e044b82f3ed88d994a0fe", "committedDate": "2020-11-24T17:35:29Z", "message": "Fix a few FluidUtil issues that were causing DispenseFluidContainer to not function properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bc7547aabcbd485e06bff27f54ee113f674a600", "author": {"user": {"login": "pupnewfster", "name": "Sara Freimer"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/0bc7547aabcbd485e06bff27f54ee113f674a600", "committedDate": "2020-11-24T17:35:29Z", "message": "Rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1569479085213c4004a5126f99a31335b92cfb9", "author": {"user": {"login": "pupnewfster", "name": "Sara Freimer"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/a1569479085213c4004a5126f99a31335b92cfb9", "committedDate": "2020-10-29T00:45:36Z", "message": "Rebase"}, "afterCommit": {"oid": "0bc7547aabcbd485e06bff27f54ee113f674a600", "author": {"user": {"login": "pupnewfster", "name": "Sara Freimer"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/0bc7547aabcbd485e06bff27f54ee113f674a600", "committedDate": "2020-11-24T17:35:29Z", "message": "Rebase"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2345, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}