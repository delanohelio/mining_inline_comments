{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwOTE1MTEz", "number": 6858, "title": "[1.16] Replace EntityHeight event with EntitySize event", "bodyText": "1.16 version of #6369\nFor the reasoning see: #6059\nThis PR replaces the existing EntityEvent#Height with a EntityEvent#Size which allows modifying the entity size in addition to the eye height. This is binary breaking.\nI personally only need to modify the player size, but as the existing Height event is posted for all entities, this system is therefore available for all entities.\nIf needed, I can commit a small test mod.\n\n  Very basic test code\n@Mod(\"player_size_test\")\npublic class PlayerSizeTest\n{\n    public PlayerSizeTest(){\n        MinecraftForge.EVENT_BUS.register(this);\n    }\n\n\n    @SubscribeEvent\n    public void onEntitySize(EntityEvent.Size event){\n        if(event.getEntity() instanceof PlayerEntity){\n            if(((PlayerEntity) event.getEntity()).inventory !=null && ((PlayerEntity) event.getEntity()).getHeldItemMainhand().getItem() == Items.STICK){\n                event.setNewSize(EntitySize.fixed(0.2f,0.2f));\n                event.setNewEyeHeight(0.15f);\n                ((PlayerEntity) event.getEntity()).setForcedPose(Pose.STANDING); //In theory only necessary once\n            }\n            else{\n                ((PlayerEntity) event.getEntity()).setForcedPose(null); //In theory only necessary once\n            }\n        }\n    }\n\n}\n\nThis simple changes the player's size and pose while holding a stick (have to sneak to update the size here)\nIf adding a proper test mod, I would write something more suitable.", "createdAt": "2020-06-27T13:56:12Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858", "merged": true, "mergeCommit": {"oid": "fc000fe913b6d4c2f14476d3df301513f51f6653"}, "closed": true, "closedAt": "2020-08-21T18:53:38Z", "author": {"login": "maxanier"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvYRUvAFqTQzODcwMDE2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAe8a9gBqjM2NzE4Njg3NDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzAwMTY3", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#pullrequestreview-438700167", "createdAt": "2020-06-27T13:57:09Z", "commit": {"oid": "cc727280f8a6a966161d381f7747ea6c0f4ca08b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMzo1NzoxMFrOGp1_Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMzo1NzoxMFrOGp1_Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTMzOQ==", "bodyText": "I am not sure about this part.\nThe old eyeHeight method was placed in the constructor as well, so I kept it here.\nHowever, I do not think this is ideal. If mods decide to change an entity's size/eyeHeight, they need something to base their decision upon. But at this point during entity construction neither capabilities nor held items nor anything else is available.\nThis means a) the event handler has to check if the entity is properly constructed and b) the mod has to trigger a size update anyway.\nOnly scenario this might be useful might be a mod which e.g. simply scales all cows to 200%. But that could also be done without the constructor patch, by just calling recalculateSize in EntityJoinWorld.\nTherefore, I would suggest removing this ugly patch, making it much easier to use.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#discussion_r446529339", "createdAt": "2020-06-27T13:57:10Z", "author": {"login": "maxanier"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -31,18 +31,20 @@\n        this.field_200606_g = p_i48580_1_;\n        this.field_70170_p = p_i48580_2_;\n        this.field_213325_aI = p_i48580_1_.func_220334_j();\n-@@ -213,7 +216,9 @@\n+@@ -213,7 +216,11 @@\n        this.field_70180_af.func_187214_a(field_189655_aD, false);\n        this.field_70180_af.func_187214_a(field_213330_X, Pose.STANDING);\n        this.func_70088_a();\n -      this.field_213326_aJ = this.func_213316_a(Pose.STANDING, this.field_213325_aI);\n-+      this.field_213326_aJ = getEyeHeightForge(Pose.STANDING, this.field_213325_aI);\n++      net.minecraftforge.event.entity.EntityEvent.Size sizeEvent= getSizeForge(Pose.STANDING, this.field_213325_aI);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc727280f8a6a966161d381f7747ea6c0f4ca08b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzYyMDM0", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#pullrequestreview-438762034", "createdAt": "2020-06-28T09:24:10Z", "commit": {"oid": "cc727280f8a6a966161d381f7747ea6c0f4ca08b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOToyNDoxMFrOGp73vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOToyNDoxMFrOGp73vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYyNTcyNA==", "bodyText": "I think you can add a few newlines to make this patch more readable", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#discussion_r446625724", "createdAt": "2020-06-28T09:24:10Z", "author": {"login": "ichttt"}, "path": "patches/minecraft/net/minecraft/entity/player/PlayerEntity.java.patch", "diffHunk": "@@ -43,23 +44,31 @@\n              this.func_225652_a_(false, true);\n           }\n        } else if (this.field_71076_b > 0) {\n-@@ -258,6 +262,7 @@\n+@@ -258,6 +263,7 @@\n        this.func_203041_m();\n        this.field_184832_bU.func_185144_a();\n        this.func_213832_dB();\n +      net.minecraftforge.fml.hooks.BasicEventHooks.onPlayerPostTick(this);\n     }\n  \n     public boolean func_226563_dT_() {\n-@@ -550,6 +555,7 @@\n+@@ -333,6 +339,7 @@\n+    }\n+ \n+    protected void func_213832_dB() {\n++      if(forcedPose!=null){this.func_213301_b(forcedPose);return;}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc727280f8a6a966161d381f7747ea6c0f4ca08b"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDUyMDU1", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#pullrequestreview-439452055", "createdAt": "2020-06-29T19:51:50Z", "commit": {"oid": "08c30d81f7e58d6404588fa299efc5f8d16ac188"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOTo1MTo1MFrOGqfz0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOTo1NjozMlrOGqf-bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIxNDU0Ng==", "bodyText": "The issue is that we have to have SOME default value in the constructor or somewhere that is always called before any other methods in the entity is called because eyeHeight needs to be a sane value until the next time resize is called.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#discussion_r447214546", "createdAt": "2020-06-29T19:51:50Z", "author": {"login": "LexManos"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -31,18 +31,20 @@\n        this.field_200606_g = p_i48580_1_;\n        this.field_70170_p = p_i48580_2_;\n        this.field_213325_aI = p_i48580_1_.func_220334_j();\n-@@ -213,7 +216,9 @@\n+@@ -213,7 +216,11 @@\n        this.field_70180_af.func_187214_a(field_189655_aD, false);\n        this.field_70180_af.func_187214_a(field_213330_X, Pose.STANDING);\n        this.func_70088_a();\n -      this.field_213326_aJ = this.func_213316_a(Pose.STANDING, this.field_213325_aI);\n-+      this.field_213326_aJ = getEyeHeightForge(Pose.STANDING, this.field_213325_aI);\n++      net.minecraftforge.event.entity.EntityEvent.Size sizeEvent= getSizeForge(Pose.STANDING, this.field_213325_aI);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTMzOQ=="}, "originalCommit": {"oid": "cc727280f8a6a966161d381f7747ea6c0f4ca08b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIxNjcwMw==", "bodyText": "honestly all of this should move to ForgeHooks/ForgeEvenntFadctory like all the other events instead of being special.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#discussion_r447216703", "createdAt": "2020-06-29T19:55:31Z", "author": {"login": "LexManos"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -310,9 +316,9 @@\n +      this.reviveCaps();\n +   }\n +\n-+   private float getEyeHeightForge(Pose pose, EntitySize size) {\n-+      net.minecraftforge.event.entity.EntityEvent.EyeHeight evt = new net.minecraftforge.event.entity.EntityEvent.EyeHeight(this, pose, size, this.func_213316_a(pose, size));\n++   private net.minecraftforge.event.entity.EntityEvent.Size getSizeForge(Pose pose, EntitySize size) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08c30d81f7e58d6404588fa299efc5f8d16ac188"}, "originalPosition": 226}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIxNzI2MA==", "bodyText": "Why is this being forced at all? The data manager already syncs the pose, why add some backdoor to bypass it?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#discussion_r447217260", "createdAt": "2020-06-29T19:56:32Z", "author": {"login": "LexManos"}, "path": "patches/minecraft/net/minecraft/entity/player/PlayerEntity.java.patch", "diffHunk": "@@ -336,5 +348,9 @@\n +         else if (facing.func_176740_k().func_176722_c()) return playerEquipmentHandler.cast();\n +      }\n +      return super.getCapability(capability, facing);\n++   }\n++\n++   public void setForcedPose(@Nullable Pose pose) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08c30d81f7e58d6404588fa299efc5f8d16ac188"}, "originalPosition": 289}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMjU1MDQ5", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#pullrequestreview-442255049", "createdAt": "2020-07-03T08:52:07Z", "commit": {"oid": "78038dc78253a0f04e2389c7fb8c90fd4fff5915"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODo1MjowN1rOGspBJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODo1MjowN1rOGspBJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2MjU2Nw==", "bodyText": "You don't need to use fully qualified names here, just use EntityEvent.Size instead of net.minecraftforge.event.entity.EntityEvent.Size. Same in the line below", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6858#discussion_r449462567", "createdAt": "2020-07-03T08:52:07Z", "author": {"login": "ichttt"}, "path": "src/main/java/net/minecraftforge/event/ForgeEventFactory.java", "diffHunk": "@@ -722,4 +724,11 @@ public static long onSleepFinished(ServerWorld world, long newTime, long minTime\n         MinecraftForge.EVENT_BUS.post(event);\n         return event.getNewTime();\n     }\n+\n+    public static net.minecraftforge.event.entity.EntityEvent.Size getEntitySizeForge(Entity player, Pose pose, EntitySize size, float eyeHeight)\n+    {\n+        net.minecraftforge.event.entity.EntityEvent.Size evt = new net.minecraftforge.event.entity.EntityEvent.Size(player, pose, size, eyeHeight);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78038dc78253a0f04e2389c7fb8c90fd4fff5915"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba5099f1e5f5906ec3cec36075df82b5ec0042f9", "author": {"user": {"login": "maxanier", "name": "Max Becker"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ba5099f1e5f5906ec3cec36075df82b5ec0042f9", "committedDate": "2020-07-05T10:39:41Z", "message": "Remove fully qualified name"}, "afterCommit": {"oid": "ca70e400198d83d221bc845b92b4cad26f24e77f", "author": {"user": {"login": "maxanier", "name": "Max Becker"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ca70e400198d83d221bc845b92b4cad26f24e77f", "committedDate": "2020-08-02T11:55:42Z", "message": "Consider vanilla pose"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7becd2416b6bb7878c79e07b78d1f20d29408790", "author": {"user": {"login": "maxanier", "name": "Max Becker"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7becd2416b6bb7878c79e07b78d1f20d29408790", "committedDate": "2020-08-19T17:19:11Z", "message": "Add patches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f4e32fac03bd63dbd5b8a88390d11c4998213ab", "author": {"user": {"login": "maxanier", "name": "Max Becker"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4f4e32fac03bd63dbd5b8a88390d11c4998213ab", "committedDate": "2020-08-19T17:19:22Z", "message": "Add event"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca70e400198d83d221bc845b92b4cad26f24e77f", "author": {"user": {"login": "maxanier", "name": "Max Becker"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ca70e400198d83d221bc845b92b4cad26f24e77f", "committedDate": "2020-08-02T11:55:42Z", "message": "Consider vanilla pose"}, "afterCommit": {"oid": "4f4e32fac03bd63dbd5b8a88390d11c4998213ab", "author": {"user": {"login": "maxanier", "name": "Max Becker"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4f4e32fac03bd63dbd5b8a88390d11c4998213ab", "committedDate": "2020-08-19T17:19:22Z", "message": "Add event"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1989, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}