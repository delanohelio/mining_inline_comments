{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3ODQzOTM3", "number": 6960, "title": "Add dataprovider for Global Loot Modifiers", "bodyText": "Added a provider to manage GLM datagen. Also incorporated it in the test mod and verified that the output was the same as the pre-existing files.", "createdAt": "2020-07-12T03:05:09Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6960", "merged": true, "mergeCommit": {"oid": "edf41bda191337c5986499370371806d8ca86a50"}, "closed": true, "closedAt": "2020-09-08T19:11:09Z", "author": {"login": "Cyborgmas"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0DirMAH2gAyNDQ3ODQzOTM3OjA1NzM4ZDY1OTM2NmQ1YjBiZGY2ZjQ0YTk1ZGYyNWI2YTlkYzExMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_nqPmgH2gAyNDQ3ODQzOTM3OjY0YWIzNzMyMjU1ODdmYzdlZWZjZGZkYjg5ODA5OTdjMTIzZWIwOGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05738d659366d5b0bdf6f44a95df25b6a9dc112a", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/05738d659366d5b0bdf6f44a95df25b6a9dc112a", "committedDate": "2020-07-12T02:37:44Z", "message": "add datagen for GLM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d536760c5a9dd7c803a8999c5e6c6d6db327519", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/8d536760c5a9dd7c803a8999c5e6c6d6db327519", "committedDate": "2020-07-12T03:00:13Z", "message": "small fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODU5MjUx", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6960#pullrequestreview-446859251", "createdAt": "2020-07-12T08:52:15Z", "commit": {"oid": "8d536760c5a9dd7c803a8999c5e6c6d6db327519"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQwODo1MjoxNVrOGwSiog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQwODo1MjoxNVrOGwSiog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI4ODYxMA==", "bodyText": "You should add a space after \"Modifiers\" because \"modid\" would stick on it.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6960#discussion_r453288610", "createdAt": "2020-07-12T08:52:15Z", "author": {"login": "MelanX"}, "path": "src/main/java/net/minecraftforge/common/data/GlobalLootModifierProvider.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package net.minecraftforge.common.data;\n+\n+import com.google.common.collect.Lists;\n+import com.google.gson.*;\n+import cpw.mods.modlauncher.api.LamdbaExceptionUtils;\n+import net.minecraft.data.DataGenerator;\n+import net.minecraft.data.DirectoryCache;\n+import net.minecraft.data.IDataProvider;\n+import net.minecraft.loot.conditions.ILootCondition;\n+import net.minecraft.loot.conditions.LootConditionManager;\n+import net.minecraft.loot.functions.ILootFunction;\n+import net.minecraft.loot.functions.LootFunctionManager;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.Tuple;\n+import net.minecraftforge.common.loot.GlobalLootModifierSerializer;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import javax.annotation.Nullable;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+\n+public abstract class GlobalLootModifierProvider implements IDataProvider\n+{\n+   private static final Logger LOGGER = LogManager.getLogger();\n+   private static final Gson GSON = (new GsonBuilder()).registerTypeHierarchyAdapter(ILootFunction.class, LootFunctionManager.func_237450_a_()).registerTypeHierarchyAdapter(ILootCondition.class, LootConditionManager.func_237474_a_()).setPrettyPrinting().create();\n+   private final DataGenerator gen;\n+   private final String modid;\n+   private final Map<String, Tuple<GlobalLootModifierSerializer<?>, List<ILootCondition>>> modifiers = new HashMap<>();\n+   private final Map<String, Consumer<JsonObject>> extraProperties = new HashMap<>();\n+   private boolean replace = false;\n+\n+   public GlobalLootModifierProvider(DataGenerator gen, String modid)\n+   {\n+      this.gen = gen;\n+      this.modid = modid;\n+   }\n+\n+   protected void replacing()\n+   {\n+      this.replace = true;\n+   }\n+\n+   /**\n+    * Call {@link #addModifier} here\n+    */\n+   protected abstract void start();\n+\n+   @Override\n+   public void act(DirectoryCache cache) throws IOException\n+   {\n+      start();\n+\n+      Path forge = gen.getOutputFolder().resolve(\"data/forge/loot_modifiers/global_loot_modifiers.json\");\n+      String modpath = \"data/\" + modid + \"/loot_modifiers/\";\n+      List<ResourceLocation> entries = new ArrayList<>();\n+\n+      modifiers.forEach(LamdbaExceptionUtils.rethrowBiConsumer((name, pair) ->\n+      {\n+         entries.add(new ResourceLocation(modid, name));\n+         Path modifierPath = gen.getOutputFolder().resolve(modpath + name + \".json\");\n+\n+         JsonObject json = new JsonObject();\n+         json.addProperty(\"type\", pair.getA().getRegistryName().toString());\n+         JsonArray conditions = new JsonArray();\n+         pair.getB().forEach(cond -> conditions.add(GSON.toJsonTree(cond)));\n+         json.add(\"conditions\", conditions);\n+\n+         Consumer<JsonObject> properties = extraProperties.get(name);\n+         if(properties != null)\n+            properties.accept(json);\n+\n+         IDataProvider.save(GSON, cache, json, modifierPath);\n+      }));\n+\n+      JsonObject forgeJson = new JsonObject();\n+      forgeJson.addProperty(\"replace\", this.replace);\n+      JsonArray modifiersArray = new JsonArray();\n+      entries.forEach(loc -> modifiersArray.add(loc.toString()));\n+      forgeJson.add(\"entries\", modifiersArray);\n+\n+      IDataProvider.save(GSON, cache, forgeJson, forge);\n+   }\n+\n+   public void addModifier(String modifier, GlobalLootModifierSerializer<?> serializer, List<ILootCondition> conditions)\n+   {\n+      addModifier(modifier, serializer, conditions, null);\n+   }\n+\n+   public void addModifier(String modifier, GlobalLootModifierSerializer<?> serializer, List<ILootCondition> conditions, @Nullable Consumer<JsonObject> extraProperties)\n+   {\n+      this.modifiers.put(modifier, new Tuple<>(serializer, conditions));\n+      this.extraProperties.put(modifier, extraProperties);\n+   }\n+\n+   @Override\n+   public String getName()\n+   {\n+      return \"Global Loot Modifiers\" + modid;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d536760c5a9dd7c803a8999c5e6c6d6db327519"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8804ffce61c93cf4bca5635a14b74c3aaf4483c7", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/8804ffce61c93cf4bca5635a14b74c3aaf4483c7", "committedDate": "2020-07-12T11:25:58Z", "message": "Fix getName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "419f0e7f6aa704d98220cd6354e46fd2d3c16186", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/419f0e7f6aa704d98220cd6354e46fd2d3c16186", "committedDate": "2020-07-12T14:07:31Z", "message": "Use the new ConditionArraySerializer for conditions array instead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d01e9dcd4b43722cf43f511ad60eb090c26e1514", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/d01e9dcd4b43722cf43f511ad60eb090c26e1514", "committedDate": "2020-07-12T14:17:51Z", "message": "cleaner json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36450bd43eb092fc75fa76098a6de6d7b8f6b73b", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/36450bd43eb092fc75fa76098a6de6d7b8f6b73b", "committedDate": "2020-07-12T14:18:11Z", "message": "Merge remote-tracking branch 'origin/GLM-datagen' into GLM-datagen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNDUxMjc4", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6960#pullrequestreview-451451278", "createdAt": "2020-07-20T09:39:27Z", "commit": {"oid": "36450bd43eb092fc75fa76098a6de6d7b8f6b73b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTozOToyN1rOG0C4pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTozOToyN1rOG0C4pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIyNjQwNg==", "bodyText": "In Forge code we use 4 spaces for indentation, not 3", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6960#discussion_r457226406", "createdAt": "2020-07-20T09:39:27Z", "author": {"login": "ichttt"}, "path": "src/main/java/net/minecraftforge/common/data/GlobalLootModifierProvider.java", "diffHunk": "@@ -0,0 +1,104 @@\n+package net.minecraftforge.common.data;\n+\n+import com.google.common.collect.Lists;\n+import com.google.gson.*;\n+import cpw.mods.modlauncher.api.LamdbaExceptionUtils;\n+import net.minecraft.data.DataGenerator;\n+import net.minecraft.data.DirectoryCache;\n+import net.minecraft.data.IDataProvider;\n+import net.minecraft.loot.ConditionArraySerializer;\n+import net.minecraft.loot.conditions.ILootCondition;\n+import net.minecraft.loot.conditions.LootConditionManager;\n+import net.minecraft.loot.functions.ILootFunction;\n+import net.minecraft.loot.functions.LootFunctionManager;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.Tuple;\n+import net.minecraftforge.common.loot.GlobalLootModifierSerializer;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import javax.annotation.Nullable;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+\n+public abstract class GlobalLootModifierProvider implements IDataProvider\n+{\n+   private static final Logger LOGGER = LogManager.getLogger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36450bd43eb092fc75fa76098a6de6d7b8f6b73b"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15f6bb292e6f29599c47780df0528a491af90ca5", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/15f6bb292e6f29599c47780df0528a491af90ca5", "committedDate": "2020-07-20T12:55:56Z", "message": "proper indent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed678991d97e71ac7338917a06e37938c2b57a6a", "author": {"user": {"login": "LexManos", "name": "LexManos"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ed678991d97e71ac7338917a06e37938c2b57a6a", "committedDate": "2020-07-27T20:27:53Z", "message": "Update GlobalLootModifierProvider.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e467cd608b430cd240198a8984639214cf9641b", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1e467cd608b430cd240198a8984639214cf9641b", "committedDate": "2020-07-27T22:59:59Z", "message": "add javadocs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a909d053a03a48f0c46db522e62c852b12bec56", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/8a909d053a03a48f0c46db522e62c852b12bec56", "committedDate": "2020-07-27T23:05:21Z", "message": "Disabled the test mod."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff76450fc236b530ad158df56024eb2ec69e21a6", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ff76450fc236b530ad158df56024eb2ec69e21a6", "committedDate": "2020-08-17T00:44:38Z", "message": "Add a write function to the serializer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ab373225587fc7eefcdfdb8980997c123eb08a", "author": {"user": {"login": "Cyborgmas", "name": "Cyborgmas"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/64ab373225587fc7eefcdfdb8980997c123eb08a", "committedDate": "2020-08-17T00:55:45Z", "message": "new gen"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2035, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}