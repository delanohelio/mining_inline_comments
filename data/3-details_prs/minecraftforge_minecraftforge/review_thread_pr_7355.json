{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyODYxMjMx", "number": 7355, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowMjo1MlrOEnWelQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODozNjo0NVrOEo7YaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5Njk4MTk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/net/minecraftforge/event/entity/player/PlayerEvent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowMjo1MlrOHX5PEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowMjo1MlrOHX5PEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgxNzA0Mg==", "bodyText": "This \"via\" info makes no sense, the event docs are in need of changes and new events should not follow the existing guides.\nYou should describe when the event fires, not which method is responsible for it.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r494817042", "createdAt": "2020-09-25T08:02:52Z", "author": {"login": "diesieben07"}, "path": "src/main/java/net/minecraftforge/event/entity/player/PlayerEvent.java", "diffHunk": "@@ -510,4 +511,30 @@ public PlayerChangedDimensionEvent(PlayerEntity player, RegistryKey<World> fromD\n             return this.toDim;\n         }\n     }\n+\n+    /**\n+     * On the server side fired when any player has their game mode changed via {@link net.minecraft.server.management.PlayerInteractionManager#setGameType(GameType)}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebb014bb4bdec51c165415b8381a66be7015ec85"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5Njk4MjQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/net/minecraftforge/event/entity/player/PlayerEvent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowMzowM1rOHX5Paw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowMzowM1rOHX5Paw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgxNzEzMQ==", "bodyText": "Formatting (braces on newlines)", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r494817131", "createdAt": "2020-09-25T08:03:03Z", "author": {"login": "diesieben07"}, "path": "src/main/java/net/minecraftforge/event/entity/player/PlayerEvent.java", "diffHunk": "@@ -510,4 +511,30 @@ public PlayerChangedDimensionEvent(PlayerEntity player, RegistryKey<World> fromD\n             return this.toDim;\n         }\n     }\n+\n+    /**\n+     * On the server side fired when any player has their game mode changed via {@link net.minecraft.server.management.PlayerInteractionManager#setGameType(GameType)}.\n+     * On the client side fired when only when the client player changes their game mode.\n+     */\n+    public static class PlayerChangeGameModeEvent extends PlayerEvent {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebb014bb4bdec51c165415b8381a66be7015ec85"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NzAwNjUzOnYy", "diffSide": "RIGHT", "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowOTo1OFrOHX5dvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowOTo1OFrOHX5dvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyMDc5OQ==", "bodyText": "Formatting (don't change indentation)\nExtract this logic into the ForgeHooks method, that's what its there for. You can have this be a much simpler patch by doing:\nthis.gameType = ForgeHooks.onClientChangeGameType(gameMode, this.gameType, ...)", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r494820799", "createdAt": "2020-09-25T08:09:58Z", "author": {"login": "diesieben07"}, "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "diffHunk": "@@ -0,0 +1,13 @@\n+--- a/net/minecraft/client/network/play/NetworkPlayerInfo.java\n++++ b/net/minecraft/client/network/play/NetworkPlayerInfo.java\n+@@ -50,7 +50,9 @@\n+    }\n+ \n+    protected void func_178839_a(GameType p_178839_1_) {\n+-      this.field_178866_b = p_178839_1_;\n++       GameType oldGameType = this.field_178866_b;\n++       this.field_178866_b = p_178839_1_;\n++       if(Minecraft.func_71410_x().field_71439_g != null && this.field_178867_a.getId().equals(Minecraft.func_71410_x().field_71439_g.func_110124_au())) net.minecraftforge.common.ForgeHooks.onChangeGameMode(Minecraft.func_71410_x().field_71439_g, p_178839_1_, oldGameType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebb014bb4bdec51c165415b8381a66be7015ec85"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTk1MDM0OnYy", "diffSide": "RIGHT", "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMDoxMzo0NlrOHYmVuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxODo1NTowMVrOHYpOtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1NjAyNQ==", "bodyText": "Indentation still wrong. Also missing space after if.\nAlso, my point of separating client and server event was so that you can fire the event on the client always, by not including the PlayerEntity.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r495556025", "createdAt": "2020-09-27T10:13:46Z", "author": {"login": "diesieben07"}, "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "diffHunk": "@@ -0,0 +1,12 @@\n+--- a/net/minecraft/client/network/play/NetworkPlayerInfo.java\n++++ b/net/minecraft/client/network/play/NetworkPlayerInfo.java\n+@@ -50,7 +50,8 @@\n+    }\n+ \n+    protected void func_178839_a(GameType p_178839_1_) {\n+-      this.field_178866_b = p_178839_1_;\n++       if(Minecraft.func_71410_x().field_71439_g != null && this.field_178867_a.getId().equals(Minecraft.func_71410_x().field_71439_g.func_110124_au()) && this.field_178866_b != p_178839_1_) net.minecraftforge.common.ForgeHooks.onClientChangeGameMode(Minecraft.func_71410_x().field_71439_g, this.field_178866_b, p_178839_1_);\n++       this.field_178866_b = p_178839_1_;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f68aa0807902497bfa3199aac56488c33ad55a5f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5OTg1NA==", "bodyText": "When the event is fired client side without the player check there are two problems:\n\nThe event is fired for all other tracked players of the local client. If a player is too far away it won't be fired.\nOut of the tracked players only the ones not in spectator are fired. If another player comes out of spectator mode the local client won't know about the change and the event is not fired.\nSometimes neither of these conditions are met and the event still fires.\nA reliable alternative is to just have the mod send a packet to the client about their mod specific status updates. Because the server knows about all players, the mod dev can control the scope of the event.\n\nBy adding the player, the goal is to add consistent results for when the event is fired.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r495599854", "createdAt": "2020-09-27T18:16:56Z", "author": {"login": "Ocelot5836"}, "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "diffHunk": "@@ -0,0 +1,12 @@\n+--- a/net/minecraft/client/network/play/NetworkPlayerInfo.java\n++++ b/net/minecraft/client/network/play/NetworkPlayerInfo.java\n+@@ -50,7 +50,8 @@\n+    }\n+ \n+    protected void func_178839_a(GameType p_178839_1_) {\n+-      this.field_178866_b = p_178839_1_;\n++       if(Minecraft.func_71410_x().field_71439_g != null && this.field_178867_a.getId().equals(Minecraft.func_71410_x().field_71439_g.func_110124_au()) && this.field_178866_b != p_178839_1_) net.minecraftforge.common.ForgeHooks.onClientChangeGameMode(Minecraft.func_71410_x().field_71439_g, this.field_178866_b, p_178839_1_);\n++       this.field_178866_b = p_178839_1_;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1NjAyNQ=="}, "originalCommit": {"oid": "f68aa0807902497bfa3199aac56488c33ad55a5f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYwMDg3Nw==", "bodyText": "That is not true. The packet is sent to all players.\nHave you actually verified these claims you are making?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r495600877", "createdAt": "2020-09-27T18:28:44Z", "author": {"login": "diesieben07"}, "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "diffHunk": "@@ -0,0 +1,12 @@\n+--- a/net/minecraft/client/network/play/NetworkPlayerInfo.java\n++++ b/net/minecraft/client/network/play/NetworkPlayerInfo.java\n+@@ -50,7 +50,8 @@\n+    }\n+ \n+    protected void func_178839_a(GameType p_178839_1_) {\n+-      this.field_178866_b = p_178839_1_;\n++       if(Minecraft.func_71410_x().field_71439_g != null && this.field_178867_a.getId().equals(Minecraft.func_71410_x().field_71439_g.func_110124_au()) && this.field_178866_b != p_178839_1_) net.minecraftforge.common.ForgeHooks.onClientChangeGameMode(Minecraft.func_71410_x().field_71439_g, this.field_178866_b, p_178839_1_);\n++       this.field_178866_b = p_178839_1_;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1NjAyNQ=="}, "originalCommit": {"oid": "f68aa0807902497bfa3199aac56488c33ad55a5f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYwMzM4Mw==", "bodyText": "I just redid me experiment and found different results. I think it may have been due to poor placement of one of the patches but my claims are not true. All players are always notified of all game mode changes, even for players they have never or currently cannot see.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r495603383", "createdAt": "2020-09-27T18:55:01Z", "author": {"login": "Ocelot5836"}, "path": "patches/minecraft/net/minecraft/client/network/play/NetworkPlayerInfo.java.patch", "diffHunk": "@@ -0,0 +1,12 @@\n+--- a/net/minecraft/client/network/play/NetworkPlayerInfo.java\n++++ b/net/minecraft/client/network/play/NetworkPlayerInfo.java\n+@@ -50,7 +50,8 @@\n+    }\n+ \n+    protected void func_178839_a(GameType p_178839_1_) {\n+-      this.field_178866_b = p_178839_1_;\n++       if(Minecraft.func_71410_x().field_71439_g != null && this.field_178867_a.getId().equals(Minecraft.func_71410_x().field_71439_g.func_110124_au()) && this.field_178866_b != p_178839_1_) net.minecraftforge.common.ForgeHooks.onClientChangeGameMode(Minecraft.func_71410_x().field_71439_g, this.field_178866_b, p_178839_1_);\n++       this.field_178866_b = p_178839_1_;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1NjAyNQ=="}, "originalCommit": {"oid": "f68aa0807902497bfa3199aac56488c33ad55a5f"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTk1MDQzOnYy", "diffSide": "RIGHT", "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMDoxNDowMlrOHYmVxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMDoxNDowMlrOHYmVxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1NjAzOQ==", "bodyText": "Formatting, space after if.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r495556039", "createdAt": "2020-09-27T10:14:02Z", "author": {"login": "diesieben07"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -130,15 +130,23 @@\n     }\n  \n     protected void func_70670_a(EffectInstance p_70670_1_) {\n-@@ -1187,6 +1208,7 @@\n+@@ -1139,6 +1160,7 @@\n+    }\n+ \n+    public void func_71033_a(GameType p_71033_1_) {\n++      if(!net.minecraftforge.common.ForgeHooks.onChangeGameMode(this, this.field_71134_c.func_73081_b(), p_71033_1_)) return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f68aa0807902497bfa3199aac56488c33ad55a5f"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTk1MTUxOnYy", "diffSide": "RIGHT", "path": "src/main/java/net/minecraftforge/event/entity/player/PlayerEvent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMDoxNTowNlrOHYmWQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMDoxNTowNlrOHYmWQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1NjE2Mg==", "bodyText": "I have no idea what you mean to say with this sentence. \"changed to a unique value\"? And what listeners are you talking about?\nYou also need to add a note about what happens when the event is cancelled.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r495556162", "createdAt": "2020-09-27T10:15:06Z", "author": {"login": "diesieben07"}, "path": "src/main/java/net/minecraftforge/event/entity/player/PlayerEvent.java", "diffHunk": "@@ -510,4 +511,65 @@ public PlayerChangedDimensionEvent(PlayerEntity player, RegistryKey<World> fromD\n             return this.toDim;\n         }\n     }\n+\n+    /**\n+     * Fired when the game type of a server player is changed to a unique value before listeners are fired.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f68aa0807902497bfa3199aac56488c33ad55a5f"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzUxNDAwOnYy", "diffSide": "RIGHT", "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODozNjo0NVrOHaTHgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODozNjo0NVrOHaTHgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMzODI0Mw==", "bodyText": "You have not fixed this.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7355#discussion_r497338243", "createdAt": "2020-09-30T08:36:45Z", "author": {"login": "diesieben07"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -130,15 +130,23 @@\n     }\n  \n     protected void func_70670_a(EffectInstance p_70670_1_) {\n-@@ -1187,6 +1208,7 @@\n+@@ -1139,6 +1160,7 @@\n+    }\n+ \n+    public void func_71033_a(GameType p_71033_1_) {\n++      if(!net.minecraftforge.common.ForgeHooks.onChangeGameMode(this, this.field_71134_c.func_73081_b(), p_71033_1_)) return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf1c50c10031a0fc5666b61f96b6a2306e1d13be"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 820, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}