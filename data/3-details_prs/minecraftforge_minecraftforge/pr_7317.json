{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzNTE0NTU1", "number": 7317, "title": "[1.16.3] Extended ITeleporter Interface", "bodyText": "This PR aims to expand the functionality of the ITeleporter interface and make it possible to use your own in Entity.changeDimension. The previous issues with changeDimension were related to the ITeleporter not being passed into methods that interacted with it, and instead inconsistently using the vanilla one. To fix this, a couple of methods have been modified to have a default version and a modded teleporter safe version. To accompany this, the ITeleporter interface gained methods for finding and placing a portal (or whatever applies given the mod).\nTo take use of this new system, all that needs to be done is calling Entity.changeDimension(ServerWorld, ITeleporter). In the past, you would have to store, replace, and then restore the old default teleporter. That is no longer required.\nWithin the repository is a new test mod under net.minecraftforge.debug.world.TeleporterTest. To use the test mod, set a \"teleporter_test:red_teleporter\" or a \"teleporter_test:blue_teleporter\". Landing on these will cause them to teleport you to their respective \"red\" and \"blue\" dimensions. The \"red\" dimension is scaled the same as the nether while \"blue\" is 1 to 1.", "createdAt": "2020-09-10T08:06:40Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317", "merged": true, "mergeCommit": {"oid": "8536521b7b4d4543fc3906c2fc2b5b7f2deabb94"}, "closed": true, "closedAt": "2020-10-16T19:09:54Z", "author": {"login": "SilverDavidMC"}, "timelineItems": {"totalCount": 63, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHbzqJAH2gAyNDgzNTE0NTU1OjUxM2U5NmFkNGI5NzdjYjQ5MGYwY2Y3N2M5ZGZiYjllOWEyNTgwMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTLG8OAH2gAyNDgzNTE0NTU1OmVlOGE2ODI1Y2I3NWVhNTQ2ZTFiNjA4NzUzYmQxMGJjYzAwNDQwNDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "513e96ad4b977cb490f0cf77c9dfbb9e9a258003", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/513e96ad4b977cb490f0cf77c9dfbb9e9a258003", "committedDate": "2020-09-10T07:38:34Z", "message": "Extended ITeleporter interface"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTE3NDk3", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-485917497", "createdAt": "2020-09-10T13:16:25Z", "commit": {"oid": "513e96ad4b977cb490f0cf77c9dfbb9e9a258003"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzoxNjoyNVrOHPzDDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzoxNjoyNVrOHPzDDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMyNzA1NQ==", "bodyText": "This method should have a proper name and be added to the forge.exc file so that the ServerWorld param can be properly remapped.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r486327055", "createdAt": "2020-09-10T13:16:25Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -262,7 +261,29 @@\n           }\n        } else {\n           return null;\n-@@ -2320,9 +2357,10 @@\n+@@ -2123,14 +2160,19 @@\n+       this.field_70128_L = true;\n+    }\n+ \n+-   @Nullable\n++   @Nullable @Deprecated // Use ITeleporter safe version\n+    protected PortalInfo func_241829_a(ServerWorld p_241829_1_) {\n++      return this.func_241829_a(p_241829_1_, p_241829_1_.func_85176_s());\n++   }\n++\n++   @Nullable\n++   protected PortalInfo func_241829_a(ServerWorld p_241829_1_, net.minecraftforge.common.util.ITeleporter teleporter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "513e96ad4b977cb490f0cf77c9dfbb9e9a258003"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87228bebdbd5b2fa9eb240ffc406fae1777f68fb", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/87228bebdbd5b2fa9eb240ffc406fae1777f68fb", "committedDate": "2020-09-10T19:23:34Z", "message": "Updated forge.exc with mappings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87e8a615dc2f4952385706df716a6ce1340b981d", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/87e8a615dc2f4952385706df716a6ce1340b981d", "committedDate": "2020-09-10T19:27:40Z", "message": "Mapped func_241829_a(ServerWorld, ITeleporter) in Entity and ServerPlayerEntity to getPortalInfo(ServerWorld, ITeleporter)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85b6d228bbe0944a244b23c725824f43d93974c7", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/85b6d228bbe0944a244b23c725824f43d93974c7", "committedDate": "2020-09-21T11:58:42Z", "message": "Merge remote-tracking branch 'upstream/1.16.x' into testiteleporterchanges\n\n# Conflicts:\n#\tsrc/test/resources/META-INF/mods.toml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f938a645fb3083a09b7743e54a11cdd0ae2d40c", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/9f938a645fb3083a09b7743e54a11cdd0ae2d40c", "committedDate": "2020-09-21T13:07:35Z", "message": "fixed modded teleporters not being able to control their own teleports depending on the dimensions being teleported to and from\n\ne.g. modded teleporters could not control their own teleports from the overworld to the end"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26bb9bc10e5f6a27a29928628e3f021794bd3c7b", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/26bb9bc10e5f6a27a29928628e3f021794bd3c7b", "committedDate": "2020-09-21T13:36:17Z", "message": "actually/finish fixing teleports involving vanilla dimensions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e325f0c160089641b148800c5dbb8fd4d102673", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1e325f0c160089641b148800c5dbb8fd4d102673", "committedDate": "2020-09-22T00:24:33Z", "message": "Merge pull request #1 from mrp-v2/testiteleporterchanges\n\nMerge from upstream and fix teleporters not being able to control some teleports from/to vanilla dimensions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDE4NTI4", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-499418528", "createdAt": "2020-09-30T13:17:40Z", "commit": {"oid": "1e325f0c160089641b148800c5dbb8fd4d102673"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMzoxNzo0MFrOHadD8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMzoxODoyM1rOHadFwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUwMTE2OQ==", "bodyText": "Copying vanilla code should always be avoided if possible. Please check if you can't replace this with a call to the original method if it is a clean copy or patch and call the original method if the change is small enough.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497501169", "createdAt": "2020-09-30T13:17:40Z", "author": {"login": "ichttt"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -58,10 +75,68 @@\n     default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    // States if this teleporter is the vanilla instance\n     default boolean isVanilla()\n     {\n         return getClass() == Teleporter.class;\n     }\n+\n+    // Replicated from the vanilla code for interface implementation. Return an empty optional if no portal was found.\n+    default Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+        PointOfInterestManager pointofinterestmanager = toWorld.getPointOfInterestManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e325f0c160089641b148800c5dbb8fd4d102673"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUwMTYzNA==", "bodyText": "Same here, looks like vanilla copied code, can we remove this copy somehow?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497501634", "createdAt": "2020-09-30T13:18:23Z", "author": {"login": "ichttt"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -58,10 +75,68 @@\n     default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    // States if this teleporter is the vanilla instance\n     default boolean isVanilla()\n     {\n         return getClass() == Teleporter.class;\n     }\n+\n+    // Replicated from the vanilla code for interface implementation. Return an empty optional if no portal was found.\n+    default Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+        PointOfInterestManager pointofinterestmanager = toWorld.getPointOfInterestManager();\n+        int dist = Math.max((int) DimensionType.func_242715_a(fromWorld.func_230315_m_(), toWorld.func_230315_m_()) * 16, 16);\n+        BlockPos pos = this.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec()));\n+        pointofinterestmanager.ensureLoadedAndValid(toWorld, pos, dist);\n+        \n+        Optional<PointOfInterest> optional = pointofinterestmanager.getInSquare((poi) -> \n+        {\n+           return poi == this.getPortalPOI();\n+        }, pos, dist, PointOfInterestManager.Status.ANY).sorted(Comparator.<PointOfInterest>comparingDouble((poi) -> \n+        {\n+           return poi.getPos().distanceSq(pos);\n+        }).thenComparingInt((poi) -> \n+        {\n+           return poi.getPos().getY();\n+        })).findFirst();\n+        \n+        return optional.map((poi) -> \n+        {\n+           BlockPos blockpos = poi.getPos();\n+           toWorld.getChunkProvider().registerTicket(TicketType.PORTAL, new ChunkPos(blockpos), 3, blockpos);\n+           BlockState blockstate = toWorld.getBlockState(blockpos);\n+           return TeleportationRepositioner.func_243676_a(blockpos, entity.getHorizontalFacing().getAxis(), 21, Direction.Axis.Y, 21, (p) -> toWorld.getBlockState(p) == blockstate);\n+        });\n+    }\n+\n+    // Creates a portal if one doesn't exist and returns the result. Default does nothing so you'll need to implement it for your portal.\n+    default Optional<TeleportationRepositioner.Result> createAndGetPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+        return Optional.empty();\n+    }\n+\n+    // Returns the portal info for the result. Default returns the tpResult position and zero values for everything else.\n+    default PortalInfo getPortalInfo(TeleportationRepositioner.Result tpResult)\n+    {\n+        return new PortalInfo(new Vector3d(tpResult.field_243679_a.getX(), tpResult.field_243679_a.getY(), tpResult.field_243679_a.getZ()), Vector3d.ZERO, 0, 0);\n+    }\n+    \n+    // Scales the given blockpos based on the worlds passed in.\n+    default BlockPos getScaledPos(World fromWorld, World toWorld, BlockPos originalPos)\n+    {\n+    \tWorldBorder worldborder = toWorld.getWorldBorder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e325f0c160089641b148800c5dbb8fd4d102673"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc3429b0694d545cbc1885e908cdcc11913feb0c", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/cc3429b0694d545cbc1885e908cdcc11913feb0c", "committedDate": "2020-09-30T14:02:31Z", "message": "fixes ichttt's request to not copy vanilla code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fad15cd0ea3611ce532545ad45b128edba0c70a4", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/fad15cd0ea3611ce532545ad45b128edba0c70a4", "committedDate": "2020-09-30T14:38:03Z", "message": "Merge pull request #3 from mrp-v2/7317\n\nfixes ichttt's request to not copy vanilla code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25dcd05214d3ddfa715b38fb3fd6ee87c960e68f", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/25dcd05214d3ddfa715b38fb3fd6ee87c960e68f", "committedDate": "2020-09-30T15:55:28Z", "message": "refactored ITeleporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3908a906fa120365cda8e59cf9fbfcca0e5ee117", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/3908a906fa120365cda8e59cf9fbfcca0e5ee117", "committedDate": "2020-09-30T16:20:22Z", "message": "more refactoring now that i know super can be used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f43a804bf79a143d60774da928e65a48cccc2519", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/f43a804bf79a143d60774da928e65a48cccc2519", "committedDate": "2020-09-30T16:24:14Z", "message": "formatting and fix accidental javadoc deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0797a2b006151ecb531f698a9875014a4edfd78", "author": {"user": {"login": "mrp-v2", "name": null}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/e0797a2b006151ecb531f698a9875014a4edfd78", "committedDate": "2020-09-30T21:02:16Z", "message": "decreased patch size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d5f06b7847ea6d30a3b69a47049081db62e250e", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7d5f06b7847ea6d30a3b69a47049081db62e250e", "committedDate": "2020-09-30T22:11:46Z", "message": "Merge pull request #4 from mrp-v2/testiteleporterchanges\n\nPull uneccesary methods out of ITeleporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e8321b02c1c6f08141cb96f75035e4c1be80d9d", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1e8321b02c1c6f08141cb96f75035e4c1be80d9d", "committedDate": "2020-09-30T22:17:44Z", "message": "Updated test mod"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7298eee9033ba97e47c89491330821ceab9196c2", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7298eee9033ba97e47c89491330821ceab9196c2", "committedDate": "2020-09-30T22:20:42Z", "message": "Fixed POITeleporter not taking dimension scaling into account"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebe87cc5be8e342d5a11acaef6ea81e493eb2088", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ebe87cc5be8e342d5a11acaef6ea81e493eb2088", "committedDate": "2020-09-30T22:33:27Z", "message": "General cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODYwMTc1", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-499860175", "createdAt": "2020-09-30T22:38:32Z", "commit": {"oid": "7d5f06b7847ea6d30a3b69a47049081db62e250e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMjozODozM1rOHaxuyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMjozODozNlrOHaxu4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgzOTgxOQ==", "bodyText": "This is a breaking change as any mods currently using ITeleporter will not have this method implemented if it is not defaulted.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497839819", "createdAt": "2020-09-30T22:38:33Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,80 @@\n \n package net.minecraftforge.common.util;\n \n-import java.util.function.Function;\n-\n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n-import net.minecraft.world.Teleporter;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.server.ServerWorld;\n \n+import java.util.Optional;\n+import java.util.function.Function;\n+\n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw,\n+            Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;\n+        return false;\n+    }\n+\n+    /**\n+     * Finds a portal to teleport to and creates a {@link TeleportationRepositioner.Result} for it.\n+     * Return an empty {@link Optional} if no portal was found.\n+     */\n+    Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d5f06b7847ea6d30a3b69a47049081db62e250e"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgzOTg0Mg==", "bodyText": "This is a breaking change as any mods currently using ITeleporter will not have this method implemented if it is not defaulted.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497839842", "createdAt": "2020-09-30T22:38:36Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,80 @@\n \n package net.minecraftforge.common.util;\n \n-import java.util.function.Function;\n-\n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n-import net.minecraft.world.Teleporter;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.server.ServerWorld;\n \n+import java.util.Optional;\n+import java.util.function.Function;\n+\n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw,\n+            Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;\n+        return false;\n+    }\n+\n+    /**\n+     * Finds a portal to teleport to and creates a {@link TeleportationRepositioner.Result} for it.\n+     * Return an empty {@link Optional} if no portal was found.\n+     */\n+    Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity);\n+\n+    /**\n+     * Creates a portal if one doesn't exist and returns the {@link TeleportationRepositioner.Result Result}.\n+     */\n+    Optional<TeleportationRepositioner.Result> createAndGetPortal(ServerWorld fromWorld, ServerWorld toWorld,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d5f06b7847ea6d30a3b69a47049081db62e250e"}, "originalPosition": 85}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f7e15c648ac1574d71671b1b5a804a4fe7157dd", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4f7e15c648ac1574d71671b1b5a804a4fe7157dd", "committedDate": "2020-09-30T22:40:16Z", "message": "Added test teleporter items"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODY0OTIy", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-499864922", "createdAt": "2020-09-30T22:50:27Z", "commit": {"oid": "7d5f06b7847ea6d30a3b69a47049081db62e250e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMjo1MDoyOFrOHax-yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMjo1MDoyOFrOHax-yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg0MzkxNQ==", "bodyText": "Why was this changed as it adds an extra line in the patch to Teleporter.java", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497843915", "createdAt": "2020-09-30T22:50:28Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,80 @@\n \n package net.minecraftforge.common.util;\n \n-import java.util.function.Function;\n-\n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n-import net.minecraft.world.Teleporter;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.server.ServerWorld;\n \n+import java.util.Optional;\n+import java.util.function.Function;\n+\n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw,\n+            Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d5f06b7847ea6d30a3b69a47049081db62e250e"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8e866991b9f7d38efe0298dc408586af355726", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4c8e866991b9f7d38efe0298dc408586af355726", "committedDate": "2020-09-30T23:01:44Z", "message": "Fixed some dimension scaling and added comments to TeleporterHelper.getPortalSearchRadius"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8db8e2d91f12e4aceb5462876c80c18864c54016", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/8db8e2d91f12e4aceb5462876c80c18864c54016", "committedDate": "2020-09-30T23:25:06Z", "message": "Updated forge.exc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bc2386fb0d11ef135f43167e5d9ed13b951ab20", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/5bc2386fb0d11ef135f43167e5d9ed13b951ab20", "committedDate": "2020-09-30T23:41:48Z", "message": "Generated patches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fcd1e2a48ace500341619bd9edd17b05a987a8c", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/3fcd1e2a48ace500341619bd9edd17b05a987a8c", "committedDate": "2020-10-01T00:04:01Z", "message": "ITeleporter.findPortal and createAndGetPortal default to calling vanilla methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dbdae0dddbf50f097780bf2f3c6b040d4b0f62c", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1dbdae0dddbf50f097780bf2f3c6b040d4b0f62c", "committedDate": "2020-10-01T00:36:07Z", "message": "Removed getPortalInfo from TeleporterHelper as it's unneeded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb964f3b5d857c4da4c1a3e8a9651e0f8a8e6244", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/bb964f3b5d857c4da4c1a3e8a9651e0f8a8e6244", "committedDate": "2020-10-01T00:36:29Z", "message": "Fixed breaking changes with ITeleporter and adjusted getPortalInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73ae39a58f2e0176b1eb597c137d98a5aff1637", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/b73ae39a58f2e0176b1eb597c137d98a5aff1637", "committedDate": "2020-10-01T00:36:50Z", "message": "Removed IPOITeleporter as it's unneeded."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee930a93a854dfea53afea0b281964396868e350", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ee930a93a854dfea53afea0b281964396868e350", "committedDate": "2020-10-01T00:36:59Z", "message": "Updated forge.exc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5af856baf99024fb5a48d02541c12139f3548f64", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/5af856baf99024fb5a48d02541c12139f3548f64", "committedDate": "2020-10-01T00:40:33Z", "message": "Added more args to ITeleporter.getPortalInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876a4e733bc4a374568617319940794fc717d07f", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/876a4e733bc4a374568617319940794fc717d07f", "committedDate": "2020-10-01T00:44:28Z", "message": "Adjusted getScaledPos in TeleporterHelper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d879ebe3ffeccd0ab0a1cf2520e9f40d260d8cd", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1d879ebe3ffeccd0ab0a1cf2520e9f40d260d8cd", "committedDate": "2020-10-01T01:12:05Z", "message": "Made ITeleporter methods default to using the world.getDefaultTeleporter or the instance itself if it extends Teleporter. Should help with compatibility."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "049c76c7fdc6c2b55d2742c019bd48d9420800b4", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/049c76c7fdc6c2b55d2742c019bd48d9420800b4", "committedDate": "2020-10-01T01:24:09Z", "message": "Gen patches"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTcxODA3", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-499971807", "createdAt": "2020-10-01T02:31:57Z", "commit": {"oid": "049c76c7fdc6c2b55d2742c019bd48d9420800b4"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMjozMTo1OFrOHa4g_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMjozNDoxOVrOHa4i2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk1MDk3Mw==", "bodyText": "If you put the Deprecated and comment on the next line or the previous line then this patch will just be an addition of one line instead of an addition and removal", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497950973", "createdAt": "2020-10-01T02:31:58Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -262,7 +261,24 @@\n           }\n        } else {\n           return null;\n-@@ -2320,9 +2357,10 @@\n+@@ -2123,8 +2160,15 @@\n+       this.field_70128_L = true;\n+    }\n+ \n+-   @Nullable\n++   @Nullable @Deprecated // Use ITeleporter safe version", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "049c76c7fdc6c2b55d2742c019bd48d9420800b4"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk1MTAwMw==", "bodyText": "Same here", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497951003", "createdAt": "2020-10-01T02:32:06Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -8,7 +8,27 @@\n        boolean flag = this.field_70170_p.func_82736_K().func_223586_b(GameRules.field_223609_l);\n        if (flag) {\n           ITextComponent itextcomponent = this.func_110142_aN().func_151521_b();\n-@@ -614,13 +615,14 @@\n+@@ -602,10 +603,16 @@\n+       return this.field_71133_b.func_71219_W();\n+    }\n+ \n+-   @Nullable\n++   @Nullable @Deprecated // Use ITeleporter safe version", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "049c76c7fdc6c2b55d2742c019bd48d9420800b4"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk1MTQzMA==", "bodyText": "Spacing is screwed up.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497951430", "createdAt": "2020-10-01T02:34:14Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,89 @@\n \n package net.minecraftforge.common.util;\n \n+import java.util.Optional;\n import java.util.function.Function;\n \n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.Teleporter;\n+import net.minecraft.world.World;\n import net.minecraft.world.server.ServerWorld;\n \n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;\n+        return this.getClass() == Teleporter.class;\n+    }\n+\n+    /**\n+     * Finds a portal to teleport to and creates a {@link TeleportationRepositioner.Result} for it. Defaults to calling vanilla Teleporter methods.\n+     */\n+    default Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+    \tTeleporter teleporter = toWorld.getDefaultTeleporter();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "049c76c7fdc6c2b55d2742c019bd48d9420800b4"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk1MTQ0OQ==", "bodyText": "Spacing is screwed up. Also is this changing the default of ITeleporter to spawning a portal instead of having a custom ITeleporter not have a portal? If so that is a breaking change from the logical standpoint even if not binary", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r497951449", "createdAt": "2020-10-01T02:34:19Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,89 @@\n \n package net.minecraftforge.common.util;\n \n+import java.util.Optional;\n import java.util.function.Function;\n \n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.Teleporter;\n+import net.minecraft.world.World;\n import net.minecraft.world.server.ServerWorld;\n \n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;\n+        return this.getClass() == Teleporter.class;\n+    }\n+\n+    /**\n+     * Finds a portal to teleport to and creates a {@link TeleportationRepositioner.Result} for it. Defaults to calling vanilla Teleporter methods.\n+     */\n+    default Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+    \tTeleporter teleporter = toWorld.getDefaultTeleporter();\n+        if (this instanceof Teleporter)\n+            teleporter = (Teleporter) this;\n+        return teleporter.func_242957_a(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), toWorld.func_234923_W_() == World.field_234919_h_);\n+    }\n+\n+    /**\n+     * Creates a portal if one doesn't exist and returns the {@link TeleportationRepositioner.Result Result}. Defaults to calling vanilla Teleporter methods.\n+     */\n+    default Optional<TeleportationRepositioner.Result> createAndGetPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+    \tTeleporter teleporter = toWorld.getDefaultTeleporter();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "049c76c7fdc6c2b55d2742c019bd48d9420800b4"}, "originalPosition": 91}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3450f8ebd7ff6d5ceb0a4e8e5225175e23d3dfd6", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/3450f8ebd7ff6d5ceb0a4e8e5225175e23d3dfd6", "committedDate": "2020-10-01T02:45:27Z", "message": "Fixed spacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39e60390f1a87a9b4712d4ed33aab1fcb38dabcf", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/39e60390f1a87a9b4712d4ed33aab1fcb38dabcf", "committedDate": "2020-10-01T03:01:59Z", "message": "Adjusted ITeleporter logic. If the ITeleporter is an instance of Teleporter, it tries to use that method (for teleporters extending from vanilla). If it isn't, it returns the scaled position of the player as it's location."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/c44e54e0f6d7a68312e1b3faf0f49e9d106c2338", "committedDate": "2020-10-01T03:29:54Z", "message": "Decreased patch size"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0Mjc4MTQ4", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-504278148", "createdAt": "2020-10-07T21:23:54Z", "commit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMToyMzo1NFrOHeGDEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMjowMzoxMFrOHeHGSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMxODQxNg==", "bodyText": "teleporter should probably be annotated as nullable given the line below \"handles\" it being null", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501318416", "createdAt": "2020-10-07T21:23:54Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -262,7 +261,23 @@\n           }\n        } else {\n           return null;\n-@@ -2320,9 +2357,10 @@\n+@@ -2124,7 +2161,15 @@\n+    }\n+ \n+    @Nullable\n++   @Deprecated // Forge: Use ITeleporter safe version\n+    protected PortalInfo func_241829_a(ServerWorld p_241829_1_) {\n++      return this.getPortalInfo(p_241829_1_, p_241829_1_.func_85176_s());\n++   }\n++\n++   @Nullable\n++   protected PortalInfo getPortalInfo(ServerWorld p_241829_1_, net.minecraftforge.common.util.ITeleporter teleporter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMxOTMyMQ==", "bodyText": "Nullable here as well? Unless it shouldn't be nullable anywhere given it doesn't seem null safe two lines down from here", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501319321", "createdAt": "2020-10-07T21:25:53Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -8,7 +8,26 @@\n        boolean flag = this.field_70170_p.func_82736_K().func_223586_b(GameRules.field_223609_l);\n        if (flag) {\n           ITextComponent itextcomponent = this.func_110142_aN().func_151521_b();\n-@@ -614,13 +615,14 @@\n+@@ -603,9 +604,16 @@\n+    }\n+ \n+    @Nullable\n++   @Deprecated // Forge: Use ITeleporter safe version\n+    protected PortalInfo func_241829_a(ServerWorld p_241829_1_) {\n+-      PortalInfo portalinfo = super.func_241829_a(p_241829_1_);\n+-      if (portalinfo != null && this.field_70170_p.func_234923_W_() == World.field_234918_g_ && p_241829_1_.func_234923_W_() == World.field_234920_i_) {\n++      return this.getPortalInfo(p_241829_1_, p_241829_1_.func_85176_s());\n++   }\n++   \n++   @Nullable\n++   protected PortalInfo getPortalInfo(ServerWorld p_241829_1_, net.minecraftforge.common.util.ITeleporter teleporter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMTA0OQ==", "bodyText": "This can just be PortalInfo portalinfo = this.getPortalInfo(p_241206_1_, teleporter);", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501321049", "createdAt": "2020-10-07T21:29:46Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -231,9 +231,8 @@\n           this.func_213319_R();\n           this.field_70170_p.func_217381_Z().func_76320_a(\"reposition\");\n -         PortalInfo portalinfo = this.func_241829_a(p_241206_1_);\n--         if (portalinfo == null) {\n-+         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : null;\n-+         if (portalinfo == null && teleporter.isVanilla()) {\n++         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : this.getPortalInfo(p_241206_1_, teleporter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMjM2Nw==", "bodyText": "What is the purpose of this teleporter is vanilla check? If a modded teleporter passes false for spawn portal then it won't spawn the end spawn platform anyways.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501322367", "createdAt": "2020-10-07T21:32:40Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/Entity.java.patch", "diffHunk": "@@ -245,7 +244,7 @@\n                 entity.func_213317_d(portalinfo.field_222506_b);\n                 p_241206_1_.func_217460_e(entity);\n -               if (p_241206_1_.func_234923_W_() == World.field_234920_i_) {\n-+               if (spawnPortal && p_241206_1_.func_234923_W_() == World.field_234920_i_) {\n++               if (spawnPortal && p_241206_1_.func_234923_W_() == World.field_234920_i_ && teleporter.isVanilla()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMjU5Ng==", "bodyText": "This can just be PortalInfo portalinfo = this.getPortalInfo(p_241206_1_, teleporter);", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501322596", "createdAt": "2020-10-07T21:33:11Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -26,28 +45,28 @@\n           if (!this.field_71136_j) {\n              this.field_71136_j = true;\n              this.field_71135_a.func_147359_a(new SChangeGameStatePacket(SChangeGameStatePacket.field_241768_e_, this.field_192040_cp ? 0.0F : 1.0F));\n-@@ -634,14 +636,15 @@\n+@@ -634,14 +643,15 @@\n           this.field_71135_a.func_147359_a(new SServerDifficultyPacket(iworldinfo.func_176130_y(), iworldinfo.func_176123_z()));\n           PlayerList playerlist = this.field_71133_b.func_184103_al();\n           playerlist.func_187243_f(this);\n -         serverworld.func_217434_e(this);\n -         this.field_70128_L = false;\n -         PortalInfo portalinfo = this.func_241829_a(p_241206_1_);\n--         if (portalinfo != null) {\n +         serverworld.removeEntity(this, true); //Forge: the player entity is moved to the new world, NOT cloned. So keep the data alive with no matching invalidate call.\n +         this.revive();\n-+         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : null;\n-+         if (portalinfo != null || !teleporter.isVanilla()) {\n++         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : this.getPortalInfo(p_241206_1_, teleporter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMzg0OQ==", "bodyText": "I am not sure about this isVanilla check being added, as the enteredNetherPosition is used for checking if a player has travelled to the nether from what I can tell.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501323849", "createdAt": "2020-10-07T21:35:43Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -26,28 +45,28 @@\n           if (!this.field_71136_j) {\n              this.field_71136_j = true;\n              this.field_71135_a.func_147359_a(new SChangeGameStatePacket(SChangeGameStatePacket.field_241768_e_, this.field_192040_cp ? 0.0F : 1.0F));\n-@@ -634,14 +636,15 @@\n+@@ -634,14 +643,15 @@\n           this.field_71135_a.func_147359_a(new SServerDifficultyPacket(iworldinfo.func_176130_y(), iworldinfo.func_176123_z()));\n           PlayerList playerlist = this.field_71133_b.func_184103_al();\n           playerlist.func_187243_f(this);\n -         serverworld.func_217434_e(this);\n -         this.field_70128_L = false;\n -         PortalInfo portalinfo = this.func_241829_a(p_241206_1_);\n--         if (portalinfo != null) {\n +         serverworld.removeEntity(this, true); //Forge: the player entity is moved to the new world, NOT cloned. So keep the data alive with no matching invalidate call.\n +         this.revive();\n-+         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : null;\n-+         if (portalinfo != null || !teleporter.isVanilla()) {\n++         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : this.getPortalInfo(p_241206_1_, teleporter);\n+          if (portalinfo != null) {\n +            Entity e = teleporter.placeEntity(this, serverworld, p_241206_1_, this.field_70177_z, spawnPortal -> {//Forge: Start vanilla logic\n              serverworld.func_217381_Z().func_76320_a(\"moving\");\n-             if (registrykey == World.field_234918_g_ && p_241206_1_.func_234923_W_() == World.field_234919_h_) {\n+-            if (registrykey == World.field_234918_g_ && p_241206_1_.func_234923_W_() == World.field_234919_h_) {\n++            if (registrykey == World.field_234918_g_ && p_241206_1_.func_234923_W_() == World.field_234919_h_ && teleporter.isVanilla()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNDA1NA==", "bodyText": "What is the purpose of this teleporter is vanilla check? If a modded teleporter passes false for spawn portal then it won't spawn the end spawn platform anyways.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501324054", "createdAt": "2020-10-07T21:36:12Z", "author": {"login": "pupnewfster"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -26,28 +45,28 @@\n           if (!this.field_71136_j) {\n              this.field_71136_j = true;\n              this.field_71135_a.func_147359_a(new SChangeGameStatePacket(SChangeGameStatePacket.field_241768_e_, this.field_192040_cp ? 0.0F : 1.0F));\n-@@ -634,14 +636,15 @@\n+@@ -634,14 +643,15 @@\n           this.field_71135_a.func_147359_a(new SServerDifficultyPacket(iworldinfo.func_176130_y(), iworldinfo.func_176123_z()));\n           PlayerList playerlist = this.field_71133_b.func_184103_al();\n           playerlist.func_187243_f(this);\n -         serverworld.func_217434_e(this);\n -         this.field_70128_L = false;\n -         PortalInfo portalinfo = this.func_241829_a(p_241206_1_);\n--         if (portalinfo != null) {\n +         serverworld.removeEntity(this, true); //Forge: the player entity is moved to the new world, NOT cloned. So keep the data alive with no matching invalidate call.\n +         this.revive();\n-+         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : null;\n-+         if (portalinfo != null || !teleporter.isVanilla()) {\n++         PortalInfo portalinfo = teleporter.isVanilla() ? this.func_241829_a(p_241206_1_) : this.getPortalInfo(p_241206_1_, teleporter);\n+          if (portalinfo != null) {\n +            Entity e = teleporter.placeEntity(this, serverworld, p_241206_1_, this.field_70177_z, spawnPortal -> {//Forge: Start vanilla logic\n              serverworld.func_217381_Z().func_76320_a(\"moving\");\n-             if (registrykey == World.field_234918_g_ && p_241206_1_.func_234923_W_() == World.field_234919_h_) {\n+-            if (registrykey == World.field_234918_g_ && p_241206_1_.func_234923_W_() == World.field_234919_h_) {\n++            if (registrykey == World.field_234918_g_ && p_241206_1_.func_234923_W_() == World.field_234919_h_ && teleporter.isVanilla()) {\n                 this.field_193110_cw = this.func_213303_ch();\n -            } else if (p_241206_1_.func_234923_W_() == World.field_234920_i_) {\n-+            } else if (spawnPortal && p_241206_1_.func_234923_W_() == World.field_234920_i_) {\n++            } else if (spawnPortal && p_241206_1_.func_234923_W_() == World.field_234920_i_ && teleporter.isVanilla()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNDYwMQ==", "bodyText": "This can just be Optional.of( and I believe you can use entity.func_233580_cy_() instead of new BlockPos(entity.getPositionVec());", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501324601", "createdAt": "2020-10-07T21:37:18Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,93 @@\n \n package net.minecraftforge.common.util;\n \n+import java.util.Optional;\n import java.util.function.Function;\n \n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.Teleporter;\n+import net.minecraft.world.World;\n import net.minecraft.world.server.ServerWorld;\n \n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;\n+        return this.getClass() == Teleporter.class;\n+    }\n+\n+    /**\n+     * Finds a portal to teleport to and creates a {@link TeleportationRepositioner.Result} for it.\n+     * Calls {@link Teleporter} methods if this is an instance of Teleporter.\n+     * Defaults to the scaled entity's position.\n+     */\n+    default Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+        if (this instanceof Teleporter)\n+            return ((Teleporter) this).func_242957_a(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), toWorld.func_234923_W_() == World.field_234919_h_);\n+        else\n+            return Optional.ofNullable(new TeleportationRepositioner.Result(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), 0, 0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNDY1Nw==", "bodyText": "This can just be Optional.of( and I believe you can use entity.func_233580_cy_() instead of new BlockPos(entity.getPositionVec());", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501324657", "createdAt": "2020-10-07T21:37:24Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -19,49 +19,93 @@\n \n package net.minecraftforge.common.util;\n \n+import java.util.Optional;\n import java.util.function.Function;\n \n+import net.minecraft.block.PortalInfo;\n import net.minecraft.entity.Entity;\n import net.minecraft.entity.player.PlayerEntity;\n import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.vector.Vector3d;\n import net.minecraft.world.Teleporter;\n+import net.minecraft.world.World;\n import net.minecraft.world.server.ServerWorld;\n \n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n     }\n-    \n-    //used internally to handle vanilla hardcoding\n+\n+    /**\n+     * Is this teleporter the vanilla instance.\n+     */\n     default boolean isVanilla()\n     {\n-        return getClass() == Teleporter.class;\n+        return this.getClass() == Teleporter.class;\n+    }\n+\n+    /**\n+     * Finds a portal to teleport to and creates a {@link TeleportationRepositioner.Result} for it.\n+     * Calls {@link Teleporter} methods if this is an instance of Teleporter.\n+     * Defaults to the scaled entity's position.\n+     */\n+    default Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+        if (this instanceof Teleporter)\n+            return ((Teleporter) this).func_242957_a(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), toWorld.func_234923_W_() == World.field_234919_h_);\n+        else\n+            return Optional.ofNullable(new TeleportationRepositioner.Result(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), 0, 0));\n+    }\n+\n+    /**\n+     * Creates a portal if one doesn't exist and returns the {@link TeleportationRepositioner.Result Result}.\n+     * Calls {@link Teleporter} methods if this is an instance of Teleporter.\n+     * Defaults to the scaled entity's position.\n+     */\n+    default Optional<TeleportationRepositioner.Result> createAndGetPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+    {\n+        if (this instanceof Teleporter)\n+            return ((Teleporter) this).func_242956_a(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), entity.getHorizontalFacing().getAxis());\n+        else\n+            return Optional.ofNullable(new TeleportationRepositioner.Result(TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec())), 0, 0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyODM3OQ==", "bodyText": "I believe this isn't necessary because the methods are defaulted in ITeleporter and because of not allowing breaking changes the functionality should be how it is currently anyways. Unless you would rather be overriding one/both of these methods to return the result for the correct destination position and remove the setPositionAndUpdate call from the placeEntity method above.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501328379", "createdAt": "2020-10-07T21:46:16Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/server/command/CommandSetDimension.java", "diffHunk": "@@ -75,6 +76,20 @@ public Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld d\n                 repositionedEntity.setPositionAndUpdate(pos.getX(), pos.getY(), pos.getZ());\n                 return repositionedEntity;\n             }\n+\n+            @Override\n+            public Optional<TeleportationRepositioner.Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld,\n+                    Entity entity)\n+            {\n+                return Optional.empty();\n+            }\n+\n+            @Override\n+            public Optional<TeleportationRepositioner.Result> createAndGetPortal(ServerWorld fromWorld,\n+                    ServerWorld toWorld, Entity entity)\n+            {\n+                return Optional.empty();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyODY5MA==", "bodyText": "This needs to be rebased anyways given there is a merge conflict, but also this should use four spaces like the rest of the file instead of using a tab.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501328690", "createdAt": "2020-10-07T21:46:54Z", "author": {"login": "pupnewfster"}, "path": "src/test/resources/META-INF/mods.toml", "diffHunk": "@@ -85,4 +85,6 @@ license=\"LGPL v2.1\"\n [[mods]]\n     modId=\"custom_tag_types_test\"\n [[mods]]\n-    modId=\"biome_loading_event_test\"\n\\ No newline at end of file\n+    modId=\"biome_loading_event_test\"\n+[[mods]]\n+\tmodId=\"teleporter_test\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzNTMyNw==", "bodyText": "There is no reason to be using extended lambdas (with the braces) here it can just be poiType -> poiType == this.poi for example. Also instead of using sorted and findFirst() you can just use min where the current sorted call is and remove the findFirst() call", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501335327", "createdAt": "2020-10-07T22:02:25Z", "author": {"login": "pupnewfster"}, "path": "src/test/java/net/minecraftforge/debug/world/TeleporterTest.java", "diffHunk": "@@ -0,0 +1,190 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2020.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.debug.world;\n+\n+import java.util.Comparator;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.block.PortalInfo;\n+import net.minecraft.block.material.Material;\n+import net.minecraft.entity.Entity;\n+import net.minecraft.item.BlockItem;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemGroup;\n+import net.minecraft.util.Direction;\n+import net.minecraft.util.RegistryKey;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.TeleportationRepositioner.Result;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.ChunkPos;\n+import net.minecraft.util.math.vector.Vector3d;\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.village.PointOfInterest;\n+import net.minecraft.village.PointOfInterestManager;\n+import net.minecraft.village.PointOfInterestType;\n+import net.minecraft.world.World;\n+import net.minecraft.world.server.ServerWorld;\n+import net.minecraft.world.server.TicketType;\n+import net.minecraftforge.common.util.ITeleporter;\n+import net.minecraftforge.common.util.TeleporterHelper;\n+import net.minecraftforge.event.RegistryEvent;\n+import net.minecraftforge.fml.common.Mod;\n+import net.minecraftforge.fml.common.ObfuscationReflectionHelper;\n+import net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext;\n+import net.minecraftforge.registries.IForgeRegistry;\n+import net.minecraftforge.registries.IForgeRegistryEntry;\n+\n+// Test mod for ITeleporter changes 9/30/2020\n+@Mod(TeleporterTest.MODID)\n+public class TeleporterTest\n+{\n+    protected static final String MODID = \"teleporter_test\";\n+    private static RegistryKey<World> RED_WORLD = RegistryKey.func_240903_a_(Registry.field_239699_ae_, new ResourceLocation(MODID, \"red_world\"));;\n+    private static RegistryKey<World> BLUE_WORLD = RegistryKey.func_240903_a_(Registry.field_239699_ae_, new ResourceLocation(MODID, \"blue_world\"));\n+    // Triggered by standing on top. Red is scaled the same as the nether while blue is 1 to 1.\n+    private static TeleporterBlock RED_TELEPORTER, BLUE_TELEPORTER;\n+    private static PointOfInterestType RED_POI, BLUE_POI;\n+    \n+    public TeleporterTest()\n+    {\n+        FMLJavaModLoadingContext.get().getModEventBus().addGenericListener(Item.class, this::registerItems);\n+        FMLJavaModLoadingContext.get().getModEventBus().addGenericListener(Block.class, this::registerBlocks);\n+        FMLJavaModLoadingContext.get().getModEventBus().addGenericListener(PointOfInterestType.class, this::registerPOIs);\n+    }\n+    \n+    protected void registerBlocks(final RegistryEvent.Register<Block> event)\n+    {\n+        RED_TELEPORTER = register(event.getRegistry(), \"red_teleporter\", new TeleporterBlock(() -> RED_POI, RED_WORLD));\n+        BLUE_TELEPORTER = register(event.getRegistry(), \"blue_teleporter\", new TeleporterBlock(() -> BLUE_POI, BLUE_WORLD));\n+    }\n+    \n+    protected void registerItems(final RegistryEvent.Register<Item> event)\n+    {\n+        register(event.getRegistry(), \"red_teleporter\", new BlockItem(RED_TELEPORTER, new Item.Properties().group(ItemGroup.TRANSPORTATION)));\n+        register(event.getRegistry(), \"blue_teleporter\", new BlockItem(BLUE_TELEPORTER, new Item.Properties().group(ItemGroup.TRANSPORTATION)));\n+    }\n+    \n+    private <T extends IForgeRegistryEntry<T>, V extends T> V register(IForgeRegistry<T> registry, String name, V obj)\n+    {\n+        obj.setRegistryName(new ResourceLocation(MODID, name));\n+        registry.register(obj);\n+        return obj;\n+    }\n+    \n+    protected void registerPOIs(final RegistryEvent.Register<PointOfInterestType> event)\n+    {\n+        RED_POI = registerPOI(event.getRegistry(), new PointOfInterestType(new ResourceLocation(MODID, \"red_poi\").toString(), PointOfInterestType.getAllStates(RED_TELEPORTER), 0, 1));\n+        BLUE_POI = registerPOI(event.getRegistry(), new PointOfInterestType(new ResourceLocation(MODID, \"blue_poi\").toString(), PointOfInterestType.getAllStates(BLUE_TELEPORTER), 0, 1));\n+    }\n+    \n+    private PointOfInterestType registerPOI(IForgeRegistry<PointOfInterestType> registry, PointOfInterestType poi)\n+    {\n+        poi.setRegistryName(new ResourceLocation(poi.toString()));\n+        registry.register(poi);\n+        try\n+        {\n+            ObfuscationReflectionHelper.findMethod(PointOfInterestType.class, \"func_221052_a\", PointOfInterestType.class).invoke(null, poi);\n+        }\n+        catch (Exception e)\n+        {\n+            e.printStackTrace();\n+        }\n+        return poi;\n+    }\n+    \n+    private static class TeleporterBlock extends Block\n+    {\n+        final Supplier<PointOfInterestType> poi;\n+        final RegistryKey<World> destWorldKey;\n+        \n+        private TeleporterBlock(Supplier<PointOfInterestType> poi, RegistryKey<World> destWorldKey)\n+        {\n+            super(Properties.from(Blocks.STONE));\n+            this.poi = poi;\n+            this.destWorldKey = destWorldKey;\n+        }\n+        \n+        @Override\n+        public void onFallenUpon(World worldIn, BlockPos pos, Entity entityIn, float fallDistance)\n+        {\n+            if (!worldIn.isRemote)\n+                entityIn.changeDimension(((ServerWorld) worldIn).getServer().getWorld(worldIn.func_234923_W_() == this.destWorldKey ? World.field_234918_g_ : this.destWorldKey), new TestTeleporter(this.poi.get(), this));\n+        }\n+    }\n+    \n+    private static class TestTeleporter implements ITeleporter\n+    {\n+        final PointOfInterestType poi;\n+        final Block teleporterBlock;\n+        \n+        private TestTeleporter(PointOfInterestType poi, Block teleporterBlock)\n+        {\n+            this.poi = poi;\n+            this.teleporterBlock = teleporterBlock;\n+        }\n+        \n+        @Override\n+        public Optional<Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+        {\n+            PointOfInterestManager poiManager = toWorld.getPointOfInterestManager();\n+            int scale = TeleporterHelper.getPortalSearchRadius(fromWorld, toWorld);\n+            BlockPos scaledPos = TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec()));\n+            poiManager.ensureLoadedAndValid(toWorld, scaledPos, scale);\n+            Optional<PointOfInterest> optional = poiManager.getInSquare((poiType) -> {\n+               return poiType == this.poi;\n+            }, scaledPos, scale, PointOfInterestManager.Status.ANY).sorted(Comparator.<PointOfInterest>comparingDouble((poi) -> {\n+               return poi.getPos().distanceSq(scaledPos);\n+            }).thenComparingInt((poi) -> {\n+               return poi.getPos().getY();\n+            })).findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzNTYyNQ==", "bodyText": "No need for the extended lambda here either", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501335625", "createdAt": "2020-10-07T22:03:10Z", "author": {"login": "pupnewfster"}, "path": "src/test/java/net/minecraftforge/debug/world/TeleporterTest.java", "diffHunk": "@@ -0,0 +1,190 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2020.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.debug.world;\n+\n+import java.util.Comparator;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.block.PortalInfo;\n+import net.minecraft.block.material.Material;\n+import net.minecraft.entity.Entity;\n+import net.minecraft.item.BlockItem;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemGroup;\n+import net.minecraft.util.Direction;\n+import net.minecraft.util.RegistryKey;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.TeleportationRepositioner;\n+import net.minecraft.util.TeleportationRepositioner.Result;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.ChunkPos;\n+import net.minecraft.util.math.vector.Vector3d;\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.village.PointOfInterest;\n+import net.minecraft.village.PointOfInterestManager;\n+import net.minecraft.village.PointOfInterestType;\n+import net.minecraft.world.World;\n+import net.minecraft.world.server.ServerWorld;\n+import net.minecraft.world.server.TicketType;\n+import net.minecraftforge.common.util.ITeleporter;\n+import net.minecraftforge.common.util.TeleporterHelper;\n+import net.minecraftforge.event.RegistryEvent;\n+import net.minecraftforge.fml.common.Mod;\n+import net.minecraftforge.fml.common.ObfuscationReflectionHelper;\n+import net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext;\n+import net.minecraftforge.registries.IForgeRegistry;\n+import net.minecraftforge.registries.IForgeRegistryEntry;\n+\n+// Test mod for ITeleporter changes 9/30/2020\n+@Mod(TeleporterTest.MODID)\n+public class TeleporterTest\n+{\n+    protected static final String MODID = \"teleporter_test\";\n+    private static RegistryKey<World> RED_WORLD = RegistryKey.func_240903_a_(Registry.field_239699_ae_, new ResourceLocation(MODID, \"red_world\"));;\n+    private static RegistryKey<World> BLUE_WORLD = RegistryKey.func_240903_a_(Registry.field_239699_ae_, new ResourceLocation(MODID, \"blue_world\"));\n+    // Triggered by standing on top. Red is scaled the same as the nether while blue is 1 to 1.\n+    private static TeleporterBlock RED_TELEPORTER, BLUE_TELEPORTER;\n+    private static PointOfInterestType RED_POI, BLUE_POI;\n+    \n+    public TeleporterTest()\n+    {\n+        FMLJavaModLoadingContext.get().getModEventBus().addGenericListener(Item.class, this::registerItems);\n+        FMLJavaModLoadingContext.get().getModEventBus().addGenericListener(Block.class, this::registerBlocks);\n+        FMLJavaModLoadingContext.get().getModEventBus().addGenericListener(PointOfInterestType.class, this::registerPOIs);\n+    }\n+    \n+    protected void registerBlocks(final RegistryEvent.Register<Block> event)\n+    {\n+        RED_TELEPORTER = register(event.getRegistry(), \"red_teleporter\", new TeleporterBlock(() -> RED_POI, RED_WORLD));\n+        BLUE_TELEPORTER = register(event.getRegistry(), \"blue_teleporter\", new TeleporterBlock(() -> BLUE_POI, BLUE_WORLD));\n+    }\n+    \n+    protected void registerItems(final RegistryEvent.Register<Item> event)\n+    {\n+        register(event.getRegistry(), \"red_teleporter\", new BlockItem(RED_TELEPORTER, new Item.Properties().group(ItemGroup.TRANSPORTATION)));\n+        register(event.getRegistry(), \"blue_teleporter\", new BlockItem(BLUE_TELEPORTER, new Item.Properties().group(ItemGroup.TRANSPORTATION)));\n+    }\n+    \n+    private <T extends IForgeRegistryEntry<T>, V extends T> V register(IForgeRegistry<T> registry, String name, V obj)\n+    {\n+        obj.setRegistryName(new ResourceLocation(MODID, name));\n+        registry.register(obj);\n+        return obj;\n+    }\n+    \n+    protected void registerPOIs(final RegistryEvent.Register<PointOfInterestType> event)\n+    {\n+        RED_POI = registerPOI(event.getRegistry(), new PointOfInterestType(new ResourceLocation(MODID, \"red_poi\").toString(), PointOfInterestType.getAllStates(RED_TELEPORTER), 0, 1));\n+        BLUE_POI = registerPOI(event.getRegistry(), new PointOfInterestType(new ResourceLocation(MODID, \"blue_poi\").toString(), PointOfInterestType.getAllStates(BLUE_TELEPORTER), 0, 1));\n+    }\n+    \n+    private PointOfInterestType registerPOI(IForgeRegistry<PointOfInterestType> registry, PointOfInterestType poi)\n+    {\n+        poi.setRegistryName(new ResourceLocation(poi.toString()));\n+        registry.register(poi);\n+        try\n+        {\n+            ObfuscationReflectionHelper.findMethod(PointOfInterestType.class, \"func_221052_a\", PointOfInterestType.class).invoke(null, poi);\n+        }\n+        catch (Exception e)\n+        {\n+            e.printStackTrace();\n+        }\n+        return poi;\n+    }\n+    \n+    private static class TeleporterBlock extends Block\n+    {\n+        final Supplier<PointOfInterestType> poi;\n+        final RegistryKey<World> destWorldKey;\n+        \n+        private TeleporterBlock(Supplier<PointOfInterestType> poi, RegistryKey<World> destWorldKey)\n+        {\n+            super(Properties.from(Blocks.STONE));\n+            this.poi = poi;\n+            this.destWorldKey = destWorldKey;\n+        }\n+        \n+        @Override\n+        public void onFallenUpon(World worldIn, BlockPos pos, Entity entityIn, float fallDistance)\n+        {\n+            if (!worldIn.isRemote)\n+                entityIn.changeDimension(((ServerWorld) worldIn).getServer().getWorld(worldIn.func_234923_W_() == this.destWorldKey ? World.field_234918_g_ : this.destWorldKey), new TestTeleporter(this.poi.get(), this));\n+        }\n+    }\n+    \n+    private static class TestTeleporter implements ITeleporter\n+    {\n+        final PointOfInterestType poi;\n+        final Block teleporterBlock;\n+        \n+        private TestTeleporter(PointOfInterestType poi, Block teleporterBlock)\n+        {\n+            this.poi = poi;\n+            this.teleporterBlock = teleporterBlock;\n+        }\n+        \n+        @Override\n+        public Optional<Result> findPortal(ServerWorld fromWorld, ServerWorld toWorld, Entity entity)\n+        {\n+            PointOfInterestManager poiManager = toWorld.getPointOfInterestManager();\n+            int scale = TeleporterHelper.getPortalSearchRadius(fromWorld, toWorld);\n+            BlockPos scaledPos = TeleporterHelper.getScaledPos(fromWorld, toWorld, new BlockPos(entity.getPositionVec()));\n+            poiManager.ensureLoadedAndValid(toWorld, scaledPos, scale);\n+            Optional<PointOfInterest> optional = poiManager.getInSquare((poiType) -> {\n+               return poiType == this.poi;\n+            }, scaledPos, scale, PointOfInterestManager.Status.ANY).sorted(Comparator.<PointOfInterest>comparingDouble((poi) -> {\n+               return poi.getPos().distanceSq(scaledPos);\n+            }).thenComparingInt((poi) -> {\n+               return poi.getPos().getY();\n+            })).findFirst();\n+            \n+            return optional.map((poi) -> {\n+               BlockPos poiPos = poi.getPos();\n+               toWorld.getChunkProvider().registerTicket(TicketType.PORTAL, new ChunkPos(poiPos), 3, poiPos);\n+               BlockState blockstate = toWorld.getBlockState(poiPos);\n+               return TeleportationRepositioner.func_243676_a(poiPos, entity.getHorizontalFacing().getAxis(), 21, Direction.Axis.Y, 21, (pos) -> {\n+                  return toWorld.getBlockState(pos) == blockstate;\n+               });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c44e54e0f6d7a68312e1b3faf0f49e9d106c2338"}, "originalPosition": 169}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c84f445f8539448043c101ba692896d9392d25d", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7c84f445f8539448043c101ba692896d9392d25d", "committedDate": "2020-10-07T22:50:44Z", "message": "Cleaned up code based on feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a164abf99c5f8bff5f57d3720965ac31890e11f", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2a164abf99c5f8bff5f57d3720965ac31890e11f", "committedDate": "2020-10-07T22:58:50Z", "message": "Generated patches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea194f872c642f4d0ee95e080e2d7703c13c63b1", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ea194f872c642f4d0ee95e080e2d7703c13c63b1", "committedDate": "2020-10-07T23:41:51Z", "message": "Fixed merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944c7fb9b70309ce986ce42f98ac67f48e04e6be", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/944c7fb9b70309ce986ce42f98ac67f48e04e6be", "committedDate": "2020-10-07T23:44:26Z", "message": "Fixed merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5967a19de6277237717b7179b138d758ef8a26c8", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/5967a19de6277237717b7179b138d758ef8a26c8", "committedDate": "2020-10-07T23:52:04Z", "message": "Merge branch '1.16.x' into 1.16.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72bfb818838ab38ae1d66e5f4c31f254e057b4c0", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/72bfb818838ab38ae1d66e5f4c31f254e057b4c0", "committedDate": "2020-10-08T00:28:06Z", "message": "Removed != null check from Entity.getPortalInfo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0Mzc1MjI2", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-504375226", "createdAt": "2020-10-08T01:42:11Z", "commit": {"oid": "72bfb818838ab38ae1d66e5f4c31f254e057b4c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMTo0MjoxMVrOHeLI6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMTo0MjoxMVrOHeLI6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTgzMg==", "bodyText": "These import changes aren't needed", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r501401832", "createdAt": "2020-10-08T01:42:11Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/server/command/CommandSetDimension.java", "diffHunk": "@@ -25,17 +25,18 @@\n import net.minecraft.command.arguments.DimensionArgument;\n import net.minecraft.command.arguments.EntityArgument;\n import net.minecraft.entity.Entity;\n+import net.minecraft.util.TeleportationRepositioner;\n import net.minecraft.util.math.BlockPos;\n import net.minecraft.util.text.TranslationTextComponent;\n import net.minecraft.world.server.ServerWorld;\n import net.minecraftforge.common.util.ITeleporter;\n-\n import com.mojang.brigadier.builder.ArgumentBuilder;\n import com.mojang.brigadier.exceptions.CommandSyntaxException;\n import com.mojang.brigadier.exceptions.DynamicCommandExceptionType;\n import com.mojang.brigadier.exceptions.SimpleCommandExceptionType;\n \n import java.util.Collection;\n+import java.util.Optional;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72bfb818838ab38ae1d66e5f4c31f254e057b4c0"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de6e8fcb73291e25018a429be72db4ddf4fdd346", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/de6e8fcb73291e25018a429be72db4ddf4fdd346", "committedDate": "2020-10-08T05:25:13Z", "message": "Removed unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd42e14a8efef54155c6c5337bacaf1a1796c821", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/cd42e14a8efef54155c6c5337bacaf1a1796c821", "committedDate": "2020-10-13T00:14:31Z", "message": "Removed some isVanilla checks from ServerPlayerEntity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abcb517a2452385ebebd0dd6850255d6ee3053e0", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/abcb517a2452385ebebd0dd6850255d6ee3053e0", "committedDate": "2020-10-15T22:49:05Z", "message": "Removed createAndGetPortal and findPortal as they are unused. Devs are better off handling it themselves. PortalInfo is now obtained from getPortalInfo."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c77b89c4ca04d2e1661d686942c07be55578646", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2c77b89c4ca04d2e1661d686942c07be55578646", "committedDate": "2020-10-15T23:12:41Z", "message": "Removed getPortalInfo method overload as well as changed how teleporting gets the portal info based on Lex's suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cd8bd14fb5074a21c90e4cc47ad2b06af122535", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/4cd8bd14fb5074a21c90e4cc47ad2b06af122535", "committedDate": "2020-10-15T23:12:50Z", "message": "Updated test mod"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODczMTA5", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-509873109", "createdAt": "2020-10-15T23:19:36Z", "commit": {"oid": "4cd8bd14fb5074a21c90e4cc47ad2b06af122535"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMzoxOTozNlrOHiewcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMzoxOTozNlrOHiewcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNzU1Mg==", "bodyText": "Probably don't need the comment here anymore, since you are no longer changing code on this line", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r505917552", "createdAt": "2020-10-15T23:19:36Z", "author": {"login": "KnightMiner"}, "path": "patches/minecraft/net/minecraft/entity/player/ServerPlayerEntity.java.patch", "diffHunk": "@@ -19,7 +19,7 @@\n        ServerWorld serverworld = this.func_71121_q();\n        RegistryKey<World> registrykey = serverworld.func_234923_W_();\n -      if (registrykey == World.field_234920_i_ && p_241206_1_.func_234923_W_() == World.field_234918_g_) {\n-+      if (registrykey == World.field_234920_i_ && p_241206_1_.func_234923_W_() == World.field_234918_g_ && teleporter.isVanilla()) { //Forge: Fix non-vanilla teleporters triggering end credits\n++      if (registrykey == World.field_234920_i_ && p_241206_1_.func_234923_W_() == World.field_234918_g_) { //Forge: Fix non-vanilla teleporters triggering end credits", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd8bd14fb5074a21c90e4cc47ad2b06af122535"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7204532f9d7d5d14060ea6824cab8f740b2734e6", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7204532f9d7d5d14060ea6824cab8f740b2734e6", "committedDate": "2020-10-15T23:23:18Z", "message": "Merge branch '1.16.x' into 1.16.x"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODc5OTMz", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-509879933", "createdAt": "2020-10-15T23:33:28Z", "commit": {"oid": "7204532f9d7d5d14060ea6824cab8f740b2734e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMzozMzoyOFrOHifBYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMzozMzoyOFrOHifBYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkyMTg5MQ==", "bodyText": "There is no reason for this stuff to exist anymore, at least not as public forge API, just put the methods in your test mod if they are still needed by it.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r505921891", "createdAt": "2020-10-15T23:33:28Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/TeleporterHelper.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package net.minecraftforge.common.util;\n+\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.MathHelper;\n+import net.minecraft.world.DimensionType;\n+import net.minecraft.world.World;\n+import net.minecraft.world.border.WorldBorder;\n+\n+public class TeleporterHelper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7204532f9d7d5d14060ea6824cab8f740b2734e6"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe15a4c912ebdf7b8853918ce9efea227e10c0b4", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/fe15a4c912ebdf7b8853918ce9efea227e10c0b4", "committedDate": "2020-10-16T01:18:25Z", "message": "Re-added the isVanilla check for end credits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e34e8178c149995dec0533a8c97330f873b4a8c", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/0e34e8178c149995dec0533a8c97330f873b4a8c", "committedDate": "2020-10-16T01:33:19Z", "message": "Fixed set_dimension command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "313965a02a428e5de2e6db932be75eb1a762dada", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/313965a02a428e5de2e6db932be75eb1a762dada", "committedDate": "2020-10-16T01:33:28Z", "message": "Removed TeleporterHelper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTU3NzU1", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-509957755", "createdAt": "2020-10-16T01:45:15Z", "commit": {"oid": "313965a02a428e5de2e6db932be75eb1a762dada"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMTo0NToxNlrOHiiJaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMTo0NToxNlrOHiiJaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk3MzA5Ng==", "bodyText": "I am guessing this is required to make it work properly and otherwise it just doesn't teleport (instead of how it currently just silently null pointers)?", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r505973096", "createdAt": "2020-10-16T01:45:16Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/server/command/CommandSetDimension.java", "diffHunk": "@@ -75,6 +73,12 @@ public Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld d\n                 repositionedEntity.setPositionAndUpdate(pos.getX(), pos.getY(), pos.getZ());\n                 return repositionedEntity;\n             }\n+            \n+            @Override\n+            public PortalInfo getPortalInfo(Entity entity, ServerWorld destWorld, Function<ServerWorld, PortalInfo> defaultPortalInfo)\n+            {\n+                return new PortalInfo(entity.getPositionVec(), Vector3d.ZERO, entity.rotationYaw, entity.rotationPitch);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "313965a02a428e5de2e6db932be75eb1a762dada"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzE2NTk1", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#pullrequestreview-510716595", "createdAt": "2020-10-16T18:40:07Z", "commit": {"oid": "313965a02a428e5de2e6db932be75eb1a762dada"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo0MDowN1rOHjL9iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo0MToyM1rOHjL_7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1ODE4NA==", "bodyText": "Discussed this with lex some and this should instead return:\nreturn isVanilla() ? defaultPortalInfo.apply(destWorld) : new PortalInfo(entity.getPositionVec(), Vector3d.ZERO, entity.rotationYaw, entity.rotationPitch);\nso that current mods implementing ITeleporter using work arounds continue to work and don't get broken by this change.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r506658184", "createdAt": "2020-10-16T18:40:07Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -29,39 +32,62 @@\n \n /**\n  * Interface for handling the placement of entities during dimension change.\n- *\n+ * <p>\n  * An implementation of this interface can be used to place the entity\n  * in a safe location, or generate a return portal, for instance.\n- *\n+ * <p>\n  * See the {@link net.minecraft.world.Teleporter} class, which has\n  * been patched to implement this interface, for a vanilla example.\n  */\n-public interface ITeleporter {\n-\n+public interface ITeleporter\n+{\n     /**\n      * Called to handle placing the entity in the new world.\n-     *\n+     * <p>\n      * The initial position of the entity will be its\n      * position in the origin world, multiplied horizontally\n      * by the computed cross-dimensional movement factor.\n-     *\n+     * <p>\n      * Note that the supplied entity has not yet been spawned\n      * in the destination world at the time.\n      *\n-     * @param entity           the entity to be placed\n-     * @param currentWorld     the entity's origin\n-     * @param destWorld        the entity's destination\n-     * @param yaw              the suggested yaw value to apply\n+     * @param entity the entity to be placed\n+     * @param currentWorld the entity's origin\n+     * @param destWorld the entity's destination\n+     * @param yaw the suggested yaw value to apply\n      * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     *\n      * @return the entity in the new World. Vanilla creates for most {@link Entity}s a new instance and copy the data. But <b>you are not allowed</b> to create a new instance for {@link PlayerEntity}s! Move the player and update its state, see {@link ServerPlayerEntity#changeDimension(net.minecraft.world.server.ServerWorld, ITeleporter)}\n      */\n-    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n-       return repositionEntity.apply(true);\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity)\n+    {\n+        return repositionEntity.apply(true);\n+    }\n+\n+    /**\n+     * Gets the PortalInfo. defaultPortalInfo references the \n+     * vanilla code and should not be used for your purposes. \n+     * Override this method to handle your own logic. \n+     * <p>\n+     * Return {@code null} to prevent teleporting.\n+     * \n+     * @param entity The entity teleporting before the teleport\n+     * @param destWorld The world the entity is teleporting to\n+     * @param defaultPortalInfo A reference to the vanilla method for getting portal info. You should implement your own logic instead of using this\n+     * \n+     * @return The location, rotation, and motion of the entity in the destWorld after the teleport\n+     */\n+    @Nullable\n+    default PortalInfo getPortalInfo(Entity entity, ServerWorld destWorld, Function<ServerWorld, PortalInfo> defaultPortalInfo)\n+    {\n+        return defaultPortalInfo.apply(destWorld);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "313965a02a428e5de2e6db932be75eb1a762dada"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1ODc5Nw==", "bodyText": "Don't remove this, it is here to remember to reimplement it at some point. (Also with the requested change to the default implementation of getPortalInfo you should be able to revert all changes being made to this class.)", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7317#discussion_r506658797", "createdAt": "2020-10-16T18:41:23Z", "author": {"login": "pupnewfster"}, "path": "src/main/java/net/minecraftforge/server/command/CommandSetDimension.java", "diffHunk": "@@ -41,7 +42,7 @@\n public class CommandSetDimension\n {\n     private static final SimpleCommandExceptionType NO_ENTITIES = new SimpleCommandExceptionType(new TranslationTextComponent(\"commands.forge.setdim.invalid.entity\"));\n-    private static final DynamicCommandExceptionType INVALID_DIMENSION = new DynamicCommandExceptionType(dim -> new TranslationTextComponent(\"commands.forge.setdim.invalid.dim\", dim));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "313965a02a428e5de2e6db932be75eb1a762dada"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e0e49d18e83d14f21b1a6036dba5c758f15af07", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/9e0e49d18e83d14f21b1a6036dba5c758f15af07", "committedDate": "2020-10-16T18:55:23Z", "message": "Reverted changes to CommandSetDimension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d81ac7e76eb7100760f5ad8b9f19730fdbd0a1aa", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/d81ac7e76eb7100760f5ad8b9f19730fdbd0a1aa", "committedDate": "2020-10-16T18:55:44Z", "message": "Updated ITeleporter logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16214949f87f2de9d90f65d7497ff303345484e2", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/16214949f87f2de9d90f65d7497ff303345484e2", "committedDate": "2020-10-16T18:57:44Z", "message": "Removed test mod"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee8a6825cb75ea546e1b608753bd10bcc0044046", "author": {"user": {"login": "SilverDavidMC", "name": "Silver_David"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ee8a6825cb75ea546e1b608753bd10bcc0044046", "committedDate": "2020-10-16T18:58:20Z", "message": "Missed a space"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2263, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}