{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMDYyMjMx", "number": 6545, "title": "Defer writing the server.properties file until after mods have loaded", "bodyText": "Proposed fix for #6189\nThis prevents the server from overwriting the server.properties file until after mods have loaded, allowing their world-types etc to be used in it.\nIt simply re-reads the properties file after mod-loading and updates the server's copy. The call to ServerPropertiesProvider.func_219033_a(..) also performs a save, ensuring the file is created and contains valid values.\nThis also maintains the vanilla behaviour of creating the settings file when the server stops early due to the eula not being accepted, the initSettings flag being present, or an invalid world being specified.\nHope this is ok!", "createdAt": "2020-03-03T16:50:36Z", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545", "merged": true, "mergeCommit": {"oid": "f6cb5268a216eb4c5612a05d63225bfc8385f6b7"}, "closed": true, "closedAt": "2020-03-27T23:19:34Z", "author": {"login": "dags-"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKEfSPgH2gAyMzgzMDYyMjMxOjM0ZTg2ZTA4OWUyNjFiYzg1MDQ0OTRjNmEwMjY2NmZhMzg4MjAxNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcR5FWxAFqTM4MzI0NzEzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34e86e089e261bc8504494c6a02666fa38820178", "author": {"user": {"login": "dags-", "name": "dags"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/34e86e089e261bc8504494c6a02666fa38820178", "committedDate": "2020-03-03T15:59:07Z", "message": "Defers writing the server.properties to file until after mods have had a chance to load/register their world-types etc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a55ae3180a22ee698d7395ec800a9fd2a4d992", "author": {"user": {"login": "dags-", "name": "dags"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/77a55ae3180a22ee698d7395ec800a9fd2a4d992", "committedDate": "2020-03-03T16:47:40Z", "message": "Also save after 'invalid world' to keep in-line with vanilla"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MTU0NDI3", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545#pullrequestreview-368154427", "createdAt": "2020-03-03T16:56:30Z", "commit": {"oid": "77a55ae3180a22ee698d7395ec800a9fd2a4d992"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNjo1NjozMVrOFxOT5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNjo1NjozMVrOFxOT5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1OTAxMw==", "bodyText": "Import in patch file. It's not even used.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545#discussion_r387159013", "createdAt": "2020-03-03T16:56:31Z", "author": {"login": "bl4ckscor3"}, "path": "patches/minecraft/net/minecraft/server/dedicated/DedicatedServer.java.patch", "diffHunk": "@@ -1,46 +1,56 @@\n --- a/net/minecraft/server/dedicated/DedicatedServer.java\n +++ b/net/minecraft/server/dedicated/DedicatedServer.java\n-@@ -97,6 +97,7 @@\n+@@ -15,6 +15,7 @@\n+ import java.net.InetAddress;\n+ import java.net.Proxy;\n+ import java.nio.charset.StandardCharsets;\n++import java.nio.file.Paths;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a55ae3180a22ee698d7395ec800a9fd2a4d992"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1949cb65184e721022295ad0f43fb9395c2e3a94", "author": {"user": {"login": "dags-", "name": "dags"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/1949cb65184e721022295ad0f43fb9395c2e3a94", "committedDate": "2020-03-03T18:21:09Z", "message": "use fully qualified class name instead of import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjcwOTk3", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545#pullrequestreview-368270997", "createdAt": "2020-03-03T19:43:22Z", "commit": {"oid": "1949cb65184e721022295ad0f43fb9395c2e3a94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo0MzoyMlrOFxT8tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo0MzoyMlrOFxT8tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1MTM4Mg==", "bodyText": "Am I correct in thinking that this wipes any changes to the properties if you have forgotten to accept the EULA (which I always forget to do)?\nSorry, it's a bit hard to read patch files on my phone, so I could be wrong about it, but I would rather it didn't affect the file if the EULA hasn't been accepted. Otherwise there's a risk that you change some settings, run the server, accept the EULA then re-run expecting your changed settings to apply and they won't.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545#discussion_r387251382", "createdAt": "2020-03-03T19:43:22Z", "author": {"login": "Alpvax"}, "path": "patches/minecraft/net/minecraft/server/MinecraftServer.java.patch", "diffHunk": "@@ -172,26 +172,45 @@\n  \n        try {\n           OptionSet optionset = optionparser.parse(p_main_0_);\n-@@ -910,6 +935,10 @@\n+@@ -888,15 +913,16 @@\n+ \n+          Path path = Paths.get(\"server.properties\");\n+          ServerPropertiesProvider serverpropertiesprovider = new ServerPropertiesProvider(path);\n+-         serverpropertiesprovider.func_219035_b();\n+          Path path1 = Paths.get(\"eula.txt\");\n+          ServerEula servereula = new ServerEula(path1);\n+          if (optionset.has(optionspec1)) {\n++            serverpropertiesprovider.func_219035_b();\n+             field_147145_h.info(\"Initialized '\" + path.toAbsolutePath().toString() + \"' and '\" + path1.toAbsolutePath().toString() + \"'\");\n+             return;\n+          }\n+ \n+          if (!servereula.func_154346_a()) {\n++            serverpropertiesprovider.func_219035_b();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1949cb65184e721022295ad0f43fb9395c2e3a94"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2513a10bc28a9c97814676832fa158cc5d68a9d9", "author": {"user": {"login": "dags-", "name": "dags"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2513a10bc28a9c97814676832fa158cc5d68a9d9", "committedDate": "2020-03-04T10:38:47Z", "message": "Only do the early write to file if it doesn't already exist or the user has provided the initSettings flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ae1d7bca706b97decc8cce03c3025b2433beb8", "author": {"user": {"login": "dags-", "name": "dags"}}, "url": "https://github.com/MinecraftForge/MinecraftForge/commit/e5ae1d7bca706b97decc8cce03c3025b2433beb8", "committedDate": "2020-03-16T10:58:36Z", "message": "Further reduce patch size by checking for the initSettings flag in the same line as File.exists, rather than adding a second properties.save call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjQ3MTMy", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545#pullrequestreview-383247132", "createdAt": "2020-03-27T23:13:14Z", "commit": {"oid": "e5ae1d7bca706b97decc8cce03c3025b2433beb8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMzoxMzoxNFrOF9EUEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMzoxMzoxNFrOF9EUEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU3ODEyOQ==", "bodyText": "Typically we just inject the IF above the line so the patch file doesn't have a removal line.", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6545#discussion_r399578129", "createdAt": "2020-03-27T23:13:14Z", "author": {"login": "LexManos"}, "path": "patches/minecraft/net/minecraft/server/MinecraftServer.java.patch", "diffHunk": "@@ -172,6 +172,15 @@\n  \n        try {\n           OptionSet optionset = optionparser.parse(p_main_0_);\n+@@ -888,7 +913,7 @@\n+ \n+          Path path = Paths.get(\"server.properties\");\n+          ServerPropertiesProvider serverpropertiesprovider = new ServerPropertiesProvider(path);\n+-         serverpropertiesprovider.func_219035_b();\n++         if (optionset.has(optionspec1) || !Files.exists(path)) serverpropertiesprovider.func_219035_b();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5ae1d7bca706b97decc8cce03c3025b2433beb8"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2150, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}