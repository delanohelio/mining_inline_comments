{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMzU5MDMy", "number": 400, "title": "Add operations to create and delete OIDC provider configs.", "bodyText": "This adds an operation to create OIDC provider configs (can be done using either the tenant-aware or standard Firebase client), as well as an operation to delete provider configs.\nI spent some time trying to see if we could make the create operation generic so that it could support both OIDC and SAML provider configs, however, I'm concerned that such a solution would add complexity to the external API, rather than making it simpler. I think it would also introduce some sort of instanceof check internally.\nThis work is part of adding multi-tenancy support (see issue #332).", "createdAt": "2020-04-28T21:00:59Z", "url": "https://github.com/firebase/firebase-admin-java/pull/400", "merged": true, "mergeCommit": {"oid": "0c76cc60ad0310556c8b438e3f35aeed6abae50d"}, "closed": true, "closedAt": "2020-04-29T23:09:58Z", "author": {"login": "micahstairs"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcb2qOfAH2gAyNDEwMzU5MDMyOjI4ZTNkYzdmNTBjODliYjFkZDc2MDQ5NzViZTFlOWZjNGE0OWUyNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcce1pxgFqTQwMzAyOTM0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28e3dc7f50c89bb1dd7604975be1e9fc4a49e26a", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/28e3dc7f50c89bb1dd7604975be1e9fc4a49e26a", "committedDate": "2020-04-27T22:03:02Z", "message": "Fix CreateRequest chaining and provider ID extraction."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65827dc74177636ff83d2d9db5542119aac43a8c", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/65827dc74177636ff83d2d9db5542119aac43a8c", "committedDate": "2020-04-27T22:08:08Z", "message": "Fix javadoc comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/913e1288d791fc8b60d8c10fe51b529517a7e168", "committedDate": "2020-04-28T20:51:19Z", "message": "Add operations to create and delete OIDC provider configs."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjA5NzIy", "url": "https://github.com/firebase/firebase-admin-java/pull/400#pullrequestreview-402209722", "createdAt": "2020-04-28T21:03:16Z", "commit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMTowMzoxN1rOGNm0uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMTowMzoxN1rOGNm0uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkyMDc2MQ==", "bodyText": "I find this mapping strange, however, \"CONFIGURATION_NOT_FOUND\" was already being mapped to \"project-not-found\".\nI've confirmed that the server returns CONFIGURATION_NOT_FOUND if you ask it to delete a provider config ID which doesn't exist.", "url": "https://github.com/firebase/firebase-admin-java/pull/400#discussion_r416920761", "createdAt": "2020-04-28T21:03:17Z", "author": {"login": "micahstairs"}, "path": "src/main/java/com/google/firebase/auth/FirebaseUserManager.java", "diffHunk": "@@ -65,6 +65,7 @@\n  */\n class FirebaseUserManager {\n \n+  static final String CONFIGURATION_NOT_FOUND = \"project-not-found\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjE4MjE0", "url": "https://github.com/firebase/firebase-admin-java/pull/400#pullrequestreview-402218214", "createdAt": "2020-04-28T21:16:32Z", "commit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMToxNjozMlrOGNnRew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMToyODoxOVrOGNnqMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkyODEyMw==", "bodyText": "This is different from the signature proposed in go/firebase-mt-java. That is fine, but we should think if this is the best we can do. In .NET we used a generics-based solution for this. Can we do something similar here? Something like the following:\n<T extends ProviderConfig> T createProviderConfig(ProviderConfig.CreateRequest<T> request)\n\nWDYT?", "url": "https://github.com/firebase/firebase-admin-java/pull/400#discussion_r416928123", "createdAt": "2020-04-28T21:16:32Z", "author": {"login": "hiranya911"}, "path": "src/main/java/com/google/firebase/auth/AbstractFirebaseAuth.java", "diffHunk": "@@ -945,6 +936,98 @@ protected String execute() throws FirebaseAuthException {\n     };\n   }\n \n+  /**\n+   * Creates a new provider OIDC Auth config with the attributes contained in the specified {@link\n+   * OidcProviderConfig.CreateRequest}.\n+   *\n+   * @param request A non-null {@link OidcProviderConfig.CreateRequest} instance.\n+   * @return An {@link OidcProviderConfig} instance corresponding to the newly created provider\n+   *     config.\n+   * @throws NullPointerException if the provided request is null.\n+   * @throws FirebaseAuthException if an error occurs while creating the provider config.\n+   */\n+  public OidcProviderConfig createOidcProviderConfig(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkzMDI5MQ==", "bodyText": "Already mapped where? Looks like it's being added here.", "url": "https://github.com/firebase/firebase-admin-java/pull/400#discussion_r416930291", "createdAt": "2020-04-28T21:20:53Z", "author": {"login": "hiranya911"}, "path": "src/main/java/com/google/firebase/auth/FirebaseUserManager.java", "diffHunk": "@@ -65,6 +65,7 @@\n  */\n class FirebaseUserManager {\n \n+  static final String CONFIGURATION_NOT_FOUND = \"project-not-found\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkyMDc2MQ=="}, "originalCommit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkzMTM4OA==", "bodyText": "idpConfigMgtBaseUrl", "url": "https://github.com/firebase/firebase-admin-java/pull/400#discussion_r416931388", "createdAt": "2020-04-28T21:22:54Z", "author": {"login": "hiranya911"}, "path": "src/main/java/com/google/firebase/auth/FirebaseUserManager.java", "diffHunk": "@@ -106,6 +107,7 @@\n   private static final String CLIENT_VERSION_HEADER = \"X-Client-Version\";\n \n   private final String userMgtBaseUrl;\n+  private final String oidpMgtBaseUrl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkzNDQ1MA==", "bodyText": "Lets add some assertions here.", "url": "https://github.com/firebase/firebase-admin-java/pull/400#discussion_r416934450", "createdAt": "2020-04-28T21:28:19Z", "author": {"login": "hiranya911"}, "path": "src/test/java/com/google/firebase/auth/FirebaseUserManagerTest.java", "diffHunk": "@@ -1383,6 +1386,140 @@ public void testUnexpectedHttpError() {\n     }\n   }\n \n+  @Test\n+  public void testCreateOidcProvider() throws Exception {\n+    TestResponseInterceptor interceptor = initializeAppForUserManagement(\n+        TestUtils.loadResource(\"oidc.json\"));\n+    OidcProviderConfig.CreateRequest createRequest =\n+        new OidcProviderConfig.CreateRequest()\n+            .setProviderId(\"oidc.provider-id\")\n+            .setDisplayName(\"DISPLAY_NAME\")\n+            .setEnabled(true)\n+            .setClientId(\"CLIENT_ID\")\n+            .setIssuer(\"https://oidc.com/issuer\");\n+\n+    OidcProviderConfig config = FirebaseAuth.getInstance().createOidcProviderConfig(createRequest);\n+\n+    checkOidcProviderConfig(config);\n+    checkRequestHeaders(interceptor);\n+    checkUrl(interceptor, \"POST\", PROJECT_BASE_URL + \"/oauthIdpConfigs\");\n+    GenericJson parsed = parseRequestContent(interceptor);\n+    assertEquals(\"DISPLAY_NAME\", parsed.get(\"displayName\"));\n+    assertTrue((boolean) parsed.get(\"enabled\"));\n+    assertEquals(\"CLIENT_ID\", parsed.get(\"clientId\"));\n+    assertEquals(\"https://oidc.com/issuer\", parsed.get(\"issuer\"));\n+    GenericUrl url = interceptor.getResponse().getRequest().getUrl();\n+    assertEquals(\"oidc.provider-id\", url.getFirst(\"oauthIdpConfigId\"));\n+  }\n+\n+  @Test\n+  public void testCreateOidcProviderMinimal() throws Exception {\n+    TestResponseInterceptor interceptor = initializeAppForUserManagement(\n+        TestUtils.loadResource(\"oidc.json\"));\n+    // Only the 'enabled' field can be omitted from an OIDC provider config creation request.\n+    OidcProviderConfig.CreateRequest createRequest =\n+        new OidcProviderConfig.CreateRequest()\n+            .setProviderId(\"oidc.provider-id\")\n+            .setDisplayName(\"DISPLAY_NAME\")\n+            .setClientId(\"CLIENT_ID\")\n+            .setIssuer(\"https://oidc.com/issuer\");\n+\n+    FirebaseAuth.getInstance().createOidcProviderConfig(createRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "913e1288d791fc8b60d8c10fe51b529517a7e168"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79f901477f42f08429c7106201fdf05f03a04871", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/79f901477f42f08429c7106201fdf05f03a04871", "committedDate": "2020-04-28T21:57:35Z", "message": "Rename variable and add test assertions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbd6a6bb83c19b644fe175dcc0d8549f8fcddc5", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/2dbd6a6bb83c19b644fe175dcc0d8549f8fcddc5", "committedDate": "2020-04-28T22:02:11Z", "message": "Add a few more test assertions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjU4NzA2", "url": "https://github.com/firebase/firebase-admin-java/pull/400#pullrequestreview-402258706", "createdAt": "2020-04-28T22:31:46Z", "commit": {"oid": "2dbd6a6bb83c19b644fe175dcc0d8549f8fcddc5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ae38d330dbaa9d2e5b4e574e9fa507ede303fd9", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/5ae38d330dbaa9d2e5b4e574e9fa507ede303fd9", "committedDate": "2020-04-29T00:46:55Z", "message": "Change 'project-not-found' to 'configuration-not-found'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e47744e81cc20c49107644a23f6eb6e572a627c", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/5e47744e81cc20c49107644a23f6eb6e572a627c", "committedDate": "2020-04-29T14:38:29Z", "message": "Merge idp-config into micahstairs-create-and-delete-provider-configs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyOTM3OTYz", "url": "https://github.com/firebase/firebase-admin-java/pull/400#pullrequestreview-402937963", "createdAt": "2020-04-29T18:39:59Z", "commit": {"oid": "5e47744e81cc20c49107644a23f6eb6e572a627c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxODo0MDowMFrOGOMCsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxODo0MDowMFrOGOMCsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUzMDU0Nw==", "bodyText": "SAML configs are on a different URL path. Better to not append /oauthIdpConfigs to the URL here.", "url": "https://github.com/firebase/firebase-admin-java/pull/400#discussion_r417530547", "createdAt": "2020-04-29T18:40:00Z", "author": {"login": "hiranya911"}, "path": "src/main/java/com/google/firebase/auth/FirebaseUserManager.java", "diffHunk": "@@ -120,15 +122,18 @@\n         \"Project ID is required to access the auth service. Use a service account credential or \"\n             + \"set the project ID explicitly via FirebaseOptions. Alternatively you can also \"\n             + \"set the project ID via the GOOGLE_CLOUD_PROJECT environment variable.\");\n-    String tenantId = builder.tenantId;\n-    if (builder.tenantId == null) {\n-      this.userMgtBaseUrl = String.format(ID_TOOLKIT_URL, \"v1\", projectId);\n+    final String idToolkitUrlV1 = String.format(ID_TOOLKIT_URL, \"v1\", projectId);\n+    final String idToolkitUrlV2 = String.format(ID_TOOLKIT_URL, \"v2\", projectId);\n+    final String tenantId = builder.tenantId;\n+    if (tenantId == null) {\n+      this.userMgtBaseUrl = idToolkitUrlV1;\n+      this.idpConfigMgtBaseUrl = idToolkitUrlV2 + \"/oauthIdpConfigs\";\n     } else {\n       checkArgument(!tenantId.isEmpty(), \"tenant ID must not be empty\");\n-      this.userMgtBaseUrl =\n-          String.format(ID_TOOLKIT_URL, \"v1\", projectId) + getTenantUrlSuffix(tenantId);\n+      this.userMgtBaseUrl = idToolkitUrlV1 + getTenantUrlSuffix(tenantId);\n+      this.idpConfigMgtBaseUrl = idToolkitUrlV2 + getTenantUrlSuffix(tenantId) + \"/oauthIdpConfigs\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e47744e81cc20c49107644a23f6eb6e572a627c"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b3cf9e9279a1bd206e0ffda0856076f0ad48a44", "author": {"user": {"login": "micahstairs", "name": "Micah Stairs"}}, "url": "https://github.com/firebase/firebase-admin-java/commit/5b3cf9e9279a1bd206e0ffda0856076f0ad48a44", "committedDate": "2020-04-29T19:00:18Z", "message": "Remove '/oauthIdpConfigs' from idpConfigMgtBaseUrl."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyOTk2NjU5", "url": "https://github.com/firebase/firebase-admin-java/pull/400#pullrequestreview-402996659", "createdAt": "2020-04-29T20:03:42Z", "commit": {"oid": "5b3cf9e9279a1bd206e0ffda0856076f0ad48a44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDI5MzQ5", "url": "https://github.com/firebase/firebase-admin-java/pull/400#pullrequestreview-403029349", "createdAt": "2020-04-29T20:51:43Z", "commit": {"oid": "5b3cf9e9279a1bd206e0ffda0856076f0ad48a44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2856, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}