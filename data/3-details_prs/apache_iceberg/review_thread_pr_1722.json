{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NTYxMTYy", "number": 1722, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOToyNTo1N1rOE1z2Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo1MzoxOVrOE2LrBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0ODU5NDA2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/iceberg/expressions/Expressions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOToyNTo1N1rOHuTAjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOToyNTo1N1rOHuTAjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMwNzk4MQ==", "bodyText": "I don't see any uses of this factory method in Spark, Flink, or MR/Hive so luckily, I don't think that this affects engines. (And I would expect it to be caught quickly by Spark tests if we did.) I think that decreases the urgency of this fix, but it still affects API users.\nThanks for catching this, @yyanyy!", "url": "https://github.com/apache/iceberg/pull/1722#discussion_r518307981", "createdAt": "2020-11-05T19:25:57Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/expressions/Expressions.java", "diffHunk": "@@ -120,7 +120,7 @@ public static Expression not(Expression child) {\n   }\n \n   public static <T> UnboundPredicate<T> notNull(UnboundTerm<T> expr) {\n-    return new UnboundPredicate<>(Expression.Operation.IS_NULL, expr);\n+    return new UnboundPredicate<>(Expression.Operation.NOT_NULL, expr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b538644c0da8c3e14eed636d5d8db9dce331c842"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjQ5Nzk4OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/apache/iceberg/expressions/TestEvaluator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo1MzoxOVrOHu30_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo1MzoxOVrOHu30_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkxMTIyOQ==", "bodyText": "Let's revert all of the changes to this file.\nWhat we need to test for this PR is that Expressions.notNull(UnboundTerm) creates an expression with operation NOT_NULL. The changes here are really large and change many, many more cases.\nThese changes basically migrate to using the UnboundTerm factory methods in Expressions for all of the cases, which is not what we want. This suite tests the Evaluator, not Expressions.\nIt would be great to add more cases to the TestExpressionHelpers suite for the Expressions factory methods that validates notNull results in UnboundPredicate with op() == NOT_NULL. We can also add more cases to cover more of Expressions, but I don't think this suite needs to change.", "url": "https://github.com/apache/iceberg/pull/1722#discussion_r518911229", "createdAt": "2020-11-06T17:53:19Z", "author": {"login": "rdblue"}, "path": "api/src/test/java/org/apache/iceberg/expressions/TestEvaluator.java", "diffHunk": "@@ -63,11 +66,20 @@\n \n   @Test\n   public void testLessThan() {\n-    Evaluator evaluator = new Evaluator(STRUCT, lessThan(\"x\", 7));\n+    testLessThan(new Evaluator(STRUCT, lessThan(\"x\", 7)),\n+        new Evaluator(STRUCT, lessThan(\"s1.s2.s3.s4.i\", 7)));\n+  }\n+\n+  @Test\n+  public void testLessThanWithUnboundTerm() {\n+    testLessThan(new Evaluator(STRUCT, lessThan(self(\"x\"), 7)),\n+        new Evaluator(STRUCT, lessThan(self(\"s1.s2.s3.s4.i\"), 7)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b538644c0da8c3e14eed636d5d8db9dce331c842"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3388, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}