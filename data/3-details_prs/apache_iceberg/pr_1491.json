{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNjc3MTI5", "number": 1491, "title": "[API][Core - Types/Avro][Parquet] Add a precondition null check for the constructor arg of PruneColumns", "bodyText": "The class PruneColumns has a single constructor, which takes in a Set, PruneColumns(Set<Integer> selected).\nLater on in this class, there are no null checks before calling methods on the value selected such as contains, etc.\nAdmittedly, the only place that PruneColumns is currently used, org.apache.iceberg.types.TypeUtils#select(Types.StructType struct, Set<Integer> fieldIds), has a precondition check for null on fieldIds - which is passed into PruneColumns. Thus, it is arguably not necessary to add this additional check with the code as is.\nHowever, because the class PruneColumns is part of api and might get used elsewhere, it seems sane to add this precondition check given that we do no null checking before accessing it and so it would be up to the caller to add the preconditions check if they were to reuse it.\nLastly, it's important to note that PruneColumns,  while part of api, is not declared as public and so one could argue that this is not needed given that it's internal to iceberg and anybody using it should just know that its constructor argument must be non-null. I'm not a personal believer in tribal knowledge like that, and so I'm opening this PR.\nIf we don't think this PR is necessary, given the precondition check in the one and only place that it is currently used, then we can go ahead and close this PR.", "createdAt": "2020-09-23T10:31:09Z", "url": "https://github.com/apache/iceberg/pull/1491", "merged": true, "mergeCommit": {"oid": "465369c342ac99401695e007559af4ead0188f59"}, "closed": true, "closedAt": "2020-09-29T00:30:47Z", "author": {"login": "kbendick"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLp56dAH2gAyNDkxNjc3MTI5OmU5OTMxNGNjZWM1NDZkZmMzZmZiYTFlYzEyMjVhNTY4OWM5ZDI0OWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdM28-WAH2gAyNDkxNjc3MTI5OmUzZWI2YTdhZGM4OWFjNGZmZDc1MGZhNDY2Njk1NTkyZjA1YWE0OWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e99314ccec546dfc3ffba1ec1225a5689c9d249a", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/e99314ccec546dfc3ffba1ec1225a5689c9d249a", "committedDate": "2020-09-23T10:19:46Z", "message": "Adds a not null check for the constructor argument of PruneColumns"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1ODI3NDgy", "url": "https://github.com/apache/iceberg/pull/1491#pullrequestreview-495827482", "createdAt": "2020-09-24T18:09:27Z", "commit": {"oid": "e99314ccec546dfc3ffba1ec1225a5689c9d249a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODowOToyN1rOHXmtWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODowOToyN1rOHXmtWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxMzQ5Ng==", "bodyText": "Rather than just using the name of the variable, I think this should give more context to users when it happens. \"Field id set\" or \"Selected field ids\" would be better.", "url": "https://github.com/apache/iceberg/pull/1491#discussion_r494513496", "createdAt": "2020-09-24T18:09:27Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/types/PruneColumns.java", "diffHunk": "@@ -22,12 +22,14 @@\n import java.util.List;\n import java.util.Set;\n import org.apache.iceberg.Schema;\n+import org.apache.iceberg.relocated.com.google.common.base.Preconditions;\n import org.apache.iceberg.relocated.com.google.common.collect.Lists;\n \n class PruneColumns extends TypeUtil.SchemaVisitor<Type> {\n   private final Set<Integer> selected;\n \n   PruneColumns(Set<Integer> selected) {\n+    Preconditions.checkNotNull(selected, \"Selected cannot be null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e99314ccec546dfc3ffba1ec1225a5689c9d249a"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "078d7066ef4935dc796646186dc6f349dacd6e94", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/078d7066ef4935dc796646186dc6f349dacd6e94", "committedDate": "2020-09-27T02:43:32Z", "message": "Use more explicit language in message of added precondition check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d805d403348221026b5f8eccbcc5fbfacfd0ff35", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/d805d403348221026b5f8eccbcc5fbfacfd0ff35", "committedDate": "2020-09-27T02:47:52Z", "message": "Adds precondition checks to more classs named PruneColumns with same patterns using null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDQ1NTk1", "url": "https://github.com/apache/iceberg/pull/1491#pullrequestreview-497045595", "createdAt": "2020-09-27T02:52:50Z", "commit": {"oid": "d805d403348221026b5f8eccbcc5fbfacfd0ff35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMjo1Mjo1MFrOHYkIVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMjo1Mjo1MFrOHYkIVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxOTgyOQ==", "bodyText": "I will also check if nameMapping needs a precondition null check.", "url": "https://github.com/apache/iceberg/pull/1491#discussion_r495519829", "createdAt": "2020-09-27T02:52:50Z", "author": {"login": "kbendick"}, "path": "core/src/main/java/org/apache/iceberg/avro/PruneColumns.java", "diffHunk": "@@ -39,6 +39,7 @@\n   private final NameMapping nameMapping;\n \n   PruneColumns(Set<Integer> selectedIds, NameMapping nameMapping) {\n+    Preconditions.checkNotNull(selectedIds, \"Selected field ids cannot be null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d805d403348221026b5f8eccbcc5fbfacfd0ff35"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3eb6a7adc89ac4ffd750fa466695592f05aa49e", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/e3eb6a7adc89ac4ffd750fa466695592f05aa49e", "committedDate": "2020-09-27T04:05:48Z", "message": "Adds in missing import for Preconditions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3820, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}