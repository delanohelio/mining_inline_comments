{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMDM4ODk3", "number": 1429, "title": "Core: Lower the log level of warning message on refresh() for NoSuchIcebergTableException", "bodyText": "Closes #1428\nThis patch adjusts the log level on NoSuchTableException in refresh() with HiveCatalog, specific to the NoSuchIcebergTableException, which can be occurred in the \"normal\" case, like below:\n\nUse default spark catalog with type=hive\nRead non-iceberg table", "createdAt": "2020-09-07T04:36:40Z", "url": "https://github.com/apache/iceberg/pull/1429", "merged": true, "mergeCommit": {"oid": "9978d39a2f6d8d69553a123b507ddf9307f44c35"}, "closed": true, "closedAt": "2020-09-09T23:49:34Z", "author": {"login": "HeartSaVioR"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGbSfigH2gAyNDgxMDM4ODk3OjZhZjZjNjg4MDcyMDkyNjc4ZDQ0ZmE2ZDdkNDkzNzE5ZTZkNzUzYWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHBwujAH2gAyNDgxMDM4ODk3OjllODVjNDBmYjA2MmMyZGQ2NTYxN2U0MGU1YWNlNzRmOTgzODMzMTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6af6c688072092678d44fa6d7d493719e6d753ac", "author": {"user": {"login": "HeartSaVioR", "name": "Jungtaek Lim"}}, "url": "https://github.com/apache/iceberg/commit/6af6c688072092678d44fa6d7d493719e6d753ac", "committedDate": "2020-09-07T04:28:25Z", "message": "[CORE] lower the log level of warning message on refresh() for NoSuchIcebergTableException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjM4MjQy", "url": "https://github.com/apache/iceberg/pull/1429#pullrequestreview-483238242", "createdAt": "2020-09-07T04:44:26Z", "commit": {"oid": "6af6c688072092678d44fa6d7d493719e6d753ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNDo0NDoyN1rOHNwAVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNDo0NDoyN1rOHNwAVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE4MDA1NA==", "bodyText": "It's also OK for me to just lower down the log level for NoSuchTableException, but would like to hear the voice first before applying it.", "url": "https://github.com/apache/iceberg/pull/1429#discussion_r484180054", "createdAt": "2020-09-07T04:44:27Z", "author": {"login": "HeartSaVioR"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -75,7 +76,14 @@ public TableMetadata refresh() {\n     try {\n       doRefresh();\n     } catch (NoSuchTableException e) {\n-      LOG.warn(\"Could not find the table during refresh, setting current metadata to null\", e);\n+      // Adjust log level according to the type of exception, as it might be intentional to call\n+      // the method without determining the type of table in prior (like SparkSessionCatalog),\n+      // and in such case it may not be an error case if the table is not an Iceberg table.\n+      if (e instanceof NoSuchIcebergTableException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6af6c688072092678d44fa6d7d493719e6d753ac"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9999df716c3ceb2557f79e3f97ad5286db8ca94d", "author": {"user": {"login": "HeartSaVioR", "name": "Jungtaek Lim"}}, "url": "https://github.com/apache/iceberg/commit/9999df716c3ceb2557f79e3f97ad5286db8ca94d", "committedDate": "2020-09-08T23:01:16Z", "message": "Reflect review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTUxMjk5", "url": "https://github.com/apache/iceberg/pull/1429#pullrequestreview-484551299", "createdAt": "2020-09-08T23:03:21Z", "commit": {"oid": "9999df716c3ceb2557f79e3f97ad5286db8ca94d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMzowMzoyMlrOHOw0oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMzowMzoyMlrOHOw0oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0MjAxNg==", "bodyText": "I'm not 100% certain that re-setting fields is valid only for when the if statement is true. If then we can move things into if statement, but otherwise I guess it can be left as it is. At least leaving it as it is won't hurt anything.", "url": "https://github.com/apache/iceberg/pull/1429#discussion_r485242016", "createdAt": "2020-09-08T23:03:22Z", "author": {"login": "HeartSaVioR"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -72,10 +73,14 @@ public int currentVersion() {\n \n   @Override\n   public TableMetadata refresh() {\n+    boolean currentMetadataWasAvailable = currentMetadata != null;\n     try {\n       doRefresh();\n     } catch (NoSuchTableException e) {\n-      LOG.warn(\"Could not find the table during refresh, setting current metadata to null\", e);\n+      if (currentMetadataWasAvailable) {\n+        LOG.warn(\"Could not find the table during refresh, setting current metadata to null\", e);\n+      }\n+\n       currentMetadata = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9999df716c3ceb2557f79e3f97ad5286db8ca94d"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e85c40fb062c2dd65617e40e5ace74f98383311", "author": {"user": {"login": "HeartSaVioR", "name": "Jungtaek Lim"}}, "url": "https://github.com/apache/iceberg/commit/9e85c40fb062c2dd65617e40e5ace74f98383311", "committedDate": "2020-09-09T01:17:50Z", "message": "Unused import"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4180, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}