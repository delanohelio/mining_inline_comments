{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1Mzg1NTMx", "number": 1080, "title": "Split Snapshot.manifests into dataManifests and deleteManifests", "bodyText": "This replaces all calls to Snapshot.manifests with calls to one of 3 new methods:\n\nSnapshot.allManifests returns both delete and data manifests\nSnapshot.deleteManifests returns only delete manifests\nSnapshot.dataManifests returns only data manifests\n\nExisting references mostly use either allManifests or dataManifests, depending on the context. For example, tests with assertions for the number of manifests use allManifests because the test cases should validate there are no new delete manifests, but other tests that validate rewritten manifests are deleted use dataManifests because only data manifests are rewritten and deleted.\nThis tries to make minimal changes that preserve the current behavior. Operations are not updated to support delete manifests (rewrite still only rewrites data manifests), but will carry through the list of delete manifests correctly.\nAfter this commit, we should be able to work in parallel on:\n\nJob planning with delete manifests and delete files\nUpdating MergingSnapshotProducer to handle delete manifests\nUpdating rewrite actions to handle deletes", "createdAt": "2020-05-30T00:29:19Z", "url": "https://github.com/apache/iceberg/pull/1080", "merged": true, "mergeCommit": {"oid": "482f420141486f5b7b02bd62dc14cdb94b9a9cca"}, "closed": true, "closedAt": "2020-06-02T19:43:04Z", "author": {"login": "rdblue"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmMAeXgFqTQyMTM1OTc0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnaKcWAFqTQyMjk5OTUzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzU5NzQ3", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-421359747", "createdAt": "2020-05-30T00:34:35Z", "commit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozNDozNVrOGcvhFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozNDozNVrOGcvhFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5MTgzMA==", "bodyText": "This is no longer needed. It was used to find all manifest entries for a file to help debug changes. Now that can be handled in parallel by the all_entries metadata table.", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r432791830", "createdAt": "2020-05-30T00:34:35Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/FileHistory.java", "diffHunk": "@@ -1,119 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-\n-package org.apache.iceberg;\n-\n-import java.io.IOException;\n-import java.util.List;\n-import java.util.Set;\n-import org.apache.iceberg.exceptions.RuntimeIOException;\n-import org.apache.iceberg.expressions.Literal;\n-import org.apache.iceberg.io.CloseableIterable;\n-import org.apache.iceberg.relocated.com.google.common.collect.ImmutableList;\n-import org.apache.iceberg.relocated.com.google.common.collect.Iterables;\n-import org.apache.iceberg.relocated.com.google.common.collect.Lists;\n-import org.apache.iceberg.relocated.com.google.common.collect.Sets;\n-import org.apache.iceberg.types.Types;\n-import org.apache.iceberg.util.CharSequenceWrapper;\n-\n-public class FileHistory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzYwMDEx", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-421360011", "createdAt": "2020-05-30T00:36:47Z", "commit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozNjo0N1rOGcviRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozNjo0N1rOGcviRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5MjEzNA==", "bodyText": "The contract for this class is to return matching data files, not splits. We use it in some cases to avoid newScan that will return either FileScanTask or CombinedScanTask and will emit a scan event. I think we may be able to remove it, or update it to return both data and delete files. For now, this uses dataManifests to mimic the current behavior.", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r432792134", "createdAt": "2020-05-30T00:36:47Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/FindFiles.java", "diffHunk": "@@ -197,7 +197,7 @@ public Builder inPartitions(PartitionSpec spec, List<StructLike> partitions) {\n       }\n \n       // when snapshot is not null\n-      CloseableIterable<ManifestEntry<DataFile>> entries = new ManifestGroup(ops.io(), snapshot.manifests())\n+      CloseableIterable<ManifestEntry<DataFile>> entries = new ManifestGroup(ops.io(), snapshot.dataManifests())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzYwMDY2", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-421360066", "createdAt": "2020-05-30T00:37:12Z", "commit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozNzoxM1rOGcvifg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozNzoxM1rOGcvifg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5MjE5MA==", "bodyText": "For now, scans continue to ignore delete manifests and delete files.", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r432792190", "createdAt": "2020-05-30T00:37:13Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/IncrementalDataTableScan.java", "diffHunk": "@@ -84,7 +84,7 @@ public TableScan appendsAfter(long newFromSnapshotId) {\n     Set<Long> snapshotIds = Sets.newHashSet(Iterables.transform(snapshots, Snapshot::snapshotId));\n     Set<ManifestFile> manifests = FluentIterable\n         .from(snapshots)\n-        .transformAndConcat(s -> s.manifests())\n+        .transformAndConcat(s -> s.dataManifests())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzYwMjM1", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-421360235", "createdAt": "2020-05-30T00:38:17Z", "commit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozODoxN1rOGcvjLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDozODoxN1rOGcvjLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5MjM2Ng==", "bodyText": "Carry forward delete manifests, if present.", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r432792366", "createdAt": "2020-05-30T00:38:17Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/MergingSnapshotProducer.java", "diffHunk": "@@ -297,6 +297,9 @@ private ManifestFile copyManifest(ManifestFile manifest) {\n       Set<CharSequenceWrapper> deletedFiles = deletedFiles(unmergedManifests);\n \n       List<ManifestFile> manifests = Lists.newArrayList();\n+      if (current != null) {\n+        manifests.addAll(current.deleteManifests());\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f3dfce5c89b4ca0a5bafba524953605efbb5d33", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/7f3dfce5c89b4ca0a5bafba524953605efbb5d33", "committedDate": "2020-05-30T00:52:55Z", "message": "Split Snapshot.manifests into dataManifests and deleteManifests."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "411bd27253cd707a1e92f2e58c382dd9558dadde", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/411bd27253cd707a1e92f2e58c382dd9558dadde", "committedDate": "2020-05-30T00:28:01Z", "message": "Split Snapshot.manifests into dataManifests and deleteManifests."}, "afterCommit": {"oid": "7f3dfce5c89b4ca0a5bafba524953605efbb5d33", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/7f3dfce5c89b4ca0a5bafba524953605efbb5d33", "committedDate": "2020-05-30T00:52:55Z", "message": "Split Snapshot.manifests into dataManifests and deleteManifests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzYwMTkz", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-421760193", "createdAt": "2020-06-01T11:03:17Z", "commit": {"oid": "7f3dfce5c89b4ca0a5bafba524953605efbb5d33"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8342d26ae815753c4cf26c63e73c6df0500037af", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/8342d26ae815753c4cf26c63e73c6df0500037af", "committedDate": "2020-06-01T17:04:48Z", "message": "Fix checkstyle."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc082c5cc0c3b2098855531d2c2a5dc462773fac", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/bc082c5cc0c3b2098855531d2c2a5dc462773fac", "committedDate": "2020-06-01T19:15:29Z", "message": "Fix test failures."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b", "committedDate": "2020-06-01T20:29:01Z", "message": "Fix manifest caching."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNTE0NzEz", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-422514713", "createdAt": "2020-06-02T09:44:46Z", "commit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTo0NDo0NlrOGdqLrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTo1ODowM1rOGdqpGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc1MzAwNg==", "bodyText": "This and two other tests use dataManifests() where all other tests have been changed to allManifests(). Is this intentional?\nOther tests:\nTestRemoveSnapshots\nRewriteManifestsAction", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r433753006", "createdAt": "2020-06-02T09:44:46Z", "author": {"login": "rymurr"}, "path": "core/src/test/java/org/apache/iceberg/TableTestBase.java", "diffHunk": "@@ -224,10 +224,10 @@ void validateSnapshot(Snapshot old, Snapshot snap, long sequenceNumber, DataFile\n   }\n \n   void validateSnapshot(Snapshot old, Snapshot snap, Long sequenceNumber, DataFile... newFiles) {\n-    List<ManifestFile> oldManifests = old != null ? old.manifests() : ImmutableList.of();\n+    List<ManifestFile> oldManifests = old != null ? old.dataManifests() : ImmutableList.of();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc1NTY0Mw==", "bodyText": "Is this explicitly ignoring the effect of deleted rows on partition metrics or is it just that you are short circuiting any delete files (as we can't use them anyways)", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r433755643", "createdAt": "2020-06-02T09:49:23Z", "author": {"login": "rymurr"}, "path": "core/src/main/java/org/apache/iceberg/ScanSummary.java", "diffHunk": "@@ -159,7 +159,7 @@ private void removeTimeFilters(List<Expression> expressions, Expression expressi\n       removeTimeFilters(filters, Expressions.rewriteNot(scan.filter()));\n       Expression rowFilter = joinFilters(filters);\n \n-      Iterable<ManifestFile> manifests = table.currentSnapshot().manifests();\n+      Iterable<ManifestFile> manifests = table.currentSnapshot().dataManifests();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc1ODU3OA==", "bodyText": "The addition of delete files in newManifests far above the addition of data files threw me a bit. Is it intentional to ensure the delete files are at the front of the list?", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r433758578", "createdAt": "2020-06-02T09:54:36Z", "author": {"login": "rymurr"}, "path": "core/src/main/java/org/apache/iceberg/FastAppend.java", "diffHunk": "@@ -122,6 +122,10 @@ private ManifestFile copyManifest(ManifestFile manifest) {\n   public List<ManifestFile> apply(TableMetadata base) {\n     List<ManifestFile> newManifests = Lists.newArrayList();\n \n+    if (base.currentSnapshot() != null) {\n+      newManifests.addAll(base.currentSnapshot().deleteManifests());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc2MDE0Ng==", "bodyText": "Here data manifests are (potentially) rewritten while keeping deletes the same. Again with deletes at the front. Do I understand correctly? The comment is a bit misleading as immediately below it old delete manifests are added to the list.", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r433760146", "createdAt": "2020-06-02T09:57:23Z", "author": {"login": "rymurr"}, "path": "core/src/main/java/org/apache/iceberg/BaseRewriteManifests.java", "diffHunk": "@@ -174,13 +173,13 @@ private ManifestFile copyManifest(ManifestFile manifest) {\n \n     validateFilesCounts();\n \n-    // TODO: add sequence numbers here\n     Iterable<ManifestFile> newManifestsWithMetadata = Iterables.transform(\n         Iterables.concat(newManifests, addedManifests, rewrittenAddedManifests),\n         manifest -> GenericManifestFile.copyOf(manifest).withSnapshotId(snapshotId()).build());\n \n     // put new manifests at the beginning\n-    List<ManifestFile> apply = new ArrayList<>();\n+    List<ManifestFile> apply = Lists.newArrayList();\n+    apply.addAll(base.currentSnapshot().deleteManifests());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc2MDUzNg==", "bodyText": "I am not sure I understand the comment here or why dataManifests is used instead of allManifests", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r433760536", "createdAt": "2020-06-02T09:58:03Z", "author": {"login": "rymurr"}, "path": "core/src/main/java/org/apache/iceberg/AllManifestsTable.java", "diffHunk": "@@ -136,7 +136,7 @@ protected long targetSplitSize(TableOperations ops) {\n         } else {\n           return StaticDataTask.of(\n               ops.io().newInputFile(ops.current().file().location()),\n-              snap.manifests(),\n+              snap.dataManifests(), // if the manifest list is missing, the table must be v1 and has no delete manifests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODI0OTA4", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-422824908", "createdAt": "2020-06-02T15:55:09Z", "commit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTo1NTowOVrOGd4gnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoxNjozOFrOGd5kfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4Nzc0MQ==", "bodyText": "This seem like a breaking change to the public API. Technically, the old description already assumed a list of all manifests. Do we think it is better to change it now to avoid confusion and misuse?", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r433987741", "createdAt": "2020-06-02T15:55:09Z", "author": {"login": "aokolnychyi"}, "path": "api/src/main/java/org/apache/iceberg/Snapshot.java", "diffHunk": "@@ -64,13 +64,25 @@\n   long timestampMillis();\n \n   /**\n-   * Return the location of all manifests in this snapshot.\n-   * <p>\n-   * The current table is made of the union of the data files in these manifests.\n+   * Return all {@link ManifestFile} instances for either data or delete manifests in this snapshot.\n+   *\n+   * @return a list of ManifestFile\n+   */\n+  List<ManifestFile> allManifests();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwNTExOQ==", "bodyText": "Shouldn't this table return all manifests?", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r434005119", "createdAt": "2020-06-02T16:16:38Z", "author": {"login": "aokolnychyi"}, "path": "core/src/main/java/org/apache/iceberg/AllManifestsTable.java", "diffHunk": "@@ -136,7 +136,7 @@ protected long targetSplitSize(TableOperations ops) {\n         } else {\n           return StaticDataTask.of(\n               ops.io().newInputFile(ops.current().file().location()),\n-              snap.manifests(),\n+              snap.dataManifests(), // if the manifest list is missing, the table must be v1 and has no delete manifests", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc2MDUzNg=="}, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODQ1MzU4", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-422845358", "createdAt": "2020-06-02T16:18:59Z", "commit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoxOTowMFrOGd5qjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoxOTowMFrOGd5qjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwNjY3MQ==", "bodyText": "The list of manifests can contain 1-2k entries, will iterating through that list twice here have an impact on performance?", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r434006671", "createdAt": "2020-06-02T16:19:00Z", "author": {"login": "aokolnychyi"}, "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -120,14 +122,42 @@ public String operation() {\n     return summary;\n   }\n \n-  @Override\n-  public List<ManifestFile> manifests() {\n-    if (manifests == null) {\n+  private void cacheManifests() {\n+    if (allManifests == null) {\n       // if manifests isn't set, then the snapshotFile is set and should be read to get the list\n-      this.manifests = ManifestLists.read(manifestList);\n+      this.allManifests = ManifestLists.read(manifestList);\n+    }\n+\n+    if (dataManifests == null) {\n+      this.dataManifests = ImmutableList.copyOf(Iterables.filter(allManifests,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODQ3Nzc4", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-422847778", "createdAt": "2020-06-02T16:21:48Z", "commit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoyMTo0OFrOGd5xug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoyMTo0OFrOGd5xug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODUwNg==", "bodyText": "Do we have to reason about thread safety like we do in PartitionSpec, for example?", "url": "https://github.com/apache/iceberg/pull/1080#discussion_r434008506", "createdAt": "2020-06-02T16:21:48Z", "author": {"login": "aokolnychyi"}, "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -120,14 +122,42 @@ public String operation() {\n     return summary;\n   }\n \n-  @Override\n-  public List<ManifestFile> manifests() {\n-    if (manifests == null) {\n+  private void cacheManifests() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b7f05c3a87c1bc4a5e31c4225a98cbacfd0c35b"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e565075882ff3691bf6dc6ba315094c046ed7bda", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/e565075882ff3691bf6dc6ba315094c046ed7bda", "committedDate": "2020-06-02T17:38:25Z", "message": "Update after reviews."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTk5NTM2", "url": "https://github.com/apache/iceberg/pull/1080#pullrequestreview-422999536", "createdAt": "2020-06-02T19:38:04Z", "commit": {"oid": "e565075882ff3691bf6dc6ba315094c046ed7bda"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4471, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}