{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNDM1MzQ4", "number": 1149, "title": "Support namespaces in SparkCatalog", "bodyText": "This adds SupportsNamespaces to SparkCatalog and adds tests in TestNamespaceSQL.\nThis also adds a couple of new base classes for Spark tests that will be used for other SQL test suites.", "createdAt": "2020-07-01T04:36:02Z", "url": "https://github.com/apache/iceberg/pull/1149", "merged": true, "mergeCommit": {"oid": "0bad6703bc8796387f3084a2120209002ad13d54"}, "closed": true, "closedAt": "2020-07-01T23:44:38Z", "author": {"login": "rdblue"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwiu6yABqjM1MDA2Mjc4ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwydxQgH2gAyNDQyNDM1MzQ4OjM5NmYyM2JhNWRmYTQ5ODg5MmQ2YzFlNzEyOTM0ODkzZjAzY2U1MWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06a1e552782e4f5f92ec252f7c5be00f7ec60955", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/06a1e552782e4f5f92ec252f7c5be00f7ec60955", "committedDate": "2020-07-01T04:34:55Z", "message": "Support namespaces in SparkCatalog."}, "afterCommit": {"oid": "c742c1e2762e1dfaf1d99bbbfbc8911c04ae1075", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/c742c1e2762e1dfaf1d99bbbfbc8911c04ae1075", "committedDate": "2020-07-01T04:42:18Z", "message": "Support namespaces in SparkCatalog."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "committedDate": "2020-07-01T17:56:57Z", "message": "Support namespaces in SparkCatalog."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41c564644b9160eb2fdeee369c60f6db151b12d2", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/41c564644b9160eb2fdeee369c60f6db151b12d2", "committedDate": "2020-07-01T16:27:07Z", "message": "Fix Hadoop namespace test."}, "afterCommit": {"oid": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "committedDate": "2020-07-01T17:56:57Z", "message": "Support namespaces in SparkCatalog."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjMzNDYy", "url": "https://github.com/apache/iceberg/pull/1149#pullrequestreview-441233462", "createdAt": "2020-07-01T22:22:42Z", "commit": {"oid": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMjoyMjo0MlrOGr3NFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMjoyMjo0MlrOGr3NFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NjQyMw==", "bodyText": "Maybe I'm missing something here, but doesn't this actually break for HadoopCatalog without the default set of keys (it'll drop through and be rejected in the else block)?", "url": "https://github.com/apache/iceberg/pull/1149#discussion_r448646423", "createdAt": "2020-07-01T22:22:42Z", "author": {"login": "danielcweeks"}, "path": "spark3/src/main/java/org/apache/iceberg/spark/SparkCatalog.java", "diffHunk": "@@ -228,13 +247,141 @@ public void invalidateTable(Identifier ident) {\n     }\n   }\n \n+  @Override\n+  public Identifier[] listTables(String[] namespace) {\n+    return icebergCatalog.listTables(Namespace.of(namespace)).stream()\n+        .map(ident -> Identifier.of(ident.namespace().levels(), ident.name()))\n+        .toArray(Identifier[]::new);\n+  }\n+\n+  @Override\n+  public String[] defaultNamespace() {\n+    if (defaultNamespace != null) {\n+      return defaultNamespace;\n+    }\n+\n+    return new String[0];\n+  }\n+\n+  @Override\n+  public String[][] listNamespaces() {\n+    if (asNamespaceCatalog != null) {\n+      return asNamespaceCatalog.listNamespaces().stream()\n+          .map(Namespace::levels)\n+          .toArray(String[][]::new);\n+    }\n+\n+    return new String[0][];\n+  }\n+\n+  @Override\n+  public String[][] listNamespaces(String[] namespace) throws NoSuchNamespaceException {\n+    if (asNamespaceCatalog != null) {\n+      try {\n+        return asNamespaceCatalog.listNamespaces(Namespace.of(namespace)).stream()\n+            .map(Namespace::levels)\n+            .toArray(String[][]::new);\n+      } catch (org.apache.iceberg.exceptions.NoSuchNamespaceException e) {\n+        throw new NoSuchNamespaceException(namespace);\n+      }\n+    }\n+\n+    throw new NoSuchNamespaceException(namespace);\n+  }\n+\n+  @Override\n+  public Map<String, String> loadNamespaceMetadata(String[] namespace) throws NoSuchNamespaceException {\n+    if (asNamespaceCatalog != null) {\n+      try {\n+        return asNamespaceCatalog.loadNamespaceMetadata(Namespace.of(namespace));\n+      } catch (org.apache.iceberg.exceptions.NoSuchNamespaceException e) {\n+        throw new NoSuchNamespaceException(namespace);\n+      }\n+    }\n+\n+    throw new NoSuchNamespaceException(namespace);\n+  }\n+\n+  @Override\n+  public void createNamespace(String[] namespace, Map<String, String> metadata) throws NamespaceAlreadyExistsException {\n+    if (asNamespaceCatalog != null) {\n+      try {\n+        if (asNamespaceCatalog instanceof HadoopCatalog && DEFAULT_NS_KEYS.equals(metadata.keySet())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07"}, "originalPosition": 143}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f43d951f3d66a527244c8bc1b803aa08e22d4e", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/26f43d951f3d66a527244c8bc1b803aa08e22d4e", "committedDate": "2020-07-01T22:50:58Z", "message": "Fix checkstyle problem in TestNamespaceSQL."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "396f23ba5dfa498892d6c1e712934893f03ce51b", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/396f23ba5dfa498892d6c1e712934893f03ce51b", "committedDate": "2020-07-01T23:02:13Z", "message": "Make SparkCatalogTestBase abstract to avoid running it as a suite."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4576, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}