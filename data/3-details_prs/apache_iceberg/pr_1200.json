{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NjE0MzUy", "number": 1200, "title": "HadoopCatalog.dropNamespace throw NamespaceNotEmptyException when Namespace is not empty", "bodyText": "What is the purpose of the change\nIn HadoopCatalog.dropNamespace, throws RuntimeIOException(\"Namespace delete failed\") when Namespace is not empty, but according to SupportsNamespaces.dropNamespace, should throw NamespaceNotEmptyException.\nBrief change log\nBefore delete, check listStatus first.", "createdAt": "2020-07-14T03:06:43Z", "url": "https://github.com/apache/iceberg/pull/1200", "merged": true, "mergeCommit": {"oid": "c2323b774725139dea401bac4837d7e706ba5ed2"}, "closed": true, "closedAt": "2020-07-14T17:24:20Z", "author": {"login": "JingsongLi"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0tHTdgH2gAyNDQ4NjE0MzUyOmI3NGEyMDkzZTVhMGFjN2E0NzJiYTg4N2Y1ZDVjNDcwNGM2MTY2NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0wPYJgH2gAyNDQ4NjE0MzUyOjFjYWQ2NWU0ODkzYjc0NmIzNjVjMGI2MTY5ZTkyNzI0NGU4MGMwMDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b74a2093e5a0ac7a472ba887f5d5c4704c61665f", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/b74a2093e5a0ac7a472ba887f5d5c4704c61665f", "committedDate": "2020-07-14T03:03:51Z", "message": "HadoopCatalog.dropNamespace should throw NamespaceNotEmptyException when Namespace is not empty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODA5ODg5", "url": "https://github.com/apache/iceberg/pull/1200#pullrequestreview-447809889", "createdAt": "2020-07-14T06:02:20Z", "commit": {"oid": "b74a2093e5a0ac7a472ba887f5d5c4704c61665f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjowMjoyMFrOGxFXRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjowMjoyMFrOGxFXRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMTI4NA==", "bodyText": "listStatus returns an array which means it lists all the files before returning. Should we use listFiles which returns an Iterator. Iterator could be a lot more efficient as we do not need to list all the underlying files in the dir and we can simply do listFiles.hasNext", "url": "https://github.com/apache/iceberg/pull/1200#discussion_r454121284", "createdAt": "2020-07-14T06:02:20Z", "author": {"login": "rdsr"}, "path": "core/src/main/java/org/apache/iceberg/hadoop/HadoopCatalog.java", "diffHunk": "@@ -276,8 +277,11 @@ public boolean dropNamespace(Namespace namespace) {\n     }\n \n     try {\n-      return fs.delete(nsPath, false /* recursive */);\n+      if (fs.listStatus(nsPath).length != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b74a2093e5a0ac7a472ba887f5d5c4704c61665f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cad65e4893b746b365c0b6169e927244e80c008", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/1cad65e4893b746b365c0b6169e927244e80c008", "committedDate": "2020-07-14T06:42:23Z", "message": "Fix comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4258, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}