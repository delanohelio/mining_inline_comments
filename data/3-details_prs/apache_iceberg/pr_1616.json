{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MjUyNTc3", "number": 1616, "title": "Seperate Action Implementations into Spark Specific Modules - With Reflection", "bodyText": "Uses reflection in the base Actions class to determine the actual\nimplementation on the classloader to use. This allows both Spark2\nand Spark3 to use different implementations of Actions while not\nchanging the location of the original Actions class.", "createdAt": "2020-10-15T17:07:52Z", "url": "https://github.com/apache/iceberg/pull/1616", "merged": true, "mergeCommit": {"oid": "779dafd243a2630f414819c2f89f1170aa9e4205"}, "closed": true, "closedAt": "2020-10-22T17:14:49Z", "author": {"login": "RussellSpitzer"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdS09PzAH2gAyNTA0MjUyNTc3OjNmNWZiMmI3Njg5OGEzZmRjMmU5YmQ2ZTRiOTZkZjA2NzFlNTE4MGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVFMuQAFqTUxNDk0ODg5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f5fb2b76898a3fdc2e9bd6e4b96df0671e5180c", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/3f5fb2b76898a3fdc2e9bd6e4b96df0671e5180c", "committedDate": "2020-10-15T17:09:50Z", "message": "Seperate Action Implementations into Spark Specific Modules\n\nUses reflection in the base Actions class to determine the actual\nimplementation on the classloader to use. This allows both Spark2\nand Spark3 to use different implementations of Actions while not\nchanging the location of the original Actions class."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8b886ede34bd2348d66a9640404906bda8a46c0", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/b8b886ede34bd2348d66a9640404906bda8a46c0", "committedDate": "2020-10-15T17:06:04Z", "message": "Seperate Action Implementations into Spark Specific Modules\n\nUses reflection in the base Actions class to determine the actual\nimplementation on the classloader to use. This allows both Spark2\nand Spark3 to use different implementations of Actions while not\nchanging the location of the original Actions class."}, "afterCommit": {"oid": "3f5fb2b76898a3fdc2e9bd6e4b96df0671e5180c", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/3f5fb2b76898a3fdc2e9bd6e4b96df0671e5180c", "committedDate": "2020-10-15T17:09:50Z", "message": "Seperate Action Implementations into Spark Specific Modules\n\nUses reflection in the base Actions class to determine the actual\nimplementation on the classloader to use. This allows both Spark2\nand Spark3 to use different implementations of Actions while not\nchanging the location of the original Actions class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTQ3NzQ4", "url": "https://github.com/apache/iceberg/pull/1616#pullrequestreview-509947748", "createdAt": "2020-10-16T01:08:44Z", "commit": {"oid": "3f5fb2b76898a3fdc2e9bd6e4b96df0671e5180c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMTowODo0NVrOHig_Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMTowODo0NVrOHig_Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1NDA5MA==", "bodyText": "Using our reflection helpers, this could be simpler:\n  try {\n    DynConstructors.Ctor<Actions> ctor = DynConstructors.builder()\n            .impl(SparkActions.class, SparkSession.class, Table.class)\n            .build();\n    return ctor;\n  } catch (NoSuchMethodException e) {\n    throw new UnsupportedOperationException(\"Cannot find Actions implementation on the classpath\");\n  }", "url": "https://github.com/apache/iceberg/pull/1616#discussion_r505954090", "createdAt": "2020-10-16T01:08:45Z", "author": {"login": "rdblue"}, "path": "spark/src/main/java/org/apache/iceberg/actions/Actions.java", "diffHunk": "@@ -19,25 +19,57 @@\n \n package org.apache.iceberg.actions;\n \n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n import org.apache.iceberg.Table;\n import org.apache.spark.sql.SparkSession;\n \n public class Actions {\n+  private static final String IMPL_NAME = \"SparkActions\";\n+\n+  private static Class<Actions> implClass;\n+  private static Constructor<Actions> implConstructor;\n \n   private SparkSession spark;\n   private Table table;\n \n-  private Actions(SparkSession spark, Table table) {\n+  protected Actions(SparkSession spark, Table table) {\n     this.spark = spark;\n     this.table = table;\n   }\n \n+  private static Constructor actionConstructor() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f5fb2b76898a3fdc2e9bd6e4b96df0671e5180c"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdd4e8bd30329b13d364c5eea9c64663e482c2c5", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/cdd4e8bd30329b13d364c5eea9c64663e482c2c5", "committedDate": "2020-10-16T17:39:35Z", "message": "Switch to using Reflection Utils Class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef74466c646384350a26204f74a7c855360ba19e", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/ef74466c646384350a26204f74a7c855360ba19e", "committedDate": "2020-10-16T17:37:07Z", "message": "Switch to using Reflection Utils Class"}, "afterCommit": {"oid": "cdd4e8bd30329b13d364c5eea9c64663e482c2c5", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/cdd4e8bd30329b13d364c5eea9c64663e482c2c5", "committedDate": "2020-10-16T17:39:35Z", "message": "Switch to using Reflection Utils Class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzc0Mjgx", "url": "https://github.com/apache/iceberg/pull/1616#pullrequestreview-510774281", "createdAt": "2020-10-16T20:19:47Z", "commit": {"oid": "cdd4e8bd30329b13d364c5eea9c64663e482c2c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMDoxOTo0N1rOHjOpYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMDoxOTo0N1rOHjOpYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcwMjE3Nw==", "bodyText": "Do we need to make these public?", "url": "https://github.com/apache/iceberg/pull/1616#discussion_r506702177", "createdAt": "2020-10-16T20:19:47Z", "author": {"login": "aokolnychyi"}, "path": "spark2/src/main/java/org/apache/iceberg/actions/SparkActions.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.actions;\n+\n+import org.apache.iceberg.Table;\n+import org.apache.spark.sql.SparkSession;\n+\n+public class SparkActions extends Actions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdd4e8bd30329b13d364c5eea9c64663e482c2c5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f705469ed9efb67cac927eda56245dc3ea8664", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/32f705469ed9efb67cac927eda56245dc3ea8664", "committedDate": "2020-10-16T21:01:39Z", "message": "DynConstructors uses HiddenImpl for DeclaredConstructors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7acc1a024c7b50135cb71be3bbdecf26deff916", "author": {"user": {"login": "RussellSpitzer", "name": "Russell Spitzer"}}, "url": "https://github.com/apache/iceberg/commit/d7acc1a024c7b50135cb71be3bbdecf26deff916", "committedDate": "2020-10-19T15:21:25Z", "message": "Package Private SparkActions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0OTQ4ODkw", "url": "https://github.com/apache/iceberg/pull/1616#pullrequestreview-514948890", "createdAt": "2020-10-22T17:13:04Z", "commit": {"oid": "d7acc1a024c7b50135cb71be3bbdecf26deff916"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3967, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}