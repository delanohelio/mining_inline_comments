{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNTkwNDc2", "number": 1786, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoyMzo0NFrOE8a7YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoyMzo0NFrOE8a7YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNzkxMjAwOnYy", "diffSide": "RIGHT", "path": "aws/src/main/java/org/apache/iceberg/aws/s3/S3RequestUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoyMzo0NFrOH4huAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoyMzo0NFrOH4huAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzNDc1NQ==", "bodyText": "The null checks as controls feel a little awkward.  Would it make sense to switch them out for noop functions like:\n  private static final Function<ServerSideEncryption, S3Request.Builder> noSse = s -> null;\n  private static final Function<String, S3Request.Builder> noKms = (s) -> null;\n\nI feel like that would be easier to reason about.", "url": "https://github.com/apache/iceberg/pull/1786#discussion_r529034755", "createdAt": "2020-11-23T22:23:44Z", "author": {"login": "danielcweeks"}, "path": "aws/src/main/java/org/apache/iceberg/aws/s3/S3RequestUtil.java", "diffHunk": "@@ -33,87 +36,66 @@ private S3RequestUtil() {\n   }\n \n   static void configureEncryption(AwsProperties awsProperties, PutObjectRequest.Builder requestBuilder) {\n-    switch (awsProperties.s3FileIoSseType().toLowerCase(Locale.ENGLISH)) {\n-      case AwsProperties.S3FILEIO_SSE_TYPE_NONE:\n-        break;\n+    configureEncryption(awsProperties, requestBuilder::serverSideEncryption, requestBuilder::ssekmsKeyId,\n+        requestBuilder::sseCustomerAlgorithm, requestBuilder::sseCustomerKey, requestBuilder::sseCustomerKeyMD5);\n+  }\n \n-      case AwsProperties.S3FILEIO_SSE_TYPE_KMS:\n-        requestBuilder.serverSideEncryption(ServerSideEncryption.AWS_KMS);\n-        requestBuilder.ssekmsKeyId(awsProperties.s3FileIoSseKey());\n-        break;\n+  static void configureEncryption(AwsProperties awsProperties, CreateMultipartUploadRequest.Builder requestBuilder) {\n+    configureEncryption(awsProperties, requestBuilder::serverSideEncryption, requestBuilder::ssekmsKeyId,\n+        requestBuilder::sseCustomerAlgorithm, requestBuilder::sseCustomerKey, requestBuilder::sseCustomerKeyMD5);\n+  }\n \n-      case AwsProperties.S3FILEIO_SSE_TYPE_S3:\n-        requestBuilder.serverSideEncryption(ServerSideEncryption.AES256);\n-        break;\n+  static void configureEncryption(AwsProperties awsProperties, UploadPartRequest.Builder requestBuilder) {\n+    configureEncryption(awsProperties, null, null,\n+        requestBuilder::sseCustomerAlgorithm, requestBuilder::sseCustomerKey, requestBuilder::sseCustomerKeyMD5);\n+  }\n \n-      case AwsProperties.S3FILEIO_SSE_TYPE_CUSTOM:\n-        requestBuilder.sseCustomerAlgorithm(ServerSideEncryption.AES256.name());\n-        requestBuilder.sseCustomerKey(awsProperties.s3FileIoSseKey());\n-        requestBuilder.sseCustomerKeyMD5(awsProperties.s3FileIoSseMd5());\n-        break;\n+  static void configureEncryption(AwsProperties awsProperties, GetObjectRequest.Builder requestBuilder) {\n+    configureEncryption(awsProperties, null, null,\n+        requestBuilder::sseCustomerAlgorithm, requestBuilder::sseCustomerKey, requestBuilder::sseCustomerKeyMD5);\n+  }\n \n-      default:\n-        throw new IllegalArgumentException(\n-            \"Cannot support given S3 encryption type: \" + awsProperties.s3FileIoSseType());\n-    }\n+  static void configureEncryption(AwsProperties awsProperties, HeadObjectRequest.Builder requestBuilder) {\n+    configureEncryption(awsProperties, null, null,\n+        requestBuilder::sseCustomerAlgorithm, requestBuilder::sseCustomerKey, requestBuilder::sseCustomerKeyMD5);\n   }\n \n-  static void configureEncryption(AwsProperties awsProperties, CreateMultipartUploadRequest.Builder requestBuilder) {\n+  @SuppressWarnings(\"ReturnValueIgnored\")\n+  static void configureEncryption(\n+      AwsProperties awsProperties,\n+      Function<ServerSideEncryption, S3Request.Builder> encryptionSetter,\n+      Function<String, S3Request.Builder> kmsKeySetter,\n+      Function<String, S3Request.Builder> customAlgorithmSetter,\n+      Function<String, S3Request.Builder> customKeySetter,\n+      Function<String, S3Request.Builder> customMd5Setter) {\n+\n     switch (awsProperties.s3FileIoSseType().toLowerCase(Locale.ENGLISH)) {\n       case AwsProperties.S3FILEIO_SSE_TYPE_NONE:\n         break;\n \n       case AwsProperties.S3FILEIO_SSE_TYPE_KMS:\n-        requestBuilder.serverSideEncryption(ServerSideEncryption.AWS_KMS);\n-        requestBuilder.ssekmsKeyId(awsProperties.s3FileIoSseKey());\n-        break;\n+        if (encryptionSetter != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c436a33317ffff26d5aed015d9f714115ead2903"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3482, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}