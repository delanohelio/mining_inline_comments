{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTY3OTUx", "number": 2011, "title": "Add equals and hashcode to BaseSnapshot", "bodyText": "For the Beam runner, we emit the Snapshots after they are made. This can be done to notify downstream consumers of the data. Because the snapshots will be serialized, Beam needs to have the ability to compare them. This is done by the native Java equals function. Because we implement equals, we also need to implement the hashcode function.\n[direct-runner-worker] WARN org.apache.beam.sdk.util.MutationDetectors - Coder of type class org.apache.beam.sdk.coders.SerializableCoder has a #structuralValue method which does not return true when the encoding of the elements is equal. Element BaseSnapshot{id=8584070983395915429, timestamp_ms=1609329789570, operation=append, summary={added-data-files=3, added-records=300, added-files-size=3072, changed-partition-count=1, total-records=300, total-data-files=3, total-delete-files=0, total-position-deletes=0, total-equality-deletes=0}, manifest-list=file:/tmp/test_batch/metadata/snap-8584070983395915429-1-84dd1557-d24b-4b8b-8511-75eac387a6c5.avro}\n\nI thought it would be nice to separate small changes outside of the Iceberg PR in #1985. So we keep the changes a bit smaller and makes it easier to review.", "createdAt": "2020-12-30T14:32:39Z", "url": "https://github.com/apache/iceberg/pull/2011", "merged": true, "mergeCommit": {"oid": "4b1b90d7333ea3c9c16a311cd89dfe8d7ac34431"}, "closed": true, "closedAt": "2021-01-01T23:32:56Z", "author": {"login": "Fokko"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrQPXzgH2gAyNTQ2OTY3OTUxOjNlZjViYzA3ZWFmN2MxOGUwYTUzZjE3ZDk5NzFmMzhjN2MxNTllMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdr4-bXgH2gAyNTQ2OTY3OTUxOmNmZDM0ZGMxOTNjZjhiNTg2ZDJiYzg4YjAxMWZjYjExMjA3YjQ1NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "author": {"user": {"login": "Fokko", "name": "Fokko Driesprong"}}, "url": "https://github.com/apache/iceberg/commit/3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "committedDate": "2020-12-30T14:31:15Z", "message": "Add equals and hashcode to BaseSnapshot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTQzOTk3", "url": "https://github.com/apache/iceberg/pull/2011#pullrequestreview-560543997", "createdAt": "2020-12-31T20:15:05Z", "commit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDoxNTowNVrOINLHwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDoxNTowNVrOINLHwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDYxMA==", "bodyText": "Can you use Objects.hash instead? That's a much more compact implementation that does basically the same thing.", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550684610", "createdAt": "2020-12-31T20:15:05Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -211,6 +211,32 @@ private void cacheChanges() {\n     this.cachedDeletes = deletes.build();\n   }\n \n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o instanceof BaseSnapshot) {\n+      BaseSnapshot other = (BaseSnapshot) o;\n+      return this.snapshotId == other.snapshotId() &&\n+          this.parentId.equals(other.parentId()) &&\n+          this.sequenceNumber == other.sequenceNumber() &&\n+          this.timestampMillis == other.timestampMillis();\n+\n+    }\n+    return false;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    int hash = 7;\n+    hash = 31 * hash + (int) this.snapshotId;\n+    hash = 31 * hash + (this.parentId == null ? 0 : this.parentId.hashCode());\n+    hash = 31 * hash + (int) sequenceNumber;\n+    hash = 31 * hash + (int) timestampMillis;\n+    return hash;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTQ0MTc5", "url": "https://github.com/apache/iceberg/pull/2011#pullrequestreview-560544179", "createdAt": "2020-12-31T20:16:32Z", "commit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDoxNjozMlrOINLIoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDoxNjozMlrOINLIoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDgzMg==", "bodyText": "Style nits: we like to separate control flow blocks with a blank line, and avoid a blank line before the end of a block or method.", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550684832", "createdAt": "2020-12-31T20:16:32Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -211,6 +211,32 @@ private void cacheChanges() {\n     this.cachedDeletes = deletes.build();\n   }\n \n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o instanceof BaseSnapshot) {\n+      BaseSnapshot other = (BaseSnapshot) o;\n+      return this.snapshotId == other.snapshotId() &&\n+          this.parentId.equals(other.parentId()) &&\n+          this.sequenceNumber == other.sequenceNumber() &&\n+          this.timestampMillis == other.timestampMillis();\n+\n+    }\n+    return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTQ0MjU0", "url": "https://github.com/apache/iceberg/pull/2011#pullrequestreview-560544254", "createdAt": "2020-12-31T20:17:21Z", "commit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDoxNzoyMVrOINLJFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDoxNzoyMVrOINLJFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDk1MA==", "bodyText": "Shouldn't this also include the the table  that was loaded? Or is it enough that id and parent id are almost certainly unique?", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550684950", "createdAt": "2020-12-31T20:17:21Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -211,6 +211,32 @@ private void cacheChanges() {\n     this.cachedDeletes = deletes.build();\n   }\n \n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o instanceof BaseSnapshot) {\n+      BaseSnapshot other = (BaseSnapshot) o;\n+      return this.snapshotId == other.snapshotId() &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4354dc8220711813acf6288324be1c8707446bf7", "author": {"user": {"login": "Fokko", "name": "Fokko Driesprong"}}, "url": "https://github.com/apache/iceberg/commit/4354dc8220711813acf6288324be1c8707446bf7", "committedDate": "2021-01-01T12:38:25Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iceberg into fd-snapshot-equals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd34dc193cf8b586d2bc88b011fcb11207b4575", "author": {"user": {"login": "Fokko", "name": "Fokko Driesprong"}}, "url": "https://github.com/apache/iceberg/commit/cfd34dc193cf8b586d2bc88b011fcb11207b4575", "committedDate": "2021-01-01T13:58:51Z", "message": "Use Objects.hashCode"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3360, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}