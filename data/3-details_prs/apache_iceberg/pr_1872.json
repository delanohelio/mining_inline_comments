{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMDU2ODYw", "number": 1872, "title": "Core: add contains_nan to field_summary", "bodyText": "Will update manifest evaluator to use this new field after either this or #1747 is merged.", "createdAt": "2020-12-03T19:44:11Z", "url": "https://github.com/apache/iceberg/pull/1872", "merged": true, "mergeCommit": {"oid": "8a84715205631a17668ec8d63a791a25fb511992"}, "closed": true, "closedAt": "2021-02-05T17:38:13Z", "author": {"login": "yyanyy"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiv6v3AFqTU0NDY0NjcwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABd3NFVqAFqTU4NDU2MDA5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NjQ2NzA0", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-544646704", "createdAt": "2020-12-04T04:20:22Z", "commit": {"oid": "beb1b41da649310ac836dea31856137b18478f4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTkxNTk4", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-545191598", "createdAt": "2020-12-04T18:17:04Z", "commit": {"oid": "beb1b41da649310ac836dea31856137b18478f4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxODoxNzowNFrOH_cc4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxODoxNzowNFrOH_cc4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI4ODQ4MQ==", "bodyText": "have we made sure changing the position is backwards compatible?", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r536288481", "createdAt": "2020-12-04T18:17:04Z", "author": {"login": "jackye1995"}, "path": "core/src/main/java/org/apache/iceberg/GenericPartitionFieldSummary.java", "diffHunk": "@@ -136,8 +144,10 @@ public Object get(int i) {\n       case 0:\n         return containsNull;\n       case 1:\n-        return lowerBound();\n+        return containsNaN;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "beb1b41da649310ac836dea31856137b18478f4e"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzYzNTYx", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-545363561", "createdAt": "2020-12-04T23:32:43Z", "commit": {"oid": "c59ec69204c98f45c4a75e35b6a21522ed576412"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjYyMDAy", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-545662002", "createdAt": "2020-12-06T01:20:54Z", "commit": {"oid": "c59ec69204c98f45c4a75e35b6a21522ed576412"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQwMToyMDo1NFrOIADffw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQwMToyMDo1NFrOIADffw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkyODEyNw==", "bodyText": "Why use Boolean instead of the primitive here? Is there a place that constructs these without knowing whether there are NaN values?", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r536928127", "createdAt": "2020-12-06T01:20:54Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/GenericPartitionFieldSummary.java", "diffHunk": "@@ -72,10 +73,11 @@ public GenericPartitionFieldSummary(Schema avroSchema) {\n     }\n   }\n \n-  public GenericPartitionFieldSummary(boolean containsNull, ByteBuffer lowerBound,\n+  public GenericPartitionFieldSummary(boolean containsNull, Boolean containsNaN, ByteBuffer lowerBound,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c59ec69204c98f45c4a75e35b6a21522ed576412"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjYyMDc4", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-545662078", "createdAt": "2020-12-06T01:22:36Z", "commit": {"oid": "c59ec69204c98f45c4a75e35b6a21522ed576412"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQwMToyMjozNlrOIADgjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQwMToyMjozNlrOIADgjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkyODM5OQ==", "bodyText": "Since this is a boolean, maybe we can change the constructor as well.", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r536928399", "createdAt": "2020-12-06T01:22:36Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/PartitionSummary.java", "diffHunk": "@@ -73,14 +75,16 @@ private PartitionFieldStats(Type type) {\n     }\n \n     public PartitionFieldSummary toSummary() {\n-      return new GenericPartitionFieldSummary(containsNull,\n+      return new GenericPartitionFieldSummary(containsNull, containsNaN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c59ec69204c98f45c4a75e35b6a21522ed576412"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf0e751859bb66bbb03b4754e17ae79aa5c6a7d6", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/bf0e751859bb66bbb03b4754e17ae79aa5c6a7d6", "committedDate": "2020-12-07T22:47:00Z", "message": "Core: add contains_nan to field_summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87ebfc0a26d7b61e44ceda9e9c6e35eda1a9e3b7", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/87ebfc0a26d7b61e44ceda9e9c6e35eda1a9e3b7", "committedDate": "2020-12-07T22:47:00Z", "message": "make containsNaN nullable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1277887017e4f62dfc02fe7476832a66f1118741", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/1277887017e4f62dfc02fe7476832a66f1118741", "committedDate": "2020-12-07T22:47:00Z", "message": "changes after rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c59ec69204c98f45c4a75e35b6a21522ed576412", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/c59ec69204c98f45c4a75e35b6a21522ed576412", "committedDate": "2020-12-04T22:37:01Z", "message": "make containsNaN nullable"}, "afterCommit": {"oid": "1277887017e4f62dfc02fe7476832a66f1118741", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/1277887017e4f62dfc02fe7476832a66f1118741", "committedDate": "2020-12-07T22:47:00Z", "message": "changes after rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzOTUwNzE3", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-553950717", "createdAt": "2020-12-16T18:05:17Z", "commit": {"oid": "1277887017e4f62dfc02fe7476832a66f1118741"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxODowNToxN1rOIHSVyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxODowNToxN1rOIHSVyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDUxMTQzNQ==", "bodyText": "Does it make sense for this to have a default of null?", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r544511435", "createdAt": "2020-12-16T18:05:17Z", "author": {"login": "holdenk"}, "path": "api/src/main/java/org/apache/iceberg/ManifestFile.java", "diffHunk": "@@ -199,6 +200,12 @@ default boolean hasDeletedFiles() {\n      */\n     boolean containsNull();\n \n+    /**\n+     * Returns true if at least one data file in the manifest has a nan value for the field.\n+     * Null if this information doesn't exist.\n+     */\n+    Boolean containsNaN();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1277887017e4f62dfc02fe7476832a66f1118741"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/bade62f2235d660d7863a33b024a893ccaefde1b", "committedDate": "2020-12-17T01:46:55Z", "message": "default containsNaN() to null in manifest file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzUwMzk5", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-555750399", "createdAt": "2020-12-18T19:13:28Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToxMzoyOFrOIIvkGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToxMzoyOFrOIIvkGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzODgwOQ==", "bodyText": "Nit: do should we add a closing  in the docstring?", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r546038809", "createdAt": "2020-12-18T19:13:28Z", "author": {"login": "holdenk"}, "path": "api/src/main/java/org/apache/iceberg/ManifestFile.java", "diffHunk": "@@ -203,8 +203,12 @@ default boolean hasDeletedFiles() {\n     /**\n      * Returns true if at least one data file in the manifest has a nan value for the field.\n      * Null if this information doesn't exist.\n+     * <p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NzcwMzAx", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-565770301", "createdAt": "2021-01-11T21:55:13Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQyMTo1NToxM1rOIRoyfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQyMTo1NToxM1rOIRoyfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTM2NDk4OA==", "bodyText": "Just going back to the discussion of default to make sure my understanding is correct, if the returned value is null, does it mean the manifest file would suggest the data file does not contain NaN?\nThis behavior seems consistent with the default false in PartitionSummary.java, but logically speaking it seems like returning true as default is more reasonable to suggest a file always might contain NaN. What is the take here?", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r555364988", "createdAt": "2021-01-11T21:55:13Z", "author": {"login": "jackye1995"}, "path": "api/src/main/java/org/apache/iceberg/ManifestFile.java", "diffHunk": "@@ -199,6 +200,16 @@ default boolean hasDeletedFiles() {\n      */\n     boolean containsNull();\n \n+    /**\n+     * Returns true if at least one data file in the manifest has a nan value for the field.\n+     * Null if this information doesn't exist.\n+     * <p>\n+     * Default to return null to ensure backward compatibility.\n+     */\n+    default Boolean containsNaN() {\n+      return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxODg4NjUz", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-581888653", "createdAt": "2021-02-03T00:27:20Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDoyNzoyMFrOIeqiBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDoyNzoyMFrOIeqiBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTAyNTAyOA==", "bodyText": "I understand that this is trying to retain the previous behavior, but if containsNaN is not known, it seems safer to assume there is a NaN value.\nI think there is an argument for doing this: at one point, NaN wasn't handled separately and if lower and upper were null then there were no non-null values. A NaN would cause a bound to be non-null. The problem is that we must accept manifests that were written with the new rule (don't store NaN for lower), but that didn't set this. I'd prefer to go with the safer option.", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r569025028", "createdAt": "2021-02-03T00:27:20Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/expressions/ManifestEvaluator.java", "diffHunk": "@@ -144,18 +143,37 @@ public Boolean or(Boolean leftResult, Boolean rightResult) {\n     @Override\n     public <T> Boolean isNaN(BoundReference<T> ref) {\n       int pos = Accessors.toPosition(ref.accessor());\n-      // containsNull encodes whether at least one partition value is null, lowerBound is null if\n-      // all partition values are null.\n-      if (stats.get(pos).containsNull() && stats.get(pos).lowerBound() == null) {\n-        return ROWS_CANNOT_MATCH; // all values are null\n+\n+      if (stats.get(pos).containsNaN() != null && !stats.get(pos).containsNaN()) {\n+        return ROWS_CANNOT_MATCH;\n+      }\n+\n+      if (allValuesAreNull(stats.get(pos))) {\n+        return ROWS_CANNOT_MATCH;\n       }\n \n       return ROWS_MIGHT_MATCH;\n     }\n \n+    private boolean allValuesAreNull(PartitionFieldSummary summary) {\n+      // Before introducing containsNaN field, containsNull encodes whether at least one partition value is null,\n+      // lowerBound is null if all partition values are null.\n+      // After introducing containsNaN field, containsNaN must be false to ensure all values are null since bounds\n+      // don't include NaN anymore.\n+      return summary.containsNull() && summary.lowerBound() == null &&\n+          (summary.containsNaN() == null || !summary.containsNaN());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxODg5Mzk5", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-581889399", "createdAt": "2021-02-03T00:29:09Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDoyOTowOVrOIeqknQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDoyOTowOVrOIeqknQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTAyNTY5Mw==", "bodyText": "Could you move this private method to the bottom of the class?", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r569025693", "createdAt": "2021-02-03T00:29:09Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/expressions/ManifestEvaluator.java", "diffHunk": "@@ -144,18 +143,37 @@ public Boolean or(Boolean leftResult, Boolean rightResult) {\n     @Override\n     public <T> Boolean isNaN(BoundReference<T> ref) {\n       int pos = Accessors.toPosition(ref.accessor());\n-      // containsNull encodes whether at least one partition value is null, lowerBound is null if\n-      // all partition values are null.\n-      if (stats.get(pos).containsNull() && stats.get(pos).lowerBound() == null) {\n-        return ROWS_CANNOT_MATCH; // all values are null\n+\n+      if (stats.get(pos).containsNaN() != null && !stats.get(pos).containsNaN()) {\n+        return ROWS_CANNOT_MATCH;\n+      }\n+\n+      if (allValuesAreNull(stats.get(pos))) {\n+        return ROWS_CANNOT_MATCH;\n       }\n \n       return ROWS_MIGHT_MATCH;\n     }\n \n+    private boolean allValuesAreNull(PartitionFieldSummary summary) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxODkwMDI1", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-581890025", "createdAt": "2021-02-03T00:30:36Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDozMDozN1rOIeqmng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDozMDozN1rOIeqmng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTAyNjIwNg==", "bodyText": "Nit: nan -> NaN", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r569026206", "createdAt": "2021-02-03T00:30:37Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/ManifestFile.java", "diffHunk": "@@ -199,6 +200,16 @@ default boolean hasDeletedFiles() {\n      */\n     boolean containsNull();\n \n+    /**\n+     * Returns true if at least one data file in the manifest has a nan value for the field.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxODkyNDkw", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-581892490", "createdAt": "2021-02-03T00:36:20Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDozNjoyMFrOIequnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDozNjoyMFrOIequnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTAyODI1Mw==", "bodyText": "Nit: indentation is off.", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r569028253", "createdAt": "2021-02-03T00:36:20Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/GenericPartitionFieldSummary.java", "diffHunk": "@@ -72,7 +74,19 @@ public GenericPartitionFieldSummary(Schema avroSchema) {\n     }\n   }\n \n-  public GenericPartitionFieldSummary(boolean containsNull, ByteBuffer lowerBound,\n+  public GenericPartitionFieldSummary(boolean containsNull, boolean containsNaN, ByteBuffer lowerBound,\n+                               ByteBuffer upperBound) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxODk4MTQz", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-581898143", "createdAt": "2021-02-03T00:50:16Z", "commit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDo1MDoxNlrOIerCKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QwMDo1MDoxNlrOIerCKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTAzMzI1OA==", "bodyText": "Nit: indentation is off.", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r569033258", "createdAt": "2021-02-03T00:50:16Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/GenericPartitionFieldSummary.java", "diffHunk": "@@ -72,7 +74,19 @@ public GenericPartitionFieldSummary(Schema avroSchema) {\n     }\n   }\n \n-  public GenericPartitionFieldSummary(boolean containsNull, ByteBuffer lowerBound,\n+  public GenericPartitionFieldSummary(boolean containsNull, boolean containsNaN, ByteBuffer lowerBound,\n+                               ByteBuffer upperBound) {\n+    this.avroSchema = AVRO_SCHEMA;\n+    this.containsNull = containsNull;\n+    this.containsNaN = containsNaN;\n+    this.lowerBound = ByteBuffers.toByteArray(lowerBound);\n+    this.upperBound = ByteBuffers.toByteArray(upperBound);\n+    this.fromProjectionPos = null;\n+  }\n+\n+  // for testing backward compatibility only\n+  @VisibleForTesting\n+  GenericPartitionFieldSummary(boolean containsNull, ByteBuffer lowerBound,\n                                       ByteBuffer upperBound) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade62f2235d660d7863a33b024a893ccaefde1b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd440082425342c3f6f60e846e8fcbb194ddd5a", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/acd440082425342c3f6f60e846e8fcbb194ddd5a", "committedDate": "2021-02-04T22:34:58Z", "message": "not consider all_null for missing containsNaN case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzOTQ0NDM0", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-583944434", "createdAt": "2021-02-05T01:08:28Z", "commit": {"oid": "acd440082425342c3f6f60e846e8fcbb194ddd5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQwMTowODoyOFrOIgN3Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNVQwMTowODoyOFrOIgN3Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDY1MjQyMw==", "bodyText": "containsNaN could only be true if the type is float or double. Should this check the column type before checking containsNaN? Then we would be able to ignore it for most cases. For example, the test below uses a string column but has no containsNaN values, so it doesn't catch that all values are null.", "url": "https://github.com/apache/iceberg/pull/1872#discussion_r570652423", "createdAt": "2021-02-05T01:08:28Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/expressions/ManifestEvaluator.java", "diffHunk": "@@ -329,5 +338,12 @@ public Boolean or(Boolean leftResult, Boolean rightResult) {\n \n       return ROWS_MIGHT_MATCH;\n     }\n+\n+    private boolean allValuesAreNull(PartitionFieldSummary summary) {\n+      // containsNull encodes whether at least one partition value is null, lowerBound is null if all partition values\n+      // are null; in case bounds don't include NaN value, containsNaN needs to be checked against.\n+      return summary.containsNull() && summary.lowerBound() == null &&\n+          summary.containsNaN() != null && !summary.containsNaN();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acd440082425342c3f6f60e846e8fcbb194ddd5a"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29d5078fcab83afec10409517ad3f2a9cd671217", "author": {"user": {"login": "yyanyy", "name": null}}, "url": "https://github.com/apache/iceberg/commit/29d5078fcab83afec10409517ad3f2a9cd671217", "committedDate": "2021-02-05T03:21:20Z", "message": "handle floating point types differently in checking all nulls case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0NTYwMDkx", "url": "https://github.com/apache/iceberg/pull/1872#pullrequestreview-584560091", "createdAt": "2021-02-05T17:37:40Z", "commit": {"oid": "29d5078fcab83afec10409517ad3f2a9cd671217"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3519, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}