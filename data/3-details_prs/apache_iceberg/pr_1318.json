{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1Nzk3MjMw", "number": 1318, "title": "Add equality field IDs to DeleteFile", "bodyText": "This adds a list of equality field IDs to DeleteFile metadata that is tracked in manifests.\nThe equality field ID list identifies the subset of a delete file's fields (by ID) that should be used when comparing rows against the rows deleted in an equality delete file. The remaining fields are informational and store the values that were deleted by an equality delete. These may be used, for example, to reconstruct CDC events that contained deleted row values.\nAdditional fields will also be used for min/max stats filtering and are required to be accurate. When finding files for a table scan, the min/max values for non-comparison columns can still be used to filter delete files, even if the delete file applies to a data file that will be read.\nFor example, if a table contains columns id and data, a delete file may delete the row (5, \"bees!\") using only the id field for equality. A scan filter like data like 'a%' can cause the delete file to be ignored, even for a data file that contains ID 5 because the scan filter will remove the row.", "createdAt": "2020-08-11T00:30:20Z", "url": "https://github.com/apache/iceberg/pull/1318", "merged": true, "mergeCommit": {"oid": "3e8b75081f79dee420872f05aac83e6e90f7e3d8"}, "closed": true, "closedAt": "2020-08-12T18:12:10Z", "author": {"login": "rdblue"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9tS-bgFqTQ2NDY5ODA1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-FdyhgFqTQ2NTYyMjU5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0Njk4MDU5", "url": "https://github.com/apache/iceberg/pull/1318#pullrequestreview-464698059", "createdAt": "2020-08-11T01:57:34Z", "commit": {"oid": "146752e92f5ce067d773eb433fd16c42d0437291"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTo1NzozNFrOG-lq3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTo1NzozNFrOG-lq3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI4MjA3Ng==", "bodyText": "nit: incomplete sentence?", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r468282076", "createdAt": "2020-08-11T01:57:34Z", "author": {"login": "chenjunjiedada"}, "path": "api/src/main/java/org/apache/iceberg/ContentFile.java", "diffHunk": "@@ -97,6 +97,17 @@\n    */\n   List<Long> splitOffsets();\n \n+  /**\n+   * Returns the set of field IDs used for equality comparison, in equality delete files.\n+   * <p>\n+   * An equality delete file may contain additional data fields that are not used by equality\n+   * comparison. The subset of columns in a delete file to be used in equality comparison are\n+   * tracked by ID. Extra columns can be used to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "146752e92f5ce067d773eb433fd16c42d0437291"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzM3Njgz", "url": "https://github.com/apache/iceberg/pull/1318#pullrequestreview-464737683", "createdAt": "2020-08-11T04:20:02Z", "commit": {"oid": "146752e92f5ce067d773eb433fd16c42d0437291"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDoyMDowMlrOG-n0rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDoyMDowMlrOG-n0rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxNzM1OA==", "bodyText": "If the data class pattern in Iceberg is:\n\nstores (primitive) arrays in class field.\nprovides List method to return this field.\n\nCan we add ArrayUtil class to provide toPrimitive and toList utils?", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r468317358", "createdAt": "2020-08-11T04:20:02Z", "author": {"login": "JingsongLi"}, "path": "core/src/main/java/org/apache/iceberg/BaseFile.java", "diffHunk": "@@ -385,7 +399,24 @@ public String toString() {\n         .add(\"lower_bounds\", lowerBounds)\n         .add(\"upper_bounds\", upperBounds)\n         .add(\"key_metadata\", keyMetadata == null ? \"null\" : \"(redacted)\")\n-        .add(\"split_offsets\", splitOffsets == null ? \"null\" : splitOffsets)\n+        .add(\"split_offsets\", splitOffsets == null ? \"null\" : splitOffsets())\n+        .add(\"equality_ids\", equalityIds == null ? \"null\" : equalityFieldIds())\n         .toString();\n   }\n+\n+  private static int[] toIntArray(List<Integer> ints) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "146752e92f5ce067d773eb433fd16c42d0437291"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba18751a16789e9f09f8e93381279bb331f03599", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/ba18751a16789e9f09f8e93381279bb331f03599", "committedDate": "2020-08-11T23:40:27Z", "message": "Add equality field IDs to DeleteFile."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93356446ab13a1b66ce5b107ca8dc2db51b5183a", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/93356446ab13a1b66ce5b107ca8dc2db51b5183a", "committedDate": "2020-08-11T22:59:50Z", "message": "Fix broken test because manifest files are now larger."}, "afterCommit": {"oid": "ba18751a16789e9f09f8e93381279bb331f03599", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/ba18751a16789e9f09f8e93381279bb331f03599", "committedDate": "2020-08-11T23:40:27Z", "message": "Add equality field IDs to DeleteFile."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTQzNzI4", "url": "https://github.com/apache/iceberg/pull/1318#pullrequestreview-465543728", "createdAt": "2020-08-12T02:06:56Z", "commit": {"oid": "ba18751a16789e9f09f8e93381279bb331f03599"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjIyNTk5", "url": "https://github.com/apache/iceberg/pull/1318#pullrequestreview-465622599", "createdAt": "2020-08-12T06:27:07Z", "commit": {"oid": "ba18751a16789e9f09f8e93381279bb331f03599"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjoyNzowN1rOG_TcgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjoyNzowN1rOG_TcgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzMjA2NA==", "bodyText": "I think there might be a minor typo here - maybe after 'from extra'", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r469032064", "createdAt": "2020-08-12T06:27:07Z", "author": {"login": "rdsr"}, "path": "api/src/main/java/org/apache/iceberg/ContentFile.java", "diffHunk": "@@ -102,6 +102,18 @@\n    */\n   List<Long> splitOffsets();\n \n+  /**\n+   * Returns the set of field IDs used for equality comparison, in equality delete files.\n+   * <p>\n+   * An equality delete file may contain additional data fields that are not used by equality\n+   * comparison. The subset of columns in a delete file to be used in equality comparison are\n+   * tracked by ID. Extra columns can be used to reconstruct changes and metrics from extra", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba18751a16789e9f09f8e93381279bb331f03599"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4422, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}