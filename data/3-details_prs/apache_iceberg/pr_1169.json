{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MzY5NDk3", "number": 1169, "title": "Remove thread local objects and use new visitors", "bodyText": "Follow up the discussion in #1139, this change remove thread local objects and use new visitors to keep the code straightforward.", "createdAt": "2020-07-05T07:11:25Z", "url": "https://github.com/apache/iceberg/pull/1169", "merged": true, "mergeCommit": {"oid": "4d1fc91d6528db88548c506a0b110b50121d67ff"}, "closed": true, "closedAt": "2020-07-06T17:49:25Z", "author": {"login": "jun-he"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcx4U1sgFqTQ0MjY1NzM1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyU_esAFqTQ0MzI4ODc5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjU3MzU2", "url": "https://github.com/apache/iceberg/pull/1169#pullrequestreview-442657356", "createdAt": "2020-07-05T08:25:48Z", "commit": {"oid": "f657254b71fa90f9c5f9090c8e411067e2642fff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwODoyNTo0OVrOGtAqnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwODoyNTo0OVrOGtAqnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg1MDAxNQ==", "bodyText": "I think this is subtle and hard to understand on why this is needed. I prefer the the new visitor approach as you guys discussed in #1139.", "url": "https://github.com/apache/iceberg/pull/1169#discussion_r449850015", "createdAt": "2020-07-05T08:25:49Z", "author": {"login": "rdsr"}, "path": "api/src/main/java/org/apache/iceberg/expressions/InclusiveMetricsEvaluator.java", "diffHunk": "@@ -102,7 +102,15 @@ private boolean eval(ContentFile<?> file) {\n       this.lowerBounds = file.lowerBounds();\n       this.upperBounds = file.upperBounds();\n \n-      return ExpressionVisitors.visitEvaluator(expr, this);\n+      try {\n+        return ExpressionVisitors.visitEvaluator(expr, this);\n+      } finally {\n+        // allow temporary state to be collected because this is in a thread-local\n+        this.valueCounts = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f657254b71fa90f9c5f9090c8e411067e2642fff"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f657254b71fa90f9c5f9090c8e411067e2642fff", "author": {"user": {"login": "jun-he", "name": null}}, "url": "https://github.com/apache/iceberg/commit/f657254b71fa90f9c5f9090c8e411067e2642fff", "committedDate": "2020-07-05T07:09:03Z", "message": "reset temporary states inside thread local objects"}, "afterCommit": {"oid": "0b9a891b4e17a220a9a496d009ca28aa6c0e4632", "author": {"user": {"login": "jun-he", "name": null}}, "url": "https://github.com/apache/iceberg/commit/0b9a891b4e17a220a9a496d009ca28aa6c0e4632", "committedDate": "2020-07-06T06:21:58Z", "message": "remove thread local objects and use new vistors to keep the code straightforward"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8317b72e8b4a383288b64f9687257abd3268c6c4", "author": {"user": {"login": "jun-he", "name": null}}, "url": "https://github.com/apache/iceberg/commit/8317b72e8b4a383288b64f9687257abd3268c6c4", "committedDate": "2020-07-06T06:29:00Z", "message": "remove thread local objects and use new visitors to keep the code straightforward"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b9a891b4e17a220a9a496d009ca28aa6c0e4632", "author": {"user": {"login": "jun-he", "name": null}}, "url": "https://github.com/apache/iceberg/commit/0b9a891b4e17a220a9a496d009ca28aa6c0e4632", "committedDate": "2020-07-06T06:21:58Z", "message": "remove thread local objects and use new vistors to keep the code straightforward"}, "afterCommit": {"oid": "8317b72e8b4a383288b64f9687257abd3268c6c4", "author": {"user": {"login": "jun-he", "name": null}}, "url": "https://github.com/apache/iceberg/commit/8317b72e8b4a383288b64f9687257abd3268c6c4", "committedDate": "2020-07-06T06:29:00Z", "message": "remove thread local objects and use new visitors to keep the code straightforward"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjAxNDk0", "url": "https://github.com/apache/iceberg/pull/1169#pullrequestreview-443201494", "createdAt": "2020-07-06T15:51:47Z", "commit": {"oid": "8317b72e8b4a383288b64f9687257abd3268c6c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjg4Nzk2", "url": "https://github.com/apache/iceberg/pull/1169#pullrequestreview-443288796", "createdAt": "2020-07-06T17:49:44Z", "commit": {"oid": "8317b72e8b4a383288b64f9687257abd3268c6c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4604, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}