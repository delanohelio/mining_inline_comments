{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MTcxMjIx", "number": 1174, "title": "Add TypeToFlinkType: convert iceberg types to Flink types", "bodyText": "Converter between Flink types and Iceberg type.\nThe conversion is not a 1:1 mapping that not allows back-and-forth conversion. So some information might get lost during the back-and-forth conversion.\n(background: FlinkCatalog need convert iceberg tables to Flink tables)", "createdAt": "2020-07-07T05:50:27Z", "url": "https://github.com/apache/iceberg/pull/1174", "merged": true, "mergeCommit": {"oid": "2f69c9cb40cca57044d5a939be0cf34fa26eed4f"}, "closed": true, "closedAt": "2020-07-15T20:20:42Z", "author": {"login": "JingsongLi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczMgu5AFqTQ0NTQ4NzgwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1A5LFgBqjM1NDY1NjMyNzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDg3ODA3", "url": "https://github.com/apache/iceberg/pull/1174#pullrequestreview-445487807", "createdAt": "2020-07-09T10:25:54Z", "commit": {"oid": "884e7b4b568a44f637e7d83d90125e0933c1a823"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMDoyNTo1NFrOGvLKmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMDoyNTo1NFrOGvLKmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjExOTE5Mw==", "bodyText": "I'd prefer to provide some separate unit tests to address the conversion differences ( so that we won't regress).", "url": "https://github.com/apache/iceberg/pull/1174#discussion_r452119193", "createdAt": "2020-07-09T10:25:54Z", "author": {"login": "openinx"}, "path": "flink/src/test/java/org/apache/iceberg/flink/TestFlinkSchemaUtil.java", "diffHunk": "@@ -218,6 +218,24 @@ public void testListField() {\n             ))\n     );\n \n-    Assert.assertEquals(expectedSchema.asStruct(), actualSchema.asStruct());\n+    checkSchema(flinkSchema, icebergSchema);\n+  }\n+\n+  private void checkSchema(TableSchema flinkSchema, Schema icebergSchema) {\n+    Assert.assertEquals(icebergSchema.asStruct(), FlinkSchemaUtil.convert(flinkSchema).asStruct());\n+    // The conversion is not a 1:1 mapping, so we just check iceberg types.\n+    Assert.assertEquals(\n+        icebergSchema.asStruct(),\n+        FlinkSchemaUtil.convert(FlinkSchemaUtil.toSchema(FlinkSchemaUtil.convert(icebergSchema))).asStruct());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "884e7b4b568a44f637e7d83d90125e0933c1a823"}, "originalPosition": 91}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "884e7b4b568a44f637e7d83d90125e0933c1a823", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/884e7b4b568a44f637e7d83d90125e0933c1a823", "committedDate": "2020-07-07T05:47:16Z", "message": "Add TypeToFlinkType: convert iceberg types to Flink types"}, "afterCommit": {"oid": "ab99a29617544dd3f21c961d69e6319361f39e4f", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/ab99a29617544dd3f21c961d69e6319361f39e4f", "committedDate": "2020-07-14T02:48:42Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzA1NTY1", "url": "https://github.com/apache/iceberg/pull/1174#pullrequestreview-448305565", "createdAt": "2020-07-14T17:14:44Z", "commit": {"oid": "ab99a29617544dd3f21c961d69e6319361f39e4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzoxNDo0NVrOGxdUiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzoxNDo0NVrOGxdUiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxMzgwMA==", "bodyText": "Precision isn't lost for date/time types. It is always microseconds.", "url": "https://github.com/apache/iceberg/pull/1174#discussion_r454513800", "createdAt": "2020-07-14T17:14:45Z", "author": {"login": "rdblue"}, "path": "flink/src/main/java/org/apache/iceberg/flink/FlinkSchemaUtil.java", "diffHunk": "@@ -21,10 +21,30 @@\n \n import org.apache.flink.table.api.TableSchema;\n import org.apache.flink.table.types.FieldsDataType;\n+import org.apache.flink.table.types.logical.LogicalType;\n+import org.apache.flink.table.types.logical.RowType;\n+import org.apache.flink.table.types.utils.TypeConversions;\n import org.apache.iceberg.Schema;\n import org.apache.iceberg.relocated.com.google.common.base.Preconditions;\n import org.apache.iceberg.types.Type;\n+import org.apache.iceberg.types.TypeUtil;\n \n+/**\n+ * Converter between Flink types and Iceberg type.\n+ * The conversion is not a 1:1 mapping that not allows back-and-forth conversion. So some information might get lost\n+ * during the back-and-forth conversion.\n+ * <p>\n+ * This inconsistent types:\n+ * <ul>\n+ *   <li>map Iceberg UUID type to Flink BinaryType(16)</li>\n+ *   <li>map Flink VarCharType and CharType to Iceberg String type (lost precision)</li>\n+ *   <li>map Flink VarBinaryType to Iceberg Binary type (lost precision)</li>\n+ *   <li>map Flink TimeType to Iceberg Time type (lost precision)</li>\n+ *   <li>map Flink TimestampType to Iceberg Timestamp without zone type (lost precision)</li>\n+ *   <li>map Flink LocalZonedTimestampType to Iceberg Timestamp with zone type (lost precision)</li>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab99a29617544dd3f21c961d69e6319361f39e4f"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a80363691ef2ede2e7c7967bafdd06e1e39ad7b4", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/a80363691ef2ede2e7c7967bafdd06e1e39ad7b4", "committedDate": "2020-07-15T02:02:47Z", "message": "Add TypeToFlinkType: convert iceberg types to Flink types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7fb7d403489d11550323051f49ee7227a94630b", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/a7fb7d403489d11550323051f49ee7227a94630b", "committedDate": "2020-07-15T02:02:47Z", "message": "Fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "814672b6f0da44309785d740e8ecb32be9dd1877", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/814672b6f0da44309785d740e8ecb32be9dd1877", "committedDate": "2020-07-15T02:06:18Z", "message": "Rebase&Fix comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab99a29617544dd3f21c961d69e6319361f39e4f", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/ab99a29617544dd3f21c961d69e6319361f39e4f", "committedDate": "2020-07-14T02:48:42Z", "message": "Fix comments"}, "afterCommit": {"oid": "814672b6f0da44309785d740e8ecb32be9dd1877", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/iceberg/commit/814672b6f0da44309785d740e8ecb32be9dd1877", "committedDate": "2020-07-15T02:06:18Z", "message": "Rebase&Fix comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4617, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}