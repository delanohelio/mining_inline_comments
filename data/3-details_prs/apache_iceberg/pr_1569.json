{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMzk2MTky", "number": 1569, "title": "API: add some validation when create bucket/truncate partition", "bodyText": "There was no exception output,when create a partition table with bucket(colName, 0) or bucket(colName, -1).\nHowever, when writing data, the following two exceptions occur.\n\nException in thread \"main\" java.lang.UnsupportedOperationException: Cannot write using unsupported transforms: bucket[-1]\njava.lang.ArithmeticException: / by zero\n\nLink: #1543", "createdAt": "2020-10-09T07:12:15Z", "url": "https://github.com/apache/iceberg/pull/1569", "merged": true, "mergeCommit": {"oid": "0c50b2074cd5dad59bbcb4b4599ec3ae11a34b49"}, "closed": true, "closedAt": "2020-10-12T17:33:17Z", "author": {"login": "zhangdove"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQwrF0AH2gAyNTAwMzk2MTkyOjQwM2ZhNjNmZGIzNzNhYWVkNTJkNWQxZGI2YTNlM2E4ZDE4YTM0NGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRgvANgH2gAyNTAwMzk2MTkyOmM1N2FiZjFhYzA5MTM4ZTY2NTI2NDNmNDQ4N2M3NjM3MTNjMGE5NzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c", "author": {"user": {"login": "zhangdove", "name": "zhangdove"}}, "url": "https://github.com/apache/iceberg/commit/403fa63fdb373aaed52d5d1db6a3e3a8d18a344c", "committedDate": "2020-10-09T07:02:32Z", "message": "add some validation when create bucket/truncate partition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzU3OTM1", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-505757935", "createdAt": "2020-10-09T15:03:42Z", "commit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzU4NTY0", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-505758564", "createdAt": "2020-10-09T15:04:25Z", "commit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTowNDoyNVrOHfNxCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTowNDoyNVrOHfNxCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ5MzQ0OA==", "bodyText": "nits: Missing a space after the comma\nnumber of bucket(s)", "url": "https://github.com/apache/iceberg/pull/1569#discussion_r502493448", "createdAt": "2020-10-09T15:04:25Z", "author": {"login": "RussellSpitzer"}, "path": "api/src/main/java/org/apache/iceberg/transforms/Bucket.java", "diffHunk": "@@ -44,6 +45,9 @@\n \n   @SuppressWarnings(\"unchecked\")\n   static <T> Bucket<T> get(Type type, int numBuckets) {\n+    Preconditions.checkArgument(numBuckets > 0,\n+        \"The number of bucket must larger than zero,but is %s\", numBuckets);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzU4OTcy", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-505758972", "createdAt": "2020-10-09T15:04:55Z", "commit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTowNDo1NVrOHfNyLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTowNDo1NVrOHfNyLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ5Mzc0MA==", "bodyText": "nit: Space after comma", "url": "https://github.com/apache/iceberg/pull/1569#discussion_r502493740", "createdAt": "2020-10-09T15:04:55Z", "author": {"login": "RussellSpitzer"}, "path": "api/src/main/java/org/apache/iceberg/transforms/Truncate.java", "diffHunk": "@@ -30,12 +30,16 @@\n import org.apache.iceberg.expressions.Expressions;\n import org.apache.iceberg.expressions.UnboundPredicate;\n import org.apache.iceberg.relocated.com.google.common.base.Objects;\n+import org.apache.iceberg.relocated.com.google.common.base.Preconditions;\n import org.apache.iceberg.types.Type;\n import org.apache.iceberg.util.UnicodeUtil;\n \n abstract class Truncate<T> implements Transform<T, T> {\n   @SuppressWarnings(\"unchecked\")\n   static <T> Truncate<T> get(Type type, int width) {\n+    Preconditions.checkArgument(width > 0,\n+        \"The width of truncate must larger than zero,but is %s\", width);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzU5NDA2", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-505759406", "createdAt": "2020-10-09T15:05:27Z", "commit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTowNToyN1rOHfNzbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTowNToyN1rOHfNzbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ5NDA2MQ==", "bodyText": "bucket -> buckets , but here it matters less since it's just a test message", "url": "https://github.com/apache/iceberg/pull/1569#discussion_r502494061", "createdAt": "2020-10-09T15:05:27Z", "author": {"login": "RussellSpitzer"}, "path": "api/src/test/java/org/apache/iceberg/transforms/TestBucketing.java", "diffHunk": "@@ -275,6 +276,14 @@ public void testUUIDHash() {\n         hashBytes(uuidBytes), bucketFunc.hash(uuid));\n   }\n \n+  @Test\n+  public void testVerifiedIllegalNumBucket() {\n+    AssertHelpers.assertThrows(\"Should fail if numBucket is less than or equal to zero\",\n+        IllegalArgumentException.class,\n+        \"The number of bucket must larger than zero\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1Nzk4OTM4", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-505798938", "createdAt": "2020-10-09T15:53:21Z", "commit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTo1MzoyMVrOHfPpxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTo1MzoyMVrOHfPpxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjUyNDM1Ng==", "bodyText": "must larger -> must be larger, here and in other places with similar message", "url": "https://github.com/apache/iceberg/pull/1569#discussion_r502524356", "createdAt": "2020-10-09T15:53:21Z", "author": {"login": "shardulm94"}, "path": "api/src/test/java/org/apache/iceberg/transforms/TestTruncate.java", "diffHunk": "@@ -86,4 +87,12 @@ public void testTruncateByteBuffer() throws Exception {\n         ByteBuffer.wrap(\"abc\".getBytes(\"UTF-8\")),\n         trunc.apply(ByteBuffer.wrap(\"abc\".getBytes(\"UTF-8\"))));\n   }\n+\n+  @Test\n+  public void testVerifiedIllegalWidth() {\n+    AssertHelpers.assertThrows(\"Should fail if width is less than or equal to zero\",\n+        IllegalArgumentException.class,\n+        \"The width of truncate must larger than zero\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "403fa63fdb373aaed52d5d1db6a3e3a8d18a344c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "871cdadfce6e834ce5c2bdfd365e4928c7568d12", "author": {"user": {"login": "zhangdove", "name": "zhangdove"}}, "url": "https://github.com/apache/iceberg/commit/871cdadfce6e834ce5c2bdfd365e4928c7568d12", "committedDate": "2020-10-10T01:27:49Z", "message": "fix some comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTI1NDMy", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-506125432", "createdAt": "2020-10-10T20:48:04Z", "commit": {"oid": "871cdadfce6e834ce5c2bdfd365e4928c7568d12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMDo0ODowNFrOHfiWow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMDo0ODowNFrOHfiWow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzMDc1NQ==", "bodyText": "How about \"Invalid truncate width: %s\"? We try to keep error messages a bit shorter and clearer, with the most useful information up front. In this case, the problem is that the truncate width is invalid. We can also add more clarification if you want, like \"Invalid truncate width: %s (must be > 0)\"", "url": "https://github.com/apache/iceberg/pull/1569#discussion_r502830755", "createdAt": "2020-10-10T20:48:04Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/transforms/Truncate.java", "diffHunk": "@@ -30,12 +30,16 @@\n import org.apache.iceberg.expressions.Expressions;\n import org.apache.iceberg.expressions.UnboundPredicate;\n import org.apache.iceberg.relocated.com.google.common.base.Objects;\n+import org.apache.iceberg.relocated.com.google.common.base.Preconditions;\n import org.apache.iceberg.types.Type;\n import org.apache.iceberg.util.UnicodeUtil;\n \n abstract class Truncate<T> implements Transform<T, T> {\n   @SuppressWarnings(\"unchecked\")\n   static <T> Truncate<T> get(Type type, int width) {\n+    Preconditions.checkArgument(width > 0,\n+        \"The width of truncate must be larger than zero, but is %s\", width);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "871cdadfce6e834ce5c2bdfd365e4928c7568d12"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTI1NDY2", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-506125466", "createdAt": "2020-10-10T20:48:37Z", "commit": {"oid": "871cdadfce6e834ce5c2bdfd365e4928c7568d12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMDo0ODozOFrOHfiWzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMDo0ODozOFrOHfiWzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzMDc5Ng==", "bodyText": "Same here. What about \"Invalid number of buckets: %s (must be > 0)\"?", "url": "https://github.com/apache/iceberg/pull/1569#discussion_r502830796", "createdAt": "2020-10-10T20:48:38Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/transforms/Bucket.java", "diffHunk": "@@ -44,6 +45,9 @@\n \n   @SuppressWarnings(\"unchecked\")\n   static <T> Bucket<T> get(Type type, int numBuckets) {\n+    Preconditions.checkArgument(numBuckets > 0,\n+        \"The number of bucket(s) must be larger than zero, but is %s\", numBuckets);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "871cdadfce6e834ce5c2bdfd365e4928c7568d12"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTM1NDM3", "url": "https://github.com/apache/iceberg/pull/1569#pullrequestreview-506135437", "createdAt": "2020-10-11T00:57:27Z", "commit": {"oid": "871cdadfce6e834ce5c2bdfd365e4928c7568d12"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c57abf1ac09138e6652643f4487c763713c0a976", "author": {"user": {"login": "zhangdove", "name": "zhangdove"}}, "url": "https://github.com/apache/iceberg/commit/c57abf1ac09138e6652643f4487c763713c0a976", "committedDate": "2020-10-11T15:02:15Z", "message": "Fix the more elegant error message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3918, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}