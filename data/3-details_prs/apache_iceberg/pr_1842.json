{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NTczNzE1", "number": 1842, "title": "Hive: Refactor Hive Iceberg schema conversions to a single file", "bodyText": "Easier to maintain, and other projects, like Impala can use this too", "createdAt": "2020-11-27T12:01:22Z", "url": "https://github.com/apache/iceberg/pull/1842", "merged": true, "mergeCommit": {"oid": "969a1ffc8d7392cc4c54eba156647c448757b45e"}, "closed": true, "closedAt": "2020-12-07T21:56:11Z", "author": {"login": "pvary"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgmR5QgH2gAyNTI4NTczNzE1Ojc3YjFkMDhlZTgwMzAwNDU3Y2ViM2E5MTFiMjY0NGU1MzhjYWIxNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjhC_TgH2gAyNTI4NTczNzE1OmRlYWE2MTNmMjdmYTI0NjhlN2EzMGJlMGFiZTZmYjc4ZGY4MjZiOWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "77b1d08ee80300457ceb3a911b2644e538cab156", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/77b1d08ee80300457ceb3a911b2644e538cab156", "committedDate": "2020-11-27T11:58:45Z", "message": "Refactor Hive Iceberg schema conversions to a single file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNDA4MzU0", "url": "https://github.com/apache/iceberg/pull/1842#pullrequestreview-540408354", "createdAt": "2020-11-28T18:12:22Z", "commit": {"oid": "77b1d08ee80300457ceb3a911b2644e538cab156"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxODoxMjoyM1rOH7cMpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxODoxMjoyM1rOH7cMpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA5MDAyMA==", "bodyText": "Don't we need to copy the comments/doc from FieldSchema as well?", "url": "https://github.com/apache/iceberg/pull/1842#discussion_r532090020", "createdAt": "2020-11-28T18:12:23Z", "author": {"login": "rdsr"}, "path": "hive-metastore/src/main/java/org/apache/iceberg/hive/HiveTypeConverter.java", "diffHunk": "@@ -30,7 +37,52 @@ private HiveTypeConverter() {\n \n   }\n \n-  public static String convert(Type type) {\n+  /**\n+   * Converts the Iceberg schema to a Hive schema.\n+   * @param schema The original Iceberg schema to convert\n+   * @return The Hive column list generated from the Iceberg schema\n+   */\n+  public static List<FieldSchema> hiveSchema(Schema schema) {\n+    return schema.columns().stream()\n+        .map(col -> new FieldSchema(col.name(), HiveTypeConverter.convert(col.type()), \"\"))\n+        .collect(Collectors.toList());\n+  }\n+\n+  /**\n+   * Converts the list of Hive FieldSchemas to an Iceberg schema.\n+   * <p>\n+   * The list should contain the columns and the partition columns as well.\n+   * @param fieldSchemas The list of the columns\n+   * @return An equivalent Iceberg Schema\n+   */\n+  public static Schema icebergSchema(List<FieldSchema> fieldSchemas) {\n+    List<String> names = new ArrayList<>(fieldSchemas.size());\n+    List<TypeInfo> typeInfos = new ArrayList<>(fieldSchemas.size());\n+\n+    for (FieldSchema col : fieldSchemas) {\n+      names.add(col.getName());\n+      typeInfos.add(TypeInfoUtils.getTypeInfoFromTypeString(col.getType()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77b1d08ee80300457ceb3a911b2644e538cab156"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNjk2NDU1", "url": "https://github.com/apache/iceberg/pull/1842#pullrequestreview-542696455", "createdAt": "2020-12-02T10:28:38Z", "commit": {"oid": "77b1d08ee80300457ceb3a911b2644e538cab156"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1Mzg5MTQ3", "url": "https://github.com/apache/iceberg/pull/1842#pullrequestreview-545389147", "createdAt": "2020-12-05T01:38:02Z", "commit": {"oid": "77b1d08ee80300457ceb3a911b2644e538cab156"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMTozODowM1rOH_n5Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMTozODowM1rOH_n5Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ3NTk3OQ==", "bodyText": "Most of the other modules use a different naming convention:\n\nAvroSchemaUtil.convert for Schema to Iceberg type and Iceberg type to Schema\nParquetSchemaUtil.convert\nSparkSchemaUtil.convert\nFlinkSchemaUtil.convert\n\nI think it would be nice to use the same convention here: use HiveSchemaUtil instead of HiveTypeConverter and then use overloads of convert. This would also make the API a bit less confusing because HiveTypeConverter and HiveSchemaConverter are very similar names and share a lot of the same tasks with different method args. Could these be combined into one?\nSome schema classes have a different type for the top-level schema (Iceberg and Parquet) and we usually convert between the two. Here, I think you could convert between Iceberg Schema and List<FieldSchema>, and between Iceberg Type and TypeInfo.", "url": "https://github.com/apache/iceberg/pull/1842#discussion_r536475979", "createdAt": "2020-12-05T01:38:03Z", "author": {"login": "rdblue"}, "path": "hive-metastore/src/main/java/org/apache/iceberg/hive/HiveTypeConverter.java", "diffHunk": "@@ -30,7 +37,52 @@ private HiveTypeConverter() {\n \n   }\n \n-  public static String convert(Type type) {\n+  /**\n+   * Converts the Iceberg schema to a Hive schema.\n+   * @param schema The original Iceberg schema to convert\n+   * @return The Hive column list generated from the Iceberg schema\n+   */\n+  public static List<FieldSchema> hiveSchema(Schema schema) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77b1d08ee80300457ceb3a911b2644e538cab156"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deaa613f27fa2468e7a30be0abe6fb78df826b9b", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/deaa613f27fa2468e7a30be0abe6fb78df826b9b", "committedDate": "2020-12-06T13:34:43Z", "message": "Renamed HiveTypeConverter.java to HiveSchemaUtil.java and renamed all the conversion methods to convert.\nAlso added conversion methods for Types and added tests for Type conversions as well."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3445, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}