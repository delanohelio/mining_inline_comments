{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1ODgwMjcw", "number": 1537, "title": "API: Add name to Table and Catalog APIs", "bodyText": "This PR adds name methods to the Table and Catalog APIs.\nResolves #658.", "createdAt": "2020-10-01T00:55:38Z", "url": "https://github.com/apache/iceberg/pull/1537", "merged": true, "mergeCommit": {"oid": "ed9caa83ed5bae9ea42ea0cb63cf4ee51600b8c7"}, "closed": true, "closedAt": "2020-10-01T20:16:31Z", "author": {"login": "aokolnychyi"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOGmQ6AH2gAyNDk1ODgwMjcwOmUzNzAxNWNmMTcyN2MwZWExMDhiNWExOGNkYmUwM2I3ODhmM2JkOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOWU3wgH2gAyNDk1ODgwMjcwOmNjYWQ1Njc2M2U3NjIzMmViMGQ3ZGRjYTg0ZTc0N2ZkOTQxM2FjM2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/e37015cf1727c0ea108b5a18cdbe03b788f3bd9a", "committedDate": "2020-10-01T00:53:24Z", "message": "API: Add name to Table and Catalog APIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTQ3MjE1", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-499947215", "createdAt": "2020-10-01T00:56:50Z", "commit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDo1Njo1MFrOHa1HQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDo1Njo1MFrOHa1HQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg5NTIzNQ==", "bodyText": "I did not intend to add the name to the Catalog API but we need this for proper metadata table names.", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r497895235", "createdAt": "2020-10-01T00:56:50Z", "author": {"login": "aokolnychyi"}, "path": "api/src/main/java/org/apache/iceberg/catalog/Catalog.java", "diffHunk": "@@ -35,6 +35,15 @@\n  */\n public interface Catalog {\n \n+  /**\n+   * Return the name for this catalog.\n+   *\n+   * @return this catalog's name\n+   */\n+  default String name() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTQ3NjUy", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-499947652", "createdAt": "2020-10-01T00:58:36Z", "commit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDo1ODozNlrOHa1L3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDo1ODozNlrOHa1L3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg5NjQxMw==", "bodyText": "It is debatable whether we have to default this. I did this to avoid breaking custom implementations.", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r497896413", "createdAt": "2020-10-01T00:58:36Z", "author": {"login": "aokolnychyi"}, "path": "api/src/main/java/org/apache/iceberg/Table.java", "diffHunk": "@@ -30,6 +30,15 @@\n  */\n public interface Table {\n \n+  /**\n+   * Return the full name for this table.\n+   *\n+   * @return this table's name\n+   */\n+  default String name() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTQ3OTUz", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-499947953", "createdAt": "2020-10-01T00:59:50Z", "commit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDo1OTo1MFrOHa1Opw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDo1OTo1MFrOHa1Opw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg5NzEyNw==", "bodyText": "This was broken before as the name of the metadata table started with its type, not catalog.", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r497897127", "createdAt": "2020-10-01T00:59:50Z", "author": {"login": "aokolnychyi"}, "path": "core/src/main/java/org/apache/iceberg/MetadataTableUtils.java", "diffHunk": "@@ -59,10 +59,10 @@ public static Table createMetadataTableInstance(TableOperations originTableOps,\n   }\n \n   public static Table createMetadataTableInstance(TableOperations originTableOps,\n+                                                  String catalogName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTQ4MzYx", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-499948361", "createdAt": "2020-10-01T01:01:25Z", "commit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMTowMToyNlrOHa1StQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMTowMToyNlrOHa1StQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg5ODE2NQ==", "bodyText": "Metadata tables loaded through HadoopTables will have their names as location.type (which is weird as we normally use location#type). I am not sure whether it is a big deal or not.", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r497898165", "createdAt": "2020-10-01T01:01:26Z", "author": {"login": "aokolnychyi"}, "path": "core/src/test/java/org/apache/iceberg/hadoop/TestHadoopTables.java", "diffHunk": "@@ -139,6 +139,18 @@ public void testCustomSortOrder() {\n     Assert.assertEquals(\"Transform must match\", transform, sortOrder.fields().get(0).transform());\n   }\n \n+  @Test\n+  public void testTableName() {\n+    PartitionSpec spec = PartitionSpec.builderFor(SCHEMA)\n+        .bucket(\"data\", 16)\n+        .build();\n+    String location = tableDir.toURI().toString();\n+    TABLES.create(SCHEMA, spec, location);\n+\n+    Table table = TABLES.load(location);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMDAyNDc5", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-500002479", "createdAt": "2020-10-01T04:35:51Z", "commit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNDozNTo1MVrOHa6M4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNDozNTo1MVrOHa6M4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk3ODU5NQ==", "bodyText": "Why rename this?", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r497978595", "createdAt": "2020-10-01T04:35:51Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreCatalog.java", "diffHunk": "@@ -129,16 +129,16 @@ public TableBuilder buildTable(TableIdentifier identifier, Schema schema) {\n   }\n \n   private Table loadMetadataTable(TableIdentifier identifier) {\n-    String name = identifier.name();\n-    MetadataTableType type = MetadataTableType.from(name);\n+    String tableName = identifier.name();\n+    MetadataTableType type = MetadataTableType.from(tableName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e37015cf1727c0ea108b5a18cdbe03b788f3bd9a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c737af65de69f1e54545d559c04c6dded23323e5", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/c737af65de69f1e54545d559c04c6dded23323e5", "committedDate": "2020-10-01T17:22:00Z", "message": "Fix Hadoop tables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTY1NTI0", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-500565524", "createdAt": "2020-10-01T17:25:12Z", "commit": {"oid": "c737af65de69f1e54545d559c04c6dded23323e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzoyNToxMlrOHbULPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzoyNToxMlrOHbULPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwNDE1Ng==", "bodyText": "We instantiate some metadata tables in tests so I kept the old constructor too. Won't harm if someone is using it directly too.", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r498404156", "createdAt": "2020-10-01T17:25:12Z", "author": {"login": "aokolnychyi"}, "path": "core/src/main/java/org/apache/iceberg/AllDataFilesTable.java", "diffHunk": "@@ -42,10 +42,16 @@\n public class AllDataFilesTable extends BaseMetadataTable {\n   private final TableOperations ops;\n   private final Table table;\n+  private final String name;\n \n   public AllDataFilesTable(TableOperations ops, Table table) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c737af65de69f1e54545d559c04c6dded23323e5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTc2NDA5", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-500576409", "createdAt": "2020-10-01T17:39:45Z", "commit": {"oid": "c737af65de69f1e54545d559c04c6dded23323e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzozOTo0NVrOHbUqbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzozOTo0NVrOHbUqbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxMjE0MQ==", "bodyText": "Minor: Although it is the same thing, I think it would make this more readable to use catalog.name() directly. That way it is clear that the name isn't coming from the caching catalog.", "url": "https://github.com/apache/iceberg/pull/1537#discussion_r498412141", "createdAt": "2020-10-01T17:39:45Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/CachingCatalog.java", "diffHunk": "@@ -78,7 +83,9 @@ public Table loadTable(TableIdentifier ident) {\n         TableOperations ops = ((HasTableOperations) originTable).operations();\n         MetadataTableType type = MetadataTableType.from(canonicalized.name());\n \n-        Table metadataTable = MetadataTableUtils.createMetadataTableInstance(ops, originTableIdentifier, type);\n+        Table metadataTable = MetadataTableUtils.createMetadataTableInstance(\n+            ops, name(), originTableIdentifier,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c737af65de69f1e54545d559c04c6dded23323e5"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTc5MTE5", "url": "https://github.com/apache/iceberg/pull/1537#pullrequestreview-500579119", "createdAt": "2020-10-01T17:43:22Z", "commit": {"oid": "c737af65de69f1e54545d559c04c6dded23323e5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62b80cbf09bcc811dbfa63e5738b0c85c5fe7512", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/62b80cbf09bcc811dbfa63e5738b0c85c5fe7512", "committedDate": "2020-10-01T19:06:08Z", "message": "Minor updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccad56763e76232eb0d7ddca84e747fd9413ac3f", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/ccad56763e76232eb0d7ddca84e747fd9413ac3f", "committedDate": "2020-10-01T19:12:53Z", "message": "Minor cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3888, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}