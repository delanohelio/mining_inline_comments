{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MDY0MTI1", "number": 887, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjoxOToxM1rODtmzSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoyMTozM1rODuef6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTQ4MjM1OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjoxOToxNFrOF_IWSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMToyNjoxMVrOF_m0Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MTM4Ng==", "bodyText": "This change should not be in this PR. The purpose of this PR is to define the format of a file and position delete file, not to make additional changes to metadata. Could you remove this?", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401741386", "createdAt": "2020-04-01T16:19:14Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -232,6 +232,7 @@ The schema of a manifest file is a struct called `manifest_entry` with the follo\n | **`128  upper_bounds`**           | `optional map<129: int, 130: binary>` | Map from column id to upper bound in the column serialized as binary [1]. Each value must be greater than or equal to all values in the column for the file.                                         |\n | **`131  key_metadata`**           | `optional binary`                     | Implementation-specific key metadata for encryption                                                                                                                                                  |\n | **`132  split_offsets`**          | `optional list`                       | Split offsets for the data file. For example, all row group offsets in a Parquet file. Must be sorted ascending.                                                                                     |\n+| **`134  file_type`**              | `optional int`                        | Type of the data file. `0`: normal data file that has the same schema as the table's schema. `1`: file and position based deletion file.                                                         |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0MDUzOQ==", "bodyText": "Sure, will move this to the file_type PR.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402240539", "createdAt": "2020-04-02T11:26:11Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -232,6 +232,7 @@ The schema of a manifest file is a struct called `manifest_entry` with the follo\n | **`128  upper_bounds`**           | `optional map<129: int, 130: binary>` | Map from column id to upper bound in the column serialized as binary [1]. Each value must be greater than or equal to all values in the column for the file.                                         |\n | **`131  key_metadata`**           | `optional binary`                     | Implementation-specific key metadata for encryption                                                                                                                                                  |\n | **`132  split_offsets`**          | `optional list`                       | Split offsets for the data file. For example, all row group offsets in a Parquet file. Must be sorted ascending.                                                                                     |\n+| **`134  file_type`**              | `optional int`                        | Type of the data file. `0`: normal data file that has the same schema as the table's schema. `1`: file and position based deletion file.                                                         |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MTM4Ng=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTQ4ODQ3OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjoyMDo1NVrOF_Iaeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMzowMDo1NFrOGADfxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MjQ1OA==", "bodyText": "Could you update this to be like the other schemas defined in the spec? It should be a table with a description of each field, Iceberg types, and should include field IDs.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401742458", "createdAt": "2020-04-01T16:20:55Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NjI5OA==", "bodyText": "Also, these fields are required.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401746298", "createdAt": "2020-04-01T16:26:30Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MjQ1OA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0MDg3NA==", "bodyText": "Sure, no problem.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402240874", "createdAt": "2020-04-02T11:26:50Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MjQ1OA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI3Nzg5Ng==", "bodyText": "You mean json format, right?", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402277896", "createdAt": "2020-04-02T12:34:59Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MjQ1OA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2NTAyNw==", "bodyText": "No, I meant table. Look at the other struct type definitions and copy those. The table format makes it easy to read.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402465027", "createdAt": "2020-04-02T16:56:11Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MjQ1OA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcxMDQ2OQ==", "bodyText": "Just updated.\n\nput required explicitly before type to emphasize it.\nuse the field ID starting from 600.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402710469", "createdAt": "2020-04-03T03:00:54Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MjQ1OA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTUxMTE1OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjoyNjowM1rOF_IoZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMTo0MDo0OVrOF_nQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NjAyMw==", "bodyText": "This is a recommendation not a requirement, so we should specifically say that. The requirement is that a delete file can be written using any supported data file format.\nAlso, the purpose of the recommendation is not module independence. People choose file formats based on what they use for most tables and have experience tuning, so it makes sense to use the same format for delete files and delta files.\nIt's convenient to not need to build a service with a dependency on iceberg-orc or iceberg-parquet if all data and delete files are Avro, but we don't want to have people misinterpret the spec and think that there is a guarantee that delete file formats match data files.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401746023", "createdAt": "2020-04-01T16:26:03Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}\n+```\n+\n+The rows in the deletion file must be sorted by `filename` and `position` so as to leverage the merge sort. The layout of sorted records in the deletion file looks like:\n+```\n+file1, 1\n+file1, 2\n+file1, 5\n+file2, 3\n+file2, 4\n+file2, 7\n+file3, 6\n+file3, 8\n+file3, 9\n+```\n+ \n+It is also worth to note that in order to keep module independence, deletion files are written with the same file format as the table's file format.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0NzcyOA==", "bodyText": "I see, let me rephrase this.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402247728", "createdAt": "2020-04-02T11:40:49Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}\n+```\n+\n+The rows in the deletion file must be sorted by `filename` and `position` so as to leverage the merge sort. The layout of sorted records in the deletion file looks like:\n+```\n+file1, 1\n+file1, 2\n+file1, 5\n+file2, 3\n+file2, 4\n+file2, 7\n+file3, 6\n+file3, 8\n+file3, 9\n+```\n+ \n+It is also worth to note that in order to keep module independence, deletion files are written with the same file format as the table's file format.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NjAyMw=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTUyNjc4OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjoyOTozOVrOF_IyDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NToyMlrOF_yA-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0ODQ5NA==", "bodyText": "I don't think this is necessary. It should be sufficient to say that the delete file must be sorted by ascending filename then position.\nThis is for two reasons:\n\nSorting by file allows filter pushdown by file in columnar storage formats.\nSorting by position allows filtering rows while scanning, to avoid keeping deletes in memory.\n\nI think it would help to rephrase \"so as to leverage the merge sort\" to \"allow filtering rows while scanning\" or something similar. Although we think of this as merge-sort, the operation is not a sort that produces a sorted list of deletes and rows -- it's a filter.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401748494", "createdAt": "2020-04-01T16:29:39Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}\n+```\n+\n+The rows in the deletion file must be sorted by `filename` and `position` so as to leverage the merge sort. The layout of sorted records in the deletion file looks like:\n+```\n+file1, 1\n+file1, 2\n+file1, 5\n+file2, 3\n+file2, 4\n+file2, 7\n+file3, 6\n+file3, 8\n+file3, 9\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNDA1OA==", "bodyText": "Ok, let me update this.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402424058", "createdAt": "2020-04-02T15:55:22Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:\n+```\n+{\n+  filename string,\n+  position long\n+}\n+```\n+\n+The rows in the deletion file must be sorted by `filename` and `position` so as to leverage the merge sort. The layout of sorted records in the deletion file looks like:\n+```\n+file1, 1\n+file1, 2\n+file1, 5\n+file2, 3\n+file2, 4\n+file2, 7\n+file3, 6\n+file3, 8\n+file3, 9\n+```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0ODQ5NA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTUzNzYwOnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjozMjoxN1rOF_I46g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMTozNjo1MlrOF_nI2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MDI1MA==", "bodyText": "This section should be \"Position-based delete files\" to distinguish these from equality delete files that will be added later.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401750250", "createdAt": "2020-04-01T16:32:17Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI0NTg1MA==", "bodyText": "Make sense!", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402245850", "createdAt": "2020-04-02T11:36:52Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MDI1MA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTU0NzM1OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjozNDozN1rOF_I_BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMTo0NjoxNFrOF_nakA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MTgxMw==", "bodyText": "Let's make this specific to position-based delete files instead of describing delete files generally. How about this:\n\nPosition-based delete files identify rows in one or more data files that have been deleted.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401751813", "createdAt": "2020-04-01T16:34:37Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI1MDM4NA==", "bodyText": "OK, let me update this.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402250384", "createdAt": "2020-04-02T11:46:14Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MTgxMw=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTU2ODQxOnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjozOTo0OVrOF_JMaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1MTowMlrOF_x0HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1NTI0MA==", "bodyText": "This needs to clearly define what file and position are. I think that file should be renamed to file_path to match tracking in the manifest file and should use a similar description, along with a note that it must match what's in the manifest. We also need to note that positions start at 0.\n\nfile_path - The full URI of a data file, with FS scheme. This must match the file_path of the target data file in a manifest entry.\nposition - The ordinal position of a deleted row in the target data file identified by file_path, starting at 0.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401755240", "createdAt": "2020-04-01T16:39:49Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMDc2NQ==", "bodyText": "I put the description into doc property of the field.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402420765", "createdAt": "2020-04-02T15:51:02Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files\n+\n+Deletion files are files that indicate deletions of pre-existing rows to be applied to the dataset at read time. Deletion files may either specify rows by column value or by file name and row position.\n+\n+1. The file and position based deletion file has the schema as following:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1NTI0MA=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTYxMjU4OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNjo1MToyOVrOF_JpAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1MToxM1rOF_x0mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc2MjU2Mw==", "bodyText": "Why is this a sub-section of Manifests?\nLet's create a new section after Table Metadata called Delete Format, with a sub-section for Position-based delete files. Then we should note that content in that section is in preparation for incrementing the format version:\n\nThis section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version, 1. This part of the spec is not yet complete and will be completed as format version 2.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r401762563", "createdAt": "2020-04-01T16:51:29Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMDg5MA==", "bodyText": "no problem.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402420890", "createdAt": "2020-04-02T15:51:13Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -254,6 +255,33 @@ Notes:\n \n 1. Technically, data files can be deleted when the last snapshot that contains the file as \u201clive\u201d data is garbage collected. But this is harder to detect and requires finding the diff of multiple snapshots. It is easier to track what files are deleted in a snapshot and delete them when that snapshot expires.\n \n+#### Deletion Files", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc2MjU2Mw=="}, "originalCommit": {"oid": "c3e942e652a8ab6e7f7d72696c73bbb16ad89150"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjA2MTA1OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNjo1NzoyNFrOF_0kNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMzowMTowOVrOGADf7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2NTg0NQ==", "bodyText": "Let's remove \"to keep module independence\" because it isn't clear what that means.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402465845", "createdAt": "2020-04-02T16:57:24Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,38 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version, 1. This part of the spec is not yet complete and will be completed as format version 2.\n+\n+#### Position-based Delete Files\n+\n+Position-based delete files identify rows in one or more data files that have been deleted. It has the schema as following:\n+```json\n+{\n+  \"type\": \"struct\",\n+  \"fields\": [ {\n+    \"id\": 1,\n+    \"name\": \"file_path\",\n+    \"required\": true,\n+    \"type\": \"string\",\n+    \"doc\": \"The full URI of a data file, with FS scheme. This must match the file_path of the target data file in a manifest entry.\"\n+  }, {\n+    \"id\": 2,\n+    \"name\": \"position\",\n+    \"required\": true,\n+    \"type\": \"long\",\n+    \"doc\": \"The ordinal position of a deleted row in the target data file identified by file_path, starting at 0.\"\n+  } ]\n+}\n+```\n+\n+The rows in the delete file must be sorted by `file_path` then `position` to optimize filtering rows while scanning. \n+\n+*  Sorting by `file_path` allows filter pushdown by file in columnar storage formats.\n+*  Sorting by `position` allows filtering rows while scanning, to avoid keeping deletes in memory.\n+ \n+Though the delete files can be written using any supported data file format in Iceberg, it is recommended to write delete files with same file format as the table's file format to keep module independence.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d1a550dc9c39bbe071a41c509fddfb94090549"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcxMDUwOA==", "bodyText": "OK", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402710508", "createdAt": "2020-04-03T03:01:09Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,38 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version, 1. This part of the spec is not yet complete and will be completed as format version 2.\n+\n+#### Position-based Delete Files\n+\n+Position-based delete files identify rows in one or more data files that have been deleted. It has the schema as following:\n+```json\n+{\n+  \"type\": \"struct\",\n+  \"fields\": [ {\n+    \"id\": 1,\n+    \"name\": \"file_path\",\n+    \"required\": true,\n+    \"type\": \"string\",\n+    \"doc\": \"The full URI of a data file, with FS scheme. This must match the file_path of the target data file in a manifest entry.\"\n+  }, {\n+    \"id\": 2,\n+    \"name\": \"position\",\n+    \"required\": true,\n+    \"type\": \"long\",\n+    \"doc\": \"The ordinal position of a deleted row in the target data file identified by file_path, starting at 0.\"\n+  } ]\n+}\n+```\n+\n+The rows in the delete file must be sorted by `file_path` then `position` to optimize filtering rows while scanning. \n+\n+*  Sorting by `file_path` allows filter pushdown by file in columnar storage formats.\n+*  Sorting by `position` allows filtering rows while scanning, to avoid keeping deletes in memory.\n+ \n+Though the delete files can be written using any supported data file format in Iceberg, it is recommended to write delete files with same file format as the table's file format to keep module independence.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2NTg0NQ=="}, "originalCommit": {"oid": "35d1a550dc9c39bbe071a41c509fddfb94090549"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzY3Mzc0OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMzozOTozM1rOGAED-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwODo1Mjo1MVrOGAMHRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcxOTczOA==", "bodyText": "Can you remove the comma between version and 1?", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402719738", "createdAt": "2020-04-03T03:39:33Z", "author": {"login": "leoluan2009"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,25 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version, 1. This part of the spec is not yet complete and will be completed as format version 2.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89ed3d02d4de620143161922861a724af238cbee"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg1MTY1Mw==", "bodyText": "Sure. I force pushed the commit.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r402851653", "createdAt": "2020-04-03T08:52:51Z", "author": {"login": "chenjunjiedada"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,25 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version, 1. This part of the spec is not yet complete and will be completed as format version 2.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcxOTczOA=="}, "originalCommit": {"oid": "89ed3d02d4de620143161922861a724af238cbee"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDU5NzUxOnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoxOTo1MFrOGAfQFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoxOTo1MFrOGAfQFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE2NTIwNA==", "bodyText": "Can you add back-ticks to file_path to format it correctly?", "url": "https://github.com/apache/iceberg/pull/887#discussion_r403165204", "createdAt": "2020-04-03T17:19:50Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,25 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version 1. This part of the spec is not yet complete and will be completed as format version 2.\n+\n+#### Position-based Delete Files\n+\n+Position-based delete files identify rows in one or more data files that have been deleted. It has the schema named \"position_based_delete_file\" with a struct of the following fields:\n+\n+| Field id, name          | Type                            | Description                                                                                                              |\n+|-------------------------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------|\n+| **`600 file_path`**     | `required string`               | The full URI of a data file with FS scheme. This must match the file_path of the target data file in a manifest entry.   |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a01fe630d5ab5ece2819ae4082aa324733eca38"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDU5ODQ0OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoxOTo1OFrOGAfQjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoxOTo1OFrOGAfQjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE2NTMyNQ==", "bodyText": "Here as well.", "url": "https://github.com/apache/iceberg/pull/887#discussion_r403165325", "createdAt": "2020-04-03T17:19:58Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,25 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version 1. This part of the spec is not yet complete and will be completed as format version 2.\n+\n+#### Position-based Delete Files\n+\n+Position-based delete files identify rows in one or more data files that have been deleted. It has the schema named \"position_based_delete_file\" with a struct of the following fields:\n+\n+| Field id, name          | Type                            | Description                                                                                                              |\n+|-------------------------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------|\n+| **`600 file_path`**     | `required string`               | The full URI of a data file with FS scheme. This must match the file_path of the target data file in a manifest entry.   |\n+| **`601 position`**      | `required long`                 | The ordinal position of a deleted row in the target data file identified by file_path, starting at 0.                    |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a01fe630d5ab5ece2819ae4082aa324733eca38"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDYwNzc3OnYy", "diffSide": "RIGHT", "path": "site/docs/spec.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoyMTozM1rOGAfVzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoyMTozM1rOGAfVzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE2NjY3MQ==", "bodyText": "Let's rephrase the second sentence so that it matches the ones above:\n\nPosition-based delete files store file_position_delete, a struct with the following fields:", "url": "https://github.com/apache/iceberg/pull/887#discussion_r403166671", "createdAt": "2020-04-03T17:21:33Z", "author": {"login": "rdblue"}, "path": "site/docs/spec.md", "diffHunk": "@@ -333,6 +333,25 @@ Table metadata is stored as JSON. Each table metadata change creates a new table\n \n The atomic operation used to commit metadata depends on how tables are tracked and is not standardized by this spec. See the sections below for examples.\n \n+### Delete Format\n+\n+This section details how to encode row-level deletes in Iceberg metadata. Row-level deletes are not supported in the current format version 1. This part of the spec is not yet complete and will be completed as format version 2.\n+\n+#### Position-based Delete Files\n+\n+Position-based delete files identify rows in one or more data files that have been deleted. It has the schema named \"position_based_delete_file\" with a struct of the following fields:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a01fe630d5ab5ece2819ae4082aa324733eca38"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2874, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}