{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0Njc5MTk2", "number": 1394, "title": "Hive: Add logging for Hive related classes", "bodyText": "As suggested on the dev list added new logs so it will be easier to follow what is happening in case there is a problem using Iceberg/Hive integration.\nModified the existing logging in one place to collapse a multiline log to a single line. Mulitline logs are not very useful with high concurrency since the different log messages are prone to interfere with each other.", "createdAt": "2020-08-27T12:51:22Z", "url": "https://github.com/apache/iceberg/pull/1394", "merged": true, "mergeCommit": {"oid": "a3d5c0cdc15617e55f1478e15bd6494540c3a42d"}, "closed": true, "closedAt": "2020-09-01T20:36:08Z", "author": {"login": "pvary"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC_if1gH2gAyNDc0Njc5MTk2Ojk0NDcyYzY1NzA4MGIxM2Y5MzRiZjIyN2JiZWMwMTEwZWZjZDBhZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEse9JAH2gAyNDc0Njc5MTk2OjYzNmU0OTllYmJlYzNmNjE5ZWIwZjRmZWMzMmM4MmM3NDc5ZTczNTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94472c657080b13f934bf227bbec0110efcd0af0", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/94472c657080b13f934bf227bbec0110efcd0af0", "committedDate": "2020-08-27T12:26:47Z", "message": "Add logging for Hive related classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Njk1NjI4", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-476695628", "createdAt": "2020-08-27T13:00:56Z", "commit": {"oid": "94472c657080b13f934bf227bbec0110efcd0af0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMzowMDo1N1rOHIPQHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMzowMjozMVrOHIPUJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQwMDU0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.info(\"Renamed table form: [{}], to: [{}]\", from, to);\n          \n          \n            \n                  LOG.info(\"Renamed table from: [{}], to: [{}]\", from, to);", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478400542", "createdAt": "2020-08-27T13:00:57Z", "author": {"login": "massdosage"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -177,6 +182,8 @@ public void renameTable(TableIdentifier from, TableIdentifier originalTo) {\n         return null;\n       });\n \n+      LOG.info(\"Renamed table form: [{}], to: [{}]\", from, to);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94472c657080b13f934bf227bbec0110efcd0af0"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQwMTU3NQ==", "bodyText": "Is the additional \\ here intentional? If so, what behaviour changes?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478401575", "createdAt": "2020-08-27T13:02:31Z", "author": {"login": "massdosage"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -465,9 +495,14 @@ protected void finalize() throws Throwable {\n     super.finalize();\n     if (!closed) {\n       close(); // releasing resources is more important than printing the warning\n-      String trace = Joiner.on(\"\\n\\t\").join(\n+      String trace = Joiner.on(\"\\\\n\\t\").join(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94472c657080b13f934bf227bbec0110efcd0af0"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/9db3dd5fba5b95ce95b2076f6ae291c25b364109", "committedDate": "2020-08-27T13:44:13Z", "message": "Fixed typo pointed out by Adrian"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTU3MTg5", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477157189", "createdAt": "2020-08-27T23:54:16Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NDoxN1rOHIlBNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NDoxN1rOHIlBNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NzE3Mw==", "bodyText": "What is the purpose of this debug message? I'm not sure how it would help.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478757173", "createdAt": "2020-08-27T23:54:17Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -89,10 +89,13 @@ public HiveCatalog(String name, String uri, int clientPoolSize, Configuration co\n \n     try {\n       List<String> tables = clients.run(client -> client.getAllTables(database));\n-      return tables.stream()\n+      List<TableIdentifier> tableIdentifiers = tables.stream()\n           .map(t -> TableIdentifier.of(namespace, t))\n           .collect(Collectors.toList());\n \n+      LOG.debug(\"Listing of namespace [{}] resulted in the following tables: [{}]\", namespace, tableIdentifiers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTU3NTU3", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477157557", "createdAt": "2020-08-27T23:55:31Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NTozMVrOHIlCig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NTozMVrOHIlCig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NzUxNA==", "bodyText": "How about \"Dropped table: {}\" instead of using a passive form? We also tend to use : instead of brackets in messages.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478757514", "createdAt": "2020-08-27T23:55:31Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -138,9 +141,11 @@ public boolean dropTable(TableIdentifier identifier, boolean purge) {\n         dropTableData(ops.io(), lastMetadata);\n       }\n \n+      LOG.info(\"Table is dropped [{}]\", identifier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTU3NzQw", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477157740", "createdAt": "2020-08-27T23:56:08Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NjowOVrOHIlDNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NjowOVrOHIlDNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NzY4Nw==", "bodyText": "How about \"Skipping drop, table does not exist: {}\"?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478757687", "createdAt": "2020-08-27T23:56:09Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -138,9 +141,11 @@ public boolean dropTable(TableIdentifier identifier, boolean purge) {\n         dropTableData(ops.io(), lastMetadata);\n       }\n \n+      LOG.info(\"Table is dropped [{}]\", identifier);\n       return true;\n \n     } catch (NoSuchTableException | NoSuchObjectException e) {\n+      LOG.debug(\"Unable to drop missing table: [{}]\", identifier, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTU3ODI0", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477157824", "createdAt": "2020-08-27T23:56:25Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NjoyNVrOHIlDjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1NjoyNVrOHIlDjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1Nzc3Mg==", "bodyText": "Can you remove the brackers?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478757772", "createdAt": "2020-08-27T23:56:25Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -177,6 +182,8 @@ public void renameTable(TableIdentifier from, TableIdentifier originalTo) {\n         return null;\n       });\n \n+      LOG.info(\"Renamed table from: [{}], to: [{}]\", from, to);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTU4NjUw", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477158650", "createdAt": "2020-08-27T23:59:08Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1OTowOFrOHIlGPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo1OTowOFrOHIlGPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1ODQ2Mw==", "bodyText": "In configuration, we use uri instead of location. Can you use that here?\nAlso, other toString methods use the helpers in MoreObjects. To have a common format, could you use that instead?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478758463", "createdAt": "2020-08-27T23:59:08Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -465,9 +495,14 @@ protected void finalize() throws Throwable {\n     super.finalize();\n     if (!closed) {\n       close(); // releasing resources is more important than printing the warning\n-      String trace = Joiner.on(\"\\n\\t\").join(\n+      String trace = Joiner.on(\"\\\\n\\t\").join(\n           Arrays.copyOfRange(createStack, 1, createStack.length));\n-      LOG.warn(\"Unclosed input stream created by:\\n\\t{}\", trace);\n+      LOG.warn(\"Unclosed input stream created by:\\\\n\\t{}\", trace);\n     }\n   }\n+\n+  @Override\n+  public String toString() {\n+    return \"HiveCatalog [name=\" + name + \", location=\" + this.conf.get(\"hive.metastore.uris\") + \"]\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTYwNjIy", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477160622", "createdAt": "2020-08-28T00:05:40Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDowNTo0MVrOHIlM7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDowNTo0MVrOHIlM7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MDE3Mg==", "bodyText": "I think these changes are too verbose for INFO, although I do think it would be good to have a log message for the commit.\nCould you add an INFO log in BaseMetastoreTableOperations#commit instead of these? Something like this:\nLOG.info(\"Successfully committed to table {} in {} ms: {}\", table.name(), end - start, newMetadataLocation);\nThat way, logging is not too verbose, consistent across implementations, and adds useful info: the time it took to commit.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478760172", "createdAt": "2020-08-28T00:05:41Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -143,9 +144,11 @@ protected void doCommit(TableMetadata base, TableMetadata metadata) {\n       // TODO add lock heart beating for cases where default lock timeout is too low.\n       Table tbl;\n       if (base != null) {\n+        LOG.info(\"Committing existing table [{}]\", fullName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTYwODY1", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477160865", "createdAt": "2020-08-28T00:06:23Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDowNjoyM1rOHIlNqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDowNjoyM1rOHIlNqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MDM2Mg==", "bodyText": "There is already a log in BaseMetastoreTableOperations for this. It has the location, but not the table name. Maybe just add table name to that one.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478760362", "createdAt": "2020-08-28T00:06:23Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -130,6 +130,7 @@ protected void doRefresh() {\n     }\n \n     refreshFromMetadataLocation(metadataLocation);\n+    LOG.debug(\"Refreshed [{}]\", fullName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTYxNTUx", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477161551", "createdAt": "2020-08-28T00:08:51Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDowODo1MVrOHIlQHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDowODo1MVrOHIlQHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MDk5MQ==", "bodyText": "I think this should be done in the catalog or HadoopTables, not in Catalogs. Otherwise, we don't get the log message consistently when table loads go directly through the catalog (as in Spark 3) or through a different class like IcebergSource (Spark 2). And if we were to later add a message to the catalog, then this would be a duplicate.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478760991", "createdAt": "2020-08-28T00:08:51Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/Catalogs.java", "diffHunk": "@@ -65,13 +68,17 @@ public static Table loadTable(Configuration conf, Properties props) {\n   private static Table loadTable(Configuration conf, String tableIdentifier, String tableLocation) {\n     Optional<Catalog> catalog = loadCatalog(conf);\n \n+    Table table;\n     if (catalog.isPresent()) {\n       Preconditions.checkArgument(tableIdentifier != null, \"Table identifier not set\");\n-      return catalog.get().loadTable(TableIdentifier.parse(tableIdentifier));\n+      table = catalog.get().loadTable(TableIdentifier.parse(tableIdentifier));\n+    } else {\n+      Preconditions.checkArgument(tableLocation != null, \"Table location not set\");\n+      table = new HadoopTables(conf).load(tableLocation);\n     }\n \n-    Preconditions.checkArgument(tableLocation != null, \"Table location not set\");\n-    return new HadoopTables(conf).load(tableLocation);\n+    LOG.info(\"Table loaded by catalog: [{}]\", table);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTYyMjA3", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477162207", "createdAt": "2020-08-28T00:11:01Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDoxMTowMVrOHIlSOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDoxMTowMVrOHIlSOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MTUzMA==", "bodyText": "I think it would be better to give more specific information:\nLOG.info(\"Loaded catalog {} using {}\", catalog, catalogLoaderClass);", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478761530", "createdAt": "2020-08-28T00:11:01Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/Catalogs.java", "diffHunk": "@@ -83,28 +90,33 @@ private static Table loadTable(Configuration conf, String tableIdentifier, Strin\n               .impl(catalogLoaderClass)\n               .build()\n               .newInstance();\n-      return Optional.of(loader.load(conf));\n+      Catalog catalog = loader.load(conf);\n+      LOG.info(\"Dynamic catalog is used: [{}]\", catalog);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTYyNzE4", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477162718", "createdAt": "2020-08-28T00:12:47Z", "commit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDoxMjo0OFrOHIlT9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDoxMjo0OFrOHIlT9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MTk3Mg==", "bodyText": "Aren't there already logs for this from the underlying file system implementation?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r478761972", "createdAt": "2020-08-28T00:12:48Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/mapreduce/IcebergInputFormat.java", "diffHunk": "@@ -227,6 +227,7 @@ public void close() throws IOException {\n \n     private CloseableIterable<T> open(FileScanTask currentTask, Schema readSchema) {\n       DataFile file = currentTask.file();\n+      LOG.debug(\"Opening [{}] for read\", file);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db3dd5fba5b95ce95b2076f6ae291c25b364109"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/b1a48b8813c1072ad67061796b1511f698efe151", "committedDate": "2020-08-28T13:43:22Z", "message": "Addressed Ryan's comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODczODM2", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477873836", "createdAt": "2020-08-28T16:37:53Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjozNzo1M1rOHJNPFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjozNzo1M1rOHJNPFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxNjA4NQ==", "bodyText": "We are trying to avoid adding more Guava classes. Could you use System.currentTimeMilis() instead?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479416085", "createdAt": "2020-08-28T16:37:53Z", "author": {"login": "rdblue"}, "path": "bundled-guava/src/main/java/org/apache/iceberg/GuavaClasses.java", "diffHunk": "@@ -81,6 +82,7 @@\n     Multimaps.class.getName();\n     Ordering.class.getName();\n     Sets.class.getName();\n+    Stopwatch.class.getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODc2Mjkz", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477876293", "createdAt": "2020-08-28T16:41:37Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0MTozN1rOHJNWhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0MTozN1rOHJNWhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxNzk5MA==", "bodyText": "This base class is extended by external projects, so I think we should avoid breaking changes like this one.\nI propose adding a tableName method with a base implementation that returns null. Hive can override the implementation to provide the table name (as could external implementations) and the log message can include the table name if it is non-null. Does that sound reasonable?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479417990", "createdAt": "2020-08-28T16:41:37Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -46,12 +48,18 @@\n \n   private static final String METADATA_FOLDER_NAME = \"metadata\";\n \n+  private String fullName;\n   private TableMetadata currentMetadata = null;\n   private String currentMetadataLocation = null;\n   private boolean shouldRefresh = true;\n   private int version = -1;\n \n-  protected BaseMetastoreTableOperations() {\n+  protected BaseMetastoreTableOperations(String fullName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODc4MDcx", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477878071", "createdAt": "2020-08-28T16:44:21Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDoyMVrOHJNb7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDoyMVrOHJNb7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxOTM3NQ==", "bodyText": "I don't think we should change the signature of this method, since there are external implementations. This also highlights that there is not even a requirement to store metadata in a file (this could be implemented with a backing database). So we probably shouldn't log the metadata location from this class.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479419375", "createdAt": "2020-08-28T16:44:21Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -101,12 +109,25 @@ public void commit(TableMetadata base, TableMetadata metadata) {\n       return;\n     }\n \n-    doCommit(base, metadata);\n+    Stopwatch stopwatch = Stopwatch.createStarted();\n+    String newMetadataLocation = doCommit(base, metadata);\n     deleteRemovedMetadataFiles(base, metadata);\n     requestRefresh();\n+    stopwatch.stop();\n+\n+    LOG.info(\"Successfully committed to table: {} in: {} ms: {}\",\n+        fullName,\n+        newMetadataLocation,\n+        stopwatch.elapsed(TimeUnit.MILLISECONDS));\n   }\n \n-  protected void doCommit(TableMetadata base, TableMetadata metadata) {\n+  /**\n+   * Executes the commit in the Metastore\n+   * @param base The base table metadata\n+   * @param metadata The new table metadata\n+   * @return The new metadata location\n+   */\n+  protected String doCommit(TableMetadata base, TableMetadata metadata) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODc4Mzg2", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477878386", "createdAt": "2020-08-28T16:44:53Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDo1M1rOHJNc8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDo1M1rOHJNc8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxOTYzNA==", "bodyText": "I don't think we need so many colons. How about Successfully committed to table {} in {} ms?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479419634", "createdAt": "2020-08-28T16:44:53Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -101,12 +109,25 @@ public void commit(TableMetadata base, TableMetadata metadata) {\n       return;\n     }\n \n-    doCommit(base, metadata);\n+    Stopwatch stopwatch = Stopwatch.createStarted();\n+    String newMetadataLocation = doCommit(base, metadata);\n     deleteRemovedMetadataFiles(base, metadata);\n     requestRefresh();\n+    stopwatch.stop();\n+\n+    LOG.info(\"Successfully committed to table: {} in: {} ms: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODc5MjA0", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477879204", "createdAt": "2020-08-28T16:46:14Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NjoxNFrOHJNftg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NjoxNFrOHJNftg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMDM0Mg==", "bodyText": "I think this is misleading. What we want to know is whether a cached version of the table was used or whether the catalog loaded the table. The catalog should log when it loads a table, so this just needs to log when there was a cache hit.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479420342", "createdAt": "2020-08-28T16:46:14Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/CachingCatalog.java", "diffHunk": "@@ -63,7 +66,10 @@ private TableIdentifier canonicalizeIdentifier(TableIdentifier tableIdentifier)\n \n   @Override\n   public Table loadTable(TableIdentifier ident) {\n-    return tableCache.get(canonicalizeIdentifier(ident), catalog::loadTable);\n+    Table result = tableCache.get(canonicalizeIdentifier(ident), catalog::loadTable);\n+    LOG.info(\"Table loaded by catalog: {}\", result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODc5Nzkx", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477879791", "createdAt": "2020-08-28T16:47:07Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NzowN1rOHJNhdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NzowN1rOHJNhdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMDc4OQ==", "bodyText": "HadoopTables is logging this message, so there is no need to add it here. Also, can we log the location instead of the table instance?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479420789", "createdAt": "2020-08-28T16:47:07Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/hadoop/HadoopTables.java", "diffHunk": "@@ -71,20 +74,24 @@ public HadoopTables(Configuration conf) {\n    */\n   @Override\n   public Table load(String location) {\n+    Table result;\n     Pair<String, MetadataTableType> parsedMetadataType = parseMetadataType(location);\n \n     if (parsedMetadataType != null) {\n       // Load a metadata table\n-      return loadMetadataTable(parsedMetadataType.first(), parsedMetadataType.second());\n+      result = loadMetadataTable(parsedMetadataType.first(), parsedMetadataType.second());\n     } else {\n       // Load a normal table\n       TableOperations ops = newTableOps(location);\n       if (ops.current() != null) {\n-        return new BaseTable(ops, location);\n+        result = new BaseTable(ops, location);\n       } else {\n         throw new NoSuchTableException(\"Table does not exist at location: \" + location);\n       }\n     }\n+\n+    LOG.info(\"Table loaded by HadoopTables: {}\", result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODgwOTU4", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477880958", "createdAt": "2020-08-28T16:49:03Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0OTowM1rOHJNlGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0OTowM1rOHJNlGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMTcyMQ==", "bodyText": "Let's clean up the message a bit: \"Listing namespace {} returned tables: {}\"", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479421721", "createdAt": "2020-08-28T16:49:03Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -89,10 +91,13 @@ public HiveCatalog(String name, String uri, int clientPoolSize, Configuration co\n \n     try {\n       List<String> tables = clients.run(client -> client.getAllTables(database));\n-      return tables.stream()\n+      List<TableIdentifier> tableIdentifiers = tables.stream()\n           .map(t -> TableIdentifier.of(namespace, t))\n           .collect(Collectors.toList());\n \n+      LOG.debug(\"Listing of namespace: {} resulted in the following tables: {}\", namespace, tableIdentifiers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODgxNjc1", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477881675", "createdAt": "2020-08-28T16:50:12Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MDoxMlrOHJNnaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MDoxMlrOHJNnaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMjMxMw==", "bodyText": "Should this be info?\nI doubt that this is much help if you have to turn debug on and re-run because whether the table exists is external and modified by this method.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479422313", "createdAt": "2020-08-28T16:50:12Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -138,9 +143,11 @@ public boolean dropTable(TableIdentifier identifier, boolean purge) {\n         dropTableData(ops.io(), lastMetadata);\n       }\n \n+      LOG.info(\"Dropped table: {}\", identifier);\n       return true;\n \n     } catch (NoSuchTableException | NoSuchObjectException e) {\n+      LOG.debug(\"Skipping drop, table does not exist: {}\", identifier, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODgxODEx", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477881811", "createdAt": "2020-08-28T16:50:26Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MDoyN1rOHJNnzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MDoyN1rOHJNnzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMjQxNQ==", "bodyText": "No need for colons after from and to.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479422415", "createdAt": "2020-08-28T16:50:27Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -177,6 +184,8 @@ public void renameTable(TableIdentifier from, TableIdentifier originalTo) {\n         return null;\n       });\n \n+      LOG.info(\"Renamed table from: {}, to: {}\", from, to);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODgzMzAz", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477883303", "createdAt": "2020-08-28T16:52:39Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MjozOVrOHJNsRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MjozOVrOHJNsRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMzU1Ng==", "bodyText": "I'm really skeptical that this is a good idea. Properties can contain sensitive information that we don't want to leak into logs. If the operation succeeds, we can get the properties directly from the table. If it fails, we will get an exception and the properties that were attempted aren't very important (the user should also be able to tell us what they were).", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479423556", "createdAt": "2020-08-28T16:52:39Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -285,7 +300,15 @@ public boolean setProperties(Namespace namespace,  Map<String, String> propertie\n     parameter.putAll(properties);\n     Database database = convertToDatabase(namespace, parameter);\n \n-    return alterHiveDataBase(namespace, database);\n+    boolean result = alterHiveDataBase(namespace, database);\n+    if (LOG.isDebugEnabled()) {\n+      LOG.debug(\"Set properties for: {} to: {} resulted: {}\",\n+          namespace,\n+          Joiner.on(\",\").withKeyValueSeparator(\"=\").join(properties),\n+          result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 104}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODgzNTQ5", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477883549", "createdAt": "2020-08-28T16:53:00Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MzowMVrOHJNs9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1MzowMVrOHJNs9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMzczMg==", "bodyText": "Same here. I'd rather not add debug logs for properties.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479423732", "createdAt": "2020-08-28T16:53:01Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -296,7 +319,10 @@ public boolean removeProperties(Namespace namespace,  Set<String> properties) {\n     properties.forEach(key -> parameter.put(key, null));\n     Database database = convertToDatabase(namespace, parameter);\n \n-    return alterHiveDataBase(namespace, database);\n+    boolean result = alterHiveDataBase(namespace, database);\n+    LOG.debug(\"Remove properties: {} from: {} resulted: {}\", properties, namespace, result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODg0MDI4", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477884028", "createdAt": "2020-08-28T16:53:45Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NVrOHJNuZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NVrOHJNuZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDEwMw==", "bodyText": "Same here. We should not be logging potentially sensitive properties.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479424103", "createdAt": "2020-08-28T16:53:45Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -329,7 +355,13 @@ private boolean alterHiveDataBase(Namespace namespace,  Database database) {\n \n     try {\n       Database database = clients.run(client -> client.getDatabase(namespace.level(0)));\n-      return convertToMetadata(database);\n+      Map<String, String> metadata = convertToMetadata(database);\n+      if (LOG.isDebugEnabled()) {\n+        LOG.debug(\"For namespace: {} loaded metadata: {}\",\n+            namespace,\n+            Joiner.on(\",\").withKeyValueSeparator(\"=\").join(metadata));\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODg0NDgz", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477884483", "createdAt": "2020-08-28T16:54:25Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NDoyNVrOHJNvow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NDoyNVrOHJNvow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDQxOQ==", "bodyText": "Looks like this change is not needed. Could you roll it back?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479424419", "createdAt": "2020-08-28T16:54:25Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/Catalogs.java", "diffHunk": "@@ -68,10 +71,11 @@ private static Table loadTable(Configuration conf, String tableIdentifier, Strin\n     if (catalog.isPresent()) {\n       Preconditions.checkArgument(tableIdentifier != null, \"Table identifier not set\");\n       return catalog.get().loadTable(TableIdentifier.parse(tableIdentifier));\n+    } else {\n+      Preconditions.checkArgument(tableLocation != null, \"Table location not set\");\n+      return new HadoopTables(conf).load(tableLocation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODg1NDIz", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-477885423", "createdAt": "2020-08-28T16:55:51Z", "commit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NTo1MVrOHJNytQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NTo1MVrOHJNytQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNTIwNQ==", "bodyText": "How about logging a similar message in the HADOOP and HIVE cases instead of this?\nLOG.info(\"Loaded Hive Metastore catalog {}\", catalog);\n\nThat gives more information about the path the code took.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479425205", "createdAt": "2020-08-28T16:55:51Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/Catalogs.java", "diffHunk": "@@ -83,28 +87,33 @@ private static Table loadTable(Configuration conf, String tableIdentifier, Strin\n               .impl(catalogLoaderClass)\n               .build()\n               .newInstance();\n-      return Optional.of(loader.load(conf));\n+      Catalog catalog = loader.load(conf);\n+      LOG.info(\"Loaded catalog {} using {}\", catalog, catalogLoaderClass);\n+      return Optional.of(catalog);\n     }\n \n     String catalogName = conf.get(InputFormatConfig.CATALOG);\n \n     if (catalogName != null) {\n+      Catalog catalog;\n       switch (catalogName.toLowerCase()) {\n         case HADOOP:\n           String warehouseLocation = conf.get(InputFormatConfig.HADOOP_CATALOG_WAREHOUSE_LOCATION);\n \n-          if (warehouseLocation != null) {\n-            return Optional.of(new HadoopCatalog(conf, warehouseLocation));\n-          }\n-\n-          return Optional.of(new HadoopCatalog(conf));\n+          catalog = (warehouseLocation != null) ? new HadoopCatalog(conf, warehouseLocation) : new HadoopCatalog(conf);\n+          break;\n         case HIVE:\n-          return Optional.of(HiveCatalogs.loadCatalog(conf));\n+          catalog = HiveCatalogs.loadCatalog(conf);\n+          break;\n         default:\n           throw new NoSuchNamespaceException(\"Catalog \" + catalogName + \" is not supported.\");\n       }\n+\n+      LOG.info(\"Catalog is used: {}\", catalog);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a48b8813c1072ad67061796b1511f698efe151"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4dfb424e404408754f685215452c47eb89c749d", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/a4dfb424e404408754f685215452c47eb89c749d", "committedDate": "2020-08-28T19:47:27Z", "message": "Reverting the API changes, and changing some more log messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89ebfe17a8a29f8878ff61214093731e22df43ed", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/89ebfe17a8a29f8878ff61214093731e22df43ed", "committedDate": "2020-08-29T04:39:14Z", "message": "alterDatabase always returns true, so removed the return value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73970d0661c70c832bdf4dc50bb7c993c66b995", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/b73970d0661c70c832bdf4dc50bb7c993c66b995", "committedDate": "2020-08-29T20:32:20Z", "message": "Only a single newline - I suspect flaky tests, but not sure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTU3OTQ1", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-478157945", "createdAt": "2020-08-29T22:16:57Z", "commit": {"oid": "89ebfe17a8a29f8878ff61214093731e22df43ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQyMjoxNjo1OFrOHJeSDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQyMjoxNjo1OFrOHJeSDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY5NTM3Mg==", "bodyText": "This log doesn't seem useful to me since it doesn't have any information other than the method reached this point. It should be clear from other places (e.g., the SQL statement that ran) what was called. And we know it is successful or else an error is logged.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r479695372", "createdAt": "2020-08-29T22:16:58Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -300,17 +300,11 @@ public boolean setProperties(Namespace namespace,  Map<String, String> propertie\n     parameter.putAll(properties);\n     Database database = convertToDatabase(namespace, parameter);\n \n-    boolean result = alterHiveDataBase(namespace, database);\n+    alterHiveDataBase(namespace, database);\n+    LOG.debug(\"Successfully set properties for {}\", namespace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89ebfe17a8a29f8878ff61214093731e22df43ed"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86372a7d27d8eb5c39e4df8f2497667d90f740ff", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/86372a7d27d8eb5c39e4df8f2497667d90f740ff", "committedDate": "2020-08-30T06:08:08Z", "message": "Removed extra log line from setProperties/removeProperties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/8b823421e765e929db0f1cd8859ee77d974d65c7", "committedDate": "2020-08-30T06:16:20Z", "message": "Added back the setProperties/removeProperties log with printing the property names in both cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODY0NjQw", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-479864640", "createdAt": "2020-09-01T15:30:20Z", "commit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMDoyMFrOHK8HnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMDoyMFrOHK8HnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIzMjc5Nw==", "bodyText": "Could we rename this to tableName so it is more clear for implementations? It would also be good to add Javadoc.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r481232797", "createdAt": "2020-09-01T15:30:20Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreTableOperations.java", "diffHunk": "@@ -54,6 +54,10 @@\n   protected BaseMetastoreTableOperations() {\n   }\n \n+  protected String fullName() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODY1ODMz", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-479865833", "createdAt": "2020-09-01T15:31:37Z", "commit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMTozN1rOHK8K2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMTozN1rOHK8K2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIzMzYyNA==", "bodyText": "Is this change needed? This is an instance variable so there should be no need to call the getter.", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r481233624", "createdAt": "2020-09-01T15:31:37Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -111,7 +116,7 @@ protected void doRefresh() {\n     String metadataLocation = null;\n     try {\n       Table table = metaClients.run(client -> client.getTable(database, tableName));\n-      validateTableIsIceberg(table, fullName);\n+      validateTableIsIceberg(table, fullName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODY2NDEy", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-479866412", "createdAt": "2020-09-01T15:32:15Z", "commit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMjoxNVrOHK8MkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMjoxNVrOHK8MkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIzNDA2NA==", "bodyText": "How about Catalog is not configured instead?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r481234064", "createdAt": "2020-09-01T15:32:15Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/Catalogs.java", "diffHunk": "@@ -83,28 +86,32 @@ private static Table loadTable(Configuration conf, String tableIdentifier, Strin\n               .impl(catalogLoaderClass)\n               .build()\n               .newInstance();\n-      return Optional.of(loader.load(conf));\n+      Catalog catalog = loader.load(conf);\n+      LOG.info(\"Loaded catalog {} using {}\", catalog, catalogLoaderClass);\n+      return Optional.of(catalog);\n     }\n \n     String catalogName = conf.get(InputFormatConfig.CATALOG);\n \n     if (catalogName != null) {\n+      Catalog catalog;\n       switch (catalogName.toLowerCase()) {\n         case HADOOP:\n           String warehouseLocation = conf.get(InputFormatConfig.HADOOP_CATALOG_WAREHOUSE_LOCATION);\n \n-          if (warehouseLocation != null) {\n-            return Optional.of(new HadoopCatalog(conf, warehouseLocation));\n-          }\n-\n-          return Optional.of(new HadoopCatalog(conf));\n+          catalog = (warehouseLocation != null) ? new HadoopCatalog(conf, warehouseLocation) : new HadoopCatalog(conf);\n+          LOG.info(\"Loaded Hadoop catalog {}\", catalog);\n+          return Optional.of(catalog);\n         case HIVE:\n-          return Optional.of(HiveCatalogs.loadCatalog(conf));\n+          catalog = HiveCatalogs.loadCatalog(conf);\n+          LOG.info(\"Loaded Hive Metastore catalog {}\", catalog);\n+          return Optional.of(catalog);\n         default:\n           throw new NoSuchNamespaceException(\"Catalog \" + catalogName + \" is not supported.\");\n       }\n     }\n \n+    LOG.info(\"No catalog is used\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b823421e765e929db0f1cd8859ee77d974d65c7"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01d4ed1eaea882b05c06c9482f89abecf4c86dda", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/01d4ed1eaea882b05c06c9482f89abecf4c86dda", "committedDate": "2020-09-01T18:34:31Z", "message": "Reverted from the usage of fullName() in HiveTableOperations.java\nFixed comment text in Catalogs.java\nRenamed fullName() to tableName() and added javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDQ0OTA3", "url": "https://github.com/apache/iceberg/pull/1394#pullrequestreview-480044907", "createdAt": "2020-09-01T19:17:26Z", "commit": {"oid": "01d4ed1eaea882b05c06c9482f89abecf4c86dda"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxOToxNzoyNlrOHLE0QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxOToxNzoyNlrOHLE0QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM3NTI5Nw==", "bodyText": "Sorry, but I didn't catch this before. This is logging a property map that could contain sensitive items. Could you log just the keys instead?", "url": "https://github.com/apache/iceberg/pull/1394#discussion_r481375297", "createdAt": "2020-09-01T19:17:26Z", "author": {"login": "rdblue"}, "path": "hive/src/main/java/org/apache/iceberg/hive/HiveCatalog.java", "diffHunk": "@@ -329,7 +350,9 @@ private boolean alterHiveDataBase(Namespace namespace,  Database database) {\n \n     try {\n       Database database = clients.run(client -> client.getDatabase(namespace.level(0)));\n-      return convertToMetadata(database);\n+      Map<String, String> metadata = convertToMetadata(database);\n+      LOG.debug(\"Loaded metadata for namespace {}\", namespace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01d4ed1eaea882b05c06c9482f89abecf4c86dda"}, "originalPosition": 138}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "636e499ebbec3f619eb0f4fec32c82c7479e7352", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/iceberg/commit/636e499ebbec3f619eb0f4fec32c82c7479e7352", "committedDate": "2020-09-01T19:22:34Z", "message": "Added logging the property keys too."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4133, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}