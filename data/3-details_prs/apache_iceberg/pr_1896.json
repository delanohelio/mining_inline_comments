{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MjIyNjEx", "number": 1896, "title": "Flink: Add PartitionedDeltaTaskWriter and UnpartitionedDeltaTaskWriter to write both insert and equality-deletes", "bodyText": "Introduced an new flink  delta task writer to write cdc events into iceberg table,  this PR is currently built on top of PR #1888.", "createdAt": "2020-12-09T14:32:26Z", "url": "https://github.com/apache/iceberg/pull/1896", "merged": true, "mergeCommit": {"oid": "314afd2a7dca0722153d4daaf74f0bd9634e8cd5"}, "closed": true, "closedAt": "2020-12-14T23:25:28Z", "author": {"login": "openinx"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkfv1kgFqTU0ODI0NzQ1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmOSTMgFqTU1MTk3NzU1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjQ3NDU5", "url": "https://github.com/apache/iceberg/pull/1896#pullrequestreview-548247459", "createdAt": "2020-12-09T14:37:49Z", "commit": {"oid": "ac53adcf456c3ce84bb58649ba29900d2955213d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDozNzo0OVrOICX3aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDozNzo0OVrOICX3aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM1OTA4Mw==", "bodyText": "It will need to add more unit tests,  such as:\n\nUpsert a key whose old values are located in partition1, while new values will be written in partition2.\nwrite the equality file with only equality columns ( the current unit test will write the full columns ).", "url": "https://github.com/apache/iceberg/pull/1896#discussion_r539359083", "createdAt": "2020-12-09T14:37:49Z", "author": {"login": "openinx"}, "path": "flink/src/test/java/org/apache/iceberg/flink/sink/TestDeltaTaskWriter.java", "diffHunk": "@@ -0,0 +1,200 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.flink.sink;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Locale;\n+import org.apache.flink.table.data.RowData;\n+import org.apache.iceberg.FileFormat;\n+import org.apache.iceberg.PartitionSpec;\n+import org.apache.iceberg.RowDelta;\n+import org.apache.iceberg.TableTestBase;\n+import org.apache.iceberg.data.IcebergGenerics;\n+import org.apache.iceberg.data.Record;\n+import org.apache.iceberg.flink.FlinkSchemaUtil;\n+import org.apache.iceberg.io.CloseableIterable;\n+import org.apache.iceberg.io.TaskWriter;\n+import org.apache.iceberg.io.WriteResult;\n+import org.apache.iceberg.relocated.com.google.common.collect.Lists;\n+import org.apache.iceberg.util.StructLikeSet;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+\n+import static org.apache.iceberg.flink.SimpleDataUtil.createDelete;\n+import static org.apache.iceberg.flink.SimpleDataUtil.createInsert;\n+import static org.apache.iceberg.flink.SimpleDataUtil.createRecord;\n+import static org.apache.iceberg.flink.SimpleDataUtil.createUpdateAfter;\n+import static org.apache.iceberg.flink.SimpleDataUtil.createUpdateBefore;\n+\n+@RunWith(Parameterized.class)\n+public class TestDeltaTaskWriter extends TableTestBase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac53adcf456c3ce84bb58649ba29900d2955213d"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac53adcf456c3ce84bb58649ba29900d2955213d", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/ac53adcf456c3ce84bb58649ba29900d2955213d", "committedDate": "2020-12-09T14:29:26Z", "message": "Flink: Add PartitionedDeltaTaskWriter and UnpartitionedDeltaTaskWriter to write both insert and equality-deletes."}, "afterCommit": {"oid": "ce26c0777a29cd867b28ce85b4da8ab069ac0ef9", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/ce26c0777a29cd867b28ce85b4da8ab069ac0ef9", "committedDate": "2020-12-10T03:48:18Z", "message": "More unit tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4b8be5a23ecb002911b6e405592a7f7784857bd", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/f4b8be5a23ecb002911b6e405592a7f7784857bd", "committedDate": "2020-12-12T08:09:59Z", "message": "Flink: Add PartitionedDeltaTaskWriter and UnpartitionedDeltaTaskWriter to write both insert and equality-deletes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6f86c8ebf11a0a501f5a44367160e031b854ab4", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/d6f86c8ebf11a0a501f5a44367160e031b854ab4", "committedDate": "2020-12-10T07:17:26Z", "message": "More unit tests."}, "afterCommit": {"oid": "f4b8be5a23ecb002911b6e405592a7f7784857bd", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/f4b8be5a23ecb002911b6e405592a7f7784857bd", "committedDate": "2020-12-12T08:09:59Z", "message": "Flink: Add PartitionedDeltaTaskWriter and UnpartitionedDeltaTaskWriter to write both insert and equality-deletes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3c3f9b5d72e5741af1308607fc66618fac68b9f", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/c3c3f9b5d72e5741af1308607fc66618fac68b9f", "committedDate": "2020-12-12T08:16:32Z", "message": "Minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0efb98a9dfe4e6721758413c339bd2bbdd5ab933", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/0efb98a9dfe4e6721758413c339bd2bbdd5ab933", "committedDate": "2020-12-12T08:57:48Z", "message": "Keep the atomic semantic for INSERT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTc3NTUz", "url": "https://github.com/apache/iceberg/pull/1896#pullrequestreview-551977553", "createdAt": "2020-12-14T23:25:01Z", "commit": {"oid": "0efb98a9dfe4e6721758413c339bd2bbdd5ab933"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3573, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}