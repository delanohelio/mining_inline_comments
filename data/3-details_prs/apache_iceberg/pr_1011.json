{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0Njc5NzYx", "number": 1011, "title": "Introduce a CloseableIterator to remove the consfusing currentCloseable in BaseDataReader", "bodyText": "When I read the BaseDataReader.java, I find that there's a member named currentCloseable which would be set with a value in its sub-class (RowDataReader), that confuse me a lot.  This also introduced a checkstyle waring @SuppressWarnings(\"checkstyle:VisibilityModifier\").\nI think it will be more clear if we introduce a CloseableIterator, say for each CloseableIterable we can create a CloseableIterator,  once we iterated all the element then just call the iterator#close to close the resources,  don't have to maintain two instances: one for Iterator and one for Closeable.", "createdAt": "2020-05-07T13:16:06Z", "url": "https://github.com/apache/iceberg/pull/1011", "merged": true, "mergeCommit": {"oid": "2f9f41d1acc11dfe85e14d695bb2bc2398928fc9"}, "closed": true, "closedAt": "2020-05-15T15:58:08Z", "author": {"login": "openinx"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce9KRFABqjMzMTI4NTc1NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchfvKKgBqjMzNDAzODIzMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b975deed6044f945bad2a002ae205af8ceeda600", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/b975deed6044f945bad2a002ae205af8ceeda600", "committedDate": "2020-05-07T13:06:25Z", "message": "Introduce a CloseableIterator to remove the consfusing currentCloseable in BaseDataReader"}, "afterCommit": {"oid": "9046d189541310affdd79bf4cf2e22f11a7597b3", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/9046d189541310affdd79bf4cf2e22f11a7597b3", "committedDate": "2020-05-07T13:18:57Z", "message": "Introduce a CloseableIterator to remove the consfusing currentCloseable in BaseDataReader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjE0NzIx", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-407614721", "createdAt": "2020-05-07T15:58:41Z", "commit": {"oid": "bae4917de65f739d1094e3162127f45620c465f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTo1ODo0MVrOGSFaCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTo1ODo0MVrOGSFaCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYxNjEzOA==", "bodyText": "This isn't correct. CloseableIterable#close will close all open iterators created by the Iterable. The purpose is to enable try-with-resources instead of relying on callers to remember to close:\ntry (CloseableIterable<T> iterable = open(...)) {\n  for (T item : iterable) {\n    process(item);\n  }\n}\nIf an iterator closed the iterable, then it would close other iterators that may be still used in other threads.\nInstead, this should check whether iterator is Closeable and call close on it.", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r421616138", "createdAt": "2020-05-07T15:58:41Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/io/CloseableIterable.java", "diffHunk": "@@ -32,6 +32,27 @@\n import org.apache.iceberg.exceptions.RuntimeIOException;\n \n public interface CloseableIterable<T> extends Iterable<T>, Closeable {\n+\n+  default CloseableIterator<T> closeableIterator() {\n+    Iterator<T> iterator = iterator();\n+    return new CloseableIterator<T>() {\n+      @Override\n+      public void close() throws IOException {\n+        CloseableIterable.this.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bae4917de65f739d1094e3162127f45620c465f3"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjE2NTUx", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-407616551", "createdAt": "2020-05-07T16:00:45Z", "commit": {"oid": "bae4917de65f739d1094e3162127f45620c465f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjowMDo0NVrOGSFf6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjowMDo0NVrOGSFf6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYxNzY0Mg==", "bodyText": "Even if this is correct style, I don't think it is worth changing because it can cause commit conflicts.", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r421617642", "createdAt": "2020-05-07T16:00:45Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/mapreduce/IcebergInputFormat.java", "diffHunk": "@@ -359,25 +357,26 @@ public void close() throws IOException {\n       return nameToPos;\n     }\n \n-    private Iterator<T> open(FileScanTask currentTask) {\n+    private CloseableIterator<T> open(FileScanTask currentTask) {\n       DataFile file = currentTask.file();\n       // schema of rows returned by readers\n       PartitionSpec spec = currentTask.spec();\n-      Set<Integer> idColumns =  Sets.intersection(spec.identitySourceIds(), TypeUtil.getProjectedIds(expectedSchema));\n+      Set<Integer> idColumns = Sets.intersection(spec.identitySourceIds(), TypeUtil.getProjectedIds(expectedSchema));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bae4917de65f739d1094e3162127f45620c465f3"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6db9ff7b3ca9550fff57145c1417b2b8a999b6e", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/a6db9ff7b3ca9550fff57145c1417b2b8a999b6e", "committedDate": "2020-05-08T03:33:29Z", "message": "Only close the current iterator in CloseableIterator instead of closing all the iteraters"}, "afterCommit": {"oid": "8393933822410c3bbcd1e487892bd8236c742959", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/8393933822410c3bbcd1e487892bd8236c742959", "committedDate": "2020-05-08T03:41:26Z", "message": "Only close the current iterator in CloseableIterator instead of closing all the iteraters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzcyMTk5", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-409372199", "createdAt": "2020-05-11T17:18:40Z", "commit": {"oid": "8393933822410c3bbcd1e487892bd8236c742959"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxODo0MVrOGTlz8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxODo0MVrOGTlz8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NTYzMg==", "bodyText": "Why doesn't this update iterator to return a CloseableIterator? I don't think it is a good idea to have two methods that do basically the same thing, but one provides a closeable version. Then we need to remember to call this variant.", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r423195632", "createdAt": "2020-05-11T17:18:41Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/io/CloseableIterable.java", "diffHunk": "@@ -32,6 +32,31 @@\n import org.apache.iceberg.exceptions.RuntimeIOException;\n \n public interface CloseableIterable<T> extends Iterable<T>, Closeable {\n+\n+  default CloseableIterator<T> closeableIterator() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8393933822410c3bbcd1e487892bd8236c742959"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA0NjQ4", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410504648", "createdAt": "2020-05-13T00:08:30Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDowODozMFrOGUdJlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDowODozMFrOGUdJlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMjI5NA==", "bodyText": "This changes the semantics of the iterator. Before, the iterators returned by this could be Closeable, but the Iterable itself was not Closeable. I think it would be unlikely to have an Iterable without a close operation that produced an Iterator that could be closed (since it should be a CloseableGroup) but I still think it makes sense to preserve whether the Iterator is Closeable here.\nHow about using CloseableIterator.wrap that calls close on the wrapped Iterator if it is Closeable?", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424102294", "createdAt": "2020-05-13T00:08:30Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/io/CloseableIterable.java", "diffHunk": "@@ -43,8 +52,8 @@ public void close() {\n       }\n \n       @Override\n-      public Iterator<E> iterator() {\n-        return iterable.iterator();\n+      public CloseableIterator<E> iterator() {\n+        return CloseableIterator.withNoopClose(iterable.iterator());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA1Mzg1", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410505385", "createdAt": "2020-05-13T00:11:23Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMToyNFrOGUdMVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMToyNFrOGUdMVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMjk5Ng==", "bodyText": "Nit: could you add this line back to avoid commit conflicts?", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424102996", "createdAt": "2020-05-13T00:11:24Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/io/CloseableIterable.java", "diffHunk": "@@ -192,5 +206,4 @@ public E next() {\n       }\n     }\n   }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA1NTE5", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410505519", "createdAt": "2020-05-13T00:11:53Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMTo1M1rOGUdMxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMTo1M1rOGUdMxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMzEwOQ==", "bodyText": "Nit: Can you add a newline after this if block?", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424103109", "createdAt": "2020-05-13T00:11:53Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/io/CloseableIterator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.io;\n+\n+import java.io.Closeable;\n+import java.io.IOException;\n+import java.util.Iterator;\n+\n+public interface CloseableIterator<T> extends Iterator<T>, Closeable {\n+\n+  static <E> CloseableIterator<E> withNoopClose(Iterator<E> iterator) {\n+    if (iterator instanceof CloseableIterator) {\n+      return (CloseableIterator<E>) iterator;\n+    }\n+    return new CloseableIterator<E>() {\n+      @Override\n+      public void close() throws IOException {\n+        // do nothing.\n+      }\n+\n+      @Override\n+      public boolean hasNext() {\n+        return iterator.hasNext();\n+      }\n+\n+      @Override\n+      public E next() {\n+        return iterator.next();\n+      }\n+    };\n+  }\n+\n+  static <E> CloseableIterator<E> withClose(Iterator<E> iterator) {\n+    if (iterator instanceof CloseableIterator) {\n+      return (CloseableIterator<E>) iterator;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA1NTg1", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410505585", "createdAt": "2020-05-13T00:12:05Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMjowNVrOGUdNAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMjowNVrOGUdNAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMzE2OA==", "bodyText": "I don't think this is needed after removing it above. The other class will work fine because it won't call close if the Iterator doesn't implement Closeable.", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424103168", "createdAt": "2020-05-13T00:12:05Z", "author": {"login": "rdblue"}, "path": "api/src/main/java/org/apache/iceberg/io/CloseableIterator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.io;\n+\n+import java.io.Closeable;\n+import java.io.IOException;\n+import java.util.Iterator;\n+\n+public interface CloseableIterator<T> extends Iterator<T>, Closeable {\n+\n+  static <E> CloseableIterator<E> withNoopClose(Iterator<E> iterator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA2MTky", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410506192", "createdAt": "2020-05-13T00:14:14Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNDoxNFrOGUdPGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNDoxNFrOGUdPGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMzcwNQ==", "bodyText": "Can you add a newline after the control flow block above?", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424103705", "createdAt": "2020-05-13T00:14:14Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/mapreduce/IcebergInputFormat.java", "diffHunk": "@@ -359,25 +357,26 @@ public void close() throws IOException {\n       return nameToPos;\n     }\n \n-    private Iterator<T> open(FileScanTask currentTask) {\n+    private CloseableIterator<T> open(FileScanTask currentTask) {\n       DataFile file = currentTask.file();\n       // schema of rows returned by readers\n       PartitionSpec spec = currentTask.spec();\n       Set<Integer> idColumns =  Sets.intersection(spec.identitySourceIds(), TypeUtil.getProjectedIds(expectedSchema));\n       boolean hasJoinedPartitionColumns = !idColumns.isEmpty();\n \n+      CloseableIterable<T> iterable;\n       if (hasJoinedPartitionColumns) {\n         Schema readDataSchema = TypeUtil.selectNot(expectedSchema, idColumns);\n         Schema identityPartitionSchema = TypeUtil.select(expectedSchema, idColumns);\n-        return Iterators.transform(\n-            open(currentTask, readDataSchema),\n+        iterable = CloseableIterable.transform(open(currentTask, readDataSchema),\n             row -> withIdentityPartitionColumns(row, identityPartitionSchema, spec, file.partition()));\n       } else {\n-        return open(currentTask, expectedSchema);\n+        iterable = open(currentTask, expectedSchema);\n       }\n+      return iterable.iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA2Mjkw", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410506290", "createdAt": "2020-05-13T00:14:30Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNDozMFrOGUdPYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNDozMFrOGUdPYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMzc3OA==", "bodyText": "Same here. Could you add a newline after the control flow block?", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424103778", "createdAt": "2020-05-13T00:14:30Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/mapreduce/IcebergInputFormat.java", "diffHunk": "@@ -396,8 +395,7 @@ public void close() throws IOException {\n           throw new UnsupportedOperationException(\n               String.format(\"Cannot read %s file: %s\", file.format().name(), file.path()));\n       }\n-      currentCloseable = iterable;\n-      return iterable.iterator();\n+      return iterable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA2NTg1", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410506585", "createdAt": "2020-05-13T00:15:29Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNToyOVrOGUdQkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNToyOVrOGUdQkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwNDA4MA==", "bodyText": "What about adding CloseableIterator.empty() to avoid this?", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424104080", "createdAt": "2020-05-13T00:15:29Z", "author": {"login": "rdblue"}, "path": "spark/src/main/java/org/apache/iceberg/spark/source/BaseDataReader.java", "diffHunk": "@@ -64,8 +61,7 @@\n     ImmutableMap.Builder<String, InputFile> inputFileBuilder = ImmutableMap.builder();\n     decryptedFiles.forEach(decrypted -> inputFileBuilder.put(decrypted.location(), decrypted));\n     this.inputFiles = inputFileBuilder.build();\n-    this.currentCloseable = CloseableIterable.empty();\n-    this.currentIterator = Collections.emptyIterator();\n+    this.currentIterator = CloseableIterable.<T>empty().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTA2NzMw", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-410506730", "createdAt": "2020-05-13T00:16:04Z", "commit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNjowNFrOGUdRGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxNjowNFrOGUdRGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwNDIxOA==", "bodyText": "Here as well, it would be more readable to have a newline after the if/else block.", "url": "https://github.com/apache/iceberg/pull/1011#discussion_r424104218", "createdAt": "2020-05-13T00:16:04Z", "author": {"login": "rdblue"}, "path": "spark/src/main/java/org/apache/iceberg/spark/source/RowDataReader.java", "diffHunk": "@@ -150,10 +151,7 @@\n               \"Cannot read unknown format: \" + task.file().format());\n       }\n     }\n-\n-    this.currentCloseable = iter;\n-\n-    return iter.iterator();\n+    return iter;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272a019b327124bb400500d56335632190fefe0e"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTc5NzM2", "url": "https://github.com/apache/iceberg/pull/1011#pullrequestreview-412179736", "createdAt": "2020-05-14T20:59:00Z", "commit": {"oid": "65a4d4d8e216cbcd538398641baa8a035d7640fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade88aa83392bd56e2b04c1a679e32bad1c7ed0f", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/ade88aa83392bd56e2b04c1a679e32bad1c7ed0f", "committedDate": "2020-05-15T10:30:10Z", "message": "Introduce a CloseableIterator to remove the consfusing currentCloseable in BaseDataReader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cb2deb6f2a8117a0453e55cd90e14efbf06501e", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/0cb2deb6f2a8117a0453e55cd90e14efbf06501e", "committedDate": "2020-05-15T10:30:10Z", "message": "Address the similiar issues in mr module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "badfedcd222dba8b8e0828f29ee487be35c9bc52", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/badfedcd222dba8b8e0828f29ee487be35c9bc52", "committedDate": "2020-05-15T10:30:10Z", "message": "Only close the current iterator in CloseableIterator instead of closing all the iteraters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99e587ff997c918a1c81bfce313ae7a5d7512df6", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/99e587ff997c918a1c81bfce313ae7a5d7512df6", "committedDate": "2020-05-15T10:38:53Z", "message": "Unified the closeableIterator and iterator into one"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73060b4fafe91492079f82939f14c3bd5c0cb10a", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/73060b4fafe91492079f82939f14c3bd5c0cb10a", "committedDate": "2020-05-15T10:38:53Z", "message": "Minor fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "494db3bf459708c39a4fcfaf03d83e07ec052c5e", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/494db3bf459708c39a4fcfaf03d83e07ec052c5e", "committedDate": "2020-05-15T10:38:53Z", "message": "Addressing the comments from ryan blue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "132afe5c3d59c2146254289e5f76fecb828017a1", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/132afe5c3d59c2146254289e5f76fecb828017a1", "committedDate": "2020-05-15T10:40:58Z", "message": "Resolve the conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65a4d4d8e216cbcd538398641baa8a035d7640fc", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/65a4d4d8e216cbcd538398641baa8a035d7640fc", "committedDate": "2020-05-13T02:03:39Z", "message": "Addressing the comments from ryan blue"}, "afterCommit": {"oid": "132afe5c3d59c2146254289e5f76fecb828017a1", "author": {"user": {"login": "openinx", "name": "openinx"}}, "url": "https://github.com/apache/iceberg/commit/132afe5c3d59c2146254289e5f76fecb828017a1", "committedDate": "2020-05-15T10:40:58Z", "message": "Resolve the conflicts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4664, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}