{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDk5MTY5", "number": 1351, "title": "Parquet: Ignore INT96 metrics while importing tables", "bodyText": "We fail while importing existing Parquet tables with INT96 timestamps as ParquetConversions.fromParquetPrimitive assumes the value is long. Since INT96 metrics are unreliable, I propose to ignore them.\njava.lang.ClassCastException: org.apache.iceberg.shaded.org.apache.parquet.io.api.Binary$ByteArrayBackedBinary cannot be cast to java.lang.Long\n\tat org.apache.iceberg.parquet.ParquetConversions.fromParquetPrimitive(ParquetConversions.java:48)\n\tat org.apache.iceberg.parquet.ParquetUtil.footerMetrics(ParquetUtil.java:133)\n\tat org.apache.iceberg.spark.SparkTableUtil.lambda$listParquetPartition$8(SparkTableUtil.java:426)\n\tat java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n\tat java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\n\tat java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)", "createdAt": "2020-08-17T22:29:18Z", "url": "https://github.com/apache/iceberg/pull/1351", "merged": true, "mergeCommit": {"oid": "c75f004c81b90a2c7265594ec6fc9fc6a581b8cc"}, "closed": true, "closedAt": "2020-08-20T16:22:44Z", "author": {"login": "aokolnychyi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_6PkygFqTQ2ODg3NjI0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_8SeuABqjM2NjQxMjE0OTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODc2MjQ5", "url": "https://github.com/apache/iceberg/pull/1351#pullrequestreview-468876249", "createdAt": "2020-08-17T22:34:49Z", "commit": {"oid": "b8faf5e2c7de6afdc5cf5be6597d03130e5c5969"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjozNDo0OVrOHB9Fjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjozNDo0OVrOHB9Fjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgxMTQ3MQ==", "bodyText": "We may want to include a justification for skipping: the stats are not reliable.", "url": "https://github.com/apache/iceberg/pull/1351#discussion_r471811471", "createdAt": "2020-08-17T22:34:49Z", "author": {"login": "rdblue"}, "path": "parquet/src/main/java/org/apache/iceberg/parquet/ParquetUtil.java", "diffHunk": "@@ -103,6 +103,11 @@ public static Metrics footerMetrics(ParquetMetadata metadata, MetricsConfig metr\n     for (BlockMetaData block : blocks) {\n       rowCount += block.getRowCount();\n       for (ColumnChunkMetaData column : block.getColumns()) {\n+        if (column.getPrimitiveType().getPrimitiveTypeName() == PrimitiveType.PrimitiveTypeName.INT96) {\n+          // skip metrics for INT96 timestamps", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8faf5e2c7de6afdc5cf5be6597d03130e5c5969"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODg3MzM5", "url": "https://github.com/apache/iceberg/pull/1351#pullrequestreview-468887339", "createdAt": "2020-08-17T23:03:56Z", "commit": {"oid": "ed6ff0620373eda1272ee27419c155983cddade6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91222dcf41e6ba7c5800da4a7edacae6a35ce680", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/91222dcf41e6ba7c5800da4a7edacae6a35ce680", "committedDate": "2020-08-18T00:19:50Z", "message": "Ignore only min/max stats"}, "afterCommit": {"oid": "c3c68a78bbf875ff400e19df2d02927d82493353", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/c3c68a78bbf875ff400e19df2d02927d82493353", "committedDate": "2020-08-18T00:55:13Z", "message": "Parquet: Ignore INT96 metrics while importing tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a4f05623ec36ee85ab8da611b1b4de70d636da6", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/6a4f05623ec36ee85ab8da611b1b4de70d636da6", "committedDate": "2020-08-18T00:57:19Z", "message": "Parquet: Ignore INT96 metrics while importing tables"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3c68a78bbf875ff400e19df2d02927d82493353", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/c3c68a78bbf875ff400e19df2d02927d82493353", "committedDate": "2020-08-18T00:55:13Z", "message": "Parquet: Ignore INT96 metrics while importing tables"}, "afterCommit": {"oid": "6a4f05623ec36ee85ab8da611b1b4de70d636da6", "author": {"user": {"login": "aokolnychyi", "name": "Anton Okolnychyi"}}, "url": "https://github.com/apache/iceberg/commit/6a4f05623ec36ee85ab8da611b1b4de70d636da6", "committedDate": "2020-08-18T00:57:19Z", "message": "Parquet: Ignore INT96 metrics while importing tables"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4069, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}