{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1ODczMDM0", "number": 1991, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjowNzozNlrOFJcboA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjowNzozNlrOFJcboA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDQ3MzI4OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/org/apache/iceberg/TestMergeAppend.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjowNzozNlrOILyI8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQyMDo0NDowMlrOIMBrww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIyNjczNw==", "bodyText": "Technically this limit needs to be at least 12817 bytes.\nThat's one byte larger than the number of bins used in the tests * the size of the largest manifest file in either test run (v1 or v2, v2 is slightly larger) for the set of operations defined in the test to meet their assertions, but I chose a value slightly larger / rounded value to match somewhat how the test was previously set up.\nFeel free to suggest a different value.", "url": "https://github.com/apache/iceberg/pull/1991#discussion_r549226737", "createdAt": "2020-12-28T06:07:36Z", "author": {"login": "kbendick"}, "path": "core/src/test/java/org/apache/iceberg/TestMergeAppend.java", "diffHunk": "@@ -239,8 +239,10 @@ public void testMergeWithExistingManifest() {\n   public void testManifestMergeMinCount() throws IOException {\n     Assert.assertEquals(\"Table should start empty\", 0, listManifestFiles().size());\n     table.updateProperties().set(TableProperties.MANIFEST_MIN_MERGE_COUNT, \"2\")\n-        // each manifest file is 5227 bytes, so 12000 bytes limit will give us 2 bins with 3 manifest/data files.\n-        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12000\")\n+        // Each initial v1/v2 ManifestFile is 5661/6397 bytes respectively. Merging two of the given\n+        // manifests make one v1/v2 ManifestFile of 5672/6408 bytes respectively, so 12850 bytes\n+        // limit will give us two bins with three manifest/data files.\n+        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12850\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e99c2e17b190aae09c0939338231ca3874cfaf7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ1MDE5Nw==", "bodyText": "3x the smaller size would be around 17k, and we need it to be at least about 13k, which is 2x the larger size. I'd probably set this to 15k to split the difference and hopefully avoid needing to update this again as tests change. This is minor, though.", "url": "https://github.com/apache/iceberg/pull/1991#discussion_r549450197", "createdAt": "2020-12-28T18:46:33Z", "author": {"login": "rdblue"}, "path": "core/src/test/java/org/apache/iceberg/TestMergeAppend.java", "diffHunk": "@@ -239,8 +239,10 @@ public void testMergeWithExistingManifest() {\n   public void testManifestMergeMinCount() throws IOException {\n     Assert.assertEquals(\"Table should start empty\", 0, listManifestFiles().size());\n     table.updateProperties().set(TableProperties.MANIFEST_MIN_MERGE_COUNT, \"2\")\n-        // each manifest file is 5227 bytes, so 12000 bytes limit will give us 2 bins with 3 manifest/data files.\n-        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12000\")\n+        // Each initial v1/v2 ManifestFile is 5661/6397 bytes respectively. Merging two of the given\n+        // manifests make one v1/v2 ManifestFile of 5672/6408 bytes respectively, so 12850 bytes\n+        // limit will give us two bins with three manifest/data files.\n+        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12850\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIyNjczNw=="}, "originalCommit": {"oid": "9e99c2e17b190aae09c0939338231ca3874cfaf7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ3NzkyMA==", "bodyText": "I'll open a patch to up this to 15k \ud83d\udc4d", "url": "https://github.com/apache/iceberg/pull/1991#discussion_r549477920", "createdAt": "2020-12-28T20:30:11Z", "author": {"login": "kbendick"}, "path": "core/src/test/java/org/apache/iceberg/TestMergeAppend.java", "diffHunk": "@@ -239,8 +239,10 @@ public void testMergeWithExistingManifest() {\n   public void testManifestMergeMinCount() throws IOException {\n     Assert.assertEquals(\"Table should start empty\", 0, listManifestFiles().size());\n     table.updateProperties().set(TableProperties.MANIFEST_MIN_MERGE_COUNT, \"2\")\n-        // each manifest file is 5227 bytes, so 12000 bytes limit will give us 2 bins with 3 manifest/data files.\n-        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12000\")\n+        // Each initial v1/v2 ManifestFile is 5661/6397 bytes respectively. Merging two of the given\n+        // manifests make one v1/v2 ManifestFile of 5672/6408 bytes respectively, so 12850 bytes\n+        // limit will give us two bins with three manifest/data files.\n+        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12850\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIyNjczNw=="}, "originalCommit": {"oid": "9e99c2e17b190aae09c0939338231ca3874cfaf7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4MTQxMQ==", "bodyText": "Opened a PR for the suggested 15k value: #1999", "url": "https://github.com/apache/iceberg/pull/1991#discussion_r549481411", "createdAt": "2020-12-28T20:44:02Z", "author": {"login": "kbendick"}, "path": "core/src/test/java/org/apache/iceberg/TestMergeAppend.java", "diffHunk": "@@ -239,8 +239,10 @@ public void testMergeWithExistingManifest() {\n   public void testManifestMergeMinCount() throws IOException {\n     Assert.assertEquals(\"Table should start empty\", 0, listManifestFiles().size());\n     table.updateProperties().set(TableProperties.MANIFEST_MIN_MERGE_COUNT, \"2\")\n-        // each manifest file is 5227 bytes, so 12000 bytes limit will give us 2 bins with 3 manifest/data files.\n-        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12000\")\n+        // Each initial v1/v2 ManifestFile is 5661/6397 bytes respectively. Merging two of the given\n+        // manifests make one v1/v2 ManifestFile of 5672/6408 bytes respectively, so 12850 bytes\n+        // limit will give us two bins with three manifest/data files.\n+        .set(TableProperties.MANIFEST_TARGET_SIZE_BYTES, \"12850\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIyNjczNw=="}, "originalCommit": {"oid": "9e99c2e17b190aae09c0939338231ca3874cfaf7"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3097, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}