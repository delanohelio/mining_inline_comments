{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0Nzc0Mjg0", "number": 1115, "title": "Refactor TableScan optional arguments into an immutable context object", "bodyText": "This PR is a refactor of TableScan implementations to use a TableScanContext object for the optional arguments used.\nAs discussed in #1094 (comment), when new arguments are added to a TableScan the number of changes needed is really large only to pass down the arguments through the refinement calls.\nThis change will make such changes more straightforward minimizing the number of changes required to add an argument, which would only be required now in the context object and in the specific TableScan that would use it, leading to more maintainable code.\nPTAL @aokolnychyi @rdblue", "createdAt": "2020-06-15T20:37:45Z", "url": "https://github.com/apache/iceberg/pull/1115", "merged": true, "mergeCommit": {"oid": "e2ef87c4c66c5ed6be13a335d4e03558bac5ec1a"}, "closed": true, "closedAt": "2020-06-17T00:12:06Z", "author": {"login": "edgarRd"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrSHrNAH2gAyNDM0Nzc0Mjg0Ojg3MThkMTYzN2Q5MDEzNzI3OGE3MjUwOWY1NzNhMTVkMjdhYWJlNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr8gjOgBqjM0NTEwMDY3NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8718d1637d90137278a72509f573a15d27aabe47", "author": {"user": {"login": "edgarRd", "name": "Edgar Rodriguez"}}, "url": "https://github.com/apache/iceberg/commit/8718d1637d90137278a72509f573a15d27aabe47", "committedDate": "2020-06-14T20:31:30Z", "message": "Refactor TableScan to use context object for args"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eb0cda065df99962a370ac3c271324735d6410a", "author": {"user": {"login": "edgarRd", "name": "Edgar Rodriguez"}}, "url": "https://github.com/apache/iceberg/commit/6eb0cda065df99962a370ac3c271324735d6410a", "committedDate": "2020-06-15T19:11:17Z", "message": "Add from/to snapshot Ids for incremental data scans"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDM1MjIw", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431035220", "createdAt": "2020-06-15T22:25:58Z", "commit": {"oid": "6eb0cda065df99962a370ac3c271324735d6410a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjoyNTo1OFrOGkE0QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjoyNTo1OFrOGkE0QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MDgzMw==", "bodyText": "I think a builder makes this refactor more awkward because the context is always copied twice. Once in the builder, then once when copy is called on the builder's result. It would be simpler to keep the refinement pattern, where every method that alters the context returns a new context. Like this:\n  TableScanContext caseSensitive() {\n    if (this.caseSensitive) {\n      return this;\n    } else {\n      return new TableScanContext(..., true /* case sensitive */, ...);\n    }\n  }", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r440480833", "createdAt": "2020-06-15T22:25:58Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,189 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  private TableScanContext(Long snapshotId, Expression rowFilter, boolean ignoreResiduals,\n+                           boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n+                           ImmutableMap<String, String> options, Long fromSnapshotId, Long toSnapshotId) {\n+    this.snapshotId = snapshotId;\n+    this.rowFilter = rowFilter;\n+    this.ignoreResiduals = ignoreResiduals;\n+    this.caseSensitive = caseSensitive;\n+    this.colStats = colStats;\n+    this.selectedColumns = selectedColumns;\n+    this.options = options;\n+    this.fromSnapshotId = fromSnapshotId;\n+    this.toSnapshotId = toSnapshotId;\n+  }\n+\n+  Long snapshotId() {\n+    return snapshotId;\n+  }\n+\n+  Expression rowFilter() {\n+    return rowFilter;\n+  }\n+\n+  boolean ignoreResiduals() {\n+    return ignoreResiduals;\n+  }\n+\n+  boolean caseSensitive() {\n+    return caseSensitive;\n+  }\n+\n+  boolean colStats() {\n+    return colStats;\n+  }\n+\n+  Collection<String> selectedColumns() {\n+    return selectedColumns;\n+  }\n+\n+  ImmutableMap<String, String> options() {\n+    return options;\n+  }\n+\n+  Long fromSnapshotId() {\n+    return fromSnapshotId;\n+  }\n+\n+  Long toSnapshotId() {\n+    return toSnapshotId;\n+  }\n+\n+  TableScanContext copy() {\n+    return TableScanContext.builder(this).build();\n+  }\n+\n+  static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  static Builder builder(TableScanContext other) {\n+    return new Builder(other);\n+  }\n+\n+  static class Builder {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eb0cda065df99962a370ac3c271324735d6410a"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b", "author": {"user": {"login": "edgarRd", "name": "Edgar Rodriguez"}}, "url": "https://github.com/apache/iceberg/commit/b4705304263f439f774c88273e7a9dbd114a462b", "committedDate": "2020-06-16T00:15:27Z", "message": "Remove builder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzQ0Mzgy", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431744382", "createdAt": "2020-06-16T17:41:45Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0MTo0NVrOGkmR9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0MTo0NVrOGkmR9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAyOTExMA==", "bodyText": "If the context is immutable, we don't need to call copy, right?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441029110", "createdAt": "2020-06-16T17:41:45Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/AllEntriesTable.java", "diffHunk": "@@ -81,23 +79,14 @@ public Schema schema() {\n       super(ops, table, schema);\n     }\n \n-    private Scan(\n-        TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n-        Collection<String> selectedColumns, ImmutableMap<String, String> options) {\n-      super(\n-          ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-          caseSensitive, colStats, selectedColumns, options);\n+    private Scan(TableOperations ops, Table table, Schema schema, TableScanContext context) {\n+      super(ops, table, schema, context);\n     }\n \n     @Override\n-    protected TableScan newRefinedScan(\n-        TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean ignoreResiduals, boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n-        ImmutableMap<String, String> options) {\n-      return new Scan(\n-          ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-          caseSensitive, colStats, selectedColumns, options);\n+    protected TableScan newRefinedScan(TableOperations ops, Table table, Schema schema,\n+                                       TableScanContext context) {\n+      return new Scan(ops, table, schema, context.copy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzQ1ODQ3", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431745847", "createdAt": "2020-06-16T17:43:43Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0Mzo0M1rOGkmWVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0Mzo0M1rOGkmWVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzMDIyOA==", "bodyText": "I think this should continue to be an IllegalArgumentException because it is validating the argument passed into useSnapshot. The problem is not with the context, it is with how the user is trying to modify that context.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441030228", "createdAt": "2020-06-16T17:43:43Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -135,19 +123,18 @@ public TableScan appendsAfter(long fromSnapshotId) {\n \n   @Override\n   public TableScan useSnapshot(long scanSnapshotId) {\n-    Preconditions.checkArgument(this.snapshotId == null,\n-        \"Cannot override snapshot, already set to id=%s\", snapshotId);\n+    Preconditions.checkState(context.snapshotId() == null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzQ3NTA4", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431747508", "createdAt": "2020-06-16T17:45:51Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0NTo1MVrOGkmbRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0NTo1MVrOGkmbRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzMTQ5NA==", "bodyText": "I think it would be better to add withOption(String property, String value) to context and move the map builder there, instead of replacing all options. That keeps this simple and delegates work to the class with the most context (tell, don't ask).", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441031494", "createdAt": "2020-06-16T17:45:51Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -167,59 +154,52 @@ public TableScan asOfTime(long timestampMillis) {\n   @Override\n   public TableScan option(String property, String value) {\n     ImmutableMap.Builder<String, String> builder = ImmutableMap.builder();\n-    builder.putAll(options);\n+    builder.putAll(context.options());\n     builder.put(property, value);\n \n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, builder.build());\n+        ops, table, schema, context.options(builder.build()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzQ4MDUw", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431748050", "createdAt": "2020-06-16T17:46:33Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0NjozM1rOGkmdIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0NjozM1rOGkmdIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzMTk2OA==", "bodyText": "What is your rationale for not making projectedSchema part of context?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441031968", "createdAt": "2020-06-16T17:46:33Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -167,59 +154,52 @@ public TableScan asOfTime(long timestampMillis) {\n   @Override\n   public TableScan option(String property, String value) {\n     ImmutableMap.Builder<String, String> builder = ImmutableMap.builder();\n-    builder.putAll(options);\n+    builder.putAll(context.options());\n     builder.put(property, value);\n \n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, builder.build());\n+        ops, table, schema, context.options(builder.build()));\n   }\n \n   @Override\n   public TableScan project(Schema projectedSchema) {\n     return newRefinedScan(\n-        ops, table, snapshotId, projectedSchema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, options);\n+        ops, table, projectedSchema, context.copy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzQ5ODMx", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431749831", "createdAt": "2020-06-16T17:48:50Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0ODo1MFrOGkmiag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0ODo1MFrOGkmiag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzMzMyMg==", "bodyText": "I think it is worth renaming some of these methods; selectedColumns is a noun, not a verb. I would expect a method to be phrased using a verb, like selectColumns(columns). Otherwise, this is just dropping set from a setter method.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441033322", "createdAt": "2020-06-16T17:48:50Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -167,59 +154,52 @@ public TableScan asOfTime(long timestampMillis) {\n   @Override\n   public TableScan option(String property, String value) {\n     ImmutableMap.Builder<String, String> builder = ImmutableMap.builder();\n-    builder.putAll(options);\n+    builder.putAll(context.options());\n     builder.put(property, value);\n \n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, builder.build());\n+        ops, table, schema, context.options(builder.build()));\n   }\n \n   @Override\n   public TableScan project(Schema projectedSchema) {\n     return newRefinedScan(\n-        ops, table, snapshotId, projectedSchema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, options);\n+        ops, table, projectedSchema, context.copy());\n   }\n \n   @Override\n   public TableScan caseSensitive(boolean scanCaseSensitive) {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        scanCaseSensitive, colStats, selectedColumns, options);\n+        ops, table, schema, context.caseSensitive(scanCaseSensitive));\n   }\n \n   @Override\n   public TableScan includeColumnStats() {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, true, selectedColumns, options);\n+        ops, table, schema, context.colStats(true));\n   }\n \n   @Override\n   public TableScan select(Collection<String> columns) {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, columns, options);\n+        ops, table, schema, context.selectedColumns(columns));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 149}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzUwMzQ0", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431750344", "createdAt": "2020-06-16T17:49:29Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0OToyOVrOGkmj5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo0OToyOVrOGkmj5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzMzcwMw==", "bodyText": "Since ignoreResiduals is a verb, it would be more consistent to make all of the methods verbs.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441033703", "createdAt": "2020-06-16T17:49:29Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -167,59 +154,52 @@ public TableScan asOfTime(long timestampMillis) {\n   @Override\n   public TableScan option(String property, String value) {\n     ImmutableMap.Builder<String, String> builder = ImmutableMap.builder();\n-    builder.putAll(options);\n+    builder.putAll(context.options());\n     builder.put(property, value);\n \n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, builder.build());\n+        ops, table, schema, context.options(builder.build()));\n   }\n \n   @Override\n   public TableScan project(Schema projectedSchema) {\n     return newRefinedScan(\n-        ops, table, snapshotId, projectedSchema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, selectedColumns, options);\n+        ops, table, projectedSchema, context.copy());\n   }\n \n   @Override\n   public TableScan caseSensitive(boolean scanCaseSensitive) {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        scanCaseSensitive, colStats, selectedColumns, options);\n+        ops, table, schema, context.caseSensitive(scanCaseSensitive));\n   }\n \n   @Override\n   public TableScan includeColumnStats() {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, true, selectedColumns, options);\n+        ops, table, schema, context.colStats(true));\n   }\n \n   @Override\n   public TableScan select(Collection<String> columns) {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-        caseSensitive, colStats, columns, options);\n+        ops, table, schema, context.selectedColumns(columns));\n   }\n \n   @Override\n   public TableScan filter(Expression expr) {\n-    return newRefinedScan(\n-        ops, table, snapshotId, schema, Expressions.and(rowFilter, expr),\n-        ignoreResiduals, caseSensitive, colStats, selectedColumns, options);\n+    return newRefinedScan(ops, table, schema,\n+        context.rowFilter(Expressions.and(context.rowFilter(), expr)));\n   }\n \n   @Override\n   public Expression filter() {\n-    return rowFilter;\n+    return context.rowFilter();\n   }\n \n   @Override\n   public TableScan ignoreResiduals() {\n     return newRefinedScan(\n-        ops, table, snapshotId, schema, rowFilter, true,\n-        caseSensitive, colStats, selectedColumns, options);\n+        ops, table, schema, context.ignoreResiduals(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 172}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzUxMTMy", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431751132", "createdAt": "2020-06-16T17:50:32Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MDozMlrOGkmmWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MDozMlrOGkmmWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNDMzMA==", "bodyText": "We avoid leaking specific classes through the API. Can you update this to use Map instead? The getter method options should also only return Map.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441034330", "createdAt": "2020-06-16T17:50:32Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -243,6 +224,7 @@ public TableScan ignoreResiduals() {\n \n   @Override\n   public CloseableIterable<CombinedScanTask> planTasks() {\n+    ImmutableMap<String, String> options = context.options();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 197}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzUxNjcz", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431751673", "createdAt": "2020-06-16T17:51:15Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MToxNVrOGkmoFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MToxNVrOGkmoFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNDc3Mw==", "bodyText": "This use of selectedColumns works because it is a getter.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441034773", "createdAt": "2020-06-16T17:51:15Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -304,16 +286,18 @@ public String toString() {\n    * @return the Schema to project\n    */\n   private Schema lazyColumnProjection() {\n+    Collection<String> selectedColumns = context.selectedColumns();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 236}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzUyMDI4", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431752028", "createdAt": "2020-06-16T17:51:43Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MTo0M1rOGkmpOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MTo0M1rOGkmpOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNTA2Nw==", "bodyText": "Nit: Does this need a newline?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441035067", "createdAt": "2020-06-16T17:51:43Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/DataFilesTable.java", "diffHunk": "@@ -76,24 +74,17 @@ public Schema schema() {\n       this.fileSchema = fileSchema;\n     }\n \n-    private FilesTableScan(\n-        TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n-        Collection<String> selectedColumns, Schema fileSchema, ImmutableMap<String, String> options) {\n-      super(\n-          ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-          caseSensitive, colStats, selectedColumns, options);\n+    private FilesTableScan(TableOperations ops, Table table, Schema schema, Schema fileSchema,\n+                           TableScanContext context) {\n+      super(ops, table, schema, context);\n       this.fileSchema = fileSchema;\n     }\n \n     @Override\n-    protected TableScan newRefinedScan(\n-        TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean ignoreResiduals, boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n-        ImmutableMap<String, String> options) {\n+    protected TableScan newRefinedScan(TableOperations ops, Table table, Schema schema,\n+                                       TableScanContext context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzUyMTIy", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431752122", "createdAt": "2020-06-16T17:51:51Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MTo1MlrOGkmpfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MTo1MlrOGkmpfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNTEzNQ==", "bodyText": "Same here: can we remove this newline?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441035135", "createdAt": "2020-06-16T17:51:52Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/DataFilesTable.java", "diffHunk": "@@ -76,24 +74,17 @@ public Schema schema() {\n       this.fileSchema = fileSchema;\n     }\n \n-    private FilesTableScan(\n-        TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n-        Collection<String> selectedColumns, Schema fileSchema, ImmutableMap<String, String> options) {\n-      super(\n-          ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-          caseSensitive, colStats, selectedColumns, options);\n+    private FilesTableScan(TableOperations ops, Table table, Schema schema, Schema fileSchema,\n+                           TableScanContext context) {\n+      super(ops, table, schema, context);\n       this.fileSchema = fileSchema;\n     }\n \n     @Override\n-    protected TableScan newRefinedScan(\n-        TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean ignoreResiduals, boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n-        ImmutableMap<String, String> options) {\n+    protected TableScan newRefinedScan(TableOperations ops, Table table, Schema schema,\n+                                       TableScanContext context) {\n       return new FilesTableScan(\n-          ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n-          caseSensitive, colStats, selectedColumns, fileSchema, options);\n+          ops, table, schema, fileSchema, context.copy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzU0MTY0", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431754164", "createdAt": "2020-06-16T17:54:33Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1NDozM1rOGkmvnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1NDozM1rOGkmvnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNjcwMA==", "bodyText": "I think it would be more clear and maintainable if this didn't use this(...). When new options are added, this list will need to change and it is easy to get off by one when passing in nulls. If instead this set each field default individually, it would be easier to read and avoid update errors.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441036700", "createdAt": "2020-06-16T17:54:33Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  TableScanContext() {\n+    this(null, Expressions.alwaysTrue(), false, true, false, null, ImmutableMap.of(), null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzU0NzUy", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431754752", "createdAt": "2020-06-16T17:55:22Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1NToyMlrOGkmxVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1NToyMlrOGkmxVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNzE0MQ==", "bodyText": "How about scanSnapshotId?\nAlso, why is id a boxed Long? If this is called, it should be non-null, right?\nWe always prefer primitive types so we can guarantee they are non-null.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441037141", "createdAt": "2020-06-16T17:55:22Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  TableScanContext() {\n+    this(null, Expressions.alwaysTrue(), false, true, false, null, ImmutableMap.of(), null, null);\n+  }\n+\n+  private TableScanContext(Long snapshotId, Expression rowFilter, boolean ignoreResiduals,\n+                           boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n+                           ImmutableMap<String, String> options, Long fromSnapshotId, Long toSnapshotId) {\n+    this.snapshotId = snapshotId;\n+    this.rowFilter = rowFilter;\n+    this.ignoreResiduals = ignoreResiduals;\n+    this.caseSensitive = caseSensitive;\n+    this.colStats = colStats;\n+    this.selectedColumns = selectedColumns;\n+    this.options = options;\n+    this.fromSnapshotId = fromSnapshotId;\n+    this.toSnapshotId = toSnapshotId;\n+  }\n+\n+  Long snapshotId() {\n+    return snapshotId;\n+  }\n+\n+  TableScanContext snapshotId(Long id) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzU0OTgy", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431754982", "createdAt": "2020-06-16T17:55:38Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1NTozOFrOGkmyDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1NTozOFrOGkmyDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNzMyNw==", "bodyText": "To make this a verb, how about filterRows?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441037327", "createdAt": "2020-06-16T17:55:38Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  TableScanContext() {\n+    this(null, Expressions.alwaysTrue(), false, true, false, null, ImmutableMap.of(), null, null);\n+  }\n+\n+  private TableScanContext(Long snapshotId, Expression rowFilter, boolean ignoreResiduals,\n+                           boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n+                           ImmutableMap<String, String> options, Long fromSnapshotId, Long toSnapshotId) {\n+    this.snapshotId = snapshotId;\n+    this.rowFilter = rowFilter;\n+    this.ignoreResiduals = ignoreResiduals;\n+    this.caseSensitive = caseSensitive;\n+    this.colStats = colStats;\n+    this.selectedColumns = selectedColumns;\n+    this.options = options;\n+    this.fromSnapshotId = fromSnapshotId;\n+    this.toSnapshotId = toSnapshotId;\n+  }\n+\n+  Long snapshotId() {\n+    return snapshotId;\n+  }\n+\n+  TableScanContext snapshotId(Long id) {\n+    return new TableScanContext(id, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Expression rowFilter() {\n+    return rowFilter;\n+  }\n+\n+  TableScanContext rowFilter(Expression filter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzU2NzQ5", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431756749", "createdAt": "2020-06-16T17:57:46Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1Nzo0N1rOGkm3cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1Nzo0N1rOGkm3cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzODcwNg==", "bodyText": "This controls whether or not column stats are returned in the DataFile instances in the resulting splits, not whether column stats should be used in planning. Columns stats are always used in planning. To avoid confusion, can you rename this to shouldReturnColumnStats? A similar update for the getter would be useful as well.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441038706", "createdAt": "2020-06-16T17:57:47Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  TableScanContext() {\n+    this(null, Expressions.alwaysTrue(), false, true, false, null, ImmutableMap.of(), null, null);\n+  }\n+\n+  private TableScanContext(Long snapshotId, Expression rowFilter, boolean ignoreResiduals,\n+                           boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n+                           ImmutableMap<String, String> options, Long fromSnapshotId, Long toSnapshotId) {\n+    this.snapshotId = snapshotId;\n+    this.rowFilter = rowFilter;\n+    this.ignoreResiduals = ignoreResiduals;\n+    this.caseSensitive = caseSensitive;\n+    this.colStats = colStats;\n+    this.selectedColumns = selectedColumns;\n+    this.options = options;\n+    this.fromSnapshotId = fromSnapshotId;\n+    this.toSnapshotId = toSnapshotId;\n+  }\n+\n+  Long snapshotId() {\n+    return snapshotId;\n+  }\n+\n+  TableScanContext snapshotId(Long id) {\n+    return new TableScanContext(id, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Expression rowFilter() {\n+    return rowFilter;\n+  }\n+\n+  TableScanContext rowFilter(Expression filter) {\n+    return new TableScanContext(snapshotId, filter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean ignoreResiduals() {\n+    return ignoreResiduals;\n+  }\n+\n+  TableScanContext ignoreResiduals(boolean shouldIgnoreResiduals) {\n+    return new TableScanContext(snapshotId, rowFilter, shouldIgnoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean caseSensitive() {\n+    return caseSensitive;\n+  }\n+\n+  TableScanContext caseSensitive(boolean isCaseSensitive) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        isCaseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean colStats() {\n+    return colStats;\n+  }\n+\n+  TableScanContext colStats(boolean shouldUseColumnStats) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzU2ODk1", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431756895", "createdAt": "2020-06-16T17:57:59Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1Nzo1OVrOGkm36g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1Nzo1OVrOGkm36g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzODgyNg==", "bodyText": "As I noted above, how about selectColumns?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441038826", "createdAt": "2020-06-16T17:57:59Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  TableScanContext() {\n+    this(null, Expressions.alwaysTrue(), false, true, false, null, ImmutableMap.of(), null, null);\n+  }\n+\n+  private TableScanContext(Long snapshotId, Expression rowFilter, boolean ignoreResiduals,\n+                           boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n+                           ImmutableMap<String, String> options, Long fromSnapshotId, Long toSnapshotId) {\n+    this.snapshotId = snapshotId;\n+    this.rowFilter = rowFilter;\n+    this.ignoreResiduals = ignoreResiduals;\n+    this.caseSensitive = caseSensitive;\n+    this.colStats = colStats;\n+    this.selectedColumns = selectedColumns;\n+    this.options = options;\n+    this.fromSnapshotId = fromSnapshotId;\n+    this.toSnapshotId = toSnapshotId;\n+  }\n+\n+  Long snapshotId() {\n+    return snapshotId;\n+  }\n+\n+  TableScanContext snapshotId(Long id) {\n+    return new TableScanContext(id, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Expression rowFilter() {\n+    return rowFilter;\n+  }\n+\n+  TableScanContext rowFilter(Expression filter) {\n+    return new TableScanContext(snapshotId, filter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean ignoreResiduals() {\n+    return ignoreResiduals;\n+  }\n+\n+  TableScanContext ignoreResiduals(boolean shouldIgnoreResiduals) {\n+    return new TableScanContext(snapshotId, rowFilter, shouldIgnoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean caseSensitive() {\n+    return caseSensitive;\n+  }\n+\n+  TableScanContext caseSensitive(boolean isCaseSensitive) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        isCaseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean colStats() {\n+    return colStats;\n+  }\n+\n+  TableScanContext colStats(boolean shouldUseColumnStats) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        caseSensitive, shouldUseColumnStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Collection<String> selectedColumns() {\n+    return selectedColumns;\n+  }\n+\n+  TableScanContext selectedColumns(Collection<String> columns) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzU3MzQz", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431757343", "createdAt": "2020-06-16T17:58:33Z", "commit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1ODozM1rOGkm5SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1ODozM1rOGkm5SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzOTE3Nw==", "bodyText": "I'm not sure this is needed if the context is immutable.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441039177", "createdAt": "2020-06-16T17:58:33Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/TableScanContext.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg;\n+\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.iceberg.expressions.Expression;\n+import org.apache.iceberg.expressions.Expressions;\n+import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Context object with optional arguments for a TableScan.\n+ */\n+final class TableScanContext {\n+  private final Long snapshotId;\n+  private final Expression rowFilter;\n+  private final boolean ignoreResiduals;\n+  private final boolean caseSensitive;\n+  private final boolean colStats;\n+  private final Collection<String> selectedColumns;\n+  private final ImmutableMap<String, String> options;\n+  private final Long fromSnapshotId;\n+  private final Long toSnapshotId;\n+\n+  TableScanContext() {\n+    this(null, Expressions.alwaysTrue(), false, true, false, null, ImmutableMap.of(), null, null);\n+  }\n+\n+  private TableScanContext(Long snapshotId, Expression rowFilter, boolean ignoreResiduals,\n+                           boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n+                           ImmutableMap<String, String> options, Long fromSnapshotId, Long toSnapshotId) {\n+    this.snapshotId = snapshotId;\n+    this.rowFilter = rowFilter;\n+    this.ignoreResiduals = ignoreResiduals;\n+    this.caseSensitive = caseSensitive;\n+    this.colStats = colStats;\n+    this.selectedColumns = selectedColumns;\n+    this.options = options;\n+    this.fromSnapshotId = fromSnapshotId;\n+    this.toSnapshotId = toSnapshotId;\n+  }\n+\n+  Long snapshotId() {\n+    return snapshotId;\n+  }\n+\n+  TableScanContext snapshotId(Long id) {\n+    return new TableScanContext(id, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Expression rowFilter() {\n+    return rowFilter;\n+  }\n+\n+  TableScanContext rowFilter(Expression filter) {\n+    return new TableScanContext(snapshotId, filter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean ignoreResiduals() {\n+    return ignoreResiduals;\n+  }\n+\n+  TableScanContext ignoreResiduals(boolean shouldIgnoreResiduals) {\n+    return new TableScanContext(snapshotId, rowFilter, shouldIgnoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean caseSensitive() {\n+    return caseSensitive;\n+  }\n+\n+  TableScanContext caseSensitive(boolean isCaseSensitive) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        isCaseSensitive, colStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  boolean colStats() {\n+    return colStats;\n+  }\n+\n+  TableScanContext colStats(boolean shouldUseColumnStats) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        caseSensitive, shouldUseColumnStats, selectedColumns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Collection<String> selectedColumns() {\n+    return selectedColumns;\n+  }\n+\n+  TableScanContext selectedColumns(Collection<String> columns) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, columns, options, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  ImmutableMap<String, String> options() {\n+    return options;\n+  }\n+\n+  TableScanContext options(Map<String, String> extraOptions) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, ImmutableMap.copyOf(extraOptions),\n+        fromSnapshotId, toSnapshotId);\n+  }\n+\n+  Long fromSnapshotId() {\n+    return fromSnapshotId;\n+  }\n+\n+  TableScanContext fromSnapshotId(Long id) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, id, toSnapshotId);\n+  }\n+\n+  Long toSnapshotId() {\n+    return toSnapshotId;\n+  }\n+\n+  TableScanContext toSnapshotId(Long id) {\n+    return new TableScanContext(snapshotId, rowFilter, ignoreResiduals,\n+        caseSensitive, colStats, selectedColumns, options, fromSnapshotId, id);\n+  }\n+\n+  TableScanContext copy() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4705304263f439f774c88273e7a9dbd114a462b"}, "originalPosition": 142}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODU4OTE5", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431858919", "createdAt": "2020-06-16T20:17:39Z", "commit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoxNzozOVrOGkrnHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoxNzozOVrOGkrnHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExNjQ0Nw==", "bodyText": "Using the prefix is normal signals a boolean getter, not a setter. What about setCaseSensitive or just caseSensitive?", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441116447", "createdAt": "2020-06-16T20:17:39Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -153,47 +153,43 @@ public TableScan asOfTime(long timestampMillis) {\n \n   @Override\n   public TableScan option(String property, String value) {\n-    ImmutableMap.Builder<String, String> builder = ImmutableMap.builder();\n-    builder.putAll(context.options());\n-    builder.put(property, value);\n-\n     return newRefinedScan(\n-        ops, table, schema, context.options(builder.build()));\n+        ops, table, schema, context.withOption(property, value));\n   }\n \n   @Override\n   public TableScan project(Schema projectedSchema) {\n     return newRefinedScan(\n-        ops, table, projectedSchema, context.copy());\n+        ops, table, projectedSchema, context);\n   }\n \n   @Override\n   public TableScan caseSensitive(boolean scanCaseSensitive) {\n     return newRefinedScan(\n-        ops, table, schema, context.caseSensitive(scanCaseSensitive));\n+        ops, table, schema, context.isCaseSensitive(scanCaseSensitive));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODU5NTkw", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431859590", "createdAt": "2020-06-16T20:18:39Z", "commit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoxODozOVrOGkrpFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoxODozOVrOGkrpFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExNjk1MA==", "bodyText": "The rowFilter getter doesn't need to change. It is still getting the row filter. Just the setter should be a verb.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441116950", "createdAt": "2020-06-16T20:18:39Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/BaseTableScan.java", "diffHunk": "@@ -273,7 +269,7 @@ public String toString() {\n     return MoreObjects.toStringHelper(this)\n         .add(\"table\", table)\n         .add(\"projection\", schema().asStruct())\n-        .add(\"filter\", context.rowFilter())\n+        .add(\"filter\", context.filterRows())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "originalPosition": 141}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODYyMTcy", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431862172", "createdAt": "2020-06-16T20:22:33Z", "commit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoyMjozM1rOGkrxJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoyMjozM1rOGkrxJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExOTAxMw==", "bodyText": "Doesn't the snapshot ID start off as null? It seems like we don't need to set it here.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441119013", "createdAt": "2020-06-16T20:22:33Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/IncrementalDataTableScan.java", "diffHunk": "@@ -19,55 +19,43 @@\n \n package org.apache.iceberg;\n \n-import java.util.Collection;\n import java.util.List;\n import java.util.Set;\n-import org.apache.iceberg.expressions.Expression;\n import org.apache.iceberg.io.CloseableIterable;\n import org.apache.iceberg.relocated.com.google.common.base.Preconditions;\n import org.apache.iceberg.relocated.com.google.common.collect.FluentIterable;\n-import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n import org.apache.iceberg.relocated.com.google.common.collect.Iterables;\n import org.apache.iceberg.relocated.com.google.common.collect.Lists;\n import org.apache.iceberg.relocated.com.google.common.collect.Sets;\n import org.apache.iceberg.util.SnapshotUtil;\n import org.apache.iceberg.util.ThreadPools;\n \n class IncrementalDataTableScan extends DataTableScan {\n-  private long fromSnapshotId;\n-  private long toSnapshotId;\n-\n-  IncrementalDataTableScan(TableOperations ops, Table table, Schema schema, Expression rowFilter,\n-                           boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n-                           Collection<String> selectedColumns, ImmutableMap<String, String> options,\n-                           long fromSnapshotId, long toSnapshotId) {\n-    super(ops, table, null, schema, rowFilter, ignoreResiduals, caseSensitive, colStats, selectedColumns, options);\n-    validateSnapshotIds(table, fromSnapshotId, toSnapshotId);\n-    this.fromSnapshotId = fromSnapshotId;\n-    this.toSnapshotId = toSnapshotId;\n+\n+  IncrementalDataTableScan(TableOperations ops, Table table, Schema schema, TableScanContext context) {\n+    super(ops, table, schema, context.useSnapshotId(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODYyNjI0", "url": "https://github.com/apache/iceberg/pull/1115#pullrequestreview-431862624", "createdAt": "2020-06-16T20:23:14Z", "commit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoyMzoxNFrOGkryeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoyMzoxNFrOGkryeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExOTM1Mw==", "bodyText": "Shouldn't validations be done in the context? I don't see why the context would allow a change that is invalid and needs to be enforced in different scans.", "url": "https://github.com/apache/iceberg/pull/1115#discussion_r441119353", "createdAt": "2020-06-16T20:23:14Z", "author": {"login": "rdblue"}, "path": "core/src/main/java/org/apache/iceberg/IncrementalDataTableScan.java", "diffHunk": "@@ -19,55 +19,43 @@\n \n package org.apache.iceberg;\n \n-import java.util.Collection;\n import java.util.List;\n import java.util.Set;\n-import org.apache.iceberg.expressions.Expression;\n import org.apache.iceberg.io.CloseableIterable;\n import org.apache.iceberg.relocated.com.google.common.base.Preconditions;\n import org.apache.iceberg.relocated.com.google.common.collect.FluentIterable;\n-import org.apache.iceberg.relocated.com.google.common.collect.ImmutableMap;\n import org.apache.iceberg.relocated.com.google.common.collect.Iterables;\n import org.apache.iceberg.relocated.com.google.common.collect.Lists;\n import org.apache.iceberg.relocated.com.google.common.collect.Sets;\n import org.apache.iceberg.util.SnapshotUtil;\n import org.apache.iceberg.util.ThreadPools;\n \n class IncrementalDataTableScan extends DataTableScan {\n-  private long fromSnapshotId;\n-  private long toSnapshotId;\n-\n-  IncrementalDataTableScan(TableOperations ops, Table table, Schema schema, Expression rowFilter,\n-                           boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n-                           Collection<String> selectedColumns, ImmutableMap<String, String> options,\n-                           long fromSnapshotId, long toSnapshotId) {\n-    super(ops, table, null, schema, rowFilter, ignoreResiduals, caseSensitive, colStats, selectedColumns, options);\n-    validateSnapshotIds(table, fromSnapshotId, toSnapshotId);\n-    this.fromSnapshotId = fromSnapshotId;\n-    this.toSnapshotId = toSnapshotId;\n+\n+  IncrementalDataTableScan(TableOperations ops, Table table, Schema schema, TableScanContext context) {\n+    super(ops, table, schema, context.useSnapshotId(null));\n+    validateSnapshotIds(table, context.fromSnapshotId(), context.toSnapshotId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67b3a30c69b593d4d1f8722c48a8b5c7c00cdf16", "author": {"user": {"login": "edgarRd", "name": "Edgar Rodriguez"}}, "url": "https://github.com/apache/iceberg/commit/67b3a30c69b593d4d1f8722c48a8b5c7c00cdf16", "committedDate": "2020-06-16T21:54:21Z", "message": "PR review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef702ab87fc9cc8c4778f1499bd4a1a032db6d66", "author": {"user": {"login": "edgarRd", "name": "Edgar Rodriguez"}}, "url": "https://github.com/apache/iceberg/commit/ef702ab87fc9cc8c4778f1499bd4a1a032db6d66", "committedDate": "2020-06-16T20:00:53Z", "message": "PR review"}, "afterCommit": {"oid": "67b3a30c69b593d4d1f8722c48a8b5c7c00cdf16", "author": {"user": {"login": "edgarRd", "name": "Edgar Rodriguez"}}, "url": "https://github.com/apache/iceberg/commit/67b3a30c69b593d4d1f8722c48a8b5c7c00cdf16", "committedDate": "2020-06-16T21:54:21Z", "message": "PR review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4526, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}