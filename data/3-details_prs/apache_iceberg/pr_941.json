{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MzMwOTEz", "number": 941, "title": "Refactor metadata inheritance for manifest rewrites", "bodyText": "This refactors manifest rewrites done by RewriteManifests, FastAppend, and MergeAppend. Previously, the rewrite method was passed a ManifestReader, but now the rewrite method handles reader creation so that it can setup inherited metadata. For a rewritten manifest, the snapshot ID should always be present and not inherited because the records were already read and rewritten by the rewrite process. For an appended manifest, this adds CopyMetadata that sets the snapshot ID.\nAfter this refactor, all metadata inheritance is setup in ManifestFiles.", "createdAt": "2020-04-20T22:15:03Z", "url": "https://github.com/apache/iceberg/pull/941", "merged": true, "mergeCommit": {"oid": "30711e2a744aa4e154c4e4c55a51fca621126363"}, "closed": true, "closedAt": "2020-04-22T16:40:35Z", "author": {"login": "rdblue"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZmbmuAH2gAyNDA2MzMwOTEzOmZjNjU4ZDA2MzJiMDg0ZjYwZDgxYzQ4ZGNlZjI0OGY3ODU0MTRiZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaLBT3AFqTM5ODM3Mzk0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc658d0632b084f60d81c48dcef248f785414bf3", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/fc658d0632b084f60d81c48dcef248f785414bf3", "committedDate": "2020-04-20T22:00:44Z", "message": "Refactor manifest rewrite inherited metadata."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13e4511f5a6caccc5ab0df7705c12e78d17e0ce9", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/13e4511f5a6caccc5ab0df7705c12e78d17e0ce9", "committedDate": "2020-04-21T17:45:57Z", "message": "Fix checkstyle error."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e9f2f53d9768124bb07abdfd8c71e141ec04daa", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/2e9f2f53d9768124bb07abdfd8c71e141ec04daa", "committedDate": "2020-04-21T19:34:08Z", "message": "Use equals to check Long equality."}, "afterCommit": {"oid": "34c207ec5f3d0270235ced43880b0d2ddc51b9ee", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/34c207ec5f3d0270235ced43880b0d2ddc51b9ee", "committedDate": "2020-04-21T19:09:39Z", "message": "Fix forward compatibility test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89a107753b5a737582e47120d1fafa8600c9d6f4", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/89a107753b5a737582e47120d1fafa8600c9d6f4", "committedDate": "2020-04-21T21:35:40Z", "message": "Fix forward compatibility test."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34c207ec5f3d0270235ced43880b0d2ddc51b9ee", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/34c207ec5f3d0270235ced43880b0d2ddc51b9ee", "committedDate": "2020-04-21T19:09:39Z", "message": "Fix forward compatibility test."}, "afterCommit": {"oid": "89a107753b5a737582e47120d1fafa8600c9d6f4", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/89a107753b5a737582e47120d1fafa8600c9d6f4", "committedDate": "2020-04-21T21:35:40Z", "message": "Fix forward compatibility test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NzE1MDc4", "url": "https://github.com/apache/iceberg/pull/941#pullrequestreview-397715078", "createdAt": "2020-04-21T22:16:32Z", "commit": {"oid": "89a107753b5a737582e47120d1fafa8600c9d6f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjoxNjozMlrOGJaykg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjoxNjozMlrOGJaykg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyOTI5OA==", "bodyText": "This test needed to change because the update started catching that the manifest didn't have a snapshot ID for entries to inherit. The solution is to append the manifest like normal instead of using the commit API directly. To be able to commit the manifest without rewriting it (which fails on the fake partition data), this sets snapshot ID inheritance to true.", "url": "https://github.com/apache/iceberg/pull/941#discussion_r412529298", "createdAt": "2020-04-21T22:16:32Z", "author": {"login": "rdblue"}, "path": "spark/src/test/java/org/apache/iceberg/spark/source/TestForwardCompatibility.java", "diffHunk": "@@ -192,8 +197,7 @@ public void testSparkCanReadUnknownTransform() throws IOException {\n       manifestWriter.close();\n     }\n \n-    TableOperations ops = ((HasTableOperations) table).operations();\n-    ops.commit(ops.current(), ops.current().replaceCurrentSnapshot(new FakeSnapshot(manifestWriter.toManifestFile())));\n+    table.newFastAppend().appendManifest(manifestWriter.toManifestFile()).commit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89a107753b5a737582e47120d1fafa8600c9d6f4"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a517ee1784bf65790b5e18231c559ef312bda38", "author": {"user": {"login": "rdblue", "name": "Ryan Blue"}}, "url": "https://github.com/apache/iceberg/commit/7a517ee1784bf65790b5e18231c559ef312bda38", "committedDate": "2020-04-21T23:00:16Z", "message": "Remove unused imports."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzczOTQ2", "url": "https://github.com/apache/iceberg/pull/941#pullrequestreview-398373946", "createdAt": "2020-04-22T16:38:30Z", "commit": {"oid": "7a517ee1784bf65790b5e18231c559ef312bda38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4836, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}