{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMDU1NDU1", "number": 1579, "title": "Remove time-zone dependent call when casting a date via toLocalDate in HiveIcebergFilterFactory", "bodyText": "For me, the test TestHiveIcebergFilterFactory#testDateType is failing locally, though it doesnt fail in the CI. So whether or not this needs to be changed is debatable, but this test fails for me when I run it locally.\nI've changed the test to use Date.valueOf(\"2015-11-12\"), which matches the Literal.of(\"2015-11-12\") more closely anyway.\nI've also made the string literal for the date its own named argument, under the hopes that possibly these tests could be parameterized some day.\nWhen  I test this on my local, the output of the failing test is\nexpected:<16751> but was:<16750>\nExpected :16751\nActual   :16750\n...\norg.apache.iceberg.mr.hive.TestHiveIcebergFilterFactory > testDateType FAILED\n    java.lang.AssertionError: expected:<16751> but was:<16750>", "createdAt": "2020-10-11T00:11:17Z", "url": "https://github.com/apache/iceberg/pull/1579", "merged": true, "mergeCommit": {"oid": "7355727cb4484daf0278c7b503c75a4f20f22ffb"}, "closed": true, "closedAt": "2020-10-13T16:16:44Z", "author": {"login": "kbendick"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRT1hKAH2gAyNTAxMDU1NDU1OjNjMTA5OTA0MDJjN2JhNGZlOGI0M2Q2YjgxMWFlNzRkYTNkYjU1MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR_xKeABqjM4NjkwNjc0NDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c10990402c7ba4fe8b43d6b811ae74da3db5520", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/3c10990402c7ba4fe8b43d6b811ae74da3db5520", "committedDate": "2020-10-11T00:00:36Z", "message": "Fix off by one error in TestHiveIcebergFilterFactory#testDateType so the gmtDate is 2015-11-12 instead of 2015-11-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f29cd0895e57670dc696cb389e5f2044231e4a", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/50f29cd0895e57670dc696cb389e5f2044231e4a", "committedDate": "2020-10-11T00:03:43Z", "message": "Use Date.valueOf instead of the confusing 2015-11-13 with start of day changes etc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02ea287e288ea8c0752e04e0154b48e9a953ef07", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/02ea287e288ea8c0752e04e0154b48e9a953ef07", "committedDate": "2020-10-11T00:12:18Z", "message": "Use the dateString as a named parameter, so that hopefully these tests could be parameterized one day"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52150964c696af20db98953d791e064601d017d5", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/52150964c696af20db98953d791e064601d017d5", "committedDate": "2020-10-11T00:34:13Z", "message": "Fix unused import error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a42de42d500ab342d8c727ab8d22c0f471f3198", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/0a42de42d500ab342d8c727ab8d22c0f471f3198", "committedDate": "2020-10-11T06:24:26Z", "message": "remove the named date string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzQ3OTk0", "url": "https://github.com/apache/iceberg/pull/1579#pullrequestreview-506747994", "createdAt": "2020-10-12T16:06:17Z", "commit": {"oid": "0a42de42d500ab342d8c727ab8d22c0f471f3198"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjowNjoxN1rOHgExzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjowNjoxN1rOHgExzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NDc2NQ==", "bodyText": "We need to avoid using classes that will change behavior based on time zone to parse the value of a date or timestamp. This method was purposely not used. The problem here is probably that although the instant value is correct, the Date uses the JVM time zone somehow.", "url": "https://github.com/apache/iceberg/pull/1579#discussion_r503394765", "createdAt": "2020-10-12T16:06:17Z", "author": {"login": "rdblue"}, "path": "mr/src/test/java/org/apache/iceberg/mr/hive/TestHiveIcebergFilterFactory.java", "diffHunk": "@@ -207,8 +206,8 @@ public void testBooleanType() {\n   @Test\n   public void testDateType() {\n     SearchArgument.Builder builder = SearchArgumentFactory.newBuilder();\n-    Date gmtDate = new Date(LocalDate.of(2015, 11, 12).atStartOfDay(ZoneOffset.UTC).toInstant().toEpochMilli());\n-    SearchArgument arg = builder.startAnd().equals(\"date\", PredicateLeaf.Type.DATE, gmtDate).end().build();\n+    Date date = Date.valueOf(\"2015-11-12\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a42de42d500ab342d8c727ab8d22c0f471f3198"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91637ff4df26fda85423758ac1ee9096924979a8", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/91637ff4df26fda85423758ac1ee9096924979a8", "committedDate": "2020-10-12T20:04:57Z", "message": "Update daysFromDate function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62c083b838e8a31a3081755ecd29f86c5063e002", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/62c083b838e8a31a3081755ecd29f86c5063e002", "committedDate": "2020-10-12T20:16:40Z", "message": "Revert changes to unit tests as we've updated the HiveIcebergFilterFactory code instead"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4549f0812e67c4a09d97173ac14b4df57e470297", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/4549f0812e67c4a09d97173ac14b4df57e470297", "committedDate": "2020-10-13T02:39:07Z", "message": "Try bumping the ulimit to see if that solves HMS connection issue"}, "afterCommit": {"oid": "62c083b838e8a31a3081755ecd29f86c5063e002", "author": {"user": {"login": "kbendick", "name": "Kyle Bendickson"}}, "url": "https://github.com/apache/iceberg/commit/62c083b838e8a31a3081755ecd29f86c5063e002", "committedDate": "2020-10-12T20:16:40Z", "message": "Revert changes to unit tests as we've updated the HiveIcebergFilterFactory code instead"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3931, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}