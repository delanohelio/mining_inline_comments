{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MDk3OTky", "number": 1128, "title": "Fix parquet name mapping unit test", "bodyText": "This is a follow-up for #830 (comment).", "createdAt": "2020-06-19T13:20:00Z", "url": "https://github.com/apache/iceberg/pull/1128", "merged": true, "mergeCommit": {"oid": "8e9bfdd87dab76da70e137a671c8c085f3d6c744"}, "closed": true, "closedAt": "2020-06-23T16:34:40Z", "author": {"login": "chenjunjiedada"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsy6mygH2gAyNDM3MDk3OTkyOjA4Y2JiOGU0MDI1MGE5OTNkNjRlZDZjYjM4NTRjNmNmM2NhM2M3Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABct6aSigH2gAyNDM3MDk3OTkyOjIwOGE5ZDJlODgyMGViNWE1ZGU4MDBjMDBkYjA3OWJkNmNlNGMyNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "08cbb8e40250a993d64ed6cb3854c6cf3ca3c7ca", "author": {"user": {"login": "chenjunjiedada", "name": "Chen, Junjie"}}, "url": "https://github.com/apache/iceberg/commit/08cbb8e40250a993d64ed6cb3854c6cf3ca3c7ca", "committedDate": "2020-06-19T13:18:01Z", "message": "Fix parquet name mapping unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Mzc4Nzk3", "url": "https://github.com/apache/iceberg/pull/1128#pullrequestreview-434378797", "createdAt": "2020-06-19T23:25:35Z", "commit": {"oid": "08cbb8e40250a993d64ed6cb3854c6cf3ca3c7ca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzoyNTozNVrOGmjO7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzoyNTozNVrOGmjO7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjMzMg==", "bodyText": "Why not use a Parquet schema visitor?", "url": "https://github.com/apache/iceberg/pull/1128#discussion_r443076332", "createdAt": "2020-06-19T23:25:35Z", "author": {"login": "rdblue"}, "path": "parquet/src/main/java/org/apache/iceberg/parquet/RemoveIds.java", "diffHunk": "@@ -0,0 +1,180 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.parquet;\n+\n+import org.apache.iceberg.avro.AvroSchemaUtil;\n+import org.apache.iceberg.types.Type.PrimitiveType;\n+import org.apache.iceberg.types.TypeUtil;\n+import org.apache.iceberg.types.Types.ListType;\n+import org.apache.iceberg.types.Types.MapType;\n+import org.apache.iceberg.types.Types.NestedField;\n+import org.apache.iceberg.types.Types.StructType;\n+import org.apache.iceberg.types.Types.TimestampType;\n+import org.apache.parquet.schema.GroupType;\n+import org.apache.parquet.schema.LogicalTypeAnnotation;\n+import org.apache.parquet.schema.MessageType;\n+import org.apache.parquet.schema.Type;\n+import org.apache.parquet.schema.Types;\n+\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.BINARY;\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.BOOLEAN;\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.DOUBLE;\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.FIXED_LEN_BYTE_ARRAY;\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.FLOAT;\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.INT32;\n+import static org.apache.parquet.schema.PrimitiveType.PrimitiveTypeName.INT64;\n+\n+public class RemoveIds {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08cbb8e40250a993d64ed6cb3854c6cf3ca3c7ca"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb8154ba66e902262d60f48d0612fa95b57f929f", "author": {"user": {"login": "chenjunjiedada", "name": "Chen, Junjie"}}, "url": "https://github.com/apache/iceberg/commit/eb8154ba66e902262d60f48d0612fa95b57f929f", "committedDate": "2020-06-20T03:20:06Z", "message": "use parquet type visitor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MDk5ODE4", "url": "https://github.com/apache/iceberg/pull/1128#pullrequestreview-435099818", "createdAt": "2020-06-22T16:42:35Z", "commit": {"oid": "eb8154ba66e902262d60f48d0612fa95b57f929f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjo0MjozNVrOGnIx-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjo0MjozNVrOGnIx-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY5MTUxMg==", "bodyText": "Why is name needed? The MessageType has a name that can be used instead of passing it in separately.", "url": "https://github.com/apache/iceberg/pull/1128#discussion_r443691512", "createdAt": "2020-06-22T16:42:35Z", "author": {"login": "rdblue"}, "path": "parquet/src/main/java/org/apache/iceberg/parquet/RemoveIds.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.parquet;\n+\n+import java.util.List;\n+import org.apache.parquet.schema.GroupType;\n+import org.apache.parquet.schema.MessageType;\n+import org.apache.parquet.schema.PrimitiveType;\n+import org.apache.parquet.schema.Type;\n+import org.apache.parquet.schema.Types;\n+\n+public class RemoveIds extends ParquetTypeVisitor<Type> {\n+  private final String name;\n+\n+  public RemoveIds(String name) {\n+    this.name = name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb8154ba66e902262d60f48d0612fa95b57f929f"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MTAwNjAz", "url": "https://github.com/apache/iceberg/pull/1128#pullrequestreview-435100603", "createdAt": "2020-06-22T16:43:36Z", "commit": {"oid": "eb8154ba66e902262d60f48d0612fa95b57f929f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjo0MzozNlrOGnI0Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjo0MzozNlrOGnI0Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY5MjExMA==", "bodyText": "It would be better to pass in MessageType instead of Schema. That way removing IDs and converting to Parquet are not mixed together.", "url": "https://github.com/apache/iceberg/pull/1128#discussion_r443692110", "createdAt": "2020-06-22T16:43:36Z", "author": {"login": "rdblue"}, "path": "parquet/src/main/java/org/apache/iceberg/parquet/RemoveIds.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.parquet;\n+\n+import java.util.List;\n+import org.apache.parquet.schema.GroupType;\n+import org.apache.parquet.schema.MessageType;\n+import org.apache.parquet.schema.PrimitiveType;\n+import org.apache.parquet.schema.Type;\n+import org.apache.parquet.schema.Types;\n+\n+public class RemoveIds extends ParquetTypeVisitor<Type> {\n+  private final String name;\n+\n+  public RemoveIds(String name) {\n+    this.name = name;\n+  }\n+\n+  @Override\n+  public Type message(MessageType message, List<Type> fields) {\n+    Types.MessageTypeBuilder builder = Types.buildMessage();\n+    for (Type field : struct(message.asGroupType(), fields).asGroupType().getFields()) {\n+      builder.addField(field);\n+    }\n+    return builder.named(name);\n+  }\n+\n+  @Override\n+  public Type struct(GroupType struct, List<Type> fields) {\n+    Types.GroupBuilder<GroupType> builder = Types.buildGroup(struct.getRepetition());\n+    for (Type field : fields) {\n+      builder.addField(field);\n+    }\n+    return builder.named(struct.getName());\n+  }\n+\n+  @Override\n+  public Type list(GroupType array, Type item) {\n+    return Types.list(array.getRepetition())\n+        .element(item)\n+        .named(array.getName());\n+  }\n+\n+  @Override\n+  public Type map(GroupType map, Type key, Type value) {\n+    return Types.map(map.getRepetition())\n+        .key(key)\n+        .value(value)\n+        .named(map.getName());\n+  }\n+\n+  @Override\n+  public Type primitive(PrimitiveType primitive) {\n+    return Types.primitive(primitive.getPrimitiveTypeName(), primitive.getRepetition())\n+        .length(primitive.getTypeLength())\n+        .as(primitive.getLogicalTypeAnnotation())\n+        .named(primitive.getName());\n+  }\n+\n+  public static MessageType removeIds(org.apache.iceberg.Schema schema, String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb8154ba66e902262d60f48d0612fa95b57f929f"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24d0f3bb99c88811a101b33fd6244cc9a9d569c3", "author": {"user": {"login": "chenjunjiedada", "name": "Chen, Junjie"}}, "url": "https://github.com/apache/iceberg/commit/24d0f3bb99c88811a101b33fd6244cc9a9d569c3", "committedDate": "2020-06-22T23:41:20Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzQ2MzA0", "url": "https://github.com/apache/iceberg/pull/1128#pullrequestreview-435346304", "createdAt": "2020-06-22T23:44:38Z", "commit": {"oid": "24d0f3bb99c88811a101b33fd6244cc9a9d569c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0NDozOFrOGnUexA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0NDozOFrOGnUexA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4MzIwNA==", "bodyText": "The name isn't used.", "url": "https://github.com/apache/iceberg/pull/1128#discussion_r443883204", "createdAt": "2020-06-22T23:44:38Z", "author": {"login": "rdblue"}, "path": "parquet/src/main/java/org/apache/iceberg/parquet/RemoveIds.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iceberg.parquet;\n+\n+import java.util.List;\n+import org.apache.parquet.schema.GroupType;\n+import org.apache.parquet.schema.MessageType;\n+import org.apache.parquet.schema.PrimitiveType;\n+import org.apache.parquet.schema.Type;\n+import org.apache.parquet.schema.Types;\n+\n+public class RemoveIds extends ParquetTypeVisitor<Type> {\n+\n+  @Override\n+  public Type message(MessageType message, List<Type> fields) {\n+    Types.MessageTypeBuilder builder = Types.buildMessage();\n+    for (Type field : struct(message.asGroupType(), fields).asGroupType().getFields()) {\n+      builder.addField(field);\n+    }\n+    return builder.named(message.getName());\n+  }\n+\n+  @Override\n+  public Type struct(GroupType struct, List<Type> fields) {\n+    Types.GroupBuilder<GroupType> builder = Types.buildGroup(struct.getRepetition());\n+    for (Type field : fields) {\n+      builder.addField(field);\n+    }\n+    return builder.named(struct.getName());\n+  }\n+\n+  @Override\n+  public Type list(GroupType array, Type item) {\n+    return Types.list(array.getRepetition())\n+        .element(item)\n+        .named(array.getName());\n+  }\n+\n+  @Override\n+  public Type map(GroupType map, Type key, Type value) {\n+    return Types.map(map.getRepetition())\n+        .key(key)\n+        .value(value)\n+        .named(map.getName());\n+  }\n+\n+  @Override\n+  public Type primitive(PrimitiveType primitive) {\n+    return Types.primitive(primitive.getPrimitiveTypeName(), primitive.getRepetition())\n+        .length(primitive.getTypeLength())\n+        .as(primitive.getLogicalTypeAnnotation())\n+        .named(primitive.getName());\n+  }\n+\n+  public static MessageType removeIds(MessageType type, String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24d0f3bb99c88811a101b33fd6244cc9a9d569c3"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208a9d2e8820eb5a5de800c00db079bd6ce4c267", "author": {"user": {"login": "chenjunjiedada", "name": "Chen, Junjie"}}, "url": "https://github.com/apache/iceberg/commit/208a9d2e8820eb5a5de800c00db079bd6ce4c267", "committedDate": "2020-06-23T00:35:53Z", "message": "address comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4547, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}