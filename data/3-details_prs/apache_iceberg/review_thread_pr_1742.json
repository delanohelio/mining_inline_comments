{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3OTE3ODQz", "number": 1742, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMzo1ODoxNFrOE3AF7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMDowMzowN1rOE3AKWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MTA4NjU0OnYy", "diffSide": "LEFT", "path": "api/src/test/java/org/apache/iceberg/expressions/TestMiscLiteralConversions.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMzo1ODoxNFrOHwGVwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMDozNzoyNlrOHw1FOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NzU2OQ==", "bodyText": "Why was this removed?", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520197569", "createdAt": "2020-11-09T23:58:14Z", "author": {"login": "rdblue"}, "path": "api/src/test/java/org/apache/iceberg/expressions/TestMiscLiteralConversions.java", "diffHunk": "@@ -231,7 +231,6 @@ public void testInvalidDecimalConversions() {\n         Types.TimeType.get(),\n         Types.TimestampType.withZone(),\n         Types.TimestampType.withoutZone(),\n-        Types.DecimalType.of(9, 4),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ0OTI3Mw==", "bodyText": "Because it's no longer an invalid conversion to call DecimalLiteral.to() on a decimal which has a scale of 2 to convert to another decimal which has a scale of 4 (i.e. it will no longer give back a null)", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520449273", "createdAt": "2020-11-10T10:21:20Z", "author": {"login": "marton-bod"}, "path": "api/src/test/java/org/apache/iceberg/expressions/TestMiscLiteralConversions.java", "diffHunk": "@@ -231,7 +231,6 @@ public void testInvalidDecimalConversions() {\n         Types.TimeType.get(),\n         Types.TimestampType.withZone(),\n         Types.TimestampType.withoutZone(),\n-        Types.DecimalType.of(9, 4),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NzU2OQ=="}, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk2MzM4NQ==", "bodyText": "Right, it is no longer invalid.", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520963385", "createdAt": "2020-11-11T00:37:26Z", "author": {"login": "rdblue"}, "path": "api/src/test/java/org/apache/iceberg/expressions/TestMiscLiteralConversions.java", "diffHunk": "@@ -231,7 +231,6 @@ public void testInvalidDecimalConversions() {\n         Types.TimeType.get(),\n         Types.TimestampType.withZone(),\n         Types.TimestampType.withoutZone(),\n-        Types.DecimalType.of(9, 4),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NzU2OQ=="}, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MTA4NzMxOnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/apache/iceberg/expressions/TestNumericLiteralConversions.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMzo1ODozOFrOHwGWNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDoxODo0NVrOHwVmUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NzY4NQ==", "bodyText": "Nit: indentation is off. It should be 2 indents (4 spaces) for continuation indents.", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520197685", "createdAt": "2020-11-09T23:58:38Z", "author": {"login": "rdblue"}, "path": "api/src/test/java/org/apache/iceberg/expressions/TestNumericLiteralConversions.java", "diffHunk": "@@ -153,17 +154,12 @@ public void testDoubleToDecimalConversion() {\n   public void testDecimalToDecimalConversion() {\n     Literal<BigDecimal> lit = Literal.of(new BigDecimal(\"34.11\"));\n \n-    Assert.assertSame(\"Should return identical object when converting to same scale\",\n-        lit, lit.to(Types.DecimalType.of(9, 2)));\n-    Assert.assertSame(\"Should return identical object when converting to same scale\",\n-        lit, lit.to(Types.DecimalType.of(11, 2)));\n-\n-    Assert.assertNull(\"Changing decimal scale is not allowed\",\n-        lit.to(Types.DecimalType.of(9, 0)));\n-    Assert.assertNull(\"Changing decimal scale is not allowed\",\n-        lit.to(Types.DecimalType.of(9, 1)));\n-    Assert.assertNull(\"Changing decimal scale is not allowed\",\n-        lit.to(Types.DecimalType.of(9, 3)));\n+    IntStream.range(0, 10).forEach(scale -> {\n+      Assert.assertSame(\"Should return identical object\",\n+              lit, lit.to(Types.DecimalType.of(9, scale)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ0NzU3MA==", "bodyText": "fixed", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520447570", "createdAt": "2020-11-10T10:18:45Z", "author": {"login": "marton-bod"}, "path": "api/src/test/java/org/apache/iceberg/expressions/TestNumericLiteralConversions.java", "diffHunk": "@@ -153,17 +154,12 @@ public void testDoubleToDecimalConversion() {\n   public void testDecimalToDecimalConversion() {\n     Literal<BigDecimal> lit = Literal.of(new BigDecimal(\"34.11\"));\n \n-    Assert.assertSame(\"Should return identical object when converting to same scale\",\n-        lit, lit.to(Types.DecimalType.of(9, 2)));\n-    Assert.assertSame(\"Should return identical object when converting to same scale\",\n-        lit, lit.to(Types.DecimalType.of(11, 2)));\n-\n-    Assert.assertNull(\"Changing decimal scale is not allowed\",\n-        lit.to(Types.DecimalType.of(9, 0)));\n-    Assert.assertNull(\"Changing decimal scale is not allowed\",\n-        lit.to(Types.DecimalType.of(9, 1)));\n-    Assert.assertNull(\"Changing decimal scale is not allowed\",\n-        lit.to(Types.DecimalType.of(9, 3)));\n+    IntStream.range(0, 10).forEach(scale -> {\n+      Assert.assertSame(\"Should return identical object\",\n+              lit, lit.to(Types.DecimalType.of(9, scale)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NzY4NQ=="}, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MTA5Nzg0OnYy", "diffSide": "RIGHT", "path": "mr/src/test/java/org/apache/iceberg/mr/hive/HiveIcebergStorageHandlerBaseTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMDowMzowN1rOHwGcUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDoxOTowM1rOHwVnFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5OTI1MQ==", "bodyText": "I think test values should be created using strings so we know that we know the exact BigDecimal values. Converting from float seems unreliable. The one that uses an integer and a specific scale seems fine.", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520199251", "createdAt": "2020-11-10T00:03:07Z", "author": {"login": "rdblue"}, "path": "mr/src/test/java/org/apache/iceberg/mr/hive/HiveIcebergStorageHandlerBaseTest.java", "diffHunk": "@@ -176,6 +177,40 @@ public void testScanEmptyTable() throws IOException {\n     Assert.assertEquals(0, rows.size());\n   }\n \n+  @Test\n+  public void testDecimalTableWithPredicateLiterals() throws IOException {\n+    shell.setHiveSessionValue(\"hive.vectorized.execution.enabled\", \"false\");\n+    Schema schema = new Schema(required(1, \"decimal_field\", Types.DecimalType.of(7, 2)));\n+    List<Record> records = TestHelper.RecordsBuilder.newInstance(schema)\n+            .add(BigDecimal.valueOf(8500, 2)) // 85.00\n+            .add(BigDecimal.valueOf(100.56))\n+            .add(BigDecimal.valueOf(100.57))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ0Nzc2NQ==", "bodyText": "makes sense, using strings now", "url": "https://github.com/apache/iceberg/pull/1742#discussion_r520447765", "createdAt": "2020-11-10T10:19:03Z", "author": {"login": "marton-bod"}, "path": "mr/src/test/java/org/apache/iceberg/mr/hive/HiveIcebergStorageHandlerBaseTest.java", "diffHunk": "@@ -176,6 +177,40 @@ public void testScanEmptyTable() throws IOException {\n     Assert.assertEquals(0, rows.size());\n   }\n \n+  @Test\n+  public void testDecimalTableWithPredicateLiterals() throws IOException {\n+    shell.setHiveSessionValue(\"hive.vectorized.execution.enabled\", \"false\");\n+    Schema schema = new Schema(required(1, \"decimal_field\", Types.DecimalType.of(7, 2)));\n+    List<Record> records = TestHelper.RecordsBuilder.newInstance(schema)\n+            .add(BigDecimal.valueOf(8500, 2)) // 85.00\n+            .add(BigDecimal.valueOf(100.56))\n+            .add(BigDecimal.valueOf(100.57))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5OTI1MQ=="}, "originalCommit": {"oid": "fcf2fccafafd27696a8de6dc252d7ed19acfd467"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3416, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}