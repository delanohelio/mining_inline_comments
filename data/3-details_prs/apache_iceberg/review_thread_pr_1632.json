{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MDUxOTE2", "number": 1632, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNjozNDo1MFrOEvZxWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNjozNzo0MVrOEvZ1yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MTQwNzYwOnYy", "diffSide": "RIGHT", "path": "mr/src/main/java/org/apache/iceberg/mr/hive/serde/objectinspector/IcebergObjectInspector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNjozNDo1MFrOHkXW7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNjozNDo1MFrOHkXW7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MzQ4Ng==", "bodyText": "Nit: indentation is off now.", "url": "https://github.com/apache/iceberg/pull/1632#discussion_r507893486", "createdAt": "2020-10-19T16:34:50Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/hive/serde/objectinspector/IcebergObjectInspector.java", "diffHunk": "@@ -36,23 +37,29 @@\n \n   // get the correct inspectors depending on whether we're working with Hive2 or Hive3 dependencies\n   // we need to do this because there is a breaking API change in Date/TimestampObjectInspector between Hive2 and Hive3\n-  private static final ObjectInspector DATE_INSPECTOR = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspectorHive3\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspector\")\n-      .buildStatic()\n-      .invoke();\n-\n-  private static final ObjectInspector TIMESTAMP_INSPECTOR = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\", boolean.class)\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\", boolean.class)\n-      .buildStatic()\n-      .invoke(false);\n-\n-  private static final ObjectInspector TIMESTAMP_INSPECTOR_WITH_TZ = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\", boolean.class)\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\", boolean.class)\n-      .buildStatic()\n-      .invoke(true);\n+  private static final ObjectInspector DATE_INSPECTOR = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspector\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f63ea227d7cac81cfae1877401f6922fb690af"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MTQxODk4OnYy", "diffSide": "RIGHT", "path": "mr/src/main/java/org/apache/iceberg/mr/hive/serde/objectinspector/IcebergObjectInspector.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNjozNzo0MVrOHkXeDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNzoxNjoyNVrOHkY87w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5NTMwOQ==", "bodyText": "It seems like it would be a bit easier to read if you didn't wrap the DynMethods call and instead just swapped out the class:\nprivate static final TIMESTAMP_INSPECTOR_CLASS = MetastoreUtil.hive3PresentOnClasspath() ?\n    \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\" :\n    \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\";\nprivate static final ObjectInspector TIMESTAMP_INSPECTOR = DynMethods.builder(\"get\")\n    .impl(TIMESTAMP_INSPECTOR_CLASS, boolean.class)\n    .buildStatic()\n    .invoke(false);\nThat way you don't need all of the inline array literals.", "url": "https://github.com/apache/iceberg/pull/1632#discussion_r507895309", "createdAt": "2020-10-19T16:37:41Z", "author": {"login": "rdblue"}, "path": "mr/src/main/java/org/apache/iceberg/mr/hive/serde/objectinspector/IcebergObjectInspector.java", "diffHunk": "@@ -36,23 +37,29 @@\n \n   // get the correct inspectors depending on whether we're working with Hive2 or Hive3 dependencies\n   // we need to do this because there is a breaking API change in Date/TimestampObjectInspector between Hive2 and Hive3\n-  private static final ObjectInspector DATE_INSPECTOR = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspectorHive3\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspector\")\n-      .buildStatic()\n-      .invoke();\n-\n-  private static final ObjectInspector TIMESTAMP_INSPECTOR = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\", boolean.class)\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\", boolean.class)\n-      .buildStatic()\n-      .invoke(false);\n-\n-  private static final ObjectInspector TIMESTAMP_INSPECTOR_WITH_TZ = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\", boolean.class)\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\", boolean.class)\n-      .buildStatic()\n-      .invoke(true);\n+  private static final ObjectInspector DATE_INSPECTOR = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspector\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspectorHive3\",\n+          new Class[] {}, new Object[] {});\n+\n+  private static final ObjectInspector TIMESTAMP_INSPECTOR = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\",\n+          new Class[] { boolean.class }, new Object[] { false });\n+\n+  private static final ObjectInspector TIMESTAMP_INSPECTOR_WITH_TZ = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\",\n+          new Class[] { boolean.class }, new Object[] { true });\n+\n+  private static ObjectInspector getObjectInspectorBasedOnHiveVersion(\n+          String staticMethod, String hive2Class, String hive3Class, Class[] argTypes, Object[] args) {\n+    String classToUse = MetastoreUtil.hive3PresentOnClasspath() ? hive3Class : hive2Class;\n+    return DynMethods.builder(staticMethod)\n+            .impl(classToUse, argTypes)\n+            .buildStatic()\n+            .invoke(args);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f63ea227d7cac81cfae1877401f6922fb690af"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxOTU5OQ==", "bodyText": "yep...much simpler, thanks:)\nchanged it", "url": "https://github.com/apache/iceberg/pull/1632#discussion_r507919599", "createdAt": "2020-10-19T17:16:25Z", "author": {"login": "marton-bod"}, "path": "mr/src/main/java/org/apache/iceberg/mr/hive/serde/objectinspector/IcebergObjectInspector.java", "diffHunk": "@@ -36,23 +37,29 @@\n \n   // get the correct inspectors depending on whether we're working with Hive2 or Hive3 dependencies\n   // we need to do this because there is a breaking API change in Date/TimestampObjectInspector between Hive2 and Hive3\n-  private static final ObjectInspector DATE_INSPECTOR = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspectorHive3\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspector\")\n-      .buildStatic()\n-      .invoke();\n-\n-  private static final ObjectInspector TIMESTAMP_INSPECTOR = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\", boolean.class)\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\", boolean.class)\n-      .buildStatic()\n-      .invoke(false);\n-\n-  private static final ObjectInspector TIMESTAMP_INSPECTOR_WITH_TZ = DynMethods.builder(\"get\")\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\", boolean.class)\n-      .impl(\"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\", boolean.class)\n-      .buildStatic()\n-      .invoke(true);\n+  private static final ObjectInspector DATE_INSPECTOR = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspector\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergDateObjectInspectorHive3\",\n+          new Class[] {}, new Object[] {});\n+\n+  private static final ObjectInspector TIMESTAMP_INSPECTOR = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\",\n+          new Class[] { boolean.class }, new Object[] { false });\n+\n+  private static final ObjectInspector TIMESTAMP_INSPECTOR_WITH_TZ = getObjectInspectorBasedOnHiveVersion(\"get\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspector\",\n+          \"org.apache.iceberg.mr.hive.serde.objectinspector.IcebergTimestampObjectInspectorHive3\",\n+          new Class[] { boolean.class }, new Object[] { true });\n+\n+  private static ObjectInspector getObjectInspectorBasedOnHiveVersion(\n+          String staticMethod, String hive2Class, String hive3Class, Class[] argTypes, Object[] args) {\n+    String classToUse = MetastoreUtil.hive3PresentOnClasspath() ? hive3Class : hive2Class;\n+    return DynMethods.builder(staticMethod)\n+            .impl(classToUse, argTypes)\n+            .buildStatic()\n+            .invoke(args);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5NTMwOQ=="}, "originalCommit": {"oid": "30f63ea227d7cac81cfae1877401f6922fb690af"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3616, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}