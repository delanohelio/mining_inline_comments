{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0ODA1MDg2", "number": 1076, "title": "Ban use of unrelocated Guava classes", "bodyText": "#1068 introduced a bundled-guava module which relocated Guava classes and changed existing imports to use these relocated classes. Unfortunately, new PRs can continue to use these classes resulting in ClassNotFoundErrors at runtime when using iceberg-spark-runtime.\ne.g. java.lang.NoClassDefFoundError: org/apache/iceberg/shaded/com/google/common/base/Preconditions\nThis PR adds a checkstyle rule to ban use of unrelocated guava classes and also changes violating imports", "createdAt": "2020-05-28T23:49:37Z", "url": "https://github.com/apache/iceberg/pull/1076", "merged": true, "mergeCommit": {"oid": "295accd3f0ad04d5ad67e2a5ff394f44f9eef8ca"}, "closed": true, "closedAt": "2020-05-29T19:56:09Z", "author": {"login": "shardulm94"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcl2rCrAH2gAyNDI0ODA1MDg2OmZjZjVjNzA1Y2IwY2Y5MGY0NDAwY2VmNTkyODhiNmNhNzNjNzlhNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmH_2igFqTQyMTI0NzgzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fcf5c705cb0cf90f4400cef59288b6ca73c79a72", "author": {"user": {"login": "shardulm94", "name": "Shardul Mahadik"}}, "url": "https://github.com/apache/iceberg/commit/fcf5c705cb0cf90f4400cef59288b6ca73c79a72", "committedDate": "2020-05-28T23:43:10Z", "message": "Use relocated guava classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjAzNTU1", "url": "https://github.com/apache/iceberg/pull/1076#pullrequestreview-420603555", "createdAt": "2020-05-29T01:54:08Z", "commit": {"oid": "fcf5c705cb0cf90f4400cef59288b6ca73c79a72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwODcyNTEz", "url": "https://github.com/apache/iceberg/pull/1076#pullrequestreview-420872513", "createdAt": "2020-05-29T11:34:47Z", "commit": {"oid": "fcf5c705cb0cf90f4400cef59288b6ca73c79a72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMTozNDo0OFrOGcZJHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMTozNDo0OFrOGcZJHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyNTI0Nw==", "bodyText": "Hmmm, the intention with the original PR is that the classpath would be set up in such a way that the other subprojects would not be able to see Guava on their classpath and these imports would give compile errors. @rdblue I guess you didn't manage to get that working? Perhaps #1067 will fix this? So this rule shouldn't be necessary and compile errors would give devs a warning earlier than checkstyle errors. I don't really mind having this as an extra safety net though.", "url": "https://github.com/apache/iceberg/pull/1076#discussion_r432425247", "createdAt": "2020-05-29T11:34:48Z", "author": {"login": "massdosage"}, "path": ".baseline/checkstyle/checkstyle.xml", "diffHunk": "@@ -165,6 +165,11 @@\n             <property name=\"illegalClasses\" value=\"com.google.common.base.Optional, com.google.common.base.Supplier\"/>\n             <message key=\"import.illegal\" value=\"Use the Java8 version of Guava objects.\"/>\n         </module>\n+        <module name=\"IllegalImport\">\n+            <property name=\"id\" value=\"BanUnrelocatedGuavaClasses\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf5c705cb0cf90f4400cef59288b6ca73c79a72"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjQ3ODM0", "url": "https://github.com/apache/iceberg/pull/1076#pullrequestreview-421247834", "createdAt": "2020-05-29T19:54:17Z", "commit": {"oid": "fcf5c705cb0cf90f4400cef59288b6ca73c79a72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4464, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}