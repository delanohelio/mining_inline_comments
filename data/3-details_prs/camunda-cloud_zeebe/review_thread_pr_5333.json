{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MjYzOTM0", "number": 5333, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoxMDozM1rOEjAs9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoyNToyMFrOEjBDFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MTQ3MTI1OnYy", "diffSide": "RIGHT", "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/gateway/GatewayLivenessProbeIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoxMDozM1rOHRIj-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoxMDozM1rOHRIj-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcyODEyMg==", "bodyText": "As discussed, please either add a timeout on the request or try once more if this assertion failed, because it could be that the request just took very long the first time and ends up with a non 200 value.", "url": "https://github.com/camunda-cloud/zeebe/pull/5333#discussion_r487728122", "createdAt": "2020-09-14T08:10:33Z", "author": {"login": "korthout"}, "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/gateway/GatewayLivenessProbeIntegrationTest.java", "diffHunk": "@@ -63,17 +56,25 @@ public void shouldReportLivenessUpIfConnectedToBroker() {\n             .build();\n \n     // --- when + then ---------------------------------------\n-    given().spec(gatewayServerSpec).when().get(PATH_LIVENESS_PROBE).then().statusCode(200);\n+    // most of the liveness probes use a delayed health indicator which is scheduled at a fixed\n+    // rate of 5 seconds, so it may take up to that and a bit more in the worst case once the\n+    // gateway finds the broker\n+    Awaitility.await(\"wait until status turns UP\")\n+        .atMost(Duration.ofSeconds(10))\n+        .pollInterval(Duration.ofMillis(100))\n+        .untilAsserted(\n+            () ->\n+                given()\n+                    .spec(gatewayServerSpec)\n+                    .when()\n+                    .get(PATH_LIVENESS_PROBE)\n+                    .then()\n+                    .statusCode(200));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c72cc1cc481adc356191eebaf664d7cdd524301e"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MTUyNzg5OnYy", "diffSide": "RIGHT", "path": "dist/src/main/resources/application.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoyNToyMFrOHRJFzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODo0Nzo0NVrOHRJ7yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczNjc4Mw==", "bodyText": "Just a quick check, but do we need this?", "url": "https://github.com/camunda-cloud/zeebe/pull/5333#discussion_r487736783", "createdAt": "2020-09-14T08:25:20Z", "author": {"login": "korthout"}, "path": "dist/src/main/resources/application.properties", "diffHunk": "@@ -6,9 +6,9 @@ management.endpoints.web.exposure.include=health,prometheus,loggers\n management.endpoint.prometheus.enabled=true\n management.metrics.export.prometheus.enabled=true\n management.endpoint.health.group.startup.include=gatewayStarted\n-management.endpoint.health.group.startup.show-details=never\n+management.endpoint.health.group.startup.show-details=always", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0550a074d1074c4c3c4841281ad9a85b5a4b4a8d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc1MDYwMQ==", "bodyText": "No, that was for debugging, I'll remove it as I squash the commits before merging :)", "url": "https://github.com/camunda-cloud/zeebe/pull/5333#discussion_r487750601", "createdAt": "2020-09-14T08:47:45Z", "author": {"login": "npepinpe"}, "path": "dist/src/main/resources/application.properties", "diffHunk": "@@ -6,9 +6,9 @@ management.endpoints.web.exposure.include=health,prometheus,loggers\n management.endpoint.prometheus.enabled=true\n management.metrics.export.prometheus.enabled=true\n management.endpoint.health.group.startup.include=gatewayStarted\n-management.endpoint.health.group.startup.show-details=never\n+management.endpoint.health.group.startup.show-details=always", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczNjc4Mw=="}, "originalCommit": {"oid": "0550a074d1074c4c3c4841281ad9a85b5a4b4a8d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 240, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}