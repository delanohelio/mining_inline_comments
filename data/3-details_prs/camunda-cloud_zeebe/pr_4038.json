{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NjU2ODEw", "number": 4038, "title": "chore(broker): Replace GSON with Jackson in BrokerCfg and GatewayCfg", "bodyText": "Background:\nThe configuration objects are serialized to JSON and written to the log during startup.\nCurrently the behavior uses GSON. This is one of the few places where GSON is used.\nIn all other places we use Jackson. There is nothing special about using GSON here,\nso it can and should be replaced with Jackson.\nScope\n\nReplace GSON with Jackson in BrokerCfg and GatewayCfg\nFactory method for JSON object writers with custom serializers for Duration (and other Java time objects)\nand DataSize objects\n\nOut of Scope\nDependency to GSON in ExporterConfiguration - the class had a low test coverage and comparing\nthe default output of GSON vs. Jackson revealed that they are not identical, so changing the\nserializer/deserializer here could alter behavior.\nRelated issues\ncloses #3994\nPull Request Checklist\n\n[ X ] All commit messages match our commit message guidelines\n[ X ] The submitting code follows our code style\n[ X ] If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-03-11T12:20:17Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4038", "merged": true, "mergeCommit": {"oid": "6efb96a3794dcee75a28d89c1ca66254260f1e2d"}, "closed": true, "closedAt": "2020-03-18T13:53:36Z", "author": {"login": "pihme"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOJEPcAFqTM3NDk2NzM3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO07zCABqjMxNDA4OTA2OTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0OTY3Mzcz", "url": "https://github.com/camunda-cloud/zeebe/pull/4038#pullrequestreview-374967373", "createdAt": "2020-03-16T07:28:48Z", "commit": {"oid": "c00133e6b101a474b4ef369af0c27fef9daac677"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwNzoyODo0OVrOF2oTXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwNzoyODo0OVrOF2oTXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjgyNzc0MA==", "bodyText": "Wouldn't it be better if duration is serialized to readable format like \"30s\"?", "url": "https://github.com/camunda-cloud/zeebe/pull/4038#discussion_r392827740", "createdAt": "2020-03-16T07:28:49Z", "author": {"login": "deepthidevaki"}, "path": "util/src/test/java/io/zeebe/util/ObjectWriterFactoryTest.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.util;\n+\n+import static io.zeebe.util.ObjectWriterFactory.getDefaultJsonObjectWriter;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.fail;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectWriter;\n+import java.time.Duration;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.junit.Test;\n+import org.springframework.util.unit.DataSize;\n+\n+public class ObjectWriterFactoryTest {\n+\n+  @Test\n+  public void shouldReturnNonNullDefaultObjectWriter() {\n+    // when\n+    final ObjectWriter actual = getDefaultJsonObjectWriter();\n+\n+    // then\n+    assertThat(actual).isNotNull();\n+  }\n+\n+  @Test\n+  public void shouldReturnObjectWriterWithPrettyPrintingEnabled() {\n+    // given\n+    final Map<String, String> objectToSerialize = new HashMap<>();\n+    objectToSerialize.put(\"field1\", \"value1\");\n+    objectToSerialize.put(\"field2\", \"value2\");\n+\n+    String actual;\n+    // when\n+    try {\n+      actual = getDefaultJsonObjectWriter().writeValueAsString(objectToSerialize);\n+    } catch (JsonProcessingException e) {\n+      fail(e.getMessage());\n+      actual = \"\";\n+    }\n+\n+    // then\n+    assertThat(actual)\n+        .withFailMessage(\"Should be pretty printed and therefore contain line breaks\")\n+        .contains(System.lineSeparator());\n+  }\n+\n+  @Test\n+  public void shouldReturnObjectWriterThatWritesDurationAsNumberInSeconds() {\n+    // given\n+    final Duration objectToSerialize = Duration.ofSeconds(30);\n+\n+    String actual;\n+    // when\n+    try {\n+      actual = getDefaultJsonObjectWriter().writeValueAsString(objectToSerialize);\n+    } catch (JsonProcessingException e) {\n+      fail(e.getMessage());\n+      actual = \"\";\n+    }\n+\n+    // then\n+    assertThat(actual).describedAs(\"Serialized form of Duration\").isEqualTo(\"30.000000000\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c00133e6b101a474b4ef369af0c27fef9daac677"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTc5NzAx", "url": "https://github.com/camunda-cloud/zeebe/pull/4038#pullrequestreview-375979701", "createdAt": "2020-03-17T12:17:22Z", "commit": {"oid": "c00133e6b101a474b4ef369af0c27fef9daac677"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c00133e6b101a474b4ef369af0c27fef9daac677", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c00133e6b101a474b4ef369af0c27fef9daac677", "committedDate": "2020-03-11T10:37:44Z", "message": "chore(broker): Replace GSON with Jackson in BrokerCfg and GatewayCfg\n\nBackground:\nThe configuration objects are serialized to JSON and written to the log during startup.\nCurrently the behavior uses GSON. This is one of the few places where GSON is used.\nIn all other places we use Jackson. There is nothing special about using GSON here,\nso it can and should be replaced with Jackson.\n\nScope\n- Replace GSON with Jackson in BrokerCfg and GatewayCfg\n- Factory method for JSON object writers with custom serializers for Duration (and other Java time objects)\n  and DataSize objects\n\nOut of Scope\n\nDependency to GSON in ExporterConfiguration - the class had a low test coverage and comparing\nthe default output of GSON vs. Jackson revealed that they are not identical, so changing the\nserializer/deserializer here could alter behavior."}, "afterCommit": {"oid": "3720a2b2846656015ae91c29c39b5dac25aa6788", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3720a2b2846656015ae91c29c39b5dac25aa6788", "committedDate": "2020-03-18T09:50:15Z", "message": "chore(broker): Replace GSON with Jackson in BrokerCfg and GatewayCfg\n\nBackground:\nThe configuration objects are serialized to JSON and written to the log during startup.\nCurrently the behavior uses GSON. This is one of the few places where GSON is used.\nIn all other places we use Jackson. There is nothing special about using GSON here,\nso it can and should be replaced with Jackson.\n\nScope\n- Replace GSON with Jackson in BrokerCfg and GatewayCfg\n- Factory method for JSON object writers with custom serializers for Duration (and other Java time objects)\n  and DataSize objects\n\nOut of Scope\n\nDependency to GSON in ExporterConfiguration - the class had a low test coverage and comparing\nthe default output of GSON vs. Jackson revealed that they are not identical, so changing the\nserializer/deserializer here could alter behavior."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c23245e8bad48968001116cc2c484bcf86fe9f6", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1c23245e8bad48968001116cc2c484bcf86fe9f6", "committedDate": "2020-03-18T10:40:56Z", "message": "chore(broker): Replace GSON with Jackson in BrokerCfg and GatewayCfg\n\nBackground:\nThe configuration objects are serialized to JSON and written to the log during startup.\nCurrently the behavior uses GSON. This is one of the few places where GSON is used.\nIn all other places we use Jackson. There is nothing special about using GSON here,\nso it can and should be replaced with Jackson.\n\nScope\n- Replace GSON with Jackson in BrokerCfg and GatewayCfg\n- Factory method for JSON object writers with custom serializers for Duration (and other Java time objects)\n  and DataSize objects\n\nOut of Scope\n\nDependency to GSON in ExporterConfiguration - the class had a low test coverage and comparing\nthe default output of GSON vs. Jackson revealed that they are not identical, so changing the\nserializer/deserializer here could alter behavior."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3720a2b2846656015ae91c29c39b5dac25aa6788", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3720a2b2846656015ae91c29c39b5dac25aa6788", "committedDate": "2020-03-18T09:50:15Z", "message": "chore(broker): Replace GSON with Jackson in BrokerCfg and GatewayCfg\n\nBackground:\nThe configuration objects are serialized to JSON and written to the log during startup.\nCurrently the behavior uses GSON. This is one of the few places where GSON is used.\nIn all other places we use Jackson. There is nothing special about using GSON here,\nso it can and should be replaced with Jackson.\n\nScope\n- Replace GSON with Jackson in BrokerCfg and GatewayCfg\n- Factory method for JSON object writers with custom serializers for Duration (and other Java time objects)\n  and DataSize objects\n\nOut of Scope\n\nDependency to GSON in ExporterConfiguration - the class had a low test coverage and comparing\nthe default output of GSON vs. Jackson revealed that they are not identical, so changing the\nserializer/deserializer here could alter behavior."}, "afterCommit": {"oid": "1c23245e8bad48968001116cc2c484bcf86fe9f6", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1c23245e8bad48968001116cc2c484bcf86fe9f6", "committedDate": "2020-03-18T10:40:56Z", "message": "chore(broker): Replace GSON with Jackson in BrokerCfg and GatewayCfg\n\nBackground:\nThe configuration objects are serialized to JSON and written to the log during startup.\nCurrently the behavior uses GSON. This is one of the few places where GSON is used.\nIn all other places we use Jackson. There is nothing special about using GSON here,\nso it can and should be replaced with Jackson.\n\nScope\n- Replace GSON with Jackson in BrokerCfg and GatewayCfg\n- Factory method for JSON object writers with custom serializers for Duration (and other Java time objects)\n  and DataSize objects\n\nOut of Scope\n\nDependency to GSON in ExporterConfiguration - the class had a low test coverage and comparing\nthe default output of GSON vs. Jackson revealed that they are not identical, so changing the\nserializer/deserializer here could alter behavior."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3060, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}