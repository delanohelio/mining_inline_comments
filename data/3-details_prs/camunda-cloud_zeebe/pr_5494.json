{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4Mzg0Mzcw", "number": 5494, "title": "chore(broker): donot detect streamprocessor as unhealthy when paused", "bodyText": "Description\nStreamProcessor is not detected as unhealthy when it is paused. Instead ZeebePartition is detected as unhealthy when disk space is not available.\nRelated issues\ncloses #5443\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-10-06T09:05:02Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5494", "merged": true, "mergeCommit": {"oid": "a5dcfac5ccfcb0fbe76b81885ba66a9fcf4b1743"}, "closed": true, "closedAt": "2020-10-13T13:17:45Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP0vbZABqjM4NDQzMzczOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSHhcMABqjM4NzA5NTI2NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7be3e8aea9f79c887bc5afa02e4ee7bb4871030", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f7be3e8aea9f79c887bc5afa02e4ee7bb4871030", "committedDate": "2020-10-06T08:21:16Z", "message": "chore(broker): donot detect streamprocessor as unhealthy when paused\n- detect partition as unhealthy when diskspace is not available"}, "afterCommit": {"oid": "5df2c4f135d73b4aa7b1b2a35176aa379ac76d2c", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5df2c4f135d73b4aa7b1b2a35176aa379ac76d2c", "committedDate": "2020-10-06T09:12:40Z", "message": "chore(broker): donot detect streamprocessor as unhealthy when paused\n- detect partition as unhealthy when diskspace is not available"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNzcyNDI2", "url": "https://github.com/camunda-cloud/zeebe/pull/5494#pullrequestreview-503772426", "createdAt": "2020-10-07T11:17:13Z", "commit": {"oid": "6c38e6ab0ec508dd68fbece020769e072e6bf893"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMToxNzoxM1rOHduaug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMToxNzozM1rOHdubVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkzMTI1OA==", "bodyText": "I think it makes more sense sense to calculate the health status here instead of in every caller and passing it as a parameter. An updateHealthStatus method can be called after updating some condition and that knows how to compute the health status. That way the logic isn't spread out.", "url": "https://github.com/camunda-cloud/zeebe/pull/5494#discussion_r500931258", "createdAt": "2020-10-07T11:17:13Z", "author": {"login": "MiguelPires"}, "path": "broker/src/main/java/io/zeebe/broker/system/partitions/ZeebePartitionHealth.java", "diffHunk": "@@ -34,9 +42,13 @@ public void addFailureListener(final FailureListener failureListener) {\n     this.failureListener = failureListener;\n   }\n \n-  void setHealthStatus(final HealthStatus healthStatus) {\n-    final var previousStatus = this.healthStatus;\n-    this.healthStatus = healthStatus;\n+  private void setHealthStatus(final boolean healthy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c38e6ab0ec508dd68fbece020769e072e6bf893"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkzMTQxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              Multiple factors determines ZeebePartition's health :\n          \n          \n            \n              Multiple factors determine ZeebePartition's health :", "url": "https://github.com/camunda-cloud/zeebe/pull/5494#discussion_r500931415", "createdAt": "2020-10-07T11:17:33Z", "author": {"login": "MiguelPires"}, "path": "broker/src/main/java/io/zeebe/broker/system/partitions/ZeebePartitionHealth.java", "diffHunk": "@@ -19,6 +19,14 @@\n   private HealthStatus healthStatus = HealthStatus.UNHEALTHY;\n   private final String name;\n   private FailureListener failureListener;\n+  /*\n+  Multiple factors determines ZeebePartition's health :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c38e6ab0ec508dd68fbece020769e072e6bf893"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NDE3MTM3", "url": "https://github.com/camunda-cloud/zeebe/pull/5494#pullrequestreview-506417137", "createdAt": "2020-10-12T08:48:24Z", "commit": {"oid": "ae568733697a0b2c1a41abb3174c4de19468a2c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b67897f6fdc65e661c5e2a14139ebc7b2a413883", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b67897f6fdc65e661c5e2a14139ebc7b2a413883", "committedDate": "2020-10-13T12:13:33Z", "message": "chore(broker): donot detect streamprocessor as unhealthy when paused\n- detect partition as unhealthy when diskspace is not available"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae568733697a0b2c1a41abb3174c4de19468a2c6", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/ae568733697a0b2c1a41abb3174c4de19468a2c6", "committedDate": "2020-10-12T08:10:29Z", "message": "chore(broker): review comments"}, "afterCommit": {"oid": "b67897f6fdc65e661c5e2a14139ebc7b2a413883", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b67897f6fdc65e661c5e2a14139ebc7b2a413883", "committedDate": "2020-10-13T12:13:33Z", "message": "chore(broker): donot detect streamprocessor as unhealthy when paused\n- detect partition as unhealthy when diskspace is not available"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2417, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}