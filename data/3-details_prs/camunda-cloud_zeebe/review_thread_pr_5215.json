{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwOTIyNDk2", "number": 5215, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMjo1MFrOEajKJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMjo1MFrOEajKJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2Mjc0NDcxOnYy", "diffSide": "LEFT", "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/AbstractAppender.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMjo1MFrOHEDIsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMzo1OVrOHEDLvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwNzczMQ==", "bodyText": "I removed this synchronized. I think it is not required. What do you think? @Zelldon", "url": "https://github.com/camunda-cloud/zeebe/pull/5215#discussion_r474007731", "createdAt": "2020-08-20T14:02:50Z", "author": {"login": "deepthidevaki"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/AbstractAppender.java", "diffHunk": "@@ -447,45 +449,63 @@ protected void handleConfigureResponseError(\n     // This prevents infinite loops when cluster configurations fail.\n   }\n \n-  /** Builds an install request for the given member. */\n-  protected InstallRequest buildInstallRequest(\n+  /**\n+   * Builds an install request for the given member.\n+   *\n+   * @return\n+   */\n+  protected Optional<InstallRequest> buildInstallRequest(\n       final RaftMemberContext member, final Snapshot snapshot) {\n     if (member.getNextSnapshotIndex() != snapshot.index()) {\n+      try {\n+        final SnapshotChunkReader snapshotChunkReader = snapshot.newChunkReader();\n+        member.setSnapshotChunkReader(snapshotChunkReader);\n+      } catch (final UncheckedIOException e) {\n+        log.warn(\n+            \"Expected to send Snapshot {} to {}. But could not open SnapshotChunkReader. Will retry.\",\n+            snapshot.getPath(),\n+            e);\n+        return Optional.empty();\n+      }\n       member.setNextSnapshotIndex(snapshot.index());\n       member.setNextSnapshotChunk(null);\n     }\n \n     final InstallRequest request;\n-    synchronized (snapshot) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwODE4Mw==", "bodyText": "I think the same, since we having only one thread.", "url": "https://github.com/camunda-cloud/zeebe/pull/5215#discussion_r474008183", "createdAt": "2020-08-20T14:03:30Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/AbstractAppender.java", "diffHunk": "@@ -447,45 +449,63 @@ protected void handleConfigureResponseError(\n     // This prevents infinite loops when cluster configurations fail.\n   }\n \n-  /** Builds an install request for the given member. */\n-  protected InstallRequest buildInstallRequest(\n+  /**\n+   * Builds an install request for the given member.\n+   *\n+   * @return\n+   */\n+  protected Optional<InstallRequest> buildInstallRequest(\n       final RaftMemberContext member, final Snapshot snapshot) {\n     if (member.getNextSnapshotIndex() != snapshot.index()) {\n+      try {\n+        final SnapshotChunkReader snapshotChunkReader = snapshot.newChunkReader();\n+        member.setSnapshotChunkReader(snapshotChunkReader);\n+      } catch (final UncheckedIOException e) {\n+        log.warn(\n+            \"Expected to send Snapshot {} to {}. But could not open SnapshotChunkReader. Will retry.\",\n+            snapshot.getPath(),\n+            e);\n+        return Optional.empty();\n+      }\n       member.setNextSnapshotIndex(snapshot.index());\n       member.setNextSnapshotChunk(null);\n     }\n \n     final InstallRequest request;\n-    synchronized (snapshot) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwNzczMQ=="}, "originalCommit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwODUxMA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/camunda-cloud/zeebe/pull/5215#discussion_r474008510", "createdAt": "2020-08-20T14:03:59Z", "author": {"login": "deepthidevaki"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/AbstractAppender.java", "diffHunk": "@@ -447,45 +449,63 @@ protected void handleConfigureResponseError(\n     // This prevents infinite loops when cluster configurations fail.\n   }\n \n-  /** Builds an install request for the given member. */\n-  protected InstallRequest buildInstallRequest(\n+  /**\n+   * Builds an install request for the given member.\n+   *\n+   * @return\n+   */\n+  protected Optional<InstallRequest> buildInstallRequest(\n       final RaftMemberContext member, final Snapshot snapshot) {\n     if (member.getNextSnapshotIndex() != snapshot.index()) {\n+      try {\n+        final SnapshotChunkReader snapshotChunkReader = snapshot.newChunkReader();\n+        member.setSnapshotChunkReader(snapshotChunkReader);\n+      } catch (final UncheckedIOException e) {\n+        log.warn(\n+            \"Expected to send Snapshot {} to {}. But could not open SnapshotChunkReader. Will retry.\",\n+            snapshot.getPath(),\n+            e);\n+        return Optional.empty();\n+      }\n       member.setNextSnapshotIndex(snapshot.index());\n       member.setNextSnapshotChunk(null);\n     }\n \n     final InstallRequest request;\n-    synchronized (snapshot) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwNzczMQ=="}, "originalCommit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 313, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}