{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMjY1MjIx", "number": 5588, "title": "Allow configuring raft threadcontext", "bodyText": "Description\nFor randomized property tests,  it is required to control the execution of raft. This PR enables us to inject\n\nThreadContext\nRandom instance\nto RaftContext. In tests, we can then use a controllable thread executor similar to ControllableActorScheduler. It is also useful to control the randomized election timeouts. So we can now insert a Random instance to generate reproducible election timeouts.\n\nThis PR is a prerequisite for introducing randomized property test for raft.\nRelated issues\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-10-14T10:16:17Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5588", "merged": true, "mergeCommit": {"oid": "48f45f2519f57a8f28d9e8741e56a2458cf56e50"}, "closed": true, "closedAt": "2020-10-20T14:58:03Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSaFVlAH2gAyNTAzMjY1MjIxOjM5ODk2ZmFmN2Y5MTVlZmU5YTllZjE0NmRmYWZiNmU2MDFlOTRiZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTA3uoAFqTUxMDIwMTUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "39896faf7f915efe9a9ef146dfafb6e601e94bd8", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/39896faf7f915efe9a9ef146dfafb6e601e94bd8", "committedDate": "2020-10-14T09:51:14Z", "message": "chore(aromix): enable raft to use provided thread factory\n- Useful in testing to control the execution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0f8021a872c81415e50f00aeba9ed6c2b82228d", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b0f8021a872c81415e50f00aeba9ed6c2b82228d", "committedDate": "2020-10-14T09:51:34Z", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution"}, "afterCommit": {"oid": "d6dee098ea74c2c29b90c4afadbaab865c5513af", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d6dee098ea74c2c29b90c4afadbaab865c5513af", "committedDate": "2020-10-14T10:18:42Z", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f1b2895a44b1769059bf28aeedd47682b9cc24c1", "committedDate": "2020-10-14T11:59:03Z", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6dee098ea74c2c29b90c4afadbaab865c5513af", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d6dee098ea74c2c29b90c4afadbaab865c5513af", "committedDate": "2020-10-14T10:18:42Z", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution"}, "afterCommit": {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f1b2895a44b1769059bf28aeedd47682b9cc24c1", "committedDate": "2020-10-14T11:59:03Z", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjAxNTI3", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#pullrequestreview-510201527", "createdAt": "2020-10-16T07:00:58Z", "commit": {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzowMDo1OFrOHiqG4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzowMjoyNVrOHiqJ6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwMzUyMQ==", "bodyText": "Why we had this factory here before do you know?", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#discussion_r506103521", "createdAt": "2020-10-16T07:00:58Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/partition/RaftPartition.java", "diffHunk": "@@ -47,7 +46,6 @@\n   private final PartitionId partitionId;\n   private final RaftPartitionGroupConfig config;\n   private final File dataDirectory;\n-  private final ThreadContextFactory threadContextFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwNDI5Nw==", "bodyText": "Why it was necessary to close the factory before? \ud83e\udd14", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#discussion_r506104297", "createdAt": "2020-10-16T07:02:25Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/impl/RaftContext.java", "diffHunk": "@@ -617,12 +609,6 @@ public void close() {\n \n     // close thread contexts\n     threadContext.close();\n-    loadContext.close();\n-\n-    // Only close the thread context factory if indicated.\n-    if (closeOnStop) {\n-      threadContextFactory.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1"}, "originalPosition": 96}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2450, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}