{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NDEyODE1", "number": 5287, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzoyODoyOFrOEf3Bnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzozNDozNVrOEf3KEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODQyODQ3OnYy", "diffSide": "RIGHT", "path": "logstreams/src/main/java/io/zeebe/logstreams/impl/log/Listener.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzoyODoyOFrOHMZn2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToxMjoyNVrOHMdjxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NDc2MQ==", "bodyText": "Since this case is not a failure, do we want to reduce the log level to DEBUG instead?\nOr, is it useful to see these log statements on WARN?", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#discussion_r482764761", "createdAt": "2020-09-03T07:28:28Z", "author": {"login": "saig0"}, "path": "logstreams/src/main/java/io/zeebe/logstreams/impl/log/Listener.java", "diffHunk": "@@ -27,13 +28,17 @@ public void onWrite(final long address) {\n \n   @Override\n   public void onWriteError(final Throwable error) {\n-    LogStorageAppender.LOG.error(\n-        \"Failed to append block with last event position {}.\", highestPosition, error);\n-    if (error instanceof NoSuchElementException) {\n+    if (error instanceof NoSuchElementException || error instanceof NoLeader) {\n       // Not a failure. It is probably during transition to follower.\n+      LogStorageAppender.LOG.warn(\n+          \"Failed to append block with last event position {}. This can happen during a leader change.\",\n+          highestPosition,\n+          error);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyOTI1NQ==", "bodyText": "Agree. DEBUG would be better. I changed it.", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#discussion_r482829255", "createdAt": "2020-09-03T09:12:25Z", "author": {"login": "deepthidevaki"}, "path": "logstreams/src/main/java/io/zeebe/logstreams/impl/log/Listener.java", "diffHunk": "@@ -27,13 +28,17 @@ public void onWrite(final long address) {\n \n   @Override\n   public void onWriteError(final Throwable error) {\n-    LogStorageAppender.LOG.error(\n-        \"Failed to append block with last event position {}.\", highestPosition, error);\n-    if (error instanceof NoSuchElementException) {\n+    if (error instanceof NoSuchElementException || error instanceof NoLeader) {\n       // Not a failure. It is probably during transition to follower.\n+      LogStorageAppender.LOG.warn(\n+          \"Failed to append block with last event position {}. This can happen during a leader change.\",\n+          highestPosition,\n+          error);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NDc2MQ=="}, "originalCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODQ1MDA4OnYy", "diffSide": "RIGHT", "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotMetadata.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzozNDozNVrOHMZ1aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOTowODozM1rOHMdXfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2ODIzNQ==", "bodyText": "You changed the hashCode() and equals() implementation.\nWhy did you change it?\nDoes this change any behavior?", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#discussion_r482768235", "createdAt": "2020-09-03T07:34:35Z", "author": {"login": "saig0"}, "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotMetadata.java", "diffHunk": "@@ -122,34 +122,37 @@ public String getSnapshotIdAsString() {\n \n   @Override\n   public int hashCode() {\n-    return Objects.hash(getIndex(), getTerm(), getTimestamp());\n+    return Objects.hash(index, term, processedPosition, exporterPosition);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNjEwOA==", "bodyText": "This should have been updated when new fields were added to the class, but it was not.  It won't change any behavior, but it is expected to include processedPosition and exporterPosition when comaparing two snapshots. We did not find out this error, because we are using SnapshotId::compareTo to compare them.", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#discussion_r482826108", "createdAt": "2020-09-03T09:08:33Z", "author": {"login": "deepthidevaki"}, "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotMetadata.java", "diffHunk": "@@ -122,34 +122,37 @@ public String getSnapshotIdAsString() {\n \n   @Override\n   public int hashCode() {\n-    return Objects.hash(getIndex(), getTerm(), getTimestamp());\n+    return Objects.hash(index, term, processedPosition, exporterPosition);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2ODIzNQ=="}, "originalCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 342, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}