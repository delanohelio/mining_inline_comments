{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NTk1MzI0", "number": 4550, "title": "chore(engine): refactoring start event onEvent processing", "bodyText": "Description\nIntroduces StartEventProcessor\nRelated issues\ncloses #4470\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-05-18T15:59:38Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4550", "merged": true, "mergeCommit": {"oid": "62bdc5d97646df2f74b042c99e06674b30d60fc4"}, "closed": true, "closedAt": "2020-05-20T12:00:59Z", "author": {"login": "korthout"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjCKv_gFqTQxNDk4NTI3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjHjhbABqjMzNTYwNTIzNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTg1Mjc5", "url": "https://github.com/camunda-cloud/zeebe/pull/4550#pullrequestreview-414985279", "createdAt": "2020-05-20T04:34:08Z", "commit": {"oid": "39f58ff1675ce3dab782195f2f43cdcdc8030357"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNDozNDowOFrOGX66kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNToyMTo0NFrOGX7p6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzczNTY5OA==", "bodyText": "It seems that the binding for ELEMENT_TERMINATED is missing \ud83d\ude09", "url": "https://github.com/camunda-cloud/zeebe/pull/4550#discussion_r427735698", "createdAt": "2020-05-20T04:34:08Z", "author": {"login": "saig0"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/transformer/StartEventTransformer.java", "diffHunk": "@@ -58,7 +58,17 @@ public void transform(final StartEvent element, final TransformContext context)\n \n   private void bindLifecycle(final ExecutableCatchEventElement startEvent) {\n     startEvent.bindLifecycleState(\n-        WorkflowInstanceIntent.EVENT_OCCURRED, BpmnStep.START_EVENT_EVENT_OCCURRED);\n+        WorkflowInstanceIntent.EVENT_OCCURRED, BpmnStep.BPMN_ELEMENT_PROCESSOR);\n+    startEvent.bindLifecycleState(\n+        WorkflowInstanceIntent.ELEMENT_ACTIVATING, BpmnStep.BPMN_ELEMENT_PROCESSOR);\n+    startEvent.bindLifecycleState(\n+        WorkflowInstanceIntent.ELEMENT_ACTIVATED, BpmnStep.BPMN_ELEMENT_PROCESSOR);\n+    startEvent.bindLifecycleState(\n+        WorkflowInstanceIntent.ELEMENT_COMPLETING, BpmnStep.BPMN_ELEMENT_PROCESSOR);\n+    startEvent.bindLifecycleState(\n+        WorkflowInstanceIntent.ELEMENT_COMPLETED, BpmnStep.BPMN_ELEMENT_PROCESSOR);\n+    startEvent.bindLifecycleState(\n+        WorkflowInstanceIntent.ELEMENT_TERMINATING, BpmnStep.BPMN_ELEMENT_PROCESSOR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39f58ff1675ce3dab782195f2f43cdcdc8030357"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc0NDk0NA==", "bodyText": "We should align the error messages with the existing ones (e.g. Expected ... but ... [context: ...].", "url": "https://github.com/camunda-cloud/zeebe/pull/4550#discussion_r427744944", "createdAt": "2020-05-20T05:11:49Z", "author": {"login": "saig0"}, "path": "engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnEventSubscriptionBehavior.java", "diffHunk": "@@ -32,7 +34,12 @@\n \n public final class BpmnEventSubscriptionBehavior {\n \n+  private static final String NO_WORKFLOW_FOUND_MESSAGE =\n+      \"Expected to create an instance of workflow with key '%d', but no such workflow was found\";\n+  private static final String NO_TRIGGERED_EVENT_MESSAGE = \"No triggered event for workflow '%d'\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39f58ff1675ce3dab782195f2f43cdcdc8030357"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc0NzgxOA==", "bodyText": "I think input mappings on a start event doesn't make sense. A start event is activated on workflow instance creation or when it is triggered by an event. So, I see no use case of an input mapping - only for output mappings.\nLet's remove it if you agree.", "url": "https://github.com/camunda-cloud/zeebe/pull/4550#discussion_r427747818", "createdAt": "2020-05-20T05:21:44Z", "author": {"login": "saig0"}, "path": "engine/src/main/java/io/zeebe/engine/nwe/event/StartEventProcessor.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.engine.nwe.event;\n+\n+import io.zeebe.engine.nwe.BpmnElementContext;\n+import io.zeebe.engine.nwe.BpmnElementProcessor;\n+import io.zeebe.engine.nwe.behavior.BpmnBehaviors;\n+import io.zeebe.engine.nwe.behavior.BpmnEventSubscriptionBehavior;\n+import io.zeebe.engine.nwe.behavior.BpmnIncidentBehavior;\n+import io.zeebe.engine.nwe.behavior.BpmnStateBehavior;\n+import io.zeebe.engine.nwe.behavior.BpmnStateTransitionBehavior;\n+import io.zeebe.engine.nwe.behavior.BpmnVariableMappingBehavior;\n+import io.zeebe.engine.processor.workflow.deployment.model.element.ExecutableStartEvent;\n+\n+public class StartEventProcessor implements BpmnElementProcessor<ExecutableStartEvent> {\n+\n+  private final BpmnEventSubscriptionBehavior eventSubscriptionBehavior;\n+  private final BpmnStateTransitionBehavior stateTransitionBehavior;\n+  private final BpmnVariableMappingBehavior variableMappingBehavior;\n+  private final BpmnIncidentBehavior incidentBehavior;\n+  private final BpmnStateBehavior stateBehavior;\n+\n+  public StartEventProcessor(final BpmnBehaviors bpmnBehaviors) {\n+    eventSubscriptionBehavior = bpmnBehaviors.eventSubscriptionBehavior();\n+    incidentBehavior = bpmnBehaviors.incidentBehavior();\n+    stateBehavior = bpmnBehaviors.stateBehavior();\n+    stateTransitionBehavior = bpmnBehaviors.stateTransitionBehavior();\n+    variableMappingBehavior = bpmnBehaviors.variableMappingBehavior();\n+  }\n+\n+  @Override\n+  public Class<ExecutableStartEvent> getType() {\n+    return ExecutableStartEvent.class;\n+  }\n+\n+  @Override\n+  public void onActivating(final ExecutableStartEvent element, final BpmnElementContext context) {\n+    // todo(@korthout): discuss the input mappings, there are no tests for this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39f58ff1675ce3dab782195f2f43cdcdc8030357"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5211e014c634c45bfad8f5f8c7d0e21a3245ec0", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d5211e014c634c45bfad8f5f8c7d0e21a3245ec0", "committedDate": "2020-05-20T11:41:07Z", "message": "chore(engine): refactoring start event onEvent processing\n\nThis is a combination of 4 commits.\n\nchore(engine): migrate the full lifecycle of start event\n\nchore(engine): clean up old start event event occurred handler\n\nchore(engine): remove todo\n\nwe cannot use this.eventRecord there."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4eb47fdbaab122c84f50faae4c0f3635045daab", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f4eb47fdbaab122c84f50faae4c0f3635045daab", "committedDate": "2020-05-20T11:41:11Z", "message": "chore(engine): resolve review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39f58ff1675ce3dab782195f2f43cdcdc8030357", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/39f58ff1675ce3dab782195f2f43cdcdc8030357", "committedDate": "2020-05-19T10:16:45Z", "message": "chore(engine): remove todo\n\nwe cannot use this.eventRecord there."}, "afterCommit": {"oid": "f4eb47fdbaab122c84f50faae4c0f3635045daab", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f4eb47fdbaab122c84f50faae4c0f3635045daab", "committedDate": "2020-05-20T11:41:11Z", "message": "chore(engine): resolve review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2827, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}