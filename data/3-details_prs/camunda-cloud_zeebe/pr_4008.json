{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NjY1NTEx", "number": 4008, "title": "test(engine): fix concurrency issue with subscription handler", "bodyText": "Description\n\nmultiple subscription handlers used the same log stream writer for writing on the same partition\navoid concurrent access by delegating the command to the subscription handler of the receiver partition instead of the sender partition\nuse a single thread pool to avoid concurrent access to the same subscription handler\n\nRelated issues\ncloses #3639\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-03-09T15:45:41Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4008", "merged": true, "mergeCommit": {"oid": "e530343d4721f1d14984fed0314e40ce12e2a303"}, "closed": true, "closedAt": "2020-03-10T08:01:40Z", "author": {"login": "saig0"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMMRGrgFqTM3MTcwMDA5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMNlDugBqjMxMTM1NjYxMDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzAwMDkw", "url": "https://github.com/camunda-cloud/zeebe/pull/4008#pullrequestreview-371700090", "createdAt": "2020-03-10T06:10:37Z", "commit": {"oid": "61e2920a2e8868ef5fa770909ddae604acbe67be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNjoxMDozN1rOF0Cghg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNjoxMDozN1rOF0Cghg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDExMTM2Ng==", "bodyText": "Here you create now an executor for each handler? What if we create one for all? So outside of the loop?", "url": "https://github.com/camunda-cloud/zeebe/pull/4008#discussion_r390111366", "createdAt": "2020-03-10T06:10:37Z", "author": {"login": "Zelldon"}, "path": "engine/src/test/java/io/zeebe/engine/util/EngineRule.java", "diffHunk": "@@ -155,6 +159,13 @@ private void startProcessors() {\n                           (key, partition) -> {},\n                           jobsAvailableCallback)\n                       .withListener(new ProcessingExporterTransistor()));\n+\n+          // sequenialize the commands to avoid concurrency\n+          final var subscriptionHandlerExecutor = Executors.newSingleThreadExecutor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61e2920a2e8868ef5fa770909ddae604acbe67be"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzE3ODcz", "url": "https://github.com/camunda-cloud/zeebe/pull/4008#pullrequestreview-371717873", "createdAt": "2020-03-10T07:09:17Z", "commit": {"oid": "14068777ff4e54b64faecdd4eeea5d0f747883a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b45110b88f1f98809436bde017c954bca5efa95e", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b45110b88f1f98809436bde017c954bca5efa95e", "committedDate": "2020-03-10T07:42:09Z", "message": "test(engine): fix concurrency issue with subscription handler\n\n* multiple subscription handlers used the same log stream writer for writing on the same partition\n* avoid concurrent access by delegating the command to the subscription handler of the receiver partition instead of the sender partition\n* use a single thread pool to avoid concurrent access to the same subscription handler"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14068777ff4e54b64faecdd4eeea5d0f747883a3", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/14068777ff4e54b64faecdd4eeea5d0f747883a3", "committedDate": "2020-03-10T07:03:45Z", "message": "test(engine): use a single thread pool for all subscription handlers"}, "afterCommit": {"oid": "b45110b88f1f98809436bde017c954bca5efa95e", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b45110b88f1f98809436bde017c954bca5efa95e", "committedDate": "2020-03-10T07:42:09Z", "message": "test(engine): fix concurrency issue with subscription handler\n\n* multiple subscription handlers used the same log stream writer for writing on the same partition\n* avoid concurrent access by delegating the command to the subscription handler of the receiver partition instead of the sender partition\n* use a single thread pool to avoid concurrent access to the same subscription handler"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3047, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}