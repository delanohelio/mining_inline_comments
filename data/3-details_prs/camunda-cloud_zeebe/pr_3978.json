{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNTg4Njkw", "number": 3978, "title": "Respond NOT_FOUND when partition cannot be found", "bodyText": "Description\nWhen a request from a client refers to an elementInstanceKey that does\nnot encapsulate a partition (or encapsulates a non-existing partition),\nthen the gateway now responds with NOT_FOUND.\nThe gateway simply checks that the partitionId is part of the known partitions of\nthe topology.\nRelated issues\ncloses #3961", "createdAt": "2020-03-04T14:23:24Z", "url": "https://github.com/camunda-cloud/zeebe/pull/3978", "merged": true, "mergeCommit": {"oid": "d29d81cf344f68bafbe1745d3307cf3fc3eefa04"}, "closed": true, "closedAt": "2020-03-11T07:11:52Z", "author": {"login": "korthout"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKYiRkgBqjMwOTcwMTU5MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMV1GpgH2gAyMzgzNTg4NjkwOmY1M2I0YjAzOGZmNTMxMGIyZTg3YzliOTYyODVhNTI2NDA1MzMxZjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6b25dc9d70bdb22ca883cd0bea8bdcbe45fd80e", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d6b25dc9d70bdb22ca883cd0bea8bdcbe45fd80e", "committedDate": "2020-03-04T15:11:39Z", "message": "chore: remove test that dealt with nonexisting partition wrongly\n\nIt was a feature, not a bug (according to this test). So I've removed\nit."}, "afterCommit": {"oid": "bc9106bad25eb5601e5d3d85221e65a60703f4f4", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/bc9106bad25eb5601e5d3d85221e65a60703f4f4", "committedDate": "2020-03-04T15:19:54Z", "message": "chore(it): remove test that dealt with nonexisting partition wrongly\n\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc9106bad25eb5601e5d3d85221e65a60703f4f4", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/bc9106bad25eb5601e5d3d85221e65a60703f4f4", "committedDate": "2020-03-04T15:19:54Z", "message": "chore(it): remove test that dealt with nonexisting partition wrongly\n\nIt was a feature, not a bug (according to this test). So I've removed\nit."}, "afterCommit": {"oid": "5d2b13a6625178d0f04027c2c65812637661c42d", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5d2b13a6625178d0f04027c2c65812637661c42d", "committedDate": "2020-03-04T16:20:15Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzU5Mzk1", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#pullrequestreview-369359395", "createdAt": "2020-03-05T08:04:34Z", "commit": {"oid": "5d2b13a6625178d0f04027c2c65812637661c42d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowNDozNVrOFyJmSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowNDozNVrOFyJmSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzMDM3Nw==", "bodyText": "I suggest to have a more detailed message. Something like Expected to send request to partition '0', but partition '0' unknown in topology . https://github.com/zeebe-io/zeebe/wiki/Error-Guidelines", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388130377", "createdAt": "2020-03-05T08:04:35Z", "author": {"login": "deepthidevaki"}, "path": "gateway/src/main/java/io/zeebe/gateway/cmd/PartitionNotFoundException.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.gateway.cmd;\n+\n+/**\n+ * Represents an exceptional error that occurs when a partition can not be found. For example this\n+ * can happen when the element instance key does not refer to a known partition.\n+ */\n+public class PartitionNotFoundException extends ClientException {\n+\n+  public PartitionNotFoundException(final int partitionId) {\n+    super(String.format(\"Unknown partition '%d'\", partitionId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d2b13a6625178d0f04027c2c65812637661c42d"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d2b13a6625178d0f04027c2c65812637661c42d", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5d2b13a6625178d0f04027c2c65812637661c42d", "committedDate": "2020-03-04T16:20:15Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}, "afterCommit": {"oid": "f1fd9d503050cf4be295bf252ad25f96698aa8cd", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f1fd9d503050cf4be295bf252ad25f96698aa8cd", "committedDate": "2020-03-05T08:39:00Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjE2MDEz", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#pullrequestreview-369216013", "createdAt": "2020-03-05T00:12:16Z", "commit": {"oid": "87829645f02a581f72aadcf855696d9c54630e2f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMDoxMjoxNlrOFyCO1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMDoxMjoxNlrOFyCO1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwOTY4Ng==", "bodyText": "The thing about getting this back to a setVariables command (or any gRPC command from a client) is that there is no partition in the request (that the user explicitly knows about), so the error message doesn't point them toward the cause.\nSuggested text: super(String.format(\"This command refers to an element that doesn't exist. The request targeted an element on partition '%d', which cannot be found in the cluster. Check the command arguments.\", partitionId));", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388009686", "createdAt": "2020-03-05T00:12:16Z", "author": {"login": "jwulf"}, "path": "gateway/src/main/java/io/zeebe/gateway/cmd/PartitionNotFoundException.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.gateway.cmd;\n+\n+/**\n+ * Represents an exceptional error that occurs when a partition can not be found. For example this\n+ * can happen when the element instance key does not refer to a known partition.\n+ */\n+public class PartitionNotFoundException extends ClientException {\n+\n+  public PartitionNotFoundException(final int partitionId) {\n+    super(String.format(\"Unknown partition '%d'\", partitionId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87829645f02a581f72aadcf855696d9c54630e2f"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1fd9d503050cf4be295bf252ad25f96698aa8cd", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f1fd9d503050cf4be295bf252ad25f96698aa8cd", "committedDate": "2020-03-05T08:39:00Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}, "afterCommit": {"oid": "bb978a3687f040d80adfb97c9847ce365820f265", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/bb978a3687f040d80adfb97c9847ce365820f265", "committedDate": "2020-03-05T11:01:39Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb978a3687f040d80adfb97c9847ce365820f265", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/bb978a3687f040d80adfb97c9847ce365820f265", "committedDate": "2020-03-05T11:01:39Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}, "afterCommit": {"oid": "e3ed6d47913b4d6be46fb516cf820af44cc0b9cf", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/e3ed6d47913b4d6be46fb516cf820af44cc0b9cf", "committedDate": "2020-03-05T12:54:40Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzE2MzY3", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#pullrequestreview-369716367", "createdAt": "2020-03-05T16:23:23Z", "commit": {"oid": "e3ed6d47913b4d6be46fb516cf820af44cc0b9cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cdf8ca9c06b9b890ebbe5f90e62e31958824e49", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/6cdf8ca9c06b9b890ebbe5f90e62e31958824e49", "committedDate": "2020-03-06T09:25:55Z", "message": "fix(gateway): respond NOT_FOUND when partition not found\n\nWhen a request from a client refers to an elementInstanceKey that does\nnot encapsulate a partition (or encapsulates a non-existing partition),\nthen the gateway now responds with NOT_FOUND.\n\nIt simply checks that the partitionId is part of the known partitions of\nthe topology."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd410301ef60c700a7255a1209baec961d6f9b5", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/7dd410301ef60c700a7255a1209baec961d6f9b5", "committedDate": "2020-03-06T10:39:00Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3ed6d47913b4d6be46fb516cf820af44cc0b9cf", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/e3ed6d47913b4d6be46fb516cf820af44cc0b9cf", "committedDate": "2020-03-05T12:54:40Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}, "afterCommit": {"oid": "7dd410301ef60c700a7255a1209baec961d6f9b5", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/7dd410301ef60c700a7255a1209baec961d6f9b5", "committedDate": "2020-03-06T10:39:00Z", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjMxMTI2", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#pullrequestreview-370231126", "createdAt": "2020-03-06T10:42:28Z", "commit": {"oid": "7dd410301ef60c700a7255a1209baec961d6f9b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDo0MjoyOVrOFy0eDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDo0MjoyOVrOFy0eDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgzMjc4MA==", "bodyText": "I reverted the removal of this method after discussing it with @npepinpe.\nThe method now only exists for a single test, but it was easier just to revert the removal of the method than to rewrite the test. A more thorough refactoring of the BrokerClient is needed anyways.", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388832780", "createdAt": "2020-03-06T10:42:29Z", "author": {"login": "korthout"}, "path": "gateway/src/main/java/io/zeebe/gateway/impl/broker/BrokerClient.java", "diffHunk": "@@ -25,6 +25,8 @@\n       BrokerResponseConsumer<T> responseConsumer,\n       Consumer<Throwable> throwableConsumer);\n \n+  <T> ActorFuture<BrokerResponse<T>> sendRequest(BrokerRequest<T> request, Duration requestTimeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dd410301ef60c700a7255a1209baec961d6f9b5"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2249513f2903b062f0046369e1ee00dc388c3d2a", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/2249513f2903b062f0046369e1ee00dc388c3d2a", "committedDate": "2020-03-10T08:22:06Z", "message": "chore(gateway): improve partition not found error message"}, "afterCommit": {"oid": "610502c23cfc704cef8aa89708ff16f8a94edf20", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/610502c23cfc704cef8aa89708ff16f8a94edf20", "committedDate": "2020-03-10T09:35:32Z", "message": "chore(gateway): improve partition not found error message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "610502c23cfc704cef8aa89708ff16f8a94edf20", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/610502c23cfc704cef8aa89708ff16f8a94edf20", "committedDate": "2020-03-10T09:35:32Z", "message": "chore(gateway): improve partition not found error message"}, "afterCommit": {"oid": "885a9a20824e49b0cce403b880d823d8245c3070", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/885a9a20824e49b0cce403b880d823d8245c3070", "committedDate": "2020-03-10T09:54:58Z", "message": "chore(gateway): improve partition not found error message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTYxMDA1", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#pullrequestreview-371961005", "createdAt": "2020-03-10T13:42:54Z", "commit": {"oid": "885a9a20824e49b0cce403b880d823d8245c3070"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "committedDate": "2020-03-10T16:57:42Z", "message": "chore(gateway): improve partition not found error message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "885a9a20824e49b0cce403b880d823d8245c3070", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/885a9a20824e49b0cce403b880d823d8245c3070", "committedDate": "2020-03-10T09:54:58Z", "message": "chore(gateway): improve partition not found error message"}, "afterCommit": {"oid": "c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "committedDate": "2020-03-10T16:57:42Z", "message": "chore(gateway): improve partition not found error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53b4b038ff5310b2e87c9b96285a526405331f5", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f53b4b038ff5310b2e87c9b96285a526405331f5", "committedDate": "2020-03-10T17:19:11Z", "message": "chore(gateway): fix test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3032, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}