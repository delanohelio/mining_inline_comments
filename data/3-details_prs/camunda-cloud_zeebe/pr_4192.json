{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2Mzc3ODg3", "number": 4192, "title": "feat(engine): ensure non-static expressions", "bodyText": "Description\n\nverify that a condition, a correlation key, and the multi-instance properties are non-static expressions to reject the deployment\nrename builder methods to distinguish static and non-static expressions:\n\ncondition() to conditionExpression()\nzeebeCorrelationKey() to zeebeCorrelationKeyExpression()\nzeebeInputCollection() to zeebeInputCollectionExpression()\nzeebeOutputElement() to zeebeOutputElementExpression()\n\n\n\nRelated issues\ncloses #4048\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-03-31T14:33:12Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4192", "merged": true, "mergeCommit": {"oid": "b8272cea0ff89f4133b8c368992cf6d72abc96e8"}, "closed": true, "closedAt": "2020-04-01T10:50:27Z", "author": {"login": "saig0"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTFLoCAFqTM4NDgxNTEyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTUlvXABqjMxODcxMDM2NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODE1MTI5", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#pullrequestreview-384815129", "createdAt": "2020-03-31T14:52:59Z", "commit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNDo1MzowMFrOF-ZxSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNTozMjo1OFrOF-br5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk3ODI0OQ==", "bodyText": "Shouldn't there be an asZeebeExpression(...) here? See e.g. AbstractFlowNodeBuilder.confitionExpression() as example.\nIf this is intentional, it is at least confusing", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400978249", "createdAt": "2020-03-31T14:53:00Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/main/java/io/zeebe/model/bpmn/builder/AbstractCatchEventBuilder.java", "diffHunk": "@@ -187,8 +187,8 @@ public ConditionalEventDefinitionBuilder conditionalEventDefinition(final String\n   }\n \n   @Override\n-  public B condition(final String condition) {\n-    conditionalEventDefinition().condition(condition);\n+  public B conditionExpression(final String conditionExpression) {\n+    conditionalEventDefinition().condition(conditionExpression);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4MjMxMw==", "bodyText": "maybe rename to inputCollectionExpression to follow the naming convention used elsewhere", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400982313", "createdAt": "2020-03-31T14:58:08Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/main/java/io/zeebe/model/bpmn/builder/AbstractMultiInstanceLoopCharacteristicsBuilder.java", "diffHunk": "@@ -93,10 +93,14 @@ public B completionCondition(final String expression) {\n   public B zeebeInputCollection(final String inputCollection) {\n     final ZeebeLoopCharacteristics characteristics =\n         getCreateSingleExtensionElement(ZeebeLoopCharacteristics.class);\n-    characteristics.setInputCollection(asZeebeExpression(inputCollection));\n+    characteristics.setInputCollection(inputCollection);\n     return myself;\n   }\n \n+  public B zeebeInputCollectionExpression(final String inputCollection) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4MzM1NQ==", "bodyText": "Maybe rename to outputElementExpression to follow the naming convention used elsewhere", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400983355", "createdAt": "2020-03-31T14:59:19Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/main/java/io/zeebe/model/bpmn/builder/AbstractMultiInstanceLoopCharacteristicsBuilder.java", "diffHunk": "@@ -114,7 +118,11 @@ public B zeebeOutputCollection(final String outputCollection) {\n   public B zeebeOutputElement(final String outputElement) {\n     final ZeebeLoopCharacteristics characteristics =\n         getCreateSingleExtensionElement(ZeebeLoopCharacteristics.class);\n-    characteristics.setOutputElement(asZeebeExpression(outputElement));\n+    characteristics.setOutputElement(outputElement);\n     return myself;\n   }\n+\n+  public B zeebeOutputElementExpression(final String outputElement) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4NDAxMA==", "bodyText": "Maybe rename to correlationKeyExpression to follow naming conventions used elsewhere", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400984010", "createdAt": "2020-03-31T15:00:08Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/main/java/io/zeebe/model/bpmn/builder/zeebe/MessageBuilder.java", "diffHunk": "@@ -31,10 +31,13 @@ public MessageBuilder name(final String name) {\n     return this;\n   }\n \n-  public MessageBuilder zeebeCorrelationKey(final String zeebeCorrelationKey) {\n+  public MessageBuilder zeebeCorrelationKey(final String correlationKey) {\n     final ZeebeSubscription subscription = getCreateSingleExtensionElement(ZeebeSubscription.class);\n-\n-    subscription.setCorrelationKey(asZeebeExpression(zeebeCorrelationKey));\n+    subscription.setCorrelationKey(correlationKey);\n     return this;\n   }\n+\n+  public MessageBuilder zeebeCorrelationKeyExpression(final String correlationKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4ODc5MA==", "bodyText": "Not sure what to make of this.\nTEST_CONDITION =\"${true}\";\nDoesn't look like a FEEL expression to me. Might be a Json Path expression, but I thought we got rid of those?\nIf it is an expression, please rename the constant.", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400988790", "createdAt": "2020-03-31T15:06:20Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/test/java/io/zeebe/model/bpmn/builder/ProcessBuilderTest.java", "diffHunk": "@@ -1832,7 +1832,7 @@ public void testIntermediateConditionalEventDefinitionShortCut() {\n         Bpmn.createProcess()\n             .startEvent()\n             .intermediateCatchEvent(CATCH_ID)\n-            .condition(TEST_CONDITION)\n+            .conditionExpression(TEST_CONDITION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5MDk3Nw==", "bodyText": "Also, BpmnTestConstantscould use some culling. My IDE tells me that many constants are not used anywhere", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400990977", "createdAt": "2020-03-31T15:09:13Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/test/java/io/zeebe/model/bpmn/builder/ProcessBuilderTest.java", "diffHunk": "@@ -1832,7 +1832,7 @@ public void testIntermediateConditionalEventDefinitionShortCut() {\n         Bpmn.createProcess()\n             .startEvent()\n             .intermediateCatchEvent(CATCH_ID)\n-            .condition(TEST_CONDITION)\n+            .conditionExpression(TEST_CONDITION)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4ODc5MA=="}, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5ODg5Nw==", "bodyText": "This looks like a path expression to me. If we FEELify it, it will become =$.id which seems nonsensical; same for $.orderID which comes next", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r400998897", "createdAt": "2020-03-31T15:19:24Z", "author": {"login": "pihme"}, "path": "bpmn-model/src/test/java/io/zeebe/model/bpmn/validation/ZeebeValidationTest.java", "diffHunk": "@@ -89,11 +89,11 @@\n             .startEvent()\n             .serviceTask(\"task\", b -> b.zeebeJobType(\"type\"))\n             .boundaryEvent(\"msg1\")\n-            .message(m -> m.name(\"message\").zeebeCorrelationKey(\"$.id\"))\n+            .message(m -> m.name(\"message\").zeebeCorrelationKeyExpression(\"$.id\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTAwOTYzNw==", "bodyText": "Optional comment:\nThe naming is a bit inconvenient, in my mind.\nFIrst the \"NonStatic\" It would be nice to have a positive variant, like \"DynamicExpression\" or something like that. But I cannot really come up with a good name. And \"Dynamic\" does not really cut it.\nThe second issue is the naming of hasValidNonStatic vs. hasValidNonStaticIfPresent. Here you could use hasValidMandatoryNonStaticExpression vs. hasValidOptionalNonStaticExpression which captures the semantics better, in my mind. It's more of a preference, though", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r401009637", "createdAt": "2020-03-31T15:32:58Z", "author": {"login": "pihme"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/validation/ZeebeExpressionValidator.java", "diffHunk": "@@ -142,10 +133,16 @@ public Builder(final Class<T> elementType) {\n       return this;\n     }\n \n-    public Builder<T> hasValidExpressionIfPresent(final Function<T, String> expressionSupplier) {\n+    public Builder<T> hasValidNonStaticExpressionIfPresent(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33068cbe6c092c83fddf840b913654cad9c3e7e2"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MzQyMzgy", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#pullrequestreview-385342382", "createdAt": "2020-04-01T07:52:34Z", "commit": {"oid": "c8720cffcfe7b885c2c2faa9e6f7be162d419212"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwNzo1MjozNFrOF-0zAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwODowOToxNVrOF-1XfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQyMTA1OA==", "bodyText": "I find it confusing because it sounds like a getter, but works like a setter. Consider renaming to asNonStatic() or makeNonStatic() or (my preference) just nonStatic()", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r401421058", "createdAt": "2020-04-01T07:52:34Z", "author": {"login": "pihme"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/validation/ZeebeExpressionValidator.java", "diffHunk": "@@ -165,6 +109,53 @@ public Builder(final Class<T> elementType) {\n     }\n   }\n \n+  public static final class ExpressionVerification {\n+\n+    private boolean isNonStatic = false;\n+    private boolean isMandatory = true;\n+\n+    public ExpressionVerification isNonStatic() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8720cffcfe7b885c2c2faa9e6f7be162d419212"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQyMjg0MA==", "bodyText": "Hmm, nice. I admit it looks very elegant.\nBut it is still deceiving. The variable name expression is misleading, because it is an expressionVerification", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r401422840", "createdAt": "2020-04-01T07:55:50Z", "author": {"login": "pihme"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/validation/ZeebeRuntimeValidators.java", "diffHunk": "@@ -24,30 +24,50 @@\n   public static final Collection<ModelElementValidator<?>> getValidators(\n       final ExpressionLanguage expressionLanguage) {\n     return List.of(\n+        // ----------------------------------------\n         ZeebeExpressionValidator.verifyThat(ZeebeInput.class)\n-            .hasValidNonStaticExpression(ZeebeInput::getSource)\n+            .hasValidExpression(\n+                ZeebeInput::getSource, expression -> expression.isNonStatic().isMandatory())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8720cffcfe7b885c2c2faa9e6f7be162d419212"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQyNDYxNA==", "bodyText": "I would rather expect the default to be false. This way you can have lenient defaults, which you then narrow down with the other methods.", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r401424614", "createdAt": "2020-04-01T07:58:49Z", "author": {"login": "pihme"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/validation/ZeebeExpressionValidator.java", "diffHunk": "@@ -165,6 +109,53 @@ public Builder(final Class<T> elementType) {\n     }\n   }\n \n+  public static final class ExpressionVerification {\n+\n+    private boolean isNonStatic = false;\n+    private boolean isMandatory = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8720cffcfe7b885c2c2faa9e6f7be162d419212"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQyNTQ0NQ==", "bodyText": "Ok, I now saw how it looks when you use it. Very elegant, but somewhat misleading, see my other comment on ZeebeRuntimeValidators", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r401425445", "createdAt": "2020-04-01T08:00:20Z", "author": {"login": "pihme"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/validation/ZeebeExpressionValidator.java", "diffHunk": "@@ -165,6 +109,53 @@ public Builder(final Class<T> elementType) {\n     }\n   }\n \n+  public static final class ExpressionVerification {\n+\n+    private boolean isNonStatic = false;\n+    private boolean isMandatory = true;\n+\n+    public ExpressionVerification isNonStatic() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQyMTA1OA=="}, "originalCommit": {"oid": "c8720cffcfe7b885c2c2faa9e6f7be162d419212"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQzMDM5Ng==", "bodyText": "Hmm, I am at two minds about this.\nFirst thought is that the chain isMandatory().isOptional() is nonsensical. If the defaults are lenient, then you could omit this method and all methods are only to deviate from the defaults.\nSecond thought is that I like to have methods which reflect the defaults. This allows to make it explicit at the point where you use this class. Then, the counterpart to isNonStatic() is missing.\nThird thought is maybe we get rid of the defaults and set them explicitly in the constructor and then we have two factory methods to create optional/mandatory ExpressionVerification factory methods. Then the API could be used like this:\n        ZeebeExpressionValidator.verifyThat(ZeebeInput.class)\n            .hasValidExpression(\n                ZeebeInput::getSource, ExprssionVerification.mandatory().nonStatic())", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#discussion_r401430396", "createdAt": "2020-04-01T08:09:15Z", "author": {"login": "pihme"}, "path": "engine/src/main/java/io/zeebe/engine/processor/workflow/deployment/model/validation/ZeebeExpressionValidator.java", "diffHunk": "@@ -165,6 +109,53 @@ public Builder(final Class<T> elementType) {\n     }\n   }\n \n+  public static final class ExpressionVerification {\n+\n+    private boolean isNonStatic = false;\n+    private boolean isMandatory = true;\n+\n+    public ExpressionVerification isNonStatic() {\n+      isNonStatic = true;\n+      return this;\n+    }\n+\n+    public ExpressionVerification isMandatory() {\n+      isMandatory = true;\n+      return this;\n+    }\n+\n+    public ExpressionVerification isOptional() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8720cffcfe7b885c2c2faa9e6f7be162d419212"}, "originalPosition": 112}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NDIzMTA4", "url": "https://github.com/camunda-cloud/zeebe/pull/4192#pullrequestreview-385423108", "createdAt": "2020-04-01T09:41:12Z", "commit": {"oid": "8da0ac694a1d5370a82f47673468bd652ab0a4be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb0a37de917e29f19adb90d59730ba5a87bd5bfc", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/cb0a37de917e29f19adb90d59730ba5a87bd5bfc", "committedDate": "2020-04-01T09:49:43Z", "message": "feat(engine): ensure non-static expressions\n\n* verify that a condition, a correlation key and the multi-instance properties are non-static expressions to reject the deployment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8da0ac694a1d5370a82f47673468bd652ab0a4be", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8da0ac694a1d5370a82f47673468bd652ab0a4be", "committedDate": "2020-04-01T08:59:25Z", "message": "chore(bpmn-model): apply review hint"}, "afterCommit": {"oid": "cb0a37de917e29f19adb90d59730ba5a87bd5bfc", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/cb0a37de917e29f19adb90d59730ba5a87bd5bfc", "committedDate": "2020-04-01T09:49:43Z", "message": "feat(engine): ensure non-static expressions\n\n* verify that a condition, a correlation key and the multi-instance properties are non-static expressions to reject the deployment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2958, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}