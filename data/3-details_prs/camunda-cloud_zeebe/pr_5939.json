{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4OTMwODY1", "number": 5939, "title": "Ignore DebugLogExporter if ZEEEB_DEBUG is false", "bodyText": "Description\nThis PR ensures the DebugLogExporter is only enabled iff ZEEBE_DEBUG==true.\nRelated issues\ncloses #5695\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions. You can trigger a backport by assigning labels (e.g. backport stable/0.25) to the PR, in case that fails you need to create backports manually.\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-11-28T10:46:22Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5939", "merged": true, "mergeCommit": {"oid": "748118fec80014fce870849882f5822b6d8f3dd1"}, "closed": true, "closedAt": "2020-11-30T18:24:10Z", "author": {"login": "npepinpe"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhhqrQgFqTU0MDcxMDgwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhoQ5uABqjQwNTI5NDczMjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNzEwODAw", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#pullrequestreview-540710800", "createdAt": "2020-11-30T09:04:41Z", "commit": {"oid": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowNDo0MVrOH7xgng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowOTo0NVrOH7xr3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzOTE5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void shouldDisableDebugLogExporter() {\n          \n          \n            \n              public void shouldNotRegisterDebugLogExporter() {", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532439198", "createdAt": "2020-11-30T09:04:41Z", "author": {"login": "pihme"}, "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -240,16 +240,20 @@ public void shouldEnableDebugLogExporter() {\n     environment.put(ENV_DEBUG_EXPORTER, \"true\");\n \n     // then\n-    assertDefaultDebugLogExporter(false);\n+    assertDefaultDebugLogExporter();\n   }\n \n   @Test\n-  public void shouldEnableDebugLogExporterWithPrettyOption() {\n+  public void shouldDisableDebugLogExporter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MDczMA==", "bodyText": "Is it deliberate that the literal is used here? (as opposed to using DebugLogExporter.defaultConfig();", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532440730", "createdAt": "2020-11-30T09:07:23Z", "author": {"login": "pihme"}, "path": "broker/src/test/java/io/zeebe/broker/test/EmbeddedBrokerConfigurator.java", "diffHunk": "@@ -20,7 +20,7 @@\n public final class EmbeddedBrokerConfigurator {\n \n   public static final Consumer<BrokerCfg> DEBUG_EXPORTER =\n-      cfg -> cfg.getExporters().put(\"DebugLogExporter\", DebugLogExporter.defaultConfig(false));\n+      cfg -> cfg.getExporters().put(\"DebugLogExporter\", DebugLogExporter.defaultConfig());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MjA3Nw==", "bodyText": "Is there a test case that verifies the debug exporter is not enabled if the environment variable doesn't exist?", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532442077", "createdAt": "2020-11-30T09:09:45Z", "author": {"login": "pihme"}, "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -240,16 +240,20 @@ public void shouldEnableDebugLogExporter() {\n     environment.put(ENV_DEBUG_EXPORTER, \"true\");\n \n     // then\n-    assertDefaultDebugLogExporter(false);\n+    assertDefaultDebugLogExporter();\n   }\n \n   @Test\n-  public void shouldEnableDebugLogExporterWithPrettyOption() {\n+  public void shouldDisableDebugLogExporter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwOTQ1OTU3", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#pullrequestreview-540945957", "createdAt": "2020-11-30T14:14:49Z", "commit": {"oid": "b8db10bf46c8d15a207efd42c45cf9ddfa1328b8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNDo0OVrOH789Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNDo0OVrOH789Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyNjc1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private void assertDefaultDebugLogExporter() {\n          \n          \n            \n              private void assertDebugLogExporterRegistered() {\n          \n      \n    \n    \n  \n\nThe name is confusing. In line 262  public void shouldHaveNoExportersByDefault() { we test for having no exporter by default.\nHere, with the name Default in it we would be testing that there is an exporter registered. But the only place we call it from is not a vanilla default configuration.", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532626751", "createdAt": "2020-11-30T14:14:49Z", "author": {"login": "pihme"}, "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -836,13 +847,13 @@ private void assertEmbeddedGatewayEnabled(final String configFileName, final boo\n     assertThat(gatewayCfg.isEnable()).isEqualTo(enabled);\n   }\n \n-  private void assertDefaultDebugLogExporter(final boolean prettyPrint) {\n-    assertDebugLogExporter(\"default\", prettyPrint);\n-    assertDebugLogExporter(\"empty\", prettyPrint);\n+  private void assertDefaultDebugLogExporter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8db10bf46c8d15a207efd42c45cf9ddfa1328b8"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDg3MjIw", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#pullrequestreview-541087220", "createdAt": "2020-11-30T16:38:21Z", "commit": {"oid": "a5b44cf930b9ad543b776d044a97b93891bd5067"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjozODoyMlrOH8Dkdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjozODoyMlrOH8Dkdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjczNTA5NA==", "bodyText": "This could be renamed:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private void assertWithDefaultConfiguration(\n          \n          \n            \n              private void assertWithConfiguration(", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532735094", "createdAt": "2020-11-30T16:38:22Z", "author": {"login": "pihme"}, "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -892,4 +892,15 @@ private void assertSystemClusterConfiguration(\n     assertThat(cfgCluster.getClusterSize()).isEqualTo(clusterSize);\n     assertThat(cfgCluster.getInitialContactPoints()).isEqualTo(initialContactPoints);\n   }\n+\n+  private void assertWithDefaultConfigurations(final Consumer<BrokerCfg> assertions) {\n+    Stream.of(\"default\", \"empty\")\n+        .forEach(configFileName -> assertWithDefaultConfiguration(assertions, configFileName));\n+  }\n+\n+  private void assertWithDefaultConfiguration(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5b44cf930b9ad543b776d044a97b93891bd5067"}, "originalPosition": 77}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7f8448a41d14f240cb266e1b717c1c66fc2b266", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b7f8448a41d14f240cb266e1b717c1c66fc2b266", "committedDate": "2020-11-30T16:41:35Z", "message": "chore(broker): rename method to be more descriptive\n\nCo-authored-by: Peter Ihme <pihme@users.noreply.github.com>"}, "afterCommit": {"oid": "a8c53c9b484a45e704c9fb6a2981d861648da8e0", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a8c53c9b484a45e704c9fb6a2981d861648da8e0", "committedDate": "2020-11-30T16:42:19Z", "message": "chore(broker): ignore debug log exporter if false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5421d5be487fa5d78b6992fe29036b890c5be6e8", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5421d5be487fa5d78b6992fe29036b890c5be6e8", "committedDate": "2020-11-30T16:51:11Z", "message": "chore(broker): ignore debug log exporter if false"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8c53c9b484a45e704c9fb6a2981d861648da8e0", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a8c53c9b484a45e704c9fb6a2981d861648da8e0", "committedDate": "2020-11-30T16:42:19Z", "message": "chore(broker): ignore debug log exporter if false"}, "afterCommit": {"oid": "5421d5be487fa5d78b6992fe29036b890c5be6e8", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5421d5be487fa5d78b6992fe29036b890c5be6e8", "committedDate": "2020-11-30T16:51:11Z", "message": "chore(broker): ignore debug log exporter if false"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2290, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}