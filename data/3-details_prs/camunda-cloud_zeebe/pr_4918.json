{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODAyNzgw", "number": 4918, "title": "Propagate message variables from event subprocess", "bodyText": "Description\n\nthe message variables were not propagated because they were stored as temporary variables of the scope of the event subprocess instead of its start event\ncopy the temporary variable to the start event scope to apply them with the output mapping\nfix the existing message mapping test to verify the correct behavior\n\nRelated issues\ncloses #4884\ncloses #3930\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release annoncement", "createdAt": "2020-07-09T11:35:17Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4918", "merged": true, "mergeCommit": {"oid": "54b84f4b31c4c5b89bd74f824bc0f445c44ac014"}, "closed": true, "closedAt": "2020-07-13T14:19:55Z", "author": {"login": "saig0"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczN_XiAH2gAyNDQ2ODAyNzgwOjhjYWE3MDNiYWIzNWE1ZjA2OGU1OWM3ODcyMmY5ZGQ4ZDM2ZTdkZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0hV-kgFqTQ0NzI0MzI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8caa703bab35a5f068e59c78722f9dd8d36e7ddb", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8caa703bab35a5f068e59c78722f9dd8d36e7ddb", "committedDate": "2020-07-09T12:14:12Z", "message": "fix(broker): variable propagation for event subprocess\n\n* the message variables were not propagated because they were stored as temporary variables of the scope of the event subprocess instead of its start event\n* copy the temporary variable to the start event scope to apply them with the output mapping\n* fix the existing message mapping test by setting the output mapping on the start event instead of the event subprocess"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48779c0f83afabc83dbda5bae57e9dd70bddf633", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/48779c0f83afabc83dbda5bae57e9dd70bddf633", "committedDate": "2020-07-09T11:27:18Z", "message": "fix(broker): variable propagation for event subprocess\n\n* the message variables were not propagated because they were stored as temporary variables of the scope of the event subprocess instead of its start event\n* copy the temporary variable to the start event scope to apply them with the output mapping"}, "afterCommit": {"oid": "8caa703bab35a5f068e59c78722f9dd8d36e7ddb", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8caa703bab35a5f068e59c78722f9dd8d36e7ddb", "committedDate": "2020-07-09T12:14:12Z", "message": "fix(broker): variable propagation for event subprocess\n\n* the message variables were not propagated because they were stored as temporary variables of the scope of the event subprocess instead of its start event\n* copy the temporary variable to the start event scope to apply them with the output mapping\n* fix the existing message mapping test by setting the output mapping on the start event instead of the event subprocess"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MTg0MTQ0", "url": "https://github.com/camunda-cloud/zeebe/pull/4918#pullrequestreview-447184144", "createdAt": "2020-07-13T11:58:41Z", "commit": {"oid": "8caa703bab35a5f068e59c78722f9dd8d36e7ddb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTo1ODo0MlrOGwlbbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTo1ODo0MlrOGwlbbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5ODA2MA==", "bodyText": "Do we remove the variables from the event subprocess so the process that's inside it propagates its variables up when it's completed?", "url": "https://github.com/camunda-cloud/zeebe/pull/4918#discussion_r453598060", "createdAt": "2020-07-13T11:58:42Z", "author": {"login": "MiguelPires"}, "path": "engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateBehavior.java", "diffHunk": "@@ -225,4 +225,16 @@ public void propagateTemporaryVariables(\n         variablesState.getVariablesAsDocument(sourceContext.getElementInstanceKey());\n     variablesState.setTemporaryVariables(targetContext.getElementInstanceKey(), variables);\n   }\n+\n+  public void transferTemporaryVariables(\n+      final BpmnElementContext sourceContext, final long targetElementInstanceKey) {\n+\n+    final var variables =\n+        variablesState.getTemporaryVariables(sourceContext.getElementInstanceKey());\n+\n+    if (variables != null) {\n+      variablesState.setTemporaryVariables(targetElementInstanceKey, variables);\n+      variablesState.removeTemporaryVariables(sourceContext.getElementInstanceKey());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8caa703bab35a5f068e59c78722f9dd8d36e7ddb"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MjQzMjQw", "url": "https://github.com/camunda-cloud/zeebe/pull/4918#pullrequestreview-447243240", "createdAt": "2020-07-13T13:21:01Z", "commit": {"oid": "8caa703bab35a5f068e59c78722f9dd8d36e7ddb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2678, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}