{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NzM1MTgx", "number": 5937, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo1OToyMVrOE-mbqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMzozMjoxMlrOE_nr3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDc2ODQwOnYy", "diffSide": "RIGHT", "path": ".ci/scripts/distribution/it-java.sh", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo1OToyMVrOH716tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMjoxNzozOVrOH74lVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMTQxMw==", "bodyText": "Can you explain this statement a bit? AFAIK it reads like:\nLIMITS_CPU is whatever you define or defaults to getconf _NPROCESSORS_ONLN\nbut what is this config?", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532511413", "createdAt": "2020-11-30T10:59:21Z", "author": {"login": "korthout"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -1,13 +1,19 @@\n #!/bin/bash -eux\n \n-\n-export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -XX:MaxRAMFraction=$((LIMITS_CPU))\"\n-\n+LIMITS_CPU=${LIMITS_CPU:-$(getconf _NPROCESSORS_ONLN)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyMTE4Ng==", "bodyText": "$(getconf _NPROCESSORS_ONLN) returns the number of processors available in a POSIX compliant way. If LIMITS_CPU isn't set, then this is the value we assign. I'm happy to omit it, which keeps the behaviour as before - it breaks if undefined :)", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532521186", "createdAt": "2020-11-30T11:16:15Z", "author": {"login": "npepinpe"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -1,13 +1,19 @@\n #!/bin/bash -eux\n \n-\n-export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -XX:MaxRAMFraction=$((LIMITS_CPU))\"\n-\n+LIMITS_CPU=${LIMITS_CPU:-$(getconf _NPROCESSORS_ONLN)}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMTQxMw=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU1MzY4MQ==", "bodyText": "Just leave it as is, I'm just unfamiliar with this config property.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532553681", "createdAt": "2020-11-30T12:15:04Z", "author": {"login": "korthout"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -1,13 +1,19 @@\n #!/bin/bash -eux\n \n-\n-export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -XX:MaxRAMFraction=$((LIMITS_CPU))\"\n-\n+LIMITS_CPU=${LIMITS_CPU:-$(getconf _NPROCESSORS_ONLN)}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMTQxMw=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU1NTA5Mw==", "bodyText": "Yeah it looks weird, but it's the only POSIX way I know of getting the cpu count (which also works on MacOS ;))", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532555093", "createdAt": "2020-11-30T12:17:39Z", "author": {"login": "npepinpe"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -1,13 +1,19 @@\n #!/bin/bash -eux\n \n-\n-export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -XX:MaxRAMFraction=$((LIMITS_CPU))\"\n-\n+LIMITS_CPU=${LIMITS_CPU:-$(getconf _NPROCESSORS_ONLN)}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMTQxMw=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDc3NDQ1OnYy", "diffSide": "RIGHT", "path": ".ci/scripts/distribution/it-java.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTowMDo0M1rOH71-Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMToxNzoxMVrOH72jAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMjMyNg==", "bodyText": "Perhaps we should just default this explicitly to 1", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532512326", "createdAt": "2020-11-30T11:00:43Z", "author": {"login": "korthout"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -1,13 +1,19 @@\n #!/bin/bash -eux\n \n-\n-export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -XX:MaxRAMFraction=$((LIMITS_CPU))\"\n-\n+LIMITS_CPU=${LIMITS_CPU:-$(getconf _NPROCESSORS_ONLN)}\n+FORK_COUNT=${FORK_COUNT:-}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyMTcyOQ==", "bodyText": "That's different behaviour though. Right now, this is set up so you can override whatever's defined in the POM - if we explicitly set to 1, then we always override it, which I don't know if we really want to do. I think ignoring it if unset is a little more intuitive in my opinion.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532521729", "createdAt": "2020-11-30T11:17:11Z", "author": {"login": "npepinpe"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -1,13 +1,19 @@\n #!/bin/bash -eux\n \n-\n-export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -XX:MaxRAMFraction=$((LIMITS_CPU))\"\n-\n+LIMITS_CPU=${LIMITS_CPU:-$(getconf _NPROCESSORS_ONLN)}\n+FORK_COUNT=${FORK_COUNT:-}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMjMyNg=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDc4MzYwOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTowMzoyMVrOH72D7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMjoxNjo1NVrOH74j0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMzc3NA==", "bodyText": "Let's also set FORK_COUNT = 2  or so, currently this PR seems to slow down the IT by a lot.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532513774", "createdAt": "2020-11-30T11:03:21Z", "author": {"login": "korthout"}, "path": "Jenkinsfile", "diffHunk": "@@ -215,6 +216,7 @@ pipeline {\n                         stage('Test') {\n                             environment {\n                                 SUREFIRE_REPORT_NAME_SUFFIX = 'it-testrun'\n+                                LIMITS_CPU = 2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyMjIzNA==", "bodyText": "I'm confused how it could affect it at all - there's only two modules, so lowering the limits here shouldn't matter - it can still only process two modules in parallel \ud83e\udd14", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532522234", "createdAt": "2020-11-30T11:18:10Z", "author": {"login": "npepinpe"}, "path": "Jenkinsfile", "diffHunk": "@@ -215,6 +216,7 @@ pipeline {\n                         stage('Test') {\n                             environment {\n                                 SUREFIRE_REPORT_NAME_SUFFIX = 'it-testrun'\n+                                LIMITS_CPU = 2", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMzc3NA=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyMjUxNg==", "bodyText": "It takes 20 minutes to process the IT stage because the update tests take 20 minutes. This is independent of this PR \ud83d\ude42", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532522516", "createdAt": "2020-11-30T11:18:44Z", "author": {"login": "npepinpe"}, "path": "Jenkinsfile", "diffHunk": "@@ -215,6 +216,7 @@ pipeline {\n                         stage('Test') {\n                             environment {\n                                 SUREFIRE_REPORT_NAME_SUFFIX = 'it-testrun'\n+                                LIMITS_CPU = 2", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMzc3NA=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU1NDcwNQ==", "bodyText": "Ah, I missed that. But that's totally fine then. I didn't consider that the default fork count from the pom would be used. Let's leave it like this.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r532554705", "createdAt": "2020-11-30T12:16:55Z", "author": {"login": "korthout"}, "path": "Jenkinsfile", "diffHunk": "@@ -215,6 +216,7 @@ pipeline {\n                         stage('Test') {\n                             environment {\n                                 SUREFIRE_REPORT_NAME_SUFFIX = 'it-testrun'\n+                                LIMITS_CPU = 2", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUxMzc3NA=="}, "originalCommit": {"oid": "d4fad77038837cefdf8fbeef5bfeab9740b9fc04"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MTQ1OTUwOnYy", "diffSide": "RIGHT", "path": ".ci/scripts/distribution/it-java.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMzozMjoxMlrOH9bCyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMzozNDo0MFrOH9bI9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE2ODI2NA==", "bodyText": "@npepinpe don't forget this change then for the other scripts.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r534168264", "createdAt": "2020-12-02T13:32:12Z", "author": {"login": "korthout"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -17,7 +29,7 @@ if grep -q \"\\[WARNING\\] Flakes:\" ${tmpfile}; then\n \n   awk '/^\\[WARNING\\] Flakes:.*$/{flag=1}/^\\[ERROR\\] Tests run:.*Flakes: [0-9]*$/{print;flag=0}flag' ${tmpfile} > ${tmpfile2}\n \n-  grep \"\\[ERROR\\]   Run 1: \" ${tmpfile} | awk '{print $4}' >> ./target/FlakyTests.txt\n+  grep \"\\[ERROR\\]   Run 1: \" ${tmpfile2} | awk '{print $4}' >> FlakyTests.txt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebd7d60f1c2c2d53a4ed06e0c1f8c2348262cdfa"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE2OTQwNA==", "bodyText": "I think on the main agent it doesn't fail because we build the root project, whereas on the IT we only build specific modules, but I can gladly change it.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r534169404", "createdAt": "2020-12-02T13:34:01Z", "author": {"login": "npepinpe"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -17,7 +29,7 @@ if grep -q \"\\[WARNING\\] Flakes:\" ${tmpfile}; then\n \n   awk '/^\\[WARNING\\] Flakes:.*$/{flag=1}/^\\[ERROR\\] Tests run:.*Flakes: [0-9]*$/{print;flag=0}flag' ${tmpfile} > ${tmpfile2}\n \n-  grep \"\\[ERROR\\]   Run 1: \" ${tmpfile} | awk '{print $4}' >> ./target/FlakyTests.txt\n+  grep \"\\[ERROR\\]   Run 1: \" ${tmpfile2} | awk '{print $4}' >> FlakyTests.txt", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE2ODI2NA=="}, "originalCommit": {"oid": "ebd7d60f1c2c2d53a4ed06e0c1f8c2348262cdfa"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE2OTg0NA==", "bodyText": "You can confirm this by removing your ./target folder from your build and running verify for specific modules, it won't build it. But if you run for the project it will appear. Why it was however sometimes appearing for IT as well is a mystery to me.", "url": "https://github.com/camunda-cloud/zeebe/pull/5937#discussion_r534169844", "createdAt": "2020-12-02T13:34:40Z", "author": {"login": "npepinpe"}, "path": ".ci/scripts/distribution/it-java.sh", "diffHunk": "@@ -17,7 +29,7 @@ if grep -q \"\\[WARNING\\] Flakes:\" ${tmpfile}; then\n \n   awk '/^\\[WARNING\\] Flakes:.*$/{flag=1}/^\\[ERROR\\] Tests run:.*Flakes: [0-9]*$/{print;flag=0}flag' ${tmpfile} > ${tmpfile2}\n \n-  grep \"\\[ERROR\\]   Run 1: \" ${tmpfile} | awk '{print $4}' >> ./target/FlakyTests.txt\n+  grep \"\\[ERROR\\]   Run 1: \" ${tmpfile2} | awk '{print $4}' >> FlakyTests.txt", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE2ODI2NA=="}, "originalCommit": {"oid": "ebd7d60f1c2c2d53a4ed06e0c1f8c2348262cdfa"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 78, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}