{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNjMzNDYz", "number": 4607, "title": "chore(atomix): initialize event subscriptions after listener is added", "bodyText": "Description\nWhen membership service adds the members before the cluster event registers the listener, the listener is not notified. In this case the event service cannot know about the subscriptions of that member. The test was flaky because of this bug.\nRelated issues\ncloses #4436\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-05-27T06:18:11Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4607", "merged": true, "mergeCommit": {"oid": "ae5502322691049189b8e68b00a0e2f491fdb852"}, "closed": true, "closedAt": "2020-05-28T12:00:47Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclTC4_AH2gAyNDIzNjMzNDYzOjBjMjExMDE1MGRlNTUzZTQzMTVkMGNhMjliMzgzNTJiYmZlMjkwY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclsMrWgFqTQyMDAxNzc0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0c2110150de553e4315d0ca29b38352bbfe290cb", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/0c2110150de553e4315d0ca29b38352bbfe290cb", "committedDate": "2020-05-27T06:12:38Z", "message": "chore(atomix): initialize cluster event subscriptions after listener is added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzYzMDg5", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#pullrequestreview-419763089", "createdAt": "2020-05-28T04:07:20Z", "commit": {"oid": "0c2110150de553e4315d0ca29b38352bbfe290cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDowNzoyMVrOGbk8Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDowODozN1rOGbk9dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU2OTk5MA==", "bodyText": "hm maybe we shouldn't put this to trace \ud83d\ude05", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#discussion_r431569990", "createdAt": "2020-05-28T04:07:21Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/test/resources/log4j2-test.xml", "diffHunk": "@@ -9,7 +9,7 @@\n \n   <Loggers>\n     <Logger name=\"io.zeebe\" level=\"debug\"/>\n-    <Logger name=\"io.atomix\" level=\"debug\"/>\n+    <Logger name=\"io.atomix\" level=\"trace\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2110150de553e4315d0ca29b38352bbfe290cb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MDI5NQ==", "bodyText": "might make sense to do that in the membershipService#addListener? Because this problem will also arise on other places probably furthermore the membership is in charge to do that I would say.", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#discussion_r431570295", "createdAt": "2020-05-28T04:08:37Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/main/java/io/atomix/cluster/messaging/impl/DefaultClusterEventService.java", "diffHunk": "@@ -189,6 +190,10 @@ private String topicsAsString(final Set<String> topics) {\n           Executors.newSingleThreadScheduledExecutor(\n               namedThreads(\"atomix-cluster-event-executor-%d\", LOGGER));\n       membershipService.addListener(this);\n+      // Listener doesn't receive notification about the Members added before the listener is added.\n+      membershipService\n+          .getMembers()\n+          .forEach(m -> event(new ClusterMembershipEvent(Type.MEMBER_ADDED, m)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2110150de553e4315d0ca29b38352bbfe290cb"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDE3NzQy", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#pullrequestreview-420017742", "createdAt": "2020-05-28T11:30:57Z", "commit": {"oid": "0c2110150de553e4315d0ca29b38352bbfe290cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2847, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}