{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MjMzMTc2", "number": 4660, "title": "chore(gateway): add flag to enable/disable long polling", "bodyText": "Description\nAdds a config flag gateway.longPolling.enabled (or environment variable ZEEBE_GATEWAY_LONGPOLLING_ENABLED ) to switch on/off long polling for available jobs.\nRelated issues\ncloses #4415\nChecklist\n\n add config flag\n test config flag\n use config to enable/disable long polling\n test that: given long polling disabled, when requesting to activate jobs and no jobs available, then response is instantly closed; i.e. requests are not blocked (this test assumes long polling is already sufficiently tested)\n test that: given long polling disabled, when requesting to activate jobs and jobs available, then jobs are provided in response.", "createdAt": "2020-06-03T14:16:20Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4660", "merged": true, "mergeCommit": {"oid": "3d9f6df1d3163f7f46489d9c28a7644179fc90ab"}, "closed": true, "closedAt": "2020-06-15T13:45:30Z", "author": {"login": "korthout"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp1TgTgFqTQyNzc3NDIwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrfFdpgBqjM0NDM5NzE2NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3Nzc0MjA2", "url": "https://github.com/camunda-cloud/zeebe/pull/4660#pullrequestreview-427774206", "createdAt": "2020-06-10T07:21:26Z", "commit": {"oid": "ce291433c1d819424eebc7154209147663209c07"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzoyMToyNlrOGhn8Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzozMDoyM1rOGhoOYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxMDUzNA==", "bodyText": "This should be added dist/*/config/broker.yaml.template and dist/*/config/gateway.yaml.template for documentation.", "url": "https://github.com/camunda-cloud/zeebe/pull/4660#discussion_r437910534", "createdAt": "2020-06-10T07:21:26Z", "author": {"login": "deepthidevaki"}, "path": "gateway/src/test/resources/configuration/gateway.default.yaml", "diffHunk": "@@ -106,3 +106,8 @@\n # Sets the path to the private key file location\n # This setting can also be overridden using the environment variable ZEEBE_GATEWAY_SECURITY_PRIVATEKEYPATH.\n # privateKeyPath:\n+\n+# longPolling:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce291433c1d819424eebc7154209147663209c07"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxNDIzNQ==", "bodyText": "Please remove this todo.", "url": "https://github.com/camunda-cloud/zeebe/pull/4660#discussion_r437914235", "createdAt": "2020-06-10T07:28:29Z", "author": {"login": "deepthidevaki"}, "path": "gateway/src/main/java/io/zeebe/gateway/impl/job/ActivateJobsHandlerImpl.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.gateway.impl.job;\n+\n+import io.grpc.Status.Code;\n+import io.grpc.StatusRuntimeException;\n+import io.grpc.stub.StreamObserver;\n+import io.zeebe.gateway.EndpointManager;\n+import io.zeebe.gateway.Loggers;\n+import io.zeebe.gateway.RequestMapper;\n+import io.zeebe.gateway.ResponseMapper;\n+import io.zeebe.gateway.impl.broker.BrokerClient;\n+import io.zeebe.gateway.impl.broker.cluster.BrokerClusterState;\n+import io.zeebe.gateway.impl.broker.request.BrokerActivateJobsRequest;\n+import io.zeebe.gateway.protocol.GatewayOuterClass.ActivateJobsRequest;\n+import io.zeebe.gateway.protocol.GatewayOuterClass.ActivateJobsResponse;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+\n+// todo(@korthout): improve name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce291433c1d819424eebc7154209147663209c07"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxNTIzNQ==", "bodyText": "Suggested name RoundRobinActivateJobsHandler. Also can you add a short description for this class?", "url": "https://github.com/camunda-cloud/zeebe/pull/4660#discussion_r437915235", "createdAt": "2020-06-10T07:30:23Z", "author": {"login": "deepthidevaki"}, "path": "gateway/src/main/java/io/zeebe/gateway/impl/job/ActivateJobsHandlerImpl.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.gateway.impl.job;\n+\n+import io.grpc.Status.Code;\n+import io.grpc.StatusRuntimeException;\n+import io.grpc.stub.StreamObserver;\n+import io.zeebe.gateway.EndpointManager;\n+import io.zeebe.gateway.Loggers;\n+import io.zeebe.gateway.RequestMapper;\n+import io.zeebe.gateway.ResponseMapper;\n+import io.zeebe.gateway.impl.broker.BrokerClient;\n+import io.zeebe.gateway.impl.broker.cluster.BrokerClusterState;\n+import io.zeebe.gateway.impl.broker.request.BrokerActivateJobsRequest;\n+import io.zeebe.gateway.protocol.GatewayOuterClass.ActivateJobsRequest;\n+import io.zeebe.gateway.protocol.GatewayOuterClass.ActivateJobsResponse;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+\n+// todo(@korthout): improve name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkxNDIzNQ=="}, "originalCommit": {"oid": "ce291433c1d819424eebc7154209147663209c07"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzc2MjEy", "url": "https://github.com/camunda-cloud/zeebe/pull/4660#pullrequestreview-430376212", "createdAt": "2020-06-15T07:14:57Z", "commit": {"oid": "8810161a0d940f66b1ae33865b30f6bae3411034"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb34419191698dd918db34d3eed714296f2b235b", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/fb34419191698dd918db34d3eed714296f2b235b", "committedDate": "2020-06-15T11:36:01Z", "message": "chore(gateway): add flag to enable/disable long polling\n\nThis is a combination of 7 commits (incl the 1 above):\n\nchore(gateway): enable long polling by default\n\nchore(gateway): improve longpolling flag name\n\nchore(gateway): test activate jobs with/without long polling\n\nchore(gateway): clarify naming and add documentation\n\nchore(gateway): add defaults to config templates\n\ntest(gateway): add IT to test job activation without long polling\n\nIn order to test for this, we need to set\nzeebe.broker.gateway.longPolling.enabled to false. This configuration\ncan only be changed at start-up of the broker and so this could not be\ntested in the same class as ActivateJobsTest, which was testing\nactivatejobs behavior for the default long polling enabled.\n\nSince a LongPollingDisabledActivateJobsTest seemed like a strange test,\nI've renamed ActivateJobsTest to LongPollingActivateJobsTest and created\na new ActivateJobsTest that tests it with long polling explicitly\ndisabled."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8810161a0d940f66b1ae33865b30f6bae3411034", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8810161a0d940f66b1ae33865b30f6bae3411034", "committedDate": "2020-06-12T15:26:51Z", "message": "test(gateway): add IT to test job activation without long polling\n\nIn order to test for this, we need to set\nzeebe.broker.gateway.longPolling.enabled to false. This configuration\ncan only be changed at start-up of the broker and so this could not be\ntested in the same class as ActivateJobsTest, which was testing\nactivatejobs behavior for the default long polling enabled.\n\nSince a LongPollingDisabledActivateJobsTest seemed like a strange test,\nI've renamed ActivateJobsTest to LongPollingActivateJobsTest and created\na new ActivateJobsTest that tests it with long polling explicitly\ndisabled."}, "afterCommit": {"oid": "fb34419191698dd918db34d3eed714296f2b235b", "author": {"user": {"login": "korthout", "name": "Nico Korthout"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/fb34419191698dd918db34d3eed714296f2b235b", "committedDate": "2020-06-15T11:36:01Z", "message": "chore(gateway): add flag to enable/disable long polling\n\nThis is a combination of 7 commits (incl the 1 above):\n\nchore(gateway): enable long polling by default\n\nchore(gateway): improve longpolling flag name\n\nchore(gateway): test activate jobs with/without long polling\n\nchore(gateway): clarify naming and add documentation\n\nchore(gateway): add defaults to config templates\n\ntest(gateway): add IT to test job activation without long polling\n\nIn order to test for this, we need to set\nzeebe.broker.gateway.longPolling.enabled to false. This configuration\ncan only be changed at start-up of the broker and so this could not be\ntested in the same class as ActivateJobsTest, which was testing\nactivatejobs behavior for the default long polling enabled.\n\nSince a LongPollingDisabledActivateJobsTest seemed like a strange test,\nI've renamed ActivateJobsTest to LongPollingActivateJobsTest and created\na new ActivateJobsTest that tests it with long polling explicitly\ndisabled."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2734, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}