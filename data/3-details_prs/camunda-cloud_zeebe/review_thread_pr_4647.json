{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mzg2MDc3", "number": 4647, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNTo1MFrOEBoB_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNzozMVrOEBoENg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTM5OTAyOnYy", "diffSide": "RIGHT", "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNTo1MFrOGdlRuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNTo1MFrOGdlRuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY3MjYzMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // Stop member 2 and change its version; start the new version first to ensure the removal is\n          \n          \n            \n                // when - starting a member with new version", "url": "https://github.com/camunda-cloud/zeebe/pull/4647#discussion_r433672633", "createdAt": "2020-06-02T07:25:50Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "diffHunk": "@@ -219,18 +220,28 @@ public void testSwimProtocol() throws Exception {\n     checkEvent(member1, METADATA_CHANGED, member1);\n     checkEvent(member2, METADATA_CHANGED, member1);\n     checkEvent(member3, METADATA_CHANGED, member1);\n+  }\n+\n+  @Test\n+  public void shouldRemoveOldMemberVersions() throws InterruptedException {\n+    // Start a node and check its events.\n+    startProtocol(member1);\n+    startProtocol(member2);\n+\n+    awaitMembers(member2, member1, member2);\n+    awaitMembers(member1, member1, member2);\n+\n+    clearEvents(member1, member2);\n \n-    // Stop member 3 and change its version.\n-    stopProtocol(member3);\n+    // Stop member 2 and change its version; start the new version first to ensure the removal is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1115390a9fedca44d7082996f85c3b113816b829"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTQwMDQyOnYy", "diffSide": "RIGHT", "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNjoxM1rOGdlSmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNjoxM1rOGdlSmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY3Mjg1Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // not done because reachability has changed", "url": "https://github.com/camunda-cloud/zeebe/pull/4647#discussion_r433672856", "createdAt": "2020-06-02T07:26:13Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "diffHunk": "@@ -219,18 +220,28 @@ public void testSwimProtocol() throws Exception {\n     checkEvent(member1, METADATA_CHANGED, member1);\n     checkEvent(member2, METADATA_CHANGED, member1);\n     checkEvent(member3, METADATA_CHANGED, member1);\n+  }\n+\n+  @Test\n+  public void shouldRemoveOldMemberVersions() throws InterruptedException {\n+    // Start a node and check its events.\n+    startProtocol(member1);\n+    startProtocol(member2);\n+\n+    awaitMembers(member2, member1, member2);\n+    awaitMembers(member1, member1, member2);\n+\n+    clearEvents(member1, member2);\n \n-    // Stop member 3 and change its version.\n-    stopProtocol(member3);\n+    // Stop member 2 and change its version; start the new version first to ensure the removal is\n+    // not done because reachability has changed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1115390a9fedca44d7082996f85c3b113816b829"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTQwNDcwOnYy", "diffSide": "RIGHT", "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNzozMVrOGdlVOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyNzozMVrOGdlVOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY3MzUzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // Verify that version 1 is removed and version 2 is added.\n          \n          \n            \n                // then - verify that version 1 is removed and version 2 is added.", "url": "https://github.com/camunda-cloud/zeebe/pull/4647#discussion_r433673531", "createdAt": "2020-06-02T07:27:31Z", "author": {"login": "Zelldon"}, "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "diffHunk": "@@ -219,18 +220,28 @@ public void testSwimProtocol() throws Exception {\n     checkEvent(member1, METADATA_CHANGED, member1);\n     checkEvent(member2, METADATA_CHANGED, member1);\n     checkEvent(member3, METADATA_CHANGED, member1);\n+  }\n+\n+  @Test\n+  public void shouldRemoveOldMemberVersions() throws InterruptedException {\n+    // Start a node and check its events.\n+    startProtocol(member1);\n+    startProtocol(member2);\n+\n+    awaitMembers(member2, member1, member2);\n+    awaitMembers(member1, member1, member2);\n+\n+    clearEvents(member1, member2);\n \n-    // Stop member 3 and change its version.\n-    stopProtocol(member3);\n+    // Stop member 2 and change its version; start the new version first to ensure the removal is\n+    // not done because reachability has changed\n     final Member member =\n-        member(member3.id().id(), member3.address().host(), member3.address().port(), version2);\n+        member(member2.id().id(), member2.address().host(), member2.address().port(), version2);\n     startProtocol(member);\n \n     // Verify that version 1 is removed and version 2 is added.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1115390a9fedca44d7082996f85c3b113816b829"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 481, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}