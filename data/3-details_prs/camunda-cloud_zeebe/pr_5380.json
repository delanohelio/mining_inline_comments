{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMDc1NjYz", "number": 5380, "title": "Improve flaky DiskSpaceMonitoringFailover test", "bodyText": "Description\nThe tests were failing because of two different reasons. In one, the test fails because it times out while awaiting the health status to be unhealthy. Since the health monitoring is only scans periodically with an interval of 60s, sometimes it has to wait for 60s until the condition is true. In the second case, the tests fails because it times out in waiting for the new leader to be elected. In both cases we could see in the logs that the health status became unhealthy and a new leader was elected. But the test fails because of the timing. This PR improves the test by\n\nIncrease the clock by monitoring interval to force rescan the health before awaiting the condition\nIncrease the timeout in waitForTopology as sometimes 10s is not enough to complete a new leader election.\n\nRelated issues\ncloses #5369\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-09-21T06:34:13Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5380", "merged": true, "mergeCommit": {"oid": "5b3e09f2213ef0d63199484503aa719049d97f83"}, "closed": true, "closedAt": "2020-09-21T08:57:04Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKAN3CgH2gAyNDkwMDc1NjYzOmQzOGI4M2FiMGU1ZmE2NTNjZDgwNjZjYzU5Yjc5ZTUxNWM4MGUwNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdK_LQ4AFqTQ5MjM3ODI4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d38b83ab0e5fa653cd8066cc59b79e515c80e073", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d38b83ab0e5fa653cd8066cc59b79e515c80e073", "committedDate": "2020-09-18T07:11:37Z", "message": "chore(qa): advance clock to rescan health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fec1c76528ab5b75e9d97b00a9573e0778bffc8", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/9fec1c76528ab5b75e9d97b00a9573e0778bffc8", "committedDate": "2020-09-18T13:37:26Z", "message": "chore(qa): increase timeout for waitForTopology"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzYzMTM5", "url": "https://github.com/camunda-cloud/zeebe/pull/5380#pullrequestreview-492363139", "createdAt": "2020-09-21T08:11:34Z", "commit": {"oid": "9fec1c76528ab5b75e9d97b00a9573e0778bffc8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODoxMTozNVrOHVEv7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODoxMTozNVrOHVEv7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg1OTk0OA==", "bodyText": "In some cases, this will increase the runtime of our ci pipelines. I have a feeling that many tests use this method, increasing the chance of increased duration of ci pipelines. Did you also consider alternative solutions?", "url": "https://github.com/camunda-cloud/zeebe/pull/5380#discussion_r491859948", "createdAt": "2020-09-21T08:11:35Z", "author": {"login": "korthout"}, "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/ClusteringRule.java", "diffHunk": "@@ -630,7 +630,7 @@ private void waitForNewLeaderOfPartitions(\n   public void waitForTopology(final Predicate<List<BrokerInfo>> topologyPredicate) {\n     Awaitility.await()\n         .pollInterval(Duration.ofMillis(100))\n-        .atMost(Duration.ofSeconds(10))\n+        .atMost(Duration.ofSeconds(60))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fec1c76528ab5b75e9d97b00a9573e0778bffc8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzc4Mjg5", "url": "https://github.com/camunda-cloud/zeebe/pull/5380#pullrequestreview-492378289", "createdAt": "2020-09-21T08:32:48Z", "commit": {"oid": "9fec1c76528ab5b75e9d97b00a9573e0778bffc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2507, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}