{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NDA5MjMz", "number": 4214, "title": "chore(broker): use raft thread context in state machine", "bodyText": "Description\nWhen a writer truncates, it should also reset the readers (#4197). However this operation is not thread safe. Since writers are always running on the raft thread context, it  is safer to use the readers in the state machine also in the raft thread context until we fix #4198. Note that readers in Zeebe stream processor are safe because a leader never truncates.\nRelated issues\n\ncloses #4199\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-04-02T07:41:37Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4214", "merged": true, "mergeCommit": {"oid": "85d7311d16aa049599ca5f6b8b1544abaf467b7c"}, "closed": true, "closedAt": "2020-04-02T14:39:06Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTq9kFAFqTM4NjM1MTM1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTrdOcgBqjMxOTE5NjM0NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MzUxMzU1", "url": "https://github.com/camunda-cloud/zeebe/pull/4214#pullrequestreview-386351355", "createdAt": "2020-04-02T11:53:54Z", "commit": {"oid": "db02986ad8c68ce8006f204c941c1c359b9c56fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMTo1Mzo1NFrOF_nqPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMTo1Mzo1NFrOF_nqPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI1NDM5Ng==", "bodyText": "Do we still need this one as well?", "url": "https://github.com/camunda-cloud/zeebe/pull/4214#discussion_r402254396", "createdAt": "2020-04-02T11:53:54Z", "author": {"login": "npepinpe"}, "path": "broker/src/main/java/io/zeebe/broker/clustering/atomix/ZeebeRaftStateMachine.java", "diffHunk": "@@ -64,7 +64,7 @@ public ThreadContext executor() {\n       if (index > reader.getFirstIndex()) {\n         final var future = new CompletableFuture<Void>();\n         logger.debug(\"Compacting log up from {} up to {}\", reader.getFirstIndex(), index);\n-        raft.getThreadContext().execute(() -> safeCompact(index, future));\n+        threadContext.execute(() -> safeCompact(index, future));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db02986ad8c68ce8006f204c941c1c359b9c56fc"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MzcxMzI1", "url": "https://github.com/camunda-cloud/zeebe/pull/4214#pullrequestreview-386371325", "createdAt": "2020-04-02T12:22:30Z", "commit": {"oid": "3e51ab249ba0fe96f243b7068ee86e2116569768"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b0d10a3bb7ed2537515e0f466c292b871824021", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3b0d10a3bb7ed2537515e0f466c292b871824021", "committedDate": "2020-04-02T12:28:17Z", "message": "chore(broker): use raft thread context in state machine"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e51ab249ba0fe96f243b7068ee86e2116569768", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3e51ab249ba0fe96f243b7068ee86e2116569768", "committedDate": "2020-04-02T12:16:30Z", "message": "chore(broker): update"}, "afterCommit": {"oid": "3b0d10a3bb7ed2537515e0f466c292b871824021", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3b0d10a3bb7ed2537515e0f466c292b871824021", "committedDate": "2020-04-02T12:28:17Z", "message": "chore(broker): use raft thread context in state machine"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2971, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}