{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5MDE1NzI4", "number": 5078, "title": "Improve stability of AtomixTransportTest", "bodyText": "Description\nIn CI, this test fails because it takes almost one second to send the response. The reason is not clear (maybe GC pause or the actor scheduler).\n\nincrease timeouts when waiting on a response\n\nRelated issues\ncloses #4124\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-07-30T09:31:47Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5078", "merged": true, "mergeCommit": {"oid": "826dd0e239de547b4bdf40a672c851d26cdd47b7"}, "closed": true, "closedAt": "2020-07-31T05:41:13Z", "author": {"login": "saig0"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc58oX1AFqTQ1ODI1NjIxOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6NNMaABqjM2MDY5MDc2NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjU2MjE4", "url": "https://github.com/camunda-cloud/zeebe/pull/5078#pullrequestreview-458256218", "createdAt": "2020-07-30T09:55:11Z", "commit": {"oid": "a032407d651cf9c82da09f5e259237d40f683d69"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwOTo1NToxMVrOG5cSag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwOTo1NzozMVrOG5cXTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4NTQ4Mg==", "bodyText": "It is a bit confusing why this is called retry timeout for the request timeout.", "url": "https://github.com/camunda-cloud/zeebe/pull/5078#discussion_r462885482", "createdAt": "2020-07-30T09:55:11Z", "author": {"login": "Zelldon"}, "path": "transport/src/test/java/io/zeebe/transport/impl/AtomixTransportTest.java", "diffHunk": "@@ -202,7 +205,7 @@ public void shouldFailResponseWhenRequestHandlerThrowsException() {\n     // when\n     final var requestFuture =\n         clientTransport.sendRequestWithRetry(\n-            nodeAddressSupplier, new Request(\"messageABC\"), Duration.ofSeconds(1));\n+            nodeAddressSupplier, new Request(\"messageABC\"), RETRY_TIMEOUT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a032407d651cf9c82da09f5e259237d40f683d69"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4NjE2NA==", "bodyText": "You change the behavior of some tests, might make the tests more flaky, since now you have the request timeout and latch timeout as same value.", "url": "https://github.com/camunda-cloud/zeebe/pull/5078#discussion_r462886164", "createdAt": "2020-07-30T09:56:28Z", "author": {"login": "Zelldon"}, "path": "transport/src/test/java/io/zeebe/transport/impl/AtomixTransportTest.java", "diffHunk": "@@ -260,17 +265,18 @@ public void shouldRetryAndSucceedAfterNodeIsResolved() throws InterruptedExcepti\n     final var nodeAddressRef = new AtomicReference<String>();\n     final var retryLatch = new CountDownLatch(3);\n     serverTransport.subscribe(0, new DirectlyResponder()).join();\n+\n     final var requestFuture =\n         clientTransport.sendRequestWithRetry(\n             () -> {\n               retryLatch.countDown();\n               return nodeAddressRef.get();\n             },\n             new Request(\"messageABC\"),\n-            Duration.ofSeconds(5));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a032407d651cf9c82da09f5e259237d40f683d69"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4NjczNQ==", "bodyText": "I would like to keep the request timeouts higher", "url": "https://github.com/camunda-cloud/zeebe/pull/5078#discussion_r462886735", "createdAt": "2020-07-30T09:57:31Z", "author": {"login": "Zelldon"}, "path": "transport/src/test/java/io/zeebe/transport/impl/AtomixTransportTest.java", "diffHunk": "@@ -283,16 +289,17 @@ public void shouldRetryAndSucceedAfterResponseIsValid() throws InterruptedExcept\n     // given\n     final var retryLatch = new CountDownLatch(2);\n     serverTransport.subscribe(0, new DirectlyResponder(bytes -> retryLatch.countDown())).join();\n+\n     final var responseValidation = new AtomicBoolean(false);\n     final var requestFuture =\n         clientTransport.sendRequestWithRetry(\n             nodeAddressSupplier,\n             (responseToValidate) -> responseValidation.get(),\n             new Request(\"messageABC\"),\n-            Duration.ofSeconds(3));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a032407d651cf9c82da09f5e259237d40f683d69"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MzM2NDk2", "url": "https://github.com/camunda-cloud/zeebe/pull/5078#pullrequestreview-458336496", "createdAt": "2020-07-30T12:06:35Z", "commit": {"oid": "f22ef3a1840e124b77ae80825b1e1ae85d967cef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7f71b40e95f561279f64b13b37d164fb8b7a1bd", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c7f71b40e95f561279f64b13b37d164fb8b7a1bd", "committedDate": "2020-07-31T05:16:40Z", "message": "test(transport): improve test stability\n\n* increase timeouts when waiting on a response - in CI, the response can take longer for unclear reasons"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f22ef3a1840e124b77ae80825b1e1ae85d967cef", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f22ef3a1840e124b77ae80825b1e1ae85d967cef", "committedDate": "2020-07-30T11:46:09Z", "message": "test(transport): reduce the latch timeout for more stability"}, "afterCommit": {"oid": "c7f71b40e95f561279f64b13b37d164fb8b7a1bd", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c7f71b40e95f561279f64b13b37d164fb8b7a1bd", "committedDate": "2020-07-31T05:16:40Z", "message": "test(transport): improve test stability\n\n* increase timeouts when waiting on a response - in CI, the response can take longer for unclear reasons"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2618, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}