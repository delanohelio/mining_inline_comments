{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NzU0Mzgw", "number": 5912, "title": "Parallelize update tests", "bodyText": "Description\nThis PR aims to speed up the update tests by parallelizing them. As a single class, surefire/failsafe cannot parallelize the 30 parameterized test cases using multiple forks. The solution is to split them off into multiple classes, where each class will be executed in a different fork. The shared assertion logic is then extracted to ContainerStateAssert, as all the assertions are asserting the current state of the broker.\nRelated issues\nrelated to #5873\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions. You can trigger a backport by assigning labels (e.g. backport stable/0.25) to the PR, in case that fails you need to create backports manually.\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-11-24T20:29:06Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5912", "merged": true, "mergeCommit": {"oid": "e0d9dce5497208ca58815bf87249e1482a034111"}, "closed": true, "closedAt": "2020-12-08T11:38:25Z", "author": {"login": "npepinpe"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfv6ILgFqTUzNzg4NDcxOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkIRA6ABqjQwODQyNjg2Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODg0NzE4", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#pullrequestreview-537884718", "createdAt": "2020-11-24T20:37:55Z", "commit": {"oid": "96f6d41a782003b0d0dfd40356c63dc0c306ec50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDozNzo1NVrOH5URUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDozNzo1NVrOH5URUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2Mjk5Mg==", "bodyText": "In junit5, CloseableResource objects which are put in a store are automatically closed when the test lifecycle ends (so if it's on a parameter or field, when the test ends; if it's on a static field, when the class/suite ends).", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#discussion_r529862992", "createdAt": "2020-11-24T20:37:55Z", "author": {"login": "npepinpe"}, "path": "update-tests/src/test/java/io/zeebe/test/ContainerState.java", "diffHunk": "@@ -18,13 +18,14 @@\n import java.util.regex.Pattern;\n import net.jodah.failsafe.Failsafe;\n import net.jodah.failsafe.RetryPolicy;\n+import org.junit.jupiter.api.extension.ExtensionContext.Store.CloseableResource;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.testcontainers.containers.ContainerFetchException;\n import org.testcontainers.containers.ContainerLaunchException;\n import org.testcontainers.containers.Network;\n \n-public class ContainerState {\n+public class ContainerState implements CloseableResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96f6d41a782003b0d0dfd40356c63dc0c306ec50"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODg1MTc2", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#pullrequestreview-537885176", "createdAt": "2020-11-24T20:38:41Z", "commit": {"oid": "96f6d41a782003b0d0dfd40356c63dc0c306ec50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDozODo0MVrOH5USqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDozODo0MVrOH5USqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2MzMzNg==", "bodyText": "Easily extended if we need more by storing a collection. Note that we'd need to make the collection itself a CloseableResource to ensure everything is cleaned up.", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#discussion_r529863336", "createdAt": "2020-11-24T20:38:41Z", "author": {"login": "npepinpe"}, "path": "update-tests/src/test/java/io/zeebe/test/ContainerStateExtension.java", "diffHunk": "@@ -8,39 +8,52 @@\n package io.zeebe.test;\n \n import io.zeebe.test.util.testcontainers.ManagedVolume;\n+import java.util.Optional;\n import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n-import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n import org.junit.jupiter.api.extension.ExtensionContext;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junit.jupiter.api.extension.ExtensionContext.Store;\n+import org.junit.jupiter.api.extension.ExtensionContext.Store.CloseableResource;\n+import org.junit.jupiter.api.extension.ParameterContext;\n+import org.junit.jupiter.api.extension.ParameterResolutionException;\n+import org.junit.jupiter.api.extension.ParameterResolver;\n \n-public class ContainerStateExtension\n-    implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n-  private static final Logger LOG = LoggerFactory.getLogger(ContainerStateExtension.class);\n-\n-  private final ContainerState state;\n-\n-  public ContainerStateExtension(final ContainerState state) {\n-    this.state = state;\n-  }\n+/**\n+ * This extension injects a new {@link ContainerState} at runtime into any test which adds a {@link\n+ * ContainerState} parameter, and stores it in a {@link Store}. This ensures that the resource is\n+ * properly closed (since {@link ContainerState} implements {@link CloseableResource}).\n+ *\n+ * <p>Note however that it currently only supports injecting a single state, since the stored state", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96f6d41a782003b0d0dfd40356c63dc0c306ec50"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85bea7d616e563fe6bc6a5518658054ea1f98657", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/85bea7d616e563fe6bc6a5518658054ea1f98657", "committedDate": "2020-11-24T20:40:12Z", "message": "chore(update-tests): remove dead code"}, "afterCommit": {"oid": "f8e4d4f4f65a559a56d73ce9e33ea946bba0290a", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f8e4d4f4f65a559a56d73ce9e33ea946bba0290a", "committedDate": "2020-11-25T13:02:43Z", "message": "chore(update-tests): remove dead code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8e4d4f4f65a559a56d73ce9e33ea946bba0290a", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f8e4d4f4f65a559a56d73ce9e33ea946bba0290a", "committedDate": "2020-11-25T13:02:43Z", "message": "chore(update-tests): remove dead code"}, "afterCommit": {"oid": "8460069cd19a6055479ad40fe8ddac5a4705e6fa", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8460069cd19a6055479ad40fe8ddac5a4705e6fa", "committedDate": "2020-11-25T14:56:30Z", "message": "chore(update-tests): remove dead code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36e84af6fe50de262276ab41e92b5688b33971c0", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/36e84af6fe50de262276ab41e92b5688b33971c0", "committedDate": "2020-11-25T15:14:00Z", "message": "chore(update-tests): remove 'type' interface"}, "afterCommit": {"oid": "5117e5c480d8e917f8d7431307a409db83dce4d6", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5117e5c480d8e917f8d7431307a409db83dce4d6", "committedDate": "2020-11-27T13:51:34Z", "message": "chore(update-tests): split off UpdateTest monster\n\n- split off UpdateTest class into multiple test suites to further\n  parallelize"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fe0710635c223e3041cc90cb9bc4f65f5a32c9c", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/5fe0710635c223e3041cc90cb9bc4f65f5a32c9c", "committedDate": "2020-11-27T14:10:42Z", "message": "chore(parent): enable junit parallel tests for fun"}, "afterCommit": {"oid": "86dc7818dda9dc823d0874e71ba3b94e48fbba16", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/86dc7818dda9dc823d0874e71ba3b94e48fbba16", "committedDate": "2020-11-27T14:12:14Z", "message": "chore(parent): enable junit parallel tests for fun"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28547b612c0a305652eca633a2ef270869de99dc", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/28547b612c0a305652eca633a2ef270869de99dc", "committedDate": "2020-11-27T15:46:01Z", "message": "chore(ci): run 4 modules in parallel for unit tests"}, "afterCommit": {"oid": "87938a6e7170a2bb252d5fda50080db6f182078c", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/87938a6e7170a2bb252d5fda50080db6f182078c", "committedDate": "2020-11-28T08:55:51Z", "message": "chore(update-tests): split off UpdateTest monster\n\n- split off UpdateTest class into multiple test suites to further\n  parallelize"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57c13d14d87e56f3e2709c0f9d4f5f8eff3c6006", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/57c13d14d87e56f3e2709c0f9d4f5f8eff3c6006", "committedDate": "2020-11-28T08:56:52Z", "message": "chore(update-tests): run parameterized tests in parallel"}, "afterCommit": {"oid": "b3485b305af19ead6dac96c4734ea02b2913db9d", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b3485b305af19ead6dac96c4734ea02b2913db9d", "committedDate": "2020-11-28T09:11:20Z", "message": "chore(update-tests): run parameterized tests in parallel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3485b305af19ead6dac96c4734ea02b2913db9d", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b3485b305af19ead6dac96c4734ea02b2913db9d", "committedDate": "2020-11-28T09:11:20Z", "message": "chore(update-tests): run parameterized tests in parallel"}, "afterCommit": {"oid": "cce83f1f13ce8182bbe54c515f761f90f6444484", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/cce83f1f13ce8182bbe54c515f761f90f6444484", "committedDate": "2020-11-28T09:36:34Z", "message": "chore(update-tests): run parameterized tests in parallel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d75e39adb9f1cf118da02e570ef36181c027ab5a", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d75e39adb9f1cf118da02e570ef36181c027ab5a", "committedDate": "2020-11-28T10:38:21Z", "message": "chore(update-tests): simplify eventually API"}, "afterCommit": {"oid": "c6cb4cb719aedc8ec06e45defe8ca07ab9a64ea0", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c6cb4cb719aedc8ec06e45defe8ca07ab9a64ea0", "committedDate": "2020-12-02T16:56:59Z", "message": "chore(update-tests): simplify eventually API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6cb4cb719aedc8ec06e45defe8ca07ab9a64ea0", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c6cb4cb719aedc8ec06e45defe8ca07ab9a64ea0", "committedDate": "2020-12-02T16:56:59Z", "message": "chore(update-tests): simplify eventually API"}, "afterCommit": {"oid": "2d6e499901584072ba2fbbe196e4373f531b2036", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/2d6e499901584072ba2fbbe196e4373f531b2036", "committedDate": "2020-12-02T17:10:07Z", "message": "chore(update-tests): run parameterized tests in parallel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e0ed16af053ce7f42d125ecb591153b48bedcdc", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8e0ed16af053ce7f42d125ecb591153b48bedcdc", "committedDate": "2020-12-02T17:34:30Z", "message": "chore(test-util): lower base port to avoid collisions with docker for ports above 32655"}, "afterCommit": {"oid": "376304685afd4dad0405e39305298c408fb06701", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/376304685afd4dad0405e39305298c408fb06701", "committedDate": "2020-12-02T18:19:26Z", "message": "chore(test-util): lower base port to avoid collisions with docker for ports above 32655"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7107e23aab12d7ee5f7dacfd82679031669c5609", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/7107e23aab12d7ee5f7dacfd82679031669c5609", "committedDate": "2020-12-02T18:53:04Z", "message": "chore(update-tests): do not use junit5 parallel tests"}, "afterCommit": {"oid": "123b0d66baee3bc141a81adb3d093da8fcdeef42", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/123b0d66baee3bc141a81adb3d093da8fcdeef42", "committedDate": "2020-12-02T20:50:22Z", "message": "chore(update-tests): do not use junit5 parallel tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "663e0e0aa0be0ce1435613c20d4371c5a4050680", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/663e0e0aa0be0ce1435613c20d4371c5a4050680", "committedDate": "2020-12-03T07:42:58Z", "message": "chore(update-tests): parallelize using junit5"}, "afterCommit": {"oid": "2605b55a593f19359c83563397fa79ad78f3ff67", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/2605b55a593f19359c83563397fa79ad78f3ff67", "committedDate": "2020-12-03T08:20:20Z", "message": "chore(test-util): lower base port to avoid collisions with docker for ports above 32655"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2605b55a593f19359c83563397fa79ad78f3ff67", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/2605b55a593f19359c83563397fa79ad78f3ff67", "committedDate": "2020-12-03T08:20:20Z", "message": "chore(test-util): lower base port to avoid collisions with docker for ports above 32655"}, "afterCommit": {"oid": "fd39466b36b10f2aade8aa57abf9644ea7e09fbc", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/fd39466b36b10f2aade8aa57abf9644ea7e09fbc", "committedDate": "2020-12-03T08:20:20Z", "message": "chore(update-tests): split off UpdateTest monster\n\n- split off UpdateTest class into multiple test suites to allow\n  parallelizing via surefire/failsafe forks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd39466b36b10f2aade8aa57abf9644ea7e09fbc", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/fd39466b36b10f2aade8aa57abf9644ea7e09fbc", "committedDate": "2020-12-03T08:20:20Z", "message": "chore(update-tests): split off UpdateTest monster\n\n- split off UpdateTest class into multiple test suites to allow\n  parallelizing via surefire/failsafe forks"}, "afterCommit": {"oid": "c4b33a49fd38c61865fdb66ab97a3e9347642af4", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c4b33a49fd38c61865fdb66ab97a3e9347642af4", "committedDate": "2020-12-04T14:48:35Z", "message": "chore(update-tests): split off UpdateTest monster\n\n- split off UpdateTest class into multiple test suites to allow\n  parallelizing via surefire/failsafe forks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4b33a49fd38c61865fdb66ab97a3e9347642af4", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c4b33a49fd38c61865fdb66ab97a3e9347642af4", "committedDate": "2020-12-04T14:48:35Z", "message": "chore(update-tests): split off UpdateTest monster\n\n- split off UpdateTest class into multiple test suites to allow\n  parallelizing via surefire/failsafe forks"}, "afterCommit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b029dea5bc9753fda05dc00c9bf604035c887ac8", "committedDate": "2020-12-04T14:52:40Z", "message": "chore(update-tests): parallelize UpdateTest\n\n- splits UpdateTest class into multiple classes, which allows\n  surefire/failsafe to parallelize the tests using forks\n- extracts shared assertion logic into ContainerStateAssert\n- fixes some warnings\n\nchore(update-tests): minor touch up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDI4NjUx", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#pullrequestreview-545028651", "createdAt": "2020-12-04T14:54:42Z", "commit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNDo1NDo0M1rOH_UZWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNDo1NDo0M1rOH_UZWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE1NjUwNA==", "bodyText": "Fixes a warning about type erasure", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#discussion_r536156504", "createdAt": "2020-12-04T14:54:43Z", "author": {"login": "npepinpe"}, "path": "update-tests/src/test/java/io/zeebe/test/ContainerState.java", "diffHunk": "@@ -18,15 +18,16 @@\n import java.util.regex.Pattern;\n import net.jodah.failsafe.Failsafe;\n import net.jodah.failsafe.RetryPolicy;\n+import org.junit.jupiter.api.extension.ExtensionContext.Store.CloseableResource;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.testcontainers.containers.ContainerFetchException;\n import org.testcontainers.containers.ContainerLaunchException;\n import org.testcontainers.containers.Network;\n \n-public class ContainerState {\n+final class ContainerState implements CloseableResource {\n   private static final RetryPolicy<Void> CONTAINER_START_RETRY_POLICY =\n-      new RetryPolicy().withMaxRetries(5).withBackoff(3, 30, ChronoUnit.SECONDS);\n+      new RetryPolicy<Void>().withMaxRetries(5).withBackoff(3, 30, ChronoUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDI5NTc3", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#pullrequestreview-545029577", "createdAt": "2020-12-04T14:55:46Z", "commit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNDo1NTo0NlrOH_Ub-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNDo1NTo0NlrOH_Ub-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE1NzE3Nw==", "bodyText": "In junit5, CloseableResource instances which are stored in an extension store will be automatically close at the end of the extension's lifecycle - in our case, with ContainerStateExtension, this means at the end of the test where the parameter is injected.\nSee https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/extension/ExtensionContext.Store.CloseableResource.html", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#discussion_r536157177", "createdAt": "2020-12-04T14:55:46Z", "author": {"login": "npepinpe"}, "path": "update-tests/src/test/java/io/zeebe/test/ContainerState.java", "diffHunk": "@@ -18,15 +18,16 @@\n import java.util.regex.Pattern;\n import net.jodah.failsafe.Failsafe;\n import net.jodah.failsafe.RetryPolicy;\n+import org.junit.jupiter.api.extension.ExtensionContext.Store.CloseableResource;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.testcontainers.containers.ContainerFetchException;\n import org.testcontainers.containers.ContainerLaunchException;\n import org.testcontainers.containers.Network;\n \n-public class ContainerState {\n+final class ContainerState implements CloseableResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDMxMDMz", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#pullrequestreview-545031033", "createdAt": "2020-12-04T14:57:23Z", "commit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNDo1NzoyM1rOH_Ugig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNDo1NzoyM1rOH_Ugig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE1ODM0Ng==", "bodyText": "These settings are known to improve performance - however they're not defaults as changing them would be non-backwards compatible. We can remove them here once that's the case.", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#discussion_r536158346", "createdAt": "2020-12-04T14:57:23Z", "author": {"login": "npepinpe"}, "path": "update-tests/src/test/java/io/zeebe/test/ContainerState.java", "diffHunk": "@@ -92,6 +97,9 @@ public void start(final boolean enableDebug) {\n     broker =\n         new ZeebeContainer(\"camunda/zeebe:\" + brokerVersion)\n             .withEnv(\"ZEEBE_LOG_LEVEL\", \"DEBUG\")\n+            .withEnv(\"ZEEBE_BROKER_NETWORK_MAXMESSAGESIZE\", \"128KB\")\n+            .withEnv(\"ZEEBE_BROKER_DATA_USEMMAP\", \"true\")\n+            .withEnv(\"ZEEBE_BROKER_DATA_LOGSEGMENTSIZE\", \"64MB\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b029dea5bc9753fda05dc00c9bf604035c887ac8"}, "originalPosition": 60}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "baf0adb623e2280bb4c8dfd9fc23ed48238c0142", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/baf0adb623e2280bb4c8dfd9fc23ed48238c0142", "committedDate": "2020-12-04T15:21:07Z", "message": "chore(update-tests): use junit5 parallelism"}, "afterCommit": {"oid": "a551c1a2e13458c17f528d5d93bafcd1227902dc", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a551c1a2e13458c17f528d5d93bafcd1227902dc", "committedDate": "2020-12-04T15:31:33Z", "message": "chore(update-tests): parallelize UpdateTest\n\n- splits UpdateTest class into multiple classes, which allows\n  surefire/failsafe to parallelize the tests using forks\n- extracts shared assertion logic into ContainerStateAssert\n- fixes some warnings\n\nchore(update-tests): minor touch up"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b7647b859fa9661cd5debefcc56b35f70dea821", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1b7647b859fa9661cd5debefcc56b35f70dea821", "committedDate": "2020-12-04T16:00:19Z", "message": "chore(parent): fix juni5 thread count"}, "afterCommit": {"oid": "32a30de35418f3691cad262078dd86c5e4833ee6", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/32a30de35418f3691cad262078dd86c5e4833ee6", "committedDate": "2020-12-04T16:31:23Z", "message": "chore(update-tests): parallelize UpdateTest\n\n- splits UpdateTest class into multiple classes, which allows\n  surefire/failsafe to parallelize the tests using forks\n- extracts shared assertion logic into ContainerStateAssert\n- fixes some warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MDU3NDQ2", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#pullrequestreview-547057446", "createdAt": "2020-12-08T10:36:29Z", "commit": {"oid": "32a30de35418f3691cad262078dd86c5e4833ee6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMDozNjoyOVrOIBSsqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMDozNjoyOVrOIBSsqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIyNTgzMg==", "bodyText": "Why not move the assignment to the declaration and remove the constructor altogether?", "url": "https://github.com/camunda-cloud/zeebe/pull/5912#discussion_r538225832", "createdAt": "2020-12-08T10:36:29Z", "author": {"login": "MiguelPires"}, "path": "update-tests/src/test/java/io/zeebe/test/ContainerState.java", "diffHunk": "@@ -45,19 +46,18 @@\n             });\n   }\n \n-  private final Network network;\n-\n   private ZeebeContainer broker;\n   private ZeebeGatewayContainer gateway;\n   private ZeebeClient client;\n   private PartitionsActuatorClient partitionsActuatorClient;\n   private ManagedVolume volume;\n+  private Network network;\n \n   private String brokerVersion;\n   private String gatewayVersion;\n \n-  public ContainerState(final Network network) {\n-    this.network = network;\n+  public ContainerState() {\n+    network = Network.SHARED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32a30de35418f3691cad262078dd86c5e4833ee6"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29bb8974dcd75727653516aea0d8e387ac2e864b", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/29bb8974dcd75727653516aea0d8e387ac2e864b", "committedDate": "2020-12-08T11:16:13Z", "message": "chore(update-tests): parallelize UpdateTest\n\n- splits UpdateTest class into multiple classes, which allows\n  surefire/failsafe to parallelize the tests using forks\n- extracts shared assertion logic into ContainerStateAssert\n- fixes some warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1880473f5639929e35e21e70b0a4c60fc332989e", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1880473f5639929e35e21e70b0a4c60fc332989e", "committedDate": "2020-12-08T11:16:04Z", "message": "chore(update-tests): apply review feedback"}, "afterCommit": {"oid": "29bb8974dcd75727653516aea0d8e387ac2e864b", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/29bb8974dcd75727653516aea0d8e387ac2e864b", "committedDate": "2020-12-08T11:16:13Z", "message": "chore(update-tests): parallelize UpdateTest\n\n- splits UpdateTest class into multiple classes, which allows\n  surefire/failsafe to parallelize the tests using forks\n- extracts shared assertion logic into ContainerStateAssert\n- fixes some warnings"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2265, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}