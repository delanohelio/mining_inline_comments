{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTQyMDQ2", "number": 3860, "title": "3841 replace byte value in signatures with long", "bodyText": "Description\nThis change adds a dedicated class for the parsing of ByteValue objects. Usage of this parsing method is then restricted to the configuration classes.\nAll other classes user either:\n\na long value for the size\nor the static methods to convert sizes to long\n\nNote that there is one unresolved issue about places which expect a size in long vs. places which expect a size in int. To that end, I tried to make as minimal changes as possible.\nRelated issues\ncloses #3841\nPull Request Checklist\n\n[ X ] All commit messages match our commit message guidelines\n[ X ] The submitting code follows our code style\n[ X ] If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-02-17T13:39:35Z", "url": "https://github.com/camunda-cloud/zeebe/pull/3860", "merged": true, "mergeCommit": {"oid": "1380a98cae4a02805d55fc6574f2182415de2c04"}, "closed": true, "closedAt": "2020-02-19T16:11:11Z", "author": {"login": "pihme"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFn_CHgFqTM2MDYzOTIzOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF1v3KgBqjMwNTE1NTEyNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjM5MjM5", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#pullrequestreview-360639239", "createdAt": "2020-02-18T20:11:04Z", "commit": {"oid": "f364db704ccedba5ec20e9c1094a9b90519c55ac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMDoxMTowNVrOFrQ0_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMDoxNTo1NlrOFrQ9tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwODc5OQ==", "bodyText": "Should we also have a getLogSegmentSizeInBytes method here as well then?", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#discussion_r380908799", "createdAt": "2020-02-18T20:11:05Z", "author": {"login": "npepinpe"}, "path": "broker/src/main/java/io/zeebe/broker/clustering/atomix/AtomixFactory.java", "diffHunk": "@@ -114,14 +114,14 @@ private static RaftPartitionGroup createRaftPartitionGroup(\n             .withFlushOnCommit();\n \n     // by default, the Atomix max entry size is 1 MB\n-    final ByteValue maxMessageSize = networkCfg.getMaxMessageSize();\n-    partitionGroupBuilder.withMaxEntrySize((int) maxMessageSize.toBytes());\n+    final int maxMessageSize = (int) networkCfg.getMaxMessageSizeInBytes();\n+    partitionGroupBuilder.withMaxEntrySize(maxMessageSize);\n \n     Optional.ofNullable(dataCfg.getLogSegmentSize())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f364db704ccedba5ec20e9c1094a9b90519c55ac"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTcxNA==", "bodyText": "Nit: not sure if necessary as when we parse the config file, we could have an invalid string and we'll anyway only figure it out when we try to access it via getMaxMessageSizeInBytes.", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#discussion_r380909714", "createdAt": "2020-02-18T20:13:01Z", "author": {"login": "npepinpe"}, "path": "broker/src/main/java/io/zeebe/broker/system/configuration/NetworkCfg.java", "diffHunk": "@@ -74,11 +74,18 @@ public void setPortOffset(final int portOffset) {\n     this.portOffset = portOffset;\n   }\n \n-  public ByteValue getMaxMessageSize() {\n-    return new ByteValue(maxMessageSize);\n+  public String getMaxMessageSize() {\n+    return maxMessageSize;\n+  }\n+\n+  public long getMaxMessageSizeInBytes() {\n+    return ByteValueParser.fromString(maxMessageSize).toBytes();\n   }\n \n   public void setMaxMessageSize(final String maxMessageSize) {\n+    // call parsing logic to provoke any exceptions that might occur during parsing\n+    ByteValueParser.fromString(maxMessageSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f364db704ccedba5ec20e9c1094a9b90519c55ac"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxMTAzMQ==", "bodyText": "Why not have the argument be an int to make this cast explicit to the caller (to avoid any potential confusion)?", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#discussion_r380911031", "createdAt": "2020-02-18T20:15:56Z", "author": {"login": "npepinpe"}, "path": "dispatcher/src/main/java/io/zeebe/dispatcher/DispatcherBuilder.java", "diffHunk": "@@ -49,8 +49,8 @@ public DispatcherBuilder name(final String name) {\n    * The number of bytes the buffer is be able to contain. Represents the size of the data section.\n    * Additional space will be allocated for the meta-data sections\n    */\n-  public DispatcherBuilder bufferSize(final ByteValue byteValue) {\n-    bufferSize = (int) byteValue.toBytes();\n+  public DispatcherBuilder bufferSize(final long bufferSize) {\n+    this.bufferSize = (int) bufferSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f364db704ccedba5ec20e9c1094a9b90519c55ac"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f364db704ccedba5ec20e9c1094a9b90519c55ac", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f364db704ccedba5ec20e9c1094a9b90519c55ac", "committedDate": "2020-02-17T13:04:33Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}, "afterCommit": {"oid": "259d600c50134c2f37dac8b8b7dc83a095d0fdf8", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/259d600c50134c2f37dac8b8b7dc83a095d0fdf8", "committedDate": "2020-02-19T09:32:37Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "259d600c50134c2f37dac8b8b7dc83a095d0fdf8", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/259d600c50134c2f37dac8b8b7dc83a095d0fdf8", "committedDate": "2020-02-19T09:32:37Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}, "afterCommit": {"oid": "f479dc7577664aca1a5ce947e51c189d2e7a749c", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f479dc7577664aca1a5ce947e51c189d2e7a749c", "committedDate": "2020-02-19T09:42:46Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDY1Njg2", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#pullrequestreview-361065686", "createdAt": "2020-02-19T12:20:32Z", "commit": {"oid": "f479dc7577664aca1a5ce947e51c189d2e7a749c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMjoyMDozMlrOFrmCuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMjoyMTowOVrOFrmD4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI1NjM3OQ==", "bodyText": "It's a little strange imo to have a Long but I get the idea. Maybe once we migrate the config we can revisit this and ensure we always have some value here.", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#discussion_r381256379", "createdAt": "2020-02-19T12:20:32Z", "author": {"login": "npepinpe"}, "path": "broker/src/main/java/io/zeebe/broker/system/configuration/DataCfg.java", "diffHunk": "@@ -45,11 +46,24 @@ public void setDirectories(final List<String> directories) {\n     this.directories = directories;\n   }\n \n+  public Long getLogSegmentSizeInBytes() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f479dc7577664aca1a5ce947e51c189d2e7a749c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI1NjY3NQ==", "bodyText": "A little nit picky, but we could do the same we did above and have the caller perform the cast to int.", "url": "https://github.com/camunda-cloud/zeebe/pull/3860#discussion_r381256675", "createdAt": "2020-02-19T12:21:09Z", "author": {"login": "npepinpe"}, "path": "dispatcher/src/main/java/io/zeebe/dispatcher/DispatcherBuilder.java", "diffHunk": "@@ -60,8 +60,8 @@ public DispatcherBuilder actorScheduler(final ActorScheduler actorScheduler) {\n   }\n \n   /** The max length of the data section of a frame */\n-  public DispatcherBuilder maxFragmentLength(final ByteValue maxFragmentLength) {\n-    this.maxFragmentLength = (int) maxFragmentLength.toBytes();\n+  public DispatcherBuilder maxFragmentLength(final long maxFragmentLength) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f479dc7577664aca1a5ce947e51c189d2e7a749c"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97a26b3cd1bcf60c509521939963dd1b74b767b2", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/97a26b3cd1bcf60c509521939963dd1b74b767b2", "committedDate": "2020-02-19T12:30:40Z", "message": "chore(util): Move parsing logic for ByteValue into dedicated class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1380a98cae4a02805d55fc6574f2182415de2c04", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1380a98cae4a02805d55fc6574f2182415de2c04", "committedDate": "2020-02-19T12:30:40Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f479dc7577664aca1a5ce947e51c189d2e7a749c", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f479dc7577664aca1a5ce947e51c189d2e7a749c", "committedDate": "2020-02-19T09:42:46Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}, "afterCommit": {"oid": "1380a98cae4a02805d55fc6574f2182415de2c04", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1380a98cae4a02805d55fc6574f2182415de2c04", "committedDate": "2020-02-19T12:30:40Z", "message": "chore(broker): Remove ByteValue from signature of config classes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3142, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}