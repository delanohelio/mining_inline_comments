{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzA5ODI0", "number": 6011, "title": "[Backport stable/0.25] Fixes outdated topology when no new leader is assigned", "bodyText": "Description\nBackport of #5979 to stable/0.25. There was some minor conflicts, where I had to bump the AssertJ version as failure did not exist in 3.17.", "createdAt": "2020-12-14T18:17:20Z", "url": "https://github.com/camunda-cloud/zeebe/pull/6011", "merged": true, "mergeCommit": {"oid": "62871d1fffd99629b57ec11554a8a367f51cc2b5"}, "closed": true, "closedAt": "2020-12-15T13:44:18Z", "author": {"login": "npepinpe"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmLEiQABqjQxMTEwMTM5MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmZdQCABqjQxMTQzMTU3MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4787348e2cbad40077ca6e98ec6b8b343ee891a", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/e4787348e2cbad40077ca6e98ec6b8b343ee891a", "committedDate": "2020-12-14T19:34:51Z", "message": "chore(test-util): use older API"}, "afterCommit": {"oid": "01eef26104bdddb90932df51cabf5e6e419aa053", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/01eef26104bdddb90932df51cabf5e6e419aa053", "committedDate": "2020-12-14T19:40:06Z", "message": "deps(parent): bump assertJ version for #failure()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01eef26104bdddb90932df51cabf5e6e419aa053", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/01eef26104bdddb90932df51cabf5e6e419aa053", "committedDate": "2020-12-14T19:40:06Z", "message": "deps(parent): bump assertJ version for #failure()"}, "afterCommit": {"oid": "c526bf632639f29985c6a9c6fae47c96348745ff", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/c526bf632639f29985c6a9c6fae47c96348745ff", "committedDate": "2020-12-14T19:41:28Z", "message": "chore(parent): bump assertJ version for #failure()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMTYyMjYw", "url": "https://github.com/camunda-cloud/zeebe/pull/6011#pullrequestreview-552162260", "createdAt": "2020-12-15T07:17:14Z", "commit": {"oid": "c526bf632639f29985c6a9c6fae47c96348745ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzoxNzoxNFrOIF8R9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzoxNzoxNFrOIF8R9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEwMTQyOA==", "bodyText": "Topology does not have partition health in this version. You can remove this test.", "url": "https://github.com/camunda-cloud/zeebe/pull/6011#discussion_r543101428", "createdAt": "2020-12-15T07:17:14Z", "author": {"login": "deepthidevaki"}, "path": "gateway/src/test/java/io/zeebe/gateway/topology/TopologyUpdateTest.java", "diffHunk": "@@ -174,6 +177,52 @@ public void shouldUpdateTopologyOnBrokerRemoveAndDirectlyRejoin() {\n     assertThat(topologyManager.getTopology().getLeaderForPartition(1)).isEqualTo(leaderId);\n   }\n \n+  @Test\n+  public void shouldUpdateTopologyOnPartitionHealth() {\n+    final int brokerId = 0;\n+    final int partition = 0;\n+    final BrokerInfo broker = createBroker(brokerId);\n+    broker.setPartitionHealthy(partition);\n+    topologyManager.event(createMemberAddedEvent(broker));\n+    waitUntil(() -> topologyManager.getTopology() != null);\n+    assertThat(topologyManager.getTopology().isPartitionHealthy(brokerId, partition)).isTrue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c526bf632639f29985c6a9c6fae47c96348745ff"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMzk2OTUz", "url": "https://github.com/camunda-cloud/zeebe/pull/6011#pullrequestreview-552396953", "createdAt": "2020-12-15T12:24:54Z", "commit": {"oid": "33f85fd89297a8280bc26c64bcb076f93314cd22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "999cd224b55ae5b848a8c56471ede537839e054f", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/999cd224b55ae5b848a8c56471ede537839e054f", "committedDate": "2020-12-15T12:25:46Z", "message": "fix(gateway): fix outdated leader when no other leader\n\n- fixes an issue in the gateway topology when the old leader becomes\n  follower, and no new node is elected leader yet, by removing the new\n  follower if it's still identified as the leader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "750a9e4b0b98171fac34c52806bc2c6e7416161a", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/750a9e4b0b98171fac34c52806bc2c6e7416161a", "committedDate": "2020-12-15T12:25:47Z", "message": "chore(test-util): update definition of complete topology\n\n- TopologyAssert#isComplete now also checks that all partitions have a\n  leader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eae6ac73d21523692e4ab55878ae30e6fdae18c7", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/eae6ac73d21523692e4ab55878ae30e6fdae18c7", "committedDate": "2020-12-15T12:25:47Z", "message": "chore(qa): add topology fault tolerance tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d37ab0de49b4def9aa788a969df5da5e5a991b1", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/6d37ab0de49b4def9aa788a969df5da5e5a991b1", "committedDate": "2020-12-15T12:25:47Z", "message": "chore(parent): bump assertJ version for #failure()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33f85fd89297a8280bc26c64bcb076f93314cd22", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/33f85fd89297a8280bc26c64bcb076f93314cd22", "committedDate": "2020-12-15T09:25:52Z", "message": "chore(gateway): removed unnecessary test"}, "afterCommit": {"oid": "6d37ab0de49b4def9aa788a969df5da5e5a991b1", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/6d37ab0de49b4def9aa788a969df5da5e5a991b1", "committedDate": "2020-12-15T12:25:47Z", "message": "chore(parent): bump assertJ version for #failure()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2230, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}