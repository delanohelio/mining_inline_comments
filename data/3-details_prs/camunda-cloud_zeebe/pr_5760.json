{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1MzA0NTk3", "number": 5760, "title": "fix(engine): always accept Deployment CREATE command", "bodyText": "Description\n\nremoves one of the in-memory deployment caches\nalways accept depmloyment create commands on other partitions, before it was rejected which can lead to inconsistency problems\n\n\nRelated issues\n\ncloses #5753\ncloses #5688\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-11-04T10:57:55Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5760", "merged": true, "mergeCommit": {"oid": "65a3c1d2f9853b7aa858cf0b373e09c9ee7018c0"}, "closed": true, "closedAt": "2020-11-06T19:44:13Z", "author": {"login": "Zelldon"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZamuHAFqTUyMzkxNTU4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ7gYzgBqjM5Njg0NzgyNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzOTE1NTg3", "url": "https://github.com/camunda-cloud/zeebe/pull/5760#pullrequestreview-523915587", "createdAt": "2020-11-05T04:21:33Z", "commit": {"oid": "6e5e20fdc67c865fcda485f650510dcc4effe015"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNDoyMTozM1rOHtzCQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNDoyNDoxN1rOHtzEpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzc4NDEyOA==", "bodyText": "This string is not used anymore \ud83d\uddd1\ufe0f", "url": "https://github.com/camunda-cloud/zeebe/pull/5760#discussion_r517784128", "createdAt": "2020-11-05T04:21:33Z", "author": {"login": "saig0"}, "path": "engine/src/main/java/io/zeebe/engine/processing/deployment/DeploymentCreateProcessor.java", "diffHunk": "@@ -13,10 +13,10 @@\n import io.zeebe.engine.processing.streamprocessor.writers.TypedStreamWriter;\n import io.zeebe.engine.state.deployment.WorkflowState;\n import io.zeebe.protocol.impl.record.value.deployment.DeploymentRecord;\n-import io.zeebe.protocol.record.RejectionType;\n import io.zeebe.protocol.record.intent.DeploymentIntent;\n \n public final class DeploymentCreateProcessor implements TypedRecordProcessor<DeploymentRecord> {\n+\n   public static final String DEPLOYMENT_ALREADY_EXISTS_MESSAGE =\n       \"Expected to create a new deployment with key '%d', but there is already an existing deployment with that key\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5e20fdc67c865fcda485f650510dcc4effe015"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzc4NDc0MQ==", "bodyText": "Since the behavior changes, we should also change the name of the test method shouldRejectTwoCreatingCommands().", "url": "https://github.com/camunda-cloud/zeebe/pull/5760#discussion_r517784741", "createdAt": "2020-11-05T04:24:17Z", "author": {"login": "saig0"}, "path": "engine/src/test/java/io/zeebe/engine/processing/deployment/DeploymentCreateProcessorTest.java", "diffHunk": "@@ -73,12 +74,12 @@ public void shouldRejectTwoCreatingCommands() {\n             DeploymentIntent.CREATE,\n             DeploymentIntent.CREATED,\n             DeploymentIntent.CREATE,\n-            DeploymentIntent.CREATE);\n+            DeploymentIntent.CREATED);\n     //\n     Assertions.assertThat(collect)\n         .extracting(Record::getRecordType)\n         .containsExactly(\n-            RecordType.COMMAND, RecordType.EVENT, RecordType.COMMAND, RecordType.COMMAND_REJECTION);\n+            RecordType.COMMAND, RecordType.EVENT, RecordType.COMMAND, RecordType.EVENT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5e20fdc67c865fcda485f650510dcc4effe015"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjA1MTEy", "url": "https://github.com/camunda-cloud/zeebe/pull/5760#pullrequestreview-524205112", "createdAt": "2020-11-05T12:18:55Z", "commit": {"oid": "1515771f58b351ac306c0a6904bc21b397a3e751"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b4260fcf833868080f946e052eb7c435d858fe", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a0b4260fcf833868080f946e052eb7c435d858fe", "committedDate": "2020-11-06T18:44:50Z", "message": "fix(engine): always accept Deplyoment CREATE command"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1515771f58b351ac306c0a6904bc21b397a3e751", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1515771f58b351ac306c0a6904bc21b397a3e751", "committedDate": "2020-11-05T06:47:51Z", "message": "chore(engine): rename method"}, "afterCommit": {"oid": "a0b4260fcf833868080f946e052eb7c435d858fe", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a0b4260fcf833868080f946e052eb7c435d858fe", "committedDate": "2020-11-06T18:44:50Z", "message": "fix(engine): always accept Deplyoment CREATE command"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2341, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}