{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NDQ4MDAx", "number": 4913, "title": "chore(atomix): fix possible race conditions on closing messaging service", "bodyText": "Description\nRequests which have been submitted in between might be not completed exceptionally when the service has stopped.\nSending a message when the service is stopped will not thrown an exception anymore.\nI run the test several times locally and also in the CI without failing. Before it was quite easy to reproduce.\n\nSee also https://ci.zeebe.camunda.cloud/job/zeebe-io/job/zeebe/job/4909-fix-msg-service/\n\nRelated issues\n\ncloses #4910\ncloses #4909\ncloses #4907\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-07-08T19:45:48Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4913", "merged": true, "mergeCommit": {"oid": "bc42d23a3cdfb6e9316d383f2d4e7b3733d1fa9a"}, "closed": true, "closedAt": "2020-07-09T13:25:10Z", "author": {"login": "Zelldon"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczNCqxAFqTQ0NTUxMTA1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABczNfibABqjM1MjkyOTYzMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTExMDU1", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#pullrequestreview-445511055", "createdAt": "2020-07-09T11:01:23Z", "commit": {"oid": "202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTowMToyM1rOGvMOxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTowNjoyNFrOGvMYJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNjY0NA==", "bodyText": "Unfortunately I don't know how to add comments to lines which were not changed.\nMy question is: Do we also need to add/remove the future for the local connection case above?", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#discussion_r452136644", "createdAt": "2020-07-09T11:01:23Z", "author": {"login": "pihme"}, "path": "atomix/cluster/src/main/java/io/atomix/cluster/messaging/impl/NettyMessagingService.java", "diffHunk": "@@ -462,12 +477,15 @@ private void initEventLoopGroup() {\n       return;\n     }\n \n+    // we need these to close them on stop", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzOTA0Nw==", "bodyText": "Maybe better:\nAssertions.assertThatCode(() -> toTest.method()).doesNotThrowAnyException(); or\n@Test(expected = Test.None.class /* no exception expected */)\npublic void test_printLine() {\n    Printer.printLine(\"line\");\n}", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#discussion_r452139047", "createdAt": "2020-07-09T11:06:24Z", "author": {"login": "pihme"}, "path": "atomix/cluster/src/test/java/io/atomix/cluster/messaging/impl/NettyUnicastServiceTest.java", "diffHunk": "@@ -55,6 +56,18 @@ public void testUnicast() throws Exception {\n     await(5000);\n   }\n \n+  @Test\n+  public void shouldNotThrowExceptionWhenServiceStopped() throws Exception {\n+    // given\n+    service2.stop();\n+\n+    // when\n+    service2.unicast(address1, \"test\", \"Hello world!\".getBytes());\n+\n+    // then\n+    assertTrue(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ff531861752cf7e1f0681e68db30195e271b26a", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1ff531861752cf7e1f0681e68db30195e271b26a", "committedDate": "2020-07-09T11:39:13Z", "message": "chore(atomix): fix possible race conditions on closing messaging service\n\n Requests which have been submitted in between might be not completed exceptionally when the service has stopped.\n Sending a message when the service is stopped will not thrown an exception."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63", "committedDate": "2020-07-08T19:38:57Z", "message": "chore(atomix): fix possible race conditions on closing messaging service\n\n Requests which have been submitted in between might be not completed exceptionally when the service has stopped.\n Sending a message when the service is stopped will not thrown an exception."}, "afterCommit": {"oid": "1ff531861752cf7e1f0681e68db30195e271b26a", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1ff531861752cf7e1f0681e68db30195e271b26a", "committedDate": "2020-07-09T11:39:13Z", "message": "chore(atomix): fix possible race conditions on closing messaging service\n\n Requests which have been submitted in between might be not completed exceptionally when the service has stopped.\n Sending a message when the service is stopped will not thrown an exception."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2675, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}