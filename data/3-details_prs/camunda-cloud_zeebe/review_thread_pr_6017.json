{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMTgyMjgw", "number": 6017, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwOToyODoxNlrOFGm_hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwOToyODoxNlrOFGm_hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNDc0NjI5OnYy", "diffSide": "RIGHT", "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotStore.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwOToyODoxNlrOIHsXQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxMzo0MFrOIHy09g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkzNzc5NA==", "bodyText": "Couldn't we delete the snapshot here if it's less recent than the latestPersistedSnapshot?", "url": "https://github.com/camunda-cloud/zeebe/pull/6017#discussion_r544937794", "createdAt": "2020-12-17T09:28:16Z", "author": {"login": "MiguelPires"}, "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotStore.java", "diffHunk": "@@ -71,7 +71,14 @@ private FileBasedSnapshot loadLatestSnapshot(final Path snapshotDirectory) {\n     FileBasedSnapshot latestPersistedSnapshot = null;\n     try (final var stream = Files.newDirectoryStream(snapshotDirectory)) {\n       for (final var path : stream) {\n-        latestPersistedSnapshot = collectSnapshot(path);\n+        final var snapshot = collectSnapshot(path);\n+        if (latestPersistedSnapshot == null) {\n+          latestPersistedSnapshot = snapshot;\n+        } else if (snapshot != null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3580ce37bb41608658b58d3377bf0313cdf359e8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzcwMg==", "bodyText": "Yes. I fixed it now. I now refactored it to make it explicit that we are deleting all older snapshot.", "url": "https://github.com/camunda-cloud/zeebe/pull/6017#discussion_r545043702", "createdAt": "2020-12-17T12:13:40Z", "author": {"login": "deepthidevaki"}, "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotStore.java", "diffHunk": "@@ -71,7 +71,14 @@ private FileBasedSnapshot loadLatestSnapshot(final Path snapshotDirectory) {\n     FileBasedSnapshot latestPersistedSnapshot = null;\n     try (final var stream = Files.newDirectoryStream(snapshotDirectory)) {\n       for (final var path : stream) {\n-        latestPersistedSnapshot = collectSnapshot(path);\n+        final var snapshot = collectSnapshot(path);\n+        if (latestPersistedSnapshot == null) {\n+          latestPersistedSnapshot = snapshot;\n+        } else if (snapshot != null", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkzNzc5NA=="}, "originalCommit": {"oid": "3580ce37bb41608658b58d3377bf0313cdf359e8"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 43, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}