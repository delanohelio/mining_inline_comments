{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNzM4Mjk0", "number": 4870, "title": "fix(broker): cancel metrics timer to avoid segfault", "bodyText": "Description\n\nRelated issues\n\ncloses #4868\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-07-02T20:56:38Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4870", "merged": true, "mergeCommit": {"oid": "f8f0e0399f7064a60f7f74a2c49e2c066eb38563"}, "closed": true, "closedAt": "2020-07-03T11:56:34Z", "author": {"login": "Zelldon"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxPkCzgFqTQ0MjIyOTIzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxRrZ5ABqjM1MTA2ODk2NzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMjI5MjMx", "url": "https://github.com/camunda-cloud/zeebe/pull/4870#pullrequestreview-442229231", "createdAt": "2020-07-03T08:12:34Z", "commit": {"oid": "d23a6ad61f4d57278d81fdc2707d5340abb09783"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODoxMjozNFrOGsn0Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODo1NToxOFrOGspIBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ0Mjg3MA==", "bodyText": "Was that sometimes false?", "url": "https://github.com/camunda-cloud/zeebe/pull/4870#discussion_r449442870", "createdAt": "2020-07-03T08:12:34Z", "author": {"login": "npepinpe"}, "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/BrokerLeaderChangeTest.java", "diffHunk": "@@ -82,6 +84,32 @@ public void shouldChangeLeaderAfterLeaderDies() {\n     jobCompleter.close();\n   }\n \n+  @Test\n+  public void shouldBeAbleToBecomeLeaderAgain() {\n+    // given\n+    final var firstLeaderInfo = clusteringRule.getLeaderForPartition(1);\n+    final var firstLeaderNodeId = firstLeaderInfo.getNodeId();\n+    assertThat(clusteringRule.getCurrentLeaderForPartition(1).getNodeId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d23a6ad61f4d57278d81fdc2707d5340abb09783"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2NDMyNA==", "bodyText": "Can we comment this? It took me a little a bit to figure out what we're doing - double loop to force leader change until the leader is back again to being the first one \ud83d\ude42 Clever though \ud83d\udc4d", "url": "https://github.com/camunda-cloud/zeebe/pull/4870#discussion_r449464324", "createdAt": "2020-07-03T08:55:18Z", "author": {"login": "npepinpe"}, "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/BrokerLeaderChangeTest.java", "diffHunk": "@@ -82,6 +84,32 @@ public void shouldChangeLeaderAfterLeaderDies() {\n     jobCompleter.close();\n   }\n \n+  @Test\n+  public void shouldBeAbleToBecomeLeaderAgain() {\n+    // given\n+    final var firstLeaderInfo = clusteringRule.getLeaderForPartition(1);\n+    final var firstLeaderNodeId = firstLeaderInfo.getNodeId();\n+    assertThat(clusteringRule.getCurrentLeaderForPartition(1).getNodeId())\n+        .isEqualTo(firstLeaderNodeId);\n+\n+    // when\n+    do {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d23a6ad61f4d57278d81fdc2707d5340abb09783"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f225a4d4a6b9b660abde5725040531b68ecbf379", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f225a4d4a6b9b660abde5725040531b68ecbf379", "committedDate": "2020-07-03T11:23:55Z", "message": "fix(broker): cancel metrics timer to avoid segfault"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d23a6ad61f4d57278d81fdc2707d5340abb09783", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d23a6ad61f4d57278d81fdc2707d5340abb09783", "committedDate": "2020-07-02T20:55:19Z", "message": "fix(broker): cancel metrics timer to avoid segfault"}, "afterCommit": {"oid": "f225a4d4a6b9b660abde5725040531b68ecbf379", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f225a4d4a6b9b660abde5725040531b68ecbf379", "committedDate": "2020-07-03T11:23:55Z", "message": "fix(broker): cancel metrics timer to avoid segfault"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2670, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}