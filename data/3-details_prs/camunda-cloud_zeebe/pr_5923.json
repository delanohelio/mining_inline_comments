{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MTY1ODU0", "number": 5923, "title": "5754 trigger testbench2", "bodyText": "Description\nAdds a new QA stage to the build process, which\n\npushes a docker image to gcr.io\ntriggers the QA protocol in testbench\n\nRelated issues\ncloses #5754\nDefinition of Done\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions. You can trigger a backport by assigning labels (e.g. backport stable/0.25) to the PR, in case that fails you need to create backports manually.\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-11-26T16:05:09Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5923", "merged": true, "mergeCommit": {"oid": "863828184ba1c01d8fbac55266ad9e1fbf3788f4"}, "closed": true, "closedAt": "2020-11-27T16:01:24Z", "author": {"login": "pihme"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgm39yAFqTUzOTk0NzY5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgojFQABqjQwNDYzODYyNzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5OTQ3Njk3", "url": "https://github.com/camunda-cloud/zeebe/pull/5923#pullrequestreview-539947697", "createdAt": "2020-11-27T12:34:57Z", "commit": {"oid": "3b08c04a06abee27da6ee2bdb5f8b876555163d5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxMjozNDo1N1rOH6841w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxMjozODo1OFrOH69ABw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTU3NzA0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            def shortTimeout = 10\n          \n          \n            \n            def longTimeout = 45\n          \n          \n            \n            def shortTimeoutMinutes = 10\n          \n          \n            \n            def longTimeoutMinutes = 45\n          \n      \n    \n    \n  \n\nOr just a comment above saying the unit is minutes, otherwise I can already predict questions \ud83d\ude42", "url": "https://github.com/camunda-cloud/zeebe/pull/5923#discussion_r531577047", "createdAt": "2020-11-27T12:34:57Z", "author": {"login": "npepinpe"}, "path": "Jenkinsfile", "diffHunk": "@@ -13,6 +13,9 @@ def isDevelopBranch = env.BRANCH_NAME == developBranchName\n def daysToKeep = isDevelopBranch ? '7' : '-1'\n def numToKeep = isDevelopBranch ? '-1' : '10'\n \n+def shortTimeout = 10\n+def longTimeout = 45", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b08c04a06abee27da6ee2bdb5f8b876555163d5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTU3Nzk1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    timeout(time: shortTimeout, unit: 'MINUTES') {\n          \n          \n            \n                                    timeout(time: longTimeout, unit: 'MINUTES') {\n          \n      \n    \n    \n  \n\nI would just standardize all verification stages to use longTimeout, just go give ourselves room as we add more tests.", "url": "https://github.com/camunda-cloud/zeebe/pull/5923#discussion_r531577955", "createdAt": "2020-11-27T12:36:57Z", "author": {"login": "npepinpe"}, "path": "Jenkinsfile", "diffHunk": "@@ -105,12 +122,14 @@ pipeline {\n \n                 stage('Test (Go)') {\n                     steps {\n-                        container('golang') {\n-                            sh '.ci/scripts/distribution/build-go.sh'\n-                        }\n+                        timeout(time: shortTimeout, unit: 'MINUTES') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b08c04a06abee27da6ee2bdb5f8b876555163d5"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTU3ODg4Nw==", "bodyText": "The image is already available, so you could just take the existing camunda/zeebe:current-test and tag it differently, no need to rebuild it.\nYou can it like this:\ndocker tag camunda/zeebe:current-test ${IMAGE}:${TAG}\ndocker push ${IMAGE}:${TAG}", "url": "https://github.com/camunda-cloud/zeebe/pull/5923#discussion_r531578887", "createdAt": "2020-11-27T12:38:58Z", "author": {"login": "npepinpe"}, "path": "Jenkinsfile", "diffHunk": "@@ -283,11 +318,56 @@ pipeline {\n             }\n         }\n \n+        stage('QA') {\n+            when {\n+                expression { params.RUN_QA }\n+            }\n+            environment {\n+                IMAGE = \"gcr.io/zeebe-io/zeebe\"\n+                VERSION = readMavenPom(file: 'parent/pom.xml').getVersion()\n+                TAG = \"${env.VERSION}-${env.GIT_COMMIT}\"\n+                DOCKER_GCR = credentials(\"zeebe-gcr-serviceaccount-json\")\n+                ZEEBE_AUTHORIZATION_SERVER_URL = 'https://login.cloud.ultrawombat.com/oauth/token'\n+                ZEEBE_CLIENT_ID = 'W5a4JUc3I1NIetNnodo3YTvdsRIFb12w'\n+                QA_RUN_VARIABLES = \"{\\\"zeebeImage\\\": \\\"${env.IMAGE}:${env.TAG}\\\", \\\"generationTemplate\\\": \\\"${params.GENERATION_TEMPLATE}\\\", \\\"channel\\\": \\\"Internal Dev\\\", \" +\n+                                   \"\\\"branch\\\": \\\"${env.BRANCH_NAME}\\\", \\\"build\\\": \\\"${currentBuild.absoluteUrl}\\\"}\"\n+            }\n+\n+            steps {\n+                timeout(time: shortTimeout, unit: 'MINUTES') {\n+                    container('docker') {\n+                        sh 'cp dist/target/zeebe-distribution-*.tar.gz zeebe-distribution.tar.gz'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b08c04a06abee27da6ee2bdb5f8b876555163d5"}, "originalPosition": 238}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b08c04a06abee27da6ee2bdb5f8b876555163d5", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3b08c04a06abee27da6ee2bdb5f8b876555163d5", "committedDate": "2020-11-26T15:23:42Z", "message": "chore(ci): add timeout to individual build steps"}, "afterCommit": {"oid": "f8e30d9762e42a6f6403b40227561fbb4a2097f0", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f8e30d9762e42a6f6403b40227561fbb4a2097f0", "committedDate": "2020-11-27T13:20:41Z", "message": "chore(ci): add timeout to individual build steps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5OTkyMjg2", "url": "https://github.com/camunda-cloud/zeebe/pull/5923#pullrequestreview-539992286", "createdAt": "2020-11-27T13:47:36Z", "commit": {"oid": "224729c3d7c12f0f25f477584bf14119941c5dde"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75627fe66204e7bd44bc5ee8e1d8365c8ac2821e", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/75627fe66204e7bd44bc5ee8e1d8365c8ac2821e", "committedDate": "2020-11-27T14:37:06Z", "message": "chore(ci): trigger QA from Jenkins build"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "224729c3d7c12f0f25f477584bf14119941c5dde", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/224729c3d7c12f0f25f477584bf14119941c5dde", "committedDate": "2020-11-27T13:26:36Z", "message": "chore(ci): incorporate review feedback"}, "afterCommit": {"oid": "75627fe66204e7bd44bc5ee8e1d8365c8ac2821e", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/75627fe66204e7bd44bc5ee8e1d8365c8ac2821e", "committedDate": "2020-11-27T14:37:06Z", "message": "chore(ci): trigger QA from Jenkins build"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2272, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}