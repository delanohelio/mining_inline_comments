{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MDk4MTA3", "number": 5157, "title": "Reenable rolling upgrade test", "bodyText": "Description\nThis PR forward-ports #5133 for the latest version, but disables the tests individually based on the target new version. This is because 0.25 is currently not backwards compatible (in terms of the rolling upgrade) with 0.24. The junit assumption API is used instead of a plain @Ignore annotation as it gives us more control over the condition where the test is ignored. In this case, as long as the target version (NEW_VERSION) starts with 0.25, we will skip those tests. This means after the release they will be automatically enabled. This isn't ideal, and suggestions are more than welcome.\nThe PR also adds minimal error handling when the follower fails to deserialization a snapshot chunk, which may happen not only because of backwards compatibility issues but generally due to network issues, bugs, etc. Unfortunately there is no specific deserialization exception so RuntimeException is used there.\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-08-11T13:16:45Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5157", "merged": true, "mergeCommit": {"oid": "dd9948eac424da2c6d99e1ffc0221e69d1ad98f7"}, "closed": true, "closedAt": "2020-08-21T11:46:38Z", "author": {"login": "npepinpe"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc92mU-AH2gAyNDY2MDk4MTA3OjZjOTNhZmQyZGNiOWY3NjNjYWRlMjQ2ZjYwNjc4MTVkZGY3OWFhOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAbW0oAFqTQ3MDQzOTI1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c93afd2dcb9f763cade246f6067815ddf79aa99", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/6c93afd2dcb9f763cade246f6067815ddf79aa99", "committedDate": "2020-08-11T13:12:12Z", "message": "chore(upgrade-tests): add snapshot upgrade test\n\n- reenable rolling upgrade test\n- disable test for versions starting with 0.25 as they are not backwards\n  compatible with 0.24"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee24f116171288e2622d5608541dabdd60494355", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/ee24f116171288e2622d5608541dabdd60494355", "committedDate": "2020-08-11T13:12:29Z", "message": "chore(atomix/cluster): handle SnapshotChunk deserialization failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "464ea5670fe1e17c1fe6cce25bf7a5646a3a0c52", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/464ea5670fe1e17c1fe6cce25bf7a5646a3a0c52", "committedDate": "2020-08-11T13:56:57Z", "message": "chore(upgrade-tests): add missing dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MjI5Mzg3", "url": "https://github.com/camunda-cloud/zeebe/pull/5157#pullrequestreview-468229387", "createdAt": "2020-08-17T07:31:07Z", "commit": {"oid": "464ea5670fe1e17c1fe6cce25bf7a5646a3a0c52"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwNzozMTowN1rOHBdc8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwNzozMjoyNlrOHBdfQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI5MzE3MA==", "bodyText": "Why do you need this \"ZEEBE_CI_SHARED_DATA\"?", "url": "https://github.com/camunda-cloud/zeebe/pull/5157#discussion_r471293170", "createdAt": "2020-08-17T07:31:07Z", "author": {"login": "deepthidevaki"}, "path": "upgrade-tests/src/test/java/io/zeebe/test/RollingUpdateTest.java", "diffHunk": "@@ -52,6 +58,19 @@\n           .endEvent()\n           .done();\n \n+  private static final File SHARED_DATA;\n+\n+  static {\n+    final var sharedDataPath =\n+        Optional.ofNullable(System.getenv(\"ZEEBE_CI_SHARED_DATA\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464ea5670fe1e17c1fe6cce25bf7a5646a3a0c52"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI5Mzc2MA==", "bodyText": "Would be good to check if it is the right type by \"tryWrap\".", "url": "https://github.com/camunda-cloud/zeebe/pull/5157#discussion_r471293760", "createdAt": "2020-08-17T07:32:26Z", "author": {"login": "deepthidevaki"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/PassiveRole.java", "diffHunk": "@@ -186,7 +188,18 @@ private void addSnapshotListener() {\n     }\n \n     final var snapshotChunk = new SnapshotChunkImpl();\n-    snapshotChunk.wrap(new UnsafeBuffer(request.data()), 0, request.data().capacity());\n+    try {\n+      snapshotChunk.wrap(new UnsafeBuffer(request.data()), 0, request.data().capacity());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464ea5670fe1e17c1fe6cce25bf7a5646a3a0c52"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0618f9b02172a7e68d35c89a1ac747c97ac40bd2", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/0618f9b02172a7e68d35c89a1ac747c97ac40bd2", "committedDate": "2020-08-18T11:59:06Z", "message": "chore(atomix/cluster): use tryWrap instead of exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2223a6d902506030bacf0e8bf4577fc69374847d", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/2223a6d902506030bacf0e8bf4577fc69374847d", "committedDate": "2020-08-18T11:59:17Z", "message": "chore(upgrade-tests): explain CI shared mount point"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae4c710cad37a9ce6133fd300ae1d087e811f8c8", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/ae4c710cad37a9ce6133fd300ae1d087e811f8c8", "committedDate": "2020-08-18T12:27:38Z", "message": "chore(atomix/cluster): fix error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTYwMzc2", "url": "https://github.com/camunda-cloud/zeebe/pull/5157#pullrequestreview-470160376", "createdAt": "2020-08-19T06:32:14Z", "commit": {"oid": "ae4c710cad37a9ce6133fd300ae1d087e811f8c8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNjozMjoxNFrOHC25Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNjozMjoxNFrOHC25Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc1ODU3MQ==", "bodyText": "The name tryWrap is a misnomer. It only checks the headers, but it doesn't wrap the content. So we have to call snapshotChunk.wrap() again.", "url": "https://github.com/camunda-cloud/zeebe/pull/5157#discussion_r472758571", "createdAt": "2020-08-19T06:32:14Z", "author": {"login": "deepthidevaki"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/PassiveRole.java", "diffHunk": "@@ -186,7 +188,15 @@ private void addSnapshotListener() {\n     }\n \n     final var snapshotChunk = new SnapshotChunkImpl();\n-    snapshotChunk.wrap(new UnsafeBuffer(request.data()), 0, request.data().capacity());\n+    final var snapshotChunkBuffer = new UnsafeBuffer(request.data());\n+    if (!snapshotChunk.tryWrap(snapshotChunkBuffer)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae4c710cad37a9ce6133fd300ae1d087e811f8c8"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a59e9f382db3104059b3ec3455fb2510c0a3d5", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/17a59e9f382db3104059b3ec3455fb2510c0a3d5", "committedDate": "2020-08-19T07:30:58Z", "message": "chore(atomix/cluster): wrap body in tryWrap if possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26b5cd74e0148543af9d5b6fd12a40ab4745ff6e", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/26b5cd74e0148543af9d5b6fd12a40ab4745ff6e", "committedDate": "2020-08-19T07:32:01Z", "message": "chore(protocol-impl): keep tryWrap behaviour consistent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDM5MjUz", "url": "https://github.com/camunda-cloud/zeebe/pull/5157#pullrequestreview-470439253", "createdAt": "2020-08-19T13:09:36Z", "commit": {"oid": "26b5cd74e0148543af9d5b6fd12a40ab4745ff6e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2636, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}