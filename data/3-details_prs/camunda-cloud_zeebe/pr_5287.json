{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NDEyODE1", "number": 5287, "title": "Improve atomix startup and snapshot replication logs", "bodyText": "Description\n\nAdd more logs at info level during raft startup\nAdd more logs for snapshot replication at info level\nImprove error log when appender fails\n\nRelated issues\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-09-03T07:11:17Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5287", "merged": true, "mergeCommit": {"oid": "5efa106a09676e0377cbdf80c272f4d9faff635b"}, "closed": true, "closedAt": "2020-09-03T10:14:20Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE8agHgH2gAyNDc4NDEyODE1OmI0OTE5ZjIyNzhhOWQzNmVmOWNkYjliYzRiMDU1NzQ1OTQ1Zjk0YTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFNL7VgBqjM3MjM3OTM1MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b4919f2278a9d36ef9cdb9bc4b055745945f94a4", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/b4919f2278a9d36ef9cdb9bc4b055745945f94a4", "committedDate": "2020-09-02T13:56:11Z", "message": "chore(atomix): add more logs snapshot replication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1537dbfa0a66957559355cc375486c575f4ad6c7", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/1537dbfa0a66957559355cc375486c575f4ad6c7", "committedDate": "2020-09-02T14:46:01Z", "message": "chore(atomix): improve raft startup logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTY1OTg3", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#pullrequestreview-481565987", "createdAt": "2020-09-03T07:28:28Z", "commit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzoyODoyOFrOHMZn2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzozNDozNVrOHMZ1aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NDc2MQ==", "bodyText": "Since this case is not a failure, do we want to reduce the log level to DEBUG instead?\nOr, is it useful to see these log statements on WARN?", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#discussion_r482764761", "createdAt": "2020-09-03T07:28:28Z", "author": {"login": "saig0"}, "path": "logstreams/src/main/java/io/zeebe/logstreams/impl/log/Listener.java", "diffHunk": "@@ -27,13 +28,17 @@ public void onWrite(final long address) {\n \n   @Override\n   public void onWriteError(final Throwable error) {\n-    LogStorageAppender.LOG.error(\n-        \"Failed to append block with last event position {}.\", highestPosition, error);\n-    if (error instanceof NoSuchElementException) {\n+    if (error instanceof NoSuchElementException || error instanceof NoLeader) {\n       // Not a failure. It is probably during transition to follower.\n+      LogStorageAppender.LOG.warn(\n+          \"Failed to append block with last event position {}. This can happen during a leader change.\",\n+          highestPosition,\n+          error);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2ODIzNQ==", "bodyText": "You changed the hashCode() and equals() implementation.\nWhy did you change it?\nDoes this change any behavior?", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#discussion_r482768235", "createdAt": "2020-09-03T07:34:35Z", "author": {"login": "saig0"}, "path": "snapshot/src/main/java/io/zeebe/snapshots/broker/impl/FileBasedSnapshotMetadata.java", "diffHunk": "@@ -122,34 +122,37 @@ public String getSnapshotIdAsString() {\n \n   @Override\n   public int hashCode() {\n-    return Objects.hash(getIndex(), getTerm(), getTimestamp());\n+    return Objects.hash(index, term, processedPosition, exporterPosition);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ffc3617cd318453e99354743b7d1b8e9a073c85", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/8ffc3617cd318453e99354743b7d1b8e9a073c85", "committedDate": "2020-09-03T06:52:15Z", "message": "chore(broker): improve error messages"}, "afterCommit": {"oid": "ac228185b8ee65ca1cda3410a77c93fb7ef30c14", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/ac228185b8ee65ca1cda3410a77c93fb7ef30c14", "committedDate": "2020-09-03T09:05:46Z", "message": "chore(broker): improve error messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNjU2MTk1", "url": "https://github.com/camunda-cloud/zeebe/pull/5287#pullrequestreview-481656195", "createdAt": "2020-09-03T09:22:11Z", "commit": {"oid": "cf369df3ced492c91b46989021aae8891b4351ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e031c0821fe3fe98bf6b2d61c61cec9966dba65", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/4e031c0821fe3fe98bf6b2d61c61cec9966dba65", "committedDate": "2020-09-03T09:28:16Z", "message": "chore(broker): improve appender error messages"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf369df3ced492c91b46989021aae8891b4351ee", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/cf369df3ced492c91b46989021aae8891b4351ee", "committedDate": "2020-09-03T09:11:41Z", "message": "chore(broker): set appender failure log to debug"}, "afterCommit": {"oid": "4e031c0821fe3fe98bf6b2d61c61cec9966dba65", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/4e031c0821fe3fe98bf6b2d61c61cec9966dba65", "committedDate": "2020-09-03T09:28:16Z", "message": "chore(broker): improve appender error messages"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2591, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}