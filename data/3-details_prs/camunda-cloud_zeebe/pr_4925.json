{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODY3NTY3", "number": 4925, "title": "fix(broker): fix OOM on restart", "bodyText": "Description\n\nSplit up apply all method into chunks of 1000 (this gives other tasks a chance to be processed by the task queue)\nChange condition when task to change raft state and notify listeners is scheduled (this leads to much fewer tasks)\n\nRelated issues\ncloses #4871\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release annoncement", "createdAt": "2020-07-09T13:39:44Z", "url": "https://github.com/camunda-cloud/zeebe/pull/4925", "merged": true, "mergeCommit": {"oid": "7d0df9965a2223bc15962f3dde7500daf6875927"}, "closed": true, "closedAt": "2020-07-09T15:13:14Z", "author": {"login": "pihme"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy5UWrgH2gAyNDQ2ODY3NTY3Ojc5ZDNhOTdiZjZkOTY4YzI2OTA5ODIxMmJkMjkxZjYwZGQ2ZmM1NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczPsXHgFqTQ0NTY1NzE3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79d3a97bf6d968c269098212bd291f60dd6fc55e", "author": {"user": {"login": "pihme", "name": "Peter Ihme"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/79d3a97bf6d968c269098212bd291f60dd6fc55e", "committedDate": "2020-07-08T12:09:07Z", "message": "fix(broker): fix OOM on restart"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NjQyNzM2", "url": "https://github.com/camunda-cloud/zeebe/pull/4925#pullrequestreview-445642736", "createdAt": "2020-07-09T13:58:08Z", "commit": {"oid": "79d3a97bf6d968c269098212bd291f60dd6fc55e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzo1ODowOVrOGvSaeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzo1ODowOVrOGvSaeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzNzk0Ng==", "bodyText": "Now when I think about it more, it is not necessary to schedule a task for this here. setLastApplied is called from the same thread context. So we can immediately execute it and no need to schedule it as a separate task.", "url": "https://github.com/camunda-cloud/zeebe/pull/4925#discussion_r452237946", "createdAt": "2020-07-09T13:58:09Z", "author": {"login": "deepthidevaki"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/impl/RaftContext.java", "diffHunk": "@@ -371,7 +371,7 @@ public long setCommitIndex(final long commitIndex) {\n   public void setLastApplied(final long lastApplied, final long lastAppliedTerm) {\n     this.lastApplied = Math.max(this.lastApplied, lastApplied);\n     this.lastAppliedTerm = Math.max(this.lastAppliedTerm, lastAppliedTerm);\n-    if (state == State.ACTIVE) {\n+    if (state == State.ACTIVE && this.lastApplied >= firstCommitIndex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79d3a97bf6d968c269098212bd291f60dd6fc55e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NjU3MTc1", "url": "https://github.com/camunda-cloud/zeebe/pull/4925#pullrequestreview-445657175", "createdAt": "2020-07-09T14:13:15Z", "commit": {"oid": "79d3a97bf6d968c269098212bd291f60dd6fc55e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2681, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}