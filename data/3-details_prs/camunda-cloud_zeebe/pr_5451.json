{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2MDk5MzE0", "number": 5451, "title": "[Backport 0.24] Admin api for brokers", "bodyText": "Description\n\nEnable pausing of streamprocessor\nBackport partitions actuator api from #5408\n\nRelated issues\ncloses #5405\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-10-01T09:12:32Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5451", "merged": true, "mergeCommit": {"oid": "d3d46874cecf9b85814b879d91486afa2193fc2c"}, "closed": true, "closedAt": "2020-10-02T07:25:45Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMRnkeAH2gAyNDk2MDk5MzE0Ojg0ZTljOWQyMTE3MTg5OTk4YTAzODJmNDIzODZlMGUzZGU0M2IwYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOgVBfABqjM4MzI2MDU1MTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "84e9c9d2117189998a0382f42386e0e3de43b0a5", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/84e9c9d2117189998a0382f42386e0e3de43b0a5", "committedDate": "2020-09-25T08:35:56Z", "message": "chore(engine): enable stream processor to be paused and resumed on command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMTY2NzEw", "url": "https://github.com/camunda-cloud/zeebe/pull/5451#pullrequestreview-500166710", "createdAt": "2020-10-01T09:28:38Z", "commit": {"oid": "acc5880c667f11cf6b5c825188386a23e659245f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwOToyODozOFrOHbCEeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwOToyODozOFrOHbCEeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODEwNzUxNA==", "bodyText": "I added this test to test the follower status. It is not in original PR. Once this is reviewed, I will port it to develop.", "url": "https://github.com/camunda-cloud/zeebe/pull/5451#discussion_r498107514", "createdAt": "2020-10-01T09:28:38Z", "author": {"login": "deepthidevaki"}, "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/system/BrokerAdminServiceTest.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.broker.it.system;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import io.atomix.raft.RaftServer.Role;\n+import io.zeebe.broker.Broker;\n+import io.zeebe.broker.it.clustering.ClusteringRule;\n+import io.zeebe.broker.it.util.GrpcClientRule;\n+import io.zeebe.broker.system.management.BrokerAdminService;\n+import io.zeebe.engine.processor.StreamProcessor.Phase;\n+import org.awaitility.Awaitility;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.RuleChain;\n+import org.junit.rules.Timeout;\n+\n+public class BrokerAdminServiceTest {\n+  private final Timeout testTimeout = Timeout.seconds(60);\n+  private final ClusteringRule clusteringRule =\n+      new ClusteringRule(\n+          1,\n+          3,\n+          3,\n+          cfg -> {\n+            cfg.getData().setLogIndexDensity(1);\n+          });\n+  private final GrpcClientRule clientRule = new GrpcClientRule(clusteringRule);\n+\n+  @Rule\n+  public RuleChain ruleChain =\n+      RuleChain.outerRule(testTimeout).around(clusteringRule).around(clientRule);\n+\n+  private BrokerAdminService leaderAdminService;\n+  private Broker leader;\n+\n+  @Before\n+  public void before() {\n+    leader = clusteringRule.getBroker(clusteringRule.getLeaderForPartition(1).getNodeId());\n+    leaderAdminService = leader.getBrokerAdminService();\n+  }\n+\n+  @Test\n+  public void shouldReportPartitionStatus() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acc5880c667f11cf6b5c825188386a23e659245f"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzMwNDMz", "url": "https://github.com/camunda-cloud/zeebe/pull/5451#pullrequestreview-500330433", "createdAt": "2020-10-01T13:11:53Z", "commit": {"oid": "acc5880c667f11cf6b5c825188386a23e659245f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9d94622f63f6c9735bcb457b2f74232198ba8e3", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/f9d94622f63f6c9735bcb457b2f74232198ba8e3", "committedDate": "2020-10-02T06:50:35Z", "message": "chore(broker): add admin service to trigger snapshots and pause processing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7be0cc77148952fb8280ceabee78228ed652b0c", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a7be0cc77148952fb8280ceabee78228ed652b0c", "committedDate": "2020-10-02T06:50:39Z", "message": "feat(broker): expose webendpoints to trigger snapshots and pause processing externally"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acc5880c667f11cf6b5c825188386a23e659245f", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/acc5880c667f11cf6b5c825188386a23e659245f", "committedDate": "2020-10-01T07:22:47Z", "message": "chore(broker): add test"}, "afterCommit": {"oid": "a7be0cc77148952fb8280ceabee78228ed652b0c", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a7be0cc77148952fb8280ceabee78228ed652b0c", "committedDate": "2020-10-02T06:50:39Z", "message": "feat(broker): expose webendpoints to trigger snapshots and pause processing externally"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2540, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}