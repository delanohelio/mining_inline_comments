{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwOTIyNDk2", "number": 5215, "title": "[Backport 0.23] Replicate snapshot faster", "bodyText": "Description\n\nBackport of #5189\nRelated issues\n\ncloses #5135", "createdAt": "2020-08-20T13:47:21Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5215", "merged": true, "mergeCommit": {"oid": "6a23d0eae0e63d3b37294c875f8b53fa91d71625"}, "closed": true, "closedAt": "2020-08-20T14:37:03Z", "author": {"login": "deepthidevaki"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAs_KfgH2gAyNDcwOTIyNDk2OjU1M2M3MGZmNzZkN2Y0NDI3MzdjZGU4MDVkNTRiMTI3Y2YwOTQyNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAwt6xAFqTQ3MTY0NjQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e", "author": {"user": {"login": "deepthidevaki", "name": "Deepthi Devaki Akkoorath"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/553c70ff76d7f442737cde805d54b127cf09426e", "committedDate": "2020-08-20T09:42:03Z", "message": "fix(atomix): donot build snapshot reader for each install request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjM5NjEx", "url": "https://github.com/camunda-cloud/zeebe/pull/5215#pullrequestreview-471639611", "createdAt": "2020-08-20T13:55:36Z", "commit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjQ2NDgy", "url": "https://github.com/camunda-cloud/zeebe/pull/5215#pullrequestreview-471646482", "createdAt": "2020-08-20T14:02:50Z", "commit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMjo1MFrOHEDIsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMjo1MFrOHEDIsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwNzczMQ==", "bodyText": "I removed this synchronized. I think it is not required. What do you think? @Zelldon", "url": "https://github.com/camunda-cloud/zeebe/pull/5215#discussion_r474007731", "createdAt": "2020-08-20T14:02:50Z", "author": {"login": "deepthidevaki"}, "path": "atomix/cluster/src/main/java/io/atomix/raft/roles/AbstractAppender.java", "diffHunk": "@@ -447,45 +449,63 @@ protected void handleConfigureResponseError(\n     // This prevents infinite loops when cluster configurations fail.\n   }\n \n-  /** Builds an install request for the given member. */\n-  protected InstallRequest buildInstallRequest(\n+  /**\n+   * Builds an install request for the given member.\n+   *\n+   * @return\n+   */\n+  protected Optional<InstallRequest> buildInstallRequest(\n       final RaftMemberContext member, final Snapshot snapshot) {\n     if (member.getNextSnapshotIndex() != snapshot.index()) {\n+      try {\n+        final SnapshotChunkReader snapshotChunkReader = snapshot.newChunkReader();\n+        member.setSnapshotChunkReader(snapshotChunkReader);\n+      } catch (final UncheckedIOException e) {\n+        log.warn(\n+            \"Expected to send Snapshot {} to {}. But could not open SnapshotChunkReader. Will retry.\",\n+            snapshot.getPath(),\n+            e);\n+        return Optional.empty();\n+      }\n       member.setNextSnapshotIndex(snapshot.index());\n       member.setNextSnapshotChunk(null);\n     }\n \n     final InstallRequest request;\n-    synchronized (snapshot) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "553c70ff76d7f442737cde805d54b127cf09426e"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2562, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}