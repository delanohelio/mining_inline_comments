{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzI2ODIy", "number": 3811, "title": "chore(gateway): prevent exceptions on already cancelled calls", "bodyText": "Description\n\nadds a check in the long polling request context to avoid completing cancelled requests\nprevents throwing an exception on cancelled calls and instead log it at TRACE level\n\nRelated issues\ncloses #3767\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-02-08T15:33:39Z", "url": "https://github.com/camunda-cloud/zeebe/pull/3811", "merged": true, "mergeCommit": {"oid": "b8c8bcdc6072e40e801e1542a85040bb1236f5f3"}, "closed": true, "closedAt": "2020-02-24T11:09:18Z", "author": {"login": "npepinpe"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCVs-sAH2gAyMzcyNzI2ODIyOjIxYjYzMjBmMzMxN2JiZDk1ZjVhNTBkMjdlNzUyMGIxOGUzMjk4MWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGi3W-AFqTM2Mjc4MTEwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "21b6320f3317bbd95f5a50d27e7520b18e32981c", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/21b6320f3317bbd95f5a50d27e7520b18e32981c", "committedDate": "2020-02-08T15:31:04Z", "message": "chore(gateway): prevent exceptions on already cancelled calls\n\n- adds a check in the long polling request context to avoid completing\n  cancelled requests\n- prevents throwing an exception on cancelled calls and instead log it\n  at TRACE level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTc4MjQy", "url": "https://github.com/camunda-cloud/zeebe/pull/3811#pullrequestreview-359578242", "createdAt": "2020-02-17T09:08:22Z", "commit": {"oid": "21b6320f3317bbd95f5a50d27e7520b18e32981c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTowODoyMlrOFqc3Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTowODoyMlrOFqc3Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1NzM4Mw==", "bodyText": "Could we somehow reuse the method sendRequest, i dont like this duplication.", "url": "https://github.com/camunda-cloud/zeebe/pull/3811#discussion_r380057383", "createdAt": "2020-02-17T09:08:22Z", "author": {"login": "Zelldon"}, "path": "gateway/src/main/java/io/zeebe/gateway/EndpointManager.java", "diffHunk": "@@ -320,6 +326,11 @@ public void updateJobRetries(\n       return;\n     }\n \n+    final ServerCallStreamObserver<GrpcResponseT> serverObserver =\n+        (ServerCallStreamObserver<GrpcResponseT>) streamObserver;\n+    serverObserver.setOnCancelHandler(\n+        () -> Loggers.GATEWAY_LOGGER.trace(\"gRPC {} request cancelled\", grpcRequest.getClass()));\n+\n     brokerClient.sendRequest(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b6320f3317bbd95f5a50d27e7520b18e32981c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2be57d3437a672509f4d8d75e0aec839321bc87", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/a2be57d3437a672509f4d8d75e0aec839321bc87", "committedDate": "2020-02-18T20:56:49Z", "message": "chore(gateway): extract helper method to reduce duplication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abe08abc220a47471bc160ffa7de54fe7ec17ecb", "author": {"user": {"login": "npepinpe", "name": "Nicolas Pepin-Perreault"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/abe08abc220a47471bc160ffa7de54fe7ec17ecb", "committedDate": "2020-02-18T20:57:09Z", "message": "chore(gateway): remove unused methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTg4NDg4", "url": "https://github.com/camunda-cloud/zeebe/pull/3811#pullrequestreview-362588488", "createdAt": "2020-02-21T12:13:09Z", "commit": {"oid": "abe08abc220a47471bc160ffa7de54fe7ec17ecb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjoxMzowOVrOFs0_yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjoxMzowOVrOFs0_yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU0OTk2Mg==", "bodyText": "What happend before without the handler again? Sorry \ud83d\ude05", "url": "https://github.com/camunda-cloud/zeebe/pull/3811#discussion_r382549962", "createdAt": "2020-02-21T12:13:09Z", "author": {"login": "Zelldon"}, "path": "gateway/src/main/java/io/zeebe/gateway/EndpointManager.java", "diffHunk": "@@ -320,13 +322,22 @@ public void updateJobRetries(\n       return;\n     }\n \n+    suppressCancelledException(grpcRequest, streamObserver);\n     brokerClient.sendRequest(\n         brokerRequest,\n         (key, response) -> consumeResponse(responseMapper, streamObserver, key, response),\n         error -> streamObserver.onError(convertThrowable(error)),\n         timeout);\n   }\n \n+  private <GrpcRequestT, GrpcResponseT> void suppressCancelledException(\n+      final GrpcRequestT grpcRequest, final StreamObserver<GrpcResponseT> streamObserver) {\n+    final ServerCallStreamObserver<GrpcResponseT> serverObserver =\n+        (ServerCallStreamObserver<GrpcResponseT>) streamObserver;\n+    serverObserver.setOnCancelHandler(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe08abc220a47471bc160ffa7de54fe7ec17ecb"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzgxMTAx", "url": "https://github.com/camunda-cloud/zeebe/pull/3811#pullrequestreview-362781101", "createdAt": "2020-02-21T17:06:52Z", "commit": {"oid": "abe08abc220a47471bc160ffa7de54fe7ec17ecb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3119, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}