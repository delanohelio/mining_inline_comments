{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MzMxNzYy", "number": 5190, "title": "Elasticsearch exporter: limit the memory size of a bulk ", "bodyText": "Description\n\nnew configuration to limit the memory size of the bulk before flushing it, default is 10 MB\nnew metric for the bulk memory size\nadjust documentation and configuration templates\n\nRelated issues\ncloses #4951\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-08-18T09:33:50Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5190", "merged": true, "mergeCommit": {"oid": "7faa98f82d2e1e5770b52cbf520bb37661c620d7"}, "closed": true, "closedAt": "2020-08-19T04:39:24Z", "author": {"login": "saig0"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAGNx5gFqTQ2OTM4MTU4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdATt8igBqjM2Njg5ODY0MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MzgxNTgw", "url": "https://github.com/camunda-cloud/zeebe/pull/5190#pullrequestreview-469381580", "createdAt": "2020-08-18T12:21:14Z", "commit": {"oid": "2bb72f70cee77050f97b38c91254a237a8ac1c30"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyMToxNFrOHCQ2bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjozMDozOFrOHCRLXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzNTI3OQ==", "bodyText": "is\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              2. when the batch memory size is below 10 MB\n          \n          \n            \n              2. when the batch memory size exceeds 10 MB", "url": "https://github.com/camunda-cloud/zeebe/pull/5190#discussion_r472135279", "createdAt": "2020-08-18T12:21:14Z", "author": {"login": "pihme"}, "path": "exporters/elasticsearch-exporter/README.md", "diffHunk": "@@ -38,24 +38,27 @@ it should be flushed (regardless of size) can be controlled by configuration.\n For example:\n \n ```yaml\n-...  \n+...\n   exporters:\n     elasticsearch:\n       args:\n         delay: 5\n         size: 1000\n+        memoryLimit: 10485760\n ```\n \n With the above example, the exporter would aggregate records and flush them to Elasticsearch\n either:\n   1. when it has aggregated 1000 records\n-  2. 5 seconds have elapsed since the last flush (regardless of how many records were aggregated)\n+  2. when the batch memory size is below 10 MB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb72f70cee77050f97b38c91254a237a8ac1c30"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE0MDYzNw==", "bodyText": "(Optional) Maybe also add a lower boundary; in case someone enters 10 in the configuration thinking it will be 10 MB", "url": "https://github.com/camunda-cloud/zeebe/pull/5190#discussion_r472140637", "createdAt": "2020-08-18T12:30:38Z", "author": {"login": "pihme"}, "path": "exporters/elasticsearch-exporter/src/main/java/io/zeebe/exporter/ElasticsearchExporter.java", "diffHunk": "@@ -92,6 +95,12 @@ private void validate(final ElasticsearchExporterConfiguration configuration) {\n               \"Elasticsearch prefix must not contain underscore. Current value: %s\",\n               configuration.index.prefix));\n     }\n+\n+    if (configuration.bulk.memoryLimit > RECOMMENDED_MAX_BULK_MEMORY_LIMIT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb72f70cee77050f97b38c91254a237a8ac1c30"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d158c91af824140b65d0179a22476d7db07702a4", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d158c91af824140b65d0179a22476d7db07702a4", "committedDate": "2020-08-19T04:15:20Z", "message": "fix(exporters/elasticsearch-exporter): limit the memory size of a bulk\n\n* new configuration to limit the memory size of the bulk before flushing it, default is 10 MB\n* new metric for the bulk memory size\n* adjust documentation and configuration templates"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7eb1666f17134168f67b9891f20a250ec925bb48", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/7eb1666f17134168f67b9891f20a250ec925bb48", "committedDate": "2020-08-19T03:59:35Z", "message": "chore(exporters/elasticsearch-exporter): apply suggestion\n\nCo-authored-by: Peter Ihme <pihme@users.noreply.github.com>"}, "afterCommit": {"oid": "d158c91af824140b65d0179a22476d7db07702a4", "author": {"user": {"login": "saig0", "name": "Philipp Ossler"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/d158c91af824140b65d0179a22476d7db07702a4", "committedDate": "2020-08-19T04:15:20Z", "message": "fix(exporters/elasticsearch-exporter): limit the memory size of a bulk\n\n* new configuration to limit the memory size of the bulk before flushing it, default is 10 MB\n* new metric for the bulk memory size\n* adjust documentation and configuration templates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2553, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}