{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMzE2Nzg2", "number": 3775, "title": "chore(upgrade-tests): add basic upgradability test", "bodyText": "Description\nAdds two tests cases to check that:\n\na pending workflow instance can be continued after updating a broker with a embedded gateway\na gateway with an older version can contact a newer broker and complete an instance\n\nRelated issues\ncloses #3743\ncloses #3791\nPull Request Checklist\n\n All commit messages match our commit message guidelines\n The submitting code follows our code style\n If submitting code, please run mvn clean install -DskipTests locally before committing", "createdAt": "2020-02-03T13:24:08Z", "url": "https://github.com/camunda-cloud/zeebe/pull/3775", "merged": true, "mergeCommit": {"oid": "5bbc2db5733fce2c5e020c4cd5b7aa375c0566da"}, "closed": true, "closedAt": "2020-02-10T15:44:14Z", "author": {"login": "MiguelPires"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBmyhdgBqjMwMTI5ODQ0MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC-u6QgBqjMwMjMxNDUzMDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65009b72cf24ace18db9e958d7874cd9ceef9306", "author": {"user": null}, "url": "https://github.com/camunda-cloud/zeebe/commit/65009b72cf24ace18db9e958d7874cd9ceef9306", "committedDate": "2020-02-03T13:22:38Z", "message": "chore(upgrade-tests): add basic upgradability test"}, "afterCommit": {"oid": "eb3a50ff8dcfaa9428ed514ee5ddea91e55a4482", "author": {"user": null}, "url": "https://github.com/camunda-cloud/zeebe/commit/eb3a50ff8dcfaa9428ed514ee5ddea91e55a4482", "committedDate": "2020-02-06T08:48:02Z", "message": "chore(upgrade-tests): add basic upgradability test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NDMzMDEw", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#pullrequestreview-354433010", "createdAt": "2020-02-06T13:05:25Z", "commit": {"oid": "2331a3633cc577e37985163fada8805d22467161"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzowNToyNVrOFmaUwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzoxMToyOFrOFmafQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMTUwNg==", "bodyText": "Can you upgrade to the latest release 0.22.1?", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375821506", "createdAt": "2020-02-06T13:05:25Z", "author": {"login": "npepinpe"}, "path": "parent/pom.xml", "diffHunk": "@@ -78,6 +80,7 @@\n     <version.asm>7.3.1</version.asm>\n     <version.testcontainers>1.12.5</version.testcontainers>\n     <version.netflix.concurrency>0.3.6</version.netflix.concurrency>\n+    <version.zeebe-test-container>0.21.0-alpha2</version.zeebe-test-container>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2331a3633cc577e37985163fada8805d22467161"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMTczNA==", "bodyText": "I guess copy and paste leftover?", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375821734", "createdAt": "2020-02-06T13:05:57Z", "author": {"login": "npepinpe"}, "path": "upgrade-tests/pom.xml", "diffHunk": "@@ -0,0 +1,73 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+  <name>Zeebe Upgradability Tests</name>\n+  <artifactId>zeebe-upgrade-tests</artifactId>\n+  <packaging>jar</packaging>\n+\n+  <parent>\n+    <groupId>io.zeebe</groupId>\n+    <artifactId>zeebe-parent</artifactId>\n+    <version>0.23.0-SNAPSHOT</version>\n+    <relativePath>../parent</relativePath>\n+  </parent>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>testcontainers</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.zeebe</groupId>\n+      <artifactId>zeebe-test-util</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>slf4j-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.zeebe</groupId>\n+      <artifactId>zeebe-test-container</artifactId>\n+      <version>0.21.0-alpha2</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2331a3633cc577e37985163fada8805d22467161"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMTkwNw==", "bodyText": "What happens if we remove this?", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375821907", "createdAt": "2020-02-06T13:06:19Z", "author": {"login": "npepinpe"}, "path": "upgrade-tests/pom.xml", "diffHunk": "@@ -0,0 +1,73 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+  <name>Zeebe Upgradability Tests</name>\n+  <artifactId>zeebe-upgrade-tests</artifactId>\n+  <packaging>jar</packaging>\n+\n+  <parent>\n+    <groupId>io.zeebe</groupId>\n+    <artifactId>zeebe-parent</artifactId>\n+    <version>0.23.0-SNAPSHOT</version>\n+    <relativePath>../parent</relativePath>\n+  </parent>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.testcontainers</groupId>\n+      <artifactId>testcontainers</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.zeebe</groupId>\n+      <artifactId>zeebe-test-util</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>slf4j-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.zeebe</groupId>\n+      <artifactId>zeebe-test-container</artifactId>\n+      <version>0.21.0-alpha2</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.zeebe</groupId>\n+      <artifactId>zeebe-client-java</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.zeebe</groupId>\n+      <artifactId>zeebe-bpmn-model</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>junit</groupId>\n+      <artifactId>junit</artifactId>\n+    </dependency>\n+\n+  </dependencies>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-surefire-plugin</artifactId>\n+        <configuration>\n+          <argLine>-Xmx2048m -XX:MaxDirectMemorySize=4g</argLine>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2331a3633cc577e37985163fada8805d22467161"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMjQ5OA==", "bodyText": "Good idea \ud83d\udc4d", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375822498", "createdAt": "2020-02-06T13:07:40Z", "author": {"login": "npepinpe"}, "path": "upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java", "diffHunk": "@@ -0,0 +1,192 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.test;\n+\n+import io.zeebe.client.ZeebeClient;\n+import io.zeebe.client.api.response.ActivateJobsResponse;\n+import io.zeebe.containers.ZeebePort;\n+import io.zeebe.containers.broker.ZeebeBrokerContainer;\n+import io.zeebe.containers.gateway.ZeebeGatewayContainer;\n+import io.zeebe.model.bpmn.Bpmn;\n+import io.zeebe.model.bpmn.BpmnModelInstance;\n+import io.zeebe.test.util.TestUtil;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestWatcher;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.Description;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.slf4j.event.Level;\n+import org.testcontainers.containers.Network;\n+\n+public class UpgradeTest {\n+\n+  public static final Logger LOG = LoggerFactory.getLogger(UpgradeTest.class);\n+  private static final String CURRENT_VERSION = \"current-test\";\n+  private static final String PROCESS_ID = \"process\";\n+  private static final String TASK = \"task\";\n+\n+  private static final BpmnModelInstance WORKFLOW =\n+      Bpmn.createExecutableProcess(PROCESS_ID)\n+          .startEvent()\n+          .serviceTask(TASK, t -> t.zeebeTaskType(TASK))\n+          .endEvent()\n+          .done();\n+\n+  private static String lastVersion = \"0.22.1\";\n+  @Rule public Timeout timeout = new Timeout(60, TimeUnit.SECONDS);\n+  @Rule public TemporaryFolder temp = new TemporaryFolder();\n+\n+  private ZeebeBrokerContainer container;\n+  private ZeebeGatewayContainer gateway;\n+  private ZeebeClient client;\n+  private Network network;\n+\n+  @Rule(order = Integer.MIN_VALUE)\n+  public TestWatcher watchman =\n+      new TestWatcher() {\n+        @Override\n+        protected void succeeded(Description description) {\n+          close();\n+        }\n+\n+        @Override\n+        protected void failed(Throwable e, Description description) {\n+          if (container != null) {\n+            LOG.error(container.getLogs());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2331a3633cc577e37985163fada8805d22467161"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyNDE5NQ==", "bodyText": "Maybe we can prefix these? e.g.\n===============================================\nBroker logs\n===============================================\n...\n...\n...\n\n\n===============================================\nGateway logs\n===============================================\n...\n...", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375824195", "createdAt": "2020-02-06T13:11:28Z", "author": {"login": "npepinpe"}, "path": "upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java", "diffHunk": "@@ -0,0 +1,192 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.test;\n+\n+import io.zeebe.client.ZeebeClient;\n+import io.zeebe.client.api.response.ActivateJobsResponse;\n+import io.zeebe.containers.ZeebePort;\n+import io.zeebe.containers.broker.ZeebeBrokerContainer;\n+import io.zeebe.containers.gateway.ZeebeGatewayContainer;\n+import io.zeebe.model.bpmn.Bpmn;\n+import io.zeebe.model.bpmn.BpmnModelInstance;\n+import io.zeebe.test.util.TestUtil;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestWatcher;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.Description;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.slf4j.event.Level;\n+import org.testcontainers.containers.Network;\n+\n+public class UpgradeTest {\n+\n+  public static final Logger LOG = LoggerFactory.getLogger(UpgradeTest.class);\n+  private static final String CURRENT_VERSION = \"current-test\";\n+  private static final String PROCESS_ID = \"process\";\n+  private static final String TASK = \"task\";\n+\n+  private static final BpmnModelInstance WORKFLOW =\n+      Bpmn.createExecutableProcess(PROCESS_ID)\n+          .startEvent()\n+          .serviceTask(TASK, t -> t.zeebeTaskType(TASK))\n+          .endEvent()\n+          .done();\n+\n+  private static String lastVersion = \"0.22.1\";\n+  @Rule public Timeout timeout = new Timeout(60, TimeUnit.SECONDS);\n+  @Rule public TemporaryFolder temp = new TemporaryFolder();\n+\n+  private ZeebeBrokerContainer container;\n+  private ZeebeGatewayContainer gateway;\n+  private ZeebeClient client;\n+  private Network network;\n+\n+  @Rule(order = Integer.MIN_VALUE)\n+  public TestWatcher watchman =\n+      new TestWatcher() {\n+        @Override\n+        protected void succeeded(Description description) {\n+          close();\n+        }\n+\n+        @Override\n+        protected void failed(Throwable e, Description description) {\n+          if (container != null) {\n+            LOG.error(container.getLogs());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMjQ5OA=="}, "originalCommit": {"oid": "2331a3633cc577e37985163fada8805d22467161"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTU2MzA3", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#pullrequestreview-355556307", "createdAt": "2020-02-08T16:38:47Z", "commit": {"oid": "d408decc785a5ab9843956e74bdab2b2582d9723"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MDA4Mjgx", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#pullrequestreview-356008281", "createdAt": "2020-02-10T15:05:01Z", "commit": {"oid": "9eba64d2253fd5a183b5da19e365ef54c631c06a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "author": {"user": null}, "url": "https://github.com/camunda-cloud/zeebe/commit/5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "committedDate": "2020-02-10T15:17:14Z", "message": "chore(upgrade-tests): add upgradability tests\n\n* upgrade broker with embedded gateway\n* older gateway with newer broker"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9eba64d2253fd5a183b5da19e365ef54c631c06a", "author": {"user": null}, "url": "https://github.com/camunda-cloud/zeebe/commit/9eba64d2253fd5a183b5da19e365ef54c631c06a", "committedDate": "2020-02-10T14:30:09Z", "message": "chore(upgrade-tests): added README"}, "afterCommit": {"oid": "5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "author": {"user": null}, "url": "https://github.com/camunda-cloud/zeebe/commit/5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "committedDate": "2020-02-10T15:17:14Z", "message": "chore(upgrade-tests): add upgradability tests\n\n* upgrade broker with embedded gateway\n* older gateway with newer broker"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3113, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}