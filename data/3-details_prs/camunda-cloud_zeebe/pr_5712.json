{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMzM1MjU0", "number": 5712, "title": "Benchmark setup script", "bodyText": "Description\nCreated new utils script which contains the OS specific sed function. @korthout would be cool if you can try it out. For me it works.\nCreated a new setup script which does the following in one script:\n\ncompiles the project\ncreates the docker image\npush the image\ncreate a new namespace for the benchmark\nadjust the values file\ndeploys all resources\n\nI hope this makes our lives a bit easier.\n\nDefinition of Done\nNot all items need to be done depending on the issue and the pull request.\nCode changes:\n\n The changes are backwards compatibility with previous versions\n If it fixes a bug then PRs are created to backport the fix to the last two minor versions\n\nTesting:\n\n There are unit/integration tests that verify all acceptance criterias of the issue\n New tests are written to ensure backwards compatibility with further versions\n The behavior is tested manually\n The impact of the changes is verified by a benchmark\n\nDocumentation:\n\n The documentation is updated (e.g. BPMN reference, configuration, examples, get-started guides, etc.)\n New content is added to the release announcement", "createdAt": "2020-10-28T07:12:09Z", "url": "https://github.com/camunda-cloud/zeebe/pull/5712", "merged": true, "mergeCommit": {"oid": "f107b904c16774fa893b78d489306d7e6654fb57"}, "closed": true, "closedAt": "2020-10-29T12:26:36Z", "author": {"login": "Zelldon"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW4JpBgH2gAyNTExMzM1MjU0OjNmNDQxZmExMDMxYzUxYzYzY2ZlNWI0ZjRmZTY0Nzg4ZDY0ZmM0ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXP7wEAFqTUxOTU0MjkzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f441fa1031c51c63cfe5b4f4fe64788d64fc481", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/3f441fa1031c51c63cfe5b4f4fe64788d64fc481", "committedDate": "2020-10-28T07:08:47Z", "message": "chore(benchmark): create utils script\n\n Utils script contains OS specific sed function which can be used by other scripts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/2514b0d3ca1209ea0df45dd73413804f97f3935d", "committedDate": "2020-10-28T07:08:47Z", "message": "chore(benchmarks): create new setupBenchmark script\n\n Allows to run on the root level of the project. It will compile, create the docker image, push it and create the namespace etc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDU4ODY1", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#pullrequestreview-518458865", "createdAt": "2020-10-28T09:19:00Z", "commit": {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOToxOTowMVrOHpgpYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTozMTozMFrOHphJKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA==", "bodyText": "from the name of this script it is not entirely clear that this also starts the benchmark. Perhaps it can be something like setupAndStartBenchmark.sh", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513288544", "createdAt": "2020-10-28T09:19:01Z", "author": {"login": "korthout"}, "path": "setupBenchmark.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+set -exo pipefail\n+\n+# Contains OS specific sed function\n+. benchmarks/setup/utils.sh\n+\n+if [ -z $1 ]\n+then\n+  echo \"Please provide a benchmark name! Format should be 'YOUR_NAME-TOPIC'\"\n+  exit 1\n+fi\n+benchmark=$1\n+\n+mvn clean install -DskipTests -T1C\n+\n+docker build --build-arg DISTBALL=dist/target/zeebe-distribution-*.tar.gz --build-arg APP_ENV=dev -t \"gcr.io/zeebe-io/zeebe:$benchmark\" .\n+docker push \"gcr.io/zeebe-io/zeebe:$benchmark\"\n+\n+cd benchmarks/setup/\n+\n+./newBenchmark.sh \"$benchmark\"\n+\n+cd \"$benchmark\"\n+\n+# calls OS specific sed inplace function\n+sed_inplace 's/camunda\\/zeebe/gcr.io\\/zeebe-io\\/zeebe/' zeebe-values.yaml\n+sed_inplace \"s/SNAPSHOT/$benchmark/\" zeebe-values.yaml\n+\n+make zeebe starter worker", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MTExNQ==", "bodyText": "I also think this script should be placed in benchmarks", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513291115", "createdAt": "2020-10-28T09:22:59Z", "author": {"login": "korthout"}, "path": "setupBenchmark.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+set -exo pipefail\n+\n+# Contains OS specific sed function\n+. benchmarks/setup/utils.sh\n+\n+if [ -z $1 ]\n+then\n+  echo \"Please provide a benchmark name! Format should be 'YOUR_NAME-TOPIC'\"\n+  exit 1\n+fi\n+benchmark=$1\n+\n+mvn clean install -DskipTests -T1C\n+\n+docker build --build-arg DISTBALL=dist/target/zeebe-distribution-*.tar.gz --build-arg APP_ENV=dev -t \"gcr.io/zeebe-io/zeebe:$benchmark\" .\n+docker push \"gcr.io/zeebe-io/zeebe:$benchmark\"\n+\n+cd benchmarks/setup/\n+\n+./newBenchmark.sh \"$benchmark\"\n+\n+cd \"$benchmark\"\n+\n+# calls OS specific sed inplace function\n+sed_inplace 's/camunda\\/zeebe/gcr.io\\/zeebe-io\\/zeebe/' zeebe-values.yaml\n+sed_inplace \"s/SNAPSHOT/$benchmark/\" zeebe-values.yaml\n+\n+make zeebe starter worker", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA=="}, "originalCommit": {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NTE0Mw==", "bodyText": "What does APP_ENV=dev achieve?", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513295143", "createdAt": "2020-10-28T09:29:10Z", "author": {"login": "korthout"}, "path": "setupBenchmark.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+set -exo pipefail\n+\n+# Contains OS specific sed function\n+. benchmarks/setup/utils.sh\n+\n+if [ -z $1 ]\n+then\n+  echo \"Please provide a benchmark name! Format should be 'YOUR_NAME-TOPIC'\"\n+  exit 1\n+fi\n+benchmark=$1\n+\n+mvn clean install -DskipTests -T1C\n+\n+docker build --build-arg DISTBALL=dist/target/zeebe-distribution-*.tar.gz --build-arg APP_ENV=dev -t \"gcr.io/zeebe-io/zeebe:$benchmark\" .", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NjY4MQ==", "bodyText": "why define this special function? Why not just turn this util script into sed-inplace.sh? And everytime you need it you just call this script?", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513296681", "createdAt": "2020-10-28T09:31:30Z", "author": {"login": "korthout"}, "path": "benchmarks/setup/utils.sh", "diffHunk": "@@ -0,0 +1,33 @@\n+#!/bin/bash\n+\n+GO_OS=${GO_OS:-\"linux\"}\n+\n+function detect_os {\n+    # Detect the OS name\n+    case \"$(uname -s)\" in\n+      Darwin)\n+        host_os=darwin\n+        ;;\n+      Linux)\n+        host_os=linux\n+        ;;\n+      *)\n+        echo \"Unsupported host OS. Must be Linux or Mac OS X.\" >&2\n+        exit 1\n+        ;;\n+    esac\n+\n+   GO_OS=\"${host_os}\"\n+}\n+\n+\n+function sed_inplace() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe6b8ea0e9802b9a76c1820107102fb0f87ad3fb", "author": {"user": {"login": "Zelldon", "name": "Christopher Zell"}}, "url": "https://github.com/camunda-cloud/zeebe/commit/fe6b8ea0e9802b9a76c1820107102fb0f87ad3fb", "committedDate": "2020-10-29T10:44:51Z", "message": "chore(benchmark): rename benchmark script and add doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTQyOTM5", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#pullrequestreview-519542939", "createdAt": "2020-10-29T10:51:20Z", "commit": {"oid": "fe6b8ea0e9802b9a76c1820107102fb0f87ad3fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2319, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}