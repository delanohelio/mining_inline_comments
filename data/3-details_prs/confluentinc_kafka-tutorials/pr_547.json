{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDI4NTQ4", "number": 547, "title": "Add new tutorial - Kafka version of  Count messages in a topic", "bodyText": "This adds a Kafka option to the tutorial to count the number of messages in a topic (#261).\nIt uses kafkacat because this integrates the most neatly into unix pipes. I tried ccloud but it doesn't have an option to exit after last message consumed, nor is there a Docker image.", "createdAt": "2020-09-21T16:45:23Z", "url": "https://github.com/confluentinc/kafka-tutorials/pull/547", "merged": true, "mergeCommit": {"oid": "eb8d11862615da055480c5eaffd8a2c446167dea"}, "closed": true, "closedAt": "2020-09-24T13:32:53Z", "author": {"login": "rmoff"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ3ceVAH2gAyNDkwNDI4NTQ4OjQyMTQ3YjU2NzU2NDBjOTRmMDIxNjUxZmE5YmYxZjg5YmZlOGQ0NGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMBLSxAH2gAyNDkwNDI4NTQ4Ojc3NzIzZTNjYmViZDgxMjRiODViZWE2NjI1Nzk5MWVlYmIyOWM2ZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "42147b5675640c94f021651fa9bf1f89bfe8d44a", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/42147b5675640c94f021651fa9bf1f89bfe8d44a", "committedDate": "2020-09-17T20:58:26Z", "message": "Add ksqlDB tutorial - count messages in a topic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b19172e4e6c60554f669ef519d1046c78628bda9", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/b19172e4e6c60554f669ef519d1046c78628bda9", "committedDate": "2020-09-17T21:22:09Z", "message": "Fix problem with ksqlDB test runner stderr getting lost"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72c3e765349daececbe088fc8d59807cee2a8cb9", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/72c3e765349daececbe088fc8d59807cee2a8cb9", "committedDate": "2020-09-21T13:58:36Z", "message": "Merge branch 'master' into gh261"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e3fc27caf1c21422d4abd20b82b9b72bc4fde9", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/94e3fc27caf1c21422d4abd20b82b9b72bc4fde9", "committedDate": "2020-09-21T16:43:05Z", "message": "Add new tutorial - Count messages with kafkacat"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0ODMzODcx", "url": "https://github.com/confluentinc/kafka-tutorials/pull/547#pullrequestreview-494833871", "createdAt": "2020-09-23T16:21:10Z", "commit": {"oid": "94e3fc27caf1c21422d4abd20b82b9b72bc4fde9"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoyMToxMFrOHW2hoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjo0NToyOFrOHW3eOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNDA2NA==", "bodyText": "For your consideration - it's not obvious from the rendered formatting that users can click on here, so maybe change to make it more obvious  but I don't have a better suggestion", "url": "https://github.com/confluentinc/kafka-tutorials/pull/547#discussion_r493724064", "createdAt": "2020-09-23T16:21:10Z", "author": {"login": "bbejeck"}, "path": "_includes/tutorials/count-messages/ksql/markup/dev/03d-count-all-messages-pageview.adoc", "diffHunk": "@@ -0,0 +1,15 @@\n+Now let's count all of the messages in the topic: \n+\n++++++\n+<pre class=\"snippet\"><code class=\"sql\">{% include_raw tutorials/count-messages/ksql/code/tutorial-steps/dev/03d-count-all-messages-pageview.sql %}</code></pre>\n++++++\n+\n+We're specifying a `LIMIT 1` clause here so that the query exits after the first row has returned. Without this, ksqlDB will continue to write any changes in the count to the screen as new messages arrive. \n+\n+You should now see a count of all the messages in the topic: \n+\n++++++\n+<pre class=\"snippet\"><code class=\"sql\">{% include_raw tutorials/count-messages/ksql/code/tutorial-steps/dev/03d-count-all-messages-pageview.out %}</code></pre>\n++++++\n+\n+NOTE: _You may be wondering about the purpose of `X` in the query. It's a dummy field to pursuade ksqlDB to do an aggregation across all messages. You can read more about this https://github.com/confluentinc/ksql/issues/430[here]_.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94e3fc27caf1c21422d4abd20b82b9b72bc4fde9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczMjcyNA==", "bodyText": "I'm not sure if it fits with this tutorial but we've updated the existing files in the harness directory to add this extra step\nccloud:\n  steps:\n    - title: Run your app to Confluent Cloud\n      content:\n        - action: skip\n          render:\n            file: shared/markup/ccloud/try-ccloud.adoc", "url": "https://github.com/confluentinc/kafka-tutorials/pull/547#discussion_r493732724", "createdAt": "2020-09-23T16:34:27Z", "author": {"login": "bbejeck"}, "path": "_data/harnesses/count-messages/ksql.yml", "diffHunk": "@@ -0,0 +1,120 @@\n+dev:\n+  steps:\n+    - title: Initialize the project\n+      content:\n+        - action: execute\n+          file: tutorial-steps/dev/01a-init.sh\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/01a-init.adoc\n+\n+        - action: execute\n+          file: tutorial-steps/dev/01b-make-dirs.sh\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/01b-make-dirs.adoc\n+\n+    - title: Get Confluent Platform\n+      content:\n+        - action: make_file\n+          file: docker-compose.yml\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/02a-make-docker-compose.adoc\n+\n+        - action: execute\n+          file: tutorial-steps/dev/02b-docker-compose-up.sh\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/02b-start-compose.adoc\n+\n+        - action: execute\n+          file: tutorial-steps/dev/02c-wait-for-containers.sh\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/02c-wait-for-containers.adoc\n+\n+    - title: Launch the ksqlDB CLI and declare a stream\n+      content:\n+        - action: docker_ksql_cli_session\n+          container: ksqldb\n+          docker_bootup_file: tutorial-steps/dev/03a-start-ksqldb-cli.sh\n+          column_width: 24\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/03a-start-ksqldb-cli.adoc\n+          stdin:\n+            - file: tutorial-steps/dev/03b-declare-pageview-stream.sql\n+              render:\n+                file: tutorials/count-messages/ksql/markup/dev/03b-declare-pageview-stream.adoc\n+\n+          stdout:\n+            directory: tutorial-steps/dev/outputs\n+\n+    - title: Count all the messages in a topic\n+      content:\n+        - action: docker_ksql_cli_session\n+          container: ksqldb\n+          docker_bootup_file: tutorial-steps/dev/03a-start-ksqldb-cli.sh\n+          column_width: 24\n+          render:\n+            skip: true\n+          stdin:\n+\n+            - file: tutorial-steps/dev/03c-set-offset-earliest.sql\n+              render:\n+                file: tutorials/count-messages/ksql/markup/dev/03c-set-offset-earliest.adoc\n+                \n+            - file: tutorial-steps/dev/03d-count-all-messages-pageview.sql\n+              render:\n+                file: tutorials/count-messages/ksql/markup/dev/03d-count-all-messages-pageview.adoc\n+\n+            - file: tutorial-steps/dev/04a-build-table.sql\n+              render:\n+                file: tutorials/count-messages/ksql/markup/dev/04a-build-table.adoc\n+            - file: tutorial-steps/dev/04b-push-query-table.sql\n+              render:\n+                file: tutorials/count-messages/ksql/markup/dev/empty.adoc\n+            - file: tutorial-steps/dev/04c-pull-query-table.sql\n+              render:\n+                file: tutorials/count-messages/ksql/markup/dev/04c-pull-query-table.adoc\n+          stdout:\n+            directory: tutorial-steps/dev/outputs\n+\n+    - title: Query the number of messages using the REST API\n+      content:\n+        - action: execute\n+          file: tutorial-steps/dev/05a-pull-query-restapi.sh\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/05a-pull-query-restapi.adoc\n+          stdout: tutorial-steps/dev/outputs/05a-pull-query-restapi.log\n+          \n+    - title: Write your statements to a file\n+      content:\n+        - action: make_file\n+          file: src/statements.sql\n+          render:\n+            file: tutorials/count-messages/ksql/markup/dev/07a-make-src-file.adoc\n+\n+test:\n+  steps:\n+    - title: Create the test data\n+      content:\n+        - action: make_file\n+          file: test/input.json\n+          render:\n+            file: tutorials/count-messages/ksql/markup/test/00-make-test-input.adoc\n+\n+        - action: make_file\n+          file: test/output.json\n+          render:\n+            file: tutorials/count-messages/ksql/markup/test/01-make-test-output.adoc\n+\n+    - title: Invoke the tests\n+      content:\n+        - action: execute\n+          file: tutorial-steps/test/02-run-tests.sh\n+          stdout: tutorial-steps/test/outputs/test-results.log\n+          render:\n+            file: tutorials/count-messages/ksql/markup/test/02-run-tests.adoc\n+\n+    - title: Clean up\n+      content:\n+        - action: execute\n+          file: tutorial-steps/test/03-clean-up.sh\n+          render:\n+            file: tutorials/count-messages/ksql/markup/test/03-clean-up.adoc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94e3fc27caf1c21422d4abd20b82b9b72bc4fde9"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczNzYwOQ==", "bodyText": "For your consideration - render the command for waiting as you did in the ksqlDB version.\nI needed to run the kafkacat command twice the first time I got this\nERROR: Topic pageviews error: Broker: Unknown topic or partition\n       0\n\nI realize it's a very minor point.", "url": "https://github.com/confluentinc/kafka-tutorials/pull/547#discussion_r493737609", "createdAt": "2020-09-23T16:42:12Z", "author": {"login": "bbejeck"}, "path": "_data/harnesses/count-messages/kafka.yml", "diffHunk": "@@ -0,0 +1,55 @@\n+dev:\n+  steps:\n+    - title: Initialize the project\n+      content:\n+        - action: execute\n+          file: tutorial-steps/dev/01a-init.sh\n+          render:\n+            file: tutorials/count-messages/kafka/markup/dev/01a-init.adoc\n+\n+    - title: Get Confluent Platform\n+      content:\n+        - action: make_file\n+          file: docker-compose.yml\n+          render:\n+            file: tutorials/count-messages/kafka/markup/dev/02a-make-docker-compose.adoc\n+\n+        - action: execute\n+          file: tutorial-steps/dev/02b-docker-compose-up.sh\n+          render:\n+            file: tutorials/count-messages/kafka/markup/dev/02b-start-compose.adoc\n+\n+        - action: execute\n+          file: tutorial-steps/dev/02c-wait-for-containers.sh\n+          render:\n+            skip: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94e3fc27caf1c21422d4abd20b82b9b72bc4fde9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczOTU3Ng==", "bodyText": "Great description of using kafkacat!", "url": "https://github.com/confluentinc/kafka-tutorials/pull/547#discussion_r493739576", "createdAt": "2020-09-23T16:45:28Z", "author": {"login": "bbejeck"}, "path": "_includes/tutorials/count-messages/kafka/markup/dev/03a-count-messages.adoc", "diffHunk": "@@ -0,0 +1,25 @@\n+You can count the number of messages in a Kafka topic simply by consuming the entire topic and counting how many messages are read. \n+\n+To do this from the commandline you can use the https://github.com/edenhill/kafkacat[`kafkacat`] tool which can act as a consumer (and producer) and is built around the https://en.wikipedia.org/wiki/Pipeline_(Unix)[Unix philosophy of pipelines]. This means that you can pipe the output (messages) from kafkacat into another tool to count the number of messages.\n+\n++++++\n+<pre class=\"snippet\"><code class=\"shell\">{% include_raw tutorials/count-messages/kafka/code/tutorial-steps/dev/03a-count-messages.sh %}</code></pre>\n++++++\n+\n++++++\n+<pre class=\"snippet\"><code class=\"shell\">{% include_raw tutorials/count-messages/kafka/code/tutorial-steps/dev/03a-count-messages.out %}</code></pre>\n++++++\n+\n+Let's take a close look at the commandline soup we've used here to count the messages. \n+\n+* `docker exec kafkacat` runs the following command with its arguments in the Docker container called `kafkacat`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94e3fc27caf1c21422d4abd20b82b9b72bc4fde9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf81107a19499d82f93d355acaf79227d1766892", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/cf81107a19499d82f93d355acaf79227d1766892", "committedDate": "2020-09-24T13:03:28Z", "message": "Merge branch 'master' into gh261-kafka"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02be7b8ee78e4c4890d5fc66bca0a89d58e62d87", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/02be7b8ee78e4c4890d5fc66bca0a89d58e62d87", "committedDate": "2020-09-24T13:17:16Z", "message": "Improve link legibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77723e3cbebd8124b85bea66257991eebb29c6fd", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/77723e3cbebd8124b85bea66257991eebb29c6fd", "committedDate": "2020-09-24T13:26:34Z", "message": "Add visual rendering of requirement to wait for components to start"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 223, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}