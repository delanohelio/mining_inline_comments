{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTkyOTU0", "number": 454, "title": "Addresses GH issue #453: Allow single KT to run and not automatically\u2026", "bodyText": "\u2026 destroy resources\nThis PR executes option 1 documented at #453 (comment) but I am happy to implement another option if anyone would like to propose for a better one.  Quick summary of PR is ability to run the following to leave the KT running\nmake SEQUENCE=\"dev, test\"\n\nNote to self: programmatic way to make file changes:\nfind . -type f -name \"Makefile\" | xargs perl -pi -e '$_ .= qq(SEQUENCE := \"dev, test, prod\"\\n) if /shell mktemp/' \nfind . -type f -name \"Makefile\" | xargs perl -pi -e 's/\\$\\(TEMP_DIR\\)/\\$\\(TEMP_DIR\\) \\$\\(SEQUENCE\\)/g'", "createdAt": "2020-06-25T18:39:32Z", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454", "merged": true, "mergeCommit": {"oid": "d9001cf60175bf7d273574d8f8e7525be9fe90ab"}, "closed": true, "closedAt": "2020-06-27T16:23:23Z", "author": {"login": "ybyzek"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuzGnbgH2gAyNDQwMTkyOTU0OmViZTc4NWE2MWIwYTkzZTk5YjgxNzg1YjU4MzJkNTA1MzU2NTRlMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvNPSNgH2gAyNDQwMTkyOTU0OmY1YjVjOTU4MDBlNDJhMjEwYWYyY2EzOTEwYTFjZDk5NTYwNTRiYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebe785a61b0a93e99b81785b5832d50535654e35", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/ebe785a61b0a93e99b81785b5832d50535654e35", "committedDate": "2020-06-25T18:38:59Z", "message": "Addresses GH issue #453: Allow single KT to run and not automatically destroy resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "997d91279913011d6adb77943507fa64f17d8c81", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/997d91279913011d6adb77943507fa64f17d8c81", "committedDate": "2020-06-25T18:42:54Z", "message": "Tweak README"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d75cb91f22f27eda9308f573d87da588b0d55d95", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/d75cb91f22f27eda9308f573d87da588b0d55d95", "committedDate": "2020-06-25T18:48:18Z", "message": "Move text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe2fd33c05f36f50bf1bf6590f3ecfd78cb43207", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/fe2fd33c05f36f50bf1bf6590f3ecfd78cb43207", "committedDate": "2020-06-25T18:51:59Z", "message": "Add removed file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7424893ec6fcb8e1d985474baeca8c46970aaddf", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/7424893ec6fcb8e1d985474baeca8c46970aaddf", "committedDate": "2020-06-25T18:52:36Z", "message": "Tweak spaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d07e1c57d658625e82fb5aa9ec251cc0bcfd3385", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/d07e1c57d658625e82fb5aa9ec251cc0bcfd3385", "committedDate": "2020-06-25T20:19:30Z", "message": "Restoring original _includes/tutorials/transforming/kstreams/code/tutorial-steps/dev/outputs/actual-movies.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc82566ab7b12bc58fd147c8c3a3794195d1f03a", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/dc82566ab7b12bc58fd147c8c3a3794195d1f03a", "committedDate": "2020-06-25T20:22:04Z", "message": "README tweak"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ae357a256cb4f4052568e535676f0c26b1ac476", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/9ae357a256cb4f4052568e535676f0c26b1ac476", "committedDate": "2020-06-25T20:30:01Z", "message": "Update templates as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29f3ba702dbd04923f09355cc24613bae8cedb13", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/29f3ba702dbd04923f09355cc24613bae8cedb13", "committedDate": "2020-06-26T12:08:59Z", "message": "Add gradle as a dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bcdff48ec12b19dc7814d19770d33c4e825bcce", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/9bcdff48ec12b19dc7814d19770d33c4e825bcce", "committedDate": "2020-06-26T12:36:51Z", "message": "Spelling errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDMyNzI3", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#pullrequestreview-438432727", "createdAt": "2020-06-26T16:27:39Z", "commit": {"oid": "9bcdff48ec12b19dc7814d19770d33c4e825bcce"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNjoyNzozOVrOGpnH7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNjoyNzozOVrOGpnH7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTgwNw==", "bodyText": "Now you can play with the environment, some sample commands shown below.\ndocker exec broker kafka-topics --list --bootstrap-server localhost:9092\ndocker exec -it ksqldb-cli ksql http://ksqldb-server:8088   \n\nDon't forget to shutdown Docker containers when you are done\ndocker-compose down --volumes", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#discussion_r446285807", "createdAt": "2020-06-26T16:27:39Z", "author": {"login": "bbejeck"}, "path": "README.md", "diffHunk": "@@ -253,30 +252,68 @@ Lastly, create a Makefile in the `code` directory to invoke the harness runner a\n \n ## Testing Locally\n \n-Given the test harness is the `heart` of a tutorial, it will be helpful to describe in detail how to work with a `kafka|ksql|kstreams.yml` file.  You should note the harness file is in the [YAML file format](https://en.wikipedia.org/wiki/YAML), so formatting properly is essential.  The harness files generate the rendered tutorial structure and validate any output of tutorial steps against expected values.\n+The [Kafka Tutorials microsite](https://kafka-tutorials.confluent.io/) shows how to manually execute each tutorial step-by-step.\n+However, there are some scenarios when a user may want to run and test a tutorial in a more automated fashion:\n \n-New tutorial authors should not need to create a harness file from scratch, using either the `tools/gen_project.sh` or  `tools/clone.sh` script will provide a usable harness file.  This section should provide enough guidance to add, update, or remove parts as needed.\n+1. End-to-end: user makes a small change to the code and wants to validate that the tutorial still works end-to-end\n+2. Run-and-play: user runs a tutorial and wants to leave it running to play with the environment\n \n-#### TL;DR\n+This section describes how you can do this using the `harness-runner` to programmatically run a single tutorial.\n \n-To run a tutorial programmatically, do the following steps. Note to follow these instructions you'll need to check out the kafka-tutorials repo:\n+### TL;DR\n \n-1. git clone https://github.com/confluentinc/kafka-tutorials.git\n-2. cd kafka-tutorials\n+To run a tutorial programmatically, do the following steps.\n \n-Once you have the kafka-tutorials repo checked out do the following:\n+1. Check out the kafka-tutorials GitHub repo:\n \n-1. Create a `Dockerfile` with the following content:\n-    ```text\n-     FROM python:3.7-slim\n-     RUN pip3 install pyyaml\n-    ```\n-2. Then run the following command to build and execute the docker image:\n-    * `docker build -t runner . ; docker run -v ${PWD}/harness_runner:/harness_runner/ -it --rm runner bash -c 'cd /harness_runner/ && pip3 install -e .'`\n+```bash\n+git clone https://github.com/confluentinc/kafka-tutorials.git\n+cd kafka-tutorials\n+```\n+\n+2. Install the packages for the harness runner.\n+\n+If you have `pip3` installed locally:\n+\n+```bash\n+(cd /harness_runner/ && pip3 install -e .)\n+```\n+\n+If you don't have `pip3` installed locally, create a `Dockerfile` with the following content:\n+\n+```text\n+FROM python:3.7-slim\n+RUN pip3 install pyyaml\n+```\n+\n+and then run the following command to build and execute the Docker image:\n+\n+```\n+docker build -t runner . ; docker run -v ${PWD}/harness_runner:/harness_runner/ -it --rm runner bash -c 'cd /harness_runner/ && pip3 install -e .'\n+```\n+\n+3. Install [gradle](https://gradle.org/install/) for tutorials that compile any code.\n \n-3. run the `make` command\n-   * `(cd _includes/tutorials/<tutorial name>/<type>/code && make)` where type is one of `ksql | kstreams | kafka`.\n-   * For example `(cd _includes/tutorials/transforming/kstreams/code/ && make)`\n+4. End-to-end: run the harness runner for a single tutorial by calling `make`, across all `dev`, `test`, and `prod` stages, to validate it works end-to-end. Identify the tutorial you want and then run `make`. Note that this destroys all the resources and Docker containers it created, so it cleans up after itself.  Format: `(cd _includes/tutorials/<tutorial name>/<type>/code && make)` where type is one of `ksql | kstreams | kafka`. Example:\n+\n+```\n+(cd _includes/tutorials/transforming/kstreams/code/ && make)\n+```\n+\n+5. Run-and-play: run the harness runner for a single tutorial by calling `make SEQUENCE=\"dev, test\"`, just across `dev` and `test` stages, which leaves all resources and Docker containers running so you can then play with it.  Format: `(cd _includes/tutorials/<tutorial name>/<type>/code && make SEQUENCE=\"dev, test\")` where type is one of `ksql | kstreams | kafka`. Example:\n+\n+```\n+(cd _includes/tutorials/transforming/kstreams/code/ && make SEQUENCE=\"dev, test\")\n+```\n+\n+Now you can play with the environment, some sample commands shown below.  Don't forget to shutdown Docker containers when you are done.\n+\n+```\n+docker exec broker kafka-topics --list --bootstrap-server localhost:9092\n+docker exec -it ksqldb-cli ksql http://ksqldb-server:8088               \n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bcdff48ec12b19dc7814d19770d33c4e825bcce"}, "originalPosition": 107}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "305b1526c2ff733794afc7bd26cc3b0c5f649d4c", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/305b1526c2ff733794afc7bd26cc3b0c5f649d4c", "committedDate": "2020-06-26T18:12:27Z", "message": "Add command examples for removing Docker containers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "018b47f8eb6f746a13c4f545589ccf77a9055661", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/018b47f8eb6f746a13c4f545589ccf77a9055661", "committedDate": "2020-06-26T19:28:12Z", "message": "Tweak README and add Docker Compose as prereq"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d17456b2a6ca2279fbd818c8d0af408ccce6f0bc", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/d17456b2a6ca2279fbd818c8d0af408ccce6f0bc", "committedDate": "2020-06-26T19:32:52Z", "message": "Convert absolute links to relative links"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5b5c95800e42a210af2ca3910a1cd9956054ba8", "author": {"user": {"login": "ybyzek", "name": "Yeva Byzek"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/f5b5c95800e42a210af2ca3910a1cd9956054ba8", "committedDate": "2020-06-27T01:05:59Z", "message": "Merge branch 'master' into GH-453"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 173, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}