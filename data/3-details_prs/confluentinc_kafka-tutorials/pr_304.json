{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNjg2NzI2", "number": 304, "title": "New tutorial: Add key to topic from Kafka Connect with ksqlDB", "bodyText": "Fixes #291", "createdAt": "2020-03-25T16:19:25Z", "url": "https://github.com/confluentinc/kafka-tutorials/pull/304", "merged": true, "mergeCommit": {"oid": "08b58784d3dc9983aac4a63f56b6f5b63100a97e"}, "closed": true, "closedAt": "2020-03-31T15:52:48Z", "author": {"login": "rmoff"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ0qklAH2gAyMzkzNjg2NzI2OjI0Y2U1MDRlYjEyZjc0NWEzNmE0YTUwMTUyNDBhNzg0OTEzOGRiYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTDKYjAFqTM4NDczNDc4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "24ce504eb12f745a36a4a5015240a7849138dbaa", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/24ce504eb12f745a36a4a5015240a7849138dbaa", "committedDate": "2020-03-24T15:30:26Z", "message": "First cut of Kafka Connect / SMT key tutorial"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9fea6b33f4218d51cc9e1c23a11e6f49a5f5521", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/a9fea6b33f4218d51cc9e1c23a11e6f49a5f5521", "committedDate": "2020-03-24T17:44:30Z", "message": "Test works locally \ud83d\ude4c"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4638b245a672354cdfd26bb78d4b81892699b6b", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/e4638b245a672354cdfd26bb78d4b81892699b6b", "committedDate": "2020-03-25T10:39:44Z", "message": "Merge branch '219-smt-rejiggle' into 122-connect-smt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b28417f6c806120bc871b3a5bb1c3d7c22141734", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/b28417f6c806120bc871b3a5bb1c3d7c22141734", "committedDate": "2020-03-25T10:49:15Z", "message": "Merge branch 'harness-make-test-prod-optional' into 122-connect-smt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc286140ef40b2679399e1635214b100fd26471b", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/bc286140ef40b2679399e1635214b100fd26471b", "committedDate": "2020-03-25T10:58:48Z", "message": "Remove test & prod noop steps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abd5595789fa7ce6089c15f37f9ced61bd273931", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/abd5595789fa7ce6089c15f37f9ced61bd273931", "committedDate": "2020-03-25T11:04:03Z", "message": "Merge branch 'make-test-prod-optional' into 122-connect-smt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "588106650fda3ab87750a8447fb9cf41e08ce657", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/588106650fda3ab87750a8447fb9cf41e08ce657", "committedDate": "2020-03-25T14:45:18Z", "message": "First cut - not working yet \ud83d\ude16"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9872e83e7a786e57de14dc300e83738c7663e4dc", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/9872e83e7a786e57de14dc300e83738c7663e4dc", "committedDate": "2020-03-25T14:52:34Z", "message": "Merge branch 'tweaks' into 291-ksqldb-add-key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22eb5d0d26dbffceb3a633429340d13d15534618", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/22eb5d0d26dbffceb3a633429340d13d15534618", "committedDate": "2020-03-25T16:13:53Z", "message": "\ud83d\udc4d\ud83c\udffbTests pass locally\ud83d\ude0e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a68109abc1751064f484184c7aa30ff36815ec3b", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/a68109abc1751064f484184c7aa30ff36815ec3b", "committedDate": "2020-03-25T16:29:31Z", "message": "Merge branch 'master' into 291-ksqldb-add-key"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTE5NTM0", "url": "https://github.com/confluentinc/kafka-tutorials/pull/304#pullrequestreview-383919534", "createdAt": "2020-03-30T14:36:04Z", "commit": {"oid": "a68109abc1751064f484184c7aa30ff36815ec3b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDozNjowNFrOF9s2gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDozNjowNFrOF9s2gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI0MjMwNQ==", "bodyText": "This series of steps relies on waiting for the containers behind the scenes. However, in the tutorial text it's not clear that waiting is necessary.\nFor example if the Create the connector step is executed too quickly, the command returns curl: (52) Empty reply from server. And querying the status returns {\"error_code\":404,\"message\":\"No status found for connector jdbc_source_postgres_01\"}.\nIn the text, I think it would be good to suggest re-running the Create the connector step in this case.", "url": "https://github.com/confluentinc/kafka-tutorials/pull/304#discussion_r400242305", "createdAt": "2020-03-30T14:36:04Z", "author": {"login": "colinhicks"}, "path": "_data/harnesses/connect-add-key-to-source/kafka.yml", "diffHunk": "@@ -0,0 +1,83 @@\n+dev:\n+  steps:\n+    - title: Initialize the project\n+      content:\n+        - action: execute\n+          file: tutorial-steps/dev/init.sh\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/init.adoc\n+            \n+    - title: Prepare the source data\n+      content:\n+        - change_directory: connect-add-key-to-source\n+          action: make_file\n+          file: cities.sql\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/make-sql-commandfile.adoc\n+\n+    - title: Get Confluent Platform\n+      content:\n+        - action: make_file\n+          file: docker-compose.yml\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/make-docker-compose.adoc\n+\n+        - action: execute_async\n+          file: tutorial-steps/dev/docker-compose-up.sh\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/start-compose.adoc\n+\n+        - action: execute\n+          file: tutorial-steps/dev/wait-for-containers.sh\n+          render:\n+            skip: true\n+            \n+    - title: Check the source data\n+      content:\n+        - action: execute\n+          file: tutorial-steps/dev/query-postgres.sh\n+          stdout: tutorial-steps/dev/outputs/query-postgres.log\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/query-postgres.adoc\n+\n+    - title: Create the connector\n+      content:\n+        - action: execute\n+          file: tutorial-steps/dev/create-connector.sh\n+          stdout: tutorial-steps/dev/outputs/create-connector.log\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/create-connector.adoc\n+\n+        - name: give Kafka Connect chance to create the connector\n+          action: sleep\n+          ms: 5000\n+          render:\n+            skip: true\n+\n+        - action: execute\n+          file: tutorial-steps/dev/check-connector.sh\n+          stdout: tutorial-steps/dev/outputs/check-connector.log\n+          render:\n+            file: tutorials/connect-add-key-to-source/kafka/markup/dev/check-connector.adoc\n+\n+        - name: give Kafka Connect further chance to get the data to the topic\n+          action: sleep\n+          ms: 5000\n+          render:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a68109abc1751064f484184c7aa30ff36815ec3b"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTM3ODI0", "url": "https://github.com/confluentinc/kafka-tutorials/pull/304#pullrequestreview-383937824", "createdAt": "2020-03-30T14:53:56Z", "commit": {"oid": "a68109abc1751064f484184c7aa30ff36815ec3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo1Mzo1NlrOF9ttqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo1Mzo1NlrOF9ttqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1NjQyNg==", "bodyText": "The statements sent to \"production\" should also include the cities table, too, right?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            );\n          \n          \n            \n            );\n          \n          \n            \n            \n          \n          \n            \n            CREATE TABLE CITIES (ROWKEY INT KEY) WITH (KAFKA_TOPIC='postgres_cities', VALUE_FORMAT='AVRO');", "url": "https://github.com/confluentinc/kafka-tutorials/pull/304#discussion_r400256426", "createdAt": "2020-03-30T14:53:56Z", "author": {"login": "colinhicks"}, "path": "_includes/tutorials/connect-add-key-to-source/ksql/code/src/statements.sql", "diffHunk": "@@ -0,0 +1,15 @@\n+CREATE SOURCE CONNECTOR JDBC_SOURCE_POSTGRES_01 WITH (\n+    'connector.class'= 'io.confluent.connect.jdbc.JdbcSourceConnector',\n+    'connection.url'= 'jdbc:postgresql://postgres:5432/postgres',\n+    'connection.user'= 'postgres',\n+    'connection.password'= 'postgres',\n+    'mode'= 'incrementing',\n+    'incrementing.column.name'= 'city_id',\n+    'topic.prefix'= 'postgres_',\n+    'transforms'= 'copyFieldToKey,extractValuefromStruct',\n+    'transforms.copyFieldToKey.type'= 'org.apache.kafka.connect.transforms.ValueToKey',\n+    'transforms.copyFieldToKey.fields'= 'city_id',\n+    'transforms.extractValuefromStruct.type'= 'org.apache.kafka.connect.transforms.ExtractField$Key',\n+    'transforms.extractValuefromStruct.field'= 'city_id',\n+    'key.converter' = 'org.apache.kafka.connect.converters.IntegerConverter'\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a68109abc1751064f484184c7aa30ff36815ec3b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "172bfb39e3b07fabf08c994d75a83a9ffaa934ff", "author": {"user": {"login": "rmoff", "name": "Robin Moffatt"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/172bfb39e3b07fabf08c994d75a83a9ffaa934ff", "committedDate": "2020-03-31T11:21:36Z", "message": "Add text clarifying to wait for Kafka Connect\nif not available yet (and knock-on impact of\ntrying to check the connector health if it\nwasn't actually created)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NzM0Nzg0", "url": "https://github.com/confluentinc/kafka-tutorials/pull/304#pullrequestreview-384734784", "createdAt": "2020-03-31T13:31:42Z", "commit": {"oid": "172bfb39e3b07fabf08c994d75a83a9ffaa934ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 292, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}