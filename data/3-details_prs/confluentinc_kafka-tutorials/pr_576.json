{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzkwMTYy", "number": 576, "title": "DEVX - Automatically promote PRs to staging", "bodyText": "This PR introduces a new pipeline that promotes PRs automatically to staging.\nThe URL for the staged PRs will be http://kafka-tutorials-staging.s3-website-us-west-2.amazonaws.com/BRANCH_NAME/ so no need to dig through log files for the link.", "createdAt": "2020-10-07T16:58:07Z", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576", "merged": true, "mergeCommit": {"oid": "48c66cbd547073fb5447697fb8e618bcdbbabf81"}, "closed": true, "closedAt": "2020-10-07T22:51:31Z", "author": {"login": "bbejeck"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQP7xOgH2gAyNDk5MzkwMTYyOjFhZGY3NDllZWZmMjY4ZjgxNGIyNzViYWE3NjY1MzU5NThjYTUzYmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQULSLgH2gAyNDk5MzkwMTYyOjFjNDEyZmMwOWNlNjcyY2IxM2YwNWFjODdmMGVjNGU3ZGQyNzQzNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1adf749eeff268f814b275baa766535958ca53bb", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/1adf749eeff268f814b275baa766535958ca53bb", "committedDate": "2020-10-07T16:53:53Z", "message": "Testing auto-deploy for PRs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27bf29b68eb89f59515c4a37a5261808662970af", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/27bf29b68eb89f59515c4a37a5261808662970af", "committedDate": "2020-10-07T17:05:05Z", "message": "trying to fix semaphore file syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff7d91093eceec6e2c5b386f536299eb886dd0b9", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/ff7d91093eceec6e2c5b386f536299eb886dd0b9", "committedDate": "2020-10-07T17:09:09Z", "message": "Trying to add 'result' condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fc79a8cd150d6f0e2399cc683d3e5ef909c2d91", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/2fc79a8cd150d6f0e2399cc683d3e5ef909c2d91", "committedDate": "2020-10-07T17:24:48Z", "message": "fix name of promotion file, try newer syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b0c592c6445ee7f7a87e359a2e00f7a6d921e75", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/6b0c592c6445ee7f7a87e359a2e00f7a6d921e75", "committedDate": "2020-10-07T17:26:40Z", "message": "fix expression language"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b547064975a2848e56eb234e8164ae5affd6550a", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/b547064975a2848e56eb234e8164ae5affd6550a", "committedDate": "2020-10-07T17:49:45Z", "message": "add missing end quote"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06cd49ec675f5fc7b54b28d5d45ec79514cb2dc2", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/06cd49ec675f5fc7b54b28d5d45ec79514cb2dc2", "committedDate": "2020-10-07T18:07:19Z", "message": "try removing retrieving from cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "867915f7fbd2919fb2e6d1a912243b7fc1350e57", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/867915f7fbd2919fb2e6d1a912243b7fc1350e57", "committedDate": "2020-10-07T18:28:59Z", "message": "removing semaphore hash to see if that works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "committedDate": "2020-10-07T20:03:47Z", "message": "Stage PRs automatically when not master, release or dependabot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjM5MDI4", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#pullrequestreview-504239028", "createdAt": "2020-10-07T20:25:15Z", "commit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDoyNToxNVrOHeEMJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDoyNjoxOVrOHeEOTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4Nzk3Mg==", "bodyText": "This rule is needed so any PR automatically promoted except for dependabot PRs.", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501287972", "createdAt": "2020-10-07T20:25:15Z", "author": {"login": "bbejeck"}, "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -20,6 +20,11 @@ promotions:\n         branch:\n           - ^master$\n \n+  - name: Stage PRs for review \n+    pipeline_file: pr-staging-deploy.yml\n+    auto_promote:\n+      when: \"branch != 'master' or branch != 'release' or branch !~ '^dependabot\\.'\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4ODQxOA==", "bodyText": "needed to change this since I removed the $SEMAPHORE_GIT_SHA", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501288418", "createdAt": "2020-10-07T20:26:09Z", "author": {"login": "bbejeck"}, "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -34,8 +39,8 @@ blocks:\n       jobs:\n         - name: Compile with Jekyll\n           commands:\n-            - bundle exec jekyll build --baseurl \"/$SEMAPHORE_GIT_BRANCH/$SEMAPHORE_GIT_SHA\"\n-            - cache store site-$SEMAPHORE_GIT_SHA _site\n+            - bundle exec jekyll build --baseurl \"/$SEMAPHORE_GIT_BRANCH\"\n+            - cache store site-$SEMAPHORE_GIT_BRANCH _site", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4ODUyNA==", "bodyText": "same here", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501288524", "createdAt": "2020-10-07T20:26:19Z", "author": {"login": "bbejeck"}, "path": ".semaphore/staging-site-deploy.yml", "diffHunk": "@@ -13,6 +13,6 @@ blocks:\n         - name: Compile and deploy site\n           commands:\n             - checkout\n-            - cache restore site-$SEMAPHORE_GIT_SHA\n-            - aws s3 cp --recursive ./_site \"s3://kafka-tutorials-staging/$SEMAPHORE_GIT_BRANCH/$SEMAPHORE_GIT_SHA/\"\n-            - echo \"Deployed to http://kafka-tutorials-staging.s3-website-us-west-2.amazonaws.com/$SEMAPHORE_GIT_BRANCH/$SEMAPHORE_GIT_SHA/\"\n+            - cache restore site-$SEMAPHORE_GIT_BRANCH", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjQxOTYx", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#pullrequestreview-504241961", "createdAt": "2020-10-07T20:29:32Z", "commit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjQzNzEx", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#pullrequestreview-504243711", "createdAt": "2020-10-07T20:31:54Z", "commit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDozMTo1NFrOHeEaHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDozMTo1NFrOHeEaHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5MTU0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  when: \"branch != 'master' or branch != 'release' or branch !~ '^dependabot\\.'\"\n          \n          \n            \n                  when: \"branch != 'master' and branch != 'release' and branch !~ '^dependabot\\.'\"", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501291548", "createdAt": "2020-10-07T20:31:54Z", "author": {"login": "colinhicks"}, "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -20,6 +20,11 @@ promotions:\n         branch:\n           - ^master$\n \n+  - name: Stage PRs for review \n+    pipeline_file: pr-staging-deploy.yml\n+    auto_promote:\n+      when: \"branch != 'master' or branch != 'release' or branch !~ '^dependabot\\.'\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abc1620510f31971d2b3af328e6948dd59e72089", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/abc1620510f31971d2b3af328e6948dd59e72089", "committedDate": "2020-10-07T20:33:07Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Colin Hicks <colin.hicks@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "127fdacaae116c54c95eb3ce43700421a72314a6", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/127fdacaae116c54c95eb3ce43700421a72314a6", "committedDate": "2020-10-07T21:49:31Z", "message": "Add back using semaphore git sha for cache key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c412fc09ce672cb13f05ac87f0ec4e7dd274340", "author": {"user": {"login": "bbejeck", "name": "Bill Bejeck"}}, "url": "https://github.com/confluentinc/kafka-tutorials/commit/1c412fc09ce672cb13f05ac87f0ec4e7dd274340", "committedDate": "2020-10-07T21:50:27Z", "message": "Merge branch 'DEVX_test_auto_deploy_of_pr' of github.com:confluentinc/kafka-tutorials into DEVX_test_auto_deploy_of_pr"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 70, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}