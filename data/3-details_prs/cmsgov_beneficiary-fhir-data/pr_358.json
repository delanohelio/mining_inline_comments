{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxODAzMDI1", "number": 358, "title": "BFD Insights: Adding BCDA project", "bodyText": "Change Details\n\n\nThis branch adds folder terraform/projects/bcda with some infrastructure that will be used to collect data for BFD insights.\nThe infrastructure consists of a terraform backend and an instance of the bucket module which creates a number of resources.\nThis module is copied almost exactly from the AB2D folder and allows for 1 cross account role to access the bucket.\nHere is the terraform plan to be applied:\n------------------------------------------------------------------------\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # module.bucket.aws_iam_group_policy_attachment.athena_attach[0] will be created\n  + resource \"aws_iam_group_policy_attachment\" \"athena_attach\" {\n      + group      = \"bfd-insights-readers\"\n      + id         = (known after apply)\n      + policy_arn = (known after apply)\n    }\n\n  # module.bucket.aws_iam_group_policy_attachment.athena_attach[1] will be created\n  + resource \"aws_iam_group_policy_attachment\" \"athena_attach\" {\n      + group      = \"bfd-insights-authors\"\n      + id         = (known after apply)\n      + policy_arn = (known after apply)\n    }\n\n  # module.bucket.aws_iam_group_policy_attachment.full_attach[0] will be created\n  + resource \"aws_iam_group_policy_attachment\" \"full_attach\" {\n      + group      = \"bfd-insights-analysts\"\n      + id         = (known after apply)\n      + policy_arn = (known after apply)\n    }\n\n  # module.bucket.aws_iam_policy.athena_query will be created\n  + resource \"aws_iam_policy\" \"athena_query\" {\n      + arn         = (known after apply)\n      + description = \"Rights needed for athena query access\"\n      + id          = (known after apply)\n      + name        = \"bfd-insights-athena-query-bcda\"\n      + path        = \"/bfd-insights/\"\n      + policy      = (known after apply)\n    }\n\n  # module.bucket.aws_iam_policy.full will be created\n  + resource \"aws_iam_policy\" \"full\" {\n      + arn         = (known after apply)\n      + description = \"Allow full access and use of the bcda bucket\"\n      + id          = (known after apply)\n      + name        = \"bfd-insights-full-bcda\"\n      + path        = \"/bfd-insights/\"\n      + policy      = (known after apply)\n    }\n\n  # module.bucket.aws_kms_alias.main will be created\n  + resource \"aws_kms_alias\" \"main\" {\n      + arn            = (known after apply)\n      + id             = (known after apply)\n      + name           = \"alias/bfd-insights-bcda-cmk\"\n      + target_key_arn = (known after apply)\n      + target_key_id  = (known after apply)\n    }\n\n  # module.bucket.aws_kms_grant.cmk_grant will be created\n  + resource \"aws_kms_grant\" \"cmk_grant\" {\n      + grant_id          = (known after apply)\n      + grant_token       = (known after apply)\n      + grantee_principal = \"arn:aws:iam::577373831711:role/service-role/aws-quicksight-service-role-v0\"\n      + id                = (known after apply)\n      + key_id            = (known after apply)\n      + name              = \"bfd-insights-bcda-cmk-grant\"\n      + operations        = [\n          + \"Decrypt\",\n          + \"DescribeKey\",\n          + \"Encrypt\",\n          + \"GenerateDataKey\",\n          + \"ReEncryptFrom\",\n          + \"ReEncryptTo\",\n        ]\n      + retire_on_delete  = false\n    }\n\n  # module.bucket.aws_kms_key.main will be created\n  + resource \"aws_kms_key\" \"main\" {\n      + arn                      = (known after apply)\n      + customer_master_key_spec = \"SYMMETRIC_DEFAULT\"\n      + description              = \"CMK for the bfd-insights-bcda-577373831711 bucket\"\n      + enable_key_rotation      = true\n      + id                       = (known after apply)\n      + is_enabled               = true\n      + key_id                   = (known after apply)\n      + key_usage                = \"ENCRYPT_DECRYPT\"\n      + policy                   = jsonencode(\n            {\n              + Statement = [\n                  + {\n                      + Action    = \"kms:*\"\n                      + Effect    = \"Allow\"\n                      + Principal = {\n                          + AWS = \"arn:aws:iam::577373831711:root\"\n                        }\n                      + Resource  = \"*\"\n                      + Sid       = \"AllowAdmin\"\n                    },\n                  + {\n                      + Action    = [\n                          + \"kms:ReEncrypt*\",\n                          + \"kms:GenerateDataKey*\",\n                          + \"kms:Encrypt\",\n                          + \"kms:DescribeKey\",\n                          + \"kms:Decrypt\",\n                        ]\n                      + Effect    = \"Allow\"\n                      + Principal = {\n                          + AWS = \"arn:aws:iam::755619740999:role/BcdaBfdInsightsRole\"\n                        }\n                      + Resource  = \"*\"\n                      + Sid       = \"AllowUse\"\n                    },\n                ]\n              + Version   = \"2012-10-17\"\n            }\n        )\n      + tags                     = {\n          + \"application\" = \"bfd-insights\"\n          + \"business\"    = \"OEDA\"\n          + \"project\"     = \"bcda\"\n        }\n    }\n\n  # module.bucket.aws_s3_bucket.main will be created\n  + resource \"aws_s3_bucket\" \"main\" {\n      + acceleration_status         = (known after apply)\n      + acl                         = \"private\"\n      + arn                         = (known after apply)\n      + bucket                      = \"bfd-insights-bcda-577373831711\"\n      + bucket_domain_name          = (known after apply)\n      + bucket_regional_domain_name = (known after apply)\n      + force_destroy               = false\n      + hosted_zone_id              = (known after apply)\n      + id                          = (known after apply)\n      + region                      = (known after apply)\n      + request_payer               = (known after apply)\n      + tags                        = {\n          + \"application\" = \"bfd-insights\"\n          + \"business\"    = \"OEDA\"\n          + \"project\"     = \"bcda\"\n          + \"sensitivity\" = \"moderate\"\n        }\n      + website_domain              = (known after apply)\n      + website_endpoint            = (known after apply)\n\n      + server_side_encryption_configuration {\n          + rule {\n              + apply_server_side_encryption_by_default {\n                  + kms_master_key_id = (known after apply)\n                  + sse_algorithm     = \"aws:kms\"\n                }\n            }\n        }\n\n      + versioning {\n          + enabled    = (known after apply)\n          + mfa_delete = (known after apply)\n        }\n    }\n\n  # module.bucket.aws_s3_bucket_object.top[\"databases\"] will be created\n  + resource \"aws_s3_bucket_object\" \"top\" {\n      + acl                    = \"private\"\n      + bucket                 = (known after apply)\n      + content_type           = \"application/x-directory\"\n      + etag                   = (known after apply)\n      + force_destroy          = false\n      + id                     = (known after apply)\n      + key                    = \"databases/\"\n      + server_side_encryption = (known after apply)\n      + storage_class          = (known after apply)\n      + version_id             = (known after apply)\n    }\n\n  # module.bucket.aws_s3_bucket_policy.cross_account[0] will be created\n  + resource \"aws_s3_bucket_policy\" \"cross_account\" {\n      + bucket = (known after apply)\n      + id     = (known after apply)\n      + policy = (known after apply)\n    }\n\n  # module.bucket.aws_s3_bucket_public_access_block.main will be created\n  + resource \"aws_s3_bucket_public_access_block\" \"main\" {\n      + block_public_acls       = true\n      + block_public_policy     = true\n      + bucket                  = (known after apply)\n      + id                      = (known after apply)\n      + ignore_public_acls      = true\n      + restrict_public_buckets = true\n    }\n\nPlan: 12 to add, 0 to change, 0 to destroy.\n\n------------------------------------------------------------------------\n\nAcceptance Validation\n\n Bucket is created and accessible by arn:aws:iam::755619740999:role/BcdaBfdInsightsRole\n\nFeedback Requested\nAll feedback is welcome.\nExternal References\n\nBCDA-3733\n\nSecurity Implications\n\n\n new software dependencies\n\n\n altered security controls\n\n\n new data stored or transmitted\n\n\n security checklist is completed for this change\n\n\n requires more information or team discussion to evaluate security implications", "createdAt": "2020-09-23T13:59:03Z", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/358", "merged": true, "mergeCommit": {"oid": "4b0b7ac2e7669155bd720670c1baf29744f1b3ab"}, "closed": true, "closedAt": "2020-09-30T16:51:22Z", "author": {"login": "orenfromberg"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLstYyAH2gAyNDkxODAzMDI1OjI1Mjk0ODA5OTRjY2U4MTQzNTFjYzkyNGQ0NjQ2NTU2NmUyNzlkMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN_X_8gFqTQ5OTYxMDY0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2529480994cce814351cc924d46465566e279d04", "author": {"user": {"login": "orenfromberg", "name": "Oren Fromberg"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/2529480994cce814351cc924d46465566e279d04", "committedDate": "2020-09-23T13:35:48Z", "message": "Adding BCDA project to Insights"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0ODY1NTE4", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/358#pullrequestreview-494865518", "createdAt": "2020-09-23T16:59:33Z", "commit": {"oid": "2529480994cce814351cc924d46465566e279d04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjo1OTozM1rOHW3_8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjo1OTozM1rOHW3_8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc0ODIwOQ==", "bodyText": "Will there be a single bucket for data coming from prod and a separate bucket for data coming from opensbx?  Or will all data flow into one bucket?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/358#discussion_r493748209", "createdAt": "2020-09-23T16:59:33Z", "author": {"login": "msnook"}, "path": "insights/terraform/projects/bcda/main.tf", "diffHunk": "@@ -0,0 +1,29 @@\n+locals {\n+  tags       = { business = \"OEDA\", application = \"bfd-insights\", project = \"bcda\" }\n+  project    = \"bcda\"\n+  database   = \"bcda\"\n+  partitions = [{ name = \"dt\", type = \"string\", comment = \"Approximate delivery time\" }]\n+}\n+\n+data \"aws_caller_identity\" \"current\" {}\n+\n+\n+## Bucket for the project's data", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2529480994cce814351cc924d46465566e279d04"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTE2NTYx", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/358#pullrequestreview-496516561", "createdAt": "2020-09-25T15:16:08Z", "commit": {"oid": "2529480994cce814351cc924d46465566e279d04"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1753a9e13601497906aa18450215936162aca6a5", "author": {"user": {"login": "orenfromberg", "name": "Oren Fromberg"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1753a9e13601497906aa18450215936162aca6a5", "committedDate": "2020-09-30T16:13:00Z", "message": "Adding athena workgroup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjA4NDc1", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/358#pullrequestreview-499608475", "createdAt": "2020-09-30T16:25:59Z", "commit": {"oid": "1753a9e13601497906aa18450215936162aca6a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjEwNjQ4", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/358#pullrequestreview-499610648", "createdAt": "2020-09-30T16:28:29Z", "commit": {"oid": "1753a9e13601497906aa18450215936162aca6a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 615, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}