{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NzIxNTc4", "number": 333, "title": "Cbrune/bfd 314 part d fields", "bodyText": "Change Details\n\nDocumentation on the expected mapping of these fields is obtained from CCW.\nhttps://www.resdac.org/cms-data/variables/service-provider-identification-number\nhttps://www.resdac.org/cms-data/variables/service-provider-identification-number-qualifier-code\nMapping is updated in BFD V1\nPR is reviewed and approved by Karl Davis\nCommunications regarding the unmapped fields and plan to resolve are drafted and shared with our peering partners.\n01 | National Provider Identifier (NPI)\n06 | Unique Physician Identification Number (UPIN)\n07 | National Council for Prescription Drug Programs (NCPDP) provider identifier\n08 | State license number\n11 | Federal tax number\n99 | Other\nNull/missing\n\nChanged the transformer for Part D event to change the org and facility based on the SRVC_PRVDR_ID_QLFYR_CD.\n01 | National Provider Identifier (NPI)\n06 | Unique Physician Identification Number (UPIN)\n07 | National Council for Prescription Drug Programs (NCPDP) provider identifier\n08 | State license number\n11 | Federal tax number\n99 | Other\nNull/missing\nAcceptance Validation\n\nMake sure this is correct based on the values.\n\nFeedback Requested\n\nVerify its correct and the logic makes sense\nExternal References\n\n\n[https://jira.cms.gov/browse/BFD-314\n\nSecurity Implications\n\nNo\n\n new software dependencies\n\n\n\n altered security controls\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications", "createdAt": "2020-07-31T02:11:05Z", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333", "merged": true, "mergeCommit": {"oid": "ffbe1b6decc79817b1c46628f2faa3f3a02f2e4d"}, "closed": true, "closedAt": "2020-09-09T15:37:21Z", "author": {"login": "cbrunefearless"}, "timelineItems": {"totalCount": 83, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxCdGbAH2gAyNDU5NzIxNTc4OjViYjA1ZmY3NjAxODQ5YjY5NDgzMWRkNGNiODVhNzBkMzk3NDIyMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHN7afAFqTQ4NTEzMDIwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5bb05ff7601849b694831dd4cb85a70d39742205", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/5bb05ff7601849b694831dd4cb85a70d39742205", "committedDate": "2020-07-02T17:39:58Z", "message": "Changed version of hapi fihr from v4.1 to v4.2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fa03bb110c21d9a2e34af500e418e7633885cf3", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6fa03bb110c21d9a2e34af500e418e7633885cf3", "committedDate": "2020-07-09T14:49:21Z", "message": "Merge branch 'master' of github.com:CMSgov/beneficiary-fhir-data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "130735e4295a207dce7b6525214ad949ac3fb7fb", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/130735e4295a207dce7b6525214ad949ac3fb7fb", "committedDate": "2020-07-23T19:38:09Z", "message": "Merge branch 'master' of github.com:CMSgov/beneficiary-fhir-data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4de72dfd0c2d9baa1d28ea747404b0e78bfbe809", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4de72dfd0c2d9baa1d28ea747404b0e78bfbe809", "committedDate": "2020-07-24T04:57:12Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "932729e008e617c2e586e3e8aeb343489a1454cd", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/932729e008e617c2e586e3e8aeb343489a1454cd", "committedDate": "2020-07-24T04:57:53Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b8efb5729120aaa3828b8abfbd6d05b0f62b7f7", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0b8efb5729120aaa3828b8abfbd6d05b0f62b7f7", "committedDate": "2020-07-26T18:01:22Z", "message": "Changed to accept different service provider ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4899ec086e6df26bb5d3c1143caf948e4b10ef04", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4899ec086e6df26bb5d3c1143caf948e4b10ef04", "committedDate": "2020-07-26T21:20:27Z", "message": "Added part d events to the transformers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ec61b511f8a1ec5a00bce4573daf6bcbad8333a", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0ec61b511f8a1ec5a00bce4573daf6bcbad8333a", "committedDate": "2020-07-27T02:50:39Z", "message": "Part D event code to updated based on subscriberid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f649b7af37300682212f78938a03fe38d1572e3a", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f649b7af37300682212f78938a03fe38d1572e3a", "committedDate": "2020-07-27T13:32:41Z", "message": "SPacing and alignment of code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f13fa61f6748c20a98b1aa98a73360f29b5d213", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0f13fa61f6748c20a98b1aa98a73360f29b5d213", "committedDate": "2020-07-27T13:33:27Z", "message": "SPacing and alignment of code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83a77c89f6d4e1fdebf4e761beaebbf8bacd71c8", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/83a77c89f6d4e1fdebf4e761beaebbf8bacd71c8", "committedDate": "2020-07-29T01:56:46Z", "message": "Merge branch 'master' of github.com:CMSgov/beneficiary-fhir-data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e87bad55a3f7f4e7e0065846d818e911af6d5188", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e87bad55a3f7f4e7e0065846d818e911af6d5188", "committedDate": "2020-07-29T19:37:09Z", "message": "Merge branch 'master' into cbrune/BFD-314-part-d-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0b243bdf103b34de348fd5e9fb55dc109513d24", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/c0b243bdf103b34de348fd5e9fb55dc109513d24", "committedDate": "2020-07-29T20:54:11Z", "message": "added constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b80cee4243c0ed3883eee609b30a73a9fd4e3a69", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b80cee4243c0ed3883eee609b30a73a9fd4e3a69", "committedDate": "2020-07-30T21:06:21Z", "message": "Added different getServiceProviderIdQualiferCode to part d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03fe7224e9b63ff0fe5c2654fecbac6c91f3ec56", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/03fe7224e9b63ff0fe5c2654fecbac6c91f3ec56", "committedDate": "2020-07-30T21:51:39Z", "message": "Merge branch 'master' into cbrune/BFD-314-part-d-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "620b27d36b44dd4a23a1a3b1b22a12439c43dd11", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/620b27d36b44dd4a23a1a3b1b22a12439c43dd11", "committedDate": "2020-07-31T02:48:21Z", "message": "Endpoint responses updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1c1c2128048189472bc7b4ea4e6bf9ec839f33df", "committedDate": "2020-07-31T03:28:56Z", "message": "Added responses that were different"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5Mjg3NjAy", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-459287602", "createdAt": "2020-07-31T16:01:41Z", "commit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowMTo0MVrOG6Ny9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyMjoyN1rOG6OauA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjYzMQ==", "bodyText": "I think you can lose this? Why not just load the normal SAMPLE_A data in your test and then modify the field to have the value you want to test? (I think those record classes are all mutable, right?)", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463696631", "createdAt": "2020-07-31T16:01:41Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResource.java", "diffHunk": "@@ -56,6 +56,8 @@\n \n   SAMPLE_A_PDE(resourceUrl(\"rif-static-samples/sample-a-pde.txt\"), RifFileType.PDE, 1),\n \n+  SAMPLE_A_PDE_UPIN(resourceUrl(\"rif-static-samples/sample-a-pde-upin.txt\"), RifFileType.PDE, 1),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjkwMw==", "bodyText": "See other comment on test data: I think this can be removed.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463696903", "createdAt": "2020-07-31T16:02:16Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResourceGroup.java", "diffHunk": "@@ -20,6 +20,19 @@\n       StaticRifResource.SAMPLE_A_SNF,\n       StaticRifResource.SAMPLE_A_DME),\n \n+  SAMPLE_A_UPIN(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NzEzNQ==", "bodyText": "See other comment on test data: I think this can be removed.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463697135", "createdAt": "2020-07-31T16:02:45Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/resources/rif-static-samples/sample-a-pde-upin.txt", "diffHunk": "@@ -0,0 +1,2 @@\n+DML_IND|PDE_ID|CLM_GRP_ID|FINAL_ACTION|BENE_ID|SRVC_DT|PD_DT|SRVC_PRVDR_ID_QLFYR_CD|SRVC_PRVDR_ID|PRSCRBR_ID_QLFYR_CD|PRSCRBR_ID|RX_SRVC_RFRNC_NUM|PROD_SRVC_ID|PLAN_CNTRCT_REC_ID|PLAN_PBP_REC_NUM|CMPND_CD|DAW_PROD_SLCTN_CD|QTY_DSPNSD_NUM|DAYS_SUPLY_NUM|FILL_NUM|DSPNSNG_STUS_CD|DRUG_CVRG_STUS_CD|ADJSTMT_DLTN_CD|NSTD_FRMT_CD|PRCNG_EXCPTN_CD|CTSTRPHC_CVRG_CD|GDC_BLW_OOPT_AMT|GDC_ABV_OOPT_AMT|PTNT_PAY_AMT|OTHR_TROOP_AMT|LICS_AMT|PLRO_AMT|CVRD_D_PLAN_PD_AMT|NCVRD_PLAN_PD_AMT|TOT_RX_CST_AMT|RX_ORGN_CD|RPTD_GAP_DSCNT_NUM|BRND_GNRC_CD|PHRMCY_SRVC_TYPE_CD|PTNT_RSDNC_CD|SUBMSN_CLR_CD", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5Nzg3Mw==", "bodyText": "Can you explain this specific change? I don't understand how it relates to the rest of the PR or what you're trying to accomplish with it.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463697873", "createdAt": "2020-07-31T16:04:21Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -209,7 +210,7 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n         .setAmount(TransformerUtils.createMoney(claimGroup.getGapDiscountAmount()));\n \n     if (claimGroup.getPrescriberIdQualifierCode() == null\n-        || !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))\n+        && !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5ODczNQ==", "bodyText": "This comment could use a header sentence introducing/explaining it, e.g. saying what CCW field the values you're listing are for.\nI'd also remove the commented-out code above it, since I think you're trying to replace/resolve that?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463698735", "createdAt": "2020-07-31T16:06:06Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMDcyNg==", "bodyText": "From reading the JavaDoc on these methods, I'm pretty sure the isNotEmpty(...) is redundant.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (StringUtils.isNotBlank(identiferSystem) && StringUtils.isNotEmpty(identiferSystem)) {\n          \n          \n            \n                  if (StringUtils.isNotBlank(identiferSystem)) {", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463700726", "createdAt": "2020-07-31T16:10:16Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;\n+      }\n+\n+      if (StringUtils.isNotBlank(identiferSystem) && StringUtils.isNotEmpty(identiferSystem)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMjIzMA==", "bodyText": "I don't think \"Other\" is actually a system, so I'd lose this constant and just use null here. I'd also make this the default case.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    case \"99\":\n          \n          \n            \n                      identiferSystem = TransformerConstants.CODING_OTHER;\n          \n          \n            \n                      break;\n          \n          \n            \n                    default:\n          \n          \n            \n                      identiferSystem = null;\n          \n          \n            \n                      break;", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463702230", "createdAt": "2020-07-31T16:13:18Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMzM2MA==", "bodyText": "If you write it like this, the compiler will be able to check for you that your code below actually initializes the value. (For example, temporarily comment out the default case in my suggestion below and the compiler will yell at you. That's nice of it to watch your back like that!)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String identiferSystem = null;\n          \n          \n            \n                String identiferSystem;", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463703360", "createdAt": "2020-07-31T16:15:28Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNDAzNg==", "bodyText": "As mentioned above, I would remove this constant.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463704036", "createdAt": "2020-07-31T16:16:55Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";\n+\n+  /** The Other as available at <a */\n+  static final String CODING_OTHER = \"https://bluebutton.cms.gov/resources/variables/other\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNTIxOA==", "bodyText": "Have we asked the FHIR community if they want to define standard identifier systems for any of these? If we haven't, we should before we proceed, and we should note the FHIR tracker links to the requests/tickets.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463705218", "createdAt": "2020-07-31T16:19:21Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNTk3MA==", "bodyText": "After extracting this object, I think you can modify it's values to be whatever you want, which would allow you to remove all of the extra sample data you've had to add here. (See other comments related to this.)", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463705970", "createdAt": "2020-07-31T16:20:46Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -40,7 +40,23 @@ public void transformSampleARecord() throws FHIRException {\n             .get();\n \n     ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n-    assertMatches(claim, eob);\n+    assertPartDMatches(claim, eob, \"01\", \"01\", TransformerConstants.CODING_NPI_US);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    List<Object> parsedRecords =\n+        ServerTestUtils.parseData(\n+            Arrays.asList(StaticRifResourceGroup.SAMPLE_A_UPIN.getResources()));\n+    PartDEvent claim =\n+        parsedRecords.stream()\n+            .filter(r -> r instanceof PartDEvent)\n+            .map(r -> (PartDEvent) r)\n+            .findFirst()\n+            .get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNjgwOA==", "bodyText": "How does this method compare/contrast to the other assertMatches(...) method in this class?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463706808", "createdAt": "2020-07-31T16:22:27Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -235,4 +251,202 @@ static void assertMatches(PartDEvent claim, ExplanationOfBenefit eob) throws FHI\n       throw new UncheckedIOException(e);\n     }\n   }\n+  /**\n+   * Verifies that the {@link ExplanationOfBenefit} \"looks like\" it should, if it were produced from\n+   * the specified {@link PartDEvent}.\n+   *\n+   * @param claim the {@link PartDEvent} that the {@link ExplanationOfBenefit} was generated from\n+   * @param eob the {@link ExplanationOfBenefit} that was generated from the specified {@link\n+   *     PartDEvent}\n+   * @throws FHIRException (indicates test failure)\n+   */\n+  static void assertPartDMatches(\n+      PartDEvent claim,\n+      ExplanationOfBenefit eob,\n+      String ServiceProviderIdQualiferCode,\n+      String PrescriberIdQualifierCode,\n+      String Coding)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d04af58958992f34c1d62f0a7071e12e542630", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/c6d04af58958992f34c1d62f0a7071e12e542630", "committedDate": "2020-07-31T20:20:09Z", "message": "Pr Comment fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87d908817b2e0e3e8e8b2dd95835b247561f7bc9", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/87d908817b2e0e3e8e8b2dd95835b247561f7bc9", "committedDate": "2020-08-03T15:46:16Z", "message": "Removed comment in partdeventtransformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cd22e92cd813de6cffc3f7c8c127182a005d209f", "committedDate": "2020-08-04T01:32:25Z", "message": "Added coding constant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjAxMjYy", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-463601262", "createdAt": "2020-08-07T20:46:14Z", "commit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo0NjoxNFrOG9nWNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NToyOVrOG9nkoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MDk4MQ==", "bodyText": "This comment could use a header sentence introducing/explaining it, e.g. saying what CCW field the values you're listing are for.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467260981", "createdAt": "2020-08-07T20:46:14Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,43 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MTc5OA==", "bodyText": "Could you please rename this to something less generic, e.g. FHIR_IDENTIFIER_TYPE_CODESYSTEM?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467261798", "createdAt": "2020-08-07T20:48:30Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,9 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String CODING_CODESYSTEM = \"http://terminology.hl7.org/CodeSystem/v2-0203\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NDExMQ==", "bodyText": "I think the changes to this file aren't material to your PR here, right? If so, I'd remove them from the PR.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467264111", "createdAt": "2020-08-07T20:54:15Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdPaged.json", "diffHunk": "@@ -2065,14 +2065,14 @@\n         \"type\" : [ {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"external-first\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NDM4Nw==", "bodyText": "I think the changes to this file aren't material to your PR here, right? If so, I'd remove them from the PR.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467264387", "createdAt": "2020-08-07T20:54:49Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobReadInpatient.json", "diffHunk": "@@ -531,14 +531,14 @@\n     \"type\" : [ {\n       \"coding\" : [ {\n         \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-        \"code\" : \"external-first\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NDY3Mw==", "bodyText": "This won't quite work for our users. If you're going to use the https://terminology.hl7.org/1.0.0/CodeSystem-v2-0203.html codeset, then you have to use the codes from that codeset, too.\nI'm having trouble figuring out how to type out a complete explanation, so perhaps we should chat about it on the phone next week? Dave may be able to help you with this, as well, if I get too tied up.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467264673", "createdAt": "2020-08-07T20:55:29Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,43 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+        case \"07\":\n+        case \"08\":\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_CODESYSTEM;\n+          break;\n+        default:\n+          identiferSystem = null;\n+          break;\n+      }\n+\n+      if (StringUtils.isNotBlank(identiferSystem)) {\n+        eob.setOrganization(\n+            TransformerUtils.createIdentifierReference(\n+                identiferSystem, claimGroup.getServiceProviderId()));\n+        eob.setFacility(\n+            TransformerUtils.createIdentifierReference(\n+                identiferSystem, claimGroup.getServiceProviderId()));\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52cfa33e63c4412bb09cc426eb61116fb4cc817d", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/52cfa33e63c4412bb09cc426eb61116fb4cc817d", "committedDate": "2020-08-07T21:05:12Z", "message": "Merge branch 'master' into cbrune/BFD-314-part-d-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b651662391488ba4539be688cc00118ec302a453", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b651662391488ba4539be688cc00118ec302a453", "committedDate": "2020-08-07T21:26:06Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e4e460747288466dce148b7aeb26d0cc29868ef", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1e4e460747288466dce148b7aeb26d0cc29868ef", "committedDate": "2020-08-07T21:27:44Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72684903749c54321bacb3f405e9405ee2e261b2", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/72684903749c54321bacb3f405e9405ee2e261b2", "committedDate": "2020-08-07T21:33:55Z", "message": "Changed version of hapi fihr from v4.1 to v4.2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e149760152994fab0e28b005cf0f1dfed510aca", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4e149760152994fab0e28b005cf0f1dfed510aca", "committedDate": "2020-08-07T21:33:56Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f6b1cf7253e81745d82f1eac2ceddfbd7f1096", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/c0f6b1cf7253e81745d82f1eac2ceddfbd7f1096", "committedDate": "2020-08-07T21:33:56Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8ec1c55bb63b51aa26cc4d7970546cad17f642e", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a8ec1c55bb63b51aa26cc4d7970546cad17f642e", "committedDate": "2020-08-07T21:33:56Z", "message": "Changed to accept different service provider ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1575669d1403de0c227707c135a5d59cdf67cddb", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1575669d1403de0c227707c135a5d59cdf67cddb", "committedDate": "2020-08-07T21:33:56Z", "message": "Added part d events to the transformers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "421389e9798e825a760d10c8548b948d98da1069", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/421389e9798e825a760d10c8548b948d98da1069", "committedDate": "2020-08-07T21:33:56Z", "message": "Part D event code to updated based on subscriberid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a2e22c63ad53775ec65ec07ac11bb0e68c9b9ed", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/8a2e22c63ad53775ec65ec07ac11bb0e68c9b9ed", "committedDate": "2020-08-07T21:33:56Z", "message": "SPacing and alignment of code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf923ddcabeef22ed09dd7943a08a48f5d0a59a5", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/bf923ddcabeef22ed09dd7943a08a48f5d0a59a5", "committedDate": "2020-08-07T21:33:56Z", "message": "SPacing and alignment of code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f81086a64d8236b6519f4d5e948495e6b951bae", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6f81086a64d8236b6519f4d5e948495e6b951bae", "committedDate": "2020-08-07T21:33:56Z", "message": "added constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "632d49cc55d476cc2f4ba1f8eed37dc37233c9c9", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/632d49cc55d476cc2f4ba1f8eed37dc37233c9c9", "committedDate": "2020-08-07T21:33:56Z", "message": "Added different getServiceProviderIdQualiferCode to part d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beabb662c89684b6c67092134eba2ebe6897e560", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/beabb662c89684b6c67092134eba2ebe6897e560", "committedDate": "2020-08-07T21:33:56Z", "message": "Endpoint responses updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba1ce387e7486d2fed4eb2c1ea7365ceb67fa01a", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/ba1ce387e7486d2fed4eb2c1ea7365ceb67fa01a", "committedDate": "2020-08-07T21:33:56Z", "message": "Added responses that were different"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fb976007e507da70f0065841c813f5a733a86be", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6fb976007e507da70f0065841c813f5a733a86be", "committedDate": "2020-08-07T21:33:56Z", "message": "Pr Comment fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8310108cad0c03d1aeee7d2599bf4da336a8d4ff", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/8310108cad0c03d1aeee7d2599bf4da336a8d4ff", "committedDate": "2020-08-07T21:33:56Z", "message": "Removed comment in partdeventtransformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608792095a2f2168b1afe3a8df8a3978dbe5c375", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/608792095a2f2168b1afe3a8df8a3978dbe5c375", "committedDate": "2020-08-07T21:33:56Z", "message": "Added coding constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ef774c62290e36d680d51303b4d2de99386da65", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1ef774c62290e36d680d51303b4d2de99386da65", "committedDate": "2020-08-07T21:33:56Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cde8711858d191f965a94c1ede5c9c6a70dd64e", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6cde8711858d191f965a94c1ede5c9c6a70dd64e", "committedDate": "2020-08-07T21:33:56Z", "message": "Changes to part d events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb8dfb76f145e5111e4970118ffd421860553ab9", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cb8dfb76f145e5111e4970118ffd421860553ab9", "committedDate": "2020-08-07T21:34:22Z", "message": "Merge branch 'cbrune/BFD-314-part-d-fields' of github.com:CMSgov/beneficiary-fhir-data into cbrune/BFD-314-part-d-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6723fa87923a3c6698f4ee9fc994ee50db28d3e", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/c6723fa87923a3c6698f4ee9fc994ee50db28d3e", "committedDate": "2020-08-07T21:42:48Z", "message": "Undo endpoint response changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c332a89a65e43592f5229f91d12bbc1f6004323d", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/c332a89a65e43592f5229f91d12bbc1f6004323d", "committedDate": "2020-08-11T00:46:02Z", "message": "Changed to pass a serviceprovideridentifier enum to the create reference function in transformer utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d2c9a88a1f9434150e53cc4611a7707c3237813", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/9d2c9a88a1f9434150e53cc4611a7707c3237813", "committedDate": "2020-08-11T01:07:48Z", "message": "Endpoint responses updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99aa21336d9544be971de80d4e15b60ed869b90b", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/99aa21336d9544be971de80d4e15b60ed869b90b", "committedDate": "2020-08-11T03:21:42Z", "message": "Added tests and eobresponses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/80f70448c471beb03b6fa3eb1180d85a4c0544a3", "committedDate": "2020-08-11T03:41:38Z", "message": "Changed test name for create reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ee55e57d0d442b177708e25d1c095275f152716", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/5ee55e57d0d442b177708e25d1c095275f152716", "committedDate": "2020-08-13T20:42:07Z", "message": "Changed response files back to whats in master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/21fc6bdbf7e4c63dc4861cb095431387f9086e36", "committedDate": "2020-08-14T17:41:30Z", "message": "Changed txt to .xls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjU2NTUy", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-467656552", "createdAt": "2020-08-14T15:12:10Z", "commit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "state": "DISMISSED", "comments": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNToxMjoxMFrOHA4YQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0NTo0OFrOHA9VAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4NTc2Mw==", "bodyText": "I'm not \ud83d\udcaf  on this, but... couldn't identifierSystem come from ServiceProviderIdentifiers, too?\nI guess it depends on how well/poorly that ends up impacting other uses of TransformerUtils.createIdentifierReference(...)...", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470685763", "createdAt": "2020-08-14T15:12:10Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,58 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     * This chart is to dosplay the different code values for the different service provider id qualifer\n+     * codes below\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem;\n+    ServiceProviderIdentifiers providerIdentifier;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          providerIdentifier = ServiceProviderIdentifiers.NPI;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          providerIdentifier = ServiceProviderIdentifiers.UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          providerIdentifier = ServiceProviderIdentifiers.NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE;\n+          providerIdentifier = ServiceProviderIdentifiers.SL;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+          providerIdentifier = ServiceProviderIdentifiers.FTN;\n+          break;\n+        default:\n+          identiferSystem = null;\n+          providerIdentifier = null;\n+          break;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4ODc3MQ==", "bodyText": "Following the naming scheme used in TransformerConstants, this should be named CODING_SYSTEM_HL7_IDENTIFIER_TYPE.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470688771", "createdAt": "2020-08-14T15:17:34Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTcxMA==", "bodyText": "There should really just be one CODING_SYSTEM_... constant per codesystem (not per code), so I'd remove this constant and refer to the other one, instead.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470689710", "createdAt": "2020-08-14T15:19:14Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTc3Ng==", "bodyText": "There should really just be one CODING_SYSTEM_... constant per codesystem (not per code), so I'd remove this constant and refer to the other one, instead.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470689776", "createdAt": "2020-08-14T15:19:22Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTg1Nw==", "bodyText": "There should really just be one CODING_SYSTEM_... constant per codesystem (not per code), so I'd remove this constant and refer to the other one, instead.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470689857", "createdAt": "2020-08-14T15:19:33Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for Federal Tax Number */\n+  static final String CODING_FEDERAL_TAX_NUM = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5ODM5Nw==", "bodyText": "This doesn't appear to be an actual FHIR code system... is it? If it's not a standard HL7 one (or from some other IG), and we can't find a reasonable code for PDP ID types, then we should define a custom-to-us code system and code for it.\nIf that's the right direction, it'd be something more like this:\n  /**\n   * Used as the {@link Coding#getSystem()} for custom-to-BFD {@link Identifier#getType()} codes.\n   */\n  static final String CODING_SYSTEM_IDENTIFIER_TYPE =\n      BASE_URL_BBAPI_RESOURCES + \"/codesystem/identifier-type\";\n\n  /**\n   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the identifier is a PDP.\n   */\n  static final String CODED_IDENTIFIER_TYPE_PDP = \"NCPDP\";\n\n  /**\n   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the identifier is a PDP.\n   */\n  static final String CODED_IDENTIFIER_TYPE_PDP_DISPLAY = \"National Council for Prescription Drug Programs\";", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470698397", "createdAt": "2020-08-14T15:30:29Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMDAzNQ==", "bodyText": "Not a big deal, but I don't think that {@link Identifier#getServiceProviderIdentifiers()} is legit, is it?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470700035", "createdAt": "2020-08-14T15:33:55Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1NTM1Ng==", "bodyText": "Why is providerIdentifiers a vararg (why does it allow for zero to many entries)?\nIf you're just trying to avoid the need to refactor other uses of it, please don't -- this just adds to tech debt, overall, as your code below only supports zero-or-one providerIdentifiers, which puts the lie to the method signature. Instead, bite the bullet and make it an Optional<...>. If you really want to avoid the extra refactoring, you can always add an overloaded version of this method without the new parameter.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470755356", "createdAt": "2020-08-14T17:22:12Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODE5Mg==", "bodyText": "Also: this variable should be named identifierType.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470758192", "createdAt": "2020-08-14T17:27:45Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODQ2MA==", "bodyText": "I would suggest renaming this enum to IdentifierType.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470758460", "createdAt": "2020-08-14T17:28:20Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+public enum ServiceProviderIdentifiers {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2MDcyNA==", "bodyText": "I'd suggest adding JavaDoc for this method to make it clearer what it does. Also: you should probably fix the case on its params, so that they don't look like types.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470760724", "createdAt": "2020-08-14T17:32:43Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -30,6 +30,58 @@\n    */\n   @Test\n   public void transformSampleARecord() throws FHIRException {\n+    PartDEvent claim = getPartDEventClaim();\n+    ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n+    assertMatches(claim, eob);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNPI() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"01\";\n+    String serviceProviderCode = TransformerConstants.CODING_NPI_US;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"06\";\n+    String serviceProviderCode = TransformerConstants.CODING_UPIN;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNCPDP() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"07\";\n+    String serviceProviderCode = TransformerConstants.CODING_NCPDP;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithStateLicenseNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"08\";\n+    String serviceProviderCode = TransformerConstants.CODING_STATE_LICENSE;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithFederalTaxNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"11\";\n+    String serviceProviderCode = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  private void checkOrgAndFacility(\n+      String ServiceProviderIdQualiferCode, String ServiceProviderCode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NDc1NA==", "bodyText": "I don't think these changes in the output are related to your coding changes and I suspect that the tests will still pass if you revert them. Please try really hard to only change as little as you have to in these files.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470764754", "createdAt": "2020-08-14T17:41:25Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdAll.json", "diffHunk": "@@ -2059,14 +2059,14 @@\n         \"type\" : [ {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"external-first\",\n-            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"\n+            \"code\" : \"principal\",\n+            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n           } ]\n         }, {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"principal\",\n-            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n+            \"code\" : \"external-first\",\n+            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NDg3NQ==", "bodyText": "I don't think these changes in the output are related to your coding changes and I suspect that the tests will still pass if you revert them. Please try really hard to only change as little as you have to in these files.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470764875", "createdAt": "2020-08-14T17:41:42Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdPaged.json", "diffHunk": "@@ -2065,14 +2065,14 @@\n         \"type\" : [ {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"external-first\",\n-            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"\n+            \"code\" : \"principal\",\n+            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n           } ]\n         }, {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"principal\",\n-            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n+            \"code\" : \"external-first\",\n+            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NjAwMw==", "bodyText": "I would suggest putting this fix in a separate PR. Also: if the file format changed, in addition to the extension, the code that parses+processes it will also require updates.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470766003", "createdAt": "2020-08-14T17:44:11Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/FDADrugDataUtilityApp.java", "diffHunk": "@@ -111,11 +111,11 @@ private static void buildProductsResource(Path convertedNdcDataFile, Path workin\n \n     // unzip FDA NDC file\n     unzip(downloadedNdcZipFile, workingDir);\n-    Path originalNdcDataFile = workingDir.resolve(\"product.txt\");\n+    Path originalNdcDataFile = workingDir.resolve(\"product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      originalNdcDataFile = workingDir.resolve(\"Product.txt\");\n+      originalNdcDataFile = workingDir.resolve(\"Product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      throw new IllegalStateException(\"Unable to locate product.txt in \" + ndctextZipUrl);\n+      throw new IllegalStateException(\"Unable to locate product.xls in \" + ndctextZipUrl);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2Njg1MQ==", "bodyText": "Public types like this should really have some JavaDoc explaining their purpose, how to use them, etc.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470766851", "createdAt": "2020-08-14T17:45:48Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+public enum ServiceProviderIdentifiers {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8ef559d7e767ad41ab01196384e8da8f84c0a87", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b8ef559d7e767ad41ab01196384e8da8f84c0a87", "committedDate": "2020-08-14T22:40:07Z", "message": "Code review changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dd2e3dcbf6d7c317925cf5acd7f062413e464bf", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/8dd2e3dcbf6d7c317925cf5acd7f062413e464bf", "committedDate": "2020-08-14T22:49:09Z", "message": "Added java doc for identifiertype enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b3c3ec96fff9b1a236e7cf7dffcdffd78d57395", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4b3c3ec96fff9b1a236e7cf7dffcdffd78d57395", "committedDate": "2020-08-14T22:51:48Z", "message": "Added java doc for identifiertype enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bf8420b4d06a166f9c490c6c27642d5f446683c", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4bf8420b4d06a166f9c490c6c27642d5f446683c", "committedDate": "2020-08-14T23:32:43Z", "message": "Ignore changed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04fab6f9552b75ce6b5eb43489dbf743971cecd8", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/04fab6f9552b75ce6b5eb43489dbf743971cecd8", "committedDate": "2020-08-14T23:38:26Z", "message": "Ignore changed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef48a96191f11f8ee030b1291b47a5cfe2e2606", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6ef48a96191f11f8ee030b1291b47a5cfe2e2606", "committedDate": "2020-08-14T23:46:04Z", "message": "Ignore for response files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e91ae0716c523fb837f087f3e238ead7e88c536", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6e91ae0716c523fb837f087f3e238ead7e88c536", "committedDate": "2020-08-15T00:28:29Z", "message": "Responses added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d940fd4d0e27051c4d1ce9dca12478e5458c9c", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/d1d940fd4d0e27051c4d1ce9dca12478e5458c9c", "committedDate": "2020-08-15T00:31:31Z", "message": "Undo response chanages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08eaceb87df3eb207a5cd15911dba1bc4b148ca", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b08eaceb87df3eb207a5cd15911dba1bc4b148ca", "committedDate": "2020-08-16T02:14:41Z", "message": "Added responses to project to make test pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/9bd37d07172271dcb0d07a773c178c4c4fcf7cab", "committedDate": "2020-08-16T05:31:17Z", "message": "Undo ignore in generate responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTExNjI2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-468511626", "createdAt": "2020-08-17T14:25:36Z", "commit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyNTozNlrOHBrB0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyODowOVrOHBrI1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUxNTYwMQ==", "bodyText": "Yeah, I thought about suggesting you move the constants here, but wasn't \ud83d\udcaf  on it. On the one hand, it's nice to have all the custom codesets in one place to inspect them. On the other, I'm not a fan of the indirection it adds.\nAnywhoways, entirely your call on what the better choice is: here or the enum. (I guess if you wanted to put them in the enum you could drop a comment here pointing to it. \ud83e\udd37 )", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471515601", "createdAt": "2020-08-17T14:25:36Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,21 +163,76 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a NPI.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_NPI = \"NPI\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a NPI.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_NPI_DISPLAY = \"National Provider Identifier\";\n+\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a UPIN.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_UPIN = \"UPIN\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a UPIN.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_UPIN_DISPLAY = \"Unique Physician Identification Number\";\n+\n   /** The Code System, as available at <a */\n-  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+  static final String CODING_SYSTEM_HL7_IDENTIFIER_TYPE =\n       \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n \n-  /** The Code System, as available for UPIN */\n-  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+  /**\n+   * Used as the {@link Coding#getSystem()} for custom-to-BFD {@link Identifier#getType()} codes.\n+   */\n+  static final String CODING_SYSTEM_IDENTIFIER_TYPE =\n+      BASE_URL_BBAPI_RESOURCES + \"/codesystem/identifier-type\";\n \n-  /** The Code System, as available for NCPDP */\n-  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a PDP.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_PDP = \"NCPDP\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a PDP.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_PDP_DISPLAY =\n+      \"National Council for Prescription Drug Programs\";\n+\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a DL.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_DL = \"DL\";\n \n-  /** The Code System, as available for State License Number */\n-  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a DL.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_DL_DISPLAY = \"State license number\";\n \n-  /** The Code System, as available for Federal Tax Number */\n-  static final String CODING_FEDERAL_TAX_NUM = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a TAX.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_TAX = \"TAX\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a TAX.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_TAX_DISPLAY = \"Federal tax number\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUxNjIxNg==", "bodyText": "\ud83d\udc68\u200d\ud83c\udf73 \ud83d\udc8b", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471516216", "createdAt": "2020-08-17T14:26:30Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,40 +701,41 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n-   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n-   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(\n-      String identifierSystem,\n-      String identifierValue,\n-      ServiceProviderIdentifiers... providerIdentifiers) {\n-\n-    Reference reference = new Reference();\n-    if (providerIdentifiers.length > 0) {\n-      Coding coding =\n-          new Coding()\n-              .setSystem(providerIdentifiers[0].bySystem())\n-              .setCode(providerIdentifiers[0].byCode())\n-              .setDisplay(providerIdentifiers[0].byDisplay());\n-      List<Coding> codingList = new ArrayList<Coding>();\n-      codingList.add(coding);\n-\n-      CodeableConcept codeableConcept = new CodeableConcept().setCoding(codingList);\n-      reference.setIdentifier(\n-          new Identifier()\n-              .setSystem(identifierSystem)\n-              .setValue(identifierValue)\n-              .setType(codeableConcept));\n+  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n \n-    } else {\n-      reference.setIdentifier(\n-          new Identifier().setSystem(identifierSystem).setValue(identifierValue));\n-    }\n+    return new Reference()\n+        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n+        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  }\n \n-    reference.setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  /**\n+   * @param identifierType the {@link gov.cms.bfd.server.war.stu3.providers.IdentifierType}\n+   * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n+   *     Reference#getIdentifier()}\n+   * @return a {@link Reference} with the specified {@link Identifier}\n+   */\n+  static Reference createIdentifierReference(\n+      IdentifierType identifierType, String identifierValue) {\n \n-    return reference;\n+    Reference reference = new Reference();\n+    Coding coding =\n+        new Coding()\n+            .setSystem(identifierType.bySystem())\n+            .setCode(identifierType.byCode())\n+            .setDisplay(identifierType.byDisplay());\n+    List<Coding> codingList = new ArrayList<Coding>();\n+    codingList.add(coding);\n+\n+    CodeableConcept codeableConcept = new CodeableConcept().setCoding(codingList);\n+    return reference\n+        .setIdentifier(\n+            new Identifier()\n+                .setSystem(identifierType.bySystem())\n+                .setValue(identifierValue)\n+                .setType(codeableConcept))\n+        .setDisplay(retrieveNpiCodeDisplay(identifierValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUxNzM5Ng==", "bodyText": "I'd go with \"get\" not \"by\".", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471517396", "createdAt": "2020-08-17T14:28:09Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/IdentifierType.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+/**\n+ * Enumerates the idenitifer types of values that for different code sets and their corresponding\n+ * system, code, and display values.\n+ */\n+public enum IdentifierType {\n+  NPI(\n+      TransformerConstants.CODING_NPI_US,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_NPI,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_NPI_DISPLAY),\n+  UPIN(\n+      TransformerConstants.CODING_SYSTEM_HL7_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_UPIN,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_UPIN_DISPLAY),\n+  NCPDP(\n+      TransformerConstants.CODING_SYSTEM_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_PDP,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_PDP_DISPLAY),\n+  SL(\n+      TransformerConstants.CODING_SYSTEM_HL7_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_DL,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_DL_DISPLAY),\n+  FTN(\n+      TransformerConstants.CODING_SYSTEM_HL7_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_TAX,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_TAX_DISPLAY);\n+\n+  public final String system;\n+  public final String code;\n+  public final String display;\n+\n+  private IdentifierType(String system, String code, String display) {\n+    this.system = system;\n+    this.code = code;\n+    this.display = display;\n+  }\n+  /** @return the string for the corresponding system for the enum value */\n+  public String bySystem() {\n+    return system;\n+  }\n+  /** @return the string for the corresponding code for the enum value */\n+  public String byCode() {\n+    return code;\n+  }\n+  /** @return the string for the corresponding display for the enum value */\n+  public String byDisplay() {\n+    return display;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ab1c1659d4ed581a87031f873bfcaf6393b7f8f", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/2ab1c1659d4ed581a87031f873bfcaf6393b7f8f", "committedDate": "2020-08-17T15:35:13Z", "message": "Changes from pr comments to change the bymethods to getmethods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "045811f07b83af231edef41b998c195931404378", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/045811f07b83af231edef41b998c195931404378", "committedDate": "2020-08-17T15:46:53Z", "message": "Changes from pr comments to change the bymethods to getmethods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f94c542e0b8ac3b1fb69b72eedcd18eea8cd83ee", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f94c542e0b8ac3b1fb69b72eedcd18eea8cd83ee", "committedDate": "2020-08-17T15:48:13Z", "message": "Responses generated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22020a30fce6680f4ebc488c2daced5ff53471ed", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/22020a30fce6680f4ebc488c2daced5ff53471ed", "committedDate": "2020-08-17T17:25:44Z", "message": "Undo ignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f3cb29365a89c3848bf219ad9f8eba693049646", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6f3cb29365a89c3848bf219ad9f8eba693049646", "committedDate": "2020-08-18T18:20:10Z", "message": "Added debug switch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48bb03d8a9c1a72d5f6de2589f371a981b2f8b0c", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/48bb03d8a9c1a72d5f6de2589f371a981b2f8b0c", "committedDate": "2020-08-18T18:42:03Z", "message": "Switch to -e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e7e2fa9d870ad3037fcb7aef512e5075ee94cb", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b1e7e2fa9d870ad3037fcb7aef512e5075ee94cb", "committedDate": "2020-08-18T19:20:16Z", "message": "Added mac os"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e7bf604dbd804a9984f85b90c24f7183fcd3718", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4e7bf604dbd804a9984f85b90c24f7183fcd3718", "committedDate": "2020-08-18T20:20:56Z", "message": "Switch GH Actions runner to macos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ee8240a23258979f8178141198f086e7e25a034", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7ee8240a23258979f8178141198f086e7e25a034", "committedDate": "2020-08-18T20:43:38Z", "message": "Order entries by keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ef68c08a11972ef1db142781821f0588bd04fd", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/54ef68c08a11972ef1db142781821f0588bd04fd", "committedDate": "2020-08-18T21:10:07Z", "message": "Added serialization feature for keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b5f8f49a8019b054dcef2aaca4b49d94580fa75", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3b5f8f49a8019b054dcef2aaca4b49d94580fa75", "committedDate": "2020-08-18T21:14:13Z", "message": "Added serialization feature for keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a96a31144178dcc38e5f9f59bbab3a9067620578", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a96a31144178dcc38e5f9f59bbab3a9067620578", "committedDate": "2020-08-19T07:03:12Z", "message": "Added compare to order diagnosis types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b66659e779b54dc56c8f087f6ab515b62cdd485", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/9b66659e779b54dc56c8f087f6ab515b62cdd485", "committedDate": "2020-08-19T15:59:05Z", "message": "Changed and added comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeddaa244047e659fe581c6c9dcafed3fdf8b270", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/eeddaa244047e659fe581c6c9dcafed3fdf8b270", "committedDate": "2020-08-19T16:06:26Z", "message": "Added comments to the fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a3baf387a2da97a5cfccdbfa1531cf34eceb2e6", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/5a3baf387a2da97a5cfccdbfa1531cf34eceb2e6", "committedDate": "2020-08-19T17:20:22Z", "message": "Merge branch 'cbrune/fixunordereditems' into cbrune/BFD-314-part-d-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b248ae79248ce47f8e36c157a6b2c8612c1582a", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/2b248ae79248ce47f8e36c157a6b2c8612c1582a", "committedDate": "2020-08-19T17:31:54Z", "message": "Added IT bug that was found"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b068774ea493a32c0bda76634a490a3586e8b897", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b068774ea493a32c0bda76634a490a3586e8b897", "committedDate": "2020-08-27T15:16:08Z", "message": "Merge branch 'master' into cbrune/BFD-314-part-d-fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a4583431c7e4b12b87e14347eb2e1899f2f4ad", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/88a4583431c7e4b12b87e14347eb2e1899f2f4ad", "committedDate": "2020-08-27T15:30:53Z", "message": "deleted space in IT tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNzA2OTY0", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-482706964", "createdAt": "2020-09-04T14:38:46Z", "commit": {"oid": "88a4583431c7e4b12b87e14347eb2e1899f2f4ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzA4NzEx", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-459308711", "createdAt": "2020-07-31T16:35:08Z", "commit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "state": "COMMENTED", "comments": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjozNTowOFrOG6Oytg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMTo0MjoyMFrOHBEFtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMjk1MA==", "bodyText": "removed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463712950", "createdAt": "2020-07-31T16:35:08Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";\n+\n+  /** The Other as available at <a */\n+  static final String CODING_OTHER = \"https://bluebutton.cms.gov/resources/variables/other\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNDAzNg=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTI5MQ==", "bodyText": "yep refactored the tests", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765291", "createdAt": "2020-07-31T18:27:20Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -40,7 +40,23 @@ public void transformSampleARecord() throws FHIRException {\n             .get();\n \n     ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n-    assertMatches(claim, eob);\n+    assertPartDMatches(claim, eob, \"01\", \"01\", TransformerConstants.CODING_NPI_US);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    List<Object> parsedRecords =\n+        ServerTestUtils.parseData(\n+            Arrays.asList(StaticRifResourceGroup.SAMPLE_A_UPIN.getResources()));\n+    PartDEvent claim =\n+        parsedRecords.stream()\n+            .filter(r -> r instanceof PartDEvent)\n+            .map(r -> (PartDEvent) r)\n+            .findFirst()\n+            .get();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNTk3MA=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTUyNg==", "bodyText": "Yea removed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765526", "createdAt": "2020-07-31T18:27:55Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResourceGroup.java", "diffHunk": "@@ -20,6 +20,19 @@\n       StaticRifResource.SAMPLE_A_SNF,\n       StaticRifResource.SAMPLE_A_DME),\n \n+  SAMPLE_A_UPIN(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjkwMw=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTU5Mg==", "bodyText": "Removed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765592", "createdAt": "2020-07-31T18:28:05Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/resources/rif-static-samples/sample-a-pde-upin.txt", "diffHunk": "@@ -0,0 +1,2 @@\n+DML_IND|PDE_ID|CLM_GRP_ID|FINAL_ACTION|BENE_ID|SRVC_DT|PD_DT|SRVC_PRVDR_ID_QLFYR_CD|SRVC_PRVDR_ID|PRSCRBR_ID_QLFYR_CD|PRSCRBR_ID|RX_SRVC_RFRNC_NUM|PROD_SRVC_ID|PLAN_CNTRCT_REC_ID|PLAN_PBP_REC_NUM|CMPND_CD|DAW_PROD_SLCTN_CD|QTY_DSPNSD_NUM|DAYS_SUPLY_NUM|FILL_NUM|DSPNSNG_STUS_CD|DRUG_CVRG_STUS_CD|ADJSTMT_DLTN_CD|NSTD_FRMT_CD|PRCNG_EXCPTN_CD|CTSTRPHC_CVRG_CD|GDC_BLW_OOPT_AMT|GDC_ABV_OOPT_AMT|PTNT_PAY_AMT|OTHR_TROOP_AMT|LICS_AMT|PLRO_AMT|CVRD_D_PLAN_PD_AMT|NCVRD_PLAN_PD_AMT|TOT_RX_CST_AMT|RX_ORGN_CD|RPTD_GAP_DSCNT_NUM|BRND_GNRC_CD|PHRMCY_SRVC_TYPE_CD|PTNT_RSDNC_CD|SUBMSN_CLR_CD", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NzEzNQ=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTg4NA==", "bodyText": "yea your right, i was testing with a different dataset and forgot to place it back", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765884", "createdAt": "2020-07-31T18:28:39Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -209,7 +210,7 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n         .setAmount(TransformerUtils.createMoney(claimGroup.getGapDiscountAmount()));\n \n     if (claimGroup.getPrescriberIdQualifierCode() == null\n-        || !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))\n+        && !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5Nzg3Mw=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI4Njg1MA==", "bodyText": "done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467286850", "createdAt": "2020-08-07T21:38:46Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,43 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MDk4MQ=="}, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzMDMwOQ==", "bodyText": "Undo since they changed it back to .txt", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470830309", "createdAt": "2020-08-14T19:38:00Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/FDADrugDataUtilityApp.java", "diffHunk": "@@ -111,11 +111,11 @@ private static void buildProductsResource(Path convertedNdcDataFile, Path workin\n \n     // unzip FDA NDC file\n     unzip(downloadedNdcZipFile, workingDir);\n-    Path originalNdcDataFile = workingDir.resolve(\"product.txt\");\n+    Path originalNdcDataFile = workingDir.resolve(\"product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      originalNdcDataFile = workingDir.resolve(\"Product.txt\");\n+      originalNdcDataFile = workingDir.resolve(\"Product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      throw new IllegalStateException(\"Unable to locate product.txt in \" + ndctextZipUrl);\n+      throw new IllegalStateException(\"Unable to locate product.xls in \" + ndctextZipUrl);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NjAwMw=="}, "originalCommit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNDg3Ng==", "bodyText": "renamed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470834876", "createdAt": "2020-08-14T19:49:21Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+public enum ServiceProviderIdentifiers {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODQ2MA=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjI3Mw==", "bodyText": "Renamed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836273", "createdAt": "2020-08-14T19:52:35Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4ODc3MQ=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjMzMQ==", "bodyText": "Deleted", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836331", "createdAt": "2020-08-14T19:52:44Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTcxMA=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjQxOA==", "bodyText": "Deleted", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836418", "createdAt": "2020-08-14T19:52:56Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTc3Ng=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjQ2NQ==", "bodyText": "Deleted", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836465", "createdAt": "2020-08-14T19:53:02Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for Federal Tax Number */\n+  static final String CODING_FEDERAL_TAX_NUM = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTg1Nw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjcyMw==", "bodyText": "Changed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836723", "createdAt": "2020-08-14T19:53:37Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,58 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     * This chart is to dosplay the different code values for the different service provider id qualifer\n+     * codes below\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem;\n+    ServiceProviderIdentifiers providerIdentifier;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          providerIdentifier = ServiceProviderIdentifiers.NPI;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          providerIdentifier = ServiceProviderIdentifiers.UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          providerIdentifier = ServiceProviderIdentifiers.NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE;\n+          providerIdentifier = ServiceProviderIdentifiers.SL;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+          providerIdentifier = ServiceProviderIdentifiers.FTN;\n+          break;\n+        default:\n+          identiferSystem = null;\n+          providerIdentifier = null;\n+          break;\n+      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4NTc2Mw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg0MjgyMQ==", "bodyText": "Added it and place all the other strings in the transfomer constants", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470842821", "createdAt": "2020-08-14T20:08:45Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5ODM5Nw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDQyOQ==", "bodyText": "Yea i just made an overloaded function with IdentifierType and IdentifierValue as params", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470850429", "createdAt": "2020-08-14T20:27:56Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1NTM1Ng=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDU1OQ==", "bodyText": "done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470850559", "createdAt": "2020-08-14T20:28:11Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODE5Mg=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg2MjUwOQ==", "bodyText": "fixed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470862509", "createdAt": "2020-08-14T20:59:47Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMDAzNQ=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg3NzYyMw==", "bodyText": "done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470877623", "createdAt": "2020-08-14T21:42:20Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -30,6 +30,58 @@\n    */\n   @Test\n   public void transformSampleARecord() throws FHIRException {\n+    PartDEvent claim = getPartDEventClaim();\n+    ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n+    assertMatches(claim, eob);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNPI() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"01\";\n+    String serviceProviderCode = TransformerConstants.CODING_NPI_US;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"06\";\n+    String serviceProviderCode = TransformerConstants.CODING_UPIN;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNCPDP() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"07\";\n+    String serviceProviderCode = TransformerConstants.CODING_NCPDP;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithStateLicenseNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"08\";\n+    String serviceProviderCode = TransformerConstants.CODING_STATE_LICENSE;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithFederalTaxNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"11\";\n+    String serviceProviderCode = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  private void checkOrgAndFacility(\n+      String ServiceProviderIdQualiferCode, String ServiceProviderCode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2MDcyNA=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTMwMjA4", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#pullrequestreview-485130208", "createdAt": "2020-09-09T15:28:22Z", "commit": {"oid": "88a4583431c7e4b12b87e14347eb2e1899f2f4ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 595, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}