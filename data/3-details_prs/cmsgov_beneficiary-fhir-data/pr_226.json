{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3ODk3OTM4", "number": 226, "title": "BLUEBUTTON-1810: Support env agnostic AMIs, remove code for unused deployment envs", "bodyText": "This PR accomplishes three things:\n\nSupports environment agnostic AMIs by moving all environment specific launch configuration into the launch.yml (BFD server), and removing all environment specific references along the build and deploy path within Jenkins and packer.\nRemoves branching path code for unused environments (healthapt, hhsdevcloud) to simplify the Jenkinsfile and build.groovy.  Also removes unused playbook code and handlers that accommodated unused environments.\nFormally disable use of gitCommitId at instance launch.  It has never properly worked due to GitHub having no context of this commit ID, as it is produced from a merge commit during a Jenkins build.", "createdAt": "2020-02-20T18:00:26Z", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226", "merged": true, "mergeCommit": {"oid": "026e9d84b39a8819dc7ee1423c6038a5b9eb6f2a"}, "closed": true, "closedAt": "2020-03-04T17:19:38Z", "author": {"login": "njdister"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFm-0vgH2gAyMzc3ODk3OTM4OjFmZGQ4NDAwMzg1YWFhMzlhZmE2MDUzNGRiZGI1N2RjNzhkMTI5NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKKSzlgFqTM2ODM4MTgxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1fdd8400385aaa39afa60534dbdb57dc78d12961", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1fdd8400385aaa39afa60534dbdb57dc78d12961", "committedDate": "2020-02-18T19:20:43Z", "message": "Remove healthapt + hhsdevcloud envs from groovy, remove deploy env references from packer and deploy-ccs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a153a227f8fe8f98296d4f682706b11674c1f9af", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a153a227f8fe8f98296d4f682706b11674c1f9af", "committedDate": "2020-02-20T17:43:19Z", "message": "Remove healthapt/hhsdevcloud reqs, move all pre-ami cert operations into post-ami launch, remove handlers on install due to immutable deploy in CCS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebae7a94a0d89df4f98a47aa67a4585e1ed3f4fe", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/ebae7a94a0d89df4f98a47aa67a4585e1ed3f4fe", "committedDate": "2020-02-20T17:45:31Z", "message": "Move SSH users into pre-ami stage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57ce06c15142ef4f18851fa3d0451e71a27293a9", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/57ce06c15142ef4f18851fa3d0451e71a27293a9", "committedDate": "2020-02-20T17:48:36Z", "message": "Move SSH users into pre-ami stage for bfd-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b693a432208300c671da54b15a227a27a74d997", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0b693a432208300c671da54b15a227a27a74d997", "committedDate": "2020-02-20T17:51:02Z", "message": "Remove handlers in bfd-pipeline for pre-ami due to immutable deploy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/acb4265653b493d7fad2a529da61bd9aaba25708", "committedDate": "2020-02-20T17:54:47Z", "message": "Move service def for bfd-server to post-ami stage to be consistent with bfd-pipeline"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTIxMTE0", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-364521114", "createdAt": "2020-02-25T23:18:27Z", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoxODoyN1rOFuY10A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoxODoyN1rOFuY10A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4NTgwOA==", "bodyText": "Unsure why bfd-pipeline did not require a vault_password_file definition previously.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384185808", "createdAt": "2020-02-25T23:18:27Z", "author": {"login": "njdister"}, "path": "ops/packer/build_bfd-pipeline.json", "diffHunk": "@@ -2,7 +2,7 @@\n   \"variables\": {\n     \"source_ami\": \"\",\n     \"subnet_id\": \"\",\n-    \"env\": \"\"\n+    \"vault_password_file\": \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTIyOTE2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-364522916", "createdAt": "2020-02-25T23:22:50Z", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyMjo1MFrOFuY8UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyMjo1MFrOFuY8UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4NzQ3Mw==", "bodyText": "Removing as this should no longer be needed in CCS environment.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384187473", "createdAt": "2020-02-25T23:22:50Z", "author": {"login": "njdister"}, "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTIzNzk5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-364523799", "createdAt": "2020-02-25T23:24:54Z", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyNDo1NFrOFuY_2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyNDo1NFrOFuY_2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4ODM3Nw==", "bodyText": "Removing as this shouldn't be needed in CCS, we just copy the keystore contained within the repo after this task anyway.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384188377", "createdAt": "2020-02-25T23:24:54Z", "author": {"login": "njdister"}, "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-\n - name: Copy BFD Server Launcher\n   copy:\n     src: \"{{ data_server_launcher }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_launcher | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n \n - name: Copy BFD Server WAR\n   copy:\n     src: \"{{ data_server_war }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_war | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Copy App Server Launcher Script\n-  template:\n-    src: bfd-server.sh.j2\n-    dest: \"{{ data_server_dir }}/bfd-server.sh\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server Service Definition\n-  template:\n-    src: bluebutton-appserver.service.j2\n-    dest: \"/etc/systemd/system/{{ data_server_appserver_service }}.service\"\n-    owner: root\n-    group: root\n-    mode: u=rw,g=r,o=r\n-  become: true\n-  notify:\n-    - 'Enable BFD Server Service'\n-    - 'Restart BFD Server Service'\n-\n-- name: Check for BFD Server SSL Keystore\n-  stat:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-  register: stat_appserver_keystore\n-  changed_when: false\n-  become: true\n-\n-- name: Create BFD Server SSL Keystore\n-  command: \"keytool -genkeypair -alias server {{ data_server_ssl_server_genkeypair_args }} -keystore {{ data_server_dir }}/bluebutton-appserver-keystore.jks -storepass changeit -keypass changeit\"\n-  when: stat_appserver_keystore.stat.isreg is not defined\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-  no_log: true  # Ensure that the key args aren't logged if this command fails.\n-  notify:\n-    - 'Restart BFD Server Service'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTI0MDc5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-364524079", "createdAt": "2020-02-25T23:25:33Z", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyNTozM1rOFuZBCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyNTozM1rOFuZBCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4ODY4Mg==", "bodyText": "Removed due to lack of use of data_server_ssl_client_cas in CCS.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384188682", "createdAt": "2020-02-25T23:25:33Z", "author": {"login": "njdister"}, "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-\n - name: Copy BFD Server Launcher\n   copy:\n     src: \"{{ data_server_launcher }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_launcher | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n \n - name: Copy BFD Server WAR\n   copy:\n     src: \"{{ data_server_war }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_war | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Copy App Server Launcher Script\n-  template:\n-    src: bfd-server.sh.j2\n-    dest: \"{{ data_server_dir }}/bfd-server.sh\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server Service Definition\n-  template:\n-    src: bluebutton-appserver.service.j2\n-    dest: \"/etc/systemd/system/{{ data_server_appserver_service }}.service\"\n-    owner: root\n-    group: root\n-    mode: u=rw,g=r,o=r\n-  become: true\n-  notify:\n-    - 'Enable BFD Server Service'\n-    - 'Restart BFD Server Service'\n-\n-- name: Check for BFD Server SSL Keystore\n-  stat:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-  register: stat_appserver_keystore\n-  changed_when: false\n-  become: true\n-\n-- name: Create BFD Server SSL Keystore\n-  command: \"keytool -genkeypair -alias server {{ data_server_ssl_server_genkeypair_args }} -keystore {{ data_server_dir }}/bluebutton-appserver-keystore.jks -storepass changeit -keypass changeit\"\n-  when: stat_appserver_keystore.stat.isreg is not defined\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-  no_log: true  # Ensure that the key args aren't logged if this command fails.\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-# TODO: Export server's public cert and publish to S3 or somesuch (so the frontend and others can pick it up).\n-\n-- name: Secure BFD Server SSL Keystore\n-  file:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rw,g=,o=\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server SSL Truststore Working Directory\n-  file:\n-    state: directory\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-\n-- name: Delete Previous BFD Server SSL Truststore Working Copy\n-  file:\n-    state: absent\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks\"\n-  changed_when: false\n-  become: true\n-\n-- name: Create Empty App Server SSL Truststore Working Copy\n-  command: \"{{ item }}\"\n-  with_items:\n-    - \"keytool -genkeypair -alias fake -dname cn=fake -keypass changeit -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit\"\n-    - \"keytool -delete -alias fake -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit -keypass changeit\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificates\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_certificates }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificate Authorities\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_cas }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "originalPosition": 121}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTI0MTY2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-364524166", "createdAt": "2020-02-25T23:25:45Z", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyNTo0NlrOFuZBdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyNTo0NlrOFuZBdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4ODc5MA==", "bodyText": "Removed due to lack of use of data_server_ssl_client_cas in CCS.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384188790", "createdAt": "2020-02-25T23:25:46Z", "author": {"login": "njdister"}, "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-\n - name: Copy BFD Server Launcher\n   copy:\n     src: \"{{ data_server_launcher }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_launcher | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n \n - name: Copy BFD Server WAR\n   copy:\n     src: \"{{ data_server_war }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_war | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Copy App Server Launcher Script\n-  template:\n-    src: bfd-server.sh.j2\n-    dest: \"{{ data_server_dir }}/bfd-server.sh\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server Service Definition\n-  template:\n-    src: bluebutton-appserver.service.j2\n-    dest: \"/etc/systemd/system/{{ data_server_appserver_service }}.service\"\n-    owner: root\n-    group: root\n-    mode: u=rw,g=r,o=r\n-  become: true\n-  notify:\n-    - 'Enable BFD Server Service'\n-    - 'Restart BFD Server Service'\n-\n-- name: Check for BFD Server SSL Keystore\n-  stat:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-  register: stat_appserver_keystore\n-  changed_when: false\n-  become: true\n-\n-- name: Create BFD Server SSL Keystore\n-  command: \"keytool -genkeypair -alias server {{ data_server_ssl_server_genkeypair_args }} -keystore {{ data_server_dir }}/bluebutton-appserver-keystore.jks -storepass changeit -keypass changeit\"\n-  when: stat_appserver_keystore.stat.isreg is not defined\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-  no_log: true  # Ensure that the key args aren't logged if this command fails.\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-# TODO: Export server's public cert and publish to S3 or somesuch (so the frontend and others can pick it up).\n-\n-- name: Secure BFD Server SSL Keystore\n-  file:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rw,g=,o=\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server SSL Truststore Working Directory\n-  file:\n-    state: directory\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-\n-- name: Delete Previous BFD Server SSL Truststore Working Copy\n-  file:\n-    state: absent\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks\"\n-  changed_when: false\n-  become: true\n-\n-- name: Create Empty App Server SSL Truststore Working Copy\n-  command: \"{{ item }}\"\n-  with_items:\n-    - \"keytool -genkeypair -alias fake -dname cn=fake -keypass changeit -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit\"\n-    - \"keytool -delete -alias fake -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit -keypass changeit\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificates\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_certificates }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificate Authorities\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_cas }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Import Certificates into App Server SSL Truststore Working Copy\n-  java_cert:\n-    cert_alias: \"{{ item.alias }}\"\n-    cert_path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-    keystore_pass: changeit\n-    keystore_path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks\"\n-  with_items: \"{{ data_server_ssl_client_certificates }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Import Certificate Authorities into App Server SSL Truststore Working Copy\n-  command: \"keytool -importcert -noprompt -trustcacerts -alias {{ item.alias }} -file {{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt -keypass changeit -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit\"\n-  with_items: \"{{ data_server_ssl_client_cas }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "originalPosition": 139}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTI1NTk0", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-364525594", "createdAt": "2020-02-25T23:29:16Z", "commit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyOToxN1rOFuZGSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyOToxN1rOFuZGSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MDAyNw==", "bodyText": "I can't think of any reason to to have a default env, potential vector for misconfiguration with agnostic AMIs.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384190027", "createdAt": "2020-02-25T23:29:17Z", "author": {"login": "njdister"}, "path": "ops/ansible/playbooks-ccs/launch_bfd-pipeline.yml", "diffHunk": "@@ -4,8 +4,6 @@\n ##\n - name: Configure ETL Server\n   hosts: localhost\n-  vars:\n-    env: \"test\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f130c769b7031bc1b0cca9fc35addef89d59920e", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f130c769b7031bc1b0cca9fc35addef89d59920e", "committedDate": "2020-02-26T20:19:18Z", "message": "Remove enviornmentId from params of buildAppAmis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72b31b780c517090558d5f98c4fd95f108c2c29f", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/72b31b780c517090558d5f98c4fd95f108c2c29f", "committedDate": "2020-02-26T20:40:26Z", "message": "With our current Jenkins merge strategy, the passed commit ID from Jenkins cannot be used with a repo checked out directly from GitHub"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39ef6602ce7f6815ec45460ec8b435e1a7e49cd9", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/39ef6602ce7f6815ec45460ec8b435e1a7e49cd9", "committedDate": "2020-02-26T21:09:03Z", "message": "Leave uncommented in terraform, be more explicit in template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "327cca1af977ea790a18a6dda285e931b12c7299", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/327cca1af977ea790a18a6dda285e931b12c7299", "committedDate": "2020-02-26T22:28:15Z", "message": "Add rng-tools in hopes of increasing slow truststore generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93f18bebaf32f5433ef494a3a600b2bac8a44268", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/93f18bebaf32f5433ef494a3a600b2bac8a44268", "committedDate": "2020-02-27T17:48:45Z", "message": "DEBUG: add playbook statements to assist debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f771570ebb05ed2c6bbc16a8837cbc264f1a6edf", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f771570ebb05ed2c6bbc16a8837cbc264f1a6edf", "committedDate": "2020-02-27T18:13:04Z", "message": "DEBUG: narrowing down debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eb93d6171202eb033c32bba63aa3fe6d535b8a5", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0eb93d6171202eb033c32bba63aa3fe6d535b8a5", "committedDate": "2020-02-27T18:37:02Z", "message": "DEBUG: narrowing down debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57e8c25ee54030c88418e6d4dd1e77621418bf36", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/57e8c25ee54030c88418e6d4dd1e77621418bf36", "committedDate": "2020-02-27T18:46:27Z", "message": "DEBUG: narrowing down debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "803036642e12c69e05cde26145acdb6c9eef6126", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/803036642e12c69e05cde26145acdb6c9eef6126", "committedDate": "2020-02-27T19:03:41Z", "message": "DEBUG: narrowing down debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3023817048265eafb6f5313e2378c7012900f9fe", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3023817048265eafb6f5313e2378c7012900f9fe", "committedDate": "2020-02-27T19:14:55Z", "message": "DEBUG: narrowing down debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b484f4a06e82131a3fd7133d528918682b82de8a", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b484f4a06e82131a3fd7133d528918682b82de8a", "committedDate": "2020-02-27T19:28:15Z", "message": "DEBUG: issue isolated to become_user, testing solutions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b91a68665fe54ff4c018033d647696d31351f7e", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1b91a68665fe54ff4c018033d647696d31351f7e", "committedDate": "2020-02-27T19:42:23Z", "message": "DEBUG: test connection local"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc9ea6c8eaa310c2715ff98f08d1ce6928aa08fd", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/bc9ea6c8eaa310c2715ff98f08d1ce6928aa08fd", "committedDate": "2020-02-27T20:03:26Z", "message": "DEBUG: test alternate become method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c697b8a4a99a9a7f5208bbce4d7431cfdc29316", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7c697b8a4a99a9a7f5208bbce4d7431cfdc29316", "committedDate": "2020-02-27T21:29:31Z", "message": "DEBUG: test timeliness of playbook when commenting out become_user, add perms fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f22ae1a328f3cbda37f6d97aaef165588c15c4a5", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f22ae1a328f3cbda37f6d97aaef165588c15c4a5", "committedDate": "2020-02-27T21:31:07Z", "message": "DEBUG: set perms recursively"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "debb915c85a2e05c97183e8ff651d31454a6bec7", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/debb915c85a2e05c97183e8ff651d31454a6bec7", "committedDate": "2020-02-27T21:46:50Z", "message": "DEBUG: testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "committedDate": "2020-03-02T15:31:01Z", "message": "Comment out debug to test deploy times"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MzQyODQw", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-367342840", "createdAt": "2020-03-02T16:32:06Z", "commit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozMjowNlrOFwmV1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozMjowNlrOFwmV1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDE0OA==", "bodyText": "It appears this was never working as intended, though if it was it would have broken due to the fact that the the commit ID is a unique merge commit that cannot be referenced from anywhere other than in that Jenkins build.  Fixing intended behavior here, but commenting out in the launch template.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386504148", "createdAt": "2020-03-02T16:32:06Z", "author": {"login": "njdister"}, "path": "ops/terraform/modules/resources/asg/main.tf", "diffHunk": "@@ -127,7 +127,7 @@ resource \"aws_launch_template\" \"main\" {\n     port          = var.lb_config.port\n     accountId     = var.launch_config.account_id\n     gitBranchName = var.launch_config.git_branch\n-    gitCommitId   = var.launch_config.git_branch\n+    gitCommitId   = var.launch_config.git_commit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MzQzNjE2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-367343616", "createdAt": "2020-03-02T16:33:01Z", "commit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozMzowMVrOFwmYXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozMzowMVrOFwmYXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDc5Nw==", "bodyText": "Disabling this feature here until it's refactored to work as intended.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386504797", "createdAt": "2020-03-02T16:33:01Z", "author": {"login": "njdister"}, "path": "ops/terraform/modules/resources/templates/fhir_server.tpl", "diffHunk": "@@ -13,7 +13,9 @@ git clone https://github.com/CMSgov/beneficiary-fhir-data.git --branch ${gitBran\n \n cd beneficiary-fhir-data/ops/ansible/playbooks-ccs/\n \n-git checkout ${gitCommitId}\n+# At this time gitCommitId is a unique merge commit in Jenkins that cannot be properly\n+# checked out via GitHub, uncommenting this will break instance launch!\n+# git checkout ${gitCommitId}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MzQzNzYy", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-367343762", "createdAt": "2020-03-02T16:33:11Z", "commit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozMzoxMVrOFwmY0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozMzoxMVrOFwmY0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDkxMg==", "bodyText": "Disabling this feature here until it's refactored to work as intended.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386504912", "createdAt": "2020-03-02T16:33:11Z", "author": {"login": "njdister"}, "path": "ops/terraform/modules/resources/templates/pipeline_server.tpl", "diffHunk": "@@ -13,7 +13,9 @@ git clone https://github.com/CMSgov/beneficiary-fhir-data.git --branch ${gitBran\n \n cd beneficiary-fhir-data/ops/ansible/playbooks-ccs/\n \n-git checkout ${gitCommitId}\n+# At this time gitCommitId is a unique merge commit in Jenkins that cannot be properly\n+# checked out via GitHub, uncommenting this will break instance launch!\n+# git checkout ${gitCommitId}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb6b8a529d56dbe15f2fafd39c283bd3b7f49bfc", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cb6b8a529d56dbe15f2fafd39c283bd3b7f49bfc", "committedDate": "2020-03-02T16:37:06Z", "message": "Use permissions setting rather than become_user to set permissions on certs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5", "author": {"user": null}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f917a2819fd5a41494c60e53e65f19f49aa9b9f5", "committedDate": "2020-03-02T16:46:52Z", "message": "Revert \"Add rng-tools in hopes of increasing slow truststore generation\"\n\nThis reverts commit 327cca1af977ea790a18a6dda285e931b12c7299."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDA4Mzc5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-367408379", "createdAt": "2020-03-02T18:01:59Z", "commit": {"oid": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDU1MDEy", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-367455012", "createdAt": "2020-03-02T19:12:32Z", "commit": {"oid": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOToxMjozMlrOFwrxWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOToxMjozMlrOFwrxWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5MzExMw==", "bodyText": "I really love the fact that you are removing all of the healthapt cases.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386593113", "createdAt": "2020-03-02T19:12:32Z", "author": {"login": "RickHawesUSDS"}, "path": "apps/build.groovy", "diffHunk": "@@ -70,12 +49,9 @@ class AppBuildResults implements Serializable {\n  \n def build(String build_env) {\n \tdir ('apps') {\n-\t\tif (build_env == 'healthapt') {\n-\t\t\tmvn \"--update-snapshots -Dmaven.test.failure.ignore clean verify -Dhttp.nonProxyHosts=localhost\"\n-\t\t} else if (build_env == 'ccs') {\n-\t\t\tmvn \"--update-snapshots -Dmaven.test.failure.ignore clean verify\"\n-\t\t} else \n-\t\tUnsupportedOperationException(\"No Build Apps job available for ${params.dev_env} environment\")\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzgxODE2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#pullrequestreview-368381816", "createdAt": "2020-03-03T22:44:55Z", "commit": {"oid": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 686, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}