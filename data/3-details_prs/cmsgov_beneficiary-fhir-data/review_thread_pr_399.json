{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzc0NzQ5", "number": 399, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0MjozMlrOE6HJgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODozNjoyM1rOE7MIPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzY5OTg1OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0MjozMlrOH0-hwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0MjozMlrOH0-hwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMjQ0OQ==", "bodyText": "I'd suggest a slight wording tweak to clarify your intent here:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /**\n          \n          \n            \n               * @param string tring to parse\n          \n          \n            \n               * @return an {@link String} with a null representation stripped from it if the input has a null\n          \n          \n            \n               *     field representation.\n          \n          \n            \n               */\n          \n          \n            \n              public static String removeInvalidCharacters(String string) {\n          \n          \n            \n                String newString = string;\n          \n          \n            \n            \n          \n          \n            \n                // Null Field\n          \n          \n            \n                String nullFields = \"\\\\0\";\n          \n          \n            \n                if (!Strings.isNullOrEmpty(newString)) {\n          \n          \n            \n                  if (newString.contains(nullFields)) newString = newString.replace(nullFields, \"\");\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                return newString;\n          \n          \n            \n              }\n          \n          \n            \n              /**\n          \n          \n            \n               * @param string the {@link String} to parse\n          \n          \n            \n               * @return a copy of the specified {@link String} but with any/all null bytes it contained removed\n          \n          \n            \n               */\n          \n          \n            \n              public static String removeInvalidCharacters(String string) {\n          \n          \n            \n                String newString = string;\n          \n          \n            \n            \n          \n          \n            \n                String nullByte = \"\\\\0\";\n          \n          \n            \n                if (!Strings.isNullOrEmpty(newString)) {\n          \n          \n            \n                  if (newString.contains(nullByte)) newString = newString.replace(nullByte, \"\");\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                return newString;\n          \n          \n            \n              }", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525312449", "createdAt": "2020-11-17T16:42:32Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -269,4 +270,21 @@ public static Character parseCharacter(String charText) {\n       return Optional.of(parseCharacter(charText));\n     }\n   }\n+\n+  /**\n+   * @param string tring to parse\n+   * @return an {@link String} with a null representation stripped from it if the input has a null\n+   *     field representation.\n+   */\n+  public static String removeInvalidCharacters(String string) {\n+    String newString = string;\n+\n+    // Null Field\n+    String nullFields = \"\\\\0\";\n+    if (!Strings.isNullOrEmpty(newString)) {\n+      if (newString.contains(nullFields)) newString = newString.replace(nullFields, \"\");\n+    }\n+\n+    return newString;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzcwNTExOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/pom.xml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0Mzo0MlrOH0-lJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo0ODo1MVrOH1EGjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMzMxNw==", "bodyText": "If we're not already using this somewhere, you'll need to file a SIA for it. Shouldn't be a big deal, though.\nYou also might consider adding it to the new bfd-shared-utils module, instead, as it definitely is useful, in general.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525313317", "createdAt": "2020-11-17T16:43:42Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/pom.xml", "diffHunk": "@@ -22,6 +22,13 @@\n \t\t\t<artifactId>bfd-model-rif</artifactId>\n \t\t</dependency>\n \n+\t\t<dependency>\n+\t\t\t<!-- Just useful. -->\n+\t\t\t<groupId>com.google.guava</groupId>\n+\t\t\t<artifactId>guava</artifactId>\n+\t\t\t<version>24.1.1-jre</version>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0ODg4MA==", "bodyText": "We are already using this for BloomFilters. see: LoadedFilterTest.java - Would this still require an SIA with this being the case?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525348880", "createdAt": "2020-11-17T17:28:44Z", "author": {"login": "jzulim"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/pom.xml", "diffHunk": "@@ -22,6 +22,13 @@\n \t\t\t<artifactId>bfd-model-rif</artifactId>\n \t\t</dependency>\n \n+\t\t<dependency>\n+\t\t\t<!-- Just useful. -->\n+\t\t\t<groupId>com.google.guava</groupId>\n+\t\t\t<artifactId>guava</artifactId>\n+\t\t\t<version>24.1.1-jre</version>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMzMxNw=="}, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM3NDA5NQ==", "bodyText": "Would this still require an SIA with this being the case?\n\nNope!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525374095", "createdAt": "2020-11-17T18:02:55Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/pom.xml", "diffHunk": "@@ -22,6 +22,13 @@\n \t\t\t<artifactId>bfd-model-rif</artifactId>\n \t\t</dependency>\n \n+\t\t<dependency>\n+\t\t\t<!-- Just useful. -->\n+\t\t\t<groupId>com.google.guava</groupId>\n+\t\t\t<artifactId>guava</artifactId>\n+\t\t\t<version>24.1.1-jre</version>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMzMxNw=="}, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwMzc4OQ==", "bodyText": "awesome, added it to the bfd-shared-utils", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525403789", "createdAt": "2020-11-17T18:48:51Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/pom.xml", "diffHunk": "@@ -22,6 +22,13 @@\n \t\t\t<artifactId>bfd-model-rif</artifactId>\n \t\t</dependency>\n \n+\t\t<dependency>\n+\t\t\t<!-- Just useful. -->\n+\t\t\t<groupId>com.google.guava</groupId>\n+\t\t\t<artifactId>guava</artifactId>\n+\t\t\t<version>24.1.1-jre</version>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMzMxNw=="}, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzcxODU4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/src/test/java/gov/cms/bfd/pipeline/rif/extract/RifFilesProcessorTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0NjoyOVrOH0-tfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxNDoxN1rOH1AITw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNTQ1NA==", "bodyText": "I'd probably simplify this way down by:\n\nChecking any/all fields with null bytes, to ensure they were cleaned up correctly.\nChecking one field after the null byte(s), to ensure they're correct.\nGetting rid of most other assertions.\n\nAs-is, it's a bit hard to figure out which field(s) were supposed to be corrected. Maybe also add a comment mentioning that?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525315454", "createdAt": "2020-11-17T16:46:29Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/src/test/java/gov/cms/bfd/pipeline/rif/extract/RifFilesProcessorTest.java", "diffHunk": "@@ -105,6 +105,70 @@ public void process1BeneRecord() {\n     Assert.assertEquals(new BigDecimal(\"1\"), beneRow.getBeneLinkKey().get());\n   }\n \n+  @Test\n+  public void process1BeneRecordWithTrailingNulls() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzODcwMw==", "bodyText": "Done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525338703", "createdAt": "2020-11-17T17:14:17Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/src/test/java/gov/cms/bfd/pipeline/rif/extract/RifFilesProcessorTest.java", "diffHunk": "@@ -105,6 +105,70 @@ public void process1BeneRecord() {\n     Assert.assertEquals(new BigDecimal(\"1\"), beneRow.getBeneLinkKey().get());\n   }\n \n+  @Test\n+  public void process1BeneRecordWithTrailingNulls() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNTQ1NA=="}, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzcyMjg1OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0NzoyNVrOH0-wTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0NzoyNVrOH0-wTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNjE3NA==", "bodyText": "Love this approach!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525316174", "createdAt": "2020-11-17T16:47:25Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -78,7 +79,7 @@ public static CSVParser createCsvParser(\n    *     consistency)\n    */\n   public static String parseString(String string) {\n-    return string;\n+    return removeInvalidCharacters(string);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzcyMzQyOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0NzozNFrOH0-wsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0NzozNFrOH0-wsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNjI3NQ==", "bodyText": "Love this approach!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525316275", "createdAt": "2020-11-17T16:47:34Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -88,7 +89,7 @@ public static String parseString(String string) {\n    *     value\n    */\n   public static Optional<String> parseOptionalString(String string) {\n-    return string.isEmpty() ? Optional.empty() : Optional.of(string);\n+    return string.isEmpty() ? Optional.empty() : Optional.of(removeInvalidCharacters(string));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTk0MDUzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoyNTo1MVrOH18P2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoyNTo1MVrOH18P2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMyMzY3Mw==", "bodyText": "I've been staring at this for a while now and I think it's incorrect? What you're searching for and replacing here is a two-char sequence: a '\\' followed by a '0'. Is that what is needed? Are we getting backslash-zero character sequences from the CCW that we need to strip out?\nOr are we really getting null bytes hiding in strings? If we are, then you'd want to change this to \"\\0\" or perhaps \"\\0x00\", instead. You'd also likely need to update the sample RIF. I'd guess that you'd need to use a hex editor to add the null bytes to the RIF, as I don't think most text editors would let you type them and I don't think CSV/Excel supports fancy escapes like that (though I could be wrong).", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r526323673", "createdAt": "2020-11-18T18:25:51Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -269,4 +270,22 @@ public static Character parseCharacter(String charText) {\n       return Optional.of(parseCharacter(charText));\n     }\n   }\n+\n+  /**\n+   * @param inputString {@link String} that possible contains invalid characters\n+   * @return an {@link String} with a null representation stripped from it if the input has a null\n+   *     field representation.\n+   */\n+  public static String removeInvalidCharacters(String inputString) {\n+    String verifiedInputString = inputString;\n+\n+    // Null Field\n+    String nullFields = \"\\\\0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9567d84a81fc938b4cdf886861453e0138c3eae7"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTAwMTU4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODozNjoyM1rOH2sWeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODozNjoyM1rOH2sWeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExMTgwMA==", "bodyText": "This really didn't look right to me, based on my reading of Pattern (the \"Backslashes, escapes, and quoting\" section, in particular). However, I was wrong!\nBased on some local testing, both of these code samples work (i.e. print out \"fixed\"):\nThis:\npublic static void main(String[] args) {\n  String valueToFix = \"Howdy!\\u0000\";\n  String valueFixed = valueToFix.replaceAll(\"\\u0000\", \"\");\n  if (valueToFix.contentEquals(valueFixed))\n    System.out.println(\"not fixed\");\n  else\n    System.out.println(\"fixed\");\n}\nAnd this:\npublic static void main(String[] args) {\n  String valueToFix = \"Howdy!\\u0000\";\n  String valueFixed = valueToFix.replaceAll(\"\\\\x00\", \"\");\n  if (valueToFix.contentEquals(valueFixed))\n    System.out.println(\"not fixed\");\n  else\n    System.out.println(\"fixed\");\n}\nI still don't understand why the second one works, but it does. So: neat!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r527111800", "createdAt": "2020-11-19T18:36:23Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -269,4 +270,20 @@ public static Character parseCharacter(String charText) {\n       return Optional.of(parseCharacter(charText));\n     }\n   }\n+\n+  /**\n+   * @param inputString {@link String} that possible contains invalid characters\n+   * @return an {@link String} with a null representation stripped from it if the input has a null\n+   *     field representation.\n+   */\n+  public static String removeInvalidCharacters(String inputString) {\n+    String verifiedInputString = inputString;\n+\n+    if (!Strings.isNullOrEmpty(verifiedInputString)) {\n+      // remove all NULLs\n+      verifiedInputString = verifiedInputString.replaceAll(\"\\\\x00\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d07dff273e149cbfecf8605ca761cb09d0a8aec"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 191, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}