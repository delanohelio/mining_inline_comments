{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5OTEzNzU3", "number": 421, "title": "BFD-351: EOB resource and PDE Profile for BFD V2", "bodyText": "Change Details\n\n\nAdds an FHIR R4 and CARIN 'mostly' compliant ExplainationOfBenefit resource.\n\n\nAdds the PDE claim type to ExplainationOfBenefit resource\n\n\nTODO: Add unit and integration tests. - BFD-533\n\n\nTODO: Resolve conformance issues - BFD-583\n\n\nAcceptance Validation\nNote: No UT or IT's were created for this code yet. We have this as a TODO (see above)\nNote: The FHIR conformance will need to be resolved.\nFeedback Requested\n\nFunctionality looks correct\nNaming is consistent with previous patterns and make sense.\nComments are where they need to be, informing reader of the 'what' and not the 'how.'\nArea for improving efficiency or reducing repeat code.\n\nExternal References\n\n\nBFD-351\n\nSecurity Implications\n\n\n[ x ] new software dependencies\n\n\n\n\nWe are making use of org.hl7.fhir.r4.model.ExplanationOfBenefit;\n\n\n altered security controls\n\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications", "createdAt": "2020-12-15T01:35:58Z", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421", "merged": true, "mergeCommit": {"oid": "b96834b872ecd03822a12da1d6c4baecb879e749"}, "closed": true, "closedAt": "2021-01-28T00:53:11Z", "author": {"login": "jzulim"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdapsG0gH2gAyNTM5OTEzNzU3OmNmOTI2NGMxNmM4YmI5YjliYmU3Y2U4MzQ5YzE4MDM1N2E1YmQ0MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd0ZkTzgFqTU3Nzg5MDkyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cf9264c16c8bb9b9bbe7ce8349c180357a5bd414", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cf9264c16c8bb9b9bbe7ce8349c180357a5bd414", "committedDate": "2020-11-09T00:33:33Z", "message": "PDE POC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ae4ff01375fb1843204c4b704f7512c09b31290", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/2ae4ff01375fb1843204c4b704f7512c09b31290", "committedDate": "2020-11-09T00:49:04Z", "message": "PDE POC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b6a5031598b7ea59732ef74acdcf3c42aa28b9b", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/6b6a5031598b7ea59732ef74acdcf3c42aa28b9b", "committedDate": "2020-11-09T01:43:23Z", "message": "V2 EOB POC Capabaility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dd9b0d578f503374c21609eea5114d0cf6316ba", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3dd9b0d578f503374c21609eea5114d0cf6316ba", "committedDate": "2020-11-13T01:46:55Z", "message": "CARIN-BB Code Systems and Value Sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2221a44406c097d4289d0af3c4906b0e456fe10c", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/2221a44406c097d4289d0af3c4906b0e456fe10c", "committedDate": "2020-11-13T01:47:47Z", "message": "CARIN-BB Code Systems and Value Sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7791923c44e8f726c840b1dba46c8eacb4351f2e", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7791923c44e8f726c840b1dba46c8eacb4351f2e", "committedDate": "2020-11-13T04:17:52Z", "message": "C4BB and FHIR Claims Values Sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3ae3eb6b1adfe3078f8dd1bd128efc9f1bde15d", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e3ae3eb6b1adfe3078f8dd1bd128efc9f1bde15d", "committedDate": "2020-11-13T04:19:41Z", "message": "C4BB and FHIR Claims Values Sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53536abb379fe43ee4ca0a7bce6997656919c917", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/53536abb379fe43ee4ca0a7bce6997656919c917", "committedDate": "2020-11-13T21:30:52Z", "message": "Bug fix for CARIN V2 EOB Indentifier UC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3e1241eec5d1acd6d199e94a578be8286aa598b", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e3e1241eec5d1acd6d199e94a578be8286aa598b", "committedDate": "2020-11-13T23:14:29Z", "message": "PDE POC Merge branch 'master' into dshekhar/BFD-351-v2_PDE_EOB_POC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014bb8a0b430ae8e91420bdbd77ee16b5de0548e", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/014bb8a0b430ae8e91420bdbd77ee16b5de0548e", "committedDate": "2020-11-18T18:15:59Z", "message": "CARIN BB Adjudication Value Sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bb6e0ad744e96c56472409c7e3462c53de4b629", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/8bb6e0ad744e96c56472409c7e3462c53de4b629", "committedDate": "2020-11-20T00:13:21Z", "message": "JEssentials refactoring Merge branch 'master' into dshekhar/BFD-351-v2_PDE_EOB_POC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6a3ba01178084149817019c42a697908506d931", "author": {"user": {"login": "dshekhar18", "name": "Dave Shekhar"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f6a3ba01178084149817019c42a697908506d931", "committedDate": "2020-11-20T03:08:06Z", "message": "integrated with BFD Shared Utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "076d3f04c846cc526d5467243ae208464395d41d", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/076d3f04c846cc526d5467243ae208464395d41d", "committedDate": "2020-12-09T20:17:34Z", "message": "Merge branch 'master' into dshekhar/BFD-351-v2_PDE_EOB_POC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a12099bebdc506ac90e0f912013e29579b1135a", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3a12099bebdc506ac90e0f912013e29579b1135a", "committedDate": "2020-12-31T01:19:45Z", "message": "updating transformer constants comments and vars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74beaab842329a56874f01af881cf1fbd4418258", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/74beaab842329a56874f01af881cf1fbd4418258", "committedDate": "2020-12-31T18:03:15Z", "message": "updating partd transformer identifier type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bac00c7edadfd2a8062e98ec0d1d1cfb318bebf", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0bac00c7edadfd2a8062e98ec0d1d1cfb318bebf", "committedDate": "2020-12-31T18:04:08Z", "message": "renaming CARIN vars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cba6e2989b8c2791a57571639215e93aca04a861", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cba6e2989b8c2791a57571639215e93aca04a861", "committedDate": "2020-12-31T18:06:36Z", "message": "adding serviceDate filter to V2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e40536e97f5f1dae1451a8add93a824d2ad3e9c1", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e40536e97f5f1dae1451a8add93a824d2ad3e9c1", "committedDate": "2020-12-31T18:37:41Z", "message": "adding claim type test for v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84397429ea23179b9c1005ef24232f0f9e345ac8", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/84397429ea23179b9c1005ef24232f0f9e345ac8", "committedDate": "2020-12-31T18:52:30Z", "message": "Merge branch 'master' into jzulim/BFD-351-v2-eob-pde"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "775964a7cb72c925f54fe2151d0c44f46aa00a3b", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/775964a7cb72c925f54fe2151d0c44f46aa00a3b", "committedDate": "2021-01-04T23:49:40Z", "message": "Merge branch 'master' into jzulim/BFD-351-v2-eob-pde"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb3a94a9ba188524acf895516e85be33307bde7a", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/eb3a94a9ba188524acf895516e85be33307bde7a", "committedDate": "2021-01-05T00:20:48Z", "message": "typo in javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f0cf33d8984f45b769dfd186f37e6e70947852ac", "committedDate": "2021-01-06T04:46:52Z", "message": "fix typos and deprecated options"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3MzUzODQz", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-567353843", "createdAt": "2021-01-13T15:43:49Z", "commit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4NjUzODI0", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-568653824", "createdAt": "2021-01-14T21:49:23Z", "commit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMTo0OToyNFrOIT4j-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMTo0OToyNFrOIT4j-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzcyMDU3MA==", "bodyText": "Arg constructor is deprecated. Use no args construct.\nref: https://hapifhir.io/hapi-fhir/apidocs/hapi-fhir-structures-r4/org/hl7/fhir/r4/hapi/rest/server/ServerCapabilityStatementProvider.html", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#discussion_r557720570", "createdAt": "2021-01-14T21:49:24Z", "author": {"login": "jzulim"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/V2Server.java", "diffHunk": "@@ -66,7 +66,7 @@ private void configureServerInfoMetadata() {\n \n     // Lightly customize the capability provider to set publisher name.\n     ServerCapabilityStatementProvider capabilityStatementProvider =\n-        new ServerCapabilityStatementProvider(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4NjU5NDI5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-568659429", "createdAt": "2021-01-14T21:57:53Z", "commit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMTo1Nzo1M1rOIT406A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMTo1Nzo1M1rOIT406A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzcyNDkwNA==", "bodyText": "Should be V2_EOB", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#discussion_r557724904", "createdAt": "2021-01-14T21:57:53Z", "author": {"login": "jzulim"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/r4/providers/R4ExplanationOfBenefitResourceProvider.java", "diffHunk": "@@ -0,0 +1,491 @@\n+package gov.cms.bfd.server.war.r4.providers;\n+\n+import ca.uhn.fhir.model.api.annotation.Description;\n+import ca.uhn.fhir.model.primitive.IdDt;\n+import ca.uhn.fhir.rest.annotation.IdParam;\n+import ca.uhn.fhir.rest.annotation.OptionalParam;\n+import ca.uhn.fhir.rest.annotation.Read;\n+import ca.uhn.fhir.rest.annotation.RequiredParam;\n+import ca.uhn.fhir.rest.annotation.Search;\n+import ca.uhn.fhir.rest.api.server.RequestDetails;\n+import ca.uhn.fhir.rest.param.DateRangeParam;\n+import ca.uhn.fhir.rest.param.ParamPrefixEnum;\n+import ca.uhn.fhir.rest.param.ReferenceParam;\n+import ca.uhn.fhir.rest.param.TokenAndListParam;\n+import ca.uhn.fhir.rest.param.TokenOrListParam;\n+import ca.uhn.fhir.rest.param.TokenParam;\n+import ca.uhn.fhir.rest.server.IResourceProvider;\n+import ca.uhn.fhir.rest.server.exceptions.ResourceNotFoundException;\n+import com.codahale.metrics.MetricRegistry;\n+import com.codahale.metrics.Timer;\n+import com.newrelic.api.agent.Trace;\n+import gov.cms.bfd.model.rif.Beneficiary;\n+import gov.cms.bfd.server.war.Operation;\n+import gov.cms.bfd.server.war.commons.LoadedFilterManager;\n+import gov.cms.bfd.server.war.commons.OffsetLinkBuilder;\n+import gov.cms.bfd.server.war.commons.QueryUtils;\n+import gov.cms.bfd.server.war.commons.TransformerConstants;\n+import java.time.LocalDate;\n+import java.time.ZoneId;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Comparator;\n+import java.util.Date;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.ListIterator;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import javax.persistence.EntityManager;\n+import javax.persistence.NoResultException;\n+import javax.persistence.PersistenceContext;\n+import javax.persistence.criteria.CriteriaBuilder;\n+import javax.persistence.criteria.CriteriaQuery;\n+import javax.persistence.criteria.Predicate;\n+import javax.persistence.criteria.Root;\n+import org.hl7.fhir.instance.model.api.IBaseResource;\n+import org.hl7.fhir.r4.model.Bundle;\n+import org.hl7.fhir.r4.model.ExplanationOfBenefit;\n+import org.hl7.fhir.r4.model.IdType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+/**\n+ * This FHIR {@link IResourceProvider} adds support for R4 {@link ExplanationOfBenefit} resources,\n+ * derived from the CCW claims.\n+ */\n+@Component\n+public final class R4ExplanationOfBenefitResourceProvider implements IResourceProvider {\n+  private static final Logger LOGGER =\n+      LoggerFactory.getLogger(R4ExplanationOfBenefitResourceProvider.class);\n+\n+  /**\n+   * A {@link Pattern} that will match the {@link ExplanationOfBenefit#getId()}s used in this\n+   * application, e.g. <code>pde-1234</code> or <code>pde--1234</code> (for negative IDs).\n+   */\n+  private static final Pattern EOB_ID_PATTERN = Pattern.compile(\"(\\\\p{Alpha}+)-(-?\\\\p{Alnum}+)\");\n+\n+  private EntityManager entityManager;\n+  private MetricRegistry metricRegistry;\n+  private R4SamhsaMatcher samhsaMatcher;\n+  private LoadedFilterManager loadedFilterManager;\n+\n+  /** @param entityManager a JPA {@link EntityManager} connected to the application's database */\n+  @PersistenceContext\n+  public void setEntityManager(EntityManager entityManager) {\n+    this.entityManager = entityManager;\n+  }\n+\n+  /** @param metricRegistry the {@link MetricRegistry} to use */\n+  @Inject\n+  public void setMetricRegistry(MetricRegistry metricRegistry) {\n+    this.metricRegistry = metricRegistry;\n+  }\n+\n+  /** @param samhsaMatcher the {@link R4SamhsaMatcher} to use */\n+  @Inject\n+  public void setSamhsaFilterer(R4SamhsaMatcher samhsaMatcher) {\n+    this.samhsaMatcher = samhsaMatcher;\n+  }\n+\n+  /** @param loadedFilterManager the {@link LoadedFilterManager} to use */\n+  @Inject\n+  public void setLoadedFilterManager(LoadedFilterManager loadedFilterManager) {\n+    this.loadedFilterManager = loadedFilterManager;\n+  }\n+\n+  /** @see ca.uhn.fhir.rest.server.IResourceProvider#getResourceType() */\n+  @Override\n+  public Class<? extends IBaseResource> getResourceType() {\n+    return ExplanationOfBenefit.class;\n+  }\n+\n+  /**\n+   * Adds support for the FHIR \"read\" operation, for {@link ExplanationOfBenefit}s. The {@link Read}\n+   * annotation indicates that this method supports the read operation.\n+   *\n+   * <p>Read operations take a single parameter annotated with {@link IdParam}, and should return a\n+   * single resource instance.\n+   *\n+   * @param eobId The read operation takes one parameter, which must be of type {@link IdType} and\n+   *     must be annotated with the {@link IdParam} annotation.\n+   * @return Returns a resource matching the specified {@link IdDt}, or <code>null</code> if none\n+   *     exists.\n+   */\n+  @SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+  @Read(version = false)\n+  @Trace\n+  public ExplanationOfBenefit read(@IdParam IdType eobId) {\n+    if (eobId == null) throw new IllegalArgumentException();\n+    if (eobId.getVersionIdPartAsLong() != null) throw new IllegalArgumentException();\n+\n+    String eobIdText = eobId.getIdPart();\n+    if (eobIdText == null || eobIdText.trim().isEmpty()) throw new IllegalArgumentException();\n+\n+    Matcher eobIdMatcher = EOB_ID_PATTERN.matcher(eobIdText);\n+    if (!eobIdMatcher.matches())\n+      throw new IllegalArgumentException(\"Unsupported ID pattern: \" + eobIdText);\n+\n+    String eobIdTypeText = eobIdMatcher.group(1);\n+    Optional<ClaimType> eobIdType = ClaimType.parse(eobIdTypeText);\n+    if (!eobIdType.isPresent()) throw new ResourceNotFoundException(eobId);\n+    String eobIdClaimIdText = eobIdMatcher.group(2);\n+\n+    Operation operation = new Operation(Operation.Endpoint.V1_EOB);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "originalPosition": 140}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4NjcwMjgz", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-568670283", "createdAt": "2021-01-14T22:15:27Z", "commit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMjoxNToyOFrOIT5V9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQyMjoxNToyOFrOIT5V9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzczMzM2NQ==", "bodyText": "BFD", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#discussion_r557733365", "createdAt": "2021-01-14T22:15:28Z", "author": {"login": "jzulim"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/r4/providers/ClaimType.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package gov.cms.bfd.server.war.r4.providers;\n+\n+import com.codahale.metrics.MetricRegistry;\n+import gov.cms.bfd.model.rif.Beneficiary;\n+import gov.cms.bfd.model.rif.PartDEvent;\n+import gov.cms.bfd.model.rif.PartDEvent_;\n+import java.time.LocalDate;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.Id;\n+import javax.persistence.metamodel.PluralAttribute;\n+import javax.persistence.metamodel.SingularAttribute;\n+import org.hl7.fhir.r4.model.ExplanationOfBenefit;\n+\n+/**\n+ * Enumerates the various Blue Button claim types that are supported by {@link", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwNzQ4NzAx", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-570748701", "createdAt": "2021-01-18T19:53:45Z", "commit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQxOTo1Mzo0NlrOIV1stQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQxOTo1Mzo0NlrOIV1stQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTc3MDgwNQ==", "bodyText": "@jarwilliams1971 Here's the PDE Mapping", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#discussion_r559770805", "createdAt": "2021-01-18T19:53:46Z", "author": {"login": "jzulim"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/r4/providers/PartDEventTransformerV2.java", "diffHunk": "@@ -0,0 +1,406 @@\n+package gov.cms.bfd.server.war.r4.providers;\n+\n+import com.codahale.metrics.MetricRegistry;\n+import com.codahale.metrics.Timer;\n+import com.newrelic.api.agent.Trace;\n+import gov.cms.bfd.model.codebook.data.CcwCodebookVariable;\n+import gov.cms.bfd.model.rif.PartDEvent;\n+import gov.cms.bfd.model.rif.parse.InvalidRifValueException;\n+import gov.cms.bfd.server.war.commons.IdentifierType;\n+import gov.cms.bfd.server.war.commons.MedicareSegment;\n+import gov.cms.bfd.server.war.commons.TransformerConstants;\n+import gov.cms.bfd.sharedutils.exceptions.BadCodeMonkeyException;\n+import java.math.BigDecimal;\n+import java.util.Optional;\n+import org.hl7.fhir.r4.model.CodeableConcept;\n+import org.hl7.fhir.r4.model.Coding;\n+import org.hl7.fhir.r4.model.DateType;\n+import org.hl7.fhir.r4.model.ExplanationOfBenefit;\n+import org.hl7.fhir.r4.model.ExplanationOfBenefit.ItemComponent;\n+import org.hl7.fhir.r4.model.SimpleQuantity;\n+import org.hl7.fhir.r4.model.codesystems.ClaimCareteamrole;\n+import org.hl7.fhir.r4.model.codesystems.V3ActCode;\n+\n+/** Transforms CCW {@link PartDEvent} instances into FHIR {@link ExplanationOfBenefit} resources. */\n+final class PartDEventTransformerV2 {\n+  /**\n+   * @param metricRegistry the {@link MetricRegistry} to use\n+   * @param claim the CCW {@link PartDEvent} to transform\n+   * @return a FHIR {@link ExplanationOfBenefit} resource that represents the specified {@link\n+   *     PartDEvent}\n+   */\n+  @Trace\n+  static ExplanationOfBenefit transform(MetricRegistry metricRegistry, Object claim) {\n+    Timer.Context timer =\n+        metricRegistry\n+            .timer(MetricRegistry.name(PartDEventTransformerV2.class.getSimpleName(), \"transform\"))\n+            .time();\n+\n+    if (!(claim instanceof PartDEvent)) throw new BadCodeMonkeyException();\n+    ExplanationOfBenefit eob = transformClaim((PartDEvent) claim);\n+\n+    timer.stop();\n+    return eob;\n+  }\n+\n+  /**\n+   * @param claimGroup the CCW {@link PartDEvent} to transform", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cf33d8984f45b769dfd186f37e6e70947852ac"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d53bd2ccc5fb9a8dced90896c901936105052fc8", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/d53bd2ccc5fb9a8dced90896c901936105052fc8", "committedDate": "2021-01-18T19:55:47Z", "message": "comment clarity and typo fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "779c3dbec3300afc337de520d93593e483c13a20", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/779c3dbec3300afc337de520d93593e483c13a20", "committedDate": "2021-01-18T23:06:13Z", "message": "Add missing bfd server war ops endpoint for EOB v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyNTU1MTk5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-572555199", "createdAt": "2021-01-20T19:24:22Z", "commit": {"oid": "779c3dbec3300afc337de520d93593e483c13a20"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e8f514435a69434719cb833afb08e70949c3636", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/9e8f514435a69434719cb833afb08e70949c3636", "committedDate": "2021-01-20T19:51:35Z", "message": "Merge branch 'master' into jzulim/BFD-351-v2-eob-pde"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a50a792ecf2ca0d503518dce12bf459be3c61225", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a50a792ecf2ca0d503518dce12bf459be3c61225", "committedDate": "2021-01-26T01:22:16Z", "message": "Merge branch 'master' into jzulim/BFD-351-v2-eob-pde"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13e5f9a0f654493dda72227dfbba1696d81fae7e", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/13e5f9a0f654493dda72227dfbba1696d81fae7e", "committedDate": "2021-01-26T01:27:56Z", "message": "use newly renamed TAX identifier constant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc3NjMyNzg3", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-577632787", "createdAt": "2021-01-27T18:23:12Z", "commit": {"oid": "13e5f9a0f654493dda72227dfbba1696d81fae7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6b04eacb253c3e83dcdc2ce3ad5e454d7f938aa", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a6b04eacb253c3e83dcdc2ce3ad5e454d7f938aa", "committedDate": "2021-01-27T23:27:48Z", "message": "Merge branch 'master' into jzulim/BFD-351-v2-eob-pde"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62fd484b6031fcd80fc7c9b390fbcfec775fc363", "author": {"user": {"login": "jzulim", "name": "John Zulim"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/62fd484b6031fcd80fc7c9b390fbcfec775fc363", "committedDate": "2021-01-28T00:12:57Z", "message": "Merge branch 'master' into jzulim/BFD-351-v2-eob-pde"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc3ODkwOTI4", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/421#pullrequestreview-577890928", "createdAt": "2021-01-28T00:28:35Z", "commit": {"oid": "62fd484b6031fcd80fc7c9b390fbcfec775fc363"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 540, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}