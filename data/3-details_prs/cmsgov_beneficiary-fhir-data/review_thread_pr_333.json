{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NzIxNTc4", "number": 333, "reviewThreads": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowMTo0MVrOEUHDWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyODowOVrOEZEdew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTIyNTIwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowMTo0MVrOG6Ny9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyODo0MFrOG6Omuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjYzMQ==", "bodyText": "I think you can lose this? Why not just load the normal SAMPLE_A data in your test and then modify the field to have the value you want to test? (I think those record classes are all mutable, right?)", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463696631", "createdAt": "2020-07-31T16:01:41Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResource.java", "diffHunk": "@@ -56,6 +56,8 @@\n \n   SAMPLE_A_PDE(resourceUrl(\"rif-static-samples/sample-a-pde.txt\"), RifFileType.PDE, 1),\n \n+  SAMPLE_A_PDE_UPIN(resourceUrl(\"rif-static-samples/sample-a-pde-upin.txt\"), RifFileType.PDE, 1),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwOTg4Mw==", "bodyText": "your right :(", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463709883", "createdAt": "2020-07-31T16:28:40Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResource.java", "diffHunk": "@@ -56,6 +56,8 @@\n \n   SAMPLE_A_PDE(resourceUrl(\"rif-static-samples/sample-a-pde.txt\"), RifFileType.PDE, 1),\n \n+  SAMPLE_A_PDE_UPIN(resourceUrl(\"rif-static-samples/sample-a-pde-upin.txt\"), RifFileType.PDE, 1),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjYzMQ=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTIyNzAwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResourceGroup.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowMjoxNlrOG6N0Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxODoyNzo1NVrOG6SAFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjkwMw==", "bodyText": "See other comment on test data: I think this can be removed.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463696903", "createdAt": "2020-07-31T16:02:16Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResourceGroup.java", "diffHunk": "@@ -20,6 +20,19 @@\n       StaticRifResource.SAMPLE_A_SNF,\n       StaticRifResource.SAMPLE_A_DME),\n \n+  SAMPLE_A_UPIN(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTUyNg==", "bodyText": "Yea removed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765526", "createdAt": "2020-07-31T18:27:55Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/java/gov/cms/bfd/model/rif/samples/StaticRifResourceGroup.java", "diffHunk": "@@ -20,6 +20,19 @@\n       StaticRifResource.SAMPLE_A_SNF,\n       StaticRifResource.SAMPLE_A_DME),\n \n+  SAMPLE_A_UPIN(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NjkwMw=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTIyODU3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif-samples/src/main/resources/rif-static-samples/sample-a-pde-upin.txt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowMjo0NVrOG6N07w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxODoyODowNVrOG6SAWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NzEzNQ==", "bodyText": "See other comment on test data: I think this can be removed.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463697135", "createdAt": "2020-07-31T16:02:45Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/resources/rif-static-samples/sample-a-pde-upin.txt", "diffHunk": "@@ -0,0 +1,2 @@\n+DML_IND|PDE_ID|CLM_GRP_ID|FINAL_ACTION|BENE_ID|SRVC_DT|PD_DT|SRVC_PRVDR_ID_QLFYR_CD|SRVC_PRVDR_ID|PRSCRBR_ID_QLFYR_CD|PRSCRBR_ID|RX_SRVC_RFRNC_NUM|PROD_SRVC_ID|PLAN_CNTRCT_REC_ID|PLAN_PBP_REC_NUM|CMPND_CD|DAW_PROD_SLCTN_CD|QTY_DSPNSD_NUM|DAYS_SUPLY_NUM|FILL_NUM|DSPNSNG_STUS_CD|DRUG_CVRG_STUS_CD|ADJSTMT_DLTN_CD|NSTD_FRMT_CD|PRCNG_EXCPTN_CD|CTSTRPHC_CVRG_CD|GDC_BLW_OOPT_AMT|GDC_ABV_OOPT_AMT|PTNT_PAY_AMT|OTHR_TROOP_AMT|LICS_AMT|PLRO_AMT|CVRD_D_PLAN_PD_AMT|NCVRD_PLAN_PD_AMT|TOT_RX_CST_AMT|RX_ORGN_CD|RPTD_GAP_DSCNT_NUM|BRND_GNRC_CD|PHRMCY_SRVC_TYPE_CD|PTNT_RSDNC_CD|SUBMSN_CLR_CD", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTU5Mg==", "bodyText": "Removed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765592", "createdAt": "2020-07-31T18:28:05Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-rif-samples/src/main/resources/rif-static-samples/sample-a-pde-upin.txt", "diffHunk": "@@ -0,0 +1,2 @@\n+DML_IND|PDE_ID|CLM_GRP_ID|FINAL_ACTION|BENE_ID|SRVC_DT|PD_DT|SRVC_PRVDR_ID_QLFYR_CD|SRVC_PRVDR_ID|PRSCRBR_ID_QLFYR_CD|PRSCRBR_ID|RX_SRVC_RFRNC_NUM|PROD_SRVC_ID|PLAN_CNTRCT_REC_ID|PLAN_PBP_REC_NUM|CMPND_CD|DAW_PROD_SLCTN_CD|QTY_DSPNSD_NUM|DAYS_SUPLY_NUM|FILL_NUM|DSPNSNG_STUS_CD|DRUG_CVRG_STUS_CD|ADJSTMT_DLTN_CD|NSTD_FRMT_CD|PRCNG_EXCPTN_CD|CTSTRPHC_CVRG_CD|GDC_BLW_OOPT_AMT|GDC_ABV_OOPT_AMT|PTNT_PAY_AMT|OTHR_TROOP_AMT|LICS_AMT|PLRO_AMT|CVRD_D_PLAN_PD_AMT|NCVRD_PLAN_PD_AMT|TOT_RX_CST_AMT|RX_ORGN_CD|RPTD_GAP_DSCNT_NUM|BRND_GNRC_CD|PHRMCY_SRVC_TYPE_CD|PTNT_RSDNC_CD|SUBMSN_CLR_CD", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NzEzNQ=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTIzMzI3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowNDoyMVrOG6N30Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxODoyODozOVrOG6SBfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5Nzg3Mw==", "bodyText": "Can you explain this specific change? I don't understand how it relates to the rest of the PR or what you're trying to accomplish with it.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463697873", "createdAt": "2020-07-31T16:04:21Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -209,7 +210,7 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n         .setAmount(TransformerUtils.createMoney(claimGroup.getGapDiscountAmount()));\n \n     if (claimGroup.getPrescriberIdQualifierCode() == null\n-        || !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))\n+        && !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTg4NA==", "bodyText": "yea your right, i was testing with a different dataset and forgot to place it back", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765884", "createdAt": "2020-07-31T18:28:39Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -209,7 +210,7 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n         .setAmount(TransformerUtils.createMoney(claimGroup.getGapDiscountAmount()));\n \n     if (claimGroup.getPrescriberIdQualifierCode() == null\n-        || !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))\n+        && !claimGroup.getPrescriberIdQualifierCode().equalsIgnoreCase(\"01\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5Nzg3Mw=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTIzOTA5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowNjowNlrOG6N7Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjowNjowNlrOG6N7Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5ODczNQ==", "bodyText": "This comment could use a header sentence introducing/explaining it, e.g. saying what CCW field the values you're listing are for.\nI'd also remove the commented-out code above it, since I think you're trying to replace/resolve that?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463698735", "createdAt": "2020-07-31T16:06:06Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI1MTM2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoxMDoxNlrOG6OC9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjozNDo0N1rOG6Ox5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMDcyNg==", "bodyText": "From reading the JavaDoc on these methods, I'm pretty sure the isNotEmpty(...) is redundant.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (StringUtils.isNotBlank(identiferSystem) && StringUtils.isNotEmpty(identiferSystem)) {\n          \n          \n            \n                  if (StringUtils.isNotBlank(identiferSystem)) {", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463700726", "createdAt": "2020-07-31T16:10:16Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;\n+      }\n+\n+      if (StringUtils.isNotBlank(identiferSystem) && StringUtils.isNotEmpty(identiferSystem)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMjc0Mg==", "bodyText": "changed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463712742", "createdAt": "2020-07-31T16:34:47Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;\n+      }\n+\n+      if (StringUtils.isNotBlank(identiferSystem) && StringUtils.isNotEmpty(identiferSystem)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMDcyNg=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI2MTAxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoxMzoxOFrOG6OI1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODoxNTozNlrOHB0qwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMjIzMA==", "bodyText": "I don't think \"Other\" is actually a system, so I'd lose this constant and just use null here. I'd also make this the default case.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    case \"99\":\n          \n          \n            \n                      identiferSystem = TransformerConstants.CODING_OTHER;\n          \n          \n            \n                      break;\n          \n          \n            \n                    default:\n          \n          \n            \n                      identiferSystem = null;\n          \n          \n            \n                      break;", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463702230", "createdAt": "2020-07-31T16:13:18Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMTcwOA==", "bodyText": "Made it the default case", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463711708", "createdAt": "2020-07-31T16:32:26Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMjIzMA=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3MzUzOA==", "bodyText": "@dshekhar18 Thinking about it for a second more, what does FHIR suggest using for \"unknown\" identifier systems? Is it just null or is there some other canonical indicator for that?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471673538", "createdAt": "2020-08-17T18:15:36Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE_NUMBER;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUMBER;\n+          break;\n+        case \"99\":\n+          identiferSystem = TransformerConstants.CODING_OTHER;\n+          break;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMjIzMA=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI2ODA2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoxNToyOFrOG6ONQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjozMjo1N1rOG6OuxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMzM2MA==", "bodyText": "If you write it like this, the compiler will be able to check for you that your code below actually initializes the value. (For example, temporarily comment out the default case in my suggestion below and the compiler will yell at you. That's nice of it to watch your back like that!)\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String identiferSystem = null;\n          \n          \n            \n                String identiferSystem;", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463703360", "createdAt": "2020-07-31T16:15:28Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMTk0MQ==", "bodyText": "changed it to not intialize the vairable, it will be null by default bc of the default case", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463711941", "createdAt": "2020-07-31T16:32:57Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -257,15 +258,48 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n      * throw new InvalidRifValueException(\n      * \"Service Provider ID Qualifier Code is invalid: \" +\n      * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMzM2MA=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI3MjM4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoxNjo1NVrOG6OP5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODoxODo1M1rOHB0xUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNDAzNg==", "bodyText": "As mentioned above, I would remove this constant.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463704036", "createdAt": "2020-07-31T16:16:55Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";\n+\n+  /** The Other as available at <a */\n+  static final String CODING_OTHER = \"https://bluebutton.cms.gov/resources/variables/other\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMjk1MA==", "bodyText": "removed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463712950", "createdAt": "2020-07-31T16:35:08Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";\n+\n+  /** The Other as available at <a */\n+  static final String CODING_OTHER = \"https://bluebutton.cms.gov/resources/variables/other\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNDAzNg=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2ODc5NQ==", "bodyText": "https://bluebutton.cms.gov/resources/variables/other is giving HTTP 404. So pls don't use if not needed.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470268795", "createdAt": "2020-08-13T21:50:11Z", "author": {"login": "dshekhar18"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";\n+\n+  /** The Other as available at <a */\n+  static final String CODING_OTHER = \"https://bluebutton.cms.gov/resources/variables/other\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNDAzNg=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3NTIxNw==", "bodyText": "Lots of our URIs do. That's a separate issue, which we should backlog a tech debt ticket for. (Followed up on this in Slack.)", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471675217", "createdAt": "2020-08-17T18:18:53Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";\n+\n+  /** The Other as available at <a */\n+  static final String CODING_OTHER = \"https://bluebutton.cms.gov/resources/variables/other\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNDAzNg=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI3OTQ0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoxOToyMVrOG6OUgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoxOToyMVrOG6OUgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNTIxOA==", "bodyText": "Have we asked the FHIR community if they want to define standard identifier systems for any of these? If we haven't, we should before we proceed, and we should note the FHIR tracker links to the requests/tickets.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463705218", "createdAt": "2020-07-31T16:19:21Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,26 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Unique Physician Identification Number (UPIN), as available at <a */\n+  static final String CODING_UPIN = \"https://bluebutton.cms.gov/resources/variables/upin\";\n+\n+  /**\n+   * The National Council for Prescription Drug Programs (NCPDP) provider identifier, as available\n+   * at <a\n+   */\n+  static final String CODING_NCPDP = \"https://bluebutton.cms.gov/resources/variables/ncpdp\";\n+\n+  /** The State License Number as available at <a */\n+  static final String CODING_STATE_LICENSE_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/state_license_number\";\n+\n+  /** The Federal Tax Number as available at <a */\n+  static final String CODING_FEDERAL_TAX_NUMBER =\n+      \"https://bluebutton.cms.gov/resources/variables/federal_tax_number\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI4NDMxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyMDo0NlrOG6OXcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxODoyNzoyMFrOG6R_Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNTk3MA==", "bodyText": "After extracting this object, I think you can modify it's values to be whatever you want, which would allow you to remove all of the extra sample data you've had to add here. (See other comments related to this.)", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463705970", "createdAt": "2020-07-31T16:20:46Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -40,7 +40,23 @@ public void transformSampleARecord() throws FHIRException {\n             .get();\n \n     ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n-    assertMatches(claim, eob);\n+    assertPartDMatches(claim, eob, \"01\", \"01\", TransformerConstants.CODING_NPI_US);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    List<Object> parsedRecords =\n+        ServerTestUtils.parseData(\n+            Arrays.asList(StaticRifResourceGroup.SAMPLE_A_UPIN.getResources()));\n+    PartDEvent claim =\n+        parsedRecords.stream()\n+            .filter(r -> r instanceof PartDEvent)\n+            .map(r -> (PartDEvent) r)\n+            .findFirst()\n+            .get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2NTI5MQ==", "bodyText": "yep refactored the tests", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463765291", "createdAt": "2020-07-31T18:27:20Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -40,7 +40,23 @@ public void transformSampleARecord() throws FHIRException {\n             .get();\n \n     ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n-    assertMatches(claim, eob);\n+    assertPartDMatches(claim, eob, \"01\", \"01\", TransformerConstants.CODING_NPI_US);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    List<Object> parsedRecords =\n+        ServerTestUtils.parseData(\n+            Arrays.asList(StaticRifResourceGroup.SAMPLE_A_UPIN.getResources()));\n+    PartDEvent claim =\n+        parsedRecords.stream()\n+            .filter(r -> r instanceof PartDEvent)\n+            .map(r -> (PartDEvent) r)\n+            .findFirst()\n+            .get();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNTk3MA=="}, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTI4OTU3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyMjoyN1rOG6OauA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyMjoyN1rOG6OauA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwNjgwOA==", "bodyText": "How does this method compare/contrast to the other assertMatches(...) method in this class?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r463706808", "createdAt": "2020-07-31T16:22:27Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -235,4 +251,202 @@ static void assertMatches(PartDEvent claim, ExplanationOfBenefit eob) throws FHI\n       throw new UncheckedIOException(e);\n     }\n   }\n+  /**\n+   * Verifies that the {@link ExplanationOfBenefit} \"looks like\" it should, if it were produced from\n+   * the specified {@link PartDEvent}.\n+   *\n+   * @param claim the {@link PartDEvent} that the {@link ExplanationOfBenefit} was generated from\n+   * @param eob the {@link ExplanationOfBenefit} that was generated from the specified {@link\n+   *     PartDEvent}\n+   * @throws FHIRException (indicates test failure)\n+   */\n+  static void assertPartDMatches(\n+      PartDEvent claim,\n+      ExplanationOfBenefit eob,\n+      String ServiceProviderIdQualiferCode,\n+      String PrescriberIdQualifierCode,\n+      String Coding)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1c2128048189472bc7b4ea4e6bf9ec839f33df"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODcwMDc0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo0NjoxNFrOG9nWNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMTozODo0NlrOG9o7Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MDk4MQ==", "bodyText": "This comment could use a header sentence introducing/explaining it, e.g. saying what CCW field the values you're listing are for.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467260981", "createdAt": "2020-08-07T20:46:14Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,43 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI4Njg1MA==", "bodyText": "done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467286850", "createdAt": "2020-08-07T21:38:46Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,43 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MDk4MQ=="}, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODcwNTkyOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo0ODozMFrOG9nZZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo0ODozMFrOG9nZZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MTc5OA==", "bodyText": "Could you please rename this to something less generic, e.g. FHIR_IDENTIFIER_TYPE_CODESYSTEM?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467261798", "createdAt": "2020-08-07T20:48:30Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,9 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String CODING_CODESYSTEM = \"http://terminology.hl7.org/CodeSystem/v2-0203\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODcyMDg0OnYy", "diffSide": "LEFT", "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdPaged.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NDoxNVrOG9nibw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NDoxNVrOG9nibw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NDExMQ==", "bodyText": "I think the changes to this file aren't material to your PR here, right? If so, I'd remove them from the PR.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467264111", "createdAt": "2020-08-07T20:54:15Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdPaged.json", "diffHunk": "@@ -2065,14 +2065,14 @@\n         \"type\" : [ {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"external-first\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODcyMjY4OnYy", "diffSide": "LEFT", "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobReadInpatient.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NDo0OVrOG9njgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NDo0OVrOG9njgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NDM4Nw==", "bodyText": "I think the changes to this file aren't material to your PR here, right? If so, I'd remove them from the PR.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467264387", "createdAt": "2020-08-07T20:54:49Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobReadInpatient.json", "diffHunk": "@@ -531,14 +531,14 @@\n     \"type\" : [ {\n       \"coding\" : [ {\n         \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-        \"code\" : \"external-first\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODcyNDc2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NToyOVrOG9nkoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo1NToyOVrOG9nkoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NDY3Mw==", "bodyText": "This won't quite work for our users. If you're going to use the https://terminology.hl7.org/1.0.0/CodeSystem-v2-0203.html codeset, then you have to use the codes from that codeset, too.\nI'm having trouble figuring out how to type out a complete explanation, so perhaps we should chat about it on the phone next week? Dave may be able to help you with this, as well, if I get too tied up.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r467264673", "createdAt": "2020-08-07T20:55:29Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,43 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          break;\n+        case \"06\":\n+        case \"07\":\n+        case \"08\":\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_CODESYSTEM;\n+          break;\n+        default:\n+          identiferSystem = null;\n+          break;\n+      }\n+\n+      if (StringUtils.isNotBlank(identiferSystem)) {\n+        eob.setOrganization(\n+            TransformerUtils.createIdentifierReference(\n+                identiferSystem, claimGroup.getServiceProviderId()));\n+        eob.setFacility(\n+            TransformerUtils.createIdentifierReference(\n+                identiferSystem, claimGroup.getServiceProviderId()));\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd22e92cd813de6cffc3f7c8c127182a005d209f"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTM0MDg4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNToxMjoxMFrOHA4YQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTo1MzozN1rOHBBl8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4NTc2Mw==", "bodyText": "I'm not \ud83d\udcaf  on this, but... couldn't identifierSystem come from ServiceProviderIdentifiers, too?\nI guess it depends on how well/poorly that ends up impacting other uses of TransformerUtils.createIdentifierReference(...)...", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470685763", "createdAt": "2020-08-14T15:12:10Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,58 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     * This chart is to dosplay the different code values for the different service provider id qualifer\n+     * codes below\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem;\n+    ServiceProviderIdentifiers providerIdentifier;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          providerIdentifier = ServiceProviderIdentifiers.NPI;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          providerIdentifier = ServiceProviderIdentifiers.UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          providerIdentifier = ServiceProviderIdentifiers.NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE;\n+          providerIdentifier = ServiceProviderIdentifiers.SL;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+          providerIdentifier = ServiceProviderIdentifiers.FTN;\n+          break;\n+        default:\n+          identiferSystem = null;\n+          providerIdentifier = null;\n+          break;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjcyMw==", "bodyText": "Changed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836723", "createdAt": "2020-08-14T19:53:37Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformer.java", "diffHunk": "@@ -245,27 +246,58 @@ private static ExplanationOfBenefit transformClaim(PartDEvent claimGroup) {\n             TransformerUtils.createExtensionQuantity(\n                 CcwCodebookVariable.DAYS_SUPLY_NUM, claimGroup.getDaysSupply()));\n \n-    // TODO CBBD-241 - This code was commented out because values other than\n-    // \"01\"\n-    // were coming thru\n-    // such as \"07\". Need to discuss with Karl if this check needs to be\n-    // here -\n-\n     /*\n-     * if (claimGroup.serviceProviderIdQualiferCode == null ||\n-     * !claimGroup.serviceProviderIdQualiferCode.equalsIgnoreCase(\"01\"))\n-     * throw new InvalidRifValueException(\n-     * \"Service Provider ID Qualifier Code is invalid: \" +\n-     * claimGroup.serviceProviderIdQualiferCode);\n+     * This chart is to dosplay the different code values for the different service provider id qualifer\n+     * codes below\n+     *   Code\t    Code value\n+     *   01        National Provider Identifier (NPI)\n+     *   06        Unique Physician Identification Number (UPIN)\n+     *   07        National Council for Prescription Drug Programs (NCPDP) provider identifier\n+     *   08        State license number\n+     *   11        Federal tax number\n+     *   99        Other\n      */\n \n+    String identiferSystem;\n+    ServiceProviderIdentifiers providerIdentifier;\n+\n     if (!claimGroup.getServiceProviderId().isEmpty()) {\n-      eob.setOrganization(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n-      eob.setFacility(\n-          TransformerUtils.createIdentifierReference(\n-              TransformerConstants.CODING_NPI_US, claimGroup.getServiceProviderId()));\n+      switch (claimGroup.getServiceProviderIdQualiferCode()) {\n+        case \"01\":\n+          identiferSystem = TransformerConstants.CODING_NPI_US;\n+          providerIdentifier = ServiceProviderIdentifiers.NPI;\n+          break;\n+        case \"06\":\n+          identiferSystem = TransformerConstants.CODING_UPIN;\n+          providerIdentifier = ServiceProviderIdentifiers.UPIN;\n+          break;\n+        case \"07\":\n+          identiferSystem = TransformerConstants.CODING_NCPDP;\n+          providerIdentifier = ServiceProviderIdentifiers.NCPDP;\n+          break;\n+        case \"08\":\n+          identiferSystem = TransformerConstants.CODING_STATE_LICENSE;\n+          providerIdentifier = ServiceProviderIdentifiers.SL;\n+          break;\n+        case \"11\":\n+          identiferSystem = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+          providerIdentifier = ServiceProviderIdentifiers.FTN;\n+          break;\n+        default:\n+          identiferSystem = null;\n+          providerIdentifier = null;\n+          break;\n+      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4NTc2Mw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTM1OTUzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNToxNzozNFrOHA4kAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTo1MjozNVrOHBBkMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4ODc3MQ==", "bodyText": "Following the naming scheme used in TransformerConstants, this should be named CODING_SYSTEM_HL7_IDENTIFIER_TYPE.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470688771", "createdAt": "2020-08-14T15:17:34Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjI3Mw==", "bodyText": "Renamed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836273", "createdAt": "2020-08-14T19:52:35Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4ODc3MQ=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTM2NTI5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNToxOToxNFrOHA4nrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTo1Mjo0NFrOHBBkaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTcxMA==", "bodyText": "There should really just be one CODING_SYSTEM_... constant per codesystem (not per code), so I'd remove this constant and refer to the other one, instead.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470689710", "createdAt": "2020-08-14T15:19:14Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjMzMQ==", "bodyText": "Deleted", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836331", "createdAt": "2020-08-14T19:52:44Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTcxMA=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTM2NTcyOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNToxOToyMlrOHA4n8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTo1Mjo1NlrOHBBkwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTc3Ng==", "bodyText": "There should really just be one CODING_SYSTEM_... constant per codesystem (not per code), so I'd remove this constant and refer to the other one, instead.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470689776", "createdAt": "2020-08-14T15:19:22Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjQxOA==", "bodyText": "Deleted", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836418", "createdAt": "2020-08-14T19:52:56Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTc3Ng=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTM2NjE2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNToxOTozM1rOHA4oQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTo1MzowMlrOHBBk8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTg1Nw==", "bodyText": "There should really just be one CODING_SYSTEM_... constant per codesystem (not per code), so I'd remove this constant and refer to the other one, instead.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470689857", "createdAt": "2020-08-14T15:19:33Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for Federal Tax Number */\n+  static final String CODING_FEDERAL_TAX_NUM = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNjQ2NQ==", "bodyText": "Deleted", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470836465", "createdAt": "2020-08-14T19:53:02Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+\n+  /** The Code System, as available for State License Number */\n+  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for Federal Tax Number */\n+  static final String CODING_FEDERAL_TAX_NUM = FHIR_IDENTIFIER_TYPE_CODESYSTEM;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4OTg1Nw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTQyODE0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNTozMDoyOVrOHA5JnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODoyOTo1OVrOHB1biw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5ODM5Nw==", "bodyText": "This doesn't appear to be an actual FHIR code system... is it? If it's not a standard HL7 one (or from some other IG), and we can't find a reasonable code for PDP ID types, then we should define a custom-to-us code system and code for it.\nIf that's the right direction, it'd be something more like this:\n  /**\n   * Used as the {@link Coding#getSystem()} for custom-to-BFD {@link Identifier#getType()} codes.\n   */\n  static final String CODING_SYSTEM_IDENTIFIER_TYPE =\n      BASE_URL_BBAPI_RESOURCES + \"/codesystem/identifier-type\";\n\n  /**\n   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the identifier is a PDP.\n   */\n  static final String CODED_IDENTIFIER_TYPE_PDP = \"NCPDP\";\n\n  /**\n   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the identifier is a PDP.\n   */\n  static final String CODED_IDENTIFIER_TYPE_PDP_DISPLAY = \"National Council for Prescription Drug Programs\";", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470698397", "createdAt": "2020-08-14T15:30:29Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg0MjgyMQ==", "bodyText": "Added it and place all the other strings in the transfomer constants", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470842821", "createdAt": "2020-08-14T20:08:45Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5ODM5Nw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxNzU5Nw==", "bodyText": "See the below link for more details. This is a licensed and standard identifier system maintained by NCPDP. CARIN refers to it too.\nhttp://hl7.org/fhir/us/carin-rtpbc/2020Feb/NamingSystem-carin-rtpbc-NamingSystem-ncpdp-provider-id.html", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470917597", "createdAt": "2020-08-15T00:55:58Z", "author": {"login": "dshekhar18"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5ODM5Nw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY4NjAyNw==", "bodyText": "Then, @cthayes, the link that @dshekhar18 provided should \ud83d\udcaf  be in the comment on this constant.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471686027", "createdAt": "2020-08-17T18:29:59Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,6 +163,22 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /** The Code System, as available at <a */\n+  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+      \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n+\n+  /** The Code System, as available for UPIN */\n+  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+\n+  /** The Code System, as available for NCPDP */\n+  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5ODM5Nw=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTQzODQwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNTozMzo1NVrOHA5QAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDo1OTo0N1rOHBDKrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMDAzNQ==", "bodyText": "Not a big deal, but I don't think that {@link Identifier#getServiceProviderIdentifiers()} is legit, is it?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470700035", "createdAt": "2020-08-14T15:33:55Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg2MjUwOQ==", "bodyText": "fixed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470862509", "createdAt": "2020-08-14T20:59:47Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMDAzNQ=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc5MDYyOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoyMjoxMlrOHA8oHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDoyNzo1NlrOHBCbfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1NTM1Ng==", "bodyText": "Why is providerIdentifiers a vararg (why does it allow for zero to many entries)?\nIf you're just trying to avoid the need to refactor other uses of it, please don't -- this just adds to tech debt, overall, as your code below only supports zero-or-one providerIdentifiers, which puts the lie to the method signature. Instead, bite the bullet and make it an Optional<...>. If you really want to avoid the extra refactoring, you can always add an overloaded version of this method without the new parameter.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470755356", "createdAt": "2020-08-14T17:22:12Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDQyOQ==", "bodyText": "Yea i just made an overloaded function with IdentifierType and IdentifierValue as params", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470850429", "createdAt": "2020-08-14T20:27:56Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1NTM1Ng=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTgwOTAwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoyNzo0NVrOHA8zMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDoyODoxMVrOHBCb_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODE5Mg==", "bodyText": "Also: this variable should be named identifierType.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470758192", "createdAt": "2020-08-14T17:27:45Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDU1OQ==", "bodyText": "done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470850559", "createdAt": "2020-08-14T20:28:11Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,12 +701,40 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n+   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n+   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n-    return new Reference()\n-        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n-        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  static Reference createIdentifierReference(\n+      String identifierSystem,\n+      String identifierValue,\n+      ServiceProviderIdentifiers... providerIdentifiers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODE5Mg=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTgxMDYwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoyODoyMFrOHA80PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTo0OToyMVrOHBBevA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODQ2MA==", "bodyText": "I would suggest renaming this enum to IdentifierType.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470758460", "createdAt": "2020-08-14T17:28:20Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+public enum ServiceProviderIdentifiers {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzNDg3Ng==", "bodyText": "renamed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470834876", "createdAt": "2020-08-14T19:49:21Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+public enum ServiceProviderIdentifiers {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1ODQ2MA=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTgyNDgwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzozMjo0M1rOHA89FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMTo0MjoyMFrOHBEFtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2MDcyNA==", "bodyText": "I'd suggest adding JavaDoc for this method to make it clearer what it does. Also: you should probably fix the case on its params, so that they don't look like types.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470760724", "createdAt": "2020-08-14T17:32:43Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -30,6 +30,58 @@\n    */\n   @Test\n   public void transformSampleARecord() throws FHIRException {\n+    PartDEvent claim = getPartDEventClaim();\n+    ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n+    assertMatches(claim, eob);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNPI() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"01\";\n+    String serviceProviderCode = TransformerConstants.CODING_NPI_US;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"06\";\n+    String serviceProviderCode = TransformerConstants.CODING_UPIN;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNCPDP() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"07\";\n+    String serviceProviderCode = TransformerConstants.CODING_NCPDP;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithStateLicenseNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"08\";\n+    String serviceProviderCode = TransformerConstants.CODING_STATE_LICENSE;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithFederalTaxNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"11\";\n+    String serviceProviderCode = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  private void checkOrgAndFacility(\n+      String ServiceProviderIdQualiferCode, String ServiceProviderCode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg3NzYyMw==", "bodyText": "done", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470877623", "createdAt": "2020-08-14T21:42:20Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/test/java/gov/cms/bfd/server/war/stu3/providers/PartDEventTransformerTest.java", "diffHunk": "@@ -30,6 +30,58 @@\n    */\n   @Test\n   public void transformSampleARecord() throws FHIRException {\n+    PartDEvent claim = getPartDEventClaim();\n+    ExplanationOfBenefit eob = PartDEventTransformer.transform(new MetricRegistry(), claim);\n+    assertMatches(claim, eob);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNPI() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"01\";\n+    String serviceProviderCode = TransformerConstants.CODING_NPI_US;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithUPIN() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"06\";\n+    String serviceProviderCode = TransformerConstants.CODING_UPIN;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithNCPDP() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"07\";\n+    String serviceProviderCode = TransformerConstants.CODING_NCPDP;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithStateLicenseNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"08\";\n+    String serviceProviderCode = TransformerConstants.CODING_STATE_LICENSE;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  @Test\n+  public void transformSampleARecordWithFederalTaxNumber() throws FHIRException {\n+    String serviceProviderIdQualiferCode = \"11\";\n+    String serviceProviderCode = TransformerConstants.CODING_FEDERAL_TAX_NUM;\n+    checkOrgAndFacility(serviceProviderIdQualiferCode, serviceProviderCode);\n+  }\n+\n+  private void checkOrgAndFacility(\n+      String ServiceProviderIdQualiferCode, String ServiceProviderCode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2MDcyNA=="}, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTg1MDY0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdAll.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0MToyNVrOHA9M0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0MToyNVrOHA9M0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NDc1NA==", "bodyText": "I don't think these changes in the output are related to your coding changes and I suspect that the tests will still pass if you revert them. Please try really hard to only change as little as you have to in these files.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470764754", "createdAt": "2020-08-14T17:41:25Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdAll.json", "diffHunk": "@@ -2059,14 +2059,14 @@\n         \"type\" : [ {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"external-first\",\n-            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"\n+            \"code\" : \"principal\",\n+            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n           } ]\n         }, {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"principal\",\n-            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n+            \"code\" : \"external-first\",\n+            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTg1MTQyOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdPaged.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0MTo0MlrOHA9NSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0MTo0MlrOHA9NSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NDg3NQ==", "bodyText": "I don't think these changes in the output are related to your coding changes and I suspect that the tests will still pass if you revert them. Please try really hard to only change as little as you have to in these files.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470764875", "createdAt": "2020-08-14T17:41:42Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/test/resources/endpoint-responses/eobByPatientIdPaged.json", "diffHunk": "@@ -2065,14 +2065,14 @@\n         \"type\" : [ {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"external-first\",\n-            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"\n+            \"code\" : \"principal\",\n+            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n           } ]\n         }, {\n           \"coding\" : [ {\n             \"system\" : \"https://bluebutton.cms.gov/resources/codesystem/diagnosis-type\",\n-            \"code\" : \"principal\",\n-            \"display\" : \"The single medical diagnosis that is most relevant to the patient's chief complaint or need for treatment.\"\n+            \"code\" : \"external-first\",\n+            \"display\" : \"The code used to identify the 1st external cause of injury, poisoning, or other adverse effect.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f70448c471beb03b6fa3eb1180d85a4c0544a3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTg1ODQ1OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/FDADrugDataUtilityApp.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0NDoxMVrOHA9Rsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTozODowMFrOHBBM5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NjAwMw==", "bodyText": "I would suggest putting this fix in a separate PR. Also: if the file format changed, in addition to the extension, the code that parses+processes it will also require updates.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470766003", "createdAt": "2020-08-14T17:44:11Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/FDADrugDataUtilityApp.java", "diffHunk": "@@ -111,11 +111,11 @@ private static void buildProductsResource(Path convertedNdcDataFile, Path workin\n \n     // unzip FDA NDC file\n     unzip(downloadedNdcZipFile, workingDir);\n-    Path originalNdcDataFile = workingDir.resolve(\"product.txt\");\n+    Path originalNdcDataFile = workingDir.resolve(\"product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      originalNdcDataFile = workingDir.resolve(\"Product.txt\");\n+      originalNdcDataFile = workingDir.resolve(\"Product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      throw new IllegalStateException(\"Unable to locate product.txt in \" + ndctextZipUrl);\n+      throw new IllegalStateException(\"Unable to locate product.xls in \" + ndctextZipUrl);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzMDMwOQ==", "bodyText": "Undo since they changed it back to .txt", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470830309", "createdAt": "2020-08-14T19:38:00Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/FDADrugDataUtilityApp.java", "diffHunk": "@@ -111,11 +111,11 @@ private static void buildProductsResource(Path convertedNdcDataFile, Path workin\n \n     // unzip FDA NDC file\n     unzip(downloadedNdcZipFile, workingDir);\n-    Path originalNdcDataFile = workingDir.resolve(\"product.txt\");\n+    Path originalNdcDataFile = workingDir.resolve(\"product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      originalNdcDataFile = workingDir.resolve(\"Product.txt\");\n+      originalNdcDataFile = workingDir.resolve(\"Product.xls\");\n     if (!Files.isReadable(originalNdcDataFile))\n-      throw new IllegalStateException(\"Unable to locate product.txt in \" + ndctextZipUrl);\n+      throw new IllegalStateException(\"Unable to locate product.xls in \" + ndctextZipUrl);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NjAwMw=="}, "originalCommit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTg2Mzg0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0NTo0OFrOHA9VAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzo0NTo0OFrOHA9VAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2Njg1MQ==", "bodyText": "Public types like this should really have some JavaDoc explaining their purpose, how to use them, etc.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r470766851", "createdAt": "2020-08-14T17:45:48Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/ServiceProviderIdentifiers.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+public enum ServiceProviderIdentifiers {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21fc6bdbf7e4c63dc4861cb095431387f9086e36"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzIxNzU3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyNTozNlrOHBrB0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyNTozNlrOHBrB0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUxNTYwMQ==", "bodyText": "Yeah, I thought about suggesting you move the constants here, but wasn't \ud83d\udcaf  on it. On the one hand, it's nice to have all the custom codesets in one place to inspect them. On the other, I'm not a fan of the indirection it adds.\nAnywhoways, entirely your call on what the better choice is: here or the enum. (I guess if you wanted to put them in the enum you could drop a comment here pointing to it. \ud83e\udd37 )", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471515601", "createdAt": "2020-08-17T14:25:36Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerConstants.java", "diffHunk": "@@ -163,21 +163,76 @@\n    */\n   static final String CODING_NPI_US = \"http://hl7.org/fhir/sid/us-npi\";\n \n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a NPI.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_NPI = \"NPI\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a NPI.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_NPI_DISPLAY = \"National Provider Identifier\";\n+\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a UPIN.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_UPIN = \"UPIN\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a UPIN.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_UPIN_DISPLAY = \"Unique Physician Identification Number\";\n+\n   /** The Code System, as available at <a */\n-  static final String FHIR_IDENTIFIER_TYPE_CODESYSTEM =\n+  static final String CODING_SYSTEM_HL7_IDENTIFIER_TYPE =\n       \"http://terminology.hl7.org/CodeSystem/v2-0203\";\n \n-  /** The Code System, as available for UPIN */\n-  static final String CODING_UPIN = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+  /**\n+   * Used as the {@link Coding#getSystem()} for custom-to-BFD {@link Identifier#getType()} codes.\n+   */\n+  static final String CODING_SYSTEM_IDENTIFIER_TYPE =\n+      BASE_URL_BBAPI_RESOURCES + \"/codesystem/identifier-type\";\n \n-  /** The Code System, as available for NCPDP */\n-  static final String CODING_NCPDP = \"http://ncpdp.org/provider-id\";\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a PDP.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_PDP = \"NCPDP\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a PDP.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_PDP_DISPLAY =\n+      \"National Council for Prescription Drug Programs\";\n+\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a DL.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_DL = \"DL\";\n \n-  /** The Code System, as available for State License Number */\n-  static final String CODING_STATE_LICENSE = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a DL.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_DL_DISPLAY = \"State license number\";\n \n-  /** The Code System, as available for Federal Tax Number */\n-  static final String CODING_FEDERAL_TAX_NUM = FHIR_IDENTIFIER_TYPE_CODESYSTEM;\n+  /**\n+   * The standard {@link Coding#getCode()} for {@link Identifier#getType()} entries where the\n+   * identifier is a TAX.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_TAX = \"TAX\";\n+\n+  /**\n+   * The standard {@link Coding#getDisplay()} for {@link Identifier#getType()} entries where the\n+   * identifier is a TAX.\n+   */\n+  static final String CODED_IDENTIFIER_TYPE_TAX_DISPLAY = \"Federal tax number\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzIyMTcwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyNjozMFrOHBrEOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyNjozMFrOHBrEOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUxNjIxNg==", "bodyText": "\ud83d\udc68\u200d\ud83c\udf73 \ud83d\udc8b", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471516216", "createdAt": "2020-08-17T14:26:30Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/TransformerUtils.java", "diffHunk": "@@ -701,40 +701,41 @@ static CodeableConcept createCodeableConcept(\n    *     Reference#getIdentifier()}\n    * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n    *     Reference#getIdentifier()}\n-   * @param providerIdentifiers the {@link Identifier#getServiceProviderIdentifiers()} to use in\n-   *     {@link Reference#getIdentifier()}\n    * @return a {@link Reference} with the specified {@link Identifier}\n    */\n-  static Reference createIdentifierReference(\n-      String identifierSystem,\n-      String identifierValue,\n-      ServiceProviderIdentifiers... providerIdentifiers) {\n-\n-    Reference reference = new Reference();\n-    if (providerIdentifiers.length > 0) {\n-      Coding coding =\n-          new Coding()\n-              .setSystem(providerIdentifiers[0].bySystem())\n-              .setCode(providerIdentifiers[0].byCode())\n-              .setDisplay(providerIdentifiers[0].byDisplay());\n-      List<Coding> codingList = new ArrayList<Coding>();\n-      codingList.add(coding);\n-\n-      CodeableConcept codeableConcept = new CodeableConcept().setCoding(codingList);\n-      reference.setIdentifier(\n-          new Identifier()\n-              .setSystem(identifierSystem)\n-              .setValue(identifierValue)\n-              .setType(codeableConcept));\n+  static Reference createIdentifierReference(String identifierSystem, String identifierValue) {\n \n-    } else {\n-      reference.setIdentifier(\n-          new Identifier().setSystem(identifierSystem).setValue(identifierValue));\n-    }\n+    return new Reference()\n+        .setIdentifier(new Identifier().setSystem(identifierSystem).setValue(identifierValue))\n+        .setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  }\n \n-    reference.setDisplay(retrieveNpiCodeDisplay(identifierValue));\n+  /**\n+   * @param identifierType the {@link gov.cms.bfd.server.war.stu3.providers.IdentifierType}\n+   * @param identifierValue the {@link Identifier#getValue()} to use in {@link\n+   *     Reference#getIdentifier()}\n+   * @return a {@link Reference} with the specified {@link Identifier}\n+   */\n+  static Reference createIdentifierReference(\n+      IdentifierType identifierType, String identifierValue) {\n \n-    return reference;\n+    Reference reference = new Reference();\n+    Coding coding =\n+        new Coding()\n+            .setSystem(identifierType.bySystem())\n+            .setCode(identifierType.byCode())\n+            .setDisplay(identifierType.byDisplay());\n+    List<Coding> codingList = new ArrayList<Coding>();\n+    codingList.add(coding);\n+\n+    CodeableConcept codeableConcept = new CodeableConcept().setCoding(codingList);\n+    return reference\n+        .setIdentifier(\n+            new Identifier()\n+                .setSystem(identifierType.bySystem())\n+                .setValue(identifierValue)\n+                .setType(codeableConcept))\n+        .setDisplay(retrieveNpiCodeDisplay(identifierValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzIyOTM5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/IdentifierType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyODowOVrOHBrI1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoyODowOVrOHBrI1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUxNzM5Ng==", "bodyText": "I'd go with \"get\" not \"by\".", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/333#discussion_r471517396", "createdAt": "2020-08-17T14:28:09Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/IdentifierType.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package gov.cms.bfd.server.war.stu3.providers;\n+\n+/**\n+ * Enumerates the idenitifer types of values that for different code sets and their corresponding\n+ * system, code, and display values.\n+ */\n+public enum IdentifierType {\n+  NPI(\n+      TransformerConstants.CODING_NPI_US,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_NPI,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_NPI_DISPLAY),\n+  UPIN(\n+      TransformerConstants.CODING_SYSTEM_HL7_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_UPIN,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_UPIN_DISPLAY),\n+  NCPDP(\n+      TransformerConstants.CODING_SYSTEM_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_PDP,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_PDP_DISPLAY),\n+  SL(\n+      TransformerConstants.CODING_SYSTEM_HL7_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_DL,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_DL_DISPLAY),\n+  FTN(\n+      TransformerConstants.CODING_SYSTEM_HL7_IDENTIFIER_TYPE,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_TAX,\n+      TransformerConstants.CODED_IDENTIFIER_TYPE_TAX_DISPLAY);\n+\n+  public final String system;\n+  public final String code;\n+  public final String display;\n+\n+  private IdentifierType(String system, String code, String display) {\n+    this.system = system;\n+    this.code = code;\n+    this.display = display;\n+  }\n+  /** @return the string for the corresponding system for the enum value */\n+  public String bySystem() {\n+    return system;\n+  }\n+  /** @return the string for the corresponding code for the enum value */\n+  public String byCode() {\n+    return code;\n+  }\n+  /** @return the string for the corresponding display for the enum value */\n+  public String byDisplay() {\n+    return display;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd37d07172271dcb0d07a773c178c4c4fcf7cab"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 237, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}