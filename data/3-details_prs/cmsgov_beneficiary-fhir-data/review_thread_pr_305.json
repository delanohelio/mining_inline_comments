{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNTk0OTAz", "number": 305, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjo1NDoyOFrOEOxRDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjozMDo0NVrOEZHlfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzOTIyNzAzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjo1NDoyOFrOGyGz0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoxNTo1M1rOGyHn0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE5MzU1NA==", "bodyText": "Looks good, but seeing some comments not describing what is being asserted starting at this section of the file.  Also some typos, like \"unleashed\" and \"hicnUnhased\".", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455193554", "createdAt": "2020-07-15T16:54:28Z", "author": {"login": "dtisza1"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwNjg2Nw==", "bodyText": "fixed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455206867", "createdAt": "2020-07-15T17:15:53Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE5MzU1NA=="}, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzOTI2OTE4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzowNToxNVrOGyHN3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoxNTo0N1rOGyHnkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMDIyMA==", "bodyText": "comment mismatch?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455200220", "createdAt": "2020-07-15T17:05:15Z", "author": {"login": "dtisza1"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is not the same as old should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.of(\"diff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwNjgwMQ==", "bodyText": "fixed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455206801", "createdAt": "2020-07-15T17:15:47Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is not the same as old should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.of(\"diff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMDIyMA=="}, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzOTI3MTUwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzowNTo1MFrOGyHPVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoxOTowOVrOGyHvyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMDU5OA==", "bodyText": "comment mismatch?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455200598", "createdAt": "2020-07-15T17:05:50Z", "author": {"login": "dtisza1"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is not the same as old should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.of(\"diff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mbihash is not the same as old should assert false\n+    newBene.setMbiHash(Optional.of(\"mbihashdiff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary mbihash and set it back to old should assert true\n+    newBene.setMbiHash(mbiHash);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Check for nulls\n+    // New beneficiary hicn unleashed is null and the return result should assert false\n+    newBene.setHicnUnhashed(Optional.empty());\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is null and the return result should assert false\n+    newBene.setSex(Character.MIN_VALUE);\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is null and the return result should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.empty());\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwODkwNA==", "bodyText": "fixed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455208904", "createdAt": "2020-07-15T17:19:09Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is not the same as old should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.of(\"diff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mbihash is not the same as old should assert false\n+    newBene.setMbiHash(Optional.of(\"mbihashdiff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary mbihash and set it back to old should assert true\n+    newBene.setMbiHash(mbiHash);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Check for nulls\n+    // New beneficiary hicn unleashed is null and the return result should assert false\n+    newBene.setHicnUnhashed(Optional.empty());\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is null and the return result should assert false\n+    newBene.setSex(Character.MIN_VALUE);\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is null and the return result should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.empty());\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMDU5OA=="}, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzOTI3NjY2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzowNzoxOVrOGyHSiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoxNTozMlrOGyHm7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMTQxNw==", "bodyText": "comment mismatch?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455201417", "createdAt": "2020-07-15T17:07:19Z", "author": {"login": "dtisza1"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is not the same as old should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.of(\"diff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mbihash is not the same as old should assert false\n+    newBene.setMbiHash(Optional.of(\"mbihashdiff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary mbihash and set it back to old should assert true\n+    newBene.setMbiHash(mbiHash);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Check for nulls\n+    // New beneficiary hicn unleashed is null and the return result should assert false\n+    newBene.setHicnUnhashed(Optional.empty());\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is null and the return result should assert false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwNjYzNw==", "bodyText": "fixed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r455206637", "createdAt": "2020-07-15T17:15:32Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderTest.java", "diffHunk": "@@ -86,4 +89,111 @@ public void computeMbiHash() {\n         \"742086db6bf338dedda6175ea3af8ca5e85b81fda9cc7078004a4d3e4792494b\",\n         RifLoader.computeMbiHash(options, secretKeyFactory, \"2456689\"));\n   }\n+\n+  /**\n+   * Runs a couple of fake HICNs through {@link\n+   * gov.cms.bfd.pipeline.rif.load.RifLoader#computeHicnHash(LoadAppOptions, SecretKeyFactory,\n+   * String)} to verify that the expected result is produced.\n+   */\n+  @Test\n+  public void isBeneficiaryHistoryEqual() {\n+    Beneficiary newBene = new Beneficiary();\n+    LocalDate birthDate = LocalDate.of(1960, 1, 8);\n+    String hicn = \"2332j3l2\";\n+    Optional<String> hicnUnhased = Optional.of(\"323232\");\n+    char sex = 'M';\n+    Optional<String> medicareBeneficiaryId = Optional.of(\"beneficiaryId\");\n+    Optional<String> mbiHash = Optional.of(\"mbiHash\");\n+\n+    newBene.setBirthDate(birthDate);\n+    newBene.setHicn(hicn);\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    newBene.setSex(sex);\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    newBene.setMbiHash(mbiHash);\n+\n+    Beneficiary oldBene = new Beneficiary();\n+    oldBene.setBirthDate(birthDate);\n+    oldBene.setHicn(hicn);\n+    oldBene.setHicnUnhashed(hicnUnhased);\n+    oldBene.setSex(sex);\n+    oldBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    oldBene.setMbiHash(mbiHash);\n+\n+    // Both old and new beneficiary have the same values return true\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary birth date is not the same as old should assert false\n+    newBene.setBirthDate(LocalDate.of(1950, 1, 8));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary birth date and set it back to old should assert true\n+    newBene.setBirthDate(birthDate);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn is not the same as old should assert false\n+    newBene.setHicn(\"difHicn\");\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn and set it back to old should assert true\n+    newBene.setHicn(hicn);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setHicnUnhashed(Optional.of(\"difHicn\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is not the same as old should assert false\n+    newBene.setSex('F');\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setSex(sex);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mediciarybeneficiaryid is not the same as old should assert false\n+    newBene.setMedicareBeneficiaryId(Optional.of(\"diff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary sex and set it back to old should assert true\n+    newBene.setMedicareBeneficiaryId(medicareBeneficiaryId);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary mbihash is not the same as old should assert false\n+    newBene.setMbiHash(Optional.of(\"mbihashdiff\"));\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary mbihash and set it back to old should assert true\n+    newBene.setMbiHash(mbiHash);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Check for nulls\n+    // New beneficiary hicn unleashed is null and the return result should assert false\n+    newBene.setHicnUnhashed(Optional.empty());\n+    Assert.assertFalse(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // Undo New beneficiary hicn unleashed and set it back to old should assert true\n+    newBene.setHicnUnhashed(hicnUnhased);\n+    Assert.assertTrue(RifLoader.isBeneficiaryHistoryEqual(newBene, oldBene));\n+\n+    // New beneficiary hicn unleashed is null and the return result should assert false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMTQxNw=="}, "originalCommit": {"oid": "a07518b026ea30b4829487af31948c26c2b0e4f6"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzQ2Mjc2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyMjowNFrOHBtXYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyMjowNFrOHBtXYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1Mzg4OQ==", "bodyText": "This line missing before: oof!\nThis possibly adds extra work to our de-dupe, @keithdadkins: we should consider also merging history records where the only difference is that the MBI hash is missing in one of them.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r471553889", "createdAt": "2020-08-17T15:22:04Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -609,20 +609,46 @@ private static void updateBeneficaryHistory(\n     Beneficiary oldBeneficiaryRecord =\n         entityManager.find(Beneficiary.class, newBeneficiaryRecord.getBeneficiaryId());\n \n-    if (oldBeneficiaryRecord != null) {\n+    if (oldBeneficiaryRecord != null\n+        && !isBeneficiaryHistoryEqual(newBeneficiaryRecord, oldBeneficiaryRecord)) {\n       BeneficiaryHistory oldBeneCopy = new BeneficiaryHistory();\n       oldBeneCopy.setBeneficiaryId(oldBeneficiaryRecord.getBeneficiaryId());\n       oldBeneCopy.setBirthDate(oldBeneficiaryRecord.getBirthDate());\n       oldBeneCopy.setHicn(oldBeneficiaryRecord.getHicn());\n       oldBeneCopy.setHicnUnhashed(oldBeneficiaryRecord.getHicnUnhashed());\n       oldBeneCopy.setSex(oldBeneficiaryRecord.getSex());\n       oldBeneCopy.setMedicareBeneficiaryId(oldBeneficiaryRecord.getMedicareBeneficiaryId());\n+      oldBeneCopy.setMbiHash(oldBeneficiaryRecord.getMbiHash());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32dfb84fad81b24e021cb20c6e692f58695e8397"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzQ3MTg0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyNDoxM1rOHBtc2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyNDoxM1rOHBtc2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NTI4OA==", "bodyText": "The inconsistent field names here make me sad (and make this harder to read), but that's not this PR's fault.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r471555288", "createdAt": "2020-08-17T15:24:13Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -609,20 +609,46 @@ private static void updateBeneficaryHistory(\n     Beneficiary oldBeneficiaryRecord =\n         entityManager.find(Beneficiary.class, newBeneficiaryRecord.getBeneficiaryId());\n \n-    if (oldBeneficiaryRecord != null) {\n+    if (oldBeneficiaryRecord != null\n+        && !isBeneficiaryHistoryEqual(newBeneficiaryRecord, oldBeneficiaryRecord)) {\n       BeneficiaryHistory oldBeneCopy = new BeneficiaryHistory();\n       oldBeneCopy.setBeneficiaryId(oldBeneficiaryRecord.getBeneficiaryId());\n       oldBeneCopy.setBirthDate(oldBeneficiaryRecord.getBirthDate());\n       oldBeneCopy.setHicn(oldBeneficiaryRecord.getHicn());\n       oldBeneCopy.setHicnUnhashed(oldBeneficiaryRecord.getHicnUnhashed());\n       oldBeneCopy.setSex(oldBeneficiaryRecord.getSex());\n       oldBeneCopy.setMedicareBeneficiaryId(oldBeneficiaryRecord.getMedicareBeneficiaryId());\n+      oldBeneCopy.setMbiHash(oldBeneficiaryRecord.getMbiHash());\n       oldBeneCopy.setLastUpdated(batchTimestamp);\n \n       entityManager.persist(oldBeneCopy);\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link Beneficiary} records for old and new benificiaries are equal or not\n+   * equal.\n+   *\n+   * @param newBeneficiaryRecord the {@link Beneficiary} new record being processed\n+   * @param oldBeneficiaryRecord the {@link Beneficiary} old record that was processed\n+   */\n+  static boolean isBeneficiaryHistoryEqual(\n+      Beneficiary newBeneficiaryRecord, Beneficiary oldBeneficiaryRecord) {\n+\n+    if (newBeneficiaryRecord.getBirthDate().equals(oldBeneficiaryRecord.getBirthDate())\n+        && newBeneficiaryRecord.getHicn().equals(oldBeneficiaryRecord.getHicn())\n+        && newBeneficiaryRecord.getHicnUnhashed().equals(oldBeneficiaryRecord.getHicnUnhashed())\n+        && newBeneficiaryRecord.getSex() == oldBeneficiaryRecord.getSex()\n+        && newBeneficiaryRecord.getMbiHash().equals(oldBeneficiaryRecord.getMbiHash())\n+        && newBeneficiaryRecord\n+            .getMedicareBeneficiaryId()\n+            .equals(oldBeneficiaryRecord.getMedicareBeneficiaryId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32dfb84fad81b24e021cb20c6e692f58695e8397"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Nzc0MTQzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjozMDo0NVrOHBwCfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjozMDo0NVrOHBwCfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5NzY5Mw==", "bodyText": "Shouldn't this just be checking to see if lastUpdated is less than or equal to start?\nAlso: you could just pull the lastUpdated from the record after the first load, run the second load, and then verify that it's unchanged. That seems simplest+clearest.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/305#discussion_r471597693", "createdAt": "2020-08-17T16:30:45Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -258,6 +259,63 @@ public void loadSampleU() {\n     }\n   }\n \n+  /**\n+   * Runs {@link gov.cms.bfd.pipeline.rif.load.RifLoader} against the {@link\n+   * StaticRifResourceGroup#SAMPLE_U} data.\n+   */\n+  @Test\n+  public void loadSampleUUnchanged() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    // this should insert a new beneficiary history record\n+    loadSample(dataSource, Arrays.asList(StaticRifResource.SAMPLE_U_BENES_UNCHANGED));\n+\n+    long start = System.currentTimeMillis();\n+    // this should bypass inserting a new beneficiary history record because it already exists\n+    loadSample(dataSource, Arrays.asList(StaticRifResource.SAMPLE_U_BENES_UNCHANGED));\n+\n+    /*\n+     * Verify that the updates worked as expected by manually checking some fields.\n+     */\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      CriteriaQuery<BeneficiaryHistory> beneficiaryHistoryCriteria =\n+          entityManager.getCriteriaBuilder().createQuery(BeneficiaryHistory.class);\n+      List<BeneficiaryHistory> beneficiaryHistoryEntries =\n+          entityManager\n+              .createQuery(\n+                  beneficiaryHistoryCriteria.select(\n+                      beneficiaryHistoryCriteria.from(BeneficiaryHistory.class)))\n+              .getResultList();\n+      for (BeneficiaryHistory beneHistory : beneficiaryHistoryEntries) {\n+        Assert.assertEquals(\"567834\", beneHistory.getBeneficiaryId());\n+        // A recent lastUpdated timestamp\n+        Assert.assertTrue(\"Expected a lastUpdated field\", beneHistory.getLastUpdated().isPresent());\n+        long end = System.currentTimeMillis();\n+        // finding the time difference and converting it into seconds\n+        long secs = (end - start) / 1000L;\n+        beneHistory\n+            .getLastUpdated()\n+            .ifPresent(\n+                lastUpdated -> {\n+                  Assert.assertFalse(\n+                      \"Expected not a recent lastUpdated timestamp\",\n+                      lastUpdated.after(Date.from(Instant.now().minusSeconds(secs))));\n+                });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32dfb84fad81b24e021cb20c6e692f58695e8397"}, "originalPosition": 143}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 220, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}