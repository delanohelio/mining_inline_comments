{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0ODU5MjU0", "number": 419, "reviewThreads": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTozNDo1MlrOFFxU-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxODowNTowMFrOFKJAaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTk1Mzg3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTozNDo1MlrOIGclkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMzo0NjowNlrOIGs9JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMDczOQ==", "bodyText": "Not sure we want this to be lazy-loaded. Any thoughts?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543630739", "createdAt": "2020-12-15T19:34:52Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -707,6 +982,47 @@ private TypeSpec generateHeaderEntity(MappingSpec mappingSpec) throws IOExceptio\n       headerEntityClass.addMethod(childGetter);\n     }\n \n+    // Add the parent-to-child join field and accessor, if appropriate.\n+    if (mappingSpec.getHasEnrollments()) {\n+\n+      ParameterizedTypeName childFieldType =\n+          ParameterizedTypeName.get(ClassName.get(List.class), mappingSpec.getEnrollmentEntity());\n+\n+      FieldSpec.Builder childField =\n+          FieldSpec.builder(childFieldType, \"enrollments\", Modifier.PRIVATE)\n+              .initializer(\"new $T<>()\", LinkedList.class);\n+\n+      childField.addAnnotation(\n+          AnnotationSpec.builder(OneToMany.class)\n+              .addMember(\"mappedBy\", \"$S\", mappingSpec.getEnrollmentEntityParentField())\n+              .addMember(\"orphanRemoval\", \"$L\", true)\n+              .addMember(\"fetch\", \"$T.LAZY\", FetchType.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 406}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzg5ODkxNw==", "bodyText": "Eager loaded", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543898917", "createdAt": "2020-12-16T03:46:06Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -707,6 +982,47 @@ private TypeSpec generateHeaderEntity(MappingSpec mappingSpec) throws IOExceptio\n       headerEntityClass.addMethod(childGetter);\n     }\n \n+    // Add the parent-to-child join field and accessor, if appropriate.\n+    if (mappingSpec.getHasEnrollments()) {\n+\n+      ParameterizedTypeName childFieldType =\n+          ParameterizedTypeName.get(ClassName.get(List.class), mappingSpec.getEnrollmentEntity());\n+\n+      FieldSpec.Builder childField =\n+          FieldSpec.builder(childFieldType, \"enrollments\", Modifier.PRIVATE)\n+              .initializer(\"new $T<>()\", LinkedList.class);\n+\n+      childField.addAnnotation(\n+          AnnotationSpec.builder(OneToMany.class)\n+              .addMember(\"mappedBy\", \"$S\", mappingSpec.getEnrollmentEntityParentField())\n+              .addMember(\"orphanRemoval\", \"$L\", true)\n+              .addMember(\"fetch\", \"$T.LAZY\", FetchType.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMDczOQ=="}, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 406}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTk2NzI5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTozODowMlrOIGctYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTo0NToyNFrOIHWPuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMjczOQ==", "bodyText": "Can the pre-existing selectJavaFieldType(...) and selectJavaPropertyType(...) methods be refactored to call these under the hood? If so, we should definitely do that, to cut down on maintenance reqs.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543632739", "createdAt": "2020-12-15T19:38:02Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1819,157 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createEnrollmentFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      TypeName fieldType,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createEnrollmentAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createEnrollmentAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  private static TypeName selectJavaFieldType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && !isColumnOptional) return TypeName.CHAR;\n+    else if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && isColumnOptional) return ClassName.get(Character.class);\n+    else if (type == RifColumnType.CHAR) return ClassName.get(String.class);\n+    else if (type == RifColumnType.DATE && columnLength.orElse(0) == 8)\n+      return ClassName.get(LocalDate.class);\n+    else if (type == RifColumnType.TIMESTAMP && columnLength.orElse(0) == 20)\n+      return ClassName.get(Instant.class);\n+    else if (type == RifColumnType.NUM && columnScale.orElse(Integer.MAX_VALUE) > 0)\n+      return ClassName.get(BigDecimal.class);\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && !isColumnOptional) return TypeName.INT;\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && isColumnOptional) return ClassName.get(Integer.class);\n+    else throw new IllegalArgumentException(\"Unhandled field type: \" + type.name());\n+  }\n+\n+  private static TypeName selectJavaPropertyType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (!isColumnOptional)\n+      return selectJavaFieldType(type, isColumnOptional, columnLength, columnScale);\n+    else\n+      return ParameterizedTypeName.get(\n+          ClassName.get(Optional.class),\n+          selectJavaFieldType(type, isColumnOptional, columnLength, columnScale));\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 592}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU3NTQxNg==", "bodyText": "yes done..", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r544575416", "createdAt": "2020-12-16T19:45:24Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1819,157 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createEnrollmentFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      TypeName fieldType,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createEnrollmentAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createEnrollmentAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  private static TypeName selectJavaFieldType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && !isColumnOptional) return TypeName.CHAR;\n+    else if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && isColumnOptional) return ClassName.get(Character.class);\n+    else if (type == RifColumnType.CHAR) return ClassName.get(String.class);\n+    else if (type == RifColumnType.DATE && columnLength.orElse(0) == 8)\n+      return ClassName.get(LocalDate.class);\n+    else if (type == RifColumnType.TIMESTAMP && columnLength.orElse(0) == 20)\n+      return ClassName.get(Instant.class);\n+    else if (type == RifColumnType.NUM && columnScale.orElse(Integer.MAX_VALUE) > 0)\n+      return ClassName.get(BigDecimal.class);\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && !isColumnOptional) return TypeName.INT;\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && isColumnOptional) return ClassName.get(Integer.class);\n+    else throw new IllegalArgumentException(\"Unhandled field type: \" + type.name());\n+  }\n+\n+  private static TypeName selectJavaPropertyType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (!isColumnOptional)\n+      return selectJavaFieldType(type, isColumnOptional, columnLength, columnScale);\n+    else\n+      return ParameterizedTypeName.get(\n+          ClassName.get(Optional.class),\n+          selectJavaFieldType(type, isColumnOptional, columnLength, columnScale));\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMjczOQ=="}, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 592}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTk3Mzc3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTozOTozNFrOIGcxRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQyMTo0MToxNlrOIMChqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMzczMg==", "bodyText": "Are there any Beneficiaries records where beneEnrollmentReferenceYear is NULL? If so, what does that indicate about the bene record and how should we handle it here?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543633732", "createdAt": "2020-12-15T19:39:34Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"Enrollments\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" varchar(7) not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"Enrollment_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"enrollment_ts\"\n+;\n+\n+\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-01') as \"yearMonth\", \"fipsStateCntyJanCode\",\n+    \"medicareStatusJanCode\", \"entitlementBuyInJanInd\", \"hmoIndicatorJanInd\",\n+    \"partCContractNumberJanId\", \"partCPbpNumberJanId\", \"partCPlanTypeJanCode\",\n+    \"partDContractNumberJanId\", \"partDPbpNumberJanId\", \"partDSegmentNumberJanId\",\n+    \"partDRetireeDrugSubsidyJanInd\", \"medicaidDualEligibilityJanCode\", \"partDLowIncomeCostShareGroupJanCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-02') as \"yearMonth\", \"fipsStateCntyFebCode\",\n+    \"medicareStatusFebCode\", \"entitlementBuyInFebInd\", \"hmoIndicatorFebInd\",\n+    \"partCContractNumberFebId\", \"partCPbpNumberFebId\", \"partCPlanTypeFebCode\",\n+    \"partDContractNumberFebId\", \"partDPbpNumberFebId\", \"partDSegmentNumberFebId\",\n+    \"partDRetireeDrugSubsidyFebInd\", \"medicaidDualEligibilityFebCode\", \"partDLowIncomeCostShareGroupFebCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-03') as \"yearMonth\", \"fipsStateCntyMarCode\",\n+    \"medicareStatusMarCode\", \"entitlementBuyInMarInd\", \"hmoIndicatorMarInd\",\n+    \"partCContractNumberMarId\", \"partCPbpNumberMarId\", \"partCPlanTypeMarCode\",\n+    \"partDContractNumberMarId\", \"partDPbpNumberMarId\", \"partDSegmentNumberMarId\",\n+    \"partDRetireeDrugSubsidyMarInd\", \"medicaidDualEligibilityMarCode\", \"partDLowIncomeCostShareGroupMarCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-04') as \"yearMonth\", \"fipsStateCntyAprCode\",\n+    \"medicareStatusAprCode\", \"entitlementBuyInAprInd\", \"hmoIndicatorAprInd\",\n+    \"partCContractNumberAprId\", \"partCPbpNumberAprId\", \"partCPlanTypeAprCode\",\n+    \"partDContractNumberAprId\", \"partDPbpNumberAprId\", \"partDSegmentNumberAprId\",\n+    \"partDRetireeDrugSubsidyAprInd\", \"medicaidDualEligibilityAprCode\", \"partDLowIncomeCostShareGroupAprCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-05') as \"yearMonth\", \"fipsStateCntyMayCode\",\n+    \"medicareStatusMayCode\", \"entitlementBuyInMayInd\", \"hmoIndicatorMayInd\",\n+    \"partCContractNumberMayId\", \"partCPbpNumberMayId\", \"partCPlanTypeMayCode\",\n+    \"partDContractNumberMayId\", \"partDPbpNumberMayId\", \"partDSegmentNumberMayId\",\n+    \"partDRetireeDrugSubsidyMayInd\", \"medicaidDualEligibilityMayCode\", \"partDLowIncomeCostShareGroupMayCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-06') as \"yearMonth\", \"fipsStateCntyJunCode\",\n+    \"medicareStatusJunCode\", \"entitlementBuyInJunInd\", \"hmoIndicatorJunInd\",\n+    \"partCContractNumberJunId\", \"partCPbpNumberJunId\", \"partCPlanTypeJunCode\",\n+    \"partDContractNumberJunId\", \"partDPbpNumberJunId\", \"partDSegmentNumberJunId\",\n+    \"partDRetireeDrugSubsidyJunInd\", \"medicaidDualEligibilityJunCode\", \"partDLowIncomeCostShareGroupJunCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-07') as \"yearMonth\", \"fipsStateCntyJulCode\",\n+    \"medicareStatusJulCode\", \"entitlementBuyInJulInd\", \"hmoIndicatorJulInd\",\n+    \"partCContractNumberJulId\", \"partCPbpNumberJulId\", \"partCPlanTypeJulCode\",\n+    \"partDContractNumberJulId\", \"partDPbpNumberJulId\", \"partDSegmentNumberJulId\",\n+    \"partDRetireeDrugSubsidyJulInd\", \"medicaidDualEligibilityJulCode\", \"partDLowIncomeCostShareGroupJulCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-08') as \"yearMonth\", \"fipsStateCntyAugCode\",\n+    \"medicareStatusAugCode\", \"entitlementBuyInAugInd\", \"hmoIndicatorAugInd\",\n+    \"partCContractNumberAugId\", \"partCPbpNumberAugId\", \"partCPlanTypeAugCode\",\n+    \"partDContractNumberAugId\", \"partDPbpNumberAugId\", \"partDSegmentNumberAugId\",\n+    \"partDRetireeDrugSubsidyAugInd\", \"medicaidDualEligibilityAugCode\", \"partDLowIncomeCostShareGroupAugCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-09') as \"yearMonth\", \"fipsStateCntySeptCode\",\n+    \"medicareStatusSeptCode\", \"entitlementBuyInSeptInd\", \"hmoIndicatorSeptInd\",\n+    \"partCContractNumberSeptId\", \"partCPbpNumberSeptId\", \"partCPlanTypeSeptCode\",\n+    \"partDContractNumberSeptId\", \"partDPbpNumberSeptId\", \"partDSegmentNumberSeptId\",\n+    \"partDRetireeDrugSubsidySeptInd\", \"medicaidDualEligibilitySeptCode\", \"partDLowIncomeCostShareGroupSeptCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+   SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-10') as \"yearMonth\", \"fipsStateCntyOctCode\",\n+    \"medicareStatusOctCode\", \"entitlementBuyInOctInd\", \"hmoIndicatorOctInd\",\n+    \"partCContractNumberOctId\", \"partCPbpNumberOctId\", \"partCPlanTypeOctCode\",\n+    \"partDContractNumberOctId\", \"partDPbpNumberOctId\", \"partDSegmentNumberOctId\",\n+    \"partDRetireeDrugSubsidyOctInd\", \"medicaidDualEligibilityOctCode\", \"partDLowIncomeCostShareGroupOctCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-11') as \"yearMonth\", \"fipsStateCntyNovCode\",\n+    \"medicareStatusNovCode\", \"entitlementBuyInNovInd\", \"hmoIndicatorNovInd\",\n+    \"partCContractNumberNovId\", \"partCPbpNumberNovId\", \"partCPlanTypeNovCode\",\n+    \"partDContractNumberNovId\", \"partDPbpNumberNovId\", \"partDSegmentNumberNovId\",\n+    \"partDRetireeDrugSubsidyNovInd\", \"medicaidDualEligibilityNovCode\", \"partDLowIncomeCostShareGroupNovCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-12') as \"yearMonth\", \"fipsStateCntyDecCode\",\n+    \"medicareStatusDecCode\", \"entitlementBuyInDecInd\", \"hmoIndicatorDecInd\",\n+    \"partCContractNumberDecId\", \"partCPbpNumberDecId\", \"partCPlanTypeDecCode\",\n+    \"partDContractNumberDecId\", \"partDPbpNumberDecId\", \"partDSegmentNumberDecId\",\n+    \"partDRetireeDrugSubsidyDecInd\", \"medicaidDualEligibilityDecCode\", \"partDLowIncomeCostShareGroupDecCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwMzQxMQ==", "bodyText": "what do u propose we should do if its null?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r545403411", "createdAt": "2020-12-17T21:05:55Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"Enrollments\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" varchar(7) not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"Enrollment_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"enrollment_ts\"\n+;\n+\n+\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-01') as \"yearMonth\", \"fipsStateCntyJanCode\",\n+    \"medicareStatusJanCode\", \"entitlementBuyInJanInd\", \"hmoIndicatorJanInd\",\n+    \"partCContractNumberJanId\", \"partCPbpNumberJanId\", \"partCPlanTypeJanCode\",\n+    \"partDContractNumberJanId\", \"partDPbpNumberJanId\", \"partDSegmentNumberJanId\",\n+    \"partDRetireeDrugSubsidyJanInd\", \"medicaidDualEligibilityJanCode\", \"partDLowIncomeCostShareGroupJanCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-02') as \"yearMonth\", \"fipsStateCntyFebCode\",\n+    \"medicareStatusFebCode\", \"entitlementBuyInFebInd\", \"hmoIndicatorFebInd\",\n+    \"partCContractNumberFebId\", \"partCPbpNumberFebId\", \"partCPlanTypeFebCode\",\n+    \"partDContractNumberFebId\", \"partDPbpNumberFebId\", \"partDSegmentNumberFebId\",\n+    \"partDRetireeDrugSubsidyFebInd\", \"medicaidDualEligibilityFebCode\", \"partDLowIncomeCostShareGroupFebCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-03') as \"yearMonth\", \"fipsStateCntyMarCode\",\n+    \"medicareStatusMarCode\", \"entitlementBuyInMarInd\", \"hmoIndicatorMarInd\",\n+    \"partCContractNumberMarId\", \"partCPbpNumberMarId\", \"partCPlanTypeMarCode\",\n+    \"partDContractNumberMarId\", \"partDPbpNumberMarId\", \"partDSegmentNumberMarId\",\n+    \"partDRetireeDrugSubsidyMarInd\", \"medicaidDualEligibilityMarCode\", \"partDLowIncomeCostShareGroupMarCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-04') as \"yearMonth\", \"fipsStateCntyAprCode\",\n+    \"medicareStatusAprCode\", \"entitlementBuyInAprInd\", \"hmoIndicatorAprInd\",\n+    \"partCContractNumberAprId\", \"partCPbpNumberAprId\", \"partCPlanTypeAprCode\",\n+    \"partDContractNumberAprId\", \"partDPbpNumberAprId\", \"partDSegmentNumberAprId\",\n+    \"partDRetireeDrugSubsidyAprInd\", \"medicaidDualEligibilityAprCode\", \"partDLowIncomeCostShareGroupAprCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-05') as \"yearMonth\", \"fipsStateCntyMayCode\",\n+    \"medicareStatusMayCode\", \"entitlementBuyInMayInd\", \"hmoIndicatorMayInd\",\n+    \"partCContractNumberMayId\", \"partCPbpNumberMayId\", \"partCPlanTypeMayCode\",\n+    \"partDContractNumberMayId\", \"partDPbpNumberMayId\", \"partDSegmentNumberMayId\",\n+    \"partDRetireeDrugSubsidyMayInd\", \"medicaidDualEligibilityMayCode\", \"partDLowIncomeCostShareGroupMayCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-06') as \"yearMonth\", \"fipsStateCntyJunCode\",\n+    \"medicareStatusJunCode\", \"entitlementBuyInJunInd\", \"hmoIndicatorJunInd\",\n+    \"partCContractNumberJunId\", \"partCPbpNumberJunId\", \"partCPlanTypeJunCode\",\n+    \"partDContractNumberJunId\", \"partDPbpNumberJunId\", \"partDSegmentNumberJunId\",\n+    \"partDRetireeDrugSubsidyJunInd\", \"medicaidDualEligibilityJunCode\", \"partDLowIncomeCostShareGroupJunCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-07') as \"yearMonth\", \"fipsStateCntyJulCode\",\n+    \"medicareStatusJulCode\", \"entitlementBuyInJulInd\", \"hmoIndicatorJulInd\",\n+    \"partCContractNumberJulId\", \"partCPbpNumberJulId\", \"partCPlanTypeJulCode\",\n+    \"partDContractNumberJulId\", \"partDPbpNumberJulId\", \"partDSegmentNumberJulId\",\n+    \"partDRetireeDrugSubsidyJulInd\", \"medicaidDualEligibilityJulCode\", \"partDLowIncomeCostShareGroupJulCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-08') as \"yearMonth\", \"fipsStateCntyAugCode\",\n+    \"medicareStatusAugCode\", \"entitlementBuyInAugInd\", \"hmoIndicatorAugInd\",\n+    \"partCContractNumberAugId\", \"partCPbpNumberAugId\", \"partCPlanTypeAugCode\",\n+    \"partDContractNumberAugId\", \"partDPbpNumberAugId\", \"partDSegmentNumberAugId\",\n+    \"partDRetireeDrugSubsidyAugInd\", \"medicaidDualEligibilityAugCode\", \"partDLowIncomeCostShareGroupAugCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-09') as \"yearMonth\", \"fipsStateCntySeptCode\",\n+    \"medicareStatusSeptCode\", \"entitlementBuyInSeptInd\", \"hmoIndicatorSeptInd\",\n+    \"partCContractNumberSeptId\", \"partCPbpNumberSeptId\", \"partCPlanTypeSeptCode\",\n+    \"partDContractNumberSeptId\", \"partDPbpNumberSeptId\", \"partDSegmentNumberSeptId\",\n+    \"partDRetireeDrugSubsidySeptInd\", \"medicaidDualEligibilitySeptCode\", \"partDLowIncomeCostShareGroupSeptCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+   SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-10') as \"yearMonth\", \"fipsStateCntyOctCode\",\n+    \"medicareStatusOctCode\", \"entitlementBuyInOctInd\", \"hmoIndicatorOctInd\",\n+    \"partCContractNumberOctId\", \"partCPbpNumberOctId\", \"partCPlanTypeOctCode\",\n+    \"partDContractNumberOctId\", \"partDPbpNumberOctId\", \"partDSegmentNumberOctId\",\n+    \"partDRetireeDrugSubsidyOctInd\", \"medicaidDualEligibilityOctCode\", \"partDLowIncomeCostShareGroupOctCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-11') as \"yearMonth\", \"fipsStateCntyNovCode\",\n+    \"medicareStatusNovCode\", \"entitlementBuyInNovInd\", \"hmoIndicatorNovInd\",\n+    \"partCContractNumberNovId\", \"partCPbpNumberNovId\", \"partCPlanTypeNovCode\",\n+    \"partDContractNumberNovId\", \"partDPbpNumberNovId\", \"partDSegmentNumberNovId\",\n+    \"partDRetireeDrugSubsidyNovInd\", \"medicaidDualEligibilityNovCode\", \"partDLowIncomeCostShareGroupNovCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-12') as \"yearMonth\", \"fipsStateCntyDecCode\",\n+    \"medicareStatusDecCode\", \"entitlementBuyInDecInd\", \"hmoIndicatorDecInd\",\n+    \"partCContractNumberDecId\", \"partCPbpNumberDecId\", \"partCPlanTypeDecCode\",\n+    \"partDContractNumberDecId\", \"partDPbpNumberDecId\", \"partDSegmentNumberDecId\",\n+    \"partDRetireeDrugSubsidyDecInd\", \"medicaidDualEligibilityDecCode\", \"partDLowIncomeCostShareGroupDecCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMzczMg=="}, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk1MTgxNA==", "bodyText": "Dunno! Depends on why it's null.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r546951814", "createdAt": "2020-12-21T22:02:49Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"Enrollments\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" varchar(7) not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"Enrollment_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"enrollment_ts\"\n+;\n+\n+\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-01') as \"yearMonth\", \"fipsStateCntyJanCode\",\n+    \"medicareStatusJanCode\", \"entitlementBuyInJanInd\", \"hmoIndicatorJanInd\",\n+    \"partCContractNumberJanId\", \"partCPbpNumberJanId\", \"partCPlanTypeJanCode\",\n+    \"partDContractNumberJanId\", \"partDPbpNumberJanId\", \"partDSegmentNumberJanId\",\n+    \"partDRetireeDrugSubsidyJanInd\", \"medicaidDualEligibilityJanCode\", \"partDLowIncomeCostShareGroupJanCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-02') as \"yearMonth\", \"fipsStateCntyFebCode\",\n+    \"medicareStatusFebCode\", \"entitlementBuyInFebInd\", \"hmoIndicatorFebInd\",\n+    \"partCContractNumberFebId\", \"partCPbpNumberFebId\", \"partCPlanTypeFebCode\",\n+    \"partDContractNumberFebId\", \"partDPbpNumberFebId\", \"partDSegmentNumberFebId\",\n+    \"partDRetireeDrugSubsidyFebInd\", \"medicaidDualEligibilityFebCode\", \"partDLowIncomeCostShareGroupFebCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-03') as \"yearMonth\", \"fipsStateCntyMarCode\",\n+    \"medicareStatusMarCode\", \"entitlementBuyInMarInd\", \"hmoIndicatorMarInd\",\n+    \"partCContractNumberMarId\", \"partCPbpNumberMarId\", \"partCPlanTypeMarCode\",\n+    \"partDContractNumberMarId\", \"partDPbpNumberMarId\", \"partDSegmentNumberMarId\",\n+    \"partDRetireeDrugSubsidyMarInd\", \"medicaidDualEligibilityMarCode\", \"partDLowIncomeCostShareGroupMarCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-04') as \"yearMonth\", \"fipsStateCntyAprCode\",\n+    \"medicareStatusAprCode\", \"entitlementBuyInAprInd\", \"hmoIndicatorAprInd\",\n+    \"partCContractNumberAprId\", \"partCPbpNumberAprId\", \"partCPlanTypeAprCode\",\n+    \"partDContractNumberAprId\", \"partDPbpNumberAprId\", \"partDSegmentNumberAprId\",\n+    \"partDRetireeDrugSubsidyAprInd\", \"medicaidDualEligibilityAprCode\", \"partDLowIncomeCostShareGroupAprCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-05') as \"yearMonth\", \"fipsStateCntyMayCode\",\n+    \"medicareStatusMayCode\", \"entitlementBuyInMayInd\", \"hmoIndicatorMayInd\",\n+    \"partCContractNumberMayId\", \"partCPbpNumberMayId\", \"partCPlanTypeMayCode\",\n+    \"partDContractNumberMayId\", \"partDPbpNumberMayId\", \"partDSegmentNumberMayId\",\n+    \"partDRetireeDrugSubsidyMayInd\", \"medicaidDualEligibilityMayCode\", \"partDLowIncomeCostShareGroupMayCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-06') as \"yearMonth\", \"fipsStateCntyJunCode\",\n+    \"medicareStatusJunCode\", \"entitlementBuyInJunInd\", \"hmoIndicatorJunInd\",\n+    \"partCContractNumberJunId\", \"partCPbpNumberJunId\", \"partCPlanTypeJunCode\",\n+    \"partDContractNumberJunId\", \"partDPbpNumberJunId\", \"partDSegmentNumberJunId\",\n+    \"partDRetireeDrugSubsidyJunInd\", \"medicaidDualEligibilityJunCode\", \"partDLowIncomeCostShareGroupJunCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-07') as \"yearMonth\", \"fipsStateCntyJulCode\",\n+    \"medicareStatusJulCode\", \"entitlementBuyInJulInd\", \"hmoIndicatorJulInd\",\n+    \"partCContractNumberJulId\", \"partCPbpNumberJulId\", \"partCPlanTypeJulCode\",\n+    \"partDContractNumberJulId\", \"partDPbpNumberJulId\", \"partDSegmentNumberJulId\",\n+    \"partDRetireeDrugSubsidyJulInd\", \"medicaidDualEligibilityJulCode\", \"partDLowIncomeCostShareGroupJulCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-08') as \"yearMonth\", \"fipsStateCntyAugCode\",\n+    \"medicareStatusAugCode\", \"entitlementBuyInAugInd\", \"hmoIndicatorAugInd\",\n+    \"partCContractNumberAugId\", \"partCPbpNumberAugId\", \"partCPlanTypeAugCode\",\n+    \"partDContractNumberAugId\", \"partDPbpNumberAugId\", \"partDSegmentNumberAugId\",\n+    \"partDRetireeDrugSubsidyAugInd\", \"medicaidDualEligibilityAugCode\", \"partDLowIncomeCostShareGroupAugCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-09') as \"yearMonth\", \"fipsStateCntySeptCode\",\n+    \"medicareStatusSeptCode\", \"entitlementBuyInSeptInd\", \"hmoIndicatorSeptInd\",\n+    \"partCContractNumberSeptId\", \"partCPbpNumberSeptId\", \"partCPlanTypeSeptCode\",\n+    \"partDContractNumberSeptId\", \"partDPbpNumberSeptId\", \"partDSegmentNumberSeptId\",\n+    \"partDRetireeDrugSubsidySeptInd\", \"medicaidDualEligibilitySeptCode\", \"partDLowIncomeCostShareGroupSeptCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+   SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-10') as \"yearMonth\", \"fipsStateCntyOctCode\",\n+    \"medicareStatusOctCode\", \"entitlementBuyInOctInd\", \"hmoIndicatorOctInd\",\n+    \"partCContractNumberOctId\", \"partCPbpNumberOctId\", \"partCPlanTypeOctCode\",\n+    \"partDContractNumberOctId\", \"partDPbpNumberOctId\", \"partDSegmentNumberOctId\",\n+    \"partDRetireeDrugSubsidyOctInd\", \"medicaidDualEligibilityOctCode\", \"partDLowIncomeCostShareGroupOctCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-11') as \"yearMonth\", \"fipsStateCntyNovCode\",\n+    \"medicareStatusNovCode\", \"entitlementBuyInNovInd\", \"hmoIndicatorNovInd\",\n+    \"partCContractNumberNovId\", \"partCPbpNumberNovId\", \"partCPlanTypeNovCode\",\n+    \"partDContractNumberNovId\", \"partDPbpNumberNovId\", \"partDSegmentNumberNovId\",\n+    \"partDRetireeDrugSubsidyNovInd\", \"medicaidDualEligibilityNovCode\", \"partDLowIncomeCostShareGroupNovCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-12') as \"yearMonth\", \"fipsStateCntyDecCode\",\n+    \"medicareStatusDecCode\", \"entitlementBuyInDecInd\", \"hmoIndicatorDecInd\",\n+    \"partCContractNumberDecId\", \"partCPbpNumberDecId\", \"partCPlanTypeDecCode\",\n+    \"partDContractNumberDecId\", \"partDPbpNumberDecId\", \"partDSegmentNumberDecId\",\n+    \"partDRetireeDrugSubsidyDecInd\", \"medicaidDualEligibilityDecCode\", \"partDLowIncomeCostShareGroupDecCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMzczMg=="}, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ5NTIwOQ==", "bodyText": "From our data providers: As of now, NULL means a beneficiary is accredited but not yet enrolled. We continue to get additional clarity on this.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549495209", "createdAt": "2020-12-28T21:41:16Z", "author": {"login": "jzulim"}, "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"Enrollments\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" varchar(7) not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"Enrollment_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"enrollment_ts\"\n+;\n+\n+\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-01') as \"yearMonth\", \"fipsStateCntyJanCode\",\n+    \"medicareStatusJanCode\", \"entitlementBuyInJanInd\", \"hmoIndicatorJanInd\",\n+    \"partCContractNumberJanId\", \"partCPbpNumberJanId\", \"partCPlanTypeJanCode\",\n+    \"partDContractNumberJanId\", \"partDPbpNumberJanId\", \"partDSegmentNumberJanId\",\n+    \"partDRetireeDrugSubsidyJanInd\", \"medicaidDualEligibilityJanCode\", \"partDLowIncomeCostShareGroupJanCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-02') as \"yearMonth\", \"fipsStateCntyFebCode\",\n+    \"medicareStatusFebCode\", \"entitlementBuyInFebInd\", \"hmoIndicatorFebInd\",\n+    \"partCContractNumberFebId\", \"partCPbpNumberFebId\", \"partCPlanTypeFebCode\",\n+    \"partDContractNumberFebId\", \"partDPbpNumberFebId\", \"partDSegmentNumberFebId\",\n+    \"partDRetireeDrugSubsidyFebInd\", \"medicaidDualEligibilityFebCode\", \"partDLowIncomeCostShareGroupFebCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-03') as \"yearMonth\", \"fipsStateCntyMarCode\",\n+    \"medicareStatusMarCode\", \"entitlementBuyInMarInd\", \"hmoIndicatorMarInd\",\n+    \"partCContractNumberMarId\", \"partCPbpNumberMarId\", \"partCPlanTypeMarCode\",\n+    \"partDContractNumberMarId\", \"partDPbpNumberMarId\", \"partDSegmentNumberMarId\",\n+    \"partDRetireeDrugSubsidyMarInd\", \"medicaidDualEligibilityMarCode\", \"partDLowIncomeCostShareGroupMarCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-04') as \"yearMonth\", \"fipsStateCntyAprCode\",\n+    \"medicareStatusAprCode\", \"entitlementBuyInAprInd\", \"hmoIndicatorAprInd\",\n+    \"partCContractNumberAprId\", \"partCPbpNumberAprId\", \"partCPlanTypeAprCode\",\n+    \"partDContractNumberAprId\", \"partDPbpNumberAprId\", \"partDSegmentNumberAprId\",\n+    \"partDRetireeDrugSubsidyAprInd\", \"medicaidDualEligibilityAprCode\", \"partDLowIncomeCostShareGroupAprCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-05') as \"yearMonth\", \"fipsStateCntyMayCode\",\n+    \"medicareStatusMayCode\", \"entitlementBuyInMayInd\", \"hmoIndicatorMayInd\",\n+    \"partCContractNumberMayId\", \"partCPbpNumberMayId\", \"partCPlanTypeMayCode\",\n+    \"partDContractNumberMayId\", \"partDPbpNumberMayId\", \"partDSegmentNumberMayId\",\n+    \"partDRetireeDrugSubsidyMayInd\", \"medicaidDualEligibilityMayCode\", \"partDLowIncomeCostShareGroupMayCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-06') as \"yearMonth\", \"fipsStateCntyJunCode\",\n+    \"medicareStatusJunCode\", \"entitlementBuyInJunInd\", \"hmoIndicatorJunInd\",\n+    \"partCContractNumberJunId\", \"partCPbpNumberJunId\", \"partCPlanTypeJunCode\",\n+    \"partDContractNumberJunId\", \"partDPbpNumberJunId\", \"partDSegmentNumberJunId\",\n+    \"partDRetireeDrugSubsidyJunInd\", \"medicaidDualEligibilityJunCode\", \"partDLowIncomeCostShareGroupJunCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-07') as \"yearMonth\", \"fipsStateCntyJulCode\",\n+    \"medicareStatusJulCode\", \"entitlementBuyInJulInd\", \"hmoIndicatorJulInd\",\n+    \"partCContractNumberJulId\", \"partCPbpNumberJulId\", \"partCPlanTypeJulCode\",\n+    \"partDContractNumberJulId\", \"partDPbpNumberJulId\", \"partDSegmentNumberJulId\",\n+    \"partDRetireeDrugSubsidyJulInd\", \"medicaidDualEligibilityJulCode\", \"partDLowIncomeCostShareGroupJulCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-08') as \"yearMonth\", \"fipsStateCntyAugCode\",\n+    \"medicareStatusAugCode\", \"entitlementBuyInAugInd\", \"hmoIndicatorAugInd\",\n+    \"partCContractNumberAugId\", \"partCPbpNumberAugId\", \"partCPlanTypeAugCode\",\n+    \"partDContractNumberAugId\", \"partDPbpNumberAugId\", \"partDSegmentNumberAugId\",\n+    \"partDRetireeDrugSubsidyAugInd\", \"medicaidDualEligibilityAugCode\", \"partDLowIncomeCostShareGroupAugCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-09') as \"yearMonth\", \"fipsStateCntySeptCode\",\n+    \"medicareStatusSeptCode\", \"entitlementBuyInSeptInd\", \"hmoIndicatorSeptInd\",\n+    \"partCContractNumberSeptId\", \"partCPbpNumberSeptId\", \"partCPlanTypeSeptCode\",\n+    \"partDContractNumberSeptId\", \"partDPbpNumberSeptId\", \"partDSegmentNumberSeptId\",\n+    \"partDRetireeDrugSubsidySeptInd\", \"medicaidDualEligibilitySeptCode\", \"partDLowIncomeCostShareGroupSeptCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"Enrollments\"\n+   SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-10') as \"yearMonth\", \"fipsStateCntyOctCode\",\n+    \"medicareStatusOctCode\", \"entitlementBuyInOctInd\", \"hmoIndicatorOctInd\",\n+    \"partCContractNumberOctId\", \"partCPbpNumberOctId\", \"partCPlanTypeOctCode\",\n+    \"partDContractNumberOctId\", \"partDPbpNumberOctId\", \"partDSegmentNumberOctId\",\n+    \"partDRetireeDrugSubsidyOctInd\", \"medicaidDualEligibilityOctCode\", \"partDLowIncomeCostShareGroupOctCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-11') as \"yearMonth\", \"fipsStateCntyNovCode\",\n+    \"medicareStatusNovCode\", \"entitlementBuyInNovInd\", \"hmoIndicatorNovInd\",\n+    \"partCContractNumberNovId\", \"partCPbpNumberNovId\", \"partCPlanTypeNovCode\",\n+    \"partDContractNumberNovId\", \"partDPbpNumberNovId\", \"partDSegmentNumberNovId\",\n+    \"partDRetireeDrugSubsidyNovInd\", \"medicaidDualEligibilityNovCode\", \"partDLowIncomeCostShareGroupNovCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"Enrollments\"\n+    SELECT  \"beneficiaryId\", CONCAT(\"beneEnrollmentReferenceYear\", '-12') as \"yearMonth\", \"fipsStateCntyDecCode\",\n+    \"medicareStatusDecCode\", \"entitlementBuyInDecInd\", \"hmoIndicatorDecInd\",\n+    \"partCContractNumberDecId\", \"partCPbpNumberDecId\", \"partCPlanTypeDecCode\",\n+    \"partDContractNumberDecId\", \"partDPbpNumberDecId\", \"partDSegmentNumberDecId\",\n+    \"partDRetireeDrugSubsidyDecInd\", \"medicaidDualEligibilityDecCode\", \"partDLowIncomeCostShareGroupDecCode\"\n+\tFROM \"Beneficiaries\"\n+\tWHERE \"beneEnrollmentReferenceYear\" is not null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMzczMg=="}, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTk5MDUxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo0MzozNVrOIGc7Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMzo0NTo0NVrOIGs8QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzNjI1OQ==", "bodyText": "I think this will overwrite all enrollment records, instead of just the current year's won't it? If you want to avoid that, you need to merge the new/current records into the existing list, avoiding duplicates (which would likely cause PK errors).\nMore importantly, if this wasn't caught by your tests, then I think you need more ITs to ensure that all of this is actually accomplishing the thing we need it to.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543636259", "createdAt": "2020-12-15T19:43:35Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -596,6 +616,240 @@ private void processAsync(\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link Enrollment} record is created or updated for the specified {@link\n+   * Beneficiary}, if that {@link Beneficiary} already exists and is just being updated.\n+   *\n+   * @param entityManager the {@link EntityManager} to use\n+   * @param loadAction the {@link Loadaction} record being processed\n+   * @param beneficiaryRecord the {@link Beneficiary} record being processed\n+   */\n+  private static void updateEnrollment(EntityManager entityManager, Beneficiary beneficiaryRecord) {\n+\n+    if (beneficiaryRecord.getBeneEnrollmentReferenceYear().isPresent()) {\n+      String date = beneficiaryRecord.getBeneEnrollmentReferenceYear().get().toString();\n+      List<Enrollment> enrollments = new LinkedList<Enrollment>();\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"01\"),\n+              beneficiaryRecord.getEntitlementBuyInJanInd(),\n+              beneficiaryRecord.getFipsStateCntyJanCode(),\n+              beneficiaryRecord.getHmoIndicatorJanInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJanCode(),\n+              beneficiaryRecord.getMedicareStatusJanCode(),\n+              beneficiaryRecord.getPartCContractNumberJanId(),\n+              beneficiaryRecord.getPartCPbpNumberJanId(),\n+              beneficiaryRecord.getPartCPlanTypeJanCode(),\n+              beneficiaryRecord.getPartDContractNumberJanId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJanCode(),\n+              beneficiaryRecord.getPartDPbpNumberJanId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJanInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJanId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"02\"),\n+              beneficiaryRecord.getEntitlementBuyInFebInd(),\n+              beneficiaryRecord.getFipsStateCntyFebCode(),\n+              beneficiaryRecord.getHmoIndicatorFebInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityFebCode(),\n+              beneficiaryRecord.getMedicareStatusFebCode(),\n+              beneficiaryRecord.getPartCContractNumberFebId(),\n+              beneficiaryRecord.getPartCPbpNumberFebId(),\n+              beneficiaryRecord.getPartCPlanTypeFebCode(),\n+              beneficiaryRecord.getPartDContractNumberFebId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupFebCode(),\n+              beneficiaryRecord.getPartDPbpNumberFebId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyFebInd(),\n+              beneficiaryRecord.getPartDSegmentNumberFebId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"03\"),\n+              beneficiaryRecord.getEntitlementBuyInMarInd(),\n+              beneficiaryRecord.getFipsStateCntyMarCode(),\n+              beneficiaryRecord.getHmoIndicatorMarInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMarCode(),\n+              beneficiaryRecord.getMedicareStatusMarCode(),\n+              beneficiaryRecord.getPartCContractNumberMarId(),\n+              beneficiaryRecord.getPartCPbpNumberMarId(),\n+              beneficiaryRecord.getPartCPlanTypeMarCode(),\n+              beneficiaryRecord.getPartDContractNumberMarId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMarCode(),\n+              beneficiaryRecord.getPartDPbpNumberMarId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMarInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMarId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"04\"),\n+              beneficiaryRecord.getEntitlementBuyInAprInd(),\n+              beneficiaryRecord.getFipsStateCntyAprCode(),\n+              beneficiaryRecord.getHmoIndicatorAprInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAprCode(),\n+              beneficiaryRecord.getMedicareStatusAprCode(),\n+              beneficiaryRecord.getPartCContractNumberAprId(),\n+              beneficiaryRecord.getPartCPbpNumberAprId(),\n+              beneficiaryRecord.getPartCPlanTypeAprCode(),\n+              beneficiaryRecord.getPartDContractNumberAprId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAprCode(),\n+              beneficiaryRecord.getPartDPbpNumberAprId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAprInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAprId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"05\"),\n+              beneficiaryRecord.getEntitlementBuyInMayInd(),\n+              beneficiaryRecord.getFipsStateCntyMayCode(),\n+              beneficiaryRecord.getHmoIndicatorMayInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMayCode(),\n+              beneficiaryRecord.getMedicareStatusMayCode(),\n+              beneficiaryRecord.getPartCContractNumberMayId(),\n+              beneficiaryRecord.getPartCPbpNumberMayId(),\n+              beneficiaryRecord.getPartCPlanTypeMayCode(),\n+              beneficiaryRecord.getPartDContractNumberMayId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMayCode(),\n+              beneficiaryRecord.getPartDPbpNumberMayId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMayInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMayId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"06\"),\n+              beneficiaryRecord.getEntitlementBuyInJunInd(),\n+              beneficiaryRecord.getFipsStateCntyJunCode(),\n+              beneficiaryRecord.getHmoIndicatorJunInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJunCode(),\n+              beneficiaryRecord.getMedicareStatusJunCode(),\n+              beneficiaryRecord.getPartCContractNumberJunId(),\n+              beneficiaryRecord.getPartCPbpNumberJunId(),\n+              beneficiaryRecord.getPartCPlanTypeJunCode(),\n+              beneficiaryRecord.getPartDContractNumberJunId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJunCode(),\n+              beneficiaryRecord.getPartDPbpNumberJunId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJunInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJunId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"07\"),\n+              beneficiaryRecord.getEntitlementBuyInJulInd(),\n+              beneficiaryRecord.getFipsStateCntyJulCode(),\n+              beneficiaryRecord.getHmoIndicatorJulInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJulCode(),\n+              beneficiaryRecord.getMedicareStatusJulCode(),\n+              beneficiaryRecord.getPartCContractNumberJulId(),\n+              beneficiaryRecord.getPartCPbpNumberJulId(),\n+              beneficiaryRecord.getPartCPlanTypeJulCode(),\n+              beneficiaryRecord.getPartDContractNumberJulId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJulCode(),\n+              beneficiaryRecord.getPartDPbpNumberJulId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJulInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJulId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"08\"),\n+              beneficiaryRecord.getEntitlementBuyInAugInd(),\n+              beneficiaryRecord.getFipsStateCntyAugCode(),\n+              beneficiaryRecord.getHmoIndicatorAugInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAugCode(),\n+              beneficiaryRecord.getMedicareStatusAugCode(),\n+              beneficiaryRecord.getPartCContractNumberAugId(),\n+              beneficiaryRecord.getPartCPbpNumberAugId(),\n+              beneficiaryRecord.getPartCPlanTypeAugCode(),\n+              beneficiaryRecord.getPartDContractNumberAugId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAugCode(),\n+              beneficiaryRecord.getPartDPbpNumberAugId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAugInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAugId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"09\"),\n+              beneficiaryRecord.getEntitlementBuyInSeptInd(),\n+              beneficiaryRecord.getFipsStateCntySeptCode(),\n+              beneficiaryRecord.getHmoIndicatorSeptInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilitySeptCode(),\n+              beneficiaryRecord.getMedicareStatusSeptCode(),\n+              beneficiaryRecord.getPartCContractNumberSeptId(),\n+              beneficiaryRecord.getPartCPbpNumberSeptId(),\n+              beneficiaryRecord.getPartCPlanTypeSeptCode(),\n+              beneficiaryRecord.getPartDContractNumberSeptId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupSeptCode(),\n+              beneficiaryRecord.getPartDPbpNumberSeptId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidySeptInd(),\n+              beneficiaryRecord.getPartDSegmentNumberSeptId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"10\"),\n+              beneficiaryRecord.getEntitlementBuyInOctInd(),\n+              beneficiaryRecord.getFipsStateCntyOctCode(),\n+              beneficiaryRecord.getHmoIndicatorOctInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityOctCode(),\n+              beneficiaryRecord.getMedicareStatusOctCode(),\n+              beneficiaryRecord.getPartCContractNumberOctId(),\n+              beneficiaryRecord.getPartCPbpNumberOctId(),\n+              beneficiaryRecord.getPartCPlanTypeOctCode(),\n+              beneficiaryRecord.getPartDContractNumberOctId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupOctCode(),\n+              beneficiaryRecord.getPartDPbpNumberOctId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyOctInd(),\n+              beneficiaryRecord.getPartDSegmentNumberOctId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"11\"),\n+              beneficiaryRecord.getEntitlementBuyInNovInd(),\n+              beneficiaryRecord.getFipsStateCntyNovCode(),\n+              beneficiaryRecord.getHmoIndicatorNovInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityNovCode(),\n+              beneficiaryRecord.getMedicareStatusNovCode(),\n+              beneficiaryRecord.getPartCContractNumberNovId(),\n+              beneficiaryRecord.getPartCPbpNumberNovId(),\n+              beneficiaryRecord.getPartCPlanTypeNovCode(),\n+              beneficiaryRecord.getPartDContractNumberNovId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupNovCode(),\n+              beneficiaryRecord.getPartDPbpNumberNovId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyNovInd(),\n+              beneficiaryRecord.getPartDSegmentNumberNovId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"12\"),\n+              beneficiaryRecord.getEntitlementBuyInDecInd(),\n+              beneficiaryRecord.getFipsStateCntyDecCode(),\n+              beneficiaryRecord.getHmoIndicatorDecInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityDecCode(),\n+              beneficiaryRecord.getMedicareStatusDecCode(),\n+              beneficiaryRecord.getPartCContractNumberDecId(),\n+              beneficiaryRecord.getPartCPbpNumberDecId(),\n+              beneficiaryRecord.getPartCPlanTypeDecCode(),\n+              beneficiaryRecord.getPartDContractNumberDecId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupDecCode(),\n+              beneficiaryRecord.getPartDPbpNumberDecId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyDecInd(),\n+              beneficiaryRecord.getPartDSegmentNumberDecId()));\n+\n+      beneficiaryRecord.setEnrollments(enrollments);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 297}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzg5ODY4OA==", "bodyText": "Yea Changed the logic and adding more IT's", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543898688", "createdAt": "2020-12-16T03:45:45Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -596,6 +616,240 @@ private void processAsync(\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link Enrollment} record is created or updated for the specified {@link\n+   * Beneficiary}, if that {@link Beneficiary} already exists and is just being updated.\n+   *\n+   * @param entityManager the {@link EntityManager} to use\n+   * @param loadAction the {@link Loadaction} record being processed\n+   * @param beneficiaryRecord the {@link Beneficiary} record being processed\n+   */\n+  private static void updateEnrollment(EntityManager entityManager, Beneficiary beneficiaryRecord) {\n+\n+    if (beneficiaryRecord.getBeneEnrollmentReferenceYear().isPresent()) {\n+      String date = beneficiaryRecord.getBeneEnrollmentReferenceYear().get().toString();\n+      List<Enrollment> enrollments = new LinkedList<Enrollment>();\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"01\"),\n+              beneficiaryRecord.getEntitlementBuyInJanInd(),\n+              beneficiaryRecord.getFipsStateCntyJanCode(),\n+              beneficiaryRecord.getHmoIndicatorJanInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJanCode(),\n+              beneficiaryRecord.getMedicareStatusJanCode(),\n+              beneficiaryRecord.getPartCContractNumberJanId(),\n+              beneficiaryRecord.getPartCPbpNumberJanId(),\n+              beneficiaryRecord.getPartCPlanTypeJanCode(),\n+              beneficiaryRecord.getPartDContractNumberJanId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJanCode(),\n+              beneficiaryRecord.getPartDPbpNumberJanId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJanInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJanId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"02\"),\n+              beneficiaryRecord.getEntitlementBuyInFebInd(),\n+              beneficiaryRecord.getFipsStateCntyFebCode(),\n+              beneficiaryRecord.getHmoIndicatorFebInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityFebCode(),\n+              beneficiaryRecord.getMedicareStatusFebCode(),\n+              beneficiaryRecord.getPartCContractNumberFebId(),\n+              beneficiaryRecord.getPartCPbpNumberFebId(),\n+              beneficiaryRecord.getPartCPlanTypeFebCode(),\n+              beneficiaryRecord.getPartDContractNumberFebId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupFebCode(),\n+              beneficiaryRecord.getPartDPbpNumberFebId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyFebInd(),\n+              beneficiaryRecord.getPartDSegmentNumberFebId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"03\"),\n+              beneficiaryRecord.getEntitlementBuyInMarInd(),\n+              beneficiaryRecord.getFipsStateCntyMarCode(),\n+              beneficiaryRecord.getHmoIndicatorMarInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMarCode(),\n+              beneficiaryRecord.getMedicareStatusMarCode(),\n+              beneficiaryRecord.getPartCContractNumberMarId(),\n+              beneficiaryRecord.getPartCPbpNumberMarId(),\n+              beneficiaryRecord.getPartCPlanTypeMarCode(),\n+              beneficiaryRecord.getPartDContractNumberMarId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMarCode(),\n+              beneficiaryRecord.getPartDPbpNumberMarId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMarInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMarId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"04\"),\n+              beneficiaryRecord.getEntitlementBuyInAprInd(),\n+              beneficiaryRecord.getFipsStateCntyAprCode(),\n+              beneficiaryRecord.getHmoIndicatorAprInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAprCode(),\n+              beneficiaryRecord.getMedicareStatusAprCode(),\n+              beneficiaryRecord.getPartCContractNumberAprId(),\n+              beneficiaryRecord.getPartCPbpNumberAprId(),\n+              beneficiaryRecord.getPartCPlanTypeAprCode(),\n+              beneficiaryRecord.getPartDContractNumberAprId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAprCode(),\n+              beneficiaryRecord.getPartDPbpNumberAprId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAprInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAprId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"05\"),\n+              beneficiaryRecord.getEntitlementBuyInMayInd(),\n+              beneficiaryRecord.getFipsStateCntyMayCode(),\n+              beneficiaryRecord.getHmoIndicatorMayInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMayCode(),\n+              beneficiaryRecord.getMedicareStatusMayCode(),\n+              beneficiaryRecord.getPartCContractNumberMayId(),\n+              beneficiaryRecord.getPartCPbpNumberMayId(),\n+              beneficiaryRecord.getPartCPlanTypeMayCode(),\n+              beneficiaryRecord.getPartDContractNumberMayId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMayCode(),\n+              beneficiaryRecord.getPartDPbpNumberMayId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMayInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMayId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"06\"),\n+              beneficiaryRecord.getEntitlementBuyInJunInd(),\n+              beneficiaryRecord.getFipsStateCntyJunCode(),\n+              beneficiaryRecord.getHmoIndicatorJunInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJunCode(),\n+              beneficiaryRecord.getMedicareStatusJunCode(),\n+              beneficiaryRecord.getPartCContractNumberJunId(),\n+              beneficiaryRecord.getPartCPbpNumberJunId(),\n+              beneficiaryRecord.getPartCPlanTypeJunCode(),\n+              beneficiaryRecord.getPartDContractNumberJunId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJunCode(),\n+              beneficiaryRecord.getPartDPbpNumberJunId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJunInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJunId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"07\"),\n+              beneficiaryRecord.getEntitlementBuyInJulInd(),\n+              beneficiaryRecord.getFipsStateCntyJulCode(),\n+              beneficiaryRecord.getHmoIndicatorJulInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJulCode(),\n+              beneficiaryRecord.getMedicareStatusJulCode(),\n+              beneficiaryRecord.getPartCContractNumberJulId(),\n+              beneficiaryRecord.getPartCPbpNumberJulId(),\n+              beneficiaryRecord.getPartCPlanTypeJulCode(),\n+              beneficiaryRecord.getPartDContractNumberJulId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJulCode(),\n+              beneficiaryRecord.getPartDPbpNumberJulId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJulInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJulId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"08\"),\n+              beneficiaryRecord.getEntitlementBuyInAugInd(),\n+              beneficiaryRecord.getFipsStateCntyAugCode(),\n+              beneficiaryRecord.getHmoIndicatorAugInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAugCode(),\n+              beneficiaryRecord.getMedicareStatusAugCode(),\n+              beneficiaryRecord.getPartCContractNumberAugId(),\n+              beneficiaryRecord.getPartCPbpNumberAugId(),\n+              beneficiaryRecord.getPartCPlanTypeAugCode(),\n+              beneficiaryRecord.getPartDContractNumberAugId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAugCode(),\n+              beneficiaryRecord.getPartDPbpNumberAugId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAugInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAugId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"09\"),\n+              beneficiaryRecord.getEntitlementBuyInSeptInd(),\n+              beneficiaryRecord.getFipsStateCntySeptCode(),\n+              beneficiaryRecord.getHmoIndicatorSeptInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilitySeptCode(),\n+              beneficiaryRecord.getMedicareStatusSeptCode(),\n+              beneficiaryRecord.getPartCContractNumberSeptId(),\n+              beneficiaryRecord.getPartCPbpNumberSeptId(),\n+              beneficiaryRecord.getPartCPlanTypeSeptCode(),\n+              beneficiaryRecord.getPartDContractNumberSeptId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupSeptCode(),\n+              beneficiaryRecord.getPartDPbpNumberSeptId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidySeptInd(),\n+              beneficiaryRecord.getPartDSegmentNumberSeptId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"10\"),\n+              beneficiaryRecord.getEntitlementBuyInOctInd(),\n+              beneficiaryRecord.getFipsStateCntyOctCode(),\n+              beneficiaryRecord.getHmoIndicatorOctInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityOctCode(),\n+              beneficiaryRecord.getMedicareStatusOctCode(),\n+              beneficiaryRecord.getPartCContractNumberOctId(),\n+              beneficiaryRecord.getPartCPbpNumberOctId(),\n+              beneficiaryRecord.getPartCPlanTypeOctCode(),\n+              beneficiaryRecord.getPartDContractNumberOctId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupOctCode(),\n+              beneficiaryRecord.getPartDPbpNumberOctId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyOctInd(),\n+              beneficiaryRecord.getPartDSegmentNumberOctId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"11\"),\n+              beneficiaryRecord.getEntitlementBuyInNovInd(),\n+              beneficiaryRecord.getFipsStateCntyNovCode(),\n+              beneficiaryRecord.getHmoIndicatorNovInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityNovCode(),\n+              beneficiaryRecord.getMedicareStatusNovCode(),\n+              beneficiaryRecord.getPartCContractNumberNovId(),\n+              beneficiaryRecord.getPartCPbpNumberNovId(),\n+              beneficiaryRecord.getPartCPlanTypeNovCode(),\n+              beneficiaryRecord.getPartDContractNumberNovId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupNovCode(),\n+              beneficiaryRecord.getPartDPbpNumberNovId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyNovInd(),\n+              beneficiaryRecord.getPartDSegmentNumberNovId()));\n+\n+      enrollments.add(\n+          getEnrollment(\n+              beneficiaryRecord,\n+              String.format(\"%s-%s\", date, \"12\"),\n+              beneficiaryRecord.getEntitlementBuyInDecInd(),\n+              beneficiaryRecord.getFipsStateCntyDecCode(),\n+              beneficiaryRecord.getHmoIndicatorDecInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityDecCode(),\n+              beneficiaryRecord.getMedicareStatusDecCode(),\n+              beneficiaryRecord.getPartCContractNumberDecId(),\n+              beneficiaryRecord.getPartCPbpNumberDecId(),\n+              beneficiaryRecord.getPartCPlanTypeDecCode(),\n+              beneficiaryRecord.getPartDContractNumberDecId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupDecCode(),\n+              beneficiaryRecord.getPartDPbpNumberDecId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyDecInd(),\n+              beneficiaryRecord.getPartDSegmentNumberDecId()));\n+\n+      beneficiaryRecord.setEnrollments(enrollments);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzNjI1OQ=="}, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 297}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjAxMDAzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo0ODowOVrOIGdGmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo0ODowOVrOIGdGmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzOTE5NQ==", "bodyText": "As mentioned above, I think you'll want to have several test cases here, covering the following scenarios:\n\nIf we insert a bene, do the resulting DB records have only the correct months' data populated, or does it end up with a lot of weird null-ish entries?\nIf we update a bene with the current year's data and just more months filled in, does the resulting Enrollments data look as expected?\nIf we update a bene with the current year's data and less months filled in (shouldn't happen but the schema allows it so we should ahndle it just in case), do the resulting DB records look as expected?\nIf we update a bene with a new year's data, is it appended to the previous years' data, or does it overwrite it?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r543639195", "createdAt": "2020-12-15T19:48:09Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -233,6 +234,8 @@ public void loadSampleU() {\n                     lastUpdated.after(Date.from(Instant.now().minus(1, ChronoUnit.MINUTES))));\n               });\n \n+      assertEnrollments(beneficiaryFromDb);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "193a5a91734bd370f5025699d00caf24b47bb77a"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODc1NzA2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMTo1NTozM1rOIJnH1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQyMjoxODo0OVrOIMDEWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk0OTA3Ng==", "bodyText": "Do you still have anything using this method?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r546949076", "createdAt": "2020-12-21T21:55:33Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -680,6 +743,262 @@ private static RifLoader createLoader(DataSource dataSource, boolean fixupsEnabl\n             defaultOptions.getFixupThreads()));\n   }\n \n+  public static void assertEnrollments(Beneficiary beneficiaryFromDb, int enrollmentSize) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUwNDA5MA==", "bodyText": "yes and added it in the test", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549504090", "createdAt": "2020-12-28T22:18:49Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -680,6 +743,262 @@ private static RifLoader createLoader(DataSource dataSource, boolean fixupsEnabl\n             defaultOptions.getFixupThreads()));\n   }\n \n+  public static void assertEnrollments(Beneficiary beneficiaryFromDb, int enrollmentSize) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk0OTA3Ng=="}, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODc1ODc5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMTo1NjowNlrOIJnIvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMzowMTozNFrOIKLq3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk0OTMwOQ==", "bodyText": "Other than assertEnrollments(...) above, do you have anything using this method?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r546949309", "createdAt": "2020-12-21T21:56:06Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -680,6 +743,262 @@ private static RifLoader createLoader(DataSource dataSource, boolean fixupsEnabl\n             defaultOptions.getFixupThreads()));\n   }\n \n+  public static void assertEnrollments(Beneficiary beneficiaryFromDb, int enrollmentSize) {\n+    List<Enrollment> enrollments = beneficiaryFromDb.getEnrollments();\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"01\",\n+        enrollments.get(0),\n+        beneficiaryFromDb.getEntitlementBuyInJanInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyJanCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorJanInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityJanCode().get(),\n+        beneficiaryFromDb.getMedicareStatusJanCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberJanId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberJanId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeJanCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberJanId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupJanCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberJanId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyJanInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberJanId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"02\",\n+        enrollments.get(1),\n+        beneficiaryFromDb.getEntitlementBuyInFebInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyFebCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorFebInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityFebCode().get(),\n+        beneficiaryFromDb.getMedicareStatusFebCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberFebId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberFebId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeFebCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberFebId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupFebCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberFebId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyFebInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberFebId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"03\",\n+        enrollments.get(2),\n+        beneficiaryFromDb.getEntitlementBuyInMarInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyMarCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorMarInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityMarCode().get(),\n+        beneficiaryFromDb.getMedicareStatusMarCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberMarId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberMarId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeMarCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberMarId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupMarCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberMarId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyMarInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberMarId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"04\",\n+        enrollments.get(3),\n+        beneficiaryFromDb.getEntitlementBuyInAprInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyAprCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorAprInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityAprCode().get(),\n+        beneficiaryFromDb.getMedicareStatusAprCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberAprId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberAprId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeAprCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberAprId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupAprCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberAprId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyAprInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberAprId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"05\",\n+        enrollments.get(4),\n+        beneficiaryFromDb.getEntitlementBuyInMayInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyMayCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorMayInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityMayCode().get(),\n+        beneficiaryFromDb.getMedicareStatusMayCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberMayId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberMayId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeMayCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberMayId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupMayCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberMayId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyMayInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberMayId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"06\",\n+        enrollments.get(5),\n+        beneficiaryFromDb.getEntitlementBuyInJunInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyJunCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorJunInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityJunCode().get(),\n+        beneficiaryFromDb.getMedicareStatusJunCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberJunId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberJunId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeJunCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberJunId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupJunCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberJunId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyJunInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberJunId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"07\",\n+        enrollments.get(6),\n+        beneficiaryFromDb.getEntitlementBuyInJulInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyJulCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorJulInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityJulCode().get(),\n+        beneficiaryFromDb.getMedicareStatusJulCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberJulId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberJulId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeJulCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberJulId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupJulCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberJulId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyJulInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberJulId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"08\",\n+        enrollments.get(7),\n+        beneficiaryFromDb.getEntitlementBuyInAugInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyAugCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorAugInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityAugCode().get(),\n+        beneficiaryFromDb.getMedicareStatusAugCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberAugId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberAugId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeAugCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberAugId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupAugCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberAugId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyAugInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberAugId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"09\",\n+        enrollments.get(8),\n+        beneficiaryFromDb.getEntitlementBuyInSeptInd().get(),\n+        beneficiaryFromDb.getFipsStateCntySeptCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorSeptInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilitySeptCode().get(),\n+        beneficiaryFromDb.getMedicareStatusSeptCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberSeptId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberSeptId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeSeptCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberSeptId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupSeptCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberSeptId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidySeptInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberSeptId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"10\",\n+        enrollments.get(9),\n+        beneficiaryFromDb.getEntitlementBuyInOctInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyOctCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorOctInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityOctCode().get(),\n+        beneficiaryFromDb.getMedicareStatusOctCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberOctId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberOctId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeOctCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberOctId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupOctCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberOctId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyOctInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberOctId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"11\",\n+        enrollments.get(10),\n+        beneficiaryFromDb.getEntitlementBuyInNovInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyNovCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorNovInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityNovCode().get(),\n+        beneficiaryFromDb.getMedicareStatusNovCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberNovId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberNovId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeNovCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberNovId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupNovCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberNovId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyNovInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberNovId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"12\",\n+        enrollments.get(11),\n+        beneficiaryFromDb.getEntitlementBuyInDecInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyDecCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorDecInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityDecCode().get(),\n+        beneficiaryFromDb.getMedicareStatusDecCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberDecId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberDecId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeDecCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberDecId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupDecCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberDecId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyDecInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberDecId().get());\n+  }\n+\n+  public static void checkEnrollments(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 301}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU0Nzg3MA==", "bodyText": "added it to the original 12 months", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r547547870", "createdAt": "2020-12-22T23:01:34Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -680,6 +743,262 @@ private static RifLoader createLoader(DataSource dataSource, boolean fixupsEnabl\n             defaultOptions.getFixupThreads()));\n   }\n \n+  public static void assertEnrollments(Beneficiary beneficiaryFromDb, int enrollmentSize) {\n+    List<Enrollment> enrollments = beneficiaryFromDb.getEnrollments();\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"01\",\n+        enrollments.get(0),\n+        beneficiaryFromDb.getEntitlementBuyInJanInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyJanCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorJanInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityJanCode().get(),\n+        beneficiaryFromDb.getMedicareStatusJanCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberJanId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberJanId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeJanCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberJanId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupJanCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberJanId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyJanInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberJanId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"02\",\n+        enrollments.get(1),\n+        beneficiaryFromDb.getEntitlementBuyInFebInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyFebCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorFebInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityFebCode().get(),\n+        beneficiaryFromDb.getMedicareStatusFebCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberFebId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberFebId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeFebCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberFebId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupFebCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberFebId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyFebInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberFebId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"03\",\n+        enrollments.get(2),\n+        beneficiaryFromDb.getEntitlementBuyInMarInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyMarCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorMarInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityMarCode().get(),\n+        beneficiaryFromDb.getMedicareStatusMarCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberMarId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberMarId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeMarCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberMarId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupMarCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberMarId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyMarInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberMarId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"04\",\n+        enrollments.get(3),\n+        beneficiaryFromDb.getEntitlementBuyInAprInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyAprCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorAprInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityAprCode().get(),\n+        beneficiaryFromDb.getMedicareStatusAprCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberAprId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberAprId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeAprCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberAprId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupAprCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberAprId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyAprInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberAprId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"05\",\n+        enrollments.get(4),\n+        beneficiaryFromDb.getEntitlementBuyInMayInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyMayCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorMayInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityMayCode().get(),\n+        beneficiaryFromDb.getMedicareStatusMayCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberMayId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberMayId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeMayCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberMayId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupMayCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberMayId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyMayInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberMayId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"06\",\n+        enrollments.get(5),\n+        beneficiaryFromDb.getEntitlementBuyInJunInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyJunCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorJunInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityJunCode().get(),\n+        beneficiaryFromDb.getMedicareStatusJunCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberJunId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberJunId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeJunCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberJunId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupJunCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberJunId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyJunInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberJunId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"07\",\n+        enrollments.get(6),\n+        beneficiaryFromDb.getEntitlementBuyInJulInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyJulCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorJulInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityJulCode().get(),\n+        beneficiaryFromDb.getMedicareStatusJulCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberJulId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberJulId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeJulCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberJulId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupJulCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberJulId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyJulInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberJulId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"08\",\n+        enrollments.get(7),\n+        beneficiaryFromDb.getEntitlementBuyInAugInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyAugCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorAugInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityAugCode().get(),\n+        beneficiaryFromDb.getMedicareStatusAugCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberAugId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberAugId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeAugCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberAugId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupAugCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberAugId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyAugInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberAugId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"09\",\n+        enrollments.get(8),\n+        beneficiaryFromDb.getEntitlementBuyInSeptInd().get(),\n+        beneficiaryFromDb.getFipsStateCntySeptCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorSeptInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilitySeptCode().get(),\n+        beneficiaryFromDb.getMedicareStatusSeptCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberSeptId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberSeptId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeSeptCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberSeptId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupSeptCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberSeptId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidySeptInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberSeptId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"10\",\n+        enrollments.get(9),\n+        beneficiaryFromDb.getEntitlementBuyInOctInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyOctCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorOctInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityOctCode().get(),\n+        beneficiaryFromDb.getMedicareStatusOctCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberOctId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberOctId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeOctCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberOctId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupOctCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberOctId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyOctInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberOctId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"11\",\n+        enrollments.get(10),\n+        beneficiaryFromDb.getEntitlementBuyInNovInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyNovCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorNovInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityNovCode().get(),\n+        beneficiaryFromDb.getMedicareStatusNovCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberNovId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberNovId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeNovCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberNovId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupNovCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberNovId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyNovInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberNovId().get());\n+\n+    checkEnrollments(\n+        beneficiaryFromDb.getBeneEnrollmentReferenceYear().get().toString(),\n+        \"12\",\n+        enrollments.get(11),\n+        beneficiaryFromDb.getEntitlementBuyInDecInd().get(),\n+        beneficiaryFromDb.getFipsStateCntyDecCode().get(),\n+        beneficiaryFromDb.getHmoIndicatorDecInd().get(),\n+        beneficiaryFromDb.getMedicaidDualEligibilityDecCode().get(),\n+        beneficiaryFromDb.getMedicareStatusDecCode().get(),\n+        beneficiaryFromDb.getPartCContractNumberDecId().get(),\n+        beneficiaryFromDb.getPartCPbpNumberDecId().get(),\n+        beneficiaryFromDb.getPartCPlanTypeDecCode().get(),\n+        beneficiaryFromDb.getPartDContractNumberDecId().get(),\n+        beneficiaryFromDb.getPartDLowIncomeCostShareGroupDecCode().get(),\n+        beneficiaryFromDb.getPartDPbpNumberDecId().get(),\n+        beneficiaryFromDb.getPartDRetireeDrugSubsidyDecInd().get(),\n+        beneficiaryFromDb.getPartDSegmentNumberDecId().get());\n+  }\n+\n+  public static void checkEnrollments(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk0OTMwOQ=="}, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 301}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODc3NDUxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjowMjoxOVrOIJnR3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjowMjoxOVrOIJnR3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk1MTY0Nw==", "bodyText": "Why this column type instead of an actual date type? I'd think an actual date type would make it easier to query against and work with, though I haven't thought about it too hard.\nI did some quick research, which you should absolutely double-check me on, and it looks like the general recommendation here is to use a date column with the day component pinned to 1.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r546951647", "createdAt": "2020-12-21T22:02:19Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_Enrollmenttable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"Enrollments\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" varchar(7) not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODc5NzE1OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjoxMDo0M1rOIJneaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNzowOToxOFrOIMIkNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk1NDg1OQ==", "bodyText": "I can't quite work out in my head if your logic above will correctly handle adding a month or two of data to the current year correctly...\nYou don't really have test coverage for that, so I'd suggest adding it. Maybe just as another step in this test case: what happens when one of the fields moves up to having ten months of data?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r546954859", "createdAt": "2020-12-21T22:10:43Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -316,6 +317,68 @@ public void loadSampleUUnchanged() {\n       if (entityManager != null) entityManager.close();\n     }\n   }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount12() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(12, beneficiaryFromDb.getEnrollments().size());\n+\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount24() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_U.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(24, beneficiaryFromDb.getEnrollments().size());\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount20SinceThereIsAUpdateOf8Months() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUwNDI5Nw==", "bodyText": "talked about if it makes sense to leave it this way with karl", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549504297", "createdAt": "2020-12-28T22:19:48Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -316,6 +317,68 @@ public void loadSampleUUnchanged() {\n       if (entityManager != null) entityManager.close();\n     }\n   }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount12() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(12, beneficiaryFromDb.getEnrollments().size());\n+\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount24() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_U.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(24, beneficiaryFromDb.getEnrollments().size());\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount20SinceThereIsAUpdateOf8Months() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk1NDg1OQ=="}, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MjAwOQ==", "bodyText": "I think I said something like, \"if I were you and could reason my way to having a lot of confidence in the above logic, I might skip adding the test -- otherwise, I'd double-check myself by adding a test case for it: what happens when we go from having just monthly data for 2020-01 to also having the data for 2020-02?\"", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549562009", "createdAt": "2020-12-29T04:16:25Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -316,6 +317,68 @@ public void loadSampleUUnchanged() {\n       if (entityManager != null) entityManager.close();\n     }\n   }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount12() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(12, beneficiaryFromDb.getEnrollments().size());\n+\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount24() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_U.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(24, beneficiaryFromDb.getEnrollments().size());\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount20SinceThereIsAUpdateOf8Months() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk1NDg1OQ=="}, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDE2Nw==", "bodyText": "added an extra test for august to sept and how the file in sept could update fields in august.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549594167", "createdAt": "2020-12-29T07:09:18Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -316,6 +317,68 @@ public void loadSampleUUnchanged() {\n       if (entityManager != null) entityManager.close();\n     }\n   }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount12() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(12, beneficiaryFromDb.getEnrollments().size());\n+\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount24() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_U.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(24, beneficiaryFromDb.getEnrollments().size());\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount20SinceThereIsAUpdateOf8Months() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk1NDg1OQ=="}, "originalCommit": {"oid": "e6b8b6ef44e33a316033f02da5f3c177b2e7c612"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg1NTg5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_BeneficiaryMonthlytable.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzo0NDowN1rOIMGUFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzo0NDowN1rOIMGUFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NzI3MQ==", "bodyText": "This file can't be in both PRs, but does appear to be. You should remove it.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549557271", "createdAt": "2020-12-29T03:44:07Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_BeneficiaryMonthlytable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg1OTkxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzo0NzozNlrOIMGWBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMzowMDo0NVrOIMaEMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1Nzc2Ng==", "bodyText": "Did the auto-formatter get run on this? If so, it behaved a bit goofy here.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549557766", "createdAt": "2020-12-29T03:47:36Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -511,23 +536,40 @@ private TypeSpec generateLineEntity(MappingSpec mappingSpec) throws IOException\n \n       FieldSpec lineField =\n           FieldSpec.builder(\n-                  selectJavaFieldType(rifField), rifField.getJavaFieldName(), Modifier.PRIVATE)\n+                  selectJavaFieldType(\n+                      rifField.getRifColumnType(),\n+                      rifField.isRifColumnOptional(),\n+                      rifField.getRifColumnLength(),\n+                      rifField.getRifColumnScale()),\n+                  rifField.getJavaFieldName(),\n+                  Modifier.PRIVATE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 160}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg4MDg4MQ==", "bodyText": "yea it did", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549880881", "createdAt": "2020-12-29T23:00:45Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -511,23 +536,40 @@ private TypeSpec generateLineEntity(MappingSpec mappingSpec) throws IOException\n \n       FieldSpec lineField =\n           FieldSpec.builder(\n-                  selectJavaFieldType(rifField), rifField.getJavaFieldName(), Modifier.PRIVATE)\n+                  selectJavaFieldType(\n+                      rifField.getRifColumnType(),\n+                      rifField.isRifColumnOptional(),\n+                      rifField.getRifColumnLength(),\n+                      rifField.getRifColumnScale()),\n+                  rifField.getJavaFieldName(),\n+                  Modifier.PRIVATE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1Nzc2Ng=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 160}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg2MTYxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzo0OTowNFrOIMGW3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNTowMToyNlrOIMHAOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1Nzk4Mw==", "bodyText": "I think the JavaDoc links here are broken. I just ctrl+f'd for \"enroll\" to see what came up and found them.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549557983", "createdAt": "2020-12-29T03:49:04Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "diffHunk": "@@ -218,6 +242,16 @@ public String getLineEntityParentField() {\n     return \"parentClaim\";\n   }\n \n+  /**\n+   * @return the name of the field in the {@link #getEnrollmentEntity()} {@link Entity} that should\n+   *     be used to store and refer to the child {@link #getEnrollmentEntity()} {@link Entity}s, if", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2ODU3MA==", "bodyText": "Changed to parentbeneficiary", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549568570", "createdAt": "2020-12-29T05:01:26Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "diffHunk": "@@ -218,6 +242,16 @@ public String getLineEntityParentField() {\n     return \"parentClaim\";\n   }\n \n+  /**\n+   * @return the name of the field in the {@link #getEnrollmentEntity()} {@link Entity} that should\n+   *     be used to store and refer to the child {@link #getEnrollmentEntity()} {@link Entity}s, if", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1Nzk4Mw=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg2MjA4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzo0OToyM1rOIMGXGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNToxMjo0NVrOIMHGxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1ODA0MA==", "bodyText": "I think the JavaDoc link here is broken. I just ctrl+f'd for \"enroll\" to see what came up and found it.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549558040", "createdAt": "2020-12-29T03:49:23Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "diffHunk": "@@ -227,6 +261,15 @@ public String getLineEntityLineNumberField() {\n     return \"lineNumber\";\n   }\n \n+  /**\n+   * @return the name of the field in the {@link #getEntityEnrollmentField()} {@link Entity} that", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3MDI0NQ==", "bodyText": "changed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549570245", "createdAt": "2020-12-29T05:12:45Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "diffHunk": "@@ -227,6 +261,15 @@ public String getLineEntityLineNumberField() {\n     return \"lineNumber\";\n   }\n \n+  /**\n+   * @return the name of the field in the {@link #getEntityEnrollmentField()} {@link Entity} that", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1ODA0MA=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg3OTUwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDowNDoyMlrOIMGfvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNToxMjozOVrOIMHGtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDI1NA==", "bodyText": "FWIW, I'd suggest JavaDoc'ing this, as it's not entirely obvious what some of those parameters mean (I can never quite remember what scale means, for instance).", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549560254", "createdAt": "2020-12-29T04:04:22Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  private static TypeName selectJavaFieldType(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 750}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3MDIzMA==", "bodyText": "added", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549570230", "createdAt": "2020-12-29T05:12:39Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  private static TypeName selectJavaFieldType(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDI1NA=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 750}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg3OTg0OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDowNDozN1rOIMGf6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDowNDozN1rOIMGf6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDI5OQ==", "bodyText": "FWIW, I'd suggest JavaDoc'ing this, as it's not entirely obvious what some of those parameters mean (I can never quite remember what scale means, for instance).", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549560299", "createdAt": "2020-12-29T04:04:37Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 682}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg3OTk2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDowNDo0OFrOIMGf-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNzozNTo0MlrOIMx7_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDMxMw==", "bodyText": "FWIW, I'd suggest JavaDoc'ing this, as it's not entirely obvious what some of those parameters mean (I can never quite remember what scale means, for instance).", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549560313", "createdAt": "2020-12-29T04:04:48Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 638}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2OTgxNQ==", "bodyText": "added", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549569815", "createdAt": "2020-12-29T05:09:46Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDMxMw=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 638}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI3MTk5Ng==", "bodyText": "This is helpful.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r550271996", "createdAt": "2020-12-30T17:35:42Z", "author": {"login": "jzulim"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDMxMw=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 638}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg4MDIzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDowNTowMFrOIMGgGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNToxMzowNFrOIMHG-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDM0Nw==", "bodyText": "FWIW, I'd suggest JavaDoc'ing this, as it's not entirely obvious what some of those parameters mean (I can never quite remember what scale means, for instance).", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549560347", "createdAt": "2020-12-29T04:05:00Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  private static TypeName selectJavaFieldType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && !isColumnOptional) return TypeName.CHAR;\n+    else if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && isColumnOptional) return ClassName.get(Character.class);\n+    else if (type == RifColumnType.CHAR) return ClassName.get(String.class);\n+    else if (type == RifColumnType.DATE && columnLength.orElse(0) == 8)\n+      return ClassName.get(LocalDate.class);\n+    else if (type == RifColumnType.TIMESTAMP && columnLength.orElse(0) == 20)\n+      return ClassName.get(Instant.class);\n+    else if (type == RifColumnType.NUM && columnScale.orElse(Integer.MAX_VALUE) > 0)\n+      return ClassName.get(BigDecimal.class);\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && !isColumnOptional) return TypeName.INT;\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && isColumnOptional) return ClassName.get(Integer.class);\n+    else throw new IllegalArgumentException(\"Unhandled field type: \" + type.name());\n+  }\n+\n+  private static TypeName selectJavaPropertyType(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 777}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3MDI5OA==", "bodyText": "added", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549570298", "createdAt": "2020-12-29T05:13:04Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,156 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  private static TypeName selectJavaFieldType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && !isColumnOptional) return TypeName.CHAR;\n+    else if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && isColumnOptional) return ClassName.get(Character.class);\n+    else if (type == RifColumnType.CHAR) return ClassName.get(String.class);\n+    else if (type == RifColumnType.DATE && columnLength.orElse(0) == 8)\n+      return ClassName.get(LocalDate.class);\n+    else if (type == RifColumnType.TIMESTAMP && columnLength.orElse(0) == 20)\n+      return ClassName.get(Instant.class);\n+    else if (type == RifColumnType.NUM && columnScale.orElse(Integer.MAX_VALUE) > 0)\n+      return ClassName.get(BigDecimal.class);\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && !isColumnOptional) return TypeName.INT;\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && isColumnOptional) return ClassName.get(Integer.class);\n+    else throw new IllegalArgumentException(\"Unhandled field type: \" + type.name());\n+  }\n+\n+  private static TypeName selectJavaPropertyType(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDM0Nw=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 777}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg4NTY2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDowOToxMVrOIMGivQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDo1NTo0NlrOIMG8wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MTAyMQ==", "bodyText": "FWIW, you don't need this if -- the for loop just won't run if the list is empty.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549561021", "createdAt": "2020-12-29T04:09:11Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -596,6 +614,313 @@ private void processAsync(\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link BeneficiaryMonthly} record is created or updated for the specified {@link\n+   * Beneficiary}, if that {@link Beneficiary} already exists and is just being updated.\n+   *\n+   * @param entityManager the {@link EntityManager} to use\n+   * @param loadAction the {@link Loadaction} record being processed\n+   * @param beneficiaryRecord the {@link Beneficiary} record being processed\n+   */\n+  private static void updateBeneficiaryMonthly(\n+      EntityManager entityManager, Beneficiary beneficiaryRecord) {\n+\n+    if (beneficiaryRecord.getBeneEnrollmentReferenceYear().isPresent()) {\n+\n+      int year = beneficiaryRecord.getBeneEnrollmentReferenceYear().get().intValue();\n+      List<BeneficiaryMonthly> currentYearBeneficiaryMonthly = new ArrayList<BeneficiaryMonthly>();\n+\n+      BeneficiaryMonthly beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 1, 1),\n+              beneficiaryRecord.getEntitlementBuyInJanInd(),\n+              beneficiaryRecord.getFipsStateCntyJanCode(),\n+              beneficiaryRecord.getHmoIndicatorJanInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJanCode(),\n+              beneficiaryRecord.getMedicareStatusJanCode(),\n+              beneficiaryRecord.getPartCContractNumberJanId(),\n+              beneficiaryRecord.getPartCPbpNumberJanId(),\n+              beneficiaryRecord.getPartCPlanTypeJanCode(),\n+              beneficiaryRecord.getPartDContractNumberJanId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJanCode(),\n+              beneficiaryRecord.getPartDPbpNumberJanId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJanInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJanId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 2, 1),\n+              beneficiaryRecord.getEntitlementBuyInFebInd(),\n+              beneficiaryRecord.getFipsStateCntyFebCode(),\n+              beneficiaryRecord.getHmoIndicatorFebInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityFebCode(),\n+              beneficiaryRecord.getMedicareStatusFebCode(),\n+              beneficiaryRecord.getPartCContractNumberFebId(),\n+              beneficiaryRecord.getPartCPbpNumberFebId(),\n+              beneficiaryRecord.getPartCPlanTypeFebCode(),\n+              beneficiaryRecord.getPartDContractNumberFebId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupFebCode(),\n+              beneficiaryRecord.getPartDPbpNumberFebId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyFebInd(),\n+              beneficiaryRecord.getPartDSegmentNumberFebId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 3, 1),\n+              beneficiaryRecord.getEntitlementBuyInMarInd(),\n+              beneficiaryRecord.getFipsStateCntyMarCode(),\n+              beneficiaryRecord.getHmoIndicatorMarInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMarCode(),\n+              beneficiaryRecord.getMedicareStatusMarCode(),\n+              beneficiaryRecord.getPartCContractNumberMarId(),\n+              beneficiaryRecord.getPartCPbpNumberMarId(),\n+              beneficiaryRecord.getPartCPlanTypeMarCode(),\n+              beneficiaryRecord.getPartDContractNumberMarId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMarCode(),\n+              beneficiaryRecord.getPartDPbpNumberMarId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMarInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMarId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 4, 1),\n+              beneficiaryRecord.getEntitlementBuyInAprInd(),\n+              beneficiaryRecord.getFipsStateCntyAprCode(),\n+              beneficiaryRecord.getHmoIndicatorAprInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAprCode(),\n+              beneficiaryRecord.getMedicareStatusAprCode(),\n+              beneficiaryRecord.getPartCContractNumberAprId(),\n+              beneficiaryRecord.getPartCPbpNumberAprId(),\n+              beneficiaryRecord.getPartCPlanTypeAprCode(),\n+              beneficiaryRecord.getPartDContractNumberAprId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAprCode(),\n+              beneficiaryRecord.getPartDPbpNumberAprId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAprInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAprId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 5, 1),\n+              beneficiaryRecord.getEntitlementBuyInMayInd(),\n+              beneficiaryRecord.getFipsStateCntyMayCode(),\n+              beneficiaryRecord.getHmoIndicatorMayInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMayCode(),\n+              beneficiaryRecord.getMedicareStatusMayCode(),\n+              beneficiaryRecord.getPartCContractNumberMayId(),\n+              beneficiaryRecord.getPartCPbpNumberMayId(),\n+              beneficiaryRecord.getPartCPlanTypeMayCode(),\n+              beneficiaryRecord.getPartDContractNumberMayId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMayCode(),\n+              beneficiaryRecord.getPartDPbpNumberMayId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMayInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMayId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 6, 1),\n+              beneficiaryRecord.getEntitlementBuyInJunInd(),\n+              beneficiaryRecord.getFipsStateCntyJunCode(),\n+              beneficiaryRecord.getHmoIndicatorJunInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJunCode(),\n+              beneficiaryRecord.getMedicareStatusJunCode(),\n+              beneficiaryRecord.getPartCContractNumberJunId(),\n+              beneficiaryRecord.getPartCPbpNumberJunId(),\n+              beneficiaryRecord.getPartCPlanTypeJunCode(),\n+              beneficiaryRecord.getPartDContractNumberJunId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJunCode(),\n+              beneficiaryRecord.getPartDPbpNumberJunId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJunInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJunId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 7, 1),\n+              beneficiaryRecord.getEntitlementBuyInJulInd(),\n+              beneficiaryRecord.getFipsStateCntyJulCode(),\n+              beneficiaryRecord.getHmoIndicatorJulInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJulCode(),\n+              beneficiaryRecord.getMedicareStatusJulCode(),\n+              beneficiaryRecord.getPartCContractNumberJulId(),\n+              beneficiaryRecord.getPartCPbpNumberJulId(),\n+              beneficiaryRecord.getPartCPlanTypeJulCode(),\n+              beneficiaryRecord.getPartDContractNumberJulId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJulCode(),\n+              beneficiaryRecord.getPartDPbpNumberJulId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJulInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJulId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 8, 1),\n+              beneficiaryRecord.getEntitlementBuyInAugInd(),\n+              beneficiaryRecord.getFipsStateCntyAugCode(),\n+              beneficiaryRecord.getHmoIndicatorAugInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAugCode(),\n+              beneficiaryRecord.getMedicareStatusAugCode(),\n+              beneficiaryRecord.getPartCContractNumberAugId(),\n+              beneficiaryRecord.getPartCPbpNumberAugId(),\n+              beneficiaryRecord.getPartCPlanTypeAugCode(),\n+              beneficiaryRecord.getPartDContractNumberAugId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAugCode(),\n+              beneficiaryRecord.getPartDPbpNumberAugId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAugInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAugId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 9, 1),\n+              beneficiaryRecord.getEntitlementBuyInSeptInd(),\n+              beneficiaryRecord.getFipsStateCntySeptCode(),\n+              beneficiaryRecord.getHmoIndicatorSeptInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilitySeptCode(),\n+              beneficiaryRecord.getMedicareStatusSeptCode(),\n+              beneficiaryRecord.getPartCContractNumberSeptId(),\n+              beneficiaryRecord.getPartCPbpNumberSeptId(),\n+              beneficiaryRecord.getPartCPlanTypeSeptCode(),\n+              beneficiaryRecord.getPartDContractNumberSeptId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupSeptCode(),\n+              beneficiaryRecord.getPartDPbpNumberSeptId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidySeptInd(),\n+              beneficiaryRecord.getPartDSegmentNumberSeptId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 10, 1),\n+              beneficiaryRecord.getEntitlementBuyInOctInd(),\n+              beneficiaryRecord.getFipsStateCntyOctCode(),\n+              beneficiaryRecord.getHmoIndicatorOctInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityOctCode(),\n+              beneficiaryRecord.getMedicareStatusOctCode(),\n+              beneficiaryRecord.getPartCContractNumberOctId(),\n+              beneficiaryRecord.getPartCPbpNumberOctId(),\n+              beneficiaryRecord.getPartCPlanTypeOctCode(),\n+              beneficiaryRecord.getPartDContractNumberOctId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupOctCode(),\n+              beneficiaryRecord.getPartDPbpNumberOctId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyOctInd(),\n+              beneficiaryRecord.getPartDSegmentNumberOctId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 11, 1),\n+              beneficiaryRecord.getEntitlementBuyInNovInd(),\n+              beneficiaryRecord.getFipsStateCntyNovCode(),\n+              beneficiaryRecord.getHmoIndicatorNovInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityNovCode(),\n+              beneficiaryRecord.getMedicareStatusNovCode(),\n+              beneficiaryRecord.getPartCContractNumberNovId(),\n+              beneficiaryRecord.getPartCPbpNumberNovId(),\n+              beneficiaryRecord.getPartCPlanTypeNovCode(),\n+              beneficiaryRecord.getPartDContractNumberNovId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupNovCode(),\n+              beneficiaryRecord.getPartDPbpNumberNovId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyNovInd(),\n+              beneficiaryRecord.getPartDSegmentNumberNovId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 12, 1),\n+              beneficiaryRecord.getEntitlementBuyInDecInd(),\n+              beneficiaryRecord.getFipsStateCntyDecCode(),\n+              beneficiaryRecord.getHmoIndicatorDecInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityDecCode(),\n+              beneficiaryRecord.getMedicareStatusDecCode(),\n+              beneficiaryRecord.getPartCContractNumberDecId(),\n+              beneficiaryRecord.getPartCPbpNumberDecId(),\n+              beneficiaryRecord.getPartCPlanTypeDecCode(),\n+              beneficiaryRecord.getPartDContractNumberDecId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupDecCode(),\n+              beneficiaryRecord.getPartDPbpNumberDecId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyDecInd(),\n+              beneficiaryRecord.getPartDSegmentNumberDecId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      if (currentYearBeneficiaryMonthly.size() > 0) {\n+        List<BeneficiaryMonthly> currentBeneficiaryMonthlyWithUpdates;\n+\n+        Beneficiary beneficiaryFromDb =\n+            entityManager.find(Beneficiary.class, beneficiaryRecord.getBeneficiaryId());\n+\n+        if (beneficiaryFromDb != null && beneficiaryFromDb.getBeneficiaryMonthlys().size() > 0) {\n+          currentBeneficiaryMonthlyWithUpdates = beneficiaryFromDb.getBeneficiaryMonthlys();\n+          List<BeneficiaryMonthly> currentYearBeneficiaryMonthlyPrevious =\n+              beneficiaryFromDb.getBeneficiaryMonthlys().stream()\n+                  .filter(e -> year == e.getYearMonth().getYear())\n+                  .collect(Collectors.toList());\n+\n+          if (currentYearBeneficiaryMonthlyPrevious.size() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 364}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NzY4MQ==", "bodyText": "Changed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549567681", "createdAt": "2020-12-29T04:55:46Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -596,6 +614,313 @@ private void processAsync(\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link BeneficiaryMonthly} record is created or updated for the specified {@link\n+   * Beneficiary}, if that {@link Beneficiary} already exists and is just being updated.\n+   *\n+   * @param entityManager the {@link EntityManager} to use\n+   * @param loadAction the {@link Loadaction} record being processed\n+   * @param beneficiaryRecord the {@link Beneficiary} record being processed\n+   */\n+  private static void updateBeneficiaryMonthly(\n+      EntityManager entityManager, Beneficiary beneficiaryRecord) {\n+\n+    if (beneficiaryRecord.getBeneEnrollmentReferenceYear().isPresent()) {\n+\n+      int year = beneficiaryRecord.getBeneEnrollmentReferenceYear().get().intValue();\n+      List<BeneficiaryMonthly> currentYearBeneficiaryMonthly = new ArrayList<BeneficiaryMonthly>();\n+\n+      BeneficiaryMonthly beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 1, 1),\n+              beneficiaryRecord.getEntitlementBuyInJanInd(),\n+              beneficiaryRecord.getFipsStateCntyJanCode(),\n+              beneficiaryRecord.getHmoIndicatorJanInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJanCode(),\n+              beneficiaryRecord.getMedicareStatusJanCode(),\n+              beneficiaryRecord.getPartCContractNumberJanId(),\n+              beneficiaryRecord.getPartCPbpNumberJanId(),\n+              beneficiaryRecord.getPartCPlanTypeJanCode(),\n+              beneficiaryRecord.getPartDContractNumberJanId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJanCode(),\n+              beneficiaryRecord.getPartDPbpNumberJanId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJanInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJanId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 2, 1),\n+              beneficiaryRecord.getEntitlementBuyInFebInd(),\n+              beneficiaryRecord.getFipsStateCntyFebCode(),\n+              beneficiaryRecord.getHmoIndicatorFebInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityFebCode(),\n+              beneficiaryRecord.getMedicareStatusFebCode(),\n+              beneficiaryRecord.getPartCContractNumberFebId(),\n+              beneficiaryRecord.getPartCPbpNumberFebId(),\n+              beneficiaryRecord.getPartCPlanTypeFebCode(),\n+              beneficiaryRecord.getPartDContractNumberFebId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupFebCode(),\n+              beneficiaryRecord.getPartDPbpNumberFebId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyFebInd(),\n+              beneficiaryRecord.getPartDSegmentNumberFebId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 3, 1),\n+              beneficiaryRecord.getEntitlementBuyInMarInd(),\n+              beneficiaryRecord.getFipsStateCntyMarCode(),\n+              beneficiaryRecord.getHmoIndicatorMarInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMarCode(),\n+              beneficiaryRecord.getMedicareStatusMarCode(),\n+              beneficiaryRecord.getPartCContractNumberMarId(),\n+              beneficiaryRecord.getPartCPbpNumberMarId(),\n+              beneficiaryRecord.getPartCPlanTypeMarCode(),\n+              beneficiaryRecord.getPartDContractNumberMarId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMarCode(),\n+              beneficiaryRecord.getPartDPbpNumberMarId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMarInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMarId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 4, 1),\n+              beneficiaryRecord.getEntitlementBuyInAprInd(),\n+              beneficiaryRecord.getFipsStateCntyAprCode(),\n+              beneficiaryRecord.getHmoIndicatorAprInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAprCode(),\n+              beneficiaryRecord.getMedicareStatusAprCode(),\n+              beneficiaryRecord.getPartCContractNumberAprId(),\n+              beneficiaryRecord.getPartCPbpNumberAprId(),\n+              beneficiaryRecord.getPartCPlanTypeAprCode(),\n+              beneficiaryRecord.getPartDContractNumberAprId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAprCode(),\n+              beneficiaryRecord.getPartDPbpNumberAprId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAprInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAprId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 5, 1),\n+              beneficiaryRecord.getEntitlementBuyInMayInd(),\n+              beneficiaryRecord.getFipsStateCntyMayCode(),\n+              beneficiaryRecord.getHmoIndicatorMayInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMayCode(),\n+              beneficiaryRecord.getMedicareStatusMayCode(),\n+              beneficiaryRecord.getPartCContractNumberMayId(),\n+              beneficiaryRecord.getPartCPbpNumberMayId(),\n+              beneficiaryRecord.getPartCPlanTypeMayCode(),\n+              beneficiaryRecord.getPartDContractNumberMayId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMayCode(),\n+              beneficiaryRecord.getPartDPbpNumberMayId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMayInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMayId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 6, 1),\n+              beneficiaryRecord.getEntitlementBuyInJunInd(),\n+              beneficiaryRecord.getFipsStateCntyJunCode(),\n+              beneficiaryRecord.getHmoIndicatorJunInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJunCode(),\n+              beneficiaryRecord.getMedicareStatusJunCode(),\n+              beneficiaryRecord.getPartCContractNumberJunId(),\n+              beneficiaryRecord.getPartCPbpNumberJunId(),\n+              beneficiaryRecord.getPartCPlanTypeJunCode(),\n+              beneficiaryRecord.getPartDContractNumberJunId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJunCode(),\n+              beneficiaryRecord.getPartDPbpNumberJunId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJunInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJunId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 7, 1),\n+              beneficiaryRecord.getEntitlementBuyInJulInd(),\n+              beneficiaryRecord.getFipsStateCntyJulCode(),\n+              beneficiaryRecord.getHmoIndicatorJulInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJulCode(),\n+              beneficiaryRecord.getMedicareStatusJulCode(),\n+              beneficiaryRecord.getPartCContractNumberJulId(),\n+              beneficiaryRecord.getPartCPbpNumberJulId(),\n+              beneficiaryRecord.getPartCPlanTypeJulCode(),\n+              beneficiaryRecord.getPartDContractNumberJulId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJulCode(),\n+              beneficiaryRecord.getPartDPbpNumberJulId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJulInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJulId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 8, 1),\n+              beneficiaryRecord.getEntitlementBuyInAugInd(),\n+              beneficiaryRecord.getFipsStateCntyAugCode(),\n+              beneficiaryRecord.getHmoIndicatorAugInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAugCode(),\n+              beneficiaryRecord.getMedicareStatusAugCode(),\n+              beneficiaryRecord.getPartCContractNumberAugId(),\n+              beneficiaryRecord.getPartCPbpNumberAugId(),\n+              beneficiaryRecord.getPartCPlanTypeAugCode(),\n+              beneficiaryRecord.getPartDContractNumberAugId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAugCode(),\n+              beneficiaryRecord.getPartDPbpNumberAugId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAugInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAugId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 9, 1),\n+              beneficiaryRecord.getEntitlementBuyInSeptInd(),\n+              beneficiaryRecord.getFipsStateCntySeptCode(),\n+              beneficiaryRecord.getHmoIndicatorSeptInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilitySeptCode(),\n+              beneficiaryRecord.getMedicareStatusSeptCode(),\n+              beneficiaryRecord.getPartCContractNumberSeptId(),\n+              beneficiaryRecord.getPartCPbpNumberSeptId(),\n+              beneficiaryRecord.getPartCPlanTypeSeptCode(),\n+              beneficiaryRecord.getPartDContractNumberSeptId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupSeptCode(),\n+              beneficiaryRecord.getPartDPbpNumberSeptId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidySeptInd(),\n+              beneficiaryRecord.getPartDSegmentNumberSeptId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 10, 1),\n+              beneficiaryRecord.getEntitlementBuyInOctInd(),\n+              beneficiaryRecord.getFipsStateCntyOctCode(),\n+              beneficiaryRecord.getHmoIndicatorOctInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityOctCode(),\n+              beneficiaryRecord.getMedicareStatusOctCode(),\n+              beneficiaryRecord.getPartCContractNumberOctId(),\n+              beneficiaryRecord.getPartCPbpNumberOctId(),\n+              beneficiaryRecord.getPartCPlanTypeOctCode(),\n+              beneficiaryRecord.getPartDContractNumberOctId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupOctCode(),\n+              beneficiaryRecord.getPartDPbpNumberOctId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyOctInd(),\n+              beneficiaryRecord.getPartDSegmentNumberOctId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 11, 1),\n+              beneficiaryRecord.getEntitlementBuyInNovInd(),\n+              beneficiaryRecord.getFipsStateCntyNovCode(),\n+              beneficiaryRecord.getHmoIndicatorNovInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityNovCode(),\n+              beneficiaryRecord.getMedicareStatusNovCode(),\n+              beneficiaryRecord.getPartCContractNumberNovId(),\n+              beneficiaryRecord.getPartCPbpNumberNovId(),\n+              beneficiaryRecord.getPartCPlanTypeNovCode(),\n+              beneficiaryRecord.getPartDContractNumberNovId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupNovCode(),\n+              beneficiaryRecord.getPartDPbpNumberNovId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyNovInd(),\n+              beneficiaryRecord.getPartDSegmentNumberNovId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 12, 1),\n+              beneficiaryRecord.getEntitlementBuyInDecInd(),\n+              beneficiaryRecord.getFipsStateCntyDecCode(),\n+              beneficiaryRecord.getHmoIndicatorDecInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityDecCode(),\n+              beneficiaryRecord.getMedicareStatusDecCode(),\n+              beneficiaryRecord.getPartCContractNumberDecId(),\n+              beneficiaryRecord.getPartCPbpNumberDecId(),\n+              beneficiaryRecord.getPartCPlanTypeDecCode(),\n+              beneficiaryRecord.getPartDContractNumberDecId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupDecCode(),\n+              beneficiaryRecord.getPartDPbpNumberDecId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyDecInd(),\n+              beneficiaryRecord.getPartDSegmentNumberDecId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      if (currentYearBeneficiaryMonthly.size() > 0) {\n+        List<BeneficiaryMonthly> currentBeneficiaryMonthlyWithUpdates;\n+\n+        Beneficiary beneficiaryFromDb =\n+            entityManager.find(Beneficiary.class, beneficiaryRecord.getBeneficiaryId());\n+\n+        if (beneficiaryFromDb != null && beneficiaryFromDb.getBeneficiaryMonthlys().size() > 0) {\n+          currentBeneficiaryMonthlyWithUpdates = beneficiaryFromDb.getBeneficiaryMonthlys();\n+          List<BeneficiaryMonthly> currentYearBeneficiaryMonthlyPrevious =\n+              beneficiaryFromDb.getBeneficiaryMonthlys().stream()\n+                  .filter(e -> year == e.getYearMonth().getYear())\n+                  .collect(Collectors.toList());\n+\n+          if (currentYearBeneficiaryMonthlyPrevious.size() > 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MTAyMQ=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 364}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg4ODc4OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDoxMjozNlrOIMGkZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNToxNDoyMlrOIMHH0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MTQ0Ng==", "bodyText": "I'm tired and can't quite think my way through it, but I think this might open us up to a race condition if we ever got a RIF file that listed the same bene multiople times? CSV records are processed in parallel, so there's a chance that you have two threads working on and trying to update the same bene record at the same time.\nThat'd be weird and bad, but perhaps worth thinking about and at least adding a \"TODO enforce RIF invariant elsewhere: no repeats of same record/PK in same RIF file allowed\".", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549561446", "createdAt": "2020-12-29T04:12:36Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -596,6 +614,313 @@ private void processAsync(\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link BeneficiaryMonthly} record is created or updated for the specified {@link\n+   * Beneficiary}, if that {@link Beneficiary} already exists and is just being updated.\n+   *\n+   * @param entityManager the {@link EntityManager} to use\n+   * @param loadAction the {@link Loadaction} record being processed\n+   * @param beneficiaryRecord the {@link Beneficiary} record being processed\n+   */\n+  private static void updateBeneficiaryMonthly(\n+      EntityManager entityManager, Beneficiary beneficiaryRecord) {\n+\n+    if (beneficiaryRecord.getBeneEnrollmentReferenceYear().isPresent()) {\n+\n+      int year = beneficiaryRecord.getBeneEnrollmentReferenceYear().get().intValue();\n+      List<BeneficiaryMonthly> currentYearBeneficiaryMonthly = new ArrayList<BeneficiaryMonthly>();\n+\n+      BeneficiaryMonthly beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 1, 1),\n+              beneficiaryRecord.getEntitlementBuyInJanInd(),\n+              beneficiaryRecord.getFipsStateCntyJanCode(),\n+              beneficiaryRecord.getHmoIndicatorJanInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJanCode(),\n+              beneficiaryRecord.getMedicareStatusJanCode(),\n+              beneficiaryRecord.getPartCContractNumberJanId(),\n+              beneficiaryRecord.getPartCPbpNumberJanId(),\n+              beneficiaryRecord.getPartCPlanTypeJanCode(),\n+              beneficiaryRecord.getPartDContractNumberJanId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJanCode(),\n+              beneficiaryRecord.getPartDPbpNumberJanId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJanInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJanId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 2, 1),\n+              beneficiaryRecord.getEntitlementBuyInFebInd(),\n+              beneficiaryRecord.getFipsStateCntyFebCode(),\n+              beneficiaryRecord.getHmoIndicatorFebInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityFebCode(),\n+              beneficiaryRecord.getMedicareStatusFebCode(),\n+              beneficiaryRecord.getPartCContractNumberFebId(),\n+              beneficiaryRecord.getPartCPbpNumberFebId(),\n+              beneficiaryRecord.getPartCPlanTypeFebCode(),\n+              beneficiaryRecord.getPartDContractNumberFebId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupFebCode(),\n+              beneficiaryRecord.getPartDPbpNumberFebId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyFebInd(),\n+              beneficiaryRecord.getPartDSegmentNumberFebId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 3, 1),\n+              beneficiaryRecord.getEntitlementBuyInMarInd(),\n+              beneficiaryRecord.getFipsStateCntyMarCode(),\n+              beneficiaryRecord.getHmoIndicatorMarInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMarCode(),\n+              beneficiaryRecord.getMedicareStatusMarCode(),\n+              beneficiaryRecord.getPartCContractNumberMarId(),\n+              beneficiaryRecord.getPartCPbpNumberMarId(),\n+              beneficiaryRecord.getPartCPlanTypeMarCode(),\n+              beneficiaryRecord.getPartDContractNumberMarId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMarCode(),\n+              beneficiaryRecord.getPartDPbpNumberMarId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMarInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMarId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 4, 1),\n+              beneficiaryRecord.getEntitlementBuyInAprInd(),\n+              beneficiaryRecord.getFipsStateCntyAprCode(),\n+              beneficiaryRecord.getHmoIndicatorAprInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAprCode(),\n+              beneficiaryRecord.getMedicareStatusAprCode(),\n+              beneficiaryRecord.getPartCContractNumberAprId(),\n+              beneficiaryRecord.getPartCPbpNumberAprId(),\n+              beneficiaryRecord.getPartCPlanTypeAprCode(),\n+              beneficiaryRecord.getPartDContractNumberAprId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAprCode(),\n+              beneficiaryRecord.getPartDPbpNumberAprId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAprInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAprId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 5, 1),\n+              beneficiaryRecord.getEntitlementBuyInMayInd(),\n+              beneficiaryRecord.getFipsStateCntyMayCode(),\n+              beneficiaryRecord.getHmoIndicatorMayInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMayCode(),\n+              beneficiaryRecord.getMedicareStatusMayCode(),\n+              beneficiaryRecord.getPartCContractNumberMayId(),\n+              beneficiaryRecord.getPartCPbpNumberMayId(),\n+              beneficiaryRecord.getPartCPlanTypeMayCode(),\n+              beneficiaryRecord.getPartDContractNumberMayId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMayCode(),\n+              beneficiaryRecord.getPartDPbpNumberMayId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMayInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMayId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 6, 1),\n+              beneficiaryRecord.getEntitlementBuyInJunInd(),\n+              beneficiaryRecord.getFipsStateCntyJunCode(),\n+              beneficiaryRecord.getHmoIndicatorJunInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJunCode(),\n+              beneficiaryRecord.getMedicareStatusJunCode(),\n+              beneficiaryRecord.getPartCContractNumberJunId(),\n+              beneficiaryRecord.getPartCPbpNumberJunId(),\n+              beneficiaryRecord.getPartCPlanTypeJunCode(),\n+              beneficiaryRecord.getPartDContractNumberJunId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJunCode(),\n+              beneficiaryRecord.getPartDPbpNumberJunId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJunInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJunId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 7, 1),\n+              beneficiaryRecord.getEntitlementBuyInJulInd(),\n+              beneficiaryRecord.getFipsStateCntyJulCode(),\n+              beneficiaryRecord.getHmoIndicatorJulInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJulCode(),\n+              beneficiaryRecord.getMedicareStatusJulCode(),\n+              beneficiaryRecord.getPartCContractNumberJulId(),\n+              beneficiaryRecord.getPartCPbpNumberJulId(),\n+              beneficiaryRecord.getPartCPlanTypeJulCode(),\n+              beneficiaryRecord.getPartDContractNumberJulId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJulCode(),\n+              beneficiaryRecord.getPartDPbpNumberJulId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJulInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJulId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 8, 1),\n+              beneficiaryRecord.getEntitlementBuyInAugInd(),\n+              beneficiaryRecord.getFipsStateCntyAugCode(),\n+              beneficiaryRecord.getHmoIndicatorAugInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAugCode(),\n+              beneficiaryRecord.getMedicareStatusAugCode(),\n+              beneficiaryRecord.getPartCContractNumberAugId(),\n+              beneficiaryRecord.getPartCPbpNumberAugId(),\n+              beneficiaryRecord.getPartCPlanTypeAugCode(),\n+              beneficiaryRecord.getPartDContractNumberAugId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAugCode(),\n+              beneficiaryRecord.getPartDPbpNumberAugId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAugInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAugId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 9, 1),\n+              beneficiaryRecord.getEntitlementBuyInSeptInd(),\n+              beneficiaryRecord.getFipsStateCntySeptCode(),\n+              beneficiaryRecord.getHmoIndicatorSeptInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilitySeptCode(),\n+              beneficiaryRecord.getMedicareStatusSeptCode(),\n+              beneficiaryRecord.getPartCContractNumberSeptId(),\n+              beneficiaryRecord.getPartCPbpNumberSeptId(),\n+              beneficiaryRecord.getPartCPlanTypeSeptCode(),\n+              beneficiaryRecord.getPartDContractNumberSeptId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupSeptCode(),\n+              beneficiaryRecord.getPartDPbpNumberSeptId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidySeptInd(),\n+              beneficiaryRecord.getPartDSegmentNumberSeptId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 10, 1),\n+              beneficiaryRecord.getEntitlementBuyInOctInd(),\n+              beneficiaryRecord.getFipsStateCntyOctCode(),\n+              beneficiaryRecord.getHmoIndicatorOctInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityOctCode(),\n+              beneficiaryRecord.getMedicareStatusOctCode(),\n+              beneficiaryRecord.getPartCContractNumberOctId(),\n+              beneficiaryRecord.getPartCPbpNumberOctId(),\n+              beneficiaryRecord.getPartCPlanTypeOctCode(),\n+              beneficiaryRecord.getPartDContractNumberOctId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupOctCode(),\n+              beneficiaryRecord.getPartDPbpNumberOctId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyOctInd(),\n+              beneficiaryRecord.getPartDSegmentNumberOctId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 11, 1),\n+              beneficiaryRecord.getEntitlementBuyInNovInd(),\n+              beneficiaryRecord.getFipsStateCntyNovCode(),\n+              beneficiaryRecord.getHmoIndicatorNovInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityNovCode(),\n+              beneficiaryRecord.getMedicareStatusNovCode(),\n+              beneficiaryRecord.getPartCContractNumberNovId(),\n+              beneficiaryRecord.getPartCPbpNumberNovId(),\n+              beneficiaryRecord.getPartCPlanTypeNovCode(),\n+              beneficiaryRecord.getPartDContractNumberNovId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupNovCode(),\n+              beneficiaryRecord.getPartDPbpNumberNovId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyNovInd(),\n+              beneficiaryRecord.getPartDSegmentNumberNovId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 12, 1),\n+              beneficiaryRecord.getEntitlementBuyInDecInd(),\n+              beneficiaryRecord.getFipsStateCntyDecCode(),\n+              beneficiaryRecord.getHmoIndicatorDecInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityDecCode(),\n+              beneficiaryRecord.getMedicareStatusDecCode(),\n+              beneficiaryRecord.getPartCContractNumberDecId(),\n+              beneficiaryRecord.getPartCPbpNumberDecId(),\n+              beneficiaryRecord.getPartCPlanTypeDecCode(),\n+              beneficiaryRecord.getPartDContractNumberDecId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupDecCode(),\n+              beneficiaryRecord.getPartDPbpNumberDecId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyDecInd(),\n+              beneficiaryRecord.getPartDSegmentNumberDecId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      if (currentYearBeneficiaryMonthly.size() > 0) {\n+        List<BeneficiaryMonthly> currentBeneficiaryMonthlyWithUpdates;\n+\n+        Beneficiary beneficiaryFromDb =\n+            entityManager.find(Beneficiary.class, beneficiaryRecord.getBeneficiaryId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 355}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3MDUxMg==", "bodyText": "added to do", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549570512", "createdAt": "2020-12-29T05:14:22Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -596,6 +614,313 @@ private void processAsync(\n     }\n   }\n \n+  /**\n+   * Ensures that a {@link BeneficiaryMonthly} record is created or updated for the specified {@link\n+   * Beneficiary}, if that {@link Beneficiary} already exists and is just being updated.\n+   *\n+   * @param entityManager the {@link EntityManager} to use\n+   * @param loadAction the {@link Loadaction} record being processed\n+   * @param beneficiaryRecord the {@link Beneficiary} record being processed\n+   */\n+  private static void updateBeneficiaryMonthly(\n+      EntityManager entityManager, Beneficiary beneficiaryRecord) {\n+\n+    if (beneficiaryRecord.getBeneEnrollmentReferenceYear().isPresent()) {\n+\n+      int year = beneficiaryRecord.getBeneEnrollmentReferenceYear().get().intValue();\n+      List<BeneficiaryMonthly> currentYearBeneficiaryMonthly = new ArrayList<BeneficiaryMonthly>();\n+\n+      BeneficiaryMonthly beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 1, 1),\n+              beneficiaryRecord.getEntitlementBuyInJanInd(),\n+              beneficiaryRecord.getFipsStateCntyJanCode(),\n+              beneficiaryRecord.getHmoIndicatorJanInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJanCode(),\n+              beneficiaryRecord.getMedicareStatusJanCode(),\n+              beneficiaryRecord.getPartCContractNumberJanId(),\n+              beneficiaryRecord.getPartCPbpNumberJanId(),\n+              beneficiaryRecord.getPartCPlanTypeJanCode(),\n+              beneficiaryRecord.getPartDContractNumberJanId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJanCode(),\n+              beneficiaryRecord.getPartDPbpNumberJanId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJanInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJanId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 2, 1),\n+              beneficiaryRecord.getEntitlementBuyInFebInd(),\n+              beneficiaryRecord.getFipsStateCntyFebCode(),\n+              beneficiaryRecord.getHmoIndicatorFebInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityFebCode(),\n+              beneficiaryRecord.getMedicareStatusFebCode(),\n+              beneficiaryRecord.getPartCContractNumberFebId(),\n+              beneficiaryRecord.getPartCPbpNumberFebId(),\n+              beneficiaryRecord.getPartCPlanTypeFebCode(),\n+              beneficiaryRecord.getPartDContractNumberFebId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupFebCode(),\n+              beneficiaryRecord.getPartDPbpNumberFebId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyFebInd(),\n+              beneficiaryRecord.getPartDSegmentNumberFebId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 3, 1),\n+              beneficiaryRecord.getEntitlementBuyInMarInd(),\n+              beneficiaryRecord.getFipsStateCntyMarCode(),\n+              beneficiaryRecord.getHmoIndicatorMarInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMarCode(),\n+              beneficiaryRecord.getMedicareStatusMarCode(),\n+              beneficiaryRecord.getPartCContractNumberMarId(),\n+              beneficiaryRecord.getPartCPbpNumberMarId(),\n+              beneficiaryRecord.getPartCPlanTypeMarCode(),\n+              beneficiaryRecord.getPartDContractNumberMarId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMarCode(),\n+              beneficiaryRecord.getPartDPbpNumberMarId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMarInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMarId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 4, 1),\n+              beneficiaryRecord.getEntitlementBuyInAprInd(),\n+              beneficiaryRecord.getFipsStateCntyAprCode(),\n+              beneficiaryRecord.getHmoIndicatorAprInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAprCode(),\n+              beneficiaryRecord.getMedicareStatusAprCode(),\n+              beneficiaryRecord.getPartCContractNumberAprId(),\n+              beneficiaryRecord.getPartCPbpNumberAprId(),\n+              beneficiaryRecord.getPartCPlanTypeAprCode(),\n+              beneficiaryRecord.getPartDContractNumberAprId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAprCode(),\n+              beneficiaryRecord.getPartDPbpNumberAprId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAprInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAprId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 5, 1),\n+              beneficiaryRecord.getEntitlementBuyInMayInd(),\n+              beneficiaryRecord.getFipsStateCntyMayCode(),\n+              beneficiaryRecord.getHmoIndicatorMayInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityMayCode(),\n+              beneficiaryRecord.getMedicareStatusMayCode(),\n+              beneficiaryRecord.getPartCContractNumberMayId(),\n+              beneficiaryRecord.getPartCPbpNumberMayId(),\n+              beneficiaryRecord.getPartCPlanTypeMayCode(),\n+              beneficiaryRecord.getPartDContractNumberMayId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupMayCode(),\n+              beneficiaryRecord.getPartDPbpNumberMayId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyMayInd(),\n+              beneficiaryRecord.getPartDSegmentNumberMayId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 6, 1),\n+              beneficiaryRecord.getEntitlementBuyInJunInd(),\n+              beneficiaryRecord.getFipsStateCntyJunCode(),\n+              beneficiaryRecord.getHmoIndicatorJunInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJunCode(),\n+              beneficiaryRecord.getMedicareStatusJunCode(),\n+              beneficiaryRecord.getPartCContractNumberJunId(),\n+              beneficiaryRecord.getPartCPbpNumberJunId(),\n+              beneficiaryRecord.getPartCPlanTypeJunCode(),\n+              beneficiaryRecord.getPartDContractNumberJunId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJunCode(),\n+              beneficiaryRecord.getPartDPbpNumberJunId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJunInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJunId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 7, 1),\n+              beneficiaryRecord.getEntitlementBuyInJulInd(),\n+              beneficiaryRecord.getFipsStateCntyJulCode(),\n+              beneficiaryRecord.getHmoIndicatorJulInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityJulCode(),\n+              beneficiaryRecord.getMedicareStatusJulCode(),\n+              beneficiaryRecord.getPartCContractNumberJulId(),\n+              beneficiaryRecord.getPartCPbpNumberJulId(),\n+              beneficiaryRecord.getPartCPlanTypeJulCode(),\n+              beneficiaryRecord.getPartDContractNumberJulId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupJulCode(),\n+              beneficiaryRecord.getPartDPbpNumberJulId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyJulInd(),\n+              beneficiaryRecord.getPartDSegmentNumberJulId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 8, 1),\n+              beneficiaryRecord.getEntitlementBuyInAugInd(),\n+              beneficiaryRecord.getFipsStateCntyAugCode(),\n+              beneficiaryRecord.getHmoIndicatorAugInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityAugCode(),\n+              beneficiaryRecord.getMedicareStatusAugCode(),\n+              beneficiaryRecord.getPartCContractNumberAugId(),\n+              beneficiaryRecord.getPartCPbpNumberAugId(),\n+              beneficiaryRecord.getPartCPlanTypeAugCode(),\n+              beneficiaryRecord.getPartDContractNumberAugId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupAugCode(),\n+              beneficiaryRecord.getPartDPbpNumberAugId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyAugInd(),\n+              beneficiaryRecord.getPartDSegmentNumberAugId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 9, 1),\n+              beneficiaryRecord.getEntitlementBuyInSeptInd(),\n+              beneficiaryRecord.getFipsStateCntySeptCode(),\n+              beneficiaryRecord.getHmoIndicatorSeptInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilitySeptCode(),\n+              beneficiaryRecord.getMedicareStatusSeptCode(),\n+              beneficiaryRecord.getPartCContractNumberSeptId(),\n+              beneficiaryRecord.getPartCPbpNumberSeptId(),\n+              beneficiaryRecord.getPartCPlanTypeSeptCode(),\n+              beneficiaryRecord.getPartDContractNumberSeptId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupSeptCode(),\n+              beneficiaryRecord.getPartDPbpNumberSeptId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidySeptInd(),\n+              beneficiaryRecord.getPartDSegmentNumberSeptId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 10, 1),\n+              beneficiaryRecord.getEntitlementBuyInOctInd(),\n+              beneficiaryRecord.getFipsStateCntyOctCode(),\n+              beneficiaryRecord.getHmoIndicatorOctInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityOctCode(),\n+              beneficiaryRecord.getMedicareStatusOctCode(),\n+              beneficiaryRecord.getPartCContractNumberOctId(),\n+              beneficiaryRecord.getPartCPbpNumberOctId(),\n+              beneficiaryRecord.getPartCPlanTypeOctCode(),\n+              beneficiaryRecord.getPartDContractNumberOctId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupOctCode(),\n+              beneficiaryRecord.getPartDPbpNumberOctId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyOctInd(),\n+              beneficiaryRecord.getPartDSegmentNumberOctId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 11, 1),\n+              beneficiaryRecord.getEntitlementBuyInNovInd(),\n+              beneficiaryRecord.getFipsStateCntyNovCode(),\n+              beneficiaryRecord.getHmoIndicatorNovInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityNovCode(),\n+              beneficiaryRecord.getMedicareStatusNovCode(),\n+              beneficiaryRecord.getPartCContractNumberNovId(),\n+              beneficiaryRecord.getPartCPbpNumberNovId(),\n+              beneficiaryRecord.getPartCPlanTypeNovCode(),\n+              beneficiaryRecord.getPartDContractNumberNovId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupNovCode(),\n+              beneficiaryRecord.getPartDPbpNumberNovId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyNovInd(),\n+              beneficiaryRecord.getPartDSegmentNumberNovId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      beneficiaryMonthly =\n+          getBeneficiaryMonthly(\n+              beneficiaryRecord,\n+              LocalDate.of(year, 12, 1),\n+              beneficiaryRecord.getEntitlementBuyInDecInd(),\n+              beneficiaryRecord.getFipsStateCntyDecCode(),\n+              beneficiaryRecord.getHmoIndicatorDecInd(),\n+              beneficiaryRecord.getMedicaidDualEligibilityDecCode(),\n+              beneficiaryRecord.getMedicareStatusDecCode(),\n+              beneficiaryRecord.getPartCContractNumberDecId(),\n+              beneficiaryRecord.getPartCPbpNumberDecId(),\n+              beneficiaryRecord.getPartCPlanTypeDecCode(),\n+              beneficiaryRecord.getPartDContractNumberDecId(),\n+              beneficiaryRecord.getPartDLowIncomeCostShareGroupDecCode(),\n+              beneficiaryRecord.getPartDPbpNumberDecId(),\n+              beneficiaryRecord.getPartDRetireeDrugSubsidyDecInd(),\n+              beneficiaryRecord.getPartDSegmentNumberDecId());\n+\n+      if (beneficiaryMonthly != null) {\n+        currentYearBeneficiaryMonthly.add(beneficiaryMonthly);\n+      }\n+\n+      if (currentYearBeneficiaryMonthly.size() > 0) {\n+        List<BeneficiaryMonthly> currentBeneficiaryMonthlyWithUpdates;\n+\n+        Beneficiary beneficiaryFromDb =\n+            entityManager.find(Beneficiary.class, beneficiaryRecord.getBeneficiaryId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MTQ0Ng=="}, "originalCommit": {"oid": "f8fb96e5b45b3dfaadbf7e7bc8223c3b681a7f00"}, "originalPosition": 355}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODY3NzM2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowMjoxOVrOIMWAmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowMjoxOVrOIMWAmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNDQyNw==", "bodyText": "Would you mind applying this suggestion?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}\n          \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}, for numeric types this represents the total number of digits that can be stored\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}, for numeric types this represents how many of the total digits (see `columnLength`) are to the right of the decimal point", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549814427", "createdAt": "2020-12-29T19:02:19Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,195 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly class in the model rif\n+   *\n+   * @param lineEntity helps build the entity {@link TypeSpec.Builder}\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 648}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODY3OTA2OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowMzoyMVrOIMWBpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowMzoyMVrOIMWBpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNDY5Mw==", "bodyText": "Would you mind applying this suggestion?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}\n          \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}, for numeric types this represents the total number of digits that can be stored\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}, for numeric types this represents how many of the total digits (see `columnLength`) are to the right of the decimal point", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549814693", "createdAt": "2020-12-29T19:03:21Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,195 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly class in the model rif\n+   *\n+   * @param lineEntity helps build the entity {@link TypeSpec.Builder}\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}\n+   */\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly annotations in the model rif\n+   *\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 703}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODY4MDE3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowMzo1NVrOIMWCNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowMzo1NVrOIMWCNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNDgzOQ==", "bodyText": "Would you mind applying this suggestion?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}\n          \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}, for numeric types this represents the total number of digits that can be stored\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}, for numeric types this represents how many of the total digits (see `columnLength`) are to the right of the decimal point", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549814839", "createdAt": "2020-12-29T19:03:55Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,195 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly class in the model rif\n+   *\n+   * @param lineEntity helps build the entity {@link TypeSpec.Builder}\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}\n+   */\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly annotations in the model rif\n+   *\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}\n+   */\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  /**\n+   * Selects the java field type\n+   *\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 779}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODY4MDY5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowNDoxM1rOIMWCjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowNDoxM1rOIMWCjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNDkyNA==", "bodyText": "Would you mind applying this suggestion?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}\n          \n          \n            \n               * @param columnLength specifies the column length {@link Optional<Integer>}, for numeric types this represents the total number of digits that can be stored\n          \n          \n            \n               * @param columnScale specifies the column scale {@link Optional<Integer>}, for numeric types this represents how many of the total digits (see `columnLength`) are to the right of the decimal point", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549814924", "createdAt": "2020-12-29T19:04:13Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/RifLayoutsProcessor.java", "diffHunk": "@@ -1503,4 +1828,195 @@ private void writeDebugLogMessages() {\n       throw new UncheckedIOException(e);\n     }\n   }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly class in the model rif\n+   *\n+   * @param lineEntity helps build the entity {@link TypeSpec.Builder}\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}\n+   */\n+  private static void createBeneficiaryMonthlyFields(\n+      TypeSpec.Builder lineEntity,\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    FieldSpec lineField =\n+        FieldSpec.builder(\n+                selectJavaFieldType(type, isColumnOptional, columnLength, columnScale),\n+                fieldName,\n+                Modifier.PRIVATE)\n+            .addAnnotations(\n+                createBeneficiaryMonthlyAnnotations(\n+                    isId,\n+                    isTransient,\n+                    isColumnOptional,\n+                    fieldName,\n+                    type,\n+                    columnLength,\n+                    columnScale))\n+            .build();\n+    lineEntity.addField(lineField);\n+\n+    MethodSpec.Builder lineFieldGetter =\n+        MethodSpec.methodBuilder(calculateGetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale));\n+    addGetterStatement(isColumnOptional, lineField, lineFieldGetter);\n+    lineEntity.addMethod(lineFieldGetter.build());\n+\n+    MethodSpec.Builder lineFieldSetter =\n+        MethodSpec.methodBuilder(calculateSetterName(lineField))\n+            .addModifiers(Modifier.PUBLIC)\n+            .returns(void.class)\n+            .addParameter(\n+                selectJavaPropertyType(type, isColumnOptional, columnLength, columnScale),\n+                lineField.name);\n+    addSetterStatement(isColumnOptional, lineField, lineFieldSetter);\n+    lineEntity.addMethod(lineFieldSetter.build());\n+  }\n+\n+  /**\n+   * Creates the fields for the BeneficiaryMonthly annotations in the model rif\n+   *\n+   * @param isId determines if the field is an id field\n+   * @param isTransient determines if the field is transient {@link boolean}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param fieldName specifies the fieldname {@link String}\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}\n+   */\n+  private static List<AnnotationSpec> createBeneficiaryMonthlyAnnotations(\n+      boolean isId,\n+      boolean isTransient,\n+      boolean isColumnOptional,\n+      String fieldName,\n+      RifColumnType type,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    LinkedList<AnnotationSpec> annotations = new LinkedList<>();\n+\n+    // Add an @Id annotation, if appropriate.\n+    if (isId) {\n+      AnnotationSpec.Builder idAnnotation = AnnotationSpec.builder(Id.class);\n+      annotations.add(idAnnotation.build());\n+    }\n+    // Add an @Column annotation to every non-transient column.\n+    if (!isTransient) {\n+      AnnotationSpec.Builder columnAnnotation =\n+          AnnotationSpec.builder(Column.class)\n+              .addMember(\"name\", \"$S\", \"`\" + fieldName + \"`\")\n+              .addMember(\"nullable\", \"$L\", isColumnOptional);\n+      if (type == RifColumnType.CHAR && columnLength.isPresent()) {\n+        columnAnnotation.addMember(\"length\", \"$L\", columnLength.get());\n+      } else if (type == RifColumnType.NUM) {\n+        /*\n+         * In SQL, the precision is the number of digits in the unscaled value, e.g.\n+         * \"123.45\" has a precision of 5. The scale is the number of digits to the right\n+         * of the decimal point, e.g. \"123.45\" has a scale of 2.\n+         */\n+\n+        if (columnLength.isPresent() && columnScale.isPresent()) {\n+          columnAnnotation.addMember(\"precision\", \"$L\", columnLength.get());\n+          columnAnnotation.addMember(\"scale\", \"$L\", columnScale.get());\n+        } else {\n+          /*\n+           * Unfortunately, Hibernate's SQL schema generation (HBM2DDL) doesn't correctly\n+           * handle SQL numeric datatypes that don't have a defined precision and scale.\n+           * What it _should_ do is represent those types in PostgreSQL as a \"NUMERIC\",\n+           * but what it does instead is insert a default precision and scale as\n+           * \"NUMBER(19, 2)\". The only way to force the correct behavior is to specify a\n+           * columnDefinition, so we do that. This leads to incorrect behavior with HSQL\n+           * (for different reasons), but fortunately that doesn't happen to cause\n+           * problems with our tests.\n+           */\n+          StringBuilder columnDefinition = new StringBuilder();\n+          columnDefinition.append(\"numeric\");\n+          if (columnLength.isPresent() || columnScale.isPresent()) {\n+            columnDefinition.append('(');\n+            if (columnLength.isPresent()) {\n+              columnDefinition.append(columnLength.get());\n+            }\n+            if (columnScale.isPresent()) {\n+              columnDefinition.append(\", \");\n+              columnDefinition.append(columnScale.get());\n+            }\n+            columnDefinition.append(')');\n+          }\n+          columnAnnotation.addMember(\"columnDefinition\", \"$S\", columnDefinition.toString());\n+        }\n+      }\n+      annotations.add(columnAnnotation.build());\n+    } else {\n+      annotations.add(AnnotationSpec.builder(Transient.class).build());\n+    }\n+\n+    return annotations;\n+  }\n+\n+  /**\n+   * Selects the java field type\n+   *\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}\n+   */\n+  private static TypeName selectJavaFieldType(\n+      RifColumnType type,\n+      boolean isColumnOptional,\n+      Optional<Integer> columnLength,\n+      Optional<Integer> columnScale) {\n+    if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && !isColumnOptional) return TypeName.CHAR;\n+    else if (type == RifColumnType.CHAR\n+        && columnLength.orElse(Integer.MAX_VALUE) == 1\n+        && isColumnOptional) return ClassName.get(Character.class);\n+    else if (type == RifColumnType.CHAR) return ClassName.get(String.class);\n+    else if (type == RifColumnType.DATE && columnLength.orElse(0) == 8)\n+      return ClassName.get(LocalDate.class);\n+    else if (type == RifColumnType.TIMESTAMP && columnLength.orElse(0) == 20)\n+      return ClassName.get(Instant.class);\n+    else if (type == RifColumnType.NUM && columnScale.orElse(Integer.MAX_VALUE) > 0)\n+      return ClassName.get(BigDecimal.class);\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && !isColumnOptional) return TypeName.INT;\n+    else if (type == RifColumnType.NUM\n+        && columnScale.orElse(Integer.MAX_VALUE) == 0\n+        && isColumnOptional) return ClassName.get(Integer.class);\n+    else throw new IllegalArgumentException(\"Unhandled field type: \" + type.name());\n+  }\n+\n+  /**\n+   * Selects the java property type\n+   *\n+   * @param type specifies the field type {@link RifColumnType}\n+   * @param isColumnOptional determines if the field is optional {@link boolean}\n+   * @param columnLength specifies the column length {@link Optional<Integer>}\n+   * @param columnScale specifies the column scale {@link Optional<Integer>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 814}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODY4NjU3OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowNjo1OVrOIMWFpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMzowMjoxMFrOIMaFZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNTcxOA==", "bodyText": "What is this assertion doing?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549815718", "createdAt": "2020-12-29T19:06:59Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -532,6 +685,7 @@ private void loadSample(DataSource dataSource, List<StaticRifResource> sampleRes\n           rifFileRecords,\n           error -> {\n             failureCount.incrementAndGet();\n+            Assert.assertEquals(\"\", error.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg4MTE5MQ==", "bodyText": "Crap forgot to remove this..", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549881191", "createdAt": "2020-12-29T23:02:10Z", "author": {"login": "cbrunefearless"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -532,6 +685,7 @@ private void loadSample(DataSource dataSource, List<StaticRifResource> sampleRes\n           rifFileRecords,\n           error -> {\n             failureCount.incrementAndGet();\n+            Assert.assertEquals(\"\", error.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNTcxOA=="}, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 171}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODY4OTA5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowODoxMlrOIMWG_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxOTowODoxMlrOIMWG_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgxNjA2MQ==", "bodyText": "Great! Glad this passes, too!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549816061", "createdAt": "2020-12-29T19:08:12Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/test/java/gov/cms/bfd/pipeline/rif/load/RifLoaderIT.java", "diffHunk": "@@ -316,6 +317,158 @@ public void loadSampleUUnchanged() {\n       if (entityManager != null) entityManager.close();\n     }\n   }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount12() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(12, beneficiaryFromDb.getBeneficiaryMonthlys().size());\n+      assertBeneficiaryMonthly(beneficiaryFromDb);\n+\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount24() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_U.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(24, beneficiaryFromDb.getBeneficiaryMonthlys().size());\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount20SinceThereIsAUpdateOf8Months() {\n+    DataSource dataSource = DatabaseTestHelper.getTestDatabaseAfterClean();\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_A.getResources()));\n+    loadSample(dataSource, Arrays.asList(StaticRifResourceGroup.SAMPLE_U.getResources()));\n+    loadSample(\n+        dataSource,\n+        Arrays.asList(StaticRifResourceGroup.SAMPLE_U_BENES_CHANGED_WITH_8_MONTHS.getResources()));\n+\n+    LoadAppOptions options = RifLoaderTestUtils.getLoadOptions(dataSource);\n+    EntityManagerFactory entityManagerFactory =\n+        RifLoaderTestUtils.createEntityManagerFactory(options);\n+    EntityManager entityManager = null;\n+    try {\n+      entityManager = entityManagerFactory.createEntityManager();\n+\n+      Beneficiary beneficiaryFromDb = entityManager.find(Beneficiary.class, \"567834\");\n+      Assert.assertEquals(20, beneficiaryFromDb.getBeneficiaryMonthlys().size());\n+    } finally {\n+      if (entityManager != null) entityManager.close();\n+    }\n+  }\n+\n+  @Test\n+  public void loadInitialEnrollmentShouldCount21SinceThereIsAUpdateOf8MonthsAndAUpdateOf9Months() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf6dbc202b796476de5e622f717f034d66c1711"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1OTE1MzQyOnYy", "diffSide": "RIGHT", "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMzoxNDoxOFrOIMaOtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMzoxNDoxOFrOIMaOtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg4MzU3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** @param hasLines the new value for {@link #setHasBeneficiaryMonthly()} */\n          \n          \n            \n              /** @param hasBeneficiaryMonthly the new value for {@link #setHasBeneficiaryMonthly()} */", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r549883572", "createdAt": "2020-12-29T23:14:18Z", "author": {"login": "jzulim"}, "path": "apps/bfd-model/bfd-model-codegen/src/main/java/gov/cms/bfd/model/codegen/MappingSpec.java", "diffHunk": "@@ -158,6 +159,20 @@ public MappingSpec setHasLines(boolean hasLines) {\n     return this;\n   }\n \n+  /**\n+   * @return <code>true</code> if the RIF layout has child line fields that should be stored\n+   *     separately from its parent header fields, <code>false</code> if not\n+   */\n+  public boolean getHasBeneficiaryMonthly() {\n+    return hasBeneficiaryMonthly;\n+  }\n+\n+  /** @param hasLines the new value for {@link #setHasBeneficiaryMonthly()} */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbf04f2800fa05f62631402ff7e532b8d6b39d29"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTczODQ5OnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNzo0NTo0NFrOIMyG2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNzo0NTo0NFrOIMyG2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI3NDc3Ng==", "bodyText": "this definition makes the code easier to read down the line. thx.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r550274776", "createdAt": "2020-12-30T17:45:44Z", "author": {"login": "jzulim"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -506,6 +508,9 @@ private void processAsync(\n \n         LoadStrategy strategy = selectStrategy(recordAction);\n         LoadAction loadAction;\n+\n+        boolean recordsIsBeneficiary = (record instanceof Beneficiary) ? true : false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea161ee2f878348bec572954d9221e7917d294e"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTc3NjQzOnYy", "diffSide": "RIGHT", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxODowNTowMFrOIMycKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxODowNTowMFrOIMycKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI4MDIzNQ==", "bodyText": "Would you consider also JavaDoc'ing this?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/419#discussion_r550280235", "createdAt": "2020-12-30T18:05:00Z", "author": {"login": "jzulim"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -657,6 +982,59 @@ static boolean isBeneficiaryHistoryEqual(\n     return false;\n   }\n \n+  public static BeneficiaryMonthly getBeneficiaryMonthly(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea161ee2f878348bec572954d9221e7917d294e"}, "originalPosition": 386}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 199, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}