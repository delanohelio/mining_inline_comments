{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NzIxMjEx", "number": 228, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxNjowNDoxOVrODiKaRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxNjowNToxMVrODiKaYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTQ4NzQxOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/LoadedFilterManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxNjowNDoxOVrOFtRfNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxNjowNDoxOVrOFtRfNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAxNjc1Nw==", "bodyText": "This the mistake. The design calls for this function to not interfere with requests. By making the call synchronous, it locks the manger and requests have to wait.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/228#discussion_r383016757", "createdAt": "2020-02-23T16:04:19Z", "author": {"login": "RickHawesUSDS"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/LoadedFilterManager.java", "diffHunk": "@@ -204,10 +204,11 @@ public synchronized boolean isInBounds(DateRangeParam range) {\n    * call.\n    */\n   @Scheduled(fixedDelay = 1000, initialDelay = 2000)\n-  public synchronized void refreshFilters() {\n+  public void refreshFilters() {\n     /*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00ca4365fd810192b33c0aefd37d629d2c80157d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTQ4NzcwOnYy", "diffSide": "RIGHT", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/LoadedFilterManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxNjowNToxMVrOFtRfZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxNjo0MDozMFrOFtRp_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAxNjgwNQ==", "bodyText": "Now, instead of setting the filters and other states during the method, the state is set once at the end.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/228#discussion_r383016805", "createdAt": "2020-02-23T16:05:11Z", "author": {"login": "RickHawesUSDS"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/LoadedFilterManager.java", "diffHunk": "@@ -232,26 +233,25 @@ public synchronized void refreshFilters() {\n             || this.firstBatchCreated.before(currentFirstBatchUpdate)) {\n           LOGGER.info(\"Trimmed LoadedFile filters before {}\", currentFirstBatchUpdate);\n           List<LoadedFile> loadedFiles = fetchLoadedFiles();\n-          this.filters = trimFilters(this.filters, loadedFiles);\n-          this.firstBatchCreated = currentFirstBatchUpdate;\n+          newFilters = trimFilters(newFilters, loadedFiles);\n         }\n \n-        // update the transaction time as well\n-        this.transactionTime = currentLastBatchCreated;\n+        set(newFilters, currentFirstBatchUpdate, currentFirstBatchUpdate);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00ca4365fd810192b33c0aefd37d629d2c80157d"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAxOTUxNg==", "bodyText": "Shouldn't the third parameter passed into set be currentLastBatchCreated rather than currentFirstBatchUpdate or am I misunderstanding the workflow?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/228#discussion_r383019516", "createdAt": "2020-02-23T16:40:30Z", "author": {"login": "njdister"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/LoadedFilterManager.java", "diffHunk": "@@ -232,26 +233,25 @@ public synchronized void refreshFilters() {\n             || this.firstBatchCreated.before(currentFirstBatchUpdate)) {\n           LOGGER.info(\"Trimmed LoadedFile filters before {}\", currentFirstBatchUpdate);\n           List<LoadedFile> loadedFiles = fetchLoadedFiles();\n-          this.filters = trimFilters(this.filters, loadedFiles);\n-          this.firstBatchCreated = currentFirstBatchUpdate;\n+          newFilters = trimFilters(newFilters, loadedFiles);\n         }\n \n-        // update the transaction time as well\n-        this.transactionTime = currentLastBatchCreated;\n+        set(newFilters, currentFirstBatchUpdate, currentFirstBatchUpdate);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAxNjgwNQ=="}, "originalCommit": {"oid": "00ca4365fd810192b33c0aefd37d629d2c80157d"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 312, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}