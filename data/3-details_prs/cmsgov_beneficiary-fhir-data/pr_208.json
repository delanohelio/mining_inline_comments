{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjcxMTMw", "number": 208, "title": "BLUEBUTTON-1737 Throw ResourceNotFoundException (404) for ID multiple matches ", "bodyText": "Change Details\nSummary:\nThis PR updates the PatientResourceProvider.queryDatabaseByHash() method used for HICN and MBI searches to throw a ResourceNotFoundException exception when multiple bene id's are found. An entry in the access.json logs (via MDC) is also made for auditing.\nThe ignored (using @ignore) IT tests in the PatientResourceProviderIT class were updated for the new behavior.\nThese tests are:  searchForExistingPatientByHicnHashWithBeneDups() and searchForExistingPatientByMbiHashWithBeneDups()\nA new assert method assertPatientByHashTypeMatch() was created to be used by these tests. It combines the overlapping code from the two separate assertPatientByHicnHashWithBeneDupsMatch() and assertPatientByMbiHashWithBeneDupsMatch() methods.\nAcceptance Validation\nThat HICN or MBI search requests that map to multiple bene ID's will produce a ResourceNotFoundException exception (404 HTTP response status code). This was previously returning a NonUniqueResultException exception (500 HTTP response status code).\nFeedback Requested\n\nDoes the naming of things and the text of the error/excpetion response look OK?\n\nExternal References\n\nBLUEBUTTON-1737", "createdAt": "2020-01-29T17:10:35Z", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/208", "merged": true, "mergeCommit": {"oid": "73a8863dfa73be7229b6f4c87a86ee52964b4a5a"}, "closed": true, "closedAt": "2020-01-30T18:33:51Z", "author": {"login": "dtisza1"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_JCNZgH2gAyMzY4NjcxMTMwOjdjMWY0OTcyYWJlODgzZWM0YThjZGIwYWE3NGVkODRlZTJjZDE0MTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_dFSlgFqTM1MDk1OTUwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7c1f4972abe883ec4a8cdb0aa74ed84ee2cd1410", "author": {"user": {"login": "dtisza1", "name": "David Tisza"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7c1f4972abe883ec4a8cdb0aa74ed84ee2cd1410", "committedDate": "2020-01-29T17:03:43Z", "message": "Change 500 exception to 404"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c1f6d522fd24e5bbfdbc4990b7fba03dc5375f", "author": {"user": {"login": "dtisza1", "name": "David Tisza"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b5c1f6d522fd24e5bbfdbc4990b7fba03dc5375f", "committedDate": "2020-01-29T17:05:07Z", "message": "Refactor IT tests for new hash search behavior"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzM1NTkz", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/208#pullrequestreview-350335593", "createdAt": "2020-01-29T18:39:11Z", "commit": {"oid": "b5c1f6d522fd24e5bbfdbc4990b7fba03dc5375f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNDQ5MDk5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/208#pullrequestreview-350449099", "createdAt": "2020-01-29T21:50:01Z", "commit": {"oid": "b5c1f6d522fd24e5bbfdbc4990b7fba03dc5375f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo1MDowMVrOFjYvzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo1MDowMVrOFjYvzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTkzMw==", "bodyText": "Typo... BENI_ID", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/208#discussion_r372649933", "createdAt": "2020-01-29T21:50:01Z", "author": {"login": "RickHawesUSDS"}, "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PatientResourceProvider.java", "diffHunk": "@@ -423,7 +423,9 @@ private Patient queryDatabaseByHash(\n     if (distinctBeneIds <= 0) {\n       throw new NoResultException();\n     } else if (distinctBeneIds > 1) {\n-      throw new NonUniqueResultException();\n+      MDC.put(\"database_query.by_hash.collision.distinct_bene_ids\", Long.toString(distinctBeneIds));\n+      throw new ResourceNotFoundException(\n+          \"By hash query found more than one distinct BENI_ID: \" + Long.toString(distinctBeneIds));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5c1f6d522fd24e5bbfdbc4990b7fba03dc5375f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e551846fa3fd67907880e81da2f44347aa1379d4", "author": {"user": {"login": "dtisza1", "name": "David Tisza"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e551846fa3fd67907880e81da2f44347aa1379d4", "committedDate": "2020-01-29T22:00:12Z", "message": "Fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTU5NTA2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/208#pullrequestreview-350959506", "createdAt": "2020-01-30T16:25:11Z", "commit": {"oid": "e551846fa3fd67907880e81da2f44347aa1379d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 664, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}