{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzc0NzQ5", "number": 399, "title": "Cbrune/bfd 520 null etl fields", "bodyText": "Change Details\nBFD-520 - Added a function to remove /0 -> nulls in the etl process when it parses the csv.\n\n\nAcceptance Validation\n\nAdded test and passes for a trailing null for county zip code as well as other string fields.\n\nFeedback Requested\n\nMake sure the change is in the right place when we get the data from the etl and before it is put in the database.\nExternal References\n\n\nBFD-520\n\nBFD-520 | State County Zip Code Null Byte Acception\nSecurity Implications\n\n\n new software dependencies\n\n\n\n altered security controls\n\n\n\n new data stored or transmitted\n\n\n\n security checklist is completed for this change\n\n\n\n requires more information or team discussion to evaluate security implications", "createdAt": "2020-11-16T16:25:21Z", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399", "merged": true, "mergeCommit": {"oid": "153d8794482bace85c7dfa498bcf9726013dcf4b"}, "closed": true, "closedAt": "2020-11-19T18:48:11Z", "author": {"login": "cbrunefearless"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcpOx9AH2gAyNTIxNzc0NzQ5OmFjMTg3MDU3ZjA2NmU2OWRmZDgwYzYyNjdmZWY3Njk5MTA2NTNmZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeHLUsAFqTUzNDczOTM3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac187057f066e69dfd80c6267fef769910653fdd", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/ac187057f066e69dfd80c6267fef769910653fdd", "committedDate": "2020-11-15T05:09:22Z", "message": "Added null check to rifprocessingutils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7835824b3b926ac2fb421da52edf84c80dca23fe", "committedDate": "2020-11-15T05:27:25Z", "message": "Changed rif parsing for null fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTY4NjM0", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#pullrequestreview-532568634", "createdAt": "2020-11-17T16:42:32Z", "commit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0MjozMlrOH0-hwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjo0NzozNFrOH0-wsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMjQ0OQ==", "bodyText": "I'd suggest a slight wording tweak to clarify your intent here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /**\n          \n          \n            \n               * @param string tring to parse\n          \n          \n            \n               * @return an {@link String} with a null representation stripped from it if the input has a null\n          \n          \n            \n               *     field representation.\n          \n          \n            \n               */\n          \n          \n            \n              public static String removeInvalidCharacters(String string) {\n          \n          \n            \n                String newString = string;\n          \n          \n            \n            \n          \n          \n            \n                // Null Field\n          \n          \n            \n                String nullFields = \"\\\\0\";\n          \n          \n            \n                if (!Strings.isNullOrEmpty(newString)) {\n          \n          \n            \n                  if (newString.contains(nullFields)) newString = newString.replace(nullFields, \"\");\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                return newString;\n          \n          \n            \n              }\n          \n          \n            \n              /**\n          \n          \n            \n               * @param string the {@link String} to parse\n          \n          \n            \n               * @return a copy of the specified {@link String} but with any/all null bytes it contained removed\n          \n          \n            \n               */\n          \n          \n            \n              public static String removeInvalidCharacters(String string) {\n          \n          \n            \n                String newString = string;\n          \n          \n            \n            \n          \n          \n            \n                String nullByte = \"\\\\0\";\n          \n          \n            \n                if (!Strings.isNullOrEmpty(newString)) {\n          \n          \n            \n                  if (newString.contains(nullByte)) newString = newString.replace(nullByte, \"\");\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                return newString;\n          \n          \n            \n              }", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525312449", "createdAt": "2020-11-17T16:42:32Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -269,4 +270,21 @@ public static Character parseCharacter(String charText) {\n       return Optional.of(parseCharacter(charText));\n     }\n   }\n+\n+  /**\n+   * @param string tring to parse\n+   * @return an {@link String} with a null representation stripped from it if the input has a null\n+   *     field representation.\n+   */\n+  public static String removeInvalidCharacters(String string) {\n+    String newString = string;\n+\n+    // Null Field\n+    String nullFields = \"\\\\0\";\n+    if (!Strings.isNullOrEmpty(newString)) {\n+      if (newString.contains(nullFields)) newString = newString.replace(nullFields, \"\");\n+    }\n+\n+    return newString;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMzMxNw==", "bodyText": "If we're not already using this somewhere, you'll need to file a SIA for it. Shouldn't be a big deal, though.\nYou also might consider adding it to the new bfd-shared-utils module, instead, as it definitely is useful, in general.", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525313317", "createdAt": "2020-11-17T16:43:42Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/pom.xml", "diffHunk": "@@ -22,6 +22,13 @@\n \t\t\t<artifactId>bfd-model-rif</artifactId>\n \t\t</dependency>\n \n+\t\t<dependency>\n+\t\t\t<!-- Just useful. -->\n+\t\t\t<groupId>com.google.guava</groupId>\n+\t\t\t<artifactId>guava</artifactId>\n+\t\t\t<version>24.1.1-jre</version>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNTQ1NA==", "bodyText": "I'd probably simplify this way down by:\n\nChecking any/all fields with null bytes, to ensure they were cleaned up correctly.\nChecking one field after the null byte(s), to ensure they're correct.\nGetting rid of most other assertions.\n\nAs-is, it's a bit hard to figure out which field(s) were supposed to be corrected. Maybe also add a comment mentioning that?", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525315454", "createdAt": "2020-11-17T16:46:29Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-pipeline/bfd-pipeline-rif-extract/src/test/java/gov/cms/bfd/pipeline/rif/extract/RifFilesProcessorTest.java", "diffHunk": "@@ -105,6 +105,70 @@ public void process1BeneRecord() {\n     Assert.assertEquals(new BigDecimal(\"1\"), beneRow.getBeneLinkKey().get());\n   }\n \n+  @Test\n+  public void process1BeneRecordWithTrailingNulls() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNjE3NA==", "bodyText": "Love this approach!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525316174", "createdAt": "2020-11-17T16:47:25Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -78,7 +79,7 @@ public static CSVParser createCsvParser(\n    *     consistency)\n    */\n   public static String parseString(String string) {\n-    return string;\n+    return removeInvalidCharacters(string);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNjI3NQ==", "bodyText": "Love this approach!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r525316275", "createdAt": "2020-11-17T16:47:34Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -88,7 +89,7 @@ public static String parseString(String string) {\n    *     value\n    */\n   public static Optional<String> parseOptionalString(String string) {\n-    return string.isEmpty() ? Optional.empty() : Optional.of(string);\n+    return string.isEmpty() ? Optional.empty() : Optional.of(removeInvalidCharacters(string));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7835824b3b926ac2fb421da52edf84c80dca23fe"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9f0e4ffd99020b992da39d9c24e90a427b4e373", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/d9f0e4ffd99020b992da39d9c24e90a427b4e373", "committedDate": "2020-11-17T18:15:51Z", "message": "refactored some code from the code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5964ea21d292a8275033a1b0612fc599acbfeb02", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/5964ea21d292a8275033a1b0612fc599acbfeb02", "committedDate": "2020-11-17T18:44:53Z", "message": "added new dependency to share utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9567d84a81fc938b4cdf886861453e0138c3eae7", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/9567d84a81fc938b4cdf886861453e0138c3eae7", "committedDate": "2020-11-18T17:32:35Z", "message": "moved dependency out to shared utils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNzUzNjQ3", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#pullrequestreview-533753647", "createdAt": "2020-11-18T18:25:51Z", "commit": {"oid": "9567d84a81fc938b4cdf886861453e0138c3eae7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoyNTo1MVrOH18P2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoyNTo1MVrOH18P2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMyMzY3Mw==", "bodyText": "I've been staring at this for a while now and I think it's incorrect? What you're searching for and replacing here is a two-char sequence: a '\\' followed by a '0'. Is that what is needed? Are we getting backslash-zero character sequences from the CCW that we need to strip out?\nOr are we really getting null bytes hiding in strings? If we are, then you'd want to change this to \"\\0\" or perhaps \"\\0x00\", instead. You'd also likely need to update the sample RIF. I'd guess that you'd need to use a hex editor to add the null bytes to the RIF, as I don't think most text editors would let you type them and I don't think CSV/Excel supports fancy escapes like that (though I could be wrong).", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r526323673", "createdAt": "2020-11-18T18:25:51Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -269,4 +270,22 @@ public static Character parseCharacter(String charText) {\n       return Optional.of(parseCharacter(charText));\n     }\n   }\n+\n+  /**\n+   * @param inputString {@link String} that possible contains invalid characters\n+   * @return an {@link String} with a null representation stripped from it if the input has a null\n+   *     field representation.\n+   */\n+  public static String removeInvalidCharacters(String inputString) {\n+    String verifiedInputString = inputString;\n+\n+    // Null Field\n+    String nullFields = \"\\\\0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9567d84a81fc938b4cdf886861453e0138c3eae7"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2251198e52ba41f98fb4483a450ebf780c63f219", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/2251198e52ba41f98fb4483a450ebf780c63f219", "committedDate": "2020-11-18T19:09:43Z", "message": "Added null check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1f0c4aa76c958999764038c1a0e5ee333cb1a22", "author": {"user": {"login": "karlmdavis", "name": "Karl M. Davis"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f1f0c4aa76c958999764038c1a0e5ee333cb1a22", "committedDate": "2020-11-18T20:46:53Z", "message": "Replace \"\\0\" strings in test RIF with null bytes.\n\nAt least, I think I did. I'm bad at this.\n\nBFD-520"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058549d871a0ef810eba8eb82c03ccd208efae71", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/058549d871a0ef810eba8eb82c03ccd208efae71", "committedDate": "2020-11-18T22:15:39Z", "message": "added trim for tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df4cbd5d2511f850dc360480b95ee9ef534ab5af", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/df4cbd5d2511f850dc360480b95ee9ef534ab5af", "committedDate": "2020-11-18T22:31:02Z", "message": "Added trim function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d07dff273e149cbfecf8605ca761cb09d0a8aec", "author": {"user": {"login": "cbrunefearless", "name": "Chris Brune"}}, "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4d07dff273e149cbfecf8605ca761cb09d0a8aec", "committedDate": "2020-11-19T16:04:58Z", "message": "Remove nulls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjgzNjU2", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#pullrequestreview-534683656", "createdAt": "2020-11-19T17:28:27Z", "commit": {"oid": "4d07dff273e149cbfecf8605ca761cb09d0a8aec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NzM5Mzc1", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#pullrequestreview-534739375", "createdAt": "2020-11-19T18:36:23Z", "commit": {"oid": "4d07dff273e149cbfecf8605ca761cb09d0a8aec"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODozNjoyM1rOH2sWeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODozNjoyM1rOH2sWeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzExMTgwMA==", "bodyText": "This really didn't look right to me, based on my reading of Pattern (the \"Backslashes, escapes, and quoting\" section, in particular). However, I was wrong!\nBased on some local testing, both of these code samples work (i.e. print out \"fixed\"):\nThis:\npublic static void main(String[] args) {\n  String valueToFix = \"Howdy!\\u0000\";\n  String valueFixed = valueToFix.replaceAll(\"\\u0000\", \"\");\n  if (valueToFix.contentEquals(valueFixed))\n    System.out.println(\"not fixed\");\n  else\n    System.out.println(\"fixed\");\n}\nAnd this:\npublic static void main(String[] args) {\n  String valueToFix = \"Howdy!\\u0000\";\n  String valueFixed = valueToFix.replaceAll(\"\\\\x00\", \"\");\n  if (valueToFix.contentEquals(valueFixed))\n    System.out.println(\"not fixed\");\n  else\n    System.out.println(\"fixed\");\n}\nI still don't understand why the second one works, but it does. So: neat!", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/399#discussion_r527111800", "createdAt": "2020-11-19T18:36:23Z", "author": {"login": "karlmdavis"}, "path": "apps/bfd-model/bfd-model-rif/src/main/java/gov/cms/bfd/model/rif/parse/RifParsingUtils.java", "diffHunk": "@@ -269,4 +270,20 @@ public static Character parseCharacter(String charText) {\n       return Optional.of(parseCharacter(charText));\n     }\n   }\n+\n+  /**\n+   * @param inputString {@link String} that possible contains invalid characters\n+   * @return an {@link String} with a null representation stripped from it if the input has a null\n+   *     field representation.\n+   */\n+  public static String removeInvalidCharacters(String inputString) {\n+    String verifiedInputString = inputString;\n+\n+    if (!Strings.isNullOrEmpty(verifiedInputString)) {\n+      // remove all NULLs\n+      verifiedInputString = verifiedInputString.replaceAll(\"\\\\x00\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d07dff273e149cbfecf8605ca761cb09d0a8aec"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 529, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}