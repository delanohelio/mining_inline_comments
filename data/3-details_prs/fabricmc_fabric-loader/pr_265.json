{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMjgxNjg5", "number": 265, "title": "Catch all exceptions json deserialization of mod metadata could throw.", "bodyText": "This prevents some more cryptic stack traces like this by actually blaming the mod that broke:\nhttps://gist.github.com/modmuss50/7c13acaed89a56b491430cbb08fd34d4\nOf course this is a tiny fix which may actually be the wrong way to approach it, so comment away.", "createdAt": "2020-06-25T22:08:08Z", "url": "https://github.com/FabricMC/fabric-loader/pull/265", "merged": true, "mergeCommit": {"oid": "f61a14d135b0eb8bd97de2500afa286506890a3f"}, "closed": true, "closedAt": "2020-07-14T12:29:30Z", "author": {"login": "i509VCB"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu2DrCgH2gAyNDQwMjgxNjg5OjAwNzRlNTMzMTlhYjI2OGEyMDM4YTc5YmI4OGEyMmEyZDE1YjQ0OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvh-csAFqTQzODczNDc4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0074e53319ab268a2038a79bb88a22a2d15b448d", "author": {"user": {"login": "i509VCB", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/0074e53319ab268a2038a79bb88a22a2d15b448d", "committedDate": "2020-06-25T22:05:29Z", "message": "Catch all exceptions json deserialization could throw.\n\nThis prevents some more cryptic stack traces like this: https://gist.github.com/modmuss50/7c13acaed89a56b491430cbb08fd34d4\n\n(cherry picked from commit 33a146fb779ccfe1f4c903fcd7ffb218e1fd1b84)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODk0NzM0", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-437894734", "createdAt": "2020-06-25T22:11:45Z", "commit": {"oid": "0074e53319ab268a2038a79bb88a22a2d15b448d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODk2MTUy", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-437896152", "createdAt": "2020-06-25T22:14:45Z", "commit": {"oid": "0074e53319ab268a2038a79bb88a22a2d15b448d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTE0MzA0", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-437914304", "createdAt": "2020-06-25T22:59:31Z", "commit": {"oid": "0074e53319ab268a2038a79bb88a22a2d15b448d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "012a6e360a0d3c1bf68ce016d51544a3acffb20a", "author": {"user": {"login": "i509VCB", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/012a6e360a0d3c1bf68ce016d51544a3acffb20a", "committedDate": "2020-06-26T21:43:14Z", "message": "Add additional throwable catch case for other fun errors.\n\nAlso proper quoting lol for error messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjI2MTY4", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-438626168", "createdAt": "2020-06-26T22:20:23Z", "commit": {"oid": "012a6e360a0d3c1bf68ce016d51544a3acffb20a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDoyM1rOGpwOVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDoyM1rOGpwOVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNDkwMA==", "bodyText": "Imo Errors should not be rethrown as runtime exceptions.", "url": "https://github.com/FabricMC/fabric-loader/pull/265#discussion_r446434900", "createdAt": "2020-06-26T22:20:23Z", "author": {"login": "liach"}, "path": "src/main/java/net/fabricmc/loader/discovery/ModResolver.java", "diffHunk": "@@ -462,11 +462,13 @@ protected void compute() {\n \t\t\ttry (InputStream stream = Files.newInputStream(modJson)) {\n \t\t\t\tinfo = ModMetadataParser.getMods(loader, stream);\n \t\t\t} catch (JsonParseException e) {\n-\t\t\t\tthrow new RuntimeException(\"Mod at '\" + path + \"' has an invalid fabric.mod.json file!\", e);\n+\t\t\t\tthrow new RuntimeException(String.format(\"Mod at \\\"%s\\\" has an invalid fabric.mod.json file!\", path), e);\n \t\t\t} catch (NoSuchFileException e) {\n \t\t\t\tinfo = new LoaderModMetadata[0];\n \t\t\t} catch (IOException e) {\n-\t\t\t\tthrow new RuntimeException(\"Failed to open fabric.mod.json for mod at '\" + path + \"'!\", e);\n+\t\t\t\tthrow new RuntimeException(String.format(\"Failed to open fabric.mod.json for mod at \\\"%s\\\"!\", path), e);\n+\t\t\t} catch (Throwable t) {\n+\t\t\t\tthrow new RuntimeException(String.format(\"Failed to parse mod metadata for mod at \\\"%s\\\"\", path), t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012a6e360a0d3c1bf68ce016d51544a3acffb20a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjU5MjI3", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-438659227", "createdAt": "2020-06-27T01:09:12Z", "commit": {"oid": "012a6e360a0d3c1bf68ce016d51544a3acffb20a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMTowOToxMlrOGpyGPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMTowOToxMlrOGpyGPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2NTU5OQ==", "bodyText": "Just FYI you probably don't need to make any changes to this file as it's all caught in ModResolver.", "url": "https://github.com/FabricMC/fabric-loader/pull/265#discussion_r446465599", "createdAt": "2020-06-27T01:09:12Z", "author": {"login": "AlexIIL"}, "path": "src/main/java/net/fabricmc/loader/metadata/ModMetadataParser.java", "diffHunk": "@@ -51,17 +51,22 @@\n \tprivate static final JsonParser JSON_PARSER = new JsonParser();\n \n \tprivate static LoaderModMetadata getMod(FabricLoader loader, JsonObject object) {\n-\t\tif (!object.has(\"schemaVersion\")) {\n-\t\t\treturn GSON_V0.fromJson(object, ModMetadataV0.class);\n-\t\t} else {\n-\t\t\t//noinspection SwitchStatementWithTooFewBranches\n-\t\t\tswitch (object.get(\"schemaVersion\").getAsInt()) {\n-\t\t\t\tcase 1:\n-\t\t\t\t\treturn GSON_V1.fromJson(object, ModMetadataV1.class);\n-\t\t\t\tdefault:\n-\t\t\t\t\tloader.getLogger().warn(\"Mod ID \" + (object.has(\"id\") ? object.get(\"id\").getAsString() : \"<unknown>\") + \" has invalid schema version: \" + object.get(\"schemaVersion\").getAsInt());\n-\t\t\t\t\treturn null;\n+\t\ttry {\n+\t\t\tif (!object.has(\"schemaVersion\")) {\n+\t\t\t\treturn GSON_V0.fromJson(object, ModMetadataV0.class);\n+\t\t\t} else {\n+\t\t\t\t//noinspection SwitchStatementWithTooFewBranches\n+\t\t\t\tswitch (object.get(\"schemaVersion\").getAsInt()) {\n+\t\t\t\t\tcase 1:\n+\t\t\t\t\t\treturn GSON_V1.fromJson(object, ModMetadataV1.class);\n+\t\t\t\t\tdefault:\n+\t\t\t\t\t\tloader.getLogger().warn(\"Mod ID \" + (object.has(\"id\") ? object.get(\"id\").getAsString() : \"<unknown>\") + \" has invalid schema version: \" + object.get(\"schemaVersion\").getAsInt());\n+\t\t\t\t\t\treturn null;\n+\t\t\t\t}\n \t\t\t}\n+\t\t} catch (Throwable t) {\n+\t\t\t// Catch all exceptions that could occur from parsing metadata and rethrow as JsonSyntaxException.\n+\t\t\tthrow new JsonParseException(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012a6e360a0d3c1bf68ce016d51544a3acffb20a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e49095b63a7399b5cfa7138dc49e35f0808fb67", "author": {"user": {"login": "i509VCB", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/8e49095b63a7399b5cfa7138dc49e35f0808fb67", "committedDate": "2020-06-27T01:38:37Z", "message": "Unnessecary catch go bye byte"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjkxMzkw", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-438691390", "createdAt": "2020-06-27T11:29:58Z", "commit": {"oid": "8e49095b63a7399b5cfa7138dc49e35f0808fb67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzM0Nzg1", "url": "https://github.com/FabricMC/fabric-loader/pull/265#pullrequestreview-438734785", "createdAt": "2020-06-28T01:15:36Z", "commit": {"oid": "8e49095b63a7399b5cfa7138dc49e35f0808fb67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3449, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}