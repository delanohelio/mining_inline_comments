{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NzQyNTE2", "number": 287, "title": "Fix #286 (SemVer pre-release comparison)", "bodyText": "Fix #286\nFix wrong test case\nAlso fix catching incorrect exception in test case\n\nNot sure if pre-release splitting should be moved to SemanticVersionImpl though.\n\nPrecedence for two pre-release versions with the same major, minor, and patch version MUST be determined by comparing each dot separated identifier from left to right until a difference is found as follows:\n\n\n    Identifiers consisting of only digits are compared numerically.\n    Identifiers with letters or hyphens are compared lexically in ASCII sort order.\n    Numeric identifiers always have lower precedence than non-numeric identifiers.\n A larger set of pre-release fields has a higher precedence than a smaller set, if all of the preceding identifiers are equal.", "createdAt": "2020-07-26T12:20:03Z", "url": "https://github.com/FabricMC/fabric-loader/pull/287", "merged": true, "mergeCommit": {"oid": "e8701ee2cb75506ba6a13c193ec969ecfd939a5f"}, "closed": true, "closedAt": "2020-11-14T16:33:05Z", "author": {"login": "Siphalor"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4sNRxAH2gAyNDU2NzQyNTE2OjdlN2I3M2JiNzI2YjBiMmYxNDlhZThkYzA4OGYwN2E0MzExOWVhZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdceSdpAFqTUzMDU4ODI5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7e7b73bb726b0b2f149ae8dc088f07a43119eaf0", "author": {"user": {"login": "Siphalor", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/7e7b73bb726b0b2f149ae8dc088f07a43119eaf0", "committedDate": "2020-07-26T12:16:10Z", "message": "Fix #286 (SemVer pre-release comparison)\n\n* Fix wrong test case\n* Also fix catching incorrect exception in test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f09bb537b892b01fef238ba48e760a83997c93a7", "author": {"user": {"login": "Siphalor", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/f09bb537b892b01fef238ba48e760a83997c93a7", "committedDate": "2020-07-26T12:47:37Z", "message": "Move `compareTo` to SemanticVersionImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38991ed34eee7fba102ecce45f215a15dc2bd8bb", "author": {"user": {"login": "Siphalor", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/38991ed34eee7fba102ecce45f215a15dc2bd8bb", "committedDate": "2020-07-26T12:57:51Z", "message": "Implement SemVer 11.4.3 and 11.4.4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6db307207144c6973b9a0756c49eb3a368067d8", "author": {"user": {"login": "Siphalor", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/e6db307207144c6973b9a0756c49eb3a368067d8", "committedDate": "2020-07-26T12:59:56Z", "message": "Missed a semicolon & more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d24d68fb0ac6972417a0ef56f19d1fa994c4a2e", "author": {"user": {"login": "Siphalor", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/9d24d68fb0ac6972417a0ef56f19d1fa994c4a2e", "committedDate": "2020-07-26T13:08:56Z", "message": "Fix an edge case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mzk0Mjcx", "url": "https://github.com/FabricMC/fabric-loader/pull/287#pullrequestreview-455394271", "createdAt": "2020-07-26T20:48:17Z", "commit": {"oid": "9d24d68fb0ac6972417a0ef56f19d1fa994c4a2e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQyMDo0ODoxOFrOG3PElQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQyMDo0ODoxOFrOG3PElQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU3MTc5Nw==", "bodyText": "IMO this shouldn't rely on parse exceptions, but check explicitly against the spec with a regex like 0|[1-9]\\d*", "url": "https://github.com/FabricMC/fabric-loader/pull/287#discussion_r460571797", "createdAt": "2020-07-26T20:48:18Z", "author": {"login": "sfPlayer1"}, "path": "src/main/java/net/fabricmc/loader/util/version/SemanticVersionImpl.java", "diffHunk": "@@ -215,4 +216,66 @@ public boolean equalsComponentsExactly(SemanticVersionImpl other) {\n \tboolean isPrerelease() {\n \t\treturn prerelease != null;\n \t}\n+\n+\t@Override\n+\tpublic int compareTo(SemanticVersion o) {\n+\t\tfor (int i = 0; i < Math.max(getVersionComponentCount(), o.getVersionComponentCount()); i++) {\n+\t\t\tint first = getVersionComponent(i);\n+\t\t\tint second = o.getVersionComponent(i);\n+\t\t\tif (first == COMPONENT_WILDCARD || second == COMPONENT_WILDCARD) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tint compare = Integer.compare(first, second);\n+\t\t\tif (compare != 0) {\n+\t\t\t\treturn compare;\n+\t\t\t}\n+\t\t}\n+\n+\t\tOptional<String> prereleaseA = getPrereleaseKey();\n+\t\tOptional<String> prereleaseB = o.getPrereleaseKey();\n+\n+\t\tif (prereleaseA.isPresent() || prereleaseB.isPresent()) {\n+\t\t\tif (prereleaseA.isPresent() && prereleaseB.isPresent()) {\n+\t\t\t\tStringTokenizer prereleaseATokenizer = new StringTokenizer(prereleaseA.get(), \".\");\n+\t\t\t\tStringTokenizer prereleaseBTokenizer = new StringTokenizer(prereleaseB.get(), \".\");\n+\n+\t\t\t\twhile (prereleaseATokenizer.hasMoreElements()) {\n+\t\t\t\t\tif (prereleaseBTokenizer.hasMoreElements()) {\n+\t\t\t\t\t\tString partA = prereleaseATokenizer.nextToken();\n+\t\t\t\t\t\tString partB = prereleaseBTokenizer.nextToken();\n+\n+\t\t\t\t\t\tint compare;\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tint numA = Integer.parseUnsignedInt(partA);\n+\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\tint numB = Integer.parseUnsignedInt(partB);\n+\t\t\t\t\t\t\t\tcompare = Integer.compareUnsigned(numA, numB);\n+\t\t\t\t\t\t\t} catch (NumberFormatException e) {\n+\t\t\t\t\t\t\t\tcompare = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d24d68fb0ac6972417a0ef56f19d1fa994c4a2e"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4dd8205d94b8d53c692b9368c5d07eb56851a48", "author": {"user": {"login": "Siphalor", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/c4dd8205d94b8d53c692b9368c5d07eb56851a48", "committedDate": "2020-09-27T13:08:38Z", "message": "Replace exception-based pre-release comparison"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTUzOTMy", "url": "https://github.com/FabricMC/fabric-loader/pull/287#pullrequestreview-530553932", "createdAt": "2020-11-14T04:38:07Z", "commit": {"oid": "c4dd8205d94b8d53c692b9368c5d07eb56851a48"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTg4Mjk1", "url": "https://github.com/FabricMC/fabric-loader/pull/287#pullrequestreview-530588295", "createdAt": "2020-11-14T16:24:26Z", "commit": {"oid": "c4dd8205d94b8d53c692b9368c5d07eb56851a48"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3459, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}