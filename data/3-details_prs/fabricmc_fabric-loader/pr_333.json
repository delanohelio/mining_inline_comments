{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMTMxODQx", "number": 333, "title": "Don't load .jar files which are *nix hidden files", "bodyText": "Fixes #325\nThe gist of the issue is that some *nix operating systems like Mac OS name their metadata .FILE_NAME.jar which loader tries to load and fails.", "createdAt": "2020-11-15T02:13:47Z", "url": "https://github.com/FabricMC/fabric-loader/pull/333", "merged": true, "mergeCommit": {"oid": "2784340f1b0a009d2c016cf76fbc998249c2f801"}, "closed": true, "closedAt": "2020-11-15T13:21:53Z", "author": {"login": "i509VCB"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcmrhtgH2gAyNTIxMTMxODQxOjgzNDVlOWEyYWJlZWJmNGQyOTliOTk0NWI2YjYyOThkZTI1OGUwZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcwLSMgFqTUzMDc5NzY2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8345e9a2abeebf4d299b9945b6b6298de258e0d0", "author": {"user": {"login": "i509VCB", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/8345e9a2abeebf4d299b9945b6b6298de258e0d0", "committedDate": "2020-11-15T02:11:03Z", "message": "Don't load jar files which are *nix hidden files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04cfa9c1fd7c178b92e4b264bd2fec18b29972b9", "author": {"user": {"login": "i509VCB", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/04cfa9c1fd7c178b92e4b264bd2fec18b29972b9", "committedDate": "2020-11-15T02:12:27Z", "message": "doc typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzY2MDg1", "url": "https://github.com/FabricMC/fabric-loader/pull/333#pullrequestreview-530766085", "createdAt": "2020-11-15T04:29:20Z", "commit": {"oid": "04cfa9c1fd7c178b92e4b264bd2fec18b29972b9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwNDoyOToyMFrOHzceOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwNDoyOTo0N1rOHzcecw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcwNTkxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tif (!Files.isHidden(file) && !file.toString().startsWith(\".\") && file.toString().endsWith(\".jar\")) {\n          \n          \n            \n            \t\t\t\t\tString fileName = file.toString();\n          \n          \n            \n            \n          \n          \n            \n            \t\t\t\t\tif (fileName.endsWith(\".jar\") && !fileName.startsWith(\".\") && !Files.isHidden(file)) {\n          \n      \n    \n    \n  \n\nwould be clearer imo.", "url": "https://github.com/FabricMC/fabric-loader/pull/333#discussion_r523705913", "createdAt": "2020-11-15T04:29:20Z", "author": {"login": "sfPlayer1"}, "path": "src/main/java/net/fabricmc/loader/discovery/DirectoryModCandidateFinder.java", "diffHunk": "@@ -51,13 +55,28 @@ public void findCandidates(FabricLoader loader, BiConsumer<URL, Boolean> urlProp\n \t\t}\n \n \t\ttry {\n-\t\t\tFiles.walk(path, 1, FileVisitOption.FOLLOW_LINKS).forEach((modPath) -> {\n-\t\t\t\tif (!Files.isDirectory(modPath) && modPath.toString().endsWith(\".jar\")) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\turlProposer.accept(UrlUtil.asUrl(modPath), requiresRemap);\n-\t\t\t\t\t} catch (UrlConversionException e) {\n-\t\t\t\t\t\tthrow new RuntimeException(\"Failed to convert URL for mod '\" + modPath + \"'!\", e);\n+\t\t\tFiles.walkFileTree(this.path, EnumSet.of(FileVisitOption.FOLLOW_LINKS), 1, new SimpleFileVisitor<Path>() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n+\t\t\t\t\t/*\n+\t\t\t\t\t * We only propose a file as a possible mod in the following scenarios:\n+\t\t\t\t\t * General: Must be a jar file\n+\t\t\t\t\t *\n+\t\t\t\t\t * Some OSes Generate metadata so consider the following because of OSes:\n+\t\t\t\t\t * UNIX: Exclude if file is hidden; this occurs when starting a file name with `.`\n+\t\t\t\t\t * MacOS: Exclude hidden + startsWith \".\" since Mac OS names their metadata files in the form of `.mod.jar`\n+\t\t\t\t\t */\n+\n+\t\t\t\t\tif (!Files.isHidden(file) && !file.toString().startsWith(\".\") && file.toString().endsWith(\".jar\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04cfa9c1fd7c178b92e4b264bd2fec18b29972b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcwNTk3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\treturn super.visitFile(file, attrs);\n          \n          \n            \n            \t\t\t\t\treturn FileVisitResult.CONTINUE;", "url": "https://github.com/FabricMC/fabric-loader/pull/333#discussion_r523705971", "createdAt": "2020-11-15T04:29:47Z", "author": {"login": "sfPlayer1"}, "path": "src/main/java/net/fabricmc/loader/discovery/DirectoryModCandidateFinder.java", "diffHunk": "@@ -51,13 +55,28 @@ public void findCandidates(FabricLoader loader, BiConsumer<URL, Boolean> urlProp\n \t\t}\n \n \t\ttry {\n-\t\t\tFiles.walk(path, 1, FileVisitOption.FOLLOW_LINKS).forEach((modPath) -> {\n-\t\t\t\tif (!Files.isDirectory(modPath) && modPath.toString().endsWith(\".jar\")) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\turlProposer.accept(UrlUtil.asUrl(modPath), requiresRemap);\n-\t\t\t\t\t} catch (UrlConversionException e) {\n-\t\t\t\t\t\tthrow new RuntimeException(\"Failed to convert URL for mod '\" + modPath + \"'!\", e);\n+\t\t\tFiles.walkFileTree(this.path, EnumSet.of(FileVisitOption.FOLLOW_LINKS), 1, new SimpleFileVisitor<Path>() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n+\t\t\t\t\t/*\n+\t\t\t\t\t * We only propose a file as a possible mod in the following scenarios:\n+\t\t\t\t\t * General: Must be a jar file\n+\t\t\t\t\t *\n+\t\t\t\t\t * Some OSes Generate metadata so consider the following because of OSes:\n+\t\t\t\t\t * UNIX: Exclude if file is hidden; this occurs when starting a file name with `.`\n+\t\t\t\t\t * MacOS: Exclude hidden + startsWith \".\" since Mac OS names their metadata files in the form of `.mod.jar`\n+\t\t\t\t\t */\n+\n+\t\t\t\t\tif (!Files.isHidden(file) && !file.toString().startsWith(\".\") && file.toString().endsWith(\".jar\")) {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\turlProposer.accept(UrlUtil.asUrl(file), requiresRemap);\n+\t\t\t\t\t\t} catch (UrlConversionException e) {\n+\t\t\t\t\t\t\tthrow new RuntimeException(\"Failed to convert URL for mod '\" + file + \"'!\", e);\n+\t\t\t\t\t\t}\n \t\t\t\t\t}\n+\n+\t\t\t\t\treturn super.visitFile(file, attrs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04cfa9c1fd7c178b92e4b264bd2fec18b29972b9"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c6ebfc8913514593dc5e35b08105ad08563bd8a", "author": {"user": {"login": "i509VCB", "name": null}}, "url": "https://github.com/FabricMC/fabric-loader/commit/8c6ebfc8913514593dc5e35b08105ad08563bd8a", "committedDate": "2020-11-15T04:43:31Z", "message": "Apply changes from review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzY2NzEx", "url": "https://github.com/FabricMC/fabric-loader/pull/333#pullrequestreview-530766711", "createdAt": "2020-11-15T04:44:38Z", "commit": {"oid": "8c6ebfc8913514593dc5e35b08105ad08563bd8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzk3NjY0", "url": "https://github.com/FabricMC/fabric-loader/pull/333#pullrequestreview-530797664", "createdAt": "2020-11-15T13:14:53Z", "commit": {"oid": "8c6ebfc8913514593dc5e35b08105ad08563bd8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3400, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}