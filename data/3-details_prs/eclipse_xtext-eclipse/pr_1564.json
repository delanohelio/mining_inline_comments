{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NDcwMjgw", "number": 1564, "title": "[#1563] Fixed Line Header Code Minings at Pos 0,0", "bodyText": "[#1563] Fixed Line Header Code Minings at Pos 0,0\nFixes: #1563\nSigned-off-by: Christian Dietrich christian.dietrich@itemis.de", "createdAt": "2020-10-21T11:41:20Z", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564", "merged": true, "mergeCommit": {"oid": "65fe4e776c4c12c2dd9fcefc364f5e64e8c4f33c"}, "closed": true, "closedAt": "2020-10-23T07:46:42Z", "author": {"login": "cdietrich"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUsbdOAFqTUxMzYxNDg1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVRKvpABqjM5MTI0Mzg0ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjE0ODU1", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#pullrequestreview-513614855", "createdAt": "2020-10-21T12:21:32Z", "commit": {"oid": "13102602a8d1e936c0bc02f2a95ee677fcbb57f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13102602a8d1e936c0bc02f2a95ee677fcbb57f1", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/13102602a8d1e936c0bc02f2a95ee677fcbb57f1", "committedDate": "2020-10-21T11:40:55Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}, "afterCommit": {"oid": "31e6c4d9ff33f0df482aa40a8729742ce945feda", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/31e6c4d9ff33f0df482aa40a8729742ce945feda", "committedDate": "2020-10-21T12:30:26Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31e6c4d9ff33f0df482aa40a8729742ce945feda", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/31e6c4d9ff33f0df482aa40a8729742ce945feda", "committedDate": "2020-10-21T12:30:26Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}, "afterCommit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/62259d3a1accd09fa9bc962c1ef9fc1913d1f31b", "committedDate": "2020-10-21T12:44:50Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MzkxOTg4", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#pullrequestreview-515391988", "createdAt": "2020-10-23T06:58:44Z", "commit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjo1ODo0NFrOHnBEnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjo1ODo0NFrOHnBEnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NDA3OQ==", "bodyText": "Futures.getUnchecked(..) may simlify this try-catch and the one below.", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#discussion_r510674079", "createdAt": "2020-10-23T06:58:44Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ui.testing/src/org/eclipse/xtext/ui/testing/AbstractCodeMiningTest.java", "diffHunk": "@@ -74,7 +77,7 @@ protected String insertCodeMinings(XtextEditor editor) {\n \t\tISourceViewer viewer = editor.getInternalSourceViewer();\n \n \t\tString text = editor.getDocument().get();\n-\t\tStringBuilder sb = new StringBuilder();\n+\t\tStringBuilder sb = new StringBuilder(text);\n \n \t\tList<? extends ICodeMining> codeMinings;\n \t\ttry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/62259d3a1accd09fa9bc962c1ef9fc1913d1f31b", "committedDate": "2020-10-21T12:44:50Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}, "afterCommit": {"oid": "1f810664685b2435e911f9f85d95c77debe7328a", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/1f810664685b2435e911f9f85d95c77debe7328a", "committedDate": "2020-10-23T07:04:14Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MzkyNTUz", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#pullrequestreview-515392553", "createdAt": "2020-10-23T06:59:47Z", "commit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjo1OTo0N1rOHnBGUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzowNToxNVrOHnBPkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NDUxNQ==", "bodyText": "Note to self: sort backwards such that traversal starts with the last one", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#discussion_r510674515", "createdAt": "2020-10-23T06:59:47Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ui.testing/src/org/eclipse/xtext/ui/testing/AbstractCodeMiningTest.java", "diffHunk": "@@ -92,45 +95,21 @@ protected String insertCodeMinings(XtextEditor editor) {\n \t\t\tassertTrue(\"CodeMining is not resolved!\", codeMining.isResolved());\n \t\t}\n \n-\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm1.getPosition().getOffset() - cm2.getPosition().getOffset());\n+\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm2.getPosition().getOffset() - cm1.getPosition().getOffset());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NDc3Nw==", "bodyText": "Note to self: Group the sorted minings -> LinkedHashMap maintains the order.", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#discussion_r510674777", "createdAt": "2020-10-23T07:00:21Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ui.testing/src/org/eclipse/xtext/ui/testing/AbstractCodeMiningTest.java", "diffHunk": "@@ -92,45 +95,21 @@ protected String insertCodeMinings(XtextEditor editor) {\n \t\t\tassertTrue(\"CodeMining is not resolved!\", codeMining.isResolved());\n \t\t}\n \n-\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm1.getPosition().getOffset() - cm2.getPosition().getOffset());\n+\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm2.getPosition().getOffset() - cm1.getPosition().getOffset());\n \n-\t\tint currentOffset = 0;\n-\t\tfor (int i = 0; i < codeMinings.size(); i++) {\n-\n-\t\t\tICodeMining codeMining = codeMinings.get(i);\n-\n-\t\t\tint codeMiningOffset = codeMining.getPosition().getOffset();\n-\n-\t\t\tList<ICodeMining> codeMiningsOnTheSameOffset = getCodeMiningsByOffset(codeMinings, codeMiningOffset);\n-\n-\t\t\tString codeMiningsText = getCodeMiningsText(codeMiningsOnTheSameOffset);\n-\n-\t\t\tsb.append(text.substring(currentOffset, codeMiningOffset) + codeMiningsText);\n-\n-\t\t\tcurrentOffset = codeMiningOffset;\n-\t\t\tif (containsLineHeaderCodeMining(codeMiningsOnTheSameOffset)) {\n-\t\t\t\tsb.append(System.lineSeparator());\n-\t\t\t\tcurrentOffset--;\n+\t\tMap<Integer, List<ICodeMining>> byPos = codeMinings.stream().collect(Collectors.groupingBy(e -> e.getPosition().getOffset(), LinkedHashMap::new, Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NTk4Mw==", "bodyText": "Maybe more straight forward to use Multimap.index(codeMinings, e->getPositions().getOffset()) but it's a matter of taste", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#discussion_r510675983", "createdAt": "2020-10-23T07:03:15Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ui.testing/src/org/eclipse/xtext/ui/testing/AbstractCodeMiningTest.java", "diffHunk": "@@ -92,45 +95,21 @@ protected String insertCodeMinings(XtextEditor editor) {\n \t\t\tassertTrue(\"CodeMining is not resolved!\", codeMining.isResolved());\n \t\t}\n \n-\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm1.getPosition().getOffset() - cm2.getPosition().getOffset());\n+\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm2.getPosition().getOffset() - cm1.getPosition().getOffset());\n \n-\t\tint currentOffset = 0;\n-\t\tfor (int i = 0; i < codeMinings.size(); i++) {\n-\n-\t\t\tICodeMining codeMining = codeMinings.get(i);\n-\n-\t\t\tint codeMiningOffset = codeMining.getPosition().getOffset();\n-\n-\t\t\tList<ICodeMining> codeMiningsOnTheSameOffset = getCodeMiningsByOffset(codeMinings, codeMiningOffset);\n-\n-\t\t\tString codeMiningsText = getCodeMiningsText(codeMiningsOnTheSameOffset);\n-\n-\t\t\tsb.append(text.substring(currentOffset, codeMiningOffset) + codeMiningsText);\n-\n-\t\t\tcurrentOffset = codeMiningOffset;\n-\t\t\tif (containsLineHeaderCodeMining(codeMiningsOnTheSameOffset)) {\n-\t\t\t\tsb.append(System.lineSeparator());\n-\t\t\t\tcurrentOffset--;\n+\t\tMap<Integer, List<ICodeMining>> byPos = codeMinings.stream().collect(Collectors.groupingBy(e -> e.getPosition().getOffset(), LinkedHashMap::new, Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62259d3a1accd09fa9bc962c1ef9fc1913d1f31b"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3Njg4MA==", "bodyText": "System.lineSeparator -> ((IDocumentExtension4)editor.getDocument()).getDefaultLineDelimiter()", "url": "https://github.com/eclipse/xtext-eclipse/pull/1564#discussion_r510676880", "createdAt": "2020-10-23T07:05:15Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.ui.testing/src/org/eclipse/xtext/ui/testing/AbstractCodeMiningTest.java", "diffHunk": "@@ -74,63 +77,31 @@ protected String insertCodeMinings(XtextEditor editor) {\n \t\tISourceViewer viewer = editor.getInternalSourceViewer();\n \n \t\tString text = editor.getDocument().get();\n-\t\tStringBuilder sb = new StringBuilder();\n+\t\tStringBuilder sb = new StringBuilder(text);\n \n \t\tList<? extends ICodeMining> codeMinings;\n-\t\ttry {\n-\t\t\tcodeMinings = codeMiningProvider.provideCodeMinings(viewer, new NullProgressMonitor()).get();\n-\t\t} catch (InterruptedException | ExecutionException e) {\n-\t\t\tthrow new RuntimeException(e);\n-\t\t}\n+\t\tcodeMinings = Futures.getUnchecked(codeMiningProvider.provideCodeMinings(viewer, new NullProgressMonitor()));\n \n \t\tfor (ICodeMining codeMining : codeMinings) {\n-\t\t\ttry {\n-\t\t\t\tcodeMining.resolve(viewer, new NullProgressMonitor()).get();\n-\t\t\t} catch (InterruptedException | ExecutionException e) {\n-\t\t\t\tthrow new RuntimeException(e);\n-\t\t\t}\n+\t\t\tFutures.getUnchecked(codeMining.resolve(viewer, new NullProgressMonitor()));\n \t\t\tassertTrue(\"CodeMining is not resolved!\", codeMining.isResolved());\n \t\t}\n \n-\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm1.getPosition().getOffset() - cm2.getPosition().getOffset());\n-\n-\t\tint currentOffset = 0;\n-\t\tfor (int i = 0; i < codeMinings.size(); i++) {\n-\n-\t\t\tICodeMining codeMining = codeMinings.get(i);\n+\t\tcodeMinings.sort((ICodeMining cm1, ICodeMining cm2) -> cm2.getPosition().getOffset() - cm1.getPosition().getOffset());\n \n-\t\t\tint codeMiningOffset = codeMining.getPosition().getOffset();\n-\n-\t\t\tList<ICodeMining> codeMiningsOnTheSameOffset = getCodeMiningsByOffset(codeMinings, codeMiningOffset);\n-\n-\t\t\tString codeMiningsText = getCodeMiningsText(codeMiningsOnTheSameOffset);\n-\n-\t\t\tsb.append(text.substring(currentOffset, codeMiningOffset) + codeMiningsText);\n-\n-\t\t\tcurrentOffset = codeMiningOffset;\n-\t\t\tif (containsLineHeaderCodeMining(codeMiningsOnTheSameOffset)) {\n-\t\t\t\tsb.append(System.lineSeparator());\n-\t\t\t\tcurrentOffset--;\n+\t\tMap<Integer, List<ICodeMining>> byPos = codeMinings.stream().collect(Collectors.groupingBy(e -> e.getPosition().getOffset(), LinkedHashMap::new, Collectors.toList()));\n+\t\tfor (Entry<Integer, List<ICodeMining>> e : byPos.entrySet()) {\n+\t\t\tint codeMiningOffset = e.getKey();\n+\t\t\tList<ICodeMining> miningsAtOffset = e.getValue();\n+\t\t\tString codeMiningsText = getCodeMiningsText(miningsAtOffset);\n+\t\t\tif (containsLineHeaderCodeMining(miningsAtOffset)) {\n+\t\t\t\tsb.insert(codeMiningOffset, System.lineSeparator());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f810664685b2435e911f9f85d95c77debe7328a"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09075f9b14cb9902a6e15900f52989963167eaca", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/09075f9b14cb9902a6e15900f52989963167eaca", "committedDate": "2020-10-23T07:09:38Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f810664685b2435e911f9f85d95c77debe7328a", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/1f810664685b2435e911f9f85d95c77debe7328a", "committedDate": "2020-10-23T07:04:14Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}, "afterCommit": {"oid": "09075f9b14cb9902a6e15900f52989963167eaca", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/09075f9b14cb9902a6e15900f52989963167eaca", "committedDate": "2020-10-23T07:09:38Z", "message": "[#1563] Fixed Line Header Code Minings at Pos 0,0\n\nFixes: #1563\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4461, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}