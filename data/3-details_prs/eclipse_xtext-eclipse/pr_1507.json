{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1Mzk4MjQz", "number": 1507, "title": "Porting quickfixes for illegal rule references", "bodyText": "Enhanced the quick-fix to handle the case where a terminal-fragment is referenced as a hidden token in a Parser rule definition\nAdded method createChangeToIssueResolution() to avoid duplicate 'Change to' quick-fix if there are multiple/different fixes for an issue\nAdded quick-fix method fixUnresolvedEnumRule()\nAdded unit-tests.\n\nSigned-off-by: nbhusare neerajbhusare@gmail.com", "createdAt": "2020-08-10T09:55:30Z", "url": "https://github.com/eclipse/xtext-eclipse/pull/1507", "merged": true, "mergeCommit": {"oid": "9c929d1959705a618d852d502f3a6669ac5c6361"}, "closed": true, "closedAt": "2020-08-28T08:06:03Z", "author": {"login": "nbhusare"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9gj8UgBqjM2MzgzNDY5NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCU5YwABqjM2ODk0NzI4Mzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1a7e96e146134ee1c83f182c7c49eada9ca3745", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/b1a7e96e146134ee1c83f182c7c49eada9ca3745", "committedDate": "2020-08-10T09:53:19Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "b3949ed2d9eee1215d2374cfc809792b7b53a9ef", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/b3949ed2d9eee1215d2374cfc809792b7b53a9ef", "committedDate": "2020-08-10T11:31:17Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3949ed2d9eee1215d2374cfc809792b7b53a9ef", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/b3949ed2d9eee1215d2374cfc809792b7b53a9ef", "committedDate": "2020-08-10T11:31:17Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9", "committedDate": "2020-08-10T13:58:54Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTg2ODU4", "url": "https://github.com/eclipse/xtext-eclipse/pull/1507#pullrequestreview-473186858", "createdAt": "2020-08-24T07:36:39Z", "commit": {"oid": "f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNzozNjo0MFrOHFX-KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNzo0MTozMFrOHFYH0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5NzY3Mw==", "bodyText": "Hmm a terminal fragment does not make much sense here, but I prefer to adjust this in a subsequent step to move this change forward. What do you think?", "url": "https://github.com/eclipse/xtext-eclipse/pull/1507#discussion_r475397673", "createdAt": "2020-08-24T07:36:40Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.ui.tests/src/org/eclipse/xtext/xtext/ui/editor/quickfix/XtextGrammarQuickfixTest.xtend", "diffHunk": "@@ -24,27 +24,156 @@ import static org.eclipse.xtext.xtext.XtextConfigurableIssueCodes.SPACES_IN_KEYW\n @RunWith(XtextRunner)\n @InjectWith(XtextUiInjectorProvider)\n class XtextGrammarQuickfixTest extends AbstractQuickfixTest {\n-\n-\t@Test def test_fix_missing_rule() {\n+\t\n+\t@Test def test_convert_terminal_fragment_to_terminal_rule() {\n+\t\t'''\n+\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\n+\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\n+\t\t\tModel hidden(ABC):\n+\t\t\t\ta = ID;\n+\t\t\t\n+\t\t\tterminal fragment ABC:\n+\t\t\t\t'a';\n+\t\t'''.testQuickfixesOn(\n+\t\t\t\"org.eclipse.xtext.grammar.InvalidHiddenTokenFragment\",\n+\t\t\tnew Quickfix(\"Convert terminal fragment to terminal rule\", \"Convert terminal fragment to terminal rule\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel hidden(ABC):\n+\t\t\t\t\ta = ID;\n+\t\t\t\t\n+\t\t\t\tterminal ABC:\n+\t\t\t\t\t'a';\n+\t\t\t'''),\n+\t\t\tnew Quickfix(\"Remove hidden token definition\", \"Remove hidden token definition\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel hidden():\n+\t\t\t\t\ta = ID;\n+\t\t\t\t\n+\t\t\t\tterminal fragment ABC:\n+\t\t\t\t\t'a';\n+\t\t\t''')\n+\t\t);\n+\t}\n+\t\n+\t@Test def test_convert_terminal_fragment_to_terminal_rule_01() {\n \t\t'''\n \t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n \t\t\t\n \t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n \t\t\t\n \t\t\tModel:\n-\t\t\t\tgreetings+=Greeting*;\n+\t\t\t\ta = ABC;\n+\t\t\t\n+\t\t\tterminal fragment ABC:\n+\t\t\t\t'a';\n+\t\t'''.testQuickfixesOn(\n+\t\t\t\"org.eclipse.xtext.grammar.InvalidTerminalFragmentRuleReference\",\n+\t\t\tnew Quickfix(\"Convert terminal fragment to terminal rule\", \"Convert terminal fragment to terminal rule\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel:\n+\t\t\t\t\ta = ABC;\n+\t\t\t\t\n+\t\t\t\tterminal ABC:\n+\t\t\t\t\t'a';\n+\t\t\t''')\n+\t\t);\n+\t}\n+\n+\t@Test def test_fix_invalid_hidden_token() {\n+\t\t'''\n+\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\n+\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\n+\t\t\tModel hidden(AnotherModel):\n+\t\t\t\ta = ID;\n+\t\t\t\n+\t\t\tAnotherModel:\n+\t\t\t\tb = ID;\n+\t\t'''.testQuickfixesOn(\n+\t\t\t\"org.eclipse.xtext.grammar.InvalidHiddenToken\",\n+\t\t\tnew Quickfix(\"Remove hidden token definition\", \"Remove hidden token definition\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel hidden():\n+\t\t\t\t\ta = ID;\n+\t\t\t\t\n+\t\t\t\tAnotherModel:\n+\t\t\t\t\tb = ID;\n+\t\t\t''')\n+\t\t);\n+\t}\n+\n+\t@Test def test_fix_missing_rule() {\n \t\t'''\n-\t\t.testQuickfixesOn(\"org.eclipse.xtext.grammar.UnresolvedRule\", new Quickfix(\"Create rule 'Greeting'\", \"Create rule 'Greeting'\", '''\n \t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n \t\t\t\n \t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n \t\t\t\n \t\t\tModel:\n \t\t\t\tgreetings+=Greeting*;\n-\t\t\t\n-\t\t\tGreeting:\n+\t\t'''.testQuickfixesOn(\n+\t\t\t\"org.eclipse.xtext.grammar.UnresolvedRule\",\n+\t\t\tnew Quickfix(\"Create rule 'Greeting'\", \"Create rule 'Greeting'\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel:\n+\t\t\t\t\tgreetings+=Greeting*;\n+\t\t\t\t\n+\t\t\t\tGreeting:\n+\t\t\t\t\t\n+\t\t\t\t;\n+\t\t\t'''),\n+\t\t\tnew Quickfix(\"Create enum rule 'Greeting'\", \"Create enum rule 'Greeting'\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel:\n+\t\t\t\t\tgreetings+=Greeting*;\n+\t\t\t\t\n+\t\t\t\tenum Greeting:\n+\t\t\t\t\t\n+\t\t\t\t;\n+\t\t\t'''),\n+\t\t\tnew Quickfix(\"Create terminal 'Greeting'\", \"Create terminal 'Greeting'\", '''\n+\t\t\t\tgrammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals\n+\t\t\t\t\n+\t\t\t\tgenerate myDsl \"http://www.xtext.org/example/mydsl/MyDsl\"\n+\t\t\t\t\n+\t\t\t\tModel:\n+\t\t\t\t\tgreetings+=Greeting*;\n+\t\t\t\t\n+\t\t\t\tterminal Greeting:\n+\t\t\t\t\t\n+\t\t\t\t;\n+\t\t\t'''),\n+\t\t\tnew Quickfix(\"Create terminal fragment 'Greeting'\", \"Create terminal fragment 'Greeting'\", '''", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwMDE0Ng==", "bodyText": "I'm aware that this is code has been like this for ages: If we figure that we should have another round on this, it could be worthwhile to use the org.eclipse.xtext.formatting.IIndentationInformation instead of the hardcoded \\t (tab) character", "url": "https://github.com/eclipse/xtext-eclipse/pull/1507#discussion_r475400146", "createdAt": "2020-08-24T07:41:30Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.ui/src/org/eclipse/xtext/xtext/ui/editor/quickfix/XtextGrammarQuickfixProvider.java", "diffHunk": "@@ -687,17 +709,14 @@ public void fixInvalidHiddenToken(Issue issue, IssueResolutionAcceptor acceptor)\n \t\t\t\t});\n \t}\n \n-\tprivate ISemanticModification createNewRule(String ruleName, boolean isFragment) {\n+\tprivate ISemanticModification createNewRule(String ruleName, String ruleType) {\n \t\treturn (element, context) -> {\n \t\t\tAbstractRule abstractRule = EcoreUtil2.getContainerOfType(element, AbstractRule.class);\n \t\t\tICompositeNode node = NodeModelUtils.getNode(abstractRule);\n \t\t\tString nl = context.getXtextDocument().getLineDelimiter(0);\n \t\t\tStringBuilder builder = new StringBuilder(nl + nl);\n-\t\t\tif (abstractRule instanceof TerminalRule) {\n-\t\t\t\tbuilder.append(\"terminal \");\n-\t\t\t\tif (isFragment) {\n-\t\t\t\t\tbuilder.append(\"fragment \");\n-\t\t\t\t}\n+\t\t\tif (ruleType != null) {\n+\t\t\t\tbuilder.append(ruleType);\n \t\t\t}\n \t\t\tString newRule = builder.append(ruleName).append(\":\" + nl + \"\\t\" + nl + \";\").toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMjA4MTc5", "url": "https://github.com/eclipse/xtext-eclipse/pull/1507#pullrequestreview-473208179", "createdAt": "2020-08-24T08:08:24Z", "commit": {"oid": "f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5238df76b35ed54f20e30795c34d0b6a93a0700", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/f5238df76b35ed54f20e30795c34d0b6a93a0700", "committedDate": "2020-08-25T10:45:23Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/f7c49672f79b79497fd5fa2f6a819bfb9be5b4a9", "committedDate": "2020-08-10T13:58:54Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "f5238df76b35ed54f20e30795c34d0b6a93a0700", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/f5238df76b35ed54f20e30795c34d0b6a93a0700", "committedDate": "2020-08-25T10:45:23Z", "message": "Porting quickfixes for illegal rule references\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4439, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}