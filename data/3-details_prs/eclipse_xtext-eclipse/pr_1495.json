{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NzcwNjk2", "number": 1495, "title": "[#1494] fixed race condition on loading the Xtext index from multiple threads", "bodyText": "[#1494] fixed race condition on loading the Xtext index from multiple threads\nSigned-off-by: Christian Dietrich christian.dietrich@itemis.de", "createdAt": "2020-07-28T12:16:09Z", "url": "https://github.com/eclipse/xtext-eclipse/pull/1495", "merged": true, "mergeCommit": {"oid": "36a7e6ffa491869c029c6ea07d027bfb3df253c8"}, "closed": true, "closedAt": "2020-07-29T05:58:13Z", "author": {"login": "cdietrich"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5WuXLgFqTQ1NjY0ODYzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5j14rABqjM1OTcyNzczNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjQ4NjMx", "url": "https://github.com/eclipse/xtext-eclipse/pull/1495#pullrequestreview-456648631", "createdAt": "2020-07-28T13:48:19Z", "commit": {"oid": "1f35f9fd1e4aec38e42834104d3ca31c3ff60a66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzo0ODoxOVrOG4NcCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzo0ODoxOVrOG4NcCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU5MzYwOA==", "bodyText": "If I'm not mistake, the lock should be aquired before the try block. Otherwise we'll try to release something in the finally block, if the acquisition failed from some reason.", "url": "https://github.com/eclipse/xtext-eclipse/pull/1495#discussion_r461593608", "createdAt": "2020-07-28T13:48:19Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/builderState/AbstractBuilderState.java", "diffHunk": "@@ -68,17 +70,26 @@\n \tprivate WorkspaceLockAccess workspaceLockAccess;\n \n \tprivate volatile boolean isLoaded = false;\n+\t\n+\tfinal ILock lock = Job.getJobManager().newLock();\n \n \tpublic void load() {\n \t\tif (!isLoaded) {\n \t\t\tIWorkspaceRunnable runnable = new IWorkspaceRunnable() {\n \t\t\t\t@Override\n \t\t\t\tpublic void run(IProgressMonitor monitor) throws CoreException {\n \t\t\t\t\tif (!isLoaded) {\n-\t\t\t\t\t\tresourceDescriptionData = new ResourceDescriptionsData(persister.load());\n-\t\t\t\t\t\tif(storage2UriMapper instanceof IStorage2UriMapperExtension)\n-\t\t\t\t\t\t\t((IStorage2UriMapperExtension) storage2UriMapper).initializeCache();\n-\t\t\t\t\t\tisLoaded = true;\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tlock.acquire();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f35f9fd1e4aec38e42834104d3ca31c3ff60a66"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjUyMDQ0", "url": "https://github.com/eclipse/xtext-eclipse/pull/1495#pullrequestreview-456652044", "createdAt": "2020-07-28T13:51:53Z", "commit": {"oid": "1f35f9fd1e4aec38e42834104d3ca31c3ff60a66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9499419fb7d1c26a3d8b496a7cc3b235fe3079d", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/a9499419fb7d1c26a3d8b496a7cc3b235fe3079d", "committedDate": "2020-07-29T05:05:04Z", "message": "[#1494] fixed race condition on loading the Xtext index from multiple threads\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f35f9fd1e4aec38e42834104d3ca31c3ff60a66", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/1f35f9fd1e4aec38e42834104d3ca31c3ff60a66", "committedDate": "2020-07-28T12:15:30Z", "message": "[#1494] fixed race condition on loading the Xtext index from multiple threads\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}, "afterCommit": {"oid": "a9499419fb7d1c26a3d8b496a7cc3b235fe3079d", "author": {"user": {"login": "cdietrich", "name": "Christian Dietrich"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/a9499419fb7d1c26a3d8b496a7cc3b235fe3079d", "committedDate": "2020-07-29T05:05:04Z", "message": "[#1494] fixed race condition on loading the Xtext index from multiple threads\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4435, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}