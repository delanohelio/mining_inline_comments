{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NzY3OTc1", "number": 1487, "title": "Add new Xtext editor quickfixes on *.xtext files", "bodyText": "Provide quick-fixes for illegal rule references (see #331943)\n Provide quick-fixes for illegal hidden token definitions (see #331942)\n Provide more quick-fixes for missing rules (see #331941)\n\nSigned-off-by: nbhusare neerajbhusare@gmail.com", "createdAt": "2020-07-06T13:15:54Z", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487", "merged": true, "mergeCommit": {"oid": "e66347ddc71507b75b222ee54fcab6477ab84a2f"}, "closed": true, "closedAt": "2020-07-14T11:04:13Z", "author": {"login": "nbhusare"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcygQiJgFqTQ0MzYwOTk4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0zVufABqjM1NDM1MDk4MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjA5OTgx", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#pullrequestreview-443609981", "createdAt": "2020-07-07T06:57:19Z", "commit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNjo1NzoxOVrOGtxbQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNjo1NzoxOVrOGtxbQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0ODg5Nw==", "bodyText": "Do we also get the Convert terminal fragment to terminal rule quickfix for this case?", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#discussion_r450648897", "createdAt": "2020-07-07T06:57:19Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.ui.tests/src/org/eclipse/xtext/xtext/ui/editor/quickfix/XtextGrammarQuickfixProviderTest.java", "diffHunk": "@@ -184,6 +184,30 @@ public void fixAddActionForGrammarWithAlias() throws Exception {\n \t\t\t\t\"Add actions to ensure object creation\");\n \t}\n \n+\t@Test\n+\tpublic void testConvertTerminalFragmentToTerminalRule() throws Exception {\n+\t\tassertAndApplySingleResolution(editorForGrammar(\"Model: digit=ABC;\", \"terminal fragment ABC: '0'..'9';\"),\n+\t\t\t\tINVALID_TERMINAL_FRAGMENT_RULE_REFERENCE, 0, \"Convert terminal fragment to terminal rule\");\n+\t}\n+\n+\t@Test\n+\tpublic void testFixInvalidTerminalFragmentHiddenToken() throws Exception {\n+\t\tassertAndApplySingleResolution(editorForGrammar(\"Model hidden(ABC): a=ID;\", \"terminal fragment ABC: '0'..'9';\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjEwNTc5", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#pullrequestreview-443610579", "createdAt": "2020-07-07T06:58:23Z", "commit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNjo1ODoyM1rOGtxdLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNjo1ODoyM1rOGtxdLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0OTM5MA==", "bodyText": "Please reword to Create terminal fragment instead of Create terminal fragment rule", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#discussion_r450649390", "createdAt": "2020-07-07T06:58:23Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.ui/src/org/eclipse/xtext/xtext/ui/editor/quickfix/XtextGrammarQuickfixProvider.java", "diffHunk": "@@ -134,24 +137,39 @@\n \t@Inject\n \tprivate ILineSeparatorInformation separatorInfo;\n \t\n+\t@Inject\n+\tprivate XtextGrammarAccess grammarAccess;\n+\t\n \t@Fix(XtextLinkingDiagnosticMessageProvider.UNRESOLVED_RULE)\n \tpublic void fixUnresolvedRule(final Issue issue, IssueResolutionAcceptor acceptor) {\n \t\tfinal String ruleName = issue.getData()[0];\n-\t\tacceptor.accept(issue, \"Create rule '\" + ruleName + \"'\", \"Create rule '\" + ruleName + \"'\", NULL_QUICKFIX_IMAGE,\n-\t\t\t\tnew ISemanticModification() {\n-\t\t\t\t\t@Override\n-\t\t\t\t\tpublic void apply(final EObject element, IModificationContext context) throws BadLocationException {\n-\t\t\t\t\t\tAbstractRule abstractRule = EcoreUtil2.getContainerOfType(element, ParserRule.class);\n-\t\t\t\t\t\tICompositeNode node = NodeModelUtils.getNode(abstractRule);\n-\t\t\t\t\t\tint offset = node.getEndOffset();\n-\t\t\t\t\t\tString nl = context.getXtextDocument().getLineDelimiter(0);\n-\t\t\t\t\t\tStringBuilder builder = new StringBuilder(nl+nl);\n-\t\t\t\t\t\tif (abstractRule instanceof TerminalRule)\n-\t\t\t\t\t\t\tbuilder.append(\"terminal \");\n-\t\t\t\t\t\tString newRule = builder.append(ruleName).append(\":\" + nl + \"\\t\" + nl + \";\").toString();\n-\t\t\t\t\t\tcontext.getXtextDocument().replace(offset, 0, newRule);\n-\t\t\t\t\t}\n-\t\t\t\t});\n+\t\tacceptor.accept(issue, // \n+\t\t\t\t\"Create rule '\" + ruleName + \"'\", //\n+\t\t\t\t\"Create rule '\" + ruleName + \"'\", //\n+\t\t\t\tNULL_QUICKFIX_IMAGE, //\n+\t\t\t\tcreateNewRule(ruleName, false));\n+\t\tcreateLinkingIssueResolutions(issue, acceptor);\n+\t}\n+\n+\t@Fix(XtextLinkingDiagnosticMessageProvider.UNRESOLVED_TERMINAL_RULE)\n+\tpublic void fixUnresolvedTerminalRule(final Issue issue, IssueResolutionAcceptor acceptor) {\n+\t\tfinal String ruleName = issue.getData()[0];\n+\t\tacceptor.accept(issue, //\n+\t\t\t\t\"Create terminal rule '\" + ruleName + \"'\", // \n+\t\t\t\t\"Create terminal rule '\" + ruleName + \"'\", //\n+\t\t\t\tNULL_QUICKFIX_IMAGE, //\n+\t\t\t\tcreateNewRule(ruleName, false));\n+\t\tcreateLinkingIssueResolutions(issue, acceptor);\n+\t}\n+\t\n+\t@Fix(XtextLinkingDiagnosticMessageProvider.UNRESOLVED_TERMINAL_RULE)\n+\tpublic void fixUnresolvedTerminalFragmentRule(final Issue issue, IssueResolutionAcceptor acceptor) {\n+\t\tfinal String ruleName = issue.getData()[0];\n+\t\tacceptor.accept(issue, //\n+\t\t\t\t\"Create terminal fragment rule '\" + ruleName + \"'\", // ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjExMzc4", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#pullrequestreview-443611378", "createdAt": "2020-07-07T06:59:43Z", "commit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNjo1OTo0M1rOGtxfag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNjo1OTo0M1rOGtxfag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0OTk2Mg==", "bodyText": "I know that it is extremely unlikely to have that in production, but could you please add a test with this rule declaration:\nterminal fragment/*comment*/FRAG: 'a';", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#discussion_r450649962", "createdAt": "2020-07-07T06:59:43Z", "author": {"login": "szarnekow"}, "path": "org.eclipse.xtext.xtext.ui/src/org/eclipse/xtext/xtext/ui/editor/quickfix/XtextGrammarQuickfixProvider.java", "diffHunk": "@@ -599,5 +617,75 @@ private void applyToNode(AbstractElement node, String actionText, MultiTextEdit\n \t\t\t\t\t}\n \t\t\t\t});\n \t}\n+\t\n+\t@Fix(INVALID_TERMINAL_FRAGMENT_RULE_REFERENCE)\n+\tpublic void fixConvertTerminalFragmentToTerminalRule(Issue issue, IssueResolutionAcceptor acceptor) {\n+\t\tacceptor.accept(issue, //\n+\t\t\t\t\"Convert terminal fragment to terminal rule\", //\n+\t\t\t\t\"Convert terminal fragment to terminal rule\", //\n+\t\t\t\tNULL_QUICKFIX_IMAGE, //\n+\t\t\t\t(context) -> {\n+\t\t\t\t\tIXtextDocument xtextDocument = context.getXtextDocument();\n+\t\t\t\t\txtextDocument.modify(new IUnitOfWork.Void<XtextResource>() {\n+\n+\t\t\t\t\t\t@Override\n+\t\t\t\t\t\tpublic void process(XtextResource state) throws Exception {\n+\t\t\t\t\t\t\tif (state == null) {\n+\t\t\t\t\t\t\t\treturn;\n+\t\t\t\t\t\t\t}\n+\n+\t\t\t\t\t\t\tRuleCall ruleCall = (RuleCall) state.getEObject(issue.getUriToProblem().fragment());\n+\t\t\t\t\t\t\tICompositeNode ruleNode = NodeModelUtils.findActualNodeFor(ruleCall.getRule());\n+\t\t\t\t\t\t\tfor (INode node : ruleNode.getAsTreeIterable()) {\n+\t\t\t\t\t\t\t\tif (node.getGrammarElement() != null && node.getGrammarElement() == grammarAccess.getTerminalRuleAccess()\n+\t\t\t\t\t\t\t\t\t\t.getFragmentFragmentKeyword_2_0_0_0()) {\n+\t\t\t\t\t\t\t\t\tITextRegion fragmentRegion = node.getTextRegion();\n+\t\t\t\t\t\t\t\t\txtextDocument.replace(fragmentRegion.getOffset(), fragmentRegion.getLength() + 1, \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjEyMTQ3", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#pullrequestreview-443612147", "createdAt": "2020-07-07T07:01:05Z", "commit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dbf31822fc6944ac2a4579d8d6225d01732f4c1", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/7dbf31822fc6944ac2a4579d8d6225d01732f4c1", "committedDate": "2020-07-06T13:13:56Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "61c110e5777fed7f2df21cb0dfe5ceb36ac9c639", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/61c110e5777fed7f2df21cb0dfe5ceb36ac9c639", "committedDate": "2020-07-13T09:14:37Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61c110e5777fed7f2df21cb0dfe5ceb36ac9c639", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/61c110e5777fed7f2df21cb0dfe5ceb36ac9c639", "committedDate": "2020-07-13T09:14:37Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "481f1641a63c53cb8ab8de10d8924cd0be9f0e7e", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/481f1641a63c53cb8ab8de10d8924cd0be9f0e7e", "committedDate": "2020-07-13T09:29:53Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDg4MjAx", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#pullrequestreview-447088201", "createdAt": "2020-07-13T09:34:33Z", "commit": {"oid": "481f1641a63c53cb8ab8de10d8924cd0be9f0e7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MTE2NDM5", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#pullrequestreview-447116439", "createdAt": "2020-07-13T10:11:41Z", "commit": {"oid": "481f1641a63c53cb8ab8de10d8924cd0be9f0e7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMDoxMTo0MVrOGwiGSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMDoxMTo0MVrOGwiGSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU0MzQ5OA==", "bodyText": "wonder if you sould reference a newer one here\nhttps://ci.eclipse.org/xtext/job/xtext-core/view/change-requests/job/PR-1540/lastSuccessfulBuild/artifact/build/p2-repository/", "url": "https://github.com/eclipse/xtext-eclipse/pull/1487#discussion_r453543498", "createdAt": "2020-07-13T10:11:41Z", "author": {"login": "cdietrich"}, "path": "releng/org.eclipse.xtext.target/org.eclipse.xtext.target-oxygen.target", "diffHunk": "@@ -32,7 +32,7 @@\n \t\t<unit id=\"org.eclipse.xtext.testlanguages.ide.source\" version=\"0.0.0\"/>\n \t\t<unit id=\"org.eclipse.xtext.tests\" version=\"0.0.0\"/>\n \t\t<unit id=\"org.eclipse.xtext.tests.source\" version=\"0.0.0\"/>\n-\t\t<repository location=\"https://ci.eclipse.org/xtext/job/xtext-core/job/master/lastStableBuild/artifact/build/p2-repository/\"/>\n+\t\t<repository location=\"https://ci.eclipse.org/xtext/job/xtext-core/job/PR-1540/1/artifact/build/p2-repository/\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "481f1641a63c53cb8ab8de10d8924cd0be9f0e7e"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "481f1641a63c53cb8ab8de10d8924cd0be9f0e7e", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/481f1641a63c53cb8ab8de10d8924cd0be9f0e7e", "committedDate": "2020-07-13T09:29:53Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "5cf29dd8c1bb183487671cc7537654ea0da52619", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/5cf29dd8c1bb183487671cc7537654ea0da52619", "committedDate": "2020-07-13T10:22:38Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5cf29dd8c1bb183487671cc7537654ea0da52619", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/5cf29dd8c1bb183487671cc7537654ea0da52619", "committedDate": "2020-07-13T10:22:38Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "d37c35c79acc9011332d2f3b037ecec70de31453", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/d37c35c79acc9011332d2f3b037ecec70de31453", "committedDate": "2020-07-13T11:19:05Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d37c35c79acc9011332d2f3b037ecec70de31453", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/d37c35c79acc9011332d2f3b037ecec70de31453", "committedDate": "2020-07-13T11:19:05Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "fafc7cde73c4fd306a5647f00ab638c945437b32", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/fafc7cde73c4fd306a5647f00ab638c945437b32", "committedDate": "2020-07-14T06:07:46Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fafc7cde73c4fd306a5647f00ab638c945437b32", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/fafc7cde73c4fd306a5647f00ab638c945437b32", "committedDate": "2020-07-14T06:07:46Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "8a84e5e15774b5f3f7143e845b7a558692065de6", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/8a84e5e15774b5f3f7143e845b7a558692065de6", "committedDate": "2020-07-14T07:05:57Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9579363ad5ad86791598bb9c25956d6a9cae61d7", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/9579363ad5ad86791598bb9c25956d6a9cae61d7", "committedDate": "2020-07-14T10:18:10Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a84e5e15774b5f3f7143e845b7a558692065de6", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/8a84e5e15774b5f3f7143e845b7a558692065de6", "committedDate": "2020-07-14T07:05:57Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}, "afterCommit": {"oid": "9579363ad5ad86791598bb9c25956d6a9cae61d7", "author": {"user": {"login": "nbhusare", "name": "Neeraj Bhusare"}}, "url": "https://github.com/eclipse/xtext-eclipse/commit/9579363ad5ad86791598bb9c25956d6a9cae61d7", "committedDate": "2020-07-14T10:18:10Z", "message": "Fix broken cross-references\nQUick fix for illegal hidden token definition\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4564, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}