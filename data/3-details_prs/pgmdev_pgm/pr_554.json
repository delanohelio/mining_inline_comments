{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MjUzNDg5", "number": 554, "title": "Rework /vote logic", "bodyText": "Rework /vote logic\nThis PR started out as a new command (/vote fill) but has since removed that command in favor of implementing both a Replacement and Override selection mode.\nReplacement\nWhen vote selection is in the replacement mode, maps added to the selection will replace maps that are provided by the current pool.\nExample:\nLet\u2019s say we wanted to add three maps to the vote The Nile, Ozone, and Sand Wars. Since three maps are added, two will be provided based on the pool.\nUsing /vote list (As you can see, there is now an indicator of what mode is active, in this case Replace)\n\nWhen the vote is ready, you\u2019ll notice that 2 additional maps from the current pool were added.\n\nCreate\nCreate preserves the current functionality, where the selected maps will be the only  maps provided in the poll.\nUsing /vote list again, we can see the three selected maps. Also pictured is the hover message that is displayed over the mode indicator. Note: you can click the status to run /vote mode to toggle the mode.\n\nWhen the vote is ready, only the selected maps will be visible.\n\nAlso here is the formatting used when executing /vote mode twice.\n\nSigned-off-by: applenick applenick@users.noreply.github.com", "createdAt": "2020-07-07T08:38:47Z", "url": "https://github.com/PGMDev/PGM/pull/554", "merged": true, "mergeCommit": {"oid": "632ddd1b670cf5875713570347b1fd4807788d03"}, "closed": true, "closedAt": "2020-07-11T23:06:50Z", "author": {"login": "applenick"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyhy8AAFqTQ0MzY4NTY5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0AhLZgFqTQ0NjgzNDI2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjg1Njk2", "url": "https://github.com/PGMDev/PGM/pull/554#pullrequestreview-443685696", "createdAt": "2020-07-07T08:44:48Z", "commit": {"oid": "4861686495a5ece44e079b486c74b00efb3738be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwODo0NDo0OFrOGt03lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwODo0NDo0OFrOGt03lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTMwMw==", "bodyText": "This is adding maps randomly, it'd be nice if it added maps based on the vote-selection logic of scores and weights", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r450705303", "createdAt": "2020-07-07T08:44:48Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/rotation/VotingPool.java", "diffHunk": "@@ -119,6 +119,24 @@ public boolean addCustomVoteMap(MapInfo info) {\n     return false;\n   }\n \n+  public Set<MapInfo> fillCustomMapVote() {\n+    Set<MapInfo> selected = Sets.newHashSet();\n+    if (customVoteMaps.size() < MAX_VOTE_OPTIONS) {\n+      int needed = MAX_VOTE_OPTIONS - customVoteMaps.size();\n+      int maxRetrys = MAX_VOTE_OPTIONS;\n+      while (selected.size() < needed && maxRetrys > 0) {\n+        MapInfo random = getRandom();\n+        if (!isCustomMapSelected(random)) {\n+          selected.add(random);\n+          addCustomVoteMap(random);\n+        } else {\n+          maxRetrys--;\n+        }\n+      }\n+    }\n+    return selected;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4861686495a5ece44e079b486c74b00efb3738be"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTk5NDYy", "url": "https://github.com/PGMDev/PGM/pull/554#pullrequestreview-444199462", "createdAt": "2020-07-07T19:48:03Z", "commit": {"oid": "53f2dec997d804f408883e6f04d71f0bb909f5ca"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxOTo0ODowM1rOGuNKnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMDoxMTozMlrOGuN5eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMzM4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                for (int i = 0; i < voteSize; i++) {\n          \n          \n            \n                for (int i = overrides.size(); i < voteSize; i++) {", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r451103389", "createdAt": "2020-07-07T19:48:03Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/rotation/MapPoll.java", "diffHunk": "@@ -68,6 +70,9 @@ private void selectMaps() {\n     NavigableMap<Double, MapInfo> cumulativeScores = new TreeMap<>();\n     double maxWeight = cummulativeMap(0, sortedDist, cumulativeScores);\n \n+    // Add all override maps before selecting random\n+    overrides.forEach(map -> votes.put(map, new HashSet<>()));\n+\n     for (int i = 0; i < voteSize; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53f2dec997d804f408883e6f04d71f0bb909f5ca"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTExNTM4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                      Sets.newHashSet(),\n          \n          \n            \n                                      Collections.emptySet(),", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r451115385", "createdAt": "2020-07-07T20:11:32Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/rotation/VotingPool.java", "diffHunk": "@@ -98,12 +101,13 @@ public void matchEnded(Match match) {\n               // If there is a restart queued, don't start a vote\n               if (RestartManager.isQueued()) return;\n               currentPoll =\n-                  shouldCustomVote()\n+                  shouldOverride()\n                       ? new MapPoll(\n                           match,\n                           getCustomVoteMapWeighted(),\n+                          Sets.newHashSet(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53f2dec997d804f408883e6f04d71f0bb909f5ca"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NDc2NjMz", "url": "https://github.com/PGMDev/PGM/pull/554#pullrequestreview-446476633", "createdAt": "2020-07-10T15:04:20Z", "commit": {"oid": "64352d4d9190f7e121dbfbc18946c3f4aab27a1a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTowNDoyMVrOGv640g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTowNDoyMVrOGv640g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkwMTA3NA==", "bodyText": "Replace and override basically mean the same thing, can we use different terms that make it more clear?", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r452901074", "createdAt": "2020-07-10T15:04:21Z", "author": {"login": "Electroid"}, "path": "util/src/main/i18n/templates/map.properties", "diffHunk": "@@ -134,3 +134,13 @@ vote.limit = Selection limit for the vote has been reached\n \n vote.title.map = Selected Maps\n \n+# {0} = player name (who toggled mode)\n+# {1} = mode name\n+vote.toggle = {0} toggled vote mode to {1}\n+\n+vote.mode.replace = Replace\n+\n+vote.mode.override = Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64352d4d9190f7e121dbfbc18946c3f4aab27a1a"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64352d4d9190f7e121dbfbc18946c3f4aab27a1a", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/64352d4d9190f7e121dbfbc18946c3f4aab27a1a", "committedDate": "2020-07-08T08:57:37Z", "message": "Small changes\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}, "afterCommit": {"oid": "c2751c640ec51071d2e1821f4720d3d7d444f2a8", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/c2751c640ec51071d2e1821f4720d3d7d444f2a8", "committedDate": "2020-07-11T18:39:10Z", "message": "Switch override to create\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "committedDate": "2020-07-11T18:44:55Z", "message": "Rework /vote logic\n* Added create & replace vote modes\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2751c640ec51071d2e1821f4720d3d7d444f2a8", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/c2751c640ec51071d2e1821f4720d3d7d444f2a8", "committedDate": "2020-07-11T18:39:10Z", "message": "Switch override to create\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}, "afterCommit": {"oid": "26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "committedDate": "2020-07-11T18:44:55Z", "message": "Rework /vote logic\n* Added create & replace vote modes\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07b9ce2ceb2b04c1b7fd9a9bead00ea210de3c80", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/07b9ce2ceb2b04c1b7fd9a9bead00ea210de3c80", "committedDate": "2020-07-11T19:20:55Z", "message": "Fix duplicate translation key\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODM0MjYx", "url": "https://github.com/PGMDev/PGM/pull/554#pullrequestreview-446834261", "createdAt": "2020-07-11T23:06:23Z", "commit": {"oid": "07b9ce2ceb2b04c1b7fd9a9bead00ea210de3c80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 427, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}