{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzk2NjQ3", "number": 751, "title": "Add query modifier for checking acting player info", "bodyText": "Let's say you wanted to prevent a player from opening chests unless they're in a specific region (the wool room maybe).\nThe current way of filtering location on a block-break or use event target the location of the physical block (which is always in the wool room). In this instance, I want to query the location of the actor (player) rather than the block in question.\nFor this, I have created a PlayerBlockQueryModifier which sets focus on the player in the event vs the block. This also slightly modifies the newly created base QueryModifier class allowing for unmodified queries to abstain by returning null. In this case, the player within the PlayerQuery can be null (when offline) so a fallback was required.\nSee the example below where the player can only use items within the yellow wool room if they too are in that region.\n<!--- filter with region -->\n<player id=\"player-in-yellow-wool\">\n    <rectangle id=\"yellow-wool-room\" min=\"534.5,-354\" max=\"544,-339\"/>\n</player>\n\n<!--- application -->\n<apply use=\"player-in-yellow-wool\" region=\"yellow-wool-room\" message=\"You can not interact with this from here.\"/>\nOpen to suggestions if this can be completed an alternative way (existing XML or improved implementation).\nDiscussed with Pablo and Simon in Discord so ty for help.", "createdAt": "2020-12-22T00:24:44Z", "url": "https://github.com/PGMDev/PGM/pull/751", "merged": true, "mergeCommit": {"oid": "1266cfd3aa5a52e1873f34887672164402ef1dde"}, "closed": true, "closedAt": "2020-12-31T22:55:19Z", "author": {"login": "Pugzy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdomUBWAFqTU1NjkwMTU1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrsDFLAFqTU2MDU1NzgyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTAxNTU0", "url": "https://github.com/PGMDev/PGM/pull/751#pullrequestreview-556901554", "createdAt": "2020-12-22T08:29:03Z", "commit": {"oid": "f0dd67a8612351528c65cdf661ced9bef0754c75"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwODoyOTowM1rOIJynfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwODoyOTowM1rOIJynfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEzNzQwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (query.getPlayer() == null) return null;\n          \n          \n            \n                // Abstain when no player can be found, eg: they disconnected\n          \n          \n            \n                if (query.getPlayer() == null) return null;\n          \n      \n    \n    \n  \n\nI'd add a clarifying comment for future mantainers", "url": "https://github.com/PGMDev/PGM/pull/751#discussion_r547137407", "createdAt": "2020-12-22T08:29:03Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/filters/modifier/PlayerBlockQueryModifier.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package tc.oc.pgm.filters.modifier;\n+\n+import javax.annotation.Nullable;\n+import tc.oc.pgm.api.filter.Filter;\n+import tc.oc.pgm.api.filter.query.PlayerQuery;\n+import tc.oc.pgm.api.filter.query.Query;\n+\n+public class PlayerBlockQueryModifier extends QueryModifier<PlayerQuery> {\n+\n+  public PlayerBlockQueryModifier(Filter filter) {\n+    super(filter);\n+  }\n+\n+  @Nullable\n+  @Override\n+  protected Query modifyQuery(PlayerQuery query) {\n+    if (query.getPlayer() == null) return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0dd67a8612351528c65cdf661ced9bef0754c75"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjU5ODg4", "url": "https://github.com/PGMDev/PGM/pull/751#pullrequestreview-558259888", "createdAt": "2020-12-23T22:44:35Z", "commit": {"oid": "f0dd67a8612351528c65cdf661ced9bef0754c75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMjo0NDozNVrOIK56Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMjo0NDozNVrOIK56Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMwNTQ4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * <p>If the modified query returns null the query will abstain.\n          \n          \n            \n             * <p>If the modified query returns {@code null} this modifier will abstain without querying the child filter.\n          \n      \n    \n    \n  \n\nA query can't abstain, unsure about the phrasing.", "url": "https://github.com/PGMDev/PGM/pull/751#discussion_r548305482", "createdAt": "2020-12-23T22:44:35Z", "author": {"login": "KingOfSquares"}, "path": "core/src/main/java/tc/oc/pgm/filters/modifier/QueryModifier.java", "diffHunk": "@@ -10,6 +11,8 @@\n  * Takes a query and modifies it before passing it onto its child filter. Might transform query type\n  * so {@link #getQueryType()} on this modifier can be different from its child filter\n  *\n+ * <p>If the modified query returns null the query will abstain.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0dd67a8612351528c65cdf661ced9bef0754c75"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "810c4bc182a29188bef029ef9ffa8498cb97ec02", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/810c4bc182a29188bef029ef9ffa8498cb97ec02", "committedDate": "2020-12-24T16:53:38Z", "message": "Update core/src/main/java/tc/oc/pgm/filters/modifier/PlayerBlockQueryModifier.java\n\nCo-authored-by: Pablo Herrera <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "44264aba46f8918e957679d22385dd17c1dc9823", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/44264aba46f8918e957679d22385dd17c1dc9823", "committedDate": "2020-12-24T16:54:12Z", "message": "Add query modifier for checking acting player info\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44264aba46f8918e957679d22385dd17c1dc9823", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/44264aba46f8918e957679d22385dd17c1dc9823", "committedDate": "2020-12-24T16:54:12Z", "message": "Add query modifier for checking acting player info\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}, "afterCommit": {"oid": "f242d19c0bf5973cc0c8c77ca532ec0cae677f07", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/f242d19c0bf5973cc0c8c77ca532ec0cae677f07", "committedDate": "2020-12-24T16:57:15Z", "message": "Add query modifier for checking acting player info\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4764d4ff6e05a3e0a1c586c50f163e006896d90", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/a4764d4ff6e05a3e0a1c586c50f163e006896d90", "committedDate": "2020-12-24T17:02:14Z", "message": "Add query modifier for checking acting player info\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f242d19c0bf5973cc0c8c77ca532ec0cae677f07", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/f242d19c0bf5973cc0c8c77ca532ec0cae677f07", "committedDate": "2020-12-24T16:57:15Z", "message": "Add query modifier for checking acting player info\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}, "afterCommit": {"oid": "a4764d4ff6e05a3e0a1c586c50f163e006896d90", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/a4764d4ff6e05a3e0a1c586c50f163e006896d90", "committedDate": "2020-12-24T17:02:14Z", "message": "Add query modifier for checking acting player info\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NzU2MDIy", "url": "https://github.com/PGMDev/PGM/pull/751#pullrequestreview-558756022", "createdAt": "2020-12-25T05:06:34Z", "commit": {"oid": "a4764d4ff6e05a3e0a1c586c50f163e006896d90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTU3ODIw", "url": "https://github.com/PGMDev/PGM/pull/751#pullrequestreview-560557820", "createdAt": "2020-12-31T22:55:10Z", "commit": {"oid": "a4764d4ff6e05a3e0a1c586c50f163e006896d90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 385, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}