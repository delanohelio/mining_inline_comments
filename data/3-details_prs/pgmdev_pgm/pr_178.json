{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NzQ0NDIx", "number": 178, "title": "Cleanup sync createWorld mess", "bodyText": "As suggested by a commit message, the CountDownLatch is a cleaner way to do this type of syncronization", "createdAt": "2020-01-02T18:07:17Z", "url": "https://github.com/PGMDev/PGM/pull/178", "merged": true, "mergeCommit": {"oid": "66635f17b79b2ca32d9576276c5fc37eaf69bbee"}, "closed": true, "closedAt": "2020-01-02T18:37:08Z", "author": {"login": "Pablete1234"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2d1zLgFqTMzNzc4NDQ0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb2d7P0ABqjI5MTg0MTIwMzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3Nzg0NDQy", "url": "https://github.com/PGMDev/PGM/pull/178#pullrequestreview-337784442", "createdAt": "2020-01-02T18:12:51Z", "commit": {"oid": "0313bd663f2fb5c8d9edf2bdfb069ac809247c63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODoxMjo1MVrOFZxpnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODoxMjo1MVrOFZxpnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU3MjE4OA==", "bodyText": "Logger?", "url": "https://github.com/PGMDev/PGM/pull/178#discussion_r362572188", "createdAt": "2020-01-02T18:12:51Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/match/MatchManagerImpl.java", "diffHunk": "@@ -197,39 +197,30 @@ private World createMatchWorld(String worldName, MapInfo info, TerrainModule ter\n   }\n \n   /**\n-   * Creates a new world, wich must be done on the primary thread. If already running on the primary\n-   * thread, calls createWorld, otherwise, starts a sync task to run create world, and waits until\n-   * it's done.\n+   * Creates a new world, which must be done on the primary thread. If already running on the\n+   * primary thread, calls createWorld, otherwise, starts a sync task to run create world, and waits\n+   * until it's done.\n    *\n    * @param creator The creator for the world\n    * @return A world if it was able to be created, null otherwise\n    */\n   private World createWorld(final WorldCreator creator) {\n     if (server.isPrimaryThread()) return server.createWorld(creator);\n-\n-    // FIXME: This is pretty dirty, there must be a better way to run & wait on main\n-    final Object LOCK = new Object();\n+    final CountDownLatch latch = new CountDownLatch(1);\n     final AtomicReference<World> world = new AtomicReference<>();\n-    final AtomicBoolean isDone = new AtomicBoolean();\n     PGM.get()\n         .getServer()\n         .getScheduler()\n         .runTask(\n             PGM.get(),\n             () -> {\n               world.set(server.createWorld(creator));\n-              isDone.set(true);\n-              synchronized (LOCK) {\n-                LOCK.notifyAll();\n-              }\n+              latch.countDown();\n             });\n-    while (!isDone.get()) {\n-      synchronized (LOCK) {\n-        try {\n-          LOCK.wait();\n-        } catch (InterruptedException ignore) {\n-        }\n-      }\n+    try {\n+      latch.await();\n+    } catch (InterruptedException e) {\n+      e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0313bd663f2fb5c8d9edf2bdfb069ac809247c63"}, "originalPosition": 55}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0313bd663f2fb5c8d9edf2bdfb069ac809247c63", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/0313bd663f2fb5c8d9edf2bdfb069ac809247c63", "committedDate": "2020-01-02T18:05:01Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "8a11e3f74b06bf8add99a44d1c17c7e3ec5f3efe", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/8a11e3f74b06bf8add99a44d1c17c7e3ec5f3efe", "committedDate": "2020-01-02T18:16:26Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a11e3f74b06bf8add99a44d1c17c7e3ec5f3efe", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/8a11e3f74b06bf8add99a44d1c17c7e3ec5f3efe", "committedDate": "2020-01-02T18:16:26Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "c14e363960ff92c15938817a3d21324a7a5421d4", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/c14e363960ff92c15938817a3d21324a7a5421d4", "committedDate": "2020-01-02T18:18:01Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f34c6e7f2f15bd45f9d423fc529a946fce59627b", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/f34c6e7f2f15bd45f9d423fc529a946fce59627b", "committedDate": "2020-01-02T18:18:37Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c14e363960ff92c15938817a3d21324a7a5421d4", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/c14e363960ff92c15938817a3d21324a7a5421d4", "committedDate": "2020-01-02T18:18:01Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "f34c6e7f2f15bd45f9d423fc529a946fce59627b", "author": {"user": {"login": "Pablete1234", "name": "Pablo Herrera"}}, "url": "https://github.com/PGMDev/PGM/commit/f34c6e7f2f15bd45f9d423fc529a946fce59627b", "committedDate": "2020-01-02T18:18:37Z", "message": "Cleanup sync createWorld mess\n\nSigned-off-by: Pablete1234 <pabloherrerapalacio@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 602, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}