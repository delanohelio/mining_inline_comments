{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NDU5NzI3", "number": 725, "title": "Add owner-points module", "bodyText": "This adds a owner-points module that can let control points give a set number of points when captured.\n    <!-- Gives exactly 20 points when captured, removes 20 points when control point lost -->\n    <control-point name=\"The Hill\" id=\"hill\" capture-time=\"1s\" owner-points=\"20\" points=\"0\">\n        <capture><region id=\"hill\"/></capture>\n        <progress><region id=\"hill\"/></progress>\n        <captured><region id=\"hill\"/></captured>\n    </control-point>\n\n    <!-- Holds 10 points when captured, then awards 1 point per second -->\n    <control-point name=\"The Hill\" id=\"second-hill\" capture-time=\"1s\" owner-points=\"10\">\n        <capture><region id=\"hill-2\"/></capture>\n        <progress><region id=\"hill-2\"/></progress>\n        <captured><region id=\"hill-2\"/></captured>\n    </control-point>\n\n    <!-- Holds 40 points when captured, then awards 3 points per second -->\n    <control-point name=\"The Hill\" id=\"third-hill\" capture-time=\"1s\" owner-points=\"40\" points=\"3\">\n        <capture><region id=\"hill-3\"/></capture>\n        <progress><region id=\"hill-3\"/></progress>\n        <captured><region id=\"hill-3\"/></captured>\n    </control-point>\nStill a work in progress because it gives the team the points the moment they start capturing the hill, rather than when capturing but otherwise it still works, just needs another case added into it but what I've tried so far didn't work. I'll check the code @Pablete1234 was talking about later. Fixes #716", "createdAt": "2020-11-27T08:09:29Z", "url": "https://github.com/PGMDev/PGM/pull/725", "merged": true, "mergeCommit": {"oid": "712c987762c74db9d720aa2ebf439c9de7de0903"}, "closed": true, "closedAt": "2020-11-29T16:34:08Z", "author": {"login": "CoWinkKeyDinkInc"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgi8AyAH2gAyNTI4NDU5NzI3OjNlZjU4Y2NmZDEwYWI3YTUyZjQ3MjBmOWQxZWNmZGYyYjYxY2YxNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhTaOxgFqTU0MDQ5NTY4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ef58ccfd10ab7a52f4720f9d1ecfdf2b61cf14c", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/3ef58ccfd10ab7a52f4720f9d1ecfdf2b61cf14c", "committedDate": "2020-11-27T08:05:08Z", "message": "Add bonus-points module\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NzgzMjE0", "url": "https://github.com/PGMDev/PGM/pull/725#pullrequestreview-539783214", "createdAt": "2020-11-27T08:23:50Z", "commit": {"oid": "3ef58ccfd10ab7a52f4720f9d1ecfdf2b61cf14c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODoyMzo1MFrOH6045A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODoyMzo1MFrOH6045A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQ0NTk4OA==", "bodyText": "The default should probably be 0", "url": "https://github.com/PGMDev/PGM/pull/725#discussion_r531445988", "createdAt": "2020-11-27T08:23:50Z", "author": {"login": "KingOfSquares"}, "path": "core/src/main/java/tc/oc/pgm/controlpoint/ControlPointParser.java", "diffHunk": "@@ -87,6 +87,8 @@ public static ControlPointDefinition parseControlPoint(\n     boolean permanent = XMLUtils.parseBoolean(elControlPoint.getAttribute(\"permanent\"), false);\n     float pointsPerSecond =\n         XMLUtils.parseNumber(elControlPoint.getAttribute(\"points\"), Float.class, 1f);\n+    float pointsBonus =\n+        XMLUtils.parseNumber(elControlPoint.getAttribute(\"bonus-points\"), Float.class, 1f);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef58ccfd10ab7a52f4720f9d1ecfdf2b61cf14c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5ODA4NzYy", "url": "https://github.com/PGMDev/PGM/pull/725#pullrequestreview-539808762", "createdAt": "2020-11-27T09:03:26Z", "commit": {"oid": "3ef58ccfd10ab7a52f4720f9d1ecfdf2b61cf14c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee948b8ddf6f485c7e6c20eb76df76c7358d9f11", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/ee948b8ddf6f485c7e6c20eb76df76c7358d9f11", "committedDate": "2020-11-27T22:52:31Z", "message": "rename bonus-points to owner-points, set default owner points to 0\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMjA3NDkx", "url": "https://github.com/PGMDev/PGM/pull/725#pullrequestreview-540207491", "createdAt": "2020-11-27T22:57:30Z", "commit": {"oid": "ee948b8ddf6f485c7e6c20eb76df76c7358d9f11"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QyMjo1NzozMFrOH7Krvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QyMjo1NzozMFrOH7Krvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgwMzA3MQ==", "bodyText": "The points are added on capture but never removed when uncaptured, see:\nhttps://github.com/OvercastNetwork/ProjectAres/blob/master/PGM/src/main/java/tc/oc/pgm/controlpoint/ControlPoint.java#L349-L353\nAlso i belive this code should be a bit lower, when the controlling team changes, not when the capturing team does", "url": "https://github.com/PGMDev/PGM/pull/725#discussion_r531803071", "createdAt": "2020-11-27T22:57:30Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/controlpoint/ControlPoint.java", "diffHunk": "@@ -348,6 +348,11 @@ private void dominateAndFireEvents(@Nullable Competitor dominantTeam, Duration d\n     if (oldCapturingTeam != this.capturingTeam) {\n       this.match.callEvent(\n           new CapturingTeamChangeEvent(this.match, this, oldCapturingTeam, this.capturingTeam));\n+      ScoreMatchModule scoreMatchModule = this.getMatch().getModule(ScoreMatchModule.class);\n+      // Gives a set number of Owner points to a team when captured.\n+      if (this.capturingTeam != null && scoreMatchModule != null) {\n+        scoreMatchModule.incrementScore(this.capturingTeam, this.getDefinition().getPointsOwner());\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee948b8ddf6f485c7e6c20eb76df76c7358d9f11"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6e6f0522844821fc3ad3ec09e00d27b38b1d617", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/a6e6f0522844821fc3ad3ec09e00d27b38b1d617", "committedDate": "2020-11-27T23:49:37Z", "message": "Implement traditional owner-points method of scoring, fix points system\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMzUyODky", "url": "https://github.com/PGMDev/PGM/pull/725#pullrequestreview-540352892", "createdAt": "2020-11-28T08:50:35Z", "commit": {"oid": "a6e6f0522844821fc3ad3ec09e00d27b38b1d617"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwODo1MDozNVrOH7XIwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwODo1MDozNVrOH7XIwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAwNzEwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (this.controllingTeam != null && scoreMatchModule != null) {\n          \n          \n            \n                  if (scoreMatchModule != null) {\n          \n      \n    \n    \n  \n\nIf you do not apply this logic when the controlling team is null, capturing won't give points since the current controlling team is null. In general points with a netrual state won't have this feature working as intended", "url": "https://github.com/PGMDev/PGM/pull/725#discussion_r532007104", "createdAt": "2020-11-28T08:50:35Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/controlpoint/ControlPoint.java", "diffHunk": "@@ -354,6 +354,17 @@ private void dominateAndFireEvents(@Nullable Competitor dominantTeam, Duration d\n       this.match.callEvent(\n           new ControllerChangeEvent(this.match, this, oldControllingTeam, this.controllingTeam));\n \n+      ScoreMatchModule scoreMatchModule = this.getMatch().getModule(ScoreMatchModule.class);\n+      // Gives a set number of owner points to a team when captured.\n+      if (this.controllingTeam != null && scoreMatchModule != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6e6f0522844821fc3ad3ec09e00d27b38b1d617"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1446207ed2fe7fe09ad04550b025e2cba54027", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/1d1446207ed2fe7fe09ad04550b025e2cba54027", "committedDate": "2020-11-28T20:13:04Z", "message": "Fix owner-points removal logic\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNDY2MDA5", "url": "https://github.com/PGMDev/PGM/pull/725#pullrequestreview-540466009", "createdAt": "2020-11-29T10:21:06Z", "commit": {"oid": "1d1446207ed2fe7fe09ad04550b025e2cba54027"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNDk1Njg1", "url": "https://github.com/PGMDev/PGM/pull/725#pullrequestreview-540495685", "createdAt": "2020-11-29T16:33:35Z", "commit": {"oid": "1d1446207ed2fe7fe09ad04550b025e2cba54027"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 376, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}