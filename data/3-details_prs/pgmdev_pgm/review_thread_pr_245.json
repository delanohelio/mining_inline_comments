{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NDYzMzQ4", "number": 245, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQyMTozNTo0MFrODZA7tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQyMjozMzo1MFrODZEnCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTU2Mjc4OnYy", "diffSide": "RIGHT", "path": "src/main/java/tc/oc/pgm/match/MatchPlayerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQyMTozNTo0MFrOFfML5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQyMTozNTo0MFrOFfML5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0OTgzMA==", "bodyText": "Put this in nmshacks", "url": "https://github.com/PGMDev/PGM/pull/245#discussion_r368249830", "createdAt": "2020-01-18T21:35:40Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/match/MatchPlayerImpl.java", "diffHunk": "@@ -75,6 +78,9 @@ public MatchPlayerImpl(Match match, Player player) {\n     this.frozen = new AtomicBoolean(false);\n     this.dead = new AtomicBoolean(false);\n     this.visible = new AtomicBoolean(false);\n+    this.protocolVersion =\n+        new AtomicInteger(\n+            ((CraftPlayer) player).getHandle().playerConnection.networkManager.protocolVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b46f5f911e3d2be1dfff93725b341a3b60c7ff"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTgyNDY4OnYy", "diffSide": "RIGHT", "path": "src/main/java/tc/oc/util/ViaUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxMDozODoxMlrOFfOQMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxMDozODoxMlrOFfOQMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MzY5OA==", "bodyText": "This should use a logger.", "url": "https://github.com/PGMDev/PGM/pull/245#discussion_r368283698", "createdAt": "2020-01-19T10:38:12Z", "author": {"login": "TheMolkaPL"}, "path": "src/main/java/tc/oc/util/ViaUtils.java", "diffHunk": "@@ -1,16 +1,48 @@\n package tc.oc.util;\n \n-import org.bukkit.Bukkit;\n+import java.lang.reflect.Method;\n import org.bukkit.entity.Player;\n+import tc.oc.pgm.api.PGM;\n import tc.oc.world.NMSHacks;\n-import us.myles.ViaVersion.api.Via;\n \n public class ViaUtils {\n+  private static boolean enabled;\n+  private static Object viaAPI;\n+  private static Method getPlayerVersion;\n+\n+  static {\n+    try {\n+      viaAPI = Class.forName(\"us.myles.ViaVersion.api.Via\").getMethod(\"getAPI\").invoke(null);\n+      getPlayerVersion =\n+          Class.forName(\"us.myles.ViaVersion.api.ViaAPI\")\n+              .getMethod(\"getPlayerVersion\", Object.class);\n+      enabled = true;\n+    } catch (Exception e) {\n+      PGM.get().getLogger().warning(\"ViaVersion is not installed\");\n+      e.printStackTrace();\n+      enabled = false;\n+    }\n+  }\n+\n   public static boolean enabled() {\n-    return Bukkit.getServer().getPluginManager().getPlugin(\"ViaVersion\") != null;\n+    return enabled;\n   }\n \n+  /**\n+   * @see <a\n+   *     href=\"https://wiki.vg/Protocol_version_numbers\">https://wiki.vg/Protocol_version_numbers</a>\n+   */\n   public static int getProtocolVersion(Player player) {\n-    return enabled() ? Via.getAPI().getPlayerVersion(player) : NMSHacks.getProtocolVersion(player);\n+    int version = NMSHacks.getProtocolVersion(player);\n+    if (enabled()) {\n+      try {\n+        return (int) getPlayerVersion.invoke(viaAPI, player);\n+      } catch (Exception e) {\n+        e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8443f7412933d8161fa7a67979950d1ea3020399"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NjE2NTIwOnYy", "diffSide": "RIGHT", "path": "src/main/java/tc/oc/pgm/listeners/PGMListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQyMjozMzo1MFrOFfQ_IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQyMjozMzo1MFrOFfQ_IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMyODQ4MQ==", "bodyText": "Can you leave the * import?", "url": "https://github.com/PGMDev/PGM/pull/245#discussion_r368328481", "createdAt": "2020-01-19T22:33:50Z", "author": {"login": "TheMolkaPL"}, "path": "src/main/java/tc/oc/pgm/listeners/PGMListener.java", "diffHunk": "@@ -1,6 +1,6 @@\n package tc.oc.pgm.listeners;\n \n-import static com.google.common.base.Preconditions.*;\n+import static com.google.common.base.Preconditions.checkNotNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe490dd9d3242f11af54da6a7b4db07e01835001"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1113, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}