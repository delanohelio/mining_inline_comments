{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0OTM3Nzgy", "number": 517, "title": "Changes to /setpool and mutes", "bodyText": "Changes to /setpool and mutes \ud83d\ude31\nAdd match limit to /setpool\nThis was suggested originally by @Pugzy and more recently @Diamyx. Basically staff can use /setpool <pool> -m (count) to set a limit on the number of matches to play in a non-dynamic rot before auto reverting back to the regular dynamic pools.\nIn addition to adding the match limit, I also updated the broadcast message to be more aligned with the recent changed to /setnext\nScreenshots\nNew format for /setpool broadcast\n\nNew format with time option\n\nNew match limit broadcast\n\nProvide mute reason to muted players\nThe second change is a minor one, but should provide a better user experience to those who find themselves mutes. Currently when a player is muted and they attempt to send a message, they receive no information regarding what their mute reason was. I\u2019ve altered the storage of muted players along with the message format to allow for muted players to view the reason they were muted. This will be shown when a muted player attempts to send a message while muted.\nScreenshot\nExample: player is muted for the reason Don\u2019t spam and then attempts to send a message 3 times.\n\nThese are minor changes, but as always I have tested to ensure these all work and should be good to go \ud83d\udc4d Please let me know if there are any modifications I should make, and I\u2019ll get to them asap.\nSigned-off-by: applenick applenick@users.noreply.github.com", "createdAt": "2020-05-29T07:34:46Z", "url": "https://github.com/PGMDev/PGM/pull/517", "merged": true, "mergeCommit": {"oid": "a8eca42f9f8b0b5e5cd03bd1469d024ab1b455e7"}, "closed": true, "closedAt": "2020-06-14T18:07:54Z", "author": {"login": "applenick"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmsjWFAFqTQyMTE2NzMxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrQDmFAFqTQzMDIzOTg4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTY3MzE3", "url": "https://github.com/PGMDev/PGM/pull/517#pullrequestreview-421167317", "createdAt": "2020-05-29T17:54:16Z", "commit": {"oid": "421fa2a2aaf9e66e49cc055755434b7732000c62"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNzo1NDoxN1rOGcmo3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoyOTozMlrOGc5Vpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0NjM2NQ==", "bodyText": "For compatibility reasons, you want to keep the parameters the same. eg. 0 = map pool, 1 = player name. Same with the other translation.", "url": "https://github.com/PGMDev/PGM/pull/517#discussion_r432646365", "createdAt": "2020-05-29T17:54:17Z", "author": {"login": "Electroid"}, "path": "util/src/main/i18n/templates/map.properties", "diffHunk": "@@ -73,14 +73,14 @@ map.protectPortal = You may not obstruct this area\n # {0} = map pool name (e.g. \"Mega\")\n pool.change = Map pool has been set to {0} in order to better adjust to the current player count.\n \n-# {0} = map pool name (e.g. \"Mega\")\n-# {1} = player name\n-pool.change.force = The map pool has been set to {0} by {1}\n-\n-# {0} = map pool name (e.g. \"Mega\")\n-# {1} = a duration (e.g. \"2 hours\")\n-# {2} = player name\n-pool.change.forceTimed = The map pool has been set to {0} for {1} by {2}\n+# {0} = player name\n+# {1} = map pool name (e.g. \"Mega\")\n+pool.change.force = {0} set the map pool to {1}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "421fa2a2aaf9e66e49cc055755434b7732000c62"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0NzkwMA==", "bodyText": "Tracking who queued the restart isn't really needed.", "url": "https://github.com/PGMDev/PGM/pull/517#discussion_r432647900", "createdAt": "2020-05-29T17:57:18Z", "author": {"login": "Electroid"}, "path": "core/src/main/java/tc/oc/pgm/command/RestartCommand.java", "diffHunk": "@@ -21,10 +24,12 @@\n       perms = Permissions.STOP)\n   public void restart(\n       Audience audience,\n+      CommandSender sender,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "421fa2a2aaf9e66e49cc055755434b7732000c62"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1Mjc0Mg==", "bodyText": "I think this is over-verbosity on messages, we already have restart message.", "url": "https://github.com/PGMDev/PGM/pull/517#discussion_r432952742", "createdAt": "2020-05-31T14:29:32Z", "author": {"login": "Electroid"}, "path": "core/src/main/java/tc/oc/pgm/command/CancelCommand.java", "diffHunk": "@@ -18,11 +21,15 @@\n       aliases = {\"cancel\", \"cancelrestart\", \"cr\"},\n       desc = \"Cancels all countdowns\",\n       perms = Permissions.STOP)\n-  public void cancel(Audience audience, Match match) {\n+  public void cancel(Audience audience, CommandSender sender, Match match) {\n     if (RestartManager.isQueued()) {\n       match.callEvent(new CancelRestartEvent());\n       audience.sendMessage(\n           TranslatableComponent.of(\"admin.cancelRestart.restartUnqueued\", TextColor.RED));\n+      ChatDispatcher.broadcastAdminChatMessage(\n+          TranslatableComponent.of(\"admin.cancelRestart.broadcast\", TextColor.GRAY)\n+              .args(UsernameFormatUtils.formatStaffName(sender, match)),\n+          match);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fcb62a4e4f1546ebcf8f29eb902d6aadaa100b6"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e9865db6b3dbfa01c49d2fffb95e1331f8c38d", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/b9e9865db6b3dbfa01c49d2fffb95e1331f8c38d", "committedDate": "2020-06-09T16:32:11Z", "message": "Add a match limit flag to /setpool command\n* Added staff broadcast to restart command\n* Provide mute reason in blocked chat messages\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b32800a6536e870012f4832fa9a23d3f77e88cdd", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/b32800a6536e870012f4832fa9a23d3f77e88cdd", "committedDate": "2020-06-09T16:32:12Z", "message": "Add a broadcast to /cancelrestart\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7178b0970978fa3072bc573fc20466d04221fc42", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/7178b0970978fa3072bc573fc20466d04221fc42", "committedDate": "2020-06-09T16:32:12Z", "message": "Improve /cancelrestart broadcast message\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d2392d2cf88ad3a323eceff9510daf6b283ef8", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/e7d2392d2cf88ad3a323eceff9510daf6b283ef8", "committedDate": "2020-06-09T16:32:13Z", "message": "Remove restart source and /cancelrestart\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b034761055f4fcb4b84cbdf40c6342134c4666f7", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/b034761055f4fcb4b84cbdf40c6342134c4666f7", "committedDate": "2020-06-09T18:40:04Z", "message": "Remove restart broadcast and cleanup /setpool\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76cadb9f37a34b21f8e1d4e8d7b6c7f9ef00b983", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/76cadb9f37a34b21f8e1d4e8d7b6c7f9ef00b983", "committedDate": "2020-05-31T17:47:47Z", "message": "Remove restart source and /cancelrestart\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}, "afterCommit": {"oid": "b034761055f4fcb4b84cbdf40c6342134c4666f7", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/b034761055f4fcb4b84cbdf40c6342134c4666f7", "committedDate": "2020-06-09T18:40:04Z", "message": "Remove restart broadcast and cleanup /setpool\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b892ae13dce870aab89066837e54520d60e55c5", "author": {"user": {"login": "applenick", "name": "applenick"}}, "url": "https://github.com/PGMDev/PGM/commit/4b892ae13dce870aab89066837e54520d60e55c5", "committedDate": "2020-06-09T19:26:48Z", "message": "Cleanup some unused parameters\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM5ODg0", "url": "https://github.com/PGMDev/PGM/pull/517#pullrequestreview-430239884", "createdAt": "2020-06-14T18:07:14Z", "commit": {"oid": "4b892ae13dce870aab89066837e54520d60e55c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 404, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}