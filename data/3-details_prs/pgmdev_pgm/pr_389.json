{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTIwNzY5", "number": 389, "title": "Players now stick to their originally picked teams", "bodyText": "This changes the behavior of joining teams slightly as now, by default, all players will be placed back on their originally picked teams if they leave the game or join observers. Donors can switch teams, if they would like, by explicitly selecting a certain team, but if no specific team is selected, they too will be placed back on their original team.\nAll other joining behavior (full team / teams) should stay the same. Fixes #328.", "createdAt": "2020-03-30T21:44:03Z", "url": "https://github.com/PGMDev/PGM/pull/389", "merged": true, "mergeCommit": {"oid": "bbaa02aad6bf943e0822f3cafb4967a03ed1c6ee"}, "closed": true, "closedAt": "2020-04-10T14:31:25Z", "author": {"login": "EricZeiberg"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSikSyAH2gAyMzk1OTIwNzY5OjhhMThiMmMxZjkwYzY2ODBhOTQyOWJhYjA4Y2Y0OGJjNWJkZmQ0ZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWR_6sgFqTM5MTQ3MjcwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a18b2c1f90c6680a9429bab08cf48bc5bdfd4f3", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/8a18b2c1f90c6680a9429bab08cf48bc5bdfd4f3", "committedDate": "2020-03-29T23:33:08Z", "message": "Freeze world after match finish\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "635fbf0f6bbcf826d1d43a9b0ad70da24e0e1f0e", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/635fbf0f6bbcf826d1d43a9b0ad70da24e0e1f0e", "committedDate": "2020-03-30T21:25:57Z", "message": "Implement previous team tracking\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61dfe6637b19bec33026628c22b718e25213a5af", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/61dfe6637b19bec33026628c22b718e25213a5af", "committedDate": "2020-03-30T21:39:37Z", "message": "Cleanup code\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dcba9947ace7722189408ba6fd6cc3f33c105f8", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/5dcba9947ace7722189408ba6fd6cc3f33c105f8", "committedDate": "2020-03-30T21:49:08Z", "message": "Replace wildcard imports\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6241f452023ab46db8a607518c62062b4f77289c", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/6241f452023ab46db8a607518c62062b4f77289c", "committedDate": "2020-03-30T21:50:37Z", "message": "No need to touch this file\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Mjc2NDI5", "url": "https://github.com/PGMDev/PGM/pull/389#pullrequestreview-384276429", "createdAt": "2020-03-30T22:26:30Z", "commit": {"oid": "6241f452023ab46db8a607518c62062b4f77289c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjoyNjozMFrOF9-hBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjoyNjozMFrOF9-hBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUzMTcxNw==", "bodyText": "Should be MatchModule and not Module", "url": "https://github.com/PGMDev/PGM/pull/389#discussion_r400531717", "createdAt": "2020-03-30T22:26:30Z", "author": {"login": "KingOfSquares"}, "path": "core/src/main/java/tc/oc/pgm/api/Modules.java", "diffHunk": "@@ -159,6 +160,7 @@ static void registerAll() {\n     register(ObserverToolsMatchModule.class, new ObserverToolsMatchModule.Factory());\n     register(FireworkMatchModule.class, FireworkMatchModule::new);\n     register(StatsMatchModule.class, StatsMatchModule::new);\n+    register(TeamRestrictModule.class, TeamRestrictModule::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6241f452023ab46db8a607518c62062b4f77289c"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0eaa6500e838cd9c3185aacd19e837b517280fe", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/c0eaa6500e838cd9c3185aacd19e837b517280fe", "committedDate": "2020-03-31T00:47:39Z", "message": "Rename module\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NTE4Mjkz", "url": "https://github.com/PGMDev/PGM/pull/389#pullrequestreview-384518293", "createdAt": "2020-03-31T08:39:52Z", "commit": {"oid": "c0eaa6500e838cd9c3185aacd19e837b517280fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwODozOTo1MlrOF-LL1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwODozOTo1MlrOF-LL1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczOTI4NA==", "bodyText": "If you won't return the party unless it's a team, why don't you just store teams to start with?", "url": "https://github.com/PGMDev/PGM/pull/389#discussion_r400739284", "createdAt": "2020-03-31T08:39:52Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/modules/TeamRestrictMatchModule.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package tc.oc.pgm.modules;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.EventPriority;\n+import org.bukkit.event.Listener;\n+import tc.oc.pgm.api.match.Match;\n+import tc.oc.pgm.api.match.MatchModule;\n+import tc.oc.pgm.api.match.MatchScope;\n+import tc.oc.pgm.api.party.Party;\n+import tc.oc.pgm.events.ListenerScope;\n+import tc.oc.pgm.events.PlayerJoinPartyEvent;\n+import tc.oc.pgm.teams.Team;\n+\n+@ListenerScope(MatchScope.LOADED)\n+public class TeamRestrictMatchModule implements MatchModule, Listener {\n+\n+  private final Match match;\n+  private final Map<UUID, Party> playerTeamMap = new HashMap<>();\n+\n+  public TeamRestrictMatchModule(Match match) {\n+    this.match = match;\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void addPlayerToMatch(PlayerJoinPartyEvent event) {\n+    UUID playerID = event.getPlayer().getId();\n+    if (playerTeamMap.containsKey(playerID)\n+        && !event\n+            .getNewParty()\n+            .isObserving()) { // If player was previously on team but joins obs, keep previous team\n+      playerTeamMap.replace(playerID, event.getNewParty());\n+\n+    } else if (!playerTeamMap.containsKey(playerID)) {\n+      playerTeamMap.put(playerID, event.getNewParty());\n+    }\n+  }\n+\n+  public Map<UUID, Party> getPlayerTeamMap() {\n+    return playerTeamMap;\n+  }\n+\n+  public Team getLastTeam(UUID id) {\n+    Party lastParty = playerTeamMap.get(id);\n+    if (lastParty instanceof Team) {\n+      return (Team) lastParty;\n+    } else {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0eaa6500e838cd9c3185aacd19e837b517280fe"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "353b03d106518e92b2da720e676108abeda32ec2", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/353b03d106518e92b2da720e676108abeda32ec2", "committedDate": "2020-03-31T16:32:03Z", "message": "Merge branch 'master' into team-restrict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "966b45eb84dc19a6d9d95ab3f25e858479f3fd52", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/966b45eb84dc19a6d9d95ab3f25e858479f3fd52", "committedDate": "2020-03-31T16:50:34Z", "message": "Rework restrict code into TeamMatchModule\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3da1327fb827a7127dad3c77795eaafb8cb304d", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/b3da1327fb827a7127dad3c77795eaafb8cb304d", "committedDate": "2020-03-31T17:12:42Z", "message": "Merge branch 'freeze-world' into team-restrict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37d41a927c40b2828373a957591197e16391fadb", "author": {"user": {"login": "EricZeiberg", "name": "Eric Zeiberg"}}, "url": "https://github.com/PGMDev/PGM/commit/37d41a927c40b2828373a957591197e16391fadb", "committedDate": "2020-04-03T23:45:12Z", "message": "Rework map to store teams instead of parties\n\nSigned-off-by: Eric Zeiberg <ejzeiberg@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNDcyNzA3", "url": "https://github.com/PGMDev/PGM/pull/389#pullrequestreview-391472707", "createdAt": "2020-04-10T14:30:37Z", "commit": {"oid": "37d41a927c40b2828373a957591197e16391fadb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 472, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}