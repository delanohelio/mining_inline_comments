{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNzcwOTk1", "number": 223, "title": "Play raindrop sounds", "bodyText": "Resolves #204\nRelated: https://github.com/OvercastNetwork/ProjectAres/blob/079d13ce62aee9a85f6871384a53356bd25735a8/Commons/bukkit/src/main/java/tc/oc/commons/bukkit/raindrops/RaindropUtil.java#L136", "createdAt": "2020-01-11T22:33:56Z", "url": "https://github.com/PGMDev/PGM/pull/223", "merged": true, "mergeCommit": {"oid": "d6d73c61274928ed1cf8db5b44571df44fb846f8"}, "closed": true, "closedAt": "2020-01-13T17:14:17Z", "author": {"login": "TheMolkaPL"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5a79RAH2gAyMzYxNzcwOTk1OjQ1NzNhNjRhYWY0MjY4YjA2MDllOWNiNmI1MGQ4M2YxNzkzZTIyYjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5_jldAH2gAyMzYxNzcwOTk1OjZlMjIzZWJjNjI2MWE1MDMyYmMxYzI0ZjhlOWY0MTRkZTViNjBiMWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "committedDate": "2020-01-11T22:31:38Z", "message": "Play raindrop sounds\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTQ2OTgw", "url": "https://github.com/PGMDev/PGM/pull/223#pullrequestreview-341546980", "createdAt": "2020-01-12T00:15:22Z", "commit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwMDoxNToyMlrOFcnWKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwMDoxNToyMlrOFcnWKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0OTA5Ng==", "bodyText": "Will this play for touching a core? When touching cores you shouldn't get them until completion", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365549096", "createdAt": "2020-01-12T00:15:22Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/modules/RaindropSoundsMatchModule.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package tc.oc.pgm.modules;\n+\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.EventPriority;\n+import org.bukkit.event.Listener;\n+import tc.oc.pgm.api.chat.Sound;\n+import tc.oc.pgm.api.match.Match;\n+import tc.oc.pgm.api.match.MatchScope;\n+import tc.oc.pgm.api.match.event.MatchFinishEvent;\n+import tc.oc.pgm.api.party.Competitor;\n+import tc.oc.pgm.api.player.MatchPlayer;\n+import tc.oc.pgm.api.player.MatchPlayerState;\n+import tc.oc.pgm.api.player.ParticipantState;\n+import tc.oc.pgm.api.player.event.MatchPlayerDeathEvent;\n+import tc.oc.pgm.api.setting.SettingKey;\n+import tc.oc.pgm.api.setting.SettingValue;\n+import tc.oc.pgm.api.setting.Settings;\n+import tc.oc.pgm.events.ListenerScope;\n+import tc.oc.pgm.goals.events.GoalTouchEvent;\n+import tc.oc.pgm.match.MatchModule;\n+import tc.oc.pgm.match.MatchModuleFactory;\n+import tc.oc.pgm.module.ModuleLoadException;\n+import tc.oc.pgm.wool.PlayerWoolPlaceEvent;\n+\n+@ListenerScope(MatchScope.RUNNING)\n+public class RaindropSoundsMatchModule extends MatchModule implements Listener {\n+\n+  public static class Factory implements MatchModuleFactory<RaindropSoundsMatchModule> {\n+    @Override\n+    public RaindropSoundsMatchModule createMatchModule(Match match) throws ModuleLoadException {\n+      return new RaindropSoundsMatchModule(match);\n+    }\n+  }\n+\n+  private static final Sound SOUND = new Sound(\"random.levelup\", 1f, 1.5f);\n+\n+  public RaindropSoundsMatchModule(Match match) {\n+    super(match);\n+  }\n+\n+  private void play(MatchPlayer player) {\n+    Settings settings = player.getSettings();\n+    if (settings.getValue(SettingKey.RAINDROP_SOUNDS).equals(SettingValue.RAINDROP_SOUNDS_ON)) {\n+      player.playSound(SOUND);\n+    }\n+  }\n+\n+  private void play(MatchPlayerState playerState) {\n+    playerState.getPlayer().ifPresent(this::play);\n+  }\n+\n+  private void play(Competitor competitor) {\n+    competitor.getPlayers().forEach(this::play);\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void onMatchPlayerDeath(MatchPlayerDeathEvent event) {\n+    ParticipantState killer = event.getKiller();\n+    if (killer != null) {\n+      play(killer);\n+    }\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void onMatchFinish(MatchFinishEvent event) {\n+    event.getWinners().forEach(this::play);\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void onGoalTouch(GoalTouchEvent event) {\n+    ParticipantState player = event.getPlayer();\n+    if (player != null) {\n+      play(player);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTU3MTgw", "url": "https://github.com/PGMDev/PGM/pull/223#pullrequestreview-341557180", "createdAt": "2020-01-12T07:03:49Z", "commit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwNzowMzo1MFrOFcoI0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwNzowNDo0OFrOFcoI9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2MjA2NA==", "bodyText": "just sounds, want to make it expandable", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365562064", "createdAt": "2020-01-12T07:03:50Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingKey.java", "diffHunk": "@@ -30,6 +30,10 @@ public void update(MatchPlayer player) {\n       player.resetVisibility();\n     }\n   }, // Changes if observers are visible\n+  RAINDROP_SOUNDS(\n+      Arrays.asList(\"raindrop-sounds\", \"rds\"),\n+      RAINDROP_SOUNDS_ON,\n+      RAINDROP_SOUNDS_OFF), // Changes if raindrop sounds are played", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2MjA3Mg==", "bodyText": "sounds", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365562072", "createdAt": "2020-01-12T07:03:57Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingValue.java", "diffHunk": "@@ -33,6 +33,9 @@\n \n   OBSERVERS_ON(\"observers\", \"on\"), // Show observers\n   OBSERVERS_OFF(\"observers\", \"off\"), // Hide observers\n+\n+  RAINDROP_SOUNDS_ON(\"raindrop_sounds\", \"on\"), // Always play raindrop sounds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2MjEwMQ==", "bodyText": "There's no concept of \"raindrops\" anymore, should just be sounds.", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365562101", "createdAt": "2020-01-12T07:04:48Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/modules/RaindropSoundsMatchModule.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package tc.oc.pgm.modules;\n+\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.EventPriority;\n+import org.bukkit.event.Listener;\n+import tc.oc.pgm.api.chat.Sound;\n+import tc.oc.pgm.api.match.Match;\n+import tc.oc.pgm.api.match.MatchScope;\n+import tc.oc.pgm.api.match.event.MatchFinishEvent;\n+import tc.oc.pgm.api.party.Competitor;\n+import tc.oc.pgm.api.player.MatchPlayer;\n+import tc.oc.pgm.api.player.MatchPlayerState;\n+import tc.oc.pgm.api.player.ParticipantState;\n+import tc.oc.pgm.api.player.event.MatchPlayerDeathEvent;\n+import tc.oc.pgm.api.setting.SettingKey;\n+import tc.oc.pgm.api.setting.SettingValue;\n+import tc.oc.pgm.api.setting.Settings;\n+import tc.oc.pgm.events.ListenerScope;\n+import tc.oc.pgm.goals.events.GoalTouchEvent;\n+import tc.oc.pgm.match.MatchModule;\n+import tc.oc.pgm.match.MatchModuleFactory;\n+import tc.oc.pgm.module.ModuleLoadException;\n+import tc.oc.pgm.wool.PlayerWoolPlaceEvent;\n+\n+@ListenerScope(MatchScope.RUNNING)\n+public class RaindropSoundsMatchModule extends MatchModule implements Listener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "committedDate": "2020-01-12T18:05:39Z", "message": "Make sounds generic\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "606dfb387adc41f78673dde2257232ba913f97ee", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/606dfb387adc41f78673dde2257232ba913f97ee", "committedDate": "2020-01-12T17:59:38Z", "message": "Make sounds generic\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}, "afterCommit": {"oid": "8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "committedDate": "2020-01-12T18:05:39Z", "message": "Make sounds generic\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMDAwOTk5", "url": "https://github.com/PGMDev/PGM/pull/223#pullrequestreview-342000999", "createdAt": "2020-01-13T17:11:24Z", "commit": {"oid": "8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e223ebc6261a5032bc1c24f8e9f414de5b60b1b", "author": {"user": {"login": "Electroid", "name": "Ashcon Partovi"}}, "url": "https://github.com/PGMDev/PGM/commit/6e223ebc6261a5032bc1c24f8e9f414de5b60b1b", "committedDate": "2020-01-13T17:11:30Z", "message": "Merge branch 'master' into raindrop-sounds"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 538, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}