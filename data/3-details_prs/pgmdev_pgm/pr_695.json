{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMzM3NTA0", "number": 695, "title": "Defer validations for translated regions to their base", "bodyText": "Fixes a super rare bug involving region reference parsing\nBasically, if you run validations during parsing on a translated region that has a reference as the region being translated, validations will fail with an ISS. This occurs because the logic that queues validations for references until after feature resolution doesn't take into account references inside of other region types. Since the check doesn't see the type being validated as a reference (since the reference is wrapped), normal validations are executed on an un-resolved reference.\nExample failing case:\n        <progress-display-region>  <translate offset=\"10,0,0\"><region id=\"progress\"/></translate></progress-display-region>", "createdAt": "2020-11-13T05:05:58Z", "url": "https://github.com/PGMDev/PGM/pull/695", "merged": true, "mergeCommit": {"oid": "72f687b416fdcb8ad99e23b69e8517263cbdba99"}, "closed": true, "closedAt": "2020-11-13T17:04:50Z", "author": {"login": "AustinLMayes"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb_5EwgH2gAyNTIwMzM3NTA0OjM1NmEyOTlkNjc2MWJjMDJiOGIzM2M2NWU0YTRjNWUwMGJhNDU5ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcKQX7gFqTUzMDI0MjQxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "356a299d6761bc02b8b33c65e4a4c5e00ba45983", "author": {"user": {"login": "AustinLMayes", "name": "Austin Mayes"}}, "url": "https://github.com/PGMDev/PGM/commit/356a299d6761bc02b8b33c65e4a4c5e00ba45983", "committedDate": "2020-11-13T04:59:33Z", "message": "Defer validations for translated regions to their base\n\nSigned-off-by: Austin L Mayes <me@austinlm.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d686b2a913d5406cdcf8960e80f82f7ff7761824", "author": {"user": {"login": "AustinLMayes", "name": "Austin Mayes"}}, "url": "https://github.com/PGMDev/PGM/commit/d686b2a913d5406cdcf8960e80f82f7ff7761824", "committedDate": "2020-11-13T05:12:51Z", "message": "Make sure base regions are references\n\nSigned-off-by: Austin L Mayes <me@austinlm.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4849f0eb36a1c306abd6c6fca4bb63f192acad3", "author": {"user": {"login": "AustinLMayes", "name": "Austin Mayes"}}, "url": "https://github.com/PGMDev/PGM/commit/d4849f0eb36a1c306abd6c6fca4bb63f192acad3", "committedDate": "2020-11-13T05:15:01Z", "message": "Code cleanup\n\nSigned-off-by: Austin L Mayes <me@austinlm.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NzQzMTA3", "url": "https://github.com/PGMDev/PGM/pull/695#pullrequestreview-529743107", "createdAt": "2020-11-13T05:15:59Z", "commit": {"oid": "d4849f0eb36a1c306abd6c6fca4bb63f192acad3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNToxNTo1OVrOHycaCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNToxNTo1OVrOHycaCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY1NjI2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      .validate(((XMLRegionReference) ((TransformedRegion) region).region), validation);\n          \n          \n            \n                      .validate((XMLRegionReference) ((TransformedRegion) region).region, validation);", "url": "https://github.com/PGMDev/PGM/pull/695#discussion_r522656264", "createdAt": "2020-11-13T05:15:59Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/regions/FeatureRegionParser.java", "diffHunk": "@@ -44,6 +44,11 @@ public void validate(Region region, FeatureValidation<RegionDefinition> validati\n       throws InvalidXMLException {\n     if (region instanceof XMLRegionReference) {\n       factory.getFeatures().validate((XMLRegionReference) region, validation);\n+    } else if (region instanceof TransformedRegion\n+        && ((TransformedRegion) region).region instanceof XMLRegionReference) {\n+      factory\n+          .getFeatures()\n+          .validate(((XMLRegionReference) ((TransformedRegion) region).region), validation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4849f0eb36a1c306abd6c6fca4bb63f192acad3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1862ccd0ea4d1179064bc80b6a2571bbeac239b7", "author": {"user": {"login": "AustinLMayes", "name": "Austin Mayes"}}, "url": "https://github.com/PGMDev/PGM/commit/1862ccd0ea4d1179064bc80b6a2571bbeac239b7", "committedDate": "2020-11-13T08:15:51Z", "message": "Remove parentheses\n\nCo-authored-by: Pablo Herrera <pabloherrerapalacio@gmail.com>\nSigned-off-by: Austin L Mayes <me@austinlm.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82cc2b8006065fee17cb5dde60736ccb89b25b9d", "author": {"user": {"login": "AustinLMayes", "name": "Austin Mayes"}}, "url": "https://github.com/PGMDev/PGM/commit/82cc2b8006065fee17cb5dde60736ccb89b25b9d", "committedDate": "2020-11-13T08:13:52Z", "message": "Remove parentheses\n\nCo-authored-by: Pablo Herrera <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "1862ccd0ea4d1179064bc80b6a2571bbeac239b7", "author": {"user": {"login": "AustinLMayes", "name": "Austin Mayes"}}, "url": "https://github.com/PGMDev/PGM/commit/1862ccd0ea4d1179064bc80b6a2571bbeac239b7", "committedDate": "2020-11-13T08:15:51Z", "message": "Remove parentheses\n\nCo-authored-by: Pablo Herrera <pabloherrerapalacio@gmail.com>\nSigned-off-by: Austin L Mayes <me@austinlm.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjQyNDE1", "url": "https://github.com/PGMDev/PGM/pull/695#pullrequestreview-530242415", "createdAt": "2020-11-13T17:04:03Z", "commit": {"oid": "1862ccd0ea4d1179064bc80b6a2571bbeac239b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 347, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}