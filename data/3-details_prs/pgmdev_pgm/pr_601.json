{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MDI3NDcw", "number": 601, "title": "Add mercy option to score module", "bodyText": "Allow a mercy option within the score module. This can be used alongside a limit or standalone. As referenced in #250.\nExample\nThis XML example will result in a match that progresses like the scoreboard screenshots.\nThe winner is the first team to get a mercy lead of 5 or reach the limit of 10.\n<score>\n    <mercy>5</mercy>\n    <limit>10</limit>\n</score>\n\nBlue team take a storming lead with just one flag away from the win, but wait, red team pulls it back and forces the score limit.\nWhat an epic gamer moment, so glad I got to watch this historic match on Nartica \u2122\ufe0f .\nNotes\nIf a limit is not set then a team will need to lead by the set mercy amount or fallback on another condition such as time.\nThe example above uses CTF but as it is the ScoreModule it would work with TDMs and Hills.\nThis just hooks into the scoring module so no changes to the scoreboard etc. I'd imagine this feature only being used in competitive environments where teams are aware of the score limit and mercy rules (from scrimming), otherwise, the scoreboard limit changing \"randomly\" may be a bit confusing. Maybe some UI work could be done to make this clearer.\nCode\nI have toyed around with the idea of including the feature directly in the score module but decided to separate it out into its own MercyRule class so I can have a few helper methods to make it a bit more readable. The topic of micro optimisation was mentioned in the linked issue, the current implementation only re-sorts all team scores if the lead or trail have their score decreased.\nWanted to get the PR made for this for feedback rather than having a useless finished branch that I had not touched in 3 months.\nSigned-off-by: Pugzy pugzy@mail.com", "createdAt": "2020-08-08T12:42:02Z", "url": "https://github.com/PGMDev/PGM/pull/601", "merged": true, "mergeCommit": {"oid": "70c139f3094195b68477180bce7ab645a9e6267b"}, "closed": true, "closedAt": "2020-08-13T18:35:46Z", "author": {"login": "Pugzy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9AzwwAFqTQ2MzgzMDU1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-kbAYAFqTQ2NzAzMTExMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzODMwNTU2", "url": "https://github.com/PGMDev/PGM/pull/601#pullrequestreview-463830556", "createdAt": "2020-08-08T22:30:41Z", "commit": {"oid": "ac733386ee98531410550cd8bb656fcaf84727d2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMjozMDo0MlrOG92lsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQyMjozMDo0MlrOG92lsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUxMDcwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private AbstractMap.SimpleEntry<Competitor, Double> leader;\n          \n          \n            \n              private AbstractMap.SimpleEntry<Competitor, Double> trailer;\n          \n          \n            \n              private Map.Entry<Competitor, Double> leader;\n          \n          \n            \n              private Map.Entry<Competitor, Double> trailer;\n          \n      \n    \n    \n  \n\nJust define the generric types here", "url": "https://github.com/PGMDev/PGM/pull/601#discussion_r467510707", "createdAt": "2020-08-08T22:30:42Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/score/MercyRule.java", "diffHunk": "@@ -0,0 +1,100 @@\n+package tc.oc.pgm.score;\n+\n+import java.util.AbstractMap;\n+import java.util.Map;\n+import tc.oc.pgm.api.party.Competitor;\n+import tc.oc.pgm.api.party.event.CompetitorScoreChangeEvent;\n+\n+public class MercyRule {\n+\n+  private final ScoreMatchModule scoreMatchModule;\n+  private final int scoreLimit;\n+  private final int mercyLimit;\n+\n+  private AbstractMap.SimpleEntry<Competitor, Double> leader;\n+  private AbstractMap.SimpleEntry<Competitor, Double> trailer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac733386ee98531410550cd8bb656fcaf84727d2"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac733386ee98531410550cd8bb656fcaf84727d2", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/ac733386ee98531410550cd8bb656fcaf84727d2", "committedDate": "2020-08-08T12:07:48Z", "message": "Add mercy option to score module\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}, "afterCommit": {"oid": "d44e6a0c986dc7f2003f486ff3e95001bf260a95", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/d44e6a0c986dc7f2003f486ff3e95001bf260a95", "committedDate": "2020-08-13T16:52:30Z", "message": "Add mercy option to score module\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8c9648fa8f8f9711fe79f3cbc9394e6333aca5d", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/e8c9648fa8f8f9711fe79f3cbc9394e6333aca5d", "committedDate": "2020-08-13T16:54:53Z", "message": "Add mercy option to score module\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d44e6a0c986dc7f2003f486ff3e95001bf260a95", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/d44e6a0c986dc7f2003f486ff3e95001bf260a95", "committedDate": "2020-08-13T16:52:30Z", "message": "Add mercy option to score module\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}, "afterCommit": {"oid": "e8c9648fa8f8f9711fe79f3cbc9394e6333aca5d", "author": {"user": {"login": "Pugzy", "name": "Andrew"}}, "url": "https://github.com/PGMDev/PGM/commit/e8c9648fa8f8f9711fe79f3cbc9394e6333aca5d", "committedDate": "2020-08-13T16:54:53Z", "message": "Add mercy option to score module\n\nSigned-off-by: Pugzy <pugzy@mail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDA0OTk0", "url": "https://github.com/PGMDev/PGM/pull/601#pullrequestreview-467004994", "createdAt": "2020-08-13T17:58:18Z", "commit": {"oid": "e8c9648fa8f8f9711fe79f3cbc9394e6333aca5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDMxMTEx", "url": "https://github.com/PGMDev/PGM/pull/601#pullrequestreview-467031111", "createdAt": "2020-08-13T18:35:28Z", "commit": {"oid": "e8c9648fa8f8f9711fe79f3cbc9394e6333aca5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 446, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}