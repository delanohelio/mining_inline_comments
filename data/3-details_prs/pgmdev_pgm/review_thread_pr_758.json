{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NTE5MTU1", "number": 758, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNjoyMlrOFJOaGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDo0MTo1MVrOFKhfAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1MjE3NTYxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/destroyable/DestroyableMatchModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNjoyMlrOILhhHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNjoyMlrOILhhHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk1NDM5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (destroyable.getMode() != null\n          \n          \n            \n                        && destroyable.getMode().equals(event.getMode().getStage())) {\n          \n          \n            \n                    } else if (destroyable.getMode().equals(event.getMode().getStage())) {\n          \n      \n    \n    \n  \n\nSince the previous if statement is already checking if the mode is null, no need to check again if it's not null \ud83d\ude04", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r548954398", "createdAt": "2020-12-26T07:26:22Z", "author": {"login": "applenick"}, "path": "core/src/main/java/tc/oc/pgm/destroyable/DestroyableMatchModule.java", "diffHunk": "@@ -126,7 +126,12 @@ public void onObjectiveModeSwitch(final ObjectiveModeChangeEvent event) {\n     for (Destroyable destroyable : this.destroyables) {\n       if (destroyable.isAffectedByModeChanges()) {\n         double oldCompletion = destroyable.getCompletion();\n-        destroyable.replaceBlocks(event.getMode().getMaterialData());\n+        if (destroyable.getMode() == null) {\n+          destroyable.replaceBlocks(event.getMode().getMaterialData());\n+        } else if (destroyable.getMode() != null\n+            && destroyable.getMode().equals(event.getMode().getStage())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4611d346bd28b7de72fed298881671b337aba756"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1MjE3Njk1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreMatchModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNzozMVrOILhhsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNzozMVrOILhhsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk1NDU0NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (core.getMode() != null && core.getMode().equals(event.getMode().getStage())) {\n          \n          \n            \n                      core.replaceBlocks(event.getMode().getMaterialData());\n          \n          \n            \n                    } else if (core.getMode().equals(event.getMode().getStage())) {\n          \n          \n            \n                      core.replaceBlocks(event.getMode().getMaterialData());\n          \n      \n    \n    \n  \n\nSee other comment", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r548954544", "createdAt": "2020-12-26T07:27:31Z", "author": {"login": "applenick"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreMatchModule.java", "diffHunk": "@@ -155,7 +155,11 @@ public void lavaProtection(final BlockTransformEvent event) {\n   public void onObjectiveModeSwitch(final ObjectiveModeChangeEvent event) {\n     for (Core core : this.cores) {\n       if (core.isAffectedByModeChanges()) {\n-        core.replaceBlocks(event.getMode().getMaterialData());\n+        if (core.getMode() == null) {\n+          core.replaceBlocks(event.getMode().getMaterialData());\n+        } else if (core.getMode() != null && core.getMode().equals(event.getMode().getStage())) {\n+          core.replaceBlocks(event.getMode().getMaterialData());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4611d346bd28b7de72fed298881671b337aba756"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDUzNDc1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreMatchModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1MDozM1rOILypsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1MDozM1rOILypsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTEyMw==", "bodyText": "You no longer need isAffectedByModeChanges.\nIf the list of modes is an empty collection, that's your validation that this is in fact, not affected by modes.\nOn the parsing side, make sure to make it so that if mode-changes is mutually exclusive with modes, and if modes isn't included you fall-back to either an empty set of modes (not affected by modes) or a null one or (possibly one that includes all modes) if it is mode-change affected", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235123", "createdAt": "2020-12-28T06:50:33Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreMatchModule.java", "diffHunk": "@@ -155,10 +155,7 @@ public void lavaProtection(final BlockTransformEvent event) {\n   public void onObjectiveModeSwitch(final ObjectiveModeChangeEvent event) {\n     for (Core core : this.cores) {\n       if (core.isAffectedByModeChanges()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDUzNjU5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1MTo0NlrOILyqqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwMjo1Nzo0OFrOIMcYFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTM3MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public List<Mode> getModeList() {\n          \n          \n            \n              public Set<Mode> getModeList() {\n          \n      \n    \n    \n  \n\nAcross the code, replace List with Set, you're primarily going to be doing contains on this collection, sets are better for that", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235370", "createdAt": "2020-12-28T06:51:46Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -161,7 +162,7 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n-  public List<String> getModeList() {\n+  public List<Mode> getModeList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkxODc0MA==", "bodyText": "Is there a reason why these shouldn't be ImmutableSets? These are after the sets are created and passed to the core object.", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549918740", "createdAt": "2020-12-30T02:57:48Z", "author": {"login": "CoWinkKeyDinkInc"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -161,7 +162,7 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n-  public List<String> getModeList() {\n+  public List<Mode> getModeList() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTM3MA=="}, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDUzODE4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1Mjo1MFrOILyreQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1Mjo1MFrOILyreQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTU3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      for (String mode : Splitter.on(\" \").split(modes)) {\n          \n          \n            \n                      for (String mode : Splitter.on(\"\\\\s\").split(modes)) {\n          \n      \n    \n    \n  \n\nuse whitespace as a separator, similar to the example in https://github.com/PGMDev/PGM/blob/dev/core/src/main/java/tc/oc/pgm/flag/FlagParser.java#L105", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235577", "createdAt": "2020-12-28T06:52:50Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -118,13 +119,14 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n         }\n \n         String modes = coreEl.getAttributeValue(\"modes\");\n-        List<String> modeList = new ArrayList<>();\n+        List<Mode> modeList = new ArrayList<>();\n         if (modes != null) {\n-          Node node = Node.fromAttr(coreEl, modes);\n-          if (node != null) {\n-            for (String mode : Splitter.on(\" \").split(node.getValue())) {\n-              modeList.add(mode);\n-            }\n+          for (String mode : Splitter.on(\" \").split(modes)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDUzODkyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1MzoxM1rOILyr0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1MzoxM1rOILyr0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTY2Nw==", "bodyText": "Make this an ImmutableSet, like the example in https://github.com/PGMDev/PGM/blob/dev/core/src/main/java/tc/oc/pgm/flag/FlagParser.java#L105", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235667", "createdAt": "2020-12-28T06:53:13Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -118,13 +119,14 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n         }\n \n         String modes = coreEl.getAttributeValue(\"modes\");\n-        List<String> modeList = new ArrayList<>();\n+        List<Mode> modeList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDU0MDU4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1NDoxM1rOILysvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1NDoxM1rOILysvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTkwMQ==", "bodyText": "You left out some debugs here, also, you need to check that the mode returned isn't null or else it means that mode hasn't been found, again, you have a perfect 1 to 1 example in https://github.com/PGMDev/PGM/blob/dev/core/src/main/java/tc/oc/pgm/flag/FlagParser.java#L105", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235901", "createdAt": "2020-12-28T06:54:13Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -118,13 +119,14 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n         }\n \n         String modes = coreEl.getAttributeValue(\"modes\");\n-        List<String> modeList = new ArrayList<>();\n+        List<Mode> modeList = new ArrayList<>();\n         if (modes != null) {\n-          Node node = Node.fromAttr(coreEl, modes);\n-          if (node != null) {\n-            for (String mode : Splitter.on(\" \").split(node.getValue())) {\n-              modeList.add(mode);\n-            }\n+          for (String mode : Splitter.on(\" \").split(modes)) {\n+            Iterable bigcontext = context.getFeatures().getAll(Mode.class);\n+            System.out.println(bigcontext);\n+            Mode mode1 = context.getFeatures().get(mode, Mode.class);\n+            modeList.add(mode1);\n+            System.out.println(mode1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDc1ODQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo0MToxNlrOIMpULA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo0MToxNlrOIMpULA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzMDczMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public Set<SelfIdentifyingFeatureDefinition> getModeList() {\n          \n          \n            \n              public ImmutableSet<Mode> getModes() {\n          \n      \n    \n    \n  \n\nAnd make this change across the places with this set, it's a set of Modes, not a set of any type of feature definition, also just call it getModes, and the variable in the definition modes,  it's not a list to start with (it's a set) and that's also the naming used in the xml, so easiest to keep it consistent.\nYou also need to move this up the hierarchy in interfaces to ModeChangeGoal, replacing isAffectedByModeChanges", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550130732", "createdAt": "2020-12-30T10:41:16Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -160,6 +161,10 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n+  public Set<SelfIdentifyingFeatureDefinition> getModeList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDc5MjQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo0OToxMlrOIMpqZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo0OToxMlrOIMpqZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzNjQyMA==", "bodyText": "You can replace instances of SelfIdentifyingFeatureDefinition Mode in this and a few other classes when used in return types and lists as it extends it.", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550136420", "createdAt": "2020-12-30T10:49:12Z", "author": {"login": "Pugzy"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -160,6 +161,10 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n+  public Set<SelfIdentifyingFeatureDefinition> getModeList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDc5ODk3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MDozNFrOIMpumA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MDozNFrOIMpumA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzNzQ5Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  ImmutableSet.Builder<SelfIdentifyingFeatureDefinition> modes = ImmutableSet.builder();\n          \n          \n            \n                  for (String modeId : node.getValue().split(\"\\\\s\")) {\n          \n          \n            \n                    SelfIdentifyingFeatureDefinition mode =\n          \n          \n            \n                        context.getFeatures().get(modeId, SelfIdentifyingFeatureDefinition.class);\n          \n          \n            \n                    if (mode == null) {\n          \n          \n            \n                      throw new InvalidXMLException(\"No mode with ID '\" + modeId + \"'\", node);\n          \n          \n            \n                    }\n          \n          \n            \n                    modes.add(mode);\n          \n          \n            \n                  }\n          \n          \n            \n                  return modes.build();\n          \n          \n            \n                  ImmutableSet.Builder<Mode> modes = ImmutableSet.builder();\n          \n          \n            \n                  for (String modeId : node.getValue().split(\"\\\\s\")) {\n          \n          \n            \n                    Mode mode = context.getFeatures().get(modeId, Mode.class);\n          \n          \n            \n                    if (mode == null) {\n          \n          \n            \n                      throw new InvalidXMLException(\"No mode with ID '\" + modeId + \"'\", node);\n          \n          \n            \n                    }\n          \n          \n            \n                    modes.add(mode);\n          \n          \n            \n                  }\n          \n          \n            \n                  return modes.build();\n          \n      \n    \n    \n  \n\nGet modes, not SelfIdentifyingFeatureDefinitions", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550137496", "createdAt": "2020-12-30T10:50:34Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -71,6 +71,20 @@ public MatchModule createMatchModule(Match match) {\n       return ImmutableList.of(RegionModule.class, TeamModule.class);\n     }\n \n+    public ImmutableSet<SelfIdentifyingFeatureDefinition> parseModeSet(\n+        Node node, MapFactory context) throws InvalidXMLException {\n+      ImmutableSet.Builder<SelfIdentifyingFeatureDefinition> modes = ImmutableSet.builder();\n+      for (String modeId : node.getValue().split(\"\\\\s\")) {\n+        SelfIdentifyingFeatureDefinition mode =\n+            context.getFeatures().get(modeId, SelfIdentifyingFeatureDefinition.class);\n+        if (mode == null) {\n+          throw new InvalidXMLException(\"No mode with ID '\" + modeId + \"'\", node);\n+        }\n+        modes.add(mode);\n+      }\n+      return modes.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDc5OTQ0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MDo0NFrOIMpu4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MDo0NFrOIMpu4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzNzU2OA==", "bodyText": "Avoid wildcard imports (can be turned off in Intellij).", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550137568", "createdAt": "2020-12-30T10:50:44Z", "author": {"login": "Pugzy"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -1,10 +1,9 @@\n package tc.oc.pgm.core;\n \n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Lists;\n-import java.util.Collection;\n-import java.util.HashMap;\n-import java.util.List;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDgwOTgyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/destroyable/DestroyableModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MzozMVrOIMp1nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MzozMVrOIMp1nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzOTI5Mg==", "bodyText": "Should use if (destroyableEl.getAttributeValue(\"modes\") != null) { rather than isEmpty and ! not.\ngetAttributeValue returns the Attribute or null so calling isEmpty produces an NPE on maps without modes defined.", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550139292", "createdAt": "2020-12-30T10:53:31Z", "author": {"login": "Pugzy"}, "path": "core/src/main/java/tc/oc/pgm/destroyable/DestroyableModule.java", "diffHunk": "@@ -111,6 +124,13 @@ public DestroyableModule parse(MapFactory context, Logger logger, Document doc)\n         Set<SingleMaterialMatcher> materials =\n             XMLUtils.parseMaterialPatternSet(\n                 Node.fromRequiredAttr(destroyableEl, \"materials\", \"material\"));\n+\n+        ImmutableSet<SelfIdentifyingFeatureDefinition> modeList = null;\n+        if (!destroyableEl.getAttributeValue(\"modes\").isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDg0MTUwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMTowMDozNlrOIMqKPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMTowMDozNlrOIMqKPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE0NDU3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public ImmutableSet<SelfIdentifyingFeatureDefinition> parseModeSet(\n          \n          \n            \n                    Node node, MapFactory context) throws InvalidXMLException {\n          \n          \n            \n                public ImmutableSet<Mode> parseModeSet(Node node) throws InvalidXMLException {\n          \n      \n    \n    \n  \n\nMake the factory a field in the class, no need to pass it as parameter", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550144574", "createdAt": "2020-12-30T11:00:36Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -71,6 +71,20 @@ public MatchModule createMatchModule(Match match) {\n       return ImmutableList.of(RegionModule.class, TeamModule.class);\n     }\n \n+    public ImmutableSet<SelfIdentifyingFeatureDefinition> parseModeSet(\n+        Node node, MapFactory context) throws InvalidXMLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MDg2NDk2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMTowNTo0MVrOIMqZfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMTowNTo0MVrOIMqZfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE0ODQ3Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ImmutableSet<SelfIdentifyingFeatureDefinition> modeList = null;\n          \n          \n            \n                    if (!coreEl.getAttributeValue(\"modes\").isEmpty()) {\n          \n          \n            \n                      modeList = parseModeSet(Objects.requireNonNull(Node.fromAttr(coreEl, \"modes\")), context);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    boolean modeChanges = XMLUtils.parseBoolean(coreEl.getAttribute(\"mode-changes\"), false);\n          \n          \n            \n                    ImmutableSet<Mode> modes;\n          \n          \n            \n                    Node modes = Node.fromAttr(coreEl, \"modes\");\n          \n          \n            \n                    if (modes != null) {\n          \n          \n            \n                        if (coreEl.getAttribute(\"mode-changes\") != null)\n          \n          \n            \n                            throw new InvalidXMLException(\"Cannot combine modes and mode-changes\");\n          \n          \n            \n                            \n          \n          \n            \n                        modes = parseModeSet(modes, context); // Specific set of modes\n          \n          \n            \n                    } else if (XMLUtils.parseBoolean(coreEl.getAttribute(\"mode-changes\"), false)) {\n          \n          \n            \n                        modes = null; // All modes\n          \n          \n            \n                    } else {\n          \n          \n            \n                        modes = ImmutableSet.of(); // No modes\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nMake parsing for modes properly support the legacy mode-changes, also make sure to throw an exception if they're combined.\nYou also need to remove all traces of modeChanges in the rest of the codebase, it is no longer a thing since we have a specific set now", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550148476", "createdAt": "2020-12-30T11:05:41Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -115,6 +129,11 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n           serialNumbers.put(owner, serial + 1);\n         }\n \n+        ImmutableSet<SelfIdentifyingFeatureDefinition> modeList = null;\n+        if (!coreEl.getAttributeValue(\"modes\").isEmpty()) {\n+          modeList = parseModeSet(Objects.requireNonNull(Node.fromAttr(coreEl, \"modes\")), context);\n+        }\n+\n         boolean modeChanges = XMLUtils.parseBoolean(coreEl.getAttribute(\"mode-changes\"), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTc4NjkwOnYy", "diffSide": "LEFT", "path": "core/src/main/java/tc/oc/pgm/goals/ModeChangeGoal.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDo0MTo1MVrOINTtQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDo0MTo1MVrOINTtQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNTI4Mg==", "bodyText": "Consider adding here ImmutableSet<Mode> getModes to replace the previous method", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550825282", "createdAt": "2021-01-02T00:41:51Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/goals/ModeChangeGoal.java", "diffHunk": "@@ -11,6 +11,4 @@\n   boolean isObjectiveMaterial(Block block);\n \n   String getModeChangeMessage(Material material);\n-\n-  boolean isAffectedByModeChanges();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549265921c4f26810b6e05ec558b12a5a22701b2"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 976, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}