{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjQxMjAz", "number": 191, "title": "Allow to toggle observers", "bodyText": "", "createdAt": "2020-01-04T19:38:34Z", "url": "https://github.com/PGMDev/PGM/pull/191", "merged": true, "mergeCommit": {"oid": "6d2dafb3dd424f2df98a7bfc2c10ade1422982c0"}, "closed": true, "closedAt": "2020-01-05T12:10:58Z", "author": {"login": "TheMolkaPL"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3IOQ1gH2gAyMzU5MjQxMjAzOmEyYzc5ODJjODEzMjAzOGU4YTgyNmE2ZTZkYjdiNjA0MDBkOWRhYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3Wc_8gFqTMzODM5NjY3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2c7982c8132038e8a826a6e6db7b60400d9dab4", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/a2c7982c8132038e8a826a6e6db7b60400d9dab4", "committedDate": "2020-01-04T19:35:35Z", "message": "Allow to toggle observers\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzcwNzU3", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338370757", "createdAt": "2020-01-04T21:26:10Z", "commit": {"oid": "a2c7982c8132038e8a826a6e6db7b60400d9dab4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMToyNjoxMFrOFaPLiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMTozMDoxMVrOFaPMOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjAwOA==", "bodyText": "Why not just on/off? I think it's better to be somewhat consistent with other settings if players want to be able to find/explore them easily.", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363056008", "createdAt": "2020-01-04T21:26:10Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingValue.java", "diffHunk": "@@ -21,7 +21,9 @@\n   DEATH_ALL(\"death\", \"all\"), // Send all death messages, highlight your own\n   PICKER_AUTO(\"picker\", \"auto\"), // Display after cycle, or with permissions.\n   PICKER_ON(\"picker\", \"on\"), // Display the picker GUI always\n-  PICKER_OFF(\"picker\", \"off\"); // Never display the picker GUI\n+  PICKER_OFF(\"picker\", \"off\"), // Never display the picker GUI\n+  OBSERVERS_SHOWN(\"observers\", \"shown\"), // Show observers\n+  OBSERVERS_HIDDEN(\"observers\", \"hidden\"); // Hide observers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c7982c8132038e8a826a6e6db7b60400d9dab4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjE4NA==", "bodyText": "This 4th branch should never occur, or am i missing something? If that's the case, maybe leave a comment saying that shouldn't happen.", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363056184", "createdAt": "2020-01-04T21:30:11Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/match/MatchPlayerImpl.java", "diffHunk": "@@ -172,7 +174,13 @@ public boolean canInteract() {\n \n   @Override\n   public boolean canSee(MatchPlayer other) {\n-    return (isObserving() || other.isParticipating()) && other.isVisible();\n+    if (!other.isVisible()) return false;\n+    if (other.isParticipating()) return true;\n+    if (isObserving()) {\n+      SettingValue observers = getSettings().getValue(SettingKey.OBSERVERS);\n+      return observers.equals(SettingValue.OBSERVERS_SHOWN);\n+    }\n+    return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c7982c8132038e8a826a6e6db7b60400d9dab4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzcxODM2", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338371836", "createdAt": "2020-01-04T22:00:10Z", "commit": {"oid": "a2c7982c8132038e8a826a6e6db7b60400d9dab4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjowMDoxMFrOFaPQ5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjowMDoxMFrOFaPQ5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NzM4MA==", "bodyText": "Change to:\nreturn getSettings().getValue(SettingKey.OBSERVERS) == SettingValue.OBSERVERS_SHOWN;", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363057380", "createdAt": "2020-01-04T22:00:10Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/match/MatchPlayerImpl.java", "diffHunk": "@@ -172,7 +174,13 @@ public boolean canInteract() {\n \n   @Override\n   public boolean canSee(MatchPlayer other) {\n-    return (isObserving() || other.isParticipating()) && other.isVisible();\n+    if (!other.isVisible()) return false;\n+    if (other.isParticipating()) return true;\n+    if (isObserving()) {\n+      SettingValue observers = getSettings().getValue(SettingKey.OBSERVERS);\n+      return observers.equals(SettingValue.OBSERVERS_SHOWN);\n+    }\n+    return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c7982c8132038e8a826a6e6db7b60400d9dab4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec5a164bd4c31da670839f9bad12f3fe12301973", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/ec5a164bd4c31da670839f9bad12f3fe12301973", "committedDate": "2020-01-04T22:04:59Z", "message": "Simplify canSee logic with obs setting\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec8274f1ee6849a015069ab5587ed459545c48ff", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/ec8274f1ee6849a015069ab5587ed459545c48ff", "committedDate": "2020-01-04T22:10:23Z", "message": "Rename shown/hidden to on/off\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc83dc5c1ab35c1773d7286f9c2d7086e8166e89", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/dc83dc5c1ab35c1773d7286f9c2d7086e8166e89", "committedDate": "2020-01-04T22:13:20Z", "message": "I forgot to rename them in SettingKey\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzcyMjgz", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338372283", "createdAt": "2020-01-04T22:15:15Z", "commit": {"oid": "dc83dc5c1ab35c1773d7286f9c2d7086e8166e89"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjoxNToxNVrOFaPTHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjoxNToxNVrOFaPTHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1Nzk0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return getSettings().getValue(SettingKey.OBSERVERS) == SettingValue.OBSERVERS_ON;\n          \n          \n            \n                return isObserving() && getSettings().getValue(SettingKey.OBSERVERS) == SettingValue.OBSERVERS_ON;", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363057949", "createdAt": "2020-01-04T22:15:15Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/match/MatchPlayerImpl.java", "diffHunk": "@@ -172,7 +174,9 @@ public boolean canInteract() {\n \n   @Override\n   public boolean canSee(MatchPlayer other) {\n-    return (isObserving() || other.isParticipating()) && other.isVisible();\n+    if (!other.isVisible()) return false;\n+    if (other.isParticipating()) return true;\n+    return getSettings().getValue(SettingKey.OBSERVERS) == SettingValue.OBSERVERS_ON;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc83dc5c1ab35c1773d7286f9c2d7086e8166e89"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bda4bd1cce66f76daf008f991cef5d0de7c36c2f", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/bda4bd1cce66f76daf008f991cef5d0de7c36c2f", "committedDate": "2020-01-04T22:16:09Z", "message": "isObserving\n\nCo-Authored-By: Pablo Herrera <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "7fa6b0d8b94d9b32a85ae869db1a5127388bc80d", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/7fa6b0d8b94d9b32a85ae869db1a5127388bc80d", "committedDate": "2020-01-04T22:16:49Z", "message": "isObserving\n\nSigned-off-by: Pablo Herrera <pabloherrerapalacio@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16b5e85627822a0b85558f327ab180a268c650f6", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/16b5e85627822a0b85558f327ab180a268c650f6", "committedDate": "2020-01-04T22:18:02Z", "message": "isObserving\n\nSigned-off-by: Pablo Herrera <pabloherrerapalacio@gmail.com>\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fa6b0d8b94d9b32a85ae869db1a5127388bc80d", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/7fa6b0d8b94d9b32a85ae869db1a5127388bc80d", "committedDate": "2020-01-04T22:16:49Z", "message": "isObserving\n\nSigned-off-by: Pablo Herrera <pabloherrerapalacio@gmail.com>"}, "afterCommit": {"oid": "16b5e85627822a0b85558f327ab180a268c650f6", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/16b5e85627822a0b85558f327ab180a268c650f6", "committedDate": "2020-01-04T22:18:02Z", "message": "isObserving\n\nSigned-off-by: Pablo Herrera <pabloherrerapalacio@gmail.com>\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459621a2df2ac7ba8777ceb0b5dce7c6b3ff799d", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/459621a2df2ac7ba8777ceb0b5dce7c6b3ff799d", "committedDate": "2020-01-04T22:20:25Z", "message": "Fix formatting\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93716c6093b41e12d99f5f19b1e5b5bdaa3742bb", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/93716c6093b41e12d99f5f19b1e5b5bdaa3742bb", "committedDate": "2020-01-04T22:21:30Z", "message": "Merge branch 'master' into toggle-obs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzgwNjM1", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338380635", "createdAt": "2020-01-05T04:43:25Z", "commit": {"oid": "93716c6093b41e12d99f5f19b1e5b5bdaa3742bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwNDo0MzoyNVrOFaP_Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwNDo0MzoyNVrOFaP_Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2OTI0Mw==", "bodyText": "make the string constants on/off?", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363069243", "createdAt": "2020-01-05T04:43:25Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingValue.java", "diffHunk": "@@ -21,7 +21,9 @@\n   DEATH_ALL(\"death\", \"all\"), // Send all death messages, highlight your own\n   PICKER_AUTO(\"picker\", \"auto\"), // Display after cycle, or with permissions.\n   PICKER_ON(\"picker\", \"on\"), // Display the picker GUI always\n-  PICKER_OFF(\"picker\", \"off\"); // Never display the picker GUI\n+  PICKER_OFF(\"picker\", \"off\"), // Never display the picker GUI\n+  OBSERVERS_ON(\"observers\", \"shown\"), // Show observers\n+  OBSERVERS_OFF(\"observers\", \"hidden\"); // Hide observers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93716c6093b41e12d99f5f19b1e5b5bdaa3742bb"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f76076fd0fd3a591511c328936637cd2169fa800", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/f76076fd0fd3a591511c328936637cd2169fa800", "committedDate": "2020-01-05T08:40:40Z", "message": "Make obs setting updatable\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fad2ed763e501eb929b9e98463edbdabf105f220", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/fad2ed763e501eb929b9e98463edbdabf105f220", "committedDate": "2020-01-05T08:39:58Z", "message": "Make obs setting updatable\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}, "afterCommit": {"oid": "f76076fd0fd3a591511c328936637cd2169fa800", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/f76076fd0fd3a591511c328936637cd2169fa800", "committedDate": "2020-01-05T08:40:40Z", "message": "Make obs setting updatable\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8c4b976517820d43459daa17f7f212fc45b26a0", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/b8c4b976517820d43459daa17f7f212fc45b26a0", "committedDate": "2020-01-05T08:45:39Z", "message": "Merge branch 'master' into toggle-obs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzg3Nzkz", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338387793", "createdAt": "2020-01-05T08:47:28Z", "commit": {"oid": "f76076fd0fd3a591511c328936637cd2169fa800"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwODo0NzoyOFrOFaQiIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwODo0NzoyOFrOFaQiIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3ODE3OA==", "bodyText": "A way to heavily simplify this, is to have a constructor overload:\nSettingKey(List<String> aliases, Consumer<MatchPlayer> update, SettingValue... values)\nThen this just becomes:\nOBSERVERS(Arrays.asList(\"observers\", \"obs\"), MatchPlayer::resetVisibility, OBSERVERS_ON, OBSERVERS_OFF)\nAs obvious, you'll need to keep the consumer on a variable, and on the update method call it if it's not null", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363078178", "createdAt": "2020-01-05T08:47:28Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingKey.java", "diffHunk": "@@ -18,10 +19,12 @@\n   DEATH(\n       Arrays.asList(\"death\", \"dms\"), DEATH_ALL, DEATH_OWN), // Changes which death messages are seen\n   PICKER(\"picker\", PICKER_AUTO, PICKER_ON, PICKER_OFF), // Changes when the picker is displayed\n-  OBSERVERS(\n-      Arrays.asList(\"observers\", \"obs\"),\n-      OBSERVERS_ON,\n-      OBSERVERS_OFF); // Changes if observers are visible\n+  OBSERVERS(Arrays.asList(\"observers\", \"obs\"), OBSERVERS_ON, OBSERVERS_OFF) {\n+    @Override\n+    public void update(MatchPlayer player) {\n+      player.resetVisibility();\n+    }\n+  }; // Changes if observers are visible", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f76076fd0fd3a591511c328936637cd2169fa800"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzg4OTc4", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338388978", "createdAt": "2020-01-05T09:13:48Z", "commit": {"oid": "b8c4b976517820d43459daa17f7f212fc45b26a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a86c0e89d984e72fb874eda51fde423b027a1ca1", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/a86c0e89d984e72fb874eda51fde423b027a1ca1", "committedDate": "2020-01-05T12:07:54Z", "message": "Merge branch 'master' into toggle-obs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzk2Njcx", "url": "https://github.com/PGMDev/PGM/pull/191#pullrequestreview-338396671", "createdAt": "2020-01-05T12:10:20Z", "commit": {"oid": "a86c0e89d984e72fb874eda51fde423b027a1ca1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQxMjoxMDoyMVrOFaRLUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQxMjoxMDoyMVrOFaRLUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA4ODcyMg==", "bodyText": "For future reference, I think this will be a stop gap solution. In making Datastore async, I think I'll add support for a Listener to be registered.", "url": "https://github.com/PGMDev/PGM/pull/191#discussion_r363088722", "createdAt": "2020-01-05T12:10:21Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingKey.java", "diffHunk": "@@ -78,4 +85,11 @@ public SettingValue getDefaultValue() {\n   public String toString() {\n     return getName();\n   }\n+\n+  /**\n+   * Called whether setting has changed and is ready to be updated internally.\n+   *\n+   * @param player owner of the setting\n+   */\n+  public void update(MatchPlayer player) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a86c0e89d984e72fb874eda51fde423b027a1ca1"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 523, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}