{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NTE5MTU1", "number": 758, "title": "Add Selectable Monument Modes", "bodyText": "This pull request adds a mode attribute to <core> and <destroyable>, and an id attribute to <mode> so that monument modes can now be selectable instead of defaulting to all cores and monuments. To maintain compatability, only modes with no id can affect cores and destroyables with no mode. Modes have a one to many relationship with the objectives. This means that monuments made of more complex materials can now be changed to different materials using multiple <destroyable> modules. Maps that use them as \"stages\" or extra platforms like Miner Sixty Niner, CannonCube, CannonDuel, and Royal Garden CTW will also greatly benefit from this addition, as more can be added, or the platforms can take on more complex patterns.\n<cores material=\"obsidian\" leak=\"2\">\n    <core team=\"red-team\" region=\"left-core\" mode-changes=\"true\" mode=\"glass-mode\"/>\n    <core team=\"blue-team\" region=\"right-core\" mode-changes=\"true\" mode=\"gold-mode\"/>\n</cores>\n<destroyables>\n    <destroyable id=\"red-mon\" name=\"red one\" owner=\"red-team\" mode-changes=\"true\" mode=\"glass-mode\" region=\"mon-red\" materials=\"obsidian\"/>\n    <destroyable id=\"blue-mon\" name=\"blue one\" owner=\"blue-team\" mode-changes=\"true\" mode=\"gold-mode\" region=\"mon-blu\" materials=\"obsidian\"/>\n</destroyables>\n<modes>\n    <mode id=\"glass-mode\" after=\"10s\" material=\"glass\" name=\"`eGlass Mode\" show-before=\"5s\"/>\n    <mode id=\"gold-mode\" after=\"20s\" material=\"gold block\" name=\"`eGold Mode\" show-before=\"5s\"/>\n</modes>\nIn this example, the Red Core and Red Monument will turn to glass from obsidian in 10 seconds, Blue Core and Blue Monument will turn to gold blocks from obsidian in 20 seconds. You can download this test map as an example to check it out these changes.\ntestworld.zip\nEDIT: This deprecates the mode-changes attribute as something that defines the Core and Destroyable instance, it remains in the XML parser for compatibility reasons.", "createdAt": "2020-12-25T05:21:03Z", "url": "https://github.com/PGMDev/PGM/pull/758", "merged": true, "mergeCommit": {"oid": "56598bbbab6b961edfcb6a14cc4d2ba02eaa717c"}, "closed": true, "closedAt": "2021-01-23T16:30:30Z", "author": {"login": "CoWinkKeyDinkInc"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpeXzggH2gAyNTQ1NTE5MTU1OmUzMzAyOWY0NTNhZDJjNzlhNWUyZTFjMmVmYzhiYTQxOGJjN2I5YTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdzAUkDAFqTU3NDg1ODc0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e33029f453ad2c79a5e2e1c2efc8ba418bc7b9a3", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/e33029f453ad2c79a5e2e1c2efc8ba418bc7b9a3", "committedDate": "2020-12-25T01:51:17Z", "message": "Add id to Mode module\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23637aecf913816a3a6855048296479e57624a0c", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/23637aecf913816a3a6855048296479e57624a0c", "committedDate": "2020-12-25T04:23:52Z", "message": "Add mode attribute to Core module\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aa4628989a64f3aca08b8d657584da71618873e", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/5aa4628989a64f3aca08b8d657584da71618873e", "committedDate": "2020-12-25T04:37:29Z", "message": "Add mode attribute to Destroyable module\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "885f8256afe2ed939588419a027f8d007db1d59e", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/885f8256afe2ed939588419a027f8d007db1d59e", "committedDate": "2020-12-25T05:04:51Z", "message": "Add mode checking to onObjectiveModeSwitch\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "549117aef3e42ff659f0890ec8a2171914921623", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/549117aef3e42ff659f0890ec8a2171914921623", "committedDate": "2020-12-26T04:32:58Z", "message": "Rename id attribute in Mode to stage, rename mode xml attributes in Core/Destroyable to modes\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8007cc001671326b9ee9917c4e62c95160531d62", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/8007cc001671326b9ee9917c4e62c95160531d62", "committedDate": "2020-12-26T04:33:58Z", "message": "Revise ObjectiveModeSwitch on DestroyableMatchModule\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4611d346bd28b7de72fed298881671b337aba756", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/4611d346bd28b7de72fed298881671b337aba756", "committedDate": "2020-12-26T04:37:48Z", "message": "Update function call on CoreMatchModule\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODUxMjA0", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-558851204", "createdAt": "2020-12-26T07:26:22Z", "commit": {"oid": "4611d346bd28b7de72fed298881671b337aba756"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNjoyMlrOILhhHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQwNzoyNzozMVrOILhhsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk1NDM5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (destroyable.getMode() != null\n          \n          \n            \n                        && destroyable.getMode().equals(event.getMode().getStage())) {\n          \n          \n            \n                    } else if (destroyable.getMode().equals(event.getMode().getStage())) {\n          \n      \n    \n    \n  \n\nSince the previous if statement is already checking if the mode is null, no need to check again if it's not null \ud83d\ude04", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r548954398", "createdAt": "2020-12-26T07:26:22Z", "author": {"login": "applenick"}, "path": "core/src/main/java/tc/oc/pgm/destroyable/DestroyableMatchModule.java", "diffHunk": "@@ -126,7 +126,12 @@ public void onObjectiveModeSwitch(final ObjectiveModeChangeEvent event) {\n     for (Destroyable destroyable : this.destroyables) {\n       if (destroyable.isAffectedByModeChanges()) {\n         double oldCompletion = destroyable.getCompletion();\n-        destroyable.replaceBlocks(event.getMode().getMaterialData());\n+        if (destroyable.getMode() == null) {\n+          destroyable.replaceBlocks(event.getMode().getMaterialData());\n+        } else if (destroyable.getMode() != null\n+            && destroyable.getMode().equals(event.getMode().getStage())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4611d346bd28b7de72fed298881671b337aba756"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODk1NDU0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (core.getMode() != null && core.getMode().equals(event.getMode().getStage())) {\n          \n          \n            \n                      core.replaceBlocks(event.getMode().getMaterialData());\n          \n          \n            \n                    } else if (core.getMode().equals(event.getMode().getStage())) {\n          \n          \n            \n                      core.replaceBlocks(event.getMode().getMaterialData());\n          \n      \n    \n    \n  \n\nSee other comment", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r548954544", "createdAt": "2020-12-26T07:27:31Z", "author": {"login": "applenick"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreMatchModule.java", "diffHunk": "@@ -155,7 +155,11 @@ public void lavaProtection(final BlockTransformEvent event) {\n   public void onObjectiveModeSwitch(final ObjectiveModeChangeEvent event) {\n     for (Core core : this.cores) {\n       if (core.isAffectedByModeChanges()) {\n-        core.replaceBlocks(event.getMode().getMaterialData());\n+        if (core.getMode() == null) {\n+          core.replaceBlocks(event.getMode().getMaterialData());\n+        } else if (core.getMode() != null && core.getMode().equals(event.getMode().getStage())) {\n+          core.replaceBlocks(event.getMode().getMaterialData());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4611d346bd28b7de72fed298881671b337aba756"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ad766e925c16cb11098361f05c52c12bfe6f11b", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/9ad766e925c16cb11098361f05c52c12bfe6f11b", "committedDate": "2020-12-26T20:22:18Z", "message": "Simplify ObjectiveModeSwitch logic\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a92f2d64b295ee3bc46ef418a0d7ecb7a89f076", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/8a92f2d64b295ee3bc46ef418a0d7ecb7a89f076", "committedDate": "2020-12-26T20:36:37Z", "message": "Revert stage to id on <mode>\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e34eae1248365fd48f70b47886e9de4590ea83c0", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/e34eae1248365fd48f70b47886e9de4590ea83c0", "committedDate": "2020-12-27T02:58:42Z", "message": "Turn mode attriute to StringList\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4OTEwNTcw", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-558910570", "createdAt": "2020-12-27T08:07:58Z", "commit": {"oid": "e34eae1248365fd48f70b47886e9de4590ea83c0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5", "committedDate": "2020-12-27T23:14:20Z", "message": "Update something\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MDE2MTUy", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-559016152", "createdAt": "2020-12-28T06:50:33Z", "commit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1MDozM1rOILypsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjo1NDoxM1rOILysvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTEyMw==", "bodyText": "You no longer need isAffectedByModeChanges.\nIf the list of modes is an empty collection, that's your validation that this is in fact, not affected by modes.\nOn the parsing side, make sure to make it so that if mode-changes is mutually exclusive with modes, and if modes isn't included you fall-back to either an empty set of modes (not affected by modes) or a null one or (possibly one that includes all modes) if it is mode-change affected", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235123", "createdAt": "2020-12-28T06:50:33Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreMatchModule.java", "diffHunk": "@@ -155,10 +155,7 @@ public void lavaProtection(final BlockTransformEvent event) {\n   public void onObjectiveModeSwitch(final ObjectiveModeChangeEvent event) {\n     for (Core core : this.cores) {\n       if (core.isAffectedByModeChanges()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTM3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public List<Mode> getModeList() {\n          \n          \n            \n              public Set<Mode> getModeList() {\n          \n      \n    \n    \n  \n\nAcross the code, replace List with Set, you're primarily going to be doing contains on this collection, sets are better for that", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235370", "createdAt": "2020-12-28T06:51:46Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -161,7 +162,7 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n-  public List<String> getModeList() {\n+  public List<Mode> getModeList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTU3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      for (String mode : Splitter.on(\" \").split(modes)) {\n          \n          \n            \n                      for (String mode : Splitter.on(\"\\\\s\").split(modes)) {\n          \n      \n    \n    \n  \n\nuse whitespace as a separator, similar to the example in https://github.com/PGMDev/PGM/blob/dev/core/src/main/java/tc/oc/pgm/flag/FlagParser.java#L105", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235577", "createdAt": "2020-12-28T06:52:50Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -118,13 +119,14 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n         }\n \n         String modes = coreEl.getAttributeValue(\"modes\");\n-        List<String> modeList = new ArrayList<>();\n+        List<Mode> modeList = new ArrayList<>();\n         if (modes != null) {\n-          Node node = Node.fromAttr(coreEl, modes);\n-          if (node != null) {\n-            for (String mode : Splitter.on(\" \").split(node.getValue())) {\n-              modeList.add(mode);\n-            }\n+          for (String mode : Splitter.on(\" \").split(modes)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTY2Nw==", "bodyText": "Make this an ImmutableSet, like the example in https://github.com/PGMDev/PGM/blob/dev/core/src/main/java/tc/oc/pgm/flag/FlagParser.java#L105", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235667", "createdAt": "2020-12-28T06:53:13Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -118,13 +119,14 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n         }\n \n         String modes = coreEl.getAttributeValue(\"modes\");\n-        List<String> modeList = new ArrayList<>();\n+        List<Mode> modeList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzNTkwMQ==", "bodyText": "You left out some debugs here, also, you need to check that the mode returned isn't null or else it means that mode hasn't been found, again, you have a perfect 1 to 1 example in https://github.com/PGMDev/PGM/blob/dev/core/src/main/java/tc/oc/pgm/flag/FlagParser.java#L105", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r549235901", "createdAt": "2020-12-28T06:54:13Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -118,13 +119,14 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n         }\n \n         String modes = coreEl.getAttributeValue(\"modes\");\n-        List<String> modeList = new ArrayList<>();\n+        List<Mode> modeList = new ArrayList<>();\n         if (modes != null) {\n-          Node node = Node.fromAttr(coreEl, modes);\n-          if (node != null) {\n-            for (String mode : Splitter.on(\" \").split(node.getValue())) {\n-              modeList.add(mode);\n-            }\n+          for (String mode : Splitter.on(\" \").split(modes)) {\n+            Iterable bigcontext = context.getFeatures().getAll(Mode.class);\n+            System.out.println(bigcontext);\n+            Mode mode1 = context.getFeatures().get(mode, Mode.class);\n+            modeList.add(mode1);\n+            System.out.println(mode1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b61583b414fcdc71ed98e1d171c0a90ebd9fdc5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc5f6308f2e2c51bc88029e71ac263651acc8ad", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/afc5f6308f2e2c51bc88029e71ac263651acc8ad", "committedDate": "2020-12-30T04:27:01Z", "message": "Convert modelist to ImmutableSet, fully implement to cores and monuments\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/1c4e2040264e1a4643873c11fe2c57c023d4df1c", "committedDate": "2020-12-30T04:38:21Z", "message": "Merge branch 'dev' into add-modes-selectable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTk1NTI4", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-559995528", "createdAt": "2020-12-30T10:41:15Z", "commit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo0MToxNlrOIMpULA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMTowNTo0MVrOIMqZfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzMDczMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public Set<SelfIdentifyingFeatureDefinition> getModeList() {\n          \n          \n            \n              public ImmutableSet<Mode> getModes() {\n          \n      \n    \n    \n  \n\nAnd make this change across the places with this set, it's a set of Modes, not a set of any type of feature definition, also just call it getModes, and the variable in the definition modes,  it's not a list to start with (it's a set) and that's also the naming used in the xml, so easiest to keep it consistent.\nYou also need to move this up the hierarchy in interfaces to ModeChangeGoal, replacing isAffectedByModeChanges", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550130732", "createdAt": "2020-12-30T10:41:16Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -160,6 +161,10 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n+  public Set<SelfIdentifyingFeatureDefinition> getModeList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzNzQ5Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  ImmutableSet.Builder<SelfIdentifyingFeatureDefinition> modes = ImmutableSet.builder();\n          \n          \n            \n                  for (String modeId : node.getValue().split(\"\\\\s\")) {\n          \n          \n            \n                    SelfIdentifyingFeatureDefinition mode =\n          \n          \n            \n                        context.getFeatures().get(modeId, SelfIdentifyingFeatureDefinition.class);\n          \n          \n            \n                    if (mode == null) {\n          \n          \n            \n                      throw new InvalidXMLException(\"No mode with ID '\" + modeId + \"'\", node);\n          \n          \n            \n                    }\n          \n          \n            \n                    modes.add(mode);\n          \n          \n            \n                  }\n          \n          \n            \n                  return modes.build();\n          \n          \n            \n                  ImmutableSet.Builder<Mode> modes = ImmutableSet.builder();\n          \n          \n            \n                  for (String modeId : node.getValue().split(\"\\\\s\")) {\n          \n          \n            \n                    Mode mode = context.getFeatures().get(modeId, Mode.class);\n          \n          \n            \n                    if (mode == null) {\n          \n          \n            \n                      throw new InvalidXMLException(\"No mode with ID '\" + modeId + \"'\", node);\n          \n          \n            \n                    }\n          \n          \n            \n                    modes.add(mode);\n          \n          \n            \n                  }\n          \n          \n            \n                  return modes.build();\n          \n      \n    \n    \n  \n\nGet modes, not SelfIdentifyingFeatureDefinitions", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550137496", "createdAt": "2020-12-30T10:50:34Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -71,6 +71,20 @@ public MatchModule createMatchModule(Match match) {\n       return ImmutableList.of(RegionModule.class, TeamModule.class);\n     }\n \n+    public ImmutableSet<SelfIdentifyingFeatureDefinition> parseModeSet(\n+        Node node, MapFactory context) throws InvalidXMLException {\n+      ImmutableSet.Builder<SelfIdentifyingFeatureDefinition> modes = ImmutableSet.builder();\n+      for (String modeId : node.getValue().split(\"\\\\s\")) {\n+        SelfIdentifyingFeatureDefinition mode =\n+            context.getFeatures().get(modeId, SelfIdentifyingFeatureDefinition.class);\n+        if (mode == null) {\n+          throw new InvalidXMLException(\"No mode with ID '\" + modeId + \"'\", node);\n+        }\n+        modes.add(mode);\n+      }\n+      return modes.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE0NDU3NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public ImmutableSet<SelfIdentifyingFeatureDefinition> parseModeSet(\n          \n          \n            \n                    Node node, MapFactory context) throws InvalidXMLException {\n          \n          \n            \n                public ImmutableSet<Mode> parseModeSet(Node node) throws InvalidXMLException {\n          \n      \n    \n    \n  \n\nMake the factory a field in the class, no need to pass it as parameter", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550144574", "createdAt": "2020-12-30T11:00:36Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -71,6 +71,20 @@ public MatchModule createMatchModule(Match match) {\n       return ImmutableList.of(RegionModule.class, TeamModule.class);\n     }\n \n+    public ImmutableSet<SelfIdentifyingFeatureDefinition> parseModeSet(\n+        Node node, MapFactory context) throws InvalidXMLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE0ODQ3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ImmutableSet<SelfIdentifyingFeatureDefinition> modeList = null;\n          \n          \n            \n                    if (!coreEl.getAttributeValue(\"modes\").isEmpty()) {\n          \n          \n            \n                      modeList = parseModeSet(Objects.requireNonNull(Node.fromAttr(coreEl, \"modes\")), context);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    boolean modeChanges = XMLUtils.parseBoolean(coreEl.getAttribute(\"mode-changes\"), false);\n          \n          \n            \n                    ImmutableSet<Mode> modes;\n          \n          \n            \n                    Node modes = Node.fromAttr(coreEl, \"modes\");\n          \n          \n            \n                    if (modes != null) {\n          \n          \n            \n                        if (coreEl.getAttribute(\"mode-changes\") != null)\n          \n          \n            \n                            throw new InvalidXMLException(\"Cannot combine modes and mode-changes\");\n          \n          \n            \n                            \n          \n          \n            \n                        modes = parseModeSet(modes, context); // Specific set of modes\n          \n          \n            \n                    } else if (XMLUtils.parseBoolean(coreEl.getAttribute(\"mode-changes\"), false)) {\n          \n          \n            \n                        modes = null; // All modes\n          \n          \n            \n                    } else {\n          \n          \n            \n                        modes = ImmutableSet.of(); // No modes\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nMake parsing for modes properly support the legacy mode-changes, also make sure to throw an exception if they're combined.\nYou also need to remove all traces of modeChanges in the rest of the codebase, it is no longer a thing since we have a specific set now", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550148476", "createdAt": "2020-12-30T11:05:41Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -115,6 +129,11 @@ public CoreModule parse(MapFactory context, Logger logger, Document doc)\n           serialNumbers.put(owner, serial + 1);\n         }\n \n+        ImmutableSet<SelfIdentifyingFeatureDefinition> modeList = null;\n+        if (!coreEl.getAttributeValue(\"modes\").isEmpty()) {\n+          modeList = parseModeSet(Objects.requireNonNull(Node.fromAttr(coreEl, \"modes\")), context);\n+        }\n+\n         boolean modeChanges = XMLUtils.parseBoolean(coreEl.getAttribute(\"mode-changes\"), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTk4MDM1", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-559998035", "createdAt": "2020-12-30T10:49:11Z", "commit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo0OToxMlrOIMpqZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMDo1MzozMVrOIMp1nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzNjQyMA==", "bodyText": "You can replace instances of SelfIdentifyingFeatureDefinition Mode in this and a few other classes when used in return types and lists as it extends it.", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550136420", "createdAt": "2020-12-30T10:49:12Z", "author": {"login": "Pugzy"}, "path": "core/src/main/java/tc/oc/pgm/core/Core.java", "diffHunk": "@@ -160,6 +161,10 @@ public void markLeaked() {\n     this.leaked = true;\n   }\n \n+  public Set<SelfIdentifyingFeatureDefinition> getModeList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzNzU2OA==", "bodyText": "Avoid wildcard imports (can be turned off in Intellij).", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550137568", "createdAt": "2020-12-30T10:50:44Z", "author": {"login": "Pugzy"}, "path": "core/src/main/java/tc/oc/pgm/core/CoreModule.java", "diffHunk": "@@ -1,10 +1,9 @@\n package tc.oc.pgm.core;\n \n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Lists;\n-import java.util.Collection;\n-import java.util.HashMap;\n-import java.util.List;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDEzOTI5Mg==", "bodyText": "Should use if (destroyableEl.getAttributeValue(\"modes\") != null) { rather than isEmpty and ! not.\ngetAttributeValue returns the Attribute or null so calling isEmpty produces an NPE on maps without modes defined.", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550139292", "createdAt": "2020-12-30T10:53:31Z", "author": {"login": "Pugzy"}, "path": "core/src/main/java/tc/oc/pgm/destroyable/DestroyableModule.java", "diffHunk": "@@ -111,6 +124,13 @@ public DestroyableModule parse(MapFactory context, Logger logger, Document doc)\n         Set<SingleMaterialMatcher> materials =\n             XMLUtils.parseMaterialPatternSet(\n                 Node.fromRequiredAttr(destroyableEl, \"materials\", \"material\"));\n+\n+        ImmutableSet<SelfIdentifyingFeatureDefinition> modeList = null;\n+        if (!destroyableEl.getAttributeValue(\"modes\").isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4e2040264e1a4643873c11fe2c57c023d4df1c"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d270e6c52885e2f9ae50ed5baaee1ab1b7ebd73d", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/d270e6c52885e2f9ae50ed5baaee1ab1b7ebd73d", "committedDate": "2020-12-31T06:21:40Z", "message": "Make ImmutableSets use Mode object, update parsing for modes\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbb87dc402ae16fa9ef1d67e00085d844e391177", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/dbb87dc402ae16fa9ef1d67e00085d844e391177", "committedDate": "2020-12-31T06:36:18Z", "message": "Remove internal references of isAffectedByModeChanges\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "705aa4e5207081609dbe9bbb6e5a3591b40e2428", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/705aa4e5207081609dbe9bbb6e5a3591b40e2428", "committedDate": "2021-01-01T20:23:20Z", "message": "Create factory instance in Core/Destroyable parse\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "549265921c4f26810b6e05ec558b12a5a22701b2", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/549265921c4f26810b6e05ec558b12a5a22701b2", "committedDate": "2021-01-01T20:34:21Z", "message": "reformat files\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjEzNTE4", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-560613518", "createdAt": "2021-01-02T00:41:51Z", "commit": {"oid": "549265921c4f26810b6e05ec558b12a5a22701b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDo0MTo1MVrOINTtQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDo0MTo1MVrOINTtQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNTI4Mg==", "bodyText": "Consider adding here ImmutableSet<Mode> getModes to replace the previous method", "url": "https://github.com/PGMDev/PGM/pull/758#discussion_r550825282", "createdAt": "2021-01-02T00:41:51Z", "author": {"login": "Pablete1234"}, "path": "core/src/main/java/tc/oc/pgm/goals/ModeChangeGoal.java", "diffHunk": "@@ -11,6 +11,4 @@\n   boolean isObjectiveMaterial(Block block);\n \n   String getModeChangeMessage(Material material);\n-\n-  boolean isAffectedByModeChanges();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549265921c4f26810b6e05ec558b12a5a22701b2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79fc8519a0fc99148c0779e96fbd41c9e25e198b", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/79fc8519a0fc99148c0779e96fbd41c9e25e198b", "committedDate": "2021-01-02T20:38:23Z", "message": "Add getModes to ModeChangeGoal Interface\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjU0NzAw", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-560654700", "createdAt": "2021-01-02T20:40:41Z", "commit": {"oid": "79fc8519a0fc99148c0779e96fbd41c9e25e198b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d38fd9fa84239332bafbd75f0c61c49e286b029", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/6d38fd9fa84239332bafbd75f0c61c49e286b029", "committedDate": "2021-01-02T20:45:49Z", "message": "reformat code\n\nSigned-off-by: Patrick <cowinkkeydinkinc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ab7e027b8b280466ec8823d1ebacdef71ea6dd0", "author": {"user": {"login": "CoWinkKeyDinkInc", "name": "Patrick"}}, "url": "https://github.com/PGMDev/PGM/commit/9ab7e027b8b280466ec8823d1ebacdef71ea6dd0", "committedDate": "2021-01-02T21:23:18Z", "message": "Merge branch 'dev' into add-modes-selectable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjU2Mjg5", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-560656289", "createdAt": "2021-01-02T21:24:00Z", "commit": {"oid": "9ab7e027b8b280466ec8823d1ebacdef71ea6dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0ODU4NzQw", "url": "https://github.com/PGMDev/PGM/pull/758#pullrequestreview-574858740", "createdAt": "2021-01-23T16:29:50Z", "commit": {"oid": "9ab7e027b8b280466ec8823d1ebacdef71ea6dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 392, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}