{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjM5MjA2", "number": 190, "title": "Player may disable receiving /msg", "bodyText": "", "createdAt": "2020-01-04T19:12:07Z", "url": "https://github.com/PGMDev/PGM/pull/190", "merged": true, "mergeCommit": {"oid": "57be80647044152596033b4fdad8ffcf95a28f38"}, "closed": true, "closedAt": "2020-01-05T12:04:48Z", "author": {"login": "TheMolkaPL"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3H3NQAH2gAyMzU5MjM5MjA2OmEwZDkxZGI1ZTBjYzViMmVhZDE5YTJhNjhjNGRkZTM0ODgyNGY5YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3WXnOAFqTMzODM5NjQyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6", "committedDate": "2020-01-04T19:10:24Z", "message": "Player may disable receiving /msg\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzcxMDY0", "url": "https://github.com/PGMDev/PGM/pull/190#pullrequestreview-338371064", "createdAt": "2020-01-04T21:35:24Z", "commit": {"oid": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMTozNToyNFrOFaPNIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMTozODo0MFrOFaPNrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjQxOQ==", "bodyText": "I'm unsure what blockedNoPermissions message exactly is, but it shouldn't be a no perms, but rather a \"player doesn't want DMS\"", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363056419", "createdAt": "2020-01-04T21:35:24Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java", "diffHunk": "@@ -102,6 +103,22 @@ public void sendAdmin(Match match, MatchPlayer sender, @Nullable @Text String me\n       desc = \"Send a direct message to a player\",\n       usage = \"[player] [message]\")\n   public void sendDirect(Match match, MatchPlayer sender, Player receiver, @Text String message) {\n+    MatchPlayer matchReceiver = manager.getPlayer(receiver);\n+    if (matchReceiver != null) {\n+      SettingValue option = matchReceiver.getSettings().getValue(SettingKey.PM);\n+\n+      switch (option) {\n+        case PM_OFF:\n+          if (!sender.getBukkit().hasPermission(Permissions.STAFF)) {\n+            String name = receiver.getDisplayName(sender.getBukkit()) + ChatColor.RED;\n+            Component component =\n+                new PersonalizedTranslatable(\"command.message.blockedNoPermissions\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1NjU1OQ==", "bodyText": "A switch-case for 1 option, feels pretty redundant\nif (option == PM_OFF && !sender.getBukkit().hasPermission(Permissions.STAFF)) {\n  // send deny\n  return;\n}", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363056559", "createdAt": "2020-01-04T21:38:40Z", "author": {"login": "Pablete1234"}, "path": "src/main/java/tc/oc/pgm/listeners/ChatDispatcher.java", "diffHunk": "@@ -102,6 +103,22 @@ public void sendAdmin(Match match, MatchPlayer sender, @Nullable @Text String me\n       desc = \"Send a direct message to a player\",\n       usage = \"[player] [message]\")\n   public void sendDirect(Match match, MatchPlayer sender, Player receiver, @Text String message) {\n+    MatchPlayer matchReceiver = manager.getPlayer(receiver);\n+    if (matchReceiver != null) {\n+      SettingValue option = matchReceiver.getSettings().getValue(SettingKey.PM);\n+\n+      switch (option) {\n+        case PM_OFF:\n+          if (!sender.getBukkit().hasPermission(Permissions.STAFF)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0d91db5e0cc5b2ead19a2a68c4dde348824f9c6"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/6ba1087d9c6edfb343cc35d9bb680f42468f54ba", "committedDate": "2020-01-04T22:01:03Z", "message": "Simplify setting check\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzcyMDQ1", "url": "https://github.com/PGMDev/PGM/pull/190#pullrequestreview-338372045", "createdAt": "2020-01-04T22:07:05Z", "commit": {"oid": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzcyNTA5", "url": "https://github.com/PGMDev/PGM/pull/190#pullrequestreview-338372509", "createdAt": "2020-01-04T22:24:08Z", "commit": {"oid": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjoyNDowOFrOFaPUTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjoyNDoyMFrOFaPUZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1ODI1Mw==", "bodyText": "PM -> MESSAGE. message and dm", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363058253", "createdAt": "2020-01-04T22:24:08Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingKey.java", "diffHunk": "@@ -17,7 +17,8 @@\n   CHAT(\"chat\", CHAT_TEAM, CHAT_GLOBAL, CHAT_ADMIN), // Changes the default chat channel\n   DEATH(\n       Arrays.asList(\"death\", \"dms\"), DEATH_ALL, DEATH_OWN), // Changes which death messages are seen\n-  PICKER(\"picker\", PICKER_AUTO, PICKER_ON, PICKER_OFF); // Changes when the picker is displayed\n+  PICKER(\"picker\", PICKER_AUTO, PICKER_ON, PICKER_OFF), // Changes when the picker is displayed\n+  PM(Arrays.asList(\"pm\", \"dm\", \"msg\"), PM_ON, PM_OFF); // Changes if private messages are accepted", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1ODI3Nw==", "bodyText": "private -> direct", "url": "https://github.com/PGMDev/PGM/pull/190#discussion_r363058277", "createdAt": "2020-01-04T22:24:20Z", "author": {"login": "Electroid"}, "path": "src/main/java/tc/oc/pgm/api/setting/SettingValue.java", "diffHunk": "@@ -21,7 +21,9 @@\n   DEATH_ALL(\"death\", \"all\"), // Send all death messages, highlight your own\n   PICKER_AUTO(\"picker\", \"auto\"), // Display after cycle, or with permissions.\n   PICKER_ON(\"picker\", \"on\"), // Display the picker GUI always\n-  PICKER_OFF(\"picker\", \"off\"); // Never display the picker GUI\n+  PICKER_OFF(\"picker\", \"off\"), // Never display the picker GUI\n+  PM_ON(\"pm\", \"on\"), // Always accept private messages", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba1087d9c6edfb343cc35d9bb680f42468f54ba"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b47a24a17a39dd77b6ec05025cd7e20bda8bea1", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/5b47a24a17a39dd77b6ec05025cd7e20bda8bea1", "committedDate": "2020-01-04T22:28:25Z", "message": "Rename PM to MESSAGE\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f116304a819fe75bf300ad96991c21b8d80ebb", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/74f116304a819fe75bf300ad96991c21b8d80ebb", "committedDate": "2020-01-04T22:31:55Z", "message": "Fix formatting\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzgwNjk2", "url": "https://github.com/PGMDev/PGM/pull/190#pullrequestreview-338380696", "createdAt": "2020-01-05T04:46:27Z", "commit": {"oid": "74f116304a819fe75bf300ad96991c21b8d80ebb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "617968a9032a0a0a404e1837382d30ca6fc54158", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/617968a9032a0a0a404e1837382d30ca6fc54158", "committedDate": "2020-01-05T08:23:09Z", "message": "Merge branch 'master' into toggle-msg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "072c40993cae91d3093309e2779f6b765b0d5911", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/072c40993cae91d3093309e2779f6b765b0d5911", "committedDate": "2020-01-05T11:58:23Z", "message": "Merge branch 'master' into toggle-msg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a9ae0ab120a3bc934711e2641a135204cb3b5a", "author": {"user": {"login": "TheMolkaPL", "name": "Aleksander Jagiello"}}, "url": "https://github.com/PGMDev/PGM/commit/00a9ae0ab120a3bc934711e2641a135204cb3b5a", "committedDate": "2020-01-05T12:01:09Z", "message": "Merge branch 'master' into toggle-msg"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzk2NDI1", "url": "https://github.com/PGMDev/PGM/pull/190#pullrequestreview-338396425", "createdAt": "2020-01-05T12:04:28Z", "commit": {"oid": "00a9ae0ab120a3bc934711e2641a135204cb3b5a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 520, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}