{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NDY3OTQ4", "number": 1793, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMDoxODoyNlrOEHWe3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMTo0MDoyNFrOET2q9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTQzODM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMDoxODoyN1rOGmrDwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxODozMjo1NVrOGwBYcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA==", "bodyText": "when the theme.properties specifies needsRestart=true I get an exception here. I think these are the relevant ones:\nat org.springframework.context.support.AbstractMessageSource.getMessage(AbstractMessageSource.java:153) at com.faforever.client.i18n.I18n.get(I18n.java:94) at com.faforever.client.i18n.I18n.get(I18n.java:90) at com.faforever.client.preferences.ui.SettingsController.lambda$initialize$8(SettingsController.java:245) [...] Caused by: java.lang.NumberFormatException: For input string: \"\"", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r443204544", "createdAt": "2020-06-21T10:18:27Z", "author": {"login": "BlackYps"}, "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "diffHunk": "@@ -239,7 +239,14 @@ public void initialize() {\n     });\n \n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n-    selectedThemeChangeListener = (observable, oldValue, newValue) -> uiService.setTheme(newValue);\n+    selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n+      uiService.setTheme(newValue);\n+      if (newValue.isNeedsRestart()) {\n+        notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkxNzI3Mg==", "bodyText": "I propose that we don't leave it up to the theme guy to decide whether or not a restart is neede; he might not even know and it might change in future client releases.\nRather the client should figure out itself whether it's needed or not. In its simplest version: require restart if there's more than just a CSS file.\nA future client might be able to reload FXML as well.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r444917272", "createdAt": "2020-06-24T14:03:10Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "diffHunk": "@@ -239,7 +239,14 @@ public void initialize() {\n     });\n \n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n-    selectedThemeChangeListener = (observable, oldValue, newValue) -> uiService.setTheme(newValue);\n+    selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n+      uiService.setTheme(newValue);\n+      if (newValue.isNeedsRestart()) {\n+        notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, "originalCommit": {"oid": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwNDc4OQ==", "bodyText": "If he changes fxml files of pop ups or the gif in the ladder1v1 search it might not be needed even tho it is more than just a css. So I say a maintainer should better judge himself. Also concider context menus, changes there also don't require a restart. You are right that in general none CSS changes more often require a restart but this is not 100%of cases the case.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r446504789", "createdAt": "2020-06-27T09:14:59Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "diffHunk": "@@ -239,7 +239,14 @@ public void initialize() {\n     });\n \n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n-    selectedThemeChangeListener = (observable, oldValue, newValue) -> uiService.setTheme(newValue);\n+    selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n+      uiService.setTheme(newValue);\n+      if (newValue.isNeedsRestart()) {\n+        notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, "originalCommit": {"oid": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNTQ4OA==", "bodyText": "No answer means u agree with me", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r453005488", "createdAt": "2020-07-10T18:28:45Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "diffHunk": "@@ -239,7 +239,14 @@ public void initialize() {\n     });\n \n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n-    selectedThemeChangeListener = (observable, oldValue, newValue) -> uiService.setTheme(newValue);\n+    selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n+      uiService.setTheme(newValue);\n+      if (newValue.isNeedsRestart()) {\n+        notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, "originalCommit": {"oid": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNzQ3Mw==", "bodyText": "Fixed", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r453007473", "createdAt": "2020-07-10T18:32:55Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "diffHunk": "@@ -239,7 +239,14 @@ public void initialize() {\n     });\n \n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n-    selectedThemeChangeListener = (observable, oldValue, newValue) -> uiService.setTheme(newValue);\n+    selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n+      uiService.setTheme(newValue);\n+      if (newValue.isNeedsRestart()) {\n+        notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, "originalCommit": {"oid": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNjAxNjUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/theme/Theme.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxNTozOTo0NlrOGwNifQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QyMTowNjozNlrOGzhNAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNjY1Mw==", "bodyText": "I'm still against having such a property.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r453206653", "createdAt": "2020-07-11T15:39:46Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/theme/Theme.java", "diffHunk": "@@ -13,21 +15,20 @@\n   private static final String AUTHOR = \"author\";\n   private static final String COMPATIBILITY_VERSION = \"compatibilityVersion\";\n   private static final String THEME_VERSION = \"themeVersion\";\n+  private static final String NEEDS_RESTART = \"needsRestart\";\n \n-  private StringProperty displayName;\n-  private StringProperty author;\n-  private SimpleObjectProperty<Integer> compatibilityVersion;\n-  private StringProperty themeVersion;\n+  private final StringProperty displayName;\n+  private final StringProperty author;\n+  private final SimpleObjectProperty<Integer> compatibilityVersion;\n+  private final StringProperty themeVersion;\n+  private final BooleanProperty needsRestart;\n \n-  public Theme() {\n-    this(null, null, null, null);\n-  }\n-\n-  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion) {\n+  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion, boolean needsRestart) {\n     this.displayName = new SimpleStringProperty(displayName);\n     this.author = new SimpleStringProperty(author);\n     this.compatibilityVersion = new SimpleObjectProperty<>(compatibilityVersion);\n     this.themeVersion = new SimpleStringProperty(themeVersion);\n+    this.needsRestart = new SimpleBooleanProperty(needsRestart);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4014ca95483152481c882f55f74789fbcb028cee"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY3NDU2Mg==", "bodyText": "So what are u for? No restart pop up, always a pop up? Looking if it contains fxml files?(that's inaccurate) Looking if it contains none css files?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r456674562", "createdAt": "2020-07-17T21:06:36Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/theme/Theme.java", "diffHunk": "@@ -13,21 +15,20 @@\n   private static final String AUTHOR = \"author\";\n   private static final String COMPATIBILITY_VERSION = \"compatibilityVersion\";\n   private static final String THEME_VERSION = \"themeVersion\";\n+  private static final String NEEDS_RESTART = \"needsRestart\";\n \n-  private StringProperty displayName;\n-  private StringProperty author;\n-  private SimpleObjectProperty<Integer> compatibilityVersion;\n-  private StringProperty themeVersion;\n+  private final StringProperty displayName;\n+  private final StringProperty author;\n+  private final SimpleObjectProperty<Integer> compatibilityVersion;\n+  private final StringProperty themeVersion;\n+  private final BooleanProperty needsRestart;\n \n-  public Theme() {\n-    this(null, null, null, null);\n-  }\n-\n-  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion) {\n+  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion, boolean needsRestart) {\n     this.displayName = new SimpleStringProperty(displayName);\n     this.author = new SimpleStringProperty(author);\n     this.compatibilityVersion = new SimpleObjectProperty<>(compatibilityVersion);\n     this.themeVersion = new SimpleStringProperty(themeVersion);\n+    this.needsRestart = new SimpleBooleanProperty(needsRestart);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNjY1Mw=="}, "originalCommit": {"oid": "4014ca95483152481c882f55f74789fbcb028cee"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MjU0MTMyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/theme/UiService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMTo0MDoyNFrOG50ztQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwOTowMDowN1rOG6BTiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NzIyMQ==", "bodyText": "This will always return the theme.properties file", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r463287221", "createdAt": "2020-07-30T21:40:24Z", "author": {"login": "BlackYps"}, "path": "src/main/java/com/faforever/client/theme/UiService.java", "diffHunk": "@@ -472,4 +472,11 @@ public JFXDialog showInDialog(StackPane parent, Node content, String title) {\n     dialog.show(parent);\n     return dialog;\n   }\n+\n+  @SneakyThrows\n+  public boolean doesThemeNeedRestart(Theme theme) {\n+    try (Stream<Path> stream = Files.list(getThemeDirectory(theme))) {\n+      return stream.anyMatch(path -> Files.isRegularFile(path) && !path.endsWith(\".css\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc37865c553d2c03e5918dd527830ecf2206f548"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ5MTA5NQ==", "bodyText": "What are u talking about? This is a check on wether a theme conatins a file that is not an css file, because if so we need a restart to fully load the theme.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r463491095", "createdAt": "2020-07-31T08:58:27Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/theme/UiService.java", "diffHunk": "@@ -472,4 +472,11 @@ public JFXDialog showInDialog(StackPane parent, Node content, String title) {\n     dialog.show(parent);\n     return dialog;\n   }\n+\n+  @SneakyThrows\n+  public boolean doesThemeNeedRestart(Theme theme) {\n+    try (Stream<Path> stream = Files.list(getThemeDirectory(theme))) {\n+      return stream.anyMatch(path -> Files.isRegularFile(path) && !path.endsWith(\".css\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NzIyMQ=="}, "originalCommit": {"oid": "bc37865c553d2c03e5918dd527830ecf2206f548"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ5MTk3Ng==", "bodyText": "oh yeah i get u now. Hmm yes so I guess I got to include this there as well", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r463491976", "createdAt": "2020-07-31T09:00:07Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/theme/UiService.java", "diffHunk": "@@ -472,4 +472,11 @@ public JFXDialog showInDialog(StackPane parent, Node content, String title) {\n     dialog.show(parent);\n     return dialog;\n   }\n+\n+  @SneakyThrows\n+  public boolean doesThemeNeedRestart(Theme theme) {\n+    try (Stream<Path> stream = Files.list(getThemeDirectory(theme))) {\n+      return stream.anyMatch(path -> Files.isRegularFile(path) && !path.endsWith(\".css\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NzIyMQ=="}, "originalCommit": {"oid": "bc37865c553d2c03e5918dd527830ecf2206f548"}, "originalPosition": 121}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2025, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}