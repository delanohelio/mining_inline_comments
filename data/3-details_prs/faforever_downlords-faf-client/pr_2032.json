{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NjkxOTgy", "number": 2032, "title": "Show team matchmaker map pools", "bodyText": "Fixes #1784\nNote that this targets the team-matchmaking branch.\nI managed to get it to work mostly. There are duplicate maps, because at the moment it mindlessly combines all pools for a Queue. It also has the problem that it ignores the item count for pagination, because it fetches pools from the api and only later unpacks the containing maps.\nFeedback on horrible code style is very much appreciated.", "createdAt": "2020-11-10T18:43:18Z", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032", "merged": true, "mergeCommit": {"oid": "acbf51b7ee29a25f2eef7a3021af72f18c164b8c"}, "closed": true, "closedAt": "2020-11-19T10:58:23Z", "author": {"login": "BlackYps"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbRpT9AFqTUyNzY3OTQzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddDD6vAH2gAyNTE4NjkxOTgyOjIyYTg1YTRjNTdjZjc4OTY1ZjM3YmQzZGJhNjdhZTY1YzNmMTcwNWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Njc5NDMx", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#pullrequestreview-527679431", "createdAt": "2020-11-10T23:05:58Z", "commit": {"oid": "d789a50506023792a6173bd2240ce5168f823766"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzowNTo1OFrOHwzGhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzowNTo1OFrOHwzGhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzMDk1MA==", "bodyText": "@DaTa maybe", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#discussion_r520930950", "createdAt": "2020-11-10T23:05:58Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/api/dto/Leaderboard.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.faforever.client.api.dto;\n+\n+import com.github.jasminb.jsonapi.annotations.Id;\n+import com.github.jasminb.jsonapi.annotations.Type;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import java.time.OffsetDateTime;\n+\n+@Getter\n+@Setter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d789a50506023792a6173bd2240ce5168f823766"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "279550ef61c513de71c30044f31559f5ccdcc7f2", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/279550ef61c513de71c30044f31559f5ccdcc7f2", "committedDate": "2020-11-10T21:08:08Z", "message": "Fix MapVaultControllerTest"}, "afterCommit": {"oid": "e7299ba95ddfcc3b8caeafcab87f8829bf851257", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/e7299ba95ddfcc3b8caeafcab87f8829bf851257", "committedDate": "2020-11-11T19:06:37Z", "message": "Filter out duplicate maps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTQyMzgx", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#pullrequestreview-529142381", "createdAt": "2020-11-12T14:31:14Z", "commit": {"oid": "1b407cc4be4f87ed22cc21313c37e237be1f28fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNDozMToxNFrOHx9bkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNDozMToxNFrOHx9bkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE0ODc1Mg==", "bodyText": "If you want to keep this structure and implement the pagination you would need to do it here with some .skip and .limit functions", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#discussion_r522148752", "createdAt": "2020-11-12T14:31:14Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/remote/FafService.java", "diffHunk": "@@ -466,11 +466,15 @@ public void restoreGameSession(int id) {\n   }\n \n   @Async\n-  public CompletableFuture<Tuple<List<MapBean>, Integer>> getLadder1v1MapsWithPageCount(int count, int page) {\n-    Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> tuple = fafApiAccessor.getLadder1v1MapsWithMeta(count, page);\n+  public CompletableFuture<Tuple<List<MapBean>, Integer>> getMatchmakerMapsWithPageCount(int matchmakerQueueId, int count, int page) {\n+    // fixme This uses the count for the number of map pools instead of the number of maps\n+    Tuple<List<MatchmakerQueueMapPool>, java.util.Map<String, ?>> tuple = fafApiAccessor.getMatchMakerPoolsWithMeta(matchmakerQueueId, count, page);\n     return CompletableFuture.completedFuture(new Tuple<>(tuple.getFirst()\n         .parallelStream()\n-        .map(ladder1v1Map -> MapBean.fromMapVersionDto(ladder1v1Map.getMapVersion()))\n+        .map(MatchmakerQueueMapPool::getMapPool)\n+        .flatMap(mapPool -> mapPool.getMapVersions().stream())\n+        .distinct()\n+        .map(MapBean::fromMapVersionDto)\n         .collect(toList()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b407cc4be4f87ed22cc21313c37e237be1f28fb"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1d0b070f6a407c4915f33345f6f84a8af181898", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/e1d0b070f6a407c4915f33345f6f84a8af181898", "committedDate": "2020-11-15T18:06:50Z", "message": "Show team matchmaker map pools"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28087c6d902290025b8293d16555dad0695a9b59", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/28087c6d902290025b8293d16555dad0695a9b59", "committedDate": "2020-11-15T18:06:50Z", "message": "Fix MapVaultControllerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046097dc91e862db6410ae16df65a46d1314ca4f", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/046097dc91e862db6410ae16df65a46d1314ca4f", "committedDate": "2020-11-15T18:06:50Z", "message": "Filter out duplicate maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba0f2f85be394267b61999e6bd26def57d100567", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/ba0f2f85be394267b61999e6bd26def57d100567", "committedDate": "2020-11-15T18:06:50Z", "message": "Fix NullPointerException in searchType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "382da6f13d33e3ee8abc463f2a99767f412fad5d", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/382da6f13d33e3ee8abc463f2a99767f412fad5d", "committedDate": "2020-11-15T18:06:50Z", "message": "Allow pagination of map pool maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e554604720663b7d3ead37ab849cb70818e13ae4", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/e554604720663b7d3ead37ab849cb70818e13ae4", "committedDate": "2020-11-15T18:06:50Z", "message": "Always return correct page count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "671ae6cce68e1527559ef3814f1898f4fa5cdd91", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/671ae6cce68e1527559ef3814f1898f4fa5cdd91", "committedDate": "2020-11-15T18:06:50Z", "message": "Use i18n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a52ecec100c53a506a540edea267ed86e291fb6f", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/a52ecec100c53a506a540edea267ed86e291fb6f", "committedDate": "2020-11-15T18:06:50Z", "message": "Retrieve queueId from the api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd97a1b7bc3bcd21a95833e90410391ab5a69b4a", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/bd97a1b7bc3bcd21a95833e90410391ab5a69b4a", "committedDate": "2020-11-15T09:54:10Z", "message": "Retrieve queueId from the api"}, "afterCommit": {"oid": "a52ecec100c53a506a540edea267ed86e291fb6f", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/a52ecec100c53a506a540edea267ed86e291fb6f", "committedDate": "2020-11-15T18:06:50Z", "message": "Retrieve queueId from the api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53e7b567906d8af40ce18c4f2718fd6a5153b840", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/53e7b567906d8af40ce18c4f2718fd6a5153b840", "committedDate": "2020-11-15T21:11:52Z", "message": "Poor attempt of a fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a85a4c57cf78965f37bd3dba67ae65c3f1705a", "author": {"user": {"login": "BlackYps", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/22a85a4c57cf78965f37bd3dba67ae65c3f1705a", "committedDate": "2020-11-16T11:15:02Z", "message": "Finish fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3264, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}