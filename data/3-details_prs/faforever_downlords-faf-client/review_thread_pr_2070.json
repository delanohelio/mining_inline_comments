{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNjA1Mjcx", "number": 2070, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNDoyN1rOFG6V7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMTozMDo0NFrOFG6eJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzkxNjYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNDoyN1rOIIJWxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNDoyN1rOIIJWxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjgwNg==", "bodyText": "Maybe we can refactor this since it is hardly readable anymore. Should be extracted into methods. Too many nesting", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545412806", "createdAt": "2020-12-17T21:24:27Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {\n+        chatChannelUser.getPlayer().ifPresent(player -> {\n+          if (player.getClan() != null) {\n+            clanService.getClanByTag(player.getClan())\n+                .thenAccept(optionalClan -> Platform.runLater(() -> {\n+                      if (optionalClan.isPresent()) {\n+                        chatChannelUser.setClan(optionalClan.get());\n+                      } else {\n+                        chatChannelUser.setClan(null);\n+                      }\n+                    })\n+                );\n+          } else {\n+            chatChannelUser.setClan(null);\n+          }\n+        });\n+      }\n+    } else {\n+      chatChannelUser.setClan(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzkyMDY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNTozOVrOIIJZIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNjo0MFrOIIJbBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMzQxMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (chatChannelUser.getClan().isEmpty()) {\n          \n          \n            \n                  if (!chatChannelUser.getClan().isEmpty()) {\n          \n          \n            \n                       return;\n          \n          \n            \n                  }", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545413411", "createdAt": "2020-12-17T21:25:39Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMzg5Mg==", "bodyText": "Early return avoids another level of nesting", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545413892", "createdAt": "2020-12-17T21:26:40Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMzQxMQ=="}, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzkyNjU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNzozMFrOIIJcsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNzozMFrOIIJcsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNDMyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (chatChannelUser.getAvatar().isEmpty()) {\n          \n          \n            \n                  if (!chatChannelUser.getAvatar().isEmpty()) {\n          \n          \n            \n                      return;\n          \n          \n            \n                  }", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545414322", "createdAt": "2020-12-17T21:27:30Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {\n+        chatChannelUser.getPlayer().ifPresent(player -> {\n+          if (player.getClan() != null) {\n+            clanService.getClanByTag(player.getClan())\n+                .thenAccept(optionalClan -> Platform.runLater(() -> {\n+                      if (optionalClan.isPresent()) {\n+                        chatChannelUser.setClan(optionalClan.get());\n+                      } else {\n+                        chatChannelUser.setClan(null);\n+                      }\n+                    })\n+                );\n+          } else {\n+            chatChannelUser.setClan(null);\n+          }\n+        });\n+      }\n+    } else {\n+      chatChannelUser.setClan(null);\n     }\n   }\n \n   public void populateAvatar(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getAvatar().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Image avatar;\n-            if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n-              avatar = avatarService.loadAvatar(player.getAvatarUrl());\n-            } else {\n-              avatar = null;\n-            }\n-            Platform.runLater(() -> {\n-              chatChannelUser.setAvatar(avatar);\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getAvatar().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzkyODAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNzo1OVrOIIJdiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyNzo1OVrOIIJdiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNDUzOQ==", "bodyText": "early return -> less nesting", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545414539", "createdAt": "2020-12-17T21:27:59Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {\n+        chatChannelUser.getPlayer().ifPresent(player -> {\n+          if (player.getClan() != null) {\n+            clanService.getClanByTag(player.getClan())\n+                .thenAccept(optionalClan -> Platform.runLater(() -> {\n+                      if (optionalClan.isPresent()) {\n+                        chatChannelUser.setClan(optionalClan.get());\n+                      } else {\n+                        chatChannelUser.setClan(null);\n+                      }\n+                    })\n+                );\n+          } else {\n+            chatChannelUser.setClan(null);\n+          }\n+        });\n+      }\n+    } else {\n+      chatChannelUser.setClan(null);\n     }\n   }\n \n   public void populateAvatar(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getAvatar().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Image avatar;\n-            if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n-              avatar = avatarService.loadAvatar(player.getAvatarUrl());\n-            } else {\n-              avatar = null;\n-            }\n-            Platform.runLater(() -> {\n-              chatChannelUser.setAvatar(avatar);\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getAvatar().isEmpty()) {\n+        chatChannelUser.getPlayer()\n+            .ifPresent(player -> {\n+              Image avatar;\n+              if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n+                avatar = avatarService.loadAvatar(player.getAvatarUrl());\n+              } else {\n+                avatar = null;\n+              }\n+              Platform.runLater(() -> {\n+                chatChannelUser.setAvatar(avatar);\n+              });\n             });\n-          });\n+      }\n+    } else {\n+      chatChannelUser.setAvatar(null);\n     }\n   }\n \n   public void populateCountry(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getCountryFlag().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Optional<Image> countryFlag = countryFlagService.loadCountryFlag(player.getCountry());\n-            Platform.runLater(() -> {\n-              chatChannelUser.setCountryFlag(countryFlag.orElse(null));\n-              chatChannelUser.setCountryName(i18n.getCountryNameLocalized(player.getCountry()));\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getCountryFlag().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzkzNjA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMTozMDoxNVrOIIJiSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMTozMDoxNVrOIIJiSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNTc1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        PlayerStatus status = player.getStatus();\n          \n          \n            \n                        Image playerStatusImage = switch (status) {\n          \n          \n            \n                          case HOSTING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_HOSTING);\n          \n          \n            \n                          case LOBBYING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_LOBBYING);\n          \n          \n            \n                          case PLAYING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_PLAYING);\n          \n          \n            \n                          default -> null;\n          \n          \n            \n                        };\n          \n          \n            \n                        Image mapImage;\n          \n          \n            \n                        if (status != PlayerStatus.IDLE) {\n          \n          \n            \n                          mapImage = mapService.loadPreview(player.getGame().getMapFolderName(), PreviewSize.SMALL);\n          \n          \n            \n                        } else {\n          \n          \n            \n                          mapImage = null;\n          \n          \n            \n                        }\n          \n          \n            \n                        Platform.runLater(() -> {\n          \n          \n            \n                          chatChannelUser.setStatusTooltipText(i18n.get(status.getI18nKey()));\n          \n          \n            \n                          chatChannelUser.setGameStatusImage(playerStatusImage);\n          \n          \n            \n                          chatChannelUser.setMapImage(mapImage);\n          \n          \n            \n                        });\n          \n          \n            \n                        setImages()", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545415754", "createdAt": "2020-12-17T21:30:15Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {\n+        chatChannelUser.getPlayer().ifPresent(player -> {\n+          if (player.getClan() != null) {\n+            clanService.getClanByTag(player.getClan())\n+                .thenAccept(optionalClan -> Platform.runLater(() -> {\n+                      if (optionalClan.isPresent()) {\n+                        chatChannelUser.setClan(optionalClan.get());\n+                      } else {\n+                        chatChannelUser.setClan(null);\n+                      }\n+                    })\n+                );\n+          } else {\n+            chatChannelUser.setClan(null);\n+          }\n+        });\n+      }\n+    } else {\n+      chatChannelUser.setClan(null);\n     }\n   }\n \n   public void populateAvatar(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getAvatar().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Image avatar;\n-            if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n-              avatar = avatarService.loadAvatar(player.getAvatarUrl());\n-            } else {\n-              avatar = null;\n-            }\n-            Platform.runLater(() -> {\n-              chatChannelUser.setAvatar(avatar);\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getAvatar().isEmpty()) {\n+        chatChannelUser.getPlayer()\n+            .ifPresent(player -> {\n+              Image avatar;\n+              if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n+                avatar = avatarService.loadAvatar(player.getAvatarUrl());\n+              } else {\n+                avatar = null;\n+              }\n+              Platform.runLater(() -> {\n+                chatChannelUser.setAvatar(avatar);\n+              });\n             });\n-          });\n+      }\n+    } else {\n+      chatChannelUser.setAvatar(null);\n     }\n   }\n \n   public void populateCountry(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getCountryFlag().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Optional<Image> countryFlag = countryFlagService.loadCountryFlag(player.getCountry());\n-            Platform.runLater(() -> {\n-              chatChannelUser.setCountryFlag(countryFlag.orElse(null));\n-              chatChannelUser.setCountryName(i18n.getCountryNameLocalized(player.getCountry()));\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getCountryFlag().isEmpty()) {\n+        chatChannelUser.getPlayer()\n+            .ifPresent(player -> {\n+              Optional<Image> countryFlag = countryFlagService.loadCountryFlag(player.getCountry());\n+              Platform.runLater(() -> {\n+                chatChannelUser.setCountryFlag(countryFlag.orElse(null));\n+                chatChannelUser.setCountryName(i18n.getCountryNameLocalized(player.getCountry()));\n+              });\n             });\n-          });\n+      }\n+    } else {\n+      chatChannelUser.setCountryFlag(null);\n+      chatChannelUser.setCountryName(null);\n     }\n   }\n \n   public void populateGameStatus(ChatChannelUser chatChannelUser) {\n-    chatChannelUser.getPlayer()\n-        .ifPresent(player -> {\n-          PlayerStatus status = player.getStatus();\n-          Image playerStatusImage = switch (status) {\n-            case HOSTING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_HOSTING);\n-            case LOBBYING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_LOBBYING);\n-            case PLAYING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_PLAYING);\n-            default -> null;\n-          };\n-          Image mapImage;\n-          if (status != PlayerStatus.IDLE) {\n-            mapImage = mapService.loadPreview(player.getGame().getMapFolderName(), PreviewSize.SMALL);\n-          } else {\n-            mapImage = null;\n-          }\n-          Platform.runLater(() -> {\n-            chatChannelUser.setStatusTooltipText(i18n.get(status.getI18nKey()));\n-            chatChannelUser.setGameStatusImage(playerStatusImage);\n-            chatChannelUser.setMapImage(mapImage);\n-            chatChannelUser.setGameStatus(status);\n+    if (chatChannelUser.isDisplayed()) {\n+      chatChannelUser.getPlayer()\n+          .ifPresent(player -> {\n+            PlayerStatus status = player.getStatus();\n+            Image playerStatusImage = switch (status) {\n+              case HOSTING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_HOSTING);\n+              case LOBBYING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_LOBBYING);\n+              case PLAYING -> uiService.getThemeImage(UiService.CHAT_LIST_STATUS_PLAYING);\n+              default -> null;\n+            };\n+            Image mapImage;\n+            if (status != PlayerStatus.IDLE) {\n+              mapImage = mapService.loadPreview(player.getGame().getMapFolderName(), PreviewSize.SMALL);\n+            } else {\n+              mapImage = null;\n+            }\n+            Platform.runLater(() -> {\n+              chatChannelUser.setStatusTooltipText(i18n.get(status.getI18nKey()));\n+              chatChannelUser.setGameStatusImage(playerStatusImage);\n+              chatChannelUser.setMapImage(mapImage);\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 168}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzkzNzY1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMTozMDo0NFrOIIJjRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMTozMDo0NFrOIIJjRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNjAwNQ==", "bodyText": "Miss leading name also does other things", "url": "https://github.com/FAForever/downlords-faf-client/pull/2070#discussion_r545416005", "createdAt": "2020-12-17T21:30:44Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/chat/ChatUserService.java", "diffHunk": "@@ -38,114 +38,121 @@ public void afterPropertiesSet() {\n   }\n \n   public void populateClan(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getClan().isEmpty()) {\n-      chatChannelUser.getPlayer().ifPresent(player -> {\n-        if (player.getClan() != null) {\n-          clanService.getClanByTag(player.getClan())\n-              .thenAccept(optionalClan -> Platform.runLater(() -> {\n-                    if (optionalClan.isPresent()) {\n-                      chatChannelUser.setClan(optionalClan.get());\n-                      chatChannelUser.setClanTag(String.format(\"[%s]\", optionalClan.get().getTag()));\n-                    } else {\n-                      chatChannelUser.setClan(null);\n-                      chatChannelUser.setClanTag(null);\n-                    }\n-                  })\n-              );\n-        } else {\n-          chatChannelUser.setClan(null);\n-          chatChannelUser.setClanTag(null);\n-        }\n-      });\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getClan().isEmpty()) {\n+        chatChannelUser.getPlayer().ifPresent(player -> {\n+          if (player.getClan() != null) {\n+            clanService.getClanByTag(player.getClan())\n+                .thenAccept(optionalClan -> Platform.runLater(() -> {\n+                      if (optionalClan.isPresent()) {\n+                        chatChannelUser.setClan(optionalClan.get());\n+                      } else {\n+                        chatChannelUser.setClan(null);\n+                      }\n+                    })\n+                );\n+          } else {\n+            chatChannelUser.setClan(null);\n+          }\n+        });\n+      }\n+    } else {\n+      chatChannelUser.setClan(null);\n     }\n   }\n \n   public void populateAvatar(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getAvatar().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Image avatar;\n-            if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n-              avatar = avatarService.loadAvatar(player.getAvatarUrl());\n-            } else {\n-              avatar = null;\n-            }\n-            Platform.runLater(() -> {\n-              chatChannelUser.setAvatar(avatar);\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getAvatar().isEmpty()) {\n+        chatChannelUser.getPlayer()\n+            .ifPresent(player -> {\n+              Image avatar;\n+              if (!Strings.isNullOrEmpty(player.getAvatarUrl())) {\n+                avatar = avatarService.loadAvatar(player.getAvatarUrl());\n+              } else {\n+                avatar = null;\n+              }\n+              Platform.runLater(() -> {\n+                chatChannelUser.setAvatar(avatar);\n+              });\n             });\n-          });\n+      }\n+    } else {\n+      chatChannelUser.setAvatar(null);\n     }\n   }\n \n   public void populateCountry(ChatChannelUser chatChannelUser) {\n-    if (chatChannelUser.getCountryFlag().isEmpty()) {\n-      chatChannelUser.getPlayer()\n-          .ifPresent(player -> {\n-            Optional<Image> countryFlag = countryFlagService.loadCountryFlag(player.getCountry());\n-            Platform.runLater(() -> {\n-              chatChannelUser.setCountryFlag(countryFlag.orElse(null));\n-              chatChannelUser.setCountryName(i18n.getCountryNameLocalized(player.getCountry()));\n+    if (chatChannelUser.isDisplayed()) {\n+      if (chatChannelUser.getCountryFlag().isEmpty()) {\n+        chatChannelUser.getPlayer()\n+            .ifPresent(player -> {\n+              Optional<Image> countryFlag = countryFlagService.loadCountryFlag(player.getCountry());\n+              Platform.runLater(() -> {\n+                chatChannelUser.setCountryFlag(countryFlag.orElse(null));\n+                chatChannelUser.setCountryName(i18n.getCountryNameLocalized(player.getCountry()));\n+              });\n             });\n-          });\n+      }\n+    } else {\n+      chatChannelUser.setCountryFlag(null);\n+      chatChannelUser.setCountryName(null);\n     }\n   }\n \n   public void populateGameStatus(ChatChannelUser chatChannelUser) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacc62618cb7f0d94d9b8f47ddef778d3eb63a56"}, "originalPosition": 127}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2003, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}