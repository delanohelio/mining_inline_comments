{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMzQxOTQy", "number": 1803, "reviewThreads": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODozMjo0MFrOEJOk2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyMTowMFrOENe0pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTExNDUwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/config/ClientProperties.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODozMjo0MFrOGpqzhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMDoyNTowNVrOGp00jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0NjExOQ==", "bodyText": "I would remove \"minSupportedMajorVersion\" (we have to have basic support all old versions forever to keep replays playable and even if we did we could build that in later) and all the corresponding checks.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446346119", "createdAt": "2020-06-26T18:32:40Z", "author": {"login": "Katharsas"}, "path": "src/main/java/com/faforever/client/config/ClientProperties.java", "diffHunk": "@@ -150,6 +150,9 @@\n     private String downloadUrlFormat;\n     private String repoAndOwnerName;\n     private String queryLatestVersionUrl;\n+    private String queryVersionsUrl;\n+    private int maxSupportedMajorVersion;\n+    private int minSupportedMajorVersion;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzU0NA==", "bodyText": "Well I think some time in the future old replays will break. I personally thnk that is ok even if it should be avoided", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446503544", "createdAt": "2020-06-27T08:59:03Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/config/ClientProperties.java", "diffHunk": "@@ -150,6 +150,9 @@\n     private String downloadUrlFormat;\n     private String repoAndOwnerName;\n     private String queryLatestVersionUrl;\n+    private String queryVersionsUrl;\n+    private int maxSupportedMajorVersion;\n+    private int minSupportedMajorVersion;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0NjExOQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMDIyMA==", "bodyText": "minSupportedMajorVersion is there as a just in case but never gets triggered since it is set to 0 it is there in case it ever would need to be used..", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446510220", "createdAt": "2020-06-27T10:25:05Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/config/ClientProperties.java", "diffHunk": "@@ -150,6 +150,9 @@\n     private String downloadUrlFormat;\n     private String repoAndOwnerName;\n     private String queryLatestVersionUrl;\n+    private String queryVersionsUrl;\n+    private int maxSupportedMajorVersion;\n+    private int minSupportedMajorVersion;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0NjExOQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTEyODQxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODozNzozOVrOGpq8Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMDozMDoxMFrOGp02Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0ODM3MQ==", "bodyText": "Doesnt this imply that this code needs to be adjusted whenever the major version changes? Why not check for 0 and then do the old way, so we dont need to adjust this on version 2,3 etc. ?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446348371", "createdAt": "2020-06-26T18:37:39Z", "author": {"login": "Katharsas"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,20 +379,37 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      String generatorVersion = mapGeneratorService.queryMaxSupportedVersion();\n+      String majorVersion = generatorVersion.split(\"\\\\.\")[0];\n+      if (majorVersion.equals(\"1\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMDYwNg==", "bodyText": "Makes sense done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446510606", "createdAt": "2020-06-27T10:30:10Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,20 +379,37 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      String generatorVersion = mapGeneratorService.queryMaxSupportedVersion();\n+      String majorVersion = generatorVersion.split(\"\\\\.\")[0];\n+      if (majorVersion.equals(\"1\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0ODM3MQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTE0MjkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0MzowNFrOGprFlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNjo0NDoyOVrOGp24tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MDc0MA==", "bodyText": "Are you sure this check is not already made by the game and replay services? It should be imo. Have you tried removing this and removing the installation setting and the trying to play?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446350740", "createdAt": "2020-06-26T18:43:04Z", "author": {"login": "Katharsas"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public JFXButton generateMapButton;\n+  public JFXTextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    if (preferencesService.getPreferences().getForgedAlliance().getInstallationPath() == null) {\n+      preferenceUpdateListener = preferences -> {\n+        if (!initialized && preferencesService.getPreferences().getForgedAlliance().getInstallationPath() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU0NDA1NQ==", "bodyText": "Removed", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446544055", "createdAt": "2020-06-27T16:44:29Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public JFXButton generateMapButton;\n+  public JFXTextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    if (preferencesService.getPreferences().getForgedAlliance().getInstallationPath() == null) {\n+      preferenceUpdateListener = preferences -> {\n+        if (!initialized && preferencesService.getPreferences().getForgedAlliance().getInstallationPath() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MDc0MA=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTE0MzkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0MzoyOVrOGprGOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMDowMTowMFrOGp0tVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MDkwNQ==", "bodyText": "private", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446350905", "createdAt": "2020-06-26T18:43:29Z", "author": {"login": "Katharsas"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public JFXButton generateMapButton;\n+  public JFXTextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    if (preferencesService.getPreferences().getForgedAlliance().getInstallationPath() == null) {\n+      preferenceUpdateListener = preferences -> {\n+        if (!initialized && preferencesService.getPreferences().getForgedAlliance().getInstallationPath() != null) {\n+          initialized = true;\n+\n+          Platform.runLater(this::init);\n+        }\n+      };\n+      preferencesService.addUpdateListener(new WeakReference<>(preferenceUpdateListener));\n+    } else {\n+      init();\n+    }\n+  }\n+\n+  public void init() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwODM3NA==", "bodyText": "Will do", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446508374", "createdAt": "2020-06-27T10:01:00Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public JFXButton generateMapButton;\n+  public JFXTextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    if (preferencesService.getPreferences().getForgedAlliance().getInstallationPath() == null) {\n+      preferenceUpdateListener = preferences -> {\n+        if (!initialized && preferencesService.getPreferences().getForgedAlliance().getInstallationPath() != null) {\n+          initialized = true;\n+\n+          Platform.runLater(this::init);\n+        }\n+      };\n+      preferencesService.addUpdateListener(new WeakReference<>(preferenceUpdateListener));\n+    } else {\n+      init();\n+    }\n+  }\n+\n+  public void init() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MDkwNQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTE1ODkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0ODo1N1rOGprP0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMjo0MzoyM1rOGp1mww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MzM2MQ==", "bodyText": "space around \">\", same below", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446353361", "createdAt": "2020-06-26T18:48:57Z", "author": {"login": "Katharsas"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -127,17 +144,53 @@ protected String queryNewestVersion() {\n     return mainObject.get(\"tag_name\").getAsString();\n   }\n \n+  @VisibleForTesting\n+  public String queryMaxSupportedVersion() {\n+    String version = queryNewestVersion();\n+    String majorVersion = version.split(\"\\\\.\")[0];\n+    if (Integer.parseInt(majorVersion)>clientProperties.getMapGenerator().getMaxSupportedMajorVersion() ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyMzA3NQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446523075", "createdAt": "2020-06-27T12:43:23Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -127,17 +144,53 @@ protected String queryNewestVersion() {\n     return mainObject.get(\"tag_name\").getAsString();\n   }\n \n+  @VisibleForTesting\n+  public String queryMaxSupportedVersion() {\n+    String version = queryNewestVersion();\n+    String majorVersion = version.split(\"\\\\.\")[0];\n+    if (Integer.parseInt(majorVersion)>clientProperties.getMapGenerator().getMaxSupportedMajorVersion() ||", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MzM2MQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjE5NjY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwOTowMDo0OFrOGp0bJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMjo0Mzo0M1rOGp1nIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzcxOQ==", "bodyText": "I think we have a class that can parse semantic versions... If we do, which I think use that", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446503719", "createdAt": "2020-06-27T09:00:48Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,20 +379,37 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      String generatorVersion = mapGeneratorService.queryMaxSupportedVersion();\n+      String majorVersion = generatorVersion.split(\"\\\\.\")[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyMzE2OA==", "bodyText": "Used ComparableVersion", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446523168", "createdAt": "2020-06-27T12:43:43Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,20 +379,37 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      String generatorVersion = mapGeneratorService.queryMaxSupportedVersion();\n+      String majorVersion = generatorVersion.split(\"\\\\.\")[0];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzcxOQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjE5NzM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwOTowMjoyMVrOGp0bgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMjo0NDowOFrOGp1nOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzgwOA==", "bodyText": "We are trying to get away from JFX since a few weeks. Can u use the notification and a Immediate notification with custom UI. @micheljung what should he do?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446503808", "createdAt": "2020-06-27T09:02:21Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,20 +379,37 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      String generatorVersion = mapGeneratorService.queryMaxSupportedVersion();\n+      String majorVersion = generatorVersion.split(\"\\\\.\")[0];\n+      if (majorVersion.equals(\"1\")) {\n+        GenerateMapController generateMapController = uiService.loadFxml(\"theme/play/generate_map.fxml\");\n+\n+        Pane root = generateMapController.getRoot();\n+        generateMapController.setCreateGameController(this);\n+        JFXDialog dialog = uiService.showInDialog(gamesRoot, root, i18n.get(\"game.generate.dialog\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyMzE5NA==", "bodyText": "Decided to keep JFXDialog for now.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446523194", "createdAt": "2020-06-27T12:44:08Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,20 +379,37 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      String generatorVersion = mapGeneratorService.queryMaxSupportedVersion();\n+      String majorVersion = generatorVersion.split(\"\\\\.\")[0];\n+      if (majorVersion.equals(\"1\")) {\n+        GenerateMapController generateMapController = uiService.loadFxml(\"theme/play/generate_map.fxml\");\n+\n+        Pane root = generateMapController.getRoot();\n+        generateMapController.setCreateGameController(this);\n+        JFXDialog dialog = uiService.showInDialog(gamesRoot, root, i18n.get(\"game.generate.dialog\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzgwOA=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjE5NzcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwOTowMjo1NVrOGp0bpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNjozNjo0MlrOGp22Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzg0Ng==", "bodyText": "Use @slf4j annotation instead", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446503846", "createdAt": "2020-06-27T09:02:55Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTc5Mg==", "bodyText": "I am unclear what using @slf4j should replace if I remove the logger then what should be used on line 227?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446509792", "createdAt": "2020-06-27T10:19:27Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzg0Ng=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMTYxNw==", "bodyText": "https://projectlombok.org/api/lombok/extern/slf4j/Slf4j.html", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446511617", "createdAt": "2020-06-27T10:43:24Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzg0Ng=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU0MzQzOQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446543439", "createdAt": "2020-06-27T16:36:42Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzg0Ng=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjE5Nzk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwOTowMzoyMFrOGp0bzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMDoxNzo1N1rOGp0ycQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzg4NA==", "bodyText": "Use Button and TextField. At least in the Controller", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446503884", "createdAt": "2020-06-27T09:03:20Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public JFXButton generateMapButton;\n+  public JFXTextField previousMapName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTY4MQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446509681", "createdAt": "2020-06-27T10:17:57Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public JFXButton generateMapButton;\n+  public JFXTextField previousMapName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwMzg4NA=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjE5OTkyOnYy", "diffSide": "RIGHT", "path": "src/main/resources/i18n/messages_cs.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwOTowNjozOVrOGp0cwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxMDoxODoxM1rOGp0yfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwNDEyOQ==", "bodyText": "Never change other language files", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446504129", "createdAt": "2020-06-27T09:06:39Z", "author": {"login": "1-alex98"}, "path": "src/main/resources/i18n/messages_cs.properties", "diffHunk": "@@ -632,7 +632,7 @@ view.showSidePane=V\u00edce detail\u016f\n view.hideSidePane=M\u00e9n\u011b detail\u016f\n menu.revealReplayFolder=Otev\u0159\u00edt slo\u017eku se z\u00e1znamy\n menu.revealGamePrefsFile=Otev\u0159\u00edt slo\u017eku s game.prefs souborem\n-game.create.generatedMap=Vytvo\u0159it mapu\n+game.generate=Vytvo\u0159it mapu", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTY5NA==", "bodyText": "Reverted all other language files", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446509694", "createdAt": "2020-06-27T10:18:13Z", "author": {"login": "Sheikah45"}, "path": "src/main/resources/i18n/messages_cs.properties", "diffHunk": "@@ -632,7 +632,7 @@ view.showSidePane=V\u00edce detail\u016f\n view.hideSidePane=M\u00e9n\u011b detail\u016f\n menu.revealReplayFolder=Otev\u0159\u00edt slo\u017eku se z\u00e1znamy\n menu.revealGamePrefsFile=Otev\u0159\u00edt slo\u017eku s game.prefs souborem\n-game.create.generatedMap=Vytvo\u0159it mapu\n+game.generate=Vytvo\u0159it mapu", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwNDEyOQ=="}, "originalCommit": {"oid": "4496f5f026ff3e89126867a698063d29a581f856"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQwNTg4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoxNDowN1rOGp9VIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMToyMDoyN1rOGrhwgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0OTYzNQ==", "bodyText": "unused, try turning on the option when commiting that removes unused imports", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446649635", "createdAt": "2020-06-28T13:14:07Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -26,6 +26,7 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Strings;\n import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXDialog;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1Mzg3MQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446653871", "createdAt": "2020-06-28T13:52:44Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -26,6 +26,7 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Strings;\n import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXDialog;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0OTYzNQ=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIxOTEwOA==", "bodyText": "Not done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r448219108", "createdAt": "2020-07-01T08:56:36Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -26,6 +26,7 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Strings;\n import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXDialog;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0OTYzNQ=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI5NTA0Mw==", "bodyText": "The JFXDialog is used by uiService.showInDialog on line 406 which I thought we were going to leave in if not I can try to find a way to remove it.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r448295043", "createdAt": "2020-07-01T11:20:27Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -26,6 +26,7 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Strings;\n import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXDialog;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0OTYzNQ=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQwODQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoxNjo0NVrOGp9WXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzo1MjozN1rOGp9lng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0OTk1MA==", "bodyText": "remove", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446649950", "createdAt": "2020-06-28T13:16:45Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1Mzg1NA==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446653854", "createdAt": "2020-06-28T13:52:37Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0OTk1MA=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQwOTgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoxODoyNVrOGp9XBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzo1MjoxOFrOGp9lew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDExOQ==", "bodyText": "ident", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446650119", "createdAt": "2020-06-28T13:18:25Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzgxOQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446653819", "createdAt": "2020-06-28T13:52:18Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDExOQ=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 192}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQxMDEzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoxODo1MFrOGp9XKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzo1MjowOVrOGp9laA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDE1NQ==", "bodyText": "Byte.MAX_VALUE that exists right?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446650155", "createdAt": "2020-06-28T13:18:50Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });\n+          });\n+        });\n+      } else {\n+        byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+        byte landDensity = (byte) (127 - getSliderValue(waterSlider, waterRandom));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzgwMA==", "bodyText": "Changed", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446653800", "createdAt": "2020-06-28T13:52:09Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });\n+          });\n+        });\n+      } else {\n+        byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+        byte landDensity = (byte) (127 - getSliderValue(waterSlider, waterRandom));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDE1NQ=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 197}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQxMDgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoxOTozMFrOGp9XfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzo1NTozM1rOGp9m9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDIzNw==", "bodyText": "indent", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446650237", "createdAt": "2020-06-28T13:19:30Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });\n+          });\n+        });\n+      } else {\n+        byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+        byte landDensity = (byte) (127 - getSliderValue(waterSlider, waterRandom));\n+        byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+        byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+        byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+        byte[] optionArray = {spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 211}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDI0Nw==", "bodyText": "ctrl+alt+L", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446650247", "createdAt": "2020-06-28T13:19:45Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });\n+          });\n+        });\n+      } else {\n+        byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+        byte landDensity = (byte) (127 - getSliderValue(waterSlider, waterRandom));\n+        byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+        byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+        byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+        byte[] optionArray = {spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDIzNw=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 211}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1NDE5Ng==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446654196", "createdAt": "2020-06-28T13:55:33Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.DualStringListCell;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.mod.FeaturedMod;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.jfoenix.controls.JFXButton;\n+import com.jfoenix.controls.JFXTextField;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.MultipleSelectionModel;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.invoke.MethodHandles;\n+import java.lang.ref.WeakReference;\n+import java.util.Objects;\n+import java.util.Random;\n+import java.util.function.Function;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter(){\n+    return new StringConverter<Double>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) return \"None\";\n+        return \"Lots\";\n+      }\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")){return 0d;}\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterRandomProperty(newValue);\n+    waterSlider.setVisible(!newValue);}));\n+    waterSlider.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+    preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauSlider.setVisible(!newValue);}));\n+    plateauSlider.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainSlider.setVisible(!newValue);}));\n+    mountainSlider.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampRandomProperty(newValue);\n+      rampSlider.setVisible(!newValue);}));\n+    rampSlider.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();}));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()){\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()){\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });\n+          });\n+        });\n+      } else {\n+        byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+        byte landDensity = (byte) (127 - getSliderValue(waterSlider, waterRandom));\n+        byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+        byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+        byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+        byte[] optionArray = {spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            createGameController.initMapSelection();\n+            createGameController.mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {\n+              createGameController.mapListView.getSelectionModel().select(mapBean);\n+              createGameController.mapListView.scrollTo(mapBean);\n+              createGameController.setSelectedMap(mapBean);\n+            });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDIzNw=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 211}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQxMTk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoyMDo1NFrOGp9YDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzo1MTo1M1rOGp9lWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDM4MA==", "bodyText": "Make them call each other and avoid code duplication", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446650380", "createdAt": "2020-06-28T13:20:54Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,13 +119,40 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion,seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(generatorVersion,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1Mzc4NA==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446653784", "createdAt": "2020-06-28T13:51:53Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,13 +119,40 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion,seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(generatorVersion,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n   }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDM4MA=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzQxMjQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzoyMTozOVrOGp9YTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxMzo1MTo0N1rOGp9lUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDQ0NQ==", "bodyText": "Make sue this is only ever called via a Spring Proxy", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446650445", "createdAt": "2020-06-28T13:21:39Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,13 +119,40 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion,seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(generatorVersion,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1Mzc3Ng==", "bodyText": "Should only be called by the bean", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446653776", "createdAt": "2020-06-28T13:51:47Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,13 +119,40 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion,seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(generatorVersion,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version,seedString+'_'+optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MDQ0NQ=="}, "originalCommit": {"oid": "73693dce16a21a72c922930d6928c0cae6087a5c"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzcxOTU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxOTozMTowM1rOGp_uXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQyMDozODoyM1rOGqAIMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4ODg2MQ==", "bodyText": "The hardcoded \"1\" needs at least a comment what is happening here.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446688861", "createdAt": "2020-06-28T19:31:03Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,23 +376,39 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      mapGeneratorService.setGeneratorVersion(mapGeneratorService.queryMaxSupportedVersion());\n+      if (mapGeneratorService.getGeneratorVersion().compareTo(new ComparableVersion(\"1\")) < 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTQ3Mg==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446695472", "createdAt": "2020-06-28T20:38:23Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,23 +376,39 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      mapGeneratorService.setGeneratorVersion(mapGeneratorService.queryMaxSupportedVersion());\n+      if (mapGeneratorService.getGeneratorVersion().compareTo(new ComparableVersion(\"1\")) < 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4ODg2MQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzcxOTczOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxOTozMToyMFrOGp_ucg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQyMzozNjozM1rOGqBLyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4ODg4Mg==", "bodyText": "linebreak after .findAny()", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446688882", "createdAt": "2020-06-28T19:31:20Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,23 +376,39 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      mapGeneratorService.setGeneratorVersion(mapGeneratorService.queryMaxSupportedVersion());\n+      if (mapGeneratorService.getGeneratorVersion().compareTo(new ComparableVersion(\"1\")) < 0) {\n+        mapGeneratorService.generateMap().thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            initMapSelection();\n+            mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcxMjc3OQ==", "bodyText": "Added", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446712779", "createdAt": "2020-06-28T23:36:33Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,23 +376,39 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      mapGeneratorService.setGeneratorVersion(mapGeneratorService.queryMaxSupportedVersion());\n+      if (mapGeneratorService.getGeneratorVersion().compareTo(new ComparableVersion(\"1\")) < 0) {\n+        mapGeneratorService.generateMap().thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            initMapSelection();\n+            mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny().ifPresent(mapBean -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4ODg4Mg=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzcyMzA1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxOTozNTozM1rOGp_wDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQyMzozNjo0NFrOGqBL5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTI5NQ==", "bodyText": "This is never used?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446689295", "createdAt": "2020-06-28T19:35:33Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,257 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import javafx.application.Platform;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcxMjgwNA==", "bodyText": "Removed", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446712804", "createdAt": "2020-06-28T23:36:44Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,257 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.MapBean;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferenceUpdateListener;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.google.common.annotations.VisibleForTesting;\n+import javafx.application.Platform;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  @VisibleForTesting\n+  FilteredList<MapBean> filteredMapBeans;\n+  private Runnable onCloseButtonClickedListener;\n+  private PreferenceUpdateListener preferenceUpdateListener;\n+\n+  /**\n+   * Remembers if the controller's init method was called, to avoid memory leaks by adding several listeners\n+   */\n+  private boolean initialized;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTI5NQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzcyNTkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxOTozOToxNlrOGp_xew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTo0NTo1MlrOGqjWhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTY1OQ==", "bodyText": "Is there a reason not to use jackson? You can configure a pojo to ignore unknown fields.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446689659", "createdAt": "2020-06-28T19:39:16Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n+    RestTemplate restTemplate = new RestTemplate();\n+\n+    LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n+    headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n+    HttpEntity<String> entity = new HttpEntity<>(null, headers);\n+\n+    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, String.class);\n+    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n+    for (JsonElement element : jsonElement.getAsJsonArray()) {\n+      JsonObject mainObject = element.getAsJsonObject();\n+      version.parseVersion(mainObject.get(\"tag_name\").getAsString());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NDg3OQ==", "bodyText": "Yeah I am going to say the reason is that I have no idea what a jackson is.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446694879", "createdAt": "2020-06-28T20:32:13Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n+    RestTemplate restTemplate = new RestTemplate();\n+\n+    LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n+    headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n+    HttpEntity<String> entity = new HttpEntity<>(null, headers);\n+\n+    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, String.class);\n+    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n+    for (JsonElement element : jsonElement.getAsJsonArray()) {\n+      JsonObject mainObject = element.getAsJsonObject();\n+      version.parseVersion(mainObject.get(\"tag_name\").getAsString());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTY1OQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc2NjY3Ng==", "bodyText": "Oh. Jackson is the json de/serializer in Spring (https://github.com/FasterXML/jackson). Spring uses it by default e.g. if you call a RestTemplate, you tell Spring it needs to return a type T and Jackson will convert it to type T.\n(The client also uses Gson which is another json de/serializer by Google, but in the long run, everything should use Jackson).\nYou can get it via Dependency Injection. The class you need to ask for is an ObjectMapper.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446766676", "createdAt": "2020-06-29T04:33:52Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n+    RestTemplate restTemplate = new RestTemplate();\n+\n+    LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n+    headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n+    HttpEntity<String> entity = new HttpEntity<>(null, headers);\n+\n+    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, String.class);\n+    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n+    for (JsonElement element : jsonElement.getAsJsonArray()) {\n+      JsonObject mainObject = element.getAsJsonObject();\n+      version.parseVersion(mainObject.get(\"tag_name\").getAsString());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTY1OQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc2ODA5Mg==", "bodyText": "Alternatively you can ask the RestTemplate directly to return you the pojo you need. If it fails during runtime because it get more values than expected than put this as annotation on the pojo: @JsonIgnoreProperties(ignoreUnknown = true)", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446768092", "createdAt": "2020-06-29T04:39:51Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n+    RestTemplate restTemplate = new RestTemplate();\n+\n+    LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n+    headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n+    HttpEntity<String> entity = new HttpEntity<>(null, headers);\n+\n+    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, String.class);\n+    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n+    for (JsonElement element : jsonElement.getAsJsonArray()) {\n+      JsonObject mainObject = element.getAsJsonObject();\n+      version.parseVersion(mainObject.get(\"tag_name\").getAsString());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTY1OQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjU4Mg==", "bodyText": "Have it return from RestTemplate directly", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r447272582", "createdAt": "2020-06-29T21:45:52Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n+    RestTemplate restTemplate = new RestTemplate();\n+\n+    LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n+    headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n+    HttpEntity<String> entity = new HttpEntity<>(null, headers);\n+\n+    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, String.class);\n+    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n+    for (JsonElement element : jsonElement.getAsJsonArray()) {\n+      JsonObject mainObject = element.getAsJsonObject();\n+      version.parseVersion(mainObject.get(\"tag_name\").getAsString());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTY1OQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 128}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzcyNjkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxOTo0MDoxN1rOGp_x7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQyMDo1Nzo0N1rOGqAPwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTc3NQ==", "bodyText": "I'm not entirely sure what happens if you use the cache twice for the same type as the method has no arguments?!", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446689775", "createdAt": "2020-06-28T19:40:17Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NzQwOA==", "bodyText": "Alright well I had left in the query newest version in case it could be used elsewhere but it is not used anywhere else so I removed it.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r446697408", "createdAt": "2020-06-28T20:57:47Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -124,26 +152,62 @@ protected String queryNewestVersion() {\n     JsonElement jsonElement = new JsonParser().parse(response.getBody());\n     JsonObject mainObject = jsonElement.getAsJsonObject();\n \n-    return mainObject.get(\"tag_name\").getAsString();\n+    return new ComparableVersion(mainObject.get(\"tag_name\").getAsString());\n+  }\n+\n+  @VisibleForTesting\n+  @Cacheable(CacheNames.MAP_GENERATOR)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4OTc3NQ=="}, "originalCommit": {"oid": "4d402f05d45ad0e7acdf0e4ffb794aad0570eb97"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDc1Nzc2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzo1MDoyMFrOGtD2gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxOTo0MTo0M1rOGtEbTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjIwOA==", "bodyText": "Could have used Bindings here :D", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449902208", "createdAt": "2020-07-05T17:50:20Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjI2OA==", "bodyText": "https://www.youtube.com/watch?v=6Zi2L0kHSx4", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449902268", "createdAt": "2020-07-05T17:50:50Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjIwOA=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkxMTYzMA==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449911630", "createdAt": "2020-07-05T19:41:43Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjIwOA=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDc1OTk0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzo1Mjo1MVrOGtD3iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNzo1NTo0M1rOGtMp5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjQ3Mg==", "bodyText": "I doubt that is is ever called. You probably need to do this in .excpetionally() on the Completable Future. https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/completion-stages-exception-handling.html", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449902472", "createdAt": "2020-07-05T17:52:51Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));\n+    plateauBox.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainBox.setVisible(!newValue);\n+    }));\n+    mountainBox.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampRandomProperty(newValue);\n+      rampBox.setVisible(!newValue);\n+    }));\n+    rampBox.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      }\n+    } catch (IllegalArgumentException e) {\n+      String msg = e.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+      if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } catch (Exception e) {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNjQzMw==", "bodyText": "I tested it and .exceptionally doesnt work because it is not a completable future that throws the exception rather it is the generatemap function which when it throws the exception never hands back a completable future which is the reason for the try catch but if there is another way it could be structured to use the .exceptionally let me know", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449906433", "createdAt": "2020-07-05T18:40:28Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));\n+    plateauBox.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainBox.setVisible(!newValue);\n+    }));\n+    mountainBox.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampRandomProperty(newValue);\n+      rampBox.setVisible(!newValue);\n+    }));\n+    rampBox.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      }\n+    } catch (IllegalArgumentException e) {\n+      String msg = e.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+      if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } catch (Exception e) {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjQ3Mg=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwNzExOA==", "bodyText": "Nevermind I got it and changed the map generator service to return a completable future that throws an exception", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449907118", "createdAt": "2020-07-05T18:47:59Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));\n+    plateauBox.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainBox.setVisible(!newValue);\n+    }));\n+    mountainBox.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampRandomProperty(newValue);\n+      rampBox.setVisible(!newValue);\n+    }));\n+    rampBox.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      }\n+    } catch (IllegalArgumentException e) {\n+      String msg = e.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+      if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } catch (Exception e) {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjQ3Mg=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwODcxNw==", "bodyText": "Done and let me know if you meant something different", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r449908717", "createdAt": "2020-07-05T19:06:54Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));\n+    plateauBox.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainBox.setVisible(!newValue);\n+    }));\n+    mountainBox.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampRandomProperty(newValue);\n+      rampBox.setVisible(!newValue);\n+    }));\n+    rampBox.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      }\n+    } catch (IllegalArgumentException e) {\n+      String msg = e.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+      if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } catch (Exception e) {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjQ3Mg=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0NTk5Mg==", "bodyText": "Well ok maybe I was wrong then. I just expected it to be thrown inside the CompletableFuture", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450045992", "createdAt": "2020-07-06T07:54:54Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));\n+    plateauBox.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainBox.setVisible(!newValue);\n+    }));\n+    mountainBox.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampRandomProperty(newValue);\n+      rampBox.setVisible(!newValue);\n+    }));\n+    rampBox.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      }\n+    } catch (IllegalArgumentException e) {\n+      String msg = e.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+      if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } catch (Exception e) {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjQ3Mg=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0NjQzNw==", "bodyText": "It also should be because otherwise u are doing stuff on the ui thread that u should not do. Lemme see what u did...", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450046437", "createdAt": "2020-07-06T07:55:43Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,246 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterRandomProperty(newValue);\n+      waterBox.setVisible(!newValue);\n+    }));\n+    waterBox.setVisible(!waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setWaterDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauRandomProperty(newValue);\n+      plateauBox.setVisible(!newValue);\n+    }));\n+    plateauBox.setVisible(!plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setPlateauDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainRandomProperty(newValue);\n+      mountainBox.setVisible(!newValue);\n+    }));\n+    mountainBox.setVisible(!mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setMountainDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampRandom.selectedProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampRandomProperty(newValue);\n+      rampBox.setVisible(!newValue);\n+    }));\n+    rampBox.setVisible(!rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampSlider.valueProperty().addListener(((observable, oldValue, newValue) -> {\n+      generatorPrefs.setRampDensityProperty(newValue.intValue());\n+      preferencesService.storeInBackground();\n+    }));\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+    try {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText()).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray).thenAccept(mapName -> Platform.runLater(() -> {\n+          createGameController.initMapSelection();\n+          createGameController.mapListView.getItems().stream()\n+              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+              .findAny().ifPresent(mapBean -> {\n+            createGameController.mapListView.getSelectionModel().select(mapBean);\n+            createGameController.mapListView.scrollTo(mapBean);\n+            createGameController.setSelectedMap(mapBean);\n+          });\n+        }));\n+      }\n+    } catch (IllegalArgumentException e) {\n+      String msg = e.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+      if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } catch (Exception e) {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjQ3Mg=="}, "originalCommit": {"oid": "ca413c506cf54beac9dc92a45c68aa5a199200e3"}, "originalPosition": 231}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTc4MDc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNzo1ODo1OFrOGtMwVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMTowNzowMVrOGt5svg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODA4Nw==", "bodyText": "If this return null then there is gonna be a nullpointer Exception following in the thenAccept part right XD Also createGameController.initMapSelection(); is called", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450048087", "createdAt": "2020-07-06T07:58:58Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODMwMg==", "bodyText": "Maybe not just maybe see how it behaves.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450048302", "createdAt": "2020-07-06T07:59:25Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODA4Nw=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0Mjk3MA==", "bodyText": "I tested this and it just errored with the illegalArgument Exception but could also just move the .exceptionally to the end.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450142970", "createdAt": "2020-07-06T10:55:22Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODA4Nw=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc4NDQ0Ng==", "bodyText": "Moved it to the end of the futures", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450784446", "createdAt": "2020-07-07T11:07:01Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODA4Nw=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 173}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTc4NDMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODowMDowOFrOGtMyow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMTowNTozNFrOGt5qHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODY3NQ==", "bodyText": "Should they not all be warn", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450048675", "createdAt": "2020-07-06T08:00:08Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } else {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 222}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE0NTE3OA==", "bodyText": "I am not sure what you me by all of them being warn? is there another function to the notification service?", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450145178", "createdAt": "2020-07-06T11:00:07Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } else {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODY3NQ=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 222}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY3NjE1Mw==", "bodyText": "log.warn(....)", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450676153", "createdAt": "2020-07-07T07:53:28Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } else {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODY3NQ=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 222}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc3MDIxNQ==", "bodyText": "Ah got it", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450770215", "createdAt": "2020-07-07T10:38:15Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } else {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODY3NQ=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 222}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc4Mzc3Mw==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450783773", "createdAt": "2020-07-07T11:05:34Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            })\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }));\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.error(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.error(\"Map generation failed\", e);\n+      }\n+    } else {\n+      notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+      log.error(\"Map generation failed\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0ODY3NQ=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 222}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTc4OTI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODowMTozMFrOGtM1mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMTowNToyNVrOGt5p1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0OTQzNA==", "bodyText": "I think there is a static Method on the CompletableFuture class that does exactly that", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450049434", "createdAt": "2020-07-06T08:01:30Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,43 +115,87 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<List<GithubGeneratorRelease>>(){});\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      return CompletableFuture.supplyAsync(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc4MzcwMg==", "bodyText": "Used", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r450783702", "createdAt": "2020-07-07T11:05:25Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,43 +115,87 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<List<GithubGeneratorRelease>>(){});\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      return CompletableFuture.supplyAsync(() -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA0OTQzNA=="}, "originalCommit": {"oid": "50bc6d15cabc20ac6a502d664221efe7e72b2f84"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjg5MDI4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo0MjoyNFrOGvw_sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NTo1OFrOGv0UoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczODk5Mw==", "bodyText": "This code doesn't seem properly formatted; please use/enable IntelliJ's auto formatting", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452738993", "createdAt": "2020-07-10T09:42:24Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,23 +376,41 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      mapGeneratorService.setGeneratorVersion(mapGeneratorService.queryMaxSupportedVersion());\n+      // Check if generated map is major version 0 which does not support options\n+      if (mapGeneratorService.getGeneratorVersion().compareTo(new ComparableVersion(\"1\")) < 0) {\n+        mapGeneratorService.generateMap().thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            initMapSelection();\n+            mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny()\n+                .ifPresent(mapBean -> {\n+              mapListView.getSelectionModel().select(mapBean);\n+              mapListView.scrollTo(mapBean);\n+              setSelectedMap(mapBean);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzUwNA==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793504", "createdAt": "2020-07-10T11:45:58Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -375,23 +376,41 @@ public void onRandomMapButtonClicked() {\n     mapListView.scrollTo(mapIndex);\n   }\n \n-  public void onGenerateMapButtonClicked() {\n+  public void onGenerateMapButtonClicked(){\n+    onGenerateMap();\n+  }\n+\n+  private void onGenerateMap() {\n     try {\n-      mapGeneratorService.generateMap().thenAccept(mapName -> {\n-        Platform.runLater(() -> {\n-          initMapSelection();\n-          mapListView.getItems().stream()\n-              .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n-              .findAny().ifPresent(mapBean -> {\n-            mapListView.getSelectionModel().select(mapBean);\n-            mapListView.scrollTo(mapBean);\n-            setSelectedMap(mapBean);\n+      mapGeneratorService.setGeneratorVersion(mapGeneratorService.queryMaxSupportedVersion());\n+      // Check if generated map is major version 0 which does not support options\n+      if (mapGeneratorService.getGeneratorVersion().compareTo(new ComparableVersion(\"1\")) < 0) {\n+        mapGeneratorService.generateMap().thenAccept(mapName -> {\n+          Platform.runLater(() -> {\n+            initMapSelection();\n+            mapListView.getItems().stream()\n+                .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                .findAny()\n+                .ifPresent(mapBean -> {\n+              mapListView.getSelectionModel().select(mapBean);\n+              mapListView.scrollTo(mapBean);\n+              setSelectedMap(mapBean);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczODk5Mw=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjg5NTA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo0Mzo1MVrOGvxClw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NTo1NFrOGv0Ujg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczOTczNQ==", "bodyText": "This is redundant; inline init()", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452739735", "createdAt": "2020-07-10T09:43:51Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzQ4Ng==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793486", "createdAt": "2020-07-10T11:45:54Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczOTczNQ=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjg5ODM4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo0NDo1MlrOGvxEow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NTo0N1rOGv0UXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0MDI1OQ==", "bodyText": "Use I18n and message keys.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452740259", "createdAt": "2020-07-10T09:44:52Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzQzNw==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793437", "createdAt": "2020-07-10T11:45:47Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0MDI1OQ=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkwMDk2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo0NTozNlrOGvxGNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NTo0MVrOGv0ULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0MDY2Mg==", "bodyText": "Conversion from String to a number is most likely never used; just throw an UnsupportedOperationException", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452740662", "createdAt": "2020-07-10T09:45:36Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzM5MA==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793390", "createdAt": "2020-07-10T11:45:41Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0MDY2Mg=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkxNTQwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo0OTo0OVrOGvxO7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDoyN1rOGv0SNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0Mjg5NA==", "bodyText": "Reduce code duplication", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452742894", "createdAt": "2020-07-10T09:49:49Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            });\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5Mjg4Ng==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452792886", "createdAt": "2020-07-10T11:44:27Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            });\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0Mjg5NA=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 197}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkyMjI4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1MTo1MVrOGvxTCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDo0OFrOGv0Ssg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0Mzk0Nw==", "bodyText": "Relying on the exception message is quite fragile; it's not part of an API and may change at any time, staying unnoticed. Instead, the map generator should either throw concrete exceptions or its exception should contain some sort of reason code.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452743947", "createdAt": "2020-07-10T09:51:51Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            });\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            });\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.warn(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.warn(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.warn(\"Map generation failed\", e);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 219}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzAxMA==", "bodyText": "Done. Used concrete exceptions.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793010", "createdAt": "2020-07-10T11:44:48Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/GenerateMapController.java", "diffHunk": "@@ -0,0 +1,237 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.map.generator.MapGeneratorService;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.preferences.GeneratorPrefs;\n+import com.faforever.client.preferences.PreferencesService;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.Slider;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory;\n+import javafx.scene.control.TextField;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.util.StringConverter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Random;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+@Slf4j\n+public class GenerateMapController implements Controller<Pane> {\n+\n+  private final PreferencesService preferencesService;\n+  private final NotificationService notificationService;\n+  private final MapGeneratorService mapGeneratorService;\n+  public CreateGameController createGameController;\n+  public Pane generateMapRoot;\n+  public Button generateMapButton;\n+  public TextField previousMapName;\n+  public Spinner<Integer> spawnCountSpinner;\n+  public Slider waterSlider;\n+  public CheckBox waterRandom;\n+  public HBox waterBox;\n+  public Slider mountainSlider;\n+  public CheckBox mountainRandom;\n+  public HBox mountainBox;\n+  public Slider plateauSlider;\n+  public CheckBox plateauRandom;\n+  public HBox plateauBox;\n+  public Slider rampSlider;\n+  public CheckBox rampRandom;\n+  public HBox rampBox;\n+  private Runnable onCloseButtonClickedListener;\n+\n+  public void initialize() {\n+    init();\n+  }\n+\n+  private void init() {\n+    initSpawnCountSpinner();\n+    initWaterSlider();\n+    initPlateauSlider();\n+    initMountainSlider();\n+    initRampSlider();\n+  }\n+\n+  private void initSpawnCountSpinner() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    int spawnCountProperty = generatorPrefs.getSpawnCountProperty();\n+    spawnCountSpinner.setValueFactory(new IntegerSpinnerValueFactory(2, 16, spawnCountProperty, 2));\n+    spawnCountSpinner.getValueFactory().valueProperty().addListener((observable, oldValue, newValue) -> {\n+      generatorPrefs.setSpawnCountProperty(newValue);\n+      preferencesService.storeInBackground();\n+    });\n+  }\n+\n+  private StringConverter<Double> getLabelConverter() {\n+    return new StringConverter<>() {\n+      @Override\n+      public String toString(Double n) {\n+        if (n < 127) {\n+          return \"None\";\n+        }\n+        return \"Lots\";\n+      }\n+\n+      @Override\n+      public Double fromString(String s) {\n+        if (s.equals(\"None\")) {\n+          return 0d;\n+        }\n+        return 127d;\n+      }\n+    };\n+  }\n+\n+  private void initWaterSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double waterDensityProperty = generatorPrefs.getWaterDensityProperty();\n+    boolean waterRandomProperty = generatorPrefs.getWaterRandomProperty();\n+    waterSlider.setLabelFormatter(getLabelConverter());\n+    waterRandom.setSelected(waterRandomProperty);\n+    waterSlider.setValue(waterDensityProperty);\n+    waterBox.visibleProperty().bind(waterRandom.selectedProperty().not());\n+    generatorPrefs.waterDensityPropertyProperty().bind(waterSlider.valueProperty());\n+    generatorPrefs.waterRandomPropertyProperty().bind(waterRandom.selectedProperty());\n+  }\n+\n+  private void initPlateauSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double plateauDensityProperty = generatorPrefs.getPlateauDensityProperty();\n+    boolean plateauRandomProperty = generatorPrefs.getPlateauRandomProperty();\n+    plateauSlider.setLabelFormatter(getLabelConverter());\n+    plateauRandom.setSelected(plateauRandomProperty);\n+    plateauSlider.setValue(plateauDensityProperty);\n+    plateauBox.visibleProperty().bind(plateauRandom.selectedProperty().not());\n+    generatorPrefs.plateauDensityPropertyProperty().bind(plateauSlider.valueProperty());\n+    generatorPrefs.plateauRandomPropertyProperty().bind(plateauRandom.selectedProperty());\n+  }\n+\n+  private void initMountainSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double mountainDensityProperty = generatorPrefs.getMountainDensityProperty();\n+    boolean mountainRandomProperty = generatorPrefs.getMountainRandomProperty();\n+    mountainSlider.setLabelFormatter(getLabelConverter());\n+    mountainRandom.setSelected(mountainRandomProperty);\n+    mountainSlider.setValue(mountainDensityProperty);\n+    mountainBox.visibleProperty().bind(mountainRandom.selectedProperty().not());\n+    generatorPrefs.mountainDensityPropertyProperty().bind(mountainSlider.valueProperty());\n+    generatorPrefs.mountainRandomPropertyProperty().bind(mountainRandom.selectedProperty());\n+  }\n+\n+  private void initRampSlider() {\n+    GeneratorPrefs generatorPrefs = preferencesService.getPreferences().getGeneratorPrefs();\n+    double rampDensityProperty = generatorPrefs.getRampDensityProperty();\n+    boolean rampRandomProperty = generatorPrefs.getRampRandomProperty();\n+    rampSlider.setLabelFormatter(getLabelConverter());\n+    rampRandom.setSelected(rampRandomProperty);\n+    rampSlider.setValue(rampDensityProperty);\n+    rampBox.visibleProperty().bind(rampRandom.selectedProperty().not());\n+    generatorPrefs.rampDensityPropertyProperty().bind(rampSlider.valueProperty());\n+    generatorPrefs.rampRandomPropertyProperty().bind(rampRandom.selectedProperty());\n+  }\n+\n+  private byte getSliderValue(Slider slider, CheckBox checkBox) {\n+    if (checkBox.isSelected()) {\n+      return (byte) new Random().nextInt(127);\n+    }\n+    return (byte) slider.getValue();\n+  }\n+\n+  protected byte[] getOptionArray() {\n+    byte spawnCount = spawnCountSpinner.getValue().byteValue();\n+    byte landDensity = (byte) (Byte.MAX_VALUE - getSliderValue(waterSlider, waterRandom));\n+    byte plateauDensity = getSliderValue(plateauSlider, plateauRandom);\n+    byte mountainDensity = getSliderValue(mountainSlider, mountainRandom);\n+    byte rampDensity = getSliderValue(rampSlider, rampRandom);\n+    return new byte[]{spawnCount, landDensity, plateauDensity, mountainDensity, rampDensity};\n+  }\n+\n+  public void onCloseButtonClicked() {\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  public void onGenerateMapButtonClicked() {\n+    onGenerateMap();\n+  }\n+\n+  public void onGenerateMap() {\n+      if (!previousMapName.getText().isEmpty()) {\n+        mapGeneratorService.generateMap(previousMapName.getText())\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            });\n+      } else {\n+        byte[] optionArray = getOptionArray();\n+        mapGeneratorService.generateMap(optionArray)\n+            .thenAccept(mapName -> Platform.runLater(() -> {\n+              createGameController.initMapSelection();\n+              createGameController.mapListView.getItems().stream()\n+                  .filter(mapBean -> mapBean.getFolderName().equalsIgnoreCase(mapName))\n+                  .findAny().ifPresent(mapBean -> {\n+                createGameController.mapListView.getSelectionModel().select(mapBean);\n+                createGameController.mapListView.scrollTo(mapBean);\n+                createGameController.setSelectedMap(mapBean);\n+              });\n+            }))\n+            .exceptionally(throwable -> {\n+              handleGenerationException(throwable);\n+              return null;\n+            });\n+      }\n+    onCloseButtonClickedListener.run();\n+  }\n+\n+  private void handleGenerationException(Throwable e) {\n+    Throwable cause = e.getCause();\n+    if (cause instanceof IllegalArgumentException) {\n+      String msg = cause.getMessage();\n+      if (msg.startsWith(\"New Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooNewVersion\");\n+        log.warn(\"Map generation failed\", cause);\n+      } else if (msg.startsWith(\"Old Version\")) {\n+        notificationService.addImmediateErrorNotification(cause, \"mapGenerator.tooOldVersion\");\n+        log.warn(\"Map generation failed\", cause);\n+      } else {\n+        notificationService.addImmediateErrorNotification(e, \"mapGenerator.generationFailed\");\n+        log.warn(\"Map generation failed\", e);\n+      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0Mzk0Nw=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 219}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkyNTI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/GithubGeneratorRelease.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1Mjo1NVrOGvxU5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDo1NVrOGv0S1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NDQyMA==", "bodyText": "Don't break the Java naming convention\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private String tag_name;\n          \n          \n            \n              @JsonProperty(\"tag_name\")\n          \n          \n            \n              private String tagName;", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452744420", "createdAt": "2020-07-10T09:52:55Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/GithubGeneratorRelease.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.faforever.client.map.generator;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import lombok.Data;\n+\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+@Data\n+public class GithubGeneratorRelease {\n+  private String tag_name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzA0NQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793045", "createdAt": "2020-07-10T11:44:55Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/GithubGeneratorRelease.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.faforever.client.map.generator;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import lombok.Data;\n+\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+@Data\n+public class GithubGeneratorRelease {\n+  private String tag_name;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NDQyMA=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkzMDMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1NDozMlrOGvxYAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NTowMVrOGv0TBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NTIxOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                throw new RuntimeException(\"No Valid Generator Version Found\");\n          \n          \n            \n                throw new RuntimeException(\"No valid generator version found\");", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452745218", "createdAt": "2020-07-10T09:54:32Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzA5Mg==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793092", "createdAt": "2020-07-10T11:45:01Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NTIxOA=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkzNjkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1NjozMlrOGvxcDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NTowN1rOGv0TNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NjI1Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  CompletableFuture<String> errorFuture = new CompletableFuture<>();\n          \n          \n            \n                  errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n          \n          \n            \n                  return errorFuture;\n          \n          \n            \n                  return CompletableFuture.failedFuture(new IllegalArgumentException(\"Map name is not a generated map\"));", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452746252", "createdAt": "2020-07-10T09:56:32Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzE0Mg==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793142", "createdAt": "2020-07-10T11:45:07Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NjI1Mg=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkzODU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1NzoxMFrOGvxdJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NToxNFrOGv0Tbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NjUzMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  CompletableFuture<String> errorFuture = new CompletableFuture<>();\n          \n          \n            \n                  errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n          \n          \n            \n                  return errorFuture;\n          \n          \n            \n                  return CompletableFuture.failedFuture(new IllegalArgumentException(\"New version not supported\"));", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452746533", "createdAt": "2020-07-10T09:57:10Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MzE5OA==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452793198", "createdAt": "2020-07-10T11:45:14Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NjUzMw=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjkzOTcyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1NzozMVrOGvxd3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDoyNFrOGv0SJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NjcxOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                   CompletableFuture<String> errorFuture = new CompletableFuture<>();\n          \n          \n            \n                   errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n          \n          \n            \n                   return errorFuture;\n          \n          \n            \n                  return CompletableFuture.failedFuture(new IllegalArgumentException(\"Old Version not supported\"));", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452746718", "createdAt": "2020-07-10T09:57:31Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 159}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5Mjg2OQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452792869", "createdAt": "2020-07-10T11:44:24Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NjcxOA=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 159}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjk0MjU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1ODoyOFrOGvxftQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDoyMlrOGv0SEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzE4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    CompletableFuture<String> errorFuture = new CompletableFuture<>();\n          \n          \n            \n                    errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n          \n          \n            \n                    return errorFuture;\n          \n          \n            \n                    return CompletableFuture.failedFuture(new RuntimeException(\"Unsupported generator version: \" + version));", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452747189", "createdAt": "2020-07-10T09:58:28Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;\n+    }\n     String generatorExecutableFileName = String.format(GENERATOR_EXECUTABLE_FILENAME, version);\n     Path generatorExecutablePath = this.generatorExecutablePath.resolve(generatorExecutableFileName);\n \n     CompletableFuture<Void> downloadGeneratorFuture;\n     if (!Files.exists(generatorExecutablePath)) {\n-      if (!VERSION_PATTERN.matcher(version).matches()) {\n-        log.error(\"Unsupported generator version: {}\", version);\n-        return CompletableFuture.supplyAsync(() -> {\n-          throw new RuntimeException(\"Unsupported generator version: \" + version);\n-        });\n+      if (!VERSION_PATTERN.matcher(version.toString()).matches()) {\n+        log.warn(\"Unsupported generator version: {}\", version);\n+        CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+        errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n+        return errorFuture;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5Mjg1MQ==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452792851", "createdAt": "2020-07-10T11:44:22Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;\n+    }\n     String generatorExecutableFileName = String.format(GENERATOR_EXECUTABLE_FILENAME, version);\n     Path generatorExecutablePath = this.generatorExecutablePath.resolve(generatorExecutableFileName);\n \n     CompletableFuture<Void> downloadGeneratorFuture;\n     if (!Files.exists(generatorExecutablePath)) {\n-      if (!VERSION_PATTERN.matcher(version).matches()) {\n-        log.error(\"Unsupported generator version: {}\", version);\n-        return CompletableFuture.supplyAsync(() -> {\n-          throw new RuntimeException(\"Unsupported generator version: \" + version);\n-        });\n+      if (!VERSION_PATTERN.matcher(version.toString()).matches()) {\n+        log.warn(\"Unsupported generator version: {}\", version);\n+        CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+        errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n+        return errorFuture;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzE4OQ=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 175}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjk0NDAzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1OTowMFrOGvxgkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDoxOVrOGv0R7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzQxMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                catch (NumberFormatException nfe) {\n          \n          \n            \n                } catch (NumberFormatException nfe) {", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452747410", "createdAt": "2020-07-10T09:59:00Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;\n+    }\n     String generatorExecutableFileName = String.format(GENERATOR_EXECUTABLE_FILENAME, version);\n     Path generatorExecutablePath = this.generatorExecutablePath.resolve(generatorExecutableFileName);\n \n     CompletableFuture<Void> downloadGeneratorFuture;\n     if (!Files.exists(generatorExecutablePath)) {\n-      if (!VERSION_PATTERN.matcher(version).matches()) {\n-        log.error(\"Unsupported generator version: {}\", version);\n-        return CompletableFuture.supplyAsync(() -> {\n-          throw new RuntimeException(\"Unsupported generator version: \" + version);\n-        });\n+      if (!VERSION_PATTERN.matcher(version.toString()).matches()) {\n+        log.warn(\"Unsupported generator version: {}\", version);\n+        CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+        errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n+        return errorFuture;\n       }\n \n       log.info(\"Downloading MapGenerator version: {}\", version);\n       DownloadMapGeneratorTask downloadMapGeneratorTask = applicationContext.getBean(DownloadMapGeneratorTask.class);\n-      downloadMapGeneratorTask.setVersion(version);\n+      downloadMapGeneratorTask.setVersion(version.toString());\n       downloadGeneratorFuture = taskService.submitTask(downloadMapGeneratorTask).getFuture();\n     } else {\n       log.info(\"Found MapGenerator version: {}\", version);\n       downloadGeneratorFuture = CompletableFuture.completedFuture(null);\n     }\n \n-    String mapFilename = String.format(GENERATED_MAP_NAME, version, seed);\n+    String[] seedParts = seedAndOptions.split(\"_\");\n+    String seedString = seedParts[0];\n+\n+    String mapFilename;\n+    String seed;\n+\n+    try {\n+      seed = Long.toString(Long.parseLong(seedString));\n+    }\n+    catch (NumberFormatException nfe) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 198}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5MjgxMg==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452792812", "createdAt": "2020-07-10T11:44:19Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;\n+    }\n     String generatorExecutableFileName = String.format(GENERATOR_EXECUTABLE_FILENAME, version);\n     Path generatorExecutablePath = this.generatorExecutablePath.resolve(generatorExecutableFileName);\n \n     CompletableFuture<Void> downloadGeneratorFuture;\n     if (!Files.exists(generatorExecutablePath)) {\n-      if (!VERSION_PATTERN.matcher(version).matches()) {\n-        log.error(\"Unsupported generator version: {}\", version);\n-        return CompletableFuture.supplyAsync(() -> {\n-          throw new RuntimeException(\"Unsupported generator version: \" + version);\n-        });\n+      if (!VERSION_PATTERN.matcher(version.toString()).matches()) {\n+        log.warn(\"Unsupported generator version: {}\", version);\n+        CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+        errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n+        return errorFuture;\n       }\n \n       log.info(\"Downloading MapGenerator version: {}\", version);\n       DownloadMapGeneratorTask downloadMapGeneratorTask = applicationContext.getBean(DownloadMapGeneratorTask.class);\n-      downloadMapGeneratorTask.setVersion(version);\n+      downloadMapGeneratorTask.setVersion(version.toString());\n       downloadGeneratorFuture = taskService.submitTask(downloadMapGeneratorTask).getFuture();\n     } else {\n       log.info(\"Found MapGenerator version: {}\", version);\n       downloadGeneratorFuture = CompletableFuture.completedFuture(null);\n     }\n \n-    String mapFilename = String.format(GENERATED_MAP_NAME, version, seed);\n+    String[] seedParts = seedAndOptions.split(\"_\");\n+    String seedString = seedParts[0];\n+\n+    String mapFilename;\n+    String seed;\n+\n+    try {\n+      seed = Long.toString(Long.parseLong(seedString));\n+    }\n+    catch (NumberFormatException nfe) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzQxMA=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 198}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjk0NTYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTo1OToyOVrOGvxhkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDoxN1rOGv0R3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzY2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                else {\n          \n          \n            \n                } else {\n          \n      \n    \n    \n  \n\nPlease make sure that auto-formatting is enabled", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452747666", "createdAt": "2020-07-10T09:59:29Z", "author": {"login": "micheljung"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;\n+    }\n     String generatorExecutableFileName = String.format(GENERATOR_EXECUTABLE_FILENAME, version);\n     Path generatorExecutablePath = this.generatorExecutablePath.resolve(generatorExecutableFileName);\n \n     CompletableFuture<Void> downloadGeneratorFuture;\n     if (!Files.exists(generatorExecutablePath)) {\n-      if (!VERSION_PATTERN.matcher(version).matches()) {\n-        log.error(\"Unsupported generator version: {}\", version);\n-        return CompletableFuture.supplyAsync(() -> {\n-          throw new RuntimeException(\"Unsupported generator version: \" + version);\n-        });\n+      if (!VERSION_PATTERN.matcher(version.toString()).matches()) {\n+        log.warn(\"Unsupported generator version: {}\", version);\n+        CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+        errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n+        return errorFuture;\n       }\n \n       log.info(\"Downloading MapGenerator version: {}\", version);\n       DownloadMapGeneratorTask downloadMapGeneratorTask = applicationContext.getBean(DownloadMapGeneratorTask.class);\n-      downloadMapGeneratorTask.setVersion(version);\n+      downloadMapGeneratorTask.setVersion(version.toString());\n       downloadGeneratorFuture = taskService.submitTask(downloadMapGeneratorTask).getFuture();\n     } else {\n       log.info(\"Found MapGenerator version: {}\", version);\n       downloadGeneratorFuture = CompletableFuture.completedFuture(null);\n     }\n \n-    String mapFilename = String.format(GENERATED_MAP_NAME, version, seed);\n+    String[] seedParts = seedAndOptions.split(\"_\");\n+    String seedString = seedParts[0];\n+\n+    String mapFilename;\n+    String seed;\n+\n+    try {\n+      seed = Long.toString(Long.parseLong(seedString));\n+    }\n+    catch (NumberFormatException nfe) {\n+      byte[] seedBytes = Base64.getDecoder().decode(seedString);\n+      ByteBuffer seedWrapper = ByteBuffer.wrap(seedBytes);\n+      seed = Long.toString(seedWrapper.getLong());\n+    }\n+\n+    // Check if major version 0 which requires numeric seed\n+    if (version.compareTo(new ComparableVersion(\"1\")) < 0) {\n+      mapFilename = String.format(GENERATED_MAP_NAME, version, seed).replace('/','^');\n+    }\n+    else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5Mjc5Ng==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452792796", "createdAt": "2020-07-10T11:44:17Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/map/generator/MapGeneratorService.java", "diffHunk": "@@ -107,62 +115,128 @@ private void deleteGeneratedMaps() {\n     }\n   }\n \n-\n   public CompletableFuture<String> generateMap() {\n-    return generateMap(queryNewestVersion(), seedGenerator.nextLong());\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    return generateMap(generatorVersion, seedString);\n+  }\n+\n+  public CompletableFuture<String> generateMap(byte[] optionArray) {\n+    return generateMap(generatorVersion, optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(String version, byte[] optionArray) {\n+    return generateMap(new ComparableVersion(version), optionArray);\n+  }\n+\n+  public CompletableFuture<String> generateMap(ComparableVersion version, byte[] optionArray) {\n+    ByteBuffer seedBuffer = ByteBuffer.allocate(8);\n+    seedBuffer.putLong(seedGenerator.nextLong());\n+    String seedString = Base64.getEncoder().encodeToString(seedBuffer.array());\n+    String optionString = Base64.getEncoder().encodeToString(optionArray);\n+    return generateMap(version, seedString + '_' + optionString);\n   }\n \n   @VisibleForTesting\n-  protected String queryNewestVersion() {\n+  @Cacheable(CacheNames.MAP_GENERATOR)\n+  public ComparableVersion queryMaxSupportedVersion() {\n+    ComparableVersion version = new ComparableVersion(\"\");\n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+\n     RestTemplate restTemplate = new RestTemplate();\n \n     LinkedMultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n     headers.add(\"Accept\", \"application/vnd.github.v3+json\");\n     HttpEntity<String> entity = new HttpEntity<>(null, headers);\n \n-    ResponseEntity<String> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryLatestVersionUrl(), HttpMethod.GET, entity, String.class);\n-    JsonElement jsonElement = new JsonParser().parse(response.getBody());\n-    JsonObject mainObject = jsonElement.getAsJsonObject();\n-\n-    return mainObject.get(\"tag_name\").getAsString();\n+    ResponseEntity<List<GithubGeneratorRelease>> response = restTemplate.exchange(clientProperties.getMapGenerator().getQueryVersionsUrl(), HttpMethod.GET, entity, new ParameterizedTypeReference<>() {\n+    });\n+    List<GithubGeneratorRelease> releases = response.getBody();\n+    for (GithubGeneratorRelease release : releases) {\n+      version.parseVersion(release.getTag_name());\n+      if (version.compareTo(maxVersion) < 0 && minVersion.compareTo(version) < 0) {\n+        return version;\n+      }\n+    }\n+    throw new RuntimeException(\"No Valid Generator Version Found\");\n   }\n \n   public CompletableFuture<String> generateMap(String mapName) {\n     Matcher matcher = GENERATED_MAP_PATTERN.matcher(mapName);\n     if (!matcher.find()) {\n-      throw new IllegalArgumentException(\"Map name is not a generated map\");\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"Map name is not a generated map\"));\n+      return errorFuture;\n     }\n-    return generateMap(matcher.group(1), Long.parseLong(matcher.group(2)));\n+    return generateMap(matcher.group(1), matcher.group(2));\n   }\n \n+  public CompletableFuture<String> generateMap(String version, String seedAndOptions) {\n+    return generateMap(new ComparableVersion(version), seedAndOptions);\n+  }\n \n-  public CompletableFuture<String> generateMap(String version, long seed) {\n+  public CompletableFuture<String> generateMap(ComparableVersion version, String seedAndOptions) {\n \n+    ComparableVersion minVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMinSupportedMajorVersion()));\n+    ComparableVersion maxVersion = new ComparableVersion(String.valueOf(clientProperties.getMapGenerator().getMaxSupportedMajorVersion() + 1));\n+    if (version.compareTo(maxVersion) >= 0) {\n+      CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+      errorFuture.completeExceptionally(new IllegalArgumentException(\"New Version not supported\"));\n+      return errorFuture;\n+    }\n+    if (version.compareTo(minVersion) < 0) {\n+       CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+       errorFuture.completeExceptionally(new IllegalArgumentException(\"Old Version not supported\"));\n+       return errorFuture;\n+    }\n     String generatorExecutableFileName = String.format(GENERATOR_EXECUTABLE_FILENAME, version);\n     Path generatorExecutablePath = this.generatorExecutablePath.resolve(generatorExecutableFileName);\n \n     CompletableFuture<Void> downloadGeneratorFuture;\n     if (!Files.exists(generatorExecutablePath)) {\n-      if (!VERSION_PATTERN.matcher(version).matches()) {\n-        log.error(\"Unsupported generator version: {}\", version);\n-        return CompletableFuture.supplyAsync(() -> {\n-          throw new RuntimeException(\"Unsupported generator version: \" + version);\n-        });\n+      if (!VERSION_PATTERN.matcher(version.toString()).matches()) {\n+        log.warn(\"Unsupported generator version: {}\", version);\n+        CompletableFuture<String> errorFuture = new CompletableFuture<>();\n+        errorFuture.completeExceptionally(new RuntimeException(\"Unsupported generator version: \" + version));\n+        return errorFuture;\n       }\n \n       log.info(\"Downloading MapGenerator version: {}\", version);\n       DownloadMapGeneratorTask downloadMapGeneratorTask = applicationContext.getBean(DownloadMapGeneratorTask.class);\n-      downloadMapGeneratorTask.setVersion(version);\n+      downloadMapGeneratorTask.setVersion(version.toString());\n       downloadGeneratorFuture = taskService.submitTask(downloadMapGeneratorTask).getFuture();\n     } else {\n       log.info(\"Found MapGenerator version: {}\", version);\n       downloadGeneratorFuture = CompletableFuture.completedFuture(null);\n     }\n \n-    String mapFilename = String.format(GENERATED_MAP_NAME, version, seed);\n+    String[] seedParts = seedAndOptions.split(\"_\");\n+    String seedString = seedParts[0];\n+\n+    String mapFilename;\n+    String seed;\n+\n+    try {\n+      seed = Long.toString(Long.parseLong(seedString));\n+    }\n+    catch (NumberFormatException nfe) {\n+      byte[] seedBytes = Base64.getDecoder().decode(seedString);\n+      ByteBuffer seedWrapper = ByteBuffer.wrap(seedBytes);\n+      seed = Long.toString(seedWrapper.getLong());\n+    }\n+\n+    // Check if major version 0 which requires numeric seed\n+    if (version.compareTo(new ComparableVersion(\"1\")) < 0) {\n+      mapFilename = String.format(GENERATED_MAP_NAME, version, seed).replace('/','^');\n+    }\n+    else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzY2Ng=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 208}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjk1Mjg5OnYy", "diffSide": "RIGHT", "path": "src/main/resources/i18n/messages.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMDowMToyOVrOGvxl4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMTo0NDoxNFrOGv0Ruw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0ODc2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            mapGenerator.tooNewVersion=This client does not support this version of map generator. Please update client to use this version.\n          \n          \n            \n            mapGenerator.tooNewVersion=This client does not support this version of the map generator. Please update the client to use this version.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452748768", "createdAt": "2020-07-10T10:01:29Z", "author": {"login": "micheljung"}, "path": "src/main/resources/i18n/messages.properties", "diffHunk": "@@ -733,6 +744,8 @@ replay.couldNotOpen=Replay with id ''{0}'' , could not be opened.\n error.game.notTerminatedCorrectly=The game did not terminate correctly and has still certain files open. Some files from the installed game could not be copied over to FAF but unless you recently modified game files in the installed version you probably do not care. We are still starting the game for you.\n map.id=#{0}\n mapGenerator.generationFailed=There was an error during map generation\n+mapGenerator.tooNewVersion=This client does not support this version of map generator. Please update client to use this version.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc5Mjc2Mw==", "bodyText": "Done", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r452792763", "createdAt": "2020-07-10T11:44:14Z", "author": {"login": "Sheikah45"}, "path": "src/main/resources/i18n/messages.properties", "diffHunk": "@@ -733,6 +744,8 @@ replay.couldNotOpen=Replay with id ''{0}'' , could not be opened.\n error.game.notTerminatedCorrectly=The game did not terminate correctly and has still certain files open. Some files from the installed game could not be copied over to FAF but unless you recently modified game files in the installed version you probably do not care. We are still starting the game for you.\n map.id=#{0}\n mapGenerator.generationFailed=There was an error during map generation\n+mapGenerator.tooNewVersion=This client does not support this version of map generator. Please update client to use this version.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0ODc2OA=="}, "originalCommit": {"oid": "ad111030f097fefa0c5b5f827bbb86eb42660c52"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTcxOTQyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwODoyMTowMFrOGwLY5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxMDozOToyMVrOGwMCtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTQzMQ==", "bodyText": "If you do this to be able to test this. Make it package private instead and annotate with @VisibleForTesting", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r453171431", "createdAt": "2020-07-11T08:21:00Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -259,7 +260,7 @@ private void initMapSelection() {\n     mapListView.getSelectionModel().selectedItemProperty().addListener((observable, oldValue, newValue) -> Platform.runLater(() -> setSelectedMap(newValue)));\n   }\n \n-  private void setSelectedMap(MapBean newValue) {\n+  protected void setSelectedMap(MapBean newValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab84c401a60d7ad5e3f1c5a4326677af3cc45878"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MjEzMg==", "bodyText": "It was changed to protected so that GenerateMapController could set the map selection after generating the map in its futures.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1803#discussion_r453182132", "createdAt": "2020-07-11T10:39:21Z", "author": {"login": "Sheikah45"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -259,7 +260,7 @@ private void initMapSelection() {\n     mapListView.getSelectionModel().selectedItemProperty().addListener((observable, oldValue, newValue) -> Platform.runLater(() -> setSelectedMap(newValue)));\n   }\n \n-  private void setSelectedMap(MapBean newValue) {\n+  protected void setSelectedMap(MapBean newValue) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3MTQzMQ=="}, "originalCommit": {"oid": "ab84c401a60d7ad5e3f1c5a4326677af3cc45878"}, "originalPosition": 83}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2040, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}