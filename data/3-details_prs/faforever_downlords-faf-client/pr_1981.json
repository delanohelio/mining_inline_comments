{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNzg1MzM3", "number": 1981, "title": "1967 ratings", "bodyText": "Pull request to use the new ranking properties from the server. Issue number is #1967", "createdAt": "2020-10-12T20:04:49Z", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981", "merged": true, "mergeCommit": {"oid": "d9e27c75d9fb61cf221825e89c31c174be991d7f"}, "closed": true, "closedAt": "2020-10-18T19:11:48Z", "author": {"login": "chrsin"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRP06TgH2gAyNTAxNzg1MzM3OmFmMjNmOGY2ODljNjJkMGZiYTZhOWZiZWIyNTViZjU2MzZkMmIzNmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdT0fHngFqTUxMTE3MjkyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af23f8f689c62d0fba6a9fbeb255bf5636d2b36f", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/af23f8f689c62d0fba6a9fbeb255bf5636d2b36f", "committedDate": "2020-10-10T19:20:19Z", "message": "#1967 Implemented game list filtering based on the rating."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf7b11edcf625249bda0e4141c874364555f31da", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/bf7b11edcf625249bda0e4141c874364555f31da", "committedDate": "2020-10-12T12:31:05Z", "message": "#1967 First stab at implementing ratings using the new server model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a8c2b1a42abf14a1b7443d02acee33d5b1377d", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/88a8c2b1a42abf14a1b7443d02acee33d5b1377d", "committedDate": "2020-10-12T19:32:26Z", "message": "#1967 Added the rating information to the new game creation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "committedDate": "2020-10-12T20:00:53Z", "message": "#1967 Removed the new localizations from other countries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjI3NDcz", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#pullrequestreview-507227473", "createdAt": "2020-10-13T09:10:57Z", "commit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOToxMDo1OFrOHgdCsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOToxMDo1OFrOHgdCsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5MjMwNQ==", "bodyText": "There are also negative Ratings!", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r503792305", "createdAt": "2020-10-13T09:10:58Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -386,13 +387,30 @@ public void onCreateButtonClicked() {\n         .map(ModVersion::getUid)\n         .collect(Collectors.toSet());\n \n+    int minRating = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzgxMTg4", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#pullrequestreview-509381188", "createdAt": "2020-10-15T13:31:14Z", "commit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzozMToxNFrOHiH8IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzozNjowNVrOHiIKGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0MzcxMw==", "bodyText": "constants like 0 and 3000 need to go away... should be something like null, null", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505543713", "createdAt": "2020-10-15T13:31:14Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/coop/CoopController.java", "diffHunk": "@@ -267,7 +267,10 @@ public void onPlayButtonClicked() {\n     modService.getFeaturedMod(COOP.getTechnicalName())\n         .thenAccept(featuredModBean -> gameService.hostGame(new NewGameInfo(titleTextField.getText(),\n             Strings.emptyToNull(passwordTextField.getText()), featuredModBean, getSelectedMission().getMapFolderName(),\n-            emptySet())));\n+            emptySet(),\n+            0, //Rating isn't interesting for coop games\n+            3000,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NDU2MA==", "bodyText": "rating range is -invinity to +invinity", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505544560", "createdAt": "2020-10-15T13:32:25Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -386,13 +387,30 @@ public void onCreateButtonClicked() {\n         .map(ModVersion::getUid)\n         .collect(Collectors.toSet());\n \n+    int minRating = 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5MjMwNQ=="}, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NDYwNQ==", "bodyText": "Nowhere should constants be found that imply a max or a min rating.... There is no max and no min rating. If no max rating is set then there is no max rating....", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505544605", "createdAt": "2020-10-15T13:32:27Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -386,13 +387,30 @@ public void onCreateButtonClicked() {\n         .map(ModVersion::getUid)\n         .collect(Collectors.toSet());\n \n+    int minRating = 0;\n+    int maxRating = 3000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NTg1NQ==", "bodyText": "{} always for code style reasons", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505545855", "createdAt": "2020-10-15T13:34:16Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GameRangePredicate.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import com.faforever.client.util.RatingUtil;\n+\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+\n+public class GameRangePredicate implements Predicate<Game> {\n+  private final Optional<Player> player;\n+\n+  public GameRangePredicate(Optional<Player> player) {\n+    this.player = player;\n+  }\n+\n+  @Override\n+  public boolean test(Game game) {\n+    if(!player.isPresent() || !game.getEnforceRating())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NjM3NA==", "bodyText": "null checks!!!!", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505546374", "createdAt": "2020-10-15T13:34:56Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GameRangePredicate.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import com.faforever.client.util.RatingUtil;\n+\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+\n+public class GameRangePredicate implements Predicate<Game> {\n+  private final Optional<Player> player;\n+\n+  public GameRangePredicate(Optional<Player> player) {\n+    this.player = player;\n+  }\n+\n+  @Override\n+  public boolean test(Game game) {\n+    if(!player.isPresent() || !game.getEnforceRating())\n+      return true;\n+\n+    float rating = RatingUtil.getGlobalRating(player.get());\n+    return game.getMaxRating() >= rating && game.getMinRating() <= rating;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NjkxOQ==", "bodyText": "use Integer so you can set it to null", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505546919", "createdAt": "2020-10-15T13:35:36Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/NewGameInfo.java", "diffHunk": "@@ -17,8 +17,11 @@\n   private String map;\n   private Set<String> simMods;\n   private GameVisibility gameVisibility;\n+  private Integer ratingMin;\n+  private Integer ratingMax;\n+  private Boolean enforceRatingRange;\n \n-  public NewGameInfo(String title, String password, FeaturedMod featuredMod, String map, Set<String> simMods) {\n-    this(title, password, featuredMod, map, simMods, GameVisibility.PUBLIC);\n+  public NewGameInfo(String title, String password, FeaturedMod featuredMod, String map, Set<String> simMods, int minRating, int maxRating, boolean enforceRating) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NzI4OQ==", "bodyText": "I think there is a PlayerBuilder", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505547289", "createdAt": "2020-10-15T13:36:05Z", "author": {"login": "1-alex98"}, "path": "src/test/java/com/faforever/client/game/GameRangePredicateTest.java", "diffHunk": "@@ -0,0 +1,130 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class GameRangePredicateTest {\n+\n+  private Player validPlayer;\n+  private GameRangePredicate predicate;\n+  private Game game;\n+\n+  @Before\n+  public void setUp() {\n+    validPlayer = new Player(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fe22cec8d4981e18641a455a43e53ea592c1f64", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/2fe22cec8d4981e18641a455a43e53ea592c1f64", "committedDate": "2020-10-17T12:05:01Z", "message": "#1967 Made the rankings optional. If null is supplied no rating is requested."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5", "committedDate": "2020-10-17T21:35:26Z", "message": "#1967 Made the rating text field accept negative values."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDE3MDM5", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#pullrequestreview-511017039", "createdAt": "2020-10-17T21:41:34Z", "commit": {"oid": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTo0MTozNVrOHjgCFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTo0MzozOFrOHjgCsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzAzMQ==", "bodyText": "No filtering needs to be done !!! The server already filters the game so they fit your rating. If the rating it not enforced the games are not filtered by the server and the rating only acts as a description.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506987031", "createdAt": "2020-10-17T21:41:35Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/CustomGamesController.java", "diffHunk": "@@ -179,9 +185,11 @@ private void updateFilteredItems() {\n     boolean showPasswordProtectedGames = showPasswordProtectedGamesCheckBox.isSelected();\n     boolean showModdedGames = showModdedGamesCheckBox.isSelected();\n \n-    filteredItems.setPredicate(OPEN_CUSTOM_GAMES_PREDICATE.and(gameInfoBean ->\n-        (showPasswordProtectedGames || !gameInfoBean.isPasswordProtected())\n-            && (showModdedGames || gameInfoBean.getSimMods().isEmpty())));\n+    filteredItems.setPredicate(OPEN_CUSTOM_GAMES_PREDICATE\n+        .and(gameInfoBean ->\n+            (showPasswordProtectedGames || !gameInfoBean.isPasswordProtected())\n+                && (showModdedGames || gameInfoBean.getSimMods().isEmpty()))\n+        .and(rangePredicate));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzEwNw==", "bodyText": "this is already done by the server", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506987107", "createdAt": "2020-10-17T21:42:17Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/game/GameRangePredicate.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import com.faforever.client.util.RatingUtil;\n+\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+\n+public class GameRangePredicate implements Predicate<Game> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzE4Nw==", "bodyText": "no commented out code", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506987187", "createdAt": "2020-10-17T21:43:38Z", "author": {"login": "1-alex98"}, "path": "src/main/resources/theme/play/create_game.fxml", "diffHunk": "@@ -35,19 +35,19 @@\n         <RowConstraints vgrow=\"NEVER\" />\n     </rowConstraints>\n     <children>\n-    \n     \t<!-- Title, Password, Rating -->\n         <TextField fx:id=\"titleTextField\" promptText=\"%game.create.title\" styleClass=\"game-title-input\" GridPane.columnSpan=\"2147483647\" />\n         <PasswordField fx:id=\"passwordTextField\" promptText=\"%game.create.password\" GridPane.rowIndex=\"1\" />\n         <CheckBox fx:id=\"onlyForFriendsCheckBox\" mnemonicParsing=\"false\" text=\"%game.create.onlyFriends\" GridPane.columnIndex=\"1\" GridPane.rowIndex=\"1\" />\n-        <Label alignment=\"CENTER_RIGHT\" maxWidth=\"1.7976931348623157E308\" text=\"%game.create.rating\" textAlignment=\"JUSTIFY\" GridPane.columnIndex=\"2\" GridPane.rowIndex=\"1\" />\n-        <HBox alignment=\"CENTER\" maxWidth=\"1.7976931348623157E308\" spacing=\"10.0\" GridPane.columnIndex=\"3\" GridPane.columnSpan=\"2147483647\" GridPane.rowIndex=\"1\">\n+        <HBox alignment=\"CENTER_RIGHT\" spacing=\"10.0\" maxWidth=\"1.7976931348623157E308\" GridPane.columnIndex=\"2\" GridPane.columnSpan=\"2147483647\" GridPane.rowIndex=\"1\">\n             <children>\n+                <Label alignment=\"CENTER_RIGHT\" text=\"%game.create.rating\" textAlignment=\"JUSTIFY\" GridPane.columnIndex=\"2\" GridPane.rowIndex=\"1\" />\n                 <TextField fx:id=\"minRankingTextField\" minWidth=\"30.0\" prefWidth=\"60.0\" promptText=\"%games.create.minRating\" HBox.hgrow=\"NEVER\" />\n                 <Label text=\"%games.create.minRating\" />\n-                <Pane minHeight=\"0.0\" minWidth=\"0.0\" HBox.hgrow=\"ALWAYS\" />\n+<!--                <Pane minHeight=\"0.0\" minWidth=\"0.0\" HBox.hgrow=\"ALWAYS\" />-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2f864d0abec25f5fa88cec652b4fece5e66e04", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/3c2f864d0abec25f5fa88cec652b4fece5e66e04", "committedDate": "2020-10-18T17:45:45Z", "message": "#1967 Removed the unused GameRangePredicate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ce5e88ab90c971e2a682e45c3432e0247a6c90", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/01ce5e88ab90c971e2a682e45c3432e0247a6c90", "committedDate": "2020-10-18T18:03:45Z", "message": "Merge remote-tracking branch 'faf/develop' into 1967-ratings\n\n# Conflicts:\n#\tsrc/main/java/com/faforever/client/game/CustomGamesController.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94ef6fd67822f62688219a207963b949d56417c7", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/94ef6fd67822f62688219a207963b949d56417c7", "committedDate": "2020-10-18T18:19:30Z", "message": "#1967 Removed the constant values from the coop controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13214aad778cf5fd3af592e9852181431d197050", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/13214aad778cf5fd3af592e9852181431d197050", "committedDate": "2020-10-18T18:27:28Z", "message": "#1967 Fixed a nullref in the join game helper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e65c9302f2fa857941e77d0dfcb0f2f45434915", "author": {"user": {"login": "chrsin", "name": "Christian Sindberg"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/1e65c9302f2fa857941e77d0dfcb0f2f45434915", "committedDate": "2020-10-18T18:55:58Z", "message": "#1967 Added unit test for the makeNumeric method and removed the enforcerating from the Coop NewGameInfo constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46ef0c8919b2ce3861e160577443e7125f416e8c", "author": {"user": {"login": "1-alex98", "name": "Alexander von Trostorff"}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/46ef0c8919b2ce3861e160577443e7125f416e8c", "committedDate": "2020-10-18T19:08:38Z", "message": "Fix unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTcyOTI4", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#pullrequestreview-511172928", "createdAt": "2020-10-18T19:10:51Z", "commit": {"oid": "46ef0c8919b2ce3861e160577443e7125f416e8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3323, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}