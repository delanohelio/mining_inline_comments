{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NTgzNzMz", "number": 1882, "title": "Add in check for local preview for generated maps ", "bodyText": "Fixes #1881", "createdAt": "2020-09-03T12:07:01Z", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882", "merged": true, "mergeCommit": {"oid": "1eb0b5a324f8c341d8b5513b9d0274943546fa76"}, "closed": true, "closedAt": "2020-09-13T16:46:58Z", "author": {"login": "Sheikah45"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFPfSAAH2gAyNDc4NTgzNzMzOmFiMzdiYjBhMjhiZWJmMGNkMjE2OWVkYjMxNDgzZGExZmQ2NTZhMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIhcfcgFqTQ4NzMyMjYwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab37bb0a28bebf0cd2169edb31483da1fd656a32", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/ab37bb0a28bebf0cd2169edb31483da1fd656a32", "committedDate": "2020-09-03T12:09:36Z", "message": "Add in check for local preview for generated maps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbc399bdf5091a06bd98489493511e78edf72b5a", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/fbc399bdf5091a06bd98489493511e78edf72b5a", "committedDate": "2020-09-03T12:06:18Z", "message": "Add in check for maps added to directory to map directory watcher"}, "afterCommit": {"oid": "ab37bb0a28bebf0cd2169edb31483da1fd656a32", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/ab37bb0a28bebf0cd2169edb31483da1fd656a32", "committedDate": "2020-09-03T12:09:36Z", "message": "Add in check for local preview for generated maps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODkxNDEw", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#pullrequestreview-482891410", "createdAt": "2020-09-04T19:17:48Z", "commit": {"oid": "ab37bb0a28bebf0cd2169edb31483da1fd656a32"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToxNzo0OFrOHNZIXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToxOTowNlrOHNZKYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNTI3Nw==", "bodyText": "Just that you know I think having the random icon was a feature and was not done because guys that wrote it did not know how to fetch the preview...\nBut since you are the maintainer of map gen I leave it to u, just think about it that maybe having the mystery about how the map looks until you join might be interesting.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#discussion_r483805277", "createdAt": "2020-09-04T19:17:48Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/map/MapService.java", "diffHunk": "@@ -303,7 +306,12 @@ public MapBean readMap(Path mapFolder) throws MapLoadException {\n   @Cacheable(value = CacheNames.MAP_PREVIEW, unless = \"#result == null\")\n   public Image loadPreview(String mapName, PreviewSize previewSize) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab37bb0a28bebf0cd2169edb31483da1fd656a32"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNTc5NA==", "bodyText": "Why do we have an AWT image only to convert it to an java fx image later, makes little sense to me pls try do this the java fx way...", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#discussion_r483805794", "createdAt": "2020-09-04T19:19:06Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/map/MapService.java", "diffHunk": "@@ -303,7 +306,12 @@ public MapBean readMap(Path mapFolder) throws MapLoadException {\n   @Cacheable(value = CacheNames.MAP_PREVIEW, unless = \"#result == null\")\n   public Image loadPreview(String mapName, PreviewSize previewSize) {\n     if (mapGeneratorService.isGeneratedMap(mapName)) {\n-      return mapGeneratorService.getGeneratedMapPreviewImage();\n+      try {\n+        BufferedImage image = ImageIO.read(forgedAlliancePreferences.getCustomMapsDirectory().resolve(mapName).resolve(mapName + \"_preview.png\").toFile());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab37bb0a28bebf0cd2169edb31483da1fd656a32"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f259599994f49d090b2a192eac6aa09999a0f47c", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/f259599994f49d090b2a192eac6aa09999a0f47c", "committedDate": "2020-09-09T21:14:25Z", "message": "Use javafx image initially"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1Njg5MTYz", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#pullrequestreview-485689163", "createdAt": "2020-09-10T08:13:29Z", "commit": {"oid": "f259599994f49d090b2a192eac6aa09999a0f47c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODoxMzoyOVrOHPoQuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODoxMzoyOVrOHPoQuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE1MDMyOQ==", "bodyText": "Can u not do new Image(....getURL())", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#discussion_r486150329", "createdAt": "2020-09-10T08:13:29Z", "author": {"login": "1-alex98"}, "path": "src/main/java/com/faforever/client/map/MapService.java", "diffHunk": "@@ -303,7 +304,11 @@ public MapBean readMap(Path mapFolder) throws MapLoadException {\n   @Cacheable(value = CacheNames.MAP_PREVIEW, unless = \"#result == null\")\n   public Image loadPreview(String mapName, PreviewSize previewSize) {\n     if (mapGeneratorService.isGeneratedMap(mapName)) {\n-      return mapGeneratorService.getGeneratedMapPreviewImage();\n+      try {\n+        return new Image(new FileInputStream(forgedAlliancePreferences.getCustomMapsDirectory().resolve(mapName).resolve(mapName + \"_preview.png\").toFile()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f259599994f49d090b2a192eac6aa09999a0f47c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzI4NTE5", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#pullrequestreview-486328519", "createdAt": "2020-09-10T21:37:49Z", "commit": {"oid": "f259599994f49d090b2a192eac6aa09999a0f47c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMTozNzo0OVrOHQGo_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMTozNzo0OVrOHQGo_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY0ODA2MA==", "bodyText": "Hard to read. My proposal:\nPath previewPath = forgedAlliancePreferences.getCustomMapsDirectory().resolve(mapName).resolve(mapName + \"_preview.png\");\nreturn new Image(Files.newInputStream(previewPath));\n\nI'm also not totally sure when the exception would be thrown? If the file does not exist yet? That shouldn't be catched via try-catch but with Files.exists(previewPath) instead (-> never use Exceptions for control flow).\nIf it's used for anything else, please add a comment.", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#discussion_r486648060", "createdAt": "2020-09-10T21:37:49Z", "author": {"login": "Brutus5000"}, "path": "src/main/java/com/faforever/client/map/MapService.java", "diffHunk": "@@ -303,7 +304,11 @@ public MapBean readMap(Path mapFolder) throws MapLoadException {\n   @Cacheable(value = CacheNames.MAP_PREVIEW, unless = \"#result == null\")\n   public Image loadPreview(String mapName, PreviewSize previewSize) {\n     if (mapGeneratorService.isGeneratedMap(mapName)) {\n-      return mapGeneratorService.getGeneratedMapPreviewImage();\n+      try {\n+        return new Image(new FileInputStream(forgedAlliancePreferences.getCustomMapsDirectory().resolve(mapName).resolve(mapName + \"_preview.png\").toFile()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE1MDMyOQ=="}, "originalCommit": {"oid": "f259599994f49d090b2a192eac6aa09999a0f47c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8c456ab7f7eb4c525c59cb0afce06be2d0dbd0f", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/c8c456ab7f7eb4c525c59cb0afce06be2d0dbd0f", "committedDate": "2020-09-10T22:41:10Z", "message": "Improve readability"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f948d03da82c05ea51761a622fd1c797dd284acb", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/f948d03da82c05ea51761a622fd1c797dd284acb", "committedDate": "2020-09-10T22:02:51Z", "message": "Update Unit Test"}, "afterCommit": {"oid": "c8c456ab7f7eb4c525c59cb0afce06be2d0dbd0f", "author": {"user": {"login": "Sheikah45", "name": null}}, "url": "https://github.com/FAForever/downlords-faf-client/commit/c8c456ab7f7eb4c525c59cb0afce06be2d0dbd0f", "committedDate": "2020-09-10T22:41:10Z", "message": "Improve readability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODQ0ODUz", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#pullrequestreview-486844853", "createdAt": "2020-09-11T14:14:33Z", "commit": {"oid": "c8c456ab7f7eb4c525c59cb0afce06be2d0dbd0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzIyNjAw", "url": "https://github.com/FAForever/downlords-faf-client/pull/1882#pullrequestreview-487322600", "createdAt": "2020-09-13T16:46:37Z", "commit": {"oid": "c8c456ab7f7eb4c525c59cb0afce06be2d0dbd0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3282, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}