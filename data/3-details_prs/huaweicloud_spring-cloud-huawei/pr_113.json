{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMjQ1Mjgy", "number": 113, "title": "Optimize some codes", "bodyText": "", "createdAt": "2020-01-08T01:41:40Z", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113", "merged": true, "mergeCommit": {"oid": "2dd100260d83a55e18fd49859c48216813f2a6ee"}, "closed": true, "closedAt": "2020-01-10T08:09:20Z", "author": {"login": "AngLi2"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4LSl0gBqjI5Mjk2MTk4NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb41aJcgH2gAyMzYwMjQ1MjgyOmRiNTg1ZmJiNjYzM2U3ZjYxYWY1MTJjNTU3YjI2MzczN2I4ZjEzY2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2cee9915061ca49e2c7232dc410f09dc490160d", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/d2cee9915061ca49e2c7232dc410f09dc490160d", "committedDate": "2020-01-07T13:19:18Z", "message": "Optimize some codes"}, "afterCommit": {"oid": "71a18f32f4d7f99d772e4e23aff45992342f3877", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/71a18f32f4d7f99d772e4e23aff45992342f3877", "committedDate": "2020-01-08T01:43:41Z", "message": "Optimize some codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bb5a40696836f8770bd959d68ef5719e36a61d4", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/8bb5a40696836f8770bd959d68ef5719e36a61d4", "committedDate": "2020-01-08T01:48:52Z", "message": "Optimize some codes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71a18f32f4d7f99d772e4e23aff45992342f3877", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/71a18f32f4d7f99d772e4e23aff45992342f3877", "committedDate": "2020-01-08T01:43:41Z", "message": "Optimize some codes"}, "afterCommit": {"oid": "8bb5a40696836f8770bd959d68ef5719e36a61d4", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/8bb5a40696836f8770bd959d68ef5719e36a61d4", "committedDate": "2020-01-08T01:48:52Z", "message": "Optimize some codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082a09060b385778ffacec0e84cd84012d747bf3", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/082a09060b385778ffacec0e84cd84012d747bf3", "committedDate": "2020-01-08T02:16:54Z", "message": "Fix UT failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NjE1NzIz", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#pullrequestreview-339615723", "createdAt": "2020-01-08T02:17:55Z", "commit": {"oid": "8bb5a40696836f8770bd959d68ef5719e36a61d4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMjoxNzo1NlrOFbLKxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMjo1MDoxNVrOFbLhWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzODg1Mg==", "bodyText": "Is it better ?\nreturn serviceList ;", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#discussion_r364038852", "createdAt": "2020-01-08T02:17:56Z", "author": {"login": "GuoYL123"}, "path": "spring-cloud-huawei-servicecomb-discovery/src/main/java/com/huaweicloud/servicecomb/discovery/discovery/ServiceCombDiscoveryClient.java", "diffHunk": "@@ -73,6 +74,6 @@ public String description() {\n     } catch (ServiceCombException e) {\n       LOGGER.error(\"getServices failed\", e);\n     }\n-    return null;\n+    return Collections.emptyList();\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bb5a40696836f8770bd959d68ef5719e36a61d4"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA0Mjk5OA==", "bodyText": "you can delete it and ut, the code never reach", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#discussion_r364042998", "createdAt": "2020-01-08T02:41:01Z", "author": {"login": "GuoYL123"}, "path": "spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/util/URLUtil.java", "diffHunk": "@@ -45,7 +46,7 @@\n    */\n   public static String[] splitIpPort(String url) {\n     if (url == null) {\n-      return null;\n+      return new String[0];\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bb5a40696836f8770bd959d68ef5719e36a61d4"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA0NDYzNA==", "bodyText": "the method name getStrings  is meaningless, we can rename it to getEnvURL or something else.", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#discussion_r364044634", "createdAt": "2020-01-08T02:50:15Z", "author": {"login": "GuoYL123"}, "path": "spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/util/URLUtil.java", "diffHunk": "@@ -125,45 +126,38 @@ private static String removeSlash(String url) {\n     return url;\n   }\n \n-  public static List<String> dealMutiUrl(String urls) {\n+  public static List<String> dealMultiUrl(String urls) {\n     List<String> urlList = new ArrayList<>();\n     if (StringUtils.isEmpty(urls)) {\n       return urlList;\n     }\n     if (urls != null && urls.indexOf(\",\") > 0) {\n-      for (String url : urls.split(\",\")) {\n-        if (url != null && !url.isEmpty()) {\n-          urlList.add(url);\n-        }\n-      }\n+      Arrays.stream(urls.split(\",\"))\n+          .filter(url -> !StringUtils.isEmpty(url))\n+          .forEach(urlList::add);\n     } else {\n       urlList.add(urls);\n     }\n     return urlList;\n   }\n \n   public static List<String> getEnvConfigUrl() {\n-    SystemConfiguration sysConfig = new SystemConfiguration();\n-    EnvironmentConfiguration envConfig = new EnvironmentConfiguration();\n-    String sysURL = sysConfig.getString(SYSTEM_KEY_CONFIG_CENTER);\n-    String envURL = envConfig.getString(SYSTEM_KEY_CONFIG_CENTER);\n-    if (StringUtils.isEmpty(sysURL) && StringUtils.isEmpty(envURL)) {\n-      sysURL = sysConfig.getString(SYSTEM_KEY_BOTH);\n-      envURL = envConfig.getString(SYSTEM_KEY_BOTH);\n-    }\n-    return StringUtils.isEmpty(sysURL) ? dealMutiUrl(envURL) : dealMutiUrl(sysURL);\n+    return getStrings(SYSTEM_KEY_CONFIG_CENTER);\n   }\n \n   public static List<String> getEnvServerURL() {\n+    return getStrings(SYSTEM_KEY_SERVICE_CENTER);\n+  }\n+\n+  private static List<String> getStrings(String systemServer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bb5a40696836f8770bd959d68ef5719e36a61d4"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMjQ2MDYx", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#pullrequestreview-340246061", "createdAt": "2020-01-09T01:31:39Z", "commit": {"oid": "dad99a9eed443152fd876b40e349c2640f1d31b4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwMTozMTo0MFrOFboxng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwMTozMjozNVrOFboyVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUyMzkzNA==", "bodyText": "It seems not change. Is it necessary to delete {} ?", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#discussion_r364523934", "createdAt": "2020-01-09T01:31:40Z", "author": {"login": "GuoYL123"}, "path": "spring-cloud-huawei-swagger/src/main/java/com/huaweicloud/swagger/ServiceCombSwaggerHandlerImpl.java", "diffHunk": "@@ -113,19 +114,18 @@ public void init(String appName, String serviceName) {\n           }\n         });\n         if (withJavaChassis) {\n-          filteSwagger(temSwagger, fullClassName);\n+          filterSwagger(temSwagger, fullClassName);\n           if (CollectionUtils.isEmpty(temSwagger.getPaths())) {\n             continue;\n           }\n           //add text/plain for string\n           List contentTypeList = Arrays.asList(\"text/plain\", \"application/json\");\n-          temSwagger.getPaths().forEach((path, operation) -> {\n-            operation.getOperations().forEach(api -> {\n-              api.setConsumes(contentTypeList);\n-              api.setProduces(contentTypeList);\n-              api.setTags(Arrays.asList(className));\n-            });\n-          });\n+          temSwagger.getPaths().forEach((path, operation) ->\n+              operation.getOperations().forEach(api -> {\n+                api.setConsumes(contentTypeList);\n+                api.setProduces(contentTypeList);\n+                api.setTags(Arrays.asList(className));\n+              }));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dad99a9eed443152fd876b40e349c2640f1d31b4"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUyMzk2OA==", "bodyText": "the same as above", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#discussion_r364523968", "createdAt": "2020-01-09T01:31:52Z", "author": {"login": "GuoYL123"}, "path": "spring-cloud-huawei-swagger/src/main/java/com/huaweicloud/swagger/ServiceCombSwaggerHandlerImpl.java", "diffHunk": "@@ -161,21 +161,19 @@ public void registerSwagger(String microserviceId, List<String> schemaIds) {\n    * @param temSwagger\n    * @param className\n    */\n-  private void filteSwagger(Swagger temSwagger, String className) {\n+  private void filterSwagger(Swagger temSwagger, String className) {\n     Set<String> abandonedList = new HashSet<>();\n     Set<String> methodFilter = new HashSet<>();\n-    temSwagger.getPaths().forEach((k, v) -> {\n-      v.getOperations().forEach(method -> {\n-        String processOptId = method.getOperationId();\n-        processOptId = processOptId.substring(0, processOptId.indexOf(\"Using\"));\n-        if (methodFilter.contains(processOptId)) {\n-          abandonedList.add(k);\n-          return;\n-        }\n-        methodFilter.add(processOptId);\n-        method.setOperationId(processOptId);\n-      });\n-    });\n+    temSwagger.getPaths().forEach((k, v) -> v.getOperations().forEach(method -> {\n+      String processOptId = method.getOperationId();\n+      processOptId = processOptId.substring(0, processOptId.indexOf(\"Using\"));\n+      if (methodFilter.contains(processOptId)) {\n+        abandonedList.add(k);\n+        return;\n+      }\n+      methodFilter.add(processOptId);\n+      method.setOperationId(processOptId);\n+    }));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dad99a9eed443152fd876b40e349c2640f1d31b4"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUyNDExNw==", "bodyText": "the same as above", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/113#discussion_r364524117", "createdAt": "2020-01-09T01:32:35Z", "author": {"login": "GuoYL123"}, "path": "spring-cloud-huawei-swagger/src/main/java/com/huaweicloud/swagger/ServiceCombSwaggerHandlerImpl.java", "diffHunk": "@@ -204,9 +202,7 @@ private void registerSwaggerSync(String microserviceId, List<String> schemaIds)\n   }\n \n   private void registerSwaggerAsync(String microserviceId, List<String> schemaIds) {\n-    Executors.newSingleThreadExecutor().execute(() -> {\n-      registerSwaggerSync(microserviceId, schemaIds);\n-    });\n+    Executors.newSingleThreadExecutor().execute(() -> registerSwaggerSync(microserviceId, schemaIds));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dad99a9eed443152fd876b40e349c2640f1d31b4"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd6aa5a2e8f9fa8b77057d78c217f131d581942b", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/dd6aa5a2e8f9fa8b77057d78c217f131d581942b", "committedDate": "2020-01-09T01:41:48Z", "message": "Modify codes according to code review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dad99a9eed443152fd876b40e349c2640f1d31b4", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/dad99a9eed443152fd876b40e349c2640f1d31b4", "committedDate": "2020-01-08T03:11:39Z", "message": "Modify codes according to code review suggestions"}, "afterCommit": {"oid": "dd6aa5a2e8f9fa8b77057d78c217f131d581942b", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/dd6aa5a2e8f9fa8b77057d78c217f131d581942b", "committedDate": "2020-01-09T01:41:48Z", "message": "Modify codes according to code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db585fbb6633e7f61af512c557b263737b8f13cc", "author": {"user": {"login": "AngLi2", "name": "Ang Li"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/db585fbb6633e7f61af512c557b263737b8f13cc", "committedDate": "2020-01-10T02:48:13Z", "message": "Fix according to review suggestions: start a new line in loop statements in lambdas"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1813, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}