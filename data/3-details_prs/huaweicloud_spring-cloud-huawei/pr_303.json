{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMTA4NjAx", "number": 303, "title": "[issue #302] fix rbac bug", "bodyText": "", "createdAt": "2020-12-01T08:11:07Z", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303", "merged": true, "mergeCommit": {"oid": "d8e1c97f92f92be24f23166f217ce270cf994c72"}, "closed": true, "closedAt": "2020-12-01T09:08:09Z", "author": {"login": "GuoYL123"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh1LZOgH2gAyNTMwMTA4NjAxOjRjNTgyM2VkOGFkNDJkOGE2NDJiNGE4MTE3ZGU1N2I0MDQ2ZTE1MDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh2C1FAFqTU0MTY3MDM2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c5823ed8ad42d8a642b4a8117de57b4046e1508", "author": {"user": {"login": "GuoYL123", "name": "GuoYL"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/4c5823ed8ad42d8a642b4a8117de57b4046e1508", "committedDate": "2020-12-01T07:54:09Z", "message": "[issue #302] fix rbac bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNjEwNTgy", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303#pullrequestreview-541610582", "createdAt": "2020-12-01T08:18:57Z", "commit": {"oid": "4c5823ed8ad42d8a642b4a8117de57b4046e1508"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwODoxODo1N1rOH8cq5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwODoxODo1N1rOH8cq5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE0NjM0Mw==", "bodyText": "\u6570\u5b57\u90fd\u5b9a\u4e49\u4e0b\u5e38\u91cf\u5427", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303#discussion_r533146343", "createdAt": "2020-12-01T08:18:57Z", "author": {"login": "tianxiaoliang"}, "path": "spring-cloud-huawei-common/src/main/java/com/huaweicloud/common/transport/DefaultHttpTransport.java", "diffHunk": "@@ -69,18 +72,26 @@\n \n   private HttpClient httpClient;\n \n+  private ServiceCombRBACProperties serviceCombRBACProperties;\n+\n+  private List<String> urlList;\n+\n+  private final TaskScheduler scheduler = new ConcurrentTaskScheduler(Executors.newSingleThreadScheduledExecutor());\n+\n   public void setRBACToken(ServiceCombRBACProperties serviceCombRBACProperties,\n       String urls) {\n     if (serviceCombRBACProperties == null ||\n         StringUtils.isEmpty(serviceCombRBACProperties.getName()) ||\n         StringUtils.isEmpty(serviceCombRBACProperties.getPassword())) {\n       return;\n     }\n-    List<String> urlList = URLUtil.dealMultiUrl(urls);\n-    getToken(serviceCombRBACProperties, urlList);\n+    this.urlList = URLUtil.dealMultiUrl(urls);\n+    this.serviceCombRBACProperties = serviceCombRBACProperties;\n+    // 30min token expire  /\n+    scheduler.scheduleWithFixedDelay(this::refreshToken, 28 * 60 * 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c5823ed8ad42d8a642b4a8117de57b4046e1508"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0aa512d91445c5fbae91c5241a70d0ca0d77be5", "author": {"user": {"login": "GuoYL123", "name": "GuoYL"}}, "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/f0aa512d91445c5fbae91c5241a70d0ca0d77be5", "committedDate": "2020-12-01T08:31:36Z", "message": "[issue #297] modify as comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNjcwMzY0", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/303#pullrequestreview-541670364", "createdAt": "2020-12-01T08:54:42Z", "commit": {"oid": "f0aa512d91445c5fbae91c5241a70d0ca0d77be5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1799, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}