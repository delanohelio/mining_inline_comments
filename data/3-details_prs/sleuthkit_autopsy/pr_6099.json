{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzNTM1NDM2", "number": 6099, "title": "6600 Text Detection Error", "bodyText": "", "createdAt": "2020-07-20T14:58:41Z", "url": "https://github.com/sleuthkit/autopsy/pull/6099", "merged": true, "mergeCommit": {"oid": "5fe9093d01cf5b19c565852ff52d77249618daa7"}, "closed": true, "closedAt": "2020-07-20T16:02:15Z", "author": {"login": "dannysmyda"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2y2yGgH2gAyNDUzNTM1NDM2OjA5NDBmZTk4Y2M3NTBhNWY1MGRhNDAyM2Y1NGRiMWU4MjY4MzNjNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2z0G6AFqTQ1MTc0NTc0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0940fe98cc750a5f50da4023f54db1e826833c53", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/0940fe98cc750a5f50da4023f54db1e826833c53", "committedDate": "2020-07-20T14:53:05Z", "message": "Updated the EncodingUtils class to discard Tika's IBM500 result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "033935168f7467eea5c7f9fd516f0b06847f5591", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/033935168f7467eea5c7f9fd516f0b06847f5591", "committedDate": "2020-07-20T15:33:51Z", "message": "Address Codacy comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e7695dc12c75f831d9f13a5af610ab280cc15cf", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/4e7695dc12c75f831d9f13a5af610ab280cc15cf", "committedDate": "2020-07-20T15:36:37Z", "message": "Removed useless comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzI3Njkw", "url": "https://github.com/sleuthkit/autopsy/pull/6099#pullrequestreview-451727690", "createdAt": "2020-07-20T15:39:45Z", "commit": {"oid": "4e7695dc12c75f831d9f13a5af610ab280cc15cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozOTo0NVrOG0T3nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozOTo0NVrOG0T3nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDY3MQ==", "bodyText": "We should put the Tika story in here too.", "url": "https://github.com/sleuthkit/autopsy/pull/6099#discussion_r457504671", "createdAt": "2020-07-20T15:39:45Z", "author": {"login": "bcarrier"}, "path": "Core/src/org/sleuthkit/autopsy/coreutils/textutils/EncodingUtils.java", "diffHunk": "@@ -87,12 +87,27 @@ public static Charset getEncoding(AbstractFile file) throws TskCoreException, IO\n         try (InputStream stream = new BufferedInputStream(new ReadContentInputStream(file))) {\n             CharsetDetector detector = new CharsetDetector();\n             detector.setText(stream);\n-            CharsetMatch tikaResult = detector.detect();\n-            if (tikaResult != null && tikaResult.getConfidence() >= MIN_CHARSETDETECT_MATCH_CONFIDENCE) {\n-                String tikaCharSet = tikaResult.getName();\n-                //Check if the nio package has support for the charset determined by Tika.\n-                if(Charset.isSupported(tikaCharSet)) {\n-                    return Charset.forName(tikaCharSet);\n+            \n+            CharsetMatch[] tikaResults = detector.detectAll();\n+            // Get all guesses by Tika. These CharsetMatch's are ordered\n+            // by descending confidence (largest first).\n+            if (tikaResults.length > 0) {\n+                CharsetMatch topPick = tikaResults[0];\n+                \n+                if (topPick.getName().equalsIgnoreCase(\"IBM500\") && tikaResults.length > 1) {\n+                    // Legacy encoding, let's discard this one in favor\n+                    // of the second pick. Tika has some problems with \n+                    // mistakenly identifying text as IBM500. See JIRA-6600 ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e7695dc12c75f831d9f13a5af610ab280cc15cf"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8532d1dc4c04a4a47648c00d60140b9e65c7fdae", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/8532d1dc4c04a4a47648c00d60140b9e65c7fdae", "committedDate": "2020-07-20T15:43:16Z", "message": "Added link to TIKA story about IBM500 issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzQ1NzQ2", "url": "https://github.com/sleuthkit/autopsy/pull/6099#pullrequestreview-451745746", "createdAt": "2020-07-20T16:00:04Z", "commit": {"oid": "8532d1dc4c04a4a47648c00d60140b9e65c7fdae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2898, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}