{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzNTM1NDM2", "number": 6099, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozOTo0NVrOEQQfVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozOTo0NVrOEQQfVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NDgyODM4OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/coreutils/textutils/EncodingUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozOTo0NVrOG0T3nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTo0NTo0OFrOG0UKYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDY3MQ==", "bodyText": "We should put the Tika story in here too.", "url": "https://github.com/sleuthkit/autopsy/pull/6099#discussion_r457504671", "createdAt": "2020-07-20T15:39:45Z", "author": {"login": "bcarrier"}, "path": "Core/src/org/sleuthkit/autopsy/coreutils/textutils/EncodingUtils.java", "diffHunk": "@@ -87,12 +87,27 @@ public static Charset getEncoding(AbstractFile file) throws TskCoreException, IO\n         try (InputStream stream = new BufferedInputStream(new ReadContentInputStream(file))) {\n             CharsetDetector detector = new CharsetDetector();\n             detector.setText(stream);\n-            CharsetMatch tikaResult = detector.detect();\n-            if (tikaResult != null && tikaResult.getConfidence() >= MIN_CHARSETDETECT_MATCH_CONFIDENCE) {\n-                String tikaCharSet = tikaResult.getName();\n-                //Check if the nio package has support for the charset determined by Tika.\n-                if(Charset.isSupported(tikaCharSet)) {\n-                    return Charset.forName(tikaCharSet);\n+            \n+            CharsetMatch[] tikaResults = detector.detectAll();\n+            // Get all guesses by Tika. These CharsetMatch's are ordered\n+            // by descending confidence (largest first).\n+            if (tikaResults.length > 0) {\n+                CharsetMatch topPick = tikaResults[0];\n+                \n+                if (topPick.getName().equalsIgnoreCase(\"IBM500\") && tikaResults.length > 1) {\n+                    // Legacy encoding, let's discard this one in favor\n+                    // of the second pick. Tika has some problems with \n+                    // mistakenly identifying text as IBM500. See JIRA-6600 ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e7695dc12c75f831d9f13a5af610ab280cc15cf"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwOTQ3NA==", "bodyText": "Done :)", "url": "https://github.com/sleuthkit/autopsy/pull/6099#discussion_r457509474", "createdAt": "2020-07-20T15:45:48Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/coreutils/textutils/EncodingUtils.java", "diffHunk": "@@ -87,12 +87,27 @@ public static Charset getEncoding(AbstractFile file) throws TskCoreException, IO\n         try (InputStream stream = new BufferedInputStream(new ReadContentInputStream(file))) {\n             CharsetDetector detector = new CharsetDetector();\n             detector.setText(stream);\n-            CharsetMatch tikaResult = detector.detect();\n-            if (tikaResult != null && tikaResult.getConfidence() >= MIN_CHARSETDETECT_MATCH_CONFIDENCE) {\n-                String tikaCharSet = tikaResult.getName();\n-                //Check if the nio package has support for the charset determined by Tika.\n-                if(Charset.isSupported(tikaCharSet)) {\n-                    return Charset.forName(tikaCharSet);\n+            \n+            CharsetMatch[] tikaResults = detector.detectAll();\n+            // Get all guesses by Tika. These CharsetMatch's are ordered\n+            // by descending confidence (largest first).\n+            if (tikaResults.length > 0) {\n+                CharsetMatch topPick = tikaResults[0];\n+                \n+                if (topPick.getName().equalsIgnoreCase(\"IBM500\") && tikaResults.length > 1) {\n+                    // Legacy encoding, let's discard this one in favor\n+                    // of the second pick. Tika has some problems with \n+                    // mistakenly identifying text as IBM500. See JIRA-6600 ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDY3MQ=="}, "originalCommit": {"oid": "4e7695dc12c75f831d9f13a5af610ab280cc15cf"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 915, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}