{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNzc0Nzc3", "number": 5645, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowNzowNVrODf4jAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowODoxOFrODf4kDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NzU4OTEyOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepo.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowNzowNVrOFp1_CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowNzowNVrOFp1_CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDQyNA==", "bodyText": "Could we reduce code duplication here by storing the database type in a variable and having the same code for both cases?", "url": "https://github.com/sleuthkit/autopsy/pull/5645#discussion_r379420424", "createdAt": "2020-02-14T13:07:05Z", "author": {"login": "APriestman"}, "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepo.java", "diffHunk": "@@ -3414,22 +3418,22 @@ public void upgradeSchema() throws CentralRepoException, SQLException, Incompati\n                     case POSTGRESQL:\n                         addAttributeSql = \"INSERT INTO correlation_types(id, display_name, db_table_name, supported, enabled) VALUES (?, ?, ?, ?, ?) \" + getConflictClause();  //NON-NLS\n \n-                        addSsidTableTemplate = PostgresCentralRepoSettings.getCreateArtifactInstancesTableTemplate();\n-                        addCaseIdIndexTemplate = PostgresCentralRepoSettings.getAddCaseIdIndexTemplate();\n-                        addDataSourceIdIndexTemplate = PostgresCentralRepoSettings.getAddDataSourceIdIndexTemplate();\n-                        addValueIndexTemplate = PostgresCentralRepoSettings.getAddValueIndexTemplate();\n-                        addKnownStatusIndexTemplate = PostgresCentralRepoSettings.getAddKnownStatusIndexTemplate();\n-                        addObjectIdIndexTemplate = PostgresCentralRepoSettings.getAddObjectIdIndexTemplate();\n+                        addSsidTableTemplate = RdbmsCentralRepoSchemaFactory.getCreateArtifactInstancesTableTemplate(CentralRepoPlatforms.POSTGRESQL);\n+                        addCaseIdIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddCaseIdIndexTemplate();\n+                        addDataSourceIdIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddDataSourceIdIndexTemplate();\n+                        addValueIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddValueIndexTemplate();\n+                        addKnownStatusIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddKnownStatusIndexTemplate();\n+                        addObjectIdIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddObjectIdIndexTemplate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NzU5MTgyOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/optionspanel/EamDbSettingsDialog.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowODoxOFrOFp2AzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjowNjo0NFrOFp7rbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDg3Nw==", "bodyText": "Was this intended to be done for this PR?", "url": "https://github.com/sleuthkit/autopsy/pull/5645#discussion_r379420877", "createdAt": "2020-02-14T13:08:18Z", "author": {"login": "APriestman"}, "path": "Core/src/org/sleuthkit/autopsy/centralrepository/optionspanel/EamDbSettingsDialog.java", "diffHunk": "@@ -447,12 +448,19 @@ private void createDb() {\n                     dbCreated = dbSettingsPostgres.createDatabase();\n                 }\n                 if (dbCreated) {\n-                    result = dbSettingsPostgres.initializeDatabaseSchema()\n-                            && dbSettingsPostgres.insertDefaultDatabaseContent();\n+                    try {\n+                        RdbmsCentralRepoSchemaFactory centralRepoSchemaFactory = new RdbmsCentralRepoSchemaFactory(selectedPlatform);\n+                        \n+                        result = centralRepoSchemaFactory.initializeDatabaseSchema()\n+                            && centralRepoSchemaFactory.insertDefaultDatabaseContent();\n+                    } catch (CentralRepoException ex) {\n+                       logger.log( Level.SEVERE, \"Unable to initialize database schema or insert contents into Postgres central repository.\", ex);\n+                    }\n                 }\n                 if (!result) {\n                     // Remove the incomplete database\n                     if (dbCreated) {\n+                        // RAMAN TBD: migrate  deleteDatabase() to RdbmsCentralRepoSchemaFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUxMzcwOA==", "bodyText": "Not for this PR", "url": "https://github.com/sleuthkit/autopsy/pull/5645#discussion_r379513708", "createdAt": "2020-02-14T16:06:44Z", "author": {"login": "raman-bt"}, "path": "Core/src/org/sleuthkit/autopsy/centralrepository/optionspanel/EamDbSettingsDialog.java", "diffHunk": "@@ -447,12 +448,19 @@ private void createDb() {\n                     dbCreated = dbSettingsPostgres.createDatabase();\n                 }\n                 if (dbCreated) {\n-                    result = dbSettingsPostgres.initializeDatabaseSchema()\n-                            && dbSettingsPostgres.insertDefaultDatabaseContent();\n+                    try {\n+                        RdbmsCentralRepoSchemaFactory centralRepoSchemaFactory = new RdbmsCentralRepoSchemaFactory(selectedPlatform);\n+                        \n+                        result = centralRepoSchemaFactory.initializeDatabaseSchema()\n+                            && centralRepoSchemaFactory.insertDefaultDatabaseContent();\n+                    } catch (CentralRepoException ex) {\n+                       logger.log( Level.SEVERE, \"Unable to initialize database schema or insert contents into Postgres central repository.\", ex);\n+                    }\n                 }\n                 if (!result) {\n                     // Remove the incomplete database\n                     if (dbCreated) {\n+                        // RAMAN TBD: migrate  deleteDatabase() to RdbmsCentralRepoSchemaFactory", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDg3Nw=="}, "originalCommit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 727, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}