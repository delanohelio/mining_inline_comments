{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNzc0Nzc3", "number": 5645, "title": "6038:  CR schema creation refactoring - unify the SQL ", "bodyText": "", "createdAt": "2020-02-11T17:03:47Z", "url": "https://github.com/sleuthkit/autopsy/pull/5645", "merged": true, "mergeCommit": {"oid": "b805d2a1ec3f4bc16229a900a8d3859ba3355758"}, "closed": true, "closedAt": "2020-02-18T18:19:37Z", "author": {"login": "raman-bt"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBxkY1AH2gAyMzczNzc0Nzc3OmNjN2VkMjI0ZmZiYWUwYTE5MGUzNjQ1ZGVhMTMwMTMyOTI4ODExZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFmGx1AFqTM2MDU2NTY0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc7ed224ffbae0a190e3645dea130132928811e6", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/cc7ed224ffbae0a190e3645dea130132928811e6", "committedDate": "2020-02-06T21:25:06Z", "message": "Interim commit - isolated scheme creation code from DBSettings classes and put them in the new RdmsCentralRepoSchemaFactory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3877804a7c1274d56d55b4aa28e65344c766091f", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/3877804a7c1274d56d55b4aa28e65344c766091f", "committedDate": "2020-02-10T19:13:27Z", "message": "Interim commit\n - The schema creation code between SQLite and PostGres has been compared, the differences are reconciled but there is still a fair bit of duplicate code, which should be easy to eliminate now."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed1443aa6817c0ac2e17f7adcbf95b2f464d7db2", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/ed1443aa6817c0ac2e17f7adcbf95b2f464d7db2", "committedDate": "2020-02-11T15:54:31Z", "message": "Unified the SQL for schema creation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b79b91f502f68f28627679ea47bcdb65b30b333e", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/b79b91f502f68f28627679ea47bcdb65b30b333e", "committedDate": "2020-02-11T16:17:28Z", "message": "Removed commented code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac8256b10254ec4072ddccadb51ce8084ec38a11", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/ac8256b10254ec4072ddccadb51ce8084ec38a11", "committedDate": "2020-02-11T16:58:09Z", "message": "Removed commented code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44d5a8576142007bb8fea712c65676aeb54312ab", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/44d5a8576142007bb8fea712c65676aeb54312ab", "committedDate": "2020-02-12T16:41:48Z", "message": "Fixed Codacy comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/876fc0b10be51ba3945cf76d5ab7283aaba33fd9", "committedDate": "2020-02-12T17:04:17Z", "message": "Address Codacy comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTI3MTY2", "url": "https://github.com/sleuthkit/autopsy/pull/5645#pullrequestreview-358927166", "createdAt": "2020-02-14T13:07:05Z", "commit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowNzowNVrOFp1_CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowODoxOFrOFp2AzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDQyNA==", "bodyText": "Could we reduce code duplication here by storing the database type in a variable and having the same code for both cases?", "url": "https://github.com/sleuthkit/autopsy/pull/5645#discussion_r379420424", "createdAt": "2020-02-14T13:07:05Z", "author": {"login": "APriestman"}, "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/RdbmsCentralRepo.java", "diffHunk": "@@ -3414,22 +3418,22 @@ public void upgradeSchema() throws CentralRepoException, SQLException, Incompati\n                     case POSTGRESQL:\n                         addAttributeSql = \"INSERT INTO correlation_types(id, display_name, db_table_name, supported, enabled) VALUES (?, ?, ?, ?, ?) \" + getConflictClause();  //NON-NLS\n \n-                        addSsidTableTemplate = PostgresCentralRepoSettings.getCreateArtifactInstancesTableTemplate();\n-                        addCaseIdIndexTemplate = PostgresCentralRepoSettings.getAddCaseIdIndexTemplate();\n-                        addDataSourceIdIndexTemplate = PostgresCentralRepoSettings.getAddDataSourceIdIndexTemplate();\n-                        addValueIndexTemplate = PostgresCentralRepoSettings.getAddValueIndexTemplate();\n-                        addKnownStatusIndexTemplate = PostgresCentralRepoSettings.getAddKnownStatusIndexTemplate();\n-                        addObjectIdIndexTemplate = PostgresCentralRepoSettings.getAddObjectIdIndexTemplate();\n+                        addSsidTableTemplate = RdbmsCentralRepoSchemaFactory.getCreateArtifactInstancesTableTemplate(CentralRepoPlatforms.POSTGRESQL);\n+                        addCaseIdIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddCaseIdIndexTemplate();\n+                        addDataSourceIdIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddDataSourceIdIndexTemplate();\n+                        addValueIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddValueIndexTemplate();\n+                        addKnownStatusIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddKnownStatusIndexTemplate();\n+                        addObjectIdIndexTemplate = RdbmsCentralRepoSchemaFactory.getAddObjectIdIndexTemplate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDg3Nw==", "bodyText": "Was this intended to be done for this PR?", "url": "https://github.com/sleuthkit/autopsy/pull/5645#discussion_r379420877", "createdAt": "2020-02-14T13:08:18Z", "author": {"login": "APriestman"}, "path": "Core/src/org/sleuthkit/autopsy/centralrepository/optionspanel/EamDbSettingsDialog.java", "diffHunk": "@@ -447,12 +448,19 @@ private void createDb() {\n                     dbCreated = dbSettingsPostgres.createDatabase();\n                 }\n                 if (dbCreated) {\n-                    result = dbSettingsPostgres.initializeDatabaseSchema()\n-                            && dbSettingsPostgres.insertDefaultDatabaseContent();\n+                    try {\n+                        RdbmsCentralRepoSchemaFactory centralRepoSchemaFactory = new RdbmsCentralRepoSchemaFactory(selectedPlatform);\n+                        \n+                        result = centralRepoSchemaFactory.initializeDatabaseSchema()\n+                            && centralRepoSchemaFactory.insertDefaultDatabaseContent();\n+                    } catch (CentralRepoException ex) {\n+                       logger.log( Level.SEVERE, \"Unable to initialize database schema or insert contents into Postgres central repository.\", ex);\n+                    }\n                 }\n                 if (!result) {\n                     // Remove the incomplete database\n                     if (dbCreated) {\n+                        // RAMAN TBD: migrate  deleteDatabase() to RdbmsCentralRepoSchemaFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "876fc0b10be51ba3945cf76d5ab7283aaba33fd9"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458bd200f2b7fd0b082b5b3f0d534412b9574f88", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/458bd200f2b7fd0b082b5b3f0d534412b9574f88", "committedDate": "2020-02-14T20:26:28Z", "message": "Addressed comments from review & verification test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDI2MTgy", "url": "https://github.com/sleuthkit/autopsy/pull/5645#pullrequestreview-360426182", "createdAt": "2020-02-18T15:20:53Z", "commit": {"oid": "458bd200f2b7fd0b082b5b3f0d534412b9574f88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDkzMzY1", "url": "https://github.com/sleuthkit/autopsy/pull/5645#pullrequestreview-360493365", "createdAt": "2020-02-18T16:38:14Z", "commit": {"oid": "458bd200f2b7fd0b082b5b3f0d534412b9574f88"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "239f856f51f612758299c6cb403e9b059d0ce8ba", "author": {"user": {"login": "raman-bt", "name": null}}, "url": "https://github.com/sleuthkit/autopsy/commit/239f856f51f612758299c6cb403e9b059d0ce8ba", "committedDate": "2020-02-18T17:54:29Z", "message": "Renamed class  RdbmsCentralRepoSchemaFactory to RdbmsCentralRepoFactory."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTY1NjQ3", "url": "https://github.com/sleuthkit/autopsy/pull/5645#pullrequestreview-360565647", "createdAt": "2020-02-18T18:19:30Z", "commit": {"oid": "239f856f51f612758299c6cb403e9b059d0ce8ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2769, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}