{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNTIwNTc3", "number": 5964, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxMDo1NVrOEEVw1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo1MDoyMVrOEEYXMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTg2MzI3OnYy", "diffSide": "RIGHT", "path": "Core/nbproject/project.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxMDo1NVrOGh5kYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODo1Nzo1MVrOGiCVTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE5OTM5Mg==", "bodyText": "Curious that we didn't already have these dependencies specified. We should probably ask Eamonn about this, just in case he did something special when we first started using Curator..", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438199392", "createdAt": "2020-06-10T15:10:55Z", "author": {"login": "rcordovano"}, "path": "Core/nbproject/project.properties", "diffHunk": "@@ -23,6 +23,9 @@ file.reference.commons-exec-1.3.jar=release\\\\modules\\\\ext\\\\commons-exec-1.3.jar\n file.reference.commons-io-2.6.jar=release\\\\modules\\\\ext\\\\commons-io-2.6.jar\n file.reference.commons-lang3-3.8.1.jar=release\\\\modules\\\\ext\\\\commons-lang3-3.8.1.jar\n file.reference.commons-pool2-2.4.2.jar=release/modules/ext/commons-pool2-2.4.2.jar\n+file.reference.curator-client-2.8.0.jar=release/modules/ext/curator-client-2.8.0.jar\n+file.reference.curator-framework-2.8.0.jar=release/modules/ext/curator-framework-2.8.0.jar\n+file.reference.curator-recipes-2.8.0.jar=release/modules/ext/curator-recipes-2.8.0.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0Mjk4OA==", "bodyText": "It was a duplicate. Removed.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438342988", "createdAt": "2020-06-10T18:57:51Z", "author": {"login": "eugene7646"}, "path": "Core/nbproject/project.properties", "diffHunk": "@@ -23,6 +23,9 @@ file.reference.commons-exec-1.3.jar=release\\\\modules\\\\ext\\\\commons-exec-1.3.jar\n file.reference.commons-io-2.6.jar=release\\\\modules\\\\ext\\\\commons-io-2.6.jar\n file.reference.commons-lang3-3.8.1.jar=release\\\\modules\\\\ext\\\\commons-lang3-3.8.1.jar\n file.reference.commons-pool2-2.4.2.jar=release/modules/ext/commons-pool2-2.4.2.jar\n+file.reference.curator-client-2.8.0.jar=release/modules/ext/curator-client-2.8.0.jar\n+file.reference.curator-framework-2.8.0.jar=release/modules/ext/curator-framework-2.8.0.jar\n+file.reference.curator-recipes-2.8.0.jar=release/modules/ext/curator-recipes-2.8.0.jar", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE5OTM5Mg=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTg3NzUzOnYy", "diffSide": "RIGHT", "path": "Core/nbproject/project.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxNDowNFrOGh5tog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODo1ODoxNFrOGiCWHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwMTc2Mg==", "bodyText": "This is new.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438201762", "createdAt": "2020-06-10T15:14:04Z", "author": {"login": "rcordovano"}, "path": "Core/nbproject/project.xml", "diffHunk": "@@ -431,6 +431,10 @@\n                 <runtime-relative-path>ext/tika-core-1.20.jar</runtime-relative-path>\n                 <binary-origin>release\\modules\\ext\\tika-core-1.20.jar</binary-origin>\n             </class-path-extension>\n+            <class-path-extension>\n+                <runtime-relative-path>ext/sleuthkit-postgresql-4.8.0.jar</runtime-relative-path>\n+                <binary-origin>release/modules/ext/sleuthkit-postgresql-4.8.0.jar</binary-origin>\n+            </class-path-extension>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MzE5OA==", "bodyText": "Not sure where this came from. Removed.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438343198", "createdAt": "2020-06-10T18:58:14Z", "author": {"login": "eugene7646"}, "path": "Core/nbproject/project.xml", "diffHunk": "@@ -431,6 +431,10 @@\n                 <runtime-relative-path>ext/tika-core-1.20.jar</runtime-relative-path>\n                 <binary-origin>release\\modules\\ext\\tika-core-1.20.jar</binary-origin>\n             </class-path-extension>\n+            <class-path-extension>\n+                <runtime-relative-path>ext/sleuthkit-postgresql-4.8.0.jar</runtime-relative-path>\n+                <binary-origin>release/modules/ext/sleuthkit-postgresql-4.8.0.jar</binary-origin>\n+            </class-path-extension>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwMTc2Mg=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTg4ODU0OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/coordinationservice/utils/CoordinationServiceUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxNjozN1rOGh503w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODo1ODoyMVrOGiCWXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwMzYxNQ==", "bodyText": "This should just be 2020 - 2020, or just 2020, not 2011 - 2020.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438203615", "createdAt": "2020-06-10T15:16:37Z", "author": {"login": "rcordovano"}, "path": "Core/src/org/sleuthkit/autopsy/coordinationservice/utils/CoordinationServiceUtils.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2011-2018 Basis Technology Corp.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MzI2Mg==", "bodyText": "Done.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438343262", "createdAt": "2020-06-10T18:58:21Z", "author": {"login": "eugene7646"}, "path": "Core/src/org/sleuthkit/autopsy/coordinationservice/utils/CoordinationServiceUtils.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2011-2018 Basis Technology Corp.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwMzYxNQ=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTkwNzA0OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToyMDo0MVrOGh6Apg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0MTozN1rOGiFkhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwNjYzMA==", "bodyText": "I don't think that these need to be public.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438206630", "createdAt": "2020-06-10T15:20:41Z", "author": {"login": "rcordovano"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -54,8 +54,15 @@\n     public static final String EXTERNAL_DATABASE_USER = \"ExternalDatabaseUsername\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_PASSWORD = \"ExternalDatabasePassword\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_TYPE = \"ExternalDatabaseType\"; //NON-NLS\n-    public static final String INDEXING_SERVER_HOST = \"IndexingServerHost\"; //NON-NLS\n-    public static final String INDEXING_SERVER_PORT = \"IndexingServerPort\"; //NON-NLS\n+    public static final String SOLR8_SERVER_HOST = \"Solr8ServerHost\"; //NON-NLS\n+    public static final String SOLR8_SERVER_PORT = \"Solr8ServerPort\"; //NON-NLS\n+    public static final String SOLR4_SERVER_HOST = \"Solr4ServerHost\"; //NON-NLS\n+    public static final String SOLR4_SERVER_PORT = \"Solr4ServerPort\"; //NON-NLS\n+    public static final String INDEXING_MAX_SHARDS = \"IndexingMaxShards\"; //NON-NLS\n+    public static final String INDEXING_DOC_QUEUE_SIZE = \"IndexingDocumentQueueSize\"; //NON-NLS\n+    public static final String INDEXING_NUM_THREADS = \"IndexingNumThreads\"; //NON-NLS\n+    public static final String ZK_SERVER_HOST = \"ZookeeperServerHost\"; //NON-NLS\n+    public static final String ZK_SERVER_PORT = \"ZookeeperServerPort\"; //NON-NLS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NjAzNg==", "bodyText": "Done.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438396036", "createdAt": "2020-06-10T20:41:37Z", "author": {"login": "eugene7646"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -54,8 +54,15 @@\n     public static final String EXTERNAL_DATABASE_USER = \"ExternalDatabaseUsername\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_PASSWORD = \"ExternalDatabasePassword\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_TYPE = \"ExternalDatabaseType\"; //NON-NLS\n-    public static final String INDEXING_SERVER_HOST = \"IndexingServerHost\"; //NON-NLS\n-    public static final String INDEXING_SERVER_PORT = \"IndexingServerPort\"; //NON-NLS\n+    public static final String SOLR8_SERVER_HOST = \"Solr8ServerHost\"; //NON-NLS\n+    public static final String SOLR8_SERVER_PORT = \"Solr8ServerPort\"; //NON-NLS\n+    public static final String SOLR4_SERVER_HOST = \"Solr4ServerHost\"; //NON-NLS\n+    public static final String SOLR4_SERVER_PORT = \"Solr4ServerPort\"; //NON-NLS\n+    public static final String INDEXING_MAX_SHARDS = \"IndexingMaxShards\"; //NON-NLS\n+    public static final String INDEXING_DOC_QUEUE_SIZE = \"IndexingDocumentQueueSize\"; //NON-NLS\n+    public static final String INDEXING_NUM_THREADS = \"IndexingNumThreads\"; //NON-NLS\n+    public static final String ZK_SERVER_HOST = \"ZookeeperServerHost\"; //NON-NLS\n+    public static final String ZK_SERVER_PORT = \"ZookeeperServerPort\"; //NON-NLS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwNjYzMA=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTk4Njc3OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozNzowMlrOGh6zkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0Mzo1M1rOGiFpBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxOTY2Ng==", "bodyText": "I would much prefer these new APIs to be in a non-public package. There is no reason we should expose these settings to all module writers, etc. We can do the same thing we did with org.sleuthkit.autopsy.commandlineingest.UserPreferences. Let's make a non-public package named org.sleuthkit.autopsy.userpreferences.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438219666", "createdAt": "2020-06-10T15:37:02Z", "author": {"login": "rcordovano"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -324,21 +331,77 @@ public static boolean getIsMultiUserModeEnabled() {\n     }\n \n     public static String getIndexingServerHost() {\n-        return preferences.get(INDEXING_SERVER_HOST, \"\");\n+        return preferences.get(SOLR8_SERVER_HOST, \"\");\n     }\n \n     public static void setIndexingServerHost(String hostName) {\n-        preferences.put(INDEXING_SERVER_HOST, hostName);\n+        preferences.put(SOLR8_SERVER_HOST, hostName);\n     }\n \n     public static String getIndexingServerPort() {\n-        return preferences.get(INDEXING_SERVER_PORT, \"8983\");\n+        return preferences.get(SOLR8_SERVER_PORT, \"8983\");\n     }\n \n     public static void setIndexingServerPort(int port) {\n-        preferences.putInt(INDEXING_SERVER_PORT, port);\n+        preferences.putInt(SOLR8_SERVER_PORT, port);\n+    }\n+    \n+    public static String getSolr4ServerHost() {\n+        return preferences.get(SOLR4_SERVER_HOST, \"\");\n+    }\n+\n+    public static void setSolr4ServerHost(String hostName) {\n+        preferences.put(SOLR4_SERVER_HOST, hostName);\n+    }    \n+    \n+    public static String getSolr4ServerPort() {\n+        return preferences.get(SOLR4_SERVER_PORT, \"\");\n+    }\n+\n+    public static void setSolr4ServerPort(String port) {\n+        preferences.put(SOLR4_SERVER_PORT, port);\n+    }    \n+    \n+    public static String getZkServerHost() {\n+        return preferences.get(ZK_SERVER_HOST, \"\");\n+    }\n+    \n+    public static void setZkServerHost(String hostName) {\n+        preferences.put(ZK_SERVER_HOST, hostName);\n+    }\n+\n+    public static String getZkServerPort() {\n+        return preferences.get(ZK_SERVER_PORT, \"\");\n+    }\n+\n+    public static void setZkServerPort(String port) {\n+        preferences.put(ZK_SERVER_PORT, port);\n+    }\n+    \n+    public static void setMaxNumShards(int maxShards) {\n+        preferences.putInt(INDEXING_MAX_SHARDS, maxShards);\n+    }\n+\n+    public static int getMaxNumShards() {\n+        return preferences.getInt(INDEXING_MAX_SHARDS, 0);\n+    }\n+\n+    public static int getNumThreads() {\n+        return preferences.getInt(INDEXING_NUM_THREADS, 10);\n     }\n \n+    public static void setNumThreads(int maxShards) {\n+        preferences.putInt(INDEXING_NUM_THREADS, maxShards);\n+    }\n+    \n+    public static void setDocumentsQueueSize(int maxShards) {\n+        preferences.putInt(INDEXING_DOC_QUEUE_SIZE, maxShards);\n+    }\n+\n+    public static int getDocumentsQueueSize() {\n+        return preferences.getInt(INDEXING_DOC_QUEUE_SIZE, 1000);\n+    }\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM3Njc0Mw==", "bodyText": "@rcordovano ugh! I just went through the trouble of implementing this class and all the methods, and modified all of the code that used these methods - only to find out that these methods/settings are used by KWS NBM, and therefore they have to be publicly exported by Autopsy Core. There are 2 methods that are only used by KWS so they can move to KWS UserPreferences, but Solr 8 & Solr 4 settings must be public.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438376743", "createdAt": "2020-06-10T20:02:52Z", "author": {"login": "eugene7646"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -324,21 +331,77 @@ public static boolean getIsMultiUserModeEnabled() {\n     }\n \n     public static String getIndexingServerHost() {\n-        return preferences.get(INDEXING_SERVER_HOST, \"\");\n+        return preferences.get(SOLR8_SERVER_HOST, \"\");\n     }\n \n     public static void setIndexingServerHost(String hostName) {\n-        preferences.put(INDEXING_SERVER_HOST, hostName);\n+        preferences.put(SOLR8_SERVER_HOST, hostName);\n     }\n \n     public static String getIndexingServerPort() {\n-        return preferences.get(INDEXING_SERVER_PORT, \"8983\");\n+        return preferences.get(SOLR8_SERVER_PORT, \"8983\");\n     }\n \n     public static void setIndexingServerPort(int port) {\n-        preferences.putInt(INDEXING_SERVER_PORT, port);\n+        preferences.putInt(SOLR8_SERVER_PORT, port);\n+    }\n+    \n+    public static String getSolr4ServerHost() {\n+        return preferences.get(SOLR4_SERVER_HOST, \"\");\n+    }\n+\n+    public static void setSolr4ServerHost(String hostName) {\n+        preferences.put(SOLR4_SERVER_HOST, hostName);\n+    }    \n+    \n+    public static String getSolr4ServerPort() {\n+        return preferences.get(SOLR4_SERVER_PORT, \"\");\n+    }\n+\n+    public static void setSolr4ServerPort(String port) {\n+        preferences.put(SOLR4_SERVER_PORT, port);\n+    }    \n+    \n+    public static String getZkServerHost() {\n+        return preferences.get(ZK_SERVER_HOST, \"\");\n+    }\n+    \n+    public static void setZkServerHost(String hostName) {\n+        preferences.put(ZK_SERVER_HOST, hostName);\n+    }\n+\n+    public static String getZkServerPort() {\n+        return preferences.get(ZK_SERVER_PORT, \"\");\n+    }\n+\n+    public static void setZkServerPort(String port) {\n+        preferences.put(ZK_SERVER_PORT, port);\n+    }\n+    \n+    public static void setMaxNumShards(int maxShards) {\n+        preferences.putInt(INDEXING_MAX_SHARDS, maxShards);\n+    }\n+\n+    public static int getMaxNumShards() {\n+        return preferences.getInt(INDEXING_MAX_SHARDS, 0);\n+    }\n+\n+    public static int getNumThreads() {\n+        return preferences.getInt(INDEXING_NUM_THREADS, 10);\n     }\n \n+    public static void setNumThreads(int maxShards) {\n+        preferences.putInt(INDEXING_NUM_THREADS, maxShards);\n+    }\n+    \n+    public static void setDocumentsQueueSize(int maxShards) {\n+        preferences.putInt(INDEXING_DOC_QUEUE_SIZE, maxShards);\n+    }\n+\n+    public static int getDocumentsQueueSize() {\n+        return preferences.getInt(INDEXING_DOC_QUEUE_SIZE, 1000);\n+    }\n+    ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxOTY2Ng=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NzE4OA==", "bodyText": "I moved KWS specific preferences (number of shards, concurrent client queue size, etc) into a separate KWS user preferences. Everything else had to stay in public Core preferences.\nAlso, none of the command line ingest preferences were being used any more, everything is being passes as CL input now, so I cleaned that up as well.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438397188", "createdAt": "2020-06-10T20:43:53Z", "author": {"login": "eugene7646"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -324,21 +331,77 @@ public static boolean getIsMultiUserModeEnabled() {\n     }\n \n     public static String getIndexingServerHost() {\n-        return preferences.get(INDEXING_SERVER_HOST, \"\");\n+        return preferences.get(SOLR8_SERVER_HOST, \"\");\n     }\n \n     public static void setIndexingServerHost(String hostName) {\n-        preferences.put(INDEXING_SERVER_HOST, hostName);\n+        preferences.put(SOLR8_SERVER_HOST, hostName);\n     }\n \n     public static String getIndexingServerPort() {\n-        return preferences.get(INDEXING_SERVER_PORT, \"8983\");\n+        return preferences.get(SOLR8_SERVER_PORT, \"8983\");\n     }\n \n     public static void setIndexingServerPort(int port) {\n-        preferences.putInt(INDEXING_SERVER_PORT, port);\n+        preferences.putInt(SOLR8_SERVER_PORT, port);\n+    }\n+    \n+    public static String getSolr4ServerHost() {\n+        return preferences.get(SOLR4_SERVER_HOST, \"\");\n+    }\n+\n+    public static void setSolr4ServerHost(String hostName) {\n+        preferences.put(SOLR4_SERVER_HOST, hostName);\n+    }    \n+    \n+    public static String getSolr4ServerPort() {\n+        return preferences.get(SOLR4_SERVER_PORT, \"\");\n+    }\n+\n+    public static void setSolr4ServerPort(String port) {\n+        preferences.put(SOLR4_SERVER_PORT, port);\n+    }    \n+    \n+    public static String getZkServerHost() {\n+        return preferences.get(ZK_SERVER_HOST, \"\");\n+    }\n+    \n+    public static void setZkServerHost(String hostName) {\n+        preferences.put(ZK_SERVER_HOST, hostName);\n+    }\n+\n+    public static String getZkServerPort() {\n+        return preferences.get(ZK_SERVER_PORT, \"\");\n+    }\n+\n+    public static void setZkServerPort(String port) {\n+        preferences.put(ZK_SERVER_PORT, port);\n+    }\n+    \n+    public static void setMaxNumShards(int maxShards) {\n+        preferences.putInt(INDEXING_MAX_SHARDS, maxShards);\n+    }\n+\n+    public static int getMaxNumShards() {\n+        return preferences.getInt(INDEXING_MAX_SHARDS, 0);\n+    }\n+\n+    public static int getNumThreads() {\n+        return preferences.getInt(INDEXING_NUM_THREADS, 10);\n     }\n \n+    public static void setNumThreads(int maxShards) {\n+        preferences.putInt(INDEXING_NUM_THREADS, maxShards);\n+    }\n+    \n+    public static void setDocumentsQueueSize(int maxShards) {\n+        preferences.putInt(INDEXING_DOC_QUEUE_SIZE, maxShards);\n+    }\n+\n+    public static int getDocumentsQueueSize() {\n+        return preferences.getInt(INDEXING_DOC_QUEUE_SIZE, 1000);\n+    }\n+    ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxOTY2Ng=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTk5MjkyOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozODozNFrOGh63zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0MTo0OFrOGiFk4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIyMDc1MQ==", "bodyText": "These should not need to be public.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438220751", "createdAt": "2020-06-10T15:38:34Z", "author": {"login": "rcordovano"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -54,8 +54,15 @@\n     public static final String EXTERNAL_DATABASE_USER = \"ExternalDatabaseUsername\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_PASSWORD = \"ExternalDatabasePassword\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_TYPE = \"ExternalDatabaseType\"; //NON-NLS\n-    public static final String INDEXING_SERVER_HOST = \"IndexingServerHost\"; //NON-NLS\n-    public static final String INDEXING_SERVER_PORT = \"IndexingServerPort\"; //NON-NLS\n+    public static final String SOLR8_SERVER_HOST = \"Solr8ServerHost\"; //NON-NLS\n+    public static final String SOLR8_SERVER_PORT = \"Solr8ServerPort\"; //NON-NLS\n+    public static final String SOLR4_SERVER_HOST = \"Solr4ServerHost\"; //NON-NLS\n+    public static final String SOLR4_SERVER_PORT = \"Solr4ServerPort\"; //NON-NLS\n+    public static final String INDEXING_MAX_SHARDS = \"IndexingMaxShards\"; //NON-NLS\n+    public static final String INDEXING_DOC_QUEUE_SIZE = \"IndexingDocumentQueueSize\"; //NON-NLS\n+    public static final String INDEXING_NUM_THREADS = \"IndexingNumThreads\"; //NON-NLS\n+    public static final String ZK_SERVER_HOST = \"ZookeeperServerHost\"; //NON-NLS\n+    public static final String ZK_SERVER_PORT = \"ZookeeperServerPort\"; //NON-NLS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NjEyOA==", "bodyText": "Done.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438396128", "createdAt": "2020-06-10T20:41:48Z", "author": {"login": "eugene7646"}, "path": "Core/src/org/sleuthkit/autopsy/core/UserPreferences.java", "diffHunk": "@@ -54,8 +54,15 @@\n     public static final String EXTERNAL_DATABASE_USER = \"ExternalDatabaseUsername\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_PASSWORD = \"ExternalDatabasePassword\"; //NON-NLS\n     public static final String EXTERNAL_DATABASE_TYPE = \"ExternalDatabaseType\"; //NON-NLS\n-    public static final String INDEXING_SERVER_HOST = \"IndexingServerHost\"; //NON-NLS\n-    public static final String INDEXING_SERVER_PORT = \"IndexingServerPort\"; //NON-NLS\n+    public static final String SOLR8_SERVER_HOST = \"Solr8ServerHost\"; //NON-NLS\n+    public static final String SOLR8_SERVER_PORT = \"Solr8ServerPort\"; //NON-NLS\n+    public static final String SOLR4_SERVER_HOST = \"Solr4ServerHost\"; //NON-NLS\n+    public static final String SOLR4_SERVER_PORT = \"Solr4ServerPort\"; //NON-NLS\n+    public static final String INDEXING_MAX_SHARDS = \"IndexingMaxShards\"; //NON-NLS\n+    public static final String INDEXING_DOC_QUEUE_SIZE = \"IndexingDocumentQueueSize\"; //NON-NLS\n+    public static final String INDEXING_NUM_THREADS = \"IndexingNumThreads\"; //NON-NLS\n+    public static final String ZK_SERVER_HOST = \"ZookeeperServerHost\"; //NON-NLS\n+    public static final String ZK_SERVER_PORT = \"ZookeeperServerPort\"; //NON-NLS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIyMDc1MQ=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDA1NTgzOnYy", "diffSide": "RIGHT", "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/DropdownToolbar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTo1MzoyNFrOGh7gPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNTozMjoyMFrOGiiy0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzMTEwMg==", "bodyText": "Do we need to set disableSearch if the schema is not compatible as well? Can we reduce the number of flags, by any chance?", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438231102", "createdAt": "2020-06-10T15:53:24Z", "author": {"login": "rcordovano"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/DropdownToolbar.java", "diffHunk": "@@ -183,24 +183,14 @@ public void propertyChange(PropertyChangeEvent evt) {\n                             }\n                             else {\n                                 Index indexInfo = server.getIndexInfo();\n-                                if (IndexFinder.getCurrentSolrVersion().equals(indexInfo.getSolrVersion())) {\n-                                    /*\n-                                     * Solr version is current, so check the Solr\n-                                     * schema version and selectively enable the ad\n-                                     * hoc search UI components.\n-                                     */\n-                                    boolean schemaIsCompatible = indexInfo.isCompatible(IndexFinder.getCurrentSchemaVersion());\n-                                    listsButton.setEnabled(schemaIsCompatible);\n-                                    searchDropButton.setEnabled(true);\n-                                    dropPanel.setRegexSearchEnabled(schemaIsCompatible);\n-                                    active = true;\n-                                } else {\n-                                    /*\n-                                     * Unsupported Solr version, disable the ad hoc\n-                                     * search UI components.\n-                                     */\n-                                    disableSearch = true;\n-                                }\n+\n+                                // Check the Solr schema version and selectively \n+                                // enable the ad hoc search UI components.\n+                                boolean schemaIsCompatible = indexInfo.isCompatible(IndexFinder.getCurrentSchemaVersion());\n+                                listsButton.setEnabled(schemaIsCompatible);\n+                                searchDropButton.setEnabled(true);\n+                                dropPanel.setRegexSearchEnabled(schemaIsCompatible);\n+                                active = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3NDgzNQ==", "bodyText": "If we have an incompatible schema, we should just disable search altogether. That is a viable generic solution going forward, as opposed to some partial enabling based on a specific schema change.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438874835", "createdAt": "2020-06-11T15:32:20Z", "author": {"login": "rcordovano"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/DropdownToolbar.java", "diffHunk": "@@ -183,24 +183,14 @@ public void propertyChange(PropertyChangeEvent evt) {\n                             }\n                             else {\n                                 Index indexInfo = server.getIndexInfo();\n-                                if (IndexFinder.getCurrentSolrVersion().equals(indexInfo.getSolrVersion())) {\n-                                    /*\n-                                     * Solr version is current, so check the Solr\n-                                     * schema version and selectively enable the ad\n-                                     * hoc search UI components.\n-                                     */\n-                                    boolean schemaIsCompatible = indexInfo.isCompatible(IndexFinder.getCurrentSchemaVersion());\n-                                    listsButton.setEnabled(schemaIsCompatible);\n-                                    searchDropButton.setEnabled(true);\n-                                    dropPanel.setRegexSearchEnabled(schemaIsCompatible);\n-                                    active = true;\n-                                } else {\n-                                    /*\n-                                     * Unsupported Solr version, disable the ad hoc\n-                                     * search UI components.\n-                                     */\n-                                    disableSearch = true;\n-                                }\n+\n+                                // Check the Solr schema version and selectively \n+                                // enable the ad hoc search UI components.\n+                                boolean schemaIsCompatible = indexInfo.isCompatible(IndexFinder.getCurrentSchemaVersion());\n+                                listsButton.setEnabled(schemaIsCompatible);\n+                                searchDropButton.setEnabled(true);\n+                                dropPanel.setRegexSearchEnabled(schemaIsCompatible);\n+                                active = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzMTEwMg=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDIwMjg3OnYy", "diffSide": "RIGHT", "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/SolrSearchService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjoyNjoyNlrOGh89_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjoyNjoyNlrOGh89_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI1NTEwMg==", "bodyText": "This code appears to be obsolete. Is there such a thing as read only mode for keyword search any more?", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438255102", "createdAt": "2020-06-10T16:26:26Z", "author": {"login": "rcordovano"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/SolrSearchService.java", "diffHunk": "@@ -350,34 +328,27 @@ public void openCaseResources(CaseContext context) throws AutopsyServiceExceptio\n                     return;\n                 }\n \n-                double currentSolrVersion = NumberUtils.toDouble(IndexFinder.getCurrentSolrVersion());\n-                double indexSolrVersion = NumberUtils.toDouble(indexToUse.getSolrVersion());\n-                if (indexSolrVersion == currentSolrVersion) {\n-                    // latest Solr version but schema not compatible. index should be used in read-only mode\n-                    if (!indexToUse.isCompatible(IndexFinder.getCurrentSchemaVersion()) && RuntimeProperties.runningWithGUI()) {\n-                        // pop up a message box to indicate the read-only restrictions.\n-                        JOptionPane optionPane = new JOptionPane(\n-                                NbBundle.getMessage(this.getClass(), \"SolrSearchService.IndexReadOnlyDialog.msg\"),\n-                                JOptionPane.WARNING_MESSAGE,\n-                                JOptionPane.DEFAULT_OPTION);\n-                        try {\n-                            SwingUtilities.invokeAndWait(() -> {\n-                                JDialog dialog = optionPane.createDialog(NbBundle.getMessage(this.getClass(), \"SolrSearchService.IndexReadOnlyDialog.title\"));\n-                                dialog.setVisible(true);\n-                            });\n-                        } catch (InterruptedException ex) {\n-                            // Cancelled\n-                            return;\n-                        } catch (InvocationTargetException ex) {\n-                            throw new AutopsyServiceException(\"Error displaying limited search features warning dialog\", ex);\n-                        }\n+                // if schema is not compatible, index should be used in read-only mode\n+                if (!indexToUse.isCompatible(IndexFinder.getCurrentSchemaVersion()) && RuntimeProperties.runningWithGUI()) {\n+                    // pop up a message box to indicate the read-only restrictions.\n+                    JOptionPane optionPane = new JOptionPane(\n+                            NbBundle.getMessage(this.getClass(), \"SolrSearchService.IndexReadOnlyDialog.msg\"),\n+                            JOptionPane.WARNING_MESSAGE,\n+                            JOptionPane.DEFAULT_OPTION);\n+                    try {\n+                        SwingUtilities.invokeAndWait(() -> {\n+                            JDialog dialog = optionPane.createDialog(NbBundle.getMessage(this.getClass(), \"SolrSearchService.IndexReadOnlyDialog.title\"));\n+                            dialog.setVisible(true);\n+                        });\n+                    } catch (InterruptedException ex) {\n+                        // Cancelled\n+                        return;\n+                    } catch (InvocationTargetException ex) {\n+                        throw new AutopsyServiceException(\"Error displaying limited search features warning dialog\", ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 160}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDIyMjU0OnYy", "diffSide": "RIGHT", "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjozMTo0M1rOGh9LCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODo1ODo0NFrOGiCXIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI1ODQ0Mw==", "bodyText": "Should this call getSolrClient()?", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438258443", "createdAt": "2020-06-10T16:31:43Z", "author": {"login": "rcordovano"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "diffHunk": "@@ -222,47 +226,76 @@ public String toString() {\n     private int currentSolrServerPort = 0;\n     private int currentSolrStopPort = 0;\n     private static final boolean DEBUG = false;//(Version.getBuildType() == Version.Type.DEVELOPMENT);\n-    private static final String SOLR = \"solr\";\n-    private static final String CORE_PROPERTIES = \"core.properties\";\n+    private static final int NUM_COLLECTION_CREATION_RETRIES = 5;\n \n     public enum CORE_EVT_STATES {\n \n         STOPPED, STARTED\n     };\n+    \n+    private enum SOLR_VERSION {\n+\n+        SOLR8, SOLR4\n+    };\n \n     // A reference to the locally running Solr instance.\n-    private final HttpSolrServer localSolrServer;\n+    private final ConcurrentUpdateSolrClient localSolrServer;\n+    private SOLR_VERSION localServerVersion = SOLR_VERSION.SOLR8; // start local Solr 8 by default\n \n     // A reference to the Solr server we are currently connected to for the Case.\n     // This could be a local or remote server.\n-    private HttpSolrServer currentSolrServer;\n+    private ConcurrentUpdateSolrClient currentSolrServer;\n \n-    private Core currentCore;\n+    private Collection currentCollection;\n     private final ReentrantReadWriteLock currentCoreLock;\n \n-    private final File solrFolder;\n-    private Path solrHome;\n+    private final File solr8Folder;\n+    private Path solr8CmdPath;\n+    private Path solr8Home;\n     private final ServerAction serverAction;\n     private InputStreamPrinterThread errorRedirectThread;\n \n+    private final File solr4Folder;\n+    private Path solr4Home;    \n     /**\n      * New instance for the server at the given URL\n      *\n      */\n     Server() {\n         initSettings();\n \n-        this.localSolrServer = new HttpSolrServer(\"http://localhost:\" + currentSolrServerPort + \"/solr\"); //NON-NLS\n+        this.localSolrServer = new ConcurrentUpdateSolrClient.Builder(\"http://localhost:\" + currentSolrServerPort + \"/solr\").build(); //NON-NLS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MzQ1OQ==", "bodyText": "Done.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438343459", "createdAt": "2020-06-10T18:58:44Z", "author": {"login": "eugene7646"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "diffHunk": "@@ -222,47 +226,76 @@ public String toString() {\n     private int currentSolrServerPort = 0;\n     private int currentSolrStopPort = 0;\n     private static final boolean DEBUG = false;//(Version.getBuildType() == Version.Type.DEVELOPMENT);\n-    private static final String SOLR = \"solr\";\n-    private static final String CORE_PROPERTIES = \"core.properties\";\n+    private static final int NUM_COLLECTION_CREATION_RETRIES = 5;\n \n     public enum CORE_EVT_STATES {\n \n         STOPPED, STARTED\n     };\n+    \n+    private enum SOLR_VERSION {\n+\n+        SOLR8, SOLR4\n+    };\n \n     // A reference to the locally running Solr instance.\n-    private final HttpSolrServer localSolrServer;\n+    private final ConcurrentUpdateSolrClient localSolrServer;\n+    private SOLR_VERSION localServerVersion = SOLR_VERSION.SOLR8; // start local Solr 8 by default\n \n     // A reference to the Solr server we are currently connected to for the Case.\n     // This could be a local or remote server.\n-    private HttpSolrServer currentSolrServer;\n+    private ConcurrentUpdateSolrClient currentSolrServer;\n \n-    private Core currentCore;\n+    private Collection currentCollection;\n     private final ReentrantReadWriteLock currentCoreLock;\n \n-    private final File solrFolder;\n-    private Path solrHome;\n+    private final File solr8Folder;\n+    private Path solr8CmdPath;\n+    private Path solr8Home;\n     private final ServerAction serverAction;\n     private InputStreamPrinterThread errorRedirectThread;\n \n+    private final File solr4Folder;\n+    private Path solr4Home;    \n     /**\n      * New instance for the server at the given URL\n      *\n      */\n     Server() {\n         initSettings();\n \n-        this.localSolrServer = new HttpSolrServer(\"http://localhost:\" + currentSolrServerPort + \"/solr\"); //NON-NLS\n+        this.localSolrServer = new ConcurrentUpdateSolrClient.Builder(\"http://localhost:\" + currentSolrServerPort + \"/solr\").build(); //NON-NLS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI1ODQ0Mw=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDIzNTUyOnYy", "diffSide": "RIGHT", "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjozNToxM1rOGh9Taw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0NDoxOVrOGiFp1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MDU4Nw==", "bodyText": "We should document that we do not do this for Solr 4 because it is runs in Jetty.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438260587", "createdAt": "2020-06-10T16:35:13Z", "author": {"login": "rcordovano"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "diffHunk": "@@ -222,47 +226,76 @@ public String toString() {\n     private int currentSolrServerPort = 0;\n     private int currentSolrStopPort = 0;\n     private static final boolean DEBUG = false;//(Version.getBuildType() == Version.Type.DEVELOPMENT);\n-    private static final String SOLR = \"solr\";\n-    private static final String CORE_PROPERTIES = \"core.properties\";\n+    private static final int NUM_COLLECTION_CREATION_RETRIES = 5;\n \n     public enum CORE_EVT_STATES {\n \n         STOPPED, STARTED\n     };\n+    \n+    private enum SOLR_VERSION {\n+\n+        SOLR8, SOLR4\n+    };\n \n     // A reference to the locally running Solr instance.\n-    private final HttpSolrServer localSolrServer;\n+    private final ConcurrentUpdateSolrClient localSolrServer;\n+    private SOLR_VERSION localServerVersion = SOLR_VERSION.SOLR8; // start local Solr 8 by default\n \n     // A reference to the Solr server we are currently connected to for the Case.\n     // This could be a local or remote server.\n-    private HttpSolrServer currentSolrServer;\n+    private ConcurrentUpdateSolrClient currentSolrServer;\n \n-    private Core currentCore;\n+    private Collection currentCollection;\n     private final ReentrantReadWriteLock currentCoreLock;\n \n-    private final File solrFolder;\n-    private Path solrHome;\n+    private final File solr8Folder;\n+    private Path solr8CmdPath;\n+    private Path solr8Home;\n     private final ServerAction serverAction;\n     private InputStreamPrinterThread errorRedirectThread;\n \n+    private final File solr4Folder;\n+    private Path solr4Home;    \n     /**\n      * New instance for the server at the given URL\n      *\n      */\n     Server() {\n         initSettings();\n \n-        this.localSolrServer = new HttpSolrServer(\"http://localhost:\" + currentSolrServerPort + \"/solr\"); //NON-NLS\n+        this.localSolrServer = new ConcurrentUpdateSolrClient.Builder(\"http://localhost:\" + currentSolrServerPort + \"/solr\").build(); //NON-NLS\n         serverAction = new ServerAction();\n-        solrFolder = InstalledFileLocator.getDefault().locate(\"solr\", Server.class.getPackage().getName(), false); //NON-NLS\n+        solr8Folder = InstalledFileLocator.getDefault().locate(\"solr\", Server.class.getPackage().getName(), false); //NON-NLS\n+        solr4Folder = InstalledFileLocator.getDefault().locate(\"solr4\", Server.class.getPackage().getName(), false); //NON-NLS\n+        \n+        // Figure out where Java is located. The Java home location \n+        // will be passed as the SOLR_JAVA_HOME environment\n+        // variable to the Solr script but it can be overridden by the user in\n+        // either autopsy-solr.cmd or autopsy-solr-in.cmd.\n         javaPath = PlatformUtil.getJavaPath();\n+        \n+        // This is our customized version of the Solr batch script to start/stop Solr.\n+        solr8CmdPath = Paths.get(solr8Folder.getAbsolutePath(), \"bin\", \"autopsy-solr.cmd\"); //NON-NLS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NzM5OQ==", "bodyText": "Done.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438397399", "createdAt": "2020-06-10T20:44:19Z", "author": {"login": "eugene7646"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "diffHunk": "@@ -222,47 +226,76 @@ public String toString() {\n     private int currentSolrServerPort = 0;\n     private int currentSolrStopPort = 0;\n     private static final boolean DEBUG = false;//(Version.getBuildType() == Version.Type.DEVELOPMENT);\n-    private static final String SOLR = \"solr\";\n-    private static final String CORE_PROPERTIES = \"core.properties\";\n+    private static final int NUM_COLLECTION_CREATION_RETRIES = 5;\n \n     public enum CORE_EVT_STATES {\n \n         STOPPED, STARTED\n     };\n+    \n+    private enum SOLR_VERSION {\n+\n+        SOLR8, SOLR4\n+    };\n \n     // A reference to the locally running Solr instance.\n-    private final HttpSolrServer localSolrServer;\n+    private final ConcurrentUpdateSolrClient localSolrServer;\n+    private SOLR_VERSION localServerVersion = SOLR_VERSION.SOLR8; // start local Solr 8 by default\n \n     // A reference to the Solr server we are currently connected to for the Case.\n     // This could be a local or remote server.\n-    private HttpSolrServer currentSolrServer;\n+    private ConcurrentUpdateSolrClient currentSolrServer;\n \n-    private Core currentCore;\n+    private Collection currentCollection;\n     private final ReentrantReadWriteLock currentCoreLock;\n \n-    private final File solrFolder;\n-    private Path solrHome;\n+    private final File solr8Folder;\n+    private Path solr8CmdPath;\n+    private Path solr8Home;\n     private final ServerAction serverAction;\n     private InputStreamPrinterThread errorRedirectThread;\n \n+    private final File solr4Folder;\n+    private Path solr4Home;    \n     /**\n      * New instance for the server at the given URL\n      *\n      */\n     Server() {\n         initSettings();\n \n-        this.localSolrServer = new HttpSolrServer(\"http://localhost:\" + currentSolrServerPort + \"/solr\"); //NON-NLS\n+        this.localSolrServer = new ConcurrentUpdateSolrClient.Builder(\"http://localhost:\" + currentSolrServerPort + \"/solr\").build(); //NON-NLS\n         serverAction = new ServerAction();\n-        solrFolder = InstalledFileLocator.getDefault().locate(\"solr\", Server.class.getPackage().getName(), false); //NON-NLS\n+        solr8Folder = InstalledFileLocator.getDefault().locate(\"solr\", Server.class.getPackage().getName(), false); //NON-NLS\n+        solr4Folder = InstalledFileLocator.getDefault().locate(\"solr4\", Server.class.getPackage().getName(), false); //NON-NLS\n+        \n+        // Figure out where Java is located. The Java home location \n+        // will be passed as the SOLR_JAVA_HOME environment\n+        // variable to the Solr script but it can be overridden by the user in\n+        // either autopsy-solr.cmd or autopsy-solr-in.cmd.\n         javaPath = PlatformUtil.getJavaPath();\n+        \n+        // This is our customized version of the Solr batch script to start/stop Solr.\n+        solr8CmdPath = Paths.get(solr8Folder.getAbsolutePath(), \"bin\", \"autopsy-solr.cmd\"); //NON-NLS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MDU4Nw=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDI4OTEzOnYy", "diffSide": "RIGHT", "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo1MDoyMVrOGh93BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODo1ODo1MlrOGiCXVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2OTcwMQ==", "bodyText": "We should remove the preceding comments.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438269701", "createdAt": "2020-06-10T16:50:21Z", "author": {"login": "rcordovano"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "diffHunk": "@@ -1599,9 +1940,17 @@ private String getSolrContent(long contentID, int chunkID) {\n         synchronized void close() throws KeywordSearchModuleException {\n             // We only unload cores for \"single-user\" cases.\n             if (this.caseType == CaseType.MULTI_USER_CASE) {\n+                solrClient.close();\n                 return;\n             }\n \n+            /* NOTE: there is no way to unload collections. Only cores can be unloaded.\n+            Since we set \"transient=true\" and \"loadOnStartup=false\" on all cores that \n+            we create, we shouldn't need to explicitly unload cores. Leaving the core below\n+            for reference. */\n+            \n+            // core name is (collectionName + \"_shard1_replica_n1\")\n+            //String coreName = this.name + \"_shard1_replica_n1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 1454}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MzUwOQ==", "bodyText": "Done.", "url": "https://github.com/sleuthkit/autopsy/pull/5964#discussion_r438343509", "createdAt": "2020-06-10T18:58:52Z", "author": {"login": "eugene7646"}, "path": "KeywordSearch/src/org/sleuthkit/autopsy/keywordsearch/Server.java", "diffHunk": "@@ -1599,9 +1940,17 @@ private String getSolrContent(long contentID, int chunkID) {\n         synchronized void close() throws KeywordSearchModuleException {\n             // We only unload cores for \"single-user\" cases.\n             if (this.caseType == CaseType.MULTI_USER_CASE) {\n+                solrClient.close();\n                 return;\n             }\n \n+            /* NOTE: there is no way to unload collections. Only cores can be unloaded.\n+            Since we set \"transient=true\" and \"loadOnStartup=false\" on all cores that \n+            we create, we shouldn't need to explicitly unload cores. Leaving the core below\n+            for reference. */\n+            \n+            // core name is (collectionName + \"_shard1_replica_n1\")\n+            //String coreName = this.name + \"_shard1_replica_n1\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2OTcwMQ=="}, "originalCommit": {"oid": "d8cbf9eabea1b8863bfe91532a1e7747ddc08566"}, "originalPosition": 1454}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 531, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}