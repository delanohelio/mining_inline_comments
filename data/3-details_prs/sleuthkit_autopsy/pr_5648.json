{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDQ3ODU5", "number": 5648, "title": "6040 file discovery documents", "bodyText": "", "createdAt": "2020-02-13T19:28:52Z", "url": "https://github.com/sleuthkit/autopsy/pull/5648", "merged": true, "mergeCommit": {"oid": "894960025702c1b02578513c54dab5ff41a2c220"}, "closed": true, "closedAt": "2020-02-24T16:26:09Z", "author": {"login": "wschaeferB"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBHfm8AH2gAyMzc1MDQ3ODU5OjhlN2Y1MWQwZTM3NDEzYWQ0YjM0M2IwY2RjMjlhNmUwMzA2YTljMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHfpFWgFqTM2MzQ5Njk2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e7f51d0e37413ad4b343b0cdc29a6e0306a9c23", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/8e7f51d0e37413ad4b343b0cdc29a6e0306a9c23", "committedDate": "2020-02-04T20:23:52Z", "message": "Merge branch 'develop' of https://github.com/sleuthkit/autopsy into 5979-DocumentViewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08a44050564b803d4e1bcfc83dfccfec066f01ff", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/08a44050564b803d4e1bcfc83dfccfec066f01ff", "committedDate": "2020-02-13T17:40:34Z", "message": "6040 add end point for document summarization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da53229ba436eb0980831ef417ec63a5ea2c069b", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/da53229ba436eb0980831ef417ec63a5ea2c069b", "committedDate": "2020-02-13T17:43:22Z", "message": "6040 use summarizer for file discovery documents view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6823ee858b7f78680e7fe204670aeb42ee666330", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/6823ee858b7f78680e7fe204670aeb42ee666330", "committedDate": "2020-02-13T17:43:30Z", "message": "Merge branch 'develop' of https://github.com/sleuthkit/autopsy into 6040-FileDiscoveryDocuments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "314007f94055bbf87fd72bff9112fc7aff9ee144", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/314007f94055bbf87fd72bff9112fc7aff9ee144", "committedDate": "2020-02-13T19:28:27Z", "message": "6040 adjust comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046e35b0d031a0d78df139c4321e29956044eb16", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/046e35b0d031a0d78df139c4321e29956044eb16", "committedDate": "2020-02-13T21:42:00Z", "message": "6040 rename summarizer to textsummarizer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f25a126f1facae30b5048564287773c22440571", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/3f25a126f1facae30b5048564287773c22440571", "committedDate": "2020-02-13T21:56:56Z", "message": "6040 fix exporting of renamed package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTMxNjEz", "url": "https://github.com/sleuthkit/autopsy/pull/5648#pullrequestreview-358931613", "createdAt": "2020-02-14T13:15:33Z", "commit": {"oid": "3f25a126f1facae30b5048564287773c22440571"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MTg2Nzkw", "url": "https://github.com/sleuthkit/autopsy/pull/5648#pullrequestreview-359186790", "createdAt": "2020-02-14T20:00:35Z", "commit": {"oid": "3f25a126f1facae30b5048564287773c22440571"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDowMDozNVrOFqCHXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDowMDozNVrOFqCHXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYxOTE2Nw==", "bodyText": "Perhaps it would be better to return null instead of throwing an exception? Nothing has really gone wrong. And then you wouldn't need that empty catch block.", "url": "https://github.com/sleuthkit/autopsy/pull/5648#discussion_r379619167", "createdAt": "2020-02-14T20:00:35Z", "author": {"login": "APriestman"}, "path": "Core/src/org/sleuthkit/autopsy/filequery/FileSearch.java", "diffHunk": "@@ -239,6 +247,80 @@ static SearchResults runFileSearchDebug(String userName,\n         return page;\n     }\n \n+    /**\n+     * Get a summary for the specified AbstractFile if no TextSummarizers exist get\n+     * the first bit of the file.\n+     *\n+     * @param file The AbstractFile to summarize.\n+     *\n+     * @return The summary or first bit of the specified file as a String.\n+     */\n+    @NbBundle.Messages({\"FileSearch.documentSummary.noPreview=No preview available.\",\n+        \"FileSearch.documentSummary.noBytes=No bytes read for document, unable to display preview.\"})\n+    static String summarize(AbstractFile file) {\n+        TextSummarizer localSummarizer = summarizerToUse;\n+        if (localSummarizer == null) {\n+            synchronized (searchCache) {\n+                if (localSummarizer == null) {\n+                    try {\n+                        localSummarizer = getLocalSummarizer();\n+                    } catch (IOException ignored) {\n+                        //no summarizers being present is not unexpected\n+                    }\n+                }\n+            }\n+        }\n+        if (localSummarizer == null) {\n+            //no summarizer was found just grab the first bit of the file\n+            return getFirstLines(file);\n+        } else {\n+            try {\n+                //a summary of length 40 seems to fit without vertical scroll bars\n+                return localSummarizer.summarize(file, 40);\n+            } catch (IOException ex) {\n+                return Bundle.FileSearch_documentSummary_noPreview();\n+            }\n+        }\n+\n+    }\n+\n+    /**\n+     * Get the first bit of text from the specified AbstractFile.\n+     *\n+     * @param file The AbstractFile to get text from.\n+     *\n+     * @return The first bit of text from the specified AbstractFile.\n+     */\n+    private static String getFirstLines(AbstractFile file) {\n+        try (Reader reader = TextExtractorFactory.getExtractor(file, null).getReader()) {\n+            char[] cbuf = new char[PREVIEW_SIZE];\n+            reader.read(cbuf, 0, PREVIEW_SIZE);\n+            return Arrays.toString(cbuf);\n+        } catch (IOException ex) {\n+            return Bundle.FileSearch_documentSummary_noBytes();\n+        } catch (TextExtractorFactory.NoTextExtractorFound | TextExtractor.InitReaderException ex) {\n+            return Bundle.FileSearch_documentSummary_noPreview();\n+        }\n+    }\n+\n+    /**\n+     * Get the first TextSummarizer found by a lookup of TextSummarizers.\n+     *\n+     * @return The first TextSummarizer found by a lookup of TextSummarizers.\n+     *\n+     * @throws IOException\n+     */\n+    private static TextSummarizer getLocalSummarizer() throws IOException {\n+        Collection<? extends TextSummarizer> summarizers\n+                = Lookup.getDefault().lookupAll(TextSummarizer.class\n+                );\n+        if (!summarizers.isEmpty()) {\n+            summarizerToUse = summarizers.iterator().next();\n+            return summarizerToUse;\n+        }\n+        throw new IOException(\"No summarizers found\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f25a126f1facae30b5048564287773c22440571"}, "originalPosition": 125}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c15d73f56125c9301363fe5a79f34aa5defbff65", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/c15d73f56125c9301363fe5a79f34aa5defbff65", "committedDate": "2020-02-18T20:48:37Z", "message": "6040 fix comments to make more clear"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc164739ed3fac131ab6123667a375a9760c357b", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/cc164739ed3fac131ab6123667a375a9760c357b", "committedDate": "2020-02-18T21:35:23Z", "message": "6040 fix codacy issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9093fc4137cb0135375d685c6ce85a23352fb802", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/9093fc4137cb0135375d685c6ce85a23352fb802", "committedDate": "2020-02-19T18:26:21Z", "message": "6040 fix char[] to String conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "425c59e63abaed6ebc11ff339bb8001c1ac5d875", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/425c59e63abaed6ebc11ff339bb8001c1ac5d875", "committedDate": "2020-02-20T15:50:49Z", "message": "6040 inline size and count for doc summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13398f833a96dc6a2a7263c047684de148da1693", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/13398f833a96dc6a2a7263c047684de148da1693", "committedDate": "2020-02-20T23:52:29Z", "message": "6040 add name label to panels to include name of first instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5e84692740498ea305f5e8b92ff80650d1d629e", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/b5e84692740498ea305f5e8b92ff80650d1d629e", "committedDate": "2020-02-21T00:06:34Z", "message": "6040 fix missing bundle message and exceptions from other workers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b7291119f9a9d32a7fec57c367bde25e94a33ba", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/7b7291119f9a9d32a7fec57c367bde25e94a33ba", "committedDate": "2020-02-21T16:38:28Z", "message": "6040 fix paths for name field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b611e6b822ae0b4e1f0c13da3bd9d70692a9ff20", "author": {"user": null}, "url": "https://github.com/sleuthkit/autopsy/commit/b611e6b822ae0b4e1f0c13da3bd9d70692a9ff20", "committedDate": "2020-02-21T18:09:37Z", "message": "6040 fix codacy address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDk2OTY0", "url": "https://github.com/sleuthkit/autopsy/pull/5648#pullrequestreview-363496964", "createdAt": "2020-02-24T15:55:29Z", "commit": {"oid": "b611e6b822ae0b4e1f0c13da3bd9d70692a9ff20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2770, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}