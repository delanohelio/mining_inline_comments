{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MjE4NjQ3", "number": 6236, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowMzoxOFrOEiQQlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTozMTo0MFrOEiQ1Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzUzNDMwOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowMzoxOFrOHQB7mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNjowMVrOHQE0Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MDkwNg==", "bodyText": "I think this is cut and paste error.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486570906", "createdAt": "2020-09-10T19:03:18Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxODE5OQ==", "bodyText": "Yes it is.  Fixed", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486618199", "createdAt": "2020-09-10T20:36:01Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MDkwNg=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzU0MDA3OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowNDo1NVrOHQB_Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNjoyMVrOHQE0-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MTgxNQ==", "bodyText": "Is this check necessary? I think you can just let the for loop recognize there is nothing to process.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486571815", "createdAt": "2020-09-10T19:04:55Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxODM2MQ==", "bodyText": "It was removed and ran fine", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486618361", "createdAt": "2020-09-10T20:36:21Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MTgxNQ=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzU1NDAxOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowOToxMlrOHQCH2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNjozN1rOHQE1dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NDA0Mw==", "bodyText": "I think you can remove this comment, assuming you did change it", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486574043", "createdAt": "2020-09-10T19:09:12Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {\n+            // Run iLeapp\n+\n+            Case currentCase = Case.getCurrentCase();\n+            for (AbstractFile iLeappFile : iLeappFilesToProcess) {\n+\n+                String currentTime = new SimpleDateFormat(\"yyyy-MM-dd HH-mm-ss z\", Locale.US).format(System.currentTimeMillis());//NON-NLS\n+                Path moduleOutputPath = Paths.get(currentCase.getModuleDirectory(), ILEAPP, currentTime);\n+                try {\n+                    Files.createDirectories(moduleOutputPath);\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error creating iLeapp output directory %s\", moduleOutputPath.toString()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                statusHelper.progress(NbBundle.getMessage(this.getClass(), \"ILeappAnalyzerIngestModule.processing.file\", iLeappFile.getName()), filesProcessedCount);\n+                ProcessBuilder iLeappCommand = buildiLeappCommand(moduleOutputPath, iLeappFile.getLocalAbsPath(), iLeappFile.getNameExtension());\n+                try {\n+                    int result = ExecUtil.execute(iLeappCommand, new DataSourceIngestModuleProcessTerminator(context));\n+                    if (result != 0) {\n+                        logger.log(Level.SEVERE, String.format(\"Error running iLeapp, error code returned %d\", result)); //NON-NLS\n+                        return ProcessResult.ERROR;\n+                    }\n+                    \n+                    addILeappReportToReports(moduleOutputPath, currentCase);\n+\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error when trying to execute iLeapp program against file %s\", iLeappFile.getLocalAbsPath()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                if (context.dataSourceIngestIsCancelled()) {\n+                    logger.log(Level.INFO, \"ILeapp Analyser ingest module run was canceled\"); //NON-NLS\n+                    return ProcessResult.OK;\n+                }\n+\n+                ProcessResult fileProcessorResult = iLeappFileProcessor.processFiles(dataSource, moduleOutputPath, iLeappFile);\n+\n+                if (fileProcessorResult == ProcessResult.ERROR) {\n+                    return ProcessResult.ERROR;\n+                }\n+                \n+                filesProcessedCount++;\n+            }\n+\n+        }\n+\n+        IngestMessage message = IngestMessage.createMessage(IngestMessage.MessageType.DATA,\n+                Bundle.ILeappAnalyzerIngestModule_has_run(),\n+                Bundle.ILeappAnalyzerIngestModule_completed());\n+        IngestServices.getInstance().postMessage(message);\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the files to process that will be processed by the iLeapp program\n+     *\n+     * @param dataSource\n+     *\n+     * @return List of abstract files to process.\n+     */\n+    private List<AbstractFile> findiLeappFilesToProcess(Content dataSource) {\n+\n+        List<AbstractFile> iLeappFiles = new ArrayList<>();\n+\n+        FileManager fileManager = getCurrentCase().getServices().getFileManager();\n+\n+        // findFiles use the SQL wildcard # in the file name\n+        try {\n+            iLeappFiles = fileManager.findFiles(dataSource, \"%\", \"/\"); //NON-NLS\n+        } catch (TskCoreException ex) {\n+            //Change this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxODQ4Ng==", "bodyText": "Comment removed", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486618486", "createdAt": "2020-09-10T20:36:37Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {\n+            // Run iLeapp\n+\n+            Case currentCase = Case.getCurrentCase();\n+            for (AbstractFile iLeappFile : iLeappFilesToProcess) {\n+\n+                String currentTime = new SimpleDateFormat(\"yyyy-MM-dd HH-mm-ss z\", Locale.US).format(System.currentTimeMillis());//NON-NLS\n+                Path moduleOutputPath = Paths.get(currentCase.getModuleDirectory(), ILEAPP, currentTime);\n+                try {\n+                    Files.createDirectories(moduleOutputPath);\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error creating iLeapp output directory %s\", moduleOutputPath.toString()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                statusHelper.progress(NbBundle.getMessage(this.getClass(), \"ILeappAnalyzerIngestModule.processing.file\", iLeappFile.getName()), filesProcessedCount);\n+                ProcessBuilder iLeappCommand = buildiLeappCommand(moduleOutputPath, iLeappFile.getLocalAbsPath(), iLeappFile.getNameExtension());\n+                try {\n+                    int result = ExecUtil.execute(iLeappCommand, new DataSourceIngestModuleProcessTerminator(context));\n+                    if (result != 0) {\n+                        logger.log(Level.SEVERE, String.format(\"Error running iLeapp, error code returned %d\", result)); //NON-NLS\n+                        return ProcessResult.ERROR;\n+                    }\n+                    \n+                    addILeappReportToReports(moduleOutputPath, currentCase);\n+\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error when trying to execute iLeapp program against file %s\", iLeappFile.getLocalAbsPath()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                if (context.dataSourceIngestIsCancelled()) {\n+                    logger.log(Level.INFO, \"ILeapp Analyser ingest module run was canceled\"); //NON-NLS\n+                    return ProcessResult.OK;\n+                }\n+\n+                ProcessResult fileProcessorResult = iLeappFileProcessor.processFiles(dataSource, moduleOutputPath, iLeappFile);\n+\n+                if (fileProcessorResult == ProcessResult.ERROR) {\n+                    return ProcessResult.ERROR;\n+                }\n+                \n+                filesProcessedCount++;\n+            }\n+\n+        }\n+\n+        IngestMessage message = IngestMessage.createMessage(IngestMessage.MessageType.DATA,\n+                Bundle.ILeappAnalyzerIngestModule_has_run(),\n+                Bundle.ILeappAnalyzerIngestModule_completed());\n+        IngestServices.getInstance().postMessage(message);\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the files to process that will be processed by the iLeapp program\n+     *\n+     * @param dataSource\n+     *\n+     * @return List of abstract files to process.\n+     */\n+    private List<AbstractFile> findiLeappFilesToProcess(Content dataSource) {\n+\n+        List<AbstractFile> iLeappFiles = new ArrayList<>();\n+\n+        FileManager fileManager = getCurrentCase().getServices().getFileManager();\n+\n+        // findFiles use the SQL wildcard # in the file name\n+        try {\n+            iLeappFiles = fileManager.findFiles(dataSource, \"%\", \"/\"); //NON-NLS\n+        } catch (TskCoreException ex) {\n+            //Change this", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NDA0Mw=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 192}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzU3NTQ1OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOToxNTo0NVrOHQCVVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNzoxMVrOHQE2rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NzQ5NA==", "bodyText": "The first condition should check not empty.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486577494", "createdAt": "2020-09-10T19:15:45Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {\n+            // Run iLeapp\n+\n+            Case currentCase = Case.getCurrentCase();\n+            for (AbstractFile iLeappFile : iLeappFilesToProcess) {\n+\n+                String currentTime = new SimpleDateFormat(\"yyyy-MM-dd HH-mm-ss z\", Locale.US).format(System.currentTimeMillis());//NON-NLS\n+                Path moduleOutputPath = Paths.get(currentCase.getModuleDirectory(), ILEAPP, currentTime);\n+                try {\n+                    Files.createDirectories(moduleOutputPath);\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error creating iLeapp output directory %s\", moduleOutputPath.toString()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                statusHelper.progress(NbBundle.getMessage(this.getClass(), \"ILeappAnalyzerIngestModule.processing.file\", iLeappFile.getName()), filesProcessedCount);\n+                ProcessBuilder iLeappCommand = buildiLeappCommand(moduleOutputPath, iLeappFile.getLocalAbsPath(), iLeappFile.getNameExtension());\n+                try {\n+                    int result = ExecUtil.execute(iLeappCommand, new DataSourceIngestModuleProcessTerminator(context));\n+                    if (result != 0) {\n+                        logger.log(Level.SEVERE, String.format(\"Error running iLeapp, error code returned %d\", result)); //NON-NLS\n+                        return ProcessResult.ERROR;\n+                    }\n+                    \n+                    addILeappReportToReports(moduleOutputPath, currentCase);\n+\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error when trying to execute iLeapp program against file %s\", iLeappFile.getLocalAbsPath()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                if (context.dataSourceIngestIsCancelled()) {\n+                    logger.log(Level.INFO, \"ILeapp Analyser ingest module run was canceled\"); //NON-NLS\n+                    return ProcessResult.OK;\n+                }\n+\n+                ProcessResult fileProcessorResult = iLeappFileProcessor.processFiles(dataSource, moduleOutputPath, iLeappFile);\n+\n+                if (fileProcessorResult == ProcessResult.ERROR) {\n+                    return ProcessResult.ERROR;\n+                }\n+                \n+                filesProcessedCount++;\n+            }\n+\n+        }\n+\n+        IngestMessage message = IngestMessage.createMessage(IngestMessage.MessageType.DATA,\n+                Bundle.ILeappAnalyzerIngestModule_has_run(),\n+                Bundle.ILeappAnalyzerIngestModule_completed());\n+        IngestServices.getInstance().postMessage(message);\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the files to process that will be processed by the iLeapp program\n+     *\n+     * @param dataSource\n+     *\n+     * @return List of abstract files to process.\n+     */\n+    private List<AbstractFile> findiLeappFilesToProcess(Content dataSource) {\n+\n+        List<AbstractFile> iLeappFiles = new ArrayList<>();\n+\n+        FileManager fileManager = getCurrentCase().getServices().getFileManager();\n+\n+        // findFiles use the SQL wildcard # in the file name\n+        try {\n+            iLeappFiles = fileManager.findFiles(dataSource, \"%\", \"/\"); //NON-NLS\n+        } catch (TskCoreException ex) {\n+            //Change this\n+            logger.log(Level.WARNING, \"No files found to process\"); //NON-NLS\n+            return iLeappFiles;\n+        }\n+\n+        List<AbstractFile> iLeappFilesToProcess = new ArrayList<>();\n+        for (AbstractFile iLeappFile : iLeappFiles) {\n+            if ((iLeappFile.getName().toLowerCase().contains(\".zip\") || (iLeappFile.getName().toLowerCase().contains(\".tar\"))\n+                    || iLeappFile.getName().toLowerCase().contains(\".tgz\"))) {\n+                iLeappFilesToProcess.add(iLeappFile);\n+            }\n+        }\n+\n+        return iLeappFilesToProcess;\n+    }\n+\n+    private ProcessBuilder buildiLeappCommand(Path moduleOutputPath, String sourceFilePath, String iLeappFileSystemType) {\n+\n+        ProcessBuilder processBuilder = buildProcessWithRunAsInvoker(\n+                \"\\\"\" + iLeappExecutable + \"\\\"\", //NON-NLS\n+                \"-t\", iLeappFileSystemType, //NON-NLS\n+                \"-i\", sourceFilePath, //NON-NLS\n+                \"-o\", moduleOutputPath.toString()\n+        );\n+        processBuilder.redirectError(moduleOutputPath.resolve(\"iLeapp_err.txt\").toFile());  //NON-NLS\n+        processBuilder.redirectOutput(moduleOutputPath.resolve(\"iLeapp_out.txt\").toFile());  //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    static private ProcessBuilder buildProcessWithRunAsInvoker(String... commandLine) {\n+        ProcessBuilder processBuilder = new ProcessBuilder(commandLine);\n+        /*\n+         * Add an environment variable to force log2timeline/psort to run with\n+         * the same permissions Autopsy uses.\n+         */\n+        processBuilder.environment().put(\"__COMPAT_LAYER\", \"RunAsInvoker\"); //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    private static File locateExecutable(String executableName) throws FileNotFoundException {\n+        String executableToFindName = Paths.get(ILEAPP, executableName).toString();\n+\n+        File exeFile = InstalledFileLocator.getDefault().locate(executableToFindName, ILeappAnalyzerIngestModule.class.getPackage().getName(), false);\n+        if (null == exeFile || exeFile.canExecute() == false) {\n+            throw new FileNotFoundException(executableName + \" executable not found.\");\n+        }\n+        return exeFile;\n+    }\n+\n+    /**\n+     * Find the index.html file in the iLeapp output directory so it can be added to reports\n+     */\n+    private void addILeappReportToReports(Path iLeappOutputDir, Case currentCase) {\n+        List<String> allIndexFiles = new ArrayList<>();\n+\n+        try (Stream<Path> walk = Files.walk(iLeappOutputDir)) {\n+\n+            allIndexFiles = walk.map(x -> x.toString())\n+                    .filter(f -> f.toLowerCase().endsWith(\"index.html\")).collect(Collectors.toList());\n+\n+            if (allIndexFiles.get(0).length() > 2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 252}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxODc5Nw==", "bodyText": "Now checks !allIndexFiles.isEmpty()", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486618797", "createdAt": "2020-09-10T20:37:11Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {\n+            // Run iLeapp\n+\n+            Case currentCase = Case.getCurrentCase();\n+            for (AbstractFile iLeappFile : iLeappFilesToProcess) {\n+\n+                String currentTime = new SimpleDateFormat(\"yyyy-MM-dd HH-mm-ss z\", Locale.US).format(System.currentTimeMillis());//NON-NLS\n+                Path moduleOutputPath = Paths.get(currentCase.getModuleDirectory(), ILEAPP, currentTime);\n+                try {\n+                    Files.createDirectories(moduleOutputPath);\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error creating iLeapp output directory %s\", moduleOutputPath.toString()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                statusHelper.progress(NbBundle.getMessage(this.getClass(), \"ILeappAnalyzerIngestModule.processing.file\", iLeappFile.getName()), filesProcessedCount);\n+                ProcessBuilder iLeappCommand = buildiLeappCommand(moduleOutputPath, iLeappFile.getLocalAbsPath(), iLeappFile.getNameExtension());\n+                try {\n+                    int result = ExecUtil.execute(iLeappCommand, new DataSourceIngestModuleProcessTerminator(context));\n+                    if (result != 0) {\n+                        logger.log(Level.SEVERE, String.format(\"Error running iLeapp, error code returned %d\", result)); //NON-NLS\n+                        return ProcessResult.ERROR;\n+                    }\n+                    \n+                    addILeappReportToReports(moduleOutputPath, currentCase);\n+\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error when trying to execute iLeapp program against file %s\", iLeappFile.getLocalAbsPath()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                if (context.dataSourceIngestIsCancelled()) {\n+                    logger.log(Level.INFO, \"ILeapp Analyser ingest module run was canceled\"); //NON-NLS\n+                    return ProcessResult.OK;\n+                }\n+\n+                ProcessResult fileProcessorResult = iLeappFileProcessor.processFiles(dataSource, moduleOutputPath, iLeappFile);\n+\n+                if (fileProcessorResult == ProcessResult.ERROR) {\n+                    return ProcessResult.ERROR;\n+                }\n+                \n+                filesProcessedCount++;\n+            }\n+\n+        }\n+\n+        IngestMessage message = IngestMessage.createMessage(IngestMessage.MessageType.DATA,\n+                Bundle.ILeappAnalyzerIngestModule_has_run(),\n+                Bundle.ILeappAnalyzerIngestModule_completed());\n+        IngestServices.getInstance().postMessage(message);\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the files to process that will be processed by the iLeapp program\n+     *\n+     * @param dataSource\n+     *\n+     * @return List of abstract files to process.\n+     */\n+    private List<AbstractFile> findiLeappFilesToProcess(Content dataSource) {\n+\n+        List<AbstractFile> iLeappFiles = new ArrayList<>();\n+\n+        FileManager fileManager = getCurrentCase().getServices().getFileManager();\n+\n+        // findFiles use the SQL wildcard # in the file name\n+        try {\n+            iLeappFiles = fileManager.findFiles(dataSource, \"%\", \"/\"); //NON-NLS\n+        } catch (TskCoreException ex) {\n+            //Change this\n+            logger.log(Level.WARNING, \"No files found to process\"); //NON-NLS\n+            return iLeappFiles;\n+        }\n+\n+        List<AbstractFile> iLeappFilesToProcess = new ArrayList<>();\n+        for (AbstractFile iLeappFile : iLeappFiles) {\n+            if ((iLeappFile.getName().toLowerCase().contains(\".zip\") || (iLeappFile.getName().toLowerCase().contains(\".tar\"))\n+                    || iLeappFile.getName().toLowerCase().contains(\".tgz\"))) {\n+                iLeappFilesToProcess.add(iLeappFile);\n+            }\n+        }\n+\n+        return iLeappFilesToProcess;\n+    }\n+\n+    private ProcessBuilder buildiLeappCommand(Path moduleOutputPath, String sourceFilePath, String iLeappFileSystemType) {\n+\n+        ProcessBuilder processBuilder = buildProcessWithRunAsInvoker(\n+                \"\\\"\" + iLeappExecutable + \"\\\"\", //NON-NLS\n+                \"-t\", iLeappFileSystemType, //NON-NLS\n+                \"-i\", sourceFilePath, //NON-NLS\n+                \"-o\", moduleOutputPath.toString()\n+        );\n+        processBuilder.redirectError(moduleOutputPath.resolve(\"iLeapp_err.txt\").toFile());  //NON-NLS\n+        processBuilder.redirectOutput(moduleOutputPath.resolve(\"iLeapp_out.txt\").toFile());  //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    static private ProcessBuilder buildProcessWithRunAsInvoker(String... commandLine) {\n+        ProcessBuilder processBuilder = new ProcessBuilder(commandLine);\n+        /*\n+         * Add an environment variable to force log2timeline/psort to run with\n+         * the same permissions Autopsy uses.\n+         */\n+        processBuilder.environment().put(\"__COMPAT_LAYER\", \"RunAsInvoker\"); //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    private static File locateExecutable(String executableName) throws FileNotFoundException {\n+        String executableToFindName = Paths.get(ILEAPP, executableName).toString();\n+\n+        File exeFile = InstalledFileLocator.getDefault().locate(executableToFindName, ILeappAnalyzerIngestModule.class.getPackage().getName(), false);\n+        if (null == exeFile || exeFile.canExecute() == false) {\n+            throw new FileNotFoundException(executableName + \" executable not found.\");\n+        }\n+        return exeFile;\n+    }\n+\n+    /**\n+     * Find the index.html file in the iLeapp output directory so it can be added to reports\n+     */\n+    private void addILeappReportToReports(Path iLeappOutputDir, Case currentCase) {\n+        List<String> allIndexFiles = new ArrayList<>();\n+\n+        try (Stream<Path> walk = Files.walk(iLeappOutputDir)) {\n+\n+            allIndexFiles = walk.map(x -> x.toString())\n+                    .filter(f -> f.toLowerCase().endsWith(\"index.html\")).collect(Collectors.toList());\n+\n+            if (allIndexFiles.get(0).length() > 2) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NzQ5NA=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 252}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzYxOTU3OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOToyOToxOVrOHQCwzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNzoyNlrOHQE3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NDUyNw==", "bodyText": "You also need to catch UncheckedIOException, a runtime wrapper for IOException. The IOException caught here, according to the Files.walk documentation, is just related to accessing the iLeappOutputDir. If there is a problem while iterating, then UncheckedIOException will be thrown. Checked exception support was never worked into Java 8 streams and lambdas. You can log the underlying IOException by calling ex.getCause() or something like that.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486584527", "createdAt": "2020-09-10T19:29:19Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {\n+            // Run iLeapp\n+\n+            Case currentCase = Case.getCurrentCase();\n+            for (AbstractFile iLeappFile : iLeappFilesToProcess) {\n+\n+                String currentTime = new SimpleDateFormat(\"yyyy-MM-dd HH-mm-ss z\", Locale.US).format(System.currentTimeMillis());//NON-NLS\n+                Path moduleOutputPath = Paths.get(currentCase.getModuleDirectory(), ILEAPP, currentTime);\n+                try {\n+                    Files.createDirectories(moduleOutputPath);\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error creating iLeapp output directory %s\", moduleOutputPath.toString()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                statusHelper.progress(NbBundle.getMessage(this.getClass(), \"ILeappAnalyzerIngestModule.processing.file\", iLeappFile.getName()), filesProcessedCount);\n+                ProcessBuilder iLeappCommand = buildiLeappCommand(moduleOutputPath, iLeappFile.getLocalAbsPath(), iLeappFile.getNameExtension());\n+                try {\n+                    int result = ExecUtil.execute(iLeappCommand, new DataSourceIngestModuleProcessTerminator(context));\n+                    if (result != 0) {\n+                        logger.log(Level.SEVERE, String.format(\"Error running iLeapp, error code returned %d\", result)); //NON-NLS\n+                        return ProcessResult.ERROR;\n+                    }\n+                    \n+                    addILeappReportToReports(moduleOutputPath, currentCase);\n+\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error when trying to execute iLeapp program against file %s\", iLeappFile.getLocalAbsPath()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                if (context.dataSourceIngestIsCancelled()) {\n+                    logger.log(Level.INFO, \"ILeapp Analyser ingest module run was canceled\"); //NON-NLS\n+                    return ProcessResult.OK;\n+                }\n+\n+                ProcessResult fileProcessorResult = iLeappFileProcessor.processFiles(dataSource, moduleOutputPath, iLeappFile);\n+\n+                if (fileProcessorResult == ProcessResult.ERROR) {\n+                    return ProcessResult.ERROR;\n+                }\n+                \n+                filesProcessedCount++;\n+            }\n+\n+        }\n+\n+        IngestMessage message = IngestMessage.createMessage(IngestMessage.MessageType.DATA,\n+                Bundle.ILeappAnalyzerIngestModule_has_run(),\n+                Bundle.ILeappAnalyzerIngestModule_completed());\n+        IngestServices.getInstance().postMessage(message);\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the files to process that will be processed by the iLeapp program\n+     *\n+     * @param dataSource\n+     *\n+     * @return List of abstract files to process.\n+     */\n+    private List<AbstractFile> findiLeappFilesToProcess(Content dataSource) {\n+\n+        List<AbstractFile> iLeappFiles = new ArrayList<>();\n+\n+        FileManager fileManager = getCurrentCase().getServices().getFileManager();\n+\n+        // findFiles use the SQL wildcard # in the file name\n+        try {\n+            iLeappFiles = fileManager.findFiles(dataSource, \"%\", \"/\"); //NON-NLS\n+        } catch (TskCoreException ex) {\n+            //Change this\n+            logger.log(Level.WARNING, \"No files found to process\"); //NON-NLS\n+            return iLeappFiles;\n+        }\n+\n+        List<AbstractFile> iLeappFilesToProcess = new ArrayList<>();\n+        for (AbstractFile iLeappFile : iLeappFiles) {\n+            if ((iLeappFile.getName().toLowerCase().contains(\".zip\") || (iLeappFile.getName().toLowerCase().contains(\".tar\"))\n+                    || iLeappFile.getName().toLowerCase().contains(\".tgz\"))) {\n+                iLeappFilesToProcess.add(iLeappFile);\n+            }\n+        }\n+\n+        return iLeappFilesToProcess;\n+    }\n+\n+    private ProcessBuilder buildiLeappCommand(Path moduleOutputPath, String sourceFilePath, String iLeappFileSystemType) {\n+\n+        ProcessBuilder processBuilder = buildProcessWithRunAsInvoker(\n+                \"\\\"\" + iLeappExecutable + \"\\\"\", //NON-NLS\n+                \"-t\", iLeappFileSystemType, //NON-NLS\n+                \"-i\", sourceFilePath, //NON-NLS\n+                \"-o\", moduleOutputPath.toString()\n+        );\n+        processBuilder.redirectError(moduleOutputPath.resolve(\"iLeapp_err.txt\").toFile());  //NON-NLS\n+        processBuilder.redirectOutput(moduleOutputPath.resolve(\"iLeapp_out.txt\").toFile());  //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    static private ProcessBuilder buildProcessWithRunAsInvoker(String... commandLine) {\n+        ProcessBuilder processBuilder = new ProcessBuilder(commandLine);\n+        /*\n+         * Add an environment variable to force log2timeline/psort to run with\n+         * the same permissions Autopsy uses.\n+         */\n+        processBuilder.environment().put(\"__COMPAT_LAYER\", \"RunAsInvoker\"); //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    private static File locateExecutable(String executableName) throws FileNotFoundException {\n+        String executableToFindName = Paths.get(ILEAPP, executableName).toString();\n+\n+        File exeFile = InstalledFileLocator.getDefault().locate(executableToFindName, ILeappAnalyzerIngestModule.class.getPackage().getName(), false);\n+        if (null == exeFile || exeFile.canExecute() == false) {\n+            throw new FileNotFoundException(executableName + \" executable not found.\");\n+        }\n+        return exeFile;\n+    }\n+\n+    /**\n+     * Find the index.html file in the iLeapp output directory so it can be added to reports\n+     */\n+    private void addILeappReportToReports(Path iLeappOutputDir, Case currentCase) {\n+        List<String> allIndexFiles = new ArrayList<>();\n+\n+        try (Stream<Path> walk = Files.walk(iLeappOutputDir)) {\n+\n+            allIndexFiles = walk.map(x -> x.toString())\n+                    .filter(f -> f.toLowerCase().endsWith(\"index.html\")).collect(Collectors.toList());\n+\n+            if (allIndexFiles.get(0).length() > 2) {\n+                currentCase.addReport(allIndexFiles.get(0), MODULE_NAME, Bundle.ILeappAnalyzerIngestModule_report_name());\n+            }\n+\n+        } catch (IOException | TskCoreException ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 256}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxODkzMA==", "bodyText": "Added exception", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486618930", "createdAt": "2020-09-10T20:37:26Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappAnalyzerIngestModule.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import org.openide.modules.InstalledFileLocator;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import static org.sleuthkit.autopsy.casemodule.Case.getCurrentCase;\n+import org.sleuthkit.autopsy.casemodule.services.FileManager;\n+import org.sleuthkit.autopsy.coreutils.ExecUtil;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModule;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProcessTerminator;\n+import org.sleuthkit.autopsy.ingest.DataSourceIngestModuleProgress;\n+import org.sleuthkit.autopsy.ingest.IngestJobContext;\n+import org.sleuthkit.autopsy.ingest.IngestMessage;\n+import org.sleuthkit.autopsy.ingest.IngestServices;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public class ILeappAnalyzerIngestModule implements DataSourceIngestModule {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappAnalyzerIngestModule.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String ILEAPP = \"iLeapp\"; //NON-NLS\n+    private static final String ILEAPP_EXECUTABLE = \"ileapp.exe\";//NON-NLS\n+\n+    private File iLeappExecutable;\n+\n+    private IngestJobContext context;\n+    \n+    private ILeappFileProcessor iLeappFileProcessor;\n+\n+    ILeappAnalyzerIngestModule() {\n+        // This constructor is intentionally empty. Nothing special is needed here.     \n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.executable.not.found=iLeapp Executable Not Found.\",\n+        \"ILeappAnalyzerIngestModule.requires.windows=iLeapp module requires windows.\",\n+        \"ILeappAnalyzerIngestModule.error.ileapp.file.processor.init=Failure to initialize ILeappProcessFile\"})\n+    @Override\n+    public void startUp(IngestJobContext context) throws IngestModuleException {\n+        this.context = context;\n+\n+        if (false == PlatformUtil.isWindowsOS()) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_requires_windows());\n+        }\n+\n+        try {\n+            iLeappFileProcessor = new ILeappFileProcessor();\n+        } catch (IOException | IngestModuleException ex) {\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_error_ileapp_file_processor_init(), ex);\n+        }\n+\n+        try {\n+            iLeappExecutable = locateExecutable(ILEAPP_EXECUTABLE);\n+        } catch (FileNotFoundException exception) {\n+            logger.log(Level.WARNING, \"iLeapp executable not found.\", exception); //NON-NLS\n+            throw new IngestModuleException(Bundle.ILeappAnalyzerIngestModule_executable_not_found(), exception);\n+        }\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappAnalyzerIngestModule.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappAnalyzerIngestModule.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappAnalyzerIngestModule.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappAnalyzerIngestModule.running.iLeapp=Running iLeapp\",\n+        \"ILeappAnalyzerIngestModule.has.run=iLeapp\",\n+        \"ILeappAnalyzerIngestModule.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappAnalyzerIngestModule.completed=iLeapp Processing Completed\",\n+        \"ILeappAnalyzerIngestModule.report.name=iLeapp Html Report\"})\n+    @Override\n+    public ProcessResult process(Content dataSource, DataSourceIngestModuleProgress statusHelper) {\n+\n+        statusHelper.progress(Bundle.ILeappAnalyzerIngestModule_starting_iLeapp(), 0);\n+\n+        List<AbstractFile> iLeappFilesToProcess = findiLeappFilesToProcess(dataSource);\n+\n+        statusHelper.switchToDeterminate(iLeappFilesToProcess.size());\n+\n+        Integer filesProcessedCount = 0;\n+\n+        if (!iLeappFilesToProcess.isEmpty()) {\n+            // Run iLeapp\n+\n+            Case currentCase = Case.getCurrentCase();\n+            for (AbstractFile iLeappFile : iLeappFilesToProcess) {\n+\n+                String currentTime = new SimpleDateFormat(\"yyyy-MM-dd HH-mm-ss z\", Locale.US).format(System.currentTimeMillis());//NON-NLS\n+                Path moduleOutputPath = Paths.get(currentCase.getModuleDirectory(), ILEAPP, currentTime);\n+                try {\n+                    Files.createDirectories(moduleOutputPath);\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error creating iLeapp output directory %s\", moduleOutputPath.toString()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                statusHelper.progress(NbBundle.getMessage(this.getClass(), \"ILeappAnalyzerIngestModule.processing.file\", iLeappFile.getName()), filesProcessedCount);\n+                ProcessBuilder iLeappCommand = buildiLeappCommand(moduleOutputPath, iLeappFile.getLocalAbsPath(), iLeappFile.getNameExtension());\n+                try {\n+                    int result = ExecUtil.execute(iLeappCommand, new DataSourceIngestModuleProcessTerminator(context));\n+                    if (result != 0) {\n+                        logger.log(Level.SEVERE, String.format(\"Error running iLeapp, error code returned %d\", result)); //NON-NLS\n+                        return ProcessResult.ERROR;\n+                    }\n+                    \n+                    addILeappReportToReports(moduleOutputPath, currentCase);\n+\n+                } catch (IOException ex) {\n+                    logger.log(Level.SEVERE, String.format(\"Error when trying to execute iLeapp program against file %s\", iLeappFile.getLocalAbsPath()), ex);\n+                    return ProcessResult.ERROR;\n+                }\n+\n+                if (context.dataSourceIngestIsCancelled()) {\n+                    logger.log(Level.INFO, \"ILeapp Analyser ingest module run was canceled\"); //NON-NLS\n+                    return ProcessResult.OK;\n+                }\n+\n+                ProcessResult fileProcessorResult = iLeappFileProcessor.processFiles(dataSource, moduleOutputPath, iLeappFile);\n+\n+                if (fileProcessorResult == ProcessResult.ERROR) {\n+                    return ProcessResult.ERROR;\n+                }\n+                \n+                filesProcessedCount++;\n+            }\n+\n+        }\n+\n+        IngestMessage message = IngestMessage.createMessage(IngestMessage.MessageType.DATA,\n+                Bundle.ILeappAnalyzerIngestModule_has_run(),\n+                Bundle.ILeappAnalyzerIngestModule_completed());\n+        IngestServices.getInstance().postMessage(message);\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the files to process that will be processed by the iLeapp program\n+     *\n+     * @param dataSource\n+     *\n+     * @return List of abstract files to process.\n+     */\n+    private List<AbstractFile> findiLeappFilesToProcess(Content dataSource) {\n+\n+        List<AbstractFile> iLeappFiles = new ArrayList<>();\n+\n+        FileManager fileManager = getCurrentCase().getServices().getFileManager();\n+\n+        // findFiles use the SQL wildcard # in the file name\n+        try {\n+            iLeappFiles = fileManager.findFiles(dataSource, \"%\", \"/\"); //NON-NLS\n+        } catch (TskCoreException ex) {\n+            //Change this\n+            logger.log(Level.WARNING, \"No files found to process\"); //NON-NLS\n+            return iLeappFiles;\n+        }\n+\n+        List<AbstractFile> iLeappFilesToProcess = new ArrayList<>();\n+        for (AbstractFile iLeappFile : iLeappFiles) {\n+            if ((iLeappFile.getName().toLowerCase().contains(\".zip\") || (iLeappFile.getName().toLowerCase().contains(\".tar\"))\n+                    || iLeappFile.getName().toLowerCase().contains(\".tgz\"))) {\n+                iLeappFilesToProcess.add(iLeappFile);\n+            }\n+        }\n+\n+        return iLeappFilesToProcess;\n+    }\n+\n+    private ProcessBuilder buildiLeappCommand(Path moduleOutputPath, String sourceFilePath, String iLeappFileSystemType) {\n+\n+        ProcessBuilder processBuilder = buildProcessWithRunAsInvoker(\n+                \"\\\"\" + iLeappExecutable + \"\\\"\", //NON-NLS\n+                \"-t\", iLeappFileSystemType, //NON-NLS\n+                \"-i\", sourceFilePath, //NON-NLS\n+                \"-o\", moduleOutputPath.toString()\n+        );\n+        processBuilder.redirectError(moduleOutputPath.resolve(\"iLeapp_err.txt\").toFile());  //NON-NLS\n+        processBuilder.redirectOutput(moduleOutputPath.resolve(\"iLeapp_out.txt\").toFile());  //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    static private ProcessBuilder buildProcessWithRunAsInvoker(String... commandLine) {\n+        ProcessBuilder processBuilder = new ProcessBuilder(commandLine);\n+        /*\n+         * Add an environment variable to force log2timeline/psort to run with\n+         * the same permissions Autopsy uses.\n+         */\n+        processBuilder.environment().put(\"__COMPAT_LAYER\", \"RunAsInvoker\"); //NON-NLS\n+        return processBuilder;\n+    }\n+\n+    private static File locateExecutable(String executableName) throws FileNotFoundException {\n+        String executableToFindName = Paths.get(ILEAPP, executableName).toString();\n+\n+        File exeFile = InstalledFileLocator.getDefault().locate(executableToFindName, ILeappAnalyzerIngestModule.class.getPackage().getName(), false);\n+        if (null == exeFile || exeFile.canExecute() == false) {\n+            throw new FileNotFoundException(executableName + \" executable not found.\");\n+        }\n+        return exeFile;\n+    }\n+\n+    /**\n+     * Find the index.html file in the iLeapp output directory so it can be added to reports\n+     */\n+    private void addILeappReportToReports(Path iLeappOutputDir, Case currentCase) {\n+        List<String> allIndexFiles = new ArrayList<>();\n+\n+        try (Stream<Path> walk = Files.walk(iLeappOutputDir)) {\n+\n+            allIndexFiles = walk.map(x -> x.toString())\n+                    .filter(f -> f.toLowerCase().endsWith(\"index.html\")).collect(Collectors.toList());\n+\n+            if (allIndexFiles.get(0).length() > 2) {\n+                currentCase.addReport(allIndexFiles.get(0), MODULE_NAME, Bundle.ILeappAnalyzerIngestModule_report_name());\n+            }\n+\n+        } catch (IOException | TskCoreException ex) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NDUyNw=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 256}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzYyMTkyOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTozMDowNlrOHQCyXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNzo1NVrOHQE4IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NDkyNA==", "bodyText": "Same here as well.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486584924", "createdAt": "2020-09-10T19:30:06Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.HashMap;\n+import static java.util.Locale.US;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.commons.io.FilenameUtils;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.autopsy.ingest.IngestModule.ProcessResult;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Blackboard;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.BlackboardAttribute.ATTRIBUTE_TYPE;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.TskException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxOTE2OQ==", "bodyText": "Changed comment", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486619169", "createdAt": "2020-09-10T20:37:55Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.HashMap;\n+import static java.util.Locale.US;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.commons.io.FilenameUtils;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.autopsy.ingest.IngestModule.ProcessResult;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Blackboard;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.BlackboardAttribute.ATTRIBUTE_TYPE;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.TskException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NDkyNA=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzYyNDg1OnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTozMTowMFrOHQC0Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozNzozN1rOHQE3jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTM4Nw==", "bodyText": "This check is not necessary.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486585387", "createdAt": "2020-09-10T19:31:00Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.HashMap;\n+import static java.util.Locale.US;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.commons.io.FilenameUtils;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.autopsy.ingest.IngestModule.ProcessResult;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Blackboard;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.BlackboardAttribute.ATTRIBUTE_TYPE;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.TskException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public final class ILeappFileProcessor {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappFileProcessor.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String XMLFILE = \"ileap-artifact-attribute-reference.xml\"; //NON-NLS\n+\n+    private final Map<String, String> tsvFiles;\n+    private final Map<String, String> tsvFileArtifacts;\n+    private final Map<String, String> tsvFileArtifactComments;\n+    private final Map<String, List<List<String>>> tsvFileAttributes;\n+\n+    public ILeappFileProcessor() throws IOException, IngestModuleException {\n+        this.tsvFiles = new HashMap<>();\n+        this.tsvFileArtifacts = new HashMap<>();\n+        this.tsvFileArtifactComments = new HashMap<>();\n+        this.tsvFileAttributes = new HashMap<>();\n+\n+        configExtractor();\n+        loadConfigFile();\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappFileProcessor.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappFileProcessor.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappFileProcessor.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappFileProcessor.running.iLeapp=Running iLeapp\",\n+        \"ILeappFileProcessor.has.run=iLeapp\",\n+        \"ILeappFileProcessor.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappFileProcessor.completed=iLeapp Processing Completed\",\n+        \"ILeappFileProcessor.error.reading.iLeapp.directory=Error reading iLeapp Output Directory\"})\n+\n+    public ProcessResult processFiles(Content dataSource, Path moduleOutputPath, AbstractFile iLeappFile) {\n+\n+        try {\n+            List<String> iLeappTsvOutputFiles = findTsvFiles(moduleOutputPath);\n+            if (!iLeappTsvOutputFiles.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxOTAyMg==", "bodyText": "Removed check", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486619022", "createdAt": "2020-09-10T20:37:37Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.HashMap;\n+import static java.util.Locale.US;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.commons.io.FilenameUtils;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.autopsy.ingest.IngestModule.ProcessResult;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Blackboard;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.BlackboardAttribute.ATTRIBUTE_TYPE;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.TskException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public final class ILeappFileProcessor {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappFileProcessor.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String XMLFILE = \"ileap-artifact-attribute-reference.xml\"; //NON-NLS\n+\n+    private final Map<String, String> tsvFiles;\n+    private final Map<String, String> tsvFileArtifacts;\n+    private final Map<String, String> tsvFileArtifactComments;\n+    private final Map<String, List<List<String>>> tsvFileAttributes;\n+\n+    public ILeappFileProcessor() throws IOException, IngestModuleException {\n+        this.tsvFiles = new HashMap<>();\n+        this.tsvFileArtifacts = new HashMap<>();\n+        this.tsvFileArtifactComments = new HashMap<>();\n+        this.tsvFileAttributes = new HashMap<>();\n+\n+        configExtractor();\n+        loadConfigFile();\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappFileProcessor.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappFileProcessor.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappFileProcessor.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappFileProcessor.running.iLeapp=Running iLeapp\",\n+        \"ILeappFileProcessor.has.run=iLeapp\",\n+        \"ILeappFileProcessor.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappFileProcessor.completed=iLeapp Processing Completed\",\n+        \"ILeappFileProcessor.error.reading.iLeapp.directory=Error reading iLeapp Output Directory\"})\n+\n+    public ProcessResult processFiles(Content dataSource, Path moduleOutputPath, AbstractFile iLeappFile) {\n+\n+        try {\n+            List<String> iLeappTsvOutputFiles = findTsvFiles(moduleOutputPath);\n+            if (!iLeappTsvOutputFiles.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTM4Nw=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzYyODMwOnYy", "diffSide": "RIGHT", "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTozMTo0MFrOHQC1_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDozODowOFrOHQE4hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTg1Mw==", "bodyText": "See previous comments on Files.walk() in the ingest module, UncheckedIOException should be caught here too.", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486585853", "createdAt": "2020-09-10T19:31:40Z", "author": {"login": "dannysmyda"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.HashMap;\n+import static java.util.Locale.US;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.commons.io.FilenameUtils;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.autopsy.ingest.IngestModule.ProcessResult;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Blackboard;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.BlackboardAttribute.ATTRIBUTE_TYPE;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.TskException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public final class ILeappFileProcessor {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappFileProcessor.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String XMLFILE = \"ileap-artifact-attribute-reference.xml\"; //NON-NLS\n+\n+    private final Map<String, String> tsvFiles;\n+    private final Map<String, String> tsvFileArtifacts;\n+    private final Map<String, String> tsvFileArtifactComments;\n+    private final Map<String, List<List<String>>> tsvFileAttributes;\n+\n+    public ILeappFileProcessor() throws IOException, IngestModuleException {\n+        this.tsvFiles = new HashMap<>();\n+        this.tsvFileArtifacts = new HashMap<>();\n+        this.tsvFileArtifactComments = new HashMap<>();\n+        this.tsvFileAttributes = new HashMap<>();\n+\n+        configExtractor();\n+        loadConfigFile();\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappFileProcessor.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappFileProcessor.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappFileProcessor.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappFileProcessor.running.iLeapp=Running iLeapp\",\n+        \"ILeappFileProcessor.has.run=iLeapp\",\n+        \"ILeappFileProcessor.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappFileProcessor.completed=iLeapp Processing Completed\",\n+        \"ILeappFileProcessor.error.reading.iLeapp.directory=Error reading iLeapp Output Directory\"})\n+\n+    public ProcessResult processFiles(Content dataSource, Path moduleOutputPath, AbstractFile iLeappFile) {\n+\n+        try {\n+            List<String> iLeappTsvOutputFiles = findTsvFiles(moduleOutputPath);\n+            if (!iLeappTsvOutputFiles.isEmpty()) {\n+                processiLeappFiles(iLeappTsvOutputFiles, iLeappFile);\n+            }\n+        } catch (IOException | IngestModuleException ex) {\n+            logger.log(Level.SEVERE, String.format(\"Error trying to process iLeapp output files in directory %s. \", moduleOutputPath.toString()), ex); //NON-NLS\n+            return ProcessResult.ERROR;\n+        }\n+\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the tsv files in the iLeapp output directory and match them to files\n+     * we know we want to process and return the list to process those files.\n+     */\n+    private List<String> findTsvFiles(Path iLeappOutputDir) throws IngestModuleException {\n+        List<String> allTsvFiles = new ArrayList<>();\n+        List<String> foundTsvFiles = new ArrayList<>();\n+\n+        try (Stream<Path> walk = Files.walk(iLeappOutputDir)) {\n+\n+            allTsvFiles = walk.map(x -> x.toString())\n+                    .filter(f -> f.toLowerCase().endsWith(\".tsv\")).collect(Collectors.toList());\n+\n+            for (String tsvFile : allTsvFiles) {\n+                if (tsvFiles.containsKey(FilenameUtils.getName(tsvFile))) {\n+                    foundTsvFiles.add(tsvFile);\n+                }\n+            }\n+\n+        } catch (IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxOTI3MQ==", "bodyText": "Added check for exception", "url": "https://github.com/sleuthkit/autopsy/pull/6236#discussion_r486619271", "createdAt": "2020-09-10T20:38:08Z", "author": {"login": "markmckinnon"}, "path": "Core/src/org/sleuthkit/autopsy/modules/ileappanalyzer/ILeappFileProcessor.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.modules.ileappanalyzer;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.HashMap;\n+import static java.util.Locale.US;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.commons.io.FilenameUtils;\n+import org.openide.util.NbBundle;\n+import org.sleuthkit.autopsy.casemodule.Case;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+import org.sleuthkit.autopsy.coreutils.PlatformUtil;\n+import org.sleuthkit.autopsy.ingest.IngestModule.IngestModuleException;\n+import org.sleuthkit.autopsy.ingest.IngestModule.ProcessResult;\n+import org.sleuthkit.datamodel.AbstractFile;\n+import org.sleuthkit.datamodel.Blackboard;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.BlackboardAttribute.ATTRIBUTE_TYPE;\n+import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.TskException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+/**\n+ * Data source ingest module that runs Plaso against the image.\n+ */\n+public final class ILeappFileProcessor {\n+\n+    private static final Logger logger = Logger.getLogger(ILeappFileProcessor.class.getName());\n+    private static final String MODULE_NAME = ILeappAnalyzerModuleFactory.getModuleName();\n+\n+    private static final String XMLFILE = \"ileap-artifact-attribute-reference.xml\"; //NON-NLS\n+\n+    private final Map<String, String> tsvFiles;\n+    private final Map<String, String> tsvFileArtifacts;\n+    private final Map<String, String> tsvFileArtifactComments;\n+    private final Map<String, List<List<String>>> tsvFileAttributes;\n+\n+    public ILeappFileProcessor() throws IOException, IngestModuleException {\n+        this.tsvFiles = new HashMap<>();\n+        this.tsvFileArtifacts = new HashMap<>();\n+        this.tsvFileArtifactComments = new HashMap<>();\n+        this.tsvFileAttributes = new HashMap<>();\n+\n+        configExtractor();\n+        loadConfigFile();\n+\n+    }\n+\n+    @NbBundle.Messages({\n+        \"ILeappFileProcessor.error.running.iLeapp=Error running iLeapp, see log file.\",\n+        \"ILeappFileProcessor.error.creating.output.dir=Error creating iLeapp module output directory.\",\n+        \"ILeappFileProcessor.starting.iLeapp=Starting iLeapp\",\n+        \"ILeappFileProcessor.running.iLeapp=Running iLeapp\",\n+        \"ILeappFileProcessor.has.run=iLeapp\",\n+        \"ILeappFileProcessor.iLeapp.cancelled=iLeapp run was canceled\",\n+        \"ILeappFileProcessor.completed=iLeapp Processing Completed\",\n+        \"ILeappFileProcessor.error.reading.iLeapp.directory=Error reading iLeapp Output Directory\"})\n+\n+    public ProcessResult processFiles(Content dataSource, Path moduleOutputPath, AbstractFile iLeappFile) {\n+\n+        try {\n+            List<String> iLeappTsvOutputFiles = findTsvFiles(moduleOutputPath);\n+            if (!iLeappTsvOutputFiles.isEmpty()) {\n+                processiLeappFiles(iLeappTsvOutputFiles, iLeappFile);\n+            }\n+        } catch (IOException | IngestModuleException ex) {\n+            logger.log(Level.SEVERE, String.format(\"Error trying to process iLeapp output files in directory %s. \", moduleOutputPath.toString()), ex); //NON-NLS\n+            return ProcessResult.ERROR;\n+        }\n+\n+        return ProcessResult.OK;\n+    }\n+\n+    /**\n+     * Find the tsv files in the iLeapp output directory and match them to files\n+     * we know we want to process and return the list to process those files.\n+     */\n+    private List<String> findTsvFiles(Path iLeappOutputDir) throws IngestModuleException {\n+        List<String> allTsvFiles = new ArrayList<>();\n+        List<String> foundTsvFiles = new ArrayList<>();\n+\n+        try (Stream<Path> walk = Files.walk(iLeappOutputDir)) {\n+\n+            allTsvFiles = walk.map(x -> x.toString())\n+                    .filter(f -> f.toLowerCase().endsWith(\".tsv\")).collect(Collectors.toList());\n+\n+            for (String tsvFile : allTsvFiles) {\n+                if (tsvFiles.containsKey(FilenameUtils.getName(tsvFile))) {\n+                    foundTsvFiles.add(tsvFile);\n+                }\n+            }\n+\n+        } catch (IOException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTg1Mw=="}, "originalCommit": {"oid": "0b10757d3e175a675c1fc3d7c0017449466fc071"}, "originalPosition": 133}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 878, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}