{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4ODAxMTY0", "number": 467, "title": "Fix publish/updated dates CCS-3877 CCS-3879", "bodyText": "Several parts to this PR:\n\nStart recording dates on metadata properly\nReintroduce copying metadata from released version onto draft version\nRefactor version upload servlets to share common code", "createdAt": "2020-11-10T22:26:05Z", "url": "https://github.com/redhataccess/pantheon/pull/467", "merged": true, "mergeCommit": {"oid": "8233bc8b4221a1c5522a0f33a7289057a1c20284"}, "closed": true, "closedAt": "2020-11-18T20:13:05Z", "author": {"login": "benradey"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZXFzlAH2gAyNTE4ODAxMTY0OmY3MThkYzhlNzFkN2FlYjJhYzI4NTJjOWZlZTZjYjI0M2I3MTE1N2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddz0yFgFqTUzMzgyOTc0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f718dc8e71d7aeb2ac2852c9fee6cb243b71157b", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/f718dc8e71d7aeb2ac2852c9fee6cb243b71157b", "committedDate": "2020-11-05T00:19:30Z", "message": "intermediate work toward copying metadata and fixing dates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcdf6b25bf3f99f4f3d918b0886eee6147af6212", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/dcdf6b25bf3f99f4f3d918b0886eee6147af6212", "committedDate": "2020-11-10T21:17:26Z", "message": "Pulling out common code, needs tested"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f4e3d7fb30d2825b8af8d5897345dd19885258", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/d2f4e3d7fb30d2825b8af8d5897345dd19885258", "committedDate": "2020-11-10T22:11:11Z", "message": "Reworking class structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1713183d40a47b6dc1d5c5b8031576f2a224a24", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/d1713183d40a47b6dc1d5c5b8031576f2a224a24", "committedDate": "2020-11-10T22:22:14Z", "message": "misc cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjQ1MjE3", "url": "https://github.com/redhataccess/pantheon/pull/467#pullrequestreview-531645217", "createdAt": "2020-11-16T19:38:35Z", "commit": {"oid": "d1713183d40a47b6dc1d5c5b8031576f2a224a24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTozODozNVrOH0OceA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTozODozNVrOH0OceA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUyNDY2NA==", "bodyText": "what's the difference between pant:datePublished and pant:dateFirstPublished?", "url": "https://github.com/redhataccess/pantheon/pull/467#discussion_r524524664", "createdAt": "2020-11-16T19:38:35Z", "author": {"login": "xdavidson"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/model/document/DocumentMetadata.java", "diffHunk": "@@ -37,6 +37,9 @@\n     @Named(\"pant:datePublished\")\n     Field<Calendar> datePublished();\n \n+    @Named(\"pant:dateFirstPublished\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1713183d40a47b6dc1d5c5b8031576f2a224a24"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjU5NTM1", "url": "https://github.com/redhataccess/pantheon/pull/467#pullrequestreview-531659535", "createdAt": "2020-11-16T19:58:32Z", "commit": {"oid": "d1713183d40a47b6dc1d5c5b8031576f2a224a24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTo1ODozMlrOH0PIqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTo1ODozMlrOH0PIqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUzNTk3OQ==", "bodyText": "should we consider the following two to be added to this list?\n\"pant:headline\"\n\"pant:abstract\"", "url": "https://github.com/redhataccess/pantheon/pull/467#discussion_r524535979", "createdAt": "2020-11-16T19:58:32Z", "author": {"login": "xdavidson"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/util/VersionUploadOperation.java", "diffHunk": "@@ -0,0 +1,161 @@\n+package com.redhat.pantheon.servlet.util;\n+\n+import com.google.common.hash.HashCode;\n+import com.redhat.pantheon.asciidoctor.AsciidoctorService;\n+import com.redhat.pantheon.conf.GlobalConfig;\n+import com.redhat.pantheon.jcr.JcrResources;\n+import com.redhat.pantheon.model.HashableFileResource;\n+import com.redhat.pantheon.model.api.Child;\n+import com.redhat.pantheon.model.api.SlingModels;\n+import com.redhat.pantheon.model.document.Document;\n+import com.redhat.pantheon.model.document.DocumentLocale;\n+import com.redhat.pantheon.model.document.DocumentMetadata;\n+import com.redhat.pantheon.servlet.ServletUtils;\n+import org.apache.commons.lang3.LocaleUtils;\n+import org.apache.sling.api.SlingHttpServletRequest;\n+import org.apache.sling.api.resource.ModifiableValueMap;\n+import org.apache.sling.api.resource.Resource;\n+import org.apache.sling.api.resource.ResourceResolver;\n+import org.apache.sling.servlets.post.AbstractPostOperation;\n+import org.apache.sling.servlets.post.PostResponse;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jcr.Session;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Arrays;\n+import java.util.Calendar;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+public abstract class VersionUploadOperation extends AbstractPostOperation {\n+\n+    private static final Logger log = LoggerFactory.getLogger(VersionUploadOperation.class);\n+\n+    private static final Set<String> METADATA_COPY_EXCLUDES = Collections.unmodifiableSet(\n+            new HashSet<>(\n+                    Arrays.asList(\n+                            \"jcr:description\",\n+                            \"jcr:lastModified\",\n+                            \"jcr:primaryType\",\n+                            \"jcr:title\",\n+                            \"pant:dateUploaded\",\n+                            \"pant:datePublished\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1713183d40a47b6dc1d5c5b8031576f2a224a24"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34d6938e60c4a887bd61cbdedced32dc38c41d9a", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/34d6938e60c4a887bd61cbdedced32dc38c41d9a", "committedDate": "2020-11-18T02:04:53Z", "message": "Code review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODI5NzQy", "url": "https://github.com/redhataccess/pantheon/pull/467#pullrequestreview-533829742", "createdAt": "2020-11-18T20:03:51Z", "commit": {"oid": "34d6938e60c4a887bd61cbdedced32dc38c41d9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1917, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}