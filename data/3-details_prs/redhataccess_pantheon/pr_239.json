{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTMzMjEw", "number": 239, "title": "doc is now rebuilt immediately before sending publish event", "bodyText": "Steps to test:\n\nUpload a doc with content similar to this:\n\nPantheon attributes:\n\nshowtitle: {showtitle}\n\npantheonproduct: {pantheonproduct}\n\npantheonversion: {pantheonversion}\n\npantheonupdateddate: {pantheonupdateddate}\n\npantheonpublisheddate: {pantheonpublisheddate}\n\n\nDon't assign metadata\nPreview the doc\nAssign all necessary metadata\nPublish the doc\nView the rendered doc\nOld behavior: variables are missing\nNew behavior: variables are available", "createdAt": "2020-02-26T22:11:20Z", "url": "https://github.com/redhataccess/pantheon/pull/239", "merged": true, "mergeCommit": {"oid": "7c018be059c1bb1a7ff1ec390733fe9ed05dd0a9"}, "closed": true, "closedAt": "2020-02-27T21:17:58Z", "author": {"login": "benradey"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIOLkZgH2gAyMzgwNTMzMjEwOmQ2OTRiYTFiMDcwZmVlYTdlMzRlMGQyNGQ2M2FhYTBlNzcwNGY5ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIg4g5AFqTM2NTk1NTQ2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d694ba1b070feea7e34e0d24d63aaa0e7704f985", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/d694ba1b070feea7e34e0d24d63aaa0e7704f985", "committedDate": "2020-02-26T22:08:47Z", "message": "doc is now rebuilt immediately before sending publish event"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzcwMDc1", "url": "https://github.com/redhataccess/pantheon/pull/239#pullrequestreview-365370075", "createdAt": "2020-02-27T02:01:27Z", "commit": {"oid": "d694ba1b070feea7e34e0d24d63aaa0e7704f985"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMjowMToyN1rOFvC32A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMjowMjoyNVrOFvC4qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3NDQ1Ng==", "bodyText": "seems like we already have fetched some of those values:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Optional<ModuleVersion> versionToRelease = getModule(request).getReleasedVersion(getLocale(request));\n          \n          \n            \n                        Optional<ModuleVersion> versionToRelease = module.getReleasedVersion(locale);", "url": "https://github.com/redhataccess/pantheon/pull/239#discussion_r384874456", "createdAt": "2020-02-27T02:01:27Z", "author": {"login": "carlosmunoz"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/module/PublishDraftVersion.java", "diffHunk": "@@ -58,6 +63,14 @@ public void run(SlingHttpServletRequest request, PostResponse response, SlingPos\n             Locale locale = getLocale(request);\n             Module module = getModule(request);\n             ModuleLocale moduleLocale = module.getModuleLocale(locale);\n+\n+\n+            //FIXME - this is a hack that needs to be removed when we have the attribute placeholder logic implemented\n+            Optional<ModuleVersion> versionToRelease = getModule(request).getReleasedVersion(getLocale(request));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d694ba1b070feea7e34e0d24d63aaa0e7704f985"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3NDY2NQ==", "bodyText": "not sure we need this... an empty context will do in this scenario", "url": "https://github.com/redhataccess/pantheon/pull/239#discussion_r384874665", "createdAt": "2020-02-27T02:02:25Z", "author": {"login": "carlosmunoz"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/module/PublishDraftVersion.java", "diffHunk": "@@ -58,6 +63,14 @@ public void run(SlingHttpServletRequest request, PostResponse response, SlingPos\n             Locale locale = getLocale(request);\n             Module module = getModule(request);\n             ModuleLocale moduleLocale = module.getModuleLocale(locale);\n+\n+\n+            //FIXME - this is a hack that needs to be removed when we have the attribute placeholder logic implemented\n+            Optional<ModuleVersion> versionToRelease = getModule(request).getReleasedVersion(getLocale(request));\n+            Map<String, Object> context = asciidoctorService.buildContextFromRequest(request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d694ba1b070feea7e34e0d24d63aaa0e7704f985"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea4b7648aeb2e95cfd9c3fabf4f7e44f38c0596b", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/ea4b7648aeb2e95cfd9c3fabf4f7e44f38c0596b", "committedDate": "2020-02-27T15:47:21Z", "message": "Simplifying due to review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1OTU1NDY4", "url": "https://github.com/redhataccess/pantheon/pull/239#pullrequestreview-365955468", "createdAt": "2020-02-27T19:56:10Z", "commit": {"oid": "ea4b7648aeb2e95cfd9c3fabf4f7e44f38c0596b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2059, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}