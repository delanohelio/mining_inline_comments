{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMDg4NTM4", "number": 253, "title": "Ccs 3469 uploader", "bodyText": "This PR makes the following changes:\n\n\nadds a custom node type for repository: pant:bucket\n\n\nupdate uploader so that it adds standalongAttributeFile property for pantheon/bucket resource", "createdAt": "2020-03-17T21:32:19Z", "url": "https://github.com/redhataccess/pantheon/pull/253", "merged": true, "mergeCommit": {"oid": "615c4080818eb3d98bd6493873a0f497307c24ee"}, "closed": true, "closedAt": "2020-03-24T18:46:44Z", "author": {"login": "xdavidson"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOoKpLgH2gAyMzkwMDg4NTM4OjNkZWI3ZTZlNjYwZTVkMGRjNGU3ZjYyYmY4MGJiODdjOTI1YTc5YzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ3WkZAFqTM4MDU5NTE1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3deb7e6e660e5d0dc4e7f62bf80bb87c925a79c4", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/3deb7e6e660e5d0dc4e7f62bf80bb87c925a79c4", "committedDate": "2020-03-17T19:48:51Z", "message": "add new node type pant:bucket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c137b1e08b91cf75d82d5995e84270df6805d19b", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/c137b1e08b91cf75d82d5995e84270df6805d19b", "committedDate": "2020-03-17T21:15:47Z", "message": "process bucket name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f", "committedDate": "2020-03-17T21:29:41Z", "message": "update node type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODgwNzM4", "url": "https://github.com/redhataccess/pantheon/pull/253#pullrequestreview-376880738", "createdAt": "2020-03-18T13:50:50Z", "commit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMzo1MDo1MVrOF4F1Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMzo1MDo1MVrOF4F1Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2MDA4Ng==", "bodyText": "Is camel-casing the right standard for yaml files?\nAlso, are you envisioning this as an attributes' file for the whole repository? or just modules? If the latter, I would consider naming this something like moduleAttributesFile", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394360086", "createdAt": "2020-03-18T13:50:51Z", "author": {"login": "carlosmunoz"}, "path": "uploader/pantheon.py", "diffHunk": "@@ -108,6 +123,7 @@ def _print_response(filetype, path, response_code, reason):\n \n server: http://localhost:8080\n repository: pantheonSampleRepo\n+attributeFile: path/to/attribute.adoc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDAwMDU3", "url": "https://github.com/redhataccess/pantheon/pull/253#pullrequestreview-377000057", "createdAt": "2020-03-18T15:52:33Z", "commit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTo1MjozM1rOF4Lg3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTo1MjozM1rOF4Lg3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1MzIxNQ==", "bodyText": "I asked earlier in our QA call but I'll ask here so it's recorded - why is creating this new type necessary?", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394453215", "createdAt": "2020-03-18T15:52:33Z", "author": {"login": "benradey"}, "path": "pantheon-bundle/src/main/resources/SLING-INF/nodetypes/nodetypes.cnd", "diffHunk": "@@ -57,6 +57,8 @@\n [pant:symlink] > nt:unstructured\n     - sling:resourceType (string) = 'pantheon/symlink' mandatory autocreated\n \n+[pant:bucket] > nt:unstructured, mix:created, mix:lastModified\n+    - sling:resourceType (string) = 'pantheon/bucket' mandatory autocreated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDAyNTg2", "url": "https://github.com/redhataccess/pantheon/pull/253#pullrequestreview-377002586", "createdAt": "2020-03-18T15:54:57Z", "commit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTo1NDo1OFrOF4Losw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTo1NDo1OFrOF4Losw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1NTIxOQ==", "bodyText": "Is this part of some doc syntax that I'm not familiar with? Otherwise, it looks like these lines are unnecessary, since you describe the method above.", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r394455219", "createdAt": "2020-03-18T15:54:58Z", "author": {"login": "benradey"}, "path": "uploader/pantheon.py", "diffHunk": "@@ -180,6 +197,9 @@ def process_file(path, filetype):\n \n     Returns:\n     list: It returns a list with value of the API call status_code and reason\n+    :param path:\n+    :param filetype:\n+    :return:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84a1337a5087d36f9f808a3db7e8cdf1c6cc9f"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6339c75deaaa0ab389a6c93783fb4426d09beddc", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/6339c75deaaa0ab389a6c93783fb4426d09beddc", "committedDate": "2020-03-18T17:32:19Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1535ee64df67ee4870f8c1baf5eb29ebbe1890ee", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/1535ee64df67ee4870f8c1baf5eb29ebbe1890ee", "committedDate": "2020-03-18T19:02:33Z", "message": "remove pant:bucket node definition per team feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5798d1d2c606c22769701706d0ed2139e9019d", "author": {"user": {"login": "jmarrero", "name": "Joseph Marrero Corchado"}}, "url": "https://github.com/redhataccess/pantheon/commit/1a5798d1d2c606c22769701706d0ed2139e9019d", "committedDate": "2020-03-19T16:26:00Z", "message": "Use attributeFile to build adoc if it is available."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a705471ba46caf76c014e4ac83888af64f304da", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/2a705471ba46caf76c014e4ac83888af64f304da", "committedDate": "2020-03-19T17:44:30Z", "message": "update logic for multi repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5212db03ea23e8bb079f25dcdc07264999cad78b", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/5212db03ea23e8bb079f25dcdc07264999cad78b", "committedDate": "2020-03-19T17:45:45Z", "message": "rename attribute property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a6cb96ab4cd330cad302505136a0123bc001a0", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/02a6cb96ab4cd330cad302505136a0123bc001a0", "committedDate": "2020-03-19T20:37:04Z", "message": "add logic to handle multi repositories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d83a68b2a1d8c1b8a2b7fb83efcabab33ea9dc", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/f7d83a68b2a1d8c1b8a2b7fb83efcabab33ea9dc", "committedDate": "2020-03-19T20:37:47Z", "message": "Merge branch 'CCS-3469_uploader_multirepo' into CCS-3469_uploader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1923bea664e1f7d7e4e39e674f4641732faf76e", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/e1923bea664e1f7d7e4e39e674f4641732faf76e", "committedDate": "2020-03-20T14:39:10Z", "message": "rename pant:bucket to pant:workspace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729ef78e85e4404818574f45425ad099df182041", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/729ef78e85e4404818574f45425ad099df182041", "committedDate": "2020-03-20T14:55:17Z", "message": "add back primaryType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bb3d76c5967db88ee60783c5648f9401e53cfe2", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/5bb3d76c5967db88ee60783c5648f9401e53cfe2", "committedDate": "2020-03-20T14:58:22Z", "message": "Model updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1026dbc3894072d54faff48e9f8a139097c697c", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/b1026dbc3894072d54faff48e9f8a139097c697c", "committedDate": "2020-03-20T14:58:57Z", "message": "Merge branch 'CCS-3469_uploader' into benHacks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29a5c483282055d23670b69f110ddae62a1e0102", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/29a5c483282055d23670b69f110ddae62a1e0102", "committedDate": "2020-03-20T15:12:31Z", "message": "add referenceable for future needs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15e88e10312f35a8ea2b35eeba8b2554f8c9590e", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/15e88e10312f35a8ea2b35eeba8b2554f8c9590e", "committedDate": "2020-03-20T15:20:23Z", "message": "rename bucket to workspace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04abc6b07dd75f1f67e9d10c91757763a0511c56", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/04abc6b07dd75f1f67e9d10c91757763a0511c56", "committedDate": "2020-03-20T15:28:46Z", "message": "Working code, broken test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac46f95c3589dc22f6fd9e32b20d99e72b0e4ad7", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/ac46f95c3589dc22f6fd9e32b20d99e72b0e4ad7", "committedDate": "2020-03-20T15:38:21Z", "message": "removed printlns, working tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea648895119934276c047049dbf9bcfbc77a3bb7", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/ea648895119934276c047049dbf9bcfbc77a3bb7", "committedDate": "2020-03-20T15:41:38Z", "message": "Merge pull request #4 from benradey/benHacks\n\nBen hacks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3643e9de6dedff26720fadb4f1c8601df4483870", "author": {"user": {"login": "jmarrero", "name": "Joseph Marrero Corchado"}}, "url": "https://github.com/redhataccess/pantheon/commit/3643e9de6dedff26720fadb4f1c8601df4483870", "committedDate": "2020-03-20T18:29:32Z", "message": "Add workspace model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7e776d5b36004b7fd8ff7e45c2e754c44eae084", "author": {"user": {"login": "jmarrero", "name": "Joseph Marrero Corchado"}}, "url": "https://github.com/redhataccess/pantheon/commit/e7e776d5b36004b7fd8ff7e45c2e754c44eae084", "committedDate": "2020-03-23T18:03:22Z", "message": "use the Workspace.class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be410a4f6da3c1858e367ef39f114a26ad858e05", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/be410a4f6da3c1858e367ef39f114a26ad858e05", "committedDate": "2020-03-23T18:05:13Z", "message": "Merge pull request #5 from jmarrero/CCS-3468b\n\nUpdates to include Workspace model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc53d5bccce97fc626477cc5b72c746d44ba981", "author": {"user": {"login": "benradey", "name": "Ben Radey"}}, "url": "https://github.com/redhataccess/pantheon/commit/8cc53d5bccce97fc626477cc5b72c746d44ba981", "committedDate": "2020-03-23T20:52:59Z", "message": "Tweaks made and tests pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14eb808731335b35bbeb43ba50348908473e1c92", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/14eb808731335b35bbeb43ba50348908473e1c92", "committedDate": "2020-03-23T21:04:36Z", "message": "Merge pull request #6 from benradey/modelUsageTweak\n\nTweaks made and tests pass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODQ3NDgx", "url": "https://github.com/redhataccess/pantheon/pull/253#pullrequestreview-379847481", "createdAt": "2020-03-23T21:48:06Z", "commit": {"oid": "14eb808731335b35bbeb43ba50348908473e1c92"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTo0ODowNlrOF6ZV0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTo0ODowNlrOF6ZV0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NjkxNA==", "bodyText": "Since process_workspace is the method that creates the pant:workspace jcr node, this should run regardless of the presence of any attributeFile.", "url": "https://github.com/redhataccess/pantheon/pull/253#discussion_r396776914", "createdAt": "2020-03-23T21:48:06Z", "author": {"login": "benradey"}, "path": "uploader/pantheon.py", "diffHunk": "@@ -325,27 +354,58 @@ def processRegexMatches(files, globs, filetype):\n     sys.exit('server ' + server + ' is not reachable')\n \n _info('Using server: ' + server)\n-_info('Using ' + mode + ': ' + repository)\n-print('--------------')\n-\n-moduleGlobs = readYamlGlob(config, 'modules')\n-resourceGlobs = readYamlGlob(config, 'resources')\n-non_resource_files = []\n-logger.debug('moduleGlobs: %s', moduleGlobs)\n-logger.debug('resourceGlobs: %s', resourceGlobs)\n-logger.debug('args.directory: %s', args.directory)\n-\n-# List all files in the directory\n-allFiles = []\n-listdir_recursive(args.directory, allFiles)\n-\n-processRegexMatches(allFiles, resourceGlobs, 'resources')\n-processRegexMatches(allFiles, moduleGlobs, 'modules')\n-\n-leftoverFiles = len(allFiles)\n-if leftoverFiles > 0:\n-    _warn(f'{leftoverFiles} additional files detected but not uploaded. Only files specified in '\n-          + CONFIG_FILE\n-          + ' are handled for upload.')\n+\n+if len(config.keys()) > 0 and 'repositories' in config:\n+    for repo_list in config['repositories']:\n+        repository = resolveOption(args.repository, '', repo_list['name'])\n+        # Enforce a repository being set in the pantheon.yml\n+        if repository == \"\" and mode == 'repository':\n+            sys.exit('repository is not set')\n+\n+        mode = 'sandbox' if args.sandbox else 'repository'\n+        # override repository if sandbox is chosen (sandbox name is the user name)\n+        if args.sandbox:\n+            repository = args.user\n+\n+        if 'attributes' in repo_list:\n+            attributeFile = resolveOption(args.attrFile, '', repo_list['attributes'])\n+        else:\n+            attributeFile = resolveOption(args.attrFile, '', '')\n+\n+        if attributeFile and not os.path.isfile(attributeFile.strip()):\n+            sys.exit('attributes: ' + attributeFile + ' does not exist.')\n+\n+        _info('Using ' + mode + ': ' + repository)\n+        _info('Using attributes: ' + attributeFile)\n+        print('--------------')\n+\n+        if attributeFile:\n+            process_workspace(repository)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14eb808731335b35bbeb43ba50348908473e1c92"}, "originalPosition": 234}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f94389abf7f74f1d3f0d4f0e0f02a5ba44226d7", "author": {"user": {"login": "jmarrero", "name": "Joseph Marrero Corchado"}}, "url": "https://github.com/redhataccess/pantheon/commit/0f94389abf7f74f1d3f0d4f0e0f02a5ba44226d7", "committedDate": "2020-03-24T18:15:03Z", "message": "Make sure that the full path to the attrFile is used when building the module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f803541cf0a5cd7c34252d53f8006b771f9da553", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/f803541cf0a5cd7c34252d53f8006b771f9da553", "committedDate": "2020-03-24T18:17:40Z", "message": "Merge pull request #7 from jmarrero/CCS-3468c\n\nUse the full path to the attributeFile when building the module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7827dbf24e9dd6d15ed8c51b1268b57de26ade58", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/7827dbf24e9dd6d15ed8c51b1268b57de26ade58", "committedDate": "2020-03-24T18:31:59Z", "message": "bug fix around attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "439535829e5dcc7c4e34ee06fa00cd1de5aa2016", "author": {"user": {"login": "xdavidson", "name": "Lisa Davidson"}}, "url": "https://github.com/redhataccess/pantheon/commit/439535829e5dcc7c4e34ee06fa00cd1de5aa2016", "committedDate": "2020-03-24T18:36:04Z", "message": "remove debugging lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTk1MTU2", "url": "https://github.com/redhataccess/pantheon/pull/253#pullrequestreview-380595156", "createdAt": "2020-03-24T18:38:18Z", "commit": {"oid": "439535829e5dcc7c4e34ee06fa00cd1de5aa2016"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2065, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}