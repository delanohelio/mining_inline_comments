{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NjQyNjA5", "number": 287, "title": "add a more compact null-safe way to traverse jcr structures using models", "bodyText": "Add a more compact null-safe way to traverse jcr structures using models.\nThis revision deprecates the existing Child.map method and adds a similar but more compact way to do complex JCR structure traversals and avoid null elements in the path.\nSee the unit tests for the way to use it.", "createdAt": "2020-05-09T23:08:34Z", "url": "https://github.com/redhataccess/pantheon/pull/287", "merged": true, "mergeCommit": {"oid": "8495d53b47d59a51b13817ea0f2ceedfe3d68d33"}, "closed": true, "closedAt": "2020-05-11T18:30:48Z", "author": {"login": "carlosmunoz"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfuvg-AH2gAyNDE1NjQyNjA5OmU4YTQ4OTBhMWQ4ZWFhZWE0ODIxZWYwN2RhZGRhZjEwYzk4ZWM2NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgT_n-gFqTQwOTQyMzYyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8a4890a1d8eaaea4821ef07daddaf10c98ec65e", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/e8a4890a1d8eaaea4821ef07daddaf10c98ec65e", "committedDate": "2020-05-09T23:05:16Z", "message": "add a more compact null-safe way to traverse jcr structures using models"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Mzg0NjYy", "url": "https://github.com/redhataccess/pantheon/pull/287#pullrequestreview-409384662", "createdAt": "2020-05-11T17:35:19Z", "commit": {"oid": "e8a4890a1d8eaaea4821ef07daddaf10c98ec65e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzozNToxOVrOGTmavg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzo0OTowOVrOGTm5Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwNTU2Ng==", "bodyText": "I have a question. Why are we using an unbounded wildcard type for EMPTY instead of <T>?", "url": "https://github.com/redhataccess/pantheon/pull/287#discussion_r423205566", "createdAt": "2020-05-11T17:35:19Z", "author": {"login": "xdavidson"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/model/api/util/SafeResourceTraversal.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.redhat.pantheon.model.api.util;\n+\n+import com.redhat.pantheon.model.api.Child;\n+import com.redhat.pantheon.model.api.Field;\n+import com.redhat.pantheon.model.api.SlingModel;\n+\n+import javax.annotation.Nullable;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+import static java.util.Optional.ofNullable;\n+\n+/**\n+ * Utility class which offers a null-safe way to traverse deep {@link SlingModel}\n+ * structures. Traversals represent paths across multiple nodes ending in deeper\n+ * child nodes, or properties. If any of the intermediary nodes is not present, the whole traversal\n+ * will still conclude, with a final result of null.<br/>\n+ * <br/>\n+ * To use it, invoke the {@link SafeResourceTraversal#start(SlingModel)} method with a\n+ * model to be traversed. From there on, the whole structure may be traversed all the\n+ * way down to specific fields.\n+ *\n+ * @author Carlos Munoz\n+ */\n+public class SafeResourceTraversal<T extends SlingModel> implements Supplier<T> {\n+\n+    private static final SafeResourceTraversal<?> EMPTY = new SafeResourceTraversal<>(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8a4890a1d8eaaea4821ef07daddaf10c98ec65e"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxMDk4Ng==", "bodyText": "never mind. Further down  i see we have genetic types of <T> or <U> or <P>", "url": "https://github.com/redhataccess/pantheon/pull/287#discussion_r423210986", "createdAt": "2020-05-11T17:44:49Z", "author": {"login": "xdavidson"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/model/api/util/SafeResourceTraversal.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.redhat.pantheon.model.api.util;\n+\n+import com.redhat.pantheon.model.api.Child;\n+import com.redhat.pantheon.model.api.Field;\n+import com.redhat.pantheon.model.api.SlingModel;\n+\n+import javax.annotation.Nullable;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+import static java.util.Optional.ofNullable;\n+\n+/**\n+ * Utility class which offers a null-safe way to traverse deep {@link SlingModel}\n+ * structures. Traversals represent paths across multiple nodes ending in deeper\n+ * child nodes, or properties. If any of the intermediary nodes is not present, the whole traversal\n+ * will still conclude, with a final result of null.<br/>\n+ * <br/>\n+ * To use it, invoke the {@link SafeResourceTraversal#start(SlingModel)} method with a\n+ * model to be traversed. From there on, the whole structure may be traversed all the\n+ * way down to specific fields.\n+ *\n+ * @author Carlos Munoz\n+ */\n+public class SafeResourceTraversal<T extends SlingModel> implements Supplier<T> {\n+\n+    private static final SafeResourceTraversal<?> EMPTY = new SafeResourceTraversal<>(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwNTU2Ng=="}, "originalCommit": {"oid": "e8a4890a1d8eaaea4821ef07daddaf10c98ec65e"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxMjY3Mg==", "bodyText": "can we name the generic type from <P> to <F>? I think the convention is to take the First letter of the type parameter.", "url": "https://github.com/redhataccess/pantheon/pull/287#discussion_r423212672", "createdAt": "2020-05-11T17:47:48Z", "author": {"login": "xdavidson"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/model/api/util/SafeResourceTraversal.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.redhat.pantheon.model.api.util;\n+\n+import com.redhat.pantheon.model.api.Child;\n+import com.redhat.pantheon.model.api.Field;\n+import com.redhat.pantheon.model.api.SlingModel;\n+\n+import javax.annotation.Nullable;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+import static java.util.Optional.ofNullable;\n+\n+/**\n+ * Utility class which offers a null-safe way to traverse deep {@link SlingModel}\n+ * structures. Traversals represent paths across multiple nodes ending in deeper\n+ * child nodes, or properties. If any of the intermediary nodes is not present, the whole traversal\n+ * will still conclude, with a final result of null.<br/>\n+ * <br/>\n+ * To use it, invoke the {@link SafeResourceTraversal#start(SlingModel)} method with a\n+ * model to be traversed. From there on, the whole structure may be traversed all the\n+ * way down to specific fields.\n+ *\n+ * @author Carlos Munoz\n+ */\n+public class SafeResourceTraversal<T extends SlingModel> implements Supplier<T> {\n+\n+    private static final SafeResourceTraversal<?> EMPTY = new SafeResourceTraversal<>(null);\n+\n+    private final Optional<T> currentResource;\n+\n+    private SafeResourceTraversal(T resource) {\n+        this.currentResource = ofNullable(resource);\n+    }\n+\n+    /**\n+     * Starts a safe traversal.\n+     * @param model The {@link SlingModel} to traverse.\n+     * @param <U>\n+     * @return A traversal object starting from the given {@link SlingModel}. If the model\n+     * is null, traversals will still conclude but will always yield null results.\n+     */\n+    public static final <U extends SlingModel> SafeResourceTraversal<U> start(@Nullable U model) {\n+        return new SafeResourceTraversal<>(model);\n+    }\n+\n+    /**\n+     * Traverses the current node in the traversal, down to one of its children.\n+     * @param childAccessor A function that returns a {@link Child} of the current resource.\n+     * @param <U>\n+     * @return A resource traversal at the child accessed via the child accessor.\n+     */\n+    public <U extends SlingModel> SafeResourceTraversal<U> traverse(Function<? super T, Child<U>> childAccessor) {\n+        if(currentResource.isPresent()) {\n+            Child<U> nextTraversalChild = childAccessor.apply(currentResource.get());\n+            return new SafeResourceTraversal<>(nextTraversalChild.get());\n+        }\n+        return (SafeResourceTraversal<U>) EMPTY;\n+    }\n+\n+    /**\n+     * Traverses to a field in the current traversed node. This represents and end\n+     * to the traversal as there is nothing to traverse from a field.\n+     * @param fieldAccessor A function that returns a {@link Field} from the current resource.\n+     * @param <P>\n+     * @return An optional containing the value of the field. If the field is not present, or if\n+     * any of the intermediary nodes in the traversal was not present, this optional is empty.\n+     */\n+    public <P> Optional<P> field(Function<? super T, Field<P>> fieldAccessor) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8a4890a1d8eaaea4821ef07daddaf10c98ec65e"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxMzQxNA==", "bodyText": "Can we rename to generic <U> to <M>? Since the type parameter if model...", "url": "https://github.com/redhataccess/pantheon/pull/287#discussion_r423213414", "createdAt": "2020-05-11T17:49:09Z", "author": {"login": "xdavidson"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/model/api/util/SafeResourceTraversal.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.redhat.pantheon.model.api.util;\n+\n+import com.redhat.pantheon.model.api.Child;\n+import com.redhat.pantheon.model.api.Field;\n+import com.redhat.pantheon.model.api.SlingModel;\n+\n+import javax.annotation.Nullable;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+import static java.util.Optional.ofNullable;\n+\n+/**\n+ * Utility class which offers a null-safe way to traverse deep {@link SlingModel}\n+ * structures. Traversals represent paths across multiple nodes ending in deeper\n+ * child nodes, or properties. If any of the intermediary nodes is not present, the whole traversal\n+ * will still conclude, with a final result of null.<br/>\n+ * <br/>\n+ * To use it, invoke the {@link SafeResourceTraversal#start(SlingModel)} method with a\n+ * model to be traversed. From there on, the whole structure may be traversed all the\n+ * way down to specific fields.\n+ *\n+ * @author Carlos Munoz\n+ */\n+public class SafeResourceTraversal<T extends SlingModel> implements Supplier<T> {\n+\n+    private static final SafeResourceTraversal<?> EMPTY = new SafeResourceTraversal<>(null);\n+\n+    private final Optional<T> currentResource;\n+\n+    private SafeResourceTraversal(T resource) {\n+        this.currentResource = ofNullable(resource);\n+    }\n+\n+    /**\n+     * Starts a safe traversal.\n+     * @param model The {@link SlingModel} to traverse.\n+     * @param <U>\n+     * @return A traversal object starting from the given {@link SlingModel}. If the model\n+     * is null, traversals will still conclude but will always yield null results.\n+     */\n+    public static final <U extends SlingModel> SafeResourceTraversal<U> start(@Nullable U model) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8a4890a1d8eaaea4821ef07daddaf10c98ec65e"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "148232b69b59524f3a4a2f716c0d97a397730a84", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/148232b69b59524f3a4a2f716c0d97a397730a84", "committedDate": "2020-05-11T18:02:06Z", "message": "review corrections: rename type parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDIzNjIw", "url": "https://github.com/redhataccess/pantheon/pull/287#pullrequestreview-409423620", "createdAt": "2020-05-11T18:29:21Z", "commit": {"oid": "148232b69b59524f3a4a2f716c0d97a397730a84"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2119, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}