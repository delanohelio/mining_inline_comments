{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NTM2OTQ0", "number": 214, "title": "Module query modifications", "bodyText": "nt:base is not needed anymore after removing the modules.json index. The index was having unintended consequences making the query not return results when we use pant:modules.", "createdAt": "2020-01-23T19:52:27Z", "url": "https://github.com/redhataccess/pantheon/pull/214", "merged": true, "mergeCommit": {"oid": "5803702537b1e22fd911bf2f9f5c8803e26e6b7f"}, "closed": true, "closedAt": "2020-01-28T14:47:44Z", "author": {"login": "jmarrero"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9Am9mAH2gAyMzY2NTM2OTQ0OjEyNzQ4NGQzYTQ1NTMyZGYwYWMxN2Q0M2U1NWJkMmUyMzFjMmI4YjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-xiEwAFqTM0OTM3OTU0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "127484d3a45532df0ac17d43e55bd2e231c2b8b4", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/127484d3a45532df0ac17d43e55bd2e231c2b8b4", "committedDate": "2020-01-23T02:06:52Z", "message": "modify the module query to avoid unnecessary query filters\n\nalso use direct types vs querying over nt:base"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2066675bc31225b2a563fd4ebb3d9b138613d997", "author": {"user": {"login": "jmarrero", "name": "Joseph Marrero Corchado"}}, "url": "https://github.com/redhataccess/pantheon/commit/2066675bc31225b2a563fd4ebb3d9b138613d997", "committedDate": "2020-01-23T18:33:31Z", "message": "Remove modules oak:index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71d270b24a1d3acf36ebdf91561a55c0df012af5", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/71d270b24a1d3acf36ebdf91561a55c0df012af5", "committedDate": "2020-01-24T15:52:14Z", "message": "add a query index specifically for the module query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5941029ed502735d3fb21a43aa43b19868867cb6", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/5941029ed502735d3fb21a43aa43b19868867cb6", "committedDate": "2020-01-24T20:15:32Z", "message": "Revert \"add a query index specifically for the module query\"\n\nThis reverts commit 71d270b24a1d3acf36ebdf91561a55c0df012af5."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2224b0df47f569232fad4a03999866fd227c72a5", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/2224b0df47f569232fad4a03999866fd227c72a5", "committedDate": "2020-01-24T20:55:55Z", "message": "restrict the module query by path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjI0NzMy", "url": "https://github.com/redhataccess/pantheon/pull/214#pullrequestreview-348224732", "createdAt": "2020-01-24T21:06:59Z", "commit": {"oid": "2224b0df47f569232fad4a03999866fd227c72a5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d92292390cb24e1c1c27c5d0240d902695052a0", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/2d92292390cb24e1c1c27c5d0240d902695052a0", "committedDate": "2020-01-25T19:14:06Z", "message": "switch the module listing query to XPATH\n\nalso shorten the product queries now that the offending index has been eliminated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53dfc4b55f6a7c1a8966da3583b767ed8aaa846", "author": {"user": {"login": "carlosmunoz", "name": "Carlos Munoz"}}, "url": "https://github.com/redhataccess/pantheon/commit/f53dfc4b55f6a7c1a8966da3583b767ed8aaa846", "committedDate": "2020-01-25T19:22:24Z", "message": "fix failing tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MDI2OTky", "url": "https://github.com/redhataccess/pantheon/pull/214#pullrequestreview-349026992", "createdAt": "2020-01-27T22:41:43Z", "commit": {"oid": "f53dfc4b55f6a7c1a8966da3583b767ed8aaa846"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMjo0MTo0M1rOFiUBOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMjo0MTo0M1rOFiUBOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUyMzg5OQ==", "bodyText": "We still have this inner join - is it worth eliminating? We could probably easily use deep attribute inspection here.", "url": "https://github.com/redhataccess/pantheon/pull/214#discussion_r371523899", "createdAt": "2020-01-27T22:41:43Z", "author": {"login": "benradey"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/ModuleListingServlet.java", "diffHunk": "@@ -148,10 +163,9 @@ protected String getQuery(SlingHttpServletRequest request) {\n         productCondition = \"AND (\" + StringUtils.join(conditions, \" OR \") + \") \";\n \n         StringBuilder query = new StringBuilder()\n-                .append(\"SELECT pv.* from [nt:base] AS pv \")\n-                .append(\"INNER JOIN [nt:base] AS product ON ISDESCENDANTNODE(pv, product) \")\n-                .append(\"WHERE pv.[jcr:primaryType] = 'pant:productVersion' \")\n-                .append(\"AND product.[jcr:primaryType] = 'pant:product' \")\n+                .append(\"SELECT pv.* from [pant:productVersion] AS pv \")\n+                .append(\"INNER JOIN [pant:product] AS product ON ISDESCENDANTNODE(pv, product) \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53dfc4b55f6a7c1a8966da3583b767ed8aaa846"}, "originalPosition": 137}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mzc5NTQy", "url": "https://github.com/redhataccess/pantheon/pull/214#pullrequestreview-349379542", "createdAt": "2020-01-28T13:40:48Z", "commit": {"oid": "f53dfc4b55f6a7c1a8966da3583b767ed8aaa846"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2173, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}