{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2NTM0OTg4", "number": 305, "title": "CCS-3634: Update the container creation files to use the karaf based distribution", "bodyText": "This PR makes the following changes:\n\nUpdated Dockerfile to use Karaf based distribution\nUpdated README to provide podman related steps\nAdded kube file for pantheon-karaf", "createdAt": "2020-06-02T11:52:39Z", "url": "https://github.com/redhataccess/pantheon/pull/305", "merged": true, "mergeCommit": {"oid": "865ef6030aa7d1b6e2b0c6ca4420254ba3465693"}, "closed": true, "closedAt": "2020-06-03T05:51:38Z", "author": {"login": "aprajshekhar"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnTbZbgH2gAyNDI2NTM0OTg4OjU1ZTgwM2U3NjE4NWVjZDcyNGYxNjczNWRkZjYxZGZkMzQ4MzA2NjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcni2AAgFqTQyMzIzMzY0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666", "author": {"user": {"login": "aprajshekhar", "name": "A.P.Rajshekhar"}}, "url": "https://github.com/redhataccess/pantheon/commit/55e803e76185ecd724f16735ddf61dfd34830666", "committedDate": "2020-06-02T11:47:15Z", "message": "CCS-3634: Update the container creation files to use the karaf based distribution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjc4NDcz", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422678473", "createdAt": "2020-06-02T13:32:20Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozMjoyMVrOGdxv-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozMjoyMVrOGdxv-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg3Njk4Nw==", "bodyText": "Is it a docker image ?", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433876987", "createdAt": "2020-06-02T13:32:21Z", "author": {"login": "rednitish"}, "path": "README.md", "diffHunk": "@@ -48,6 +48,51 @@ For sling's management UI, you can head to http://localhost:8181/starter/index.h\n - To list all bundles and view their status: bundle:list\n - Find out why a bundle is in waiting state: diag _[bundle-id]_\n \n+### Run the application using Podman\n+First, install [podman](https://podman.io).\n+\n+Then, create a pod:\n+\n+```sh\n+podman pod create --name pantheon-karaf -p 8181 -p 5005\n+```\n+\n+This will create a `pantheon-karaf` pod with ports 8181 (for web access) and 5005 (for\n+remote Java debugging) open.\n+\n+Run a mongo database container in the pod.\n+\n+```sh\n+podman run --pod pantheon-karaf --name slingmongo -d mongo\n+```\n+\n+Build the pantheon docker image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjgyMzQy", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422682342", "createdAt": "2020-06-02T13:36:30Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozNjozMFrOGdx7YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozNjozMFrOGdx7YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg3OTkwNA==", "bodyText": "Correct me if, i am wrong, should it be  \" run the sling container in the pod.\"?", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433879904", "createdAt": "2020-06-02T13:36:30Z", "author": {"login": "rednitish"}, "path": "README.md", "diffHunk": "@@ -48,6 +48,51 @@ For sling's management UI, you can head to http://localhost:8181/starter/index.h\n - To list all bundles and view their status: bundle:list\n - Find out why a bundle is in waiting state: diag _[bundle-id]_\n \n+### Run the application using Podman\n+First, install [podman](https://podman.io).\n+\n+Then, create a pod:\n+\n+```sh\n+podman pod create --name pantheon-karaf -p 8181 -p 5005\n+```\n+\n+This will create a `pantheon-karaf` pod with ports 8181 (for web access) and 5005 (for\n+remote Java debugging) open.\n+\n+Run a mongo database container in the pod.\n+\n+```sh\n+podman run --pod pantheon-karaf --name slingmongo -d mongo\n+```\n+\n+Build the pantheon docker image\n+\n+```sh\n+buildah bud --layers -f container/Dockerfile -t pantheon-karaf-app .\n+```\n+\n+Run the sling container pod in the pod.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjg0NzM5", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422684739", "createdAt": "2020-06-02T13:38:39Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozODo0MFrOGdyB7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozODo0MFrOGdyB7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg4MTU4Mw==", "bodyText": "I am  not sure, if it's an issue at my end, but this step is throwing error message on my local.\nError: Transaction failed\nerror building at STEP \"RUN yum -y install java-1.8.0-openjdk\": error while running runtime: exit status 1\nERRO exit status 1", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433881583", "createdAt": "2020-06-02T13:38:40Z", "author": {"login": "rednitish"}, "path": "README.md", "diffHunk": "@@ -48,6 +48,51 @@ For sling's management UI, you can head to http://localhost:8181/starter/index.h\n - To list all bundles and view their status: bundle:list\n - Find out why a bundle is in waiting state: diag _[bundle-id]_\n \n+### Run the application using Podman\n+First, install [podman](https://podman.io).\n+\n+Then, create a pod:\n+\n+```sh\n+podman pod create --name pantheon-karaf -p 8181 -p 5005\n+```\n+\n+This will create a `pantheon-karaf` pod with ports 8181 (for web access) and 5005 (for\n+remote Java debugging) open.\n+\n+Run a mongo database container in the pod.\n+\n+```sh\n+podman run --pod pantheon-karaf --name slingmongo -d mongo\n+```\n+\n+Build the pantheon docker image\n+\n+```sh\n+buildah bud --layers -f container/Dockerfile -t pantheon-karaf-app .", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjg5Nzcx", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422689771", "createdAt": "2020-06-02T13:43:49Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0Mzo0OVrOGdyRBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0Mzo0OVrOGdyRBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg4NTQ0Nw==", "bodyText": "Why are we exposing  ports : 1099 and 44444 ?", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433885447", "createdAt": "2020-06-02T13:43:49Z", "author": {"login": "rednitish"}, "path": "container/Dockerfile", "diffHunk": "@@ -1,15 +1,21 @@\n FROM registry.access.redhat.com/ubi8/ubi\n RUN yum -y install java-1.8.0-openjdk\n \n-RUN mkdir -p /opt/sling\n+ENV MONGO_DB=\"sling\"\n+ENV REPOSITORY=\"sling/repository\"\n \n-COPY ../pantheon-slingstart/target/pantheon-slingstart-*.jar /opt/sling/pantheon.jar\n+RUN mkdir -p /opt/pantheon-karaf-dist\n+RUN mkdir /tmp/archive\n+WORKDIR /tmp/archive\n \n-WORKDIR /opt/sling/\n-EXPOSE 8080\n-EXPOSE 5005\n+COPY ../pantheon-karaf-dist/target/pantheon-karaf-dist-*.tar.gz /tmp/archive/pantheon-karaf-dist.tar.gz\n \n-ENV JAVA_OPTS -Xmx1024m -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\n-ENV SLING_OPS ''\n+RUN tar --strip-components=1 -C /opt/pantheon-karaf-dist -xzf pantheon-karaf-dist.tar.gz; \\\n+    rm -rf /tmp/*\n \n-CMD export COMMIT_HASH=$(cat /opt/sling/commit_hash); java $JAVA_OPTS -jar pantheon.jar $SLING_OPTS\n+RUN chmod 755 /opt; \n+    #sed -i \"21s/out/stdout/\" /opt/pantheon-karaf-dist/etc/org.ops4j.pax.logging.cfg;\n+\n+EXPOSE 1099 8181 44444", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjkxNzYw", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422691760", "createdAt": "2020-06-02T13:45:49Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0NTo0OVrOGdyW-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0NTo0OVrOGdyW-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg4Njk2OQ==", "bodyText": "Is it required ?\nwon't it get automatically created ?", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433886969", "createdAt": "2020-06-02T13:45:49Z", "author": {"login": "rednitish"}, "path": "container/pantheon-karaf.yml", "diffHunk": "@@ -0,0 +1,91 @@\n+# Generation of Kubernetes YAML is still under development!\n+#\n+# Save the output of this file and use kubectl create -f to import\n+# it into Kubernetes.\n+#\n+# Created with podman-1.9.2\n+apiVersion: v1\n+kind: Pod\n+metadata:\n+  creationTimestamp: \"2020-06-02T11:45:11Z\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjkzODI5", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422693829", "createdAt": "2020-06-02T13:48:04Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0ODowNFrOGdydLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0ODowNFrOGdydLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg4ODU1OA==", "bodyText": "Can we parameterize tags, so that we can deploy stable and latest images as well ?", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433888558", "createdAt": "2020-06-02T13:48:04Z", "author": {"login": "rednitish"}, "path": "container/pantheon-karaf.yml", "diffHunk": "@@ -0,0 +1,91 @@\n+# Generation of Kubernetes YAML is still under development!\n+#\n+# Save the output of this file and use kubectl create -f to import\n+# it into Kubernetes.\n+#\n+# Created with podman-1.9.2\n+apiVersion: v1\n+kind: Pod\n+metadata:\n+  creationTimestamp: \"2020-06-02T11:45:11Z\"\n+  labels:\n+    app: pantheon-karaf\n+  name: pantheon-karaf\n+spec:\n+  containers:\n+  - command:\n+    - /opt/pantheon-karaf-dist/bin/karaf\n+    - run\n+    env:\n+    - name: PATH\n+      value: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n+    - name: TERM\n+      value: xterm\n+    - name: HOSTNAME\n+      value: pantheon-karaf\n+    - name: MONGO_DB\n+      value: sling\n+    - name: REPOSITORY\n+      value: sling/repository\n+    - name: MONGO_DB_REPLICA\n+      value: mongodb://localhost:27017\n+    - name: container\n+      value: oci\n+    image: localhost/pantheon-karaf-app:latest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjk2MzAz", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-422696303", "createdAt": "2020-06-02T13:50:41Z", "commit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo1MDo0MVrOGdyktQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo1MDo0MVrOGdyktQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg5MDQ4NQ==", "bodyText": "mongoDB as container, is it for testing purpose only ?", "url": "https://github.com/redhataccess/pantheon/pull/305#discussion_r433890485", "createdAt": "2020-06-02T13:50:41Z", "author": {"login": "rednitish"}, "path": "container/pantheon-karaf.yml", "diffHunk": "@@ -0,0 +1,91 @@\n+# Generation of Kubernetes YAML is still under development!\n+#\n+# Save the output of this file and use kubectl create -f to import\n+# it into Kubernetes.\n+#\n+# Created with podman-1.9.2\n+apiVersion: v1\n+kind: Pod\n+metadata:\n+  creationTimestamp: \"2020-06-02T11:45:11Z\"\n+  labels:\n+    app: pantheon-karaf\n+  name: pantheon-karaf\n+spec:\n+  containers:\n+  - command:\n+    - /opt/pantheon-karaf-dist/bin/karaf\n+    - run\n+    env:\n+    - name: PATH\n+      value: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n+    - name: TERM\n+      value: xterm\n+    - name: HOSTNAME\n+      value: pantheon-karaf\n+    - name: MONGO_DB\n+      value: sling\n+    - name: REPOSITORY\n+      value: sling/repository\n+    - name: MONGO_DB_REPLICA\n+      value: mongodb://localhost:27017\n+    - name: container\n+      value: oci\n+    image: localhost/pantheon-karaf-app:latest\n+    name: pantheon-karaf-app\n+    ports:\n+    - containerPort: 8181\n+      hostPort: 8181\n+      protocol: TCP\n+    - containerPort: 55555\n+      hostPort: 55555\n+      protocol: TCP\n+    - containerPort: 1099\n+      hostPort: 1099\n+      protocol: TCP\n+    resources: {}\n+    securityContext:\n+      allowPrivilegeEscalation: true\n+      capabilities: {}\n+      privileged: false\n+      readOnlyRootFilesystem: false\n+      seLinuxOptions: {}\n+    tty: true\n+    workingDir: /tmp/archive\n+  - command:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e803e76185ecd724f16735ddf61dfd34830666"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08a95d79b76ef187075585688dbca33e023fc21a", "author": {"user": {"login": "aprajshekhar", "name": "A.P.Rajshekhar"}}, "url": "https://github.com/redhataccess/pantheon/commit/08a95d79b76ef187075585688dbca33e023fc21a", "committedDate": "2020-06-03T05:30:20Z", "message": "CCS-3634: Update the container creation files to use the karaf based distribution. Code review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjMzNjQ0", "url": "https://github.com/redhataccess/pantheon/pull/305#pullrequestreview-423233644", "createdAt": "2020-06-03T05:44:53Z", "commit": {"oid": "08a95d79b76ef187075585688dbca33e023fc21a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2129, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}