{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMTAxMTI3", "number": 312, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjo0MzowNVrOEEFKhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjo0NTowM1rOEEFMAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNzE0MzcyOnYy", "diffSide": "RIGHT", "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/module/ModuleVersionUpload.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjo0MzowNVrOGhe5OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjo0MzowNVrOGhe5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc2MjM2MQ==", "bodyText": "lets break this up into multiple lines, both for readability and in case we are hit by NPEs", "url": "https://github.com/redhataccess/pantheon/pull/312#discussion_r437762361", "createdAt": "2020-06-09T22:43:05Z", "author": {"login": "carlosmunoz"}, "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/module/ModuleVersionUpload.java", "diffHunk": "@@ -103,13 +121,19 @@ protected void doRun(SlingHttpServletRequest request, PostResponse response, Lis\n                 draftSrc.jcrContent().getOrCreate()\n                         .mimeType().set(\"text/x-asciidoc\");\n \n-                // TODO Html can no longer be generated on upload since there might be too many variants\n-                // TODO This will need to be re-thought since metadata now lies on the variant\n+                resolver.commit();\n+\n+                Map<String, Object> context = asciidoctorService.buildContextFromRequest(request);\n+                asciidoctorService.getModuleHtml(module, localeObj, module.getWorkspace().getCanonicalVariantName(),\n+                        true, context, true);\n+\n+                Metadata metadata = moduleLocale.variants().getOrCreate().variant(moduleLocale.getWorkspace().getCanonicalVariantName()).getOrCreate().draft().getOrCreate().metadata().getOrCreate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77d49f4ef551b4833a2b279a12d72c7a2f1f22"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNzE0NzUyOnYy", "diffSide": "RIGHT", "path": "pantheon-bundle/src/test/java/com/redhat/pantheon/servlet/module/ModuleVersionUploadTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjo0NTowM1rOGhe7nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjo0NTowM1rOGhe7nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc2Mjk3NQ==", "bodyText": "a comment for all these tests:\nwe should at least add verify calls to ensure the appropriate methods are being called in the asciidoctorService and serviceResourceResolvedProvider objects", "url": "https://github.com/redhataccess/pantheon/pull/312#discussion_r437762975", "createdAt": "2020-06-09T22:45:03Z", "author": {"login": "carlosmunoz"}, "path": "pantheon-bundle/src/test/java/com/redhat/pantheon/servlet/module/ModuleVersionUploadTest.java", "diffHunk": "@@ -49,7 +74,7 @@ void createFirstVersion() throws Exception {\n         // Then\n         assertEquals(HttpServletResponse.SC_CREATED, response.getStatusCode());\n         assertNotNull(slingContext.resourceResolver().getResource(\"/content/repositories/test_workspace/entities/new/proc_module/es_ES/source/draft/jcr:content\"));\n-        assertNull(slingContext.resourceResolver().getResource(\"/content/repositories/test_workspace/entities/new/proc_module/es_ES/variants\"));\n+        assertNotNull(slingContext.resourceResolver().getResource(\"/content/repositories/test_workspace/entities/new/proc_module/es_ES/variants\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77d49f4ef551b4833a2b279a12d72c7a2f1f22"}, "originalPosition": 69}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 321, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}