{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNTk2Njc0", "number": 848, "title": "GG-27017 Fixed availability of \"Add user\" action.", "bodyText": "", "createdAt": "2020-01-14T11:57:58Z", "url": "https://github.com/gridgain/gridgain/pull/848", "merged": true, "mergeCommit": {"oid": "d21a62b424808956be68d0f3909a2c0da09f7c52"}, "closed": true, "closedAt": "2020-01-15T11:35:39Z", "author": {"login": "vsisko"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6PoxngH2gAyMzYyNTk2Njc0OmFjYWVhMmRhNTE2NGI3NmYzNDg0Mzg3NzljYjQ3ODg4OThmN2VhY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6joVOAFqTM0MzE0NjU3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "acaea2da5164b76f348438779cb4788898f7eacd", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/acaea2da5164b76f348438779cb4788898f7eacd", "committedDate": "2020-01-14T11:55:39Z", "message": "GG-27017 Fixed availability of \"Add user\" action."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNDk3ODE2", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-342497816", "createdAt": "2020-01-14T12:33:11Z", "commit": {"oid": "acaea2da5164b76f348438779cb4788898f7eacd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de08e74af7b8a46e023d4c318c6366a62816c11", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/1de08e74af7b8a46e023d4c318c6366a62816c11", "committedDate": "2020-01-14T13:22:52Z", "message": "GG-27017 Small fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNTM4NDUw", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-342538450", "createdAt": "2020-01-14T13:42:41Z", "commit": {"oid": "1de08e74af7b8a46e023d4c318c6366a62816c11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDExNjU4", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-343011658", "createdAt": "2020-01-15T06:38:25Z", "commit": {"oid": "1de08e74af7b8a46e023d4c318c6366a62816c11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "committedDate": "2020-01-15T07:19:41Z", "message": "GG-27017 Small fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDcxODE5", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-343071819", "createdAt": "2020-01-15T09:09:31Z", "commit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwOTowOTozMVrOFdxXGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwOTowOTozMVrOFdxXGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MTc1Mw==", "bodyText": "await t.expect(excluded === actionSelector.withText(actionLbl).exists).notOk();", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366761753", "createdAt": "2020-01-15T09:09:31Z", "author": {"login": "MaxLosevskoy"}, "path": "modules/web-console/e2e/testcafe/fixtures/admin/assume-identity.js", "diffHunk": "@@ -20,9 +20,39 @@ import * as admin from '../../page-models/pageAdminListOfRegisteredUsers';\n import {pageProfile as profile} from '../../page-models/pageProfile';\n import * as notifications from '../../components/permanentNotifications';\n import {userMenu} from '../../components/userMenu';\n+import { Selector } from 'testcafe';\n+import { successNotification } from '../../components/notifications';\n+import {confirmation} from '../../components/confirmation'\n \n const regularUser = createRegularUser();\n \n+const _checkListOfActions = async(t, actions, excluded) => {\n+    const actionSelector = Selector('.dropdown-menu a');\n+\n+    for (let i = 0; i < actions.length; i++) {\n+        const actionLbl = actions[i];\n+\n+        if (excluded)\n+            await t.expect(actionSelector.withText(actionLbl).exists).notOk();\n+        else\n+            await t.expect(actionSelector.withText(actionLbl).exists).ok();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDc5NjEy", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-343079612", "createdAt": "2020-01-15T09:22:29Z", "commit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwOToyMjoyOVrOFdxuyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwOToyMjoyOVrOFdxuyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2NzgxOA==", "bodyText": "There's no validation that admin permissions were granted/revoked - alert does not guarantee that", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366767818", "createdAt": "2020-01-15T09:22:29Z", "author": {"login": "MaxLosevskoy"}, "path": "modules/web-console/e2e/testcafe/fixtures/admin/assume-identity.js", "diffHunk": "@@ -61,3 +91,82 @@ test('Become user', async(t) => {\n         // See https://ggsystems.atlassian.net/browse/GG-24068\n         .expect(userMenu.menuItem.withText('Admin panel').count).eql(1);\n });\n+\n+test(\"Action availability\", async(t) => {\n+    const _changeUserSelection = async(userName) => {\n+        await t.click(admin.userNameCell.withText(userName))\n+            .hover(admin.usersTable.actionsButton);\n+    };\n+\n+    await t.navigateTo(resolveUrl('/settings/admin'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await admin.usersTable.performAction('Add user');\n+\n+    const createUserDialog = Selector('.modal-dialog');\n+\n+    await t.expect(createUserDialog.find('.modal-header').withText('Create User').exists).ok()\n+        .click(createUserDialog.find('button').withText('Cancel'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, false);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, false, false);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await admin.usersTable.performAction('Revoke admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully revoked for user: \"User Name\"').exists).ok();\n+\n+    await admin.usersTable.performAction('Grant admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully granted for user: \"User Name\"').exists).ok();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDgwNTMy", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-343080532", "createdAt": "2020-01-15T09:24:01Z", "commit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwOToyNDowMlrOFdxxig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwOToyNDowMlrOFdxxig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2ODUyMg==", "bodyText": "We assert that modal is displayed but we don't assert the content of the modal", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366768522", "createdAt": "2020-01-15T09:24:02Z", "author": {"login": "MaxLosevskoy"}, "path": "modules/web-console/e2e/testcafe/fixtures/admin/assume-identity.js", "diffHunk": "@@ -61,3 +91,82 @@ test('Become user', async(t) => {\n         // See https://ggsystems.atlassian.net/browse/GG-24068\n         .expect(userMenu.menuItem.withText('Admin panel').count).eql(1);\n });\n+\n+test(\"Action availability\", async(t) => {\n+    const _changeUserSelection = async(userName) => {\n+        await t.click(admin.userNameCell.withText(userName))\n+            .hover(admin.usersTable.actionsButton);\n+    };\n+\n+    await t.navigateTo(resolveUrl('/settings/admin'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await admin.usersTable.performAction('Add user');\n+\n+    const createUserDialog = Selector('.modal-dialog');\n+\n+    await t.expect(createUserDialog.find('.modal-header').withText('Create User').exists).ok()\n+        .click(createUserDialog.find('button').withText('Cancel'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, false);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, false, false);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await admin.usersTable.performAction('Revoke admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully revoked for user: \"User Name\"').exists).ok();\n+\n+    await admin.usersTable.performAction('Grant admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully granted for user: \"User Name\"').exists).ok();\n+});\n+\n+test(\"Remove user\", async(t) => {\n+    await t.navigateTo(resolveUrl('/settings/admin'))\n+        .click(admin.userNameCell.withText('User Name'));\n+\n+    await admin.usersTable.performAction('Remove user');\n+\n+    await t.expect(confirmation.body.exists).ok();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8"}, "originalPosition": 99}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af74448a2591dcd43b4fb463a64ccc3a4b371d64", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/af74448a2591dcd43b4fb463a64ccc3a4b371d64", "committedDate": "2020-01-15T11:02:10Z", "message": "GG-27017 Small fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMTQ1ODE0", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-343145814", "createdAt": "2020-01-15T11:11:47Z", "commit": {"oid": "af74448a2591dcd43b4fb463a64ccc3a4b371d64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMTQ2NTc1", "url": "https://github.com/gridgain/gridgain/pull/848#pullrequestreview-343146575", "createdAt": "2020-01-15T11:13:16Z", "commit": {"oid": "af74448a2591dcd43b4fb463a64ccc3a4b371d64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4581, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}