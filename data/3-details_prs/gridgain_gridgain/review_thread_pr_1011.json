{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNjEzMTU5", "number": 1011, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzo1MTo1N1rODre0gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMToyMzo1NFrODrmb8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2OTIwMzIwOnYy", "diffSide": "RIGHT", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzo1MTo1N1rOF72fUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwNzoyOTozMlrOF76KuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMzA1OA==", "bodyText": "org.apache.ignite.internal.processors.cache.GridCacheProcessor#cache use the cache name as an argument, but you pass schema name. How this will work?", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398303058", "createdAt": "2020-03-26T03:51:57Z", "author": {"login": "nva"}, "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java", "diffHunk": "@@ -132,9 +133,13 @@ public QueryActionsController(GridKernalContext ctx) {\n \n                 SqlFieldsQuery qry = prepareQuery(arg);\n \n-                GridCacheContext cctx = F.isEmpty(arg.getCacheName())\n+                IgniteInternalCache<Object, Object> cache = F.isEmpty(arg.getDefaultSchema())\n+                    ? null\n+                    : ctx.cache().cache(arg.getDefaultSchema());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaa8ab7f3c115b46ae0d9c852f94456cb3ea6065"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM2MzMyMA==", "bodyText": "Expected that cache name will be sent and its context will be used.", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398363320", "createdAt": "2020-03-26T07:29:32Z", "author": {"login": "vsisko"}, "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/action/controller/QueryActionsController.java", "diffHunk": "@@ -132,9 +133,13 @@ public QueryActionsController(GridKernalContext ctx) {\n \n                 SqlFieldsQuery qry = prepareQuery(arg);\n \n-                GridCacheContext cctx = F.isEmpty(arg.getCacheName())\n+                IgniteInternalCache<Object, Object> cache = F.isEmpty(arg.getDefaultSchema())\n+                    ? null\n+                    : ctx.cache().cache(arg.getDefaultSchema());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMzA1OA=="}, "originalCommit": {"oid": "aaa8ab7f3c115b46ae0d9c852f94456cb3ea6065"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDQ1MTA2OnYy", "diffSide": "RIGHT", "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/action/controller/QueryActionsControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMToyMzo1NFrOF8CWjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzo1OTowOFrOF8IPBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ5NzQyMg==", "bodyText": "Let's add test where schema is removed from query and set we set default schema", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398497422", "createdAt": "2020-03-26T11:23:54Z", "author": {"login": "nva"}, "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/action/controller/QueryActionsControllerTest.java", "diffHunk": "@@ -365,7 +453,7 @@ public void shouldReturnRunningQueriesFromAllNodes() {\n                         .setQueryId(UUID.randomUUID().toString())\n                         .setQueryText(\"SELECT count(*), sleep() AS \\\"\" + nid + \"\\\" FROM \\\"TestCache\\\".STRING\")\n                         .setPageSize(1)\n-                        .setCacheName(\"TestCache\")\n+                        .setDefaultSchema(\"TestCache\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37172077e8b2108bb3eaa20e70a714ddd37c300e"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU5Mzc5OQ==", "bodyText": "This variant is already implemented in my test:\ngetSelectQuery(fullTestTable) + getSelectQuery(testTable)", "url": "https://github.com/gridgain/gridgain/pull/1011#discussion_r398593799", "createdAt": "2020-03-26T13:59:08Z", "author": {"login": "vsisko"}, "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/action/controller/QueryActionsControllerTest.java", "diffHunk": "@@ -365,7 +453,7 @@ public void shouldReturnRunningQueriesFromAllNodes() {\n                         .setQueryId(UUID.randomUUID().toString())\n                         .setQueryText(\"SELECT count(*), sleep() AS \\\"\" + nid + \"\\\" FROM \\\"TestCache\\\".STRING\")\n                         .setPageSize(1)\n-                        .setCacheName(\"TestCache\")\n+                        .setDefaultSchema(\"TestCache\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ5NzQyMg=="}, "originalCommit": {"oid": "37172077e8b2108bb3eaa20e70a714ddd37c300e"}, "originalPosition": 115}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3149, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}