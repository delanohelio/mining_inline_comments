{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2Mzk5MTE3", "number": 1091, "title": "GG-28826 [IGNITE-12468] Java thin: deserialization of collections fixed", "bodyText": "(cherry picked from commit 4433485)", "createdAt": "2020-04-21T02:22:01Z", "url": "https://github.com/gridgain/gridgain/pull/1091", "merged": true, "mergeCommit": {"oid": "e313bd4cfdbc6c49fe3a4e97dc781cc63608bf03"}, "closed": true, "closedAt": "2020-04-22T14:56:58Z", "author": {"login": "isapego"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZqMLNAH2gAyNDA2Mzk5MTE3OjY2Yjk2NzgwNzkwZTkwZmM1ZWI3ODA3NzQwMjEwN2QzOTc4MjI1Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaDQHjAFqTM5NzkxODk2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66b96780790e90fc5eb78077402107d397822528", "author": {"user": {"login": "alex-plekhanov", "name": "Aleksey Plekhanov"}}, "url": "https://github.com/gridgain/gridgain/commit/66b96780790e90fc5eb78077402107d397822528", "committedDate": "2020-04-21T02:23:30Z", "message": "IGNITE-12468 Java thin: deserialization of collections fixed\n\n(cherry picked from commit 4433485d74adc109ac5f435569e18578bc9f351f)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eedc944eeaea03960ce3c6c739e49092e1504995", "author": {"user": {"login": "alex-plekhanov", "name": "Aleksey Plekhanov"}}, "url": "https://github.com/gridgain/gridgain/commit/eedc944eeaea03960ce3c6c739e49092e1504995", "committedDate": "2020-04-21T02:19:55Z", "message": "IGNITE-12468 Java thin: deserialization of collections fixed\n\n(cherry picked from commit 4433485d74adc109ac5f435569e18578bc9f351f)"}, "afterCommit": {"oid": "66b96780790e90fc5eb78077402107d397822528", "author": {"user": {"login": "alex-plekhanov", "name": "Aleksey Plekhanov"}}, "url": "https://github.com/gridgain/gridgain/commit/66b96780790e90fc5eb78077402107d397822528", "committedDate": "2020-04-21T02:23:30Z", "message": "IGNITE-12468 Java thin: deserialization of collections fixed\n\n(cherry picked from commit 4433485d74adc109ac5f435569e18578bc9f351f)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTE4OTYz", "url": "https://github.com/gridgain/gridgain/pull/1091#pullrequestreview-397918963", "createdAt": "2020-04-22T07:35:21Z", "commit": {"oid": "66b96780790e90fc5eb78077402107d397822528"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzozNToyMVrOGJn2Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzozNToyMVrOGJn2Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA==", "bodyText": "This does not look correct to me:\n\nWhy do we use special unmarshal logic for thin client? It is supposed to be reused from thick, right?\nWe should not need to unwrap things like that. When keepBinary is false, we should deserialize correctly right away, without intermediate BinaryObjects that need to be unwrapped.", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412743174", "createdAt": "2020-04-22T07:35:21Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -495,12 +501,73 @@ void writeObject(BinaryOutputStream out, Object obj) {\n \n     /** Read Ignite binary object from input stream. */\n     <T> T readObject(BinaryInputStream in, boolean keepBinary) {\n-        Object val = marsh.unmarshal(in);\n+        if (keepBinary)\n+            return (T)marsh.unmarshal(in);\n+        else {\n+            BinaryReaderHandles hnds = new BinaryReaderHandles();\n+\n+            return (T)unwrapBinary(marsh.deserialize(in, hnds), hnds);\n+        }\n+    }\n+\n+    /**\n+     * Unwrap binary object.\n+     */\n+    private Object unwrapBinary(Object obj, BinaryReaderHandles hnds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66b96780790e90fc5eb78077402107d397822528"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4336, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}