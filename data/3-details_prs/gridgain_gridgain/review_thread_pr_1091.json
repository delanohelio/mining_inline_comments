{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2Mzk5MTE3", "number": 1091, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzozNToyMVrOD0m68g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzozNToyMVrOD0m68g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NDkwMjI2OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzozNToyMVrOGJn2Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDo0MzowOVrOGJ6P1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA==", "bodyText": "This does not look correct to me:\n\nWhy do we use special unmarshal logic for thin client? It is supposed to be reused from thick, right?\nWe should not need to unwrap things like that. When keepBinary is false, we should deserialize correctly right away, without intermediate BinaryObjects that need to be unwrapped.", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412743174", "createdAt": "2020-04-22T07:35:21Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -495,12 +501,73 @@ void writeObject(BinaryOutputStream out, Object obj) {\n \n     /** Read Ignite binary object from input stream. */\n     <T> T readObject(BinaryInputStream in, boolean keepBinary) {\n-        Object val = marsh.unmarshal(in);\n+        if (keepBinary)\n+            return (T)marsh.unmarshal(in);\n+        else {\n+            BinaryReaderHandles hnds = new BinaryReaderHandles();\n+\n+            return (T)unwrapBinary(marsh.deserialize(in, hnds), hnds);\n+        }\n+    }\n+\n+    /**\n+     * Unwrap binary object.\n+     */\n+    private Object unwrapBinary(Object obj, BinaryReaderHandles hnds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66b96780790e90fc5eb78077402107d397822528"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk0OTg3NQ==", "bodyText": "Well, now we need to decide what should we do with this, considering this is backport from Ignite.", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412949875", "createdAt": "2020-04-22T12:45:58Z", "author": {"login": "isapego"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -495,12 +501,73 @@ void writeObject(BinaryOutputStream out, Object obj) {\n \n     /** Read Ignite binary object from input stream. */\n     <T> T readObject(BinaryInputStream in, boolean keepBinary) {\n-        Object val = marsh.unmarshal(in);\n+        if (keepBinary)\n+            return (T)marsh.unmarshal(in);\n+        else {\n+            BinaryReaderHandles hnds = new BinaryReaderHandles();\n+\n+            return (T)unwrapBinary(marsh.deserialize(in, hnds), hnds);\n+        }\n+    }\n+\n+    /**\n+     * Unwrap binary object.\n+     */\n+    private Object unwrapBinary(Object obj, BinaryReaderHandles hnds) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA=="}, "originalCommit": {"oid": "66b96780790e90fc5eb78077402107d397822528"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk1NzgyNQ==", "bodyText": "I propose to properly fix this in separate patch so it can be donated in Ignite. What do you think?", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r412957825", "createdAt": "2020-04-22T12:56:46Z", "author": {"login": "isapego"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -495,12 +501,73 @@ void writeObject(BinaryOutputStream out, Object obj) {\n \n     /** Read Ignite binary object from input stream. */\n     <T> T readObject(BinaryInputStream in, boolean keepBinary) {\n-        Object val = marsh.unmarshal(in);\n+        if (keepBinary)\n+            return (T)marsh.unmarshal(in);\n+        else {\n+            BinaryReaderHandles hnds = new BinaryReaderHandles();\n+\n+            return (T)unwrapBinary(marsh.deserialize(in, hnds), hnds);\n+        }\n+    }\n+\n+    /**\n+     * Unwrap binary object.\n+     */\n+    private Object unwrapBinary(Object obj, BinaryReaderHandles hnds) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA=="}, "originalCommit": {"oid": "66b96780790e90fc5eb78077402107d397822528"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA0NDY5Mw==", "bodyText": "Agree.", "url": "https://github.com/gridgain/gridgain/pull/1091#discussion_r413044693", "createdAt": "2020-04-22T14:43:09Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -495,12 +501,73 @@ void writeObject(BinaryOutputStream out, Object obj) {\n \n     /** Read Ignite binary object from input stream. */\n     <T> T readObject(BinaryInputStream in, boolean keepBinary) {\n-        Object val = marsh.unmarshal(in);\n+        if (keepBinary)\n+            return (T)marsh.unmarshal(in);\n+        else {\n+            BinaryReaderHandles hnds = new BinaryReaderHandles();\n+\n+            return (T)unwrapBinary(marsh.deserialize(in, hnds), hnds);\n+        }\n+    }\n+\n+    /**\n+     * Unwrap binary object.\n+     */\n+    private Object unwrapBinary(Object obj, BinaryReaderHandles hnds) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MzE3NA=="}, "originalCommit": {"oid": "66b96780790e90fc5eb78077402107d397822528"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3121, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}