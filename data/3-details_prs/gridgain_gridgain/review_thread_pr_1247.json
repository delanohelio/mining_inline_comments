{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1OTQ1MjQz", "number": 1247, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozOTowNlrOELC_7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwODowMDozM1rOEXhBFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDE4OTI3OnYy", "diffSide": "RIGHT", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBeanImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozOTowNlrOGscWoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozOTowNlrOGscWoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1NTA3Mg==", "bodyText": "I don't think parseLong will work here. The quota strings can have multiple formats - see SqlConfiguration::setSqlGlobalMemoryQuota javadoc. Same for query quota.", "url": "https://github.com/gridgain/gridgain/pull/1247#discussion_r449255072", "createdAt": "2020-07-02T20:39:06Z", "author": {"login": "slukyano"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBeanImpl.java", "diffHunk": "@@ -73,6 +73,11 @@ public SqlQueryMXBeanImpl(GridKernalContext ctx) {\n         h2idx.longRunningQueries().setResultSetSizeThresholdMultiplier(rsSizeThresholdMultiplier);\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public Long getSqlGlobalMemoryQuotaBytes() {\n+        return Long.parseLong(h2idx.memoryManager().getGlobalQuota());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7a4b3eeace0a50cfa486a33130af369d4e342c5"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDE5MjAzOnYy", "diffSide": "RIGHT", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBean.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo0MDoxMVrOGscYUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo0MDoxMVrOGscYUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1NTUwNg==", "bodyText": "Need to either drop a comma before but here or add a comma in the global quota method.", "url": "https://github.com/gridgain/gridgain/pull/1247#discussion_r449255506", "createdAt": "2020-07-02T20:40:11Z", "author": {"login": "slukyano"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBean.java", "diffHunk": "@@ -144,6 +155,18 @@\n         \"For example:  '1000', '10M', '100k', '1G', '70%'\")\n     void setSqlGlobalMemoryQuota(String size);\n \n+\n+    /**\n+     * Gets global query quota.\n+     *\n+     * @return Global query quota as a long.\n+     */\n+    @MXBeanDescription(\"Global SQL query memory pool size or SQL query memory quota is\" +\n+        \" an upper bound for the heap memory part which might be occupied by the SQL query execution engine. \" +\n+        \"This quota is shared among all simultaneously running queries, hence it be easily consumed by the single \" +\n+        \"heavy analytics query. Same as SqlQueryMemoryQuota, but with a Long return type.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7a4b3eeace0a50cfa486a33130af369d4e342c5"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMDkzNjU1OnYy", "diffSide": "RIGHT", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBeanImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwODowMDozM1rOG_WM3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwODowMDozM1rOG_WM3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NzIxMw==", "bodyText": "We already have an integer value of the quota, right? So we probably don't need parseBytes.\nMay change the memoryManager().getGlobalQuota() to return long instead of String? It is internal and doesn't seem to be used anywhere else, so we can change it easily.", "url": "https://github.com/gridgain/gridgain/pull/1247#discussion_r469077213", "createdAt": "2020-08-12T08:00:33Z", "author": {"login": "slukyano"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBeanImpl.java", "diffHunk": "@@ -73,19 +74,30 @@ public SqlQueryMXBeanImpl(GridKernalContext ctx) {\n         h2idx.longRunningQueries().setResultSetSizeThresholdMultiplier(rsSizeThresholdMultiplier);\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public Long getSqlGlobalMemoryQuotaBytes() {\n+        return U.parseBytes(h2idx.memoryManager().getGlobalQuota());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebbf1c2da1b9bc0029f38d284c7949eca3263d1"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3339, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}