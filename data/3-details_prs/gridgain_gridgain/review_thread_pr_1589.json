{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NDQ3MTkx", "number": 1589, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMjoyNTo1N1rOFAN2lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNDozODozNFrOFQ6C6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1NzcxMjg0OnYy", "diffSide": "RIGHT", "path": "modules/log4j2/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMjoyNTo1N1rOH-ZKMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNToyODoxNlrOH_Bb_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE4NTk3MA==", "bodyText": "Why do we add a bridge for JUL in the SLF4J, but not here?", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r535185970", "createdAt": "2020-12-03T12:25:57Z", "author": {"login": "dmekhanikov"}, "path": "modules/log4j2/pom.xml", "diffHunk": "@@ -66,6 +66,12 @@\n             <artifactId>log4j-core</artifactId>\n             <version>${log4j.version}</version>\n         </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.logging.log4j</groupId>\n+            <artifactId>log4j-jcl</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ef8d32b22eaf279669d8ca39624ca670cd05c33"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0NTg4Ng==", "bodyText": "Done", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r535845886", "createdAt": "2020-12-04T05:28:16Z", "author": {"login": "nva"}, "path": "modules/log4j2/pom.xml", "diffHunk": "@@ -66,6 +66,12 @@\n             <artifactId>log4j-core</artifactId>\n             <version>${log4j.version}</version>\n         </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.logging.log4j</groupId>\n+            <artifactId>log4j-jcl</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE4NTk3MA=="}, "originalCommit": {"oid": "4ef8d32b22eaf279669d8ca39624ca670cd05c33"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTk0OTA5OnYy", "diffSide": "RIGHT", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo0OTozM1rOIHBfbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDozNjowMFrOIMGxRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTM3NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log1.info(\"Text that should be presence in logs\");\n          \n          \n            \n                    log1.info(\"Text that should be present in logs\");", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544235375", "createdAt": "2020-12-16T11:49:33Z", "author": {"login": "dmekhanikov"}, "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjM1Mw==", "bodyText": "Let's move log messages into a String variable, so that the strings are not duplicated in code.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544236353", "createdAt": "2020-12-16T11:51:14Z", "author": {"login": "dmekhanikov"}, "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTM3NQ=="}, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDc0Mw==", "bodyText": "done", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r549564743", "createdAt": "2020-12-29T04:36:00Z", "author": {"login": "nva"}, "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTM3NQ=="}, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTk1MjYwOnYy", "diffSide": "RIGHT", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MDoyM1rOIHBhYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MDoyM1rOIHBhYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTg3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n          \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be present in logs\"));", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544235872", "createdAt": "2020-12-16T11:50:23Z", "author": {"login": "dmekhanikov"}, "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTk1ODM2OnYy", "diffSide": "RIGHT", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MTo0M1rOIHBkhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MTo0M1rOIHBkhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjY3OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log1.info(\"Text that should be presence in logs\");\n          \n          \n            \n                    log1.info(\"Text that should be present in logs\");", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544236679", "createdAt": "2020-12-16T11:51:43Z", "author": {"login": "dmekhanikov"}, "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n+\n+        assertFalse(\"JUL INFO logs for org.springframework package are present in log file\",\n+            logContent.contains(\"INFO logs from org.springframework package should be excluded from logs\"));\n+    }\n+\n+    /**\n+     * Check that Apache Commons Logging is redirected to Log4j2.\n+     *\n+     * Start the local node and check for presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using Apache Commons Logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using Apache Commons Logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJCLIsRedirectedToLog4j2() throws Exception {\n+        File logFile = checkOneNode(0);\n+\n+        Log log1 = LogFactory.getLog(this.getClass());\n+        log1.info(\"Text that should be presence in logs\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTk1OTk1OnYy", "diffSide": "RIGHT", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MjowMFrOIHBlXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MjowMFrOIHBlXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjg5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n          \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be present in logs\"));", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544236893", "createdAt": "2020-12-16T11:52:00Z", "author": {"login": "dmekhanikov"}, "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n+\n+        assertFalse(\"JUL INFO logs for org.springframework package are present in log file\",\n+            logContent.contains(\"INFO logs from org.springframework package should be excluded from logs\"));\n+    }\n+\n+    /**\n+     * Check that Apache Commons Logging is redirected to Log4j2.\n+     *\n+     * Start the local node and check for presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using Apache Commons Logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using Apache Commons Logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJCLIsRedirectedToLog4j2() throws Exception {\n+        File logFile = checkOneNode(0);\n+\n+        Log log1 = LogFactory.getLog(this.getClass());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Log log2 = LogFactory.getLog(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JCL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDE1NTY5OnYy", "diffSide": "RIGHT", "path": "modules/slf4j/src/main/java/org/apache/ignite/logger/slf4j/Slf4jLogger.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjozODozMFrOIHDUaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNDozMTozM1rOIH4Vew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTMyMA==", "bodyText": "What does this thing do? Is it required?\nThe comment looks confusing. It says \"Optionally\", meaning that this step is not really required. We decided to perform it, but kept the \"Optionally\" word.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544265320", "createdAt": "2020-12-16T12:38:30Z", "author": {"login": "dmekhanikov"}, "path": "modules/slf4j/src/main/java/org/apache/ignite/logger/slf4j/Slf4jLogger.java", "diffHunk": "@@ -65,7 +66,12 @@ public Slf4jLogger(Logger impl) {\n \n         this.impl = impl;\n \n-        quiet = Boolean.valueOf(System.getProperty(IGNITE_QUIET, \"true\"));\n+        quiet = Boolean.parseBoolean(System.getProperty(IGNITE_QUIET, \"true\"));\n+\n+        // Optionally remove existing handlers attached to j.u.l root logger (since SLF4J 1.6.5)\n+        SLF4JBridgeHandler.removeHandlersForRootLogger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMjg4Ng==", "bodyText": "Remove all other handlers that can catch logs from JUL. I think it required.\nRemove \"Optionally\" word.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544812886", "createdAt": "2020-12-17T04:58:34Z", "author": {"login": "nva"}, "path": "modules/slf4j/src/main/java/org/apache/ignite/logger/slf4j/Slf4jLogger.java", "diffHunk": "@@ -65,7 +66,12 @@ public Slf4jLogger(Logger impl) {\n \n         this.impl = impl;\n \n-        quiet = Boolean.valueOf(System.getProperty(IGNITE_QUIET, \"true\"));\n+        quiet = Boolean.parseBoolean(System.getProperty(IGNITE_QUIET, \"true\"));\n+\n+        // Optionally remove existing handlers attached to j.u.l root logger (since SLF4J 1.6.5)\n+        SLF4JBridgeHandler.removeHandlersForRootLogger();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTMyMA=="}, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTEzMzk0Nw==", "bodyText": "Let's remove the \"(since SLF4J 1.6.5)\" part as well then.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r545133947", "createdAt": "2020-12-17T14:31:33Z", "author": {"login": "dmekhanikov"}, "path": "modules/slf4j/src/main/java/org/apache/ignite/logger/slf4j/Slf4jLogger.java", "diffHunk": "@@ -65,7 +66,12 @@ public Slf4jLogger(Logger impl) {\n \n         this.impl = impl;\n \n-        quiet = Boolean.valueOf(System.getProperty(IGNITE_QUIET, \"true\"));\n+        quiet = Boolean.parseBoolean(System.getProperty(IGNITE_QUIET, \"true\"));\n+\n+        // Optionally remove existing handlers attached to j.u.l root logger (since SLF4J 1.6.5)\n+        SLF4JBridgeHandler.removeHandlersForRootLogger();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTMyMA=="}, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDE2MDYwOnYy", "diffSide": "RIGHT", "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjozOTozOVrOIHDXLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjozOTozOVrOIHDXLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NjAzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logContent.contains(\"[INFO ][main][Slf4jLoggerSelfTest] Text that should be presence in logs\"));\n          \n          \n            \n                        logContent.contains(\"[INFO ][main][Slf4jLoggerSelfTest] Text that should be present in logs\"));", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544266031", "createdAt": "2020-12-16T12:39:39Z", "author": {"login": "dmekhanikov"}, "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "diffHunk": "@@ -0,0 +1,181 @@\n+/*\n+ * Copyright 2020 GridGain Systems, Inc. and Contributors.\n+ *\n+ * Licensed under the GridGain Community Edition License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.gridgain.com/products/software/community-edition/gridgain-community-edition-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.logger.slf4j;\n+\n+import java.io.File;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.logging.Logger;\n+import java.util.stream.Stream;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.configuration.IgniteConfiguration;\n+import org.apache.ignite.internal.util.typedef.G;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi;\n+import org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder;\n+import org.apache.logging.log4j.LogManager;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Grid Slf4j SPI test.\n+ */\n+public class Slf4jLoggerSelfTest {\n+    /** Path to full log. */\n+    private static final String LOG_ALL = \"work/log/all.log\";\n+\n+    /** Path to filtered log. */\n+    private static final String LOG_FILTERED = \"work/log/filtered.log\";\n+\n+    /** */\n+    @Before\n+    public void setUp() {\n+        deleteLogs();\n+\n+        LogManager.shutdown();\n+    }\n+\n+    /** */\n+    @After\n+    public void tearDown() {\n+        deleteLogs();\n+    }\n+\n+    /**\n+     * Check that JUL is redirected to Slf4j .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToSlf4j() throws Exception {\n+        File logFile = checkOneNode();\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Slf4jLoggerSelfTest] Text that should be presence in logs\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDE4MjIzOnYy", "diffSide": "RIGHT", "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjo0NDo1MFrOIHDjhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNDo1MzoyNFrOIHko0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2OTE4OQ==", "bodyText": "Why do we say about log4j2 here? Is SLF backed by log4j? Let's clarify it somewhere in the comments.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544269189", "createdAt": "2020-12-16T12:44:50Z", "author": {"login": "dmekhanikov"}, "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "diffHunk": "@@ -0,0 +1,181 @@\n+/*\n+ * Copyright 2020 GridGain Systems, Inc. and Contributors.\n+ *\n+ * Licensed under the GridGain Community Edition License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.gridgain.com/products/software/community-edition/gridgain-community-edition-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.logger.slf4j;\n+\n+import java.io.File;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.logging.Logger;\n+import java.util.stream.Stream;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.configuration.IgniteConfiguration;\n+import org.apache.ignite.internal.util.typedef.G;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi;\n+import org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder;\n+import org.apache.logging.log4j.LogManager;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Grid Slf4j SPI test.\n+ */\n+public class Slf4jLoggerSelfTest {\n+    /** Path to full log. */\n+    private static final String LOG_ALL = \"work/log/all.log\";\n+\n+    /** Path to filtered log. */\n+    private static final String LOG_FILTERED = \"work/log/filtered.log\";\n+\n+    /** */\n+    @Before\n+    public void setUp() {\n+        deleteLogs();\n+\n+        LogManager.shutdown();\n+    }\n+\n+    /** */\n+    @After\n+    public void tearDown() {\n+        deleteLogs();\n+    }\n+\n+    /**\n+     * Check that JUL is redirected to Slf4j .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMTIxOQ==", "bodyText": "Fixed to slf4j. I don't think such details should be in the test description.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544811219", "createdAt": "2020-12-17T04:53:24Z", "author": {"login": "nva"}, "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "diffHunk": "@@ -0,0 +1,181 @@\n+/*\n+ * Copyright 2020 GridGain Systems, Inc. and Contributors.\n+ *\n+ * Licensed under the GridGain Community Edition License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.gridgain.com/products/software/community-edition/gridgain-community-edition-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.logger.slf4j;\n+\n+import java.io.File;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.logging.Logger;\n+import java.util.stream.Stream;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.configuration.IgniteConfiguration;\n+import org.apache.ignite.internal.util.typedef.G;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi;\n+import org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder;\n+import org.apache.logging.log4j.LogManager;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Grid Slf4j SPI test.\n+ */\n+public class Slf4jLoggerSelfTest {\n+    /** Path to full log. */\n+    private static final String LOG_ALL = \"work/log/all.log\";\n+\n+    /** Path to filtered log. */\n+    private static final String LOG_FILTERED = \"work/log/filtered.log\";\n+\n+    /** */\n+    @Before\n+    public void setUp() {\n+        deleteLogs();\n+\n+        LogManager.shutdown();\n+    }\n+\n+    /** */\n+    @After\n+    public void tearDown() {\n+        deleteLogs();\n+    }\n+\n+    /**\n+     * Check that JUL is redirected to Slf4j .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2OTE4OQ=="}, "originalCommit": {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjYzNjc5OnYy", "diffSide": "RIGHT", "path": "config/java.util.logging.properties", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNDoyMDozNlrOIXAcfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQwODo1NToxOVrOIaMyJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk5NTQ1Mg==", "bodyText": "Why are these properties at the WARNING level? I think it would be better to use ERROR. This makes it easier to debug problems.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r560995452", "createdAt": "2021-01-20T14:20:36Z", "author": {"login": "aealeksandrov"}, "path": "config/java.util.logging.properties", "diffHunk": "@@ -54,6 +54,9 @@ handlers=java.util.logging.ConsoleHandler, org.apache.ignite.logger.java.JavaLog\n #\n #org.apache.ignite.CourtesyConfigNotice.level=OFF\n \n+org.springframework.level=WARNING", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTU5MzcyNA==", "bodyText": "This was copied from config/ignite-log4j2.xml, config/ignite-log4j.xml Should we change this too?", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r561593724", "createdAt": "2021-01-21T04:23:43Z", "author": {"login": "nva"}, "path": "config/java.util.logging.properties", "diffHunk": "@@ -54,6 +54,9 @@ handlers=java.util.logging.ConsoleHandler, org.apache.ignite.logger.java.JavaLog\n #\n #org.apache.ignite.CourtesyConfigNotice.level=OFF\n \n+org.springframework.level=WARNING", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk5NTQ1Mg=="}, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTgyMDIzMw==", "bodyText": "ERROR will show fewer issues than WARN. Will it really make debugging easier?", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r561820233", "createdAt": "2021-01-21T11:50:43Z", "author": {"login": "dmekhanikov"}, "path": "config/java.util.logging.properties", "diffHunk": "@@ -54,6 +54,9 @@ handlers=java.util.logging.ConsoleHandler, org.apache.ignite.logger.java.JavaLog\n #\n #org.apache.ignite.CourtesyConfigNotice.level=OFF\n \n+org.springframework.level=WARNING", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk5NTQ1Mg=="}, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDMzNTc1Mw==", "bodyText": "I guess that ERROR shows warns but WARN doesn't show errors. Please correct me if I am wrong.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r564335753", "createdAt": "2021-01-26T08:43:24Z", "author": {"login": "aealeksandrov"}, "path": "config/java.util.logging.properties", "diffHunk": "@@ -54,6 +54,9 @@ handlers=java.util.logging.ConsoleHandler, org.apache.ignite.logger.java.JavaLog\n #\n #org.apache.ignite.CourtesyConfigNotice.level=OFF\n \n+org.springframework.level=WARNING", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk5NTQ1Mg=="}, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDM0MzMzNA==", "bodyText": "No, this level work as threshold. So WARN will be include ERROR and WARN, ERROR will include only ERROR", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r564343334", "createdAt": "2021-01-26T08:55:19Z", "author": {"login": "nva"}, "path": "config/java.util.logging.properties", "diffHunk": "@@ -54,6 +54,9 @@ handlers=java.util.logging.ConsoleHandler, org.apache.ignite.logger.java.JavaLog\n #\n #org.apache.ignite.CourtesyConfigNotice.level=OFF\n \n+org.springframework.level=WARNING", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk5NTQ1Mg=="}, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMjcyNTU1OnYy", "diffSide": "RIGHT", "path": "modules/log4j2/src/main/java/org/apache/ignite/logger/log4j2/Log4J2Logger.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNDozODozNFrOIXBTQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQwNToyMzoxNFrOIXl88Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTAwOTQ3NQ==", "bodyText": "As far as I can see, you removed all handlers attached to the j.u.l root logger. Can you explain why? As I can see from the examples, you can simply add your handler via Log4jBridgeHandler.install().\nIf I understood this correctly after calling this method, all other handlers (logs appenders) configured by the client, for example, will be removed. Please correct me because I am not close to these methods, but it looks dangerous.", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r561009475", "createdAt": "2021-01-20T14:38:34Z", "author": {"login": "aealeksandrov"}, "path": "modules/log4j2/src/main/java/org/apache/ignite/logger/log4j2/Log4J2Logger.java", "diffHunk": "@@ -131,6 +131,11 @@ public Log4J2Logger() {\n \n         quiet = quiet0;\n         cfg = null;\n+\n+        // Remove existing handlers attached to j.u.l root logger.\n+        Log4jBridgeHandler.removeHandlersForRootLogger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYwOTk2OQ==", "bodyText": "This was an optional step from the examples. Let's not install the same handler twice and remove java.util.logging.ConsoleHandler which duplicate output to log. This can happen if you start/stop a node in the same jvm", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r561609969", "createdAt": "2021-01-21T05:23:14Z", "author": {"login": "nva"}, "path": "modules/log4j2/src/main/java/org/apache/ignite/logger/log4j2/Log4J2Logger.java", "diffHunk": "@@ -131,6 +131,11 @@ public Log4J2Logger() {\n \n         quiet = quiet0;\n         cfg = null;\n+\n+        // Remove existing handlers attached to j.u.l root logger.\n+        Log4jBridgeHandler.removeHandlersForRootLogger();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTAwOTQ3NQ=="}, "originalCommit": {"oid": "71925c15f999657b990aea400ecde6303d5d1c06"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3245, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}