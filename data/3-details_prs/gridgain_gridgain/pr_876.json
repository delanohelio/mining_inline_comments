{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3ODU4NTU4", "number": 876, "title": "GG-24415 Handle secure clusters when attaching cluster to user", "bodyText": "", "createdAt": "2020-01-28T07:05:21Z", "url": "https://github.com/gridgain/gridgain/pull/876", "merged": true, "mergeCommit": {"oid": "451c6128a614b20b4a83b315b4aa65107d2f59cf"}, "closed": true, "closedAt": "2020-02-14T10:03:14Z", "author": {"login": "nva"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABaQCC1MAH2gAyMzY3ODU4NTU4OmI2NDQ5MmQxYmFiZTQxNjkyOGVjYWUxZjEyMTQ5ZmI5ZDBlNTM5YmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEHmxkAH2gAyMzY3ODU4NTU4OjdiYjdkYThmNjBmMDU3MGFiM2YyOTI3MGZhM2YwZjk1OGE4MDZkZDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b64492d1babe416928ecae1f12149fb9d0e539bf", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/b64492d1babe416928ecae1f12149fb9d0e539bf", "committedDate": "2019-02-18T12:09:28Z", "message": "IGNITE-11345 remove deprecation for beforeTestsStarted and afterTestsStopped\n- done as per ticket description\n-- verified with diffs overview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bccd734c7413b9914c491dc7e33a9f229ed94d6", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/7bccd734c7413b9914c491dc7e33a9f229ed94d6", "committedDate": "2020-01-21T10:37:53Z", "message": "GG-24415 WIP."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc5b51727120d11cbcd5b76603f11308c38213c0", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/bc5b51727120d11cbcd5b76603f11308c38213c0", "committedDate": "2020-01-27T08:57:12Z", "message": "Merge branch 'master' of https://github.com/gridgain/apache-ignite into gg-24415\n\n\u0001 Conflicts:\n\u0001\tmodules/core/src/test/java/org/apache/ignite/testframework/junits/JUnit3TestLegacySupport.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0fdd57e9b943d9d28b50f04f21459c6f57b9c16", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/b0fdd57e9b943d9d28b50f04f21459c6f57b9c16", "committedDate": "2020-01-28T02:55:35Z", "message": "Merge branches 'gg-24415' and 'master' of https://github.com/gridgain/gridgain into gg-24415"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7db19a4d120912412a88ca516ffcffcf6b913213", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/7db19a4d120912412a88ca516ffcffcf6b913213", "committedDate": "2020-01-28T02:59:41Z", "message": "GG-24415 WIP."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5", "committedDate": "2020-01-28T05:21:23Z", "message": "GG-24415 WIP."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTY4MzMz", "url": "https://github.com/gridgain/gridgain/pull/876#pullrequestreview-349168333", "createdAt": "2020-01-28T07:22:57Z", "commit": {"oid": "9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTg3OTQ4", "url": "https://github.com/gridgain/gridgain/pull/876#pullrequestreview-349987948", "createdAt": "2020-01-29T10:05:27Z", "commit": {"oid": "9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMDowNToyN1rOFjCzow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMDowODowNVrOFjC4eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI5MDQ2Nw==", "bodyText": "Nice work  \ud83d\udc4d", "url": "https://github.com/gridgain/gridgain/pull/876#discussion_r372290467", "createdAt": "2020-01-29T10:05:27Z", "author": {"login": "somjik-api"}, "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/action/controller/AbstractActionControllerTest.java", "diffHunk": "@@ -107,6 +112,42 @@ protected void executeAction(Request req, Function<List<JobResponse>, Boolean> a\n         executeActionAndStopNode(req, 0, 0, assertFn);\n     }\n \n+    /**\n+     * @param reqId Request ID.\n+     */\n+    protected List<TaskResponse> taskResults(UUID reqId) {\n+        return interceptor.getAllPayloads(buildActionTaskResponseDest(cluster.id()), TaskResponse.class).stream()\n+            .filter(r -> r.getId().equals(reqId))\n+            .collect(toList());\n+    }\n+\n+    /**\n+     * @param reqId Request ID.\n+     */\n+    protected TaskResponse taskResult(UUID reqId) {\n+        List<TaskResponse> taskRes = taskResults(reqId);\n+\n+        return taskRes.isEmpty() ? null : F.last(taskRes);\n+    }\n+\n+    /**\n+     * @param reqId Request ID.\n+     */\n+    protected List<JobResponse> jobResults(UUID reqId) {\n+        return interceptor.getAllPayloads(buildActionJobResponseDest(cluster.id()), JobResponse.class).stream()\n+            .filter(r -> r.getRequestId().equals(reqId))\n+            .collect(toList());\n+    }\n+\n+    /**\n+     * @param reqId Request ID.\n+     */\n+    protected JobResponse jobResult(UUID reqId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI5MDY3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        List<TaskResponse> taskRes =taskResults(req.getId());\n          \n          \n            \n                        List<TaskResponse> taskRes = taskResults(req.getId());", "url": "https://github.com/gridgain/gridgain/pull/876#discussion_r372290678", "createdAt": "2020-01-29T10:05:56Z", "author": {"login": "somjik-api"}, "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/processor/action/DistributedActionProcessorWithAuthenticationTest.java", "diffHunk": "@@ -66,20 +67,19 @@ public void shouldExecuteActionOnCoordinatorNode() throws Exception {\n             .setNodeIds(singleton(crdId))\n             .setSessionId(sesId);\n \n-        executeAction(req, res -> {\n-            List<TaskResponse> taskResults =\n-                interceptor.getAllPayloads(buildActionTaskResponseDest(cluster.id(), req.getId()), TaskResponse.class);\n+        executeAction(req, jobRes -> {\n+            List<TaskResponse> taskRes =taskResults(req.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI5MTcwNg==", "bodyText": "I think we should not change topic name, because i don't sure how it will be handled in multi-backend setup :(", "url": "https://github.com/gridgain/gridgain/pull/876#discussion_r372291706", "createdAt": "2020-01-29T10:08:05Z", "author": {"login": "somjik-api"}, "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/StompDestinationsUtils.java", "diffHunk": "@@ -92,20 +92,18 @@ public static String buildEventsDest(UUID clusterId) {\n \n     /**\n      * @param clusterId Cluster ID.\n-     * @param reqId request ID.\n      * @return Task response destination.\n      */\n-    public static String buildActionTaskResponseDest(UUID clusterId, UUID reqId) {\n-        return CLUSTER_ACTION_TASK_RESPONSE_DEST + clusterId + \"/\" + reqId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d6e96d4170133585d7f5e09f9d800e3aaa5fcf5"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adade2bf0edb43a3ebc7850c14df9e97e8dc65bd", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/adade2bf0edb43a3ebc7850c14df9e97e8dc65bd", "committedDate": "2020-02-04T10:50:00Z", "message": "Update modules/management-console-agent/src/test/java/org/apache/ignite/agent/processor/action/DistributedActionProcessorWithAuthenticationTest.java\n\nCo-Authored-By: Sergey Moldachev <smoldachev@gridgain.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNjE5Mzg0", "url": "https://github.com/gridgain/gridgain/pull/876#pullrequestreview-353619384", "createdAt": "2020-02-05T10:43:36Z", "commit": {"oid": "adade2bf0edb43a3ebc7850c14df9e97e8dc65bd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxMDo0MzozNlrOFlzRmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxMDo0MzozNlrOFlzRmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4MTcyMA==", "bodyText": "reqId.equals(r.getId())\nExpected goes first\nIn case of nullable there's a risk of NPE", "url": "https://github.com/gridgain/gridgain/pull/876#discussion_r375181720", "createdAt": "2020-02-05T10:43:36Z", "author": {"login": "MaxLosevskoy"}, "path": "modules/management-console-agent/src/test/java/org/apache/ignite/agent/action/controller/AbstractActionControllerTest.java", "diffHunk": "@@ -107,6 +112,42 @@ protected void executeAction(Request req, Function<List<JobResponse>, Boolean> a\n         executeActionAndStopNode(req, 0, 0, assertFn);\n     }\n \n+    /**\n+     * @param reqId Request ID.\n+     */\n+    protected List<TaskResponse> taskResults(UUID reqId) {\n+        return interceptor.getAllPayloads(buildActionTaskResponseDest(cluster.id()), TaskResponse.class).stream()\n+            .filter(r -> r.getId().equals(reqId))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adade2bf0edb43a3ebc7850c14df9e97e8dc65bd"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNzMzMzU3", "url": "https://github.com/gridgain/gridgain/pull/876#pullrequestreview-353733357", "createdAt": "2020-02-05T13:58:25Z", "commit": {"oid": "adade2bf0edb43a3ebc7850c14df9e97e8dc65bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f80f50f3e953375b8b48498095c88945d0b1c85", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/5f80f50f3e953375b8b48498095c88945d0b1c85", "committedDate": "2020-02-11T12:45:25Z", "message": "GG-24415 Fixed review notes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "542d9df0eb22e6d210cc3ea9f825e78711a6503b", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/542d9df0eb22e6d210cc3ea9f825e78711a6503b", "committedDate": "2020-02-13T13:02:47Z", "message": "Merge branches 'gg-24415' and 'master' of https://github.com/gridgain/gridgain into gg-24415"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fcb2f5d76d4cd82e5f2354902c068151232b078", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/7fcb2f5d76d4cd82e5f2354902c068151232b078", "committedDate": "2020-02-14T02:56:23Z", "message": "Merge branches 'gg-24415' and 'master' of https://github.com/gridgain/gridgain into gg-24415"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bb7da8f60f0570ab3f29270fa3f0f958a806dd3", "author": {"user": {"login": "nva", "name": "Andrey Novikov"}}, "url": "https://github.com/gridgain/gridgain/commit/7bb7da8f60f0570ab3f29270fa3f0f958a806dd3", "committedDate": "2020-02-14T04:13:28Z", "message": "GG-24415 Fixed tests."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4664, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}