{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMjQzMDMw", "number": 958, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNzo0MDoxOVrODjuJoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowOTo0M1rODkn9-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NzgyODgwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNzo0MDoxOVrOFvr7nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwOTo0NjowM1rOFwNQXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA==", "bodyText": "May be more proper use F.exist(rawArgs, (arg) -> CMD_PRINT_ERR_STACK_TRACE.equals(CMD_PRINT_ERR_STACK_TRACE))", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385547164", "createdAt": "2020-02-28T07:40:19Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n \n+        Throwable err = null;\n+        boolean printErrStackTrace = false;\n+\n         try {\n             if (F.isEmpty(rawArgs) || (rawArgs.size() == 1 && CMD_HELP.equalsIgnoreCase(rawArgs.get(0)))) {\n                 printHelp();\n \n                 return EXIT_CODE_OK;\n             }\n \n+            printErrStackTrace = rawArgs.stream().anyMatch(CMD_PRINT_ERR_STACK_TRACE::equals);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NDQzOA==", "bodyText": "I think to use parser instead of go through console args manually.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385554438", "createdAt": "2020-02-28T08:02:25Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n \n+        Throwable err = null;\n+        boolean printErrStackTrace = false;\n+\n         try {\n             if (F.isEmpty(rawArgs) || (rawArgs.size() == 1 && CMD_HELP.equalsIgnoreCase(rawArgs.get(0)))) {\n                 printHelp();\n \n                 return EXIT_CODE_OK;\n             }\n \n+            printErrStackTrace = rawArgs.stream().anyMatch(CMD_PRINT_ERR_STACK_TRACE::equals);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA=="}, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5MzE1MA==", "bodyText": "Remade to F#exist.\nIn the beginning I did through the parser, but then I realized that while parsing can also appear error, stack where you want to watch, so I made also the argument \"--print-err-stack-trace\" may be at the end and it not get.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386093150", "createdAt": "2020-03-01T09:46:03Z", "author": {"login": "tkalkirill"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n \n+        Throwable err = null;\n+        boolean printErrStackTrace = false;\n+\n         try {\n             if (F.isEmpty(rawArgs) || (rawArgs.size() == 1 && CMD_HELP.equalsIgnoreCase(rawArgs.get(0)))) {\n                 printHelp();\n \n                 return EXIT_CODE_OK;\n             }\n \n+            printErrStackTrace = rawArgs.stream().anyMatch(CMD_PRINT_ERR_STACK_TRACE::equals);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA=="}, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Nzg4ODMwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/test/resources/org.apache.ignite.util/control.sh_help.output", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODowNzozOFrOFvsfAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODowNzozOFrOFvsfAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NjIyNA==", "bodyText": "It does not need parameter to set for print stack trace argument\n[--print-err-stack-trace]", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385556224", "createdAt": "2020-02-28T08:07:38Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/test/resources/org.apache.ignite.util/control.sh_help.output", "diffHunk": "@@ -4,7 +4,7 @@ User: <!any!>\n Time: <!any!>\n Control utility script is used to execute admin commands on cluster or get common cluster info. The command has the following syntax:\n \n-  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] [command] <command_parameters>\n+  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--print-err-stack-trace PRINT_ERR_STACK_TRACE] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] [command] <command_parameters>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Nzg5NzI1OnYy", "diffSide": "RIGHT", "path": "modules/core/src/test/resources/org.apache.ignite.util/control.sh_cache_help.output", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODoxMTowOVrOFvskAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODoxMTowOVrOFvskAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NzUwNQ==", "bodyText": "Only --print-err-stack-trace would be enough for printing stack on log.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385557505", "createdAt": "2020-02-28T08:11:09Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/test/resources/org.apache.ignite.util/control.sh_cache_help.output", "diffHunk": "@@ -7,7 +7,7 @@ Arguments: --cache help --yes\n --------------------------------------------------------------------------------\n   The '--cache subcommand' is used to get information about and perform actions with caches. The command has the following syntax:\n \n-  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] --cache [subcommand] <subcommand_parameters>\n+  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--print-err-stack-trace PRINT_ERR_STACK_TRACE] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] --cache [subcommand] <subcommand_parameters>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NzI5MDE4OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowNTo0M1rOFxDJMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowNTo0M1rOFxDJMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NjA1MQ==", "bodyText": "Does this logger have an issue with printing several lines?\nLike this manner:\nlogger.info(\"Error stack trace:\\n\" +\nX.getFullStackTrace(err));", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386976051", "createdAt": "2020-03-03T12:05:43Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -319,34 +331,45 @@ public int execute(List<String> rawArgs) {\n                     if (isSSLMisconfigurationError(cause))\n                         e = cause;\n \n-                    logger.severe(\"Connection to cluster failed. \" + CommandLogger.errorMessage(e));\n+                    logger.severe(\"Connection to cluster failed. \" + errorMessage(e));\n \n                 }\n \n                 logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_CONNECTION_FAILED);\n \n+                err = e;\n+\n                 return EXIT_CODE_CONNECTION_FAILED;\n             }\n \n             if (X.hasCause(e, VisorIllegalStateException.class)) {\n                 VisorIllegalStateException vise = X.cause(e, VisorIllegalStateException.class);\n \n-                logger.severe(CommandLogger.errorMessage(vise));\n+                logger.severe(errorMessage(vise));\n                 logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_ILLEGAL_STATE_ERROR);\n \n+                err = e;\n+\n                 return EXIT_CODE_ILLEGAL_STATE_ERROR;\n             }\n \n-            logger.severe(CommandLogger.errorMessage(e));\n+            logger.severe(errorMessage(e));\n             logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_UNEXPECTED_ERROR);\n \n+            err = e;\n+\n             return EXIT_CODE_UNEXPECTED_ERROR;\n         }\n         finally {\n             LocalDateTime endTime = LocalDateTime.now();\n \n             Duration diff = Duration.between(startTime, endTime);\n \n+            if (printErrStackTrace && nonNull(err)) {\n+                logger.info(\"Error stack trace:\");\n+                logger.info(X.getFullStackTrace(err));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NzMwMTcxOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowOTo0M1rOFxDQLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNToyMjoyM1rOFxKSiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NzgzOA==", "bodyText": "Excess empty line.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386977838", "createdAt": "2020-03-03T12:09:43Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA5MzEyOQ==", "bodyText": "I think there should be an empty string here.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r387093129", "createdAt": "2020-03-03T15:22:23Z", "author": {"login": "tkalkirill"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NzgzOA=="}, "originalCommit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3144, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}