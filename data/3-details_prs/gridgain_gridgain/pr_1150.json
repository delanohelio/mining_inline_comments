{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3OTQzNjA0", "number": 1150, "title": "GG-28399 [IGNITE-12399' Java thin client: add cache expiry policies", "bodyText": "", "createdAt": "2020-05-14T11:49:52Z", "url": "https://github.com/gridgain/gridgain/pull/1150", "merged": true, "mergeCommit": {"oid": "817dcc6e023139a2eb4608f48a05416334150e5d"}, "closed": true, "closedAt": "2020-05-14T13:13:23Z", "author": {"login": "isapego"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchLS2uAH2gAyNDE3OTQzNjA0OmNmZDQzZTIyZjZhMjdhODllNGIyMjIyYWMxMzQ0MTMyNWQ4ZjQwNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchMop7gH2gAyNDE3OTQzNjA0OjQyMzZhMjU0OGRhNDZlODg0ZGE2YTI0YmEyNGRlODY0MmYzNDY4MDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cfd43e22f6a27a89e4b2222ac13441325d8f4061", "author": {"user": {"login": "alex-plekhanov", "name": "Aleksey Plekhanov"}}, "url": "https://github.com/gridgain/gridgain/commit/cfd43e22f6a27a89e4b2222ac13441325d8f4061", "committedDate": "2020-05-14T10:55:08Z", "message": "GG-28399 [IGNITE-12399' Java thin client: add cache expiry policies\n\n(cherry picked from commit 4fb139d10913ba757900fa1231ba6dfa1afc16b5)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6283b44d4d108fba3acc7446e2b53e824e960db", "author": {"user": {"login": "isapego", "name": "Igor Sapego"}}, "url": "https://github.com/gridgain/gridgain/commit/c6283b44d4d108fba3acc7446e2b53e824e960db", "committedDate": "2020-05-14T10:55:08Z", "message": "GG-28399: Default protocol version fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fc3d097f68d29b9ff4905f72233da79cfc1d7c8", "author": {"user": {"login": "isapego", "name": "Igor Sapego"}}, "url": "https://github.com/gridgain/gridgain/commit/4fc3d097f68d29b9ff4905f72233da79cfc1d7c8", "committedDate": "2020-05-14T10:55:08Z", "message": "GG-28399: Added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f31ac105a29490357bba01e130b20ab1873c0f5e", "author": {"user": {"login": "isapego", "name": "Igor Sapego"}}, "url": "https://github.com/gridgain/gridgain/commit/f31ac105a29490357bba01e130b20ab1873c0f5e", "committedDate": "2020-05-14T10:55:08Z", "message": "GG-28399: Fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca0cc450e42e6c55d44bc921643434cc5a30a9a1", "author": {"user": {"login": "isapego", "name": "Igor Sapego"}}, "url": "https://github.com/gridgain/gridgain/commit/ca0cc450e42e6c55d44bc921643434cc5a30a9a1", "committedDate": "2020-05-14T10:55:08Z", "message": "GG-28399: Minor fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNzI4MjAx", "url": "https://github.com/gridgain/gridgain/pull/1150#pullrequestreview-411728201", "createdAt": "2020-05-14T11:54:25Z", "commit": {"oid": "ca0cc450e42e6c55d44bc921643434cc5a30a9a1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMTo1NDoyNVrOGVYwEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMTo1NToxNVrOGVYx2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3ODgwMw==", "bodyText": "I believe that this method should be consistent with a regular cache API and be named as \"withExpirypolicy\". But since we are making a port from Ignite, let's keep the single code base for now.", "url": "https://github.com/gridgain/gridgain/pull/1150#discussion_r425078803", "createdAt": "2020-05-14T11:54:25Z", "author": {"login": "ashapkin"}, "path": "modules/core/src/main/java/org/apache/ignite/client/ClientCache.java", "diffHunk": "@@ -335,12 +337,19 @@\n      */\n     public <K1, V1> ClientCache<K1, V1> withKeepBinary();\n \n+    /**\n+     * Returns cache with the specified expired policy set. This policy will be used for each operation invoked on\n+     * the returned cache.\n+     *\n+     * @return Cache instance with the specified expiry policy set.\n+     */\n+    public <K1, V1> ClientCache<K1, V1> withExpirePolicy(ExpiryPolicy expirePlc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca0cc450e42e6c55d44bc921643434cc5a30a9a1"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3OTI1OQ==", "bodyText": "\"Expiry\", but see comment above", "url": "https://github.com/gridgain/gridgain/pull/1150#discussion_r425079259", "createdAt": "2020-05-14T11:55:15Z", "author": {"login": "ashapkin"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/ClientUtils.java", "diffHunk": "@@ -338,15 +343,32 @@ void cacheConfiguration(ClientCacheConfiguration cfg, BinaryOutputStream out, Pr\n                                 w.writeByte((byte)i.getIndexType().ordinal());\n                                 w.writeInt(i.getInlineSize());\n                                 ClientUtils.collection(i.getFields().entrySet(), out, (unused5, f) -> {\n-                                        w.writeString(f.getKey());\n-                                        w.writeBoolean(f.getValue());\n-                                    }\n+                                            w.writeString(f.getKey());\n+                                            w.writeBoolean(f.getValue());\n+                                        }\n                                 );\n                             });\n-                    }\n+                        }\n                 )\n             );\n \n+            if (ver.compareTo(V1_6_0) >= 0) {\n+                itemWriter.accept(CfgItem.EXPIRE_POLICY, w -> {\n+                    ExpiryPolicy expiryPlc = cfg.getExpiryPolicy();\n+                    if (expiryPlc == null)\n+                        w.writeBoolean(false);\n+                    else {\n+                        w.writeBoolean(true);\n+                        w.writeLong(convertDuration(expiryPlc.getExpiryForCreation()));\n+                        w.writeLong(convertDuration(expiryPlc.getExpiryForUpdate()));\n+                        w.writeLong(convertDuration(expiryPlc.getExpiryForAccess()));\n+                    }\n+                });\n+            } else if (cfg.getExpiryPolicy() != null) {\n+                throw new ClientProtocolError(String.format(\"Expire policies have not supported by the server \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca0cc450e42e6c55d44bc921643434cc5a30a9a1"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4236a2548da46e884da6a24ba24de8642f346807", "author": {"user": {"login": "isapego", "name": "Igor Sapego"}}, "url": "https://github.com/gridgain/gridgain/commit/4236a2548da46e884da6a24ba24de8642f346807", "committedDate": "2020-05-14T12:28:51Z", "message": "GG-28399: Deprecated withExpirePolicy and added withExpiryPolicy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4185, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}