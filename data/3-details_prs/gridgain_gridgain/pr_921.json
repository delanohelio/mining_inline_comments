{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczOTkyMjQx", "number": 921, "title": "GG-27188 JMX metric indexbuildcountpartitionsleft show values below zero", "bodyText": "", "createdAt": "2020-02-11T23:50:25Z", "url": "https://github.com/gridgain/gridgain/pull/921", "merged": true, "mergeCommit": {"oid": "d84c5189d5f471078c557e75a2b15329c21455be"}, "closed": true, "closedAt": "2020-04-03T21:40:39Z", "author": {"login": "a-polyakov"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDal4nAH2gAyMzczOTkyMjQxOjU5ZWY4NWRjZjY5NGMwZjYzNjJjZjM1M2Q2NWU5Mzk2MzRkOWRkYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUH6e_gH2gAyMzczOTkyMjQxOjYyZmQ4ODQzM2NmOWYwZWRlMzMwYjNkZDk1NWYzMGEwYmJkOWRmMGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59ef85dcf694c0f6362cf353d65e939634d9ddb3", "author": {"user": {"login": "a-polyakov", "name": null}}, "url": "https://github.com/gridgain/gridgain/commit/59ef85dcf694c0f6362cf353d65e939634d9ddb3", "committedDate": "2020-02-11T23:46:46Z", "message": "GG-27188 JMX metric indexbuildcountpartitionsleft show values below zero"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzUxNDA3", "url": "https://github.com/gridgain/gridgain/pull/921#pullrequestreview-379351407", "createdAt": "2020-03-23T11:42:23Z", "commit": {"oid": "59ef85dcf694c0f6362cf353d65e939634d9ddb3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo0MjoyM1rOF6Btew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo0MjoyM1rOF6Btew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM4OTc1NQ==", "bodyText": "new line need to be here.", "url": "https://github.com/gridgain/gridgain/pull/921#discussion_r396389755", "createdAt": "2020-03-23T11:42:23Z", "author": {"login": "zstan"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cache/CacheGroupMetricsImpl.java", "diffHunk": "@@ -191,6 +191,13 @@ public void setIndexBuildCountPartitionsLeft(long idxBuildCntPartitionsLeft) {\n     public void decrementIndexBuildCountPartitionsLeft() {\n         idxBuildCntPartitionsLeft.decrement();\n     }\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59ef85dcf694c0f6362cf353d65e939634d9ddb3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzUxNTcz", "url": "https://github.com/gridgain/gridgain/pull/921#pullrequestreview-379351573", "createdAt": "2020-03-23T11:42:38Z", "commit": {"oid": "59ef85dcf694c0f6362cf353d65e939634d9ddb3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo0MjozOFrOF6Bt-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo0MjozOFrOF6Bt-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM4OTg4Mw==", "bodyText": "and new line here", "url": "https://github.com/gridgain/gridgain/pull/921#discussion_r396389883", "createdAt": "2020-03-23T11:42:38Z", "author": {"login": "zstan"}, "path": "modules/indexing/src/test/java/org/apache/ignite/internal/processors/cache/CacheGroupMetricsWithIndexTest.java", "diffHunk": "@@ -79,8 +85,32 @@\n         IgniteConfiguration cfg = super.getConfiguration(igniteInstanceName);\n \n         for (CacheConfiguration cacheCfg : cfg.getCacheConfiguration()) {\n-            if (GROUP_NAME.equals(cacheCfg.getGroupName()) && CACHE_NAME.equals(cacheCfg.getName())) {\n-                QueryEntity qryEntity = new QueryEntity(Long.class.getCanonicalName(), OBJECT_NAME);\n+            if (GROUP_NAME.equals(cacheCfg.getGroupName()) && CACHE_NAME2.equals(cacheCfg.getName())) {\n+                QueryEntity qryEntity = new QueryEntity(Long.class.getCanonicalName(), OBJECT_NAME2);\n+\n+                qryEntity.setKeyFieldName(KEY_NAME);\n+\n+                LinkedHashMap<String, String> fields = new LinkedHashMap<>();\n+\n+                fields.put(KEY_NAME, Long.class.getCanonicalName());\n+\n+                fields.put(COLUMN1_NAME, Integer.class.getCanonicalName());\n+\n+                fields.put(COLUMN2_NAME, String.class.getCanonicalName());\n+\n+                qryEntity.setFields(fields);\n+\n+                ArrayList<QueryIndex> indexes = new ArrayList<>();\n+\n+                indexes.add(new QueryIndex(COLUMN1_NAME));\n+\n+                indexes.add(new QueryIndex(COLUMN2_NAME));\n+\n+                qryEntity.setIndexes(indexes);\n+\n+                cacheCfg.setQueryEntities(Collections.singletonList(qryEntity));\n+            }else if (GROUP_NAME.equals(cacheCfg.getGroupName()) && CACHE_NAME3.equals(cacheCfg.getName())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59ef85dcf694c0f6362cf353d65e939634d9ddb3"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab054861018f60504a83492bc52e3d61e2f2f182", "author": {"user": {"login": "a-polyakov", "name": null}}, "url": "https://github.com/gridgain/gridgain/commit/ab054861018f60504a83492bc52e3d61e2f2f182", "committedDate": "2020-03-26T13:40:51Z", "message": "Merge remote-tracking branch 'gridgain-ce/master' into gg-27188\n\n# Conflicts:\n#\tmodules/core/src/main/java/org/apache/ignite/internal/processors/query/GridQueryProcessor.java\n#\tmodules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/IgniteH2Indexing.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d833b2bc1519995a754fcacc0f7ac080ed37d37f", "author": {"user": {"login": "a-polyakov", "name": null}}, "url": "https://github.com/gridgain/gridgain/commit/d833b2bc1519995a754fcacc0f7ac080ed37d37f", "committedDate": "2020-03-26T14:47:53Z", "message": "GG-27188 JMX metric indexbuildcountpartitionsleft show values below zero. Merge master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MjQzNzcw", "url": "https://github.com/gridgain/gridgain/pull/921#pullrequestreview-386243770", "createdAt": "2020-04-02T09:14:37Z", "commit": {"oid": "d833b2bc1519995a754fcacc0f7ac080ed37d37f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOToxNDozN1rOF_iWZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOToxNDozN1rOF_iWZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE2NzM5Ng==", "bodyText": "Will be better to rewrite it to use our system view. INFORMATION_SCHEMA don't support by IGNITE at all.", "url": "https://github.com/gridgain/gridgain/pull/921#discussion_r402167396", "createdAt": "2020-04-02T09:14:37Z", "author": {"login": "ygerzhedovich"}, "path": "modules/indexing/src/test/java/org/apache/ignite/internal/processors/cache/CacheGroupMetricsWithIndexTest.java", "diffHunk": "@@ -182,34 +213,34 @@ public void testIndexCreateCountPartitionsLeft() throws Exception {\n \n         ignite.cluster().active(true);\n \n-        IgniteCache<Object, Object> cache1 = ignite.cache(CACHE_NAME);\n+        IgniteCache<Object, Object> cache2 = ignite.cache(CACHE_NAME2);\n \n         String addColSql = \"ALTER TABLE \" + TABLE + \" ADD COLUMN \" + COLUMN3_NAME + \" BIGINT\";\n \n-        cache1.query(new SqlFieldsQuery(addColSql)).getAll();\n+        cache2.query(new SqlFieldsQuery(addColSql)).getAll();\n \n         for (int i = 0; i < 100_000; i++) {\n             Long id = (long)i;\n \n-            BinaryObjectBuilder o = ignite.binary().builder(OBJECT_NAME)\n+            BinaryObjectBuilder o = ignite.binary().builder(OBJECT_NAME2)\n                 .setField(KEY_NAME, id)\n                 .setField(COLUMN1_NAME, i / 2)\n                 .setField(COLUMN2_NAME, \"str\" + Integer.toHexString(i))\n                 .setField(COLUMN3_NAME, id * 10);\n \n-            cache1.put(id, o.build());\n+            cache2.put(id, o.build());\n         }\n \n         MetricRegistry metrics = cacheGroupMetrics(0, GROUP_NAME).get2();\n \n         GridTestUtils.runAsync(() -> {\n             String createIdxSql = \"CREATE INDEX \" + INDEX_NAME + \" ON \" + TABLE + \"(\" + COLUMN3_NAME + \")\";\n \n-            cache1.query(new SqlFieldsQuery(createIdxSql)).getAll();\n+            cache2.query(new SqlFieldsQuery(createIdxSql)).getAll();\n \n             String selectIdxSql = \"select * from information_schema.indexes where index_name='\" + INDEX_NAME + \"'\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d833b2bc1519995a754fcacc0f7ac080ed37d37f"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MjQ2NjEw", "url": "https://github.com/gridgain/gridgain/pull/921#pullrequestreview-386246610", "createdAt": "2020-04-02T09:18:11Z", "commit": {"oid": "d833b2bc1519995a754fcacc0f7ac080ed37d37f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOToxODoxMVrOF_ifGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOToxODoxMVrOF_ifGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE2OTYyNg==", "bodyText": "when metrics could be null?", "url": "https://github.com/gridgain/gridgain/pull/921#discussion_r402169626", "createdAt": "2020-04-02T09:18:11Z", "author": {"login": "ygerzhedovich"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/IgniteH2Indexing.java", "diffHunk": "@@ -2024,6 +2024,9 @@ public UpdateResult executeUpdateOnDataNode(\n \n         GridFutureAdapter<Void> rebuildCacheIdxFut = new GridFutureAdapter<>();\n \n+        if (cctx.group().metrics() != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d833b2bc1519995a754fcacc0f7ac080ed37d37f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62fd88433cf9f0ede330b3dd955f30a0bbd9df0a", "author": {"user": {"login": "a-polyakov", "name": null}}, "url": "https://github.com/gridgain/gridgain/commit/62fd88433cf9f0ede330b3dd955f30a0bbd9df0a", "committedDate": "2020-04-03T21:37:47Z", "message": "GG-27188 JMX metric indexbuildcountpartitionsleft show values below zero. Corrections on the results of the code review."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4768, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}