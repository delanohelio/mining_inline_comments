{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMjQzMDMw", "number": 958, "title": "Gg 23528", "bodyText": "", "createdAt": "2020-02-28T07:22:44Z", "url": "https://github.com/gridgain/gridgain/pull/958", "merged": true, "mergeCommit": {"oid": "1ef83b67027ff94aaa42072a7fa7b3e19afdde94"}, "closed": true, "closedAt": "2020-03-14T06:48:54Z", "author": {"login": "vldpyatkov"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHDd7_AH2gAyMzgxMjQzMDMwOmEyMTEwZTYzNjkzM2IzYzgxNWIxOGQ0N2M2ZDUzNTliODQwYjNjMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKEK9dgH2gAyMzgxMjQzMDMwOmZkZTU1MWMzOTcxNzk2MzdlMWM4YTdiZDE1NTMwYjE1NDhlNDZmZGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2110e636933b3c815b18d47c6d5359b840b3c36", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/a2110e636933b3c815b18d47c6d5359b840b3c36", "committedDate": "2020-02-23T07:05:58Z", "message": "GG-23528 First impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1d214301023e4abfe47ea422bac23dbbf3d9589", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/e1d214301023e4abfe47ea422bac23dbbf3d9589", "committedDate": "2020-02-26T09:40:48Z", "message": "GG-23528 Fix first impl and add 2 test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032", "committedDate": "2020-02-26T09:42:18Z", "message": "Merge branch 'master' into gg-23528"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjA2NDMx", "url": "https://github.com/gridgain/gridgain/pull/958#pullrequestreview-366206431", "createdAt": "2020-02-28T07:40:19Z", "commit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNzo0MDoxOVrOFvr7nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNzo0MDoxOVrOFvr7nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0NzE2NA==", "bodyText": "May be more proper use F.exist(rawArgs, (arg) -> CMD_PRINT_ERR_STACK_TRACE.equals(CMD_PRINT_ERR_STACK_TRACE))", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385547164", "createdAt": "2020-02-28T07:40:19Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n \n+        Throwable err = null;\n+        boolean printErrStackTrace = false;\n+\n         try {\n             if (F.isEmpty(rawArgs) || (rawArgs.size() == 1 && CMD_HELP.equalsIgnoreCase(rawArgs.get(0)))) {\n                 printHelp();\n \n                 return EXIT_CODE_OK;\n             }\n \n+            printErrStackTrace = rawArgs.stream().anyMatch(CMD_PRINT_ERR_STACK_TRACE::equals);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjE3NzIz", "url": "https://github.com/gridgain/gridgain/pull/958#pullrequestreview-366217723", "createdAt": "2020-02-28T08:07:38Z", "commit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODowNzozOFrOFvsfAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODowNzozOFrOFvsfAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NjIyNA==", "bodyText": "It does not need parameter to set for print stack trace argument\n[--print-err-stack-trace]", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385556224", "createdAt": "2020-02-28T08:07:38Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/test/resources/org.apache.ignite.util/control.sh_help.output", "diffHunk": "@@ -4,7 +4,7 @@ User: <!any!>\n Time: <!any!>\n Control utility script is used to execute admin commands on cluster or get common cluster info. The command has the following syntax:\n \n-  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] [command] <command_parameters>\n+  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--print-err-stack-trace PRINT_ERR_STACK_TRACE] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] [command] <command_parameters>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjE5MjMy", "url": "https://github.com/gridgain/gridgain/pull/958#pullrequestreview-366219232", "createdAt": "2020-02-28T08:11:09Z", "commit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODoxMTowOVrOFvskAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODoxMTowOVrOFvskAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NzUwNQ==", "bodyText": "Only --print-err-stack-trace would be enough for printing stack on log.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r385557505", "createdAt": "2020-02-28T08:11:09Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/test/resources/org.apache.ignite.util/control.sh_cache_help.output", "diffHunk": "@@ -7,7 +7,7 @@ Arguments: --cache help --yes\n --------------------------------------------------------------------------------\n   The '--cache subcommand' is used to get information about and perform actions with caches. The command has the following syntax:\n \n-  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] --cache [subcommand] <subcommand_parameters>\n+  control.(sh|bat) [--host HOST_OR_IP] [--port PORT] [--user USER] [--password PASSWORD] [--ping-interval PING_INTERVAL] [--ping-timeout PING_TIMEOUT] [--print-err-stack-trace PRINT_ERR_STACK_TRACE] [--ssl-protocol SSL_PROTOCOL[, SSL_PROTOCOL_2, ..., SSL_PROTOCOL_N]] [--ssl-cipher-suites SSL_CIPHER_1[, SSL_CIPHER_2, ..., SSL_CIPHER_N]] [--ssl-key-algorithm SSL_KEY_ALGORITHM] [--keystore-type KEYSTORE_TYPE] [--keystore KEYSTORE_PATH] [--keystore-password KEYSTORE_PASSWORD] [--truststore-type TRUSTSTORE_TYPE] [--truststore TRUSTSTORE_PATH] [--truststore-password TRUSTSTORE_PASSWORD] --cache [subcommand] <subcommand_parameters>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6ea3fbcc9e91d27365b1a0bc959fb4b8125032"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fff2eccf5ca25ac4f1a3ee5eebd23809d05c174", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/0fff2eccf5ca25ac4f1a3ee5eebd23809d05c174", "committedDate": "2020-03-01T08:03:13Z", "message": "GG-23528 Fix by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "589ce3e023a6010f5047d6d5c8922c53db148cbd", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/589ce3e023a6010f5047d6d5c8922c53db148cbd", "committedDate": "2020-03-01T09:29:56Z", "message": "GG-23528 Fix by review #2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/273c1624eff9c72e1d4357451df366a191c1140e", "committedDate": "2020-03-01T09:37:54Z", "message": "Merge branch 'master' into gg-23528"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTIyOTk2", "url": "https://github.com/gridgain/gridgain/pull/958#pullrequestreview-367922996", "createdAt": "2020-03-03T12:05:43Z", "commit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowNTo0M1rOFxDJMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowNTo0M1rOFxDJMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NjA1MQ==", "bodyText": "Does this logger have an issue with printing several lines?\nLike this manner:\nlogger.info(\"Error stack trace:\\n\" +\nX.getFullStackTrace(err));", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386976051", "createdAt": "2020-03-03T12:05:43Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -319,34 +331,45 @@ public int execute(List<String> rawArgs) {\n                     if (isSSLMisconfigurationError(cause))\n                         e = cause;\n \n-                    logger.severe(\"Connection to cluster failed. \" + CommandLogger.errorMessage(e));\n+                    logger.severe(\"Connection to cluster failed. \" + errorMessage(e));\n \n                 }\n \n                 logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_CONNECTION_FAILED);\n \n+                err = e;\n+\n                 return EXIT_CODE_CONNECTION_FAILED;\n             }\n \n             if (X.hasCause(e, VisorIllegalStateException.class)) {\n                 VisorIllegalStateException vise = X.cause(e, VisorIllegalStateException.class);\n \n-                logger.severe(CommandLogger.errorMessage(vise));\n+                logger.severe(errorMessage(vise));\n                 logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_ILLEGAL_STATE_ERROR);\n \n+                err = e;\n+\n                 return EXIT_CODE_ILLEGAL_STATE_ERROR;\n             }\n \n-            logger.severe(CommandLogger.errorMessage(e));\n+            logger.severe(errorMessage(e));\n             logger.info(\"Command [\" + commandName + \"] finished with code: \" + EXIT_CODE_UNEXPECTED_ERROR);\n \n+            err = e;\n+\n             return EXIT_CODE_UNEXPECTED_ERROR;\n         }\n         finally {\n             LocalDateTime endTime = LocalDateTime.now();\n \n             Duration diff = Duration.between(startTime, endTime);\n \n+            if (printErrStackTrace && nonNull(err)) {\n+                logger.info(\"Error stack trace:\");\n+                logger.info(X.getFullStackTrace(err));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTI1MzUy", "url": "https://github.com/gridgain/gridgain/pull/958#pullrequestreview-367925352", "createdAt": "2020-03-03T12:09:43Z", "commit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowOTo0M1rOFxDQLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjowOTo0M1rOFxDQLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NzgzOA==", "bodyText": "Excess empty line.", "url": "https://github.com/gridgain/gridgain/pull/958#discussion_r386977838", "createdAt": "2020-03-03T12:09:43Z", "author": {"login": "vldpyatkov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/CommandHandler.java", "diffHunk": "@@ -222,13 +225,18 @@ public int execute(List<String> rawArgs) {\n \n         String commandName = \"\";\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273c1624eff9c72e1d4357451df366a191c1140e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fde551c397179637e1c8a7bd15530b1548e46fdd", "author": {"user": null}, "url": "https://github.com/gridgain/gridgain/commit/fde551c397179637e1c8a7bd15530b1548e46fdd", "committedDate": "2020-03-03T15:36:55Z", "message": "GG-23528 Fix by new review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4418, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}