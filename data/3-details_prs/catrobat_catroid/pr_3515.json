{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NjUyNjcz", "number": 3515, "title": "CATROID-336 \"Open\" .catrobat extension files", "bodyText": "The Pocket Code App should be able to import files with .catrobat file extension.\nWhen Other apps encounter .catrobat files they will call implicit intent to pocket code app. The pocket code app will open in the Project List Activity (ProjectListActivity).\n\n\nfiles by Google:\n\nTested on:\nPixel 3 Api29 Emulator\nZTE blade mini Android 7.0 Api24\nNexus 6P Android 7.1.1 Api25 Emulator\nNexus S Android 6 Api23 Emulator\n\n Include the name of the Jira ticket in the PR\u2019s title\n Include a summary of the changes plus the relevant context\n Choose the proper base branch (develop)\n Confirm that the changes follow the project\u2019s coding guidelines\n Verify that the changes generate no compiler or linter warnings\n Perform a self-review of the changes\n Verify to commit no other files than the intentionally changed ones\n Include reasonable and readable tests verifying the added or changed behavior\n Confirm that new and existing unit tests pass locally\n Check that the commits\u2019 message style matches the [project\u2019s guideline]\n Stick to the project\u2019s gitflow workflow\n Verify that your changes do not have any conflicts with the base branch\n After the PR, verify that all CI checks have passed\n Post a message in the catroid-stage or catroid-ide Slack channel and ask for a code reviewer", "createdAt": "2020-03-11T12:11:12Z", "url": "https://github.com/Catrobat/Catroid/pull/3515", "merged": true, "mergeCommit": {"oid": "e2035ce7d6d3e135a9780c2517ed65daac042f33"}, "closed": true, "closedAt": "2020-05-09T09:08:16Z", "author": {"login": "Gwzwnglai-AuBurn"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMn7CEgBqjMxMTkwMzA1ODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccq5q9AFqTQwMzQxMTQ4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MjMwNjc4", "url": "https://github.com/Catrobat/Catroid/pull/3515#pullrequestreview-375230678", "createdAt": "2020-03-16T13:51:49Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMzo1MTo1MFrOF21DgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMzo1MTo1MFrOF21DgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw==", "bodyText": "This method and the other methods are already implemented in the ProjectListFragment.\nPlease, find a way (maybe pass the intent as an argument) to minimize code duplication.", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r393036673", "createdAt": "2020-03-16T13:51:50Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectListActivity.java", "diffHunk": "@@ -75,4 +100,50 @@ public void handleAddButton(View view) {\n \t\tNewProjectDialogFragment dialog = new NewProjectDialogFragment();\n \t\tdialog.show(getSupportFragmentManager(), NewProjectDialogFragment.TAG);\n \t}\n+\n+\tprivate ProjectUnzipAndImportTask.ProjectUnzipAndImportListener projectUnzipAndImportListener =\n+\t\t\tnew ProjectUnzipAndImportTask.ProjectUnzipAndImportListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onImportFinished(boolean success) {\n+\t\t\t\t\tif (!success) {\n+\t\t\t\t\t\tToastUtil.showError(ProjectListActivity.this, R.string.error_import_project);\n+\t\t\t\t\t}\n+\t\t\t\t\tloadFragment(new ProjectListFragment());\n+\t\t\t\t}\n+\t\t\t};\n+\n+\tprivate ProjectImportTask.ProjectImportListener projectImportListener =\n+\t\t\tnew ProjectImportTask.ProjectImportListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onImportFinished(boolean success) {\n+\t\t\t\t\tif (!success) {\n+\t\t\t\t\t\tToastUtil.showError(ProjectListActivity.this, R.string.error_import_project);\n+\t\t\t\t\t}\n+\t\t\t\t\tloadFragment(new ProjectListFragment());\n+\t\t\t\t}\n+\t\t\t};\n+\n+\tprivate void importProjectFromExternal(String path, Intent intent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 76}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzY4MTY2", "url": "https://github.com/Catrobat/Catroid/pull/3515#pullrequestreview-382768166", "createdAt": "2020-03-27T11:14:44Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMToxNDo0NVrOF8sxjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMjowOTo1NlrOF8ubrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5MjQ2Mg==", "bodyText": "PLEASE-EXPLAIN: Is it really necessary to bundle the intent? Why don't you pass the intent.getExtras() itself?", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399192462", "createdAt": "2020-03-27T11:14:45Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectListActivity.java", "diffHunk": "@@ -35,18 +37,32 @@\n \n public class ProjectListActivity extends BaseCastActivity {\n \n+\tpublic static final String TAG = ProjectListActivity.class.getSimpleName();\n+\n \t@Override\n \tpublic void onCreate(Bundle savedInstanceState) {\n \t\tsuper.onCreate(savedInstanceState);\n-\n \t\tsetContentView(R.layout.activity_recycler);\n \t\tsetSupportActionBar(findViewById(R.id.toolbar));\n \t\tgetSupportActionBar().setTitle(R.string.project_list_title);\n \t\tgetSupportActionBar().setDisplayHomeAsUpEnabled(true);\n \n \t\tBottomBar.hidePlayButton(this);\n \n-\t\tloadFragment(new ProjectListFragment());\n+\t\tFragment projectListFragment = new ProjectListFragment();\n+\n+\t\tIntent importProjectFromImplicitIntent = getIntent();\n+\t\tif (importProjectFromImplicitIntent.getAction() != null) {\n+\t\t\ttry {\n+\t\t\t\tBundle data = new Bundle();\n+\t\t\t\tdata.putParcelable(\"intent\", importProjectFromImplicitIntent);\n+\t\t\t\tprojectListFragment.setArguments(data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNDQ2Ng==", "bodyText": "PLEASE-FIX: This check is unnecessary because the other import-use-case only generates \"file\" URIs and this use-case ignores it. => the boolean-flag, the check, and these try-catches only obfuscate code.  => delete it\nThanks!", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399204466", "createdAt": "2020-03-27T11:38:57Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -195,8 +212,19 @@ private void importProject(Intent data) {\n \t\t\treturn;\n \t\t}\n \n-\t\tif (!data.getData().getScheme().equals(\"file\")) {\n-\t\t\tthrow new IllegalArgumentException(\"importProject has to be called with a file uri. (not a content uri\");\n+\t\tboolean isImporting = false;\n+\t\ttry {\n+\t\t\tisImporting = data.getExtras().getSerializable(\"IS_IMPORTING_FROM_IMPLICIT_INTENT\") != null;\n+\t\t} catch (NullPointerException e) {\n+\t\t\tLog.e(TAG, \"Null pointer exception\", e);\n+\t\t}\n+\n+\t\ttry {\n+\t\t\tif (!data.getData().getScheme().equals(\"file\") && !isImporting) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjgwNA==", "bodyText": "PLEASE FIX: Since the bundle holds the intent and vise-versa, this could probably lead to a memory loss.\nSure, the Garbage-Collector of Java may realize this, but it's also not a good idea to recycle variables.\n(->Intent->Bundle->)", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399216804", "createdAt": "2020-03-27T12:04:15Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -86,6 +90,19 @@\n \n \tprivate static final int REQUEST_IMPORT_PROJECT = 7;\n \n+\t@Override\n+\tpublic View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n+\t\tView view = super.onCreateView(inflater, container, savedInstanceState);\n+\t\tif (getArguments() != null) {\n+\t\t\tBundle data = getArguments();\n+\t\t\tIntent intent = data.getParcelable(\"intent\");\n+\t\t\tdata.putSerializable(\"IS_IMPORTING_FROM_IMPLICIT_INTENT\", true);\n+\t\t\tintent.putExtras(data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxOTYyOQ==", "bodyText": "Feel free to refactor function signatures, etc.. to get your code as short and as readable as possible ;)", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399219629", "createdAt": "2020-03-27T12:09:56Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -86,6 +90,19 @@\n \n \tprivate static final int REQUEST_IMPORT_PROJECT = 7;\n \n+\t@Override\n+\tpublic View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n+\t\tView view = super.onCreateView(inflater, container, savedInstanceState);\n+\t\tif (getArguments() != null) {\n+\t\t\tBundle data = getArguments();\n+\t\t\tIntent intent = data.getParcelable(\"intent\");\n+\t\t\tdata.putSerializable(\"IS_IMPORTING_FROM_IMPLICIT_INTENT\", true);\n+\t\t\tintent.putExtras(data);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjgwNA=="}, "originalCommit": null, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMDkwNjg4", "url": "https://github.com/Catrobat/Catroid/pull/3515#pullrequestreview-390090688", "createdAt": "2020-04-08T15:34:31Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNTozNDozMVrOGC053A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNTozNDozMVrOGC053A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzExNg==", "bodyText": "PRAISE: The code looks much better than before!\nPLEASE-EXPLAIN: What's the source of the null-ptr-exception?\nPLEASE-FIX: I think there is a race condition with the adapter.\nThe adapter is used in the callback methods, the import method is called \"onCreateView\", but the adapter is initialized \"inOnActivityCreated\"  => if the import finishes before the activity was created a null-ptr-exception occurs.\nhttps://stackoverflow.com/questions/28929637/difference-and-uses-of-oncreate-oncreateview-and-onactivitycreated-in-fra", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r405617116", "createdAt": "2020-04-08T15:34:31Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -217,7 +227,7 @@ private void importProject(Intent data) {\n \t\t\t\t\t\t.execute(projectFile);\n \t\t\t}\n \t\t\tsetShowProgressBar(true);\n-\t\t} catch (IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "author": {"user": {"login": "Gwzwnglai-AuBurn", "name": "Gwzwn"}}, "url": "https://github.com/Catrobat/Catroid/commit/96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "committedDate": "2020-04-29T05:33:53Z", "message": "CATROID-336 \"Open\" .catrobat extension files"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "author": {"user": {"login": "Gwzwnglai-AuBurn", "name": "Gwzwn"}}, "url": "https://github.com/Catrobat/Catroid/commit/96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "committedDate": "2020-04-29T05:33:53Z", "message": "CATROID-336 \"Open\" .catrobat extension files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNDExNDg5", "url": "https://github.com/Catrobat/Catroid/pull/3515#pullrequestreview-403411489", "createdAt": "2020-04-30T10:54:58Z", "commit": {"oid": "96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2015, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}