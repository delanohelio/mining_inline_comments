{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NDUzNjE3", "number": 3510, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyNzoyMFrODoSfqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxOTowMVrODqEvvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTcyNjUxOnYy", "diffSide": "RIGHT", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyNzoyMFrOF2vwmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNzo1MTowN1rOF3RAcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0OTkxNA==", "bodyText": "Please try with dagger and dependency injection.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r392949914", "createdAt": "2020-03-16T11:27:20Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "diffHunk": "@@ -238,47 +243,115 @@ public void onItemClick(CategoryListItem item) {\n \t\t\t\tshowSelectSpriteDialog();\n \t\t\t\tbreak;\n \t\t\tcase CategoryListRVAdapter.DEFAULT:\n-\t\t\t\t((FormulaEditorFragment) getFragmentManager()\n-\t\t\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG))\n-\t\t\t\t\t\t.addResourceToActiveFormula(item.nameResId);\n-\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\tif (LIST_FUNCTIONS.contains(item.nameResId)) {\n+\t\t\t\t\tonUserListFunctionSelected(item);\n+\t\t\t\t} else {\n+\t\t\t\t\taddResourceToActiveFormulaInFormulaEditor(item);\n+\t\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t}\n \t}\n \n+\tprivate FormulaEditorFragment addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem) {\n+\t\tFormulaEditorFragment formulaEditorFragment = ((FormulaEditorFragment) getFragmentManager()\n+\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG));\n+\t\tformulaEditorFragment.addResourceToActiveFormula(categoryListItem.nameResId);\n+\t\treturn formulaEditorFragment;\n+\t}\n+\n+\tprivate void addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem, UserList lastUserList) {\n+\t\taddResourceToActiveFormulaInFormulaEditor(categoryListItem).addUserListToActiveFormula(lastUserList.getName());\n+\t\tgetActivity().onBackPressed();\n+\t}\n+\n+\tprivate void onUserListFunctionSelected(CategoryListItem item) {\n+\t\tFragmentActivity activity = getActivity();\n+\t\tTextInputDialog.Builder builder = new TextInputDialog.Builder(activity);\n+\t\tfinal List<UserList> projectUserList =\n+\t\t\t\tProjectManager.getInstance().getCurrentProject().getUserLists();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ4MTczMA==", "bodyText": "According to @SimonStefan this is not yet possible for fragments. As it will still take time till the concerning PR is merged ProjectManager.getInstance() should be used until then.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r393481730", "createdAt": "2020-03-17T07:16:18Z", "author": {"login": "mstoeg"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "diffHunk": "@@ -238,47 +243,115 @@ public void onItemClick(CategoryListItem item) {\n \t\t\t\tshowSelectSpriteDialog();\n \t\t\t\tbreak;\n \t\t\tcase CategoryListRVAdapter.DEFAULT:\n-\t\t\t\t((FormulaEditorFragment) getFragmentManager()\n-\t\t\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG))\n-\t\t\t\t\t\t.addResourceToActiveFormula(item.nameResId);\n-\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\tif (LIST_FUNCTIONS.contains(item.nameResId)) {\n+\t\t\t\t\tonUserListFunctionSelected(item);\n+\t\t\t\t} else {\n+\t\t\t\t\taddResourceToActiveFormulaInFormulaEditor(item);\n+\t\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t}\n \t}\n \n+\tprivate FormulaEditorFragment addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem) {\n+\t\tFormulaEditorFragment formulaEditorFragment = ((FormulaEditorFragment) getFragmentManager()\n+\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG));\n+\t\tformulaEditorFragment.addResourceToActiveFormula(categoryListItem.nameResId);\n+\t\treturn formulaEditorFragment;\n+\t}\n+\n+\tprivate void addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem, UserList lastUserList) {\n+\t\taddResourceToActiveFormulaInFormulaEditor(categoryListItem).addUserListToActiveFormula(lastUserList.getName());\n+\t\tgetActivity().onBackPressed();\n+\t}\n+\n+\tprivate void onUserListFunctionSelected(CategoryListItem item) {\n+\t\tFragmentActivity activity = getActivity();\n+\t\tTextInputDialog.Builder builder = new TextInputDialog.Builder(activity);\n+\t\tfinal List<UserList> projectUserList =\n+\t\t\t\tProjectManager.getInstance().getCurrentProject().getUserLists();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0OTkxNA=="}, "originalCommit": null, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ5NDY0MQ==", "bodyText": "Ok, thanks!", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r393494641", "createdAt": "2020-03-17T07:51:07Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "diffHunk": "@@ -238,47 +243,115 @@ public void onItemClick(CategoryListItem item) {\n \t\t\t\tshowSelectSpriteDialog();\n \t\t\t\tbreak;\n \t\t\tcase CategoryListRVAdapter.DEFAULT:\n-\t\t\t\t((FormulaEditorFragment) getFragmentManager()\n-\t\t\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG))\n-\t\t\t\t\t\t.addResourceToActiveFormula(item.nameResId);\n-\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\tif (LIST_FUNCTIONS.contains(item.nameResId)) {\n+\t\t\t\t\tonUserListFunctionSelected(item);\n+\t\t\t\t} else {\n+\t\t\t\t\taddResourceToActiveFormulaInFormulaEditor(item);\n+\t\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t}\n \t}\n \n+\tprivate FormulaEditorFragment addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem) {\n+\t\tFormulaEditorFragment formulaEditorFragment = ((FormulaEditorFragment) getFragmentManager()\n+\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG));\n+\t\tformulaEditorFragment.addResourceToActiveFormula(categoryListItem.nameResId);\n+\t\treturn formulaEditorFragment;\n+\t}\n+\n+\tprivate void addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem, UserList lastUserList) {\n+\t\taddResourceToActiveFormulaInFormulaEditor(categoryListItem).addUserListToActiveFormula(lastUserList.getName());\n+\t\tgetActivity().onBackPressed();\n+\t}\n+\n+\tprivate void onUserListFunctionSelected(CategoryListItem item) {\n+\t\tFragmentActivity activity = getActivity();\n+\t\tTextInputDialog.Builder builder = new TextInputDialog.Builder(activity);\n+\t\tfinal List<UserList> projectUserList =\n+\t\t\t\tProjectManager.getInstance().getCurrentProject().getUserLists();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0OTkxNA=="}, "originalCommit": null, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTczNTkyOnYy", "diffSide": "LEFT", "path": "catroid/src/androidTest/java/org/catrobat/catroid/uiespresso/formulaeditor/FormulaEditorFunctionListTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozMDoxMlrOF2v2QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozMDoxMlrOF2v2QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1MTM2MA==", "bodyText": "PLEASE_EXPLAIN: Why are these tests not necessary anymore?", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r392951360", "createdAt": "2020-03-16T11:30:12Z", "author": {"login": "gPathpp"}, "path": "catroid/src/androidTest/java/org/catrobat/catroid/uiespresso/formulaeditor/FormulaEditorFunctionListTest.java", "diffHunk": "@@ -92,12 +92,6 @@\n \t\t\t\t{R.string.formula_editor_function_join, R.string.formula_editor_function_join_parameter, \"join\"},\n \t\t\t\t{R.string.formula_editor_function_regex, R.string.formula_editor_function_regex_parameter,\n \t\t\t\t\t\t\"regular expression\"},\n-\t\t\t\t{R.string.formula_editor_function_number_of_items, R.string", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTczOTExOnYy", "diffSide": "LEFT", "path": "catroid/src/main/java/org/catrobat/catroid/content/bricks/UserListBrick.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozMTowOVrOF2v4LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozMTowOVrOF2v4LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1MTg1Mg==", "bodyText": "Great! That's way more readable.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r392951852", "createdAt": "2020-03-16T11:31:09Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/content/bricks/UserListBrick.java", "diffHunk": "@@ -105,44 +104,31 @@ public void onNewOptionSelected() {\n \n \t\tbuilder.setHint(activity.getString(R.string.data_label))\n \t\t\t\t.setTextWatcher(new NewItemTextWatcher<>(spinner.getItems()))\n-\t\t\t\t.setPositiveButton(activity.getString(R.string.ok), new TextInputDialog.OnClickListener() {\n-\t\t\t\t\t@Override\n-\t\t\t\t\tpublic void onPositiveButtonClick(DialogInterface dialog, String textInput) {\n-\t\t\t\t\t\tUserList userList = new UserList(textInput);\n-\n-\t\t\t\t\t\tRadioButton addToProjectListsRadioButton = ((Dialog) dialog).findViewById(R.id.global);\n-\t\t\t\t\t\tboolean addToProjectLists = addToProjectListsRadioButton.isChecked();\n-\n-\t\t\t\t\t\tif (addToProjectLists) {\n-\t\t\t\t\t\t\tcurrentProject.addUserList(userList);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tcurrentSprite.addUserList(userList);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\tspinner.add(userList);\n-\t\t\t\t\t\tspinner.setSelection(userList);\n-\n-\t\t\t\t\t\tScriptFragment parentFragment = (ScriptFragment) activity\n-\t\t\t\t\t\t\t\t.getSupportFragmentManager().findFragmentByTag(ScriptFragment.TAG);\n-\t\t\t\t\t\tif (parentFragment != null) {\n-\t\t\t\t\t\t\tparentFragment.notifyDataSetChanged();\n-\t\t\t\t\t\t}\n+\t\t\t\t.setPositiveButton(activity.getString(R.string.ok), (TextInputDialog.OnClickListener) (dialog, textInput) -> {\n+\t\t\t\t\tUserList userList = new UserList(textInput);\n+\n+\t\t\t\t\tRadioButton addToProjectListsRadioButton = ((Dialog) dialog).findViewById(R.id.global);\n+\t\t\t\t\tboolean addToProjectLists = addToProjectListsRadioButton.isChecked();\n+\n+\t\t\t\t\tif (addToProjectLists) {\n+\t\t\t\t\t\tcurrentProject.addUserList(userList);\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tcurrentSprite.addUserList(userList);\n+\t\t\t\t\t}\n+\t\t\t\t\tspinner.add(userList);\n+\t\t\t\t\tspinner.setSelection(userList);\n+\n+\t\t\t\t\tScriptFragment parentFragment = (ScriptFragment) activity\n+\t\t\t\t\t\t\t.getSupportFragmentManager().findFragmentByTag(ScriptFragment.TAG);\n+\t\t\t\t\tif (parentFragment != null) {\n+\t\t\t\t\t\tparentFragment.notifyDataSetChanged();\n \t\t\t\t\t}\n \t\t\t\t});\n \n \t\tbuilder.setTitle(R.string.formula_editor_list_dialog_title)\n \t\t\t\t.setView(R.layout.dialog_new_user_data)\n-\t\t\t\t.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTc0MTAwOnYy", "diffSide": "LEFT", "path": "catroid/src/main/java/org/catrobat/catroid/ui/fragment/FormulaEditorFragment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozMTo0NFrOF2v5XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozMTo0NFrOF2v5XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1MjE1Ng==", "bodyText": "Nice!", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r392952156", "createdAt": "2020-03-16T11:31:44Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/fragment/FormulaEditorFragment.java", "diffHunk": "@@ -365,12 +364,7 @@ private void showNewStringDialog() {\n \n \t\tbuilder.setHint(getString(R.string.string_label))\n \t\t\t\t.setText(selectedFormulaText)\n-\t\t\t\t.setPositiveButton(getString(R.string.ok), new TextInputDialog.OnClickListener() {\n-\t\t\t\t\t@Override\n-\t\t\t\t\tpublic void onPositiveButtonClick(DialogInterface dialog, String textInput) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTc1OTU1OnYy", "diffSide": "RIGHT", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozNzoyMVrOF2wE0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTozNzoyMVrOF2wE0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1NTA5MQ==", "bodyText": "Please check if the fragment exists. It could lead to a null-pointer exception.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r392955091", "createdAt": "2020-03-16T11:37:21Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "diffHunk": "@@ -238,47 +243,115 @@ public void onItemClick(CategoryListItem item) {\n \t\t\t\tshowSelectSpriteDialog();\n \t\t\t\tbreak;\n \t\t\tcase CategoryListRVAdapter.DEFAULT:\n-\t\t\t\t((FormulaEditorFragment) getFragmentManager()\n-\t\t\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG))\n-\t\t\t\t\t\t.addResourceToActiveFormula(item.nameResId);\n-\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\tif (LIST_FUNCTIONS.contains(item.nameResId)) {\n+\t\t\t\t\tonUserListFunctionSelected(item);\n+\t\t\t\t} else {\n+\t\t\t\t\taddResourceToActiveFormulaInFormulaEditor(item);\n+\t\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t}\n \t}\n \n+\tprivate FormulaEditorFragment addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem) {\n+\t\tFormulaEditorFragment formulaEditorFragment = ((FormulaEditorFragment) getFragmentManager()\n+\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG));\n+\t\tformulaEditorFragment.addResourceToActiveFormula(categoryListItem.nameResId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTc2OTMxOnYy", "diffSide": "RIGHT", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTo0MDoxOFrOF2wKpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTo0MDoxOFrOF2wKpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1NjU4Mw==", "bodyText": "Nice!", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r392956583", "createdAt": "2020-03-16T11:40:18Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "diffHunk": "@@ -447,11 +517,11 @@ private void initializeAdapter() {\n \n \t\tSensorHandler sensorHandler = SensorHandler.getInstance(getActivity());\n \t\tdeviceSensorItems.addAll(sensorHandler.accelerationAvailable() ? toCategoryListItems(SENSORS_ACCELERATION)\n-\t\t\t\t: Collections.<CategoryListItem>emptyList());\n+\t\t\t\t: Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 224}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjcyNjI0OnYy", "diffSide": "RIGHT", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToyOTozOFrOF25kHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToyOTozOFrOF25kHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExMDU1OQ==", "bodyText": "Please make a util method/class, or something else for this task. Because there are already two places where the user-list is added to the project.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r393110559", "createdAt": "2020-03-16T15:29:38Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/CategoryListFragment.java", "diffHunk": "@@ -238,47 +243,115 @@ public void onItemClick(CategoryListItem item) {\n \t\t\t\tshowSelectSpriteDialog();\n \t\t\t\tbreak;\n \t\t\tcase CategoryListRVAdapter.DEFAULT:\n-\t\t\t\t((FormulaEditorFragment) getFragmentManager()\n-\t\t\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG))\n-\t\t\t\t\t\t.addResourceToActiveFormula(item.nameResId);\n-\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\tif (LIST_FUNCTIONS.contains(item.nameResId)) {\n+\t\t\t\t\tonUserListFunctionSelected(item);\n+\t\t\t\t} else {\n+\t\t\t\t\taddResourceToActiveFormulaInFormulaEditor(item);\n+\t\t\t\t\tgetActivity().onBackPressed();\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t}\n \t}\n \n+\tprivate FormulaEditorFragment addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem) {\n+\t\tFormulaEditorFragment formulaEditorFragment = ((FormulaEditorFragment) getFragmentManager()\n+\t\t\t\t.findFragmentByTag(FormulaEditorFragment.FORMULA_EDITOR_FRAGMENT_TAG));\n+\t\tformulaEditorFragment.addResourceToActiveFormula(categoryListItem.nameResId);\n+\t\treturn formulaEditorFragment;\n+\t}\n+\n+\tprivate void addResourceToActiveFormulaInFormulaEditor(CategoryListItem categoryListItem, UserList lastUserList) {\n+\t\taddResourceToActiveFormulaInFormulaEditor(categoryListItem).addUserListToActiveFormula(lastUserList.getName());\n+\t\tgetActivity().onBackPressed();\n+\t}\n+\n+\tprivate void onUserListFunctionSelected(CategoryListItem item) {\n+\t\tFragmentActivity activity = getActivity();\n+\t\tTextInputDialog.Builder builder = new TextInputDialog.Builder(activity);\n+\t\tfinal List<UserList> projectUserList =\n+\t\t\t\tProjectManager.getInstance().getCurrentProject().getUserLists();\n+\t\tfinal List<UserList> spriteUserList =\n+\t\t\t\tProjectManager.getInstance().getCurrentSprite().getUserLists();\n+\t\tinsertLastUserListToActiveFormula(item, projectUserList, spriteUserList,\n+\t\t\t\tactivity, builder);\n+\t}\n+\n+\t@VisibleForTesting\n+\tpublic void insertLastUserListToActiveFormula(CategoryListItem categoryListItem,\n+\t\t\tList<UserList> projectUserList, List<UserList> spriteUserList,\n+\t\t\tFragmentActivity activity,\n+\t\t\tTextInputDialog.Builder builder) {\n+\n+\t\tif (spriteUserList.isEmpty() && projectUserList.isEmpty()) {\n+\t\t\tshowNewUserListDialog(categoryListItem, projectUserList, spriteUserList,\n+\t\t\t\t\tactivity, builder);\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tif (!spriteUserList.isEmpty()) {\n+\t\t\taddResourceToActiveFormulaInFormulaEditor(categoryListItem, spriteUserList.get(spriteUserList.size() - 1));\n+\t\t\treturn;\n+\t\t}\n+\t\taddResourceToActiveFormulaInFormulaEditor(categoryListItem, projectUserList.get(projectUserList.size() - 1));\n+\t}\n+\n+\tprivate void showNewUserListDialog(CategoryListItem categoryListItem, List<UserList> projectUserList, List<UserList> spriteUserList,\n+\t\t\tFragmentActivity activity, TextInputDialog.Builder builder) {\n+\t\tbuilder.setHint(activity.getString(R.string.data_label))\n+\t\t\t\t.setPositiveButton(activity.getString(R.string.ok), (TextInputDialog.OnClickListener) (dialog, textInput) -> {\n+\t\t\t\t\tif (textInput.isEmpty()) {\n+\t\t\t\t\t\tactivity.onBackPressed();\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\t}\n+\t\t\t\t\tUserList userList = new UserList(textInput);\n+\n+\t\t\t\t\tRadioButton addToProjectListsRadioButton = ((Dialog) dialog).findViewById(R.id.global);\n+\t\t\t\t\tboolean addToProjectLists = addToProjectListsRadioButton.isChecked();\n+\n+\t\t\t\t\tif (addToProjectLists) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDQ0MzA3OnYy", "diffSide": "RIGHT", "path": "catroid/src/main/java/org/catrobat/catroid/formulaeditor/InternFormula.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxNDoyNFrOF5ot4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxNDoyNFrOF5ot4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MDI1OA==", "bodyText": "Please add a test.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r395980258", "createdAt": "2020-03-21T10:14:24Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/formulaeditor/InternFormula.java", "diffHunk": "@@ -726,6 +726,11 @@ private CursorTokenPropertiesAfterModification setCursorPositionAndSelectionAfte\n \t\t\t\t\t\t.getFunctionParameterInternTokensAsLists(functionInternTokenList);\n \t\t\t\tList<InternToken> functionFirstParameter = functionParameters.get(0);\n \n+\t\t\t\tif (functionInternTokenList.get(0).getTokenStringValue().equals(Functions.LIST_ITEM.name()) && !functionFirstParameter.get(0).isUserList()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDQ0MzE1OnYy", "diffSide": "LEFT", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/adapter/CategoryListRVAdapter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxNDo0MFrOF5ot6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxNDo0MFrOF5ot6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MDI2Nw==", "bodyText": "Nice!", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r395980267", "createdAt": "2020-03-21T10:14:40Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/adapter/CategoryListRVAdapter.java", "diffHunk": "@@ -89,12 +89,7 @@ public void onBindViewHolder(@NonNull ViewHolder holder, final int position) {\n \t\t}\n \n \t\tholder.title.setText(item.text);\n-\t\tholder.itemView.setOnClickListener(new View.OnClickListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDQ0NTQyOnYy", "diffSide": "RIGHT", "path": "catroid/src/main/java/org/catrobat/catroid/utils/AddUserListDialog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxOTowMVrOF5ovCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQxMDoxOTowMVrOF5ovCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MDU1Mw==", "bodyText": "Please remove the activity and pass the strings instead.", "url": "https://github.com/Catrobat/Catroid/pull/3510#discussion_r395980553", "createdAt": "2020-03-21T10:19:01Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/utils/AddUserListDialog.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package org.catrobat.catroid.utils;\n+\n+import android.app.Activity;\n+import android.app.Dialog;\n+import android.content.DialogInterface;\n+import android.widget.RadioButton;\n+\n+import org.catrobat.catroid.R;\n+import org.catrobat.catroid.content.bricks.brickspinner.BrickSpinner;\n+import org.catrobat.catroid.formulaeditor.UserList;\n+import org.catrobat.catroid.ui.recyclerview.dialog.TextInputDialog;\n+import org.catrobat.catroid.ui.recyclerview.dialog.textwatcher.NewItemTextWatcher;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class AddUserListDialog {\n+\tprivate Activity activity;\n+\tprivate TextInputDialog.Builder builder;\n+\tprivate BrickSpinner<UserList> spinner;\n+\tprivate List<UserList> existingUserLists;\n+\n+\tpublic AddUserListDialog(Activity activity, TextInputDialog.Builder builder, BrickSpinner<UserList> spinner) {\n+\t\tthis.activity = activity;\n+\t\tthis.builder = builder;\n+\t\tthis.spinner = spinner;\n+\t\texistingUserLists = spinner.getItems();\n+\t}\n+\n+\tpublic AddUserListDialog(Activity activity, TextInputDialog.Builder builder) {\n+\t\tthis.activity = activity;\n+\t\tthis.builder = builder;\n+\t\texistingUserLists = new ArrayList<>();\n+\t}\n+\n+\tpublic void show(Callback callback) {\n+\t\tbuilder.setHint(activity.getString(R.string.data_label))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4009, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}