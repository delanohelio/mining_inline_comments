{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2ODE0NTA5", "number": 3568, "title": "CATROID-126 Fixed repeating sound to match scratch behavior", "bodyText": "If an object is playing a sound that is already being played they are not overlapping each other anymore, instead the first one is stopped.\nThis does not concern the same sound of different objects or different sounds.\nIf an \"Start Sound and Wait\" brick is waiting on the sound to finish but the same sound gets started it cancels the wait and continues to the next brick.\n*added new testcases to check if sounds stop.\n*added new testcases to check the function of \"Start Sound and Wait\"\nJIRA: https://jira.catrob.at/browse/CATROID-126\nYour checklist for this pull request\nPlease review the contributing guidelines and wiki pages of this repository.\n\n Include the name of the Jira ticket in the PR\u2019s title\n Include a summary of the changes plus the relevant context\n Choose the proper base branch (develop)\n Confirm that the changes follow the project\u2019s coding guidelines\n Verify that the changes generate no compiler or linter warnings\n Perform a self-review of the changes\n Verify to commit no other files than the intentionally changed ones\n Include reasonable and readable tests verifying the added or changed behavior\n Confirm that new and existing unit tests pass locally\n Check that the commits\u2019 message style matches the project\u2019s guideline\n Stick to the project\u2019s gitflow workflow\n Verify that your changes do not have any conflicts with the base branch\n After the PR, verify that all CI checks have passed\n Post a message in the catroid-stage or catroid-ide Slack channel and ask for a code reviewer", "createdAt": "2020-04-01T07:38:45Z", "url": "https://github.com/Catrobat/Catroid/pull/3568", "merged": true, "mergeCommit": {"oid": "199466abeb3aeda48f13ca9ce1dc10817d999a0d"}, "closed": true, "closedAt": "2020-06-14T21:16:40Z", "author": {"login": "maxf24"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTS_sHABqjMxODY2NjcwNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrSofygFqTQzMDI1MTEyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODgyMzc5", "url": "https://github.com/Catrobat/Catroid/pull/3568#pullrequestreview-389882379", "createdAt": "2020-04-08T11:22:57Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNzA5Mjc1", "url": "https://github.com/Catrobat/Catroid/pull/3568#pullrequestreview-411709275", "createdAt": "2020-05-14T11:25:09Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODE1MjUy", "url": "https://github.com/Catrobat/Catroid/pull/3568#pullrequestreview-425815252", "createdAt": "2020-06-07T12:25:47Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDU4NDM1", "url": "https://github.com/Catrobat/Catroid/pull/3568#pullrequestreview-428058435", "createdAt": "2020-06-10T13:35:25Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozNToyNVrOGh1HNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNDoxNTowMVrOGh25xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyNjM5MQ==", "bodyText": "PLEASE-EXPLAIN: For what does this function do?\nPLEASE-FIX: Please Rename this function.", "url": "https://github.com/Catrobat/Catroid/pull/3568#discussion_r438126391", "createdAt": "2020-06-10T13:35:25Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/io/SoundManager.java", "diffHunk": "@@ -74,6 +87,30 @@ public synchronized void playSoundFileWithStartTime(String pathToSoundfile,\n \t\t}\n \t}\n \n+\tprivate void stopSameSpritePlayingSameSound(String pathToSoundFile, Sprite spriteToStartSound,\n+\t\t\tBrick brickToStartSound) {\n+\t\tfor (MediaPlayerWithSoundDetails mediaPlayer : mediaPlayers) {\n+\t\t\tif (mediaPlayer.isPlaying() && mediaPlayer.getStartedBySprite() == spriteToStartSound\n+\t\t\t\t\t&& mediaPlayer.getPathToSoundFile().equals(pathToSoundFile)\n+\t\t\t\t\t&& checkStopWithStartedBrick(mediaPlayer, brickToStartSound)) {\n+\t\t\t\tmediaPlayer.stop();\n+\t\t\t\trecentlyStoppedSoundfilePaths.add(new SoundFilePathWithSprite(\n+\t\t\t\t\t\tmediaPlayer.getPathToSoundFile(), spriteToStartSound));\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate boolean checkStopWithStartedBrick(MediaPlayerWithSoundDetails mediaPlayer, Brick brickToStartSound) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyNzU2Mw==", "bodyText": "PLEASE-EXPLAIN: Why do you compare the Script pointers here?", "url": "https://github.com/Catrobat/Catroid/pull/3568#discussion_r438127563", "createdAt": "2020-06-10T13:37:05Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/io/SoundManager.java", "diffHunk": "@@ -74,6 +87,30 @@ public synchronized void playSoundFileWithStartTime(String pathToSoundfile,\n \t\t}\n \t}\n \n+\tprivate void stopSameSpritePlayingSameSound(String pathToSoundFile, Sprite spriteToStartSound,\n+\t\t\tBrick brickToStartSound) {\n+\t\tfor (MediaPlayerWithSoundDetails mediaPlayer : mediaPlayers) {\n+\t\t\tif (mediaPlayer.isPlaying() && mediaPlayer.getStartedBySprite() == spriteToStartSound\n+\t\t\t\t\t&& mediaPlayer.getPathToSoundFile().equals(pathToSoundFile)\n+\t\t\t\t\t&& checkStopWithStartedBrick(mediaPlayer, brickToStartSound)) {\n+\t\t\t\tmediaPlayer.stop();\n+\t\t\t\trecentlyStoppedSoundfilePaths.add(new SoundFilePathWithSprite(\n+\t\t\t\t\t\tmediaPlayer.getPathToSoundFile(), spriteToStartSound));\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate boolean checkStopWithStartedBrick(MediaPlayerWithSoundDetails mediaPlayer, Brick brickToStartSound) {\n+\t\tif (brickToStartSound instanceof PlaySoundAndWaitBrick || brickToStartSound instanceof SpeakAndWaitBrick) {\n+\t\t\treturn mediaPlayer.getStartedByBrick().getScript() != brickToStartSound.getScript();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyOTA0Mw==", "bodyText": "Nice!", "url": "https://github.com/Catrobat/Catroid/pull/3568#discussion_r438129043", "createdAt": "2020-06-10T13:39:07Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/io/SoundManager.java", "diffHunk": "@@ -42,9 +50,10 @@\n \tprivate static final String TAG = SoundManager.class.getSimpleName();\n \tprivate static final SoundManager INSTANCE = new SoundManager();\n \n-\tprivate final List<MediaPlayer> mediaPlayers = new ArrayList<MediaPlayer>(MAX_MEDIA_PLAYERS);\n+\tprivate final List<MediaPlayerWithSoundDetails> mediaPlayers = new ArrayList<>(MAX_MEDIA_PLAYERS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEzMzY4MA==", "bodyText": "PLEASE-FIX:\n\nRename method. (it does not stop the sprite, or does it?)\nRename the parameters spriteToStartSound -> sprite (it doesn't start the sound in this method) and the same for the brick\nRename pathToSoundFile to soundFilePath", "url": "https://github.com/Catrobat/Catroid/pull/3568#discussion_r438133680", "createdAt": "2020-06-10T13:45:27Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/io/SoundManager.java", "diffHunk": "@@ -74,6 +87,30 @@ public synchronized void playSoundFileWithStartTime(String pathToSoundfile,\n \t\t}\n \t}\n \n+\tprivate void stopSameSpritePlayingSameSound(String pathToSoundFile, Sprite spriteToStartSound,", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE1NTcxOQ==", "bodyText": "This is the only (real) usage of the StartedByBrick. Is this line of code necessary or can this functionality be implemented in a better way?", "url": "https://github.com/Catrobat/Catroid/pull/3568#discussion_r438155719", "createdAt": "2020-06-10T14:15:01Z", "author": {"login": "gPathpp"}, "path": "catroid/src/main/java/org/catrobat/catroid/io/SoundManager.java", "diffHunk": "@@ -74,6 +87,30 @@ public synchronized void playSoundFileWithStartTime(String pathToSoundfile,\n \t\t}\n \t}\n \n+\tprivate void stopSameSpritePlayingSameSound(String pathToSoundFile, Sprite spriteToStartSound,\n+\t\t\tBrick brickToStartSound) {\n+\t\tfor (MediaPlayerWithSoundDetails mediaPlayer : mediaPlayers) {\n+\t\t\tif (mediaPlayer.isPlaying() && mediaPlayer.getStartedBySprite() == spriteToStartSound\n+\t\t\t\t\t&& mediaPlayer.getPathToSoundFile().equals(pathToSoundFile)\n+\t\t\t\t\t&& checkStopWithStartedBrick(mediaPlayer, brickToStartSound)) {\n+\t\t\t\tmediaPlayer.stop();\n+\t\t\t\trecentlyStoppedSoundfilePaths.add(new SoundFilePathWithSprite(\n+\t\t\t\t\t\tmediaPlayer.getPathToSoundFile(), spriteToStartSound));\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate boolean checkStopWithStartedBrick(MediaPlayerWithSoundDetails mediaPlayer, Brick brickToStartSound) {\n+\t\tif (brickToStartSound instanceof PlaySoundAndWaitBrick || brickToStartSound instanceof SpeakAndWaitBrick) {\n+\t\t\treturn mediaPlayer.getStartedByBrick().getScript() != brickToStartSound.getScript();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyNzU2Mw=="}, "originalCommit": null, "originalPosition": 79}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "c098498401236bbab03c2b992a55e66dae7ca0e2", "author": {"user": {"login": "maxf24", "name": "Maximilian Flicker"}}, "url": "https://github.com/Catrobat/Catroid/commit/c098498401236bbab03c2b992a55e66dae7ca0e2", "committedDate": "2020-06-13T09:18:01Z", "message": "CATROID-126 Fixed repeating sound to match scratch behavior"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c098498401236bbab03c2b992a55e66dae7ca0e2", "author": {"user": {"login": "maxf24", "name": "Maximilian Flicker"}}, "url": "https://github.com/Catrobat/Catroid/commit/c098498401236bbab03c2b992a55e66dae7ca0e2", "committedDate": "2020-06-13T09:18:01Z", "message": "CATROID-126 Fixed repeating sound to match scratch behavior"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjUxMTI3", "url": "https://github.com/Catrobat/Catroid/pull/3568#pullrequestreview-430251127", "createdAt": "2020-06-14T21:07:21Z", "commit": {"oid": "c098498401236bbab03c2b992a55e66dae7ca0e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1902, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}