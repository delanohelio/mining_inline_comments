{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MTMxOTgx", "number": 3063, "title": "ARTEMIS-2692 refactor queue creation", "bodyText": "This commit does the following:\n\nDeprecates existing overloaded createQueue, createSharedQueue,\ncreateTemporaryQueue, & updateQueue methods for ClientSession,\nServerSession, ActiveMQServer, & ActiveMQServerControl where\napplicable.\nDeprecates QueueAttributes, QueueConfig, & CoreQueueConfiguration.\nDeprecates existing overloaded constructors for QueueImpl.\nImplements QueueConfiguration with JavaDoc to be the single,\ncentralized configuration object for both client-side and broker-side\nqueue creation including methods to convert to & from JSON for use in\nthe management API.\nImplements new createQueue, createSharedQueue, createTemporaryQueue &\nupdateQueue methods with JavaDoc for ClientSession, ServerSession,\nActiveMQServer, & ActiveMQServerControl as well as a new constructor\nfor QueueImpl all using the new QueueConfiguration object.\nChanges all tests and internal code to use the new methods.", "createdAt": "2020-04-05T15:27:49Z", "url": "https://github.com/apache/activemq-artemis/pull/3063", "merged": true, "mergeCommit": {"oid": "42f75537e47a4b7b1ceb3d3528a1df3833397f9f"}, "closed": true, "closedAt": "2020-04-13T20:02:22Z", "author": {"login": "jbertram"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUtUFbAFqTM4Nzg0MDEwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXUBVdABqjMyMjgyNjI0MDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODQwMTA2", "url": "https://github.com/apache/activemq-artemis/pull/3063#pullrequestreview-387840106", "createdAt": "2020-04-05T17:12:14Z", "commit": {"oid": "40bab72d61b1c5972da0c356edb2f21de1b87ad6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxNzoxMjoxNFrOGBBv1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxNzoxMjoxNFrOGBBv1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzczMDM5MA==", "bodyText": "I'm wondering, do we still need all these overloads like createSharedQueue and createTemporaryQueue. Shouldn't the intent be expressed by the state of QueueConfiguration object itself? As the client of the api, I wouldn't expect that the configuration I am passing will be mutated.", "url": "https://github.com/apache/activemq-artemis/pull/3063#discussion_r403730390", "createdAt": "2020-04-05T17:12:14Z", "author": {"login": "Havret"}, "path": "artemis-core-client/src/main/java/org/apache/activemq/artemis/core/client/impl/ClientSessionImpl.java", "diffHunk": "@@ -298,6 +299,28 @@ public void createAddress(final SimpleString address, RoutingType routingType, b\n       createAddress(address, EnumSet.of(routingType), autoCreated);\n    }\n \n+   @Override\n+   public void createQueue(QueueConfiguration queueConfiguration) throws ActiveMQException {\n+      internalCreateQueue(queueConfiguration);\n+   }\n+\n+   @Override\n+   public void createSharedQueue(QueueConfiguration queueConfiguration) throws ActiveMQException {\n+      checkClosed();\n+\n+      startCall();\n+      try {\n+         sessionContext.createSharedQueue(queueConfiguration);\n+      } finally {\n+         endCall();\n+      }\n+   }\n+\n+   @Override\n+   public void createTemporaryQueue(QueueConfiguration queueConfiguration) throws ActiveMQException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bab72d61b1c5972da0c356edb2f21de1b87ad6"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MDM1NDUz", "url": "https://github.com/apache/activemq-artemis/pull/3063#pullrequestreview-388035453", "createdAt": "2020-04-06T08:31:13Z", "commit": {"oid": "40bab72d61b1c5972da0c356edb2f21de1b87ad6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwODozMToxM1rOGBNDsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwODozMTozOFrOGBNEoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNTY5Ng==", "bodyText": "I would encapsulate this logic in a separate method on a separate class to make it more readeable an d shorter ie translation from request to QueueConfiguration", "url": "https://github.com/apache/activemq-artemis/pull/3063#discussion_r403915696", "createdAt": "2020-04-06T08:31:13Z", "author": {"login": "franz1981"}, "path": "artemis-server/src/main/java/org/apache/activemq/artemis/core/protocol/core/ServerSessionPacketHandler.java", "diffHunk": "@@ -357,9 +363,29 @@ private void slowPacketHandler(final Packet packet) {\n                case CREATE_QUEUE_V2: {\n                   CreateQueueMessage_V2 request = (CreateQueueMessage_V2) packet;\n                   requiresResponse = request.isRequiresResponse();\n-                  session.createQueue(request.getAddress(), request.getQueueName(), request.getRoutingType(), request.getFilterString(), request.isTemporary(), request.isDurable(), request.getMaxConsumers(), request.isPurgeOnNoConsumers(),\n-                                      request.isExclusive(), request.isGroupRebalance(), request.getGroupBuckets(), request.getGroupFirstKey(), request.isLastValue(), request.getLastValueKey(), request.isNonDestructive(), request.getConsumersBeforeDispatch(), request.getDelayBeforeDispatch(),\n-                                      request.isAutoDelete(), request.getAutoDeleteDelay(), request.getAutoDeleteMessageCount(), request.isAutoCreated(), request.getRingSize());\n+                  session.createQueue(new QueueConfiguration(request.getQueueName())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bab72d61b1c5972da0c356edb2f21de1b87ad6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNTkzNg==", "bodyText": "I would encapsulate this logic in a separate method on a separate class to make it more readeable an d shorter ie translation from request to QueueConfiguration", "url": "https://github.com/apache/activemq-artemis/pull/3063#discussion_r403915936", "createdAt": "2020-04-06T08:31:38Z", "author": {"login": "franz1981"}, "path": "artemis-server/src/main/java/org/apache/activemq/artemis/core/protocol/core/ServerSessionPacketHandler.java", "diffHunk": "@@ -382,9 +411,25 @@ private void slowPacketHandler(final Packet packet) {\n                   requiresResponse = request.isRequiresResponse();\n                   QueueQueryResult result = session.executeQueueQuery(request.getQueueName());\n                   if (!(result.isExists() && Objects.equals(result.getAddress(), request.getAddress()) && Objects.equals(result.getFilterString(), request.getFilterString()))) {\n-                     session.createSharedQueue(request.getAddress(), request.getQueueName(), request.getRoutingType(), request.getFilterString(), request.isDurable(), request.getMaxConsumers(), request.isPurgeOnNoConsumers(),\n-                                               request.isExclusive(), request.isGroupRebalance(), request.getGroupBuckets(), request.getGroupFirstKey(), request.isLastValue(), request.getLastValueKey(), request.isNonDestructive(), request.getConsumersBeforeDispatch(), request.getDelayBeforeDispatch(),\n-                                               request.isAutoDelete(), request.getAutoDeleteDelay(), request.getAutoDeleteMessageCount());\n+                     session.createSharedQueue(new QueueConfiguration(request.getQueueName())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bab72d61b1c5972da0c356edb2f21de1b87ad6"}, "originalPosition": 74}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40bab72d61b1c5972da0c356edb2f21de1b87ad6", "author": {"user": {"login": "jbertram", "name": "Justin Bertram"}}, "url": "https://github.com/apache/activemq-artemis/commit/40bab72d61b1c5972da0c356edb2f21de1b87ad6", "committedDate": "2020-04-05T15:26:05Z", "message": "ARTEMIS-2692 refactor queue creation\n\nThis commit does the following:\n- Deprecates existing overloaded createQueue, createSharedQueue,\n  createTemporaryQueue, & updateQueue methods for ClientSession,\n  ServerSession, ActiveMQServer, & ActiveMQServerControl where\n  applicable.\n- Deprecates QueueAttributes, QueueConfig, & CoreQueueConfiguration.\n- Deprecates existing overloaded constructors for QueueImpl.\n- Implements QueueConfiguration with JavaDoc to be the single,\n  centralized configuration object for both client-side and broker-side\n  queue creation including methods to convert to & from JSON for use in\n  the management API.\n- Implements new createQueue, createSharedQueue, createTemporaryQueue &\n  updateQueue methods with JavaDoc for ClientSession, ServerSession,\n  ActiveMQServer, & ActiveMQServerControl as well as a new constructor\n  for QueueImpl all using the new QueueConfiguration object.\n- Changes all tests and internal code to use the new methods."}, "afterCommit": {"oid": "50b45d275d4c0a04c937f0f41279dfbb2b3f4a06", "author": {"user": {"login": "jbertram", "name": "Justin Bertram"}}, "url": "https://github.com/apache/activemq-artemis/commit/50b45d275d4c0a04c937f0f41279dfbb2b3f4a06", "committedDate": "2020-04-12T02:47:20Z", "message": "ARTEMIS-2692 refactor queue creation\n\nThis commit changes all tests to use the new methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2efa44daf52994790737e21ee29ae830f8f0a12c", "author": {"user": {"login": "jbertram", "name": "Justin Bertram"}}, "url": "https://github.com/apache/activemq-artemis/commit/2efa44daf52994790737e21ee29ae830f8f0a12c", "committedDate": "2020-04-13T19:25:30Z", "message": "ARTEMIS-2692 refactor queue creation\n\nThis commit does the following:\n- Deprecates existing overloaded createQueue, createSharedQueue,\n  createTemporaryQueue, & updateQueue methods for ClientSession,\n  ServerSession, ActiveMQServer, & ActiveMQServerControl where\n  applicable.\n- Deprecates QueueAttributes, QueueConfig, & CoreQueueConfiguration.\n- Deprecates existing overloaded constructors for QueueImpl.\n- Implements QueueConfiguration with JavaDoc to be the single,\n  centralized configuration object for both client-side and broker-side\n  queue creation including methods to convert to & from JSON for use in\n  the management API.\n- Implements new createQueue, createSharedQueue & updateQueue methods\n  with JavaDoc for ClientSession, ServerSession, ActiveMQServer, &\n  ActiveMQServerControl as well as a new constructor for QueueImpl all\n  using the new QueueConfiguration object.\n- Changes all internal broker code to use the new methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "701b4e47944fad231b7ee94f89f93b4b11329b90", "author": {"user": {"login": "jbertram", "name": "Justin Bertram"}}, "url": "https://github.com/apache/activemq-artemis/commit/701b4e47944fad231b7ee94f89f93b4b11329b90", "committedDate": "2020-04-13T19:25:30Z", "message": "ARTEMIS-2692 refactor queue creation\n\nThis commit changes all tests to use the new methods."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50b45d275d4c0a04c937f0f41279dfbb2b3f4a06", "author": {"user": {"login": "jbertram", "name": "Justin Bertram"}}, "url": "https://github.com/apache/activemq-artemis/commit/50b45d275d4c0a04c937f0f41279dfbb2b3f4a06", "committedDate": "2020-04-12T02:47:20Z", "message": "ARTEMIS-2692 refactor queue creation\n\nThis commit changes all tests to use the new methods."}, "afterCommit": {"oid": "701b4e47944fad231b7ee94f89f93b4b11329b90", "author": {"user": {"login": "jbertram", "name": "Justin Bertram"}}, "url": "https://github.com/apache/activemq-artemis/commit/701b4e47944fad231b7ee94f89f93b4b11329b90", "committedDate": "2020-04-13T19:25:30Z", "message": "ARTEMIS-2692 refactor queue creation\n\nThis commit changes all tests to use the new methods."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1649, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}