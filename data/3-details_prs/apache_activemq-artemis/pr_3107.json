{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNDk2NDAw", "number": 3107, "title": "ARTEMIS-2648 - audit logging improvements", "bodyText": "https://issues.apache.org/jira/browse/ARTEMIS-2648\nA description of what I have done can be found on the Jira. Id like however some feedback on something, where I have added new logging I have removed the log message that was previously in the same place so where  there was a log message for creating a queue I have added a success and failure log. If anyone thinks this is a big deal i can add back the old messages but this will mean there are multiple logs potentially occurring.", "createdAt": "2020-04-30T13:29:46Z", "url": "https://github.com/apache/activemq-artemis/pull/3107", "merged": true, "mergeCommit": {"oid": "0fe11c7562ae8fb6c1001b8b2770064194b5a708"}, "closed": true, "closedAt": "2020-05-04T14:43:02Z", "author": {"login": "andytaylor"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcctQ5qgBqjMyODk0NDk1NjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceAONkABqjMzMDAwOTc4MzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c00131debca32c043340e79174272fbbf3b35db", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/3c00131debca32c043340e79174272fbbf3b35db", "committedDate": "2020-04-30T12:50:56Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "3d40d581c08b6fb2ee8c778398327e35a9817ef6", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/3d40d581c08b6fb2ee8c778398327e35a9817ef6", "committedDate": "2020-04-30T13:39:54Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d40d581c08b6fb2ee8c778398327e35a9817ef6", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/3d40d581c08b6fb2ee8c778398327e35a9817ef6", "committedDate": "2020-04-30T13:39:54Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "a6647f2dd203aa16396b8cefeaf03c7151b9dc7b", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/a6647f2dd203aa16396b8cefeaf03c7151b9dc7b", "committedDate": "2020-05-01T10:20:54Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTUzNTUz", "url": "https://github.com/apache/activemq-artemis/pull/3107#pullrequestreview-404153553", "createdAt": "2020-05-01T13:17:32Z", "commit": {"oid": "a6647f2dd203aa16396b8cefeaf03c7151b9dc7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMzoxNzozMlrOGPJb6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMzoxNzozMlrOGPJb6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUzNjQyNw==", "bodyText": "You don't need this. you're using AMQPConnection directly, no need to change to change EventHandler.\nCan you remove it?", "url": "https://github.com/apache/activemq-artemis/pull/3107#discussion_r418536427", "createdAt": "2020-05-01T13:17:32Z", "author": {"login": "clebertsuconic"}, "path": "artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/proton/handler/EventHandler.java", "diffHunk": "@@ -91,4 +91,7 @@ default boolean flowControl(ReadyListener readyListener) {\n       return true;\n    }\n \n+   default String getRemoteAddress() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6647f2dd203aa16396b8cefeaf03c7151b9dc7b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTU3NTI4", "url": "https://github.com/apache/activemq-artemis/pull/3107#pullrequestreview-404157528", "createdAt": "2020-05-01T13:26:46Z", "commit": {"oid": "a6647f2dd203aa16396b8cefeaf03c7151b9dc7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMzoyNjo0NlrOGPJpPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMzoyNjo0NlrOGPJpPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUzOTgzOA==", "bodyText": "this won't work...\nopenWireActor.act() will transfer the execution to a different thread.\nyou will lose the ThreadLocal here.\nThe netty loop is reused for many connections.", "url": "https://github.com/apache/activemq-artemis/pull/3107#discussion_r418539838", "createdAt": "2020-05-01T13:26:46Z", "author": {"login": "clebertsuconic"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/OpenWireConnection.java", "diffHunk": "@@ -287,6 +288,9 @@ public void bufferReceived(Object connectionID, ActiveMQBuffer buffer) {\n          if (logger.isTraceEnabled()) {\n             traceBufferReceived(connectionID, command);\n          }\n+         if (AuditLogger.isAnyLoggingEnabled()) {\n+            AuditLogger.setRemoteAddress(getRemoteAddress());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6647f2dd203aa16396b8cefeaf03c7151b9dc7b"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6647f2dd203aa16396b8cefeaf03c7151b9dc7b", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/a6647f2dd203aa16396b8cefeaf03c7151b9dc7b", "committedDate": "2020-05-01T10:20:54Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "4a48fda6fdd5e334c225eb64831b9364f805465c", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/4a48fda6fdd5e334c225eb64831b9364f805465c", "committedDate": "2020-05-01T15:00:47Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MjQwNjky", "url": "https://github.com/apache/activemq-artemis/pull/3107#pullrequestreview-404240692", "createdAt": "2020-05-01T15:59:37Z", "commit": {"oid": "4a48fda6fdd5e334c225eb64831b9364f805465c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNTo1OTozN1rOGPNuRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNTo1OTozN1rOGPNuRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYwNjY2MQ==", "bodyText": "Do you need to do this for every event? It seems you only need to this only once.. so I think you could do this at the beggining of the method, before the loop starts.", "url": "https://github.com/apache/activemq-artemis/pull/3107#discussion_r418606661", "createdAt": "2020-05-01T15:59:37Z", "author": {"login": "clebertsuconic"}, "path": "artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/proton/handler/ProtonHandler.java", "diffHunk": "@@ -497,6 +498,9 @@ private void dispatch() {\n                if (log.isTraceEnabled()) {\n                   log.trace(\"Handling \" + ev + \" towards \" + h);\n                }\n+               if (AuditLogger.isAnyLoggingEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a48fda6fdd5e334c225eb64831b9364f805465c"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a48fda6fdd5e334c225eb64831b9364f805465c", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/4a48fda6fdd5e334c225eb64831b9364f805465c", "committedDate": "2020-05-01T15:00:47Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "0f2e879c0407df43b7f88581fd99b9350ef04925", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/0f2e879c0407df43b7f88581fd99b9350ef04925", "committedDate": "2020-05-02T09:51:45Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f2e879c0407df43b7f88581fd99b9350ef04925", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/0f2e879c0407df43b7f88581fd99b9350ef04925", "committedDate": "2020-05-02T09:51:45Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "ce68f2f60f65b8ca12a51f853fa99fac493feb4e", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/ce68f2f60f65b8ca12a51f853fa99fac493feb4e", "committedDate": "2020-05-04T10:26:10Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce68f2f60f65b8ca12a51f853fa99fac493feb4e", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/ce68f2f60f65b8ca12a51f853fa99fac493feb4e", "committedDate": "2020-05-04T10:26:10Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "179dab99cacff8668073c878a63d043e236a0d43", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/179dab99cacff8668073c878a63d043e236a0d43", "committedDate": "2020-05-04T14:07:06Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a04ee07de8a7c863daf37a07a1176131151caa0", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/8a04ee07de8a7c863daf37a07a1176131151caa0", "committedDate": "2020-05-04T14:19:08Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "179dab99cacff8668073c878a63d043e236a0d43", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/179dab99cacff8668073c878a63d043e236a0d43", "committedDate": "2020-05-04T14:07:06Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}, "afterCommit": {"oid": "8a04ee07de8a7c863daf37a07a1176131151caa0", "author": {"user": {"login": "andytaylor", "name": "Andy Taylor"}}, "url": "https://github.com/apache/activemq-artemis/commit/8a04ee07de8a7c863daf37a07a1176131151caa0", "committedDate": "2020-05-04T14:19:08Z", "message": "ARTEMIS-2648 - audit logging improvements\n\nhttps://issues.apache.org/jira/browse/ARTEMIS-2648"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1601, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}