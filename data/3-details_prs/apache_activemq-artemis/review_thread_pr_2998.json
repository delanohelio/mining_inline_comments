{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNDAzMzk2", "number": 2998, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo1MzoyNVrODk9TXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo1MzoyNVrODk9TXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc5NzExOnYy", "diffSide": "RIGHT", "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "isResolved": false, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo1MzoyNVrOFxkkQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTowOTowNlrOFxlDvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ==", "bodyText": "what happen if it won't succeed?", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387523649", "createdAt": "2020-03-04T08:53:25Z", "author": {"login": "franz1981"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzk5NQ==", "bodyText": "@michaelandrepearce any suggestions?", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387523995", "createdAt": "2020-03-04T08:54:06Z", "author": {"login": "franz1981"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyNTQ5MQ==", "bodyText": "what do you mean if it wont succeed? if its not null it means it already had a pullhandler set, no need to assign a new one.", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387525491", "createdAt": "2020-03-04T08:57:01Z", "author": {"login": "michaelpearce-gain"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyODAxMw==", "bodyText": "that can happen if:\n\nthere is a racing thread doing it\nthe value isn't null\n\nin both cases probably logging some trace/debug is ok if we expect it to happen?", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387528013", "createdAt": "2020-03-04T09:01:47Z", "author": {"login": "franz1981"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyODc1Mg==", "bodyText": "Anyway It's fine to me; if there are no objections I'm going to merge this ;)", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387528752", "createdAt": "2020-03-04T09:03:17Z", "author": {"login": "franz1981"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyOTAzNA==", "bodyText": "if its not null, we dont want to change it. e.g. the case there is client was already at prefetch 0 and simply sent a second update which set it to the same size, as such you want to leave the original pullhandler.", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387529034", "createdAt": "2020-03-04T09:03:51Z", "author": {"login": "michaelpearce-gain"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyOTU4Mw==", "bodyText": "if you really want a log i would add it as a trace, i dont think its needed tbh i think it just clutter the code base.", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387529583", "createdAt": "2020-03-04T09:04:56Z", "author": {"login": "michaelpearce-gain"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyOTg1NQ==", "bodyText": "no need to set messagePullHandler value if it isn't null", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387529855", "createdAt": "2020-03-04T09:05:27Z", "author": {"login": "brusdev"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUzMDIzNw==", "bodyText": "\ud83d\udc4d  thanks for the explanation bud :)", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387530237", "createdAt": "2020-03-04T09:06:15Z", "author": {"login": "franz1981"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUzMTcxMA==", "bodyText": "Anyway It's fine to me; if there are no objections I'm going to merge this ;)\n\nno objections here, please go ahead....", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387531710", "createdAt": "2020-03-04T09:09:06Z", "author": {"login": "michaelpearce-gain"}, "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, "originalCommit": {"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3963, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}