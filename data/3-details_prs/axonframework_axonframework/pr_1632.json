{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDkxMzg2", "number": 1632, "title": "Resolve Spring beans using Spring dependency resolution", "bodyText": "This fixes #1620.  The Spring bean parameter resolver now uses Spring bean resolution.  This will behave exactly as if you were injecting a bean from anywhere within Spring.\nDiscussion\nTwo tests are failing: testMethodsAreProperlyInjected_ErrorOnMissingParameterType and testMethodsAreProperlyInjected_ErrorOnDuplicateParameterType.  This is because Spring injection does handle these cases, and the code will now behave accordingly (i.e. will trigger various forms of BeansException when there are problems).  It will also correctly inject null when dependencies are missing.", "createdAt": "2020-12-09T22:01:20Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632", "merged": true, "mergeCommit": {"oid": "7223ecd53ef2352953164d1166e10ad175afad91"}, "closed": true, "closedAt": "2021-01-25T10:23:53Z", "author": {"login": "jnfeinstein"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkvVMoAFqTU0ODk2NDIxNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdx-npygFqTU3MjE0ODA2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4OTY0MjE0", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#pullrequestreview-548964214", "createdAt": "2020-12-10T08:44:39Z", "commit": {"oid": "b1cc30f3167963edeae96e4dc6411cfd39e1b577"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0NDozOVrOIC9tlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0NzowNFrOIC9zmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3OTE1OA==", "bodyText": "This is \"static\" inspection, please move to the ParameterResolverFactory.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r539979158", "createdAt": "2020-12-10T08:44:39Z", "author": {"login": "abuijze"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringBeanParameterResolverFactory.java", "diffHunk": "@@ -133,19 +85,31 @@ public void setApplicationContext(ApplicationContext applicationContext) throws\n         this.applicationContext = applicationContext;\n     }\n \n-    private static class SpringBeanParameterResolver implements ParameterResolver<Object> {\n+    private static class SpringBeanMethodParameterParameterResolver implements ParameterResolver<Object> {\n \n         private final AutowireCapableBeanFactory beanFactory;\n-        private final String beanName;\n+        private final Executable executable;\n+        private final int parameterIndex;\n \n-        public SpringBeanParameterResolver(AutowireCapableBeanFactory beanFactory, String beanName) {\n+        public SpringBeanMethodParameterParameterResolver(AutowireCapableBeanFactory beanFactory, Executable executable, int parameterIndex) {\n             this.beanFactory = beanFactory;\n-            this.beanName = beanName;\n+            this.executable = executable;\n+            this.parameterIndex = parameterIndex;\n         }\n \n         @Override\n         public Object resolveParameterValue(Message<?> message) {\n-            return beanFactory.getBean(beanName);\n+            final Autowired ann = executable.getAnnotation(Autowired.class);\n+            final boolean required = ann == null || ann.required(); // Defaults to true\n+            final MethodParameter methodParameter;\n+\n+            if (executable instanceof Method) {\n+                methodParameter = new MethodParameter((Method) executable, parameterIndex);\n+            } else {\n+                methodParameter = new MethodParameter((Constructor<?>) executable, parameterIndex);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1cc30f3167963edeae96e4dc6411cfd39e1b577"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MDAzNQ==", "bodyText": "This should resolve to the exact same instance on each invocation. I wonder if it wouldn't be best to \"cache\" the result in an AtomicReference. This prevents the dependency resolution to be invoked on each handler invocation.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r539980035", "createdAt": "2020-12-10T08:45:57Z", "author": {"login": "abuijze"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringBeanParameterResolverFactory.java", "diffHunk": "@@ -133,19 +85,31 @@ public void setApplicationContext(ApplicationContext applicationContext) throws\n         this.applicationContext = applicationContext;\n     }\n \n-    private static class SpringBeanParameterResolver implements ParameterResolver<Object> {\n+    private static class SpringBeanMethodParameterParameterResolver implements ParameterResolver<Object> {\n \n         private final AutowireCapableBeanFactory beanFactory;\n-        private final String beanName;\n+        private final Executable executable;\n+        private final int parameterIndex;\n \n-        public SpringBeanParameterResolver(AutowireCapableBeanFactory beanFactory, String beanName) {\n+        public SpringBeanMethodParameterParameterResolver(AutowireCapableBeanFactory beanFactory, Executable executable, int parameterIndex) {\n             this.beanFactory = beanFactory;\n-            this.beanName = beanName;\n+            this.executable = executable;\n+            this.parameterIndex = parameterIndex;\n         }\n \n         @Override\n         public Object resolveParameterValue(Message<?> message) {\n-            return beanFactory.getBean(beanName);\n+            final Autowired ann = executable.getAnnotation(Autowired.class);\n+            final boolean required = ann == null || ann.required(); // Defaults to true\n+            final MethodParameter methodParameter;\n+\n+            if (executable instanceof Method) {\n+                methodParameter = new MethodParameter((Method) executable, parameterIndex);\n+            } else {\n+                methodParameter = new MethodParameter((Constructor<?>) executable, parameterIndex);\n+            }\n+\n+            return beanFactory.resolveDependency(new DependencyDescriptor(methodParameter, required), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1cc30f3167963edeae96e4dc6411cfd39e1b577"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MDY5Nw==", "bodyText": "Would be really nice to also add a dependency that has more than one candidate and uses Spring's @Qualifier to resolve one. This \"proves\" that Spring's dependency injection mechanism is used.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r539980697", "createdAt": "2020-12-10T08:47:04Z", "author": {"login": "abuijze"}, "path": "spring/src/test/java/org/axonframework/spring/config/annotation/SpringBeanParameterResolverFactoryTest.java", "diffHunk": "@@ -314,10 +314,11 @@ public void handle(String message, PrototypeResource resource) {\n     public static class AnnotatedEventHandlerWithResources {\n \n         @EventHandler\n-        public void handle(String message, CommandBus commandBus, EventBus eventBus) {\n+        public void handle(String message, CommandBus commandBus, EventBus eventBus, ApplicationContext applicationContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1cc30f3167963edeae96e4dc6411cfd39e1b577"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDI5MDI5", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#pullrequestreview-549029029", "createdAt": "2020-12-10T10:00:49Z", "commit": {"oid": "b1cc30f3167963edeae96e4dc6411cfd39e1b577"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1cc30f3167963edeae96e4dc6411cfd39e1b577", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/b1cc30f3167963edeae96e4dc6411cfd39e1b577", "committedDate": "2020-12-09T21:59:23Z", "message": "Resolve Spring beans using Spring dependency resolution"}, "afterCommit": {"oid": "f84dc5c381a2b1069656a783e6558518e6225002", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/f84dc5c381a2b1069656a783e6558518e6225002", "committedDate": "2020-12-10T12:19:29Z", "message": "Resolve Spring beans using Spring dependency resolution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f84dc5c381a2b1069656a783e6558518e6225002", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/f84dc5c381a2b1069656a783e6558518e6225002", "committedDate": "2020-12-10T12:19:29Z", "message": "Resolve Spring beans using Spring dependency resolution"}, "afterCommit": {"oid": "1d4147536bbce6bb7405a0271f10a901b1829daf", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/1d4147536bbce6bb7405a0271f10a901b1829daf", "committedDate": "2020-12-10T12:32:10Z", "message": "Resolve Spring beans using Spring dependency resolution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d4147536bbce6bb7405a0271f10a901b1829daf", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/1d4147536bbce6bb7405a0271f10a901b1829daf", "committedDate": "2020-12-10T12:32:10Z", "message": "Resolve Spring beans using Spring dependency resolution"}, "afterCommit": {"oid": "d1d55b68144e778d212aa53142a828469873e488", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/d1d55b68144e778d212aa53142a828469873e488", "committedDate": "2020-12-10T12:34:11Z", "message": "Resolve Spring beans using Spring dependency resolution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDA0NjAy", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#pullrequestreview-551404602", "createdAt": "2020-12-14T14:13:53Z", "commit": {"oid": "d1d55b68144e778d212aa53142a828469873e488"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1d55b68144e778d212aa53142a828469873e488", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/d1d55b68144e778d212aa53142a828469873e488", "committedDate": "2020-12-10T12:34:11Z", "message": "Resolve Spring beans using Spring dependency resolution"}, "afterCommit": {"oid": "ffb15f04dff0cdc89d22ff44fb336b981fb44059", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/ffb15f04dff0cdc89d22ff44fb336b981fb44059", "committedDate": "2020-12-16T13:29:18Z", "message": "Resolve Spring beans using Spring dependency resolution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffb15f04dff0cdc89d22ff44fb336b981fb44059", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/ffb15f04dff0cdc89d22ff44fb336b981fb44059", "committedDate": "2020-12-16T13:29:18Z", "message": "Resolve Spring beans using Spring dependency resolution"}, "afterCommit": {"oid": "13bf5865bd18662cea30325f0b8991e76f9136fc", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/13bf5865bd18662cea30325f0b8991e76f9136fc", "committedDate": "2021-01-18T15:39:53Z", "message": "Add paramter resolver using core Spring dependency resolution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13bf5865bd18662cea30325f0b8991e76f9136fc", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/13bf5865bd18662cea30325f0b8991e76f9136fc", "committedDate": "2021-01-18T15:39:53Z", "message": "Add paramter resolver using core Spring dependency resolution"}, "afterCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/5ec800309e2b2fdb525d5ae9982df3885696b42e", "committedDate": "2021-01-18T15:44:37Z", "message": "Add paramter resolver using core Spring dependency resolution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxNDAwMTE2", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#pullrequestreview-571400116", "createdAt": "2021-01-19T16:06:29Z", "commit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNjowNjozMFrOIWVjAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNjo0Njo1MVrOIWXd3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI5MjYxMQ==", "bodyText": "The priority of this guy should be higher than the soon-to-be-deprecated SpringBeanParameterResolverFactory.\nOtherwise, they'd be competing, whilst in essence, we want this to win and replace the old variant eventually.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560292611", "createdAt": "2021-01-19T16:06:30Z", "author": {"login": "smcvb"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringBeanDependencyResolverFactory.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2010-2020. Axon Framework\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.axonframework.spring.config.annotation;\n+\n+import org.axonframework.common.Priority;\n+import org.axonframework.eventhandling.AnnotationEventHandlerAdapter;\n+import org.axonframework.messaging.Message;\n+import org.axonframework.messaging.annotation.ParameterResolver;\n+import org.axonframework.messaging.annotation.ParameterResolverFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeansException;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.config.AutowireCapableBeanFactory;\n+import org.springframework.beans.factory.config.DependencyDescriptor;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.context.ApplicationContextAware;\n+import org.springframework.core.MethodParameter;\n+import org.springframework.lang.NonNull;\n+\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.Executable;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Parameter;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import static org.axonframework.eventhandling.GenericEventMessage.asEventMessage;\n+\n+/**\n+ * ParameterResolverFactory implementation that resolves parameters using Spring dependency resolution.\n+ * Mark a parameter as {@link org.springframework.beans.factory.annotation.Autowired} to resolve said parameter\n+ * using Spring dependency resolution.\n+ *\n+ * @author Joel Feinstein\n+ * @since 4.5\n+ * @see Autowired\n+ */\n+@Priority(Priority.LOW)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI5MzA4MQ==", "bodyText": "It's nitty and lame, but I do feel the constructor should have a short piece of Javadoc. Even though it's gonna be along the lines of \"this constructs a SpringBeanDependencyResolverFactory`\".", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560293081", "createdAt": "2021-01-19T16:07:05Z", "author": {"login": "smcvb"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringBeanDependencyResolverFactory.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2010-2020. Axon Framework\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.axonframework.spring.config.annotation;\n+\n+import org.axonframework.common.Priority;\n+import org.axonframework.eventhandling.AnnotationEventHandlerAdapter;\n+import org.axonframework.messaging.Message;\n+import org.axonframework.messaging.annotation.ParameterResolver;\n+import org.axonframework.messaging.annotation.ParameterResolverFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeansException;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.config.AutowireCapableBeanFactory;\n+import org.springframework.beans.factory.config.DependencyDescriptor;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.context.ApplicationContextAware;\n+import org.springframework.core.MethodParameter;\n+import org.springframework.lang.NonNull;\n+\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.Executable;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Parameter;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import static org.axonframework.eventhandling.GenericEventMessage.asEventMessage;\n+\n+/**\n+ * ParameterResolverFactory implementation that resolves parameters using Spring dependency resolution.\n+ * Mark a parameter as {@link org.springframework.beans.factory.annotation.Autowired} to resolve said parameter\n+ * using Spring dependency resolution.\n+ *\n+ * @author Joel Feinstein\n+ * @since 4.5\n+ * @see Autowired\n+ */\n+@Priority(Priority.LOW)\n+public class SpringBeanDependencyResolverFactory implements ParameterResolverFactory {\n+\n+    private final ApplicationContext applicationContext;\n+\n+    public SpringBeanDependencyResolverFactory(@NonNull ApplicationContext applicationContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDMwMDM1Mg==", "bodyText": "So, this change did me frown a little, since a HandlerDefinition has nothing to do with parameter resolution.\nChecked the git history, but this piece of Javadoc was wrongly copied over from the SpringParameterResolverFactoryBean#setAdditionalFactories(List<ParameterResolverFactory>) back in the day...\nNo need to change this in your PR by the way, but adding this line is also unnessary.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560300352", "createdAt": "2021-01-19T16:16:12Z", "author": {"login": "smcvb"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringHandlerDefinitionBean.java", "diffHunk": "@@ -89,6 +89,7 @@ public void afterPropertiesSet() {\n      *\n      * @param additionalFactories The extra definitions to register\n      * @see SpringBeanParameterResolverFactory\n+     * @see SpringBeanDependencyResolverFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDMwMTAwMQ==", "bodyText": "Similar as with the SpringHandlerDefinitionBean, the SpringHandlerEnhancerDefinitionBean is about HandlerEnhancerDefinitions, not about ParameterResolverFactory instances.\nAgain, wrongly copied over back in the day, making this added line unnecessary too.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560301001", "createdAt": "2021-01-19T16:17:04Z", "author": {"login": "smcvb"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringHandlerEnhancerDefinitionBean.java", "diffHunk": "@@ -99,6 +99,7 @@ public void setApplicationContext(ApplicationContext applicationContext) throws\n      *\n      * @param additionalFactories The extra definitions to register\n      * @see SpringBeanParameterResolverFactory\n+     * @see SpringBeanDependencyResolverFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDMyMDQxMg==", "bodyText": "Although this works, we aim to allow meta-annotations too.\nIf my mind serves me right, Parameter#getAnnotation(Class<T>) will only return if the given annotation is actually present.\nSlightly debatable if it makes sense for Spring @Autowired annotation, as the behaviour is mainly aimed so that users are not required to uses Axon's @CommandHandler annotation directly for example.\nStill, I feel there's a benefit to allowing this.\nLuckily, Axon Framework has an AnnotationUtils class for this, which does check for meta-annotations as well.\nBy using AnnotationUtils#isAnnotationPresent(AnnotatedElement, Class<? extends Annotation>) you will receive a boolean if the Autowired annotation is present on the parameter, or on an annotation on the parameter.\nYou can see the AbstractAnnotatedParameterResolverFactory to get a feel how the framework uses this for parameter resolvers.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560320412", "createdAt": "2021-01-19T16:41:58Z", "author": {"login": "smcvb"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringBeanDependencyResolverFactory.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2010-2020. Axon Framework\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.axonframework.spring.config.annotation;\n+\n+import org.axonframework.common.Priority;\n+import org.axonframework.eventhandling.AnnotationEventHandlerAdapter;\n+import org.axonframework.messaging.Message;\n+import org.axonframework.messaging.annotation.ParameterResolver;\n+import org.axonframework.messaging.annotation.ParameterResolverFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeansException;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.config.AutowireCapableBeanFactory;\n+import org.springframework.beans.factory.config.DependencyDescriptor;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.context.ApplicationContextAware;\n+import org.springframework.core.MethodParameter;\n+import org.springframework.lang.NonNull;\n+\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.Executable;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Parameter;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import static org.axonframework.eventhandling.GenericEventMessage.asEventMessage;\n+\n+/**\n+ * ParameterResolverFactory implementation that resolves parameters using Spring dependency resolution.\n+ * Mark a parameter as {@link org.springframework.beans.factory.annotation.Autowired} to resolve said parameter\n+ * using Spring dependency resolution.\n+ *\n+ * @author Joel Feinstein\n+ * @since 4.5\n+ * @see Autowired\n+ */\n+@Priority(Priority.LOW)\n+public class SpringBeanDependencyResolverFactory implements ParameterResolverFactory {\n+\n+    private final ApplicationContext applicationContext;\n+\n+    public SpringBeanDependencyResolverFactory(@NonNull ApplicationContext applicationContext) {\n+        this.applicationContext = applicationContext;\n+    }\n+\n+    @Override\n+    public ParameterResolver<?> createInstance(Executable executable, Parameter[] parameters, int parameterIndex) {\n+        final Autowired ann = parameters[parameterIndex].getAnnotation(Autowired.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDMyMDkxNg==", "bodyText": "Just to get my head straight, but this approach also allows the @Qualifier annotation on the parameters, since Spring's DependencyDescriptor simply includes that logic, correct?\nIf so, it would be nice to see a test case for that combination in the SpringBeanParameterResolverFactoryTest class.\nNext to calling this out in the JavaDoc :-)", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560320916", "createdAt": "2021-01-19T16:42:37Z", "author": {"login": "smcvb"}, "path": "spring/src/main/java/org/axonframework/spring/config/annotation/SpringBeanDependencyResolverFactory.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2010-2020. Axon Framework\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.axonframework.spring.config.annotation;\n+\n+import org.axonframework.common.Priority;\n+import org.axonframework.eventhandling.AnnotationEventHandlerAdapter;\n+import org.axonframework.messaging.Message;\n+import org.axonframework.messaging.annotation.ParameterResolver;\n+import org.axonframework.messaging.annotation.ParameterResolverFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeansException;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.config.AutowireCapableBeanFactory;\n+import org.springframework.beans.factory.config.DependencyDescriptor;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.context.ApplicationContextAware;\n+import org.springframework.core.MethodParameter;\n+import org.springframework.lang.NonNull;\n+\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.Executable;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Parameter;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+import static org.axonframework.eventhandling.GenericEventMessage.asEventMessage;\n+\n+/**\n+ * ParameterResolverFactory implementation that resolves parameters using Spring dependency resolution.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDMyNDA2Mg==", "bodyText": "It would be good to note in the class level JavaDoc of this test class, that both the SpringBeanParameterResolverFactory as well as the SpringBeanDependencyResolverFactory are tested through this class.\nMaybe even change the class name to be a bit clearer there too.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#discussion_r560324062", "createdAt": "2021-01-19T16:46:51Z", "author": {"login": "smcvb"}, "path": "spring/src/test/java/org/axonframework/spring/config/annotation/SpringBeanParameterResolverFactoryTest.java", "diffHunk": "@@ -27,6 +27,7 @@\n import org.axonframework.spring.config.AnnotationDriven;\n import org.junit.jupiter.api.*;\n import org.junit.jupiter.api.extension.ExtendWith;\n+import org.springframework.beans.factory.NoUniqueBeanDefinitionException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ec800309e2b2fdb525d5ae9982df3885696b42e", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/5ec800309e2b2fdb525d5ae9982df3885696b42e", "committedDate": "2021-01-18T15:44:37Z", "message": "Add paramter resolver using core Spring dependency resolution"}, "afterCommit": {"oid": "7beabb231370ebcb1a9a5a482d20e7418f8ae08b", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/7beabb231370ebcb1a9a5a482d20e7418f8ae08b", "committedDate": "2021-01-19T18:09:43Z", "message": "Add paramter resolver using core Spring dependency resolution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "299285f87c58986c5dd97277fe5518171a9c307a", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/299285f87c58986c5dd97277fe5518171a9c307a", "committedDate": "2021-01-19T18:17:18Z", "message": "Add paramter resolver using core Spring dependency resolution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7beabb231370ebcb1a9a5a482d20e7418f8ae08b", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/7beabb231370ebcb1a9a5a482d20e7418f8ae08b", "committedDate": "2021-01-19T18:09:43Z", "message": "Add paramter resolver using core Spring dependency resolution"}, "afterCommit": {"oid": "299285f87c58986c5dd97277fe5518171a9c307a", "author": {"user": {"login": "jnfeinstein", "name": "Joel Feinstein"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/299285f87c58986c5dd97277fe5518171a9c307a", "committedDate": "2021-01-19T18:17:18Z", "message": "Add paramter resolver using core Spring dependency resolution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyMTQ4MDYw", "url": "https://github.com/AxonFramework/AxonFramework/pull/1632#pullrequestreview-572148060", "createdAt": "2021-01-20T11:56:57Z", "commit": {"oid": "299285f87c58986c5dd97277fe5518171a9c307a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2043, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}