{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjYyMTA5", "number": 1435, "title": "[#1390] Allow for custom parameters to be provided when triggering a reset", "bodyText": "This pull request introduces the capability to provide resetInfo upon performing a TrackingEventProcessor#resetTokens operation. This object will be passed along towards the EventHandlerInvoker and than the EventMessageHandler. In the latter it will be added to a dedicated ResetMessage to finally be passed along a @ResetHandler annotated method.\nQuestions for reviewers:\n\nI am not overly happy with the parameter name resetInfo. If you have any suggestions, please share\nI have a very slight concern that adjusting the @ResetHandler by removing the @EventHandler meta-annotation might be problematic for users who've meta-annotated their own annotations with @ResetHandler. Any thoughts on this?\nCurrent users of the @ResetHandler annotation might have methods which take in parameter resolved resources. With this change however, a reset handler like this:\n\n@ResetHandler\npublic void reset(SomeResolvedResource resource) {\n    // Impl. details\n}\nwill no longer be called. This is due to the introduction of a dedicated ResetMessage, through the parameter resolver logic now expect the first field to always be the message's payload. Couldn't find a solution I was pleased with to resolve this. Again, suggestions are welcome.\nThis pull request resolves #1390", "createdAt": "2020-05-15T15:38:32Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435", "merged": true, "mergeCommit": {"oid": "4203930817a1949193351f64c37a5fa9abf3703b"}, "closed": true, "closedAt": "2020-06-24T10:48:52Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchjtlXgH2gAyNDE4NjYyMTA5OmQ2OWRmODFlZDUwNTNhNzNlN2NiZTc2N2NjMzFmODAzNDU1MjVjMmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuWSoyAH2gAyNDE4NjYyMTA5OjZiM2M1MjYwMWViMzkzYmM3ZTJjYzRhZTE4NWY3Y2U2ZGY2MTJhNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d69df81ed5053a73e7cbe767cc31f80345525c2c", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/d69df81ed5053a73e7cbe767cc31f80345525c2c", "committedDate": "2020-05-15T15:22:03Z", "message": "Introduce ResetMessage\n\nIntroduce a ResetMessage plus implementation to support resetting with\nan optional payload field\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50353a1393163f39ba44b5e4e178c9f972b36ab7", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/50353a1393163f39ba44b5e4e178c9f972b36ab7", "committedDate": "2020-05-15T15:23:27Z", "message": "Add prepare reset with reset info\n\nAdd a prepareReset(R resetInfo) method to open up the provisioning of\nreset-supporting information\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b0fbf706a37bdf8f23fa037a7d9232b9cec9d9", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/f6b0fbf706a37bdf8f23fa037a7d9232b9cec9d9", "committedDate": "2020-05-15T15:25:02Z", "message": "Add prepare reset with reset info\n\nAdd a prepareReset(R resetInfo) method to open up the provisioning of\nreset-supporting information\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b8a1862f711e2093751fc81a37c16599789dac2", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/7b8a1862f711e2093751fc81a37c16599789dac2", "committedDate": "2020-05-15T15:26:42Z", "message": "Change ResetHandler annotation\n\nChange the ResetHandler annotation to  specifically cope with message of\n type ResetMessage instead of EventMessages containing the\n ResetTriggeredEvent\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3195d1e9ed78ad4e17ef65f3c798ab2db14b8b1a", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/3195d1e9ed78ad4e17ef65f3c798ab2db14b8b1a", "committedDate": "2020-05-15T15:27:57Z", "message": "Add resetTokens methods allowing reset-info\n\nCreate additional resetTokens methods which take a resetInfo parameter.\nThe resetInfo parameter should be provided to the EventHandlerInvoker\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3083e1b407050c2b84e48a09e7e06603e17265d", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/c3083e1b407050c2b84e48a09e7e06603e17265d", "committedDate": "2020-05-15T15:29:07Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDA5ODUz", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#pullrequestreview-413409853", "createdAt": "2020-05-18T09:12:02Z", "commit": {"oid": "c3083e1b407050c2b84e48a09e7e06603e17265d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwOToxMjowMlrOGWuUoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwOToxMjowMlrOGWuUoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ4MDgwMQ==", "bodyText": "resetResourse instead resetInfo?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#discussion_r426480801", "createdAt": "2020-05-18T09:12:02Z", "author": {"login": "stefanvozd"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventHandlerInvoker.java", "diffHunk": "@@ -70,5 +73,15 @@ default boolean supportsReset() {\n      * Performs any activities that are required to reset the state managed by handlers assigned to this invoker.\n      */\n     default void performReset() {\n+        performReset(NO_RESET_PAYLOAD);\n+    }\n+\n+    /**\n+     * Performs any activities that are required to reset the state managed by handlers assigned to this invoker.\n+     *\n+     * @param resetInfo a {@code R} used to support the reset operation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3083e1b407050c2b84e48a09e7e06603e17265d"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91f9fd47661f10bbdf50db2d815a2d35d1c0ad9f", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/91f9fd47661f10bbdf50db2d815a2d35d1c0ad9f", "committedDate": "2020-06-11T10:31:57Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4129adc8600d48e81eee7e89c7ac554e87f130e4", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/4129adc8600d48e81eee7e89c7ac554e87f130e4", "committedDate": "2020-06-11T12:34:08Z", "message": "Remove interface constant\n\nRemove interface constant for cleaner API\n\n#1390"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMjMwNDI3", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#pullrequestreview-431230427", "createdAt": "2020-06-16T07:29:15Z", "commit": {"oid": "4129adc8600d48e81eee7e89c7ac554e87f130e4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNzoyOToxNVrOGkOpHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNzozNTowN1rOGkO1tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY0MTgyMw==", "bodyText": "It would be beneficial to check whether messageOrPayload is an instance of Message as well.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#discussion_r440641823", "createdAt": "2020-06-16T07:29:15Z", "author": {"login": "m1l4n54v1c"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/replay/GenericResetMessage.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright (c) 2010-2020. Axon Framework\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.axonframework.eventhandling.replay;\n+\n+import org.axonframework.messaging.GenericMessage;\n+import org.axonframework.messaging.Message;\n+import org.axonframework.messaging.MessageDecorator;\n+import org.axonframework.messaging.MetaData;\n+\n+import java.util.Map;\n+\n+/**\n+ * Generic implementation of the {@link ResetMessage}.\n+ *\n+ * @param <T> the type of payload contained in the message\n+ * @author Steven van Beelen\n+ * @since 4.4\n+ */\n+public class GenericResetMessage<T> extends MessageDecorator<T> implements ResetMessage<T> {\n+\n+    private static final long serialVersionUID = -6872386525166762225L;\n+\n+    /**\n+     * Returns the given {@code messageOrPayload} as a {@link ResetMessage}. If {@code messageOrPayload} already\n+     * implements {@code ResetMessage}, it is returned as-is. Otherwise, the given {@code messageOrPayload} is wrapped\n+     * into a {@link GenericResetMessage} as its payload.\n+     *\n+     * @param messageOrPayload the payload to wrap as {@link ResetMessage}\n+     * @param <T>              the type of payload contained in the message\n+     * @return a {@link ResetMessage} containing given {@code messageOrPayload} as payload, or the {@code\n+     * messageOrPayload} if it already implements {@code ResetMessage}.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    public static <T> ResetMessage<T> asResetMessage(Object messageOrPayload) {\n+        return messageOrPayload instanceof ResetMessage", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4129adc8600d48e81eee7e89c7ac554e87f130e4"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY0NTA0NQ==", "bodyText": "Did you consider extending EventMessage? This approach could resolve a backwards compatibility issue with @ResetHandler annotation.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#discussion_r440645045", "createdAt": "2020-06-16T07:35:07Z", "author": {"login": "m1l4n54v1c"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/replay/ResetMessage.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright (c) 2010-2020. Axon Framework\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.axonframework.eventhandling.replay;\n+\n+import org.axonframework.messaging.Message;\n+\n+import java.util.Map;\n+\n+/**\n+ * Represents a Message initiating the reset of an Event Handling Component. A payload of {@code T} can be provided to\n+ * support the reset operation handling this message.\n+ *\n+ * @param <T> the type of payload contained in the message\n+ * @author Steven van Beelen\n+ * @since 4.4\n+ */\n+public interface ResetMessage<T> extends Message<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4129adc8600d48e81eee7e89c7ac554e87f130e4"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMjUwMzg4", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#pullrequestreview-431250388", "createdAt": "2020-06-16T07:56:26Z", "commit": {"oid": "4129adc8600d48e81eee7e89c7ac554e87f130e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNzo1NjoyNlrOGkPmUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNzo1NjoyNlrOGkPmUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY1NzQ4OQ==", "bodyText": "Hmmmm... Even if Saga @Allows replaying?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1435#discussion_r440657489", "createdAt": "2020-06-16T07:56:26Z", "author": {"login": "m1l4n54v1c"}, "path": "modelling/src/main/java/org/axonframework/modelling/saga/AbstractSagaManager.java", "diffHunk": "@@ -191,7 +191,7 @@ public boolean supportsReset() {\n     }\n \n     @Override\n-    public void performReset() {\n+    public void performReset(Object resetInfo) {\n         throw new ResetNotSupportedException(\"Sagas do no support resetting tokens\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4129adc8600d48e81eee7e89c7ac554e87f130e4"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0a97bf814900eea7c6501e07a7adb6e7d8eaedb", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/b0a97bf814900eea7c6501e07a7adb6e7d8eaedb", "committedDate": "2020-06-16T08:14:32Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5c08f09f4ab61c8e03ce8cef83dd5d2edb7eeac", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/e5c08f09f4ab61c8e03ce8cef83dd5d2edb7eeac", "committedDate": "2020-06-19T09:37:50Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90f06e16c9a536df320a843a48e9df01d02cc30a", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/90f06e16c9a536df320a843a48e9df01d02cc30a", "committedDate": "2020-06-19T09:46:23Z", "message": "Rename resetInfo to resetContext\n\nRename resetInfo parameter to resetContext\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec695f5cd573ea4961460a5e07263af770c280c6", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/ec695f5cd573ea4961460a5e07263af770c280c6", "committedDate": "2020-06-22T13:16:07Z", "message": "Process review comments\n\n- Let (Generic)ResetMessage implement (Generic)EventMessage\n- Due to inheritance, a dedicated ResetHandlingMember should be provided\n with a higher priority than events\n- Make asResetMessage validate for Message objects too\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c31644c0b8b2524174da76c130bbf6e72ae656dc", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/c31644c0b8b2524174da76c130bbf6e72ae656dc", "committedDate": "2020-06-22T15:16:10Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f16ac4c5d66662bb10e3fed2b31c24d32d8bc7e", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/1f16ac4c5d66662bb10e3fed2b31c24d32d8bc7e", "committedDate": "2020-06-23T10:13:48Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb673e74579e867b00806b04e23d6df5d69ed8c1", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/bb673e74579e867b00806b04e23d6df5d69ed8c1", "committedDate": "2020-06-23T11:30:43Z", "message": "Adjust default implementation of perform/prepareReset\n\nThe original performReset()/prepareReset() should no default to the new\nimplementation, as users might have implemented these methods themselves\nInstead, the new method should call the old impl., if the reset context\nis null. Otherwise, throw an UnsupportedOperationException.\nAdditionally, keep the old overrides, which call the new method, thus\nensuring users which use these interfaces directly still have the same\nfunctionality too.\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "453dec397d12247d145f2d7323dc518c9cc20576", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/453dec397d12247d145f2d7323dc518c9cc20576", "committedDate": "2020-06-23T11:31:07Z", "message": "Drop ResetTriggeredEvent\n\nDrop ResetTriggeredEvent, as it's no longer used and wouldn't be used by\n users.\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d298b7b73500588197ae07b65d129a2b44880ac", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/5d298b7b73500588197ae07b65d129a2b44880ac", "committedDate": "2020-06-23T11:34:01Z", "message": "Rename ResetMessage to ResetContext and let it implement Message again\n\nResetContext better carries the load of what the dedicated reset Message\n is for, hence it should be renamed. Additionally, letting it implement\n event mean introduces a form of premature optimization, as it requires\n a dedicated ResetHandlingMember where the priority method is overridden\nAdditionally, a timestamp on a ResetMessage doesn't say much, as the\nreset's time is always when it occurs\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46bbedd1a7457d73ddc323d6b025dc70a661f2dd", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/46bbedd1a7457d73ddc323d6b025dc70a661f2dd", "committedDate": "2020-06-23T11:53:46Z", "message": "Fix minor missed issues\n\n- Reindent some files\n- Add last new line for some tests\n- Remove double copyright notice on org.axonframework.messaging\n.annotation.HandlerEnhancerDefinition\n- Add missed override in Saga\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da099b92ab9bad038f497160f7e20efe270dd0d", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/6da099b92ab9bad038f497160f7e20efe270dd0d", "committedDate": "2020-06-23T11:54:22Z", "message": "Remove double copyright notice\n\nRemove double copyright notice\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c303b482e79ac30f095c219f464014fbf5bfe68", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/8c303b482e79ac30f095c219f464014fbf5bfe68", "committedDate": "2020-06-23T13:06:27Z", "message": "Add more tests\n\nAdd additional test cases to ensure everything's covered\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebd899e1ffff5d0cb31d68104078f947547adcaa", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/ebd899e1ffff5d0cb31d68104078f947547adcaa", "committedDate": "2020-06-24T09:04:25Z", "message": "Fix some warnings\n\n- Add new lines\n- Add missing class level javadoc\n\n#1390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b3c52601eb393bc7e2cc4ae185f7ce6df612a58", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/6b3c52601eb393bc7e2cc4ae185f7ce6df612a58", "committedDate": "2020-06-24T09:04:52Z", "message": "Merge remote-tracking branch 'origin/master' into feature/1390"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1749, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}