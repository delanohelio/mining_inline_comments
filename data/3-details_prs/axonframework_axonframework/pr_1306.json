{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4OTg4MTU0", "number": 1306, "title": "[#680]  Expect Scheduled Deadline based on Deadline name", "bodyText": "This pull request introduces two methods to both the AggregateTestFixture and SagaTestFixture validation phase:\n\nexpectScheduledDeadlineWithName(Duration duration, String deadlineName)\nexpectScheduledDeadlineWithName(Instant scheduledTime, String deadlineName)\n\nThis methods are beneficial to include, as users are able to schedule deadlines without any form of payload, but with a deadline name. In those scenarios, one would still want to verify through test cases if such a deadline was scheduled.\nAlongside this addition, I've resolved warnings I encountered in the touched files.\nThis pull request resolves #680", "createdAt": "2020-01-03T13:27:27Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306", "merged": true, "mergeCommit": {"oid": "4b5b49ce0c43ff0e825dfa685c15a0efe354ba0c"}, "closed": true, "closedAt": "2020-01-09T10:51:34Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2uCEeAH2gAyMzU4OTg4MTU0OjQ0M2VmMjI1YjdlMThlZTU1MmMxNTFhZjIyMjA3MzYyYjc0MmE3ZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3s8nsAH2gAyMzU4OTg4MTU0OmQ3MWMxNWQzY2Y0ODZhYzQ1Y2M5YWE3Y2JlMzc0ZTVmZGU0ZjhmOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "443ef225b7e18ee552c151af22207362b742a7fa", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/443ef225b7e18ee552c151af22207362b742a7fa", "committedDate": "2020-01-03T13:04:44Z", "message": "Implement expectScheduledDeadlineWithName\n\nFor aggregate test fixtures it is beneficial to be able to test whether\na deadline for a given name has been scheduled. This is necessary in the\n scenario no payload has been used when scheduling\n\n#680"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bd69b086fd29a1bfe7b6918fbf49d296db35839", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/3bd69b086fd29a1bfe7b6918fbf49d296db35839", "committedDate": "2020-01-03T13:05:10Z", "message": "Resolve warnings\n\nResolve the warnings the IDE gives tells us about\n\n#680"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11ac23b445a17322b73ec6194419a254d3e02eb0", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/11ac23b445a17322b73ec6194419a254d3e02eb0", "committedDate": "2020-01-03T13:07:05Z", "message": "Implement tests for the expectScheduledDeadlineWithName\n\nAdd a test case to validate the correct workings of the\nexpectScheduledDeadlineWithName method. Additionally, clean up the test\nclass slightly, by adding constants, removing warnings and adding\njavadoc\n\n#680"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24da071cd6ff7b6c9b828d58cf33c811b3dc594a", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/24da071cd6ff7b6c9b828d58cf33c811b3dc594a", "committedDate": "2020-01-03T13:20:36Z", "message": "Implement expectScheduledDeadlineWithName\n\nFor saga test fixtures it is beneficial to be able to test whether\na deadline for a given name has been scheduled. This is necessary in the\nscenario no payload has been used when scheduling\n\n#680"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b3217a985e607ebaba4e895f9478af95a6405a", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/87b3217a985e607ebaba4e895f9478af95a6405a", "committedDate": "2020-01-03T13:21:10Z", "message": "Implement tests for the expectScheduledDeadlineWithName\n\nAdd a test case to validate the correct workings of the\nexpectScheduledDeadlineWithName method. Additionally, clean up the test\nclass slightly, by adding constants, removing warnings and adding\njavadoc\n\n#680"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac", "committedDate": "2020-01-03T15:07:36Z", "message": "Merge branch 'feature/1050' into feature/680"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NTY0NDQ5", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306#pullrequestreview-338564449", "createdAt": "2020-01-06T10:17:55Z", "commit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDoxNzo1NVrOFaaA5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDozMjo0MVrOFaaWeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzMzUxMA==", "bodyText": "Should be @code scheduledTime\nAlso the wording for it might change a bit since this is the expected time for the deadline and not the duration anymore.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306#discussion_r363233510", "createdAt": "2020-01-06T10:17:55Z", "author": {"login": "lfgcampos"}, "path": "test/src/main/java/org/axonframework/test/aggregate/ResultValidator.java", "diffHunk": "@@ -249,6 +256,15 @@\n      */\n     ResultValidator<T> expectScheduledDeadlineOfType(Instant scheduledTime, Class<?> deadlineType);\n \n+    /**\n+     * Asserts that a deadline with the given {@code deadlineName} has been scheduled after the given {@code duration}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzNDM0NA==", "bodyText": "Should be @code scheduledTime\nAlso the wording for it might change a bit since this is the expected time for the deadline and not the duration anymore.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306#discussion_r363234344", "createdAt": "2020-01-06T10:20:04Z", "author": {"login": "lfgcampos"}, "path": "test/src/main/java/org/axonframework/test/saga/FixtureExecutionResult.java", "diffHunk": "@@ -209,6 +218,15 @@ FixtureExecutionResult expectScheduledDeadlineMatching(Instant scheduledTime,\n      */\n     FixtureExecutionResult expectScheduledDeadlineOfType(Instant scheduledTime, Class<?> deadlineType);\n \n+    /**\n+     * Asserts that a deadline with the given {@code deadlineName} has been scheduled after the given {@code duration}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzODg0Mg==", "bodyText": "Tests for the Instant scheduledTime option are needed as well?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306#discussion_r363238842", "createdAt": "2020-01-06T10:32:05Z", "author": {"login": "lfgcampos"}, "path": "test/src/test/java/org/axonframework/test/aggregate/FixtureTest_Deadlines.java", "diffHunk": "@@ -44,61 +50,68 @@ void setUp() {\n     @Test\n     void testDeadlineScheduling() {\n         fixture.givenNoPriorActivity()\n-               .when(new CreateMyAggregateCommand(\"id\"))\n+               .when(CREATE_COMMAND)\n                .expectScheduledDeadline(Duration.ofMinutes(TRIGGER_DURATION_MINUTES), \"deadlineDetails\");\n     }\n \n     @Test\n     void testDeadlineSchedulingTypeMatching() {\n         fixture.givenNoPriorActivity()\n-               .when(new CreateMyAggregateCommand(\"id\"))\n+               .when(CREATE_COMMAND)\n                .expectScheduledDeadlineOfType(Duration.ofMinutes(TRIGGER_DURATION_MINUTES), String.class);\n     }\n \n+    @Test\n+    void testDeadlineSchedulingNameMatching() {\n+        fixture.given(new MyAggregateCreatedEvent(AGGREGATE_ID, \"deadlineName\", \"deadlineId\"))\n+               .when(new SetPayloadlessDeadlineCommand(AGGREGATE_ID))\n+               .expectScheduledDeadlineWithName(Duration.ofMinutes(TRIGGER_DURATION_MINUTES), \"payloadless-deadline\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzOTAzMw==", "bodyText": "Tests for the Instant scheduledTime option are needed as well?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306#discussion_r363239033", "createdAt": "2020-01-06T10:32:41Z", "author": {"login": "lfgcampos"}, "path": "test/src/test/java/org/axonframework/test/saga/FixtureTest_Deadlines.java", "diffHunk": "@@ -57,15 +60,26 @@ void testDeadlineScheduling() {\n     @Test\n     void testDeadlineSchedulingTypeMatching() {\n         fixture.givenNoPriorActivity()\n-               .whenAggregate(\"id\").publishes(new TriggerSagaStartEvent(\"id\"))\n+               .whenAggregate(AGGREGATE_ID)\n+               .publishes(START_SAGA_EVENT)\n                .expectActiveSagas(1)\n                .expectScheduledDeadlineOfType(Duration.ofMinutes(TRIGGER_DURATION_MINUTES), String.class)\n                .expectNoScheduledEvents();\n     }\n \n+    @Test\n+    void testDeadlineSchedulingNameMatching() {\n+        fixture.givenAggregate(AGGREGATE_ID)\n+               .published(START_SAGA_EVENT)\n+               .whenAggregate(AGGREGATE_ID)\n+               .publishes(new PayloadlessDeadlineShouldBeSetEvent(AGGREGATE_ID))\n+               .expectScheduledDeadlineWithName(Duration.ofMinutes(TRIGGER_DURATION_MINUTES), \"payloadless-deadline\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NTcyOTMx", "url": "https://github.com/AxonFramework/AxonFramework/pull/1306#pullrequestreview-338572931", "createdAt": "2020-01-06T10:35:56Z", "commit": {"oid": "76dc02f53deec40d19a1c3fe3d77e42ea9aac3ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e90ba4235f981f8d2c43cba8514547a0b15d31a4", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/e90ba4235f981f8d2c43cba8514547a0b15d31a4", "committedDate": "2020-01-06T14:15:07Z", "message": "Merge branch 'feature/1050' into feature/680"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d71c15d3cf486ac45cc9aa7cbe374e5fde4f8f91", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/d71c15d3cf486ac45cc9aa7cbe374e5fde4f8f91", "committedDate": "2020-01-06T14:22:48Z", "message": "Resolve javadoc typos\n\nResolve javadoc typos\n\n#680"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1807, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}