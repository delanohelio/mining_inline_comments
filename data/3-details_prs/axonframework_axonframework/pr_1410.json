{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MDQ1NTMz", "number": 1410, "title": "Adjust retrieval of Query Name in the QueryGateway", "bodyText": "The QueryGateway recently received an adjustment which allowed the usage of Message instances for the query parameter. This was introduced to support addition of MetaData directly on the QueryGateway.\nDue to this adjustment, some of the default QueryGateway methods now set the queryName parameter to the outcome of Message.class.getName(). As Message would (very likely) never be the desired queryName, this behaviour should be adjusted to verify whether the given query parameter is an instance of Message.\nThat's exactly what this pull request introduces. For this, a static method has been included in the GenericMessage class, which validates whether a given object is the payload or a message.\nIn case of the former, payload.getClass().getName() will be performed.\nIn case of the latter, ((Message) payload).getPayloadType().getName() will be used as the message name.\nTests have been included in the GenericMessageTest and DefaultQueryGatewayTest classes.", "createdAt": "2020-04-17T10:13:22Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410", "merged": true, "mergeCommit": {"oid": "2b6f56e0cd49669ef49599a0e5df2cb8c137ec4b"}, "closed": true, "closedAt": "2020-04-22T07:25:44Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYeaSoAH2gAyNDA1MDQ1NTMzOmE4NTU0ODg0NTA0ZTkyZGNhNzAzOGU3ZjM5Nzc5MDNmZTA1OThjM2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ1SfKgH2gAyNDA1MDQ1NTMzOjQ0ZDU5YjY0MzM2YThjYmE2NDRlMzI5OTFmY2NjZDI4MWU3ODI5YTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a8554884504e92dca7038e7f3977903fe0598c3e", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/a8554884504e92dca7038e7f3977903fe0598c3e", "committedDate": "2020-04-17T10:06:08Z", "message": "Adjust how the query name will be retrieved\n\nThe commit which introduce the option to provide a Message as the query\nparameter missed the adjustment to ensure the queryName would stay\nconsistently. Hence, the queryName could become \"Message\", which is\ndefinitely not intended. As a resolution, a static method can be\nintroduced in the GenericMessage class which correctly deduced the\nmessage name. This static method can in turn be used in the QueryGateway\n default methods to supply the right queryName field. Subsequently, the\n tests should be updated to verify this behaviour.\n\n#query-name-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d8b849ccfd496348bbb6bb0f2ad160da269360a", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/1d8b849ccfd496348bbb6bb0f2ad160da269360a", "committedDate": "2020-04-17T12:08:28Z", "message": "Add tests\n\nAdd tests which verify the given query name will be used if it's\nspecified\n\n#1410"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDExMTYy", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410#pullrequestreview-395411162", "createdAt": "2020-04-17T12:31:08Z", "commit": {"oid": "1d8b849ccfd496348bbb6bb0f2ad160da269360a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MjgyNTg1", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410#pullrequestreview-396282585", "createdAt": "2020-04-20T09:22:25Z", "commit": {"oid": "1d8b849ccfd496348bbb6bb0f2ad160da269360a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3Mjg1MDc3", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410#pullrequestreview-397285077", "createdAt": "2020-04-21T12:36:01Z", "commit": {"oid": "1d8b849ccfd496348bbb6bb0f2ad160da269360a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjozNjowMVrOGJDXVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjozNjowMVrOGJDXVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NTQ5NQ==", "bodyText": "I think this class also needs to take instance of QueryMessage into account, and use the queryName property to get the name.\nAlso suggest using queryName instead of messageName as method name and moving it to GenericQueryMessage.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410#discussion_r412145495", "createdAt": "2020-04-21T12:36:01Z", "author": {"login": "abuijze"}, "path": "messaging/src/main/java/org/axonframework/messaging/GenericMessage.java", "diffHunk": "@@ -56,6 +57,23 @@\n         }\n     }\n \n+    /**\n+     * Extracts the message name from the given {@code payloadOrMessage}. If the given {@code payloadOrMessage} is an\n+     * instance of {@link Message}, {@link Message#getPayloadType()} is used. Otherwise we expect the given {@link\n+     * Object} to be the payload directly. The return value will be the result of {@link Class#getName()}, either from\n+     * the {@code Message}'s {@code payloadType} or from the payload's class.\n+     *\n+     * @param payloadOrMessage the payload to extract the {@link Class#getName()} from, or an instance of {@link\n+     *                         Message}\n+     * @return the {@link Class#getName()} result from the payload, or from the {@link Message#getPayloadType()} if the\n+     * given {@code payloadOrMessage} is an instance of {@link Message}\n+     */\n+    public static String messageName(Object payloadOrMessage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d8b849ccfd496348bbb6bb0f2ad160da269360a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "148a12f63fdbcf619aa43fb519af0aaa610df279", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/148a12f63fdbcf619aa43fb519af0aaa610df279", "committedDate": "2020-04-21T15:18:53Z", "message": "Adjust logic to retrieve the query name\n\nMove the static messageName method to the QueryMessage interface. Added,\n supply a check which verifies if the given object is a QueryMessage.\n\n#1410"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44d59b64336a8cba644e32991fcccd281e7829a1", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/44d59b64336a8cba644e32991fcccd281e7829a1", "committedDate": "2020-04-21T15:19:21Z", "message": "Merge remote-tracking branch 'origin/axon-4.3.x' into bug/query-name-fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1744, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}