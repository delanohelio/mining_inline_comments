{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2NTcwMzQ1", "number": 1657, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxMjo0NzowNlrOFNOA0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxMjo0NzowNlrOFNOA0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NDA1MzkyOnYy", "diffSide": "RIGHT", "path": "config/src/main/java/org/axonframework/config/AggregateConfigurer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxMjo0NzowNlrOIRT5GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxMzozMjoyNVrOIRVb6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTAyMjYxNw==", "bodyText": "Wouldn't this change break backwards compatibility? I'd opt for finding a way to toggle this feature instead of using it by default.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1657#discussion_r555022617", "createdAt": "2021-01-11T12:47:06Z", "author": {"login": "m1l4n54v1c"}, "path": "config/src/main/java/org/axonframework/config/AggregateConfigurer.java", "diffHunk": "@@ -178,7 +182,13 @@ protected AggregateConfigurer(Class<A> aggregate) {\n         );\n         snapshotTriggerDefinition = new Component<>(() -> parent, name(\"snapshotTriggerDefinition\"),\n                                                     c -> NoSnapshotTriggerDefinition.INSTANCE);\n-        snapshotFilter = new Component<>(() -> parent, name(\"snapshotFilter\"), c -> SnapshotFilter.allowAll());\n+        snapshotFilter = new Component<>(() -> parent, name(\"snapshotFilter\"), c -> {\n+            Optional<String> revisionValue =\n+                    AnnotationUtils.findAnnotationAttribute(aggregate, Revision.class, \"revision\");\n+            return revisionValue.isPresent()\n+                    ? new RevisionSnapshotFilter(revisionValue.get())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92203c326e2c87d3144199a6cdab4e93bff42935"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTAyOTQzNQ==", "bodyText": "There was no reason to put the @Revision on an Aggregate until now. The only thing is will \"break\", is that now the default is to look at the revision of the aggregate to validate whether a snapshot is suitable for that Aggregate. If that alters any behavior, it will cause an aggregate to be streamed from its entire past events for a single time, whereafter a new snapshot is created.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1657#discussion_r555029435", "createdAt": "2021-01-11T12:59:37Z", "author": {"login": "abuijze"}, "path": "config/src/main/java/org/axonframework/config/AggregateConfigurer.java", "diffHunk": "@@ -178,7 +182,13 @@ protected AggregateConfigurer(Class<A> aggregate) {\n         );\n         snapshotTriggerDefinition = new Component<>(() -> parent, name(\"snapshotTriggerDefinition\"),\n                                                     c -> NoSnapshotTriggerDefinition.INSTANCE);\n-        snapshotFilter = new Component<>(() -> parent, name(\"snapshotFilter\"), c -> SnapshotFilter.allowAll());\n+        snapshotFilter = new Component<>(() -> parent, name(\"snapshotFilter\"), c -> {\n+            Optional<String> revisionValue =\n+                    AnnotationUtils.findAnnotationAttribute(aggregate, Revision.class, \"revision\");\n+            return revisionValue.isPresent()\n+                    ? new RevisionSnapshotFilter(revisionValue.get())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTAyMjYxNw=="}, "originalCommit": {"oid": "92203c326e2c87d3144199a6cdab4e93bff42935"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTA0NzkxMw==", "bodyText": "Ah, it wasn't used. Please disregard my comment then :)", "url": "https://github.com/AxonFramework/AxonFramework/pull/1657#discussion_r555047913", "createdAt": "2021-01-11T13:32:25Z", "author": {"login": "m1l4n54v1c"}, "path": "config/src/main/java/org/axonframework/config/AggregateConfigurer.java", "diffHunk": "@@ -178,7 +182,13 @@ protected AggregateConfigurer(Class<A> aggregate) {\n         );\n         snapshotTriggerDefinition = new Component<>(() -> parent, name(\"snapshotTriggerDefinition\"),\n                                                     c -> NoSnapshotTriggerDefinition.INSTANCE);\n-        snapshotFilter = new Component<>(() -> parent, name(\"snapshotFilter\"), c -> SnapshotFilter.allowAll());\n+        snapshotFilter = new Component<>(() -> parent, name(\"snapshotFilter\"), c -> {\n+            Optional<String> revisionValue =\n+                    AnnotationUtils.findAnnotationAttribute(aggregate, Revision.class, \"revision\");\n+            return revisionValue.isPresent()\n+                    ? new RevisionSnapshotFilter(revisionValue.get())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTAyMjYxNw=="}, "originalCommit": {"oid": "92203c326e2c87d3144199a6cdab4e93bff42935"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3182, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}