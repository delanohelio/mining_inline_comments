{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NTU4MjQz", "number": 1308, "title": "[#691] Expand fixture API with \"expect no scheduled events / deadlines\"", "bodyText": "This pull request introduces an API to the AggregateTestFixture and SagaTestFixture through which the user can validate that:\n\nNo events (of type) have been scheduled in a Saga\nNo deadlines (of type/name) have been scheduled in a Saga\nNo deadlines (of type/name) have been scheduled in an Aggregate\n\nAll permutations allow validating based on an Instant and Duration, making it similar to the other expect deadline/scheduled-event methods.\nTests have been introduce, alongside the resolution of IDE mentioned warnings and style guide changes on all touched files.\nThis pull request resolves #691", "createdAt": "2020-01-06T14:08:03Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308", "merged": true, "mergeCommit": {"oid": "a711a25c54375791523588d5378846dfeebbab2e"}, "closed": true, "closedAt": "2020-01-10T15:34:07Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3pY5eAH2gAyMzU5NTU4MjQzOjZkODMzOGJiNjkxOTVjZTk0NDU5NGI2MzNlMTZhNjliODU0NmZjYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5ASTKAH2gAyMzU5NTU4MjQzOjRmOThhN2E2ZjY3YjQxMDYxODU5NzkyYzQxMWMxZjY0NDYyOWYzOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6d8338bb69195ce944594b633e16a69b8546fcbc", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/6d8338bb69195ce944594b633e16a69b8546fcbc", "committedDate": "2020-01-06T10:14:04Z", "message": "Some preliminary work\n\nMake some minor adjustments prior to introducing the canceled deadlines\nlogic as a form of clean up\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ced28317f044a20843fd9a1d805dfba4c8ad1d5e", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/ced28317f044a20843fd9a1d805dfba4c8ad1d5e", "committedDate": "2020-01-06T11:15:22Z", "message": "Add assert-no-scheduled-deadline methods\n\nTo provide functionality to match/test for no scheduled deadlines\nfunctions should be introduced which assert that. An assert method\ntaking in a Duration and a Matcher and an assert method taking in an\nInstant and a Matcher should be sufficient. Whilst in the file, resolve\ninconsistencies and warnings as mentioned by the IDE\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0f056155133f67a378cbd1f949922ca319c5067", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/f0f056155133f67a378cbd1f949922ca319c5067", "committedDate": "2020-01-06T11:39:41Z", "message": "Implement set of expect no scheduled deadline methods\n\nThe AggregateTestFixture should allow testing for no scheduled deadlines\nThe same parameters used to test for actual scheduled deadlines, thus\nthrough a deadline Matcher, object, type and name, should be provided,\nas well as method sets for Instant and Duration checking.\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a4b642cd05c6ea557c8309d3650220441822ae6", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/2a4b642cd05c6ea557c8309d3650220441822ae6", "committedDate": "2020-01-06T11:46:43Z", "message": "Implement set of expect no scheduled deadline methods\n\nThe SagaTestFixture should allow testing for no scheduled deadlines\nThe same parameters used to test for actual scheduled deadlines, thus\nthrough a deadline Matcher, object, type and name, should be provided,\nas well as method sets for Instant and Duration checking.\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "511b0e91df6172d9f7c03a8e42de55a03c06cb15", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/511b0e91df6172d9f7c03a8e42de55a03c06cb15", "committedDate": "2020-01-06T11:48:53Z", "message": "Move the EventSchedulerValidator to the eventscheduler package\n\nMove the EventSchedulerValidator to the eventscheduler package\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdc374d994ec1c40a08d5c9d5f89f4b27a1f3b79", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/cdc374d994ec1c40a08d5c9d5f89f4b27a1f3b79", "committedDate": "2020-01-06T13:28:51Z", "message": "Add assert-no-scheduled-event methods\n\nTo provide functionality to match/test for no scheduled events\nfunctions should be introduced which assert that. An assert method\ntaking in a Duration and a Matcher and an assert method taking in an\nInstant and a Matcher should be sufficient. Whilst in the file, resolve\ninconsistencies and warnings as mentioned by the IDE\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba211ae1731c44a9793841b03b57742738a5e213", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/ba211ae1731c44a9793841b03b57742738a5e213", "committedDate": "2020-01-06T13:30:02Z", "message": "Implement set of expect no scheduled event methods\n\nThe SagaTestFixture should allow testing for no scheduled events\nThe same parameters used to test for actual scheduled events, thus\nthrough a event Matcher, object, type and name, should be provided,\nas well as method sets for Instant and Duration checking.\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e294292c922b44415b320b076769bcfb6f60b523", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/e294292c922b44415b320b076769bcfb6f60b523", "committedDate": "2020-01-06T13:56:11Z", "message": "Provide tests for the no-scheduled-events methods\n\nAdd a dedicated test class for scheduled events for clarity. Move\napplicable tests from the AnnotatedSagaTest to this new file and add\ntest scenarios for the new expect no-scheduled-events. Perform some\nclean up for the touched files whilst at it\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3faa074c328fa2a22548d625563e45f144567ca", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/b3faa074c328fa2a22548d625563e45f144567ca", "committedDate": "2020-01-06T13:57:00Z", "message": "Adjust test names for clarity\n\nAdjust test names for clarity\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e06b2099895ff5a6407ef9b54e33f72cc8b0362d", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/e06b2099895ff5a6407ef9b54e33f72cc8b0362d", "committedDate": "2020-01-06T14:08:48Z", "message": "Trigger copyright update\n\nTrigger copyright notice update to 2020\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9b465c9a16fb1c18508324693e270b6bf3050a5", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/b9b465c9a16fb1c18508324693e270b6bf3050a5", "committedDate": "2020-01-06T14:11:57Z", "message": "Undo change to trigger copyright update\n\nUndo the change which triggered the copyright notice update\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b474f56cc0639f1496edac714f3b41ffb513fb8", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/6b474f56cc0639f1496edac714f3b41ffb513fb8", "committedDate": "2020-01-06T14:26:58Z", "message": "Merge branch 'feature/894' into feature/691"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Njk5Nzgy", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#pullrequestreview-338699782", "createdAt": "2020-01-06T15:15:22Z", "commit": {"oid": "6b474f56cc0639f1496edac714f3b41ffb513fb8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNToxNToyMlrOFagQeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNToxNToyMlrOFagQeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMzNTgwMA==", "bodyText": "This is still a @duration =)\njavadoc changes as usual", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#discussion_r363335800", "createdAt": "2020-01-06T15:15:22Z", "author": {"login": "lfgcampos"}, "path": "test/src/main/java/org/axonframework/test/aggregate/ResultValidator.java", "diffHunk": "@@ -274,6 +275,100 @@\n      */\n     ResultValidator<T> expectNoScheduledDeadlines();\n \n+    /**\n+     * Asserts that <b>no</b> deadline matching the given {@code matcher} should be scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration the time at which no deadline matching the given {@code matcher} should be scheduled\n+     * @param matcher  the matcher defining the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineMatching(Duration duration,\n+                                                         Matcher<? super DeadlineMessage<?>> matcher);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline equal to the given {@code deadline} has been scheduled after the given {@code\n+     * duration}.\n+     * <p/>\n+     * Note that the source attribute of the deadline is ignored when comparing deadlines. Deadlines are compared using\n+     * an \"equals\" check on all fields in the deadlines.\n+     *\n+     * @param duration the time at which no deadline equal to the given {@code deadline} should be scheduled\n+     * @param deadline the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadline(Duration duration, Object deadline);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline of the given {@code deadlineType} has been scheduled at the given {@code\n+     * scheduledTime}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b474f56cc0639f1496edac714f3b41ffb513fb8"}, "originalPosition": 134}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73fcc6c48329afe15f2c41a643eb4cf302701ad6", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/73fcc6c48329afe15f2c41a643eb4cf302701ad6", "committedDate": "2020-01-07T10:01:10Z", "message": "Resolve javadoc typos\n\nResolve javadoc typos\n\n#691"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMTU2Mzg4", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#pullrequestreview-340156388", "createdAt": "2020-01-08T21:28:44Z", "commit": {"oid": "73fcc6c48329afe15f2c41a643eb4cf302701ad6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMToyODo0NVrOFbkYVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMToyODo0NVrOFbkYVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MTkyNA==", "bodyText": "The timestamp of a DeadlineMessage should reflect the time of expiry of the deadline. At least, the DeadlineManager implementations for production use, have the schedule date as the event timestamp once they publish the Deadline Message. It would be nice for the StubDeadlineManager to reflect this behavior.\nThat would make the Instant parameter obsolete for this method. As a result, the method could become more powerful, as one can more easily validate the absence of any deadlines that match certain criteria.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#discussion_r364451924", "createdAt": "2020-01-08T21:28:45Z", "author": {"login": "abuijze"}, "path": "test/src/main/java/org/axonframework/test/aggregate/ResultValidator.java", "diffHunk": "@@ -274,6 +275,100 @@\n      */\n     ResultValidator<T> expectNoScheduledDeadlines();\n \n+    /**\n+     * Asserts that <b>no</b> deadline matching the given {@code matcher} should be scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration the time at which no deadline matching the given {@code matcher} should be scheduled\n+     * @param matcher  the matcher defining the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineMatching(Duration duration,\n+                                                         Matcher<? super DeadlineMessage<?>> matcher);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline equal to the given {@code deadline} has been scheduled after the given {@code\n+     * duration}.\n+     * <p/>\n+     * Note that the source attribute of the deadline is ignored when comparing deadlines. Deadlines are compared using\n+     * an \"equals\" check on all fields in the deadlines.\n+     *\n+     * @param duration the time at which no deadline equal to the given {@code deadline} should be scheduled\n+     * @param deadline the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadline(Duration duration, Object deadline);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline of the given {@code deadlineType} has been scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration     the time at which no deadline of {@code deadlineType} should be scheduled\n+     * @param deadlineType the type of the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineOfType(Duration duration, Class<?> deadlineType);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline with the given {@code deadlineName} has been scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration     the time at which no deadline of {@code deadlineName} should be scheduled\n+     * @param deadlineName the name of the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineWithName(Duration duration, String deadlineName);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline matching the given {@code matcher} has been scheduled at the given {@code\n+     * scheduledTime}.\n+     * <p/>\n+     * If the {@code scheduledTime} is calculated based on the \"current time\", use the {@link\n+     * TestExecutor#currentTime()} to get the time to use as \"current time\".\n+     *\n+     * @param scheduledTime the time at which no deadline matching the given {@code matcher} should be scheduled\n+     * @param matcher       the matcher defining the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineMatching(Instant scheduledTime,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73fcc6c48329afe15f2c41a643eb4cf302701ad6"}, "originalPosition": 163}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5200f41b69531de25972a341f386b866b6648c78", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/5200f41b69531de25972a341f386b866b6648c78", "committedDate": "2020-01-10T09:38:00Z", "message": "Merge remote-tracking branch 'origin/master' into feature/691"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMTAyNTky", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#pullrequestreview-341102592", "createdAt": "2020-01-10T11:22:10Z", "commit": {"oid": "73fcc6c48329afe15f2c41a643eb4cf302701ad6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "560e6ab4882bbe3d16ee38a2287fa8daa59637f9", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/560e6ab4882bbe3d16ee38a2287fa8daa59637f9", "committedDate": "2020-01-10T13:40:06Z", "message": "Add expectNoScheduledDeadlineMatching(Matcher<DeadlineMessage>)\n\nThe DeadlineMessage also contains the scheduled time. Hence, the\nResultValidatorImpl and FixtureExecutionResultImpl can already match if\nthe given Duration/Instant matches the scheduled time in the\nDeadlineMessage. This simplifies the DeadlineManagerValidator, as it\ndoesn't have to provide two assert methods (with differing time types)\nbut a single one taking in a Matcher\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1946cd5e390f04b8575845770e3c6902b2e094e9", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/1946cd5e390f04b8575845770e3c6902b2e094e9", "committedDate": "2020-01-10T14:01:59Z", "message": "Minor javadoc change\n\nMinor javadoc change\n\n#691"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f98a7a6f67b41061859792c411c1f644629f39f", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/4f98a7a6f67b41061859792c411c1f644629f39f", "committedDate": "2020-01-10T15:28:36Z", "message": "Switch around time and matcher check\n\nIt's smarter to first do the time matching and only then the provided\nmatcher. This way we ensure the given matcher isn't called for messages\nwith a completely different timestamp. Additionally, if the given\nmatcher is \"slow\", it would not be called in vain either.\n\n#691"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1810, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}