{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2ODc4Nzg4", "number": 1330, "title": "[#1252] Expose token replay info in EventTrackerStatus", "bodyText": "This PR will resolve #1252\nUser can now have more information on an ongoing reply token status, knowing the estimated position of current replay token and the reset token position until the replay will be processed.", "createdAt": "2020-01-24T15:04:20Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330", "merged": true, "mergeCommit": {"oid": "c21e1cffab3b25e01166506966aebe936bcb0d79"}, "closed": true, "closedAt": "2020-02-05T14:14:17Z", "author": {"login": "corradom"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9gOTvAH2gAyMzY2ODc4Nzg4OjcyMzU5NDAwMWRhZjNiNDUyNTJhOWVkOGIxZWE0NTA4N2IzNTcxYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBWk4SAFqTM1MzczMzIxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7", "author": {"user": {"login": "corradom", "name": "Corrado Musumeci"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/723594001daf3b45252a9ed8b1ea45087b3571a7", "committedDate": "2020-01-24T14:56:54Z", "message": "expose token replay info in EventTrackerStatus"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NTczMzg2", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#pullrequestreview-348573386", "createdAt": "2020-01-27T10:48:21Z", "commit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxMDo0ODoyMVrOFh-e3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxMToxMzo0N1rOFh_Jdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3MTAzOQ==", "bodyText": "Nit: To be more in line with the getReplayPosition method name, I'd call this method the getResetPosition.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371171039", "createdAt": "2020-01-27T10:48:21Z", "author": {"login": "smcvb"}, "path": "axon-server-connector/src/test/java/org/axonframework/axonserver/connector/processor/grpc/FakeEventTrackerStatus.java", "diffHunk": "@@ -70,4 +73,15 @@ public boolean isErrorState() {\n     public Throwable getError() {\n         return exception;\n     }\n+\n+    @Override\n+    public OptionalLong getReplayPosition() {\n+        return (replaying) ? trackingToken.position() : OptionalLong.empty();\n+    }\n+\n+    @Override\n+    public OptionalLong getResetTokenPosition() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3MTUwMQ==", "bodyText": "Nit: I think using 1 second i.o. 5 for the getResetTokenPosition validation is sufficient.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371171501", "createdAt": "2020-01-27T10:49:24Z", "author": {"login": "smcvb"}, "path": "integrationtests/src/test/java/org/axonframework/integrationtests/eventhandling/TrackingEventProcessorTest.java", "diffHunk": "@@ -700,8 +700,12 @@ void testResetCausesEventsToBeReplayed() throws Exception {\n         assertEquals(handled.subList(0, 4), handled.subList(4, 8));\n         assertEquals(handled.subList(4, 8), handledInRedelivery);\n         assertTrue(testSubject.processingStatus().get(0).isReplaying());\n+        assertTrue(testSubject.processingStatus().get(0).getReplayPosition().isPresent());\n+        assertTrue(testSubject.processingStatus().get(0).getResetTokenPosition().isPresent());\n         eventBus.publish(createEvents(1));\n         assertWithin(1, TimeUnit.SECONDS, () -> assertFalse(testSubject.processingStatus().get(0).isReplaying()));\n+        assertWithin(1, TimeUnit.SECONDS, () -> assertTrue(testSubject.processingStatus().get(0).getReplayPosition().isPresent()));\n+        assertWithin(5, TimeUnit.SECONDS, () -> assertFalse(testSubject.processingStatus().get(0).getResetTokenPosition().isPresent()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3MTU3Mg==", "bodyText": "Nit: I think using 1 second i.o. 5 for the getResetTokenPosition validation is sufficient.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371171572", "createdAt": "2020-01-27T10:49:33Z", "author": {"login": "smcvb"}, "path": "integrationtests/src/test/java/org/axonframework/integrationtests/eventhandling/TrackingEventProcessorTest.java", "diffHunk": "@@ -732,8 +736,12 @@ void testResetToPositionCausesCertainEventsToBeReplayed() throws Exception {\n         assertEquals(handled.subList(2, 4), handled.subList(4, 6));\n         assertEquals(handled.subList(4, 6), handledInRedelivery);\n         assertTrue(testSubject.processingStatus().get(0).isReplaying());\n+        assertTrue(testSubject.processingStatus().get(0).getReplayPosition().isPresent());\n+        assertTrue(testSubject.processingStatus().get(0).getResetTokenPosition().isPresent());\n         eventBus.publish(createEvents(1));\n         assertWithin(1, TimeUnit.SECONDS, () -> assertFalse(testSubject.processingStatus().get(0).isReplaying()));\n+        assertWithin(1, TimeUnit.SECONDS, () -> assertTrue(testSubject.processingStatus().get(0).getReplayPosition().isPresent()));\n+        assertWithin(5, TimeUnit.SECONDS, () -> assertFalse(testSubject.processingStatus().get(0).getResetTokenPosition().isPresent()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3ODc4Mg==", "bodyText": "Shouldn't both getReplayPosition and getResetTokenPosition return false it this point, as isReplaying is false too?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371178782", "createdAt": "2020-01-27T11:06:33Z", "author": {"login": "smcvb"}, "path": "integrationtests/src/test/java/org/axonframework/integrationtests/eventhandling/TrackingEventProcessorTest.java", "diffHunk": "@@ -806,6 +818,8 @@ void testResetBeforeStartingPerformsANormalRun() throws Exception {\n         assertWithin(1, TimeUnit.SECONDS, () -> assertEquals(4, handled.size()));\n         assertEquals(0, handledInRedelivery.size());\n         assertFalse(testSubject.processingStatus().get(0).isReplaying());\n+        assertTrue(testSubject.processingStatus().get(0).getReplayPosition().isPresent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3OTE1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n          \n          \n            \n                 * In case no estimation can be given or no replay is active, an {@code OptionalLong.empty()} will be returned.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371179153", "createdAt": "2020-01-27T11:07:26Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3OTQyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n          \n          \n            \n                 * Return the estimated relative replay position this Segment represents.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371179420", "createdAt": "2020-01-27T11:08:07Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3OTYxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Return the relative position at which a reset was triggered whether this Segment is still replaying.\n          \n          \n            \n                 * Return the relative position at which a reset was triggered for this Segment.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371179619", "createdAt": "2020-01-27T11:08:32Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();\n+\n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3OTc5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * In case of a replay ended or no replay an {@code OptionalLong.empty()} will be returned.\n          \n          \n            \n                 * In case a replay finished or no replay is active, an {@code OptionalLong.empty()} will be returned.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371179797", "createdAt": "2020-01-27T11:08:54Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();\n+\n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.\n+     * In case of a replay ended or no replay an {@code OptionalLong.empty()} will be returned.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3OTg5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return the relative position at which a reset was triggered whether this Segment is still replaying\n          \n          \n            \n                 * @return the relative position at which a reset was triggered for this Segment", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371179899", "createdAt": "2020-01-27T11:09:11Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();\n+\n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.\n+     * In case of a replay ended or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the relative position at which a reset was triggered whether this Segment is still replaying", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4MDc5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n          \n          \n            \n                 * @return return the estimated relative replay position this Segment represents", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371180798", "createdAt": "2020-01-27T11:11:23Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4MTA4Mw==", "bodyText": "Nit: To be more in line with the getReplayPosition method name, I'd call this method the getResetPosition.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371181083", "createdAt": "2020-01-27T11:12:02Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();\n+\n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.\n+     * In case of a replay ended or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the relative position at which a reset was triggered whether this Segment is still replaying\n+     */\n+    OptionalLong getResetTokenPosition();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4MTQ4NQ==", "bodyText": "I'd adjust this javadoc somewhat similar to the suggested adjustments in the EventTrackerStatus interface.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371181485", "createdAt": "2020-01-27T11:12:55Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/ReplayToken.java", "diffHunk": "@@ -99,6 +99,18 @@ public static boolean isReplay(TrackingToken trackingToken) {\n \n     }\n \n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4MTk0Mg==", "bodyText": "I think this method should check whether this.trackingToken is an instance of ReplayToken. Otherwise, I wouldn't expect a position.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371181942", "createdAt": "2020-01-27T11:13:47Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/TrackingEventProcessor.java", "diffHunk": "@@ -864,6 +865,16 @@ public Throwable getError() {\n             return errorState;\n         }\n \n+        @Override\n+        public OptionalLong getReplayPosition() {\n+            return trackingToken.position();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NTkxMjQw", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#pullrequestreview-348591240", "createdAt": "2020-01-27T11:20:51Z", "commit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxMToyMDo1MlrOFh_V5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxMToyNjoyMVrOFh_gEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4NTEyNQ==", "bodyText": "Can be useful to have here a method that returns the estimated number of events remaining to process.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371185125", "createdAt": "2020-01-27T11:20:52Z", "author": {"login": "saratry"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();\n+\n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.\n+     * In case of a replay ended or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the relative position at which a reset was triggered whether this Segment is still replaying\n+     */\n+    OptionalLong getResetTokenPosition();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4NzczMA==", "bodyText": "is it really useful? getTrackingToken().getPosition() and is Replaying() together can give the same information I think, is it correct?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r371187730", "createdAt": "2020-01-27T11:26:21Z", "author": {"login": "saratry"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67", "author": {"user": {"login": "corradom", "name": "Corrado Musumeci"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/4eb80a066b382123b2fb6fe62a49abded6459d67", "committedDate": "2020-01-28T13:16:21Z", "message": "address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODA1NTQ1", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#pullrequestreview-352805545", "createdAt": "2020-02-04T08:51:19Z", "commit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwODo1MToyMFrOFlMICA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwODo1Mzo1M1rOFlMMdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU0MDI5Ng==", "bodyText": "Based on the discussions we've had, I think this should be replaced for a getPosition().", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r374540296", "createdAt": "2020-02-04T08:51:20Z", "author": {"login": "smcvb"}, "path": "axon-server-connector/src/test/java/org/axonframework/axonserver/connector/processor/grpc/FakeEventTrackerStatus.java", "diffHunk": "@@ -70,4 +73,15 @@ public boolean isErrorState() {\n     public Throwable getError() {\n         return exception;\n     }\n+\n+    @Override\n+    public OptionalLong getReplayPosition() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU0MDg0NA==", "bodyText": "Sweet plan. That'll leave the getResetPosition as is, but will replace the getReplayPosition() method for a regular getPosition.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r374540844", "createdAt": "2020-02-04T08:52:36Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying.\n+     * In case no estimation can be given or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the estimated relative position this tracking token represents for the event tracker status whether this Segment is still replaying\n+     */\n+    OptionalLong getReplayPosition();\n+\n+    /**\n+     * Return the relative position at which a reset was triggered whether this Segment is still replaying.\n+     * In case of a replay ended or no replay an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the relative position at which a reset was triggered whether this Segment is still replaying\n+     */\n+    OptionalLong getResetTokenPosition();\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4NTEyNQ=="}, "originalCommit": {"oid": "723594001daf3b45252a9ed8b1ea45087b3571a7"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU0MTMxOA==", "bodyText": "I think this new method justifies a test in the ReplayTokenTest class.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r374541318", "createdAt": "2020-02-04T08:53:37Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/ReplayToken.java", "diffHunk": "@@ -99,6 +99,18 @@ public static boolean isReplay(TrackingToken trackingToken) {\n \n     }\n \n+    /**\n+     * Return the relative position at which a reset was triggered for this Segment.\n+     * In case a replay finished or no replay is active, an {@code OptionalLong.empty()} will be returned.\n+     *\n+     * @return the relative position at which a reset was triggered for this Segment\n+     */\n+    public static OptionalLong getTokenAtReset(TrackingToken trackingToken) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU0MTQzMA==", "bodyText": "Based on the discussions we've had, I think this should be replaced for a getPosition().", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r374541430", "createdAt": "2020-02-04T08:53:53Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/TrackingEventProcessor.java", "diffHunk": "@@ -864,6 +865,18 @@ public Throwable getError() {\n             return errorState;\n         }\n \n+        @Override\n+        public OptionalLong getReplayPosition() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODM4Mjc5", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#pullrequestreview-352838279", "createdAt": "2020-02-04T09:43:06Z", "commit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTo0MzowN1rOFlNqWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTo0MzowN1rOFlNqWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU2NTQ2Ng==", "bodyText": "Suggestion: might be nice to mention on this piece of javadoc that this method will return a non-empty result as long as isReplaying returns true.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r374565466", "createdAt": "2020-02-04T09:43:07Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/EventTrackerStatus.java", "diffHunk": "@@ -74,4 +76,21 @@\n      * @return the exception that caused processing to fail, or {@code null} when processing normally\n      */\n     Throwable getError();\n+\n+    /**\n+     * Return the estimated relative replay position this Segment represents.\n+     * In case no estimation can be given or no replay is active, an {@code OptionalLong.empty()} will be returned.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb80a066b382123b2fb6fe62a49abded6459d67"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41e50d8140ec5e0111575a758e31cc8ba9fe2b5d", "author": {"user": {"login": "corradom", "name": "Corrado Musumeci"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/41e50d8140ec5e0111575a758e31cc8ba9fe2b5d", "committedDate": "2020-02-04T15:24:30Z", "message": "Apply suggestions from code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNTQ1ODcx", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#pullrequestreview-353545871", "createdAt": "2020-02-05T08:49:03Z", "commit": {"oid": "41e50d8140ec5e0111575a758e31cc8ba9fe2b5d"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODo0OTowM1rOFlvwEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODo1MDozMlrOFlvyXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyMzk4Ng==", "bodyText": "Nit: indentation is slight off, as I'd expect spaces around !=", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r375123986", "createdAt": "2020-02-05T08:49:03Z", "author": {"login": "smcvb"}, "path": "axon-server-connector/src/test/java/org/axonframework/axonserver/connector/processor/grpc/FakeEventTrackerStatus.java", "diffHunk": "@@ -70,4 +73,15 @@ public boolean isErrorState() {\n     public Throwable getError() {\n         return exception;\n     }\n+\n+    @Override\n+    public OptionalLong getCurrentPosition() {\n+        return (trackingToken!=null) ? trackingToken.position() : OptionalLong.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e50d8140ec5e0111575a758e31cc8ba9fe2b5d"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyNDU3Mg==", "bodyText": "Nit: You could use {@inheritDoc} to copy over the documentation from the interface so that you do not have to duplicate it.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#discussion_r375124572", "createdAt": "2020-02-05T08:50:32Z", "author": {"login": "smcvb"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/TrackingEventProcessor.java", "diffHunk": "@@ -864,6 +865,28 @@ public Throwable getError() {\n             return errorState;\n         }\n \n+        /**\n+         * Return the estimated relative replay position this Segment represents.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e50d8140ec5e0111575a758e31cc8ba9fe2b5d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d8d9b17bcfd348c7505d6297240090d88f743d", "author": {"user": {"login": "corradom", "name": "Corrado Musumeci"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/a0d8d9b17bcfd348c7505d6297240090d88f743d", "committedDate": "2020-02-05T10:01:40Z", "message": "minor suggestions from code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNzMzMjE2", "url": "https://github.com/AxonFramework/AxonFramework/pull/1330#pullrequestreview-353733216", "createdAt": "2020-02-05T13:58:12Z", "commit": {"oid": "a0d8d9b17bcfd348c7505d6297240090d88f743d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1826, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}