{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NjYxNDUx", "number": 1597, "title": "[#1593] Filter ResetHandlers from canHandleType", "bodyText": "The AnnotationEventHandlerAdapter#canHandleType should not take @ResetHandler annotated methods into account when being invoked, because the reset handling members will only be invoked through a EventHandlerInvoker directly instead of as a result of general message handling.\nThe fact this filter was not in place was the main reason of issue #1593, which noted that events were not filtered out of the entire stream when a plain @ResetHandler (thus without a \"reset context\" as the message) was present. This occurred, since a @ResetHandler without any specific reset context was capable of handling any type of message. Due to this no events where ever filtered out of the stream, since the framework assumed everything could be handled.\nIntroducing the simple filter solves the problem, and as such resolves #1593", "createdAt": "2020-11-10T17:51:22Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597", "merged": true, "mergeCommit": {"oid": "d5e93c615404091bf200cc0eb237fcb6b3d612b4"}, "closed": true, "closedAt": "2020-11-11T13:55:03Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbLwBeAH2gAyNTE4NjYxNDUxOmM1NGQ2MjRiZWJmNjdmY2QyN2ZlMTIzODIwNzA4ZGM0ZjQwNGViZjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbeRBUAFqTUyODE4NjM2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c54d624bebf67fcd27fe123820708dc4f404ebf2", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/c54d624bebf67fcd27fe123820708dc4f404ebf2", "committedDate": "2020-11-10T16:14:36Z", "message": "Filter out ResetHandlers when filtering out events\n\nWhen the canHandleType is called, it should disregard ResetHandler\nannotated methods as those should only be invoked through the\nprepareReset method directly. Thus will ensure that filtering out\nevents as is supported by the BlockingStream actually works for\n@ResetHandler annotated methods which do not include a context\n\n#1593"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868b324d2d599e8f6362ceee0df23d8b55230c4d", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/868b324d2d599e8f6362ceee0df23d8b55230c4d", "committedDate": "2020-11-10T17:44:50Z", "message": "Merge remote-tracking branch 'origin/axon-4.4.x' into bug/1593"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69be9a276f22d3c519208919ea1abfd0c815bdef", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/69be9a276f22d3c519208919ea1abfd0c815bdef", "committedDate": "2020-11-10T17:52:54Z", "message": "Add comment for clarity\n\nAdd a comment specifying these methods are intended to be no-op\n\n#1593"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MDE2OTAz", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#pullrequestreview-528016903", "createdAt": "2020-11-11T09:47:40Z", "commit": {"oid": "69be9a276f22d3c519208919ea1abfd0c815bdef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwOTo0Nzo0MFrOHxF1zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwOTo0Nzo0MFrOHxF1zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIzNzk2NQ==", "bodyText": "The idea of these meta-annotations is that we shouldn't check on the actual annotation used. Instead, we should check whether the MessageHandler annotation declares a type of message that is compatible with the EventMessage.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#discussion_r521237965", "createdAt": "2020-11-11T09:47:40Z", "author": {"login": "abuijze"}, "path": "messaging/src/main/java/org/axonframework/eventhandling/AnnotationEventHandlerAdapter.java", "diffHunk": "@@ -105,6 +105,7 @@ public boolean canHandle(EventMessage<?> event) {\n     @Override\n     public boolean canHandleType(Class<?> payloadType) {\n         return inspector.getHandlers(listenerType)\n+                        .filter(messageHandler -> !messageHandler.hasAnnotation(ResetHandler.class))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69be9a276f22d3c519208919ea1abfd0c815bdef"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e914e21fe45210bcb3367c1b8428a69a7409cd0", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/6e914e21fe45210bcb3367c1b8428a69a7409cd0", "committedDate": "2020-11-11T10:21:39Z", "message": "Adjust filtering logic\n\nAdjust filtering logic to base itself on the messageType attributes on\nthe MessageHandler annotation. This way users can still create their own\n reset handlers specific annotation, meta-annotated with ResetHandler\n\n#1593"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d990fae5d5752f6fe4991a05a68003a05889df", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/93d990fae5d5752f6fe4991a05a68003a05889df", "committedDate": "2020-11-11T10:52:51Z", "message": "Switch filter logic\n\nSwitch filter logic to only accept events, instead of reject the\nResetContext. This way it automatically copes with the scenario that\nother message types will be introduced.\n\n#1593"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3e8f630fc95b598351076f7cb7c6b53f5533697", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/b3e8f630fc95b598351076f7cb7c6b53f5533697", "committedDate": "2020-11-11T13:05:15Z", "message": "Shorten filter operation\n\nShorten filter operation by using annotationAttributes instead of\ninvoking the annotationUtils\n\n#1593"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d58faca73231033c72a81e18c5894d5c862d7884", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/d58faca73231033c72a81e18c5894d5c862d7884", "committedDate": "2020-11-11T13:05:31Z", "message": "Merge remote-tracking branch 'origin/axon-4.4.x' into bug/1593"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8542568e77ffc272bd5002bd06e751b3acb3c90f", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/8542568e77ffc272bd5002bd06e751b3acb3c90f", "committedDate": "2020-11-11T13:18:08Z", "message": "Switch check order\n\nSwitch check order to focus on the EventMessage first\n\n#1593"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTcwMDY5", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#pullrequestreview-528170069", "createdAt": "2020-11-11T13:28:02Z", "commit": {"oid": "8542568e77ffc272bd5002bd06e751b3acb3c90f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b070a48bacd91b2624e88de00814f1d2d3a808f", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/9b070a48bacd91b2624e88de00814f1d2d3a808f", "committedDate": "2020-11-11T13:28:44Z", "message": "Use boolean i.o. Boolean\n\nUse boolean i.o. Boolean\n\n#1593"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTcxMDY2", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#pullrequestreview-528171066", "createdAt": "2020-11-11T13:29:22Z", "commit": {"oid": "9b070a48bacd91b2624e88de00814f1d2d3a808f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTg1ODIz", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#pullrequestreview-528185823", "createdAt": "2020-11-11T13:48:17Z", "commit": {"oid": "9b070a48bacd91b2624e88de00814f1d2d3a808f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTg2MzY5", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#pullrequestreview-528186369", "createdAt": "2020-11-11T13:48:56Z", "commit": {"oid": "9b070a48bacd91b2624e88de00814f1d2d3a808f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2031, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}