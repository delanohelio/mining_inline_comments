{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3ODgzNzA5", "number": 1421, "title": "[#1418] Allow activation of default type information on the JacksonSerializer", "bodyText": "As pointed out in issue #1418 (and several others), returning a List of complex objects as a result of a @QueryHandler annotated method will result in receiving a ArrayList containing LinkedHashMap instances instead of the expected Query Response.\nThis follows from the fact that the ObjectMapper can not deduce the type required within the collection, which can be resolved by adding type information upon serialization.\nAlthough configurable on the ObjectMapper somebody would use for the JacksonSerializer, I think it's beneficial to allow configuration of default type information directly on the JacksonSerializer instead. This is inline with the already present JacksonSerializer.Builder#lenientSerialization method.\nThis pull request introduce just such a functionality, specifying the requirement to provide a thorough PolymorphicTypeValidator for security reasons, as is stated in Jackson's documentation.\nThis PR resolves #1418.", "createdAt": "2020-04-23T12:28:46Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1421", "merged": true, "mergeCommit": {"oid": "58a5911524bcabf053123f9c1ed53e331de07f7a"}, "closed": true, "closedAt": "2020-04-30T10:02:24Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcab8EvAH2gAyNDA3ODgzNzA5OmI3M2UyZmVmYmJmODZlZjIzNDA2YzE5OGJmMzQ4ZDA2ZjcyNjUyZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaw5DAAFqTM5OTkxMjk5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b73e2fefbbf86ef23406c198bf348d06f72652e0", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/b73e2fefbbf86ef23406c198bf348d06f72652e0", "committedDate": "2020-04-23T12:21:10Z", "message": "Update Jackson version\n\nUpdate Jackson version 2.10.3\n\n#1418"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f1c971c210706b287cc0799aca988d66af99b27", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/2f1c971c210706b287cc0799aca988d66af99b27", "committedDate": "2020-04-23T12:23:44Z", "message": "Add activateDefaultTyping(PolymorphicTypeValidator) to JacksonSerializer\n\nIn the case users return lists of objects in a Query Handler in\nconjunction with using the JacksonSerializer, they will hit the\nproblem of deserialization missing the exact types to deserialize too.\nThe JacksonSerializer can benefit to allow easier toggling of the\naddition of type information upon serialization to resolve this issue.\n\n#1418"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDgwMzYw", "url": "https://github.com/AxonFramework/AxonFramework/pull/1421#pullrequestreview-399080360", "createdAt": "2020-04-23T13:07:39Z", "commit": {"oid": "2f1c971c210706b287cc0799aca988d66af99b27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMzowNzozOVrOGKoW2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMzowNzozOVrOGKoW2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgwMDE1NA==", "bodyText": "Shouldn't it be NON_CONCRETE_AND_ARRAYS (the same used on JacksonSerializer)?", "url": "https://github.com/AxonFramework/AxonFramework/pull/1421#discussion_r413800154", "createdAt": "2020-04-23T13:07:39Z", "author": {"login": "lfgcampos"}, "path": "messaging/src/test/java/org/axonframework/serialization/json/JacksonSerializerTest.java", "diffHunk": "@@ -103,7 +97,10 @@ void testSerializeAndDeserializeArray() {\n \n     @Test\n     void testSerializeAndDeserializeList() {\n-        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE, JsonTypeInfo.As.PROPERTY);\n+        objectMapper.activateDefaultTyping(\n+                objectMapper.getPolymorphicTypeValidator(),\n+                ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f1c971c210706b287cc0799aca988d66af99b27"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MTU3NTQ1", "url": "https://github.com/AxonFramework/AxonFramework/pull/1421#pullrequestreview-399157545", "createdAt": "2020-04-23T14:30:59Z", "commit": {"oid": "2f1c971c210706b287cc0799aca988d66af99b27"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDozMTowMFrOGKrLbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDozMTowMFrOGKrLbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0NjM4Mg==", "bodyText": "Note that change makes Axon incompatible with Jackson 2.9. Preferably, we would fall back to using enableDefaultTyping for pre-Jackson 2.10 versions.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1421#discussion_r413846382", "createdAt": "2020-04-23T14:31:00Z", "author": {"login": "abuijze"}, "path": "messaging/src/test/java/org/axonframework/serialization/json/JacksonSerializerTest.java", "diffHunk": "@@ -103,7 +97,10 @@ void testSerializeAndDeserializeArray() {\n \n     @Test\n     void testSerializeAndDeserializeList() {\n-        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE, JsonTypeInfo.As.PROPERTY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f1c971c210706b287cc0799aca988d66af99b27"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67d2cf90a124d61e9ea4f078b4534b7ff7b9ba37", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/67d2cf90a124d61e9ea4f078b4534b7ff7b9ba37", "committedDate": "2020-04-24T12:02:38Z", "message": "Revert usage of Jackson 2.10 API\n\nUsing the ObjectMapper#activateDefaultTyping method introduced into\nJackson 2.10 will introduce a breaking chance for users which supply an\nObjectMapper of versions prior to 2.10 when they'd use this feature.\nHence, this should be adjusted back to a pre-2.10 solution, using the\nObjectMapper#enableDefaultTyping method.\n\n#1418"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTEyOTk1", "url": "https://github.com/AxonFramework/AxonFramework/pull/1421#pullrequestreview-399912995", "createdAt": "2020-04-24T12:45:52Z", "commit": {"oid": "67d2cf90a124d61e9ea4f078b4534b7ff7b9ba37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1747, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}