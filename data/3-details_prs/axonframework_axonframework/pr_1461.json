{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNDgwMDM5", "number": 1461, "title": "Allow specific return types on creation policy always", "bodyText": "The AggregateCreationPolicy#ALWAYS on a command handler will currently ensure that the result of command handling will be the aggregate identifier. Thus similar to a command handling constructor.\nIt however makes sense to place the annotation @CreationPolicy(ALWAYS) on a method with a specific return type, expecting the user specified returned result to be the command handling result.\nThis PR ensures that this is the behavior of a command handling function annotated with @CreationPolicy(ALWAYS).\nWhen a return value is given on such a method, it will be the result of command handling.\nIf none is provided, it will default to the aggregate identifier.", "createdAt": "2020-06-29T15:10:36Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1461", "merged": true, "mergeCommit": {"oid": "8e31e2b3b28d656d3d7974badc187e5d38fe91e0"}, "closed": true, "closedAt": "2020-06-30T08:03:55Z", "author": {"login": "smcvb"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwCctegH2gAyNDQxNDgwMDM5OjlhMmE3ZWM2OTMyMmVkYWFhYjRlYmU5ODBjN2Q2MjI4YmFmOGQ2Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwQ-RqgFqTQzOTc2NTI5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a2a7ec69322edaaab4ebe980c7d6228baf8d627", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/9a2a7ec69322edaaab4ebe980c7d6228baf8d627", "committedDate": "2020-06-29T15:05:37Z", "message": "Allow specific returns type on creation policy always\n\nThe AggregateCreationPolicy#ALWAYS will default to returning the\naggregate identifier after command handling. Similar to a command\nhandling constructor. However, this policy allows to be placed on\nregular methods thus opening up to several return values. Hence, default\n to the aggregate identifier if no result is returned. Otherwise, return\n the result of command handling.\n\n#creation-policy-always-return-value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MzExMTYw", "url": "https://github.com/AxonFramework/AxonFramework/pull/1461#pullrequestreview-439311160", "createdAt": "2020-06-29T16:28:18Z", "commit": {"oid": "9a2a7ec69322edaaab4ebe980c7d6228baf8d627"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NzQzNzc2", "url": "https://github.com/AxonFramework/AxonFramework/pull/1461#pullrequestreview-439743776", "createdAt": "2020-06-30T07:32:37Z", "commit": {"oid": "9a2a7ec69322edaaab4ebe980c7d6228baf8d627"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzozMjozOFrOGqvd3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzozMjozOFrOGqvd3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ3MTA3MQ==", "bodyText": "I'd rather resolve return value if the handler is of type Void. In other situations, it's fine to return null:\n@CommandHandler\npublic MySuperAwesomeReturnType handle(MyCommand cmd) {\n  if (iDontLikeMyCmd(cmd)) {\n    return null;\n  }\n  return nonNullValue;\n}", "url": "https://github.com/AxonFramework/AxonFramework/pull/1461#discussion_r447471071", "createdAt": "2020-06-30T07:32:38Z", "author": {"login": "m1l4n54v1c"}, "path": "modelling/src/main/java/org/axonframework/modelling/command/AggregateAnnotationCommandHandler.java", "diffHunk": "@@ -393,12 +394,14 @@ private AlwaysCreateAggregateCommandHandler(MessageHandlingMember<? super T> han\n \n         @Override\n         public Object handle(CommandMessage<?> command) throws Exception {\n+            AtomicReference<Object> resultReference = new AtomicReference<>();\n             Aggregate<T> aggregate = repository.newInstance(() -> {\n                 T newInstance = factoryMethod.call();\n-                handler.handle(command, newInstance);\n+                resultReference.set(handler.handle(command, newInstance));\n                 return newInstance;\n             });\n-            return resolveReturnValue(command, aggregate);\n+            Object commandHandlingResult = resultReference.get();\n+            return commandHandlingResult != null ? commandHandlingResult : resolveReturnValue(command, aggregate);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a2a7ec69322edaaab4ebe980c7d6228baf8d627"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47e2e89c2e249355d5583ab992773cf34edd2dfc", "author": {"user": {"login": "smcvb", "name": "Steven van Beelen"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/47e2e89c2e249355d5583ab992773cf34edd2dfc", "committedDate": "2020-06-30T07:59:11Z", "message": "Allow null result\n\nAllow null result if the handler's return type is not void.\n\n#1461"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NzY1Mjkw", "url": "https://github.com/AxonFramework/AxonFramework/pull/1461#pullrequestreview-439765290", "createdAt": "2020-06-30T08:00:57Z", "commit": {"oid": "47e2e89c2e249355d5583ab992773cf34edd2dfc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1767, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}