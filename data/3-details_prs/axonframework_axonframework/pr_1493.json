{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMzMzNzc1", "number": 1493, "title": "Fixed infinite looping issue when tracking from a SequenceEventStorageEngine", "bodyText": "This PR resolves the issue that causes a Tracking Processor to possibly restream all events from the active storage when getting to the head of the stream.\nAddresses #1491", "createdAt": "2020-08-19T18:19:12Z", "url": "https://github.com/AxonFramework/AxonFramework/pull/1493", "merged": true, "mergeCommit": {"oid": "d9fdc8ccd11f8c673f9bde3c65a1205a8c8facca"}, "closed": true, "closedAt": "2020-08-26T20:01:39Z", "author": {"login": "abuijze"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAfwCrAH2gAyNDcwMzMzNzc1OjU4OGQwMDk2ZTJhNTgxN2E5NmEzZjRiYWVmOWNjMTc2MGQwMWE5MDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAs46GgH2gAyNDcwMzMzNzc1OmY3ZDhmMmI3MGFjNjYzZDhlYzBhYzdkNmU1ZDRkNzkxMjFmYTRjMTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "588d0096e2a5817a96a3f4baef9cc1760d01a906", "author": {"user": {"login": "abuijze", "name": "Allard Buijze"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/588d0096e2a5817a96a3f4baef9cc1760d01a906", "committedDate": "2020-08-19T18:16:46Z", "message": "Fixed infinite looping issue when tracking from a SequenceEventStorageEngine\n\nResolves #1491"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMjU0MTE0", "url": "https://github.com/AxonFramework/AxonFramework/pull/1493#pullrequestreview-471254114", "createdAt": "2020-08-20T05:19:51Z", "commit": {"oid": "588d0096e2a5817a96a3f4baef9cc1760d01a906"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNToxOTo1MVrOHDqT9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNToxOTo1MVrOHDqT9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYwMTAxMw==", "bodyText": "I don't understand this assumption. Isn't the point of the historic storage that some events will come from the historic, and some. events from the active store? At least this is the case in our production system.", "url": "https://github.com/AxonFramework/AxonFramework/pull/1493#discussion_r473601013", "createdAt": "2020-08-20T05:19:51Z", "author": {"login": "ovstetun"}, "path": "integrationtests/src/test/java/org/axonframework/integrationtests/eventhandling/TrackingEventProcessorTest.java", "diffHunk": "@@ -224,6 +251,44 @@ void tearDown() {\n         eventBus.shutDown();\n     }\n \n+    @Test\n+    void testSequenceEventStorageReceivesEachEventOnlyOnce() throws Exception {\n+        InMemoryEventStorageEngine historic = new InMemoryEventStorageEngine();\n+        InMemoryEventStorageEngine active = new InMemoryEventStorageEngine();\n+        SequenceEventStorageEngine sequenceEventStorageEngine = new SequenceEventStorageEngine(historic, active);\n+\n+        EmbeddedEventStore sequenceEventBus = EmbeddedEventStore.builder().storageEngine(sequenceEventStorageEngine).build();\n+\n+        initProcessor(TrackingEventProcessorConfiguration.forSingleThreadedProcessing()\n+                                                         .andEventAvailabilityTimeout(100, TimeUnit.MILLISECONDS),\n+                      b -> {\n+                          b.messageSource(sequenceEventBus);\n+                          return b;\n+                      });\n+\n+        historic.appendEvents(createEvent(AGGREGATE, 1L, \"message1\"), createEvent(AGGREGATE, 2L, \"message2\"));\n+        // to make sure tracking tokens match, we need to append the same number of events in the active store", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "588d0096e2a5817a96a3f4baef9cc1760d01a906"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNDA5ODc2", "url": "https://github.com/AxonFramework/AxonFramework/pull/1493#pullrequestreview-471409876", "createdAt": "2020-08-20T09:15:18Z", "commit": {"oid": "588d0096e2a5817a96a3f4baef9cc1760d01a906"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d8f2b70ac663d8ec0ac7d6e5d4d79121fa4c19", "author": {"user": {"login": "abuijze", "name": "Allard Buijze"}}, "url": "https://github.com/AxonFramework/AxonFramework/commit/f7d8f2b70ac663d8ec0ac7d6e5d4d79121fa4c19", "committedDate": "2020-08-20T09:35:13Z", "message": "Added concept of offset to InMemoryEventStorageEngine to support its use in SequenceEventStorageEngine"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1777, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}