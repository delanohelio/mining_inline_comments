{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NTA5Mjc2", "number": 3139, "title": "buildgen: update go_gapic_library for microgen", "bodyText": "The gapic-generator is no longer used to generate Go GAPICs, except for when invoking the go_gapic_library Bazel target. gapic-generator-go has an implementation of go_gapic_library to replace that of the gapic-generator.\nThis PR updates the Bazel BUILD file generator to generate the go_gapic_library interface implemented by gapic-generator-go.\nTwo notable differences are:\n\nThe grpc_service_config is used instead of gapic_yaml (for retry)\nThe importpath has a derived package name appended to it with a semicolon separator. This is a standard format in Go. It is derived based on the name of the product, indicated by the proto package segment immediately preceding the trailing version segement. This is required for the microgenerator, because it needs to know what to name the generated Go package. Presumably, gapic-generator was getting the same information from the package attribute of its go_gapic_library implementation, that's value was the proto package name.\n\nThe submission and release of this should be timed with a refactor of go_gapic_library uses in googleapis.", "createdAt": "2020-03-12T22:47:09Z", "url": "https://github.com/googleapis/gapic-generator/pull/3139", "merged": true, "mergeCommit": {"oid": "0bf1e325040acab8bd0594555c71a0daad1c38dd"}, "closed": true, "closedAt": "2020-03-24T01:36:57Z", "author": {"login": "noahdietz"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNZJ-OgBqjMxMjg2Njk3MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQoe-DAFqTM3OTkzODUyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7cf3dec779f13d61de7589251e02ab671d54e7c7", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/7cf3dec779f13d61de7589251e02ab671d54e7c7", "committedDate": "2020-03-13T20:35:05Z", "message": "fix google java format"}, "afterCommit": {"oid": "e8f6f7dd19edb6c03a422b2eed66593c2604b397", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/e8f6f7dd19edb6c03a422b2eed66593c2604b397", "committedDate": "2020-03-13T23:45:28Z", "message": "fix google java format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjkwMzU4", "url": "https://github.com/googleapis/gapic-generator/pull/3139#pullrequestreview-374690358", "createdAt": "2020-03-14T02:23:40Z", "commit": {"oid": "e8f6f7dd19edb6c03a422b2eed66593c2604b397"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMjoyMzo0MFrOF2XQeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMjoyMzo0MFrOF2XQeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU0ODQ3NA==", "bodyText": "Should I use {{name}} attribute here to add the package name suffix instead of parsing the proto package using the newly added assembleGoGapicImportPath method?\nIt would be, simply:\nimportpath = \"{{go_gapic_importpath}};{{name}}\",\nInstead of parsing the proto package and combining it into it's own template variable go_gapic_importpath_pkg.", "url": "https://github.com/googleapis/gapic-generator/pull/3139#discussion_r392548474", "createdAt": "2020-03-14T02:23:40Z", "author": {"login": "noahdietz"}, "path": "rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BUILD.bazel.gapic_api.mustache", "diffHunk": "@@ -106,10 +106,9 @@ go_proto_library(\n \n go_gapic_library(\n     name = \"{{name}}_go_gapic\",\n-    src = \":{{name}}_proto_with_info\",\n-    gapic_yaml = \"{{gapic_yaml}}\",\n-    importpath = \"{{go_gapic_importpath}}\",\n-    package = \"{{package}}\",\n+    srcs = [\":{{name}}_proto_with_info\"],\n+    grpc_service_config = \"{{grpc_service_config}}\",\n+    importpath = \"{{go_gapic_importpath_pkg}}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8f6f7dd19edb6c03a422b2eed66593c2604b397"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzgyOTc2", "url": "https://github.com/googleapis/gapic-generator/pull/3139#pullrequestreview-376382976", "createdAt": "2020-03-17T20:32:02Z", "commit": {"oid": "c68dadff4529ce9629f8552cf97fcd535324d234"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDozMjowMlrOF3s5iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDozMjowMlrOF3s5iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1MTYyNQ==", "bodyText": "this change looks suspicious, do you really need part after semicolon? The other go rules (those which come in rules_go) never require it.", "url": "https://github.com/googleapis/gapic-generator/pull/3139#discussion_r393951625", "createdAt": "2020-03-17T20:32:02Z", "author": {"login": "vam-google"}, "path": "rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java", "diffHunk": "@@ -73,7 +79,7 @@\n     tokens.put(\n         \"java_gapic_test_deps\", joinSetWithIndentationNl(mapJavaGapicTestDeps(actualImports)));\n \n-    tokens.put(\"go_gapic_importpath\", bp.getLangGapicPackages().get(\"go\").split(\";\")[0]);\n+    tokens.put(\"go_gapic_importpath\", bp.getLangGapicPackages().get(\"go\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c68dadff4529ce9629f8552cf97fcd535324d234"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ecbadd350bf7a23301d060d880e47070a74642c", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/1ecbadd350bf7a23301d060d880e47070a74642c", "committedDate": "2020-03-23T20:33:38Z", "message": "buildgen: update go_gapic_library for microgen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e21e732e2ab6309c5e897160b3172fd77a82d58e", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/e21e732e2ab6309c5e897160b3172fd77a82d58e", "committedDate": "2020-03-23T20:33:38Z", "message": "add newline to json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d6f605dfd6efbf09a055ce689056a8083c9d05", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/d4d6f605dfd6efbf09a055ce689056a8083c9d05", "committedDate": "2020-03-23T20:33:38Z", "message": "fix missing variable type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bec276a0bb23f1bdd43a0d25e180466594573f78", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/bec276a0bb23f1bdd43a0d25e180466594573f78", "committedDate": "2020-03-23T20:33:38Z", "message": "fix baseline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c47714eecda97b82c275ccb5aeef3624064399", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/f1c47714eecda97b82c275ccb5aeef3624064399", "committedDate": "2020-03-23T20:33:38Z", "message": "add pkg to importpath for go_gapic_library"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77b1ef352327df24bb736683b86a1285f062c588", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/77b1ef352327df24bb736683b86a1285f062c588", "committedDate": "2020-03-23T20:33:38Z", "message": "fix google java format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e6ff888a3a56076867d6d24c67f3b42fdf6af47", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/1e6ff888a3a56076867d6d24c67f3b42fdf6af47", "committedDate": "2020-03-23T20:33:38Z", "message": "remove unnecessary helper for go pkg name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f6c7dd406a459ff570b51324cf65c08f60e55c8", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/1f6c7dd406a459ff570b51324cf65c08f60e55c8", "committedDate": "2020-03-23T20:33:38Z", "message": "replace semicolon split on go pkg name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50e1743e324979acdb7c4290c2a454cdb33d0983", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/50e1743e324979acdb7c4290c2a454cdb33d0983", "committedDate": "2020-03-23T21:29:09Z", "message": "infer Go importpath based on API artifacts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4d1c5591ce5c8a3c06aa586e8e7417a2204c20f", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/a4d1c5591ce5c8a3c06aa586e8e7417a2204c20f", "committedDate": "2020-03-20T22:11:46Z", "message": "Merge branch 'master' into bazel-go-microgen"}, "afterCommit": {"oid": "50e1743e324979acdb7c4290c2a454cdb33d0983", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/50e1743e324979acdb7c4290c2a454cdb33d0983", "committedDate": "2020-03-23T21:29:09Z", "message": "infer Go importpath based on API artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ece2f93db07dcc12747c21cef8b477c4b32a4b36", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/ece2f93db07dcc12747c21cef8b477c4b32a4b36", "committedDate": "2020-03-23T21:29:41Z", "message": "googleJavaFormat"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODUyNTQy", "url": "https://github.com/googleapis/gapic-generator/pull/3139#pullrequestreview-379852542", "createdAt": "2020-03-23T21:57:17Z", "commit": {"oid": "ece2f93db07dcc12747c21cef8b477c4b32a4b36"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTo1NzoxN1rOF6ZmWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTo1ODo0NVrOF6ZpGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTE0NQ==", "bodyText": "Look like you are searching for an exact string match. If this is the case, then there is no need to use regexps. This thing already depends heavily on them and uses them in cases where they are not supposed to be used... If we can simplify it, then we probably should.", "url": "https://github.com/googleapis/gapic-generator/pull/3139#discussion_r396781145", "createdAt": "2020-03-23T21:57:17Z", "author": {"login": "vam-google"}, "path": "rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/ApiDir.java", "diffHunk": "@@ -10,20 +10,32 @@\n       Pattern.compile(\"(?m)^type\\\\s*:\\\\s*google.api.Service\\\\s*$\");\n   private static Pattern SERVICE_YAML_NAME_VERSION =\n       Pattern.compile(\"_(?<version>[a-zA-Z]+\\\\d+[\\\\w]*)\\\\.yaml\");\n+  private static Pattern CLOUD_AUTH_SCOPE =\n+      Pattern.compile(\"https\\\\:\\\\/\\\\/www\\\\.googleapis\\\\.com\\\\/auth\\\\/cloud-platform\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ece2f93db07dcc12747c21cef8b477c4b32a4b36"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTg0OQ==", "bodyText": "I guess this constructor is getting really big. If possible, please consider moving this in a private method (it is go-specific stuff, so putting it in separate method should be ok).", "url": "https://github.com/googleapis/gapic-generator/pull/3139#discussion_r396781849", "createdAt": "2020-03-23T21:58:45Z", "author": {"login": "vam-google"}, "path": "rules_gapic/bazel/src/main/java/com/google/api/codegen/bazel/BazelBuildFileView.java", "diffHunk": "@@ -73,7 +79,29 @@\n     tokens.put(\n         \"java_gapic_test_deps\", joinSetWithIndentationNl(mapJavaGapicTestDeps(actualImports)));\n \n-    tokens.put(\"go_gapic_importpath\", bp.getLangGapicPackages().get(\"go\").split(\";\")[0]);\n+    // Construct GAPIC import path & package name based on go_package proto option\n+    String goPkg = bp.getLangProtoPackages().get(\"go\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ece2f93db07dcc12747c21cef8b477c4b32a4b36"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0da4ef51d24054a65042dd4ce73b1dfc6f24358", "author": {"user": {"login": "noahdietz", "name": "Noah Dietz"}}, "url": "https://github.com/googleapis/gapic-generator/commit/f0da4ef51d24054a65042dd4ce73b1dfc6f24358", "committedDate": "2020-03-23T22:35:53Z", "message": "fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5OTM4NTI5", "url": "https://github.com/googleapis/gapic-generator/pull/3139#pullrequestreview-379938529", "createdAt": "2020-03-24T01:18:54Z", "commit": {"oid": "f0da4ef51d24054a65042dd4ce73b1dfc6f24358"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1370, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}