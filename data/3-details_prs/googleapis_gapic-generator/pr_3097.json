{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDgxMTUw", "number": 3097, "title": "Create multi-pattern resource using the new static create/format methods in samples and tests", "bodyText": "In Java, for libraries generated from gapic v2 + annotations, use the new static create methods (e.g., ofShelfBookName) to create resource names in samples and tests.", "createdAt": "2020-02-20T00:35:47Z", "url": "https://github.com/googleapis/gapic-generator/pull/3097", "merged": true, "mergeCommit": {"oid": "b32c73219d617f90de70bfa6ff0ea0b0dd638dfe"}, "closed": true, "closedAt": "2020-02-26T20:14:46Z", "author": {"login": "yihanzhen"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGAEUsgH2gAyMzc3NDgxMTUwOjgyZWFiZTlmNWI3NDc2MjBkYWM3MzEyZDA4YjVmZDNlMTNhMGMzMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIL2WmAH2gAyMzc3NDgxMTUwOjk2NTc2N2JiZmExNjM3OTc4NzczMWE2MWQ1MGE5MmU0MzdiNmZlN2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "82eabe9f5b747620dac7312d08b5fd3e13a0c305", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/82eabe9f5b747620dac7312d08b5fd3e13a0c305", "committedDate": "2020-02-20T00:34:21Z", "message": "first pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c6467506448127db0dd7794cd2c15c9c19d782e", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/1c6467506448127db0dd7794cd2c15c9c19d782e", "committedDate": "2020-02-20T00:49:59Z", "message": "update baseline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a563ff69685a448debf5302206b201feec3d0fec", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/a563ff69685a448debf5302206b201feec3d0fec", "committedDate": "2020-02-20T00:59:19Z", "message": "remove extra ;"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc2fbf7b2f8f6b59340217b1b26a03df2228fa09", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/fc2fbf7b2f8f6b59340217b1b26a03df2228fa09", "committedDate": "2020-02-20T01:13:45Z", "message": "add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ee318c9f3affb8015aebecb46555d9ec5968e2", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/58ee318c9f3affb8015aebecb46555d9ec5968e2", "committedDate": "2020-02-20T19:01:27Z", "message": "tests too!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/256184a7a03bebc6bc2d5b5a044729275357e890", "committedDate": "2020-02-20T19:04:20Z", "message": "baseline update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDY0OTQy", "url": "https://github.com/googleapis/gapic-generator/pull/3097#pullrequestreview-364464942", "createdAt": "2020-02-25T21:34:40Z", "commit": {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMTozNDo0MFrOFuWBbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMTo0NDoxMVrOFubtHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzOTYyOA==", "bodyText": "Minor: Please add a java doc here", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384139628", "createdAt": "2020-02-25T21:34:40Z", "author": {"login": "vam-google"}, "path": "src/main/java/com/google/api/codegen/config/ResourceNamePatternConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/* Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.api.codegen.config;\n+\n+import com.google.api.codegen.util.Name;\n+import com.google.api.pathtemplate.PathTemplate;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+\n+/** ResourceNamePatternConfig represents the configuration a resource name pattern. */\n+public class ResourceNamePatternConfig {\n+\n+  private final String pattern;\n+  @Nullable private final PathTemplate template;\n+\n+  public ResourceNamePatternConfig(String pattern) {\n+    this.pattern = pattern;\n+    this.template = PathTemplate.create(pattern);\n+  }\n+\n+  public ImmutableSet<String> getBindingVariables() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0Mjk0MA==", "bodyText": "Isn't checking for only one of the braces enough?", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384142940", "createdAt": "2020-02-25T21:41:20Z", "author": {"login": "vam-google"}, "path": "src/main/java/com/google/api/codegen/config/ResourceNamePatternConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/* Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.api.codegen.config;\n+\n+import com.google.api.codegen.util.Name;\n+import com.google.api.pathtemplate.PathTemplate;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+\n+/** ResourceNamePatternConfig represents the configuration a resource name pattern. */\n+public class ResourceNamePatternConfig {\n+\n+  private final String pattern;\n+  @Nullable private final PathTemplate template;\n+\n+  public ResourceNamePatternConfig(String pattern) {\n+    this.pattern = pattern;\n+    this.template = PathTemplate.create(pattern);\n+  }\n+\n+  public ImmutableSet<String> getBindingVariables() {\n+    if (isFixedPattern()) {\n+      return ImmutableSet.of();\n+    }\n+    return ImmutableSet.copyOf(template.vars());\n+  }\n+\n+  /** Returns true if the pattern does not have binding variables. */\n+  public boolean isFixedPattern() {\n+    return pattern.indexOf('{') == -1 && pattern.indexOf('}') == -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIzMTQ2OQ==", "bodyText": "Please consider replacing this method with String.replaceAll().", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384231469", "createdAt": "2020-02-26T01:39:21Z", "author": {"login": "vam-google"}, "path": "src/main/java/com/google/api/codegen/config/ResourceNamePatternConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/* Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.api.codegen.config;\n+\n+import com.google.api.codegen.util.Name;\n+import com.google.api.pathtemplate.PathTemplate;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+\n+/** ResourceNamePatternConfig represents the configuration a resource name pattern. */\n+public class ResourceNamePatternConfig {\n+\n+  private final String pattern;\n+  @Nullable private final PathTemplate template;\n+\n+  public ResourceNamePatternConfig(String pattern) {\n+    this.pattern = pattern;\n+    this.template = PathTemplate.create(pattern);\n+  }\n+\n+  public ImmutableSet<String> getBindingVariables() {\n+    if (isFixedPattern()) {\n+      return ImmutableSet.of();\n+    }\n+    return ImmutableSet.copyOf(template.vars());\n+  }\n+\n+  /** Returns true if the pattern does not have binding variables. */\n+  public boolean isFixedPattern() {\n+    return pattern.indexOf('{') == -1 && pattern.indexOf('}') == -1;\n+  }\n+\n+  /**\n+   * Returns the name of the static method that creates an instance of the resource name class\n+   * representing this pattern, such as ofProjectBookName.\n+   */\n+  public String getCreateMethodName() {\n+    return Name.anyLower(\"of\", getPatternNameLowerUnderscore(), \"name\").toLowerCamel();\n+  }\n+\n+  /**\n+   * Returns the name of the static method that returns a formatted string using this pattern, such\n+   * as formatProjectBookName.\n+   */\n+  public String getFormatMethodName() {\n+    return Name.anyLower(\"format\", getPatternNameLowerUnderscore(), \"name\").toLowerCamel();\n+  }\n+\n+  private String getPatternNameLowerUnderscore() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIzMjczNQ==", "bodyText": "Please consider moving this in a variable (not changed in the stream).", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384232735", "createdAt": "2020-02-26T01:44:11Z", "author": {"login": "vam-google"}, "path": "src/main/java/com/google/api/codegen/transformer/InitCodeTransformer.java", "diffHunk": "@@ -977,6 +1001,20 @@ private static SingleResourceNameConfig getMatchingSingleResourceNameConfig(\n     return matchingConfigs.get(0);\n   }\n \n+  private static ResourceNamePatternConfig getMatchingResourceNamePattern(\n+      InitCodeNode node, ResourceNameOneofConfig oneofConfig) {\n+    Optional<ResourceNamePatternConfig> pattern =\n+        oneofConfig\n+            .getPatterns()\n+            .stream()\n+            .filter(\n+                p ->\n+                    p.getBindingVariables()\n+                        .equals(node.getInitValueConfig().getResourceNameBindingValues().keySet()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890"}, "originalPosition": 121}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2429a83b619624b65bbead795ee691d43a17ab5a", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/2429a83b619624b65bbead795ee691d43a17ab5a", "committedDate": "2020-02-26T19:25:10Z", "message": "implement all"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965767bbfa16379787731a61d50a92e437b6fe7f", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/965767bbfa16379787731a61d50a92e437b6fe7f", "committedDate": "2020-02-26T19:25:48Z", "message": "Merge branch 'master' into multi-pattern-samplegen"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1411, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}