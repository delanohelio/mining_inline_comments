{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDE4ODE5", "number": 3151, "title": "feat: trace up only one level when calculating parent types with singleton resource names ", "bodyText": "parent type of projects/{project}/foo/bar/{bar} would be projects/{project}/foo.\nparent type of projects/{project}/foo would be projects/{project}.\nThis is to support dialogflow.", "createdAt": "2020-03-28T00:21:49Z", "url": "https://github.com/googleapis/gapic-generator/pull/3151", "merged": true, "mergeCommit": {"oid": "c895a56928c4b8b786a738db27aa93d925788e69"}, "closed": true, "closedAt": "2020-03-30T21:18:42Z", "author": {"login": "yihanzhen"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR6A0bgH2gAyMzk1MDE4ODE5OmExZDNhNDI4ODZjYTBlODliNTExYjE2MThhZWYzYWNiZmY5MzkzODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS1CtlgH2gAyMzk1MDE4ODE5OmI0NGFkZmIwOTU2ODBmMjM1MTAyMjg1NjlhODhmNGI4MjdjNTM4M2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a1d3a42886ca0e89b511b1618aef3acbff939389", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/a1d3a42886ca0e89b511b1618aef3acbff939389", "committedDate": "2020-03-28T00:18:11Z", "message": "baseline"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjg2MTA5", "url": "https://github.com/googleapis/gapic-generator/pull/3151#pullrequestreview-383286109", "createdAt": "2020-03-28T05:41:55Z", "commit": {"oid": "a1d3a42886ca0e89b511b1618aef3acbff939389"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQwNTo0MTo1NlrOF9HFew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQwNTo0MjoxMVrOF9HFhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYyMzU0Nw==", "bodyText": "Is this method ever called for a pattern of \"\"? If so, it should return \"\" at that point.", "url": "https://github.com/googleapis/gapic-generator/pull/3151#discussion_r399623547", "createdAt": "2020-03-28T05:41:56Z", "author": {"login": "jskeet"}, "path": "src/main/java/com/google/api/codegen/config/ResourceDescriptorConfig.java", "diffHunk": "@@ -271,15 +271,16 @@ private String getUnqualifiedTypeName() {\n   @VisibleForTesting\n   static String getParentPattern(String pattern) {\n     List<String> segments = getSegments(pattern);\n-    int index = segments.size() - 2;\n-    while (index >= 0 && !isVariableBinding(segments.get(index))) {\n+    int index = segments.size() - 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1d3a42886ca0e89b511b1618aef3acbff939389"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYyMzU1OQ==", "bodyText": "Does this report an error?", "url": "https://github.com/googleapis/gapic-generator/pull/3151#discussion_r399623559", "createdAt": "2020-03-28T05:42:11Z", "author": {"login": "jskeet"}, "path": "src/main/java/com/google/api/codegen/config/ResourceDescriptorConfig.java", "diffHunk": "@@ -271,15 +271,16 @@ private String getUnqualifiedTypeName() {\n   @VisibleForTesting\n   static String getParentPattern(String pattern) {\n     List<String> segments = getSegments(pattern);\n-    int index = segments.size() - 2;\n-    while (index >= 0 && !isVariableBinding(segments.get(index))) {\n+    int index = segments.size() - 1;\n+    if (isVariableBinding(segments.get(index))) {\n+      index -= 2;\n+    } else {\n       index--;\n     }\n-    index++;\n-    if (index <= 0) {\n+    if (index < 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1d3a42886ca0e89b511b1618aef3acbff939389"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08bf511a9d4b48b8120c31ce3f6cdc03b1012e1", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/b08bf511a9d4b48b8120c31ce3f6cdc03b1012e1", "committedDate": "2020-03-28T06:03:48Z", "message": "add error check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjg3Mjk4", "url": "https://github.com/googleapis/gapic-generator/pull/3151#pullrequestreview-383287298", "createdAt": "2020-03-28T06:06:32Z", "commit": {"oid": "b08bf511a9d4b48b8120c31ce3f6cdc03b1012e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQwNjowNjozMlrOF9HMyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQwNjowNjozMlrOF9HMyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYyNTQxNg==", "bodyText": "I suspect this should be index >= 0 - as otherwise we get an empty pattern, which still isn't a useful parent.\n(Basically, taking the parent of \"foo\" for \"foos/{foo}\" is invalid, I'd say. The empty pattern can't represent a resource name, so it's not useful.)", "url": "https://github.com/googleapis/gapic-generator/pull/3151#discussion_r399625416", "createdAt": "2020-03-28T06:06:32Z", "author": {"login": "jskeet"}, "path": "src/main/java/com/google/api/codegen/config/ResourceDescriptorConfig.java", "diffHunk": "@@ -272,14 +272,16 @@ private String getUnqualifiedTypeName() {\n   static String getParentPattern(String pattern) {\n     List<String> segments = getSegments(pattern);\n     int index = segments.size() - 1;\n+    if (index < 0) {\n+      return \"\";\n+    }\n     if (isVariableBinding(segments.get(index))) {\n       index -= 2;\n     } else {\n       index--;\n     }\n-    if (index < 0) {\n-      return \"\";\n-    }\n+    Preconditions.checkArgument(\n+        index >= -1, \"malformatted pattern, can't calculate parent: %s\", pattern);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08bf511a9d4b48b8120c31ce3f6cdc03b1012e1"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69551f73e130f36740a8d5ffd888e9d105b2a54d", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/69551f73e130f36740a8d5ffd888e9d105b2a54d", "committedDate": "2020-03-30T20:00:59Z", "message": "check *"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTk1NTI5", "url": "https://github.com/googleapis/gapic-generator/pull/3151#pullrequestreview-384195529", "createdAt": "2020-03-30T20:15:04Z", "commit": {"oid": "69551f73e130f36740a8d5ffd888e9d105b2a54d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2886352b9e454a3c25d43182a740399ba32a6cd", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/f2886352b9e454a3c25d43182a740399ba32a6cd", "committedDate": "2020-03-30T20:32:11Z", "message": "Merge branch 'master' into dialogflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b44adfb095680f23510228569a88f4b827c5383b", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/b44adfb095680f23510228569a88f4b827c5383b", "committedDate": "2020-03-30T21:04:39Z", "message": "regenerate baseline"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1378, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}