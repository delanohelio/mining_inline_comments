{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTg2MTQw", "number": 3163, "title": "feat: support '*' in resource definition", "bodyText": "This is to support Asset.\nIf referencing a resource with only one * pattern, treats it the same as resource_reference.type = \"*\". That is, do not generate any resource name class for it, and use ResourceName interface on the client surface.", "createdAt": "2020-04-07T01:23:46Z", "url": "https://github.com/googleapis/gapic-generator/pull/3163", "merged": true, "mergeCommit": {"oid": "9f1bca829a335ed9cbb2988055d678500d0d0098"}, "closed": true, "closedAt": "2020-04-08T17:55:45Z", "author": {"login": "yihanzhen"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVI5oigH2gAyMzk5OTg2MTQwOmNjOWZjMWI4NDM3MWI2NjAxNjQzZjM0MjVmY2NkNzk2YjRhZDkyZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVh5vxAFqTM4OTY4MzQxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc9fc1b84371b6601643f3425fccd796b4ad92f3", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/cc9fc1b84371b6601643f3425fccd796b4ad92f3", "committedDate": "2020-04-07T01:20:41Z", "message": "any resource name in resource definition annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74feb00d6b94ff04fed06c784bfcd826529246b3", "author": {"user": {"login": "yihanzhen", "name": "Hanzhen Yi"}}, "url": "https://github.com/googleapis/gapic-generator/commit/74feb00d6b94ff04fed06c784bfcd826529246b3", "committedDate": "2020-04-07T01:24:55Z", "message": "remove comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Nzk0ODEw", "url": "https://github.com/googleapis/gapic-generator/pull/3163#pullrequestreview-388794810", "createdAt": "2020-04-07T05:32:00Z", "commit": {"oid": "74feb00d6b94ff04fed06c784bfcd826529246b3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NjgzNDE5", "url": "https://github.com/googleapis/gapic-generator/pull/3163#pullrequestreview-389683419", "createdAt": "2020-04-08T06:27:22Z", "commit": {"oid": "74feb00d6b94ff04fed06c784bfcd826529246b3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjoyNzoyMlrOGCgsHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjoyNzoyMlrOGCgsHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI4NTkxOA==", "bodyText": "I think it might be clearer to move the earlier put call to an else block - so that every branch of this switch statement calls fieldEntityMap.put exactly once. (You could even extract this to a method which just returns \"the value to put in the map\" so you only have a single fieldEntityMap.put call.)", "url": "https://github.com/googleapis/gapic-generator/pull/3163#discussion_r405285918", "createdAt": "2020-04-08T06:27:22Z", "author": {"login": "jskeet"}, "path": "src/main/java/com/google/api/codegen/config/ResourceNameMessageConfigs.java", "diffHunk": "@@ -134,36 +140,40 @@ private static void loadFieldEntityPairFromResourceReferenceAnnotation(\n           \"Only one of child_type and type should be set: %s\",\n           field);\n \n-      if (!childType.isEmpty()) {\n-        List<ResourceDescriptorConfig> parents =\n-            childParentResourceMap.getOrDefault(childType, Collections.emptyList());\n-        for (ResourceDescriptorConfig parentResourceDescriptor : parents) {\n-          String derivedEntityName = parentResourceDescriptor.getDerivedEntityName();\n-          ResourceNameConfig parentResource = resourceNameConfigs.get(derivedEntityName);\n-          Preconditions.checkArgument(\n-              parentResource != null, \"Referencing non-existing parent resource: %s\", childType);\n-          fieldEntityMap.put(field.getSimpleName(), parentResource.getEntityId());\n-        }\n+      if (type.equals(\"*\") || childType.equals(\"*\")) {\n+        fieldEntityMap.put(field.getSimpleName(), \"*\");\n         continue;\n       }\n \n-      if (type.equals(\"*\")) {\n-        fieldEntityMap.put(field.getSimpleName(), \"*\");\n-        continue;\n+      List<ResourceDescriptorConfig> referencedResources;\n+      if (!childType.isEmpty()) {\n+        referencedResources = childParentResourceMap.get(childType);\n+      } else {\n+        referencedResources = Collections.singletonList(descriptorConfigMap.get(type));\n       }\n \n-      String unqualifiedResourceType = ResourceDescriptorConfig.getUnqualifiedTypeName(type);\n-      ResourceNameConfig resourceNameConfig =\n-          resourceNameConfigs.get(unqualifiedResourceType + \"Oneof\");\n-      if (resourceNameConfig != null\n-          && resourceNameConfig.getResourceNameType() == ResourceNameType.ONEOF) {\n-        fieldEntityMap.put(field.getSimpleName(), unqualifiedResourceType + \"Oneof\");\n-        continue;\n+      for (ResourceDescriptorConfig descriptor : referencedResources) {\n+        String unqualifiedName = descriptor.getDerivedEntityName();\n+        ResourceNameConfig resource = resourceNameConfigs.get(unqualifiedName);\n+\n+        switch (resource.getResourceNameType()) {\n+          case ANY:\n+            fieldEntityMap.put(field.getSimpleName(), \"*\");\n+            break;\n+          case SINGLE:\n+            fieldEntityMap.put(field.getSimpleName(), unqualifiedName);\n+            break;\n+          case ONEOF:\n+            fieldEntityMap.put(field.getSimpleName(), unqualifiedName);\n+            if (((ResourceNameOneofConfig) resource).hasAnyResourceNamePattern()) {\n+              fieldEntityMap.put(field.getSimpleName(), \"*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74feb00d6b94ff04fed06c784bfcd826529246b3"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1387, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}