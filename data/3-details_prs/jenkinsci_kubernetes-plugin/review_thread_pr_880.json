{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDE1MTUw", "number": 880, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNzoyMzo0NFrOE1UtGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzoyNTo0N1rOE2FcCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MzQ5MjExOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStepExecution.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNzoyMzo0NFrOHtiOiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOToxNjozM1rOHul-fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwODc0NA==", "bodyText": "Will this fail the build if the cloud is not found? Is that the desired affect? I guess it would alert the user of an issue.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/880#discussion_r517508744", "createdAt": "2020-11-04T17:23:44Z", "author": {"login": "cwholmes"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStepExecution.java", "diffHunk": "@@ -253,21 +253,10 @@ private PodTemplateCallback(PodTemplate podTemplate) {\n          * Remove the template after step is done\n          */\n         protected void finished(StepContext context) throws Exception {\n-            Cloud cloud = Jenkins.get().getCloud(cloudName);\n-            if (cloud == null) {\n-                LOGGER.log(Level.FINE, \"Cloud {0} no longer exists, cannot delete pod template {1}\",\n-                        new Object[] { cloudName, podTemplate.getName() });\n-                return;\n-            }\n-            if (cloud instanceof KubernetesCloud) {\n-                LOGGER.log(Level.FINE, \"Removing pod template {1} from cloud {0}\",\n-                        new Object[] { cloud.name, podTemplate.getName() });\n-                KubernetesCloud kubernetesCloud = (KubernetesCloud) cloud;\n-                kubernetesCloud.removeDynamicTemplate(podTemplate);\n-            } else {\n-                LOGGER.log(Level.WARNING, \"Cloud is not a KubernetesCloud: {0} {1}\",\n-                        new String[] { cloud.name, cloud.getClass().getName() });\n-            }\n+            KubernetesCloud cloud = resolveCloud();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cb6d4a7ea2a968af917ceff29e4cd94edd7a33b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxODc0OA==", "bodyText": "This would happen only if the cloud is removed while running the step. I guess it is highly unlikely to happen (unless you're actively changing the instance configuration, and in that case it wouldn't be unexpected to see some jobs failing as a result of removing the kubernetes cloud).", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/880#discussion_r518618748", "createdAt": "2020-11-06T09:16:33Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStepExecution.java", "diffHunk": "@@ -253,21 +253,10 @@ private PodTemplateCallback(PodTemplate podTemplate) {\n          * Remove the template after step is done\n          */\n         protected void finished(StepContext context) throws Exception {\n-            Cloud cloud = Jenkins.get().getCloud(cloudName);\n-            if (cloud == null) {\n-                LOGGER.log(Level.FINE, \"Cloud {0} no longer exists, cannot delete pod template {1}\",\n-                        new Object[] { cloudName, podTemplate.getName() });\n-                return;\n-            }\n-            if (cloud instanceof KubernetesCloud) {\n-                LOGGER.log(Level.FINE, \"Removing pod template {1} from cloud {0}\",\n-                        new Object[] { cloud.name, podTemplate.getName() });\n-                KubernetesCloud kubernetesCloud = (KubernetesCloud) cloud;\n-                kubernetesCloud.removeDynamicTemplate(podTemplate);\n-            } else {\n-                LOGGER.log(Level.WARNING, \"Cloud is not a KubernetesCloud: {0} {1}\",\n-                        new String[] { cloud.name, cloud.getClass().getName() });\n-            }\n+            KubernetesCloud cloud = resolveCloud();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwODc0NA=="}, "originalCommit": {"oid": "1cb6d4a7ea2a968af917ceff29e4cd94edd7a33b"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTQ3NjU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStepExecution.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzoyNTo0N1rOHut63w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzoyNzoxMlrOHut95g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc0ODg5NQ==", "bodyText": "Is it a good idea to mute this exception?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/880#discussion_r518748895", "createdAt": "2020-11-06T13:25:47Z", "author": {"login": "twasyl"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStepExecution.java", "diffHunk": "@@ -253,20 +253,13 @@ private PodTemplateCallback(PodTemplate podTemplate) {\n          * Remove the template after step is done\n          */\n         protected void finished(StepContext context) throws Exception {\n-            Cloud cloud = Jenkins.get().getCloud(cloudName);\n-            if (cloud == null) {\n-                LOGGER.log(Level.FINE, \"Cloud {0} no longer exists, cannot delete pod template {1}\",\n-                        new Object[] { cloudName, podTemplate.getName() });\n-                return;\n-            }\n-            if (cloud instanceof KubernetesCloud) {\n-                LOGGER.log(Level.FINE, \"Removing pod template {1} from cloud {0}\",\n-                        new Object[] { cloud.name, podTemplate.getName() });\n-                KubernetesCloud kubernetesCloud = (KubernetesCloud) cloud;\n-                kubernetesCloud.removeDynamicTemplate(podTemplate);\n-            } else {\n-                LOGGER.log(Level.WARNING, \"Cloud is not a KubernetesCloud: {0} {1}\",\n-                        new String[] { cloud.name, cloud.getClass().getName() });\n+            try {\n+                KubernetesCloud cloud = resolveCloud();\n+                LOGGER.log(Level.FINE, () -> \"Removing pod template \" + podTemplate.getName()\n+                        + \" from cloud \" + cloud.name);\n+                cloud.removeDynamicTemplate(podTemplate);\n+            } catch (AbortException e) {\n+                LOGGER.log(Level.WARNING, () -> \"Unable to resolve cloud for \" + podTemplate.getName() + \". Maybe the cloud was removed while running the build?\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5fd2cca51270de2e9339cac0aba917f18b8dea4"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc0OTY3MA==", "bodyText": "Already updated in be75374", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/880#discussion_r518749670", "createdAt": "2020-11-06T13:27:12Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStepExecution.java", "diffHunk": "@@ -253,20 +253,13 @@ private PodTemplateCallback(PodTemplate podTemplate) {\n          * Remove the template after step is done\n          */\n         protected void finished(StepContext context) throws Exception {\n-            Cloud cloud = Jenkins.get().getCloud(cloudName);\n-            if (cloud == null) {\n-                LOGGER.log(Level.FINE, \"Cloud {0} no longer exists, cannot delete pod template {1}\",\n-                        new Object[] { cloudName, podTemplate.getName() });\n-                return;\n-            }\n-            if (cloud instanceof KubernetesCloud) {\n-                LOGGER.log(Level.FINE, \"Removing pod template {1} from cloud {0}\",\n-                        new Object[] { cloud.name, podTemplate.getName() });\n-                KubernetesCloud kubernetesCloud = (KubernetesCloud) cloud;\n-                kubernetesCloud.removeDynamicTemplate(podTemplate);\n-            } else {\n-                LOGGER.log(Level.WARNING, \"Cloud is not a KubernetesCloud: {0} {1}\",\n-                        new String[] { cloud.name, cloud.getClass().getName() });\n+            try {\n+                KubernetesCloud cloud = resolveCloud();\n+                LOGGER.log(Level.FINE, () -> \"Removing pod template \" + podTemplate.getName()\n+                        + \" from cloud \" + cloud.name);\n+                cloud.removeDynamicTemplate(podTemplate);\n+            } catch (AbortException e) {\n+                LOGGER.log(Level.WARNING, () -> \"Unable to resolve cloud for \" + podTemplate.getName() + \". Maybe the cloud was removed while running the build?\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc0ODg5NQ=="}, "originalCommit": {"oid": "e5fd2cca51270de2e9339cac0aba917f18b8dea4"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4863, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}