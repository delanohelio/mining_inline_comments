{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NTIxMjk4", "number": 851, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNzo1OTowMVrOErfghw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NzoyOVrOE9K3Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQwNDU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNzo1OTowMVrOHeSakQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNzo1OTowMVrOHeSakQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMTA0MQ==", "bodyText": "Should use different system property name.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r501521041", "createdAt": "2020-10-08T07:59:01Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -103,6 +103,11 @@\n     static final String DEFAULT_JNLP_CONTAINER_CPU_REQUEST = System\n             .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultCpuRequest\", \"100m\");\n \n+    static final String DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT = System\n+            .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultMemoryRequest\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff007a722bee7f3beea535aba2ed60b1c44f97e1"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQwNjA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNzo1OToyNlrOHeSbgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNzoxMDo0OVrOH5lvnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMTI4Mg==", "bodyText": "This is wrong. It is overriding the default request since you're starting from an empty ContainerBuilder.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r501521282", "createdAt": "2020-10-08T07:59:26Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -261,6 +266,14 @@ public Pod build() {\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n             jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            if (DEFAULT_JNLP_CONTAINER_CPU_LIMIT!=null) {\n+                jnlp.setResources(new ContainerBuilder().editOrNewResources().addToLimits(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_LIMIT)).endResources().build().getResources());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff007a722bee7f3beea535aba2ed60b1c44f97e1"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE0OTI3Nw==", "bodyText": "fix", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r530149277", "createdAt": "2020-11-25T07:10:49Z", "author": {"login": "KrapivinAndrey"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -261,6 +266,14 @@ public Pod build() {\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n             jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            if (DEFAULT_JNLP_CONTAINER_CPU_LIMIT!=null) {\n+                jnlp.setResources(new ContainerBuilder().editOrNewResources().addToLimits(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_LIMIT)).endResources().build().getResources());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMTI4Mg=="}, "originalCommit": {"oid": "ff007a722bee7f3beea535aba2ed60b1c44f97e1"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDA4MzEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQxODoxODoyNFrOHzh0Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwNzoxNzo1M1rOHzqgQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5MzQyNg==", "bodyText": "Probably don't need to have a call to editOrNewResources for each request/limit.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        containerBuilder = new ContainerBuilder();\n          \n          \n            \n                        ResourcesNested<ContainerBuilder> containerResources = new ContainerBuilder().editOrNewResources();", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r523793426", "createdAt": "2020-11-15T18:18:24Z", "author": {"login": "cwholmes"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -260,7 +265,20 @@ public Pod build() {\n         envVars.putAll(jnlp.getEnv().stream().collect(Collectors.toMap(EnvVar::getName, Function.identity())));\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n-            jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            containerBuilder = new ContainerBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e936579c4dede0666e1bdc2ef89202f38ecd9be6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzkzNTgxMA==", "bodyText": "fix", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r523935810", "createdAt": "2020-11-16T07:17:53Z", "author": {"login": "KrapivinAndrey"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -260,7 +265,20 @@ public Pod build() {\n         envVars.putAll(jnlp.getEnv().stream().collect(Collectors.toMap(EnvVar::getName, Function.identity())));\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n-            jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            containerBuilder = new ContainerBuilder();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5MzQyNg=="}, "originalCommit": {"oid": "e936579c4dede0666e1bdc2ef89202f38ecd9be6"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDA4NDE1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQxODoxOToyNVrOHzh0gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwNzoxNzo1N1rOHzqgaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5MzUzOQ==", "bodyText": "The endResourcesMethod is on the ResourcesNested class and not the ContainerBuilerClass. The suggestion above will probably help with what this line is trying to do.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r523793539", "createdAt": "2020-11-15T18:19:25Z", "author": {"login": "cwholmes"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -260,7 +265,20 @@ public Pod build() {\n         envVars.putAll(jnlp.getEnv().stream().collect(Collectors.toMap(EnvVar::getName, Function.identity())));\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n-            jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            containerBuilder = new ContainerBuilder();\n+            containerBuilder.editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST));\n+\n+            if (DEFAULT_JNLP_CONTAINER_CPU_LIMIT!=null) {\n+                containerBuilder.editOrNewResources().addToLimits(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_LIMIT));\n+            }\n+\n+            if (DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT!=null) {\n+                containerBuilder.editOrNewResources().addToLimits(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT))\n+            }\n+\n+            jnlp.setResources(containerBuilder.endResources().build().getResources());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e936579c4dede0666e1bdc2ef89202f38ecd9be6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzkzNTg0OQ==", "bodyText": "fix", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r523935849", "createdAt": "2020-11-16T07:17:57Z", "author": {"login": "KrapivinAndrey"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -260,7 +265,20 @@ public Pod build() {\n         envVars.putAll(jnlp.getEnv().stream().collect(Collectors.toMap(EnvVar::getName, Function.identity())));\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n-            jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            containerBuilder = new ContainerBuilder();\n+            containerBuilder.editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST));\n+\n+            if (DEFAULT_JNLP_CONTAINER_CPU_LIMIT!=null) {\n+                containerBuilder.editOrNewResources().addToLimits(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_LIMIT));\n+            }\n+\n+            if (DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT!=null) {\n+                containerBuilder.editOrNewResources().addToLimits(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT))\n+            }\n+\n+            jnlp.setResources(containerBuilder.endResources().build().getResources());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5MzUzOQ=="}, "originalCommit": {"oid": "e936579c4dede0666e1bdc2ef89202f38ecd9be6"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNTc1MDk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NDowM1rOH5tc4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NDowM1rOH5tc4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI3NTU1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultMemoryLimit\", null);\n          \n          \n            \n                        .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultMemoryLimit\");", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r530275554", "createdAt": "2020-11-25T10:44:03Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -103,6 +104,11 @@\n     static final String DEFAULT_JNLP_CONTAINER_CPU_REQUEST = System\n             .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultCpuRequest\", \"100m\");\n \n+    static final String DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT = System\n+            .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultMemoryLimit\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b2ff34a507f8b8c963cd841bddeadc4b1f215c9"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNTc1MTYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NDoxMlrOH5tdPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NDoxMlrOH5tdPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI3NTY0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultCpuLimit\", null);\n          \n          \n            \n                        .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultCpuLimit\");", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r530275646", "createdAt": "2020-11-25T10:44:12Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -103,6 +104,11 @@\n     static final String DEFAULT_JNLP_CONTAINER_CPU_REQUEST = System\n             .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultCpuRequest\", \"100m\");\n \n+    static final String DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT = System\n+            .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultMemoryLimit\", null);\n+    static final String DEFAULT_JNLP_CONTAINER_CPU_LIMIT = System\n+            .getProperty(PodTemplateStepExecution.class.getName() + \".defaultContainer.defaultCpuLimit\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b2ff34a507f8b8c963cd841bddeadc4b1f215c9"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNTc2NTE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NzoyOVrOH5tlXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMDo0NzoyOVrOH5tlXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI3NzcyNQ==", "bodyText": "Can be simplified by using new ResourceRequirementsBuilder()", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/851#discussion_r530277725", "createdAt": "2020-11-25T10:47:29Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -260,7 +266,20 @@ public Pod build() {\n         envVars.putAll(jnlp.getEnv().stream().collect(Collectors.toMap(EnvVar::getName, Function.identity())));\n         jnlp.setEnv(new ArrayList<>(envVars.values()));\n         if (jnlp.getResources() == null) {\n-            jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST)).endResources().build().getResources());\n+\n+            ResourcesNested<ContainerBuilder> containerBuilder = new ContainerBuilder().withNewResources();\n+            containerBuilder.addToRequests(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_REQUEST)).addToRequests(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_REQUEST));\n+\n+            if (DEFAULT_JNLP_CONTAINER_CPU_LIMIT!=null) {\n+                containerBuilder.addToLimits(\"cpu\", new Quantity(DEFAULT_JNLP_CONTAINER_CPU_LIMIT));\n+            }\n+\n+            if (DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT!=null) {\n+                containerBuilder.addToLimits(\"memory\", new Quantity(DEFAULT_JNLP_CONTAINER_MEMORY_LIMIT));\n+            }\n+\n+            jnlp.setResources(containerBuilder.endResources().build().getResources());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b2ff34a507f8b8c963cd841bddeadc4b1f215c9"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4834, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}