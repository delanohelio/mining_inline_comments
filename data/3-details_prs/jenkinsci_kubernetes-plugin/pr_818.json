{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3ODQzNDg2", "number": 818, "title": "[JENKINS-59690] Fix: allow multiple labels also in Jenkinsfile", "bodyText": "[JENKINS-51248] introduced a check for valid labels\n[JENKINS-60537] added a sanitizer for labels which makes the check not necessary anymore\ncombining the strategies and instead of putting the whole label string into one pod label, put each label atom into a separate pod label to get rid of the limitation to a single label when creating the pod template in a Jenkinsfile", "createdAt": "2020-08-14T08:17:49Z", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/818", "merged": true, "mergeCommit": {"oid": "cc647dfd48dfb7a545f8bdff91adb089ef9821d5"}, "closed": true, "closedAt": "2020-08-20T09:31:53Z", "author": {"login": "scddev"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_ucO_gFqTQ2ODI3NzY2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAXxTLAFqTQ3MDI2MDI1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4Mjc3NjY2", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/818#pullrequestreview-468277666", "createdAt": "2020-08-17T08:45:24Z", "commit": {"oid": "c0702a45eb6a113f3927fa44cea3306acb1dbb94"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwODo0NToyNFrOHBfzTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwODo0NToyNFrOHBfzTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMzMTY2Mw==", "bodyText": "Would effectively revert JENKINS-60088\nExposed labels in Kubernetes have no effect on the Jenkins labels. I would recommend reverting this hunk.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/818#discussion_r471331663", "createdAt": "2020-08-17T08:45:24Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplate.java", "diffHunk": "@@ -395,7 +396,16 @@ public String getActiveDeadlineSecondsStr() {\n     }\n \n     public Map<String, String> getLabelsMap() {\n-        return ImmutableMap.of(\"jenkins/label\", label == null ? DEFAULT_LABEL : sanitizeLabel(label));\n+        if(label == null) {\n+            return ImmutableMap.of(\"jenkins/\" + DEFAULT_LABEL, \"true\");\n+        }\n+\n+        ImmutableMap.Builder<String, String> builder = ImmutableMap.builder();\n+        getLabelSet().stream().map(Objects::toString).sorted().forEach((atom) -> {\n+            builder.put(\"jenkins/\" + sanitizeLabel(atom), \"true\");\n+        });\n+\n+        return builder.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0702a45eb6a113f3927fa44cea3306acb1dbb94"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae4c4fc220e94cbcfff534dfb02a1fdbc67c2293", "author": {"user": {"login": "scddev", "name": "Dietmar Scheidl"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/ae4c4fc220e94cbcfff534dfb02a1fdbc67c2293", "committedDate": "2020-08-17T15:27:22Z", "message": "[JENKINS-59690] fix: allow multiple labels also in Jenkinsfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dcd7cc9146b51c0ef439a83e58b815e923bf7be", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/6dcd7cc9146b51c0ef439a83e58b815e923bf7be", "committedDate": "2020-08-19T08:06:59Z", "message": "Add tests\n\n* Sort labels in KubernetesDeclarativeAgent#getLabelExpression for consistent output\n* Check node label in declarative\n* Switch hash function to sha1 (40 chars) and put in constant.\n* Rename \"jenkins/label-md5\" to \"jenkins/label-digest\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjYwMjUz", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/818#pullrequestreview-470260253", "createdAt": "2020-08-19T08:58:54Z", "commit": {"oid": "6dcd7cc9146b51c0ef439a83e58b815e923bf7be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 148, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}