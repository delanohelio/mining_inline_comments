{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDcyNjk4", "number": 915, "title": "[JENKINS-57841] Change defaults for command and args", "bodyText": "Changing defaults for command and args in Container Template. Document Windows defaults in the help.\nTicket: JENKINS-57841", "createdAt": "2020-12-09T21:22:14Z", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915", "merged": true, "mergeCommit": {"oid": "e10afe45b1078698b5c53433ddfdb159441d5f7e"}, "closed": true, "closedAt": "2020-12-23T09:21:01Z", "author": {"login": "kerogers-cloudbees"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdklfIaAH2gAyNTM1NDcyNjk4OmNlNzNlZjU3Y2ViNWYwYjExNjk0OTYyZjg3NWQ2NjFkNGVlYzkzMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd5dQuZAFqTU4OTY4NDEwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302", "author": {"user": {"login": "kerogers-cloudbees", "name": "Kenneth Rogers"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/ce73ef57ceb5f0b11694962f875d661d4eec9302", "committedDate": "2020-12-09T21:19:00Z", "message": "[JENKINS-57841] Change defaults for command and args for Container Template. Document Windows defaults in the help."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NjIxNzQ2", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#pullrequestreview-548621746", "createdAt": "2020-12-09T21:24:26Z", "commit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMToyNDoyNlrOICqJvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMToyODoxNVrOICqSvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY1ODY4NA==", "bodyText": "Uh, why?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r539658684", "createdAt": "2020-12-09T21:24:26Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate.java", "diffHunk": "@@ -133,17 +135,19 @@ public void setCommand(String command) {\n         this.command = command;\n     }\n \n+    @CheckForNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY1ODc0Ng==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r539658746", "createdAt": "2020-12-09T21:24:34Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate.java", "diffHunk": "@@ -133,17 +135,19 @@ public void setCommand(String command) {\n         this.command = command;\n     }\n \n+    @CheckForNull\n     public String getCommand() {\n-        return command;\n+        return this.command == null ? DescriptorImpl.defaultCommand : this.command;\n     }\n \n     @DataBoundSetter\n     public void setArgs(String args) {\n         this.args = args;\n     }\n \n+    @CheckForNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY1OTU2OA==", "bodyText": "Change the default to be false in this case. The only reason for tty: true was to pair with cat. IOW\ncat\nwith no input, but with a TTY (so no EOF), is just an idiom for sleeping.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r539659568", "createdAt": "2020-12-09T21:25:55Z", "author": {"login": "jglick"}, "path": "src/main/resources/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate/config.jelly", "diffHunk": "@@ -23,11 +23,11 @@\n   </f:entry>\n \n   <f:entry field=\"command\" title=\"${%Command to run}\">\n-    <f:textbox default=\"/bin/sh -c\"/>\n+    <f:textbox default=\"${descriptor.defaultCommand}\"/>\n   </f:entry>\n \n   <f:entry field=\"args\" title=\"${%Arguments to pass to the command}\">\n-    <f:textbox default=\"cat\"/>\n+    <f:textbox default=\"${descriptor.defaultArgs}\"/>\n   </f:entry>\n \n   <f:entry field=\"ttyEnabled\" title=\"${%Allocate pseudo-TTY}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2MDIwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <p>For Windows containers 'powershell' is a good default.</p>\n          \n          \n            \n            <p>For Windows containers <code>powershell</code> is a good default.</p>", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r539660209", "createdAt": "2020-12-09T21:26:59Z", "author": {"login": "jglick"}, "path": "src/main/resources/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate/help-command.html", "diffHunk": "@@ -1 +1,2 @@\n-Override the image entrypoint with a different one\n\\ No newline at end of file\n+<p>Override the image entrypoint with a different one.</p>\n+<p>For Windows containers 'powershell' is a good default.</p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2MDk4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <p>For Windows containers the args [\"Start-Sleep\", \"999999\"] are reasonable choices to go with powershell.</p>\n          \n          \n            \n            <p>For Windows containers the args <code>Start-Sleep 999999</code> are reasonable choices to go with <code>powershell</code>.</p>\n          \n      \n    \n    \n  \n\nI guess? The field is of type String not List<String>.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r539660988", "createdAt": "2020-12-09T21:28:15Z", "author": {"login": "jglick"}, "path": "src/main/resources/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate/help-args.html", "diffHunk": "@@ -1,2 +1,3 @@\n-Arguments to pass to the command. \n-${computer.jnlpmac} and ${computer.name} are replaced with the agent secret and name respectively. \n+<p>Arguments to pass to the command.</p>\n+<p>${computer.jnlpmac} and ${computer.name} are replaced with the agent secret and name respectively.</p>\n+<p>For Windows containers the args [\"Start-Sleep\", \"999999\"] are reasonable choices to go with powershell.</p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NjMwOTM1", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#pullrequestreview-548630935", "createdAt": "2020-12-09T21:37:30Z", "commit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMTozNzozMFrOICqo9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMTozNzozMFrOICqo9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2NjY3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public final static String defaultCommand = \"sleep\";\n          \n          \n            \n                    public final static String defaultArgs = \"9999999\";\n          \n          \n            \n                    public final static String DEFAULT_COMMAND = \"sleep\";\n          \n          \n            \n                    public final static String DEFAULT_ARGS = \"9999999\";\n          \n      \n    \n    \n  \n\nCustomary to use all caps for static final vars (constants). Not sure if Jelly has different rules..", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r539666678", "createdAt": "2020-12-09T21:37:30Z", "author": {"login": "schottsfired"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate.java", "diffHunk": "@@ -350,6 +354,8 @@ public FormValidation doCheckImage(@QueryParameter String value) {\n         public String getWorkingDir() {\n             return DEFAULT_WORKING_DIR;\n         }\n+        public final static String defaultCommand = \"sleep\";\n+        public final static String defaultArgs = \"9999999\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce73ef57ceb5f0b11694962f875d661d4eec9302"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179775fe7396953bca238217333f9fcebf0e0a1d", "author": {"user": {"login": "kerogers-cloudbees", "name": "Kenneth Rogers"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/179775fe7396953bca238217333f9fcebf0e0a1d", "committedDate": "2020-12-09T21:40:13Z", "message": "[JENKINS-57841] changes from review. more to come."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6add077c9527694d8493d3bc596c2d0f299b49f4", "author": {"user": {"login": "kerogers-cloudbees", "name": "Kenneth Rogers"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/6add077c9527694d8493d3bc596c2d0f299b49f4", "committedDate": "2020-12-09T21:46:57Z", "message": "[JENKINS-57841] Use the normal java style conventions for final static strings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d363c50fcf92a9f097a9a2e13f7bce0202b06bfc", "author": {"user": {"login": "kerogers-cloudbees", "name": "Kenneth Rogers"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/d363c50fcf92a9f097a9a2e13f7bce0202b06bfc", "committedDate": "2020-12-10T16:18:21Z", "message": "[JENKINS-57841] Reverting the defaults out of the java class. Changing the defaults in the jelly file. Also updating the examples to reflect the changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDA5Mzky", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#pullrequestreview-549409392", "createdAt": "2020-12-10T16:59:22Z", "commit": {"oid": "d363c50fcf92a9f097a9a2e13f7bce0202b06bfc"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNjo1OToyMlrOIDTlDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzowMToxNVrOIDTqtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMzNzQyMw==", "bodyText": "Do we want to be consistent?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                command: ['sleep']\n          \n          \n            \n                args: ['9999999']\n          \n          \n            \n                command:\n          \n          \n            \n                - sleep\n          \n          \n            \n                args:\n          \n          \n            \n                - 9999999", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r540337423", "createdAt": "2020-12-10T16:59:22Z", "author": {"login": "jglick"}, "path": "examples/multi-container.groovy", "diffHunk": "@@ -13,8 +13,8 @@ spec:\n     tty: true\n   - name: golang\n     image: golang:1.8.0\n-    command: ['cat']\n-    tty: true\n+    command: ['sleep']\n+    args: ['9999999']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d363c50fcf92a9f097a9a2e13f7bce0202b06bfc"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMzODA1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ttyEnabled false\n          \n      \n    \n    \n  \n\nsince the default if false right?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r540338053", "createdAt": "2020-12-10T17:00:12Z", "author": {"login": "jglick"}, "path": "src/test/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline/declarative.groovy", "diffHunk": "@@ -5,8 +5,9 @@ pipeline {\n       containerTemplate {\n         name 'maven'\n         image 'maven:3.3.9-jdk-8-alpine'\n-        ttyEnabled true\n-        command 'cat'\n+        ttyEnabled false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d363c50fcf92a9f097a9a2e13f7bce0202b06bfc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMzODg3MQ==", "bodyText": "just\ngit checkout master -- src/main/java/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate.java\nto revert irrelevant changes", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r540338871", "createdAt": "2020-12-10T17:01:15Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate.java", "diffHunk": "@@ -1,31 +1,29 @@\n package org.csanchez.jenkins.plugins.kubernetes;\n \n-import java.io.Serializable;\n-import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.TreeMap;\n-\n-import org.apache.commons.lang.StringUtils;\n-import org.csanchez.jenkins.plugins.kubernetes.model.TemplateEnvVar;\n-import org.jenkinsci.Symbol;\n-import org.kohsuke.accmod.Restricted;\n-import org.kohsuke.accmod.restrictions.DoNotUse;\n-import org.kohsuke.stapler.DataBoundConstructor;\n-import org.kohsuke.stapler.DataBoundSetter;\n-\n import com.google.common.base.Preconditions;\n-\n import hudson.Extension;\n import hudson.Util;\n import hudson.model.AbstractDescribableImpl;\n import hudson.model.Descriptor;\n import hudson.model.DescriptorVisibilityFilter;\n import hudson.util.FormValidation;\n import jenkins.model.Jenkins;\n+import org.apache.commons.lang.StringUtils;\n+import org.csanchez.jenkins.plugins.kubernetes.model.TemplateEnvVar;\n+import org.jenkinsci.Symbol;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.DoNotUse;\n+import org.kohsuke.stapler.DataBoundConstructor;\n+import org.kohsuke.stapler.DataBoundSetter;\n import org.kohsuke.stapler.QueryParameter;\n \n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.TreeMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d363c50fcf92a9f097a9a2e13f7bce0202b06bfc"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4468f33f96bb96e7fd11932b52ca390461d6632c", "author": {"user": {"login": "kerogers-cloudbees", "name": "Kenneth Rogers"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/4468f33f96bb96e7fd11932b52ca390461d6632c", "committedDate": "2020-12-10T18:27:04Z", "message": "[JENKINS-57841] reverting irrelevant changes to ContainerTemplate.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8065f2828cb5fcc38bac0d31cf99cb0fa398b06b", "author": {"user": {"login": "kerogers-cloudbees", "name": "Kenneth Rogers"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/8065f2828cb5fcc38bac0d31cf99cb0fa398b06b", "committedDate": "2020-12-10T18:31:39Z", "message": "[JENKINS-57841] Make yaml more consistent. remove unnecessary properties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9d98ce96c7c39ec9b3325c13fe460146433c35a", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/a9d98ce96c7c39ec9b3325c13fe460146433c35a", "committedDate": "2020-12-23T09:20:10Z", "message": "Fixup args inline help"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NzQyMjky", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#pullrequestreview-557742292", "createdAt": "2020-12-23T09:20:53Z", "commit": {"oid": "a9d98ce96c7c39ec9b3325c13fe460146433c35a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg5Njg0MTA2", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#pullrequestreview-589684106", "createdAt": "2021-02-12T17:36:26Z", "commit": {"oid": "a9d98ce96c7c39ec9b3325c13fe460146433c35a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMlQxNzozNjoyNlrOIkvCKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMlQxNzozNjoyNlrOIkvCKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTM5MDI0OA==", "bodyText": "typo: does talse evaluate to false anyway?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/915#discussion_r575390248", "createdAt": "2021-02-12T17:36:26Z", "author": {"login": "sbeaulie"}, "path": "src/main/resources/org/csanchez/jenkins/plugins/kubernetes/ContainerTemplate/config.jelly", "diffHunk": "@@ -23,15 +23,15 @@\n   </f:entry>\n \n   <f:entry field=\"command\" title=\"${%Command to run}\">\n-    <f:textbox default=\"/bin/sh -c\"/>\n+    <f:textbox default=\"sleep\"/>\n   </f:entry>\n \n   <f:entry field=\"args\" title=\"${%Arguments to pass to the command}\">\n-    <f:textbox default=\"cat\"/>\n+    <f:textbox default=\"9999999\"/>\n   </f:entry>\n \n   <f:entry field=\"ttyEnabled\" title=\"${%Allocate pseudo-TTY}\">\n-    <f:checkbox default=\"true\"/>\n+    <f:checkbox default=\"talse\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9d98ce96c7c39ec9b3325c13fe460146433c35a"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 75, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}