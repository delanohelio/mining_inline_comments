{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NTIzOTYy", "number": 830, "title": "Update DinD Example", "bodyText": "Supersedes #829.\nAs per the comments in #581 (comment), the environment variable which allows containers to connect over TCP will not work without TLS in future versions of docker.\nSo the example has been updated to use /var/run(/docker.sock) instead of TCP.\nNote: /var/run is used instead of /var/run/docker.sock because docker.sock is a file and emptyDir is a directory, so if /docker.sock is used, the daemon fails to start with an error:\n\nfailed to load listeners: can't create unix socket /var/run/docker.sock: is a directory", "createdAt": "2020-08-31T20:29:33Z", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/830", "merged": true, "mergeCommit": {"oid": "909bfbbe98d37ad777135eaedc4e644aced048b4"}, "closed": true, "closedAt": "2020-09-01T08:24:54Z", "author": {"login": "schottsfired"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdET3VTAH2gAyNDc2NTIzOTYyOjkzZjdmODVlZjc4OTYwYTI2MDViMDFlZmExZmExMDZjN2EzOGE3YjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEjEvJgFqTQ3OTUxMDE3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "93f7f85ef78960a2605b01efa1fa106c7a38a7b2", "author": {"user": {"login": "schottsfired", "name": "David B. Schott"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/93f7f85ef78960a2605b01efa1fa106c7a38a7b2", "committedDate": "2020-08-31T14:41:34Z", "message": "fix: the command needs to know which Dockerfile to build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc2db616dea325c819ba853a2164dd1773a2e70", "author": {"user": {"login": "schottsfired", "name": "David B. Schott"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/cfc2db616dea325c819ba853a2164dd1773a2e70", "committedDate": "2020-08-31T19:56:42Z", "message": "use writeFile instead of git"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab2199402d73bfa67b6e1378f97a18168fcd1014", "author": {"user": {"login": "schottsfired", "name": "David B. Schott"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/ab2199402d73bfa67b6e1378f97a18168fcd1014", "committedDate": "2020-08-31T20:21:35Z", "message": "prefer sharing a volume over using tls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTM3Mjk4", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/830#pullrequestreview-478937298", "createdAt": "2020-08-31T20:38:17Z", "commit": {"oid": "ab2199402d73bfa67b6e1378f97a18168fcd1014"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDozODoxOFrOHKIaNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDozODoxOFrOHKIaNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM4NTU4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    writeFile encoding: 'UTF-8', file: 'Dockerfile', text: 'FROM scratch'\n          \n          \n            \n                    writeFile file: 'Dockerfile', text: 'FROM scratch'\n          \n      \n    \n    \n  \n\nunnecessary", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/830#discussion_r480385589", "createdAt": "2020-08-31T20:38:18Z", "author": {"login": "jglick"}, "path": "examples/dind.groovy", "diffHunk": "@@ -10,26 +10,29 @@ podTemplate(yaml: '''\n apiVersion: v1\n kind: Pod\n spec:\n+  volumes:\n+  - name: docker-socket\n+    emptyDir: {}\n   containers:\n   - name: docker\n     image: docker:19.03.1\n     command:\n     - sleep\n     args:\n     - 99d\n-    env:\n-      - name: DOCKER_HOST\n-        value: tcp://localhost:2375\n+    volumeMounts:\n+    - name: docker-socket\n+      mountPath: /var/run\n   - name: docker-daemon\n     image: docker:19.03.1-dind\n     securityContext:\n       privileged: true\n-    env:\n-      - name: DOCKER_TLS_CERTDIR\n-        value: \"\"\n+    volumeMounts:\n+    - name: docker-socket\n+      mountPath: /var/run\n ''') {\n     node(POD_LABEL) {\n-        git 'https://github.com/jenkinsci/docker-jnlp-slave.git'\n+        writeFile encoding: 'UTF-8', file: 'Dockerfile', text: 'FROM scratch'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab2199402d73bfa67b6e1378f97a18168fcd1014"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b8c2156bcdef333c8a3cdfbab87ea80e101dfd5", "author": {"user": {"login": "schottsfired", "name": "David B. Schott"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/1b8c2156bcdef333c8a3cdfbab87ea80e101dfd5", "committedDate": "2020-08-31T20:40:15Z", "message": "Update examples/dind.groovy\n\nCo-authored-by: Jesse Glick <jglick@cloudbees.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTQ1Mzcx", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/830#pullrequestreview-478945371", "createdAt": "2020-08-31T20:51:12Z", "commit": {"oid": "1b8c2156bcdef333c8a3cdfbab87ea80e101dfd5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTQ2OTgx", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/830#pullrequestreview-478946981", "createdAt": "2020-08-31T20:53:45Z", "commit": {"oid": "1b8c2156bcdef333c8a3cdfbab87ea80e101dfd5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTEwMTc3", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/830#pullrequestreview-479510177", "createdAt": "2020-09-01T08:24:47Z", "commit": {"oid": "1b8c2156bcdef333c8a3cdfbab87ea80e101dfd5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 159, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}