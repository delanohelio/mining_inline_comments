{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NzQwODUz", "number": 906, "title": "Pod decorator extension point", "bodyText": "Trying a replacement of some proprietary PodTemplateFilter implementations", "createdAt": "2020-11-23T13:42:26Z", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906", "merged": true, "mergeCommit": {"oid": "b32e84178c1925be6671a3a2b37b3de6dc1c5a8a"}, "closed": true, "closedAt": "2020-12-11T16:24:10Z", "author": {"login": "Vlatombe"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfVWxZAH2gAyNTI1NzQwODUzOmI3NTVlNzJlMzEwNGI3OTJmNTEyNmFhZWVlZTEyMWNmMzQ3ZGNjNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdilUS9gH2gAyNTI1NzQwODUzOjNhNmYxODc3NzExMjRhZjE3ZGJhZThmODFmNTc1NWUwNTcyNTg5YjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/b755e72e3104b792f5126aaeeee121cf347dcc72", "committedDate": "2020-11-23T13:41:46Z", "message": "Pod decorator extension point"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDk0ODEz", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#pullrequestreview-536494813", "createdAt": "2020-11-23T13:57:55Z", "commit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1Nzo1NlrOH4Oj0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1ODoxMVrOH4OkYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMDg0OQ==", "bodyText": "Just inline.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528720849", "createdAt": "2020-11-23T13:57:56Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodDecorator.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.csanchez.jenkins.plugins.kubernetes;\n+\n+import hudson.ExtensionList;\n+import hudson.ExtensionPoint;\n+import io.fabric8.kubernetes.api.model.PodBuilder;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * Allows to alter a pod definition after it has been built from the yaml and DSL/GUI configuration.\n+ */\n+public abstract class PodDecorator implements ExtensionPoint {\n+    public static ExtensionList<PodDecorator> all() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMDk5Mw==", "bodyText": "Could be an interface.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528720993", "createdAt": "2020-11-23T13:58:11Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodDecorator.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.csanchez.jenkins.plugins.kubernetes;\n+\n+import hudson.ExtensionList;\n+import hudson.ExtensionPoint;\n+import io.fabric8.kubernetes.api.model.PodBuilder;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * Allows to alter a pod definition after it has been built from the yaml and DSL/GUI configuration.\n+ */\n+public abstract class PodDecorator implements ExtensionPoint {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDk1NzUz", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#pullrequestreview-536495753", "createdAt": "2020-11-23T13:59:01Z", "commit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1OTowMlrOH4OmfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1OTowMlrOH4OmfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMTUzMw==", "bodyText": "Does this cost anything if the list is empty?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528721533", "createdAt": "2020-11-23T13:59:02Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -233,7 +233,7 @@ public Pod build() {\n         }\n \n         // merge with the yaml fragments\n-        Pod pod = combine(template.getYamlsPod(), builder.endSpec().build());\n+        Pod pod = PodDecorator.decorateAll(new PodBuilder(combine(template.getYamlsPod(), builder.endSpec().build()))).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c362ab9394b747a403de25525fb63c31962599d", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/5c362ab9394b747a403de25525fb63c31962599d", "committedDate": "2020-11-23T14:26:21Z", "message": "Fix reviews"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd56241214888daf2ed5e21291b6ec597c791140", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/dd56241214888daf2ed5e21291b6ec597c791140", "committedDate": "2020-11-23T14:28:46Z", "message": "Optimize with 0 decorators"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NTI3MjEy", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#pullrequestreview-536527212", "createdAt": "2020-11-23T14:33:27Z", "commit": {"oid": "dd56241214888daf2ed5e21291b6ec597c791140"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "595c21757fb34fcbf2d818129f0c4738c6ee2984", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/595c21757fb34fcbf2d818129f0c4738c6ee2984", "committedDate": "2020-11-24T09:50:16Z", "message": "Functional test + reference implementations\n\nExtension point only depends on Pod model, not on the builder. Some\nchanges are easier to implement only using the model, some others are\neasier using the builder."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b66d80e9fa25469362708c039dbbb03f720b54b9", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/b66d80e9fa25469362708c039dbbb03f720b54b9", "committedDate": "2020-11-24T09:53:57Z", "message": "Some comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34bf2fe51484244207fded1d91a546737ae4f1dc", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/34bf2fe51484244207fded1d91a546737ae4f1dc", "committedDate": "2020-11-24T16:24:04Z", "message": "Merge branch 'master' into poddecorator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac7b9d2b6974deaa6bccf611eee37375f9015b54", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/ac7b9d2b6974deaa6bccf611eee37375f9015b54", "committedDate": "2020-11-30T10:36:08Z", "message": "Add KubernetesCloud to signature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDY4MDQ2", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#pullrequestreview-541068046", "createdAt": "2020-11-30T16:18:50Z", "commit": {"oid": "ac7b9d2b6974deaa6bccf611eee37375f9015b54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDY4ODY1", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#pullrequestreview-541068865", "createdAt": "2020-11-30T16:19:41Z", "commit": {"oid": "ac7b9d2b6974deaa6bccf611eee37375f9015b54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjoxOTo0MVrOH8Ct3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjoxOTo0MVrOH8Ct3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcyMTExNw==", "bodyText": "https://github.com/jenkinsci/kubernetes-plugin/pull/906/checks?check_run_id=1473530018", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532721117", "createdAt": "2020-11-30T16:19:41Z", "author": {"login": "jglick"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilderTest.java", "diffHunk": "@@ -301,6 +301,7 @@ private void validatePod(Pod pod, boolean directConnection) {\n \n     private void validatePod(Pod pod, boolean fromYaml, boolean directConnection) {\n         assertThat(pod.getMetadata().getLabels(), hasEntry(\"some-label\", \"some-label-value\"));\n+        assertEquals(\"Never\", pod.getSpec().getRestartPolicy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac7b9d2b6974deaa6bccf611eee37375f9015b54"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/4a0397cb58c1b203617649ce9acb76f18acc2315", "committedDate": "2020-11-30T16:43:13Z", "message": "Always set PodTemplateBuilder#slave"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08a8b22222ce34c1dbc3fb85e04bf9d34dd8766", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/b08a8b22222ce34c1dbc3fb85e04bf9d34dd8766", "committedDate": "2020-11-30T16:46:34Z", "message": "Keep the old contructor as it may be used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDk1NDY5", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#pullrequestreview-541095469", "createdAt": "2020-11-30T16:47:00Z", "commit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0NzowMVrOH8D9pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0NzoyNFrOH8D-uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MTU0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent != null ? agent.getPodName() : null));\n          \n          \n            \n                    volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent.getPodName()));\n          \n      \n    \n    \n  \n\nif it is really @Nonnull?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532741540", "createdAt": "2020-11-30T16:47:01Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -166,7 +168,7 @@ public Pod build() {\n             }\n         }\n \n-        volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, slave != null ? slave.getPodName() : null));\n+        volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent != null ? agent.getPodName() : null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MTgxOQ==", "bodyText": "Ditto here, etc.?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532741819", "createdAt": "2020-11-30T16:47:24Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -176,13 +178,13 @@ public Pod build() {\n         }\n \n         MetadataNested<PodBuilder> metadataBuilder = new PodBuilder().withNewMetadata();\n-        if (slave != null) {\n-            metadataBuilder.withName(slave.getPodName());\n+        if (agent != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a759929ae74ac5f6ac236a21dcd4dd4205632a63", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/a759929ae74ac5f6ac236a21dcd4dd4205632a63", "committedDate": "2020-12-03T15:51:40Z", "message": "Merge branch 'master' into poddecorator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a6f187771124af17dbae8f81f5755e0572589b5", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/3a6f187771124af17dbae8f81f5755e0572589b5", "committedDate": "2020-12-03T15:59:19Z", "message": "Fix broken tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 70, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}