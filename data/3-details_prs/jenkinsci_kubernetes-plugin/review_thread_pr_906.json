{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NzQwODUz", "number": 906, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1Nzo1NlrOE8OlEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0NzoyNFrOE-viQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTg4ODgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodDecorator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1Nzo1NlrOH4Oj0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1Nzo1NlrOH4Oj0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMDg0OQ==", "bodyText": "Just inline.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528720849", "createdAt": "2020-11-23T13:57:56Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodDecorator.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.csanchez.jenkins.plugins.kubernetes;\n+\n+import hudson.ExtensionList;\n+import hudson.ExtensionPoint;\n+import io.fabric8.kubernetes.api.model.PodBuilder;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * Allows to alter a pod definition after it has been built from the yaml and DSL/GUI configuration.\n+ */\n+public abstract class PodDecorator implements ExtensionPoint {\n+    public static ExtensionList<PodDecorator> all() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTg4OTc4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodDecorator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1ODoxMVrOH4OkYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1ODoxMVrOH4OkYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMDk5Mw==", "bodyText": "Could be an interface.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528720993", "createdAt": "2020-11-23T13:58:11Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodDecorator.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.csanchez.jenkins.plugins.kubernetes;\n+\n+import hudson.ExtensionList;\n+import hudson.ExtensionPoint;\n+import io.fabric8.kubernetes.api.model.PodBuilder;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * Allows to alter a pod definition after it has been built from the yaml and DSL/GUI configuration.\n+ */\n+public abstract class PodDecorator implements ExtensionPoint {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTg5MzA1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1OTowMlrOH4OmfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNDoyOToxNVrOH4P2rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMTUzMw==", "bodyText": "Does this cost anything if the list is empty?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528721533", "createdAt": "2020-11-23T13:59:02Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -233,7 +233,7 @@ public Pod build() {\n         }\n \n         // merge with the yaml fragments\n-        Pod pod = combine(template.getYamlsPod(), builder.endSpec().build());\n+        Pod pod = PodDecorator.decorateAll(new PodBuilder(combine(template.getYamlsPod(), builder.endSpec().build()))).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc0MjA2Mw==", "bodyText": "It's pretty cheap but I refactored to avoid it.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r528742063", "createdAt": "2020-11-23T14:29:15Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -233,7 +233,7 @@ public Pod build() {\n         }\n \n         // merge with the yaml fragments\n-        Pod pod = combine(template.getYamlsPod(), builder.endSpec().build());\n+        Pod pod = PodDecorator.decorateAll(new PodBuilder(combine(template.getYamlsPod(), builder.endSpec().build()))).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMTUzMw=="}, "originalCommit": {"oid": "b755e72e3104b792f5126aaeeee121cf347dcc72"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MjEyNzkxOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjoxOTo0MVrOH8Ct3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjoyMDoxMVrOH8CvRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcyMTExNw==", "bodyText": "https://github.com/jenkinsci/kubernetes-plugin/pull/906/checks?check_run_id=1473530018", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532721117", "createdAt": "2020-11-30T16:19:41Z", "author": {"login": "jglick"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilderTest.java", "diffHunk": "@@ -301,6 +301,7 @@ private void validatePod(Pod pod, boolean directConnection) {\n \n     private void validatePod(Pod pod, boolean fromYaml, boolean directConnection) {\n         assertThat(pod.getMetadata().getLabels(), hasEntry(\"some-label\", \"some-label-value\"));\n+        assertEquals(\"Never\", pod.getSpec().getRestartPolicy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac7b9d2b6974deaa6bccf611eee37375f9015b54"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcyMTQ3Ng==", "bodyText": "yeah, looking into it.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532721476", "createdAt": "2020-11-30T16:20:11Z", "author": {"login": "Vlatombe"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilderTest.java", "diffHunk": "@@ -301,6 +301,7 @@ private void validatePod(Pod pod, boolean directConnection) {\n \n     private void validatePod(Pod pod, boolean fromYaml, boolean directConnection) {\n         assertThat(pod.getMetadata().getLabels(), hasEntry(\"some-label\", \"some-label-value\"));\n+        assertEquals(\"Never\", pod.getSpec().getRestartPolicy());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcyMTExNw=="}, "originalCommit": {"oid": "ac7b9d2b6974deaa6bccf611eee37375f9015b54"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MjI1ODEzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0NzowMVrOH8D9pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0OTozNVrOH8EFCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MTU0MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent != null ? agent.getPodName() : null));\n          \n          \n            \n                    volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent.getPodName()));\n          \n      \n    \n    \n  \n\nif it is really @Nonnull?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532741540", "createdAt": "2020-11-30T16:47:01Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -166,7 +168,7 @@ public Pod build() {\n             }\n         }\n \n-        volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, slave != null ? slave.getPodName() : null));\n+        volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent != null ? agent.getPodName() : null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MzQzNA==", "bodyText": "The old constructor is used in other places so I have to keep it @CheckForNull", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532743434", "createdAt": "2020-11-30T16:49:35Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -166,7 +168,7 @@ public Pod build() {\n             }\n         }\n \n-        volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, slave != null ? slave.getPodName() : null));\n+        volumes.put(WORKSPACE_VOLUME_NAME, template.getWorkspaceVolume().buildVolume(WORKSPACE_VOLUME_NAME, agent != null ? agent.getPodName() : null));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MTU0MA=="}, "originalCommit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MjI1OTg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0NzoyNFrOH8D-uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjo0NzoyNFrOH8D-uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MTgxOQ==", "bodyText": "Ditto here, etc.?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/906#discussion_r532741819", "createdAt": "2020-11-30T16:47:24Z", "author": {"login": "jglick"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -176,13 +178,13 @@ public Pod build() {\n         }\n \n         MetadataNested<PodBuilder> metadataBuilder = new PodBuilder().withNewMetadata();\n-        if (slave != null) {\n-            metadataBuilder.withName(slave.getPodName());\n+        if (agent != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0397cb58c1b203617649ce9acb76f18acc2315"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4879, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}