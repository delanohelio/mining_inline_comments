{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NTY0ODAz", "number": 781, "title": "Don't use Computer#getLogDir to avoid race condition", "bodyText": "", "createdAt": "2020-05-15T12:31:00Z", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/781", "merged": true, "mergeCommit": {"oid": "4fac91e0c94c5529d4dcc7f65cab78bec0b6f7d7"}, "closed": true, "closedAt": "2020-05-18T12:13:29Z", "author": {"login": "Vlatombe"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchhQlhAH2gAyNDE4NTY0ODAzOjAzM2JlZWQ5Yjg2ODBlYWM2OGIzZDdlMDExYjllNDExZWY2MzY0ZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciezz3gH2gAyNDE4NTY0ODAzOjBkMTBiMWZhNDBmZTg3ODg5ZjAxOTc4MjhiZjAxYjE3N2VmOTIxODc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "033beed9b8680eac68b3d7e011b9e411ef6364f4", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/033beed9b8680eac68b3d7e011b9e411ef6364f4", "committedDate": "2020-05-15T12:30:34Z", "message": "Don't use Computer#getLogDir to avoid race condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzI3NDA2", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/781#pullrequestreview-412727406", "createdAt": "2020-05-15T15:01:39Z", "commit": {"oid": "033beed9b8680eac68b3d7e011b9e411ef6364f4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTowMTozOVrOGWIkmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTowMjo0NlrOGWInkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg2MjI5Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    if (j == null) break;\n          \n          \n            \n                                    if (j == null) {\n          \n          \n            \n                                        break;\n          \n          \n            \n                                    }", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/781#discussion_r425862296", "createdAt": "2020-05-15T15:01:39Z", "author": {"login": "jglick"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesPipelineTest.java", "diffHunk": "@@ -128,8 +129,12 @@ public void runInPod() throws Exception {\n             new Thread(() -> {\n                 long pos = 0;\n                 try {\n-                    while (Jenkins.getInstanceOrNull() != null) { // otherwise get NPE from Computer.getLogDir\n-                        if (c.getLogFile().isFile()) { // TODO should LargeText.FileSession handle this?\n+                    while (true) {\n+                        Jenkins j = Jenkins.getInstanceOrNull();\n+                        if (j == null) break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "033beed9b8680eac68b3d7e011b9e411ef6364f4"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg2MzA1Ng==", "bodyText": "Hmm. I guess OK as a hotfix but this is not maintainable. Is there a core patch to fix the underlying issue?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/781#discussion_r425863056", "createdAt": "2020-05-15T15:02:46Z", "author": {"login": "jglick"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesPipelineTest.java", "diffHunk": "@@ -128,8 +129,12 @@ public void runInPod() throws Exception {\n             new Thread(() -> {\n                 long pos = 0;\n                 try {\n-                    while (Jenkins.getInstanceOrNull() != null) { // otherwise get NPE from Computer.getLogDir\n-                        if (c.getLogFile().isFile()) { // TODO should LargeText.FileSession handle this?\n+                    while (true) {\n+                        Jenkins j = Jenkins.getInstanceOrNull();\n+                        if (j == null) break;\n+                        // not using Computer#getLogDir as it has side-effect of creating log directories which can create a race condition with main code\n+                        File logFile = new File(j.getRootDir(), \"logs/slaves/\" + c.getName() + \"/slave.log\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "033beed9b8680eac68b3d7e011b9e411ef6364f4"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d10b1fa40fe87889f0197828bf01b177ef92187", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/0d10b1fa40fe87889f0197828bf01b177ef92187", "committedDate": "2020-05-18T12:13:15Z", "message": "Update src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesPipelineTest.java\n\nCo-authored-by: Jesse Glick <jglick@cloudbees.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 126, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}