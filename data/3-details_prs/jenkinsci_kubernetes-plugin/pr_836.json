{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NjYxODgw", "number": 836, "title": "[JENKINS-63584] Add an option to use Jenkins proxy to access Kubernetes", "bodyText": "", "createdAt": "2020-09-03T14:11:38Z", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836", "merged": true, "mergeCommit": {"oid": "f5dd539d4d0fbc1de2e54813c7542681483e09a3"}, "closed": true, "closedAt": "2020-09-11T08:06:10Z", "author": {"login": "inidona"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFLtG-gH2gAyNDc4NjYxODgwOjdjNGMyZjcwZGM1MWY3MGUwODI5ZDUwMGIxYWMwOTkzODEyZmFiNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHwzMeAFqTQ4NjU2MjczNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7c4c2f70dc51f70e0829d500b1ac0993812fab41", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/7c4c2f70dc51f70e0829d500b1ac0993812fab41", "committedDate": "2020-09-03T07:45:05Z", "message": "Merge pull request #1 from jenkinsci/master\n\nUpdate from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4516c867b6c27b3cbef6d0395f7a9b0bf39d8e5", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/b4516c867b6c27b3cbef6d0395f7a9b0bf39d8e5", "committedDate": "2020-09-03T14:10:26Z", "message": "[JENKINS-63584] Respect Jenkins Proxy settings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxODgzMzg4", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#pullrequestreview-481883388", "createdAt": "2020-09-03T14:15:15Z", "commit": {"oid": "b4516c867b6c27b3cbef6d0395f7a9b0bf39d8e5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aeae728db12da91c93e1d2e5ed888121487fcdc", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/7aeae728db12da91c93e1d2e5ed888121487fcdc", "committedDate": "2020-09-03T15:20:12Z", "message": "[JENKINS-63584] Use Jenkins Proxy settings only if cloud has it activated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a79c487973803835555f3a191e21e1c01ad51ed", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/9a79c487973803835555f3a191e21e1c01ad51ed", "committedDate": "2020-09-04T06:41:36Z", "message": "[JENKINS-63584] useJenkinsProxy in Cloud config realy saved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2df98b42e8773c4e0417a85a7aeba4c6fd284856", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/2df98b42e8773c4e0417a85a7aeba4c6fd284856", "committedDate": "2020-09-04T06:46:50Z", "message": "[JENKINS-63584] better comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cefedbe74bf56ff3d2a578d3c649c7301ee89506", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/cefedbe74bf56ff3d2a578d3c649c7301ee89506", "committedDate": "2020-09-07T10:33:12Z", "message": "[JENKINS-63584] HashCode modified for reloading clound config after config change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "committedDate": "2020-09-07T11:24:43Z", "message": "[JENKINS-63584] label enhanced"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NzQ5MDY0", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#pullrequestreview-484749064", "createdAt": "2020-09-09T07:53:13Z", "commit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNzo1MzoxM1rOHO7G_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNzo1NDo0M1rOHO7KsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDU1Nw==", "bodyText": "Remove unused imports", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485410557", "createdAt": "2020-09-09T07:53:13Z", "author": {"login": "Vlatombe"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapterTest.java", "diffHunk": "@@ -29,16 +29,19 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import jenkins.model.Jenkins;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDYzMg==", "bodyText": "Ditto", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485410632", "createdAt": "2020-09-09T07:53:19Z", "author": {"login": "Vlatombe"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapterTest.java", "diffHunk": "@@ -29,16 +29,19 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import jenkins.model.Jenkins;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n \n import static io.fabric8.kubernetes.client.Config.*;\n import io.fabric8.kubernetes.client.KubernetesClient;\n+import org.junit.runner.RunWith;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDc0Mg==", "bodyText": "Revert", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485410742", "createdAt": "2020-09-09T07:53:30Z", "author": {"login": "Vlatombe"}, "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapterTest.java", "diffHunk": "@@ -29,16 +29,19 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import jenkins.model.Jenkins;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n \n import static io.fabric8.kubernetes.client.Config.*;\n import io.fabric8.kubernetes.client.KubernetesClient;\n+import org.junit.runner.RunWith;\n \n /**\n  * Test the creation of clients\n  */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMTA3Ng==", "bodyText": "Not really.", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485411076", "createdAt": "2020-09-09T07:54:03Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapter.java", "diffHunk": "@@ -120,9 +124,38 @@ public KubernetesClient createClient() throws KubernetesAuthException {\n         }\n \n         LOGGER.log(FINE, \"Creating Kubernetes client: {0}\", this.toString());\n+        // JENKINS-63584 If Jenkins has an configured Proxy and cloud has enabled proxy usage pass the arguments to K8S\n+        LOGGER.log(FINE, \"Proxy Settings for Cloud: \" + useJenkinsProxy);\n+        if(useJenkinsProxy) {\n+            Jenkins jenkins = Jenkins.getInstanceOrNull(); // this code might run on slaves", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMTUwNQ==", "bodyText": "Why this?", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485411505", "createdAt": "2020-09-09T07:54:43Z", "author": {"login": "Vlatombe"}, "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapter.java", "diffHunk": "@@ -120,9 +124,38 @@ public KubernetesClient createClient() throws KubernetesAuthException {\n         }\n \n         LOGGER.log(FINE, \"Creating Kubernetes client: {0}\", this.toString());\n+        // JENKINS-63584 If Jenkins has an configured Proxy and cloud has enabled proxy usage pass the arguments to K8S\n+        LOGGER.log(FINE, \"Proxy Settings for Cloud: \" + useJenkinsProxy);\n+        if(useJenkinsProxy) {\n+            Jenkins jenkins = Jenkins.getInstanceOrNull(); // this code might run on slaves\n+            LOGGER.log(FINE, \"Jenkins Instance: \" + jenkins);\n+            if (jenkins != null) {\n+                ProxyConfiguration p = jenkins.proxy;\n+                LOGGER.log(FINE,\"Proxy Instance: \" + p);\n+                if (p != null) {\n+                    builder.withWebsocketTimeout(10000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eb6f6d67da1e3757a28645685a17e68de485e60", "author": {"user": {"login": "inidona", "name": "Andreas M\u00fcller"}}, "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/1eb6f6d67da1e3757a28645685a17e68de485e60", "committedDate": "2020-09-09T08:27:45Z", "message": "[JENKINS-63584] Review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NTYyNzM2", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#pullrequestreview-486562736", "createdAt": "2020-09-11T08:06:04Z", "commit": {"oid": "1eb6f6d67da1e3757a28645685a17e68de485e60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 165, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}