{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxOTk5OTUx", "number": 4149, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NDo1NFrOEtKHig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1OTowMVrOEtKNig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Nzg3MTQ2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NDo1NFrOHgyzJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NDo1NFrOHgyzJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0ODc3NQ==", "bodyText": "Should we add messages to each section that has no cards counts like databrowser?", "url": "https://github.com/all-of-us/workbench/pull/4149#discussion_r504148775", "createdAt": "2020-10-13T17:54:54Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -134,31 +134,35 @@ interface ConceptCacheItem {\n }\n \n const DomainCard: React.FunctionComponent<{conceptDomainInfo: DomainInfo,\n-  standardConceptsOnly: boolean, browseInDomain: Function}> =\n-    ({conceptDomainInfo, standardConceptsOnly, browseInDomain}) => {\n+  standardConceptsOnly: boolean, browseInDomain: Function, updating: boolean}> =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7693821593473c8f880f497779b235b58d57b51e"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Nzg3NzIwOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NjozMFrOHgy2ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NjozMFrOHgy2ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0OTY2Nw==", "bodyText": "may have to change this to call all domains at once.", "url": "https://github.com/all-of-us/workbench/pull/4149#discussion_r504149667", "createdAt": "2020-10-13T17:56:30Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -341,6 +354,33 @@ export const ConceptHomepage = fp.flow(withCurrentWorkspace(), withCurrentConcep\n       this.setState({loadingDomains: false});\n     }\n \n+    async updateCardCounts() {\n+      const {cdrVersionId} = this.props.workspace;\n+      const {conceptDomainList, conceptSurveysList, currentInputString} = this.state;\n+      this.setState({\n+        domainsLoading: conceptDomainList.map(domain => domain.domain),\n+        surveysLoading: conceptSurveysList.map(survey => survey.name),\n+      });\n+      const promises = [];\n+      conceptDomainList.forEach(conceptDomain => {\n+        promises.push(cohortBuilderApi().findDomainCount(+cdrVersionId, conceptDomain.domain.toString(), currentInputString)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7693821593473c8f880f497779b235b58d57b51e"}, "originalPosition": 143}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Nzg3ODQ1OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1Njo1MVrOHgy3cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1Njo1MVrOHgy3cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0OTg3NQ==", "bodyText": "may have to change this to call all surveys at once.", "url": "https://github.com/all-of-us/workbench/pull/4149#discussion_r504149875", "createdAt": "2020-10-13T17:56:51Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -341,6 +354,33 @@ export const ConceptHomepage = fp.flow(withCurrentWorkspace(), withCurrentConcep\n       this.setState({loadingDomains: false});\n     }\n \n+    async updateCardCounts() {\n+      const {cdrVersionId} = this.props.workspace;\n+      const {conceptDomainList, conceptSurveysList, currentInputString} = this.state;\n+      this.setState({\n+        domainsLoading: conceptDomainList.map(domain => domain.domain),\n+        surveysLoading: conceptSurveysList.map(survey => survey.name),\n+      });\n+      const promises = [];\n+      conceptDomainList.forEach(conceptDomain => {\n+        promises.push(cohortBuilderApi().findDomainCount(+cdrVersionId, conceptDomain.domain.toString(), currentInputString)\n+          .then(domainCount => {\n+            conceptDomain.allConceptCount = domainCount.conceptCount;\n+            this.setState({domainsLoading: this.state.domainsLoading.filter(domain => domain !== conceptDomain.domain)});\n+          })\n+        );\n+      });\n+      conceptSurveysList.forEach(conceptSurvey => {\n+        promises.push(cohortBuilderApi().findSurveyCount(+cdrVersionId, conceptSurvey.name, currentInputString)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7693821593473c8f880f497779b235b58d57b51e"}, "originalPosition": 151}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Nzg4NDY3OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/api/CohortBuilderController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1ODoyN1rOHgy7WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1ODoyN1rOHgy7WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1MDg3Mw==", "bodyText": "Depending on how fast this returns, we may need to make this endpoint run once for all domains.", "url": "https://github.com/all-of-us/workbench/pull/4149#discussion_r504150873", "createdAt": "2020-10-13T17:58:27Z", "author": {"login": "freemabd"}, "path": "api/src/main/java/org/pmiops/workbench/api/CohortBuilderController.java", "diffHunk": "@@ -187,11 +190,24 @@\n   }\n \n   @Override\n-  public ResponseEntity<DomainInfoResponse> findDomainInfos(Long cdrVersionId, String term) {\n+  public ResponseEntity<DomainCount> findDomainCount(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7693821593473c8f880f497779b235b58d57b51e"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Nzg4NjgyOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/api/CohortBuilderController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1OTowMVrOHgy8sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1OTowMVrOHgy8sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1MTIxOA==", "bodyText": "Again, may need to refactor this to run all surveys at once.", "url": "https://github.com/all-of-us/workbench/pull/4149#discussion_r504151218", "createdAt": "2020-10-13T17:59:01Z", "author": {"login": "freemabd"}, "path": "api/src/main/java/org/pmiops/workbench/api/CohortBuilderController.java", "diffHunk": "@@ -221,10 +237,17 @@\n   }\n \n   @Override\n-  public ResponseEntity<SurveysResponse> findSurveyModules(Long cdrVersionId, String term) {\n+  public ResponseEntity<SurveyCount> findSurveyCount(Long cdrVersionId, String name, String term) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7693821593473c8f880f497779b235b58d57b51e"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3811, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}