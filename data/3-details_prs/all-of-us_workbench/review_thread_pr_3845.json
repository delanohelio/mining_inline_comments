{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMzU0MDU3", "number": 3845, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTowODozOVrOEUwh3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToxODoxN1rOEUwsyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMjAyMDc2OnYy", "diffSide": "LEFT", "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTowODozOVrOG7IyiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToyMDozNVrOG7JHFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MzE3Nw==", "bodyText": "nit: maybe add a prefix to indicate that its an int? I thought it was a list while reading through", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464663177", "createdAt": "2020-08-03T21:08:39Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -50,9 +51,9 @@ public RandomizeVcf() {\n   }\n \n   @VisibleForTesting\n-  protected RandomizeVcf(String sampleNameSuffix, Random random) {\n+  protected RandomizeVcf(int samples, Random random) {\n     super();\n-    this.sampleNameSuffix = sampleNameSuffix;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2ODQzOQ==", "bodyText": "How about numberOfSamples?", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464668439", "createdAt": "2020-08-03T21:20:35Z", "author": {"login": "als364"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -50,9 +51,9 @@ public RandomizeVcf() {\n   }\n \n   @VisibleForTesting\n-  protected RandomizeVcf(String sampleNameSuffix, Random random) {\n+  protected RandomizeVcf(int samples, Random random) {\n     super();\n-    this.sampleNameSuffix = sampleNameSuffix;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MzE3Nw=="}, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMjAzNjAzOnYy", "diffSide": "RIGHT", "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToxMzo1OVrOG7I7kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToyMjoyNVrOG7JJ_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NTQ5MQ==", "bodyText": "are these NO_CALLs fixing a different issue?", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464665491", "createdAt": "2020-08-03T21:13:59Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -142,6 +141,8 @@ protected Genotype randomizeGenotype(VariantContext variantContext, Genotype gen\n     double genotypeTypeIndex = random.nextDouble();\n     if (genotypeTypeIndex < .0145) {\n       // double no-call\n+      alleles.add(Allele.NO_CALL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2OTE4MQ==", "bodyText": "Yes - VcfWriter gets unhappy when some samples have no alleles when there are samples that do have alleles.", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464669181", "createdAt": "2020-08-03T21:22:25Z", "author": {"login": "als364"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -142,6 +141,8 @@ protected Genotype randomizeGenotype(VariantContext variantContext, Genotype gen\n     double genotypeTypeIndex = random.nextDouble();\n     if (genotypeTypeIndex < .0145) {\n       // double no-call\n+      alleles.add(Allele.NO_CALL);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NTQ5MQ=="}, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMjA0ODc0OnYy", "diffSide": "RIGHT", "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToxODoxN1rOG7JDPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToyMTo1NVrOG7JJRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NzQ1NQ==", "bodyText": "I don't understand a lot of the GATK models but I thought this part seemed a little suspicious since we're only ever grabbing the first genotype out of the variant. Is that ok?", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464667455", "createdAt": "2020-08-03T21:18:17Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -93,8 +92,8 @@ protected VariantContext randomizeVariant(VariantContext variant) {\n     variantContextBuilder.alleles(variant.getAlleles());\n \n     List<Genotype> randomizedGenotypes =\n-        variant.getGenotypes().stream()\n-            .map(genotype -> randomizeGenotype(variant, genotype))\n+        IntStream.rangeClosed(1, this.samples)\n+            .mapToObj(i -> randomizeGenotype(variant, variant.getGenotype(0), i))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2ODk5OA==", "bodyText": "Yes. All we want to randomize is the alleles. We're starting from a single-sample vcf anyways so there will only ever be one genotype in the variant. I can specify that in the comments for the invocation and add a comment here, if you think that would help.", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464668998", "createdAt": "2020-08-03T21:21:55Z", "author": {"login": "als364"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -93,8 +92,8 @@ protected VariantContext randomizeVariant(VariantContext variant) {\n     variantContextBuilder.alleles(variant.getAlleles());\n \n     List<Genotype> randomizedGenotypes =\n-        variant.getGenotypes().stream()\n-            .map(genotype -> randomizeGenotype(variant, genotype))\n+        IntStream.rangeClosed(1, this.samples)\n+            .mapToObj(i -> randomizeGenotype(variant, variant.getGenotype(0), i))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NzQ1NQ=="}, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2485, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}