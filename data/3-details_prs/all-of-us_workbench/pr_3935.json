{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1MDMyODAx", "number": 3935, "title": "[RW-4847][RW-5405][risk=low] Upgrade remaining Leo client-side usages", "bodyText": "(part 4 of ??)\nDepends on #3934\nI considered migrating these to OAS3, but realized I'd need to generate a new set of codegen targets and corresponding boilerplate and also bring in the swagger3 codegen CLI. This didn't seem worth the effort, so instead I downgraded these 4 simple APIs to swagger2, which was a straightforward transformation.\n\nUpgrade cluster APIs to new Runtime variants\nUpgrade deprecated notebooks APIs --> newer \"proxy\" variants\nRelabeled Welder endpoints under proxy for consistency", "createdAt": "2020-08-28T01:20:42Z", "url": "https://github.com/all-of-us/workbench/pull/3935", "merged": true, "mergeCommit": {"oid": "e47436f29c7d5def651d863e58def7f72dc77889"}, "closed": true, "closedAt": "2020-09-03T16:29:52Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDboQegFqTQ3ODAyMzA5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFQqM7AFqTQ4MTg0MTA5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDIzMDk2", "url": "https://github.com/all-of-us/workbench/pull/3935#pullrequestreview-478023096", "createdAt": "2020-08-28T21:00:39Z", "commit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMTowMDozOVrOHJUVKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMToxMDoyMVrOHJUjjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjMzMQ==", "bodyText": "Also need to update the Welder tags (228 and 259)", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479532331", "createdAt": "2020-08-28T21:00:39Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -23,10 +20,10 @@ produces:\n tags:\n   - name: test\n     description: Test API\n-  - name: cluster\n-    description: Clusters API\n-  - name: notebooks\n-    description: Notebooks API\n+  - name: runtime\n+    description: Runtimes API\n+  - name: proxy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjk5NA==", "bodyText": "uses the plural everywhere else", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479532994", "createdAt": "2020-08-28T21:02:23Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -23,10 +20,10 @@ produces:\n tags:\n   - name: test\n     description: Test API\n-  - name: cluster\n-    description: Clusters API\n-  - name: notebooks\n-    description: Notebooks API\n+  - name: runtime", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMzQ0MA==", "bodyText": "is this un-deprecated?", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479533440", "createdAt": "2020-08-28T21:03:39Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -47,98 +44,111 @@ securityDefinitions:\n       profile: profile authorization\n \n ##########################################################################################\n-## PATHS\n+## Subset of Leo APIs needed by the frontend. Just leave them here for ease of\n+## access. If we want to consolidate these APIs, we can later decide to migrate\n+## the Welder and Jupyter spec to OAS3 as well, and move typescript codegen.\n ##########################################################################################\n \n-# TODO(calbach): migrate start/stop into new swagger3 spec; currently these are\n-# needed by typescript.\n-\n paths:\n-  '/api/cluster/{googleProject}/{clusterName}/stop':\n+\n+  /api/google/v1/runtimes/{googleProject}/{name}/stop:\n     post:\n-      summary: Stops a Dataproc cluster\n-      description: |\n-        Stops the instances of a Dataproc cluster, but retains any data persisted on disk. The\n-        cluster may be restarted with the /start endpoint.\n-      operationId: stopCluster\n+      summary: Stops a Dataproc cluster or Google Compute Engine instance\n+      description: >\n+        Stops the running compute, but retains any data persisted on disk. The runtime may be restarted with the /start endpoint.\n+      operationId: stopRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtime name\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster stop request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be stopped\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime stop request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be stopped\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-\n-  '/api/cluster/{googleProject}/{clusterName}/start':\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+  /api/google/v1/runtimes/{googleProject}/{name}/start:\n     post:\n-      summary: Starts a Dataproc cluster\n-      description: |\n-        Starts the instances of a stopped Dataproc cluster.\n-      operationId: startCluster\n+      summary: Starts a Dataproc cluster or Google Compute Engine instance\n+      description: Starts the a stopped runtime\n+      operationId: startRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtimeName\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster start request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be started\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime start request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be started\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n \n-  '/notebooks/{googleProject}/{clusterName}/setCookie':\n+  \"/proxy/{googleProject}/{clusterName}/setCookie\":\n     get:\n-      summary: (Deprecated) Sets a browser cookie needed to authorize connections to a Jupyter notebook\n-      description: |\n-        If using Google token-based authorization to a Jupyter notebook, the Leo proxy accepts a\n+      summary: Sets a browser cookie needed to authorize connections to a Dataproc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633"}, "originalPosition": 180}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMzg0MQ==", "bodyText": "Is this strictly for clusters?  Update text to \"runtime\" if not", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479533841", "createdAt": "2020-08-28T21:04:44Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -47,98 +44,111 @@ securityDefinitions:\n       profile: profile authorization\n \n ##########################################################################################\n-## PATHS\n+## Subset of Leo APIs needed by the frontend. Just leave them here for ease of\n+## access. If we want to consolidate these APIs, we can later decide to migrate\n+## the Welder and Jupyter spec to OAS3 as well, and move typescript codegen.\n ##########################################################################################\n \n-# TODO(calbach): migrate start/stop into new swagger3 spec; currently these are\n-# needed by typescript.\n-\n paths:\n-  '/api/cluster/{googleProject}/{clusterName}/stop':\n+\n+  /api/google/v1/runtimes/{googleProject}/{name}/stop:\n     post:\n-      summary: Stops a Dataproc cluster\n-      description: |\n-        Stops the instances of a Dataproc cluster, but retains any data persisted on disk. The\n-        cluster may be restarted with the /start endpoint.\n-      operationId: stopCluster\n+      summary: Stops a Dataproc cluster or Google Compute Engine instance\n+      description: >\n+        Stops the running compute, but retains any data persisted on disk. The runtime may be restarted with the /start endpoint.\n+      operationId: stopRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtime name\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster stop request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be stopped\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime stop request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be stopped\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-\n-  '/api/cluster/{googleProject}/{clusterName}/start':\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+  /api/google/v1/runtimes/{googleProject}/{name}/start:\n     post:\n-      summary: Starts a Dataproc cluster\n-      description: |\n-        Starts the instances of a stopped Dataproc cluster.\n-      operationId: startCluster\n+      summary: Starts a Dataproc cluster or Google Compute Engine instance\n+      description: Starts the a stopped runtime\n+      operationId: startRuntime\n       tags:\n-        - cluster\n+        - runtimes\n       parameters:\n         - in: path\n           name: googleProject\n           description: googleProject\n           required: true\n           type: string\n         - in: path\n-          name: clusterName\n-          description: clusterName\n+          name: name\n+          description: runtimeName\n           required: true\n           type: string\n       responses:\n-        '202':\n-          description: Cluster start request accepted\n-        '403':\n-          description: User does not have permission to perform action on cluster\n-        '404':\n-          description: Cluster not found\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '409':\n-          description: Cluster cannot be started\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n-        '500':\n+        \"202\":\n+          description: Runtime start request accepted\n+        \"403\":\n+          description: User does not have permission to perform action on runtime\n+        \"404\":\n+          description: Runtime not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"409\":\n+          description: Runtime cannot be started\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n+        \"500\":\n           description: Internal Error\n-          schema:\n-            $ref: '#/definitions/ErrorReport'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: \"#/definitions/ErrorReport\"\n \n-  '/notebooks/{googleProject}/{clusterName}/setCookie':\n+  \"/proxy/{googleProject}/{clusterName}/setCookie\":\n     get:\n-      summary: (Deprecated) Sets a browser cookie needed to authorize connections to a Jupyter notebook\n-      description: |\n-        If using Google token-based authorization to a Jupyter notebook, the Leo proxy accepts a\n+      summary: Sets a browser cookie needed to authorize connections to a Dataproc\n+        cluster", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzNjAxNQ==", "bodyText": "\"cluster/path\" prefix.  Also update the many cluster references in the \"subset\" Jupyter and Welder sections themselves", "url": "https://github.com/all-of-us/workbench/pull/3935#discussion_r479536015", "createdAt": "2020-08-28T21:10:21Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/notebooks.yaml", "diffHunk": "@@ -1,10 +1,7 @@\n # This file is a hand-crafted combination of Leo and its proxy APIs.\n #  - A subset of Welder (modified for cluster/path prefix): https://github.com/DataBiosphere/welder/blob/master/server/src/main/resources/api-docs.yaml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f56b433b4d16500c0bc5e11d8092d74bf081b633", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/f56b433b4d16500c0bc5e11d8092d74bf081b633", "committedDate": "2020-08-28T01:19:39Z", "message": "comment"}, "afterCommit": {"oid": "4d55dfc8519266d8c3b91affeaecfc6ce811e5ee", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/4d55dfc8519266d8c3b91affeaecfc6ce811e5ee", "committedDate": "2020-09-02T04:57:16Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48b05ae20b2f2fd28f8f865a7f1610cb2e48f35", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/d48b05ae20b2f2fd28f8f865a7f1610cb2e48f35", "committedDate": "2020-09-03T00:01:21Z", "message": "Upgrade remaining UI usages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "999036e28268c54a92cc62d39afb391e792ae56a", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/999036e28268c54a92cc62d39afb391e792ae56a", "committedDate": "2020-09-03T00:01:21Z", "message": "comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b3ac34dbab7ab54bb69489892be7d9bc4e2449d", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/1b3ac34dbab7ab54bb69489892be7d9bc4e2449d", "committedDate": "2020-09-03T00:01:21Z", "message": "fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7789f4a744dff6ff6ccaf056e6bfab525cafffe6", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/7789f4a744dff6ff6ccaf056e6bfab525cafffe6", "committedDate": "2020-09-03T00:01:21Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "906cfe3491649ca44bb3326d8fa44cf270258713", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/906cfe3491649ca44bb3326d8fa44cf270258713", "committedDate": "2020-09-03T00:01:21Z", "message": "fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fca5a16d25b932fbfd31979a59f28eb8187bf29", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/6fca5a16d25b932fbfd31979a59f28eb8187bf29", "committedDate": "2020-09-03T01:12:52Z", "message": "Proxy rename"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a25d508c9dd1e7f623a990cf8c92761a4630920", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/9a25d508c9dd1e7f623a990cf8c92761a4630920", "committedDate": "2020-09-02T06:02:54Z", "message": "fixes"}, "afterCommit": {"oid": "6fca5a16d25b932fbfd31979a59f28eb8187bf29", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/6fca5a16d25b932fbfd31979a59f28eb8187bf29", "committedDate": "2020-09-03T01:12:52Z", "message": "Proxy rename"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxODQxMDk4", "url": "https://github.com/all-of-us/workbench/pull/3935#pullrequestreview-481841098", "createdAt": "2020-09-03T13:31:26Z", "commit": {"oid": "6fca5a16d25b932fbfd31979a59f28eb8187bf29"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4374, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}