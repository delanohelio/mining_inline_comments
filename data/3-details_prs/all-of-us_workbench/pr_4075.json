{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MjI3MTYz", "number": 4075, "title": "[RW-5558][risk=no] Make footer for Attributes & Modifiers sidebar sticky", "bodyText": "Make the footer with the Calculate, Back and Add/Apply buttons fixed at the bottom of the Attributes & Modifiers sidebars\nTop of sidebar content:\n\nScrolled to the bottom:\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n I have run and tested this change locally\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer", "createdAt": "2020-09-28T15:24:51Z", "url": "https://github.com/all-of-us/workbench/pull/4075", "merged": true, "mergeCommit": {"oid": "cc37c0e09eb00043c48301e74d3251b5ec5aebed"}, "closed": true, "closedAt": "2020-09-29T16:29:17Z", "author": {"login": "dolbeew"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNVKWrAH2gAyNDk0MjI3MTYzOjk0Njg1ZWM1Y2U0ZTMzMjRjNTlkMWNlYjBmNWFjYTFkY2MyZWEyNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNqMHlAH2gAyNDk0MjI3MTYzOmQ0MDNmYjRlNzZmOGNkZDY1ZDhiODgxMDk0ODFmYjEzMjc5Yjg1NjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94685ec5ce4e3324c59d1ceb0f5aca1dcc2ea259", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/94685ec5ce4e3324c59d1ceb0f5aca1dcc2ea259", "committedDate": "2020-09-28T15:17:34Z", "message": "RW-5558 make attributes footer sticky"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e62f659cf42ab3aaf4904c92e78231187c07c112", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e62f659cf42ab3aaf4904c92e78231187c07c112", "committedDate": "2020-09-28T15:17:34Z", "message": "RW-5558 adjust sticky footer for modifiers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d0fb8364c3211e983b9ce59e34d772938f1619e", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/9d0fb8364c3211e983b9ce59e34d772938f1619e", "committedDate": "2020-09-28T16:10:25Z", "message": "RW-5558 lint errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c4882f48af3a80e1dbb022679870ba17f0958a00", "committedDate": "2020-09-28T19:02:57Z", "message": "RW-5558 fix modifiers calculate fn"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDMxNjcw", "url": "https://github.com/all-of-us/workbench/pull/4075#pullrequestreview-498031670", "createdAt": "2020-09-29T03:03:22Z", "commit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzowMzoyMlrOHZW1dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzowMzoyMlrOHZW1dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MDU4Mw==", "bodyText": "nit: can you move the prop out. It will be easier to read", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496350583", "createdAt": "2020-09-29T03:03:22Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDM1OTE1", "url": "https://github.com/all-of-us/workbench/pull/4075#pullrequestreview-498035915", "createdAt": "2020-09-29T03:17:56Z", "commit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzoxNzo1NlrOHZXDYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzoxNzo1NlrOHZXDYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1NDE0NQ==", "bodyText": "nit: can we re-write style condition as disableCalculate ? {....styles.calculateButton, borderColor: colorWithWhiteness(colors.dark, 0.6)} : styles.calculatebutton", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496354145", "createdAt": "2020-09-29T03:17:56Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {\n+  return <div style={{background: colorWithWhiteness(colors.primary, .87), bottom: 0, position: 'sticky'}}>\n+    <FlexRowWrap style={styles.countPreview}>\n+      <div style={styles.resultsContainer}>\n+        <Button id='attributes-calculate'\n+          type='secondaryLight'\n+          disabled={disableCalculate}\n+          style={{...styles.calculateButton, ...(disableCalculate ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDM4NTA2", "url": "https://github.com/all-of-us/workbench/pull/4075#pullrequestreview-498038506", "createdAt": "2020-09-29T03:27:10Z", "commit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e467a412e476c33bf726209ae81456cae80170c", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6e467a412e476c33bf726209ae81456cae80170c", "committedDate": "2020-09-29T05:02:04Z", "message": "RW-5558 pr feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDk4MTM4", "url": "https://github.com/all-of-us/workbench/pull/4075#pullrequestreview-498098138", "createdAt": "2020-09-29T05:05:48Z", "commit": {"oid": "6e467a412e476c33bf726209ae81456cae80170c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNTo0OVrOHZaPBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNzoyNVrOHZaTQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwNjI3OQ==", "bodyText": "Moved this to a separate function since I noticed the calculate function was not using the current values in the form, usually resulting in an empty array getting sent with the request.", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496406279", "createdAt": "2020-09-29T05:05:49Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -349,10 +346,8 @@ export const ModifierPage = fp.flow(withCurrentWorkspace(), withCurrentCohortSea\n       this.setState({count: null, formState}, () => this.validateValues());\n     }\n \n-    updateMods() {\n-      const {cohortContext} = this.props;\n-      const {formState} = this.state;\n-      cohortContext.item.modifiers = formState.reduce((acc, mod) => {\n+    getModifiersFromForm() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e467a412e476c33bf726209ae81456cae80170c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwNzM2MQ==", "bodyText": "Also update the filter condition here, since 0 values in the number inputs were getting filtered out, resulting in a bad request for the calculate api call.", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496407361", "createdAt": "2020-09-29T05:07:25Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -361,15 +356,20 @@ export const ModifierPage = fp.flow(withCurrentWorkspace(), withCurrentCohortSea\n               break;\n             case ModifierType.EVENTDATE:\n               const formatted = values.map(val => moment(val, 'YYYY-MM-DD', true).isValid()\n-                    ? moment(val).format('YYYY-MM-DD') : undefined);\n+                ? moment(val).format('YYYY-MM-DD') : undefined);\n               acc.push({name, operator, operands: formatted.filter(val => !!val)});\n               break;\n             default:\n-              acc.push({name, operator, operands: values.filter(val => !!val)});\n+              acc.push({name, operator, operands: values.filter(val => !['', null, undefined].includes(val))});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e467a412e476c33bf726209ae81456cae80170c"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d403fb4e76f8cdd65d8b88109481fb13279b8566", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d403fb4e76f8cdd65d8b88109481fb13279b8566", "committedDate": "2020-09-29T15:47:30Z", "message": "RW-5558 prevent attributes and modifiers in the same sidebar"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4121, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}