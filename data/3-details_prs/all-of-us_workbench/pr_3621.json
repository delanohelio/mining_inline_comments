{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Nzc4NzU3", "number": 3621, "title": "[risk=no] Add additional metadata fields for user/workspace export", "bodyText": "These were requested by Karthik.", "createdAt": "2020-05-28T22:55:44Z", "url": "https://github.com/all-of-us/workbench/pull/3621", "merged": true, "mergeCommit": {"oid": "761e70b7d312a554ea5c31fe3d2fba227ad26255"}, "closed": true, "closedAt": "2020-06-05T23:10:25Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoWyAVgFqTQyNTUyMjQ1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpQqaXgFqTQyNjI1MzUyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NTIyNDU2", "url": "https://github.com/all-of-us/workbench/pull/3621#pullrequestreview-425522456", "createdAt": "2020-06-05T18:13:11Z", "commit": {"oid": "ef4806ce3f990ef1ecb4e865d7988f9920108831"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxODoxMzoxMlrOGf4k5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxODoxNDoyMVrOGf4ojg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4NTk4OQ==", "bodyText": "nit: I'd prefer the nullable/map/orElse pattern here but I'm not gonna block on that", "url": "https://github.com/all-of-us/workbench/pull/3621#discussion_r436085989", "createdAt": "2020-06-05T18:13:12Z", "author": {"login": "jmthibault79"}, "path": "api/tools/src/main/java/org/pmiops/workbench/tools/ExportWorkspaceData.java", "diffHunk": "@@ -230,11 +238,34 @@ private WorkspaceExportRow toWorkspaceExportRow(DbWorkspace workspace) {\n   }\n \n   private WorkspaceExportRow toWorkspaceExportRow(DbUser user) {\n+    String verifiedInstitutionName =\n+        verifiedInstitutionalAffiliationDao\n+            .findFirstByUser(user)\n+            .map(via -> via.getInstitution().getDisplayName())\n+            .orElse(\"\");\n+\n     WorkspaceExportRow row = new WorkspaceExportRow();\n     row.setCreatorContactEmail(user.getContactEmail());\n     row.setCreatorUsername(user.getUsername());\n+    row.setInstitution(verifiedInstitutionName);\n     row.setCreatorFirstSignIn(\n         user.getFirstSignInTime() == null ? \"\" : dateFormat.format(user.getFirstSignInTime()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef4806ce3f990ef1ecb4e865d7988f9920108831"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4NjkyNg==", "bodyText": "welp this is certainly tedious.  assuming there's no better way or you'd have done it?", "url": "https://github.com/all-of-us/workbench/pull/3621#discussion_r436086926", "createdAt": "2020-06-05T18:14:21Z", "author": {"login": "jmthibault79"}, "path": "api/tools/src/main/java/org/pmiops/workbench/tools/WorkspaceExportRow.java", "diffHunk": "@@ -38,7 +50,7 @@ public void setCreatorFirstSignIn(String creatorFirstSignIn) {\n   }\n \n   @CsvBindByName(column = \"First Sign In\")\n-  @CsvBindByPosition(position = 2)\n+  @CsvBindByPosition(position = 3)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef4806ce3f990ef1ecb4e865d7988f9920108831"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aff14e6ecdb9f5351a27a27c26c30e2a097e74e", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/0aff14e6ecdb9f5351a27a27c26c30e2a097e74e", "committedDate": "2020-06-05T18:42:59Z", "message": "Add additional metadata fields for export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43a021888f0cff8771501ba404c8d75787e2086a", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/43a021888f0cff8771501ba404c8d75787e2086a", "committedDate": "2020-06-05T18:42:59Z", "message": "optionals"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef024367da88f5c16ce16affe7de4c4f089134ef", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/ef024367da88f5c16ce16affe7de4c4f089134ef", "committedDate": "2020-06-05T18:41:55Z", "message": "optionals"}, "afterCommit": {"oid": "43a021888f0cff8771501ba404c8d75787e2086a", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/43a021888f0cff8771501ba404c8d75787e2086a", "committedDate": "2020-06-05T18:42:59Z", "message": "optionals"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjUzNTI1", "url": "https://github.com/all-of-us/workbench/pull/3621#pullrequestreview-426253525", "createdAt": "2020-06-08T13:40:48Z", "commit": {"oid": "43a021888f0cff8771501ba404c8d75787e2086a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzo0MDo0OFrOGgemag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzo0MTo0M1rOGgepBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjcwODk3MA==", "bodyText": "FWIW, this was not intended to be a long-lived implementation.", "url": "https://github.com/all-of-us/workbench/pull/3621#discussion_r436708970", "createdAt": "2020-06-08T13:40:48Z", "author": {"login": "jaycarlton"}, "path": "api/tools/src/main/java/org/pmiops/workbench/tools/WorkspaceExportRow.java", "diffHunk": "@@ -38,7 +50,7 @@ public void setCreatorFirstSignIn(String creatorFirstSignIn) {\n   }\n \n   @CsvBindByName(column = \"First Sign In\")\n-  @CsvBindByPosition(position = 2)\n+  @CsvBindByPosition(position = 3)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4NjkyNg=="}, "originalCommit": {"oid": "ef4806ce3f990ef1ecb4e865d7988f9920108831"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjcwOTYzNw==", "bodyText": "One option is to just write an array of JSON objects and use an off-the-shelf json->csv converter.", "url": "https://github.com/all-of-us/workbench/pull/3621#discussion_r436709637", "createdAt": "2020-06-08T13:41:43Z", "author": {"login": "jaycarlton"}, "path": "api/tools/src/main/java/org/pmiops/workbench/tools/WorkspaceExportRow.java", "diffHunk": "@@ -62,7 +122,7 @@ public void setProjectId(String projectId) {\n   }\n \n   @CsvBindByName(column = \"Workspace Project ID\")\n-  @CsvBindByPosition(position = 4)\n+  @CsvBindByPosition(position = 9)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43a021888f0cff8771501ba404c8d75787e2086a"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4795, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}