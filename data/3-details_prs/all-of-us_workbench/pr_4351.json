{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMDY3NjI5", "number": 4351, "title": "[risk=low] Update the Create Auth Domain endpoint and project-rb command", "bodyText": "Description:\nImprovements to the New Application Environment process via the project.rb create-auth-domain command.  See comment below.\nNote: this is arguably a breaking API change.  But it's a change from an empty response to a response with a body.\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-12-03T19:56:28Z", "url": "https://github.com/all-of-us/workbench/pull/4351", "merged": true, "mergeCommit": {"oid": "503c65bfbb5f2c7bc3147561e1bbf4412759c1bc"}, "closed": true, "closedAt": "2020-12-07T15:06:31Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiopAPgH2gAyNTMyMDY3NjI5OjI5ZjhmMzcwN2RlYjRlMDZiMWIzY2ZmY2FjOGM5ODk0NzVmNWM2MGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj28DRgH2gAyNTMyMDY3NjI5OjBjYTc3M2RhMWMwZDc0YjhlMWVmZDM2Yjc1NzM4Mzc4MWYxNGMyZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29f8f3707deb4e06b1b3cffcac8c989475f5c60e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/29f8f3707deb4e06b1b3cffcac8c989475f5c60e", "committedDate": "2020-12-03T19:51:39Z", "message": "Add user parameter and make all params required"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c", "committedDate": "2020-12-03T19:51:42Z", "message": "Update create auth domain to return the group email"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MzY0MzAw", "url": "https://github.com/all-of-us/workbench/pull/4351#pullrequestreview-544364300", "createdAt": "2020-12-03T20:01:24Z", "commit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowMToyNVrOH-vJlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowMToyNVrOH-vJlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU0NjI2Mw==", "bodyText": "Previously: opened a web browser requiring google login.  This was annoyingly disruptive when I had to run this more than once.", "url": "https://github.com/all-of-us/workbench/pull/4351#discussion_r535546263", "createdAt": "2020-12-03T20:01:25Z", "author": {"login": "jmthibault79"}, "path": "api/libproject/devstart.rb", "diffHunk": "@@ -1286,12 +1286,18 @@ def create_auth_domain(cmd_name, args)\n   op.add_option(\n     \"--project [project]\",\n     ->(opts, v) { opts.project = v},\n-    \"Project to create the authorization domain\"\n+    \"Workbench Project (environment) for creating the authorization domain\"\n   )\n+  op.add_option(\n+    \"--user [user]\",\n+    ->(opts, v) { opts.user = v},\n+    \"A Workbench user you control with DEVELOPER Authority in the environment\"\n+  )\n+  op.add_validator ->(opts) { raise ArgumentError unless opts.project and opts.user}\n   op.parse.validate\n \n   common = Common.new\n-  common.run_inline %W{gcloud auth login}\n+  common.run_inline %W{gcloud auth login #{op.opts.user}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Mzc1MDE5", "url": "https://github.com/all-of-us/workbench/pull/4351#pullrequestreview-544375019", "createdAt": "2020-12-03T20:08:01Z", "commit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowODowMVrOH-vYlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowODowMVrOH-vYlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU1MDEwMA==", "bodyText": "Step 45 of the New Application Environment creation doc is running the Create Auth Domain command.\nStep 46 involves determining the Auth Domain's Terra Group Email via a multi-step process.  Terra already returns this information to us during creation!  Let's return it to the script caller.", "url": "https://github.com/all-of-us/workbench/pull/4351#discussion_r535550100", "createdAt": "2020-12-03T20:08:01Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/api/AuthDomainController.java", "diffHunk": "@@ -36,9 +37,13 @@\n \n   @AuthorityRequired({Authority.DEVELOPER})\n   @Override\n-  public ResponseEntity<EmptyResponse> createAuthDomain(String groupName) {\n-    fireCloudService.createGroup(groupName);\n-    return ResponseEntity.ok(new EmptyResponse());\n+  public ResponseEntity<AuthDomainCreatedResponse> createAuthDomain(String authDomainName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTY1NTg4", "url": "https://github.com/all-of-us/workbench/pull/4351#pullrequestreview-545165588", "createdAt": "2020-12-04T17:40:43Z", "commit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzo0MDo0M1rOH_bH5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzo1MDowOFrOH_beDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2NjcyNQ==", "bodyText": "optional nit: variable not really necessary, could inline below", "url": "https://github.com/all-of-us/workbench/pull/4351#discussion_r536266725", "createdAt": "2020-12-04T17:40:43Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/api/AuthDomainController.java", "diffHunk": "@@ -36,9 +37,13 @@\n \n   @AuthorityRequired({Authority.DEVELOPER})\n   @Override\n-  public ResponseEntity<EmptyResponse> createAuthDomain(String groupName) {\n-    fireCloudService.createGroup(groupName);\n-    return ResponseEntity.ok(new EmptyResponse());\n+  public ResponseEntity<AuthDomainCreatedResponse> createAuthDomain(String authDomainName) {\n+    final FirecloudManagedGroupWithMembers group = fireCloudService.createGroup(authDomainName);\n+    final AuthDomainCreatedResponse response =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI3MjM5Nw==", "bodyText": "nit: the other similar usage we have in project.rb calls this flag \"account\" \n  \n    \n      workbench/api/libproject/devstart.rb\n    \n    \n         Line 1398\n      in\n      ee18c9c\n    \n    \n    \n    \n\n        \n          \n           common.run_inline %W{gcloud auth login #{op.opts.account}}", "url": "https://github.com/all-of-us/workbench/pull/4351#discussion_r536272397", "createdAt": "2020-12-04T17:50:08Z", "author": {"login": "calbach"}, "path": "api/libproject/devstart.rb", "diffHunk": "@@ -1286,12 +1286,18 @@ def create_auth_domain(cmd_name, args)\n   op.add_option(\n     \"--project [project]\",\n     ->(opts, v) { opts.project = v},\n-    \"Project to create the authorization domain\"\n+    \"Workbench Project (environment) for creating the authorization domain\"\n   )\n+  op.add_option(\n+    \"--user [user]\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee18c9c28ae92fb1e11a6d746731d4361cfe9b5c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ca773da1c0d74b8e1efd36b757383781f14c2d2", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/0ca773da1c0d74b8e1efd36b757383781f14c2d2", "committedDate": "2020-12-07T15:05:03Z", "message": "inline the new AuthDomainCreatedResponse()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3705, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}