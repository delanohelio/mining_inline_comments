{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNzQ2MzU3", "number": 3735, "title": "[RW-5099][risk=no] Reactify unguarded static content routes", "bodyText": "Some of these depend on the Angular SignInService. Our overall approach for reactifying these things was to make all the routes themselves react first, then delete the Angular router, then delete the rest of the Angular, so I'm just pushing the SignInService down a layer for now.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-07-01T14:41:17Z", "url": "https://github.com/all-of-us/workbench/pull/3735", "merged": true, "mergeCommit": {"oid": "123eeec69b894e1a714009b2f52dd94ded717c8d"}, "closed": true, "closedAt": "2020-07-02T17:41:15Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwr4H6AFqTQ0MDk2MjA2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxBxy8AH2gAyNDQyNzQ2MzU3OjEzNWVmNDdlY2U0MTk3Mjk5N2Q3YWRkYjBhNjIwNDMzYTc4ZWY4ZDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTYyMDY5", "url": "https://github.com/all-of-us/workbench/pull/3735#pullrequestreview-440962069", "createdAt": "2020-07-01T15:11:18Z", "commit": {"oid": "4cf62c38b9fa09adc64bcd8f336725f3f457d98e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxMToxOVrOGrqJLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToyMToyMFrOGrqi4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzMjQzMA==", "bodyText": "things will be collapsible, dangit", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r448432430", "createdAt": "2020-07-01T15:11:19Z", "author": {"login": "als364"}, "path": "ui/src/app/app-routing.module.ts", "diffHunk": "@@ -55,19 +52,8 @@ const routes: Routes = [\n     path: 'login',\n     component: SignInComponent,\n     data: {title: 'Sign In'}\n-  }, {\n-    path: 'session-expired',\n-    component: SessionExpiredComponent,\n-    data: {title: 'You have been signed out'}\n-  }, {\n-    path: 'sign-in-again',\n-    component: SignInAgainComponent,\n-    data: {title: 'You have been signed out'}\n-  }, {\n-    path: 'user-disabled',\n-    component: UserDisabledComponent,\n-    data: {title: 'Disabled'}\n-  }, {\n+  },\n+  {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf62c38b9fa09adc64bcd8f336725f3f457d98e"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzMzI1OA==", "bodyText": "This was originally consumed in the Angular wrappers for SignInAgain and SessionExpired. Pushing it down here so that 1) it's in one place instead of several and 2) so that I don't have to figure out how to deprecate it before we get rid of the Angular router.", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r448433258", "createdAt": "2020-07-01T15:12:33Z", "author": {"login": "als364"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -1,20 +1,32 @@\n import {Component as AComponent} from '@angular/core';\n import {AppRoute, AppRouter} from 'app/components/app-router';\n+import {CookiePolicy} from 'app/pages/cookie-policy';\n+import {SessionExpired} from 'app/pages/session-expired';\n+import {SignInAgain} from 'app/pages/sign-in-again';\n+import {UserDisabled} from 'app/pages/user-disabled';\n+import {SignInService} from 'app/services/sign-in.service';\n import { ReactWrapperBase } from 'app/utils';\n import * as React from 'react';\n-import {CookiePolicyComponent} from './pages/cookie-policy';\n \n-export const AppRoutingComponent: React.FunctionComponent = () => {\n+export const AppRoutingComponent: React.FunctionComponent<{signIn: Function}> = ({signIn}) => {\n   return <AppRouter>\n-    <AppRoute path='/cookie-policy' component={CookiePolicyComponent}/>\n+    <AppRoute path='/cookie-policy' component={CookiePolicy}/>\n+    <AppRoute path='/session-expired' data={{signIn: signIn}} component={SessionExpired}/>\n+    <AppRoute path='/sign-in-again' data={{signIn: signIn}} component={SignInAgain}/>\n+    <AppRoute path='/user-disabled' component={UserDisabled}/>\n   </AppRouter>;\n };\n \n @AComponent({\n   template: '<div #root></div>'\n })\n export class AppRouting extends ReactWrapperBase {\n-  constructor() {\n-    super(AppRoutingComponent, []);\n+  constructor(private signInService: SignInService) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf62c38b9fa09adc64bcd8f336725f3f457d98e"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzOTAxMA==", "bodyText": "the basic idea is that we could do like a thin wrapper around React.Component kind of like:\nexport class ComponentWithPageTitle extends React.Component<{pageTitle, ...props}> {\n    constructor(pageTitle, ...props) {\n        super(props);\n        document.title = buildPageTitleForEnvironment(pageTitle);\n    }\n}\n\nexport class UserDisabled extends ComponentWithPageTitle<{pageTitle}> {\n    constructor(pageTitle) {\n        super(pageTitle);\n    }\n\n    render() {\n        [...]\n    }\n}", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r448439010", "createdAt": "2020-07-01T15:21:20Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/user-disabled.tsx", "diffHunk": "@@ -1,31 +1,27 @@\n-import {Component} from '@angular/core';\n import * as React from 'react';\n \n import {StyledAnchorTag} from 'app/components/buttons';\n import {BoldHeader} from 'app/components/headers';\n import {PublicLayout} from 'app/components/public-layout';\n import colors from 'app/styles/colors';\n-import {\n-  ReactWrapperBase\n-} from 'app/utils';\n+import {buildPageTitleForEnvironment} from 'app/utils/title';\n \n const supportUrl = 'support@researchallofus.org';\n \n-export const UserDisabled: React.FunctionComponent<{}> = () => {\n-  return <PublicLayout>\n-    <BoldHeader>Your account has been disabled</BoldHeader>\n-    <section style={{color: colors.primary, fontSize: '18px', marginTop: '.5rem'}}>\n-      Contact <StyledAnchorTag href={'mailto:' + supportUrl}>{supportUrl}</StyledAnchorTag> for\n-      more information.\n-    </section>\n-  </PublicLayout>;\n-};\n+export class UserDisabled extends React.Component {\n+  // TODO: esteemed reviewer, please yell at me if I don't write a paper about a global wrapper that", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf62c38b9fa09adc64bcd8f336725f3f457d98e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMTYzNTI0", "url": "https://github.com/all-of-us/workbench/pull/3735#pullrequestreview-441163524", "createdAt": "2020-07-01T20:07:58Z", "commit": {"oid": "4cf62c38b9fa09adc64bcd8f336725f3f457d98e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDowNzo1OFrOGrzv7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDowNzo1OFrOGrzv7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU4OTgwNg==", "bodyText": "Please take a look at this document about how I could do this better (but not in this PR)", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r448589806", "createdAt": "2020-07-01T20:07:58Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/cookie-policy.tsx", "diffHunk": "@@ -46,7 +47,11 @@ const COOKIE_DELETION_LINK = 'https://www.aboutcookies.org/how-to-delete-cookies\n const GOOGLE_PRIVACY_LINK = 'https://policies.google.com/privacy';\n const ZENDESK_PRIVACY_LINK = 'https://www.zendesk.com/company/customers-partners/privacy-policy/';\n \n-export class CookiePolicyComponent extends React.Component<{}, {}> {\n+export class CookiePolicy extends React.Component<{}, {}> {\n+  componentDidMount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf62c38b9fa09adc64bcd8f336725f3f457d98e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82e32920b0dce1d3c4abe60c58545551ad133efd", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/82e32920b0dce1d3c4abe60c58545551ad133efd", "committedDate": "2020-07-01T20:12:02Z", "message": "user-disabled + title function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d972b4b117f1ca106bd95b0048058479c9b0a04b", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d972b4b117f1ca106bd95b0048058479c9b0a04b", "committedDate": "2020-07-01T20:13:15Z", "message": "signinservice pushed down to app-routing wrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5721e8ec50a69aab35bba234babdc7e8910b53c1", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/5721e8ec50a69aab35bba234babdc7e8910b53c1", "committedDate": "2020-07-01T20:13:15Z", "message": "whoops, fixed SessionExpired"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7222e50efe1ab843b7ac6324e654c0332de9c9cd", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/7222e50efe1ab843b7ac6324e654c0332de9c9cd", "committedDate": "2020-07-01T20:13:43Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "611a839a5b550ec21b0a806e1551dec70d495159", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/611a839a5b550ec21b0a806e1551dec70d495159", "committedDate": "2020-07-01T20:13:43Z", "message": "removed snarky comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6769cb82a992bee084714041fe0a46ef4d49adb6", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6769cb82a992bee084714041fe0a46ef4d49adb6", "committedDate": "2020-07-01T20:10:06Z", "message": "removed snarky comment"}, "afterCommit": {"oid": "611a839a5b550ec21b0a806e1551dec70d495159", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/611a839a5b550ec21b0a806e1551dec70d495159", "committedDate": "2020-07-01T20:13:43Z", "message": "removed snarky comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00648ffc31cc091fc6a075548c4b0f13a3c5038", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e00648ffc31cc091fc6a075548c4b0f13a3c5038", "committedDate": "2020-07-01T20:15:48Z", "message": "lint post-rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODEzMDc3", "url": "https://github.com/all-of-us/workbench/pull/3735#pullrequestreview-441813077", "createdAt": "2020-07-02T15:42:34Z", "commit": {"oid": "e00648ffc31cc091fc6a075548c4b0f13a3c5038"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNTo0MjozNFrOGsTA8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNTo1MDoxMFrOGsTlqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEwMjA2Ng==", "bodyText": "nit: avoid concatenating with interpolation:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                title = `[${environment.displayTag}] ` + title;\n          \n          \n            \n                title = `[${environment.displayTag}] title` ;", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r449102066", "createdAt": "2020-07-02T15:42:34Z", "author": {"login": "petesantos"}, "path": "ui/src/app/utils/title.ts", "diffHunk": "@@ -0,0 +1,14 @@\n+import {environment} from 'environments/environment';\n+\n+import {BASE_TITLE} from 'app/utils/strings';\n+\n+export function buildPageTitleForEnvironment(pageTitle?: string) {\n+  let title = BASE_TITLE;\n+  if (environment.shouldShowDisplayTag) {\n+    title = `[${environment.displayTag}] ` + title;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00648ffc31cc091fc6a075548c4b0f13a3c5038"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEwNDE4Mw==", "bodyText": "same nit as above", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r449104183", "createdAt": "2020-07-02T15:44:20Z", "author": {"login": "petesantos"}, "path": "ui/src/app/utils/title.ts", "diffHunk": "@@ -0,0 +1,14 @@\n+import {environment} from 'environments/environment';\n+\n+import {BASE_TITLE} from 'app/utils/strings';\n+\n+export function buildPageTitleForEnvironment(pageTitle?: string) {\n+  let title = BASE_TITLE;\n+  if (environment.shouldShowDisplayTag) {\n+    title = `[${environment.displayTag}] ` + title;\n+    if (pageTitle) {\n+      title = `${pageTitle} | ` + title;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00648ffc31cc091fc6a075548c4b0f13a3c5038"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExMTQ2NA==", "bodyText": "One possiblity to avoid the let:\n    const title = environment.shouldShowDisplayTag && pageTitle ? `${pageTitle} | ` : ''\n    return environment.shouldShowDisplayTag ? `${title}[${environment.displayTag}] ${BASE_TITLE}` : BASE_TITLE\n\nBut I don't know if that is cleaner to read", "url": "https://github.com/all-of-us/workbench/pull/3735#discussion_r449111464", "createdAt": "2020-07-02T15:50:10Z", "author": {"login": "petesantos"}, "path": "ui/src/app/utils/title.ts", "diffHunk": "@@ -0,0 +1,14 @@\n+import {environment} from 'environments/environment';\n+\n+import {BASE_TITLE} from 'app/utils/strings';\n+\n+export function buildPageTitleForEnvironment(pageTitle?: string) {\n+  let title = BASE_TITLE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00648ffc31cc091fc6a075548c4b0f13a3c5038"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "135ef47ece41972997d7addb0a620433a78ef8d4", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/135ef47ece41972997d7addb0a620433a78ef8d4", "committedDate": "2020-07-02T16:52:40Z", "message": "nitpicking"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4654, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}