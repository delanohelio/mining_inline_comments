{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxOTE0ODE1", "number": 3654, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzo0MToyNFrOED_SgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDowODo1M1rOEECUvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjE4MTEyOnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzo0MToyNFrOGhVY9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMTowODo0OFrOGhcjFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYwNjY0NA==", "bodyText": "Great! Can you also please show an example of a full path before and after this conversion?", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437606644", "createdAt": "2020-06-09T17:41:24Z", "author": {"login": "jaycarlton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then\n+              ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+            fi\n       - run:\n           name: Run Java unit tests\n           working_directory: ~/workbench/api\n-          command: ./project.rb test\n+          # See: https://circleci.com/docs/2.0/language-java/#sample-configuration\n+          # Short explanation on commands:\n+          #   Find all unit tests recursively in \"api/src/test/java/\" directories.\n+          #   Strips off \"src/test/java/\" substring;\n+          #   Replaces all path separator \"/\" with \".\";\n+          #   Removes file extensions.\n+          #   Append \"--tests\" in front of file name.\n+          command: |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcyMzkyNA==", "bodyText": "Done.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437723924", "createdAt": "2020-06-09T21:08:48Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then\n+              ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+            fi\n       - run:\n           name: Run Java unit tests\n           working_directory: ~/workbench/api\n-          command: ./project.rb test\n+          # See: https://circleci.com/docs/2.0/language-java/#sample-configuration\n+          # Short explanation on commands:\n+          #   Find all unit tests recursively in \"api/src/test/java/\" directories.\n+          #   Strips off \"src/test/java/\" substring;\n+          #   Replaces all path separator \"/\" with \".\";\n+          #   Removes file extensions.\n+          #   Append \"--tests\" in front of file name.\n+          command: |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYwNjY0NA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjE4NTA1OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzo0MjoyN1rOGhVbjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDo1MzoyMVrOGhb8Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYwNzMwOA==", "bodyText": "Thinking out loud: Could you make a wrapper command called single_node_run that takes in the command to run (inside the if) as a parameter? Not for this PR.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437607308", "createdAt": "2020-06-09T17:42:27Z", "author": {"login": "jaycarlton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxMzkzMQ==", "bodyText": "yes. it is possible. Command that takes a steps type parameter.\nhttps://circleci.com/docs/2.0/reusing-config/#steps", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437713931", "createdAt": "2020-06-09T20:53:21Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYwNzMwOA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjY3Mjc3OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDowNzowNVrOGhaUIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMToxMTo0N1rOGhcojw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4NzMyOA==", "bodyText": "FYI, if you're testing this, note that this command isn't doing anything right now. https://precisionmedicineinitiative.atlassian.net/browse/RW-5073. No change is needed here, though.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437687328", "createdAt": "2020-06-09T20:07:05Z", "author": {"login": "jaycarlton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then\n+              ./project.rb validate-swagger --project-prop verboseTestLogging=yes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcyNTMyNw==", "bodyText": "good to know.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437725327", "createdAt": "2020-06-09T21:11:47Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then\n+              ./project.rb validate-swagger --project-prop verboseTestLogging=yes", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4NzMyOA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjY3NjY1OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDowODoxN1rOGhaWiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMTowOTo1OVrOGhclLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4Nzk0NA==", "bodyText": "nit: Can you move the java & gradle version checks to their own step if they're necessary? I guess I was thinking that's specified by the image, so maybe we don't need it here too?", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437687944", "createdAt": "2020-06-09T20:08:17Z", "author": {"login": "jaycarlton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then\n+              ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+            fi\n       - run:\n           name: Run Java unit tests\n           working_directory: ~/workbench/api\n-          command: ./project.rb test\n+          # See: https://circleci.com/docs/2.0/language-java/#sample-configuration\n+          # Short explanation on commands:\n+          #   Find all unit tests recursively in \"api/src/test/java/\" directories.\n+          #   Strips off \"src/test/java/\" substring;\n+          #   Replaces all path separator \"/\" with \".\";\n+          #   Removes file extensions.\n+          #   Append \"--tests\" in front of file name.\n+          command: |\n+            CLASSNAMES=$(circleci tests glob \"src/test/java/**/*Test.java\" \"src/test/java/**/*Test.kt\" \\\n+              | cut -c 1- \\\n+              | sed 's@src/test/java/@@' \\\n+              | sed 's@/@.@g' \\\n+              | sed 's/\\.[^.]*$//' \\\n+              | circleci tests split --split-by=timings --timings-type=classname --index=$CIRCLE_NODE_INDEX)\n+            GRADLE_ARGS=$(echo $CLASSNAMES | awk '{for (i=1; i<=NF; i++) print \"--tests\", $i}')\n+            java -version && gradle -v && gradle test $GRADLE_ARGS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcyNDQ2Mw==", "bodyText": "removed java -version && gradle -v substring. I thought it would be good to have for info, but you're right, it is already in docker image. No need to show here.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437724463", "createdAt": "2020-06-09T21:09:59Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -298,18 +299,43 @@ jobs:\n       - run:\n           name: Validate Swagger definitions\n           working_directory: ~/workbench/api\n-          command: ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+          command: |\n+            if [ \"$CIRCLE_NODE_INDEX\" == 0 ]; then\n+              ./project.rb validate-swagger --project-prop verboseTestLogging=yes\n+            fi\n       - run:\n           name: Run Java unit tests\n           working_directory: ~/workbench/api\n-          command: ./project.rb test\n+          # See: https://circleci.com/docs/2.0/language-java/#sample-configuration\n+          # Short explanation on commands:\n+          #   Find all unit tests recursively in \"api/src/test/java/\" directories.\n+          #   Strips off \"src/test/java/\" substring;\n+          #   Replaces all path separator \"/\" with \".\";\n+          #   Removes file extensions.\n+          #   Append \"--tests\" in front of file name.\n+          command: |\n+            CLASSNAMES=$(circleci tests glob \"src/test/java/**/*Test.java\" \"src/test/java/**/*Test.kt\" \\\n+              | cut -c 1- \\\n+              | sed 's@src/test/java/@@' \\\n+              | sed 's@/@.@g' \\\n+              | sed 's/\\.[^.]*$//' \\\n+              | circleci tests split --split-by=timings --timings-type=classname --index=$CIRCLE_NODE_INDEX)\n+            GRADLE_ARGS=$(echo $CLASSNAMES | awk '{for (i=1; i<=NF; i++) print \"--tests\", $i}')\n+            java -version && gradle -v && gradle test $GRADLE_ARGS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4Nzk0NA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjY3ODM4OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDowODo1M1rOGhaXtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMTozODoxNFrOGhdXzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4ODI0NA==", "bodyText": "nit: is there a better name for ui-build-test?", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437688244", "createdAt": "2020-06-09T20:08:53Z", "author": {"login": "jaycarlton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -561,7 +587,7 @@ workflows:\n       # Always run basic test/lint/compilation (open PRs, master merge).\n       # Note: by default tags are not picked up.\n       - api-local-test\n-      - api-build-test\n+      - api-unit-test\n       - ui-build-test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcyNDk4NQ==", "bodyText": "\ud83e\udd14 ui-bvt? At IBM, BVT is universally accepted short name for \"Build Verification Tests\". But word of caution, I don't find any team in Broad use it.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437724985", "createdAt": "2020-06-09T21:10:58Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -561,7 +587,7 @@ workflows:\n       # Always run basic test/lint/compilation (open PRs, master merge).\n       # Note: by default tags are not picked up.\n       - api-local-test\n-      - api-build-test\n+      - api-unit-test\n       - ui-build-test", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4ODI0NA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNTAyNA==", "bodyText": "I think build is implied. I don't know of any non-build tests we'd be doing here (except linting).\nWhat do you call this suite? Maybe angular-test?", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437735024", "createdAt": "2020-06-09T21:32:45Z", "author": {"login": "jaycarlton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -561,7 +587,7 @@ workflows:\n       # Always run basic test/lint/compilation (open PRs, master merge).\n       # Note: by default tags are not picked up.\n       - api-local-test\n-      - api-build-test\n+      - api-unit-test\n       - ui-build-test", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4ODI0NA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNzIwOA==", "bodyText": "It checks for both compilation and runs the unit tests. Full compilation is not required to run the unit tests, so I don't agree that it's implicit, though I'd be fine with just ui-test. angular-test would be inaccurate.", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437737208", "createdAt": "2020-06-09T21:37:44Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -561,7 +587,7 @@ workflows:\n       # Always run basic test/lint/compilation (open PRs, master merge).\n       # Note: by default tags are not picked up.\n       - api-local-test\n-      - api-build-test\n+      - api-unit-test\n       - ui-build-test", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4ODI0NA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNzQyMA==", "bodyText": "I see the other was renamed to unit. That would be fine here as well, ui-unit-test", "url": "https://github.com/all-of-us/workbench/pull/3654#discussion_r437737420", "createdAt": "2020-06-09T21:38:14Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -561,7 +587,7 @@ workflows:\n       # Always run basic test/lint/compilation (open PRs, master merge).\n       # Note: by default tags are not picked up.\n       - api-local-test\n-      - api-build-test\n+      - api-unit-test\n       - ui-build-test", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4ODI0NA=="}, "originalCommit": {"oid": "2625fafe2fb6ff572616b12dcb6ad36ec9da40e4"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2773, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}