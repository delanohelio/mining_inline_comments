{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NjQ1NTk1", "number": 3832, "title": "[no ticket][risk=no] Puppeteer: parameterize getPropValue function", "bodyText": "Code improvement:\n\nParameterize getPropValue<T>() function in element-utils.ts so it can be used widely to reduce code duplication.\nGet rid of Promise<unknown> as functions' return type.\n\nUnrelated code mistake fix:\n\nRemoved await from non-async calls like page.url().\n\nNo change to tests and functions' behavior.", "createdAt": "2020-07-25T17:56:34Z", "url": "https://github.com/all-of-us/workbench/pull/3832", "merged": true, "mergeCommit": {"oid": "40887affc2301c096119515224608a6e907ea750"}, "closed": true, "closedAt": "2020-08-04T18:01:58Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5C1MwgFqTQ1NTgxNjYwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7qBm7gFqTQ2MTAxNTQ1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1ODE2NjA3", "url": "https://github.com/all-of-us/workbench/pull/3832#pullrequestreview-455816607", "createdAt": "2020-07-27T14:08:32Z", "commit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNDowODozMlrOG3kINg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNDowOToxM1rOG3kKLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxNjc5MA==", "bodyText": "non-async functions, await not needed.", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r460916790", "createdAt": "2020-07-27T14:08:32Z", "author": {"login": "aweng98"}, "path": "e2e/jest.test-setup.ts", "diffHunk": "@@ -15,8 +15,8 @@ const timeOut = parseInt(process.env.PUPPETEER_TIMEOUT, 10) || 90000;\n beforeEach(async () => {\n   await page.setUserAgent(userAgent);\n   // See https://github.com/puppeteer/puppeteer/blob/master/docs/api.md#pagesetdefaultnavigationtimeouttimeout\n-  await page.setDefaultNavigationTimeout(navTimeOut);\n-  await page.setDefaultTimeout(timeOut);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxNzI5Mg==", "bodyText": "page.url() is also non-async call. removed await here and several other places.", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r460917292", "createdAt": "2020-07-27T14:09:13Z", "author": {"login": "aweng98"}, "path": "e2e/tests/cohorts/cohorts-create.spec.ts", "diffHunk": "@@ -121,7 +121,7 @@ describe('User can create new Cohorts', () => {\n     const dataPage = new DataPage(page);\n \n     // Save url\n-    const workspaceDataUrl = await page.url();\n+    const workspaceDataUrl = page.url();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTMwODgx", "url": "https://github.com/all-of-us/workbench/pull/3832#pullrequestreview-460930881", "createdAt": "2020-08-04T15:34:07Z", "commit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNTozNDowN1rOG7l84w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNTozNjo1MVrOG7mEWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0MDk2Mw==", "bodyText": "What does link argument name mean in this context? Maybe it should be renamed to el for consistency with attr.\nAm I right in assessing that this function is basically designed to have Puppeteer evaluate the ElementHandle into an actual Element which is then used to return the attribute value?", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465140963", "createdAt": "2020-08-04T15:34:07Z", "author": {"login": "gjuggler"}, "path": "e2e/utils/element-utils.ts", "diffHunk": "@@ -7,24 +7,24 @@ import {ElementHandle, JSHandle, Page} from 'puppeteer';\n  * @param {string} attribute Attribute name.\n  */\n export const getAttrValue = async (page: Page, element: ElementHandle, attribute: string): Promise<string> => {\n-  return page.evaluate((link, attr) => link.getAttribute(attr), element, attribute);\n+  return page.evaluate((link, attr) => {return link.getAttribute(attr)}, element, attribute);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0Mjg3Mg==", "bodyText": "What is the purpose of this change? This seems like the opposite syntax compared to the method above.", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465142872", "createdAt": "2020-08-04T15:36:51Z", "author": {"login": "gjuggler"}, "path": "e2e/utils/element-utils.ts", "diffHunk": "@@ -7,24 +7,24 @@ import {ElementHandle, JSHandle, Page} from 'puppeteer';\n  * @param {string} attribute Attribute name.\n  */\n export const getAttrValue = async (page: Page, element: ElementHandle, attribute: string): Promise<string> => {\n-  return page.evaluate((link, attr) => link.getAttribute(attr), element, attribute);\n+  return page.evaluate((link, attr) => {return link.getAttribute(attr)}, element, attribute);\n }\n \n /**\n  * Gets the property value.\n  * @param {ElementHandle} element Element.\n  * @param {string} property Property name.\n  */\n-export const getPropValue = async (element: ElementHandle, property: string): Promise<string> => {\n+export async function getPropValue<T> (element: ElementHandle, property: string): Promise<T> {\n   const value = await element.getProperty(property).then((prop) => prop.jsonValue());\n-  return value.toString().trim();\n+  return value as T;\n }\n \n /*\n  * Wait until the existing element changed in DOM.\n  * @param {Page} page Instance of Puppeteer page object.\n  * @param {ElementHandle} element Element.\n  */\n-export async function waitUntilChanged(page: Page, element: ElementHandle): Promise<JSHandle> {\n+export const waitUntilChanged = async (page: Page, element: ElementHandle): Promise<JSHandle> => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3e098e10ab644babe2b37ce4d2fafa3f6a915a21", "committedDate": "2020-07-25T19:57:15Z", "message": "one change"}, "afterCommit": {"oid": "45f567bddf2591d6a6622b2a3c29642728b51076", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/45f567bddf2591d6a6622b2a3c29642728b51076", "committedDate": "2020-08-04T17:09:33Z", "message": "refactor getPropValue function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2631f9ad2a7fe5b3e9a3af88bea8f090137d472", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e2631f9ad2a7fe5b3e9a3af88bea8f090137d472", "committedDate": "2020-08-04T17:14:21Z", "message": "refactor getPropValue function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "committedDate": "2020-08-04T17:20:55Z", "message": "PR feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45f567bddf2591d6a6622b2a3c29642728b51076", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/45f567bddf2591d6a6622b2a3c29642728b51076", "committedDate": "2020-08-04T17:09:33Z", "message": "refactor getPropValue function"}, "afterCommit": {"oid": "5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/5ace9f73733d789e57eaf8cefbbc1c5cba46145a", "committedDate": "2020-08-04T17:20:55Z", "message": "PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDE1NDU4", "url": "https://github.com/all-of-us/workbench/pull/3832#pullrequestreview-461015458", "createdAt": "2020-08-04T17:19:05Z", "commit": {"oid": "45f567bddf2591d6a6622b2a3c29642728b51076"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNzoxOTowNVrOG7qAPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNzoyMToxNFrOG7qFCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwNzM1Nw==", "bodyText": "\ud83d\udc4d renamed link to elemt for consistency.\nand yes to the second question, the evaluate function does just that.", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465207357", "createdAt": "2020-08-04T17:19:05Z", "author": {"login": "aweng98"}, "path": "e2e/utils/element-utils.ts", "diffHunk": "@@ -7,24 +7,24 @@ import {ElementHandle, JSHandle, Page} from 'puppeteer';\n  * @param {string} attribute Attribute name.\n  */\n export const getAttrValue = async (page: Page, element: ElementHandle, attribute: string): Promise<string> => {\n-  return page.evaluate((link, attr) => link.getAttribute(attr), element, attribute);\n+  return page.evaluate((link, attr) => {return link.getAttribute(attr)}, element, attribute);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0MDk2Mw=="}, "originalCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwODU4Nw==", "bodyText": "forgot to change it back. I was experimenting.", "url": "https://github.com/all-of-us/workbench/pull/3832#discussion_r465208587", "createdAt": "2020-08-04T17:21:14Z", "author": {"login": "aweng98"}, "path": "e2e/utils/element-utils.ts", "diffHunk": "@@ -7,24 +7,24 @@ import {ElementHandle, JSHandle, Page} from 'puppeteer';\n  * @param {string} attribute Attribute name.\n  */\n export const getAttrValue = async (page: Page, element: ElementHandle, attribute: string): Promise<string> => {\n-  return page.evaluate((link, attr) => link.getAttribute(attr), element, attribute);\n+  return page.evaluate((link, attr) => {return link.getAttribute(attr)}, element, attribute);\n }\n \n /**\n  * Gets the property value.\n  * @param {ElementHandle} element Element.\n  * @param {string} property Property name.\n  */\n-export const getPropValue = async (element: ElementHandle, property: string): Promise<string> => {\n+export async function getPropValue<T> (element: ElementHandle, property: string): Promise<T> {\n   const value = await element.getProperty(property).then((prop) => prop.jsonValue());\n-  return value.toString().trim();\n+  return value as T;\n }\n \n /*\n  * Wait until the existing element changed in DOM.\n  * @param {Page} page Instance of Puppeteer page object.\n  * @param {ElementHandle} element Element.\n  */\n-export async function waitUntilChanged(page: Page, element: ElementHandle): Promise<JSHandle> {\n+export const waitUntilChanged = async (page: Page, element: ElementHandle): Promise<JSHandle> => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0Mjg3Mg=="}, "originalCommit": {"oid": "3e098e10ab644babe2b37ce4d2fafa3f6a915a21"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4503, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}