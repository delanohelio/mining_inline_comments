{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMzU3MTMw", "number": 3602, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozNzoxMFrOEAIE8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozODo1NFrOEAII-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTY3NzkyOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/api/OfflineClusterController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozNzoxMFrOGbNkjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozNzoxMFrOGbNkjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4NzA4NQ==", "bodyText": "The finalpalooza here is to highlight the not-final counting vars.", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431187085", "createdAt": "2020-05-27T14:37:10Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/api/OfflineClusterController.java", "diffHunk": "@@ -65,16 +64,16 @@\n    * <p>As an App Engine cron endpoint, the runtime of this method may not exceed 10 minutes.\n    */\n   @Override\n-  public ResponseEntity<CheckClustersResponse> checkClusters() {\n-    Instant now = clock.instant();\n-    WorkbenchConfig config = configProvider.get();\n-    Duration maxAge = Duration.ofDays(config.firecloud.clusterMaxAgeDays);\n-    Duration idleMaxAge = Duration.ofDays(config.firecloud.clusterIdleMaxAgeDays);\n+  public ResponseEntity<Void> checkClusters() {\n+    final Instant now = clock.instant();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "343b81803451c63c88f48de3c94a84de5a85244c"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTY4MjY2OnYy", "diffSide": "LEFT", "path": "api/src/main/java/org/pmiops/workbench/billing/OfflineBillingController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozNzo1MlrOGbNnhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozNzo1MlrOGbNnhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4Nzg0NQ==", "bodyText": "This metric was no longer in use now that we have a general operation time metric.", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431187845", "createdAt": "2020-05-27T14:37:52Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/billing/OfflineBillingController.java", "diffHunk": "@@ -38,16 +35,6 @@\n   @Override\n   public ResponseEntity<Void> bufferBillingProjects() {\n     billingProjectBufferService.bufferBillingProjects();\n-    // TODO(jaycarlton) we're going to need a richer framework for cron reporting,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "343b81803451c63c88f48de3c94a84de5a85244c"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTY4ODI0OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/pmiops/workbench/api/OfflineClusterControllerTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDozODo1NFrOGbNrDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNzo1MzoxNFrOGbWhfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODc1MQ==", "bodyText": "I don't actually understand how this worked before. We were effectively treating it like a mock and it was happy, but it wasn't declared as a mock...", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431188751", "createdAt": "2020-05-27T14:38:54Z", "author": {"login": "jaycarlton"}, "path": "api/src/test/java/org/pmiops/workbench/api/OfflineClusterControllerTest.java", "diffHunk": "@@ -61,16 +54,20 @@ Clock clock() {\n \n     @Bean\n     public WorkbenchConfig workbenchConfig() {\n-      WorkbenchConfig config = new WorkbenchConfig();\n-      config.firecloud = new WorkbenchConfig.FireCloudConfig();\n+      WorkbenchConfig config = WorkbenchConfig.createEmptyConfig();\n+      config.firecloud = new FireCloudConfig();\n       config.firecloud.clusterMaxAgeDays = (int) MAX_AGE.toDays();\n       config.firecloud.clusterIdleMaxAgeDays = (int) IDLE_MAX_AGE.toDays();\n       return config;\n     }\n   }\n \n-  @Autowired ClusterApi clusterApi;\n-  @Autowired OfflineClusterController controller;\n+  @Qualifier(NotebooksConfig.SERVICE_CLUSTER_API)\n+  @MockBean private ClusterApi mockClusterApi;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "343b81803451c63c88f48de3c94a84de5a85244c"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyODkzNQ==", "bodyText": "It was declared as a mock...", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431328935", "createdAt": "2020-05-27T17:47:56Z", "author": {"login": "calbach"}, "path": "api/src/test/java/org/pmiops/workbench/api/OfflineClusterControllerTest.java", "diffHunk": "@@ -61,16 +54,20 @@ Clock clock() {\n \n     @Bean\n     public WorkbenchConfig workbenchConfig() {\n-      WorkbenchConfig config = new WorkbenchConfig();\n-      config.firecloud = new WorkbenchConfig.FireCloudConfig();\n+      WorkbenchConfig config = WorkbenchConfig.createEmptyConfig();\n+      config.firecloud = new FireCloudConfig();\n       config.firecloud.clusterMaxAgeDays = (int) MAX_AGE.toDays();\n       config.firecloud.clusterIdleMaxAgeDays = (int) IDLE_MAX_AGE.toDays();\n       return config;\n     }\n   }\n \n-  @Autowired ClusterApi clusterApi;\n-  @Autowired OfflineClusterController controller;\n+  @Qualifier(NotebooksConfig.SERVICE_CLUSTER_API)\n+  @MockBean private ClusterApi mockClusterApi;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODc1MQ=="}, "originalCommit": {"oid": "343b81803451c63c88f48de3c94a84de5a85244c"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMzMzc1OA==", "bodyText": "Oh I see. That makes sense.", "url": "https://github.com/all-of-us/workbench/pull/3602#discussion_r431333758", "createdAt": "2020-05-27T17:53:14Z", "author": {"login": "jaycarlton"}, "path": "api/src/test/java/org/pmiops/workbench/api/OfflineClusterControllerTest.java", "diffHunk": "@@ -61,16 +54,20 @@ Clock clock() {\n \n     @Bean\n     public WorkbenchConfig workbenchConfig() {\n-      WorkbenchConfig config = new WorkbenchConfig();\n-      config.firecloud = new WorkbenchConfig.FireCloudConfig();\n+      WorkbenchConfig config = WorkbenchConfig.createEmptyConfig();\n+      config.firecloud = new FireCloudConfig();\n       config.firecloud.clusterMaxAgeDays = (int) MAX_AGE.toDays();\n       config.firecloud.clusterIdleMaxAgeDays = (int) IDLE_MAX_AGE.toDays();\n       return config;\n     }\n   }\n \n-  @Autowired ClusterApi clusterApi;\n-  @Autowired OfflineClusterController controller;\n+  @Qualifier(NotebooksConfig.SERVICE_CLUSTER_API)\n+  @MockBean private ClusterApi mockClusterApi;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODc1MQ=="}, "originalCommit": {"oid": "343b81803451c63c88f48de3c94a84de5a85244c"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2695, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}