{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MDYyOTA1", "number": 4373, "title": "[RW-6021][risk=low] Pulling workspace free tier usage into reporting", "bodyText": "Update: For the most part, free tier usage is a separate table as an internal implementation detail - so initially I used a JOIN. However, in the spirit of the reporting design, I will export this as a separate table instead - though I don't love exposing such a raw mapping to external consumers as it makes us less flexible to change our implementation later. The ship has already sailed on this as we've started shipping internal IDs over as well. This PR was also updated to reflect the new row mapping pattern.\nI'm updating the companion PR to this to reflect the new changes as well: all-of-us/workbench-terraform-modules#9", "createdAt": "2020-12-08T01:54:06Z", "url": "https://github.com/all-of-us/workbench/pull/4373", "merged": true, "mergeCommit": {"oid": "3ace4c01291052a34cb1f294ef9c6d8745b41f7a"}, "closed": true, "closedAt": "2021-01-09T00:13:09Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkApW8gFqTU0NjY4NjU2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdt6NXNgH2gAyNTM0MDYyOTA1OjU1MDEzYmRkMmIxMTU5YTE0ZWZkOGJjOGRhMmUyOWU0ZWRjMjc0Zjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2Njg2NTY2", "url": "https://github.com/all-of-us/workbench/pull/4373#pullrequestreview-546686566", "createdAt": "2020-12-08T01:57:57Z", "commit": {"oid": "e47437d6e4c6a5f64084ffc3445c1e9c9602ab0a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMTo1Nzo1N1rOIBDUHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMTo1OToxOVrOIBDWEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk3Mzc5MQ==", "bodyText": "I was using left outer join elsewhere, but this may be the same difference.", "url": "https://github.com/all-of-us/workbench/pull/4373#discussion_r537973791", "createdAt": "2020-12-08T01:57:57Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/db/dao/WorkspaceDao.java", "diffHunk": "@@ -122,8 +122,10 @@ default void updateBillingStatus(long workspaceId, BillingStatus status) {\n           + \"  w.scientificApproach AS rpScientificApproach,\\n\"\n           + \"  w.socialBehavioral AS rpSocialBehavioral,\\n\"\n           + \"  w.timeRequested AS rpTimeRequested,\\n\"\n-          + \"  w.workspaceId\\n\"\n+          + \"  w.workspaceId,\\n\"\n+          + \"  ft.cost as freeTierBillingUsage\\n\"\n           + \"FROM DbWorkspace w\\n\"\n+          + \"LEFT JOIN w.freeTierUsage ft\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e47437d6e4c6a5f64084ffc3445c1e9c9602ab0a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk3NDI4OQ==", "bodyText": "These classes are deprecated in favor of direct queries and RowMappers, but go ahead and use them since you're outrunning me.", "url": "https://github.com/all-of-us/workbench/pull/4373#discussion_r537974289", "createdAt": "2020-12-08T01:59:19Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/db/dao/projection/ProjectedReportingWorkspace.java", "diffHunk": "@@ -72,4 +72,6 @@\n   Timestamp getRpTimeRequested();\n \n   Long getWorkspaceId();\n+\n+  Double getFreeTierBillingUsage();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e47437d6e4c6a5f64084ffc3445c1e9c9602ab0a"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1263b576f5bd21008f2db6fbcebfe8f0ed1d2387", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/1263b576f5bd21008f2db6fbcebfe8f0ed1d2387", "committedDate": "2020-12-09T00:47:05Z", "message": "Extract, type fix, test"}, "afterCommit": {"oid": "bdc4ea4f58ae3e3b248882b746559bee7169b722", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/bdc4ea4f58ae3e3b248882b746559bee7169b722", "committedDate": "2020-12-09T00:49:36Z", "message": "Extract, type fix, test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzAxMjA0", "url": "https://github.com/all-of-us/workbench/pull/4373#pullrequestreview-549701204", "createdAt": "2020-12-10T23:47:02Z", "commit": {"oid": "7407743f8fac5552acb3aabddb17147719bf68aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a1b57c002e36d04d8883992e5d54ff9969dddd1", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/2a1b57c002e36d04d8883992e5d54ff9969dddd1", "committedDate": "2021-01-06T01:20:35Z", "message": "Try pulling free tier usage into reporting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "817ee723f3b615e6dfaca50552818242887c5791", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/817ee723f3b615e6dfaca50552818242887c5791", "committedDate": "2021-01-06T01:21:18Z", "message": "Extract, type fix, test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48c8e719a20682d1f92f2916723140eb89ab621", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/d48c8e719a20682d1f92f2916723140eb89ab621", "committedDate": "2021-01-06T01:21:18Z", "message": ":facepalm:"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63097f6ee1658a4c18f749e58deadf7d5144c49c", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/63097f6ee1658a4c18f749e58deadf7d5144c49c", "committedDate": "2021-01-06T01:21:36Z", "message": "Test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf4e97746dcb09fc637f62561dbc119f731a33bd", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/bf4e97746dcb09fc637f62561dbc119f731a33bd", "committedDate": "2021-01-06T02:23:12Z", "message": "Switch to separate table"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7407743f8fac5552acb3aabddb17147719bf68aa", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/7407743f8fac5552acb3aabddb17147719bf68aa", "committedDate": "2020-12-09T01:47:06Z", "message": "Test fixes"}, "afterCommit": {"oid": "bf4e97746dcb09fc637f62561dbc119f731a33bd", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/bf4e97746dcb09fc637f62561dbc119f731a33bd", "committedDate": "2021-01-06T02:23:12Z", "message": "Switch to separate table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41adae004bcf11cb582f9355d8471414aa433f79", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/41adae004bcf11cb582f9355d8471414aa433f79", "committedDate": "2021-01-06T02:24:33Z", "message": "More revets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyNzkyNjY0", "url": "https://github.com/all-of-us/workbench/pull/4373#pullrequestreview-562792664", "createdAt": "2021-01-06T15:19:49Z", "commit": {"oid": "41adae004bcf11cb582f9355d8471414aa433f79"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxNToxOTo0OVrOIPGm-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxNToyMToxN1rOIPGsRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjcwNzgzNQ==", "bodyText": "nit: add units, \"in USD\"", "url": "https://github.com/all-of-us/workbench/pull/4373#discussion_r552707835", "createdAt": "2021-01-06T15:19:49Z", "author": {"login": "gjuggler"}, "path": "api/reporting/schemas/input/descriptions/workspace_free_tier_usage.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+workspace_free_tier_usage:\n+  user_id: |\n+    ID of the user whose free tier quota was billed for this workspace.\n+  workspace_id: |\n+    ID of the workspace associated with this free tier cost.\n+  cost: |\n+    Free tier usage cost for this workspace.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41adae004bcf11cb582f9355d8471414aa433f79"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjcwOTE4OQ==", "bodyText": "This seems related to the old approach of joining it into the workspace table \u2013 remove?", "url": "https://github.com/all-of-us/workbench/pull/4373#discussion_r552709189", "createdAt": "2021-01-06T15:21:17Z", "author": {"login": "gjuggler"}, "path": "api/reporting/schemas/input/descriptions/workspace.yaml", "diffHunk": "@@ -14,6 +14,9 @@ workspace:\n       User ID of user who initially created this workspace.\n   disseminate_research_other: |\n       Description of user-defined research dissemination option.\n+  free_tier_billing_usage: |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41adae004bcf11cb582f9355d8471414aa433f79"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55b2b30a0adbeb6183e09d0d3daf98beed22eb00", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/55b2b30a0adbeb6183e09d0d3daf98beed22eb00", "committedDate": "2021-01-07T00:24:02Z", "message": "in USD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b4c961dc2ea4c58896c44bc11f2d3a7c5972ca8", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/9b4c961dc2ea4c58896c44bc11f2d3a7c5972ca8", "committedDate": "2021-01-07T20:00:25Z", "message": "Way more touchpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55013bdd2b1159a14efd8bc8da2e29e4edc274f8", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/55013bdd2b1159a14efd8bc8da2e29e4edc274f8", "committedDate": "2021-01-07T20:32:55Z", "message": "Test fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3733, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}