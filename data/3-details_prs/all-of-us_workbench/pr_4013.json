{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MDMxMTMx", "number": 4013, "title": "[risk=high][RW-5478] Admin View Notebook page", "bodyText": "Description:\n\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-09-16T14:29:13Z", "url": "https://github.com/all-of-us/workbench/pull/4013", "merged": true, "mergeCommit": {"oid": "2c1d910af3990c5196991cfd43d7f7e2b0296150"}, "closed": true, "closedAt": "2020-09-17T15:25:38Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJbbcbAH2gAyNDg4MDMxMTMxOjEwMDkwODhhYjRkNzk3ZWQwNjYyMWI2ZWE1OTZkMmI5MDJiOWU5NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJyjqzAH2gAyNDg4MDMxMTMxOmI5ODc3OGJmOTM1YjBmZmFhZDFkM2FjYzc4ODg1MGMzMzk0ZTUxZGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1009088ab4d797ed06621b6ea596d2b902b9e942", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1009088ab4d797ed06621b6ea596d2b902b9e942", "committedDate": "2020-09-16T12:19:58Z", "message": "Remove workspaceName parameter from adminReadOnlyNotebook"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f8efebb9bc733a72ed7a758570294e6883aa7df", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3f8efebb9bc733a72ed7a758570294e6883aa7df", "committedDate": "2020-09-16T12:19:59Z", "message": "AdminNotebookView"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "561345411f4776af9bf4b3f0f599dd8f8e74fb73", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/561345411f4776af9bf4b3f0f599dd8f8e74fb73", "committedDate": "2020-09-16T12:19:59Z", "message": "basically works!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4b648d92de3879e108525af2b1c8e8de50a250c", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b4b648d92de3879e108525af2b1c8e8de50a250c", "committedDate": "2020-09-16T13:05:19Z", "message": "add header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11823c188c0cb9a763edfa371cf1b25bc34e441b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/11823c188c0cb9a763edfa371cf1b25bc34e441b", "committedDate": "2020-09-16T13:13:23Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b3f464626c75e47c6dcd8b4d46eb73483675fe5", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9b3f464626c75e47c6dcd8b4d46eb73483675fe5", "committedDate": "2020-09-16T13:35:04Z", "message": "Error on no accessQuery param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e009c9ab1a0e1d6d0fab4e2a4ee42a9befe5494e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e009c9ab1a0e1d6d0fab4e2a4ee42a9befe5494e", "committedDate": "2020-09-16T13:43:04Z", "message": "reuse errorMessage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb", "committedDate": "2020-09-16T14:27:55Z", "message": "combine effects and add spinner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Njg3MzY2", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-489687366", "createdAt": "2020-09-16T14:30:35Z", "commit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMDozNVrOHSztdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMDozNVrOHSztdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4MzYzNg==", "bodyText": "Workspace name (firecloud name, no spaces) is not strictly necessary, and is also not immediately available to the UI page", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489483636", "createdAt": "2020-09-16T14:30:35Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -59,13 +59,9 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n   @Override\n   @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n   public ResponseEntity<ReadOnlyNotebookResponse> adminReadOnlyNotebook(\n-      String workspaceNamespace,\n-      String workspaceName,\n-      String notebookName,\n-      AccessReason accessReason) {\n+      String workspaceNamespace, String notebookName, AccessReason accessReason) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Njg4NTky", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-489688592", "createdAt": "2020-09-16T14:31:48Z", "commit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMTo0OFrOHSzxPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMTo0OFrOHSzxPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NDYwNA==", "bodyText": "split out as a method because it's now needed in 3 places", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489484604", "createdAt": "2020-09-16T14:31:48Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -162,12 +162,7 @@ public CloudStorageTraffic getCloudStorageTraffic(String workspaceNamespace) {\n \n   @Override\n   public WorkspaceAdminView getWorkspaceAdminView(String workspaceNamespace) {\n-    final DbWorkspace dbWorkspace =\n-        getFirstWorkspaceByNamespace(workspaceNamespace)\n-            .orElseThrow(\n-                () ->\n-                    new NotFoundException(\n-                        String.format(\"No workspace found for namespace %s\", workspaceNamespace)));\n+    final DbWorkspace dbWorkspace = getWorkspaceByNamespaceOrThrow(workspaceNamespace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NjkwMTM0", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-489690134", "createdAt": "2020-09-16T14:33:16Z", "commit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMzoxNlrOHSz14g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMzoxNlrOHSz14g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA==", "bodyText": "this breaking API change is OK because it was just created and is not yet used", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489485794", "createdAt": "2020-09-16T14:33:16Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16bb1f02355ac162836fc41a24c44bc638937f2f", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/16bb1f02355ac162836fc41a24c44bc638937f2f", "committedDate": "2020-09-16T14:37:06Z", "message": "unused"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2584a0cc85452e414dcfcae8b8f8df31020a01e9", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2584a0cc85452e414dcfcae8b8f8df31020a01e9", "committedDate": "2020-09-16T14:42:36Z", "message": "comment for reactRouterUrlSearchParams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3d4633e26949c63ae952cb02d77391a5b5478919", "committedDate": "2020-09-16T14:43:55Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NzAxODIz", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-489701823", "createdAt": "2020-09-16T14:44:36Z", "commit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0NDozNlrOHS0YQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0NDozNlrOHS0YQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5NDU5NA==", "bodyText": "this might belong elsewhere?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489494594", "createdAt": "2020-09-16T14:44:36Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/utils/navigation.tsx", "diffHunk": "@@ -111,6 +112,17 @@ export const navigateSignOut = (continuePath: string = '/login') => {\n     `https://appengine.google.com/_ah/logout?continue=${window.location.origin}${continuePath}`);\n };\n \n+/**\n+ * Retrieve query parameters from the React Router.\n+ *\n+ * Example:\n+ *  my/query/page?user=alice123\n+ *  reactRouterUrlSearchParams.get('user') -> value is 'alice123'\n+ */\n+export const reactRouterUrlSearchParams = (): URLSearchParams => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NzA3Mjcx", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-489707271", "createdAt": "2020-09-16T14:49:49Z", "commit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0OTo0OVrOHS0o6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0OTo0OVrOHS0o6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5ODg1Nw==", "bodyText": "these are copied from a variety of sources.  The goal here is \"looks OK\" rather than polished", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489498857", "createdAt": "2020-09-16T14:49:49Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,109 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NzA4NTQy", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-489708542", "createdAt": "2020-09-16T14:51:10Z", "commit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo1MToxMFrOHS0swg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo1MToxMFrOHS0swg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5OTg0Mg==", "bodyText": "workspaceName is not immediately available: gets updated when getWorkspaceAdminView() returns", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489499842", "createdAt": "2020-09-16T14:51:10Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,109 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/051e1311bd6482a30be40e55ae77f7d41c8fa99b", "committedDate": "2020-09-16T17:55:42Z", "message": "Don't show spinner and error message at the same time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDAwNTY3", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-490000567", "createdAt": "2020-09-16T20:35:36Z", "commit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDozNTozNlrOHTDR5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo0NDozMlrOHTDjOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTczODcyNg==", "bodyText": "interesting.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489738726", "createdAt": "2020-09-16T20:35:36Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -59,13 +59,9 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n   @Override\n   @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n   public ResponseEntity<ReadOnlyNotebookResponse> adminReadOnlyNotebook(\n-      String workspaceNamespace,\n-      String workspaceName,\n-      String notebookName,\n-      AccessReason accessReason) {\n+      String workspaceNamespace, String notebookName, AccessReason accessReason) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4MzYzNg=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTczOTYyNA==", "bodyText": "Are we sure we'll only ever have one workspace in the namespace?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489739624", "createdAt": "2020-09-16T20:37:23Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MDIxNQ==", "bodyText": "I think you can add a friendly title property to the routeData to give yourself a tab title.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489740215", "createdAt": "2020-09-16T20:38:32Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -98,6 +100,13 @@ export const AppRoutingComponent: React.FunctionComponent<RoutingProps> = ({onSi\n           path='/admin/workspace-audit/:workspaceNamespace'\n           component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}\n       />\n+      <AppRoute", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MDY4Mw==", "bodyText": "please set '' as the default for strings instead of undefined.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489740683", "createdAt": "2020-09-16T20:39:31Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,110 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MTAzNQ==", "bodyText": "nit: Probably want to split the reason onto another line. Can come later with a styling follow-on.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489741035", "createdAt": "2020-09-16T20:40:08Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,110 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;\n+    const link = <a href={`/admin/workspaces/${workspaceNamespace}`}>{location}</a>;\n+\n+    return <div style={styles.heading}>Viewing {nbName} in {link} for reason: {accessReason}</div>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0Mjg1OA==", "bodyText": "nit: please spell out notebookName, since it's not that long and easier to read.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489742858", "createdAt": "2020-09-16T20:43:51Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,110 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;\n+    const link = <a href={`/admin/workspaces/${workspaceNamespace}`}>{location}</a>;\n+\n+    return <div style={styles.heading}>Viewing {nbName} in {link} for reason: {accessReason}</div>;\n+  };\n+\n+  const Main = () => {\n+    if (notebookHtml) {\n+      return <iframe id='notebook-frame' style={styles.notebook} srcDoc={notebookHtml}/>;\n+    } else if (errorMessage) {\n+      return <div style={styles.error}>{errorMessage}</div>;\n+    } else {\n+      return <SpinnerOverlay />;\n+    }\n+  };\n+\n+  useEffect(() => {\n+    workspaceAdminApi().getWorkspaceAdminView(workspaceNamespace)\n+      .then(workspaceAdminView => setWorkspaceName(workspaceAdminView.workspace.name));\n+  }, []);\n+\n+  useEffect(() => {\n+    if (!accessReason || !accessReason.trim()) {\n+      setErrorMessage('Error: must include accessReason query parameter in URL');\n+      return;\n+    }\n+\n+    workspaceAdminApi().adminReadOnlyNotebook(workspaceNamespace, nbName, {reason: accessReason})\n+      .then(response => setHtml(response.html))\n+      .catch((e) => {\n+        if (e.status === 404) {\n+          setErrorMessage(`Notebook ${nbName} was not found`);\n+        } else if (e.status === 412) {\n+          setErrorMessage('Notebook is too large to display in preview mode');\n+        } else {\n+          setErrorMessage('Failed to render notebook preview due to unknown error');\n+        }\n+      });\n+  }, []);\n+\n+  return <React.Fragment>\n+    <Header/>\n+    <Main/>\n+  </React.Fragment>;\n+};\n+\n+const AdminNotebookView = () => {\n+  const {workspaceNamespace, nbName} = useParams();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MzE2Mg==", "bodyText": "I don't even know what this is. @petesantos can you take a quick look at the routey bits?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489743162", "createdAt": "2020-09-16T20:44:32Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/utils/navigation.tsx", "diffHunk": "@@ -111,6 +112,17 @@ export const navigateSignOut = (continuePath: string = '/login') => {\n     `https://appengine.google.com/_ah/logout?continue=${window.location.origin}${continuePath}`);\n };\n \n+/**\n+ * Retrieve query parameters from the React Router.\n+ *\n+ * Example:\n+ *  my/query/page?user=alice123\n+ *  reactRouterUrlSearchParams.get('user') -> value is 'alice123'\n+ */\n+export const reactRouterUrlSearchParams = (): URLSearchParams => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5NDU5NA=="}, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a7411157f5b34ac3dc35c69cff619489996026c", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/0a7411157f5b34ac3dc35c69cff619489996026c", "committedDate": "2020-09-16T21:30:01Z", "message": "init state vars to emptystring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a11863bda2d388bed7c99d4b0734ed6ffc6ac3aa", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/a11863bda2d388bed7c99d4b0734ed6ffc6ac3aa", "committedDate": "2020-09-16T21:31:07Z", "message": "notebookName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47bc440c9ed54a2fc61744db7d317decfe9a913f", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/47bc440c9ed54a2fc61744db7d317decfe9a913f", "committedDate": "2020-09-16T21:41:14Z", "message": "move accessReason to next line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNTk1ODI1", "url": "https://github.com/all-of-us/workbench/pull/4013#pullrequestreview-490595825", "createdAt": "2020-09-17T13:29:55Z", "commit": {"oid": "47bc440c9ed54a2fc61744db7d317decfe9a913f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c51d50ed023c2ae64d52413c3da1280d5d2db0be", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/c51d50ed023c2ae64d52413c3da1280d5d2db0be", "committedDate": "2020-09-17T15:14:37Z", "message": "update error styling and workspace text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b98778bf935b0ffaad1d3acc788850c3394e51da", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b98778bf935b0ffaad1d3acc788850c3394e51da", "committedDate": "2020-09-17T15:16:46Z", "message": "90% whiteness"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4251, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}