{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzU2MjI1", "number": 3481, "title": "[RW-4820][risk=no] Text area with length limits", "bodyText": "PR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally", "createdAt": "2020-04-24T20:42:24Z", "url": "https://github.com/all-of-us/workbench/pull/3481", "merged": true, "mergeCommit": {"oid": "dcc9052b73122da7cbb5181ed82c27df75246158"}, "closed": true, "closedAt": "2020-04-24T21:38:02Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca32xXgFqTQwMDI2MzE5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABca4UbzgH2gAyNDA4NzU2MjI1OjYwNzJlNjFkNDM0NzZlZjIyNTVmOTRlYTYzZThkZTliZDkxZDU0ZmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjYzMTkw", "url": "https://github.com/all-of-us/workbench/pull/3481#pullrequestreview-400263190", "createdAt": "2020-04-24T20:52:42Z", "commit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1Mjo0MlrOGLoztA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1Mjo0MlrOGLoztA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjExNg==", "bodyText": "nit: Extract Style", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856116", "createdAt": "2020-04-24T20:52:42Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/components/inputs.tsx", "diffHunk": "@@ -82,6 +83,132 @@ export const ValidationError = ({children}) => {\n   >{children}</div>;\n };\n \n+export const TextArea = ({style = {}, onChange, ...props}) => {\n+  return <textarea\n+      {...props}\n+      onChange={onChange ? (e => onChange(e.target.value)) : undefined}\n+      style={{\n+        width: '100%',\n+        borderColor: inputBorderColor, borderWidth: 1, borderStyle: 'solid', borderRadius: 3,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjYzNTYx", "url": "https://github.com/all-of-us/workbench/pull/3481#pullrequestreview-400263561", "createdAt": "2020-04-24T20:53:25Z", "commit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1MzoyNVrOGLo1KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1MzoyNVrOGLo1KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjQ4OQ==", "bodyText": "nit: extract style", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856489", "createdAt": "2020-04-24T20:53:25Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/components/inputs.tsx", "diffHunk": "@@ -82,6 +83,132 @@ export const ValidationError = ({children}) => {\n   >{children}</div>;\n };\n \n+export const TextArea = ({style = {}, onChange, ...props}) => {\n+  return <textarea\n+      {...props}\n+      onChange={onChange ? (e => onChange(e.target.value)) : undefined}\n+      style={{\n+        width: '100%',\n+        borderColor: inputBorderColor, borderWidth: 1, borderStyle: 'solid', borderRadius: 3,\n+        padding: '0.25rem 0.5rem',\n+        backgroundColor: colors.white,\n+        ...style\n+      }}\n+  />;\n+};\n+\n+interface TextAreaWithLengthValidationMessageProps {\n+  id: string;\n+  initialText: string;\n+  maxCharacters: number;\n+  tooLongWarningCharacters: number;\n+  onChange: (s: string) => void;\n+  tooShortWarningCharacters?: number;\n+  tooShortWarning?: string;\n+}\n+\n+interface TextAreaWithLengthValidationMessageState {\n+  showTooShortWarning: boolean;\n+  text: string;\n+}\n+\n+export class TextAreaWithLengthValidationMessage extends React.Component<\n+  TextAreaWithLengthValidationMessageProps,\n+  TextAreaWithLengthValidationMessageState\n+> {\n+  constructor(props: TextAreaWithLengthValidationMessageProps) {\n+    super(props);\n+    this.state = {\n+      showTooShortWarning: false,\n+      text: props.initialText\n+    };\n+  }\n+\n+  onTextUpdate(text) {\n+    if (this.state.showTooShortWarning && text.length >= 50) {\n+      this.setState({showTooShortWarning: false});\n+    }\n+    this.setState({text: text});\n+    this.props.onChange(text);\n+  }\n+\n+  updateShowTooShortWarning() {\n+    if (\n+        this.state.text\n+        && this.props.tooShortWarningCharacters\n+        && this.props.tooShortWarning\n+        && this.state.text.length < this.props.tooShortWarningCharacters\n+    ) {\n+      this.setState({showTooShortWarning: true});\n+    } else {\n+      this.setState({showTooShortWarning: false});\n+    }\n+  }\n+\n+  renderCharacterLimitMessage(textColor: string, message: string) {\n+    return <div\n+        data-test-id='characterLimit'\n+        style={{color: textColor, marginLeft: 'auto', flex: '0 0 auto'}}\n+    >\n+      {message}\n+    </div>;\n+  }\n+\n+  render() {\n+    const {id, maxCharacters, tooShortWarning} = this.props;\n+    const {showTooShortWarning, text} = this.state;\n+\n+    return <React.Fragment>\n+      <TextArea\n+          style={{\n+            height: '15rem',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjYzNzYz", "url": "https://github.com/all-of-us/workbench/pull/3481#pullrequestreview-400263763", "createdAt": "2020-04-24T20:53:46Z", "commit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1Mzo0NlrOGLo11A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1Mzo0NlrOGLo11A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjY2MA==", "bodyText": "nit: extract style", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414856660", "createdAt": "2020-04-24T20:53:46Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/components/inputs.tsx", "diffHunk": "@@ -82,6 +83,132 @@ export const ValidationError = ({children}) => {\n   >{children}</div>;\n };\n \n+export const TextArea = ({style = {}, onChange, ...props}) => {\n+  return <textarea\n+      {...props}\n+      onChange={onChange ? (e => onChange(e.target.value)) : undefined}\n+      style={{\n+        width: '100%',\n+        borderColor: inputBorderColor, borderWidth: 1, borderStyle: 'solid', borderRadius: 3,\n+        padding: '0.25rem 0.5rem',\n+        backgroundColor: colors.white,\n+        ...style\n+      }}\n+  />;\n+};\n+\n+interface TextAreaWithLengthValidationMessageProps {\n+  id: string;\n+  initialText: string;\n+  maxCharacters: number;\n+  tooLongWarningCharacters: number;\n+  onChange: (s: string) => void;\n+  tooShortWarningCharacters?: number;\n+  tooShortWarning?: string;\n+}\n+\n+interface TextAreaWithLengthValidationMessageState {\n+  showTooShortWarning: boolean;\n+  text: string;\n+}\n+\n+export class TextAreaWithLengthValidationMessage extends React.Component<\n+  TextAreaWithLengthValidationMessageProps,\n+  TextAreaWithLengthValidationMessageState\n+> {\n+  constructor(props: TextAreaWithLengthValidationMessageProps) {\n+    super(props);\n+    this.state = {\n+      showTooShortWarning: false,\n+      text: props.initialText\n+    };\n+  }\n+\n+  onTextUpdate(text) {\n+    if (this.state.showTooShortWarning && text.length >= 50) {\n+      this.setState({showTooShortWarning: false});\n+    }\n+    this.setState({text: text});\n+    this.props.onChange(text);\n+  }\n+\n+  updateShowTooShortWarning() {\n+    if (\n+        this.state.text\n+        && this.props.tooShortWarningCharacters\n+        && this.props.tooShortWarning\n+        && this.state.text.length < this.props.tooShortWarningCharacters\n+    ) {\n+      this.setState({showTooShortWarning: true});\n+    } else {\n+      this.setState({showTooShortWarning: false});\n+    }\n+  }\n+\n+  renderCharacterLimitMessage(textColor: string, message: string) {\n+    return <div\n+        data-test-id='characterLimit'\n+        style={{color: textColor, marginLeft: 'auto', flex: '0 0 auto'}}\n+    >\n+      {message}\n+    </div>;\n+  }\n+\n+  render() {\n+    const {id, maxCharacters, tooShortWarning} = this.props;\n+    const {showTooShortWarning, text} = this.state;\n+\n+    return <React.Fragment>\n+      <TextArea\n+          style={{\n+            height: '15rem',\n+            resize: 'none',\n+            width: '48rem',\n+            borderRadius: '3px 3px 0 0',\n+            boderColor: colorWithWhiteness(colors.dark, 0.5)\n+          }}\n+          id={id}\n+          value={text}\n+          onBlur={() => this.updateShowTooShortWarning()}\n+          onChange={v => this.onTextUpdate(v)}\n+      />\n+      <FlexRow\n+          style={{\n+            justifyContent: 'space-between',\n+            width: '48rem',\n+            backgroundColor: colorWithWhiteness(colors.primary, 0.95),\n+            fontSize: 12,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjY0NTk0", "url": "https://github.com/all-of-us/workbench/pull/3481#pullrequestreview-400264594", "createdAt": "2020-04-24T20:55:18Z", "commit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1NToxOVrOGLo5Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1NToxOVrOGLo5Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzUzMQ==", "bodyText": "Curious should this be a const rather than class?", "url": "https://github.com/all-of-us/workbench/pull/3481#discussion_r414857531", "createdAt": "2020-04-24T20:55:19Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/pages/workspace/workspace-research-summary.tsx", "diffHunk": "@@ -1,111 +1,40 @@\n-import {FlexRow} from 'app/components/flex';\n-import {TextArea} from 'app/components/inputs';\n-import colors from 'app/styles/colors';\n-import {colorWithWhiteness} from 'app/styles/colors';\n-import {reactStyles} from 'app/utils';\n+import {TextAreaWithLengthValidationMessage} from 'app/components/inputs';\n import * as React from 'react';\n import {WorkspaceEditSection} from './workspace-edit-section';\n import {ResearchPurposeQuestion} from './workspace-edit-text';\n \n-const styles = reactStyles({\n-  textArea: {\n-    height: '15rem',\n-    resize: 'none',\n-    width: '48rem',\n-    borderRadius: '3px 3px 0 0',\n-    boderColor: colorWithWhiteness(colors.dark, 0.5)\n-  },\n-  textBoxCharRemaining: {\n-    justifyContent: 'space-between',\n-    width: '48rem',\n-    backgroundColor: colorWithWhiteness(colors.primary, 0.95),\n-    fontSize: 12,\n-    colors: colors.primary,\n-    padding: '0.25rem',\n-    borderRadius: '0 0 3px 3px', marginTop: '-0.5rem',\n-    border: `1px solid ${colorWithWhiteness(colors.dark, 0.5)}`\n-  },\n-});\n \n interface Props {\n+  id: string;\n   index: string;\n   onChange: Function;\n   researchPurpose: ResearchPurposeQuestion;\n   researchValue: string;\n-  rowId: string;\n }\n \n-interface State {\n-  showWarningMessage: boolean;\n-  researchValue: string;\n-  textColor: string;\n-}\n-\n-export class WorkspaceResearchSummary extends React.Component<Props, State > {\n+export class WorkspaceResearchSummary extends React.Component<Props> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3858a459277b18b6370614df6291092311ff961"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee937e0a0cc8c278985b889d0eb0fb1aac26399b", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/ee937e0a0cc8c278985b889d0eb0fb1aac26399b", "committedDate": "2020-04-24T21:01:26Z", "message": "first pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a9ff19ee86d1edd811db62cf4d45fbe35bc39ae", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/9a9ff19ee86d1edd811db62cf4d45fbe35bc39ae", "committedDate": "2020-04-24T21:01:26Z", "message": "fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39d1826862f66f2630e00c5d9f047855220d00e6", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/39d1826862f66f2630e00c5d9f047855220d00e6", "committedDate": "2020-04-24T21:01:27Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "committedDate": "2020-04-24T21:02:44Z", "message": "this can be a const now it has no state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f10455ceb627dce8a317dc50054b4b0a3b1e7853", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/f10455ceb627dce8a317dc50054b4b0a3b1e7853", "committedDate": "2020-04-24T20:59:17Z", "message": "this can be a const now it has no state"}, "afterCommit": {"oid": "e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e57d9a27ff948a8c3acdba10c49ccb1f37cef630", "committedDate": "2020-04-24T21:02:44Z", "message": "this can be a const now it has no state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ec6cb709fd63aa015eaece8689a0cdc6ed36dd", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e7ec6cb709fd63aa015eaece8689a0cdc6ed36dd", "committedDate": "2020-04-24T21:15:58Z", "message": "lint again I GUESS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjc4Njc3", "url": "https://github.com/all-of-us/workbench/pull/3481#pullrequestreview-400278677", "createdAt": "2020-04-24T21:22:27Z", "commit": {"oid": "e57d9a27ff948a8c3acdba10c49ccb1f37cef630"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6072e61d43476ef2255f94ea63e8de9bd91d54fb", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6072e61d43476ef2255f94ea63e8de9bd91d54fb", "committedDate": "2020-04-24T21:25:07Z", "message": "fixed some incorrect error text"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4884, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}