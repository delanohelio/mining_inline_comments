{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDgwMTk5", "number": 3019, "title": "[RW-4279][RW-4293][Risk=low] Add db fields for demographic survey", "bodyText": "Description:\nThis adds professionalUrl to our DB, and changes gender identity and sexual orientation options to free text with a boolean identifier, per new caps requirements. This does not address the styling on the account creation survey page, which will be done in a follow up task.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-01-21T19:50:30Z", "url": "https://github.com/all-of-us/workbench/pull/3019", "merged": true, "mergeCommit": {"oid": "fcf24da5efd5d31fa90265d9a7d5f81eb4550bde"}, "closed": true, "closedAt": "2020-01-23T18:39:48Z", "author": {"login": "s-rubenstein"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8oxogAFqTM0NjIyMzA2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9NDhFgBqjI5NzQ0MzM3NDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MjIzMDY3", "url": "https://github.com/all-of-us/workbench/pull/3019#pullrequestreview-346223067", "createdAt": "2020-01-21T22:02:23Z", "commit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjowMjoyNFrOFgKRwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjoxOTozOFrOFgKtPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzEzNg==", "bodyText": "Nit: methods named \"toggle\" generally mean \"switch from one state to another every time I'm called\", while this method and the one below simply update a field to a given boolean value. A slightly clearer name may be \"updateDisability\" or \"setDisability\".", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369267136", "createdAt": "2020-01-21T22:02:24Z", "author": {"login": "gjuggler"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -111,16 +109,20 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n   }\n \n   toggleDisability(value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzI5Nw==", "bodyText": "Typing nit: it's never too late to start incorporating some type-safety here, e.g. value --> value: Boolean", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369267297", "createdAt": "2020-01-21T22:02:51Z", "author": {"login": "gjuggler"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -111,16 +109,20 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n   }\n \n   toggleDisability(value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2NzQ4MA==", "bodyText": "What impact does this change have?", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369267480", "createdAt": "2020-01-21T22:03:19Z", "author": {"login": "gjuggler"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -138,70 +140,75 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       </ListPageHeader>\n \n       {/*Race section*/}\n-      <Section header='1. Race'>\n+      <Section header='Race'>\n         <div style={{display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap'}}>\n           {AccountCreationOptions.race.map((race) => {\n-            return this.createOptionCheckbox(race.label, 'race', race.value);\n+            return this.createOptionCheckbox(race.label, 'race', race.value, race.value.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI2ODM1Mw==", "bodyText": "Nit: can you make the  fit on one line to be consistent with the \"no\" label? (If it got auto-wrapped, that's fine, but by eye it looks like it might fit.", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369268353", "createdAt": "2020-01-21T22:05:25Z", "author": {"login": "gjuggler"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -138,70 +140,75 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       </ListPageHeader>\n \n       {/*Race section*/}\n-      <Section header='1. Race'>\n+      <Section header='Race'>\n         <div style={{display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap'}}>\n           {AccountCreationOptions.race.map((race) => {\n-            return this.createOptionCheckbox(race.label, 'race', race.value);\n+            return this.createOptionCheckbox(race.label, 'race', race.value, race.value.toString());\n           })}\n         </div>\n       </Section>\n \n       {/*Ethnicity section*/}\n-      <DropDownSection header='2. Ethnicity' options={AccountCreationOptions.ethnicity}\n+      <DropDownSection header='Ethnicity' options={AccountCreationOptions.ethnicity}\n                        value={demographicSurvey.ethnicity}\n                        onChange={(e) => this.updateDemographicAttribute('ethnicity', e)}/>\n-\n-      {/*Gender section*/}\n-      <Section header='3. Gender'>\n-        <FlexRow style={{flexWrap: 'wrap'}}>\n-          {AccountCreationOptions.gender.map((gender) => {\n-            return this.createOptionCheckbox(gender.label, 'gender', gender.value);\n-          })}\n-        </FlexRow>\n+      <Section header='Do you identify as lesbian, gay, bisexual, transgender, queer (LGBTQ),\n+or another sexual and/or gender minority?'>\n+        <div style={{paddingTop: '0.5rem'}}>\n+          <RadioButton onChange={\n+            (e) => this.toggleIdentifiesAsLgbtq(true)}\n+                       checked={demographicSurvey.identifiesAsLgbtq}\n+                       style={{marginRight: '0.5rem'}}/>\n+          <label style={{paddingRight: '3rem', color: colors.primary}}>\n+            Yes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3MTc0OQ==", "bodyText": "[Just thinking out loud] Have we encountered scenarios where users attempt to put more text into an input form than our database column width allows? Do we have clear DB design guidelines around choosing between the various text types or lengths for free-form text like this? I suspect 255 is probably enough here, I'm just curious if there is a broader pattern.\n(Based on a quick dig into our codebase, it seems we use varchar more often by far, with one instance of type=\"longtext\" and a few instances of type=\"text\" in the data dictionary schema. It's a clear pattern, but I'm not sure the motivation behind preferring varchar more often than not.)", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369271749", "createdAt": "2020-01-21T22:13:48Z", "author": {"login": "gjuggler"}, "path": "api/db/changelog/db.changelog-118-update-demographics.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog\n+    xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n+                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n+  <changeSet author=\"srubenst\" id=\"db.changelog-116-update-demographics\">\n+    <addColumn tableName=\"user\">\n+      <column name=\"professional_url\" type=\"varchar(255)\">\n+        <constraints nullable=\"true\"/>\n+      </column>\n+    </addColumn>\n+    <addColumn tableName=\"demographic_survey\">\n+      <column name=\"identifies_as_lgbtq\" type=\"boolean\">\n+        <constraints nullable=\"true\"/>\n+      </column>\n+      <column name=\"lgbtq_identity\" type=\"varchar(255)\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3NDE3Mg==", "bodyText": "It might be worth adding a comment here, and/or in the PR description, referencing https://precisionmedicineinitiative.atlassian.net/browse/RW-4312 (thanks for filing!). I also marked that ticket as blocked by RW-4293 for clarity.", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369274172", "createdAt": "2020-01-21T22:19:38Z", "author": {"login": "gjuggler"}, "path": "api/db/changelog/db.changelog-118-update-demographics.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog\n+    xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n+                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n+  <changeSet author=\"srubenst\" id=\"db.changelog-116-update-demographics\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de081c8df448fb18f444647303385f67cfa11e1"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3cc6322c496488ad1428e8a52d9353d6224f397a", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/3cc6322c496488ad1428e8a52d9353d6224f397a", "committedDate": "2020-01-22T18:18:46Z", "message": "Fix spotless"}, "afterCommit": {"oid": "4b2d2c2ede9f96bb3b5dcbaca1f06720460ddc1c", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/4b2d2c2ede9f96bb3b5dcbaca1f06720460ddc1c", "committedDate": "2020-01-22T18:20:51Z", "message": "Fix spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2OTM2ODIy", "url": "https://github.com/all-of-us/workbench/pull/3019#pullrequestreview-346936822", "createdAt": "2020-01-22T22:06:03Z", "commit": {"oid": "b9f1561b397ee201359d40a9fc6424bf5d42f83c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMjowNjowM1rOFgsofA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMjowODoxM1rOFgssKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgzMDAxMg==", "bodyText": "Is it an AC to not export this anymore?", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369830012", "createdAt": "2020-01-22T22:06:03Z", "author": {"login": "als364"}, "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -193,11 +193,6 @@ private RdrResearcher toRdrResearcher(DbUser dbUser) {\n             RdrExportEnums.sexAtBirthToRdrSexAtBirth(\n                 dbDemographicSurvey.getSexAtBirthEnum().get(0)));\n       }\n-      if (dbDemographicSurvey.getSexualOrientationEnum() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9f1561b397ee201359d40a9fc6424bf5d42f83c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgzMDk1Mg==", "bodyText": "Given that this is how we're wording it, I agree with Greg's earlier comment that this could be much larger than 255 characters. I'd bump it all the way up to 4000 because storage is cheap and a lot of the time it will be empty anyways.", "url": "https://github.com/all-of-us/workbench/pull/3019#discussion_r369830952", "createdAt": "2020-01-22T22:08:13Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -138,70 +144,73 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       </ListPageHeader>\n \n       {/*Race section*/}\n-      <Section header='1. Race'>\n+      <Section header='Race'>\n         <div style={{display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap'}}>\n           {AccountCreationOptions.race.map((race) => {\n-            return this.createOptionCheckbox(race.label, 'race', race.value);\n+            return this.createOptionCheckbox(race.label, 'race', race.value, race.value.toString());\n           })}\n         </div>\n       </Section>\n \n       {/*Ethnicity section*/}\n-      <DropDownSection header='2. Ethnicity' options={AccountCreationOptions.ethnicity}\n+      <DropDownSection header='Ethnicity' options={AccountCreationOptions.ethnicity}\n                        value={demographicSurvey.ethnicity}\n                        onChange={(e) => this.updateDemographicAttribute('ethnicity', e)}/>\n-\n-      {/*Gender section*/}\n-      <Section header='3. Gender'>\n-        <FlexRow style={{flexWrap: 'wrap'}}>\n-          {AccountCreationOptions.gender.map((gender) => {\n-            return this.createOptionCheckbox(gender.label, 'gender', gender.value);\n-          })}\n-        </FlexRow>\n+      <Section header='Do you identify as lesbian, gay, bisexual, transgender, queer (LGBTQ),\n+or another sexual and/or gender minority?'>\n+        <div style={{paddingTop: '0.5rem'}}>\n+          <RadioButton onChange={\n+            (e) => this.updateDemographicAttribute('identifiesAsLgbtq', true)}\n+                       checked={demographicSurvey.identifiesAsLgbtq}\n+                       style={{marginRight: '0.5rem'}}/>\n+          <label style={{paddingRight: '3rem', color: colors.primary}}>\n+            Yes\n+          </label>\n+          <RadioButton onChange={(e) => this.updateDemographicAttribute('identifiesAsLgbtq', false)}\n+                       checked={!demographicSurvey.identifiesAsLgbtq}\n+                       style={{marginRight: '0.5rem'}}/>\n+          <label style={{color: colors.primary}}>No</label>\n+        </div>\n+        <label></label>\n+        <TextInputWithLabel labelText='If yes, please tell us about your LGBTQ+ identity'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9f1561b397ee201359d40a9fc6424bf5d42f83c"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f40c2710e14cd0a9f40b1b43031c1025bd255099", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/f40c2710e14cd0a9f40b1b43031c1025bd255099", "committedDate": "2020-01-23T16:36:17Z", "message": "WIP New fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0885ab9beedb8396980d5ab99cbe47df356179c", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/f0885ab9beedb8396980d5ab99cbe47df356179c", "committedDate": "2020-01-23T16:36:17Z", "message": "Add professional url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b76327e5ed0e4dc41dc32b58e1c3d7da6885fad", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/9b76327e5ed0e4dc41dc32b58e1c3d7da6885fad", "committedDate": "2020-01-23T16:36:17Z", "message": "Add added fields to display"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da950c0918989b5cacfad6e694c0568ecbf9992", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/8da950c0918989b5cacfad6e694c0568ecbf9992", "committedDate": "2020-01-23T16:36:17Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ba4f6ccdf0db5302f776da2ccebb51597c98e3e", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/3ba4f6ccdf0db5302f776da2ccebb51597c98e3e", "committedDate": "2020-01-23T16:36:17Z", "message": "fix linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2c969da6de287b5122419d525495b9a307f45e", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/ac2c969da6de287b5122419d525495b9a307f45e", "committedDate": "2020-01-23T16:36:42Z", "message": "Remove drop table for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd4f17e80bde8202c3bdcc1c14d6bc27c55d4f4a", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/dd4f17e80bde8202c3bdcc1c14d6bc27c55d4f4a", "committedDate": "2020-01-23T16:36:42Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29bb723947fca9c0bcfd2a7d0d2eba3ac4e4f17d", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/29bb723947fca9c0bcfd2a7d0d2eba3ac4e4f17d", "committedDate": "2020-01-23T16:36:42Z", "message": "Add front-end validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c214ec6d94301f6b24f417af37e8ea466d5b91a1", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/c214ec6d94301f6b24f417af37e8ea466d5b91a1", "committedDate": "2020-01-23T16:36:42Z", "message": "Fix spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b779a0ae4b8fbdc5c5ea03a06f8fc30b9d4f1abe", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/b779a0ae4b8fbdc5c5ea03a06f8fc30b9d4f1abe", "committedDate": "2020-01-23T16:36:42Z", "message": "remove extra functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cee4c28612f797c9a748c5055f9492a35f91749e", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/cee4c28612f797c9a748c5055f9492a35f91749e", "committedDate": "2020-01-23T16:36:42Z", "message": "More pr feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ab8dd19d50fa188d3a473d124f4fb60b665443", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/e7ab8dd19d50fa188d3a473d124f4fb60b665443", "committedDate": "2020-01-23T16:36:42Z", "message": "Move to 'text'"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da7b978708bd08b0df61ccb9938e4dfe0adc62b0", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/da7b978708bd08b0df61ccb9938e4dfe0adc62b0", "committedDate": "2020-01-23T16:32:40Z", "message": "Move to 'text'"}, "afterCommit": {"oid": "e7ab8dd19d50fa188d3a473d124f4fb60b665443", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/e7ab8dd19d50fa188d3a473d124f4fb60b665443", "committedDate": "2020-01-23T16:36:42Z", "message": "Move to 'text'"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3707, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}