{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4ODg2MzY5", "number": 4272, "title": "[RW-5766][RW-5851][risk=no] Rework runtime ops store / usage", "bodyText": "Approach:\n\nRepurpose the store to track \"compound runtime operations\", only applicable to delete/create cycles\nInclude the pending configuration as part of the store, this is used to repopulate the panel during the transition\nFeed pendingRuntime details into the sidebar and panel, to smooth over the intermediate UX\n\nRelated changes:\n\nReduce LeoRuntimeInitializer usage through - coordinate more through runtimeStore\nwithRuntimeStore() initializes the runtimeStore, if needed\nrevert unit test hack\nfix signal abort handling flow\nfix error type on runtime initializer", "createdAt": "2020-11-11T02:05:54Z", "url": "https://github.com/all-of-us/workbench/pull/4272", "merged": true, "mergeCommit": {"oid": "acefc8be03bfdfb3a48a25df98f842344a72c831"}, "closed": true, "closedAt": "2020-11-12T19:54:49Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbUrX4AH2gAyNTE4ODg2MzY5OjllNDA5Y2IwZjFiYjI1ODQ0YjhkY2EwOTdiNjBhNDNmZDNjYjMwYzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb3h7vAFqTUyOTQxMDU0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e409cb0f1bb25844b8dca097b60a43fd3cb30c0", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/9e409cb0f1bb25844b8dca097b60a43fd3cb30c0", "committedDate": "2020-11-11T02:38:40Z", "message": "partway to a pendingRuntime impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c3e94b970e1b80f9c6cb99c1ef4170f0df2371", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/80c3e94b970e1b80f9c6cb99c1ef4170f0df2371", "committedDate": "2020-11-11T02:38:41Z", "message": "partway to a pendingRuntime impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9969b6397ec3810d66897bb5a69918362f4165d", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/c9969b6397ec3810d66897bb5a69918362f4165d", "committedDate": "2020-11-11T02:38:42Z", "message": "partway to a pendingRuntime impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7965bd6681bb74d469fc0ebdfef1bc8421db85c", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/e7965bd6681bb74d469fc0ebdfef1bc8421db85c", "committedDate": "2020-11-11T02:38:42Z", "message": "Mostly there"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a408da0c0766e0520314afa926da9f6154929fa8", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/a408da0c0766e0520314afa926da9f6154929fa8", "committedDate": "2020-11-11T02:38:42Z", "message": "working"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73b269d691d2a60a04a1a2a968e6b78682975208", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/73b269d691d2a60a04a1a2a968e6b78682975208", "committedDate": "2020-11-11T02:38:43Z", "message": "Revert \"[RW-5851][risk=no] Temporary hack to fix unit test flakiness (#4246)\"\n\nThis reverts commit 862ee0bfb86c128de98ee15c66f24c3d88ac3c89."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5351f47e59967fe8c2962e71b3f3dc30ec069b5f", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/5351f47e59967fe8c2962e71b3f3dc30ec069b5f", "committedDate": "2020-11-11T02:38:43Z", "message": "Test refactorings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abb128cd1c30e9b23dcab7593462f0d26bc5eda4", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/abb128cd1c30e9b23dcab7593462f0d26bc5eda4", "committedDate": "2020-11-11T02:38:44Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1719b18090faa5340e0744fa2519f0bd55ae422a", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/1719b18090faa5340e0744fa2519f0bd55ae422a", "committedDate": "2020-11-11T02:38:45Z", "message": "ng test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0997759d023e10fd71d935fb034002121bbef801", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/0997759d023e10fd71d935fb034002121bbef801", "committedDate": "2020-11-11T02:38:45Z", "message": "comment fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "384f22924fb98f9dcae2bcadc4cce80359995466", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/384f22924fb98f9dcae2bcadc4cce80359995466", "committedDate": "2020-11-11T02:26:45Z", "message": "ng test fix"}, "afterCommit": {"oid": "0997759d023e10fd71d935fb034002121bbef801", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/0997759d023e10fd71d935fb034002121bbef801", "committedDate": "2020-11-11T02:38:45Z", "message": "comment fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d91e61acefb2d82412c1d978124780f39e8ea25", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/9d91e61acefb2d82412c1d978124780f39e8ea25", "committedDate": "2020-11-11T02:39:40Z", "message": "revert ng test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "287e859d180c0097e8d0d74a6eb74e3dce4bcad9", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/287e859d180c0097e8d0d74a6eb74e3dce4bcad9", "committedDate": "2020-11-11T20:32:20Z", "message": "Test coverage for help sidebar..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "882ffb074a2a0ea9a8a46c8a1954a1a95c94b891", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/882ffb074a2a0ea9a8a46c8a1954a1a95c94b891", "committedDate": "2020-11-12T00:05:31Z", "message": "Drop loggers, fix redirect, unindent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30a644df340a7313e48720747c2876439520e3d4", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/30a644df340a7313e48720747c2876439520e3d4", "committedDate": "2020-11-12T01:10:00Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64", "committedDate": "2020-11-12T06:25:36Z", "message": "handle 404s properly in useRuntime"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjYxMzE3", "url": "https://github.com/all-of-us/workbench/pull/4272#pullrequestreview-529261317", "createdAt": "2020-11-12T16:25:21Z", "commit": {"oid": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNjoyNToyMVrOHyC4NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNzoyNDo1MlrOHyFlCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzODAwNA==", "bodyText": "are you intending on implementing this in this PR? if not, is there an outstanding ticket to represent this work?", "url": "https://github.com/all-of-us/workbench/pull/4272#discussion_r522238004", "createdAt": "2020-11-12T16:25:21Z", "author": {"login": "als364"}, "path": "ui/src/app/utils/leo-runtime-initializer.tsx", "diffHunk": "@@ -196,76 +186,44 @@ export class LeoRuntimeInitializer {\n     this.targetRuntime = options.targetRuntime;\n   }\n \n-  private async getRuntime(): Promise<Runtime> {\n-    const aborter = new AbortController();\n-    const promise = runtimeApi().getRuntime(this.workspaceNamespace, {signal: aborter.signal});\n-    updateRuntimeOpsStoreForWorkspaceNamespace(this.workspaceNamespace, {\n-      promise: promise,\n-      operation: 'get',\n-      aborter: aborter\n-    });\n-    markRuntimeOperationCompleteForWorkspace(this.workspaceNamespace);\n-    return promise;\n-  }\n-\n   private async createRuntime(): Promise<void> {\n     if (this.createCount >= this.maxCreateCount) {\n       throw new ExceededActionCountError(\n         `Reached max runtime create count (${this.maxCreateCount})`, this.currentRuntime);\n     }\n-    const aborter = new AbortController();\n     let runtime: Runtime;\n     if (serverConfigStore.getValue().enableCustomRuntimes && this.targetRuntime) {\n       runtime = this.targetRuntime;\n     } else {\n+      // In lazy initialization mode, this should default to:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4MjI1MA==", "bodyText": "This is in runtime-utils and runtime-panels too - could it be pulled out into a test utils file?", "url": "https://github.com/all-of-us/workbench/pull/4272#discussion_r522282250", "createdAt": "2020-11-12T17:24:52Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/analysis/notebook-redirect.spec.tsx", "diffHunk": "@@ -28,8 +30,17 @@ describe('NotebookRedirect', () => {\n \n   let runtimeStub: RuntimeApiStub;\n \n-  const mountedComponent = () => {\n-    return mount(<NotebookRedirect/>);\n+  const handleUseEffect = async (component) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c2c6f0675dbeebec88e5d8d5056147aa8bc1a64"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2242e327d2bf02fd0ab15ed593cdaaa578d336a7", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/2242e327d2bf02fd0ab15ed593cdaaa578d336a7", "committedDate": "2020-11-12T18:59:46Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7f86084f8198333663da80ca5d5efa2415dbeb8", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/e7f86084f8198333663da80ca5d5efa2415dbeb8", "committedDate": "2020-11-12T19:01:06Z", "message": "Missed one handleUseEffect"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NDEwNTQy", "url": "https://github.com/all-of-us/workbench/pull/4272#pullrequestreview-529410542", "createdAt": "2020-11-12T19:15:02Z", "commit": {"oid": "e7f86084f8198333663da80ca5d5efa2415dbeb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3848, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}