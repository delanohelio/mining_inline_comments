{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NTQ2MDA5", "number": 3751, "title": "[RW-5060][RISK=LOW]  DataSetController - reduce number of args passed to dataSetService#saveDataSet", "bodyText": "Map DataSetRequest object to DBDataSet and call the existing save(DbDataSet) method in DataSetService class\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-07-07T17:14:55Z", "url": "https://github.com/all-of-us/workbench/pull/3751", "merged": true, "mergeCommit": {"oid": "c7661e5f314881ef188bb770ecc013d83c8cb612"}, "closed": true, "closedAt": "2020-07-13T17:35:33Z", "author": {"login": "NehaBroad"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcypC6VgH2gAyNDQ1NTQ2MDA5OjQ2YjYxOTBmNmNhZWE2MTlkOTFiNmYxNTliZGJiODg2YzdjZDBhMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0jPe8AFqTQ0NzM2MzgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "46b6190f6caea619d91b6f159bdbb886c7cd0a39", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/46b6190f6caea619d91b6f159bdbb886c7cd0a39", "committedDate": "2020-07-07T17:11:35Z", "message": "Reduce arguments for DataSetService save"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a1d7e4f4e9c1f784e8d68409f0767be8a8ca02", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/c8a1d7e4f4e9c1f784e8d68409f0767be8a8ca02", "committedDate": "2020-07-07T17:35:53Z", "message": "Fix Api test : Add null or Empty check for data set version\n;"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTE5NzQy", "url": "https://github.com/all-of-us/workbench/pull/3751#pullrequestreview-444119742", "createdAt": "2020-07-07T17:50:01Z", "commit": {"oid": "c8a1d7e4f4e9c1f784e8d68409f0767be8a8ca02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1MDowMVrOGuJVrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1MDowMVrOGuJVrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0MDY4Ng==", "bodyText": "I had to delete this otherwise DataSetMapper was using this method for the method  DbDataset dataSetRequestToDb(DataSetRequest dataSetRequest);\nand then starting throwing exception (for each attribute)  \"lastModifiedTIME\" not found did you mean null", "url": "https://github.com/all-of-us/workbench/pull/3751#discussion_r451040686", "createdAt": "2020-07-07T17:50:01Z", "author": {"login": "NehaBroad"}, "path": "api/src/main/java/org/pmiops/workbench/db/model/DbDataset.java", "diffHunk": "@@ -277,101 +260,4 @@ public int hashCode() {\n   public String toString() {\n     return ToStringBuilder.reflectionToString(this);\n   }\n-\n-  public static DbDataset.Builder builder() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a1d7e4f4e9c1f784e8d68409f0767be8a8ca02"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/257852fbb5b29e194b4aef682894975640ab6c12", "committedDate": "2020-07-07T18:30:28Z", "message": "Resol ve conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTU0OTYx", "url": "https://github.com/all-of-us/workbench/pull/3751#pullrequestreview-444154961", "createdAt": "2020-07-07T18:40:50Z", "commit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODo0MDo1MFrOGuLCYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODo0NToyMVrOGuLL0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA2ODUxMw==", "bodyText": "I think you need to revert this block and leave the code the way it was for purposes of how the rename has to work. This will be a breaking change to the rename dataset.", "url": "https://github.com/all-of-us/workbench/pull/3751#discussion_r451068513", "createdAt": "2020-07-07T18:40:50Z", "author": {"login": "freemabd"}, "path": "api/src/main/java/org/pmiops/workbench/api/DataSetController.java", "diffHunk": "@@ -437,34 +416,27 @@ private void formatTimestampValues(List<DataSetPreviewValueList> valuePreviewLis\n     if (Strings.isNullOrEmpty(request.getEtag())) {\n       throw new BadRequestException(\"missing required update field 'etag'\");\n     }\n+    final Timestamp now = new Timestamp(clock.instant().toEpochMilli());\n     DbWorkspace workspace =\n         workspaceService.getWorkspaceEnforceAccessLevelAndSetCdrVersion(\n             workspaceNamespace, workspaceId, WorkspaceAccessLevel.WRITER);\n-\n+    request.setWorkspaceId(workspace.getWorkspaceId());\n     DbDataset dbDataSet = dataSetService.getDbDataSet(workspace, dataSetId).get();\n \n     int version = Etags.toVersion(request.getEtag());\n     if (dbDataSet.getVersion() != version) {\n       throw new ConflictException(\"Attempted to modify outdated data set version\");\n     }\n-    Timestamp now = new Timestamp(clock.instant().toEpochMilli());\n-    dbDataSet.setName(request.getName());\n-    dbDataSet.setDescription(request.getDescription());\n-    dbDataSet.setLastModifiedTime(now);\n-    if (request.getDomainValuePairs() != null) {\n-      dbDataSet.setIncludesAllParticipants(request.getIncludesAllParticipants());\n-      dbDataSet.setCohortIds(request.getCohortIds());\n-      dbDataSet.setConceptSetIds(request.getConceptSetIds());\n-      dbDataSet.setPrePackagedConceptSetEnum(request.getPrePackagedConceptSet());\n-      dbDataSet.setValues(\n-          request.getDomainValuePairs().stream()\n-              .map(this::getDataSetValuesFromDomainValueSet)\n-              .collect(Collectors.toList()));\n-    }\n+    DbDataset dbMappingConvert = dataSetMapper.dataSetRequestToDb(request);\n+    dbMappingConvert.setDataSetId(dbDataSet.getDataSetId());\n+    dbMappingConvert.setInvalid(false);\n+    dbMappingConvert.setCreatorId(dbDataSet.getCreatorId());\n+    dbMappingConvert.setCreationTime(dbDataSet.getCreationTime());\n+    dbMappingConvert.setLastModifiedTime(now);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA3MDA5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              @Mapping(target = \"version\", source = \"etag\")\n          \n          \n            \n              @Mapping(target = \"version\", source = \"etag\", qualifiedByName = \"etagToCdrVersion\")", "url": "https://github.com/all-of-us/workbench/pull/3751#discussion_r451070092", "createdAt": "2020-07-07T18:43:49Z", "author": {"login": "freemabd"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetMapper.java", "diffHunk": "@@ -37,17 +42,47 @@\n   @Named(\"dbModelToClientLight\")\n   DataSet dbModelToClientLight(DbDataset dbDataset);\n \n+  @Mapping(target = \"dataSetId\", ignore = true)\n+  @Mapping(target = \"version\", source = \"etag\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA3MDkyOA==", "bodyText": "Remove this and use qualifiedByName above. This method exists in CommonMappers.", "url": "https://github.com/all-of-us/workbench/pull/3751#discussion_r451070928", "createdAt": "2020-07-07T18:45:21Z", "author": {"login": "freemabd"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetMapper.java", "diffHunk": "@@ -37,17 +42,47 @@\n   @Named(\"dbModelToClientLight\")\n   DataSet dbModelToClientLight(DbDataset dbDataset);\n \n+  @Mapping(target = \"dataSetId\", ignore = true)\n+  @Mapping(target = \"version\", source = \"etag\")\n+  @Mapping(target = \"creatorId\", ignore = true)\n+  @Mapping(target = \"creationTime\", ignore = true)\n+  @Mapping(target = \"invalid\", ignore = true)\n+  @Mapping(target = \"lastModifiedTime\", ignore = true)\n+  @Mapping(target = \"prePackagedConceptSetEnum\", ignore = true)\n+  @Mapping(target = \"values\", source = \"domainValuePairs\")\n+  DbDataset dataSetRequestToDb(DataSetRequest dataSetRequest);\n+\n   @Mapping(target = \"id\", source = \"dataSetId\")\n   @Mapping(target = \"conceptSets\", source = \"conceptSetIds\")\n   @Mapping(target = \"cohorts\", source = \"cohortIds\")\n   @Mapping(target = \"domainValuePairs\", source = \"values\")\n   @Mapping(target = \"etag\", source = \"version\", qualifiedByName = \"cdrVersionToEtag\")\n   DataSet dbModelToClient(DbDataset dbDataset);\n \n+  default int etagToVersion(String eTag) {\n+    return Strings.isNullOrEmpty(eTag) ? 1 : Etags.toVersion(eTag);\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTYzODE0", "url": "https://github.com/all-of-us/workbench/pull/3751#pullrequestreview-444163814", "createdAt": "2020-07-07T18:53:55Z", "commit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODo1Mzo1NVrOGuLc6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODo1Mzo1NVrOGuLc6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA3NTMwNQ==", "bodyText": "Can we add a test case for this in DataSetMapperTest?", "url": "https://github.com/all-of-us/workbench/pull/3751#discussion_r451075305", "createdAt": "2020-07-07T18:53:55Z", "author": {"login": "freemabd"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetMapper.java", "diffHunk": "@@ -37,17 +42,47 @@\n   @Named(\"dbModelToClientLight\")\n   DataSet dbModelToClientLight(DbDataset dbDataset);\n \n+  @Mapping(target = \"dataSetId\", ignore = true)\n+  @Mapping(target = \"version\", source = \"etag\")\n+  @Mapping(target = \"creatorId\", ignore = true)\n+  @Mapping(target = \"creationTime\", ignore = true)\n+  @Mapping(target = \"invalid\", ignore = true)\n+  @Mapping(target = \"lastModifiedTime\", ignore = true)\n+  @Mapping(target = \"prePackagedConceptSetEnum\", ignore = true)\n+  @Mapping(target = \"values\", source = \"domainValuePairs\")\n+  DbDataset dataSetRequestToDb(DataSetRequest dataSetRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "257852fbb5b29e194b4aef682894975640ab6c12"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cbb3419841ab19598ea993f0dc15448a8397f3a", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/4cbb3419841ab19598ea993f0dc15448a8397f3a", "committedDate": "2020-07-13T04:16:26Z", "message": "Fix rename issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21f4b29f8c88efedaf7e12ff87629eed7e7ab2cc", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/21f4b29f8c88efedaf7e12ff87629eed7e7ab2cc", "committedDate": "2020-07-13T04:48:22Z", "message": "Add Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87962573d2988c99faa15476fc5655d6feeb297c", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/87962573d2988c99faa15476fc5655d6feeb297c", "committedDate": "2020-07-13T05:02:12Z", "message": "Add Pre Packaged Concept Set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f31fadde4b5d713f97e1085dbfa31c62bcc300f7", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f31fadde4b5d713f97e1085dbfa31c62bcc300f7", "committedDate": "2020-07-13T05:09:36Z", "message": "Method name change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed5ab785452b0920656d8d72f8a5c5b92c627943", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ed5ab785452b0920656d8d72f8a5c5b92c627943", "committedDate": "2020-07-13T05:10:55Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7611348c21e7ee53dbe06ab81d4fdbcea735b0f", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d7611348c21e7ee53dbe06ab81d4fdbcea735b0f", "committedDate": "2020-07-13T05:23:14Z", "message": "Fix test failure: cohort list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "024095d89b68f69b00488b112b8c98b8002b1fe5", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/024095d89b68f69b00488b112b8c98b8002b1fe5", "committedDate": "2020-07-13T05:25:22Z", "message": "Removevduplicate line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f025f59c33d1037b0f629a6c0ecd821f6807034", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/0f025f59c33d1037b0f629a6c0ecd821f6807034", "committedDate": "2020-07-13T05:47:05Z", "message": "Correct variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15f646e3cc95b13883ec8ecd3636fd0ffa73f344", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/15f646e3cc95b13883ec8ecd3636fd0ffa73f344", "committedDate": "2020-07-13T13:39:37Z", "message": "extra line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb11de1a0b17af16bb936659f42770569ba90f0e", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/eb11de1a0b17af16bb936659f42770569ba90f0e", "committedDate": "2020-07-13T13:59:23Z", "message": "Spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MzYzODIz", "url": "https://github.com/all-of-us/workbench/pull/3751#pullrequestreview-447363823", "createdAt": "2020-07-13T15:33:44Z", "commit": {"oid": "eb11de1a0b17af16bb936659f42770569ba90f0e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4681, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}