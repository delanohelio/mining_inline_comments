{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyOTY0NTA0", "number": 3737, "title": "[risk=no][rw-4945] Add URL validation to account creation and profile", "bodyText": "Description:\nAdd validation to the professional URL field in the account creation and profile pages.\nI also updated the error messages in the profile page when the save button is disabled to enumerate the errors as it done on other pages.\nI looked into URL sanitization, but could not find a library I was satisfied with and also feel some requirements around sanitization should be defined - not only for URL's but all inputs. Also, it is not clear to me what we want to guard against on the client side (URL or HTML sanitization?) and how we want to sanitize (e.g. should we immediately change the input on a change? On a blur? Or not update the field, but save the sanitized value? Will there be server side sanitization, and if so should we converge on a library? etc...)\nI added two additional tech debt tickets:\nRW-5160 Converge on validation error handling\nRW-5161 Spike on user input validation\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-07-01T20:15:56Z", "url": "https://github.com/all-of-us/workbench/pull/3737", "merged": true, "mergeCommit": {"oid": "8e926e6a7300eb572b3c42b74e4c4f06a2d2de87"}, "closed": true, "closedAt": "2020-07-02T17:12:11Z", "author": {"login": "petesantos"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwt0c8AH2gAyNDQyOTY0NTA0OmY3NmQ3ZDQ5NjBjZGM0ZDZkZTM4NDUzYjgzM2RhYjVkNWJlZGZiMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw_hMDgFqTQ0MTcyMDMwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f76d7d4960cdc4d6de38453b833dab5d5bedfb31", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/f76d7d4960cdc4d6de38453b833dab5d5bedfb31", "committedDate": "2020-07-01T17:37:28Z", "message": "Add validation to professional URL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9daf6ad1894fb62a35e583df4e8d7d38dbaea05", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/a9daf6ad1894fb62a35e583df4e8d7d38dbaea05", "committedDate": "2020-07-01T19:46:21Z", "message": "Update validation logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMTY4ODE5", "url": "https://github.com/all-of-us/workbench/pull/3737#pullrequestreview-441168819", "createdAt": "2020-07-01T20:17:30Z", "commit": {"oid": "a9daf6ad1894fb62a35e583df4e8d7d38dbaea05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDoxNzozMFrOGr0BEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDoxNzozMFrOGr0BEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU5NDE5Mg==", "bodyText": "Defaulting professionalUrl prevents a react error from showing up in the console from having an input field initialized as undefined", "url": "https://github.com/all-of-us/workbench/pull/3737#discussion_r448594192", "createdAt": "2020-07-01T20:17:30Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -409,14 +409,26 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n         };\n       }\n     }\n-    return validate(validationData, validationCheck);\n+\n+    const urlError = validationData.professionalUrl\n+      ? validate({website: validationData.professionalUrl}, {\n+        website: { url: { message: '^Professional URL %{value} is not a valid URL' } }\n+      })\n+      : undefined;\n+\n+    const errors = {\n+      ...validate(validationData, validationCheck),\n+      ...urlError\n+    };\n+\n+    return fp.isEmpty(errors) ? undefined : errors;\n   }\n \n   render() {\n     const {\n       profile: {\n         givenName, familyName,\n-        contactEmail, username, areaOfResearch, professionalUrl,\n+        contactEmail, username, areaOfResearch, professionalUrl = '',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9daf6ad1894fb62a35e583df4e8d7d38dbaea05"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNzIwMzA4", "url": "https://github.com/all-of-us/workbench/pull/3737#pullrequestreview-441720308", "createdAt": "2020-07-02T14:14:43Z", "commit": {"oid": "a9daf6ad1894fb62a35e583df4e8d7d38dbaea05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4661, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}