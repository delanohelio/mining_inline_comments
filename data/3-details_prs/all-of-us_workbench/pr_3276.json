{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMTg0OTEw", "number": 3276, "title": "[RW-4567][RISKNO] Bug with Research Purpose checkbox ", "bodyText": "Research purpose categories can be expanded either by selecting the icon next the Research purpose label or by selecting the checkbox\n\n\nThe Research Purpose checkbox can only be selected. Once selected it will expand the categories.\n\n\nIf the sub category is selected and un selected , the research purpose checkbox will then be un selected, but the categories will still be expanded\n\n\nOnly clicking the icon next to Research Purpose will collapse the categories\n\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-03-19T19:07:38Z", "url": "https://github.com/all-of-us/workbench/pull/3276", "merged": true, "mergeCommit": {"oid": "65fa002db2cfbd01b8ba3d87a2d5fd71391e4d5f"}, "closed": true, "closedAt": "2020-03-26T14:54:07Z", "author": {"login": "NehaBroad"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPQoYWAH2gAyMzkxMTg0OTEwOmJjMmNmM2E1ZDQyN2QyYzZjOTUyOWJlMTRlMzVhZjU0YmI3Mzk2ZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRc1T7AH2gAyMzkxMTg0OTEwOmE0MWNmNzI3ODE2ODY3MTNmOGExZDYyNGIyMDZiNTI5MDA2M2I0Y2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc2cf3a5d427d2c6c9529be14e35af54bb7396e1", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/bc2cf3a5d427d2c6c9529be14e35af54bb7396e1", "committedDate": "2020-03-19T18:57:32Z", "message": "Research purpose bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d710d848483b9ef4e310480fc3e06e0b7b5ada", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f7d710d848483b9ef4e310480fc3e06e0b7b5ada", "committedDate": "2020-03-19T19:15:33Z", "message": "method name change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f6d3783bef548dc4d928f3b38c79e79981ca6bf", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9f6d3783bef548dc4d928f3b38c79e79981ca6bf", "committedDate": "2020-03-19T19:18:11Z", "message": "method name change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0", "committedDate": "2020-03-19T19:44:20Z", "message": "add some comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTcxODA5", "url": "https://github.com/all-of-us/workbench/pull/3276#pullrequestreview-378571809", "createdAt": "2020-03-20T15:15:15Z", "commit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNToxNToxNVrOF5X6vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNToxODoyM1rOF5YDKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTAyMQ==", "bodyText": "a little confused by this line. researchPurposeCategoriesSelected takes in a research purpose right? How are we able to pass in the state object here?", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705021", "createdAt": "2020-03-20T15:15:15Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -564,6 +574,15 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       return researchPurpose.researchOutcomeList && researchPurpose.researchOutcomeList.length !== 0 ;\n     }\n \n+    updatePrimaryPurpose(cateogry, value) {\n+      this.updateResearchPurpose(cateogry, value);\n+      if (!value && !this.researchPurposeCategoriesSelected(this.state)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTI3OQ==", "bodyText": "can we add type signatures? I think it would help clear up a question I had below", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705279", "createdAt": "2020-03-20T15:15:38Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -354,9 +354,14 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n         return false;\n       }\n       const rp = this.props.workspace.researchPurpose;\n-      return rp.ancestry || rp.controlSet ||\n-          rp.diseaseFocusedResearch || rp.ethics || rp.drugDevelopment ||\n-          rp.methodsDevelopment || rp.populationHealth || rp.socialBehavioral;\n+      return this.researchPurposeCategoriesSelected(rp);\n+    }\n+\n+    researchPurposeCategoriesSelected(researchPurpose) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTQ3OA==", "bodyText": "type signature", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705478", "createdAt": "2020-03-20T15:15:56Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -398,12 +403,26 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       </div>;\n     }\n \n+    onResearchPurposeChange(checked) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTUxMg==", "bodyText": "type signature", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395705512", "createdAt": "2020-03-20T15:15:59Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -398,12 +403,26 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       </div>;\n     }\n \n+    onResearchPurposeChange(checked) {\n+      // If Checkbox is selected expand the research purpose categories\n+      if (checked) {\n+        this.setState({showResearchPurpose: true, selectResearchPurpose: true});\n+        return;\n+      }\n+      this.setState({selectResearchPurpose: false});\n+    }\n+\n+    get researchPurposeCheck() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNjQzMw==", "bodyText": "nit: I like  new lines for new properties, easier to read IMO", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395706433", "createdAt": "2020-03-20T15:17:20Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -854,26 +873,35 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n           <FlexRow>\n             <FlexColumn>\n               <FlexColumn  style={styles.researchPurposeRow}>\n+                <FlexRow>\n                 <CheckBox\n                   data-test-id='researchPurpose-checkbox'\n-                  style={{...styles.checkboxStyle, marginLeft: '0.6rem'}}\n-                  label={this.researchPurposeLabel}\n-                  labelStyle={styles.shortDescription}\n-                  checked={this.primaryPurposeIsSelected}\n-                  onChange={v => this.setState({\n-                    selectResearchPurpose: v,\n-                    showResearchPurpose: !this.state.showResearchPurpose})}/>\n-                  {this.state.showResearchPurpose && <FlexColumn>\n+                  manageOwnState={false}\n+                  style={{...styles.checkboxStyle, marginLeft: '0.6rem', marginTop: '0.1rem'}}\n+                  checked={this.researchPurposeCheck}\n+                  onChange={v => this.onResearchPurposeChange(v)}/>\n+                  <div style={{...styles.shortDescription, marginLeft: '-0.5rem'}}>\n+                    <button style={{...styles.shortDescription, border: 'none'}} data-test-id='research-purpose-button'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNzE3Ng==", "bodyText": "nit:  you could combine this with the tag above and use a ternary operator within the className", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r395707176", "createdAt": "2020-03-20T15:18:23Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -854,26 +873,35 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n           <FlexRow>\n             <FlexColumn>\n               <FlexColumn  style={styles.researchPurposeRow}>\n+                <FlexRow>\n                 <CheckBox\n                   data-test-id='researchPurpose-checkbox'\n-                  style={{...styles.checkboxStyle, marginLeft: '0.6rem'}}\n-                  label={this.researchPurposeLabel}\n-                  labelStyle={styles.shortDescription}\n-                  checked={this.primaryPurposeIsSelected}\n-                  onChange={v => this.setState({\n-                    selectResearchPurpose: v,\n-                    showResearchPurpose: !this.state.showResearchPurpose})}/>\n-                  {this.state.showResearchPurpose && <FlexColumn>\n+                  manageOwnState={false}\n+                  style={{...styles.checkboxStyle, marginLeft: '0.6rem', marginTop: '0.1rem'}}\n+                  checked={this.researchPurposeCheck}\n+                  onChange={v => this.onResearchPurposeChange(v)}/>\n+                  <div style={{...styles.shortDescription, marginLeft: '-0.5rem'}}>\n+                    <button style={{...styles.shortDescription, border: 'none'}} data-test-id='research-purpose-button'\n+                            onClick={() => this.setState({showResearchPurpose: !this.state.showResearchPurpose})}>\n+                      Research purpose\n+                      {!this.state.showResearchPurpose &&\n+                      <i className='pi pi-angle-right' style={{verticalAlign: 'middle'}}></i>}\n+                      {this.state.showResearchPurpose &&\n+                      <i className='pi pi-angle-down' style={{verticalAlign: 'middle'}}></i>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386dfdd7a2e37c3c9b3349c4bb45ddb6f71a32d0"}, "originalPosition": 114}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1dff3f230e943710a1d19e41caca25d1b2aa909", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d1dff3f230e943710a1d19e41caca25d1b2aa909", "committedDate": "2020-03-20T16:28:35Z", "message": "added types and extracted icon class - PR Comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDUwNzMz", "url": "https://github.com/all-of-us/workbench/pull/3276#pullrequestreview-381450733", "createdAt": "2020-03-25T19:01:57Z", "commit": {"oid": "d1dff3f230e943710a1d19e41caca25d1b2aa909"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTowMTo1OFrOF7qDVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTowMTo1OFrOF7qDVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5OTI4Nw==", "bodyText": "nit: I would prefer to use else here instead of using a return statement above. I thought this was a bug when I was reading through", "url": "https://github.com/all-of-us/workbench/pull/3276#discussion_r398099287", "createdAt": "2020-03-25T19:01:58Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -398,12 +404,30 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       </div>;\n     }\n \n+    onResearchPurposeChange(checked: boolean) {\n+      // If Checkbox is selected expand the research purpose categories\n+      if (checked) {\n+        this.setState({showResearchPurpose: true, selectResearchPurpose: true});\n+        return;\n+      }\n+      this.setState({selectResearchPurpose: false});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1dff3f230e943710a1d19e41caca25d1b2aa909"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41cf72781686713f8a1d624b206b5290063b4ce", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/a41cf72781686713f8a1d624b206b5290063b4ce", "committedDate": "2020-03-26T14:18:22Z", "message": "if else PR Comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3258, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}