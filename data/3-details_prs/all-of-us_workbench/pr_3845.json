{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMzU0MDU3", "number": 3845, "title": "[no ticket][risk=no] Make randomize fast", "bodyText": "Usage:\n./project.rb randomize-vcf --vcf [vcf location] --number-of-copies [number] --output-path [output path]", "createdAt": "2020-08-03T19:25:13Z", "url": "https://github.com/all-of-us/workbench/pull/3845", "merged": true, "mergeCommit": {"oid": "e1f022a47498034a0c6833ed88ca91d18eb74cdc"}, "closed": true, "closedAt": "2020-08-06T14:45:30Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7YwoLgFqTQ2MDM0MjM3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8QS07gBqjM2MjkxOTYyNTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzQyMzcw", "url": "https://github.com/all-of-us/workbench/pull/3845#pullrequestreview-460342370", "createdAt": "2020-08-03T21:08:39Z", "commit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTowODozOVrOG7IyiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMToxODoxN1rOG7JDPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MzE3Nw==", "bodyText": "nit: maybe add a prefix to indicate that its an int? I thought it was a list while reading through", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464663177", "createdAt": "2020-08-03T21:08:39Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -50,9 +51,9 @@ public RandomizeVcf() {\n   }\n \n   @VisibleForTesting\n-  protected RandomizeVcf(String sampleNameSuffix, Random random) {\n+  protected RandomizeVcf(int samples, Random random) {\n     super();\n-    this.sampleNameSuffix = sampleNameSuffix;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NTQ5MQ==", "bodyText": "are these NO_CALLs fixing a different issue?", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464665491", "createdAt": "2020-08-03T21:13:59Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -142,6 +141,8 @@ protected Genotype randomizeGenotype(VariantContext variantContext, Genotype gen\n     double genotypeTypeIndex = random.nextDouble();\n     if (genotypeTypeIndex < .0145) {\n       // double no-call\n+      alleles.add(Allele.NO_CALL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NzQ1NQ==", "bodyText": "I don't understand a lot of the GATK models but I thought this part seemed a little suspicious since we're only ever grabbing the first genotype out of the variant. Is that ok?", "url": "https://github.com/all-of-us/workbench/pull/3845#discussion_r464667455", "createdAt": "2020-08-03T21:18:17Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -93,8 +92,8 @@ protected VariantContext randomizeVariant(VariantContext variant) {\n     variantContextBuilder.alleles(variant.getAlleles());\n \n     List<Genotype> randomizedGenotypes =\n-        variant.getGenotypes().stream()\n-            .map(genotype -> randomizeGenotype(variant, genotype))\n+        IntStream.rangeClosed(1, this.samples)\n+            .mapToObj(i -> randomizeGenotype(variant, variant.getGenotype(0), i))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTk4NjQw", "url": "https://github.com/all-of-us/workbench/pull/3845#pullrequestreview-462198640", "createdAt": "2020-08-06T05:32:46Z", "commit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbea0986eeb57b1f038018356282c44cf2b2e7bd", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/fbea0986eeb57b1f038018356282c44cf2b2e7bd", "committedDate": "2020-08-06T14:00:26Z", "message": "make randomize fast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe7ac61bda11c510ac1d947d02dfaa234bc239a0", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/fe7ac61bda11c510ac1d947d02dfaa234bc239a0", "committedDate": "2020-08-06T14:00:27Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbdfe05aacb8e07fda9137ab7a7e877f8f5e5fd1", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/dbdfe05aacb8e07fda9137ab7a7e877f8f5e5fd1", "committedDate": "2020-08-06T14:00:27Z", "message": "update readme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4636a5adcbe6c3fb751fdb083b8fe207e5f26f4", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e4636a5adcbe6c3fb751fdb083b8fe207e5f26f4", "committedDate": "2020-08-06T14:00:27Z", "message": "output path"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9592791844c7d3ad8e3de97dae6ecf071f719e4f", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/9592791844c7d3ad8e3de97dae6ecf071f719e4f", "committedDate": "2020-08-03T19:32:26Z", "message": "output path"}, "afterCommit": {"oid": "e4636a5adcbe6c3fb751fdb083b8fe207e5f26f4", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/e4636a5adcbe6c3fb751fdb083b8fe207e5f26f4", "committedDate": "2020-08-06T14:00:27Z", "message": "output path"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4523, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}