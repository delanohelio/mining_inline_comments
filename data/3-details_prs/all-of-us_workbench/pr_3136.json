{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NjA1NzQw", "number": 3136, "title": "[RW-4463][RISK=NO] Interceptor-based logging", "bodyText": "Use a simple interceptor to create a duration and record a distribution metric.\nTIL:\n\nrequest attributes can hold things that you might need later, and you don't need to worry about threading (e.g. if you were thinking of using an in-class map)\nit's really powerful stuff\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-02-14T22:52:53Z", "url": "https://github.com/all-of-us/workbench/pull/3136", "merged": true, "mergeCommit": {"oid": "332cf0d529813bf3a73afea4516a57d5f8a28f75"}, "closed": true, "closedAt": "2020-02-20T15:52:18Z", "author": {"login": "jaycarlton"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEW-U1AH2gAyMzc1NjA1NzQwOjk3NzI5YWIyYjUyMWM5OGQ2YzEzOTQ3OWU0ZmI5ZGMwYjQ3ZWMwZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFmQCmgFqTM2MDU3MTMyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97729ab2b521c98d6c139479e4fb9dc0b47ec0ee", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/97729ab2b521c98d6c139479e4fb9dc0b47ec0ee", "committedDate": "2020-02-14T22:07:46Z", "message": "initial version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65347e50bb3ea0bf3bbe77256c6f4bf936b49656", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/65347e50bb3ea0bf3bbe77256c6f4bf936b49656", "committedDate": "2020-02-14T22:49:56Z", "message": "cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTcxMzI3", "url": "https://github.com/all-of-us/workbench/pull/3136#pullrequestreview-360571327", "createdAt": "2020-02-18T18:28:09Z", "commit": {"oid": "65347e50bb3ea0bf3bbe77256c6f4bf936b49656"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoyODowOVrOFrNibA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoyODowOVrOFrNibA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NDg5Mg==", "bodyText": "TOL: Since this is about tracking time, it could make sense to fold this and tracing together into a TimeTrackingInterceptor...", "url": "https://github.com/all-of-us/workbench/pull/3136#discussion_r380854892", "createdAt": "2020-02-18T18:28:09Z", "author": {"login": "s-rubenstein"}, "path": "api/src/main/java/org/pmiops/workbench/interceptors/ElapsedTimeDistributionInterceptor.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package org.pmiops.workbench.interceptors;\n+\n+import com.google.api.client.http.HttpMethods;\n+import java.time.Clock;\n+import java.time.Duration;\n+import java.time.Instant;\n+import java.util.Optional;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.pmiops.workbench.monitoring.LogsBasedMetricService;\n+import org.pmiops.workbench.monitoring.MeasurementBundle;\n+import org.pmiops.workbench.monitoring.labels.MetricLabel;\n+import org.pmiops.workbench.monitoring.views.DistributionMetric;\n+import org.springframework.stereotype.Service;\n+import org.springframework.web.method.HandlerMethod;\n+import org.springframework.web.servlet.ModelAndView;\n+import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;\n+\n+@Service\n+public class ElapsedTimeDistributionInterceptor extends HandlerInterceptorAdapter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65347e50bb3ea0bf3bbe77256c6f4bf936b49656"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3592, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}