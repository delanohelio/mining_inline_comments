{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NjkzOTY5", "number": 4376, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo0NDozMVrOFC576w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo0NDozMVrOFC576w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NTkwNjk5OnYy", "diffSide": "RIGHT", "path": "e2e/tests/workspace/cdr-version-upgrade.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo0NDozMVrOICSyuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTowODoxOFrOICZdkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3NTk2Mw==", "bodyText": "This is a different Cancel button from the button above, so I'd prefer a different variable name.  Then both of these can be const.", "url": "https://github.com/all-of-us/workbench/pull/4376#discussion_r539275963", "createdAt": "2020-12-09T12:44:31Z", "author": {"login": "jmthibault79"}, "path": "e2e/tests/workspace/cdr-version-upgrade.spec.ts", "diffHunk": "@@ -1,69 +1,62 @@\n import WorkspaceCard from 'app/component/workspace-card';\n+import {Page} from 'puppeteer';\n import {createWorkspace, signIn} from 'utils/test-utils';\n import {config} from 'resources/workbench-config';\n import WorkspaceDataPage from 'app/page/workspace-data-page';\n import WorkspaceBase from 'app/page/workspace-base';\n-import WorkspacesPage from 'app/page/workspaces-page';\n import WorkspaceEditPage from 'app/page/workspace-edit-page';\n-import Navigation, {NavLink} from 'app/component/navigation';\n import CdrVersionUpgradeModal from 'app/page/cdr-version-upgrade-modal';\n \n-describe('Workspace CDR Version upgrade', () => {\n+describe('Workspace CDR Version Upgrade modal', () => {\n     beforeEach(async () => {\n         await signIn(page);\n     });\n \n-   test('Clicking the CDR version upgrade flag pops up the upgrade modal', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        await workspaceCard.clickWorkspaceName();\n+   test('Clicking Cancel and Upgrade buttons', async () => {\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n-        expect(await workspacePage.getCdrVersion()).toBe(config.altCdrVersionName);\n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n+      const workspaceName = await workspaceCard.clickWorkspaceName();\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      const cdrVersion = await workspacePage.getCdrVersion();\n+      expect(cdrVersion).toBe(config.altCdrVersionName);\n \n-        // hit cancel\n-        const cancelButton = await modal.getCancelButton();\n-        await cancelButton.click();\n+      let modal = await launchCdrUpgradeModal(page);\n \n-        // new version flag remains\n-        await workspacePage.getNewCdrVersionFlag();\n+      // Clicking the Cancel\n+      let cancelButton = await modal.getCancelButton();\n+      await cancelButton.click();\n \n-        // cleanup\n-        await workspacePage.deleteWorkspace()\n-    });\n-\n-    test('Clicking the CDR version upgrade button opens the Duplicate Workspace Page', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        const workspaceName = await workspaceCard.clickWorkspaceName();\n+      // CDR version flag remains\n+      await workspacePage.getNewCdrVersionFlag();\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      // Clicking the Upgrade button opens the Duplicate Workspace Page\n+      modal = await launchCdrUpgradeModal(page);\n+      const upgradeButton = await modal.getUpgradeButton();\n+      await upgradeButton.click();\n \n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const duplicationPage = new WorkspaceEditPage(page);\n+      const upgradeMessage = await duplicationPage.getCdrVersionUpgradeMessage();\n+      expect(upgradeMessage).toContain(workspaceName);\n+      expect(upgradeMessage).toContain(`${config.altCdrVersionName} to ${config.defaultCdrVersionName}.`);\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      cancelButton = await duplicationPage.getCancelButton();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb261151786c6dd00e4a3239cfaebf49a996c6f"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM4NTIzMw==", "bodyText": "Done. Thanks.", "url": "https://github.com/all-of-us/workbench/pull/4376#discussion_r539385233", "createdAt": "2020-12-09T15:08:18Z", "author": {"login": "aweng98"}, "path": "e2e/tests/workspace/cdr-version-upgrade.spec.ts", "diffHunk": "@@ -1,69 +1,62 @@\n import WorkspaceCard from 'app/component/workspace-card';\n+import {Page} from 'puppeteer';\n import {createWorkspace, signIn} from 'utils/test-utils';\n import {config} from 'resources/workbench-config';\n import WorkspaceDataPage from 'app/page/workspace-data-page';\n import WorkspaceBase from 'app/page/workspace-base';\n-import WorkspacesPage from 'app/page/workspaces-page';\n import WorkspaceEditPage from 'app/page/workspace-edit-page';\n-import Navigation, {NavLink} from 'app/component/navigation';\n import CdrVersionUpgradeModal from 'app/page/cdr-version-upgrade-modal';\n \n-describe('Workspace CDR Version upgrade', () => {\n+describe('Workspace CDR Version Upgrade modal', () => {\n     beforeEach(async () => {\n         await signIn(page);\n     });\n \n-   test('Clicking the CDR version upgrade flag pops up the upgrade modal', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        await workspaceCard.clickWorkspaceName();\n+   test('Clicking Cancel and Upgrade buttons', async () => {\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n-        expect(await workspacePage.getCdrVersion()).toBe(config.altCdrVersionName);\n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n+      const workspaceName = await workspaceCard.clickWorkspaceName();\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      const cdrVersion = await workspacePage.getCdrVersion();\n+      expect(cdrVersion).toBe(config.altCdrVersionName);\n \n-        // hit cancel\n-        const cancelButton = await modal.getCancelButton();\n-        await cancelButton.click();\n+      let modal = await launchCdrUpgradeModal(page);\n \n-        // new version flag remains\n-        await workspacePage.getNewCdrVersionFlag();\n+      // Clicking the Cancel\n+      let cancelButton = await modal.getCancelButton();\n+      await cancelButton.click();\n \n-        // cleanup\n-        await workspacePage.deleteWorkspace()\n-    });\n-\n-    test('Clicking the CDR version upgrade button opens the Duplicate Workspace Page', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        const workspaceName = await workspaceCard.clickWorkspaceName();\n+      // CDR version flag remains\n+      await workspacePage.getNewCdrVersionFlag();\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      // Clicking the Upgrade button opens the Duplicate Workspace Page\n+      modal = await launchCdrUpgradeModal(page);\n+      const upgradeButton = await modal.getUpgradeButton();\n+      await upgradeButton.click();\n \n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const duplicationPage = new WorkspaceEditPage(page);\n+      const upgradeMessage = await duplicationPage.getCdrVersionUpgradeMessage();\n+      expect(upgradeMessage).toContain(workspaceName);\n+      expect(upgradeMessage).toContain(`${config.altCdrVersionName} to ${config.defaultCdrVersionName}.`);\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      cancelButton = await duplicationPage.getCancelButton();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3NTk2Mw=="}, "originalCommit": {"oid": "8fb261151786c6dd00e4a3239cfaebf49a996c6f"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3633, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}