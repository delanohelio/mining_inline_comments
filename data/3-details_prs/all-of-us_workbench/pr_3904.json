{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxODAyOTE0", "number": 3904, "title": "[RW-5101][risk=low] Reactify notebook list", "bodyText": "@calbach, @ericsong could I get some eyes on this - it is no longer in draft and is blocking the merging of two other router PRs that have been approved\nI believe pr 3917 will resolve the issues seen with switch and protected routes. I have removed Switch from the router and pushed the guard check down to the individual routes similar to Ariel's proposal. The child component will only render if the path matches.\nHaving played with the Switch component some more I am inclined to avoid it altogether as the order of the routes would implicitly have meaning - only the first match under a switch would render. If we would like to render multiple components under a tiered path (e.g. workspace/:wsid/notebooks/:notebookId) it may be a better pattern to add the routing under the component that initially renders the workspace rather than in one monolithic routing component.\nAriel's Notes:\nOpening as draft cause I'm trying to figure out an elegant way to deal with AppRoutes...\nReact builds components from the outside in. react-router's Switch component performs matching in its render() function before rendering any of the children. It expects that the children will be Routes instead of evaluating to Routes. So we need to either 1) force the evaluation, or 2) switch to using bare routes. The reason this is working right now is because of duck typing.\nSnippet in question:\n  _proto.render = function render() {\n    var _this = this;\n\n    return React.createElement(context.Consumer, null, function (context) {\n      !context ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"You should not use <Switch> outside a <Router>\") : invariant(false) : void 0;\n      var location = _this.props.location || context.location;\n      var element, match; // We use React.Children.forEach instead of React.Children.toArray().find()\n      // here because toArray adds keys to all child elements and we do not want\n      // to trigger an unmount/remount for two <Route>s that render the same\n      // component at different URLs.\n\n      React.Children.forEach(_this.props.children, function (child) {\n        if (match == null && React.isValidElement(child)) {\n          element = child;\n          var path = child.props.path || child.props.from;\n          match = path ? matchPath(location.pathname, _extends({}, child.props, {\n            path: path\n          })) : context.match;\n        }\n      });\n      return match ? React.cloneElement(element, {\n        location: location,\n        computedMatch: match\n      }) : null;\n    });\n  };\nThis function naively uses the children. It will not, for instance, do exact matching by default unless an exact prop exists on the child, regardless of what component the child is exactly.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-08-21T18:49:30Z", "url": "https://github.com/all-of-us/workbench/pull/3904", "merged": true, "mergeCommit": {"oid": "8b05511d7e7cd4ef6b57557aeb9f0c2921fba81d"}, "closed": true, "closedAt": "2020-09-01T12:26:18Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAzN7-gH2gAyNDcxODAyOTE0OjQ2MzQ3ZGM3YTU3MGQyYmNmMjc1MzNlNWEwYWM5ODVjNTYwMDBkOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEYvlrAFqTQ3ODkyNzIxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "46347dc7a570d2bcf27533e5a0ac985c56000d8b", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/46347dc7a570d2bcf27533e5a0ac985c56000d8b", "committedDate": "2020-08-20T16:57:37Z", "message": "shelving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdcc064fa2fb1f7976a4b1002c49a38461f9c769", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/cdcc064fa2fb1f7976a4b1002c49a38461f9c769", "committedDate": "2020-08-21T18:14:10Z", "message": "git add .! it works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6722c047acef9d73c604ceff4e635de7bc6d78f5", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6722c047acef9d73c604ceff4e635de7bc6d78f5", "committedDate": "2020-08-21T18:25:40Z", "message": "checkpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c29b1010a1721601eb1693d245d47f4f13d2e062", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c29b1010a1721601eb1693d245d47f4f13d2e062", "committedDate": "2020-08-21T20:41:33Z", "message": "LARGE NUMBER OF EXPLETIVES\\! IT WORKS\\!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODIzNDQ1", "url": "https://github.com/all-of-us/workbench/pull/3904#pullrequestreview-472823445", "createdAt": "2020-08-21T21:15:16Z", "commit": {"oid": "c29b1010a1721601eb1693d245d47f4f13d2e062"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c958cd9a01e712322f375554f2af8de5e1ab063f", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/c958cd9a01e712322f375554f2af8de5e1ab063f", "committedDate": "2020-08-26T20:15:13Z", "message": "Merge remote-tracking branch 'origin/master' into as/reactify-notebook-list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab2b901784f3595d2c907de3740cf69163d1bc38", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/ab2b901784f3595d2c907de3740cf69163d1bc38", "committedDate": "2020-08-26T20:20:02Z", "message": "Merge branch 'master' of github.com:all-of-us/workbench into as/reactify-notebook-list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77855a783d5a830d768adab864da07d338d788cd", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/77855a783d5a830d768adab864da07d338d788cd", "committedDate": "2020-08-26T20:39:57Z", "message": "De-angularize notebooks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeaba2af0dfcaf8f8553bd23d53f48fc5e4d93d5", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/aeaba2af0dfcaf8f8553bd23d53f48fc5e4d93d5", "committedDate": "2020-08-26T20:43:42Z", "message": "More de-angularizing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODgxMjkw", "url": "https://github.com/all-of-us/workbench/pull/3904#pullrequestreview-475881290", "createdAt": "2020-08-26T21:45:04Z", "commit": {"oid": "aeaba2af0dfcaf8f8553bd23d53f48fc5e4d93d5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo0NTowNFrOHHe1cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo0ODo1OFrOHHe7vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYwNzI4Mw==", "bodyText": "Was this intentional? Does not seem related to the PR", "url": "https://github.com/all-of-us/workbench/pull/3904#discussion_r477607283", "createdAt": "2020-08-26T21:45:04Z", "author": {"login": "calbach"}, "path": "ui/src/app/app-routing.module.ts", "diffHunk": "@@ -335,12 +337,12 @@ const routes: Routes = [\n             data: {}\n           },\n           {\n-            path: 'workspaceAudit',\n+            path: 'workspace-audit',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeaba2af0dfcaf8f8553bd23d53f48fc5e4d93d5"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYwODg5NA==", "bodyText": "The ticket includes dealing with these two parameters. Do we no longer intend to move these over piecemeal?", "url": "https://github.com/all-of-us/workbench/pull/3904#discussion_r477608894", "createdAt": "2020-08-26T21:48:58Z", "author": {"login": "calbach"}, "path": "ui/src/app/app-routing.module.ts", "diffHunk": "@@ -155,28 +156,29 @@ const routes: Routes = [\n                     children: [\n                       {\n                         path: '',\n-                        component: NotebookListComponent,\n+                        component: AppRouting,\n                         data: {\n-                          title: 'View Notebooks',\n                           breadcrumb: BreadcrumbType.Workspace,\n                           helpContentKey: 'notebooks'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeaba2af0dfcaf8f8553bd23d53f48fc5e4d93d5"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50ce5119413a06300e1735265db5c9835894f31c", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/50ce5119413a06300e1735265db5c9835894f31c", "committedDate": "2020-08-27T16:52:29Z", "message": "Add breadcrumb and helpContentKey to react route"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65a96a5db86085b82e506765882d3de0e1029ed3", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/65a96a5db86085b82e506765882d3de0e1029ed3", "committedDate": "2020-08-27T16:55:47Z", "message": "Merge remote-tracking branch 'origin/master' into as/reactify-notebook-list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "596347e25134483fbb748aed3f25aa83e500cb6e", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/596347e25134483fbb748aed3f25aa83e500cb6e", "committedDate": "2020-08-27T17:02:02Z", "message": "remove export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2644c22a09ef91d90e73a7296fa55e22795178", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/ac2644c22a09ef91d90e73a7296fa55e22795178", "committedDate": "2020-08-27T20:41:30Z", "message": "minor corrections"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "480bdfef469b20f0749b8cc960aabcfc6ac95feb", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/480bdfef469b20f0749b8cc960aabcfc6ac95feb", "committedDate": "2020-08-28T17:13:13Z", "message": "Clean up routeDataStore subscription"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NzkzNDcw", "url": "https://github.com/all-of-us/workbench/pull/3904#pullrequestreview-478793470", "createdAt": "2020-08-31T17:12:41Z", "commit": {"oid": "480bdfef469b20f0749b8cc960aabcfc6ac95feb"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNzoxMjo0MVrOHKBWFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNzoxNTo0M1rOHKBb8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2OTg0Ng==", "bodyText": "nit: This -> this", "url": "https://github.com/all-of-us/workbench/pull/3904#discussion_r480269846", "createdAt": "2020-08-31T17:12:41Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/workspace/workspace-wrapper/component.ts", "diffHunk": "@@ -65,6 +67,11 @@ export class WorkspaceWrapperComponent implements OnInit, OnDestroy {\n   }\n \n   ngOnInit(): void {\n+    // This is allows the react-router conversion to utilize the helpContentKey\n+    // Once we are fully converted the help sidebar and modals will need to be reworked a bit to eliminate\n+    // This Angular code", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "480bdfef469b20f0749b8cc960aabcfc6ac95feb"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI3MTM0Nw==", "bodyText": "Confirming: does the reactRouteData store get cleared with an empty object when you navigate away from the React routes? Or will this potentially contain stale data from the most recent route? Probably won't be a problem here..", "url": "https://github.com/all-of-us/workbench/pull/3904#discussion_r480271347", "createdAt": "2020-08-31T17:15:43Z", "author": {"login": "calbach"}, "path": "ui/src/app/components/breadcrumb.tsx", "diffHunk": "@@ -179,7 +182,7 @@ export const Breadcrumb = fp.flow(\n \n     trail(): Array<BreadcrumbData> {\n       return getTrail(\n-        this.props.routeConfigData.breadcrumb,\n+        this.props.routeConfigData.breadcrumb || this.props.reactRouteData.breadcrumb,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "480bdfef469b20f0749b8cc960aabcfc6ac95feb"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdd5777c7a76b0de1c2f20ebe252b6cb30367d53", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/bdd5777c7a76b0de1c2f20ebe252b6cb30367d53", "committedDate": "2020-08-31T17:32:45Z", "message": "Correct Comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTI3MjEz", "url": "https://github.com/all-of-us/workbench/pull/3904#pullrequestreview-478927213", "createdAt": "2020-08-31T20:22:38Z", "commit": {"oid": "480bdfef469b20f0749b8cc960aabcfc6ac95feb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4309, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}