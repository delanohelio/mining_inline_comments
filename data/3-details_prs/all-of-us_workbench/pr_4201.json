{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NjQ0NDM4", "number": 4201, "title": "[risk=low] Update codegen for image changes and quality of life", "bodyText": "Switch to mostly ! over %%bash. I didn't realize this initially, but ! streams stdout/stderr, while %%bash doesn't, which is critical here.\nAs a side-effect of that change, make the UUID generation hardcoded across cells\nUpdate flags per new image locations, flag changes, and other discussion\nPut VCF extracts into a separate folder; may want similar treatment for .mt and .phe files, not sure yet.\n\nAlso related find, can add these flags to the GATK extract to subset the data:\n        --min-probe-id \"0\" \\\n        --max-probe-id \"20000\" \\ # up to ~1.9m", "createdAt": "2020-10-23T01:33:29Z", "url": "https://github.com/all-of-us/workbench/pull/4201", "merged": true, "mergeCommit": {"oid": "30f0a09970a553753635ab37942981cfcfdf872a"}, "closed": true, "closedAt": "2020-10-26T20:07:21Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVaoKtgFqTUxNTg5NTkxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWZA28AFqTUxNzA3MDA3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODk1OTEx", "url": "https://github.com/all-of-us/workbench/pull/4201#pullrequestreview-515895911", "createdAt": "2020-10-23T18:09:40Z", "commit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODowOTo0MFrOHnYVZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODoxMTowMVrOHnYYLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1NTIwNQ==", "bodyText": "i think we need a trailing slash here?", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r511055205", "createdAt": "2020-10-23T18:09:40Z", "author": {"login": "ericsong"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -847,7 +851,7 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n             + \"\\n\"\n             + \"hl.plot.output_notebook()\\n\"\n             + \"bucket = os.environ['WORKSPACE_BUCKET']\\n\"\n-            + \"hl.import_vcf(f'{bucket}/\"\n+            + \"hl.import_vcf(f'{bucket}/cohort-extract\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1NTkxOA==", "bodyText": "we could switch this to synthetic_microarray_data which has the 100k samples", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r511055918", "createdAt": "2020-10-23T18:11:01Z", "author": {"login": "ericsong"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -740,41 +749,36 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n             + \"    for person_id in person_ids:\\n\"\n             + \"        cohort_file.write(str(person_id) + '\\\\n')\\n\"\n             + \"    cohort_file.close()\\n\",\n-        \"%%bash\\n\\n\"\n-            + \"uuid=$(cat /proc/sys/kernel/random/uuid | sed s/-/_/g)\\n\"\n-            // TODO: Writing to the \"tmp\" dataset is a temporary workaround until an alternative,\n-            // RW-5735\n-            + \"EXPORT_TABLE=\\\"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.${uuid}\\\"\\n\"\n-            + \"\\n\"\n-            + \"python3 /genomics/microarray/raw_array_cohort_extract.py \\\\\\n\"\n+        \"!python3 /usr/local/share/raw_array_cohort_extract.py \\\\\\n\"\n             + \"          --dataset fc-aou-cdr-synth-test.microarray_data \\\\\\n\"\n-            + \"          --fq_destination_table ${EXPORT_TABLE} \\\\\\n\"\n+            + \"          --fq_destination_table \"\n+            + cohortExtractTable\n+            + \" \\\\\\n\"\n             + \"          --query_project ${GOOGLE_PROJECT} \\\\\\n\"\n             // TODO: Replace hardcoded dataset reference: RW-5748\n-            + \"          --sample_mapping_table fc-aou-cdr-synth-test.microarray_data.sample_list \\\\\\n\"\n+            + \"          --fq_sample_mapping_table fc-aou-cdr-synth-test.microarray_data.sample_list \\\\\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "originalPosition": 71}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/ee77bfd71b3d67ec08d887c5aa06e0c192df6a37", "committedDate": "2020-10-23T01:22:43Z", "message": "Image updates / QOL"}, "afterCommit": {"oid": "07b5331b5b16db8854c3ad78cc7ac79331daa63b", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/07b5331b5b16db8854c3ad78cc7ac79331daa63b", "committedDate": "2020-10-23T22:07:02Z", "message": "PR feedback, test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31e3bd1db5d078c70a618ecaa3e2c50396d26a46", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/31e3bd1db5d078c70a618ecaa3e2c50396d26a46", "committedDate": "2020-10-23T22:08:35Z", "message": "Image updates / QOL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/8b8fe9c5c408c5c2aa43226b54d444db2609ab66", "committedDate": "2020-10-23T22:08:35Z", "message": "PR feedback, test fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07b5331b5b16db8854c3ad78cc7ac79331daa63b", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/07b5331b5b16db8854c3ad78cc7ac79331daa63b", "committedDate": "2020-10-23T22:07:02Z", "message": "PR feedback, test fixes"}, "afterCommit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/8b8fe9c5c408c5c2aa43226b54d444db2609ab66", "committedDate": "2020-10-23T22:08:35Z", "message": "PR feedback, test fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MDcwMDc5", "url": "https://github.com/all-of-us/workbench/pull/4201#pullrequestreview-517070079", "createdAt": "2020-10-26T18:36:33Z", "commit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODozNjozM1rOHodRRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODozNjozM1rOHodRRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE4NDY0NA==", "bodyText": "presumably we will eventually make this a per env parameter?", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r512184644", "createdAt": "2020-10-26T18:36:33Z", "author": {"login": "als364"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -721,6 +726,10 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n     final String cohortSampleNamesFilename = \"cohort_sample_names_\" + qualifier + \".txt\";\n     final String cohortSampleMapFilename = \"cohort_sample_map_\" + qualifier + \".csv\";\n     final String cohortVcfFilename = \"cohort_\" + qualifier + \".vcf\";\n+    // TODO(RW-5735): Writing to the \"tmp\" dataset is a temporary workaround.\n+    final String cohortExtractTable =\n+        \"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4015, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}