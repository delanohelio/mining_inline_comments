{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNzI2OTk4", "number": 4412, "title": "[no ticket][risk=no] Puppeteer Reduce tests flakiness", "bodyText": "Contains a number of small fixes:\n\nAdding missing {visible: true} in page.waitForXPath function.\nIncrease timeout for long notebook tests. test playback time varies a lot, may take a long time to run.\nAdd retry in few flaky functions.\nRework waitUntilEnabled function.\n\nruntime-status-update.spec.ts is flaky but the issue is not addressed in this PR.", "createdAt": "2020-12-15T21:20:48Z", "url": "https://github.com/all-of-us/workbench/pull/4412", "merged": true, "mergeCommit": {"oid": "f136bb6fc7ff514b50fe16078718dbfc7aa36212"}, "closed": true, "closedAt": "2020-12-16T18:50:48Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmhF7bAH2gAyNTQwNzI2OTk4OjhjNzUyMjkzZDAyYWQ4MGE2ZGMzNmRhNGFkMTg4ZTUyZjMzNWYxZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmymdSgH2gAyNTQwNzI2OTk4OjNlOWE5OTJkOGYzNjZiMjAyN2JmMzI4OGE1OTNiYjIyMzgxNzYyZjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c752293d02ad80a6dc36da4ad188e52f335f1e4", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8c752293d02ad80a6dc36da4ad188e52f335f1e4", "committedDate": "2020-12-15T21:19:42Z", "message": "waitForXpath condition visible true"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODk5NzA3", "url": "https://github.com/all-of-us/workbench/pull/4412#pullrequestreview-552899707", "createdAt": "2020-12-15T21:23:26Z", "commit": {"oid": "8c752293d02ad80a6dc36da4ad188e52f335f1e4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMToyNjoxNVrOIGgq6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMToyNzo0MFrOIGgugg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY5NzY0Mg==", "bodyText": "In notebook runtime panel, there is a img (spinner) element. remove svg so it works for img spinner too.", "url": "https://github.com/all-of-us/workbench/pull/4412#discussion_r543697642", "createdAt": "2020-12-15T21:26:15Z", "author": {"login": "aweng98"}, "path": "e2e/utils/waits-utils.ts", "diffHunk": "@@ -263,7 +263,7 @@ export async function waitForText(page: Page,\n  */\n export async function waitWhileLoading(page: Page, timeout: number = 90000): Promise<void> {\n   const notBlankPageSelector = '[data-test-id=\"sign-in-container\"], title:not(empty), div.spinner, svg[viewBox]';\n-  const spinElementsSelector = '[style*=\"running spin\"], .spinner:empty, svg[style*=\"running rotation\"]:not([aria-hidden=\"true\"])';\n+  const spinElementsSelector = '[style*=\"running spin\"], .spinner:empty, [style*=\"running rotation\"]:not([aria-hidden=\"true\"])';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c752293d02ad80a6dc36da4ad188e52f335f1e4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY5ODU2Mg==", "bodyText": "Little time to allow UI elements to start rendering in UI", "url": "https://github.com/all-of-us/workbench/pull/4412#discussion_r543698562", "createdAt": "2020-12-15T21:27:40Z", "author": {"login": "aweng98"}, "path": "e2e/utils/waits-utils.ts", "diffHunk": "@@ -276,6 +276,8 @@ export async function waitWhileLoading(page: Page, timeout: number = 90000): Pro\n     const elements = document.querySelectorAll(css);\n     return elements && elements.length === 0;\n   }, {polling: 'mutation', timeout}, spinElementsSelector);\n+\n+  await page.waitForTimeout(500);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c752293d02ad80a6dc36da4ad188e52f335f1e4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d4211e8982b9de8cef732daabd0f0b2271e58e", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f7d4211e8982b9de8cef732daabd0f0b2271e58e", "committedDate": "2020-12-15T22:02:18Z", "message": "getComputedStyle fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cdda50c626c8f50fd9cea4f5fb8b82e9c776390", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9cdda50c626c8f50fd9cea4f5fb8b82e9c776390", "committedDate": "2020-12-15T23:38:56Z", "message": "additional fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebea8200940f5cf82b74ecccdc250943d85cdef9", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ebea8200940f5cf82b74ecccdc250943d85cdef9", "committedDate": "2020-12-16T00:42:28Z", "message": "disable timeout in submit function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "345bc3f655b1987383e6aba22db33612b5e5fcf8", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/345bc3f655b1987383e6aba22db33612b5e5fcf8", "committedDate": "2020-12-16T01:13:38Z", "message": "more fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b826debd5ed779712786be4489ca527a7d9f7026", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b826debd5ed779712786be4489ca527a7d9f7026", "committedDate": "2020-12-16T13:39:56Z", "message": "revert unrelated changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9b0aaf97217f11a8a61a25694a9a03ca74cf8dab", "committedDate": "2020-12-16T14:52:35Z", "message": "update missing package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNzY2MDk1", "url": "https://github.com/all-of-us/workbench/pull/4412#pullrequestreview-553766095", "createdAt": "2020-12-16T14:54:46Z", "commit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDo1NDo0NlrOIHJURQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDo1NDo0NlrOIHJURQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM2MzU4OQ==", "bodyText": "Add missing package.", "url": "https://github.com/all-of-us/workbench/pull/4412#discussion_r544363589", "createdAt": "2020-12-16T14:54:46Z", "author": {"login": "aweng98"}, "path": "e2e/package.json", "diffHunk": "@@ -51,6 +51,7 @@\n     \"fs-extra\": \"9.0.1\",\n     \"jest\": \"26.6.3\",\n     \"jest-circus\": \"26.6.3\",\n+    \"jest-config\": \"26.6.3\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzODk1MTE4", "url": "https://github.com/all-of-us/workbench/pull/4412#pullrequestreview-553895118", "createdAt": "2020-12-16T17:00:28Z", "commit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzowMDoyOVrOIHPi0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzowMzowMVrOIHPp6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ2NTYxNg==", "bodyText": "check inidentation here.", "url": "https://github.com/all-of-us/workbench/pull/4412#discussion_r544465616", "createdAt": "2020-12-16T17:00:29Z", "author": {"login": "jaycarlton"}, "path": "e2e/app/element/checkbox.ts", "diffHunk": "@@ -29,22 +28,22 @@ export default class Checkbox extends BaseElement {\n    * Click (check) checkbox element.\n    */\n   async check(maxAttempts: number = 2): Promise<void> {\n+    const click = async () => {\n+      await this.clickWithEval();\n+      await this.page.waitForTimeout(500);\n+      const isChecked = await this.isChecked();\n+      if (isChecked) {\n+        return;\n+      }\n+      if (maxAttempts <= 0) {\n+        return;\n+      }\n+    maxAttempts--;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ2NzQzNA==", "bodyText": "30 minutes? This is min * sec * millis riight?", "url": "https://github.com/all-of-us/workbench/pull/4412#discussion_r544467434", "createdAt": "2020-12-16T17:03:01Z", "author": {"login": "jaycarlton"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -68,6 +68,6 @@ describe('Jupyter notebook download test', () => {\n     // As of 9/25/20 I was unable to find a clear mechanism for accessing this.\n \n     await notebook.deleteNotebook(notebookName);\n-  }, 20 * 60 * 1000);\n+  }, 30 * 60 * 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4afacae921c2dd1d3e67b86b9d3c87660a62126f", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/4afacae921c2dd1d3e67b86b9d3c87660a62126f", "committedDate": "2020-12-16T17:07:16Z", "message": "formating"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzOTAyMTA4", "url": "https://github.com/all-of-us/workbench/pull/4412#pullrequestreview-553902108", "createdAt": "2020-12-16T17:08:02Z", "commit": {"oid": "4afacae921c2dd1d3e67b86b9d3c87660a62126f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzowODowMlrOIHP4jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzowODowMlrOIHP4jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3MTE4Mw==", "bodyText": "yes, it's 30 minutes.", "url": "https://github.com/all-of-us/workbench/pull/4412#discussion_r544471183", "createdAt": "2020-12-16T17:08:02Z", "author": {"login": "aweng98"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -68,6 +68,6 @@ describe('Jupyter notebook download test', () => {\n     // As of 9/25/20 I was unable to find a clear mechanism for accessing this.\n \n     await notebook.deleteNotebook(notebookName);\n-  }, 20 * 60 * 1000);\n+  }, 30 * 60 * 1000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ2NzQzNA=="}, "originalCommit": {"oid": "9b0aaf97217f11a8a61a25694a9a03ca74cf8dab"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "736d53ec96ba9eb92ed3c8fe658830a2b8b028d2", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/736d53ec96ba9eb92ed3c8fe658830a2b8b028d2", "committedDate": "2020-12-16T17:41:33Z", "message": "undo throw error in puppeteer-custom-environment.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e9a992d8f366b2027bf3288a593bb22381762f9", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3e9a992d8f366b2027bf3288a593bb22381762f9", "committedDate": "2020-12-16T17:43:37Z", "message": "increase timeout waiting for runtime"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3772, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}