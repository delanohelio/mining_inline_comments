{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODEzNzY0", "number": 2963, "title": "[RW-4075][risk=no] Ask user for confirmation when concept set with a dataset reference is being deleted", "bodyText": "Description:\nThis fixes a bug where the warning modal for deleting concept sets with existing references no longer appeared. This was caused by a refactoring where we swapped in enum references for ResourceTypes in our display code. The enum values were being used as a parameter in the getDataSetsByResourceId API method. By changing the enum values to the display strings, it also changed the parameter value that gets sent to the API. The API didn't know how to interpret the new value and returned an empty list, a response which the front end treats as a sign that its OK to delete.\nMy solution was to create an enum type in swagger which both the API and front end uses in the API calls. I also refactored the front end to use this enum type as a replacement for its previously defined ResourceType enum.\nNotes\n\nSwagger 2 does not support objects in GET methods since they do not support objects in path and query parameters. Swagger 3 does\nI changed the getDataSetsByResourceId to be a POST request so I can send a body and parameterize it as an object through Swagger. We can change this back to a GET when we upgrade to Swagger 3.\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-01-02T22:20:34Z", "url": "https://github.com/all-of-us/workbench/pull/2963", "merged": true, "mergeCommit": {"oid": "b1684307a805d64be376933cea5419aa1bf26125"}, "closed": true, "closedAt": "2020-01-09T19:01:30Z", "author": {"login": "ericsong"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbx_6GhAH2gAyMzU4ODEzNzY0OjA3YzRlZDI5MDE3ODk3ZDJhMjcxNzZiZjhlNmJlMWZkOTEyYzNjYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4uMQ5gFqTM0MDcyMjUwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "07c4ed29017897d2a27176bf8e6be1fd912c3cae", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/07c4ed29017897d2a27176bf8e6be1fd912c3cae", "committedDate": "2019-12-19T21:04:42Z", "message": "use ResourceType enum on backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88bcef4decd34833376787adf5881bf10e580568", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/88bcef4decd34833376787adf5881bf10e580568", "committedDate": "2019-12-20T19:33:44Z", "message": "WIP: refactor ResourceType to not rely the enum value for display printing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2f4417de219fd8dfe69dfbcf1c9ef56e8c00448", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/b2f4417de219fd8dfe69dfbcf1c9ef56e8c00448", "committedDate": "2019-12-20T19:55:40Z", "message": "remove invalid enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0df3053ed6a64685a124ec5a6e72f80b80e003fe", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/0df3053ed6a64685a124ec5a6e72f80b80e003fe", "committedDate": "2019-12-20T20:19:38Z", "message": "swap out ResourceType enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd729ff677c0cfe038293f87e2077de3d79a8fe", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/ffd729ff677c0cfe038293f87e2077de3d79a8fe", "committedDate": "2020-01-02T20:31:10Z", "message": "Merge branch 'master' of github.com:all-of-us/workbench into songe/RW-4075"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c068f4723c0ef6749a707469235aa0c43c96ff8a", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/c068f4723c0ef6749a707469235aa0c43c96ff8a", "committedDate": "2020-01-02T20:59:53Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68856b637a6b359059840b9282f417911e5b72d7", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/68856b637a6b359059840b9282f417911e5b72d7", "committedDate": "2020-01-02T21:50:57Z", "message": "switch get to post so we can send body"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f888011937eb7d8884d4bb5faf91afd06180b00", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/9f888011937eb7d8884d4bb5faf91afd06180b00", "committedDate": "2020-01-02T22:09:15Z", "message": "rename prop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30b2a3253ce992d8e05bca491bdcdd9b16bbb704", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/30b2a3253ce992d8e05bca491bdcdd9b16bbb704", "committedDate": "2020-01-02T22:25:51Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5OTU5NDAx", "url": "https://github.com/all-of-us/workbench/pull/2963#pullrequestreview-339959401", "createdAt": "2020-01-08T15:52:18Z", "commit": {"oid": "30b2a3253ce992d8e05bca491bdcdd9b16bbb704"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNTo1MjoxOFrOFbbRpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNTo1OToyOFrOFbbhaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDMwMjc1OA==", "bodyText": "Why did this need to be changed to a POST?", "url": "https://github.com/all-of-us/workbench/pull/2963#discussion_r364302758", "createdAt": "2020-01-08T15:52:18Z", "author": {"login": "als364"}, "path": "api/src/main/resources/workbench.yaml", "diffHunk": "@@ -2027,12 +2027,13 @@ paths:\n     parameters:\n       - $ref: '#/parameters/workspaceNamespace'\n       - $ref: '#/parameters/workspaceId'\n-    get:\n+    post:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b2a3253ce992d8e05bca491bdcdd9b16bbb704"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDMwMzc5Mg==", "bodyText": "Nit: it looks like sometimes we name these enums ThingEnum and sometimes we name them Thing. Maybe we should be consistent about that. Not sure which we have more of or if we have a strong preference.", "url": "https://github.com/all-of-us/workbench/pull/2963#discussion_r364303792", "createdAt": "2020-01-08T15:54:08Z", "author": {"login": "als364"}, "path": "api/src/main/resources/workbench.yaml", "diffHunk": "@@ -2974,7 +2975,17 @@ definitions:\n         type: integer\n         format: int64\n       resourceType:\n-        type: string\n+        $ref: \"#/definitions/ResourceType\"\n+\n+  ResourceType:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b2a3253ce992d8e05bca491bdcdd9b16bbb704"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDMwNjc5NQ==", "bodyText": "you think this was left in here by mistake or was this a pattern we used to do?", "url": "https://github.com/all-of-us/workbench/pull/2963#discussion_r364306795", "createdAt": "2020-01-08T15:59:28Z", "author": {"login": "als364"}, "path": "ui/src/app/components/resource-card.tsx", "diffHunk": "@@ -212,15 +209,11 @@ export class ResourceCard extends React.Component<Props, State> {\n \n   async getDataSetByResourceId(id) {\n     if (this.state.dataSetByResourceIdList.length === 0) {\n-      try {\n-        const dataSetList = await dataSetApi().getDataSetByResourceId(\n-          this.props.resourceCard.workspaceNamespace,\n-          this.props.resourceCard.workspaceFirecloudName,\n-          this.resourceType, id);\n-        return dataSetList.items;\n-      } catch (ex) {\n-        console.log(ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b2a3253ce992d8e05bca491bdcdd9b16bbb704"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzIyNTA5", "url": "https://github.com/all-of-us/workbench/pull/2963#pullrequestreview-340722509", "createdAt": "2020-01-09T18:23:43Z", "commit": {"oid": "30b2a3253ce992d8e05bca491bdcdd9b16bbb704"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3809, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}