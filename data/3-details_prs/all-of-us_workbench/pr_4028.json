{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NTI1MjEx", "number": 4028, "title": "[risk=medium][RW-5471][RW-5472] List workspace files on admin page", "bodyText": "PR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-09-18T20:26:42Z", "url": "https://github.com/all-of-us/workbench/pull/4028", "merged": true, "mergeCommit": {"oid": "11a8d9aa880393e0d2f80b3036a72b147a5bf536"}, "closed": true, "closedAt": "2020-09-23T22:23:13Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKLqyRAFqTQ5MTc2MzY4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLzxrEgH2gAyNDg5NTI1MjExOjdjYjBjZGZmMGZmNDZhZjA4OWM5ZjUwMWY0MGJmYWVhNDgxYmU1OWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzYzNjg5", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-491763689", "createdAt": "2020-09-18T20:32:09Z", "commit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMjowOVrOHUbChw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMjowOVrOHUbChw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NjU4Mw==", "bodyText": "alt: FileDetailMapper?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491176583", "createdAt": "2020-09-18T20:32:09Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/google/CloudStorageService.java", "diffHunk": "@@ -56,4 +57,14 @@ ServiceAccountCredentials getGarbageCollectionServiceAccountCredentials(\n   String getMoodleApiKey();\n \n   String getCaptchaServerKey();\n+\n+  default FileDetail blobToFileDetail(Blob blob, String bucketName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzY0MjU5", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-491764259", "createdAt": "2020-09-18T20:33:12Z", "commit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMzoxMlrOHUbEXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMzoxMlrOHUbEXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NzA1Mg==", "bodyText": "alt: include this (and also cloudStorageTraffic?) in the WorkspaceAdminView", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491177052", "createdAt": "2020-09-18T20:33:12Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1720,6 +1720,21 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n+  \"/v1/admin/workspaces/{workspaceNamespace}/files\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzY0Njkz", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-491764693", "createdAt": "2020-09-18T20:34:02Z", "commit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNDowMlrOHUbFsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNDowMlrOHUbFsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NzM5NQ==", "bodyText": "extracted from AdminWorkspaceImpl class", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491177395", "createdAt": "2020-09-18T20:34:02Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -30,22 +35,100 @@ const styles = reactStyles({\n   narrowWithMargin: {\n     width: '10rem',\n     marginRight: '1rem'\n-  }\n-});\n+  },\n+  fileDetailsTable: {\n+    maxWidth: '1000px',\n+    marginTop: '1rem',\n+  },\n+})\n \n const PurpleLabel = ({style = {}, children}) => {\n   return <label style={{color: colors.primary, ...style}}>\n     {...children}\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzY1Njcw", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-491765670", "createdAt": "2020-09-18T20:35:48Z", "commit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNTo0OFrOHUbItQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNTo0OFrOHUbItQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3ODE2NQ==", "bodyText": "alt: parseLocation, deriveLocation, etc?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491178165", "createdAt": "2020-09-18T20:35:48Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -30,22 +35,100 @@ const styles = reactStyles({\n   narrowWithMargin: {\n     width: '10rem',\n     marginRight: '1rem'\n-  }\n-});\n+  },\n+  fileDetailsTable: {\n+    maxWidth: '1000px',\n+    marginTop: '1rem',\n+  },\n+})\n \n const PurpleLabel = ({style = {}, children}) => {\n   return <label style={{color: colors.primary, ...style}}>\n     {...children}\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={{width: '80%', maxWidth: '1000px'}}>\n+    <PurpleLabel\n+        style={{\n+          width: '250px',\n+          minWidth: '180px',\n+          textAlign: 'right',\n+          marginRight: '1rem',\n+        }}\n+    >\n+      {labelText}\n+    </PurpleLabel>\n+    <div\n+        style={{\n+          flex: 1,\n+          wordWrap: 'break-word',\n+        }}\n+    >\n+      {divContents}\n+    </div>\n+  </FlexRow>;\n+};\n+\n+const FileDetails = (props: {data: WorkspaceFiles}) => {\n+  const {data} = props;\n+  const {bucket} = data;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: number;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzcwNzcx", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-491770771", "createdAt": "2020-09-18T20:45:34Z", "commit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTozNFrOHUbYbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTozNFrOHUbYbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE4MjE4OQ==", "bodyText": "these are all whitespace and this. removal", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491182189", "createdAt": "2020-09-18T20:45:34Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -209,23 +273,14 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           <h2>Workspace</h2>\n           <h3>Basic Information</h3>\n           <div className='basic-info' style={{marginTop: '1rem'}}>\n-            {this.workspaceInfoField('Workspace Name', workspace.name)}\n-            {this.workspaceInfoField('Google Project Id', workspace.namespace)}\n-            {this.workspaceInfoField('Billing Status', workspace.billingStatus)}\n-            {this.workspaceInfoField('Billing Account Type', workspace.billingAccountType)}\n-            {this.workspaceInfoField(\n-              'Creation Time',\n-              new Date(workspace.creationTime).toDateString()\n-            )}\n-            {this.workspaceInfoField(\n-              'Last Modified Time',\n-              new Date(workspace.lastModifiedTime).toDateString()\n-            )}\n-            {this.workspaceInfoField(\n-              'Workspace Published',\n-              workspace.published ? 'Yes' : 'No'\n-            )}\n-            {this.workspaceInfoField('Audit', <a href={`/admin/workspace-audit/${workspace.namespace}`}>Audit History</a>)}\n+            {workspaceInfoField('Workspace Name', workspace.name)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 199}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzcwOTA1", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-491770905", "createdAt": "2020-09-18T20:45:49Z", "commit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTo0OVrOHUbY4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTo0OVrOHUbY4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE4MjMwNA==", "bodyText": "here's the new component!", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491182304", "createdAt": "2020-09-18T20:45:49Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,82 +292,29 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            {workspaceInfoField('# of Cohorts', resources.workspaceObjects.cohortCount)}\n+            {workspaceInfoField('# of Concept Sets', resources.workspaceObjects.conceptSetCount)}\n+            {workspaceInfoField('# of Data Sets', resources.workspaceObjects.datasetCount)}\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            {workspaceInfoField('# of Notebook Files', resources.cloudStorage.notebookFileCount)}\n+            {workspaceInfoField('# of Non-Notebook Files', resources.cloudStorage.nonNotebookFileCount)}\n+            {workspaceInfoField('Storage used (bytes)', resources.cloudStorage.storageBytesUsed)}\n           </div>\n+          {files && <FileDetails data={files}/>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 260}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00930c052a6aa11f2d863a012168de86a04d9a45", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/00930c052a6aa11f2d863a012168de86a04d9a45", "committedDate": "2020-09-21T14:53:47Z", "message": "post rebase"}, "afterCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b32e41ea10724f941cf3bd47865b0145f5fbe00e", "committedDate": "2020-09-22T12:26:30Z", "message": "restyle workspaceInfoField and reword a few entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNDE2Nzg1", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493416785", "createdAt": "2020-09-22T12:42:46Z", "commit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0Mjo0NlrOHV4G5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0Mjo0NlrOHV4G5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMTQxMg==", "bodyText": "This line is the only addition.  The rest was moved as-is from NotebooksServiceImpl.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492701412", "createdAt": "2020-09-22T12:42:46Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/google/CloudStorageService.java", "diffHunk": "@@ -56,4 +57,14 @@ ServiceAccountCredentials getGarbageCollectionServiceAccountCredentials(\n   String getMoodleApiKey();\n \n   String getCaptchaServerKey();\n+\n+  default FileDetail blobToFileDetail(Blob blob, String bucketName) {\n+    String[] parts = blob.getName().split(\"/\");\n+    FileDetail fileDetail = new FileDetail();\n+    fileDetail.setName(parts[parts.length - 1]);\n+    fileDetail.setPath(\"gs://\" + bucketName + \"/\" + blob.getName());\n+    fileDetail.setLastModifiedTime(blob.getUpdateTime());\n+    fileDetail.setSize(blob.getSize());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNDE3MTkx", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493417191", "createdAt": "2020-09-22T12:43:16Z", "commit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0MzoxNlrOHV4ICw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0MzoxNlrOHV4ICw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMTcwNw==", "bodyText": "alt name: listFiles?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492701707", "createdAt": "2020-09-22T12:43:16Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -64,4 +66,10 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n         workspaceAdminService.getReadOnlyNotebook(workspaceNamespace, notebookName, accessReason);\n     return ResponseEntity.ok(new ReadOnlyNotebookResponse().html(notebookHtml));\n   }\n+\n+  @Override\n+  @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n+  public ResponseEntity<List<FileDetail>> getFiles(String workspaceNamespace) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNDE4MjY2", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493418266", "createdAt": "2020-09-22T12:44:28Z", "commit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NDoyOFrOHV4LKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NDoyOFrOHV4LKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMjUwNA==", "bodyText": "extracted from workspaceInfoField()", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492702504", "createdAt": "2020-09-22T12:44:28Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -18,19 +18,41 @@ import {\n } from 'app/utils/research-purpose';\n import {\n   CloudStorageTraffic,\n-  ListRuntimeResponse, WorkspaceAdminView,\n+  FileDetail,\n+  ListRuntimeResponse,\n+  WorkspaceAdminView,\n } from 'generated/fetch';\n+import {Column} from 'primereact/column';\n+import {DataTable} from 'primereact/datatable';\n import {ReactFragment} from 'react';\n \n const styles = reactStyles({\n+  infoRow: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNDE5MzA4", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493419308", "createdAt": "2020-09-22T12:45:45Z", "commit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NTo0NVrOHV4OUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NTo0NVrOHV4OUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMzMxMg==", "bodyText": "changed this text to be more precise.  See the comments at https://precisionmedicineinitiative.atlassian.net/browse/RW-5471", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492703312", "createdAt": "2020-09-22T12:45:45Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,88 +283,29 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            {workspaceInfoField('# of Cohorts', resources.workspaceObjects.cohortCount)}\n+            {workspaceInfoField('# of Concept Sets', resources.workspaceObjects.conceptSetCount)}\n+            {workspaceInfoField('# of Data Sets', resources.workspaceObjects.datasetCount)}\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            {workspaceInfoField('GCS bucket path', resources.cloudStorage.storageBucketPath)}\n+            {workspaceInfoField('# of Workbench-managed notebook files', resources.cloudStorage.notebookFileCount)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 255}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8acfd2170ffb82364a89d071b0c974cb390c826", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b8acfd2170ffb82364a89d071b0c974cb390c826", "committedDate": "2020-09-22T17:03:13Z", "message": "List workspace files on admin page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45b81e62250281ccd4609005a3b201e4e1c483e3", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/45b81e62250281ccd4609005a3b201e4e1c483e3", "committedDate": "2020-09-22T17:03:14Z", "message": "restyle workspaceInfoField and reword a few entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f3ce99c606ca3fb8eb267fcd33ac59fb195d389", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2f3ce99c606ca3fb8eb267fcd33ac59fb195d389", "committedDate": "2020-09-22T17:03:14Z", "message": "Display file size in MB"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b2fb9f8a50f784cbe9ac1d9c1bcab183423382", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/c1b2fb9f8a50f784cbe9ac1d9c1bcab183423382", "committedDate": "2020-09-22T17:03:14Z", "message": "test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f0089cba882b00a8f5b401a7d7284be71f0251c", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3f0089cba882b00a8f5b401a7d7284be71f0251c", "committedDate": "2020-09-22T17:03:15Z", "message": "test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/400dd699e8ceca70ee6b352b0a924a0a3c82c69a", "committedDate": "2020-09-22T17:03:15Z", "message": "getFiles() test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80259af68cccb9d9871826d31297f2bf6680aa33", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/80259af68cccb9d9871826d31297f2bf6680aa33", "committedDate": "2020-09-22T15:05:22Z", "message": "getFiles() test"}, "afterCommit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/400dd699e8ceca70ee6b352b0a924a0a3c82c69a", "committedDate": "2020-09-22T17:03:15Z", "message": "getFiles() test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNjc2Mzgw", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493676380", "createdAt": "2020-09-22T17:09:23Z", "commit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowOToyNFrOHWENoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowOToyNFrOHWENoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5OTc0NQ==", "bodyText": "unused here.  useful for the other test, so I moved it there.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492899745", "createdAt": "2020-09-22T17:09:24Z", "author": {"login": "jmthibault79"}, "path": "api/src/test/java/org/pmiops/workbench/api/WorkspacesControllerTest.java", "diffHunk": "@@ -471,15 +475,6 @@ private void mockBillingProjectBuffer(String projectName) {\n     doReturn(entry).when(billingProjectBufferService).assignBillingProject(any());\n   }\n \n-  private Blob mockBlob(String bucket, String path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5570472a5f9c303d8fb24c931a2804375aef0931", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/5570472a5f9c303d8fb24c931a2804375aef0931", "committedDate": "2020-09-22T17:10:40Z", "message": "rebase fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNjc4NDgx", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493678481", "createdAt": "2020-09-22T17:12:07Z", "commit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxMjowN1rOHWEUBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxMjowN1rOHWEUBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwMTM4MA==", "bodyText": "These 3 lines copied from some other DataTable.  I can remove/adjust if inappropriate here.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492901380", "createdAt": "2020-09-22T17:12:07Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');\n+  };\n+\n+  const formatMB = (fileSize: number): string => {\n+    const mb = fileSize / 1000000.0;\n+    if (mb < 1.0) {\n+      return '<1';\n+    } else {\n+      return mb.toFixed(2);\n+    }\n+  };\n+\n+  const formattedData: Array<TableEntry> = data.map(file => {\n+    return {\n+      name: file.name,\n+      size: formatMB(file.size),\n+      location: getLocation(file)\n+    };\n+  });\n+\n+  const sortedData = formattedData.sort((a, b) => {\n+    const locCmp = a.location.localeCompare(b.location);\n+    if (locCmp === 0) {\n+      return a.name.localeCompare(b.name);\n+    } else {\n+      return locCmp;\n+    }\n+  });\n+\n+  return <DataTable\n+      data-test-id='object-details-table'\n+      value={sortedData}\n+      style={styles.fileDetailsTable}\n+      scrollable={true}\n+      paginator={true}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/743b4d780c19a67c6b05871efdab6cba13494c9a", "committedDate": "2020-09-22T17:21:15Z", "message": "Rename FileDetail.size to sizeInBytes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzQ5Nzg4", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-493749788", "createdAt": "2020-09-22T18:46:01Z", "commit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo0NjowMlrOHWHwwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOToyMToxNlrOHWI-3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1Nzg4OA==", "bodyText": "I like listFiles", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492957888", "createdAt": "2020-09-22T18:46:02Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -64,4 +66,10 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n         workspaceAdminService.getReadOnlyNotebook(workspaceNamespace, notebookName, accessReason);\n     return ResponseEntity.ok(new ReadOnlyNotebookResponse().html(notebookHtml));\n   }\n+\n+  @Override\n+  @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n+  public ResponseEntity<List<FileDetail>> getFiles(String workspaceNamespace) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMTcwNw=="}, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg==", "bodyText": "It's worth noting that the implementation for getBlobList is flawed - it only returns the first page of results. This is probably acceptable for your use case here, though it would be ideal to communicate whether there are more files or not back to the admin page. I think it will present more of a problem for us on the admin page - more so than on the user-facing page, since people may have a large number of object files living outside of the main notebooks/ directory.\nDo you mind adding a disclaimer to this method? Ideally the admin method would also communicate storage.get(bucketName).list().hasNextPage() back to the client.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492963502", "createdAt": "2020-09-22T18:55:17Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NDAxMQ==", "bodyText": "I think I like what you've done here with splitting it out. In the future, if we need to paginate this endpoint we'll have the flexibility to do so.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492964011", "createdAt": "2020-09-22T18:56:08Z", "author": {"login": "calbach"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1720,6 +1720,21 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n+  \"/v1/admin/workspaces/{workspaceNamespace}/files\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NzA1Mg=="}, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2OTQ3MQ==", "bodyText": "Existing issue, so feel free to ignore this for now:\nI'm wondering whether it might be more idiomatic to just make this into a private function component as you did for FileDetailsTable, since it's only a few characters removed from that currently (maybe @petesantos has an opinion on this):\nconst WorkspaceInfoField = ({labelText, children}) => {\n  ...\n};\n\nlater..\n<WorkspaceInfoField labelText=\"...\"> ... </WorkspaceInfoField>", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492969471", "createdAt": "2020-09-22T19:05:20Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3MzIwMw==", "bodyText": "FYI: Technically there is a middle-ground, which are notebooks in subdirs of notebooks/. These are synchronized back/forth to the notebook VM/GCS, but are not displayed on the RW notebooks list page. Way too much detail for this line, and I don't think I would change the description you have here.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492973203", "createdAt": "2020-09-22T19:12:26Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,88 +283,29 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            {workspaceInfoField('# of Cohorts', resources.workspaceObjects.cohortCount)}\n+            {workspaceInfoField('# of Concept Sets', resources.workspaceObjects.conceptSetCount)}\n+            {workspaceInfoField('# of Data Sets', resources.workspaceObjects.datasetCount)}\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            {workspaceInfoField('GCS bucket path', resources.cloudStorage.storageBucketPath)}\n+            {workspaceInfoField('# of Workbench-managed notebook files', resources.cloudStorage.notebookFileCount)}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMzMxMg=="}, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 255}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3MzY4Mg==", "bodyText": "Really nice solution, thank you. Could you apply this to the total on L304 as well?\nThis also satisfies the AC on https://precisionmedicineinitiative.atlassian.net/browse/RW-5472 , so please close that with this PR as well - if you don't mind.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492973682", "createdAt": "2020-09-22T19:13:24Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');\n+  };\n+\n+  const formatMB = (fileSize: number): string => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NDk4MQ==", "bodyText": "parseLocation seems reasonable to me", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492974981", "createdAt": "2020-09-22T19:15:48Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -30,22 +35,100 @@ const styles = reactStyles({\n   narrowWithMargin: {\n     width: '10rem',\n     marginRight: '1rem'\n-  }\n-});\n+  },\n+  fileDetailsTable: {\n+    maxWidth: '1000px',\n+    marginTop: '1rem',\n+  },\n+})\n \n const PurpleLabel = ({style = {}, children}) => {\n   return <label style={{color: colors.primary, ...style}}>\n     {...children}\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={{width: '80%', maxWidth: '1000px'}}>\n+    <PurpleLabel\n+        style={{\n+          width: '250px',\n+          minWidth: '180px',\n+          textAlign: 'right',\n+          marginRight: '1rem',\n+        }}\n+    >\n+      {labelText}\n+    </PurpleLabel>\n+    <div\n+        style={{\n+          flex: 1,\n+          wordWrap: 'break-word',\n+        }}\n+    >\n+      {divContents}\n+    </div>\n+  </FlexRow>;\n+};\n+\n+const FileDetails = (props: {data: WorkspaceFiles}) => {\n+  const {data} = props;\n+  const {bucket} = data;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: number;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3ODE2NQ=="}, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Nzg4Nw==", "bodyText": "Current approach incorrectly handles this input:\nparseLocation({... 'gs://bkt/foo/bar/foo'}) -> 'gs://bkt/bar/foo'\n\nProbably substring() is best here; regexp is a bit dicey since the prefix/suffix are ultimately user input.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492977887", "createdAt": "2020-09-22T19:21:16Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b936ed8cef4a7abac836b5100522f87419f13df", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/5b936ed8cef4a7abac836b5100522f87419f13df", "committedDate": "2020-09-22T19:36:00Z", "message": "renamed to parseLocation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e4a902d6bf84c2159a0328b05699bafe1f5c2f0", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6e4a902d6bf84c2159a0328b05699bafe1f5c2f0", "committedDate": "2020-09-22T19:41:01Z", "message": "getFiles -> listFiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bb6621fc5942c99b80d655edd9154679c050e3e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3bb6621fc5942c99b80d655edd9154679c050e3e", "committedDate": "2020-09-22T19:43:04Z", "message": "apply formatMB() to total storage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38c31fc1245d2f48479c374f318ca46801d15013", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/38c31fc1245d2f48479c374f318ca46801d15013", "committedDate": "2020-09-22T20:07:59Z", "message": "convert workspaceInfoField to a functional component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e508a1f0038e6e6d79cdf2ca02902072bc3825b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2e508a1f0038e6e6d79cdf2ca02902072bc3825b", "committedDate": "2020-09-22T20:33:45Z", "message": "right-align file size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93ffd446896b820913843855636a852f8a988631", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/93ffd446896b820913843855636a852f8a988631", "committedDate": "2020-09-22T20:58:02Z", "message": "parseLocation() using substring()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c1aa9e878f5c745ec8c8ea8ce977b27c6fe2900", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6c1aa9e878f5c745ec8c8ea8ce977b27c6fe2900", "committedDate": "2020-09-22T22:38:51Z", "message": "Split getBlobList/ForPrefix into Iterable and Page versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b0ca5683ee3e31ff962c6abf15a6f869b438797", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7b0ca5683ee3e31ff962c6abf15a6f869b438797", "committedDate": "2020-09-22T22:44:39Z", "message": "add blob page undercount notes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18fd87a30d470d9a4e14e116e226b2195ce5dc4a", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/18fd87a30d470d9a4e14e116e226b2195ce5dc4a", "committedDate": "2020-09-22T22:59:55Z", "message": "undercount note in UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2bc028889a68dca064120f8a130eb79cc31d6cbb", "committedDate": "2020-09-22T23:43:09Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0638b6683da71cca99291457e120b55252fd1ee", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/c0638b6683da71cca99291457e120b55252fd1ee", "committedDate": "2020-09-23T21:22:40Z", "message": "rm getBlobs/getBlobsForPrefix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDU3NDUx", "url": "https://github.com/all-of-us/workbench/pull/4028#pullrequestreview-495057451", "createdAt": "2020-09-23T21:20:42Z", "commit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMDo0MlrOHXBZ9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMzoyNFrOHXBepQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMjMyNQ==", "bodyText": "nit: string literals prop values shouldn't need {}", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493902325", "createdAt": "2020-09-23T21:20:42Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,89 +297,48 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'# of Cohorts'}>{resources.workspaceObjects.cohortCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Concept Sets'}>{resources.workspaceObjects.conceptSetCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Data Sets'}>{resources.workspaceObjects.datasetCount}</WorkspaceInfoField>\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            <div style={{color: colors.warning, fontWeight: 'bold'}}>\n+              NOTE: these may be undercounts, because we process only a single page of storage list results.\n+            </div>\n+            <WorkspaceInfoField labelText={'GCS bucket path'}>\n+              {resources.cloudStorage.storageBucketPath}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Workbench-managed notebook files'}>\n+              {resources.cloudStorage.notebookFileCount}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of other files'}>\n+              {resources.cloudStorage.nonNotebookFileCount}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'Storage used (MB)'}>\n+              {formatMB(resources.cloudStorage.storageBytesUsed)}\n+            </WorkspaceInfoField>\n           </div>\n+          {files && <FileDetailsTable data={files} bucket={resources.cloudStorage.storageBucketPath}/>}\n           <h3>Research Purpose</h3>\n           <div className='research-purpose' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'Primary purpose of project',\n-                getSelectedPrimaryPurposeItems(\n-                  workspace.researchPurpose).map(\n-                    (\n-                      researchPurposeItem, i) =>\n-                      <div key={i}>{researchPurposeItem}</div>\n-                    )\n-                )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Reason for choosing All of Us',\n-                workspace.researchPurpose.reasonForAllOfUs\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Area of intended study',\n-                workspace.researchPurpose.intendedStudy\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Anticipated findings',\n-                workspace.researchPurpose.anticipatedFindings\n-              )\n-            }\n-            {\n-              workspace.researchPurpose.populationDetails.length > 0 && this.workspaceInfoField(\n-                'Population area(s) of focus',\n-                getSelectedPopulations(workspace.researchPurpose)\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'Primary purpose of project'}>\n+              {getSelectedPrimaryPurposeItems(workspace.researchPurpose).map((researchPurposeItem, i) =>\n+                  <div key={i}>{researchPurposeItem}</div>)}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'Reason for choosing All of Us'}>\n+              {workspace.researchPurpose.reasonForAllOfUs}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'Area of intended study'}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "originalPosition": 329}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMjkyMg==", "bodyText": "I would clarify in this note that it may undercount if there are ~1000 or more objects in the bucket.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493902922", "createdAt": "2020-09-23T21:22:04Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,89 +297,48 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'# of Cohorts'}>{resources.workspaceObjects.cohortCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Concept Sets'}>{resources.workspaceObjects.conceptSetCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Data Sets'}>{resources.workspaceObjects.datasetCount}</WorkspaceInfoField>\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            <div style={{color: colors.warning, fontWeight: 'bold'}}>\n+              NOTE: these may be undercounts, because we process only a single page of storage list results.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "originalPosition": 269}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMzUyNQ==", "bodyText": "Would also clarify that the file table may be incomplete as well", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493903525", "createdAt": "2020-09-23T21:23:24Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,89 +297,48 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'# of Cohorts'}>{resources.workspaceObjects.cohortCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Concept Sets'}>{resources.workspaceObjects.conceptSetCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Data Sets'}>{resources.workspaceObjects.datasetCount}</WorkspaceInfoField>\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            <div style={{color: colors.warning, fontWeight: 'bold'}}>\n+              NOTE: these may be undercounts, because we process only a single page of storage list results.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "originalPosition": 269}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9aedbefa2c7bedf65d9a5579b9893996a5805573", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9aedbefa2c7bedf65d9a5579b9893996a5805573", "committedDate": "2020-09-23T21:33:14Z", "message": "string props don't need squiggle brackets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d97f4e1ef35d623ff099738e760b99f5686383f", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8d97f4e1ef35d623ff099738e760b99f5686383f", "committedDate": "2020-09-23T21:34:41Z", "message": "1000 files text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "131edf85e0de2cbb0dde713db562cc8491867994", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/131edf85e0de2cbb0dde713db562cc8491867994", "committedDate": "2020-09-23T21:36:58Z", "message": "add note about the table too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cb0cdff0ff46af089c9f501f40bfaea481be59b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7cb0cdff0ff46af089c9f501f40bfaea481be59b", "committedDate": "2020-09-23T21:49:49Z", "message": "combine warnings"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4058, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}