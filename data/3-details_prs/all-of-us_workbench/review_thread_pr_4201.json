{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NjQ0NDM4", "number": 4201, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODowOTo0MFrOExT0FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODozNjozM1rOEyCU7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTQwMzA5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODowOTo0MFrOHnYVZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMTo1ODo1OFrOHnfjwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1NTIwNQ==", "bodyText": "i think we need a trailing slash here?", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r511055205", "createdAt": "2020-10-23T18:09:40Z", "author": {"login": "ericsong"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -847,7 +851,7 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n             + \"\\n\"\n             + \"hl.plot.output_notebook()\\n\"\n             + \"bucket = os.environ['WORKSPACE_BUCKET']\\n\"\n-            + \"hl.import_vcf(f'{bucket}/\"\n+            + \"hl.import_vcf(f'{bucket}/cohort-extract\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MzU2OA==", "bodyText": "Oops thanks, didn't get around to retesting the Hail flow after making this change. Done", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r511173568", "createdAt": "2020-10-23T21:58:58Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -847,7 +851,7 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n             + \"\\n\"\n             + \"hl.plot.output_notebook()\\n\"\n             + \"bucket = os.environ['WORKSPACE_BUCKET']\\n\"\n-            + \"hl.import_vcf(f'{bucket}/\"\n+            + \"hl.import_vcf(f'{bucket}/cohort-extract\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1NTIwNQ=="}, "originalCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTQwNzQzOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODoxMTowMVrOHnYYLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMTo1ODoyNlrOHnfjHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1NTkxOA==", "bodyText": "we could switch this to synthetic_microarray_data which has the 100k samples", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r511055918", "createdAt": "2020-10-23T18:11:01Z", "author": {"login": "ericsong"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -740,41 +749,36 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n             + \"    for person_id in person_ids:\\n\"\n             + \"        cohort_file.write(str(person_id) + '\\\\n')\\n\"\n             + \"    cohort_file.close()\\n\",\n-        \"%%bash\\n\\n\"\n-            + \"uuid=$(cat /proc/sys/kernel/random/uuid | sed s/-/_/g)\\n\"\n-            // TODO: Writing to the \"tmp\" dataset is a temporary workaround until an alternative,\n-            // RW-5735\n-            + \"EXPORT_TABLE=\\\"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.${uuid}\\\"\\n\"\n-            + \"\\n\"\n-            + \"python3 /genomics/microarray/raw_array_cohort_extract.py \\\\\\n\"\n+        \"!python3 /usr/local/share/raw_array_cohort_extract.py \\\\\\n\"\n             + \"          --dataset fc-aou-cdr-synth-test.microarray_data \\\\\\n\"\n-            + \"          --fq_destination_table ${EXPORT_TABLE} \\\\\\n\"\n+            + \"          --fq_destination_table \"\n+            + cohortExtractTable\n+            + \" \\\\\\n\"\n             + \"          --query_project ${GOOGLE_PROJECT} \\\\\\n\"\n             // TODO: Replace hardcoded dataset reference: RW-5748\n-            + \"          --sample_mapping_table fc-aou-cdr-synth-test.microarray_data.sample_list \\\\\\n\"\n+            + \"          --fq_sample_mapping_table fc-aou-cdr-synth-test.microarray_data.sample_list \\\\\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MzQwNQ==", "bodyText": "done", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r511173405", "createdAt": "2020-10-23T21:58:26Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -740,41 +749,36 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n             + \"    for person_id in person_ids:\\n\"\n             + \"        cohort_file.write(str(person_id) + '\\\\n')\\n\"\n             + \"    cohort_file.close()\\n\",\n-        \"%%bash\\n\\n\"\n-            + \"uuid=$(cat /proc/sys/kernel/random/uuid | sed s/-/_/g)\\n\"\n-            // TODO: Writing to the \"tmp\" dataset is a temporary workaround until an alternative,\n-            // RW-5735\n-            + \"EXPORT_TABLE=\\\"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.${uuid}\\\"\\n\"\n-            + \"\\n\"\n-            + \"python3 /genomics/microarray/raw_array_cohort_extract.py \\\\\\n\"\n+        \"!python3 /usr/local/share/raw_array_cohort_extract.py \\\\\\n\"\n             + \"          --dataset fc-aou-cdr-synth-test.microarray_data \\\\\\n\"\n-            + \"          --fq_destination_table ${EXPORT_TABLE} \\\\\\n\"\n+            + \"          --fq_destination_table \"\n+            + cohortExtractTable\n+            + \" \\\\\\n\"\n             + \"          --query_project ${GOOGLE_PROJECT} \\\\\\n\"\n             // TODO: Replace hardcoded dataset reference: RW-5748\n-            + \"          --sample_mapping_table fc-aou-cdr-synth-test.microarray_data.sample_list \\\\\\n\"\n+            + \"          --fq_sample_mapping_table fc-aou-cdr-synth-test.microarray_data.sample_list \\\\\\n\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1NTkxOA=="}, "originalCommit": {"oid": "ee77bfd71b3d67ec08d887c5aa06e0c192df6a37"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTAyMzgzOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODozNjozM1rOHodRRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDowNzo0NFrOHogbDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE4NDY0NA==", "bodyText": "presumably we will eventually make this a per env parameter?", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r512184644", "createdAt": "2020-10-26T18:36:33Z", "author": {"login": "als364"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -721,6 +726,10 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n     final String cohortSampleNamesFilename = \"cohort_sample_names_\" + qualifier + \".txt\";\n     final String cohortSampleMapFilename = \"cohort_sample_map_\" + qualifier + \".csv\";\n     final String cohortVcfFilename = \"cohort_\" + qualifier + \".vcf\";\n+    // TODO(RW-5735): Writing to the \"tmp\" dataset is a temporary workaround.\n+    final String cohortExtractTable =\n+        \"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIzNTgwMA==", "bodyText": "Per above comment, this line in particular is temporary. There's another ticket linked in the other TODO's here to plumb through env vars for read access to the CDR dataset as well.", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r512235800", "createdAt": "2020-10-26T20:06:48Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -721,6 +726,10 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n     final String cohortSampleNamesFilename = \"cohort_sample_names_\" + qualifier + \".txt\";\n     final String cohortSampleMapFilename = \"cohort_sample_map_\" + qualifier + \".csv\";\n     final String cohortVcfFilename = \"cohort_\" + qualifier + \".vcf\";\n+    // TODO(RW-5735): Writing to the \"tmp\" dataset is a temporary workaround.\n+    final String cohortExtractTable =\n+        \"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE4NDY0NA=="}, "originalCommit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIzNjMwMA==", "bodyText": "gotcha, thank you", "url": "https://github.com/all-of-us/workbench/pull/4201#discussion_r512236300", "createdAt": "2020-10-26T20:07:44Z", "author": {"login": "als364"}, "path": "api/src/main/java/org/pmiops/workbench/dataset/DataSetServiceImpl.java", "diffHunk": "@@ -721,6 +726,10 @@ private String getQualifiedColumnName(Domain currentDomain, String columnName) {\n     final String cohortSampleNamesFilename = \"cohort_sample_names_\" + qualifier + \".txt\";\n     final String cohortSampleMapFilename = \"cohort_sample_map_\" + qualifier + \".csv\";\n     final String cohortVcfFilename = \"cohort_\" + qualifier + \".vcf\";\n+    // TODO(RW-5735): Writing to the \"tmp\" dataset is a temporary workaround.\n+    final String cohortExtractTable =\n+        \"fc-aou-cdr-synth-test.tmp_shared_cohort_extract.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE4NDY0NA=="}, "originalCommit": {"oid": "8b8fe9c5c408c5c2aa43226b54d444db2609ab66"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3881, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}