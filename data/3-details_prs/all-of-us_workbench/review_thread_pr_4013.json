{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MDMxMTMx", "number": 4013, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMDozNVrOEkFVSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo0Mzo1MVrOEkO7jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjcxNTYzOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMDozNVrOHSztdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDozNTozNlrOHTDR5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4MzYzNg==", "bodyText": "Workspace name (firecloud name, no spaces) is not strictly necessary, and is also not immediately available to the UI page", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489483636", "createdAt": "2020-09-16T14:30:35Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -59,13 +59,9 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n   @Override\n   @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n   public ResponseEntity<ReadOnlyNotebookResponse> adminReadOnlyNotebook(\n-      String workspaceNamespace,\n-      String workspaceName,\n-      String notebookName,\n-      AccessReason accessReason) {\n+      String workspaceNamespace, String notebookName, AccessReason accessReason) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTczODcyNg==", "bodyText": "interesting.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489738726", "createdAt": "2020-09-16T20:35:36Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -59,13 +59,9 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n   @Override\n   @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n   public ResponseEntity<ReadOnlyNotebookResponse> adminReadOnlyNotebook(\n-      String workspaceNamespace,\n-      String workspaceName,\n-      String notebookName,\n-      AccessReason accessReason) {\n+      String workspaceNamespace, String notebookName, AccessReason accessReason) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4MzYzNg=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjcyMTcyOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMTo0OFrOHSzxPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMTo0OFrOHSzxPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NDYwNA==", "bodyText": "split out as a method because it's now needed in 3 places", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489484604", "createdAt": "2020-09-16T14:31:48Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -162,12 +162,7 @@ public CloudStorageTraffic getCloudStorageTraffic(String workspaceNamespace) {\n \n   @Override\n   public WorkspaceAdminView getWorkspaceAdminView(String workspaceNamespace) {\n-    final DbWorkspace dbWorkspace =\n-        getFirstWorkspaceByNamespace(workspaceNamespace)\n-            .orElseThrow(\n-                () ->\n-                    new NotFoundException(\n-                        String.format(\"No workspace found for namespace %s\", workspaceNamespace)));\n+    final DbWorkspace dbWorkspace = getWorkspaceByNamespaceOrThrow(workspaceNamespace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjcyOTEyOnYy", "diffSide": "RIGHT", "path": "api/src/main/resources/workbench-api.yaml", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDozMzoxNlrOHSz14g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNDoxNDoyMVrOHTkYiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA==", "bodyText": "this breaking API change is OK because it was just created and is not yet used", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489485794", "createdAt": "2020-09-16T14:33:16Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTczOTYyNA==", "bodyText": "Are we sure we'll only ever have one workspace in the namespace?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489739624", "createdAt": "2020-09-16T20:37:23Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0NDYxNQ==", "bodyText": "Also, is there any kind of untrusted code/attack vector associated with passing the parameter this way?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489744615", "createdAt": "2020-09-16T20:47:27Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc2Mjg2NA==", "bodyText": "The other Workspace admin pages are namespace-only, and this continues the pattern.  Only a few very old Test workspaces violate the 1PPW rule, so that shouldn't be relevant here.\nPath parameters are very common in AoU and Terra.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489762864", "createdAt": "2020-09-16T21:24:17Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0MjAyNA==", "bodyText": "Sorry, I think I meant to ask this about the query param being encoded. We don't need to run it through a sanitizing function or something. (Obviously it's not executed at the moment.)", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r490242024", "createdAt": "2020-09-17T13:25:18Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI4MTA5Nw==", "bodyText": "Simply printing the accessReason looks reasonably safe.\nWe may want to truncate to some maxlen however.  Is there a general guideline for audit property values?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r490281097", "createdAt": "2020-09-17T14:14:21Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1697,10 +1697,9 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n-  \"/v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/readonly\":\n+  \"/v1/admin/workspaces/{workspaceNamespace}/notebooks/{notebookName}/readonly\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4NTc5NA=="}, "originalCommit": {"oid": "e70fbbb3dfb2fcddce2c3145cea72a46cc278eeb"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2Mjc4Mzc4OnYy", "diffSide": "RIGHT", "path": "ui/src/app/utils/navigation.tsx", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0NDozNlrOHS0YQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzoyNzoxNVrOHTiGjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5NDU5NA==", "bodyText": "this might belong elsewhere?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489494594", "createdAt": "2020-09-16T14:44:36Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/utils/navigation.tsx", "diffHunk": "@@ -111,6 +112,17 @@ export const navigateSignOut = (continuePath: string = '/login') => {\n     `https://appengine.google.com/_ah/logout?continue=${window.location.origin}${continuePath}`);\n };\n \n+/**\n+ * Retrieve query parameters from the React Router.\n+ *\n+ * Example:\n+ *  my/query/page?user=alice123\n+ *  reactRouterUrlSearchParams.get('user') -> value is 'alice123'\n+ */\n+export const reactRouterUrlSearchParams = (): URLSearchParams => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MzE2Mg==", "bodyText": "I don't even know what this is. @petesantos can you take a quick look at the routey bits?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489743162", "createdAt": "2020-09-16T20:44:32Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/utils/navigation.tsx", "diffHunk": "@@ -111,6 +112,17 @@ export const navigateSignOut = (continuePath: string = '/login') => {\n     `https://appengine.google.com/_ah/logout?continue=${window.location.origin}${continuePath}`);\n };\n \n+/**\n+ * Retrieve query parameters from the React Router.\n+ *\n+ * Example:\n+ *  my/query/page?user=alice123\n+ *  reactRouterUrlSearchParams.get('user') -> value is 'alice123'\n+ */\n+export const reactRouterUrlSearchParams = (): URLSearchParams => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5NDU5NA=="}, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc2MzMyOA==", "bodyText": "This could go in a different \"utils\" file.  It makes sense to me here, but I could also move it.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489763328", "createdAt": "2020-09-16T21:25:13Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/utils/navigation.tsx", "diffHunk": "@@ -111,6 +112,17 @@ export const navigateSignOut = (continuePath: string = '/login') => {\n     `https://appengine.google.com/_ah/logout?continue=${window.location.origin}${continuePath}`);\n };\n \n+/**\n+ * Retrieve query parameters from the React Router.\n+ *\n+ * Example:\n+ *  my/query/page?user=alice123\n+ *  reactRouterUrlSearchParams.get('user') -> value is 'alice123'\n+ */\n+export const reactRouterUrlSearchParams = (): URLSearchParams => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5NDU5NA=="}, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0MzcyNw==", "bodyText": "I thought there was some kind of handshaking between this router state and the components already established, so that they can get the parameters.\nNot worth worrying about where to put it. Generally utils could become a junk drawer for code, so it's nice to have them arranged topically.\nDef not a blocker.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r490243727", "createdAt": "2020-09-17T13:27:15Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/utils/navigation.tsx", "diffHunk": "@@ -111,6 +112,17 @@ export const navigateSignOut = (continuePath: string = '/login') => {\n     `https://appengine.google.com/_ah/logout?continue=${window.location.origin}${continuePath}`);\n };\n \n+/**\n+ * Retrieve query parameters from the React Router.\n+ *\n+ * Example:\n+ *  my/query/page?user=alice123\n+ *  reactRouterUrlSearchParams.get('user') -> value is 'alice123'\n+ */\n+export const reactRouterUrlSearchParams = (): URLSearchParams => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5NDU5NA=="}, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjgxMDcxOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0OTo0OVrOHS0o6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo0OTo0OVrOHS0o6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5ODg1Nw==", "bodyText": "these are copied from a variety of sources.  The goal here is \"looks OK\" rather than polished", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489498857", "createdAt": "2020-09-16T14:49:49Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,109 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjgxNjcyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo1MToxMFrOHS0swg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzoyODoyNFrOHTiKyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5OTg0Mg==", "bodyText": "workspaceName is not immediately available: gets updated when getWorkspaceAdminView() returns", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489499842", "createdAt": "2020-09-16T14:51:10Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,109 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0NDgwOA==", "bodyText": "Maybe name it like Workspace  with Namespace $workspaceNamespace or w/e the syntax is so it shows some context. Depends on where you use this string.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r490244808", "createdAt": "2020-09-17T13:28:24Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,109 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5OTg0Mg=="}, "originalCommit": {"oid": "3d4633e26949c63ae952cb02d77391a5b5478919"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NDI3MTQzOnYy", "diffSide": "RIGHT", "path": "ui/src/app/app-routing.tsx", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDozODozMlrOHTDXtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzoyOTozNlrOHTiPLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MDIxNQ==", "bodyText": "I think you can add a friendly title property to the routeData to give yourself a tab title.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489740215", "createdAt": "2020-09-16T20:38:32Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -98,6 +100,13 @@ export const AppRoutingComponent: React.FunctionComponent<RoutingProps> = ({onSi\n           path='/admin/workspace-audit/:workspaceNamespace'\n           component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}\n       />\n+      <AppRoute", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc2NDg1NA==", "bodyText": "pathElementForTitle: 'nbName' does this: the notebook name is the tab title.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489764854", "createdAt": "2020-09-16T21:28:18Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -98,6 +100,13 @@ export const AppRoutingComponent: React.FunctionComponent<RoutingProps> = ({onSi\n           path='/admin/workspace-audit/:workspaceNamespace'\n           component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}\n       />\n+      <AppRoute", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MDIxNQ=="}, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0NTkzNA==", "bodyText": "Maybe Admin Inspection View for $nbName or something would give a bit more context?", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r490245934", "createdAt": "2020-09-17T13:29:36Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -98,6 +100,13 @@ export const AppRoutingComponent: React.FunctionComponent<RoutingProps> = ({onSi\n           path='/admin/workspace-audit/:workspaceNamespace'\n           component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}\n       />\n+      <AppRoute", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MDIxNQ=="}, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NDI3NDIzOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDozOTozMVrOHTDZiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDozOTozMVrOHTDZiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MDY4Mw==", "bodyText": "please set '' as the default for strings instead of undefined.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489740683", "createdAt": "2020-09-16T20:39:31Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,110 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NDI3NjYwOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo0MDowOFrOHTDa6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo0MDowOFrOHTDa6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0MTAzNQ==", "bodyText": "nit: Probably want to split the reason onto another line. Can come later with a styling follow-on.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489741035", "createdAt": "2020-09-16T20:40:08Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,110 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;\n+    const link = <a href={`/admin/workspaces/${workspaceNamespace}`}>{location}</a>;\n+\n+    return <div style={styles.heading}>Viewing {nbName} in {link} for reason: {accessReason}</div>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NDI4ODEyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo0Mzo1MVrOHTDiCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo0Mzo1MVrOHTDiCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0Mjg1OA==", "bodyText": "nit: please spell out notebookName, since it's not that long and easier to read.", "url": "https://github.com/all-of-us/workbench/pull/4013#discussion_r489742858", "createdAt": "2020-09-16T20:43:51Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/pages/admin/admin-notebook-view.tsx", "diffHunk": "@@ -0,0 +1,110 @@\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {workspaceAdminApi} from 'app/services/swagger-fetch-clients';\n+import colors from 'app/styles/colors';\n+import {reactStyles} from 'app/utils';\n+import {reactRouterUrlSearchParams} from 'app/utils/navigation';\n+import * as React from 'react';\n+import {useEffect, useState} from 'react';\n+import {useParams} from 'react-router';\n+\n+const styles = reactStyles({\n+  heading: {\n+    color: colors.primary,\n+    fontSize: 16,\n+    fontWeight: 500,\n+  },\n+  notebook: {\n+    width: '100%',\n+    height: 'calc(100% - 40px)',\n+    position: 'absolute',\n+    border: 0\n+  },\n+  error: {\n+    marginLeft: 'auto',\n+    marginRight: 'auto',\n+    marginTop: '56px',\n+    background: colors.warning,\n+    border: '1px solid #ebafa6',\n+    borderRadius: '5px',\n+    color: colors.white,\n+    display: 'flex',\n+    fontSize: '14px',\n+    fontWeight: 500,\n+    maxWidth: '550px',\n+    padding: '8px',\n+    textAlign: 'left'\n+  },\n+});\n+\n+interface Props {\n+  workspaceNamespace: string;\n+  nbName: string;\n+  accessReason: string;\n+}\n+\n+const AdminNotebookViewComponent = (props: Props) => {\n+  const {workspaceNamespace, nbName, accessReason} = props;\n+  const [notebookHtml, setHtml] = useState(undefined);\n+  const [workspaceName, setWorkspaceName] = useState(undefined);\n+  const [errorMessage, setErrorMessage] = useState(undefined);\n+\n+  const Header = () => {\n+    const location = workspaceName ? `Workspace ${workspaceNamespace}/${workspaceName}` : workspaceNamespace;\n+    const link = <a href={`/admin/workspaces/${workspaceNamespace}`}>{location}</a>;\n+\n+    return <div style={styles.heading}>Viewing {nbName} in {link} for reason: {accessReason}</div>;\n+  };\n+\n+  const Main = () => {\n+    if (notebookHtml) {\n+      return <iframe id='notebook-frame' style={styles.notebook} srcDoc={notebookHtml}/>;\n+    } else if (errorMessage) {\n+      return <div style={styles.error}>{errorMessage}</div>;\n+    } else {\n+      return <SpinnerOverlay />;\n+    }\n+  };\n+\n+  useEffect(() => {\n+    workspaceAdminApi().getWorkspaceAdminView(workspaceNamespace)\n+      .then(workspaceAdminView => setWorkspaceName(workspaceAdminView.workspace.name));\n+  }, []);\n+\n+  useEffect(() => {\n+    if (!accessReason || !accessReason.trim()) {\n+      setErrorMessage('Error: must include accessReason query parameter in URL');\n+      return;\n+    }\n+\n+    workspaceAdminApi().adminReadOnlyNotebook(workspaceNamespace, nbName, {reason: accessReason})\n+      .then(response => setHtml(response.html))\n+      .catch((e) => {\n+        if (e.status === 404) {\n+          setErrorMessage(`Notebook ${nbName} was not found`);\n+        } else if (e.status === 412) {\n+          setErrorMessage('Notebook is too large to display in preview mode');\n+        } else {\n+          setErrorMessage('Failed to render notebook preview due to unknown error');\n+        }\n+      });\n+  }, []);\n+\n+  return <React.Fragment>\n+    <Header/>\n+    <Main/>\n+  </React.Fragment>;\n+};\n+\n+const AdminNotebookView = () => {\n+  const {workspaceNamespace, nbName} = useParams();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051e1311bd6482a30be40e55ae77f7d41c8fa99b"}, "originalPosition": 99}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4102, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}