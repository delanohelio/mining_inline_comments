{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3OTAxNTg1", "number": 3163, "title": "[no ticket][risk=no] Unit test enhancements and small refactorings for new interceptor", "bodyText": "There's a new unit test, a couple of renames, removal of an enum parameter I didn't find a real use for, and a new helper method on MeasurementBundle.\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-02-20T18:10:02Z", "url": "https://github.com/all-of-us/workbench/pull/3163", "merged": true, "mergeCommit": {"oid": "589e4e3850cadb2afe433c1009fe0b2e96221284"}, "closed": true, "closedAt": "2020-03-10T23:47:08Z", "author": {"login": "jaycarlton"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEW-U1AH2gAyMzc3OTAxNTg1Ojk3NzI5YWIyYjUyMWM5OGQ2YzEzOTQ3OWU0ZmI5ZGMwYjQ3ZWMwZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMajbSAH2gAyMzc3OTAxNTg1OjNlODhhMzI5ZTVlMDlkMGI5YjE2YTk2ZTg2NGJjZTliZWY1OTU0NTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97729ab2b521c98d6c139479e4fb9dc0b47ec0ee", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/97729ab2b521c98d6c139479e4fb9dc0b47ec0ee", "committedDate": "2020-02-14T22:07:46Z", "message": "initial version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65347e50bb3ea0bf3bbe77256c6f4bf936b49656", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/65347e50bb3ea0bf3bbe77256c6f4bf936b49656", "committedDate": "2020-02-14T22:49:56Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fa08bf406e6b48fabbe97db08cdd13313915602", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/1fa08bf406e6b48fabbe97db08cdd13313915602", "committedDate": "2020-02-19T19:17:54Z", "message": "merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9853ab6b91e6554db65d7e32e9c95cc3254ce0b3", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/9853ab6b91e6554db65d7e32e9c95cc3254ce0b3", "committedDate": "2020-02-20T16:24:25Z", "message": "test class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7965c86df618f4b63c79f7a55de72ac35c693d8e", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/7965c86df618f4b63c79f7a55de72ac35c693d8e", "committedDate": "2020-02-20T16:51:37Z", "message": "fixup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90a41098f39b07de915a08390bb5b1484991c7f5", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/90a41098f39b07de915a08390bb5b1484991c7f5", "committedDate": "2020-02-20T16:57:45Z", "message": "merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODE0MjE3", "url": "https://github.com/all-of-us/workbench/pull/3163#pullrequestreview-362814217", "createdAt": "2020-02-21T18:03:29Z", "commit": {"oid": "90a41098f39b07de915a08390bb5b1484991c7f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODowMzozMFrOFs_uHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODowMzozMFrOFs_uHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNTY2Mg==", "bodyText": "questions is RequestTimeMetricInterceptor just a new rename for  ElapsedTimeDistributionInterceptor ? i cannot see it being removed as a file in this PR.", "url": "https://github.com/all-of-us/workbench/pull/3163#discussion_r382725662", "createdAt": "2020-02-21T18:03:30Z", "author": {"login": "NehaBroad"}, "path": "api/src/main/java/org/pmiops/workbench/config/WebMvcConfig.java", "diffHunk": "@@ -9,7 +9,7 @@\n import org.pmiops.workbench.interceptors.CloudTaskInterceptor;\n import org.pmiops.workbench.interceptors.CorsInterceptor;\n import org.pmiops.workbench.interceptors.CronInterceptor;\n-import org.pmiops.workbench.interceptors.ElapsedTimeDistributionInterceptor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a41098f39b07de915a08390bb5b1484991c7f5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a32f8e6cd75ed514834e4a91f23943447b99e05", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/1a32f8e6cd75ed514834e4a91f23943447b99e05", "committedDate": "2020-02-21T18:11:34Z", "message": "merge master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODQ0MTYw", "url": "https://github.com/all-of-us/workbench/pull/3163#pullrequestreview-362844160", "createdAt": "2020-02-21T18:55:06Z", "commit": {"oid": "90a41098f39b07de915a08390bb5b1484991c7f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODo1NTowNlrOFtBKKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODo1NTowNlrOFtBKKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc0OTIyNw==", "bodyText": "Also it will be good to  add comments to explain whats happening in this method", "url": "https://github.com/all-of-us/workbench/pull/3163#discussion_r382749227", "createdAt": "2020-02-21T18:55:06Z", "author": {"login": "NehaBroad"}, "path": "api/src/main/java/org/pmiops/workbench/interceptors/RequestTimeMetricInterceptor.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package org.pmiops.workbench.interceptors;\n+\n+import com.google.api.client.http.HttpMethods;\n+import java.time.Clock;\n+import java.time.Duration;\n+import java.time.Instant;\n+import java.util.Optional;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.pmiops.workbench.monitoring.LogsBasedMetricService;\n+import org.pmiops.workbench.monitoring.MeasurementBundle;\n+import org.pmiops.workbench.monitoring.labels.MetricLabel;\n+import org.pmiops.workbench.monitoring.views.DistributionMetric;\n+import org.springframework.stereotype.Service;\n+import org.springframework.web.method.HandlerMethod;\n+import org.springframework.web.servlet.ModelAndView;\n+import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;\n+\n+@Service\n+public class RequestTimeMetricInterceptor extends HandlerInterceptorAdapter {\n+\n+  private final LogsBasedMetricService logsBasedMetricService;\n+  private Clock clock;\n+\n+  public RequestTimeMetricInterceptor(LogsBasedMetricService logsBasedMetricService, Clock clock) {\n+    this.logsBasedMetricService = logsBasedMetricService;\n+    this.clock = clock;\n+  }\n+\n+  @Override\n+  public boolean preHandle(\n+      HttpServletRequest request, HttpServletResponse response, Object handler) {\n+    if (shouldSkip(request, handler)) {\n+      return true;\n+    }\n+    request.setAttribute(RequestAttribute.START_INSTANT.toString(), clock.instant());\n+    return true;\n+  }\n+\n+  private boolean shouldSkip(HttpServletRequest request, Object handler) {\n+    return (request.getMethod().equals(HttpMethods.OPTIONS))\n+        || (!(handler instanceof HandlerMethod));\n+  }\n+\n+  @Override\n+  public void postHandle(\n+      HttpServletRequest request,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a41098f39b07de915a08390bb5b1484991c7f5"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67a91765f1003b9d4568bcd4e8a62142a8644bf6", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/67a91765f1003b9d4568bcd4e8a62142a8644bf6", "committedDate": "2020-03-09T21:37:54Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a4721349628675b1b8d76517abc8f7240d2c6ee", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/5a4721349628675b1b8d76517abc8f7240d2c6ee", "committedDate": "2020-03-09T21:47:46Z", "message": "remove duplicated file and add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c92c2ca1e743e458b0bf75f16e04d53e13591508", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/c92c2ca1e743e458b0bf75f16e04d53e13591508", "committedDate": "2020-03-09T21:49:59Z", "message": "spelling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNjMwNjA4", "url": "https://github.com/all-of-us/workbench/pull/3163#pullrequestreview-371630608", "createdAt": "2020-03-10T01:37:55Z", "commit": {"oid": "c92c2ca1e743e458b0bf75f16e04d53e13591508"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eaf1860e5ef736edaa36f70c0586220b7a78e9c", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/0eaf1860e5ef736edaa36f70c0586220b7a78e9c", "committedDate": "2020-03-10T13:15:23Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a29f3249202fb36d1ee211dd0c4ea74562a7418", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/9a29f3249202fb36d1ee211dd0c4ea74562a7418", "committedDate": "2020-03-10T13:30:53Z", "message": "dummy change to re-trigger circle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e88a329e5e09d0b9b16a96e864bce9bef595450", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/3e88a329e5e09d0b9b16a96e864bce9bef595450", "committedDate": "2020-03-10T22:49:24Z", "message": "merge"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3619, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}