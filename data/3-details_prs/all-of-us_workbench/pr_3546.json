{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MTc2NTI0", "number": 3546, "title": "[RW-4878][risk=no] Convert criteria selection list to React", "bodyText": "Created new React component SelectionList, previously part of ModalComponent, since the list will eventually be moved into the sidebar.\nConverted  SelectionInfo component to React.\n\n\n@als364  to review React conversion\n@freemabd  to deploy and test CB functionality\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally", "createdAt": "2020-05-06T15:40:45Z", "url": "https://github.com/all-of-us/workbench/pull/3546", "merged": true, "mergeCommit": {"oid": "dee8a6bc8f072d1c23fbed046d844e9a40fe8893"}, "closed": true, "closedAt": "2020-05-07T16:15:46Z", "author": {"login": "dolbeew"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceavP6gH2gAyNDE0MTc2NTI0Ojg1ZmZiMDE4MTE0M2Y1ZDZiZWQzMzdmYTRjMGQ1MWQ2NWUwZWU5Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce_MWRgFqTQwNzU5OTQxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "85ffb0181143f5d6bed337fa4c0d51d65e0ee9ca", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/85ffb0181143f5d6bed337fa4c0d51d65e0ee9ca", "committedDate": "2020-05-05T21:12:57Z", "message": "RW-4878 initial react conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a9d3c48934e489f97fbdae073080c8f5758dde8", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/5a9d3c48934e489f97fbdae073080c8f5758dde8", "committedDate": "2020-05-05T21:12:57Z", "message": "RW-4878 add styles and tooltips to selection items"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3252b70cd0802fe783fb8d73158d23c12c0482e0", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3252b70cd0802fe783fb8d73158d23c12c0482e0", "committedDate": "2020-05-05T21:12:57Z", "message": "RW-4878 disable finish button for no selections/errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/b91207bb281db2e3fde0aa276728123cdcc8ec11", "committedDate": "2020-05-05T21:12:57Z", "message": "RW-4878 remove angular files, add render test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODEwMTQ5", "url": "https://github.com/all-of-us/workbench/pull/3546#pullrequestreview-406810149", "createdAt": "2020-05-06T17:00:07Z", "commit": {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzowMDowN1rOGRckSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzoxOTowMVrOGRdTeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NzAxOQ==", "bodyText": "I'd prefer for this to be named consistently - if the only thing this function does is close the list then name it close throughout.", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420947019", "createdAt": "2020-05-06T17:00:07Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/modal/modal.component.html", "diffHunk": "@@ -129,43 +128,16 @@\n \n         <div *ngIf=\"wizard.type !== criteriaType.AGE\" class=\"col padding-zero\" [ngClass]=\"sidebarClass\">\n           <div class=\"content right\" *ngIf=\"open\">\n-            <div class=\"panel-right-container\">\n-              <h5 class=\"selection-title\">Selected Criteria</h5>\n-              <div class=\"panel-right selected\">\n-                <crit-list-selection-info\n-                  *ngFor=\"let parameter of selections; let p = index\"\n-                  [index]=\"p\"\n-                  [parameter]=\"parameter\"\n-                  [remove]=\"removeSelection\">\n-                </crit-list-selection-info>\n-              </div>\n-              <div class=\"footer\">\n-                <button type=\"button\"\n-                  (click)=\"close()\"\n-                  class=\"btn btn-link\">\n-                  Cancel\n-                </button>\n-                <button  *ngIf=\"showNext\"\n-                  type=\"button\"\n-                  [disabled]=\"selections.length === 0\"\n-                  (click)=\"mode = 'modifiers'\"\n-                  class=\"btn btn-primary\">\n-                  Next\n-                </button>\n-                <button *ngIf=\"showBack\"\n-                  type=\"button\"\n-                  (click)=\"back()\"\n-                  class=\"btn btn-primary\">\n-                  Back\n-                </button>\n-                <button type=\"button\"\n-                  [disabled]=\"disableFlag\"\n-                  (click)=\"finish()\"\n-                  class=\"btn btn-primary\">\n-                  Finish\n-                </button>\n-              </div>\n-            </div>\n+            <crit-selection-list\n+              [back]=\"back\"\n+              [cancel]=\"close\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0Nzc1Ng==", "bodyText": "Same with this - why is it named differently in different files?", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420947756", "createdAt": "2020-05-06T17:01:16Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/modal/modal.component.html", "diffHunk": "@@ -129,43 +128,16 @@\n \n         <div *ngIf=\"wizard.type !== criteriaType.AGE\" class=\"col padding-zero\" [ngClass]=\"sidebarClass\">\n           <div class=\"content right\" *ngIf=\"open\">\n-            <div class=\"panel-right-container\">\n-              <h5 class=\"selection-title\">Selected Criteria</h5>\n-              <div class=\"panel-right selected\">\n-                <crit-list-selection-info\n-                  *ngFor=\"let parameter of selections; let p = index\"\n-                  [index]=\"p\"\n-                  [parameter]=\"parameter\"\n-                  [remove]=\"removeSelection\">\n-                </crit-list-selection-info>\n-              </div>\n-              <div class=\"footer\">\n-                <button type=\"button\"\n-                  (click)=\"close()\"\n-                  class=\"btn btn-link\">\n-                  Cancel\n-                </button>\n-                <button  *ngIf=\"showNext\"\n-                  type=\"button\"\n-                  [disabled]=\"selections.length === 0\"\n-                  (click)=\"mode = 'modifiers'\"\n-                  class=\"btn btn-primary\">\n-                  Next\n-                </button>\n-                <button *ngIf=\"showBack\"\n-                  type=\"button\"\n-                  (click)=\"back()\"\n-                  class=\"btn btn-primary\">\n-                  Back\n-                </button>\n-                <button type=\"button\"\n-                  [disabled]=\"disableFlag\"\n-                  (click)=\"finish()\"\n-                  class=\"btn btn-primary\">\n-                  Finish\n-                </button>\n-              </div>\n-            </div>\n+            <crit-selection-list\n+              [back]=\"back\"\n+              [cancel]=\"close\"\n+              [disableFinish]=\"modifiersDisabled\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1MzQ3Ng==", "bodyText": "Consider using the Button component in buttons.tsx", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420953476", "createdAt": "2020-05-06T17:10:27Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -0,0 +1,232 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {attributeDisplay, nameDisplay, typeDisplay} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {Criteria, DomainType} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  buttonContainer: {\n+    display: 'flex',\n+    justifyContent: 'flex-end',\n+    marginTop: '0.5rem',\n+    padding: '0.45rem 0rem'\n+  },\n+  button: {\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  disabled: {\n+    opacity: 0.4,\n+    pointerEvents: 'none'\n+  },\n+  itemInfo: {\n+    width: '100%',\n+    minWidth: 0,\n+    flex: 1,\n+    display: 'flex',\n+    flexFlow: 'row nowrap',\n+    justifyContent: 'flex-start'\n+  },\n+  itemName: {\n+    flex: 1,\n+    overflow: 'hidden',\n+    textOverflow: 'ellipsis',\n+    whiteSpace: 'nowrap'\n+  },\n+  removeSelection: {\n+    background: 'none',\n+    border: 0,\n+    color: colors.danger,\n+    cursor: 'pointer',\n+    marginRight: '0.25rem',\n+    padding: 0\n+  },\n+  selectionContainer: {\n+    background: colors.white,\n+    border: `2px solid ${colors.primary}`,\n+    borderRadius: '5px',\n+    height: 'calc(100% - 150px)',\n+    overflowX: 'hidden',\n+    overflowY: 'auto',\n+    width: '95%',\n+  },\n+  selectionItem: {\n+    display: 'flex',\n+    fontSize: '14px',\n+    padding: '0.2rem 0.5rem 0',\n+    width: '100%',\n+  },\n+  selectionPanel: {\n+    background: colorWithWhiteness(colors.black, 0.95),\n+    height: '100%',\n+    padding: '0.5rem 0 0 1rem',\n+  },\n+  selectionTitle: {\n+    color: colors.primary,\n+    margin: 0,\n+    padding: '0.5rem 0'\n+  }\n+});\n+\n+interface Selection extends Criteria {\n+  parameterId: string;\n+}\n+\n+interface SelectionInfoProps {\n+  index: number;\n+  selection: Selection;\n+  removeSelection: Function;\n+}\n+\n+interface SelectionInfoState {\n+  truncated: boolean;\n+}\n+\n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <div style={styles.selectionItem}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>\n+        <ClrIcon shape='times-circle'/>\n+      </button>\n+      <div style={styles.itemInfo}>\n+        {this.showOr && <strong>OR&nbsp;</strong>}\n+        {!!selection.group && <span>Group&nbsp;</span>}\n+        <TooltipTrigger disabled={!this.state.truncated} content={itemName}>\n+          <div style={styles.itemName} ref={(e) => this.name = e}>\n+            {itemName}\n+          </div>\n+        </TooltipTrigger>\n+      </div>\n+    </div>;\n+  }\n+}\n+\n+interface Props {\n+  back: Function;\n+  cancel: Function;\n+  disableFinish: boolean;\n+  domain: DomainType;\n+  finish: Function;\n+  removeSelection: Function;\n+  selections: Array<Selection>;\n+  setView: Function;\n+  view: string;\n+}\n+\n+export class SelectionList extends React.Component<Props> {\n+  constructor(props: Props) {\n+    super(props);\n+  }\n+\n+  get showModifiers() {\n+    return ![DomainType.PHYSICALMEASUREMENT, DomainType.PERSON, DomainType.SURVEY].includes(this.props.domain);\n+  }\n+\n+  get showNext() {\n+    return this.showModifiers && this.props.view !== 'modifiers';\n+  }\n+\n+  get showBack() {\n+    return this.showModifiers && this.props.view === 'modifiers';\n+  }\n+\n+  render() {\n+    const {back, cancel, disableFinish, finish, removeSelection, selections, setView} = this.props;\n+    return <div style={styles.selectionPanel}>\n+      <h5 style={styles.selectionTitle}>Selected Criteria</h5>\n+      <div style={styles.selectionContainer}>\n+        {selections.map((selection, s) =>\n+          <SelectionInfo key={s}\n+            index={s}\n+            selection={selection}\n+            removeSelection={() => removeSelection(selection)}/>\n+        )}\n+      </div>\n+      <div style={styles.buttonContainer}>\n+        <button style={{...styles.button, background: 'transparent', color: colors.dark, fontSize: '14px'}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11"}, "originalPosition": 187}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1OTA5Ng==", "bodyText": "You get most of these styles for free with the Button component.", "url": "https://github.com/all-of-us/workbench/pull/3546#discussion_r420959096", "createdAt": "2020-05-06T17:19:01Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -0,0 +1,232 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {attributeDisplay, nameDisplay, typeDisplay} from 'app/cohort-search/utils';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase} from 'app/utils';\n+import {Criteria, DomainType} from 'generated/fetch';\n+\n+const styles = reactStyles({\n+  buttonContainer: {\n+    display: 'flex',\n+    justifyContent: 'flex-end',\n+    marginTop: '0.5rem',\n+    padding: '0.45rem 0rem'\n+  },\n+  button: {\n+    border: 'none',\n+    borderRadius: '0.3rem',\n+    cursor: 'pointer',\n+    fontSize: '12px',\n+    height: '1.5rem',\n+    letterSpacing: '0.02rem',\n+    lineHeight: '0.75rem',\n+    margin: '0.25rem 0.5rem',\n+    padding: '0rem 0.75rem',\n+    textTransform: 'uppercase',\n+  },\n+  disabled: {\n+    opacity: 0.4,\n+    pointerEvents: 'none'\n+  },\n+  itemInfo: {\n+    width: '100%',\n+    minWidth: 0,\n+    flex: 1,\n+    display: 'flex',\n+    flexFlow: 'row nowrap',\n+    justifyContent: 'flex-start'\n+  },\n+  itemName: {\n+    flex: 1,\n+    overflow: 'hidden',\n+    textOverflow: 'ellipsis',\n+    whiteSpace: 'nowrap'\n+  },\n+  removeSelection: {\n+    background: 'none',\n+    border: 0,\n+    color: colors.danger,\n+    cursor: 'pointer',\n+    marginRight: '0.25rem',\n+    padding: 0\n+  },\n+  selectionContainer: {\n+    background: colors.white,\n+    border: `2px solid ${colors.primary}`,\n+    borderRadius: '5px',\n+    height: 'calc(100% - 150px)',\n+    overflowX: 'hidden',\n+    overflowY: 'auto',\n+    width: '95%',\n+  },\n+  selectionItem: {\n+    display: 'flex',\n+    fontSize: '14px',\n+    padding: '0.2rem 0.5rem 0',\n+    width: '100%',\n+  },\n+  selectionPanel: {\n+    background: colorWithWhiteness(colors.black, 0.95),\n+    height: '100%',\n+    padding: '0.5rem 0 0 1rem',\n+  },\n+  selectionTitle: {\n+    color: colors.primary,\n+    margin: 0,\n+    padding: '0.5rem 0'\n+  }\n+});\n+\n+interface Selection extends Criteria {\n+  parameterId: string;\n+}\n+\n+interface SelectionInfoProps {\n+  index: number;\n+  selection: Selection;\n+  removeSelection: Function;\n+}\n+\n+interface SelectionInfoState {\n+  truncated: boolean;\n+}\n+\n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <div style={styles.selectionItem}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>\n+        <ClrIcon shape='times-circle'/>\n+      </button>\n+      <div style={styles.itemInfo}>\n+        {this.showOr && <strong>OR&nbsp;</strong>}\n+        {!!selection.group && <span>Group&nbsp;</span>}\n+        <TooltipTrigger disabled={!this.state.truncated} content={itemName}>\n+          <div style={styles.itemName} ref={(e) => this.name = e}>\n+            {itemName}\n+          </div>\n+        </TooltipTrigger>\n+      </div>\n+    </div>;\n+  }\n+}\n+\n+interface Props {\n+  back: Function;\n+  cancel: Function;\n+  disableFinish: boolean;\n+  domain: DomainType;\n+  finish: Function;\n+  removeSelection: Function;\n+  selections: Array<Selection>;\n+  setView: Function;\n+  view: string;\n+}\n+\n+export class SelectionList extends React.Component<Props> {\n+  constructor(props: Props) {\n+    super(props);\n+  }\n+\n+  get showModifiers() {\n+    return ![DomainType.PHYSICALMEASUREMENT, DomainType.PERSON, DomainType.SURVEY].includes(this.props.domain);\n+  }\n+\n+  get showNext() {\n+    return this.showModifiers && this.props.view !== 'modifiers';\n+  }\n+\n+  get showBack() {\n+    return this.showModifiers && this.props.view === 'modifiers';\n+  }\n+\n+  render() {\n+    const {back, cancel, disableFinish, finish, removeSelection, selections, setView} = this.props;\n+    return <div style={styles.selectionPanel}>\n+      <h5 style={styles.selectionTitle}>Selected Criteria</h5>\n+      <div style={styles.selectionContainer}>\n+        {selections.map((selection, s) =>\n+          <SelectionInfo key={s}\n+            index={s}\n+            selection={selection}\n+            removeSelection={() => removeSelection(selection)}/>\n+        )}\n+      </div>\n+      <div style={styles.buttonContainer}>\n+        <button style={{...styles.button, background: 'transparent', color: colors.dark, fontSize: '14px'}}\n+          onClick={() => cancel()}>\n+          Cancel\n+        </button>\n+        {this.showNext && <button onClick={() => setView('modifiers')}\n+          style={{\n+            ...styles.button,\n+            ...(selections.length === 0 ? styles.disabled : {}),\n+            background: colors.primary, color: colors.white}}>\n+          Next\n+        </button>}\n+        {this.showBack && <button style={{...styles.button, background: colors.primary, color: colors.white}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b91207bb281db2e3fde0aa276728123cdcc8ec11"}, "originalPosition": 198}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6055ca4aabe2e890d9a8ebe6cb8a9ee75bb56e80", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6055ca4aabe2e890d9a8ebe6cb8a9ee75bb56e80", "committedDate": "2020-05-07T15:07:55Z", "message": "RW-4878 address pr feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b4856540aca6580b7dec95cb378283564f36802", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/5b4856540aca6580b7dec95cb378283564f36802", "committedDate": "2020-05-07T15:21:03Z", "message": "RW-4878 fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTk5NDE1", "url": "https://github.com/all-of-us/workbench/pull/3546#pullrequestreview-407599415", "createdAt": "2020-05-07T15:41:20Z", "commit": {"oid": "5b4856540aca6580b7dec95cb378283564f36802"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4968, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}