{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MzE4NTEw", "number": 3775, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyMjoxMVrOEN3hNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoyMzo0NFrOEN6kXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTc2NTY1OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyMjoxMVrOGwtevA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo1MDowN1rOGwuwCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyOTk4MA==", "bodyText": "We can use FlexRowWrap here", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453729980", "createdAt": "2020-07-13T15:22:11Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,224 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,\n+          cohortChanged,\n+          updateGroupListsCount: this.state.updateGroupListsCount + 1\n+        });\n+      }));\n+      this.updateWrapperDimensions();\n+      this.props.setShowWarningModal(this.showWarningModal);\n+    }\n+\n+    componentWillUnmount() {\n+      this.subscription.unsubscribe();\n+      idsInUse.next(new Set());\n+      currentCohortStore.next(undefined);\n+      searchRequestStore.next({includes: [], excludes: [], dataFilters: []} as SearchRequest);\n+    }\n+\n+    async showWarningModal() {\n+      this.setState({modalOpen: true});\n+      return await new Promise<boolean>((resolve => this.resolve = resolve));\n+    }\n+\n+    getModalResponse(res: boolean) {\n+      this.setState({modalOpen: false});\n+      this.resolve(res);\n+    }\n+\n+    updateWrapperDimensions() {\n+      const {top} = this.searchWrapper.getBoundingClientRect();\n+      this.searchWrapper.style.minHeight = `${window.innerHeight - top - 24}px`;\n+    }\n+\n+    updateRequest = () => {\n+      // timeout prevents Angular 'Expression changed after checked' error\n+      setTimeout(() => this.setState({updateCount: this.state.updateCount + 1}));\n+    }\n+\n+    render() {\n+      const {cohort, cohortChanged, criteria, loading, modalOpen, overview, searchContext, updateCount, updateGroupListsCount} = this.state;\n+      return <React.Fragment>\n+        <div ref={el => this.searchWrapper = el} style={{padding: '1rem 1rem 2rem'}}>\n+        <div style={{display: 'flex', flexWrap: 'wrap', margin: '0 -0.5rem'}}>\n+          <div style={colStyle('66.66667')}>\n+            <div style={{display: 'flex', flexWrap: 'wrap', margin: '0 -0.5rem'}}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02aa17b94d9a85d015020abda4d34fd4a820bca2"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1MDc5NQ==", "bodyText": "Nice, didn't know these were here.", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453750795", "createdAt": "2020-07-13T15:50:07Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,224 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,\n+          cohortChanged,\n+          updateGroupListsCount: this.state.updateGroupListsCount + 1\n+        });\n+      }));\n+      this.updateWrapperDimensions();\n+      this.props.setShowWarningModal(this.showWarningModal);\n+    }\n+\n+    componentWillUnmount() {\n+      this.subscription.unsubscribe();\n+      idsInUse.next(new Set());\n+      currentCohortStore.next(undefined);\n+      searchRequestStore.next({includes: [], excludes: [], dataFilters: []} as SearchRequest);\n+    }\n+\n+    async showWarningModal() {\n+      this.setState({modalOpen: true});\n+      return await new Promise<boolean>((resolve => this.resolve = resolve));\n+    }\n+\n+    getModalResponse(res: boolean) {\n+      this.setState({modalOpen: false});\n+      this.resolve(res);\n+    }\n+\n+    updateWrapperDimensions() {\n+      const {top} = this.searchWrapper.getBoundingClientRect();\n+      this.searchWrapper.style.minHeight = `${window.innerHeight - top - 24}px`;\n+    }\n+\n+    updateRequest = () => {\n+      // timeout prevents Angular 'Expression changed after checked' error\n+      setTimeout(() => this.setState({updateCount: this.state.updateCount + 1}));\n+    }\n+\n+    render() {\n+      const {cohort, cohortChanged, criteria, loading, modalOpen, overview, searchContext, updateCount, updateGroupListsCount} = this.state;\n+      return <React.Fragment>\n+        <div ref={el => this.searchWrapper = el} style={{padding: '1rem 1rem 2rem'}}>\n+        <div style={{display: 'flex', flexWrap: 'wrap', margin: '0 -0.5rem'}}>\n+          <div style={colStyle('66.66667')}>\n+            <div style={{display: 'flex', flexWrap: 'wrap', margin: '0 -0.5rem'}}>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyOTk4MA=="}, "originalCommit": {"oid": "02aa17b94d9a85d015020abda4d34fd4a820bca2"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDIyNzc0OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxMzo1NFrOGwx8mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOToyOToyNlrOGw2vBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMzE2MA==", "bodyText": "Question: Whats await new Promise((resolve => this.resolve = resolve)); used for", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453803160", "createdAt": "2020-07-13T17:13:54Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,\n+          cohortChanged,\n+          updateGroupListsCount: this.state.updateGroupListsCount + 1\n+        });\n+      }));\n+      this.updateWrapperDimensions();\n+      this.props.setShowWarningModal(this.showWarningModal);\n+    }\n+\n+    componentWillUnmount() {\n+      this.subscription.unsubscribe();\n+      idsInUse.next(new Set());\n+      currentCohortStore.next(undefined);\n+      searchRequestStore.next({includes: [], excludes: [], dataFilters: []} as SearchRequest);\n+    }\n+\n+    async showWarningModal() {\n+      this.setState({modalOpen: true});\n+      return await new Promise<boolean>((resolve => this.resolve = resolve));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4MTYwNw==", "bodyText": "Yeah, this is the unsaved changes warning and is definitely a little tricky.\nSo the promise is what gets returned to the canDeactivate guard if there are unsaved changes to the cohort. this.resolve handles the response from the the user through the modal and determines whether to complete or cancel the navigation to the new route.", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453881607", "createdAt": "2020-07-13T19:29:26Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,\n+          cohortChanged,\n+          updateGroupListsCount: this.state.updateGroupListsCount + 1\n+        });\n+      }));\n+      this.updateWrapperDimensions();\n+      this.props.setShowWarningModal(this.showWarningModal);\n+    }\n+\n+    componentWillUnmount() {\n+      this.subscription.unsubscribe();\n+      idsInUse.next(new Set());\n+      currentCohortStore.next(undefined);\n+      searchRequestStore.next({includes: [], excludes: [], dataFilters: []} as SearchRequest);\n+    }\n+\n+    async showWarningModal() {\n+      this.setState({modalOpen: true});\n+      return await new Promise<boolean>((resolve => this.resolve = resolve));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMzE2MA=="}, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDIzODk4OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxNjo0N1rOGwyDiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOTozMzo0MlrOGw24nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNDkzOQ==", "bodyText": "can sr ever be null? also can we use more meaningful variable searchRequest or something?", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453804939", "createdAt": "2020-07-13T17:16:47Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4NDA2MQ==", "bodyText": "It should never be null. The initial value is set to {includes: [], excludes: [], dataFilters: []} in the store, basically an empty search request object. I renamed the variable to 'searchRequest.'", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453884061", "createdAt": "2020-07-13T19:33:42Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNDkzOQ=="}, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDI1MDY2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxOTo1OFrOGwyK8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDoxMzo1MVrOGw4JCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNjgzMw==", "bodyText": "What happens if this api throws an error", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453806833", "createdAt": "2020-07-13T17:19:58Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkwNDY1MQ==", "bodyText": "Good point. Currently just leaves a blank page. I've added handling to the call and a message to show if the call fails.", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453904651", "createdAt": "2020-07-13T20:13:51Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNjgzMw=="}, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDI2NTI3OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.spec.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoyMzo0NFrOGwyUKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNDozNzo1NlrOGxWt8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwOTE5NA==", "bodyText": "Can we add more test like for search request with include/exclude?", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453809194", "createdAt": "2020-07-13T17:23:44Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.spec.tsx", "diffHunk": "@@ -0,0 +1,19 @@\n+import {shallow} from 'enzyme';\n+import * as React from 'react';\n+\n+import {currentWorkspaceStore, queryParamsStore} from 'app/utils/navigation';\n+import {workspaceDataStub} from 'testing/stubs/workspaces-api-stub';\n+import {CohortSearch} from './cohort-search.component';\n+\n+describe('CohortSearch', () => {\n+  beforeEach(() => {\n+    currentWorkspaceStore.next(workspaceDataStub);\n+    queryParamsStore.next({\n+      cohortId: 'test-id'\n+    });\n+  });\n+  it('should render', () => {\n+    const wrapper = shallow(<CohortSearch setCohortChanged={() => {}} setShowWarningModal={() => {}} setUpdatingCohort={() => {}}/>);\n+    expect(wrapper).toBeTruthy();\n+  });\n+});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNTYxOA==", "bodyText": "Probably could use more still, but I added one to check that the number of groups matches the length of the includes/excludes array.", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r454405618", "createdAt": "2020-07-14T14:37:56Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.spec.tsx", "diffHunk": "@@ -0,0 +1,19 @@\n+import {shallow} from 'enzyme';\n+import * as React from 'react';\n+\n+import {currentWorkspaceStore, queryParamsStore} from 'app/utils/navigation';\n+import {workspaceDataStub} from 'testing/stubs/workspaces-api-stub';\n+import {CohortSearch} from './cohort-search.component';\n+\n+describe('CohortSearch', () => {\n+  beforeEach(() => {\n+    currentWorkspaceStore.next(workspaceDataStub);\n+    queryParamsStore.next({\n+      cohortId: 'test-id'\n+    });\n+  });\n+  it('should render', () => {\n+    const wrapper = shallow(<CohortSearch setCohortChanged={() => {}} setShowWarningModal={() => {}} setUpdatingCohort={() => {}}/>);\n+    expect(wrapper).toBeTruthy();\n+  });\n+});", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwOTE5NA=="}, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2408, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}