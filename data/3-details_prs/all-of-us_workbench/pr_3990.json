{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NjI1ODk3", "number": 3990, "title": "[RW-5434][risk=no] Update Puppeteer test for new Cohort Builder UI", "bodyText": "Update existing tests for new cohort builder UI and workflow (converted modal to full page, use sidebar for selections, modifiers and attributes)\nAdd new class for testing the HelpSidebar component\nIncludes minor updates/cleanup of cohort builder components needed for tests\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local", "createdAt": "2020-09-11T04:16:15Z", "url": "https://github.com/all-of-us/workbench/pull/3990", "merged": true, "mergeCommit": {"oid": "843b35674ec11fab03593d977ea54337d3aab612"}, "closed": true, "closedAt": "2020-09-14T16:33:17Z", "author": {"login": "dolbeew"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHkdTvAH2gAyNDg0NjI1ODk3OmNhNjA2NDIyZTBiNTRjM2MwYzg4OTAxMDhhYWJhOTIxMjI5ZjIzYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI1IMigH2gAyNDg0NjI1ODk3OjIwMGQzNGU0YjRkNzhlMGUwOThjNmU5NjliMjE0NDU0ZDZkODUzNjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ca606422e0b54c3c0c8890108aaba921229f23b2", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/ca606422e0b54c3c0c8890108aaba921229f23b2", "committedDate": "2020-09-10T17:43:18Z", "message": "RW-5434 update variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76adf727c34c035d1346d5e1014b7209f2e3445e", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/76adf727c34c035d1346d5e1014b7209f2e3445e", "committedDate": "2020-09-10T17:43:18Z", "message": "RW-5434 add help sidebar class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee84486fa3c5a9790e26dcc9df86211a7601f653", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/ee84486fa3c5a9790e26dcc9df86211a7601f653", "committedDate": "2020-09-10T17:47:50Z", "message": "RW-5434 update cohorts-create test for new UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0281d69b5864ea4ceb9e2400d43bebf4541f50bd", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/0281d69b5864ea4ceb9e2400d43bebf4541f50bd", "committedDate": "2020-09-10T17:48:47Z", "message": "RW-5434 update export-to-notebook test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "405fa2adf7b65444f146ab054cde1eccc343c359", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/405fa2adf7b65444f146ab054cde1eccc343c359", "committedDate": "2020-09-10T17:48:47Z", "message": "RW-5434 update dataset-create test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "308bedc11e00532e19aa6901d7143a56caba0b83", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/308bedc11e00532e19aa6901d7143a56caba0b83", "committedDate": "2020-09-10T17:50:31Z", "message": "RW-5434 update cohorts-review test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3d53ebda0c82de39733c51fe1c35a03fbf4ffc8", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d3d53ebda0c82de39733c51fe1c35a03fbf4ffc8", "committedDate": "2020-09-11T04:07:15Z", "message": "RW-5434 update tests for latest CB changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "021b454bd0ba29623128a0e83cb5dda171ba2884", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/021b454bd0ba29623128a0e83cb5dda171ba2884", "committedDate": "2020-09-11T05:41:06Z", "message": "RW-5434 lint error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/bd193d9068ba5a924b667668c7ddb70c197f94ce", "committedDate": "2020-09-14T14:26:13Z", "message": "RW-5434 changes from feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODQxMDcw", "url": "https://github.com/all-of-us/workbench/pull/3990#pullrequestreview-487841070", "createdAt": "2020-09-14T14:40:47Z", "commit": {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNDo0MDo0N1rOHRYSlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNDo0OToxMlrOHRYrfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4NTgxNA==", "bodyText": "nit: remove await", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487985814", "createdAt": "2020-09-14T14:40:47Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -124,22 +120,32 @@ export default class CohortCriteriaModal extends Modal {\n    * Click FINISH button.\n    */\n   async clickFinishButton(): Promise<void> {\n-    return this.clickButton(LinkText.Finish, {waitForClose: true});\n+    return Button.findByName(this.page, {normalizeSpace: LinkText.FinishAndReview}).then(button => button.click());\n+  }\n+\n+  async viewAndSaveCriteria(): Promise<void> {\n+    const finishAndReviewButton = await Button.findByName(this.page, {name: LinkText.FinishAndReview});\n+    await finishAndReviewButton.waitUntilEnabled();\n+    await finishAndReviewButton.click();\n+\n+    // Click Save Criteria button in sidebar\n+    const helpSidebar = await new HelpSidebar(this.page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4OTQ0OQ==", "bodyText": "nit: remove await in class constructor call.", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487989449", "createdAt": "2020-09-14T14:45:31Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -94,28 +108,10 @@ export default class CohortCriteriaModal extends Modal {\n     const link = await this.waitForPhysicalMeasurementCriteriaLink(criteriaName);\n     await link.click();\n \n-    const selectMenu = await SelectMenu.findByName(this.page, {ancestorLevel: 2}, this);\n-    await selectMenu.clickMenuItem(filterSign);\n-\n-    const numberField = await this.page.waitForXPath(`${this.xpath}//input[@type=\"number\"]`, {visible: true});\n-    await numberField.type(String(filterValue));\n-\n-    await this.clickButton(LinkText.Calculate);\n-    const participantResult = await this.waitForParticipantResult();\n+    const helpSidebar = await new HelpSidebar(this.page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5MTI4MQ==", "bodyText": "nit: remove ../.. before utils", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487991281", "createdAt": "2020-09-14T14:48:01Z", "author": {"login": "aweng98"}, "path": "e2e/app/component/help-sidebar.ts", "diffHunk": "@@ -0,0 +1,107 @@\n+import {ElementHandle, Page} from 'puppeteer';\n+\n+import SelectMenu from 'app/component/select-menu';\n+import Container from 'app/container';\n+import Button from 'app/element/button';\n+import {FilterSign} from 'app/page/cohort-search-page';\n+import {LinkText} from 'app/text-labels';\n+import {buildXPath} from 'app/xpath-builders';\n+import {ElementType} from 'app/xpath-options';\n+import {waitForNumericalString} from 'utils/waits-utils';\n+import {waitWhileLoading} from '../../utils/test-utils';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5MjE4OA==", "bodyText": "old comment. no more modal window, right?", "url": "https://github.com/all-of-us/workbench/pull/3990#discussion_r487992188", "createdAt": "2020-09-14T14:49:12Z", "author": {"login": "aweng98"}, "path": "e2e/app/component/help-sidebar.ts", "diffHunk": "@@ -0,0 +1,107 @@\n+import {ElementHandle, Page} from 'puppeteer';\n+\n+import SelectMenu from 'app/component/select-menu';\n+import Container from 'app/container';\n+import Button from 'app/element/button';\n+import {FilterSign} from 'app/page/cohort-search-page';\n+import {LinkText} from 'app/text-labels';\n+import {buildXPath} from 'app/xpath-builders';\n+import {ElementType} from 'app/xpath-options';\n+import {waitForNumericalString} from 'utils/waits-utils';\n+import {waitWhileLoading} from '../../utils/test-utils';\n+\n+const defaultXpath = '//*[@id=\"help-sidebar\"]';\n+enum SectionSelectors {\n+  AttributesForm = '//*[@id=\"attributes-form\"]',\n+  ModifiersForm = '//*[@id=\"modifiers-form\"]',\n+  SelectionList = '//*[@id=\"selection-list\"]',\n+}\n+\n+export default class HelpSidebar extends Container {\n+\n+  constructor(page: Page, xpath: string = defaultXpath) {\n+    super(page, xpath);\n+  }\n+\n+  async getPhysicalMeasurementParticipantResult(filterSign: FilterSign, filterValue: number): Promise<string> {\n+    await this.waitUntilSectionVisible(SectionSelectors.AttributesForm);\n+\n+    const selectMenu = await SelectMenu.findByName(this.page, {ancestorLevel: 2}, this);\n+    await selectMenu.clickMenuItem(filterSign);\n+\n+    const numberField = await this.page.waitForXPath(`${this.xpath}//input[@type=\"number\"]`, {visible: true});\n+    await numberField.type(String(filterValue));\n+\n+    await this.clickSidebarButton(LinkText.Calculate);\n+    const participantResult = await this.waitForParticipantResult();\n+\n+    // Find criteria in Selected Criteria Content Box.\n+    const removeSelectedCriteriaIconSelector = buildXPath({type: ElementType.Icon, iconShape: 'times-circle'}, this);\n+    // Before add criteria, first check for nothing in Selected Criteria Content Box.\n+    await this.page.waitForXPath(removeSelectedCriteriaIconSelector,{hidden: true});\n+\n+    await this.clickSidebarButton(LinkText.AddThis);\n+    // After add criteria, should flip to selection list section\n+    await this.waitUntilSectionVisible(SectionSelectors.SelectionList);\n+    // Look for X (remove) icon for indication that add succeeded.\n+    await this.page.waitForXPath(removeSelectedCriteriaIconSelector,{visible: true});\n+\n+    // dialog close after click FINISH button.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd193d9068ba5a924b667668c7ddb70c197f94ce"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "200d34e4b4d78e0e098c6e969b214454d6d85362", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/200d34e4b4d78e0e098c6e969b214454d6d85362", "committedDate": "2020-09-14T15:42:33Z", "message": "RW-5434 pr comments, add delay"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4202, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}