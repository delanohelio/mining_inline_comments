{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MTUxODg1", "number": 4392, "title": "[no ticket][risk=no] Puppeteer Fix flaky tests", "bodyText": "", "createdAt": "2020-12-10T18:26:32Z", "url": "https://github.com/all-of-us/workbench/pull/4392", "merged": true, "mergeCommit": {"oid": "5a58bc75e10bdd593a49e8445f6ebfb4a96bad37"}, "closed": true, "closedAt": "2020-12-14T15:45:31Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk2mlyAH2gAyNTM2MTUxODg1OjNmN2VmZTkwMTljYmE2ZjQwOGQ2MGRiNjdhODU4YzViZTI1OTgxOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlLXJIAFqTU1MDMzMDEzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f7efe9019cba6f408d60db67a858c5be2598199", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3f7efe9019cba6f408d60db67a858c5be2598199", "committedDate": "2020-12-10T17:15:32Z", "message": "increase waitForKernelIdle to 3 minutes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f4aedb370d5c4bd066a3e54aae0394b87e0a13c", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7f4aedb370d5c4bd066a3e54aae0394b87e0a13c", "committedDate": "2020-12-10T18:25:06Z", "message": "Fix flaky dataset-create.spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea648931214ac6f6ce358a1b108fb721fde9b0ee", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ea648931214ac6f6ce358a1b108fb721fde9b0ee", "committedDate": "2020-12-10T18:28:04Z", "message": "remove debug line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDg0NTk0", "url": "https://github.com/all-of-us/workbench/pull/4392#pullrequestreview-549484594", "createdAt": "2020-12-10T18:26:47Z", "commit": {"oid": "7f4aedb370d5c4bd066a3e54aae0394b87e0a13c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyNjo0OFrOIDXWWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODozMDozMlrOIDXgSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM5OTE5NA==", "bodyText": "Fix a timeout failure:\nhttps://app.circleci.com/pipelines/github/all-of-us/workbench/6396/workflows/3df44fa7-e8b5-448c-9c67-3ab504e74f1f/jobs/113642/steps\nFAIL tests/notebook/notebook-python3.spec.ts (290.995 s)\n  Jupyter notebook tests in Python language\n    \u2715 Run code from file (290223 ms)\n\n  \u25cf Jupyter notebook tests in Python language \u203a Run code from file\n\n    waitForKernelIdle encountered TimeoutError: waiting for selector `#MathJax_Message` to be hidden failed: timeout 120000ms exceeded\n\n      126 |     } catch (e) {\n      127 |       console.error(`Notebook kernel is: ${await this.kernelStatus()}`);\n    > 128 |       throw new Error(`waitForKernelIdle encountered ${e}`);\n          |             ^\n      129 |     }\n      130 |   }\n      131 | \n\n      at NotebookPage.waitForKernelIdle (app/page/notebook-page.ts:128:13)\n      at NotebookPage.isLoaded (app/page/notebook-page.ts:54:5)\n      at NotebookPage.waitForLoad (app/page/authenticated-page.ts:35:5)\n      at WorkspaceAnalysisPage.createNotebook (app/page/workspace-analysis-page.ts:77:5)\n      at Object.<anonymous> (tests/notebook/notebook-python3.spec.ts:29:22)", "url": "https://github.com/all-of-us/workbench/pull/4392#discussion_r540399194", "createdAt": "2020-12-10T18:26:48Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/notebook-page.ts", "diffHunk": "@@ -51,7 +51,7 @@ export default class NotebookPage extends AuthenticatedPage {\n       console.log(`Reloading \"${this.documentTitle}\" because cannot find the Run button`);\n       await this.page.reload({waitUntil: ['networkidle0', 'load']});\n     }\n-    await this.waitForKernelIdle(120000);\n+    await this.waitForKernelIdle(180000); // 3 minutes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4aedb370d5c4bd066a3e54aae0394b87e0a13c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQwMTczOA==", "bodyText": "Created new dataset-edit-page.ts class because clicking Edit option opens the Edit Dataset page.", "url": "https://github.com/all-of-us/workbench/pull/4392#discussion_r540401738", "createdAt": "2020-12-10T18:30:32Z", "author": {"login": "aweng98"}, "path": "e2e/tests/datasets/dataset-create.spec.ts", "diffHunk": "@@ -75,10 +75,13 @@ describe('Dataset test', () => {\n     await datasetCard.selectSnowmanMenu(Option.Edit);\n     await waitWhileLoading(page);\n \n-    await datasetPage.selectCohorts(['All Participants']);\n-    await datasetPage.clickAnalyzeButton();\n-\n+    const datasetEditPage = new DatasetEditPage(page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea648931214ac6f6ce358a1b108fb721fde9b0ee"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "067cac9929844775f1ba6ac782f670649bcf9210", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/067cac9929844775f1ba6ac782f670649bcf9210", "committedDate": "2020-12-10T20:53:17Z", "message": "ignore error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NTk0MTky", "url": "https://github.com/all-of-us/workbench/pull/4392#pullrequestreview-549594192", "createdAt": "2020-12-10T20:55:36Z", "commit": {"oid": "067cac9929844775f1ba6ac782f670649bcf9210"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1NTozNlrOIDc58A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1NTozNlrOIDc58A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5MDIyNA==", "bodyText": "Ignore error (okayed by @dolbeew)\nhttps://app.circleci.com/pipelines/github/all-of-us/workbench/6404/workflows/5b652dc7-aac3-4598-a702-32df5abb47ae/jobs/113690/parallel-runs/1?filterBy=FAILED\nFAIL tests/cohorts/cohorts-rename.spec.ts (159.676 s)\n  User can create, modify, rename and delete Cohort\n    \u2715 Add cohort including Demographics Age (159052 ms)\n\n  \u25cf User can create, modify, rename and delete Cohort \u203a Add cohort including Demographics Age\n\n    TimeoutError: waiting for function failed: timeout 30000ms exceeded\n\n      231 |          // wait for visible then compare texts\n      232 |       await page.waitForSelector(selector.css, {visible: true, timeout});\n    > 233 |       const jsHandle = await page.waitForFunction((css, expText) => {\n          |                                   ^\n      234 |         const element = document.querySelector(css);\n      235 |         return element && element.textContent.includes(expText);\n      236 |       }, {timeout}, selector.css, textSubstr);\n\n      at new WaitTask (node_modules/puppeteer/lib/cjs/puppeteer/common/DOMWorld.js:505:34)\n      at DOMWorld.waitForFunction (node_modules/puppeteer/lib/cjs/puppeteer/common/DOMWorld.js:460:26)\n      at Frame.waitForFunction (node_modules/puppeteer/lib/cjs/puppeteer/common/FrameManager.js:910:32)\n      at Page.waitForFunction (node_modules/puppeteer/lib/cjs/puppeteer/common/Page.js:1291:33)\n      at Object.waitForText (utils/waits-utils.ts:233:35)\n      at CohortParticipantsGroup.deleteGroup (app/page/cohort-participants-group.ts:79:5)\n      at Object.<anonymous> (tests/cohorts/cohorts-rename.spec.ts:82:32)", "url": "https://github.com/all-of-us/workbench/pull/4392#discussion_r540490224", "createdAt": "2020-12-10T20:55:36Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/cohort-participants-group.ts", "diffHunk": "@@ -76,7 +76,11 @@ export default class CohortParticipantsGroup {\n   async deleteGroup(): Promise<ElementHandle[]> {\n     await this.clickSnowmanIcon();\n     await this.selectGroupSnowmanMenu(GroupMenuOption.DeleteGroup);\n-    await waitForText(this.page, 'This group has been deleted');\n+    try {\n+      await waitForText(this.page, 'This group has been deleted');\n+    } catch (err) {\n+      // Sometimes message fails to show up. Ignore error.\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "067cac9929844775f1ba6ac782f670649bcf9210"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMzMwMTMw", "url": "https://github.com/all-of-us/workbench/pull/4392#pullrequestreview-550330130", "createdAt": "2020-12-11T17:26:40Z", "commit": {"oid": "067cac9929844775f1ba6ac782f670649bcf9210"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3756, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}