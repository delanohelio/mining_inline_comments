{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODE2NTE0", "number": 3689, "title": "[RW-4383][risk=no] Puppeteer test: Export notebook in R language", "bodyText": "Add second test Export dataset to notebook in R programming language in export-to-notebook.spec.ts test file.\nTest pass screenshot:\n\nSupporting changes:\n\nxPathOptionToXpath - Add support for starts-with xpath expr.\nSome xpath selectors fixes.", "createdAt": "2020-06-18T23:53:02Z", "url": "https://github.com/all-of-us/workbench/pull/3689", "merged": true, "mergeCommit": {"oid": "83b2b54d3ecc5a6e816ef7cd50772a75be9f6a94"}, "closed": true, "closedAt": "2020-06-21T13:48:29Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsnXNgAH2gAyNDM2ODE2NTE0OjIyYzZmZThjYjUwN2YyY2MwOTVkYWJkNDUxNTkyZDE5ZWU4ZjA2Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctUfypAFqTQzNDQ2ODY3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "22c6fe8cb507f2cc095dabd451592d19ee8f0679", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/22c6fe8cb507f2cc095dabd451592d19ee8f0679", "committedDate": "2020-06-18T23:50:24Z", "message": "export notebook in R language"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffc74bdabda35b5fcd661ad78ca8c2b83c3c34f2", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ffc74bdabda35b5fcd661ad78ca8c2b83c3c34f2", "committedDate": "2020-06-19T01:29:19Z", "message": "more update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ab935dc79689daef12c89770dd04b8c1239a9e66", "committedDate": "2020-06-19T01:31:55Z", "message": "revert jest.test-setup.ts change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzUyMzg0", "url": "https://github.com/all-of-us/workbench/pull/3689#pullrequestreview-433752384", "createdAt": "2020-06-19T01:48:42Z", "commit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMTo0ODo0MlrOGmFeCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMTo1MDo0MVrOGmFfxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4ODY4Mg==", "bodyText": "If someone needs to pause test execution and look for why errored on page,  simply uncomment await jestPuppeteer.debug(); to allow the inspection of page manually.\nLog error if errored. so I know it is related to the screenshot.\nExample:", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r442588682", "createdAt": "2020-06-19T01:48:42Z", "author": {"login": "aweng98"}, "path": "e2e/app/element/base-element.ts", "diffHunk": "@@ -29,10 +29,17 @@ export default class BaseElement extends Container {\n    * @param {WaitForSelectorOptions} waitOptions\n    */\n   async waitForXPath(waitOptions: WaitForSelectorOptions = {visible: true}): Promise<this> {\n-    if (this.element === undefined) {\n-      this.element = await this.page.waitForXPath(this.xpath, waitOptions);\n+    try {\n+      if (this.element === undefined) {\n+        this.element = await this.page.waitForXPath(this.xpath, waitOptions);\n+      }\n+      return this;\n+    } catch (err) {\n+      console.error(`waitForXpath() encountered ${err}`);\n+      // Debugging pause\n+      // await jestPuppeteer.debug();\n+      throw err;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4OTEyNQ==", "bodyText": "Inconsistency in casing. o is lowercase in of. Uppercase O in Of. \ud83d\ude14", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r442589125", "createdAt": "2020-06-19T01:50:41Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/cohort-criteria-modal.ts", "diffHunk": "@@ -29,6 +29,14 @@ export enum PhysicalMeasurementsCriteria {\n   WheelChairUser = 'Wheelchair user at enrollment',\n }\n \n+export enum Ethnicity {\n+  NotHispanicOrLatino = 'Not Hispanic or Latino',\n+  HispanicOrLatino = 'Hispanic or Latino',\n+  RaceEthnicityNoneOfThese = 'Race Ethnicity None Of These',\n+  PreferNotToAnswer = 'Prefer Not To Answer',\n+  Skip = 'Skip',\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Mzc4ODc5", "url": "https://github.com/all-of-us/workbench/pull/3689#pullrequestreview-434378879", "createdAt": "2020-06-19T23:26:03Z", "commit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzoyNjowNFrOGmjPNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNDo1MlrOGmjUPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjQwNw==", "bodyText": "nit: too many spaces", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443076407", "createdAt": "2020-06-19T23:26:04Z", "author": {"login": "calbach"}, "path": "e2e/app/page/cohort-criteria-modal.ts", "diffHunk": "@@ -128,4 +145,11 @@ export default class CohortCriteriaModal extends Dialog {\n     return participantResult;\n   }\n \n+  async addEthnicity(ethnicities: Ethnicity[]): Promise<void> {\n+    for  (const ethnicity of  ethnicities) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjU5Nw==", "bodyText": "the parens around (any) look wrong to me here; am I missing something?", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443076597", "createdAt": "2020-06-19T23:27:13Z", "author": {"login": "calbach"}, "path": "e2e/app/page/data-page.ts", "diffHunk": "@@ -56,14 +56,17 @@ export default class DataPage extends AuthenticatedPage {\n    * Select DATA, ANALYSIS or ABOUT page tab.\n    * @param {TabLabelAlias} tabName\n    */\n-  async openTab(tabName: TabLabelAlias, opts: {waitPageChange?: boolean} = {}): Promise<void> {\n+  async openTab(tabName: TabLabelAlias, opts: {waitPageChange?: boolean} = {}): Promise<(any)> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjY1Ng==", "bodyText": "presumably this was for debugging - remove?", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443076656", "createdAt": "2020-06-19T23:27:39Z", "author": {"login": "calbach"}, "path": "e2e/app/page/dataset-save-modal.ts", "diffHunk": "@@ -41,9 +41,10 @@ export default class DatasetSaveModal extends Dialog {\n \n     if (isExportToNotebook) {\n       // Export to notebook\n-      const notebookNameTextbox = new Textbox(this.page, '//*[@data-test-id=\"notebook-name-input\"]');\n+      const notebookNameTextbox = new Textbox(this.page, `${this.getXpath()}//*[@data-test-id=\"notebook-name-input\"]`);\n       await notebookNameTextbox.type(notebookName);\n-      const radioBtn = await RadioButton.findByName(this.page, {name: language});\n+      console.log(`Notebook language: ` + language);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjgxMg==", "bodyText": "Adding a bunch of these makes me a bit worried about maintenance. Is there a reason these needed to be added here? vs just waiting for the next button to become clickable/undisabled?", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443076812", "createdAt": "2020-06-19T23:28:52Z", "author": {"login": "calbach"}, "path": "e2e/tests/datasets/dataset-create.spec.ts", "diffHunk": "@@ -102,7 +103,9 @@ describe('Create Dataset', () => {\n     const dataSetName = await saveModal.saveDataset();\n \n     // Verify create successful.\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NzIzOA==", "bodyText": "analysis", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443077238", "createdAt": "2020-06-19T23:31:32Z", "author": {"login": "calbach"}, "path": "e2e/tests/datasets/export-to-notebook.spec.ts", "diffHunk": "@@ -77,8 +79,96 @@ describe('Create Dataset', () => {\n \n     // Delete Dataset.\n     await dataPage.openTab(TabLabelAlias.Data);\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await waitWhileLoading(page);\n+\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);\n+\n     await dataPage.deleteDataset(newDatasetName);\n+  });\n+\n+  /**\n+   * Create new Cohort thru Dataset Build page. Cohort built from demographics -> Ethnicity.\n+   * Create new Dataset with Cohort, then export to notebook in R language.\n+   * Delete Cohort, Dataset, and Notebook.\n+   */\n+  test('Export dataset to notebook in R programming language', async () => {\n+    const workspaceCard = await findWorkspace(page);\n+    const workspaceName = await workspaceCard.clickWorkspaceName();\n+\n+    // Click Add Datasets button\n+    const dataPage = new DataPage(page);\n+    const datasetBuildPage = await dataPage.clickAddDatasetButton();\n+    const cohortBuildPage = await datasetBuildPage.clickAddCohortsButton();\n+\n+    // Include Participants Group 1: Add Criteria: Ethnicity\n+    const group1 = cohortBuildPage.findIncludeParticipantsGroup('Group 1');\n+    const modal = await group1.includeEthnicity();\n+    await modal.addEthnicity([Ethnicity.HispanicOrLatino, Ethnicity.NotHispanicOrLatino]);\n+    await modal.clickFinishButton();\n+\n+    // Check Group 1 Count.\n+    const group1Count = await group1.getGroupCount();\n+    const group1CountInt = Number(group1Count.replace(/,/g, ''));\n+    expect(group1CountInt).toBeGreaterThan(1);\n+    console.log('Include Participants Group 1: ' + group1CountInt);\n+\n+    // Save new Cohort.\n+    const newCohortName = await cohortBuildPage.saveCohortAs();\n+    await waitForText(page, 'Cohort Saved Successfully');\n+    console.log(`Created Cohort \"${newCohortName}\"`);\n+\n+    const cohortActionsPage = new CohortActionsPage(page);\n+    await cohortActionsPage.clickCreateDatasetButton();\n+\n+    await datasetBuildPage.selectCohorts([newCohortName]);\n+    await datasetBuildPage.selectConceptSets(['Demographics']);\n+    await datasetBuildPage.clickSaveAndAnalyzeButton();\n+\n+    const newNotebookName = makeRandomName();\n+    const saveModal = new DatasetSaveModal(page);\n+    const newDatasetName = await saveModal.saveDataset({isExportToNotebook: true, notebookName: newNotebookName, language: Language.R});\n+    await waitWhileLoading(page);\n+\n+    // Verify Notebook preview. Not going to start the Jupyter notebook.\n+    const notebookPreviewPage = new NotebookPreviewPage(page);\n+    await notebookPreviewPage.waitForLoad();\n+    const currentPageUrl = await page.url();\n+    expect(currentPageUrl).toContain(`notebooks/preview/${newNotebookName}.ipynb`);\n+\n+    const code = await notebookPreviewPage.getFormattedCode();\n+    expect(code).toContain('library(bigrquery)');\n+\n+    // Navigate to Workpace Data page.\n+    const notebooksLink = await Link.findByName(page, {name: workspaceName});\n+    await notebooksLink.clickAndWait();\n+    await dataPage.waitForLoad();\n+\n+    // Delete test data sequence is: Delete Notebook, then Dataset, finally Cohort.\n+    // Delete Notebook\n+    await dataPage.openTab(TabLabelAlias.Analysis);\n+    await waitWhileLoading(page);\n+\n+    const analysiPage = new AnalysisPage(page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NzM4MA==", "bodyText": "nice, this is pretty easy to read through", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443077380", "createdAt": "2020-06-19T23:32:30Z", "author": {"login": "calbach"}, "path": "e2e/tests/datasets/export-to-notebook.spec.ts", "diffHunk": "@@ -77,8 +79,96 @@ describe('Create Dataset', () => {\n \n     // Delete Dataset.\n     await dataPage.openTab(TabLabelAlias.Data);\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await waitWhileLoading(page);\n+\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);\n+\n     await dataPage.deleteDataset(newDatasetName);\n+  });\n+\n+  /**\n+   * Create new Cohort thru Dataset Build page. Cohort built from demographics -> Ethnicity.\n+   * Create new Dataset with Cohort, then export to notebook in R language.\n+   * Delete Cohort, Dataset, and Notebook.\n+   */\n+  test('Export dataset to notebook in R programming language', async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NzY5NQ==", "bodyText": "136 characters is really excessive... Is the linter not active here?\nIn this case I would wrap the object since it's a pretty important part of the test:\nconst newDatasetName = await saveModal.saveDataset({\n  isExportToNotebook: true,\n  notebookName: newNotebookName,\n  language: Language.R\n});", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443077695", "createdAt": "2020-06-19T23:34:52Z", "author": {"login": "calbach"}, "path": "e2e/tests/datasets/export-to-notebook.spec.ts", "diffHunk": "@@ -77,8 +79,96 @@ describe('Create Dataset', () => {\n \n     // Delete Dataset.\n     await dataPage.openTab(TabLabelAlias.Data);\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await waitWhileLoading(page);\n+\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);\n+\n     await dataPage.deleteDataset(newDatasetName);\n+  });\n+\n+  /**\n+   * Create new Cohort thru Dataset Build page. Cohort built from demographics -> Ethnicity.\n+   * Create new Dataset with Cohort, then export to notebook in R language.\n+   * Delete Cohort, Dataset, and Notebook.\n+   */\n+  test('Export dataset to notebook in R programming language', async () => {\n+    const workspaceCard = await findWorkspace(page);\n+    const workspaceName = await workspaceCard.clickWorkspaceName();\n+\n+    // Click Add Datasets button\n+    const dataPage = new DataPage(page);\n+    const datasetBuildPage = await dataPage.clickAddDatasetButton();\n+    const cohortBuildPage = await datasetBuildPage.clickAddCohortsButton();\n+\n+    // Include Participants Group 1: Add Criteria: Ethnicity\n+    const group1 = cohortBuildPage.findIncludeParticipantsGroup('Group 1');\n+    const modal = await group1.includeEthnicity();\n+    await modal.addEthnicity([Ethnicity.HispanicOrLatino, Ethnicity.NotHispanicOrLatino]);\n+    await modal.clickFinishButton();\n+\n+    // Check Group 1 Count.\n+    const group1Count = await group1.getGroupCount();\n+    const group1CountInt = Number(group1Count.replace(/,/g, ''));\n+    expect(group1CountInt).toBeGreaterThan(1);\n+    console.log('Include Participants Group 1: ' + group1CountInt);\n+\n+    // Save new Cohort.\n+    const newCohortName = await cohortBuildPage.saveCohortAs();\n+    await waitForText(page, 'Cohort Saved Successfully');\n+    console.log(`Created Cohort \"${newCohortName}\"`);\n+\n+    const cohortActionsPage = new CohortActionsPage(page);\n+    await cohortActionsPage.clickCreateDatasetButton();\n+\n+    await datasetBuildPage.selectCohorts([newCohortName]);\n+    await datasetBuildPage.selectConceptSets(['Demographics']);\n+    await datasetBuildPage.clickSaveAndAnalyzeButton();\n+\n+    const newNotebookName = makeRandomName();\n+    const saveModal = new DatasetSaveModal(page);\n+    const newDatasetName = await saveModal.saveDataset({isExportToNotebook: true, notebookName: newNotebookName, language: Language.R});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dd66685ff9039d05fe8a390671844b09b7bcc0d", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6dd66685ff9039d05fe8a390671844b09b7bcc0d", "committedDate": "2020-06-20T01:36:38Z", "message": "PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Mzg4MjM0", "url": "https://github.com/all-of-us/workbench/pull/3689#pullrequestreview-434388234", "createdAt": "2020-06-20T00:37:01Z", "commit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQwMDozNzowMVrOGmjxVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQwMTozNToxOVrOGmkFMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NTE0MQ==", "bodyText": "corrected.", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443085141", "createdAt": "2020-06-20T00:37:01Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/cohort-criteria-modal.ts", "diffHunk": "@@ -128,4 +145,11 @@ export default class CohortCriteriaModal extends Dialog {\n     return participantResult;\n   }\n \n+  async addEthnicity(ethnicities: Ethnicity[]): Promise<void> {\n+    for  (const ethnicity of  ethnicities) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjQwNw=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NjEwOA==", "bodyText": "I didn't notice this before. I think tslint added it automatically.\nupdate function return to Promise<[void, Response] | void>.", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443086108", "createdAt": "2020-06-20T00:46:21Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/data-page.ts", "diffHunk": "@@ -56,14 +56,17 @@ export default class DataPage extends AuthenticatedPage {\n    * Select DATA, ANALYSIS or ABOUT page tab.\n    * @param {TabLabelAlias} tabName\n    */\n-  async openTab(tabName: TabLabelAlias, opts: {waitPageChange?: boolean} = {}): Promise<void> {\n+  async openTab(tabName: TabLabelAlias, opts: {waitPageChange?: boolean} = {}): Promise<(any)> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjU5Nw=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NjMzMw==", "bodyText": "Intentional. I thought good to know what lang was notebook created in.", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443086333", "createdAt": "2020-06-20T00:48:39Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/dataset-save-modal.ts", "diffHunk": "@@ -41,9 +41,10 @@ export default class DatasetSaveModal extends Dialog {\n \n     if (isExportToNotebook) {\n       // Export to notebook\n-      const notebookNameTextbox = new Textbox(this.page, '//*[@data-test-id=\"notebook-name-input\"]');\n+      const notebookNameTextbox = new Textbox(this.page, `${this.getXpath()}//*[@data-test-id=\"notebook-name-input\"]`);\n       await notebookNameTextbox.type(notebookName);\n-      const radioBtn = await RadioButton.findByName(this.page, {name: language});\n+      console.log(`Notebook language: ` + language);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjY1Ng=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4OTY0MA==", "bodyText": "Admittedly, this is not 'clean code'.\nwaitWhileLoading function checks for existences of spinners spinning for up to one second. Each time a call to function is made, it adds one extra second in playback time when no spinner was found.\nthru observation, app UI performance is unreliable. A conscious decision was made to make tests more resilient to failures related to page's readiness. It is a tradeoff between having longer playback time and \"flaky\" tests.", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443089640", "createdAt": "2020-06-20T01:27:48Z", "author": {"login": "aweng98"}, "path": "e2e/tests/datasets/dataset-create.spec.ts", "diffHunk": "@@ -102,7 +103,9 @@ describe('Create Dataset', () => {\n     const dataSetName = await saveModal.saveDataset();\n \n     // Verify create successful.\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NjgxMg=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4OTY4OQ==", "bodyText": "Thanks. I'll try do more like this in future.", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443089689", "createdAt": "2020-06-20T01:28:36Z", "author": {"login": "aweng98"}, "path": "e2e/tests/datasets/export-to-notebook.spec.ts", "diffHunk": "@@ -77,8 +79,96 @@ describe('Create Dataset', () => {\n \n     // Delete Dataset.\n     await dataPage.openTab(TabLabelAlias.Data);\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await waitWhileLoading(page);\n+\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);\n+\n     await dataPage.deleteDataset(newDatasetName);\n+  });\n+\n+  /**\n+   * Create new Cohort thru Dataset Build page. Cohort built from demographics -> Ethnicity.\n+   * Create new Dataset with Cohort, then export to notebook in R language.\n+   * Delete Cohort, Dataset, and Notebook.\n+   */\n+  test('Export dataset to notebook in R programming language', async () => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NzM4MA=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA5MDA3Ng==", "bodyText": "140 char is the max limit.\nwrapped and renamed parameter names to be shorter.\nconst newDatasetName = await saveModal.saveDataset({\n      exportToNotebook: true,\n      notebookName: newNotebookName,\n      lang: Language.R\n });\n    await waitWhileLoading(page);", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443090076", "createdAt": "2020-06-20T01:33:37Z", "author": {"login": "aweng98"}, "path": "e2e/tests/datasets/export-to-notebook.spec.ts", "diffHunk": "@@ -77,8 +79,96 @@ describe('Create Dataset', () => {\n \n     // Delete Dataset.\n     await dataPage.openTab(TabLabelAlias.Data);\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await waitWhileLoading(page);\n+\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);\n+\n     await dataPage.deleteDataset(newDatasetName);\n+  });\n+\n+  /**\n+   * Create new Cohort thru Dataset Build page. Cohort built from demographics -> Ethnicity.\n+   * Create new Dataset with Cohort, then export to notebook in R language.\n+   * Delete Cohort, Dataset, and Notebook.\n+   */\n+  test('Export dataset to notebook in R programming language', async () => {\n+    const workspaceCard = await findWorkspace(page);\n+    const workspaceName = await workspaceCard.clickWorkspaceName();\n+\n+    // Click Add Datasets button\n+    const dataPage = new DataPage(page);\n+    const datasetBuildPage = await dataPage.clickAddDatasetButton();\n+    const cohortBuildPage = await datasetBuildPage.clickAddCohortsButton();\n+\n+    // Include Participants Group 1: Add Criteria: Ethnicity\n+    const group1 = cohortBuildPage.findIncludeParticipantsGroup('Group 1');\n+    const modal = await group1.includeEthnicity();\n+    await modal.addEthnicity([Ethnicity.HispanicOrLatino, Ethnicity.NotHispanicOrLatino]);\n+    await modal.clickFinishButton();\n+\n+    // Check Group 1 Count.\n+    const group1Count = await group1.getGroupCount();\n+    const group1CountInt = Number(group1Count.replace(/,/g, ''));\n+    expect(group1CountInt).toBeGreaterThan(1);\n+    console.log('Include Participants Group 1: ' + group1CountInt);\n+\n+    // Save new Cohort.\n+    const newCohortName = await cohortBuildPage.saveCohortAs();\n+    await waitForText(page, 'Cohort Saved Successfully');\n+    console.log(`Created Cohort \"${newCohortName}\"`);\n+\n+    const cohortActionsPage = new CohortActionsPage(page);\n+    await cohortActionsPage.clickCreateDatasetButton();\n+\n+    await datasetBuildPage.selectCohorts([newCohortName]);\n+    await datasetBuildPage.selectConceptSets(['Demographics']);\n+    await datasetBuildPage.clickSaveAndAnalyzeButton();\n+\n+    const newNotebookName = makeRandomName();\n+    const saveModal = new DatasetSaveModal(page);\n+    const newDatasetName = await saveModal.saveDataset({isExportToNotebook: true, notebookName: newNotebookName, language: Language.R});", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NzY5NQ=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA5MDIyNA==", "bodyText": "corrected.", "url": "https://github.com/all-of-us/workbench/pull/3689#discussion_r443090224", "createdAt": "2020-06-20T01:35:19Z", "author": {"login": "aweng98"}, "path": "e2e/tests/datasets/export-to-notebook.spec.ts", "diffHunk": "@@ -77,8 +79,96 @@ describe('Create Dataset', () => {\n \n     // Delete Dataset.\n     await dataPage.openTab(TabLabelAlias.Data);\n-    await dataPage.openTab(TabLabelAlias.Datasets);\n+    await waitWhileLoading(page);\n+\n+    await dataPage.openTab(TabLabelAlias.Datasets, {waitPageChange: false});\n+    await waitWhileLoading(page);\n+\n     await dataPage.deleteDataset(newDatasetName);\n+  });\n+\n+  /**\n+   * Create new Cohort thru Dataset Build page. Cohort built from demographics -> Ethnicity.\n+   * Create new Dataset with Cohort, then export to notebook in R language.\n+   * Delete Cohort, Dataset, and Notebook.\n+   */\n+  test('Export dataset to notebook in R programming language', async () => {\n+    const workspaceCard = await findWorkspace(page);\n+    const workspaceName = await workspaceCard.clickWorkspaceName();\n+\n+    // Click Add Datasets button\n+    const dataPage = new DataPage(page);\n+    const datasetBuildPage = await dataPage.clickAddDatasetButton();\n+    const cohortBuildPage = await datasetBuildPage.clickAddCohortsButton();\n+\n+    // Include Participants Group 1: Add Criteria: Ethnicity\n+    const group1 = cohortBuildPage.findIncludeParticipantsGroup('Group 1');\n+    const modal = await group1.includeEthnicity();\n+    await modal.addEthnicity([Ethnicity.HispanicOrLatino, Ethnicity.NotHispanicOrLatino]);\n+    await modal.clickFinishButton();\n+\n+    // Check Group 1 Count.\n+    const group1Count = await group1.getGroupCount();\n+    const group1CountInt = Number(group1Count.replace(/,/g, ''));\n+    expect(group1CountInt).toBeGreaterThan(1);\n+    console.log('Include Participants Group 1: ' + group1CountInt);\n+\n+    // Save new Cohort.\n+    const newCohortName = await cohortBuildPage.saveCohortAs();\n+    await waitForText(page, 'Cohort Saved Successfully');\n+    console.log(`Created Cohort \"${newCohortName}\"`);\n+\n+    const cohortActionsPage = new CohortActionsPage(page);\n+    await cohortActionsPage.clickCreateDatasetButton();\n+\n+    await datasetBuildPage.selectCohorts([newCohortName]);\n+    await datasetBuildPage.selectConceptSets(['Demographics']);\n+    await datasetBuildPage.clickSaveAndAnalyzeButton();\n+\n+    const newNotebookName = makeRandomName();\n+    const saveModal = new DatasetSaveModal(page);\n+    const newDatasetName = await saveModal.saveDataset({isExportToNotebook: true, notebookName: newNotebookName, language: Language.R});\n+    await waitWhileLoading(page);\n+\n+    // Verify Notebook preview. Not going to start the Jupyter notebook.\n+    const notebookPreviewPage = new NotebookPreviewPage(page);\n+    await notebookPreviewPage.waitForLoad();\n+    const currentPageUrl = await page.url();\n+    expect(currentPageUrl).toContain(`notebooks/preview/${newNotebookName}.ipynb`);\n+\n+    const code = await notebookPreviewPage.getFormattedCode();\n+    expect(code).toContain('library(bigrquery)');\n+\n+    // Navigate to Workpace Data page.\n+    const notebooksLink = await Link.findByName(page, {name: workspaceName});\n+    await notebooksLink.clickAndWait();\n+    await dataPage.waitForLoad();\n+\n+    // Delete test data sequence is: Delete Notebook, then Dataset, finally Cohort.\n+    // Delete Notebook\n+    await dataPage.openTab(TabLabelAlias.Analysis);\n+    await waitWhileLoading(page);\n+\n+    const analysiPage = new AnalysisPage(page);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NzIzOA=="}, "originalCommit": {"oid": "ab935dc79689daef12c89770dd04b8c1239a9e66"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDY4Njcz", "url": "https://github.com/all-of-us/workbench/pull/3689#pullrequestreview-434468673", "createdAt": "2020-06-21T04:25:30Z", "commit": {"oid": "6dd66685ff9039d05fe8a390671844b09b7bcc0d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4588, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}