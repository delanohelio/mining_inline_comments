{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MDcyMTI1", "number": 3179, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzozNTozNFrODiakQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzo0ODoxMlrODia0FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDEzNDQxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzozNTozNFrOFtpghg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODoxMDoxM1rOFtqkRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxMDMxMA==", "bodyText": "nit: while you're here, I'd fix the CamelCase in the method name: should be updateDbRdrExport (per Google's guidelines which I always link to, https://google.github.io/styleguide/javaguide.html#s5.3-camel-case)", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383410310", "createdAt": "2020-02-24T17:35:34Z", "author": {"login": "gjuggler"}, "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -409,7 +405,7 @@ RdrWorkspaceDemographic toRdrWorkspaceDemographics(\n    * @param entity\n    * @param idList\n    */\n-  private void updateDBRdrExport(RdrEntity entity, List<Long> idList) {\n+  public void updateDBRdrExport(RdrEntity entity, List<Long> idList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyNzY1NA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383427654", "createdAt": "2020-02-24T18:10:13Z", "author": {"login": "als364"}, "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -409,7 +405,7 @@ RdrWorkspaceDemographic toRdrWorkspaceDemographics(\n    * @param entity\n    * @param idList\n    */\n-  private void updateDBRdrExport(RdrEntity entity, List<Long> idList) {\n+  public void updateDBRdrExport(RdrEntity entity, List<Long> idList) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxMDMxMA=="}, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDEzNTc0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzozNTo1NVrOFtphSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODoxMDoyMlrOFtqkig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxMDUwNw==", "bodyText": "Is this worth a @VisibleForTesting annotation?", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383410507", "createdAt": "2020-02-24T17:35:55Z", "author": {"login": "gjuggler"}, "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -409,7 +405,7 @@ RdrWorkspaceDemographic toRdrWorkspaceDemographics(\n    * @param entity\n    * @param idList\n    */\n-  private void updateDBRdrExport(RdrEntity entity, List<Long> idList) {\n+  public void updateDBRdrExport(RdrEntity entity, List<Long> idList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyNzcyMg==", "bodyText": "completely forgot about this annotation. thank you!", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383427722", "createdAt": "2020-02-24T18:10:22Z", "author": {"login": "als364"}, "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -409,7 +405,7 @@ RdrWorkspaceDemographic toRdrWorkspaceDemographics(\n    * @param entity\n    * @param idList\n    */\n-  private void updateDBRdrExport(RdrEntity entity, List<Long> idList) {\n+  public void updateDBRdrExport(RdrEntity entity, List<Long> idList) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxMDUwNw=="}, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDE0MTY5OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzozNzo0NVrOFtplBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODoxNDoxN1rOFtqr9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxMTQ2Mw==", "bodyText": "Some of these (RdrApi, RdrExportDao, and UserDao) should be unnecessary since you use the inline @MockBean annotation above (which I tend to prefer, as it directly associates it with an instance variable if needed). In fact, I tend to use only the inline version, even for mock beans that aren't directly used in the test (since it avoids creating a situation where some mockbeans are defined in one place, and some in the other place).\nI'd be happy to hear reasons for preferring a different approach, though... I'm definitely still honing my Spring test aesthetic.", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383411463", "createdAt": "2020-02-24T17:37:45Z", "author": {"login": "gjuggler"}, "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package org.pmiops.workbench.rdr;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyList;\n+import static org.mockito.ArgumentMatchers.anyListOf;\n+import static org.mockito.ArgumentMatchers.anyLong;\n+import static org.mockito.ArgumentMatchers.anyShort;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.sql.Timestamp;\n+import java.time.Clock;\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.pmiops.workbench.db.dao.RdrExportDao;\n+import org.pmiops.workbench.db.dao.UserDao;\n+import org.pmiops.workbench.db.dao.WorkspaceDao;\n+import org.pmiops.workbench.db.model.DbUser;\n+import org.pmiops.workbench.model.Degree;\n+import org.pmiops.workbench.rdr.api.RdrApi;\n+import org.pmiops.workbench.test.FakeClock;\n+import org.pmiops.workbench.workspaces.WorkspaceService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.TestConfiguration;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Import;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+@RunWith(SpringRunner.class)\n+public class RdrExportServiceImplTest {\n+  @Autowired private RdrExportService rdrExportService;\n+\n+  @MockBean private ApiClient mockApiClient;\n+  @MockBean private RdrApi mockRdrApi;\n+  @MockBean private RdrExportDao rdrExportDao;\n+  @MockBean private UserDao mockUserDao;\n+\n+  private static final Instant NOW = Instant.now();\n+  private static final Timestamp NOW_TIMESTAMP = Timestamp.from(NOW);\n+  private static final FakeClock CLOCK = new FakeClock(NOW, ZoneId.systemDefault());\n+\n+  private DbUser dbUserWithEmail;\n+  private DbUser dbUserWithoutEmail;\n+\n+  @TestConfiguration\n+  @Import({RdrExportServiceImpl.class})\n+  @MockBean({\n+      RdrApi.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyOTYyMg==", "bodyText": "No reason - still don't have a good sense of how to make tests work in Spring. I'll remove from this declaration the beans I have a handle for - if I pull all of them out someone will delete them for being unused and then wonder why the test doesn't work...", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383429622", "createdAt": "2020-02-24T18:14:17Z", "author": {"login": "als364"}, "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package org.pmiops.workbench.rdr;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyList;\n+import static org.mockito.ArgumentMatchers.anyListOf;\n+import static org.mockito.ArgumentMatchers.anyLong;\n+import static org.mockito.ArgumentMatchers.anyShort;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.sql.Timestamp;\n+import java.time.Clock;\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.pmiops.workbench.db.dao.RdrExportDao;\n+import org.pmiops.workbench.db.dao.UserDao;\n+import org.pmiops.workbench.db.dao.WorkspaceDao;\n+import org.pmiops.workbench.db.model.DbUser;\n+import org.pmiops.workbench.model.Degree;\n+import org.pmiops.workbench.rdr.api.RdrApi;\n+import org.pmiops.workbench.test.FakeClock;\n+import org.pmiops.workbench.workspaces.WorkspaceService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.TestConfiguration;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Import;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+@RunWith(SpringRunner.class)\n+public class RdrExportServiceImplTest {\n+  @Autowired private RdrExportService rdrExportService;\n+\n+  @MockBean private ApiClient mockApiClient;\n+  @MockBean private RdrApi mockRdrApi;\n+  @MockBean private RdrExportDao rdrExportDao;\n+  @MockBean private UserDao mockUserDao;\n+\n+  private static final Instant NOW = Instant.now();\n+  private static final Timestamp NOW_TIMESTAMP = Timestamp.from(NOW);\n+  private static final FakeClock CLOCK = new FakeClock(NOW, ZoneId.systemDefault());\n+\n+  private DbUser dbUserWithEmail;\n+  private DbUser dbUserWithoutEmail;\n+\n+  @TestConfiguration\n+  @Import({RdrExportServiceImpl.class})\n+  @MockBean({\n+      RdrApi.class,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxMTQ2Mw=="}, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDE3NDkzOnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzo0ODoxMlrOFtp5zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzo0ODoxMlrOFtp5zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQxNjc4MA==", "bodyText": "Thanks for adding a test case! I know this was a TODO that @NehaBroad had been tracking, I'm sure we can add to it over time, but usually the biggest hurdle is just creating a test file with some basic assertions :)", "url": "https://github.com/all-of-us/workbench/pull/3179#discussion_r383416780", "createdAt": "2020-02-24T17:48:12Z", "author": {"login": "gjuggler"}, "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package org.pmiops.workbench.rdr;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyList;\n+import static org.mockito.ArgumentMatchers.anyListOf;\n+import static org.mockito.ArgumentMatchers.anyLong;\n+import static org.mockito.ArgumentMatchers.anyShort;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.sql.Timestamp;\n+import java.time.Clock;\n+import java.time.Instant;\n+import java.time.ZoneId;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.pmiops.workbench.db.dao.RdrExportDao;\n+import org.pmiops.workbench.db.dao.UserDao;\n+import org.pmiops.workbench.db.dao.WorkspaceDao;\n+import org.pmiops.workbench.db.model.DbUser;\n+import org.pmiops.workbench.model.Degree;\n+import org.pmiops.workbench.rdr.api.RdrApi;\n+import org.pmiops.workbench.test.FakeClock;\n+import org.pmiops.workbench.workspaces.WorkspaceService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.TestConfiguration;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Import;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+@RunWith(SpringRunner.class)\n+public class RdrExportServiceImplTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce7b47d91f96f7f42622ab855b67f330557225b1"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3400, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}