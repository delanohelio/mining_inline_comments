{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNDg2Mjc5", "number": 3288, "title": "[RW-4634][]risk=no]Add custom Chrome startUp flags", "bodyText": "Extending Puppeteer default Chrome startUp flags (switches) with CircleCi relevant flags to improve test stability and performance.", "createdAt": "2020-03-23T16:18:21Z", "url": "https://github.com/all-of-us/workbench/pull/3288", "merged": true, "mergeCommit": {"oid": "27c5c7d534211d075fead04734a8125d59a08027"}, "closed": true, "closedAt": "2020-03-23T18:58:17Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQgsT_AH2gAyMzkyNDg2Mjc5OmZhNGE4ZDg5MDAzZjQ4YmFkMjNjM2I2MzljY2U2MzdhNTFhOWM5NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQjCUkgFqTM3OTcyNTk5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa4a8d89003f48bad23c3b639cce637a51a9c976", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fa4a8d89003f48bad23c3b639cce637a51a9c976", "committedDate": "2020-03-23T16:14:14Z", "message": "Add custom Chrome startUp flags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NTkzMzg2", "url": "https://github.com/all-of-us/workbench/pull/3288#pullrequestreview-379593386", "createdAt": "2020-03-23T16:21:10Z", "commit": {"oid": "fa4a8d89003f48bad23c3b639cce637a51a9c976"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjoyMToxMVrOF6NP-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjoyMToxMVrOF6NP-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3ODgwOA==", "bodyText": "--runInBand is same as -maxWorkers=1: Ensure tests are run in serial order in one thread in CircleCi.", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396578808", "createdAt": "2020-03-23T16:21:11Z", "author": {"login": "aweng98"}, "path": "e2e/package.json", "diffHunk": "@@ -7,9 +7,9 @@\n   \"license\": \"BSD\",\n   \"scripts\": {\n     \"test\": \"WORKBENCH_ENV=dev jest --detectOpenHandles\",\n-    \"test:debug\": \"WORKBENCH_ENV=dev PUPPETEER_HEADLESS=false jest --detectOpenHandles --runInBand\",\n+    \"test:debug\": \"WORKBENCH_ENV=dev PUPPETEER_HEADLESS=false jest --detectOpenHandles --maxWorkers=2\",\n     \"test-local\": \"WORKBENCH_ENV=local jest\",\n-    \"test:ci\": \"cross-env NODE_ENV=development WORKBENCH_ENV=dev INCOGNITO=true jest --ci --maxWorkers=2 --forceExit\",\n+    \"test:ci\": \"cross-env NODE_ENV=development WORKBENCH_ENV=dev INCOGNITO=true jest --ci --runInBand --forceExit\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa4a8d89003f48bad23c3b639cce637a51a9c976"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NTk0ODUx", "url": "https://github.com/all-of-us/workbench/pull/3288#pullrequestreview-379594851", "createdAt": "2020-03-23T16:22:38Z", "commit": {"oid": "fa4a8d89003f48bad23c3b639cce637a51a9c976"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjoyMjozOFrOF6NUPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjoyMjozOFrOF6NUPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3OTkwMQ==", "bodyText": "Puppeteer click() is not working sometimes for this button. Changing to call to Document.click() function.", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396579901", "createdAt": "2020-03-23T16:22:38Z", "author": {"login": "aweng98"}, "path": "e2e/tests/user/registration.spec.ts", "diffHunk": "@@ -61,7 +61,7 @@ describe('User registration tests:', () => {\n     await createAccountPage.fillOutInstitution();\n     nextButton = await createAccountPage.getNextButton();\n     await nextButton.waitUntilEnabled();\n-    await nextButton.click();\n+    await nextButton.clickWithEval();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa4a8d89003f48bad23c3b639cce637a51a9c976"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "941c8c746195f655c85fdb0adde27b301dd49605", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/941c8c746195f655c85fdb0adde27b301dd49605", "committedDate": "2020-03-23T18:02:00Z", "message": "adding cross-env"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzIyNDQx", "url": "https://github.com/all-of-us/workbench/pull/3288#pullrequestreview-379722441", "createdAt": "2020-03-23T18:47:53Z", "commit": {"oid": "941c8c746195f655c85fdb0adde27b301dd49605"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0Nzo1M1rOF6TaUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0Nzo1M1rOF6TaUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3OTc2Mw==", "bodyText": "I don't see code that's handling this argument, ignoreDefaultArgs. How is it able to continue working if the type was changed form a string array to a boolean?", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396679763", "createdAt": "2020-03-23T18:47:53Z", "author": {"login": "ericsong"}, "path": "e2e/driver/puppeteer-launch.ts", "diffHunk": "@@ -1,22 +1,15 @@\n import * as puppeteer from 'puppeteer';\n+import {getChromeFlags} from './chrome-startup-flags';\n+\n+const isHeadless = !process.env.PUPPETEER_HEADLESS;\n \n const defaultLaunchOpts = {\n-  headless: !process.env.PUPPETEER_HEADLESS,\n+  headless: isHeadless,\n   slowMo: 10,\n   defaultViewport: null,\n   devtools: false,\n-  ignoreDefaultArgs: ['--disable-extensions'],\n-  args: [\n-    '--no-sandbox',\n-    '--disable-setuid-sandbox',\n-    '--disable-dev-shm-usage',\n-    '--disable-gpu',\n-    '--disable-background-timer-throttling',\n-    '--disable-backgrounding-occluded-windows',\n-    '--disable-renderer-backgrounding',\n-    '--disable-web-security',\n-    '--disable-features=IsolateOrigins,site-per-process',\n-  ]\n+  ignoreDefaultArgs: true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "941c8c746195f655c85fdb0adde27b301dd49605"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzI1OTk2", "url": "https://github.com/all-of-us/workbench/pull/3288#pullrequestreview-379725996", "createdAt": "2020-03-23T18:52:46Z", "commit": {"oid": "941c8c746195f655c85fdb0adde27b301dd49605"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1Mjo0NlrOF6TlVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1Mjo0NlrOF6TlVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MjU4MQ==", "bodyText": "Because ignoreDefaultArgs takes param either is boolean or Array<string>.\nignoreDefaultArgs <boolean|Array<string>> If true, then do not use puppeteer.defaultArgs(). If an array is given, then filter out the given default arguments. Dangerous option; use with care. Defaults to false.", "url": "https://github.com/all-of-us/workbench/pull/3288#discussion_r396682581", "createdAt": "2020-03-23T18:52:46Z", "author": {"login": "aweng98"}, "path": "e2e/driver/puppeteer-launch.ts", "diffHunk": "@@ -1,22 +1,15 @@\n import * as puppeteer from 'puppeteer';\n+import {getChromeFlags} from './chrome-startup-flags';\n+\n+const isHeadless = !process.env.PUPPETEER_HEADLESS;\n \n const defaultLaunchOpts = {\n-  headless: !process.env.PUPPETEER_HEADLESS,\n+  headless: isHeadless,\n   slowMo: 10,\n   defaultViewport: null,\n   devtools: false,\n-  ignoreDefaultArgs: ['--disable-extensions'],\n-  args: [\n-    '--no-sandbox',\n-    '--disable-setuid-sandbox',\n-    '--disable-dev-shm-usage',\n-    '--disable-gpu',\n-    '--disable-background-timer-throttling',\n-    '--disable-backgrounding-occluded-windows',\n-    '--disable-renderer-backgrounding',\n-    '--disable-web-security',\n-    '--disable-features=IsolateOrigins,site-per-process',\n-  ]\n+  ignoreDefaultArgs: true,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3OTc2Mw=="}, "originalCommit": {"oid": "941c8c746195f655c85fdb0adde27b301dd49605"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3275, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}