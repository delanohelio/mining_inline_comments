{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MzQ0OTc0", "number": 3218, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo0Njo0MVrODleZjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODoyNzozOFrODliK_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjIxOTY1OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo0Njo0MVrOFyY20A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDoxMzo1OVrOFy6ERw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4MDM2OA==", "bodyText": "With this name this variable sounds like it's a boolean. Would it be more accurate to call it something like updateGroupListsCount?", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388380368", "createdAt": "2020-03-05T15:46:41Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.ts", "diffHunk": "@@ -25,12 +25,13 @@ export class CohortSearchComponent implements OnInit, OnDestroy {\n   error = false;\n   overview = false;\n   criteria = {includes: [], excludes: []};\n-  updateCriteria = {update: 0, recalculate: true};\n+  updateCount = 0;\n   cohort: any;\n   resolve: Function;\n   modalPromise: Promise<boolean> | null = null;\n   modalOpen = false;\n   saving = false;\n+  updateGroupLists = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyNDQ4Nw==", "bodyText": "Agreed, adding count on the end makes more sense.", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388924487", "createdAt": "2020-03-06T14:13:59Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.ts", "diffHunk": "@@ -25,12 +25,13 @@ export class CohortSearchComponent implements OnInit, OnDestroy {\n   error = false;\n   overview = false;\n   criteria = {includes: [], excludes: []};\n-  updateCriteria = {update: 0, recalculate: true};\n+  updateCount = 0;\n   cohort: any;\n   resolve: Function;\n   modalPromise: Promise<boolean> | null = null;\n   modalOpen = false;\n   saving = false;\n+  updateGroupLists = 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4MDM2OA=="}, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjMzNzA5OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/overview/overview.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoxMjo1OVrOFyaAew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDoyMzowN1rOFy6Y8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5OTIyNw==", "bodyText": "annoying that codegen strips the underscores out of this. SHOUTY_SNAKE_CASE much easier to read than regular SHOUTYCASE.", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388399227", "createdAt": "2020-03-05T16:12:59Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/overview/overview.component.tsx", "diffHunk": "@@ -200,17 +203,15 @@ export const ListOverview = withCurrentWorkspace()(\n \n     get hasTemporalError() {\n       const {searchRequest} = this.props;\n-      const activeGroups = searchRequest.includes\n-        .filter(grp => grp.temporal && grp.status === 'active');\n+      const activeGroups = searchRequest.includes.filter(grp => grp.temporal && grp.status === 'active');\n       return activeGroups.some(grp => {\n         const activeItems = grp.items.reduce((acc, it) => {\n           if (it.status === 'active') {\n             acc[it.temporalGroup]++;\n           }\n           return acc;\n         }, [0, 0]);\n-        const inputError = grp.time !== TemporalTime.DURINGSAMEENCOUNTERAS &&\n-          (grp.timeValue === null || grp.timeValue < 0);\n+        const inputError = grp.time !== TemporalTime.DURINGSAMEENCOUNTERAS && (isNaN(parseInt(grp.timeValue, 10)) || grp.timeValue < 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyOTc3Nw==", "bodyText": "Yes, definitely agree on this", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388929777", "createdAt": "2020-03-06T14:23:07Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/overview/overview.component.tsx", "diffHunk": "@@ -200,17 +203,15 @@ export const ListOverview = withCurrentWorkspace()(\n \n     get hasTemporalError() {\n       const {searchRequest} = this.props;\n-      const activeGroups = searchRequest.includes\n-        .filter(grp => grp.temporal && grp.status === 'active');\n+      const activeGroups = searchRequest.includes.filter(grp => grp.temporal && grp.status === 'active');\n       return activeGroups.some(grp => {\n         const activeItems = grp.items.reduce((acc, it) => {\n           if (it.status === 'active') {\n             acc[it.temporalGroup]++;\n           }\n           return acc;\n         }, [0, 0]);\n-        const inputError = grp.time !== TemporalTime.DURINGSAMEENCOUNTERAS &&\n-          (grp.timeValue === null || grp.timeValue < 0);\n+        const inputError = grp.time !== TemporalTime.DURINGSAMEENCOUNTERAS && (isNaN(parseInt(grp.timeValue, 10)) || grp.timeValue < 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5OTIyNw=="}, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjM5OTQ2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/search-group-item/search-group-item.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoyODoyN1rOFyaoGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDo0MTo0MFrOFy7CbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwOTM3MQ==", "bodyText": "any makes it hard to tell what's actually in there - are the contents of item so varied that a nested definition couldn't be done here? like\nitem: {\n    count:  number\n    modifiers: whatever modifiers is\n}", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388409371", "createdAt": "2020-03-05T16:28:27Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/search-group-item/search-group-item.component.tsx", "diffHunk": "@@ -122,22 +121,20 @@ class SearchGroupItemParameter extends React.Component<{parameter: any}, {toolti\n }\n \n interface Props {\n-  role: keyof SearchRequest;\n   groupId: string;\n   item: any;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk0MDM5Nw==", "bodyText": "There is a swagger generated interface for this, but I originally used any because I needed a couple extra properties. Fixed by creating a new interface ItemProp that extends Item", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388940397", "createdAt": "2020-03-06T14:41:40Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/search-group-item/search-group-item.component.tsx", "diffHunk": "@@ -122,22 +121,20 @@ class SearchGroupItemParameter extends React.Component<{parameter: any}, {toolti\n }\n \n interface Props {\n-  role: keyof SearchRequest;\n   groupId: string;\n   item: any;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwOTM3MQ=="}, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjgzNzcyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/search-group/search-group.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODoyNzozOFrOFye6TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDo1OTowNVrOFy7syw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3OTU2NA==", "bodyText": "I wish this wasn't necessary. I guess you can't set it directly on a <React.Fragment> because it's not in the DOM, and you can't set it on the parent for some reason?", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388479564", "createdAt": "2020-03-05T18:27:38Z", "author": {"login": "als364"}, "path": "ui/src/app/cohort-search/search-group/search-group.component.tsx", "diffHunk": "@@ -0,0 +1,606 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {SearchGroupItem} from 'app/cohort-search/search-group-item/search-group-item.component';\n+import {criteriaMenuOptionsStore, searchRequestStore, wizardStore} from 'app/cohort-search/search-state.service';\n+import {domainToTitle, generateId, mapGroup, typeToTitle} from 'app/cohort-search/utils';\n+import {Clickable} from 'app/components/buttons';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {isAbortError} from 'app/utils/errors';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {DomainType, SearchRequest, TemporalMention, TemporalTime} from 'generated/fetch';\n+import {InputSwitch} from 'primereact/inputswitch';\n+import {Menu} from 'primereact/menu';\n+import {TieredMenu} from 'primereact/tieredmenu';\n+\n+const styles = reactStyles({\n+  card: {\n+    background: colors.white,\n+    borderColor: 'rgba(215, 215, 215, 0.5)',\n+    borderRadius: '0.2rem',\n+    boxShadow: `0 0.125rem 0.125rem 0 ${colorWithWhiteness(colors.black, 0.85)}`,\n+    margin: '0 0 0.6rem'\n+  },\n+  cardBlock: {\n+    borderBottom: `1px solid ${colors.light}`,\n+    padding: '0.5rem 0.75rem'\n+  },\n+  cardHeader: {\n+    backgroundColor: colorWithWhiteness(colors.light, -0.3),\n+    color: colors.primary,\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    minWidth: '100%',\n+    padding: '0.5rem 0.75rem'\n+  },\n+  overlay: {\n+    background: colors.white,\n+    display: 'table',\n+    opacity: 0.9,\n+    position: 'relative',\n+    textAlign: 'center',\n+    verticalAlign: 'middle',\n+  },\n+  overlayInner: {\n+    color: colors.warning,\n+    display: 'table-cell',\n+    fontSize: '18px',\n+    verticalAlign: 'middle',\n+  },\n+  overlayButton: {\n+    background: 'transparent',\n+    border: 0,\n+    color: colors.accent,\n+    cursor: 'pointer',\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    letterSpacing: 0,\n+    margin: '0.25rem 0',\n+  },\n+  itemOr: {\n+    background: colors.white,\n+    color: colorWithWhiteness(colors.black, 0.75),\n+    float: 'right',\n+    marginRight: '46%',\n+    padding: '0 10px'\n+  },\n+  menu: {\n+    maxWidth: '15rem',\n+    minWidth: '5rem',\n+    width: 'auto'\n+  },\n+  searchItem: {\n+    borderBottom: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    margin: '0 0.5rem',\n+    padding: '0.5rem 0.25rem'\n+  },\n+  menuButton: {\n+    border: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    borderRadius: '0.125rem',\n+    color: colorWithWhiteness(colors.black, 0.45),\n+    fontSize: '12px',\n+    fontWeight: 100,\n+    height: '1.5rem',\n+    letterSpacing: '1px',\n+    lineHeight: '1.5rem',\n+    padding: '0 0.5rem',\n+    textTransform: 'uppercase',\n+    verticalAlign: 'middle'\n+  },\n+  row: {\n+    display: 'flex',\n+    flexWrap: 'wrap',\n+    marginLeft: '-0.5rem',\n+    marginRight: '-0.5rem',\n+  },\n+  col6: {\n+    flex: '0 0 50%',\n+    maxWidth: '50%',\n+    padding: '0 0.5rem',\n+  },\n+  timeInput: {\n+    border: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    borderRadius: '0.1rem',\n+    height: '1.4rem',\n+    marginLeft: '1rem',\n+    width: '2.5rem'\n+  },\n+  inputError: {\n+    background: colorWithWhiteness(colors.danger, 0.85),\n+    border: `1px solid ${colorWithWhiteness(colors.danger, 0.6)}`,\n+    borderRadius: '3px',\n+    color: colorWithWhiteness(colors.dark, .1),\n+    fontSize: '11px',\n+    lineHeight: '16px',\n+    marginBottom: '0.25rem',\n+    padding: '5px 3px'\n+  }\n+});\n+\n+const css = `", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk1MTI0Mw==", "bodyText": "These are custom styles we need to put on elements that we can't access directly since they're generated by PrimeReact components, Menu and InputSwitch in this case. I don't like it either, but It's the only way I know of to do it.", "url": "https://github.com/all-of-us/workbench/pull/3218#discussion_r388951243", "createdAt": "2020-03-06T14:59:05Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/search-group/search-group.component.tsx", "diffHunk": "@@ -0,0 +1,606 @@\n+import {Component, Input} from '@angular/core';\n+import * as React from 'react';\n+\n+import {SearchGroupItem} from 'app/cohort-search/search-group-item/search-group-item.component';\n+import {criteriaMenuOptionsStore, searchRequestStore, wizardStore} from 'app/cohort-search/search-state.service';\n+import {domainToTitle, generateId, mapGroup, typeToTitle} from 'app/cohort-search/utils';\n+import {Clickable} from 'app/components/buttons';\n+import {ClrIcon} from 'app/components/icons';\n+import {TooltipTrigger} from 'app/components/popups';\n+import {Spinner} from 'app/components/spinners';\n+import {cohortBuilderApi} from 'app/services/swagger-fetch-clients';\n+import colors, {colorWithWhiteness} from 'app/styles/colors';\n+import {reactStyles, ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {triggerEvent} from 'app/utils/analytics';\n+import {isAbortError} from 'app/utils/errors';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {DomainType, SearchRequest, TemporalMention, TemporalTime} from 'generated/fetch';\n+import {InputSwitch} from 'primereact/inputswitch';\n+import {Menu} from 'primereact/menu';\n+import {TieredMenu} from 'primereact/tieredmenu';\n+\n+const styles = reactStyles({\n+  card: {\n+    background: colors.white,\n+    borderColor: 'rgba(215, 215, 215, 0.5)',\n+    borderRadius: '0.2rem',\n+    boxShadow: `0 0.125rem 0.125rem 0 ${colorWithWhiteness(colors.black, 0.85)}`,\n+    margin: '0 0 0.6rem'\n+  },\n+  cardBlock: {\n+    borderBottom: `1px solid ${colors.light}`,\n+    padding: '0.5rem 0.75rem'\n+  },\n+  cardHeader: {\n+    backgroundColor: colorWithWhiteness(colors.light, -0.3),\n+    color: colors.primary,\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    minWidth: '100%',\n+    padding: '0.5rem 0.75rem'\n+  },\n+  overlay: {\n+    background: colors.white,\n+    display: 'table',\n+    opacity: 0.9,\n+    position: 'relative',\n+    textAlign: 'center',\n+    verticalAlign: 'middle',\n+  },\n+  overlayInner: {\n+    color: colors.warning,\n+    display: 'table-cell',\n+    fontSize: '18px',\n+    verticalAlign: 'middle',\n+  },\n+  overlayButton: {\n+    background: 'transparent',\n+    border: 0,\n+    color: colors.accent,\n+    cursor: 'pointer',\n+    fontSize: '14px',\n+    fontWeight: 600,\n+    letterSpacing: 0,\n+    margin: '0.25rem 0',\n+  },\n+  itemOr: {\n+    background: colors.white,\n+    color: colorWithWhiteness(colors.black, 0.75),\n+    float: 'right',\n+    marginRight: '46%',\n+    padding: '0 10px'\n+  },\n+  menu: {\n+    maxWidth: '15rem',\n+    minWidth: '5rem',\n+    width: 'auto'\n+  },\n+  searchItem: {\n+    borderBottom: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    margin: '0 0.5rem',\n+    padding: '0.5rem 0.25rem'\n+  },\n+  menuButton: {\n+    border: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    borderRadius: '0.125rem',\n+    color: colorWithWhiteness(colors.black, 0.45),\n+    fontSize: '12px',\n+    fontWeight: 100,\n+    height: '1.5rem',\n+    letterSpacing: '1px',\n+    lineHeight: '1.5rem',\n+    padding: '0 0.5rem',\n+    textTransform: 'uppercase',\n+    verticalAlign: 'middle'\n+  },\n+  row: {\n+    display: 'flex',\n+    flexWrap: 'wrap',\n+    marginLeft: '-0.5rem',\n+    marginRight: '-0.5rem',\n+  },\n+  col6: {\n+    flex: '0 0 50%',\n+    maxWidth: '50%',\n+    padding: '0 0.5rem',\n+  },\n+  timeInput: {\n+    border: `1px solid ${colorWithWhiteness(colors.black, 0.75)}`,\n+    borderRadius: '0.1rem',\n+    height: '1.4rem',\n+    marginLeft: '1rem',\n+    width: '2.5rem'\n+  },\n+  inputError: {\n+    background: colorWithWhiteness(colors.danger, 0.85),\n+    border: `1px solid ${colorWithWhiteness(colors.danger, 0.6)}`,\n+    borderRadius: '3px',\n+    color: colorWithWhiteness(colors.dark, .1),\n+    fontSize: '11px',\n+    lineHeight: '16px',\n+    marginBottom: '0.25rem',\n+    padding: '5px 3px'\n+  }\n+});\n+\n+const css = `", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3OTU2NA=="}, "originalCommit": {"oid": "979167c90d1772ae279b0f87ed4a87d7e7c04fbc"}, "originalPosition": 126}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3200, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}