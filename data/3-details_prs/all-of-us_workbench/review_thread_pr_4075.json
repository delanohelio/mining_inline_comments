{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MjI3MTYz", "number": 4075, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzowMzoyMlrOEoVSTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNzoyNVrOEoXW7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNzI3MjQ1OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzowMzoyMlrOHZW1dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNDo1OToyMlrOHZZ9Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MDU4Mw==", "bodyText": "nit: can you move the prop out. It will be easier to read", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496350583", "createdAt": "2020-09-29T03:03:22Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMTcwNw==", "bodyText": "Done.", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496401707", "createdAt": "2020-09-29T04:59:22Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1MDU4Mw=="}, "originalCommit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNzI5NTgyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMzoxNzo1NlrOHZXDYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNDo1OToyOVrOHZZ9iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1NDE0NQ==", "bodyText": "nit: can we re-write style condition as disableCalculate ? {....styles.calculateButton, borderColor: colorWithWhiteness(colors.dark, 0.6)} : styles.calculatebutton", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496354145", "createdAt": "2020-09-29T03:17:56Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {\n+  return <div style={{background: colorWithWhiteness(colors.primary, .87), bottom: 0, position: 'sticky'}}>\n+    <FlexRowWrap style={styles.countPreview}>\n+      <div style={styles.resultsContainer}>\n+        <Button id='attributes-calculate'\n+          type='secondaryLight'\n+          disabled={disableCalculate}\n+          style={{...styles.calculateButton, ...(disableCalculate ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMTgwMA==", "bodyText": "Done.", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496401800", "createdAt": "2020-09-29T04:59:29Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/attributes-page-v2/attributes-page-v2.component.tsx", "diffHunk": "@@ -126,23 +126,38 @@ const styles = reactStyles({\n   },\n });\n \n-export const CalculateFooter = (props) => {\n-  return <FlexRowWrap style={styles.countPreview}>\n-     <div style={styles.resultsContainer}>\n-     <Button id='attributes-calculate'\n-       type='secondaryLight'\n-    disabled={props.disabled}\n-    style={{...styles.calculateButton, ...(props.disabled ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}\n-    onClick={() => props.calculate()}>\n-    {props.calculating && <Spinner size={16} style={styles.spinner}/>} Calculate\n-    </Button>\n-    </div>\n-    <div style={styles.resultsContainer}>\n-      <div style={{fontWeight: 600}}>Number of Participants:\n-        <span> {props.count === null ? '--' : props.count.toLocaleString()} </span>\n+export const CalculateFooter = ({addButtonText, addFn, backFn, calculateFn, calculating, count, disableAdd, disableCalculate}) => {\n+  return <div style={{background: colorWithWhiteness(colors.primary, .87), bottom: 0, position: 'sticky'}}>\n+    <FlexRowWrap style={styles.countPreview}>\n+      <div style={styles.resultsContainer}>\n+        <Button id='attributes-calculate'\n+          type='secondaryLight'\n+          disabled={disableCalculate}\n+          style={{...styles.calculateButton, ...(disableCalculate ? {borderColor: colorWithWhiteness(colors.dark, 0.6)} : {})}}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM1NDE0NQ=="}, "originalCommit": {"oid": "c4882f48af3a80e1dbb022679870ba17f0958a00"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNzYwNTkxOnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNTo0OVrOHZaPBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNTo0OVrOHZaPBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwNjI3OQ==", "bodyText": "Moved this to a separate function since I noticed the calculate function was not using the current values in the form, usually resulting in an empty array getting sent with the request.", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496406279", "createdAt": "2020-09-29T05:05:49Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -349,10 +346,8 @@ export const ModifierPage = fp.flow(withCurrentWorkspace(), withCurrentCohortSea\n       this.setState({count: null, formState}, () => this.validateValues());\n     }\n \n-    updateMods() {\n-      const {cohortContext} = this.props;\n-      const {formState} = this.state;\n-      cohortContext.item.modifiers = formState.reduce((acc, mod) => {\n+    getModifiersFromForm() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e467a412e476c33bf726209ae81456cae80170c"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNzYxMTk2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNzoyNVrOHZaTQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTowNzoyNVrOHZaTQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwNzM2MQ==", "bodyText": "Also update the filter condition here, since 0 values in the number inputs were getting filtered out, resulting in a bad request for the calculate api call.", "url": "https://github.com/all-of-us/workbench/pull/4075#discussion_r496407361", "createdAt": "2020-09-29T05:07:25Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -361,15 +356,20 @@ export const ModifierPage = fp.flow(withCurrentWorkspace(), withCurrentCohortSea\n               break;\n             case ModifierType.EVENTDATE:\n               const formatted = values.map(val => moment(val, 'YYYY-MM-DD', true).isValid()\n-                    ? moment(val).format('YYYY-MM-DD') : undefined);\n+                ? moment(val).format('YYYY-MM-DD') : undefined);\n               acc.push({name, operator, operands: formatted.filter(val => !!val)});\n               break;\n             default:\n-              acc.push({name, operator, operands: values.filter(val => !!val)});\n+              acc.push({name, operator, operands: values.filter(val => !['', null, undefined].includes(val))});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e467a412e476c33bf726209ae81456cae80170c"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3976, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}