{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NzE1MTQ0", "number": 3688, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOToyMjowMFrOEG4cGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMDoyNTo0MVrOEHOpgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NjUxNjEwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOToyMjowMFrOGl8-yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOToyMjowMFrOGl8-yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0OTYxMQ==", "bodyText": "This signature update also helps with billing un-lock-out, which I'm working on", "url": "https://github.com/all-of-us/workbench/pull/3688#discussion_r442449611", "createdAt": "2020-06-18T19:22:00Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -140,11 +140,18 @@ private boolean expiredByCost(final DbUser user, final double currentCost) {\n     return compareCosts(currentCost, getUserFreeTierDollarLimit(user)) > 0;\n   }\n \n-  private void deactivateUserWorkspaces(final DbUser user) {\n-    final Set<DbWorkspace> toDeactivate = workspaceDao.findAllByCreator(user);\n-    for (final DbWorkspace workspace : toDeactivate) {\n-      workspaceDao.updateBillingStatus(workspace.getWorkspaceId(), BillingStatus.INACTIVE);\n-    }\n+  // TODO: move to DbWorkspace?  RW-5107\n+  private boolean isFreeTier(final DbWorkspace workspace) {\n+    return workspace\n+        .getBillingAccountName()\n+        .equals(workbenchConfigProvider.get().billing.freeTierBillingAccountName());\n+  }\n+\n+  private void setActiveStatusForCreatedWorkspaces(final DbUser user, final BillingStatus status) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "151f4961cb53faa6c0ce4421991d2465cb553229"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDE1NDg4OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMDoyNTo0MVrOGmgZxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMDoyNTo0MVrOGmgZxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzAyOTk1Ng==", "bodyText": "I hate to ask for more characters in this verbose method name, but seems like this should probably specify FreeTierWorkspaces", "url": "https://github.com/all-of-us/workbench/pull/3688#discussion_r443029956", "createdAt": "2020-06-19T20:25:41Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -140,11 +140,18 @@ private boolean expiredByCost(final DbUser user, final double currentCost) {\n     return compareCosts(currentCost, getUserFreeTierDollarLimit(user)) > 0;\n   }\n \n-  private void deactivateUserWorkspaces(final DbUser user) {\n-    final Set<DbWorkspace> toDeactivate = workspaceDao.findAllByCreator(user);\n-    for (final DbWorkspace workspace : toDeactivate) {\n-      workspaceDao.updateBillingStatus(workspace.getWorkspaceId(), BillingStatus.INACTIVE);\n-    }\n+  // TODO: move to DbWorkspace?  RW-5107\n+  private boolean isFreeTier(final DbWorkspace workspace) {\n+    return workspace\n+        .getBillingAccountName()\n+        .equals(workbenchConfigProvider.get().billing.freeTierBillingAccountName());\n+  }\n+\n+  private void setActiveStatusForCreatedWorkspaces(final DbUser user, final BillingStatus status) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "151f4961cb53faa6c0ce4421991d2465cb553229"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2540, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}