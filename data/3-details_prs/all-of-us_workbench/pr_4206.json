{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MjIwNjUx", "number": 4206, "title": "[risk=low][RW-5561] Fix for Copy Notebook from Analysis page", "bodyText": "Description:\nFix an oversight from #4064 : I didn't test copying notebooks with CDR differences from the Analysis page.  Copying from Analysis takes a different path from Recent Resources copies, and this didn't include the new cdrVersionId field, so the source CDR was unknown when creating the Copy Modal.\nFixing this was a one-line change: setting cdrVersionId from the associated workspace.  The rest is tightening the type checking around WorkspaceResource and test updates to deal with these changes.\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-10-23T21:15:17Z", "url": "https://github.com/all-of-us/workbench/pull/4206", "merged": true, "mergeCommit": {"oid": "ebc193a5a3b571614726fa27856baf880f8cdb2a"}, "closed": true, "closedAt": "2020-10-26T14:05:04Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVwweRAH2gAyNTA5MjIwNjUxOjliY2RiZThmNmI4YTFlMjJkMzMwMzI1YzFiOGRhZTM0OTUzNmJiYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWUz1KgFqTUxNjgwMzAyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9bcdbe8f6b8a1e22d330325c1b8dae349536bbb4", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9bcdbe8f6b8a1e22d330325c1b8dae349536bbb4", "committedDate": "2020-10-24T19:58:02Z", "message": "fix copy notebook modal cdr display"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0721c43e2c82a5f585d2fb40df16105b1be9cb02", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/0721c43e2c82a5f585d2fb40df16105b1be9cb02", "committedDate": "2020-10-24T19:58:08Z", "message": "Make some WorkspaceResource fields required"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56eada85b79fe60f64fffadb8be395638ff202b5", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/56eada85b79fe60f64fffadb8be395638ff202b5", "committedDate": "2020-10-24T20:25:37Z", "message": "test fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b9a8cadb71d30f02d7a30f91d8c99b5492fde87", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2b9a8cadb71d30f02d7a30f91d8c99b5492fde87", "committedDate": "2020-10-24T00:05:35Z", "message": "revert: don't need this part"}, "afterCommit": {"oid": "56eada85b79fe60f64fffadb8be395638ff202b5", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/56eada85b79fe60f64fffadb8be395638ff202b5", "committedDate": "2020-10-24T20:25:37Z", "message": "test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MzA2MzAx", "url": "https://github.com/all-of-us/workbench/pull/4206#pullrequestreview-516306301", "createdAt": "2020-10-24T20:48:38Z", "commit": {"oid": "56eada85b79fe60f64fffadb8be395638ff202b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQyMDo0ODozOFrOHn0REQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQyMDo0ODozOFrOHn0REQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUxMjg0OQ==", "bodyText": "This line is what corrects the problem - all the rest is stronger typing and signature changes.", "url": "https://github.com/all-of-us/workbench/pull/4206#discussion_r511512849", "createdAt": "2020-10-24T20:48:38Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/utils/resourceActions.ts", "diffHunk": "@@ -32,36 +33,36 @@ export function toDisplay(resourceType: ResourceType): string {\n \n export interface ConvertToResourcesArgs {\n   list:  FileDetail[] | Cohort[] | CohortReview[] | ConceptSet[] | DataSet[];\n-  workspaceNamespace: string;\n-  workspaceId: string;\n-  accessLevel: WorkspaceAccessLevel;\n   resourceType: ResourceType;\n+  workspace: WorkspaceData;\n }\n \n export function convertToResources(args: ConvertToResourcesArgs): WorkspaceResource[] {\n   const resourceList = [];\n   for (const resource of args.list) {\n-    resourceList.push(convertToResource(resource, args.workspaceNamespace, args.workspaceId,\n-      args.accessLevel, args.resourceType));\n+    resourceList.push(convertToResource(resource, args.resourceType, args.workspace));\n   }\n   return resourceList;\n }\n \n-export function convertToResource(resource: FileDetail | Cohort | CohortReview | ConceptSet\n-  | DataSet, workspaceNamespace: string, workspaceId: string,\n-  accessLevel: WorkspaceAccessLevel,\n-  resourceType: ResourceType): WorkspaceResource {\n+export function convertToResource(\n+  resource: FileDetail | Cohort | CohortReview | ConceptSet | DataSet,\n+  resourceType: ResourceType,\n+  workspace: WorkspaceData): WorkspaceResource {\n+  const {namespace, id, accessLevel, cdrVersionId, billingStatus} = workspace;\n   let modifiedTime: string;\n   if (!resource.lastModifiedTime) {\n     modifiedTime = new Date().toDateString();\n   } else {\n     modifiedTime = new Date(resource.lastModifiedTime).toString();\n   }\n   const newResource: WorkspaceResource = {\n-    workspaceNamespace: workspaceNamespace,\n-    workspaceFirecloudName: workspaceId,\n+    workspaceNamespace: namespace,\n+    workspaceFirecloudName: id,\n     permission: WorkspaceAccessLevel[accessLevel],\n-    modifiedTime: modifiedTime\n+    modifiedTime,\n+    cdrVersionId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56eada85b79fe60f64fffadb8be395638ff202b5"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01da75645b3b385f2eb05f6cfa7200a197b0ee77", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/01da75645b3b385f2eb05f6cfa7200a197b0ee77", "committedDate": "2020-10-24T20:58:17Z", "message": "test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2ODAzMDIx", "url": "https://github.com/all-of-us/workbench/pull/4206#pullrequestreview-516803021", "createdAt": "2020-10-26T13:58:18Z", "commit": {"oid": "01da75645b3b385f2eb05f6cfa7200a197b0ee77"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4017, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}