{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjQ2MjI4", "number": 3860, "title": "triallelic randomize", "bodyText": "In this array, we don't look for the ref in triallelic sites, we just no-call if it's not one of the alts. So I'm now handling randomizing at triallelic sites differently than biallelic sites. I'm combining the no-call probability with the homref probability and just writing 1/2 and 2/1 where I'd otherwise write 0/1 or 1/0.", "createdAt": "2020-08-05T21:14:08Z", "url": "https://github.com/all-of-us/workbench/pull/3860", "merged": true, "mergeCommit": {"oid": "1a7d2954f27312f3066088e7f79f63b558c01687"}, "closed": true, "closedAt": "2020-08-05T21:28:57Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8B0fxgH2gAyNDYzNjQ2MjI4OjdkNjQwZDFhM2E2ODA4MWVkZDRjZmMzNDE1OWRmMmYyYzY2MmY4ZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8B9h5gH2gAyNDYzNjQ2MjI4OmQ3NTg1MjhlNjU3MmE1MDc1NDAzZWZlODI0ZWRmNjQzMjIyOTA0YWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7d640d1a3a68081edd4cfc34159df2f2c662f8e0", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/7d640d1a3a68081edd4cfc34159df2f2c662f8e0", "committedDate": "2020-08-05T21:08:47Z", "message": "triallelic randomize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDMwNjk3", "url": "https://github.com/all-of-us/workbench/pull/3860#pullrequestreview-462030697", "createdAt": "2020-08-05T21:17:26Z", "commit": {"oid": "7d640d1a3a68081edd4cfc34159df2f2c662f8e0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxNzoyN1rOG8a9mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxNzoyN1rOG8a9mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwOTQ5OA==", "bodyText": "nit: I think it would read a little quicker if we specified that the size should be equal to 2. I was trying to figure this out earlier while I was reading.", "url": "https://github.com/all-of-us/workbench/pull/3860#discussion_r466009498", "createdAt": "2020-08-05T21:17:27Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -140,30 +140,49 @@ protected Genotype randomizeGenotype(VariantContext variantContext, Genotype gen\n      */\n     List<Allele> alleles = new ArrayList<>();\n     double genotypeTypeIndex = random.nextDouble();\n-    if (genotypeTypeIndex < .0145) {\n-      // double no-call\n-      return alleles;\n-    } else if (genotypeTypeIndex < .8095) {\n-      // homref\n-      alleles.add(variantContext.getReference());\n-      alleles.add(variantContext.getReference());\n-    } else if (genotypeTypeIndex < .8654) {\n-      // 0/1 het\n-      alleles.add(variantContext.getReference());\n-      alleles.add(variantContext.getAlternateAllele(0));\n-    } else if (genotypeTypeIndex < .9268) {\n-      // 1/0 het\n-      alleles.add(variantContext.getAlternateAllele(0));\n-      alleles.add(variantContext.getReference());\n-    } else if (genotypeTypeIndex < .9994\n-        || (genotypeTypeIndex >= .9994 && variantContext.getAlternateAlleles().size() == 1)) {\n-      // homvar\n-      alleles.add(variantContext.getAlternateAllele(0));\n-      alleles.add(variantContext.getAlternateAllele(0));\n+    if (variantContext.getAlternateAlleles().size() == 1) {\n+      if (genotypeTypeIndex < .0145) {\n+        // double no-call\n+        alleles.add(Allele.NO_CALL);\n+        alleles.add(Allele.NO_CALL);\n+        return alleles;\n+      } else if (genotypeTypeIndex < .8095) {\n+        // homref\n+        alleles.add(variantContext.getReference());\n+        alleles.add(variantContext.getReference());\n+      } else if (genotypeTypeIndex < .8654) {\n+        // 0/1 het\n+        alleles.add(variantContext.getReference());\n+        alleles.add(variantContext.getAlternateAllele(0));\n+      } else if (genotypeTypeIndex < .9268) {\n+        // 1/0 het\n+        alleles.add(variantContext.getAlternateAllele(0));\n+        alleles.add(variantContext.getReference());\n+      } else {\n+        // homvar\n+        alleles.add(variantContext.getAlternateAllele(0));\n+        alleles.add(variantContext.getAlternateAllele(0));\n+      }\n     } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d640d1a3a68081edd4cfc34159df2f2c662f8e0"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d758528e6572a5075403efe824edf643222904af", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d758528e6572a5075403efe824edf643222904af", "committedDate": "2020-08-05T21:18:39Z", "message": "phrasing"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4543, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}