{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MTM4NTMx", "number": 3885, "title": "[RW-5114][risk=no] Update hierarchy page ", "bodyText": "Style updates for hierarchy view for V2 UI\nAdd store for opening/closing sidebar from other components, use for 'Finish & Review' button\nMove AttributesPageV2 component to SelectionList\nAdd shared function saveCriteria for adding current criteria selections to cohort\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n I have run and tested this change locally", "createdAt": "2020-08-14T19:00:34Z", "url": "https://github.com/all-of-us/workbench/pull/3885", "merged": true, "mergeCommit": {"oid": "d0afe6e2c294d376b57011620f85524525f6d258"}, "closed": true, "closedAt": "2020-08-17T21:35:34Z", "author": {"login": "dolbeew"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_1XC1gFqTQ2ODYzOTM3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_4F9LABqjM2NjM0MTg5ODE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NjM5Mzc1", "url": "https://github.com/all-of-us/workbench/pull/3885#pullrequestreview-468639375", "createdAt": "2020-08-17T16:53:26Z", "commit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjo1MzoyNlrOHBw01g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjo1MzoyNlrOHBw01g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxMDU4Mg==", "bodyText": "Should we add check for selectionsIds being null or undefined?", "url": "https://github.com/all-of-us/workbench/pull/3885#discussion_r471610582", "createdAt": "2020-08-17T16:53:26Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/list-search-v2/list-search-v2.component.tsx", "diffHunk": "@@ -411,7 +411,12 @@ export const ListSearchV2 = withCurrentWorkspace()(\n             </tbody>\n           </table>}\n           {!standardOnly && !displayData.length && <div>No results found</div>}\n-          <Button type='primary' style={{borderRadius: '5px', float: 'right', marginTop: '1rem'}}>Finish & Review</Button>\n+          <Button type='primary'\n+                  style={{borderRadius: '5px', float: 'right', marginTop: '1rem'}}\n+                  disabled={selectedIds.length === 0}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NjY5OTgw", "url": "https://github.com/all-of-us/workbench/pull/3885#pullrequestreview-468669980", "createdAt": "2020-08-17T17:18:20Z", "commit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzoxODoyMFrOHByRVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzoxODoyMFrOHByRVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYzNDI2Mw==", "bodyText": "nit we can move this in a function as we are using this condition twice (at 442) attributesSelection || showModifiersSlide", "url": "https://github.com/all-of-us/workbench/pull/3885#discussion_r471634263", "createdAt": "2020-08-17T17:18:20Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -310,111 +329,143 @@ export class SelectionListModalVersion extends React.Component<Props> {\n   }\n }\n \n-export const SelectionList = withCurrentCohortCriteria()(class extends React.Component<Props, State> {\n-  constructor(props: Props) {\n-    super(props);\n-    this.state = {\n-      modifierButtonText: 'APPLY MODIFIERS',\n-      showModifiersSlide: false\n-    };\n-  }\n-\n-  componentDidUpdate(prevProps: Readonly<Props>): void {\n-    if (!this.props.criteria && !!prevProps.criteria) {\n-      this.setState({\n+export const SelectionList = fp.flow(withCurrentCohortCriteria(), withCurrentCohortSearchContext())(\n+  class extends React.Component<Props, State> {\n+    subscription: Subscription;\n+    constructor(props: Props) {\n+      super(props);\n+      this.state = {\n+        attributesSelection: undefined,\n         modifierButtonText: 'APPLY MODIFIERS',\n         showModifiersSlide: false\n+      };\n+    }\n+\n+    componentDidMount(): void {\n+      this.subscription = attributesSelectionStore.subscribe(attributesSelection => {\n+        this.setState({attributesSelection});\n+        if (!!attributesSelection) {\n+          setSidebarActiveIconStore.next('criteria');\n+        }\n       });\n     }\n-  }\n \n-  get showModifiers() {\n-    return ![DomainType.PHYSICALMEASUREMENT, DomainType.PERSON, DomainType.SURVEY].includes(this.props.domain);\n-  }\n+    componentDidUpdate(prevProps: Readonly<Props>): void {\n+      if (!this.props.criteria && !!prevProps.criteria) {\n+        this.setState({\n+          modifierButtonText: 'APPLY MODIFIERS',\n+          showModifiersSlide: false\n+        });\n+      }\n+    }\n \n-  get showNext() {\n-    return this.showModifiers && this.props.view !== 'modifiers';\n-  }\n+    get showModifiers() {\n+      return ![DomainType.PHYSICALMEASUREMENT, DomainType.PERSON, DomainType.SURVEY].includes(this.props.domain);\n+    }\n \n-  get showBack() {\n-    return this.showModifiers && this.props.view === 'modifiers';\n-  }\n+    get showNext() {\n+      return this.showModifiers && this.props.view !== 'modifiers';\n+    }\n \n-  showOr(index, selection) {\n-    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n-  }\n+    get showBack() {\n+      return this.showModifiers && this.props.view === 'modifiers';\n+    }\n \n-  renderCriteria() {\n-    const {criteria} = this.props;\n-    const g = fp.groupBy('isStandard', criteria);\n-    return <div style={{paddingLeft: '0.5rem', paddingBottom: '4rem'}}>\n-      {g['true'] && g['true'].length > 0 && this.renderCriteriaGroup(g['true'] , 'Standard Groups')}\n-      {g['false'] && g['false'].length > 0 && this.renderCriteriaGroup(g['false'], 'Source code Groups')}\n-    </div>;\n-  }\n+    showOr(index, selection) {\n+      return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+    }\n \n-  removeCriteria(criteriaToDel) {\n-    const updateList =  fp.remove(\n-      (selection) => selection.parameterId === criteriaToDel.parameterId, this.props.criteria);\n-    currentCohortCriteriaStore.next(updateList);\n-  }\n+    renderCriteria() {\n+      const {criteria} = this.props;\n+      const g = fp.groupBy('isStandard', criteria);\n+      return <div style={{paddingLeft: '0.5rem', paddingBottom: '4rem'}}>\n+        {g['true'] && g['true'].length > 0 && this.renderCriteriaGroup(g['true'] , 'Standard Groups')}\n+        {g['false'] && g['false'].length > 0 && this.renderCriteriaGroup(g['false'], 'Source code Groups')}\n+      </div>;\n+    }\n \n-  renderCriteriaGroup(criteriaGroup, header) {\n-    return  <React.Fragment>\n-      <h3> {header}</h3>\n-      <hr style={{marginRight: '0.5rem'}}/>\n-      {criteriaGroup && criteriaGroup.map((criteria, index) =>\n-        <SelectionInfo key={index}\n-                       index={index}\n-                       selection={criteria}\n-                       removeSelection={() => this.removeCriteria(criteria)}/>\n-\n-      )}\n-    </React.Fragment> ;\n-  }\n+    removeCriteria(criteriaToDel) {\n+      const updateList = fp.remove((selection) => selection.parameterId === criteriaToDel.parameterId, this.props.criteria);\n+      currentCohortCriteriaStore.next(updateList);\n+    }\n+\n+    renderCriteriaGroup(criteriaGroup, header) {\n+      return  <React.Fragment>\n+        <h3> {header}</h3>\n+        <hr style={{marginRight: '0.5rem'}}/>\n+        {criteriaGroup && criteriaGroup.map((criteria, index) =>\n+          <SelectionInfo key={index}\n+                         index={index}\n+                         selection={criteria}\n+                         removeSelection={() => this.removeCriteria(criteria)}/>\n \n-  applyModifier(modifiers) {\n-    if (modifiers) {\n-      const modifierButtonText = '(' + modifiers.length + ')  MODIFIERS APPLIED';\n-      this.setState({showModifiersSlide: false, modifierButtonText: modifierButtonText});\n-    } else {\n-      this.setState({showModifiersSlide: false, modifierButtonText: 'APPLY MODIFIERS'});\n+        )}\n+      </React.Fragment> ;\n     }\n-  }\n \n-  get showModifierButton() {\n-    const {criteria} = this.props;\n-    return criteria && criteria.length > 0 &&\n-      criteria[0].domainId !== DomainType.PHYSICALMEASUREMENT.toString()\n-      && criteria[0].domainId !== DomainType.PERSON.toString();\n-  }\n+    applyModifier(modifiers) {\n+      if (modifiers) {\n+        const modifierButtonText = '(' + modifiers.length + ')  MODIFIERS APPLIED';\n+        this.setState({showModifiersSlide: false, modifierButtonText: modifierButtonText});\n+      } else {\n+        this.setState({showModifiersSlide: false, modifierButtonText: 'APPLY MODIFIERS'});\n+      }\n+    }\n \n-  render() {\n-    const {back, criteria} = this.props;\n-    const {modifierButtonText, showModifiersSlide} = this.state;\n-    return <div>\n-        {!showModifiersSlide ?  <React.Fragment>\n-          <h3 style={{...styles.sectionTitle, marginTop: 0}}>Add selected criteria to cohort</h3>\n-          <div style={{paddingTop: '0.5rem', position: 'relative'}}>\n-            <div style={styles.selectionContainer}>\n-              {this.renderCriteria()}\n-              {this.showModifierButton && <div style={{paddingLeft: '0.6rem'}}>\n-                <Button type='secondaryOnDarkBackground' style={styles.modifierButton}\n-                        onClick={() => this.setState({showModifiersSlide: true})}>\n-                  {modifierButtonText}\n-                </Button>\n-              </div>}\n+    get showModifierButton() {\n+      const {criteria} = this.props;\n+      return criteria && criteria.length > 0 &&\n+        criteria[0].domainId !== DomainType.PHYSICALMEASUREMENT.toString()\n+        && criteria[0].domainId !== DomainType.PERSON.toString();\n+    }\n+\n+    render() {\n+      const {back, criteria} = this.props;\n+      const {attributesSelection, modifierButtonText, showModifiersSlide} = this.state;\n+      return <div>\n+        <FlexRow style={styles.navIcons}>\n+          {(attributesSelection || showModifiersSlide) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "originalPosition": 240}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4Njg1OTQx", "url": "https://github.com/all-of-us/workbench/pull/3885#pullrequestreview-468685941", "createdAt": "2020-08-17T17:40:58Z", "commit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzo0MDo1OFrOHBzfjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzo0MDo1OFrOHBzfjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY1NDI4NA==", "bodyText": "Nit: can you please add brackets, because of so many conditions its a little difficult to read", "url": "https://github.com/all-of-us/workbench/pull/3885#discussion_r471654284", "createdAt": "2020-08-17T17:40:58Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/tree-node/tree-node.component.tsx", "diffHunk": "@@ -292,7 +292,9 @@ export class TreeNode extends React.Component<TreeNodeProps, TreeNodeState> {\n       setAttributes} = this.props;\n     const {children, error, expanded, hover, loading, searchMatch} = this.state;\n     const nodeChildren = domainId === DomainType.PHYSICALMEASUREMENT.toString() ? node.children : children;\n-    const selected = selectedIds.includes(this.paramId) || groupSelections.includes(parentId);\n+    const selected = serverConfigStore.getValue().enableCohortBuilderV2\n+      ? currentCohortCriteriaStore.getValue().some(crit => crit.parameterId === this.paramId)\n+      : selectedIds.includes(this.paramId) || groupSelections.includes(parentId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NjkxMTk0", "url": "https://github.com/all-of-us/workbench/pull/3885#pullrequestreview-468691194", "createdAt": "2020-08-17T17:48:56Z", "commit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NjkyNDg1", "url": "https://github.com/all-of-us/workbench/pull/3885#pullrequestreview-468692485", "createdAt": "2020-08-17T17:50:39Z", "commit": {"oid": "16b7206b8f76035e932bf3ff5e71a669b20221c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb08deca54a4811cbd24f4a9f68efe1666187b64", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/fb08deca54a4811cbd24f4a9f68efe1666187b64", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 fix removal of selections"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c2003be9c3c85007f2c253528b021be18d1382", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/f1c2003be9c3c85007f2c253528b021be18d1382", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 adjust searchbar styles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20898fc155443caf463e7728829c0022d42b96e3", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/20898fc155443caf463e7728829c0022d42b96e3", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 implement save criteria function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0bb623cce38f0cbd6fb8ab7ab8f676a44616c8", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/fd0bb623cce38f0cbd6fb8ab7ab8f676a44616c8", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 add store for opening sidebar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7e6d9a8c534fb891184fc57e8cd6987f9e42857", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/f7e6d9a8c534fb891184fc57e8cd6987f9e42857", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 move attributes to selection-list component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c735b0441437ed7cc14248bbe798a70197657970", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c735b0441437ed7cc14248bbe798a70197657970", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 fix ui tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04f8d0d0c51e43ad8b0d654e79631b3d9aa5c7de", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/04f8d0d0c51e43ad8b0d654e79631b3d9aa5c7de", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 minor tree fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "595efe3c284acc3c726a09a7b3749d5c49cd8563", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/595efe3c284acc3c726a09a7b3749d5c49cd8563", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 pr feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2bfd27b78619373f4661c19b205e77853fcc1c3", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/b2bfd27b78619373f4661c19b205e77853fcc1c3", "committedDate": "2020-08-17T20:02:24Z", "message": "RW-5114 pr feedback"}, "afterCommit": {"oid": "595efe3c284acc3c726a09a7b3749d5c49cd8563", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/595efe3c284acc3c726a09a7b3749d5c49cd8563", "committedDate": "2020-08-17T20:04:14Z", "message": "RW-5114 pr feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4281, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}