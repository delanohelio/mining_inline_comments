{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1MDU2MTg2", "number": 4432, "title": "[risk=no] Fix a UI bug: could not edit WS name in the middle of the field", "bodyText": "Description:\nAttempting to edit a workspace name does not work correctly.  Here I'm succeeding at adding \"end is fine\" but failing at updating in the middle with \"middle is not\"\n\nThis is similar behavior to something we've seen before with Duplicate Workspace, and the fix is the same.  Not sure why we didn't fix both then.\nEditing in the middle now works:\n\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-12-23T22:34:53Z", "url": "https://github.com/all-of-us/workbench/pull/4432", "merged": true, "mergeCommit": {"oid": "e86cd87f7b9ce684da16b359b54898684f5967bd"}, "closed": true, "closedAt": "2021-01-05T03:11:20Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpG7YKgH2gAyNTQ1MDU2MTg2OmVmMjdhNDEyZDBmODVhMmIwZTNkYmUzYWNiZjQxYzI1OTgxN2M1NGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtB-utgFqTU2MTQ4NTUzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef27a412d0f85a2b0e3dbe3acbf41c259817c54e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ef27a412d0f85a2b0e3dbe3acbf41c259817c54e", "committedDate": "2020-12-23T22:32:25Z", "message": "Fix a UI bug: could not edit WS name in the middle of the field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMTQyMjE0", "url": "https://github.com/all-of-us/workbench/pull/4432#pullrequestreview-561142214", "createdAt": "2021-01-04T15:59:42Z", "commit": {"oid": "ef27a412d0f85a2b0e3dbe3acbf41c259817c54e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNTo1OTo0MlrOIN3FRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNTo1OTo0MlrOIN3FRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQwNDg2OQ==", "bodyText": "not 100% sure why this change works, but it seems to.  Please LMK if I have misunderstood something here.", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551404869", "createdAt": "2021-01-04T15:59:42Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -1026,7 +1027,7 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n                                 required={!this.isMode(WorkspaceEditMode.Duplicate)}>\n           <FlexRow style={{alignItems: 'baseline'}}>\n             <TextInput type='text' style={styles.textInput} autoFocus placeholder='Workspace Name'\n-              value = {name}\n+              defaultValue = {name}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef27a412d0f85a2b0e3dbe3acbf41c259817c54e"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/bc28800a7b8999a73ef35c0562c01bfb5aee4bf4", "committedDate": "2021-01-04T16:09:00Z", "message": "workspace prop is empty in create mode - don't destructure it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMTUxNTkw", "url": "https://github.com/all-of-us/workbench/pull/4432#pullrequestreview-561151590", "createdAt": "2021-01-04T16:11:54Z", "commit": {"oid": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNjoxMTo1NVrOIN3ktw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNjoxMTo1NVrOIN3ktw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQxMjkxOQ==", "bodyText": "Now always shows \"Edit workspace oldname\" instead of the continuously changing \"Edit workspace newname\"", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551412919", "createdAt": "2021-01-04T16:11:55Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -614,15 +614,16 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n     }\n \n     renderHeader() {\n-      switch (this.props.routeConfigData.mode) {\n+      // use workspace name from props instead of state here\n+      // because it's a record of the initial value\n+      const {routeConfigData: {mode}, workspace} = this.props;\n+      switch (mode) {\n         case WorkspaceEditMode.Create:\n           return 'Create a new workspace';\n         case WorkspaceEditMode.Edit:\n-          return 'Edit workspace \\\"' + this.state.workspace.name + '\\\"';\n+          return 'Edit workspace \\\"' + workspace.name + '\\\"';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzc3MDcx", "url": "https://github.com/all-of-us/workbench/pull/4432#pullrequestreview-561377071", "createdAt": "2021-01-04T21:58:39Z", "commit": {"oid": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMTo1ODozOVrOIOCoTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMTo1ODozOVrOIOCoTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU5NDA2MQ==", "bodyText": "This can, and probably should remain value - I don't think defaultValue is effecting the behavior. The fix is actually occurring in the renderHeader function where the name is no longer being updated as the user types.\nWhat was happening before was each time the text changed, the header would change causing the children to unmount and remount rather than just re-render. This is because of this line in workspace-edit-section.tsx. The WorkspaceEditSection uses the header prop as the key. Each time the header changes, the key changes causing an unmount/remount.\nThis seems rather unexpected and difficult to trace through the code - I created a techdebt issue to take a closer look to see whether the key is needed", "url": "https://github.com/all-of-us/workbench/pull/4432#discussion_r551594061", "createdAt": "2021-01-04T21:58:39Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -1026,7 +1027,7 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n                                 required={!this.isMode(WorkspaceEditMode.Duplicate)}>\n           <FlexRow style={{alignItems: 'baseline'}}>\n             <TextInput type='text' style={styles.textInput} autoFocus placeholder='Workspace Name'\n-              value = {name}\n+              defaultValue = {name}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc28800a7b8999a73ef35c0562c01bfb5aee4bf4"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c73a5cb3ba1504f8ec5ac5758793ab753efaf0", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/78c73a5cb3ba1504f8ec5ac5758793ab753efaf0", "committedDate": "2021-01-05T00:33:52Z", "message": "rv defaultValue chg"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDg1NTM0", "url": "https://github.com/all-of-us/workbench/pull/4432#pullrequestreview-561485534", "createdAt": "2021-01-05T03:02:15Z", "commit": {"oid": "78c73a5cb3ba1504f8ec5ac5758793ab753efaf0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3683, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}