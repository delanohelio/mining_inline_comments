{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NjkzOTY5", "number": 4376, "title": "[no ticket][risk=no] Puppeteer Combining two CDR modal tests", "bodyText": "Combining two small CDR modal tests into one. Faster playback time, one less login and one less new workspace.", "createdAt": "2020-12-08T20:09:08Z", "url": "https://github.com/all-of-us/workbench/pull/4376", "merged": true, "mergeCommit": {"oid": "e3212303996e99b8d6f7f8933344357e1f762882"}, "closed": true, "closedAt": "2020-12-09T16:18:53Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkP2-eAH2gAyNTM0NjkzOTY5OjhmYjI2MTE1MTc4NmM2ZGQwMGU0YTMyMzljZmFlYmY0OWE5OTZjNmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkgK2FgH2gAyNTM0NjkzOTY5OjQ2MDc0OWFhOGYxYzM3ZGZkOGZlMWRhYzNlYjUyZDcyMTQ0NzU5ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8fb261151786c6dd00e4a3239cfaebf49a996c6f", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8fb261151786c6dd00e4a3239cfaebf49a996c6f", "committedDate": "2020-12-08T20:07:08Z", "message": "combine two tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MTQ1MjQ3", "url": "https://github.com/all-of-us/workbench/pull/4376#pullrequestreview-548145247", "createdAt": "2020-12-09T12:44:31Z", "commit": {"oid": "8fb261151786c6dd00e4a3239cfaebf49a996c6f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo0NDozMVrOICSyuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo0NDozMVrOICSyuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3NTk2Mw==", "bodyText": "This is a different Cancel button from the button above, so I'd prefer a different variable name.  Then both of these can be const.", "url": "https://github.com/all-of-us/workbench/pull/4376#discussion_r539275963", "createdAt": "2020-12-09T12:44:31Z", "author": {"login": "jmthibault79"}, "path": "e2e/tests/workspace/cdr-version-upgrade.spec.ts", "diffHunk": "@@ -1,69 +1,62 @@\n import WorkspaceCard from 'app/component/workspace-card';\n+import {Page} from 'puppeteer';\n import {createWorkspace, signIn} from 'utils/test-utils';\n import {config} from 'resources/workbench-config';\n import WorkspaceDataPage from 'app/page/workspace-data-page';\n import WorkspaceBase from 'app/page/workspace-base';\n-import WorkspacesPage from 'app/page/workspaces-page';\n import WorkspaceEditPage from 'app/page/workspace-edit-page';\n-import Navigation, {NavLink} from 'app/component/navigation';\n import CdrVersionUpgradeModal from 'app/page/cdr-version-upgrade-modal';\n \n-describe('Workspace CDR Version upgrade', () => {\n+describe('Workspace CDR Version Upgrade modal', () => {\n     beforeEach(async () => {\n         await signIn(page);\n     });\n \n-   test('Clicking the CDR version upgrade flag pops up the upgrade modal', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        await workspaceCard.clickWorkspaceName();\n+   test('Clicking Cancel and Upgrade buttons', async () => {\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n-        expect(await workspacePage.getCdrVersion()).toBe(config.altCdrVersionName);\n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n+      const workspaceName = await workspaceCard.clickWorkspaceName();\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      const cdrVersion = await workspacePage.getCdrVersion();\n+      expect(cdrVersion).toBe(config.altCdrVersionName);\n \n-        // hit cancel\n-        const cancelButton = await modal.getCancelButton();\n-        await cancelButton.click();\n+      let modal = await launchCdrUpgradeModal(page);\n \n-        // new version flag remains\n-        await workspacePage.getNewCdrVersionFlag();\n+      // Clicking the Cancel\n+      let cancelButton = await modal.getCancelButton();\n+      await cancelButton.click();\n \n-        // cleanup\n-        await workspacePage.deleteWorkspace()\n-    });\n-\n-    test('Clicking the CDR version upgrade button opens the Duplicate Workspace Page', async () => {\n-        const workspaceCard: WorkspaceCard = await createWorkspace(page, config.altCdrVersionName);\n-        const workspaceName = await workspaceCard.clickWorkspaceName();\n+      // CDR version flag remains\n+      await workspacePage.getNewCdrVersionFlag();\n \n-        const workspacePage: WorkspaceBase = new WorkspaceDataPage(page);\n+      // Clicking the Upgrade button opens the Duplicate Workspace Page\n+      modal = await launchCdrUpgradeModal(page);\n+      const upgradeButton = await modal.getUpgradeButton();\n+      await upgradeButton.click();\n \n-        const newVersionFlag = await workspacePage.getNewCdrVersionFlag();\n-        await newVersionFlag.click();\n+      const duplicationPage = new WorkspaceEditPage(page);\n+      const upgradeMessage = await duplicationPage.getCdrVersionUpgradeMessage();\n+      expect(upgradeMessage).toContain(workspaceName);\n+      expect(upgradeMessage).toContain(`${config.altCdrVersionName} to ${config.defaultCdrVersionName}.`);\n \n-        const modal = new CdrVersionUpgradeModal(page);\n-        expect(await modal.isLoaded()).toBe(true);\n+      cancelButton = await duplicationPage.getCancelButton();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb261151786c6dd00e4a3239cfaebf49a996c6f"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "460749aa8f1c37dfd8fe1dac3eb52d7214475984", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/460749aa8f1c37dfd8fe1dac3eb52d7214475984", "committedDate": "2020-12-09T15:07:19Z", "message": "address PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3736, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}