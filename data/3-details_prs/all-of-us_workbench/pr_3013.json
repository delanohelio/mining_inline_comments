{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NDQ2NTAw", "number": 3013, "title": "[RISK=MEDIUM][no ticket] Add default value to user creation date and last modified time", "bodyText": "This PR has 3 database script file:\n\n115 : Skip if USER TABLE have creation_time and last_modfied_time COLUMNS already else create the two columns with\n\n\ncreation_time with not null\nlast_modified_time with null constraint. and default value as current_timestamp\n\n\n116: DROP column creation_time and  LAST_MODIFIED_TIME if they exist in USER else skip\n117: Add columns creation_time and  LAST_MODIFIED_TIME  again with null constraints and defaultdate as 1970 Jan 1\n\nThe reason for three scripts are as follows:\n\nDate with null constraint cannot be updated later with another default value as it starts giving liquibase base exception\nliquibase.exception.LiquibaseException: Unexpected error running Liquibase: Data truncation: Incorrect datetime value: '0000-00-00 00:00:00' for column 'creation_time' at row 1 [Failed SQL: ALTER TABLE workbench.user ADD creation_time datetime NOT NULL, ADD last_modified_time datetime NOT NULL]\nOn test 115 has already run and we do not have permission to ALTER table hence the rollback script ran partially removing the entry from DATABASECHANGELOG but unable to alter table hence we are rerunning 115 with preCondition to ignore onFail\nSince test already has the columns we want to Default value too and we cannot add default values tag 116 will drop them (if they exist) and 117 will add proper values", "createdAt": "2020-01-18T17:22:35Z", "url": "https://github.com/all-of-us/workbench/pull/3013", "merged": true, "mergeCommit": {"oid": "66c6b9f9fc531f692993a0cafec00bd9be88e1b1"}, "closed": true, "closedAt": "2020-01-18T19:05:51Z", "author": {"login": "NehaBroad"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7WVmfAH2gAyMzY0NDQ2NTAwOjY0MDMzZjU5ZDVmYjk4NDA4YTMzNGNhZGRjN2VhNWNmMmYwZGJhYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7nieigFqTM0NDk1NTcyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/64033f59d5fb98408a334caddc7ea5cf2f0dbaa7", "committedDate": "2020-01-17T22:17:58Z", "message": "Add default value to creation_Time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d7630753f3ab897c2f84f8b8bd3d2acca99fe005", "committedDate": "2020-01-17T23:02:50Z", "message": "Conflict resolve"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7c7ed09877ad85ea2c45c682008616edf3f351f", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f7c7ed09877ad85ea2c45c682008616edf3f351f", "committedDate": "2020-01-18T16:12:43Z", "message": "change changesheet name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1653d41198433f8877df78ba59bc722ca3fb7747", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1653d41198433f8877df78ba59bc722ca3fb7747", "committedDate": "2020-01-18T17:14:41Z", "message": "Add scripts to remove creation_time and last_modified_time from user table and readd them with default values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff3e1cf7e1622858eb68286a7cb65239bf26a82c", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ff3e1cf7e1622858eb68286a7cb65239bf26a82c", "committedDate": "2020-01-18T17:24:20Z", "message": "reverting 115 to original script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8683901997becd8523f89aa1aec0315a4b901cc", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/c8683901997becd8523f89aa1aec0315a4b901cc", "committedDate": "2020-01-18T17:34:08Z", "message": "Merge branch 'master' into nsaxena/RDR/addColoboratorStatus"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTU1NjYy", "url": "https://github.com/all-of-us/workbench/pull/3013#pullrequestreview-344955662", "createdAt": "2020-01-18T18:16:01Z", "commit": {"oid": "c8683901997becd8523f89aa1aec0315a4b901cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxODoxNjowMVrOFfLnww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxODoxNjowMVrOFfLnww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDU3OQ==", "bodyText": "No, we can't have this. The entire point of Liquibase is that it's idempotent, and if it's at a state, it got there by playing everything before it successfully.\nCan we just restore the database from a backup and run a migration from there?", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368240579", "createdAt": "2020-01-18T18:16:01Z", "author": {"login": "jaycarlton"}, "path": "api/db/changelog/db.changelog-115-addColumn-user-create-modified.xml", "diffHunk": "@@ -5,12 +5,17 @@\n     xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n   <changeSet author=\"nsaxena\" id=\"db.changelog-115-addColumn-user-create-modified-with-null-constraint-and-default\">\n+    <preConditions onFail=\"MARK_RAN\" > ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8683901997becd8523f89aa1aec0315a4b901cc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTU1NzIw", "url": "https://github.com/all-of-us/workbench/pull/3013#pullrequestreview-344955720", "createdAt": "2020-01-18T18:17:14Z", "commit": {"oid": "c8683901997becd8523f89aa1aec0315a4b901cc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxODoxNzoxNFrOFfLoBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxODoxNzoxNFrOFfLoBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDY0NA==", "bodyText": "We should just delete this changeset and start at 120 if it failed. I think that's more correct. 115 should never be in the history for two different databases with different semantics.", "url": "https://github.com/all-of-us/workbench/pull/3013#discussion_r368240644", "createdAt": "2020-01-18T18:17:14Z", "author": {"login": "jaycarlton"}, "path": "api/db/changelog/db.changelog-115-addColumn-user-create-modified.xml", "diffHunk": "@@ -5,12 +5,17 @@\n     xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog/1.9\n                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd\">\n   <changeSet author=\"nsaxena\" id=\"db.changelog-115-addColumn-user-create-modified-with-null-constraint-and-default\">\n+    <preConditions onFail=\"MARK_RAN\" > \n+      <not>         \n+        <columnExists tableName=\"user\" columnName=\"creation_time\" />\n+      </not>\n+    </preConditions>\n     <addColumn tableName=\"user\">\n-      <column name=\"creation_time\" type=\"datetime\" defaultValueDate=\"1970-01-01 00:00:00\">\n-        <constraints nullable=\"false\" />\n+      <column name=\"creation_time\" type=\"datetime\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8683901997becd8523f89aa1aec0315a4b901cc"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3689, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}