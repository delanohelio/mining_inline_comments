{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjQ4NzY0", "number": 3840, "title": "[risk=no][RW-5342] Add useNavigation hook", "bodyText": "Description:\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-08-03T15:34:48Z", "url": "https://github.com/all-of-us/workbench/pull/3840", "merged": true, "mergeCommit": {"oid": "e9fd589d2582591d04623265963b426e6261be39"}, "closed": true, "closedAt": "2020-08-04T13:44:03Z", "author": {"login": "petesantos"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7TjJaAH2gAyNDYyMjQ4NzY0OjIzZWZhODhjOWRhYzAwMmQzNDRmZmRmZDVhZGE1MTE5MjBiMjhlZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7ag_lgFqTQ2MDM5OTAwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "23efa88c9dac002d344ffdfd5ada511920b28eff", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/23efa88c9dac002d344ffdfd5ada511920b28eff", "committedDate": "2020-08-03T15:14:12Z", "message": "Add hook to make setting nav state a bit cleaner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7388d416d1e851630163f654b1c5cc9c75af66a4", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/7388d416d1e851630163f654b1c5cc9c75af66a4", "committedDate": "2020-08-03T15:17:32Z", "message": "Add comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjIzMzA5", "url": "https://github.com/all-of-us/workbench/pull/3840#pullrequestreview-460223309", "createdAt": "2020-08-03T17:46:13Z", "commit": {"oid": "7388d416d1e851630163f654b1c5cc9c75af66a4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo0NjoxM1rOG7C9nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo0Nzo1OFrOG7DA_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NzcwOQ==", "bodyText": "I didn't read this name as a boolean and  was confused. Maybe something like doNavigate or canNavigate?", "url": "https://github.com/all-of-us/workbench/pull/3840#discussion_r464567709", "createdAt": "2020-08-03T17:46:13Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/components/admin/audit-page-component.tsx", "diffHunk": "@@ -50,14 +50,8 @@ export interface AuditPageProps {\n \n const UserInput = ({initialAuditSubject, auditSubjectType, getNextAuditPath, buttonLabel, queryText}) => {\n   const [auditSubject, setAuditSubject] = useState(initialAuditSubject);\n-  const [loadNextSubject, setLoadNextSubject] = useState(false);\n   const [downloadSqlFile, setDownloadSqlFile] = useState(false);\n-\n-  useEffect(() =>  {\n-    if (loadNextSubject) {\n-      setLoadNextSubject(false);\n-    }\n-  }, [loadNextSubject]);\n+  const [navSubject, setNavSubject] = useNavigation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7388d416d1e851630163f654b1c5cc9c75af66a4"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2ODAzMA==", "bodyText": "Can we  change <Navigate/> to take this in as a property like enabled so we don't need the &&? I guess I  was thinking the Navigate element would be absorbed into a hook as well, but I don't know that I understood.", "url": "https://github.com/all-of-us/workbench/pull/3840#discussion_r464568030", "createdAt": "2020-08-03T17:46:52Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/components/admin/audit-page-component.tsx", "diffHunk": "@@ -91,7 +85,7 @@ const UserInput = ({initialAuditSubject, auditSubjectType, getNextAuditPath, but\n   };\n \n   return <React.Fragment>\n-    {loadNextSubject && <Navigate to={getNextAuditPath(auditSubject)}/>}\n+    {navSubject && <Navigate to={getNextAuditPath(auditSubject)}/>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7388d416d1e851630163f654b1c5cc9c75af66a4"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2ODU3NA==", "bodyText": "It would help to  have a little more documentation for what this does and doesn't do for you.  Maybe name it  useGatedNavigation?", "url": "https://github.com/all-of-us/workbench/pull/3840#discussion_r464568574", "createdAt": "2020-08-03T17:47:58Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/components/app-router.tsx", "diffHunk": "@@ -59,3 +59,16 @@ export const Navigate = ({to}): React.ReactElement => {\n   const location = useLocation();\n   return <Redirect to={{pathname: to, state: {from: location}}}/>;\n };\n+\n+// Resets the state after change to prevent a navigation loop", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7388d416d1e851630163f654b1c5cc9c75af66a4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d3399cd56510d7b2649a6d77ebf76ff1e22eb98", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/1d3399cd56510d7b2649a6d77ebf76ff1e22eb98", "committedDate": "2020-08-03T18:29:49Z", "message": "Change state name, add doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3ca179f6339af8920eedaa3fcc7ebb1d8873314", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/b3ca179f6339af8920eedaa3fcc7ebb1d8873314", "committedDate": "2020-08-03T18:31:33Z", "message": "Change hook name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjgzMDQ2", "url": "https://github.com/all-of-us/workbench/pull/3840#pullrequestreview-460283046", "createdAt": "2020-08-03T19:24:38Z", "commit": {"oid": "b3ca179f6339af8920eedaa3fcc7ebb1d8873314"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxOToyNDozOFrOG7F5HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxOToyNTozNVrOG7F67w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxNTcwOA==", "bodyText": "There's really nothing navigation-specific here. Could  this be more of a useToggle?", "url": "https://github.com/all-of-us/workbench/pull/3840#discussion_r464615708", "createdAt": "2020-08-03T19:24:38Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/components/app-router.tsx", "diffHunk": "@@ -59,3 +59,19 @@ export const Navigate = ({to}): React.ReactElement => {\n   const location = useLocation();\n   return <Redirect to={{pathname: to, state: {from: location}}}/>;\n };\n+\n+// This is essentially a setState for navigation.\n+// When the navigation state is set to true it will trigger a render.\n+// At this point the state should be used to render the 'Navigate' component, triggering a route change\n+// This hook will automatically set the state back to false, preventing the need for an additional 'useEffect' per nav item\n+export const useNavigationState = (): [boolean, Function] => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3ca179f6339af8920eedaa3fcc7ebb1d8873314"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxNjE3NQ==", "bodyText": "Can we just call this subjectRequested? The first  one is also a next one, so I don't know that next  really signifies anything.\nAlso,  do we really need this other bit? It seems like we've got a boolean tracking whether another property is non-null and/or changed. Can we not express  what we need with useEffect on auditSubject?", "url": "https://github.com/all-of-us/workbench/pull/3840#discussion_r464616175", "createdAt": "2020-08-03T19:25:35Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/components/admin/audit-page-component.tsx", "diffHunk": "@@ -50,14 +50,8 @@ export interface AuditPageProps {\n \n const UserInput = ({initialAuditSubject, auditSubjectType, getNextAuditPath, buttonLabel, queryText}) => {\n   const [auditSubject, setAuditSubject] = useState(initialAuditSubject);\n-  const [loadNextSubject, setLoadNextSubject] = useState(false);\n   const [downloadSqlFile, setDownloadSqlFile] = useState(false);\n-\n-  useEffect(() =>  {\n-    if (loadNextSubject) {\n-      setLoadNextSubject(false);\n-    }\n-  }, [loadNextSubject]);\n+  const [nextSubjectRequested, setNextSubjectRequested] = useNavigationState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3ca179f6339af8920eedaa3fcc7ebb1d8873314"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "488f770d8ba3acc2d0b744b675f9a298f116b242", "author": {"user": {"login": "petesantos", "name": "Pete Santos"}}, "url": "https://github.com/all-of-us/workbench/commit/488f770d8ba3acc2d0b744b675f9a298f116b242", "committedDate": "2020-08-03T20:05:50Z", "message": "Update naming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzk4ODQw", "url": "https://github.com/all-of-us/workbench/pull/3840#pullrequestreview-460398840", "createdAt": "2020-08-03T23:20:44Z", "commit": {"oid": "488f770d8ba3acc2d0b744b675f9a298f116b242"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMzoyMDo0NFrOG7Lv1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMzoyMDo0NFrOG7Lv1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcxMTYzNg==", "bodyText": "this still  seems iffy somehow, to have to evaluate an external variable instead of having this be a prop on Navigate. Other elements have a show property, though if we're using an element to describe a state change, we're already well outside my comfort zone. I want to think of elements as nouns or objects, with possible side effects at render time. But having a new class of elements that are not only stateful but  mutate elements around them seems awkward. So something like  <MyNavigate go={subjectRequested} url={auditUrl}/>.", "url": "https://github.com/all-of-us/workbench/pull/3840#discussion_r464711636", "createdAt": "2020-08-03T23:20:44Z", "author": {"login": "jaycarlton"}, "path": "ui/src/app/components/admin/audit-page-component.tsx", "diffHunk": "@@ -91,7 +85,7 @@ const UserInput = ({initialAuditSubject, auditSubjectType, getNextAuditPath, but\n   };\n \n   return <React.Fragment>\n-    {loadNextSubject && <Navigate to={getNextAuditPath(auditSubject)}/>}\n+    {subjectRequested && <Navigate to={getNextAuditPath(auditSubject)}/>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "488f770d8ba3acc2d0b744b675f9a298f116b242"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzk5MDA3", "url": "https://github.com/all-of-us/workbench/pull/3840#pullrequestreview-460399007", "createdAt": "2020-08-03T23:21:11Z", "commit": {"oid": "488f770d8ba3acc2d0b744b675f9a298f116b242"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4521, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}