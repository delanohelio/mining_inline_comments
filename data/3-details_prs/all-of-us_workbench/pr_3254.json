{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MzI2MDEw", "number": 3254, "title": "[RW-4139][risk=no] CircleCI config change to run Puppeteer tests on master merges", "bodyText": "Goal: Run Puppeteer e2e tests in CircleCI on master branch merges.\n\n\ne2e tests run on \"test\" env.\n\n\njob requires \"ui-deploy-to-test\" and \"api-deploy-to-test\" succeed.", "createdAt": "2020-03-14T14:42:09Z", "url": "https://github.com/all-of-us/workbench/pull/3254", "merged": true, "mergeCommit": {"oid": "2fe22656a1cce7bcc159931fc0f6763a0db526eb"}, "closed": true, "closedAt": "2020-03-20T17:06:52Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNl9DIAH2gAyMzg4MzI2MDEwOjQ1YTRjM2Q1ZDNlNWQ3NjA0ZmQzMmEwODViN2QxN2M4OGNjMmI1ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPjXuKAH2gAyMzg4MzI2MDEwOmZhNzM1ZWJhYjY4Yzg4MjA0OTc4NmNjZWYyMzhkZjUzMTI0NzcyMWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "45a4c3d5d3e5d7604fd32a085b7d17c88cc2b5dd", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/45a4c3d5d3e5d7604fd32a085b7d17c88cc2b5dd", "committedDate": "2020-03-14T14:40:16Z", "message": "circle config change to run Puppeteer tests on master merges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b730913b60fcf1de6470354d777fedffd1e745e1", "committedDate": "2020-03-14T14:45:46Z", "message": "comment out job master filter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzMyMTA5", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-374732109", "createdAt": "2020-03-14T14:56:14Z", "commit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDo1NjoxNFrOF2aDKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDo1NjoxNFrOF2aDKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NDIxOA==", "bodyText": "The logs folder is going to be created in a follow-up PR for test results and screenshots.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r392594218", "createdAt": "2020-03-14T14:56:14Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,52 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\\n+              gconf-service libasound2 libatk1.0-0 libatk-bridge2.0-0 libc6 libcairo2 libcups2 libdbus-1-3 \\\n+              libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \\\n+              libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 \\\n+              libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates \\\n+              fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget\n+      - run:\n+          name: Update environment variables\n+          command: |\n+            echo 'export USER_NAME=$PUPPETEER_TEST_USER' >> $BASH_ENV\n+            echo 'export PASSWORD=$PUPPETEER_TEST_USER_PASSWORD' >> $BASH_ENV\n+            echo 'export INVITATION_KEY=$PUPPETEER_TEST_REGISTRATION_KEY' >> $BASH_ENV\n+            echo 'export CONTACT_EMAIL=hermione.owner@quality.firecloud.org' >> $BASH_ENV\n+            source $BASH_ENV\n+      - run:\n+          name: Run e2e tests (Puppeteer and Jest)\n+          working_directory: ~/workbench/e2e\n+          command: yarn --silent test:ci\n+      - store_artifacts:\n+          path: e2e/logs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzMyMTYy", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-374732162", "createdAt": "2020-03-14T14:56:54Z", "commit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDo1Njo1NFrOF2aDZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDo1Njo1NFrOF2aDZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NDI3OQ==", "bodyText": "Remove this line. Uncomment line #414 - 419 before PR merge.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r392594279", "createdAt": "2020-03-14T14:56:54Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -356,6 +401,7 @@ workflows:\n       - ui-build-test\n       - api-bigquery-test\n       - api-integration-test\n+      - puppeteer-e2e-test # to test Puppeteer tests start and run. To be removed before PR merge.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDkxMDgy", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-375491082", "createdAt": "2020-03-16T18:43:18Z", "commit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODo0MzoxOVrOF3BXrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODo0NDoxNVrOF3BZeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzODQ0Ng==", "bodyText": "Can we bake some of these into the dockerfile? This seems like it would be a large amount of files to install every time.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r393238446", "createdAt": "2020-03-16T18:43:19Z", "author": {"login": "s-rubenstein"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,52 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzODkwNA==", "bodyText": "Could you add the puppeteer tests to the staging deploy job as well? We should probably block releases on this?", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r393238904", "createdAt": "2020-03-16T18:44:15Z", "author": {"login": "s-rubenstein"}, "path": ".circleci/config.yml", "diffHunk": "@@ -398,6 +450,7 @@ workflows:\n             - api-deps-check\n             - api-integration-test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3e7f5d760a51d1258bd198a9a2221d524603e0", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3d3e7f5d760a51d1258bd198a9a2221d524603e0", "committedDate": "2020-03-17T14:21:47Z", "message": "PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzkxMjIx", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-376391221", "createdAt": "2020-03-17T20:44:28Z", "commit": {"oid": "3d3e7f5d760a51d1258bd198a9a2221d524603e0"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDo0NDoyOFrOF3tTxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDo1MjoyMlrOF3tmCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1ODM0MA==", "bodyText": "I'd be surprised if there isn't a prebuilt Circle image which has these. Try circleci/node:12.16.1-browsers", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r393958340", "createdAt": "2020-03-17T20:44:28Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,52 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzODQ0Ng=="}, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2MjA3OQ==", "bodyText": "Would prefer we don't do that, this will generate noise on unrelated PRs.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r393962079", "createdAt": "2020-03-17T20:51:09Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -356,6 +401,7 @@ workflows:\n       - ui-build-test\n       - api-bigquery-test\n       - api-integration-test\n+      - puppeteer-e2e-test # to test Puppeteer tests start and run. To be removed before PR merge.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NDI3OQ=="}, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2MzAxNw==", "bodyText": "This doesn't seem like it needs to be configurable via an env var.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r393963017", "createdAt": "2020-03-17T20:52:22Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,54 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+        environment:\n+          NODE_ENV: development\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\\n+              gconf-service libasound2 libatk1.0-0 libatk-bridge2.0-0 libc6 libcairo2 libcups2 libdbus-1-3 \\\n+              libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \\\n+              libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 \\\n+              libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates \\\n+              fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget\n+      - run:\n+          name: Update environment variables\n+          command: |\n+            echo 'export USER_NAME=$PUPPETEER_TEST_USER' >> $BASH_ENV\n+            echo 'export PASSWORD=$PUPPETEER_TEST_USER_PASSWORD' >> $BASH_ENV\n+            echo 'export INVITATION_KEY=$PUPPETEER_TEST_REGISTRATION_KEY' >> $BASH_ENV\n+            echo 'export CONTACT_EMAIL=hermione.owner@quality.firecloud.org' >> $BASH_ENV", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3e7f5d760a51d1258bd198a9a2221d524603e0"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdf801f5021b944808ab0509367f12ec679e38d0", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/cdf801f5021b944808ab0509367f12ec679e38d0", "committedDate": "2020-03-18T02:43:49Z", "message": "revert last commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75c10fefa8daaf723361e2594d5e8f49c410382c", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/75c10fefa8daaf723361e2594d5e8f49c410382c", "committedDate": "2020-03-18T02:24:04Z", "message": "test"}, "afterCommit": {"oid": "cdf801f5021b944808ab0509367f12ec679e38d0", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/cdf801f5021b944808ab0509367f12ec679e38d0", "committedDate": "2020-03-18T02:43:49Z", "message": "revert last commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0674689439f7bd8191cb44804b927aa4c5188012", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/0674689439f7bd8191cb44804b927aa4c5188012", "committedDate": "2020-03-18T02:46:35Z", "message": "last test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "434026057601e742302ffb55b897299529dee013", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/434026057601e742302ffb55b897299529dee013", "committedDate": "2020-03-18T03:07:32Z", "message": "runInBand"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b454c5b1271fbe6c85eb43b134a7f8ff657359db", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/b454c5b1271fbe6c85eb43b134a7f8ff657359db", "committedDate": "2020-03-18T14:04:08Z", "message": "maxWorker is 2 again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1acf9b71faa2c134b46775ce25cbe561210d4480", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1acf9b71faa2c134b46775ce25cbe561210d4480", "committedDate": "2020-03-18T14:27:27Z", "message": "try node-browser image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d553fd31452509aedc54d501822e216ffd8f104", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/0d553fd31452509aedc54d501822e216ffd8f104", "committedDate": "2020-03-18T14:56:05Z", "message": "comment out headless dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "019922c7f18c9cee91b9bbaeb508e63934796739", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/019922c7f18c9cee91b9bbaeb508e63934796739", "committedDate": "2020-03-18T15:12:35Z", "message": "removed commented code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODk5MDY0", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-376899064", "createdAt": "2020-03-18T14:10:10Z", "commit": {"oid": "b454c5b1271fbe6c85eb43b134a7f8ff657359db"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNDoxMDoxMFrOF4Grlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNDoyMToxNFrOF4HMKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM3NDAzOQ==", "bodyText": "right. it's not a \"secret\" value. I'll remove it here and refactor in next PR.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394374039", "createdAt": "2020-03-18T14:10:10Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,54 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+        environment:\n+          NODE_ENV: development\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\\n+              gconf-service libasound2 libatk1.0-0 libatk-bridge2.0-0 libc6 libcairo2 libcups2 libdbus-1-3 \\\n+              libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \\\n+              libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 \\\n+              libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates \\\n+              fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget\n+      - run:\n+          name: Update environment variables\n+          command: |\n+            echo 'export USER_NAME=$PUPPETEER_TEST_USER' >> $BASH_ENV\n+            echo 'export PASSWORD=$PUPPETEER_TEST_USER_PASSWORD' >> $BASH_ENV\n+            echo 'export INVITATION_KEY=$PUPPETEER_TEST_REGISTRATION_KEY' >> $BASH_ENV\n+            echo 'export CONTACT_EMAIL=hermione.owner@quality.firecloud.org' >> $BASH_ENV", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2MzAxNw=="}, "originalCommit": {"oid": "3d3e7f5d760a51d1258bd198a9a2221d524603e0"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM3NDcyNw==", "bodyText": "\ud83d\udc4dline removed.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394374727", "createdAt": "2020-03-18T14:11:04Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -356,6 +401,7 @@ workflows:\n       - ui-build-test\n       - api-bigquery-test\n       - api-integration-test\n+      - puppeteer-e2e-test # to test Puppeteer tests start and run. To be removed before PR merge.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NDI3OQ=="}, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM4MjM3OA==", "bodyText": "I saw node:<version>-browsers image too. I chose not to use it because image installs Firefox and Chrome/chromedriver. Test run in Chromium headless. So installed files are not exactly what test need and provided more than what test need. No preference from me as long as image works.  Do folks still prefer node:<version>-browsers?\nSo I tried circleci/node:13.10.1-browsers image and test ran in headless mode so I think it is okay to use that a node:<version>-browswer image.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394382378", "createdAt": "2020-03-18T14:21:14Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,52 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzODQ0Ng=="}, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDQxMzM3", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-377041337", "createdAt": "2020-03-18T16:37:08Z", "commit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNjozNzowOFrOF4NfoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNjozOTo0OFrOF4NmwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4NTY2NA==", "bodyText": "Thanks, this is good. We just don't want to maintain this long list of package installs if we can avoid it. Image size of prebuilt Circle images is not really a concern since Circle automatically caches them all.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394485664", "createdAt": "2020-03-18T16:37:08Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,52 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+          - ui-cache-\n+      - run: \n+          working_directory: ~/workbench/e2e\n+          command: yarn cache clean && yarn install --verbose --frozen-lockfile\n+      - save_cache:\n+          paths:\n+            - ~/.cache/yarn\n+          key: ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}\n+      - run:\n+          working_directory: ~/workbench/e2e\n+          name: Install Headless Chrome dependencies\n+          command: |\n+            sudo apt-get install -yq \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzODQ0Ng=="}, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4NzQ4OQ==", "bodyText": "Please name this key differently here and below:\ne.g.\n- e2e-cache-{{ checksum ... }}\n- e2e-cache-\n\nThis is not caching the same thing as the above UI tests", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394487489", "createdAt": "2020-03-18T16:39:48Z", "author": {"login": "calbach"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,52 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:\n+    docker:\n+      - image: circleci/node:12.16.1\n+    working_directory: ~/workbench\n+    steps:\n+      - checkout\n+      - run:\n+          name: Fetch Submodules\n+          command: git submodule update --init --recursive\n+      - restore_cache:\n+          keys:\n+          - ui-cache-{{ checksum \"~/workbench/e2e/yarn.lock\" }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b730913b60fcf1de6470354d777fedffd1e745e1"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43103076abfa50ffaaea8d8d07d67b435f042c20", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/43103076abfa50ffaaea8d8d07d67b435f042c20", "committedDate": "2020-03-18T16:57:32Z", "message": "rename cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDYwOTIz", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-377060923", "createdAt": "2020-03-18T16:59:37Z", "commit": {"oid": "43103076abfa50ffaaea8d8d07d67b435f042c20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2OTc1NTg2", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-376975586", "createdAt": "2020-03-18T15:27:26Z", "commit": {"oid": "019922c7f18c9cee91b9bbaeb508e63934796739"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNToyNzoyNlrOF4KUoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNToyNzoyNlrOF4KUoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQzMzY5Nw==", "bodyText": "Can you add a comment here describing this workflow a bit (e.g. \"Runs the suite of Puppeteer end-to-end QA tests, pointed at the test Workbench environment.\") and possibly add a cross-link to the relevant Jira ticket or design doc?", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394433697", "createdAt": "2020-03-18T15:27:26Z", "author": {"login": "gjuggler"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,44 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "019922c7f18c9cee91b9bbaeb508e63934796739"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDg1MDkz", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-377085093", "createdAt": "2020-03-18T17:28:40Z", "commit": {"oid": "43103076abfa50ffaaea8d8d07d67b435f042c20"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDk2MzUx", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-377096351", "createdAt": "2020-03-18T17:42:55Z", "commit": {"oid": "43103076abfa50ffaaea8d8d07d67b435f042c20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTQ2NDE4", "url": "https://github.com/all-of-us/workbench/pull/3254#pullrequestreview-377146418", "createdAt": "2020-03-18T18:51:09Z", "commit": {"oid": "43103076abfa50ffaaea8d8d07d67b435f042c20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODo1MTowOVrOF4Sllw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODo1MTowOVrOF4Sllw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU2OTExMQ==", "bodyText": "That's easy. doing so doesn't over-comment code, right? I do have a comment at line #405 in workflows section, although not worded same.", "url": "https://github.com/all-of-us/workbench/pull/3254#discussion_r394569111", "createdAt": "2020-03-18T18:51:09Z", "author": {"login": "aweng98"}, "path": ".circleci/config.yml", "diffHunk": "@@ -257,7 +257,44 @@ jobs:\n           root: .\n           paths:\n             - ui\n-\n+  \n+  puppeteer-e2e-test:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQzMzY5Nw=="}, "originalCommit": {"oid": "019922c7f18c9cee91b9bbaeb508e63934796739"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b39b349b7606b998c7858c70e89778b5da290b2", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1b39b349b7606b998c7858c70e89778b5da290b2", "committedDate": "2020-03-20T16:35:47Z", "message": "add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa735ebab68c882049786ccef238df531247721e", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fa735ebab68c882049786ccef238df531247721e", "committedDate": "2020-03-20T16:47:32Z", "message": "fix bad comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3471, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}