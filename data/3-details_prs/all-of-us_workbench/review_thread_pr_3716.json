{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMjU4Nzkz", "number": 3716, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDo1ODo1NFrOEJKeww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToxNjowMlrOEJK2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDQ0MzU1OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDo1ODo1NFrOGpkItw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDo1ODo1NFrOGpkItw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzNjg1NQ==", "bodyText": "Opt: It could be simpler if we check for Surveys here, then we could remove the line below:\nconst formState = this.modifiersForSurvey;", "url": "https://github.com/all-of-us/workbench/pull/3716#discussion_r446236855", "createdAt": "2020-06-26T14:58:54Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -250,7 +251,7 @@ export const ModifierPage = withCurrentWorkspace()(\n \n     async componentDidMount() {\n       const {workspace: {cdrVersionId}} = this.props;\n-      const {formState} = this.state;\n+      let {formState} = this.state;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48577d8faaf189d0ff50cee5583893a4c39a4e1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDQ0ODQ1OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTowMDoxM1rOGpkL4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTowMDoxM1rOGpkL4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzNzY2Ng==", "bodyText": "Remove if making the above change", "url": "https://github.com/all-of-us/workbench/pull/3716#discussion_r446237666", "createdAt": "2020-06-26T15:00:13Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -306,10 +307,19 @@ export const ModifierPage = withCurrentWorkspace()(\n         formState.push(encounters);\n         this.setState({visitCounts});\n       }\n+      formState = this.modifiersForSurvey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48577d8faaf189d0ff50cee5583893a4c39a4e1"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDQ1NTk0OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTowMjoxOFrOGpkQsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTowMjoxOFrOGpkQsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzODg5OQ==", "bodyText": "We also need to filter the form here for Surveys. When I added a Survey item, then went back in to edit the item, all three modifier fields showed in the form.", "url": "https://github.com/all-of-us/workbench/pull/3716#discussion_r446238899", "createdAt": "2020-06-26T15:02:18Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.tsx", "diffHunk": "@@ -306,10 +307,19 @@ export const ModifierPage = withCurrentWorkspace()(\n         formState.push(encounters);\n         this.setState({visitCounts});\n       }\n+      formState = this.modifiersForSurvey;\n       this.setState({formState});\n       this.getExisting();\n     }\n \n+    get modifiersForSurvey() {\n+      const {formState} = this.state;\n+      const {searchContext: {domain}} = this.props;\n+      if (domain === DomainType.SURVEY) {\n+        return formState.filter(form => SURVEY_MODIFIERS.indexOf(form.name) > -1);\n+      }\n+      return formState;\n+    }\n     getExisting() {\n       const {searchContext} = this.props;\n       const {formState} = this.state;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48577d8faaf189d0ff50cee5583893a4c39a4e1"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDUwMzU4OnYy", "diffSide": "RIGHT", "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.spec.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToxNjowMlrOGpkvXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToxNjowMlrOGpkvXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0Njc0OA==", "bodyText": "Thanks for adding this! CB is in pretty bad shape in regards to UI testing.", "url": "https://github.com/all-of-us/workbench/pull/3716#discussion_r446246748", "createdAt": "2020-06-26T15:16:02Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/modifier-page/modifier-page.component.spec.tsx", "diffHunk": "@@ -1,12 +1,62 @@\n-import {shallow} from 'enzyme';\n+import {mount, shallow} from 'enzyme';\n \n+import {cohortBuilderApi, registerApiClient} from 'app/services/swagger-fetch-clients';\n+import {currentWorkspaceStore, serverConfigStore, urlParamsStore} from 'app/utils/navigation';\n+import {\n+  CohortBuilderApi, CohortsApi, DomainType, ModifierType,\n+  WorkspacesApi\n+} from 'generated/fetch';\n import * as React from 'react';\n+import {waitOneTickAndUpdate} from 'testing/react-test-helpers';\n+import {CohortBuilderServiceStub} from 'testing/stubs/cohort-builder-service-stub';\n+import {CohortsApiStub} from 'testing/stubs/cohorts-api-stub';\n+import {WorkspaceStubVariables} from 'testing/stubs/workspaces-api-stub';\n+import {workspaceDataStub, WorkspacesApiStub} from 'testing/stubs/workspaces-api-stub';\n import {ModifierPage} from './modifier-page.component';\n \n \n describe('ListModifierPage', () => {\n+  beforeEach(() => {\n+    registerApiClient(WorkspacesApi, new WorkspacesApiStub());\n+    registerApiClient(CohortBuilderApi, new CohortBuilderServiceStub());\n+\n+    urlParamsStore.next({\n+      ns: WorkspaceStubVariables.DEFAULT_WORKSPACE_NS,\n+      wsid: WorkspaceStubVariables.DEFAULT_WORKSPACE_ID\n+    });\n+    currentWorkspaceStore.next(workspaceDataStub);\n+    serverConfigStore.next({\n+      enableEventDateModifier: true,\n+      gsuiteDomain: 'fake-research-aou.org',\n+      projectId: 'aaa',\n+      publicApiKeyForErrorReports: 'aaa',\n+      enableEraCommons: true,\n+    });\n+  });\n+\n   it('should render', () => {\n     const wrapper = shallow(<ModifierPage disabled={() => {}} wizard={{}}/>);\n     expect(wrapper.exists()).toBeTruthy();\n   });\n+\n+  it('should display Only Age Event modifier for SURVEY', async() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48577d8faaf189d0ff50cee5583893a4c39a4e1"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2582, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}