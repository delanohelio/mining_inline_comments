{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NTAyODU5", "number": 3307, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozMzozMlrODr5KNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNjozNToxMlrODsJFMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzUxODYxOnYy", "diffSide": "RIGHT", "path": "e2e/app/workspace-card.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozMzozMlrOF8gNLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozMzozMlrOF8gNLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4NjU0MA==", "bodyText": "Calling getAllCards() function to avoid duplicate code. should have been done at the beginning.", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r398986540", "createdAt": "2020-03-27T01:33:32Z", "author": {"login": "aweng98"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);\n+    for (const card of allCards) {\n+      const children = await card.asElementHandle().$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n       if (children.length > 0) {\n-        return new WorkspaceCard(page).asCardElement(card);\n+        return card; // matched workspace name, found the Workspace card.\n       }\n-      await card.dispose();\n+      await card.dispose(); // not it, dispose the ElementHandle.\n     }\n-    return null;\n+    return null; // not found", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzUyNDQwOnYy", "diffSide": "RIGHT", "path": "e2e/app/workspace-card.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozNTozMVrOF8gQvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozNTozMVrOF8gQvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4NzQ1Mw==", "bodyText": "I think new method name is better and more clear.", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r398987453", "createdAt": "2020-03-27T01:35:31Z", "author": {"login": "aweng98"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);\n+    for (const card of allCards) {\n+      const children = await card.asElementHandle().$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n       if (children.length > 0) {\n-        return new WorkspaceCard(page).asCardElement(card);\n+        return card; // matched workspace name, found the Workspace card.\n       }\n-      await card.dispose();\n+      await card.dispose(); // not it, dispose the ElementHandle.\n     }\n-    return null;\n+    return null; // not found\n   }\n \n \n   constructor(page: Page) {\n     super(page);\n   }\n \n-  async getResourceCardName(): Promise<unknown> {\n-    const cardNameElem = await this.element.$x('.//*[@data-test-id=\"workspace-card-name\"]');\n+  async getWorkspaceName(): Promise<unknown> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzUyNjIwOnYy", "diffSide": "RIGHT", "path": "e2e/app/workspace-card.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozNjozNVrOF8gR0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTozNjozNVrOF8gR0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4NzczMA==", "bodyText": "Fix the flaky issue: wait until Workspace Card is visible.", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r398987730", "createdAt": "2020-03-27T01:36:35Z", "author": {"login": "aweng98"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -25,8 +25,9 @@ export default class WorkspaceCard extends BaseElement {\n   // **********************\n \n   static async getAllCards(page: Page): Promise<WorkspaceCard[]> {\n+    await page.waitForXPath(WorkspaceCard.cardRootXpath, {visible: true});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTcwNTI4OnYy", "diffSide": "RIGHT", "path": "e2e/app/workspace-card.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo1NzoyNlrOF806Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNTowNzozOFrOF81YAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNTc5OA==", "bodyText": "is this the workspace landing page? else can we name this as getAllWorkspaceCards", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399325798", "createdAt": "2020-03-27T14:57:26Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzMzM3Ng==", "bodyText": "It can be either Home or Your Workspaces page.", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399333376", "createdAt": "2020-03-27T15:07:38Z", "author": {"login": "aweng98"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNTc5OA=="}, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTcxMDAxOnYy", "diffSide": "RIGHT", "path": "e2e/app/workspace-card.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo1ODozMVrOF809Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNTozNDowMFrOF82g8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNjU1OA==", "bodyText": "wondering if we can use allCards.filter(card -> await card...) instead of for?", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399326558", "createdAt": "2020-03-27T14:58:31Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);\n+    for (const card of allCards) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM1MjA1MQ==", "bodyText": "I tried for a hour but failed to make it work. Then I found out .filter function is not async capable. :(", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399352051", "createdAt": "2020-03-27T15:34:00Z", "author": {"login": "aweng98"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);\n+    for (const card of allCards) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNjU1OA=="}, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTcxMzg2OnYy", "diffSide": "RIGHT", "path": "e2e/app/workspace-card.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo1OToyMFrOF80_xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNToxMDozM1rOF81f1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNzE3Mw==", "bodyText": "workspaceNameElem?", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399327173", "createdAt": "2020-03-27T14:59:20Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);\n+    for (const card of allCards) {\n+      const children = await card.asElementHandle().$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n       if (children.length > 0) {\n-        return new WorkspaceCard(page).asCardElement(card);\n+        return card; // matched workspace name, found the Workspace card.\n       }\n-      await card.dispose();\n+      await card.dispose(); // not it, dispose the ElementHandle.\n     }\n-    return null;\n+    return null; // not found\n   }\n \n \n   constructor(page: Page) {\n     super(page);\n   }\n \n-  async getResourceCardName(): Promise<unknown> {\n-    const cardNameElem = await this.element.$x('.//*[@data-test-id=\"workspace-card-name\"]');\n+  async getWorkspaceName(): Promise<unknown> {\n+    const selector = './/*[@data-test-id=\"workspace-card-name\"]';\n+    const cardNameElem = await this.element.$x(selector);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNTM4MA==", "bodyText": "\ud83d\udc4d Done", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399335380", "createdAt": "2020-03-27T15:10:33Z", "author": {"login": "aweng98"}, "path": "e2e/app/workspace-card.ts", "diffHunk": "@@ -41,24 +42,25 @@ export default class WorkspaceCard extends BaseElement {\n   }\n \n   static async findCard(page: Page, workspaceName: string): Promise<WorkspaceCard | null> {\n-    const cards = await page.$x(WorkspaceCard.cardRootXpath);\n-    for (const card of cards) {\n-      const children = await card.$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n+    const allCards = await this.getAllCards(page);\n+    for (const card of allCards) {\n+      const children = await card.asElementHandle().$x(`.//*[@data-test-id=\"workspace-card-name\" and text()=\"${workspaceName}\"]`);\n       if (children.length > 0) {\n-        return new WorkspaceCard(page).asCardElement(card);\n+        return card; // matched workspace name, found the Workspace card.\n       }\n-      await card.dispose();\n+      await card.dispose(); // not it, dispose the ElementHandle.\n     }\n-    return null;\n+    return null; // not found\n   }\n \n \n   constructor(page: Page) {\n     super(page);\n   }\n \n-  async getResourceCardName(): Promise<unknown> {\n-    const cardNameElem = await this.element.$x('.//*[@data-test-id=\"workspace-card-name\"]');\n+  async getWorkspaceName(): Promise<unknown> {\n+    const selector = './/*[@data-test-id=\"workspace-card-name\"]';\n+    const cardNameElem = await this.element.$x(selector);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNzE3Mw=="}, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTcxNjE2OnYy", "diffSide": "RIGHT", "path": "e2e/tests/workspace/workspace-ui.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo1OTo1MFrOF81BSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNTowNjoxMFrOF81Tzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNzU2Mg==", "bodyText": "can this be workspaceName", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399327562", "createdAt": "2020-03-27T14:59:50Z", "author": {"login": "NehaBroad"}, "path": "e2e/tests/workspace/workspace-ui.spec.ts", "diffHunk": "@@ -57,7 +57,7 @@ describe('Workspace ui tests', () => {\n \n     await WorkspaceCard.getAllCards(page);\n     const anyCard = await WorkspaceCard.getAnyCard(page);\n-    const cardName = await anyCard.getResourceCardName();\n+    const cardName = await anyCard.getWorkspaceName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzMjMwMw==", "bodyText": "\ud83d\udc4d Done", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399332303", "createdAt": "2020-03-27T15:06:10Z", "author": {"login": "aweng98"}, "path": "e2e/tests/workspace/workspace-ui.spec.ts", "diffHunk": "@@ -57,7 +57,7 @@ describe('Workspace ui tests', () => {\n \n     await WorkspaceCard.getAllCards(page);\n     const anyCard = await WorkspaceCard.getAnyCard(page);\n-    const cardName = await anyCard.getResourceCardName();\n+    const cardName = await anyCard.getWorkspaceName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNzU2Mg=="}, "originalCommit": {"oid": "c9a44242908abd94e509332fa95ca7ef2a1bbb81"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjEyMzM3OnYy", "diffSide": "LEFT", "path": "e2e/app/authenticated-page.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNjozNDoxN1rOF85A3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNjozNDoxN1rOF85A3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM5Mjk5MQ==", "bodyText": "oversight: this is a dup function. it already is in base-page.ts.", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399392991", "createdAt": "2020-03-27T16:34:17Z", "author": {"login": "aweng98"}, "path": "e2e/app/authenticated-page.ts", "diffHunk": "@@ -48,16 +48,6 @@ export default abstract class AuthenticatedPage extends BasePage {\n     super(page);\n   }\n \n-  /**\n-   * Take a full-page screenshot, save file in .png format in logs/screenshots directory.\n-   * @param fileName\n-   */\n-  async takeScreenshot(fileName: string) {\n-    const timestamp = new Date().getTime();\n-    const screenshotFile = `screenshots/${fileName}_${timestamp}.png`;\n-    await this.page.screenshot({path: screenshotFile, fullPage: true});\n-  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e59785446e93d54c7e2f975d90fd8e9aaad41c5"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjEyNzIxOnYy", "diffSide": "RIGHT", "path": "e2e/app/base-page.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNjozNToxMlrOF85DTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNjozNToxMlrOF85DTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM5MzYxNA==", "bodyText": "change to import for consistent style.", "url": "https://github.com/all-of-us/workbench/pull/3307#discussion_r399393614", "createdAt": "2020-03-27T16:35:12Z", "author": {"login": "aweng98"}, "path": "e2e/app/base-page.ts", "diffHunk": "@@ -1,5 +1,5 @@\n import {ElementHandle, Page, Response} from 'puppeteer';\n-const fse = require('fs-extra');\n+import { ensureDir } from 'fs-extra';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e59785446e93d54c7e2f975d90fd8e9aaad41c5"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3073, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}