{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDM1MjEw", "number": 3315, "title": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace", "bodyText": "System changes:\n\nDrop our custom handling of file cloning on CloneWorkspace, leverage the Firecloud cloneWorkspace file copy feature instead.\n\nFunctional changes:\n\nWe no longer copy all files in the bucket, just in the notebooks/ subdir. This is a revert to the original behavior which was intended to mitigate accidental copies of large files. It's required for this change since Rawls clone workspace doesn't support copying all files\nDrop the size limitation on cloned file size\nFiles are no longer synchronously available immediately after the clone, Rawls does this in a background thread.\n\nBased on manual local testing:\n\nThe propagation delay was not noticeable - tested with 50 notebook files.\nConfirmed that files outside this prefix do not get copied\nConfirmed that files in \"subdirectories\" do get copied", "createdAt": "2020-03-28T02:35:55Z", "url": "https://github.com/all-of-us/workbench/pull/3315", "merged": true, "mergeCommit": {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f"}, "closed": true, "closedAt": "2020-03-30T19:28:18Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR7fVQgH2gAyMzk1MDM1MjEwOmYwZmYzZTA1MzM1ZjJiZmUwMGJjN2UyNWJiMjhhYjMwZDBkNzFiMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSyPLWgH2gAyMzk1MDM1MjEwOjY4MTExNDQ5Mzc3NzExNGU2NzcxODk4OTg3NWM4MGQ4MGQ3MTVhZDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23", "committedDate": "2020-03-28T02:01:25Z", "message": "Switch to Rawls cloneWorkspace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTg3MDgz", "url": "https://github.com/all-of-us/workbench/pull/3315#pullrequestreview-383987083", "createdAt": "2020-03-30T15:43:46Z", "commit": {"oid": "f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDg3MTAy", "url": "https://github.com/all-of-us/workbench/pull/3315#pullrequestreview-384087102", "createdAt": "2020-03-30T17:43:44Z", "commit": {"oid": "f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzo0Mzo0NVrOF91DpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzo0Mzo0NVrOF91DpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3Njc0MA==", "bodyText": "Do we ever want to do a deep copy?", "url": "https://github.com/all-of-us/workbench/pull/3315#discussion_r400376740", "createdAt": "2020-03-30T17:43:45Z", "author": {"login": "jaycarlton"}, "path": "api/src/main/java/org/pmiops/workbench/firecloud/FireCloudServiceImpl.java", "diffHunk": "@@ -315,23 +309,36 @@ public void removeOwnerFromBillingProject(\n   @Override\n   public FirecloudWorkspace createWorkspace(String projectName, String workspaceName) {\n     WorkspacesApi workspacesApi = workspacesApiProvider.get();\n-    FirecloudWorkspaceIngest workspaceIngest = new FirecloudWorkspaceIngest();\n-    workspaceIngest.setName(workspaceName);\n-    workspaceIngest.setNamespace(projectName);\n-    checkAndAddRegistered(workspaceIngest);\n+    FirecloudWorkspaceIngest workspaceIngest =\n+        new FirecloudWorkspaceIngest()\n+            .namespace(projectName)\n+            .name(workspaceName)\n+            .authorizationDomain(\n+                ImmutableList.of(\n+                    new FirecloudManagedGroupRef()\n+                        .membersGroupName(configProvider.get().firecloud.registeredDomainName)));\n+\n     return retryHandler.run((context) -> workspacesApi.createWorkspace(workspaceIngest));\n   }\n \n   @Override\n   public FirecloudWorkspace cloneWorkspace(\n       String fromProject, String fromName, String toProject, String toName) {\n     WorkspacesApi workspacesApi = workspacesApiProvider.get();\n-    FirecloudWorkspaceIngest workspaceIngest = new FirecloudWorkspaceIngest();\n-    workspaceIngest.setNamespace(toProject);\n-    workspaceIngest.setName(toName);\n-    checkAndAddRegistered(workspaceIngest);\n+    FirecloudWorkspaceRequestClone cloneRequest =\n+        new FirecloudWorkspaceRequestClone()\n+            .namespace(toProject)\n+            .name(toName)\n+            // We copy only the notebooks/ subdirectory as a heuristic to avoid unintentionally\n+            // performing a deep copy of workspace blobs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0ff3e05335f2bfe00bc7e25bb28ab30d0d71b23"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "681114493777114e67718989875c80d80d715ad4", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/681114493777114e67718989875c80d80d715ad4", "committedDate": "2020-03-30T17:48:33Z", "message": "Update FireCloudServiceImpl.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3312, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}