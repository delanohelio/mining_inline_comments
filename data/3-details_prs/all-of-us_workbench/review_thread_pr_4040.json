{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNTczMzcx", "number": 4040, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NjozOVrOEmORXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0MToyM1rOEnFC0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTE1MTY0OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NjozOVrOHWIJ2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NjozOVrOHWIJ2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NDMxMw==", "bodyText": "Nice to see function components and hooks being used!", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r492964313", "createdAt": "2020-09-22T18:56:39Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -68,19 +78,33 @@ const workspaceInfoField = (labelText: string, divContents: React.ReactFragment)\n   </FlexRow>;\n };\n \n-const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n-  const {data, bucket} = props;\n+const NOTEBOOKS_DIRECTORY = 'notebooks';\n+const NOTEBOOKS_SUFFIX = '.ipynb';\n+const MAX_NOTEBOOK_READ_SIZE_BYTES = 5 * 1000 * 1000; // see NotebooksServiceImpl\n+\n+interface FileDetailsProps {\n+  workspaceNamespace: string;\n+  data: Array<FileDetail>;\n+  bucket: string;\n+}\n+\n+const FileDetailsTable = (props: FileDetailsProps) => {\n+  const {workspaceNamespace, data, bucket} = props;\n \n   interface TableEntry {\n-    name: string;\n-    size: string;\n     location: string;\n+    rawName: string;\n+    nameCell: ReactFragment;\n+    size: string;\n   }\n \n+  const [tableData, setTableData] = useState<Array<TableEntry>>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTI3OTQxOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTozMzo0MVrOHWJYug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTozMzo0MVrOHWJYug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4NDUwNg==", "bodyText": "Could this be another function component, with file and accessReason as props? If not, could accessReason be factored out as a param rather than using a closure?", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r492984506", "createdAt": "2020-09-22T19:33:41Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTMxMzQxOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0NDoyM1rOHWJuQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0NDoyM1rOHWJuQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5MDAxOA==", "bodyText": "It looks like these functions (getLocation, nameCell and formatMB) can be factored outside of the main function component - this would prevent redefining the function on each render call. Would there be an issue with moving them?", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r492990018", "createdAt": "2020-09-22T19:44:23Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -68,19 +78,33 @@ const workspaceInfoField = (labelText: string, divContents: React.ReactFragment)\n   </FlexRow>;\n };\n \n-const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n-  const {data, bucket} = props;\n+const NOTEBOOKS_DIRECTORY = 'notebooks';\n+const NOTEBOOKS_SUFFIX = '.ipynb';\n+const MAX_NOTEBOOK_READ_SIZE_BYTES = 5 * 1000 * 1000; // see NotebooksServiceImpl\n+\n+interface FileDetailsProps {\n+  workspaceNamespace: string;\n+  data: Array<FileDetail>;\n+  bucket: string;\n+}\n+\n+const FileDetailsTable = (props: FileDetailsProps) => {\n+  const {workspaceNamespace, data, bucket} = props;\n \n   interface TableEntry {\n-    name: string;\n-    size: string;\n     location: string;\n+    rawName: string;\n+    nameCell: ReactFragment;\n+    size: string;\n   }\n \n+  const [tableData, setTableData] = useState<Array<TableEntry>>();\n+  const [accessReason, setAccessReason] = useState('');\n+\n   const getLocation = (file: FileDetail): string => {\n     const prefix = `${bucket}/`;\n     const suffix = `/${file.name}`;\n-    return file.path.replace(prefix, '').replace(suffix, '');\n+    return file.path.replace(prefix, '').replace(suffix, '').trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTM3NTQyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowMjozNFrOHWKUUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMTo1MjowM1rOHXWx7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5OTc2MA==", "bodyText": "What are your thoughts on using a fp.cond for something like this?\nSomething along the lines of:\n    return fp.cond([\n      [() => NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX) && (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES) , enablePreview],\n      [() => NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX), tooLargeToPreview],\n      [() => true, () => filenameText]\n    ])(accessReason)\nWhere enablePreview and tooLargeToPreview are defined functions that return the fragment", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r492999760", "createdAt": "2020-09-22T20:02:34Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyODU1NA==", "bodyText": "not sure what fp.cond gets us beyond if - but I broke out the returned fragments and that looks more clear to me", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r493628554", "createdAt": "2020-09-23T14:15:20Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5OTc2MA=="}, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5MDY0MQ==", "bodyText": "We could have a simpler cond util function that would clean it up a bit more.\nI like cond for the clarity/declarative approach. Looking at the conditions I can read what the outcome is supposed to be. It also reduces the cyclomatic complexity a bit by eliminating the nested conditionals.", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r493690641", "createdAt": "2020-09-23T15:33:54Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5OTc2MA=="}, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1MjUyNQ==", "bodyText": "OK - gave cond() a try.  PTAL", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r494252525", "createdAt": "2020-09-24T11:52:03Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5OTc2MA=="}, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTQwNDc2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDoxMToyOFrOHWKmhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDoxMToyOFrOHWKmhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwNDQyMQ==", "bodyText": "Thoughts on making this a ternary?\n      const locCmp = a.location.localeCompare(b.location);\n      return locCmp === 0 ? a.rawName.localeCompare(b.rawName) : locCmp", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r493004421", "createdAt": "2020-09-22T20:11:28Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {\n+      if (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES) {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger\n+            content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+          ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      } else {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+            <Button style={styles.previewButton} disabled={!accessReason || !accessReason.trim()}\n+                    onClick={navigateToPreview}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      }\n     } else {\n-      return locCmp;\n+      return filenameText;\n     }\n-  });\n-\n-  return <DataTable\n-      data-test-id='object-details-table'\n-      value={sortedData}\n-      style={styles.fileDetailsTable}\n-      scrollable={true}\n-      paginator={true}\n-      paginatorTemplate='CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown'\n-      currentPageReportTemplate='Showing {first} to {last} of {totalRecords} entries'>\n-    <Column field='location' header='Location'/>\n-    <Column field='name' header='Filename'/>\n-    <Column field='size' header='File size (MB)'/>\n-  </DataTable>;\n+  };\n+\n+  const setupTable = () => {\n+    setTableData(data\n+      .map(file => {\n+        return {\n+          location: getLocation(file),\n+          rawName: file.name,\n+          nameCell: nameCell(file),\n+          size: formatMB(file.sizeInBytes),\n+        }; })\n+      .sort((a, b) => {\n+        const locCmp = a.location.localeCompare(b.location);\n+        if (locCmp === 0) {\n+          return a.rawName.localeCompare(b.rawName);\n+        } else {\n+          return locCmp;\n+        }}));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTYyMDg2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMToxNjoxN1rOHWMr8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzozNzozM1rOHWu0Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzODU3Ng==", "bodyText": "I am not seeing the connection between accessReason and setting the table data - does the table data change as the accessReason changes? If so could this be added to the onChange handler rather than as an effect?", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r493038576", "createdAt": "2020-09-22T21:16:17Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {\n+      if (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES) {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger\n+            content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+          ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      } else {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+            <Button style={styles.previewButton} disabled={!accessReason || !accessReason.trim()}\n+                    onClick={navigateToPreview}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      }\n     } else {\n-      return locCmp;\n+      return filenameText;\n     }\n-  });\n-\n-  return <DataTable\n-      data-test-id='object-details-table'\n-      value={sortedData}\n-      style={styles.fileDetailsTable}\n-      scrollable={true}\n-      paginator={true}\n-      paginatorTemplate='CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown'\n-      currentPageReportTemplate='Showing {first} to {last} of {totalRecords} entries'>\n-    <Column field='location' header='Location'/>\n-    <Column field='name' header='Filename'/>\n-    <Column field='size' header='File size (MB)'/>\n-  </DataTable>;\n+  };\n+\n+  const setupTable = () => {\n+    setTableData(data\n+      .map(file => {\n+        return {\n+          location: getLocation(file),\n+          rawName: file.name,\n+          nameCell: nameCell(file),\n+          size: formatMB(file.sizeInBytes),\n+        }; })\n+      .sort((a, b) => {\n+        const locCmp = a.location.localeCompare(b.location);\n+        if (locCmp === 0) {\n+          return a.rawName.localeCompare(b.rawName);\n+        } else {\n+          return locCmp;\n+        }}));\n+  };\n+\n+  useEffect(() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMTIwNQ==", "bodyText": "The enabled/disabled state of the button changes depending on accessReason.  This way of linking them does feel clunky.\nI'll see what I can do with onChange.", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r493521205", "createdAt": "2020-09-23T12:19:16Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {\n+      if (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES) {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger\n+            content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+          ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      } else {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+            <Button style={styles.previewButton} disabled={!accessReason || !accessReason.trim()}\n+                    onClick={navigateToPreview}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      }\n     } else {\n-      return locCmp;\n+      return filenameText;\n     }\n-  });\n-\n-  return <DataTable\n-      data-test-id='object-details-table'\n-      value={sortedData}\n-      style={styles.fileDetailsTable}\n-      scrollable={true}\n-      paginator={true}\n-      paginatorTemplate='CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown'\n-      currentPageReportTemplate='Showing {first} to {last} of {totalRecords} entries'>\n-    <Column field='location' header='Location'/>\n-    <Column field='name' header='Filename'/>\n-    <Column field='size' header='File size (MB)'/>\n-  </DataTable>;\n+  };\n+\n+  const setupTable = () => {\n+    setTableData(data\n+      .map(file => {\n+        return {\n+          location: getLocation(file),\n+          rawName: file.name,\n+          nameCell: nameCell(file),\n+          size: formatMB(file.sizeInBytes),\n+        }; })\n+      .sort((a, b) => {\n+        const locCmp = a.location.localeCompare(b.location);\n+        if (locCmp === 0) {\n+          return a.rawName.localeCompare(b.rawName);\n+        } else {\n+          return locCmp;\n+        }}));\n+  };\n+\n+  useEffect(() => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzODU3Ng=="}, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU5NzcyNg==", "bodyText": "now updated via onChange", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r493597726", "createdAt": "2020-09-23T13:37:33Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -92,35 +116,76 @@ const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n     }\n   };\n \n-  const formattedData: Array<TableEntry> = data.map(file => {\n-    return {\n-      name: file.name,\n-      size: formatMB(file.sizeInBytes),\n-      location: getLocation(file)\n+  const nameCell = (file: FileDetail): React.ReactFragment => {\n+    const filename = file.name.trim();\n+    const filenameText = <span>{filename}</span>;\n+    const navigateToPreview = () => {\n+      navigate(['admin', 'workspaces', workspaceNamespace, filename],\n+          { queryParams: { accessReason: accessReason } });\n     };\n-  });\n \n-  const sortedData = formattedData.sort((a, b) => {\n-    const locCmp = a.location.localeCompare(b.location);\n-    if (locCmp === 0) {\n-      return a.name.localeCompare(b.name);\n+    // remove first check after RW-5626\n+    if (NOTEBOOKS_DIRECTORY === getLocation(file) && filename.endsWith(NOTEBOOKS_SUFFIX)) {\n+      if (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES) {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger\n+            content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+          ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      } else {\n+        return <FlexRow>\n+          {filenameText}\n+          <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+            <Button style={styles.previewButton} disabled={!accessReason || !accessReason.trim()}\n+                    onClick={navigateToPreview}>Preview</Button>\n+          </TooltipTrigger>\n+        </FlexRow>;\n+      }\n     } else {\n-      return locCmp;\n+      return filenameText;\n     }\n-  });\n-\n-  return <DataTable\n-      data-test-id='object-details-table'\n-      value={sortedData}\n-      style={styles.fileDetailsTable}\n-      scrollable={true}\n-      paginator={true}\n-      paginatorTemplate='CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown'\n-      currentPageReportTemplate='Showing {first} to {last} of {totalRecords} entries'>\n-    <Column field='location' header='Location'/>\n-    <Column field='name' header='Filename'/>\n-    <Column field='size' header='File size (MB)'/>\n-  </DataTable>;\n+  };\n+\n+  const setupTable = () => {\n+    setTableData(data\n+      .map(file => {\n+        return {\n+          location: getLocation(file),\n+          rawName: file.name,\n+          nameCell: nameCell(file),\n+          size: formatMB(file.sizeInBytes),\n+        }; })\n+      .sort((a, b) => {\n+        const locCmp = a.location.localeCompare(b.location);\n+        if (locCmp === 0) {\n+          return a.rawName.localeCompare(b.rawName);\n+        } else {\n+          return locCmp;\n+        }}));\n+  };\n+\n+  useEffect(() => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzODU3Ng=="}, "originalCommit": {"oid": "30480713e59d2549d177b934e74360377ee75fc6"}, "originalPosition": 158}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDA4NDAxOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDozMjo1MlrOHXd5Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1Mzo1MFrOHXe5WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM2OTExOA==", "bodyText": "Are these comments needed?", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r494369118", "createdAt": "2020-09-24T14:32:52Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -77,53 +88,121 @@ const formatMB = (fileSize: number): string => {\n   }\n };\n \n-const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n-  const {data, bucket} = props;\n+const parseLocation = (file: FileDetail, bucket: string): string => {\n+  const prefixLength = bucket.length;\n+  const start = prefixLength + 1;  // slash after bucket name\n+  const suffixPos = file.path.lastIndexOf(file.name);\n+  const end = suffixPos - 1;  // slash before filename\n+\n+  return file.path.substring(start, end);\n+};\n+\n+const NOTEBOOKS_DIRECTORY = 'notebooks';\n+const NOTEBOOKS_SUFFIX = '.ipynb';\n+const MAX_NOTEBOOK_READ_SIZE_BYTES = 5 * 1000 * 1000; // see NotebooksServiceImpl\n+\n+interface NameCellProps {\n+  file: FileDetail;\n+  bucket: string;\n+  workspaceNamespace: string;\n+  accessReason: string;\n+}\n+\n+const NameCell = (props: NameCellProps) => {\n+  const {file, bucket, workspaceNamespace, accessReason} = props;\n+  const filename = file.name.trim();\n+\n+  const filenameSpan = () => <span>{filename}</span>;\n+\n+  const fileTooLarge = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger\n+        content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+    ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  const navigateToPreview = () => navigate(\n+      ['admin', 'workspaces', workspaceNamespace, filename],\n+      { queryParams: { accessReason: accessReason } });\n+\n+  const fileWithPreviewButton = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+      <Button style={styles.previewButton}\n+              disabled={!accessReason || !accessReason.trim()}\n+              onClick={navigateToPreview}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  // remove first check after RW-5626\n+  const isNotebook = () => (NOTEBOOKS_DIRECTORY === parseLocation(file, bucket)) && filename.endsWith(NOTEBOOKS_SUFFIX);\n+  const isTooLargeNotebook = () => isNotebook() && (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES);\n+\n+  // if (tooLarge()) fileTooLarge();\n+  // else if (isNotebook()) fileWithPreviewButton();\n+  // else filenameSpan();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93a753c9f10daf07cc1976cbc893b5b0778fa342"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4NTQ5Nw==", "bodyText": "I find it difficult to find good documentation or examples for fp, so it's my hope that this will be a useful \"translation\" of the below code", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r494385497", "createdAt": "2020-09-24T14:53:50Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -77,53 +88,121 @@ const formatMB = (fileSize: number): string => {\n   }\n };\n \n-const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n-  const {data, bucket} = props;\n+const parseLocation = (file: FileDetail, bucket: string): string => {\n+  const prefixLength = bucket.length;\n+  const start = prefixLength + 1;  // slash after bucket name\n+  const suffixPos = file.path.lastIndexOf(file.name);\n+  const end = suffixPos - 1;  // slash before filename\n+\n+  return file.path.substring(start, end);\n+};\n+\n+const NOTEBOOKS_DIRECTORY = 'notebooks';\n+const NOTEBOOKS_SUFFIX = '.ipynb';\n+const MAX_NOTEBOOK_READ_SIZE_BYTES = 5 * 1000 * 1000; // see NotebooksServiceImpl\n+\n+interface NameCellProps {\n+  file: FileDetail;\n+  bucket: string;\n+  workspaceNamespace: string;\n+  accessReason: string;\n+}\n+\n+const NameCell = (props: NameCellProps) => {\n+  const {file, bucket, workspaceNamespace, accessReason} = props;\n+  const filename = file.name.trim();\n+\n+  const filenameSpan = () => <span>{filename}</span>;\n+\n+  const fileTooLarge = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger\n+        content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+    ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  const navigateToPreview = () => navigate(\n+      ['admin', 'workspaces', workspaceNamespace, filename],\n+      { queryParams: { accessReason: accessReason } });\n+\n+  const fileWithPreviewButton = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+      <Button style={styles.previewButton}\n+              disabled={!accessReason || !accessReason.trim()}\n+              onClick={navigateToPreview}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  // remove first check after RW-5626\n+  const isNotebook = () => (NOTEBOOKS_DIRECTORY === parseLocation(file, bucket)) && filename.endsWith(NOTEBOOKS_SUFFIX);\n+  const isTooLargeNotebook = () => isNotebook() && (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES);\n+\n+  // if (tooLarge()) fileTooLarge();\n+  // else if (isNotebook()) fileWithPreviewButton();\n+  // else filenameSpan();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM2OTExOA=="}, "originalCommit": {"oid": "93a753c9f10daf07cc1976cbc893b5b0778fa342"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDEyNTYwOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0MToyM1rOHXeTDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1NDowMVrOHXe52A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3NTY5NA==", "bodyText": "Is cond not working without the dummy parameter?", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r494375694", "createdAt": "2020-09-24T14:41:23Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -77,53 +88,121 @@ const formatMB = (fileSize: number): string => {\n   }\n };\n \n-const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n-  const {data, bucket} = props;\n+const parseLocation = (file: FileDetail, bucket: string): string => {\n+  const prefixLength = bucket.length;\n+  const start = prefixLength + 1;  // slash after bucket name\n+  const suffixPos = file.path.lastIndexOf(file.name);\n+  const end = suffixPos - 1;  // slash before filename\n+\n+  return file.path.substring(start, end);\n+};\n+\n+const NOTEBOOKS_DIRECTORY = 'notebooks';\n+const NOTEBOOKS_SUFFIX = '.ipynb';\n+const MAX_NOTEBOOK_READ_SIZE_BYTES = 5 * 1000 * 1000; // see NotebooksServiceImpl\n+\n+interface NameCellProps {\n+  file: FileDetail;\n+  bucket: string;\n+  workspaceNamespace: string;\n+  accessReason: string;\n+}\n+\n+const NameCell = (props: NameCellProps) => {\n+  const {file, bucket, workspaceNamespace, accessReason} = props;\n+  const filename = file.name.trim();\n+\n+  const filenameSpan = () => <span>{filename}</span>;\n+\n+  const fileTooLarge = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger\n+        content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+    ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  const navigateToPreview = () => navigate(\n+      ['admin', 'workspaces', workspaceNamespace, filename],\n+      { queryParams: { accessReason: accessReason } });\n+\n+  const fileWithPreviewButton = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+      <Button style={styles.previewButton}\n+              disabled={!accessReason || !accessReason.trim()}\n+              onClick={navigateToPreview}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  // remove first check after RW-5626\n+  const isNotebook = () => (NOTEBOOKS_DIRECTORY === parseLocation(file, bucket)) && filename.endsWith(NOTEBOOKS_SUFFIX);\n+  const isTooLargeNotebook = () => isNotebook() && (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES);\n+\n+  // if (tooLarge()) fileTooLarge();\n+  // else if (isNotebook()) fileWithPreviewButton();\n+  // else filenameSpan();\n+  const requiredDummyParameter = undefined;\n+  return fp.cond([\n+    [isTooLargeNotebook, fileTooLarge],\n+    [isNotebook, fileWithPreviewButton],\n+    [fp.stubTrue, filenameSpan]\n+  ])(requiredDummyParameter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93a753c9f10daf07cc1976cbc893b5b0778fa342"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4NTYyNA==", "bodyText": "right", "url": "https://github.com/all-of-us/workbench/pull/4040#discussion_r494385624", "createdAt": "2020-09-24T14:54:01Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -77,53 +88,121 @@ const formatMB = (fileSize: number): string => {\n   }\n };\n \n-const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n-  const {data, bucket} = props;\n+const parseLocation = (file: FileDetail, bucket: string): string => {\n+  const prefixLength = bucket.length;\n+  const start = prefixLength + 1;  // slash after bucket name\n+  const suffixPos = file.path.lastIndexOf(file.name);\n+  const end = suffixPos - 1;  // slash before filename\n+\n+  return file.path.substring(start, end);\n+};\n+\n+const NOTEBOOKS_DIRECTORY = 'notebooks';\n+const NOTEBOOKS_SUFFIX = '.ipynb';\n+const MAX_NOTEBOOK_READ_SIZE_BYTES = 5 * 1000 * 1000; // see NotebooksServiceImpl\n+\n+interface NameCellProps {\n+  file: FileDetail;\n+  bucket: string;\n+  workspaceNamespace: string;\n+  accessReason: string;\n+}\n+\n+const NameCell = (props: NameCellProps) => {\n+  const {file, bucket, workspaceNamespace, accessReason} = props;\n+  const filename = file.name.trim();\n+\n+  const filenameSpan = () => <span>{filename}</span>;\n+\n+  const fileTooLarge = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger\n+        content={`Files larger than ${formatMB(MAX_NOTEBOOK_READ_SIZE_BYTES)} MB are too large to preview`}\n+    ><Button style={styles.previewButton} disabled={true}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  const navigateToPreview = () => navigate(\n+      ['admin', 'workspaces', workspaceNamespace, filename],\n+      { queryParams: { accessReason: accessReason } });\n+\n+  const fileWithPreviewButton = () => <FlexRow>\n+    {filenameSpan()}\n+    <TooltipTrigger content='Please enter an access reason below' disabled={accessReason && accessReason.trim()}>\n+      <Button style={styles.previewButton}\n+              disabled={!accessReason || !accessReason.trim()}\n+              onClick={navigateToPreview}>Preview</Button>\n+    </TooltipTrigger>\n+  </FlexRow>;\n+\n+  // remove first check after RW-5626\n+  const isNotebook = () => (NOTEBOOKS_DIRECTORY === parseLocation(file, bucket)) && filename.endsWith(NOTEBOOKS_SUFFIX);\n+  const isTooLargeNotebook = () => isNotebook() && (file.sizeInBytes > MAX_NOTEBOOK_READ_SIZE_BYTES);\n+\n+  // if (tooLarge()) fileTooLarge();\n+  // else if (isNotebook()) fileWithPreviewButton();\n+  // else filenameSpan();\n+  const requiredDummyParameter = undefined;\n+  return fp.cond([\n+    [isTooLargeNotebook, fileTooLarge],\n+    [isNotebook, fileWithPreviewButton],\n+    [fp.stubTrue, filenameSpan]\n+  ])(requiredDummyParameter);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3NTY5NA=="}, "originalCommit": {"oid": "93a753c9f10daf07cc1976cbc893b5b0778fa342"}, "originalPosition": 111}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3933, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}