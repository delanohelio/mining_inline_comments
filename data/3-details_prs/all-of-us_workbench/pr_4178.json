{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0ODg2MTk2", "number": 4178, "title": "[RW-5714][risk=no] Preset runtime dropdown", "bodyText": "PR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-10-16T14:20:47Z", "url": "https://github.com/all-of-us/workbench/pull/4178", "merged": true, "mergeCommit": {"oid": "8e40a7266849f78df2c038bb8f2359c4ae5f30ec"}, "closed": true, "closedAt": "2020-10-19T19:40:07Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdS1VO9AH2gAyNTA0ODg2MTk2OjE0N2U4NjhkYzU1YjBjMGYyNjQ4YjM3MjE0YmMwZTIxYzRjZjZlYzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUJWwFgFqTUxMjA5MjUzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "147e868dc55b0c0f2648b37214bc0e21c4cf6ec5", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/147e868dc55b0c0f2648b37214bc0e21c4cf6ec5", "committedDate": "2020-10-15T17:36:02Z", "message": "set runtime config type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb2ffa3b38d2f4035df446408b1db252298aa232", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/eb2ffa3b38d2f4035df446408b1db252298aa232", "committedDate": "2020-10-15T17:49:18Z", "message": "cat owner grade lint roller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecbf5a39d913193d9e51c84cf217a341b02a89e2", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/ecbf5a39d913193d9e51c84cf217a341b02a89e2", "committedDate": "2020-10-15T18:20:11Z", "message": "always enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9580cbc10261822488c8a9b11acd7af0db27fe78", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/9580cbc10261822488c8a9b11acd7af0db27fe78", "committedDate": "2020-10-16T14:18:08Z", "message": "tidying"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5f477f30a6270cc629fb5616dcd924764a4d6d", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/5b5f477f30a6270cc629fb5616dcd924764a4d6d", "committedDate": "2020-10-16T14:19:08Z", "message": "small lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69bdf275b6e8300f51329bd9d45eb07a4b2e216c", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/69bdf275b6e8300f51329bd9d45eb07a4b2e216c", "committedDate": "2020-10-16T14:21:53Z", "message": "boot disk size not disk size for gce"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13b140a46010818aa56b49613f0d9afe3cb33afa", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/13b140a46010818aa56b49613f0d9afe3cb33afa", "committedDate": "2020-10-16T14:22:39Z", "message": "git commit dash am has failed me for the last time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb2a6691b4eb269f5706d783875c5aa6ebb10004", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/bb2a6691b4eb269f5706d783875c5aa6ebb10004", "committedDate": "2020-10-16T14:25:59Z", "message": "lol i was wrong"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da8d340ec2e10d49cc38596c8b8573f9ebb5b874", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/da8d340ec2e10d49cc38596c8b8573f9ebb5b874", "committedDate": "2020-10-16T14:33:38Z", "message": "angular tests borked"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90ec32374d7f53b7c1a4efc7ca543fcb35053c01", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/90ec32374d7f53b7c1a4efc7ca543fcb35053c01", "committedDate": "2020-10-16T15:19:14Z", "message": "type check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNTU3MDA3", "url": "https://github.com/all-of-us/workbench/pull/4178#pullrequestreview-510557007", "createdAt": "2020-10-16T15:04:04Z", "commit": {"oid": "da8d340ec2e10d49cc38596c8b8573f9ebb5b874"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNTowNDowNFrOHjDrOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNToyMTozM1rOHjErRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUyMjQyNQ==", "bodyText": "I'm cool with using regular map but the lodash docs says that they do provide an index? https://lodash.com/docs/4.17.15#map", "url": "https://github.com/all-of-us/workbench/pull/4178#discussion_r506522425", "createdAt": "2020-10-16T15:04:04Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/analysis/runtime-panel.tsx", "diffHunk": "@@ -157,27 +150,72 @@ export const RuntimePanel = withCurrentWorkspace()(({workspace}) => {\n                     closeOnClick\n                     content={\n                       <React.Fragment>\n-                        <MenuItem style={styles.presetMenuItem}>General purpose analysis</MenuItem>\n-                        <MenuItem style={styles.presetMenuItem}>Genomics analysis</MenuItem>\n+                        {\n+                          fp.filter(['displayName', 'General Analysis'], runtimePresets)\n+                            // regular .map used here bc fp map won't provide index as an iteratee argument", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da8d340ec2e10d49cc38596c8b8573f9ebb5b874"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUzMzU2Nw==", "bodyText": "I didn't know filter could be used this way where it can be provided with a key/value pair. Is there another lodash function that does the same thing? I was confused because I'm very used to the filter API of .filter[collection, predicate]", "url": "https://github.com/all-of-us/workbench/pull/4178#discussion_r506533567", "createdAt": "2020-10-16T15:15:44Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/analysis/runtime-panel.tsx", "diffHunk": "@@ -157,27 +150,72 @@ export const RuntimePanel = withCurrentWorkspace()(({workspace}) => {\n                     closeOnClick\n                     content={\n                       <React.Fragment>\n-                        <MenuItem style={styles.presetMenuItem}>General purpose analysis</MenuItem>\n-                        <MenuItem style={styles.presetMenuItem}>Genomics analysis</MenuItem>\n+                        {\n+                          fp.filter(['displayName', 'General Analysis'], runtimePresets)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da8d340ec2e10d49cc38596c8b8573f9ebb5b874"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUzODgyMA==", "bodyText": "Although unlikely to happen, it's possible that this can pull the presetDiskSize from gceConfig and presetMachineName from the dataprocConfig or vice versa.", "url": "https://github.com/all-of-us/workbench/pull/4178#discussion_r506538820", "createdAt": "2020-10-16T15:21:33Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/analysis/runtime-panel.tsx", "diffHunk": "@@ -157,27 +150,72 @@ export const RuntimePanel = withCurrentWorkspace()(({workspace}) => {\n                     closeOnClick\n                     content={\n                       <React.Fragment>\n-                        <MenuItem style={styles.presetMenuItem}>General purpose analysis</MenuItem>\n-                        <MenuItem style={styles.presetMenuItem}>Genomics analysis</MenuItem>\n+                        {\n+                          fp.filter(['displayName', 'General Analysis'], runtimePresets)\n+                            // regular .map used here bc fp map won't provide index as an iteratee argument\n+                            .map((preset, i) => {\n+                              return <MenuItem\n+                                  style={styles.presetMenuItem}\n+                                  key={i}\n+                                  onClick={() => {\n+                                    // renaming to avoid shadowing\n+                                    const presetDiskSize =\n+                                        (preset.runtimeTemplate.gceConfig && preset.runtimeTemplate.gceConfig.bootDiskSize)\n+                                        || (preset.runtimeTemplate.dataprocConfig && preset.runtimeTemplate.dataprocConfig.masterDiskSize);\n+                                    const presetMachineName =\n+                                        (preset.runtimeTemplate.gceConfig && preset.runtimeTemplate.gceConfig.machineType)\n+                                        || (preset.runtimeTemplate.dataprocConfig && preset.runtimeTemplate.dataprocConfig.masterMachineType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da8d340ec2e10d49cc38596c8b8573f9ebb5b874"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4211d3914c86f9b1945effd33fb844fba913a8d7", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/4211d3914c86f9b1945effd33fb844fba913a8d7", "committedDate": "2020-10-16T15:42:48Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2b1e7d80a0dd0e1972b0e52314d499740ec8b89", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/a2b1e7d80a0dd0e1972b0e52314d499740ec8b89", "committedDate": "2020-10-16T20:16:09Z", "message": "make fp nicer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cbe33af71fec12f57fd968cab8d88d0df772ec3", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/9cbe33af71fec12f57fd968cab8d88d0df772ec3", "committedDate": "2020-10-16T20:20:07Z", "message": "make everything else nicer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da2c1266a75a4f23ed33d41945f3d294b5e10c1f", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/da2c1266a75a4f23ed33d41945f3d294b5e10c1f", "committedDate": "2020-10-16T20:35:23Z", "message": "lint will be the death of me"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODM4NTY5", "url": "https://github.com/all-of-us/workbench/pull/4178#pullrequestreview-510838569", "createdAt": "2020-10-16T22:56:40Z", "commit": {"oid": "da2c1266a75a4f23ed33d41945f3d294b5e10c1f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjo1Njo0MFrOHjR2wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjo1Njo0MFrOHjR2wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1NDc1Mg==", "bodyText": "Would invert this predicate, i.e. ![null, Deleted, Running, Stopped].includes(status). The set of valid statuses is unlikely to change over time without a conscious decision on our end - however, the set of invalid statuses might evolve over time and we may not remember to keep this file synchronized.\nThis is also an incorrect usage of the in keyword. x in o checks whether o has key x, so these string checks will never pass, but something like 'includes' in [] will pass.", "url": "https://github.com/all-of-us/workbench/pull/4178#discussion_r506754752", "createdAt": "2020-10-16T22:56:40Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/analysis/runtime-panel.tsx", "diffHunk": "@@ -191,12 +230,24 @@ export const RuntimePanel = withCurrentWorkspace()(({workspace}) => {\n     <FlexRow style={{justifyContent: 'flex-end', marginTop: '.75rem'}}>\n       <Button\n         aria-label={currentRuntime ? 'Update' : 'Create'}\n-        disabled={status !== RuntimeStatus.Running || !runtimeChanged}\n+        disabled={\n+          !runtimeChanged\n+          || status in [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2c1266a75a4f23ed33d41945f3d294b5e10c1f"}, "originalPosition": 131}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c182ebaff854099ae8b45b1053018d50ce39613f", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c182ebaff854099ae8b45b1053018d50ce39613f", "committedDate": "2020-10-19T14:43:26Z", "message": "restate status check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODA2MDc0", "url": "https://github.com/all-of-us/workbench/pull/4178#pullrequestreview-510806074", "createdAt": "2020-10-16T21:23:07Z", "commit": {"oid": "da2c1266a75a4f23ed33d41945f3d294b5e10c1f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMToyMzowN1rOHjQLfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMToyMzowN1rOHjQLfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcyNzI5NA==", "bodyText": "If you want to avoid the let you could use fp.cond, returning an object and destructuring out the variables.\nSomething like:\nconst {presetDiskSize, presetMachineName} = fp.cond([\n  [() => !!runtimeTemplate.gceConfig, ({gceConfig: {bootDiskSize, machineType}}) =>({\n    presetDiskSize: bootDiskSize,\n    presetMachineName: machineType\n  })],\n  [() => !!runtimeTemplate.dataprocConfig, ...]\n])(runtimeTemplate)\nThe above example uses on some additional destructuring in the map function signature", "url": "https://github.com/all-of-us/workbench/pull/4178#discussion_r506727294", "createdAt": "2020-10-16T21:23:07Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/analysis/runtime-panel.tsx", "diffHunk": "@@ -157,27 +150,73 @@ export const RuntimePanel = withCurrentWorkspace()(({workspace}) => {\n                     closeOnClick\n                     content={\n                       <React.Fragment>\n-                        <MenuItem style={styles.presetMenuItem}>General purpose analysis</MenuItem>\n-                        <MenuItem style={styles.presetMenuItem}>Genomics analysis</MenuItem>\n+                        {\n+                          fp.flow(\n+                            fp.filter(['displayName', 'General Analysis']),\n+                            fp.toPairs,\n+                            fp.map(([i, preset]) => {\n+                              return <MenuItem\n+                              style={styles.presetMenuItem}\n+                              key={i}\n+                              onClick={() => {\n+                                // renaming to avoid shadowing\n+                                let presetDiskSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2c1266a75a4f23ed33d41945f3d294b5e10c1f"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a967619f55fd47935996dcb10f01ac9fbb81ab2a", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/a967619f55fd47935996dcb10f01ac9fbb81ab2a", "committedDate": "2020-10-19T17:06:09Z", "message": "fp dot cond"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8160404236059391a5901d926cabae0c820a7ed2", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/8160404236059391a5901d926cabae0c820a7ed2", "committedDate": "2020-10-19T17:37:05Z", "message": "lint lint lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMDkyNTM3", "url": "https://github.com/all-of-us/workbench/pull/4178#pullrequestreview-512092537", "createdAt": "2020-10-19T19:29:43Z", "commit": {"oid": "8160404236059391a5901d926cabae0c820a7ed2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3978, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}