{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjQ2MjI4", "number": 3860, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxNzoyN1rOEVlLDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxNzoyN1rOEVlLDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMDY0NTg4OnYy", "diffSide": "RIGHT", "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxNzoyN1rOG8a9mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxODowMVrOG8a-mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwOTQ5OA==", "bodyText": "nit: I think it would read a little quicker if we specified that the size should be equal to 2. I was trying to figure this out earlier while I was reading.", "url": "https://github.com/all-of-us/workbench/pull/3860#discussion_r466009498", "createdAt": "2020-08-05T21:17:27Z", "author": {"login": "ericsong"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -140,30 +140,49 @@ protected Genotype randomizeGenotype(VariantContext variantContext, Genotype gen\n      */\n     List<Allele> alleles = new ArrayList<>();\n     double genotypeTypeIndex = random.nextDouble();\n-    if (genotypeTypeIndex < .0145) {\n-      // double no-call\n-      return alleles;\n-    } else if (genotypeTypeIndex < .8095) {\n-      // homref\n-      alleles.add(variantContext.getReference());\n-      alleles.add(variantContext.getReference());\n-    } else if (genotypeTypeIndex < .8654) {\n-      // 0/1 het\n-      alleles.add(variantContext.getReference());\n-      alleles.add(variantContext.getAlternateAllele(0));\n-    } else if (genotypeTypeIndex < .9268) {\n-      // 1/0 het\n-      alleles.add(variantContext.getAlternateAllele(0));\n-      alleles.add(variantContext.getReference());\n-    } else if (genotypeTypeIndex < .9994\n-        || (genotypeTypeIndex >= .9994 && variantContext.getAlternateAlleles().size() == 1)) {\n-      // homvar\n-      alleles.add(variantContext.getAlternateAllele(0));\n-      alleles.add(variantContext.getAlternateAllele(0));\n+    if (variantContext.getAlternateAlleles().size() == 1) {\n+      if (genotypeTypeIndex < .0145) {\n+        // double no-call\n+        alleles.add(Allele.NO_CALL);\n+        alleles.add(Allele.NO_CALL);\n+        return alleles;\n+      } else if (genotypeTypeIndex < .8095) {\n+        // homref\n+        alleles.add(variantContext.getReference());\n+        alleles.add(variantContext.getReference());\n+      } else if (genotypeTypeIndex < .8654) {\n+        // 0/1 het\n+        alleles.add(variantContext.getReference());\n+        alleles.add(variantContext.getAlternateAllele(0));\n+      } else if (genotypeTypeIndex < .9268) {\n+        // 1/0 het\n+        alleles.add(variantContext.getAlternateAllele(0));\n+        alleles.add(variantContext.getReference());\n+      } else {\n+        // homvar\n+        alleles.add(variantContext.getAlternateAllele(0));\n+        alleles.add(variantContext.getAlternateAllele(0));\n+      }\n     } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d640d1a3a68081edd4cfc34159df2f2c662f8e0"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwOTc1NA==", "bodyText": "that makes sense, I'll flip it around!", "url": "https://github.com/all-of-us/workbench/pull/3860#discussion_r466009754", "createdAt": "2020-08-05T21:18:01Z", "author": {"login": "als364"}, "path": "api/genomics/src/main/java/org/pmiops/workbench/genomics/RandomizeVcf.java", "diffHunk": "@@ -140,30 +140,49 @@ protected Genotype randomizeGenotype(VariantContext variantContext, Genotype gen\n      */\n     List<Allele> alleles = new ArrayList<>();\n     double genotypeTypeIndex = random.nextDouble();\n-    if (genotypeTypeIndex < .0145) {\n-      // double no-call\n-      return alleles;\n-    } else if (genotypeTypeIndex < .8095) {\n-      // homref\n-      alleles.add(variantContext.getReference());\n-      alleles.add(variantContext.getReference());\n-    } else if (genotypeTypeIndex < .8654) {\n-      // 0/1 het\n-      alleles.add(variantContext.getReference());\n-      alleles.add(variantContext.getAlternateAllele(0));\n-    } else if (genotypeTypeIndex < .9268) {\n-      // 1/0 het\n-      alleles.add(variantContext.getAlternateAllele(0));\n-      alleles.add(variantContext.getReference());\n-    } else if (genotypeTypeIndex < .9994\n-        || (genotypeTypeIndex >= .9994 && variantContext.getAlternateAlleles().size() == 1)) {\n-      // homvar\n-      alleles.add(variantContext.getAlternateAllele(0));\n-      alleles.add(variantContext.getAlternateAllele(0));\n+    if (variantContext.getAlternateAlleles().size() == 1) {\n+      if (genotypeTypeIndex < .0145) {\n+        // double no-call\n+        alleles.add(Allele.NO_CALL);\n+        alleles.add(Allele.NO_CALL);\n+        return alleles;\n+      } else if (genotypeTypeIndex < .8095) {\n+        // homref\n+        alleles.add(variantContext.getReference());\n+        alleles.add(variantContext.getReference());\n+      } else if (genotypeTypeIndex < .8654) {\n+        // 0/1 het\n+        alleles.add(variantContext.getReference());\n+        alleles.add(variantContext.getAlternateAllele(0));\n+      } else if (genotypeTypeIndex < .9268) {\n+        // 1/0 het\n+        alleles.add(variantContext.getAlternateAllele(0));\n+        alleles.add(variantContext.getReference());\n+      } else {\n+        // homvar\n+        alleles.add(variantContext.getAlternateAllele(0));\n+        alleles.add(variantContext.getAlternateAllele(0));\n+      }\n     } else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwOTQ5OA=="}, "originalCommit": {"oid": "7d640d1a3a68081edd4cfc34159df2f2c662f8e0"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2507, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}