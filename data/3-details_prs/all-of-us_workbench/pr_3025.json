{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NDUyMzg2", "number": 3025, "title": "[RW-4091][RISK=NO]Change content header for cloud task request TO APPLCIATION/JSON", "bodyText": "The cloud task was sending  application/octect-stream content-type header which was rejected by our application Hence changing the type to application/json. Since this is urgent the changes to yaml file and method file will be taken care in the next PR this PR will block the RDR flow to start sending researcher and workspace data to RDR", "createdAt": "2020-01-23T16:29:33Z", "url": "https://github.com/all-of-us/workbench/pull/3025", "merged": true, "mergeCommit": {"oid": "96a7feccdcf84dce511ce7688f778e3701ce06d2"}, "closed": true, "closedAt": "2020-01-23T17:08:45Z", "author": {"login": "NehaBroad"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8pKqEAH2gAyMzY2NDUyMzg2OjI2YTgxNzhkNjUwOWUyZDA4MDgxYTc4ZTYzYmJkNzRmY2VmNWVmZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9Nf0nAFqTM0NzQ2NDc5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "26a8178d6509e2d08081a78e63bbd74fcef5efd2", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/26a8178d6509e2d08081a78e63bbd74fcef5efd2", "committedDate": "2020-01-21T22:48:08Z", "message": "Interceptor for Cloud task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f955a912ea817bb77e6e93e7fa7dae782a49051", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7f955a912ea817bb77e6e93e7fa7dae782a49051", "committedDate": "2020-01-21T23:08:05Z", "message": "removing unwanted code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64aede134dcf08d47cb6ef1febbe14e4a2f05dda", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/64aede134dcf08d47cb6ef1febbe14e4a2f05dda", "committedDate": "2020-01-21T23:33:10Z", "message": "add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e537a46f4d6720de3daf2ef5523738cbfed9947a", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e537a46f4d6720de3daf2ef5523738cbfed9947a", "committedDate": "2020-01-22T21:40:07Z", "message": "Push correct java test file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "894f942e821d1544029eef7384b809fb2640ca0a", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/894f942e821d1544029eef7384b809fb2640ca0a", "committedDate": "2020-01-23T13:49:49Z", "message": "Spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f82b2faced155bc5ebf665e2f6f60243f15d8a90", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f82b2faced155bc5ebf665e2f6f60243f15d8a90", "committedDate": "2020-01-23T16:26:41Z", "message": "change contenty-type for cloud task to json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e27504b7e4baf5dbf02f5a27cfb645961929b918", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e27504b7e4baf5dbf02f5a27cfb645961929b918", "committedDate": "2020-01-23T16:32:37Z", "message": "rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDQ3NDE2", "url": "https://github.com/all-of-us/workbench/pull/3025#pullrequestreview-347447416", "createdAt": "2020-01-23T16:43:39Z", "commit": {"oid": "e27504b7e4baf5dbf02f5a27cfb645961929b918"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNjo0MzozOVrOFhFJNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNjo0MzozOVrOFhFJNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIzMTYwNQ==", "bodyText": "Is there a reason to do this ByteString conversion? With us moving to JSON, I would expect this to pass in a json.toString style thing, rather than a bytestring conversion? Do we need to do this for the AppEngineHttpRequest? (Or will it implicitly handle the conversion from string to encoded string?)\n(Also, do you know where the docs for this are? All I've found is https://developers.google.com/resources/api-libraries/documentation/cloudtasks/v2/java/latest/com/google/api/services/cloudtasks/v2/model/AppEngineHttpRequest.html#setBody-java.lang.String- or https://cloud.google.com/appengine/docs/python/taskqueue/push/creating-handlers#reading_request_headers which doesn't have a putHeaders method or a builder method)", "url": "https://github.com/all-of-us/workbench/pull/3025#discussion_r370231605", "createdAt": "2020-01-23T16:43:39Z", "author": {"login": "s-rubenstein"}, "path": "api/src/main/java/org/pmiops/workbench/api/OfflineRdrExportController.java", "diffHunk": "@@ -108,18 +109,20 @@ private void groupIdsAndPushTask(List<Long> idList, String taskUri) {\n \n   private void createAndPushTask(List<Long> ids, String queuePath, String taskUri) {\n     List<String> idsAsString = ids.stream().map(id -> id.toString()).collect(Collectors.toList());\n+    Gson gson = new Gson();\n+    String daysJson = gson.toJson(ids);\n     try (CloudTasksClient client = CloudTasksClient.create()) {\n       String commaSepList = String.join(IDS_STRING_SPLIT, idsAsString);\n-      Task.Builder taskBuilder =\n-          Task.newBuilder()\n-              .setAppEngineHttpRequest(\n-                  AppEngineHttpRequest.newBuilder()\n-                      .setRelativeUri(taskUri)\n-                      .setBody(ByteString.copyFrom(commaSepList.getBytes()))\n-                      .setHttpMethod(HttpMethod.POST)\n-                      .build());\n+      AppEngineHttpRequest req =\n+          AppEngineHttpRequest.newBuilder()\n+              .setRelativeUri(taskUri)\n+              .setBody(ByteString.copyFromUtf8(daysJson))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e27504b7e4baf5dbf02f5a27cfb645961929b918"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDY0Nzky", "url": "https://github.com/all-of-us/workbench/pull/3025#pullrequestreview-347464792", "createdAt": "2020-01-23T17:07:50Z", "commit": {"oid": "e27504b7e4baf5dbf02f5a27cfb645961929b918"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3718, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}