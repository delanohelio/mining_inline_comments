{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTM0NzM1", "number": 3194, "title": "[risk=low]Partial completion of RW-4161 Verified Inst Affil UI", "bodyText": "Description:\nAdds the Verified Institutional Affiliation flow to the Profile and Account Creation pages, and removes the older pre-verification I.A. flow.\nDisabled by default.  Set the Feature Flag requireInstitutionalVerification to enable.\nINCOMPLETE!  TODO:\n\nRW-4523 Unit test updates\nRW-4524 Change the Account Creation flow from 2 screens to 3.  This PR has the new Step 1 on the same page above the old Step 1 (new Step 2)\nRW-4524 Currently only validates email at createUser() time at the end of the process.  This is not desired.  We want to do so at the end of Step 1 - which may require a new endpoint.\nRW-4525 Finer touches of layout/CSS to match mocks\nRW-4525 Broken layout for \"about you\" due to removal of the email element\n\nI'm going away for a few weeks so I won't be able to work on this PR.  Since it's feature flagged, I would like us to merge in this rough state, with fixes for the TODOs in future PRs.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-02-26T22:15:03Z", "url": "https://github.com/all-of-us/workbench/pull/3194", "merged": true, "mergeCommit": {"oid": "5395515918b403f46c7e50166f8fb1b153e3e312"}, "closed": true, "closedAt": "2020-02-28T20:45:28Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIOWyLAFqTM2NTI4NzMyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI1-NwAFqTM2NjY2Njk2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Mjg3MzIw", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365287320", "createdAt": "2020-02-26T22:21:01Z", "commit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyMTowMlrOFu-gyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyMTowMlrOFu-gyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwMzAxOA==", "bodyText": "new flow will have 3 pages", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r384803018", "createdAt": "2020-02-26T22:21:02Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.tsx", "diffHunk": "@@ -121,10 +113,11 @@ export class AccountCreationSurvey extends React.Component<AccountCreationSurvey\n       },\n     };\n     const errors = validate(demographicSurvey, validationCheck);\n+    const {requireInstitutionalVerification} = serverConfigStore.getValue();\n \n     return <div style={{marginTop: '1rem', paddingLeft: '3rem', width: '26rem'}}>\n       <label style={{color: colors.primary, fontSize: 16}}>\n-        Please complete Step 2 of 2\n+        Please complete Step {requireInstitutionalVerification ? '3 of 3' : '2 of 2'}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Mjg4OTE2", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365288916", "createdAt": "2020-02-26T22:23:55Z", "commit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyMzo1NVrOFu-mJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyMzo1NVrOFu-mJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNDM4OQ==", "bodyText": "Moved to top-level from elsewhere in this file", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r384804389", "createdAt": "2020-02-26T22:23:55Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/sign-in.tsx", "diffHunk": "@@ -128,6 +129,47 @@ interface SignInState {\n   termsOfServiceVersion?: number;\n }\n \n+export const createEmptyProfile = (requireInstitutionalVerification: boolean): Profile => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjkxODMz", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365291833", "createdAt": "2020-02-26T22:29:07Z", "commit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyOTowN1rOFu-vew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyOTowN1rOFu-vew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNjc3OQ==", "bodyText": "moved inside render() which is the only place it's used", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r384806779", "createdAt": "2020-02-26T22:29:07Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -327,23 +367,33 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n   }\n \n   updateInstitutionAffiliation(attribute: string, value) {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    const {requireInstitutionalVerification} = serverConfigStore.getValue();\n+    if (requireInstitutionalVerification) {\n+      this.setState(fp.set(['profile', 'verifiedInstitutionalAffiliation', attribute], value));\n+    } else {\n+      this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    }\n   }\n \n-  showFreeTextField(option) {\n-    return option === NonAcademicAffiliation.FREETEXT || option === IndustryRole.FREETEXT ||\n-        option === EducationalRole.FREETEXT;\n+  // cannot destructure because verifiedInstitutionalAffiliation may not be defined\n+  // todo is this a code smell?\n+  getVerifiedInstitutionalAffiliationAttribute(attribute: string) {\n+    const {verifiedInstitutionalAffiliation} = this.state.profile;\n+    if (!verifiedInstitutionalAffiliation) {\n+      return undefined;\n+    } else {\n+      return verifiedInstitutionalAffiliation[attribute];\n+    }\n   }\n \n-  clearInstitutionAffiliation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "originalPosition": 202}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjkyMjM4", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365292238", "createdAt": "2020-02-26T22:29:55Z", "commit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyOTo1NlrOFu-w5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyOTo1NlrOFu-w5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNzE0MA==", "bodyText": "moved from inline in render()", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r384807140", "createdAt": "2020-02-26T22:29:56Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -474,14 +541,145 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n \n     const errors = this.validateAccountCreation();\n \n+    // TODO remove after we switch to verified institutional affiliation\n+    const clearInstitutionAffiliation = () => {\n+      this.setState(fp.set(['profile', 'institutionalAffiliations', '0'], {\n+        nonAcademicAffiliation: null,\n+        role: '',\n+        institution: '',\n+        other: ''\n+      }));\n+    };\n+\n+    const renderVerifiedInstitutionalAffiliation = () => {\n+      if (!requireInstitutionalVerification) {\n+        return;\n+      }\n+\n+      const {institutionList} = this.state;\n+      const institutionShortName = this.getVerifiedInstitutionalAffiliationAttribute('institutionShortName');\n+      const institutionalRoleEnum = this.getVerifiedInstitutionalAffiliationAttribute('institutionalRoleEnum');\n+      const institutionalRoleOtherText = this.getVerifiedInstitutionalAffiliationAttribute('institutionalRoleOtherText');\n+\n+      return <React.Fragment>\n+        <FlexColumn style={{marginTop: '0.5rem'}}>\n+          <div style={{...styles.text, fontSize: 16}}>\n+            Please complete Step 1 of 3\n+          </div>\n+          <div style={{...styles.text, fontSize: 16, marginTop: '0.5rem'}}>\n+            For access to the <i>All of Us</i> Research Program data, your institution needs to have signed a Data Use Agreement\n+            with the program. The institutions listed below have an Institutional Data Use Agreement with the program that\n+            enables us to provide their researchers with access to the Workbench.\n+          </div>\n+          <div style={{...styles.text, fontSize: 12, marginTop: '0.5rem'}}>All fields required unless indicated as optional</div>\n+          <label style={{...styles.text, fontWeight: 600, marginTop: '0.5rem'}}>Select your institution\n+            <i style={{...styles.publiclyDisplayedText, marginLeft: '0.2rem'}}>Publicly displayed</i>\n+          </label>\n+          <div style={{...styles.text, fontSize: 16}}>\n+            Your institution will be notified that you have registered using your institutional credentials.</div>\n+          <Dropdown options={institutionList.map(inst => ({'value': inst.shortName, 'label': inst.displayName}))}\n+                    value={institutionShortName}\n+                    onChange={(e) => this.updateInstitutionAffiliation('institutionShortName', e.value)}/>\n+          <a href={'https://www.researchallofus.org/apply/'} target='_blank' style={{color: colors.accent}}>\n+            Don't see your institution listed?\n+          </a>\n+          <TextInputWithLabel style={{marginTop: '1rem'}}\n+                              value={contactEmail} inputId='contactEmail' inputName='contactEmail'\n+                              labelText='Your institutional email address'\n+                              invalid={this.state.invalidEmail}\n+                              onChange={v => this.updateProfileObject('contactEmail', v)}/>\n+          {!requireInstitutionalVerification && this.state.invalidEmail &&\n+          <ErrorDiv id='invalidEmailError'>\n+            Contact Email is invalid\n+          </ErrorDiv>}\n+          <label style={{...styles.text, fontWeight: 600, marginTop: '1rem'}}>Which of the following best describes your role?\n+            <i style={{...styles.publiclyDisplayedText, marginLeft: '0.2rem'}}>Publicly displayed</i>\n+          </label>\n+          <Dropdown options={this.roleMapForSelectedInstitution}\n+                    value={institutionalRoleEnum}\n+                    onChange={(e) => this.updateInstitutionAffiliation('institutionalRoleEnum', e.value)}/>\n+          {institutionalRoleEnum === InstitutionalRole.OTHER && <React.Fragment>\n+            <label style={{...styles.text, fontWeight: 600, marginTop: '1rem'}}>Please describe your role\n+              <i style={{...styles.publiclyDisplayedText, marginLeft: '0.2rem'}}>Publicly displayed</i>\n+            </label>\n+            <TextInputWithLabel value={institutionalRoleOtherText} inputId='institutionalRoleOtherText' inputName='institutionalRoleOtherText'\n+                                onChange={v => this.updateInstitutionAffiliation('institutionalRoleOtherText', v)}/>\n+          </React.Fragment>}\n+        </FlexColumn>\n+      </React.Fragment>;\n+    };\n+\n+    // TODO remove after we switch to verified institutional affiliation\n+    const renderOldInstitutionalAffiliation = () => {\n+      if (requireInstitutionalVerification) {\n+        return;\n+      }\n+\n+      return <React.Fragment>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "originalPosition": 420}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjkyNTg4", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365292588", "createdAt": "2020-02-26T22:30:34Z", "commit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjozMDozNVrOFu-yCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjozMDozNVrOFu-yCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNzQzNQ==", "bodyText": "email is now part of step 1 because it depends on the inst affil", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r384807435", "createdAt": "2020-02-26T22:30:35Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -529,12 +727,14 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n                   Last Name must be {nameLength} character or less.\n                 </ErrorMessage>}\n               </FlexRow>\n-              <FlexRow style={{alignItems: 'center'}}>\n-                <TextInputWithLabel value={contactEmail} inputId='contactEmail' inputName='contactEmail'\n-                                    placeholder='Email Address'\n-                                    invalid={this.state.invalidEmail} labelText='Email Address'\n-                                    onChange={v => this.updateProfileObject('contactEmail', v)}/>\n-                {this.state.invalidEmail &&\n+              <FlexRow style={{alignItems: 'left'}}>\n+                {/* TODO remove after we switch to verified institutional affiliation */}\n+                {!requireInstitutionalVerification &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be0340086ce78ebc178e6a5ef8ac1a0bd35c96aa"}, "originalPosition": 510}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5395b35176c0bd82e9070c44edb967ad5a618914", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/5395b35176c0bd82e9070c44edb967ad5a618914", "committedDate": "2020-02-27T16:01:15Z", "message": "VerifiedInstitutionalAffiliation profile page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3268749b34186a3eb6f1f30cd1383d11b424f7e7", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/3268749b34186a3eb6f1f30cd1383d11b424f7e7", "committedDate": "2020-02-27T16:01:15Z", "message": "Account Creation page w/ Institutional Affiliation\n\nupdate createEmptyProfile to only add instAffils for the old flow\n- replace getEmptyProfile with createEmptyProfile\n\nsign-in spec test for requireInstitutionalVerification = true"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06fd8e515d63156938ea18a3e746a6aed9c01d3f", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/06fd8e515d63156938ea18a3e746a6aed9c01d3f", "committedDate": "2020-02-27T16:01:15Z", "message": "TODO text for account-creation.spec.tsx\nand small fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "316a07a6e8cff4dbed01a2d688e4bd55ef2440f8", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/316a07a6e8cff4dbed01a2d688e4bd55ef2440f8", "committedDate": "2020-02-27T16:01:15Z", "message": "refactor a bit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f845da2ce980171b62a46d882916be10ffac04e9", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f845da2ce980171b62a46d882916be10ffac04e9", "committedDate": "2020-02-27T16:01:15Z", "message": "test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f10acb3bbe7fe964337c81edcfd9ef12abf64794", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f10acb3bbe7fe964337c81edcfd9ef12abf64794", "committedDate": "2020-02-27T16:01:15Z", "message": "lint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5957747b5572230685717f42595a1f5dee5cb08", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/c5957747b5572230685717f42595a1f5dee5cb08", "committedDate": "2020-02-26T22:43:21Z", "message": "lint"}, "afterCommit": {"oid": "f10acb3bbe7fe964337c81edcfd9ef12abf64794", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f10acb3bbe7fe964337c81edcfd9ef12abf64794", "committedDate": "2020-02-27T16:01:15Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/301e290c4a7cade4f3f0919665abd465472a7391", "committedDate": "2020-02-27T16:49:25Z", "message": "small testing updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODMwNDIx", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365830421", "createdAt": "2020-02-27T16:57:32Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1NzozMlrOFvZPCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1NzozMlrOFvZPCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MDg0Mw==", "bodyText": "This is mostly a copy of the old-flow roles but not quite, so I'm making a clean break and deleting the old ones later, as planned here: https://docs.google.com/document/d/1qrTwj2-YH3-r_nAveQnY75L5GCLuaBwqfwSciiF4p3M/edit#bookmark=id.3ah876rsgvdu", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385240843", "createdAt": "2020-02-27T16:57:32Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation-options.tsx", "diffHunk": "@@ -59,6 +63,80 @@ export const AccountCreationOptions = {\n     {label: 'Administrator', value: EducationalRole.ADMIN},\n     {label: 'Other (free text)', value: EducationalRole.FREETEXT}\n   ],\n+  // END roles and affiliations for old (pre-verification) institutional affiliation\n+  // BEGIN roles for verified institutional affiliation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODMxMjY0", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365831264", "createdAt": "2020-02-27T16:58:33Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1ODozM1rOFvZRgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1ODozM1rOFvZRgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MTQ3NQ==", "bodyText": "Object.values() turns them into strings instead, oh well", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385241475", "createdAt": "2020-02-27T16:58:33Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation-options.tsx", "diffHunk": "@@ -59,6 +63,80 @@ export const AccountCreationOptions = {\n     {label: 'Administrator', value: EducationalRole.ADMIN},\n     {label: 'Other (free text)', value: EducationalRole.FREETEXT}\n   ],\n+  // END roles and affiliations for old (pre-verification) institutional affiliation\n+  // BEGIN roles for verified institutional affiliation\n+  institutionalRoles: [\n+    {label: `Undergraduate (Bachelor level) student`,\n+      value: InstitutionalRole.UNDERGRADUATE},\n+    {label: `Graduate trainee (Current student in a Masters, PhD, or Medical school training program)`,\n+      value: InstitutionalRole.TRAINEE},\n+    {label: `Research fellow (a post-doctoral fellow or medical resident in training)`,\n+      value: InstitutionalRole.FELLOW},\n+    {label: `Early career tenure-track researcher`,\n+      value: InstitutionalRole.EARLYCAREER},\n+    {label: `Mid-career tenured researcher`,\n+      value: InstitutionalRole.MIDCAREER},\n+    {label: `Late career tenured researcher`,\n+      value: InstitutionalRole.LATECAREER},\n+    {label: `Project Personnel (eg: Research Assistant, Data Analyst, Project Manager, Research Coordinator or other roles)`,\n+      value: InstitutionalRole.PROJECTPERSONNEL},\n+    {label: 'Research Assistant (pre-doctoral)',\n+      value: InstitutionalRole.PREDOCTORAL},\n+    {label: 'Research associate (post-doctoral; early/mid career)',\n+      value: InstitutionalRole.POSTDOCTORAL},\n+    {label: 'Senior Researcher (PI/Team Lead, senior scientist)',\n+      value: InstitutionalRole.SENIORRESEARCHER},\n+    {label: 'Teacher/Instructor/Professor',\n+      value: InstitutionalRole.TEACHER},\n+    {label: 'Student',\n+      value: InstitutionalRole.STUDENT},\n+    {label: 'Administrator',\n+      value: InstitutionalRole.ADMIN},\n+    {label: 'Other (free text)',\n+      value: InstitutionalRole.OTHER},\n+  ],\n+  institutionalRolesByOrganizationType: [\n+    {type: OrganizationType.ACADEMICRESEARCHINSTITUTION,\n+      roles: [\n+        InstitutionalRole.UNDERGRADUATE,\n+        InstitutionalRole.TRAINEE,\n+        InstitutionalRole.FELLOW,\n+        InstitutionalRole.EARLYCAREER,\n+        InstitutionalRole.MIDCAREER,\n+        InstitutionalRole.LATECAREER,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.INDUSTRY,\n+      // identical to the HEALTHCENTERNONPROFIT roles\n+      roles: [\n+        InstitutionalRole.PREDOCTORAL,\n+        InstitutionalRole.POSTDOCTORAL,\n+        InstitutionalRole.SENIORRESEARCHER,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.HEALTHCENTERNONPROFIT,\n+      // identical to the INDUSTRY roles\n+      roles: [\n+        InstitutionalRole.PREDOCTORAL,\n+        InstitutionalRole.POSTDOCTORAL,\n+        InstitutionalRole.SENIORRESEARCHER,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.EDUCATIONALINSTITUTION,\n+      roles: [\n+        InstitutionalRole.TEACHER,\n+        InstitutionalRole.STUDENT,\n+        InstitutionalRole.ADMIN,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.OTHER,\n+      // display all roles for OTHER\n+      roles: Object.keys(InstitutionalRole).map(k => InstitutionalRole[k])}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODMyNDMx", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365832431", "createdAt": "2020-02-27T16:59:50Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1OTo1MFrOFvZU5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1OTo1MFrOFvZU5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MjM0MQ==", "bodyText": "deleted test-utils.  It had only this, which was a test-only copy of the real fn createEmptyProfile", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385242341", "createdAt": "2020-02-27T16:59:50Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.spec.tsx", "diffHunk": "@@ -5,9 +5,9 @@ import {\n   AccountCreationSurvey,\n   AccountCreationSurveyProps,\n } from 'app/pages/login/account-creation/account-creation-survey';\n-import {getEmptyProfile} from 'app/pages/login/test-utils';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODMzODg5", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365833889", "createdAt": "2020-02-27T17:01:46Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzowMTo0NlrOFvZZZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzowMTo0NlrOFvZZZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MzQ5Mg==", "bodyText": "aside: this data-test-id should actually be \"institution-name\".  I don't understand why this test passes.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385243492", "createdAt": "2020-02-27T17:01:46Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.spec.tsx", "diffHunk": "@@ -123,8 +126,9 @@ it('should handle invalid Email', () => {\n   expect(wrapper.exists('#invalidEmailError')).toBeFalsy();\n });\n \n+// TODO remove after we switch to verified institutional affiliation\n it('should display Institution name and role option by default', () => {\n-  serverConfigStore.next({...defaultConfig, enableNewAccountCreation: true});\n+  serverConfigStore.next({...defaultConfig, enableNewAccountCreation: true, requireInstitutionalVerification: false});\n   const wrapper = component();\n   const institutionName = wrapper.find('[data-test-id=\"institutionname\"]');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODQ0NDc0", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365844474", "createdAt": "2020-02-27T17:15:08Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxNTowOFrOFvZ5Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxNTowOFrOFvZ5Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1MTYwNg==", "bodyText": "moved from render()", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385251606", "createdAt": "2020-02-27T17:15:08Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/sign-in.tsx", "diffHunk": "@@ -128,6 +129,47 @@ interface SignInState {\n   termsOfServiceVersion?: number;\n }\n \n+export const createEmptyProfile = (requireInstitutionalVerification: boolean = false): Profile => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODQ1OTk0", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365845994", "createdAt": "2020-02-27T17:17:11Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxNzoxMVrOFvZ9sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxNzoxMVrOFvZ9sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1Mjc4Ng==", "bodyText": "these 2 are pulled out and made more explicit from their original contexts, which has itself been pulled out to renderOldInstitutionalAffiliationComponents()", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385252786", "createdAt": "2020-02-27T17:17:11Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/profile/profile-page.tsx", "diffHunk": "@@ -157,11 +166,98 @@ export const ProfilePage = withUserProfile()(class extends React.Component<\n       </div>;\n     };\n \n+    const removeOldInstitutionalAffiliation = (affiliation: InstitutionalAffiliation) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODQ2NjI2", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365846626", "createdAt": "2020-02-27T17:18:05Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxODowNVrOFvZ_jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxODowNVrOFvZ_jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1MzI2MQ==", "bodyText": "Earlier discussion on a draft version of this at #3181", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385253261", "createdAt": "2020-02-27T17:18:05Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/profile/profile-page.tsx", "diffHunk": "@@ -157,11 +166,98 @@ export const ProfilePage = withUserProfile()(class extends React.Component<\n       </div>;\n     };\n \n+    const removeOldInstitutionalAffiliation = (affiliation: InstitutionalAffiliation) => {\n+      this.setState(fp.update(\n+        ['profileEdits', 'institutionalAffiliations'],\n+        fp.pull(affiliation)\n+      ));\n+    };\n+\n+    const addEmptyOldInstitutionalAffiliation = () => {\n+      this.setState(fp.update(\n+        ['profileEdits', 'institutionalAffiliations'],\n+        affiliation => fp.concat(affiliation, {institution: '', role: ''})));\n+    };\n+\n+    const renderVerifiedInstitutionalAffiliationComponents = () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODUxMjA4", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365851208", "createdAt": "2020-02-27T17:24:14Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoyNDoxNFrOFvaNcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoyNDoxNFrOFvaNcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1NjgxNw==", "bodyText": "moved from render()", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385256817", "createdAt": "2020-02-27T17:24:14Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/profile/profile-page.tsx", "diffHunk": "@@ -157,11 +166,98 @@ export const ProfilePage = withUserProfile()(class extends React.Component<\n       </div>;\n     };\n \n+    const removeOldInstitutionalAffiliation = (affiliation: InstitutionalAffiliation) => {\n+      this.setState(fp.update(\n+        ['profileEdits', 'institutionalAffiliations'],\n+        fp.pull(affiliation)\n+      ));\n+    };\n+\n+    const addEmptyOldInstitutionalAffiliation = () => {\n+      this.setState(fp.update(\n+        ['profileEdits', 'institutionalAffiliations'],\n+        affiliation => fp.concat(affiliation, {institution: '', role: ''})));\n+    };\n+\n+    const renderVerifiedInstitutionalAffiliationComponents = () => {\n+      const {verifiedInstitutionalAffiliation} = profile;\n+      if (!verifiedInstitutionalAffiliation) {\n+        return;\n+      }\n+\n+      const {institutionDisplayName, institutionalRoleEnum, institutionalRoleOtherText} = verifiedInstitutionalAffiliation;\n+      return <React.Fragment>\n+        <div style={{...styles.h1, marginBottom: 24}}>Verified Institutional Affiliation</div>\n+        <FlexRow>\n+          <FlexColumn>\n+            <div style={styles.inputLabel}>Institution</div>\n+            <div style={styles.uneditableProfileElement}>{institutionDisplayName}</div>\n+          </FlexColumn>\n+          <FlexColumn>\n+            <div style={styles.inputLabel}>Role</div>\n+            <div style={styles.uneditableProfileElement}>\n+            {institutionalRoleEnum === InstitutionalRole.OTHER ? institutionalRoleOtherText : institutionalRoleEnum}\n+            </div>\n+          </FlexColumn>\n+        </FlexRow>\n+      </React.Fragment>;\n+    };\n+\n+    const renderOldInstitutionalAffiliationComponents = () => {\n+      return <React.Fragment>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODUyMzUw", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365852350", "createdAt": "2020-02-27T17:25:35Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoyNTozNlrOFvaQVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoyNTozNlrOFvaQVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1NzU1Ng==", "bodyText": "I'm guessing the linter did this", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385257556", "createdAt": "2020-02-27T17:25:36Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -1,10 +1,7 @@\n import {Button} from 'app/components/buttons';\n import {FormSection} from 'app/components/forms';\n \n-import {\n-  InfoIcon,\n-  ValidationIcon\n-} from 'app/components/icons';\n+import {InfoIcon, ValidationIcon} from 'app/components/icons';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODcwMjEx", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365870211", "createdAt": "2020-02-27T17:49:06Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0OTowNlrOFvbEiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0OTowNlrOFvbEiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MDkyMA==", "bodyText": "am I doing crimes?", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385270920", "createdAt": "2020-02-27T17:49:06Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -327,23 +367,33 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n   }\n \n   updateInstitutionAffiliation(attribute: string, value) {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    const {requireInstitutionalVerification} = serverConfigStore.getValue();\n+    if (requireInstitutionalVerification) {\n+      this.setState(fp.set(['profile', 'verifiedInstitutionalAffiliation', attribute], value));\n+    } else {\n+      this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    }\n   }\n \n-  showFreeTextField(option) {\n-    return option === NonAcademicAffiliation.FREETEXT || option === IndustryRole.FREETEXT ||\n-        option === EducationalRole.FREETEXT;\n+  // TODO remove after we switch to verified institutional affiliation\n+  showInstitutionAffiliationFreeTextField(option) {\n+    return option === NonAcademicAffiliation.FREETEXT ||\n+      option === IndustryRole.FREETEXT ||\n+      option === EducationalRole.FREETEXT;\n   }\n \n-  clearInstitutionAffiliation() {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0'], {\n-      nonAcademicAffiliation: null,\n-      role: '',\n-      institution: '',\n-      other: ''\n-    }));\n+  // cannot destructure because verifiedInstitutionalAffiliation may not be defined\n+  // todo is this a code smell?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 206}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODcwNzM3", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365870737", "createdAt": "2020-02-27T17:49:47Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0OTo0N1rOFvbGLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0OTo0N1rOFvbGLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MTM0MA==", "bodyText": "moved to the else below", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385271340", "createdAt": "2020-02-27T17:49:47Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -384,15 +434,14 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n   validateAccountCreation() {\n     const {\n       showInstitution,\n-      profile: { givenName, familyName, contactEmail, areaOfResearch, degrees, username,\n-        address: {streetAddress1, city, country, state, zipCode}, institutionalAffiliations\n+      profile: {\n+        givenName, familyName, contactEmail, areaOfResearch, degrees, username,\n+        address: { streetAddress1, city, country, state, zipCode },\n+        // TODO remove after we switch to verified institutional affiliation\n+        institutionalAffiliations,\n       }\n     } = this.state;\n-\n-    let institution, nonAcademicAffiliation, role;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 259}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODk3MzQ1", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-365897345", "createdAt": "2020-02-27T18:29:37Z", "commit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoyOTozN1rOFvcX_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTo1MToyMlrOFv5sgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI5MjI4NA==", "bodyText": "booooo javascriiiiipt", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385292284", "createdAt": "2020-02-27T18:29:37Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation-options.tsx", "diffHunk": "@@ -59,6 +63,80 @@ export const AccountCreationOptions = {\n     {label: 'Administrator', value: EducationalRole.ADMIN},\n     {label: 'Other (free text)', value: EducationalRole.FREETEXT}\n   ],\n+  // END roles and affiliations for old (pre-verification) institutional affiliation\n+  // BEGIN roles for verified institutional affiliation\n+  institutionalRoles: [\n+    {label: `Undergraduate (Bachelor level) student`,\n+      value: InstitutionalRole.UNDERGRADUATE},\n+    {label: `Graduate trainee (Current student in a Masters, PhD, or Medical school training program)`,\n+      value: InstitutionalRole.TRAINEE},\n+    {label: `Research fellow (a post-doctoral fellow or medical resident in training)`,\n+      value: InstitutionalRole.FELLOW},\n+    {label: `Early career tenure-track researcher`,\n+      value: InstitutionalRole.EARLYCAREER},\n+    {label: `Mid-career tenured researcher`,\n+      value: InstitutionalRole.MIDCAREER},\n+    {label: `Late career tenured researcher`,\n+      value: InstitutionalRole.LATECAREER},\n+    {label: `Project Personnel (eg: Research Assistant, Data Analyst, Project Manager, Research Coordinator or other roles)`,\n+      value: InstitutionalRole.PROJECTPERSONNEL},\n+    {label: 'Research Assistant (pre-doctoral)',\n+      value: InstitutionalRole.PREDOCTORAL},\n+    {label: 'Research associate (post-doctoral; early/mid career)',\n+      value: InstitutionalRole.POSTDOCTORAL},\n+    {label: 'Senior Researcher (PI/Team Lead, senior scientist)',\n+      value: InstitutionalRole.SENIORRESEARCHER},\n+    {label: 'Teacher/Instructor/Professor',\n+      value: InstitutionalRole.TEACHER},\n+    {label: 'Student',\n+      value: InstitutionalRole.STUDENT},\n+    {label: 'Administrator',\n+      value: InstitutionalRole.ADMIN},\n+    {label: 'Other (free text)',\n+      value: InstitutionalRole.OTHER},\n+  ],\n+  institutionalRolesByOrganizationType: [\n+    {type: OrganizationType.ACADEMICRESEARCHINSTITUTION,\n+      roles: [\n+        InstitutionalRole.UNDERGRADUATE,\n+        InstitutionalRole.TRAINEE,\n+        InstitutionalRole.FELLOW,\n+        InstitutionalRole.EARLYCAREER,\n+        InstitutionalRole.MIDCAREER,\n+        InstitutionalRole.LATECAREER,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.INDUSTRY,\n+      // identical to the HEALTHCENTERNONPROFIT roles\n+      roles: [\n+        InstitutionalRole.PREDOCTORAL,\n+        InstitutionalRole.POSTDOCTORAL,\n+        InstitutionalRole.SENIORRESEARCHER,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.HEALTHCENTERNONPROFIT,\n+      // identical to the INDUSTRY roles\n+      roles: [\n+        InstitutionalRole.PREDOCTORAL,\n+        InstitutionalRole.POSTDOCTORAL,\n+        InstitutionalRole.SENIORRESEARCHER,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.EDUCATIONALINSTITUTION,\n+      roles: [\n+        InstitutionalRole.TEACHER,\n+        InstitutionalRole.STUDENT,\n+        InstitutionalRole.ADMIN,\n+        InstitutionalRole.PROJECTPERSONNEL,\n+        InstitutionalRole.OTHER,\n+      ]},\n+    {type: OrganizationType.OTHER,\n+      // display all roles for OTHER\n+      roles: Object.keys(InstitutionalRole).map(k => InstitutionalRole[k])}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MTQ3NQ=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI5MjUyNg==", "bodyText": "does it make sense to delete that actual function?", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385292526", "createdAt": "2020-02-27T18:30:04Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation-survey.spec.tsx", "diffHunk": "@@ -5,9 +5,9 @@ import {\n   AccountCreationSurvey,\n   AccountCreationSurveyProps,\n } from 'app/pages/login/account-creation/account-creation-survey';\n-import {getEmptyProfile} from 'app/pages/login/test-utils';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MjM0MQ=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0MjE4MQ==", "bodyText": "weird. does it still work if you fix the query here?", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385342181", "createdAt": "2020-02-27T20:03:49Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.spec.tsx", "diffHunk": "@@ -123,8 +126,9 @@ it('should handle invalid Email', () => {\n   expect(wrapper.exists('#invalidEmailError')).toBeFalsy();\n });\n \n+// TODO remove after we switch to verified institutional affiliation\n it('should display Institution name and role option by default', () => {\n-  serverConfigStore.next({...defaultConfig, enableNewAccountCreation: true});\n+  serverConfigStore.next({...defaultConfig, enableNewAccountCreation: true, requireInstitutionalVerification: false});\n   const wrapper = component();\n   const institutionName = wrapper.find('[data-test-id=\"institutionname\"]');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MzQ5Mg=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0NDA5Ng==", "bodyText": "Can you write some tests for if the flag is switched on?", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385344096", "createdAt": "2020-02-27T20:07:56Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.spec.tsx", "diffHunk": "@@ -123,8 +126,9 @@ it('should handle invalid Email', () => {\n   expect(wrapper.exists('#invalidEmailError')).toBeFalsy();\n });\n \n+// TODO remove after we switch to verified institutional affiliation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0NDIyNQ==", "bodyText": "it does things like this.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385344225", "createdAt": "2020-02-27T20:08:11Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -1,10 +1,7 @@\n import {Button} from 'app/components/buttons';\n import {FormSection} from 'app/components/forms';\n \n-import {\n-  InfoIcon,\n-  ValidationIcon\n-} from 'app/components/icons';\n+import {InfoIcon, ValidationIcon} from 'app/components/icons';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1NzU1Ng=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0NjMxNw==", "bodyText": "nit: slight preference for naming the props instead of passing in a props object, but I see we use this pattern elsewhere for things like FlexRow, so up to you.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385346317", "createdAt": "2020-02-27T20:12:14Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -118,6 +113,14 @@ export const Section = (props) => {\n   </FormSection>;\n };\n \n+export const DropDownSection = (props) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0ODgxNA==", "bodyText": "Please put a comment here explaining why we only care about the first institution.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385348814", "createdAt": "2020-02-27T20:17:42Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -204,22 +218,28 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n       usernameConflictError: false,\n       creatingAccount: false,\n       showAllFieldsRequiredError: false,\n-      // showInstitution defaults to true, since we expect most users coming in will be academics.\n-      showInstitution: true,\n-      showNonAcademicAffiliationRole: false,\n-      showNonAcademicAffiliationOther: false,\n       invalidEmail: false,\n+      // (KEEP) state for verified institutional affiliation\n+      institutionList: [],\n+      // TODO remove all after this point, after we switch to verified institutional affiliation\n       rolesOptions: [],\n       institutionName: '',\n       institutionRole: '',\n       nonAcademicAffiliation: '',\n       nonAcademicAffiliationRole: '',\n-      nonAcademicAffiliationOther: ''\n+      nonAcademicAffiliationOther: '',\n+      // showInstitution defaults to true, since we expect most users coming in will be academics.\n+      showInstitution: true,\n+      showNonAcademicAffiliationRole: false,\n+      showNonAcademicAffiliationOther: false,\n     };\n \n-    const institutionalAffiliation = this.props.profile.institutionalAffiliations[0];\n-    if (institutionalAffiliation.institution) {\n-      state.showInstitution = true;\n+    // TODO remove after we switch to verified institutional affiliation\n+    if (!serverConfigStore.getValue().requireInstitutionalVerification) {\n+      const institutionalAffiliation = this.props.profile.institutionalAffiliations[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1MTczOA==", "bodyText": "boo to no pattern matching in typescript.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385351738", "createdAt": "2020-02-27T20:23:57Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -268,6 +288,26 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n     return (this.state.usernameConflictError || this.usernameInvalidError());\n   }\n \n+  get roleMapForSelectedInstitution() {\n+    const {institutionList, profile: {verifiedInstitutionalAffiliation}} = this.state;\n+    if (!institutionList || !verifiedInstitutionalAffiliation || isBlank(verifiedInstitutionalAffiliation.institutionShortName)) {\n+      return undefined;\n+    }\n+\n+    const selectedInstOrgType: OrganizationType = institutionList\n+      .find(inst => inst.shortName === verifiedInstitutionalAffiliation.institutionShortName)\n+      .organizationTypeEnum;\n+\n+    const rolesForSelectedInstitution: InstitutionalRole[] =\n+      AccountCreationOptions.institutionalRolesByOrganizationType\n+        .find(kvp => kvp.type === selectedInstOrgType)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1MjkxMQ==", "bodyText": "yes. tomorrow at high noon you will be dragged unceremoniously to the typescript pillory and defunct javascript frameworks will be thrown at your face while the webdev community jeers at you.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385352911", "createdAt": "2020-02-27T20:26:36Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -327,23 +367,33 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n   }\n \n   updateInstitutionAffiliation(attribute: string, value) {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    const {requireInstitutionalVerification} = serverConfigStore.getValue();\n+    if (requireInstitutionalVerification) {\n+      this.setState(fp.set(['profile', 'verifiedInstitutionalAffiliation', attribute], value));\n+    } else {\n+      this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    }\n   }\n \n-  showFreeTextField(option) {\n-    return option === NonAcademicAffiliation.FREETEXT || option === IndustryRole.FREETEXT ||\n-        option === EducationalRole.FREETEXT;\n+  // TODO remove after we switch to verified institutional affiliation\n+  showInstitutionAffiliationFreeTextField(option) {\n+    return option === NonAcademicAffiliation.FREETEXT ||\n+      option === IndustryRole.FREETEXT ||\n+      option === EducationalRole.FREETEXT;\n   }\n \n-  clearInstitutionAffiliation() {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0'], {\n-      nonAcademicAffiliation: null,\n-      role: '',\n-      institution: '',\n-      other: ''\n-    }));\n+  // cannot destructure because verifiedInstitutionalAffiliation may not be defined\n+  // todo is this a code smell?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MDkyMA=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 206}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1MzM1OA==", "bodyText": "(this is better than doing this check each time. unless I'm misunderstanding something, this will become unnecessary when the feature flag is deleted. this just means this should be a feature flag we seriously prioritize deleting.)", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385353358", "createdAt": "2020-02-27T20:27:39Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -327,23 +367,33 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n   }\n \n   updateInstitutionAffiliation(attribute: string, value) {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    const {requireInstitutionalVerification} = serverConfigStore.getValue();\n+    if (requireInstitutionalVerification) {\n+      this.setState(fp.set(['profile', 'verifiedInstitutionalAffiliation', attribute], value));\n+    } else {\n+      this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    }\n   }\n \n-  showFreeTextField(option) {\n-    return option === NonAcademicAffiliation.FREETEXT || option === IndustryRole.FREETEXT ||\n-        option === EducationalRole.FREETEXT;\n+  // TODO remove after we switch to verified institutional affiliation\n+  showInstitutionAffiliationFreeTextField(option) {\n+    return option === NonAcademicAffiliation.FREETEXT ||\n+      option === IndustryRole.FREETEXT ||\n+      option === EducationalRole.FREETEXT;\n   }\n \n-  clearInstitutionAffiliation() {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0'], {\n-      nonAcademicAffiliation: null,\n-      role: '',\n-      institution: '',\n-      other: ''\n-    }));\n+  // cannot destructure because verifiedInstitutionalAffiliation may not be defined\n+  // todo is this a code smell?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MDkyMA=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 206}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM1MzQ5OQ==", "bodyText": "please add a // TODO remove after we switch to etc.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385353499", "createdAt": "2020-02-27T20:27:57Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/account-creation/account-creation.tsx", "diffHunk": "@@ -327,23 +367,33 @@ export class AccountCreation extends React.Component<AccountCreationProps, Accou\n   }\n \n   updateInstitutionAffiliation(attribute: string, value) {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    const {requireInstitutionalVerification} = serverConfigStore.getValue();\n+    if (requireInstitutionalVerification) {\n+      this.setState(fp.set(['profile', 'verifiedInstitutionalAffiliation', attribute], value));\n+    } else {\n+      this.setState(fp.set(['profile', 'institutionalAffiliations', '0', attribute], value));\n+    }\n   }\n \n-  showFreeTextField(option) {\n-    return option === NonAcademicAffiliation.FREETEXT || option === IndustryRole.FREETEXT ||\n-        option === EducationalRole.FREETEXT;\n+  // TODO remove after we switch to verified institutional affiliation\n+  showInstitutionAffiliationFreeTextField(option) {\n+    return option === NonAcademicAffiliation.FREETEXT ||\n+      option === IndustryRole.FREETEXT ||\n+      option === EducationalRole.FREETEXT;\n   }\n \n-  clearInstitutionAffiliation() {\n-    this.setState(fp.set(['profile', 'institutionalAffiliations', '0'], {\n-      nonAcademicAffiliation: null,\n-      role: '',\n-      institution: '',\n-      other: ''\n-    }));\n+  // cannot destructure because verifiedInstitutionalAffiliation may not be defined\n+  // todo is this a code smell?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI3MDkyMA=="}, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 206}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MjA2MQ==", "bodyText": "why can't we just click the button?", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385772061", "createdAt": "2020-02-28T15:50:18Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/sign-in.spec.tsx", "diffHunk": "@@ -117,11 +117,40 @@ describe('SignInReact', () => {\n     wrapper.find(AccountCreationTos).props().onComplete();\n \n     expect(wrapper.exists(AccountCreation)).toBeTruthy();\n-    wrapper.find(AccountCreation).props().onComplete(getEmptyProfile());\n+    wrapper.find(AccountCreation).props().onComplete(createEmptyProfile(requireInstitutionalVerification));\n \n     // Account Creation Survey (e.g. demographics) is part of the new-style flow.\n     expect(wrapper.exists(AccountCreationSurvey)).toBeTruthy();\n-    wrapper.find(AccountCreationSurvey).props().onComplete(getEmptyProfile());\n+    wrapper.find(AccountCreationSurvey).props().onComplete(createEmptyProfile(requireInstitutionalVerification));\n+\n+    expect(wrapper.exists(AccountCreationSuccess)).toBeTruthy();\n+  });\n+\n+  it('should handle sign-up flow for new account creation with institutional verification', () => {\n+    props.serverConfig = {...defaultConfig, enableNewAccountCreation: true};\n+    const requireInstitutionalVerification = true;\n+\n+    const wrapper = shallowComponent();\n+\n+    // To start, the landing page / login component should be shown.\n+    expect(wrapper.exists(LoginReactComponent)).toBeTruthy();\n+    // Simulate the \"create account\" button being clicked by firing the callback method.\n+    wrapper.find(LoginReactComponent).props().onCreateAccount();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc3MjY3Mg==", "bodyText": "why can't we put the text in the text box?\nand similar comments for all the calling of internal callbacks below in this function.", "url": "https://github.com/all-of-us/workbench/pull/3194#discussion_r385772672", "createdAt": "2020-02-28T15:51:22Z", "author": {"login": "als364"}, "path": "ui/src/app/pages/login/sign-in.spec.tsx", "diffHunk": "@@ -117,11 +117,40 @@ describe('SignInReact', () => {\n     wrapper.find(AccountCreationTos).props().onComplete();\n \n     expect(wrapper.exists(AccountCreation)).toBeTruthy();\n-    wrapper.find(AccountCreation).props().onComplete(getEmptyProfile());\n+    wrapper.find(AccountCreation).props().onComplete(createEmptyProfile(requireInstitutionalVerification));\n \n     // Account Creation Survey (e.g. demographics) is part of the new-style flow.\n     expect(wrapper.exists(AccountCreationSurvey)).toBeTruthy();\n-    wrapper.find(AccountCreationSurvey).props().onComplete(getEmptyProfile());\n+    wrapper.find(AccountCreationSurvey).props().onComplete(createEmptyProfile(requireInstitutionalVerification));\n+\n+    expect(wrapper.exists(AccountCreationSuccess)).toBeTruthy();\n+  });\n+\n+  it('should handle sign-up flow for new account creation with institutional verification', () => {\n+    props.serverConfig = {...defaultConfig, enableNewAccountCreation: true};\n+    const requireInstitutionalVerification = true;\n+\n+    const wrapper = shallowComponent();\n+\n+    // To start, the landing page / login component should be shown.\n+    expect(wrapper.exists(LoginReactComponent)).toBeTruthy();\n+    // Simulate the \"create account\" button being clicked by firing the callback method.\n+    wrapper.find(LoginReactComponent).props().onCreateAccount();\n+\n+    // Invitation key step is next.\n+    expect(wrapper.exists(InvitationKey)).toBeTruthy();\n+    wrapper.find(InvitationKey).props().onInvitationKeyVerified('asdf');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301e290c4a7cade4f3f0919665abd465472a7391"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c5144cb3378917cfb34d1129ae8cdff0c3f2a33", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8c5144cb3378917cfb34d1129ae8cdff0c3f2a33", "committedDate": "2020-02-28T19:15:11Z", "message": "rm smell comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de6b90cb79cbed79e985e81b204684a65e74348c", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/de6b90cb79cbed79e985e81b204684a65e74348c", "committedDate": "2020-02-28T19:29:48Z", "message": "styling improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjY2OTYw", "url": "https://github.com/all-of-us/workbench/pull/3194#pullrequestreview-366666960", "createdAt": "2020-02-28T20:30:24Z", "commit": {"oid": "de6b90cb79cbed79e985e81b204684a65e74348c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3393, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}