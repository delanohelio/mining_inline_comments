{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MjIwMTk0", "number": 4119, "title": "[no ticket][risk=no] Puppeteer Simplify openSubtab function in Data page", "bodyText": "Small improvement in openTab functions:\n\nIf tab is already open (ariaSelected == true), then click on element is skipped.\nIf open sub-tab in Data page, users do not have to remember to open Data tab first.", "createdAt": "2020-10-06T02:20:05Z", "url": "https://github.com/all-of-us/workbench/pull/4119", "merged": true, "mergeCommit": {"oid": "5244db5ed2b63fb862446c3bb7d789070161f982"}, "closed": true, "closedAt": "2020-10-06T17:49:06Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPu8wvAFqTUwMjU0MTM5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP7vp6gBqjM4NDY2OTQ5NDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTQxMzk3", "url": "https://github.com/all-of-us/workbench/pull/4119#pullrequestreview-502541397", "createdAt": "2020-10-06T02:26:11Z", "commit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwMjoyNjoxMVrOHczz3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwMjoyNzoyOFrOHcz1Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk3MTAzOQ==", "bodyText": "The default timeout for waitForFunction is 10 seconds. It is too short and made tests flaky. Increase it to 30 seconds helps to reduce flaky.", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r499971039", "createdAt": "2020-10-06T02:26:11Z", "author": {"login": "aweng98"}, "path": "e2e/utils/waits-utils.ts", "diffHunk": "@@ -39,7 +39,7 @@ export async function waitForDocumentTitle(page: Page, titleSubstr: string): Pro\n     const jsHandle = await page.waitForFunction(t => {\n       const actualTitle = document.title;\n       return actualTitle.includes(t);\n-    }, {}, titleSubstr);\n+    }, {timeout: 30000}, titleSubstr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk3MTMzOA==", "bodyText": "throw (err) to keep original stacktrace unchanged. It was a mistake to do throw new Error() before.", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r499971338", "createdAt": "2020-10-06T02:27:28Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/authenticated-page.ts", "diffHunk": "@@ -38,11 +38,10 @@ export default abstract class AuthenticatedPage extends BasePage {\n         this.isLoaded(),\n       ]);\n       return this;\n-    } catch (e) {\n+    } catch (err) {\n       await savePageToFile(this.page);\n       await takeScreenshot(this.page);\n-      const title = await this.page.title();\n-      throw new Error(`\"${title}\" page waitForLoad() encountered ${e}.`);\n+      throw (err);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTc1MzUx", "url": "https://github.com/all-of-us/workbench/pull/4119#pullrequestreview-503175351", "createdAt": "2020-10-06T16:59:17Z", "commit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo1OToxN1rOHdRVuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowMjozOVrOHdReCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NDg0Mw==", "bodyText": "you might be able to set the stack trace to the original stack trace if you need to.", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r500454843", "createdAt": "2020-10-06T16:59:17Z", "author": {"login": "jaycarlton"}, "path": "e2e/app/page/authenticated-page.ts", "diffHunk": "@@ -38,11 +38,10 @@ export default abstract class AuthenticatedPage extends BasePage {\n         this.isLoaded(),\n       ]);\n       return this;\n-    } catch (e) {\n+    } catch (err) {\n       await savePageToFile(this.page);\n       await takeScreenshot(this.page);\n-      const title = await this.page.title();\n-      throw new Error(`\"${title}\" page waitForLoad() encountered ${e}.`);\n+      throw (err);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk3MTMzOA=="}, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NTgwNw==", "bodyText": "aria as in Opera?", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r500455807", "createdAt": "2020-10-06T17:00:48Z", "author": {"login": "jaycarlton"}, "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -94,6 +95,10 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n     const { waitPageChange = true } = opts;\n     const selector = buildXPath({name: pageTabName, type: ElementType.Tab});\n     const tab = new Link(this.page, selector);\n+    const isSelected = await getPropValue<boolean>(await tab.asElementHandle(), 'ariaSelected');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NjQ0NA==", "bodyText": "If you think individual steps are too slow, please file tickets on those, especially if it's a regression.", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r500456444", "createdAt": "2020-10-06T17:01:50Z", "author": {"login": "jaycarlton"}, "path": "e2e/utils/waits-utils.ts", "diffHunk": "@@ -39,7 +39,7 @@ export async function waitForDocumentTitle(page: Page, titleSubstr: string): Pro\n     const jsHandle = await page.waitForFunction(t => {\n       const actualTitle = document.title;\n       return actualTitle.includes(t);\n-    }, {}, titleSubstr);\n+    }, {timeout: 30000}, titleSubstr);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk3MTAzOQ=="}, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1Njk3MQ==", "bodyText": "Could you also use await here?", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r500456971", "createdAt": "2020-10-06T17:02:39Z", "author": {"login": "jaycarlton"}, "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -57,32 +58,32 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n    * Click Datasets subtab in Data page.\n    * @param opts\n    */\n-  async openDatasetsSubtab(opts: {waitPageChange?: boolean} = {}): Promise<void> {\n-    return this.openTab(TabLabels.Datasets, opts);\n+  async openDatasetsSubtab(): Promise<void> {\n+    return this.openDataPage().then(() => this.openTab(TabLabels.Datasets, {waitPageChange: false}));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTg5MjA0", "url": "https://github.com/all-of-us/workbench/pull/4119#pullrequestreview-503189204", "createdAt": "2020-10-06T17:15:54Z", "commit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoxNTo1NVrOHdR93g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoxNTo1NVrOHdR93g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NTExOA==", "bodyText": "return makes await redundant. same outcome with or without it.", "url": "https://github.com/all-of-us/workbench/pull/4119#discussion_r500465118", "createdAt": "2020-10-06T17:15:55Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -57,32 +58,32 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n    * Click Datasets subtab in Data page.\n    * @param opts\n    */\n-  async openDatasetsSubtab(opts: {waitPageChange?: boolean} = {}): Promise<void> {\n-    return this.openTab(TabLabels.Datasets, opts);\n+  async openDatasetsSubtab(): Promise<void> {\n+    return this.openDataPage().then(() => this.openTab(TabLabels.Datasets, {waitPageChange: false}));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1Njk3MQ=="}, "originalCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a10e854894df1a5b28a9df1879d8be83cc818a14", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/a10e854894df1a5b28a9df1879d8be83cc818a14", "committedDate": "2020-10-06T17:19:38Z", "message": "optimize open subtab functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3134a2b7fdfddc830cabc636d432be026b9cdad", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e3134a2b7fdfddc830cabc636d432be026b9cdad", "committedDate": "2020-10-06T17:19:38Z", "message": "fix a throw call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbfee78d3c80e5ccd7e4b082b1a4db1045692994", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fbfee78d3c80e5ccd7e4b082b1a4db1045692994", "committedDate": "2020-10-06T17:22:16Z", "message": "rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ba3e23ca4b05d206c9793c9ba20b99b6b5f8d3f2", "committedDate": "2020-10-06T02:17:29Z", "message": "fix a throw call"}, "afterCommit": {"oid": "fbfee78d3c80e5ccd7e4b082b1a4db1045692994", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fbfee78d3c80e5ccd7e4b082b1a4db1045692994", "committedDate": "2020-10-06T17:22:16Z", "message": "rebase"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4176, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}