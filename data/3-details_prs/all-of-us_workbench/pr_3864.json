{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTA4ODE1", "number": 3864, "title": "[RW-5319][risk=no] Migrate sex at birth concept id when saving a review", "bodyText": "Migrate sex at birth concept id when saving a review\n\nAdding sex_at_birth_concept_id  column to participant_cohort_status table in cloud sql\nUpdated CohortQueryBuilder to include sex_at_birth_concept_id\nUpdated ParticipantCohortStatusDaoImpl to include sex_at_birth_concept_id\nUpdated DbParticipantCohortStatus Entity to include sex_at_birth_concept_id\nUpdated CohortReviewController#TO_CLIENT_PARTICIPANT to include sex_at_birth_concept_id\nUpdated/Fixed corresponding test cases.", "createdAt": "2020-08-06T15:43:04Z", "url": "https://github.com/all-of-us/workbench/pull/3864", "merged": true, "mergeCommit": {"oid": "13aa7088026ac9ac9fd375427166e68f677b1254"}, "closed": true, "closedAt": "2020-08-11T16:06:42Z", "author": {"login": "freemabd"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8RoQtAH2gAyNDY0MTA4ODE1OjRlOTdiNDc0NzZlNGMyYjExNzYyZGNmOGJmYmVjNmUzNTI4Y2FhMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc94H8CgFqTQ2NTE1MzkwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e97b47476e4c2b11762dcf8bfbec6e3528caa0d", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/4e97b47476e4c2b11762dcf8bfbec6e3528caa0d", "committedDate": "2020-08-06T15:33:54Z", "message": "RW-5319 adding sex at birth to response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "689b9ba8962db73807f3a40c17d734de527ff057", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/689b9ba8962db73807f3a40c17d734de527ff057", "committedDate": "2020-08-06T15:33:54Z", "message": "RW-5319\nfixing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76c4747185b64d39387de7b864d121521efa374a", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/76c4747185b64d39387de7b864d121521efa374a", "committedDate": "2020-08-06T17:00:23Z", "message": "RW-5319 fixing test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNzgxOTU2", "url": "https://github.com/all-of-us/workbench/pull/3864#pullrequestreview-462781956", "createdAt": "2020-08-06T18:40:38Z", "commit": {"oid": "76c4747185b64d39387de7b864d121521efa374a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODo0MDozOFrOG8_whg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODo0MDozOFrOG8_whg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxMjM1OA==", "bodyText": "this could be moved to a method (maybe pass Participant Id) and called again", "url": "https://github.com/all-of-us/workbench/pull/3864#discussion_r466612358", "createdAt": "2020-08-06T18:40:38Z", "author": {"login": "NehaBroad"}, "path": "api/src/bigquerytest/java/org/pmiops/workbench/api/CohortReviewControllerBQTest.java", "diffHunk": "@@ -209,57 +207,47 @@ public void setUp() {\n     stubMockFirecloudGetWorkspaceAcl();\n \n     Gson gson = new Gson();\n-    cohortWithoutEHRData = new DbCohort();\n+    DbCohort cohortWithoutEHRData = new DbCohort();\n     cohortWithoutEHRData.setWorkspaceId(workspace.getWorkspaceId());\n     cohortWithoutEHRData.setCriteria(gson.toJson(SearchRequests.males()));\n     cohortWithoutEHRData = cohortDao.save(cohortWithoutEHRData);\n \n-    cohortWithEHRData = new DbCohort();\n+    DbCohort cohortWithEHRData = new DbCohort();\n     cohortWithEHRData.setWorkspaceId(workspace.getWorkspaceId());\n     cohortWithEHRData.setCriteria(gson.toJson(SearchRequests.malesWithEHRData()));\n     cohortWithEHRData = cohortDao.save(cohortWithEHRData);\n \n-    reviewWithoutEHRData =\n-        new DbCohortReview()\n-            .cdrVersionId(cdrVersion.getCdrVersionId())\n-            .matchedParticipantCount(212)\n-            .creationTime(new Timestamp(new Date().getTime()))\n-            .lastModifiedTime(new Timestamp(new Date().getTime()))\n-            .cohortId(cohortWithoutEHRData.getCohortId());\n-    reviewWithoutEHRData = cohortReviewDao.save(reviewWithoutEHRData);\n-\n-    DbParticipantCohortStatusKey key =\n-        new DbParticipantCohortStatusKey()\n-            .participantId(PARTICIPANT_ID)\n-            .cohortReviewId(reviewWithoutEHRData.getCohortReviewId());\n-    participantCohortStatusDao.save(new DbParticipantCohortStatus().participantKey(key));\n-\n-    DbParticipantCohortStatusKey key2 =\n-        new DbParticipantCohortStatusKey()\n-            .participantId(PARTICIPANT_ID2)\n-            .cohortReviewId(reviewWithoutEHRData.getCohortReviewId());\n-    participantCohortStatusDao.save(new DbParticipantCohortStatus().participantKey(key2));\n-\n-    reviewWithEHRData =\n-        new DbCohortReview()\n-            .cdrVersionId(cdrVersion.getCdrVersionId())\n-            .matchedParticipantCount(212)\n-            .creationTime(new Timestamp(new Date().getTime()))\n-            .lastModifiedTime(new Timestamp(new Date().getTime()))\n-            .cohortId(cohortWithEHRData.getCohortId());\n-    reviewWithEHRData = cohortReviewDao.save(reviewWithEHRData);\n-\n-    DbParticipantCohortStatusKey key3 =\n-        new DbParticipantCohortStatusKey()\n-            .participantId(PARTICIPANT_ID)\n-            .cohortReviewId(reviewWithEHRData.getCohortReviewId());\n-    participantCohortStatusDao.save(new DbParticipantCohortStatus().participantKey(key3));\n-\n-    DbParticipantCohortStatusKey key4 =\n-        new DbParticipantCohortStatusKey()\n-            .participantId(PARTICIPANT_ID2)\n-            .cohortReviewId(reviewWithEHRData.getCohortReviewId());\n-    participantCohortStatusDao.save(new DbParticipantCohortStatus().participantKey(key4));\n+    reviewWithoutEHRData = createCohortReview(cohortWithoutEHRData);\n+\n+    participantCohortStatusDao.save(\n+        new DbParticipantCohortStatus()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76c4747185b64d39387de7b864d121521efa374a"}, "originalPosition": 69}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "322caad918395ae13ac1d6c81a1cd63bb8064450", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/322caad918395ae13ac1d6c81a1cd63bb8064450", "committedDate": "2020-08-11T14:09:49Z", "message": "RW-5319 changes to duplicate code in test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MTUzOTA0", "url": "https://github.com/all-of-us/workbench/pull/3864#pullrequestreview-465153904", "createdAt": "2020-08-11T14:58:49Z", "commit": {"oid": "322caad918395ae13ac1d6c81a1cd63bb8064450"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4546, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}