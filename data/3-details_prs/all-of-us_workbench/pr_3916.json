{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNDA4NjQ1", "number": 3916, "title": "[RW-5312][risk=no] Add genomics microarray field to cdrVersion", "bodyText": "Description:\nAdds a new field to the CdrVersion table and model.\nI did not add it to the API model since it's not being used anywhere and many of the CdrVersion fields are not exposed anyways. Also, part of the A/C of the ticket was to add a new CdrVersion that contains a reference to the microarray dataset but I decided to postpone that until the dataset actually exists.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-08-25T19:25:29Z", "url": "https://github.com/all-of-us/workbench/pull/3916", "merged": true, "mergeCommit": {"oid": "fee026949742446d2af90c63895c34dccc0e863f"}, "closed": true, "closedAt": "2020-08-27T00:41:42Z", "author": {"login": "ericsong"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCcTapAH2gAyNDczNDA4NjQ1OmIzNWFlY2E4ZDFiMDVjMzUxNzMwN2NmYzQzZTkzNTE5NzEzOGE5N2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCzBcQgH2gAyNDczNDA4NjQ1OmJmYzk4MjQ2Y2U5Zjc0Yzc5YWY5YWE5YWNjNjMyNmYyZTkyNmNhNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b35aeca8d1b05c3517307cfc43e935197138a97e", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/b35aeca8d1b05c3517307cfc43e935197138a97e", "committedDate": "2020-08-25T19:23:38Z", "message": "add genomics microarray field to cdrVersion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0026904d0abfea6c8e9cd8191c9f417b7561a82", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/f0026904d0abfea6c8e9cd8191c9f417b7561a82", "committedDate": "2020-08-26T14:37:42Z", "message": "add microarry field to CdrVersion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56857d41c9cea943b1c30c5156b46190b23d08d4", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/56857d41c9cea943b1c30c5156b46190b23d08d4", "committedDate": "2020-08-26T15:06:15Z", "message": "expose microarray field in API, add test, convert to mapstruct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40f82ca721516c0a96a1ed1cc7d823748fdeba8e", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/40f82ca721516c0a96a1ed1cc7d823748fdeba8e", "committedDate": "2020-08-26T15:15:19Z", "message": "Merge branch 'master' of github.com:all-of-us/workbench into songe/RW-5312"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd318e099857f1b89961e3d45486829384503bef", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/bd318e099857f1b89961e3d45486829384503bef", "committedDate": "2020-08-26T15:27:10Z", "message": "spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjczMDAx", "url": "https://github.com/all-of-us/workbench/pull/3916#pullrequestreview-475673001", "createdAt": "2020-08-26T16:45:43Z", "commit": {"oid": "bd318e099857f1b89961e3d45486829384503bef"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjo0NTo0M1rOHHUxPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjo1NDo1OFrOHHVIMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ0MjM2Nw==", "bodyText": "nit: maybe \"Synthetic Dataset v1 (with microarray)\"", "url": "https://github.com/all-of-us/workbench/pull/3916#discussion_r477442367", "createdAt": "2020-08-26T16:45:43Z", "author": {"login": "calbach"}, "path": "api/config/cdr_versions_local.json", "diffHunk": "@@ -24,5 +24,19 @@\n     \"numParticipants\": 946237,\n     \"cdrDbName\": \"cdr\",\n     \"elasticIndexBaseName\": \"cdr\"\n+  },\n+  {\n+    \"cdrVersionId\": 3,\n+    \"isDefault\": false,\n+    \"name\": \"Synthetic Dataset v1.1\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd318e099857f1b89961e3d45486829384503bef"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ0MjU2Mg==", "bodyText": "nit: 2020\n(this doesn't really matter)", "url": "https://github.com/all-of-us/workbench/pull/3916#discussion_r477442562", "createdAt": "2020-08-26T16:46:00Z", "author": {"login": "calbach"}, "path": "api/config/cdr_versions_local.json", "diffHunk": "@@ -24,5 +24,19 @@\n     \"numParticipants\": 946237,\n     \"cdrDbName\": \"cdr\",\n     \"elasticIndexBaseName\": \"cdr\"\n+  },\n+  {\n+    \"cdrVersionId\": 3,\n+    \"isDefault\": false,\n+    \"name\": \"Synthetic Dataset v1.1\",\n+    \"dataAccessLevel\": 1,\n+    \"bigqueryProject\": \"fc-aou-cdr-synth-test\",\n+    \"bigqueryDataset\": \"SR2019q4r3\",\n+    \"microarrayBigqueryDataset\": \"microarray_data\",\n+    \"creationTime\": \"2019-08-26 00:09:51Z\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd318e099857f1b89961e3d45486829384503bef"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ0ODI0MA==", "bodyText": "Now that I'm looking at this, the client won't really be able to do much with it (they don't know the BQ project). The only thing the client needs to use this for is to make a determination as to which features should be shown in a given workspace.\nWDYT about changing this to be a boolean hasMicroarrayData?", "url": "https://github.com/all-of-us/workbench/pull/3916#discussion_r477448240", "createdAt": "2020-08-26T16:54:58Z", "author": {"login": "calbach"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -3604,6 +3604,8 @@ definitions:\n         \"$ref\": \"#/definitions/DataAccessLevel\"\n       archivalStatus:\n         \"$ref\": \"#/definitions/ArchivalStatus\"\n+      microarrayBigqueryDataset:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd318e099857f1b89961e3d45486829384503bef"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjgxNTY3", "url": "https://github.com/all-of-us/workbench/pull/3916#pullrequestreview-475681567", "createdAt": "2020-08-26T16:55:57Z", "commit": {"oid": "bd318e099857f1b89961e3d45486829384503bef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjo1NTo1N1rOHHVKqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjo1NTo1N1rOHHVKqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ0ODg3Mg==", "bodyText": "Also - nice, thanks for adding the mapper", "url": "https://github.com/all-of-us/workbench/pull/3916#discussion_r477448872", "createdAt": "2020-08-26T16:55:57Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/cdr/CdrVersionMapper.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package org.pmiops.workbench.cdr;\n+\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbCdrVersion;\n+import org.pmiops.workbench.model.CdrVersion;\n+import org.pmiops.workbench.utils.mappers.CommonMappers;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(\n+    config = MapStructConfig.class,\n+    uses = {CommonMappers.class})\n+public interface CdrVersionMapper {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd318e099857f1b89961e3d45486829384503bef"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fda9538d0d7bbb446e5401d3db226fe44b6e058", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/3fda9538d0d7bbb446e5401d3db226fe44b6e058", "committedDate": "2020-08-26T20:47:42Z", "message": "config field fixe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6155bb200008f6571b95a7b0d87aa10806ddc3d", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/c6155bb200008f6571b95a7b0d87aa10806ddc3d", "committedDate": "2020-08-26T20:48:04Z", "message": "convert microarray bq string to boolean when exposed to API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b253938b1589acd098f37e46a5fc4c06735466be", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/b253938b1589acd098f37e46a5fc4c06735466be", "committedDate": "2020-08-26T20:49:04Z", "message": "spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODYzOTg1", "url": "https://github.com/all-of-us/workbench/pull/3916#pullrequestreview-475863985", "createdAt": "2020-08-26T21:14:15Z", "commit": {"oid": "b253938b1589acd098f37e46a5fc4c06735466be"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMToxNDoxNlrOHHd-Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMToxNDoxNlrOHHd-Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU5MzE3OQ==", "bodyText": "nit: null or empty might be slightly less error-prone. I'm worried about someone putting microarrayBigQueryDataset: \"\" in the JSON.", "url": "https://github.com/all-of-us/workbench/pull/3916#discussion_r477593179", "createdAt": "2020-08-26T21:14:16Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/cdr/CdrVersionMapper.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.pmiops.workbench.cdr;\n+\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbCdrVersion;\n+import org.pmiops.workbench.model.CdrVersion;\n+import org.pmiops.workbench.utils.mappers.CommonMappers;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(\n+    config = MapStructConfig.class,\n+    uses = {CommonMappers.class})\n+public interface CdrVersionMapper {\n+\n+  @Mapping(source = \"microarrayBigqueryDataset\", target = \"hasMicroarrayData\")\n+  @Mapping(source = \"dataAccessLevelEnum\", target = \"dataAccessLevel\")\n+  @Mapping(source = \"archivalStatusEnum\", target = \"archivalStatus\")\n+  CdrVersion dbModelToClient(DbCdrVersion db);\n+\n+  default boolean isNonNull(String s) {\n+    return s != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b253938b1589acd098f37e46a5fc4c06735466be"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfc98246ce9f74c79af9aa9acc6326f2e926ca68", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/bfc98246ce9f74c79af9aa9acc6326f2e926ca68", "committedDate": "2020-08-26T21:51:49Z", "message": "add empty string check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4340, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}