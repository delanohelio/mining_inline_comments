{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTM4OTMx", "number": 3371, "title": "[RW-4573][risk=low] Switch delete-workspaces to use SA creds", "bodyText": "Switching to use service account creds rather than user impersonation. This is needed as there are a set of users in prod who are no longer in the registered tier, and therefore no longer have permission to delete workspaces.\nVerified in the test environment by deleting one of my own workspaces.", "createdAt": "2020-04-09T00:04:19Z", "url": "https://github.com/all-of-us/workbench/pull/3371", "merged": true, "mergeCommit": {"oid": "fe8b4edaeee7c0a06d5fd647009433849aa72366"}, "closed": true, "closedAt": "2020-04-09T04:26:15Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVw-cAAH2gAyNDAxMTM4OTMxOjY4NDVlNTMyYzhkM2MzNWQ3OGMyYjc0OWY5MzFjYWVmMDFhMzRmYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVxxxKAFqTM5MDQyNjY2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6845e532c8d3c35d78c2b749f931caef01a34fbc", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/6845e532c8d3c35d78c2b749f931caef01a34fbc", "committedDate": "2020-04-09T00:02:08Z", "message": "Delete workspace fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDEwODIy", "url": "https://github.com/all-of-us/workbench/pull/3371#pullrequestreview-390410822", "createdAt": "2020-04-09T00:05:17Z", "commit": {"oid": "6845e532c8d3c35d78c2b749f931caef01a34fbc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMDowNToxN1rOGDFKtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMDowNToxN1rOGDFKtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg4MzU3Mg==", "bodyText": "Initially I'd tried to inject the SERVICE_ACCOUNT_API_CLIENT, but I think there's an issue going from prototype --> request scoped:\njava.lang.IllegalStateException: No Scope registered for scope name 'request'                             \n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:343)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)\n        at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:211)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1131)                          \n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1059)                                                                              \n        at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)\n        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)                                                                                           \n        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:467)                                                                                 \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1177)                                                  \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1072)                                                             \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:511)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:481)                               \n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:331)                                                                                                     \n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)\n        at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:211)                                                                                             \n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1131)                                                                            \n        at org.springframework.beans.factory.support.DefaultListableBeanFactory$DependencyObjectProvider.getObject(DefaultListableBeanFactory.java:1649)                                                             \n        at org.springframework.beans.factory.support.DefaultListableBeanFactory$Jsr330DependencyProvider.get(DefaultListableBeanFactory.java:1718)                                                                   \n        at org.pmiops.workbench.firecloud.FireCloudServiceImpl.deleteWorkspace(FireCloudServiceImpl.java:403)                                                                                                        \n        at org.pmiops.workbench.workspaces.WorkspaceServiceImpl.deleteWorkspace(WorkspaceServiceImpl.java:303)", "url": "https://github.com/all-of-us/workbench/pull/3371#discussion_r405883572", "createdAt": "2020-04-09T00:05:17Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/firecloud/FireCloudConfig.java", "diffHunk": "@@ -39,7 +39,7 @@\n   public static final String SERVICE_ACCOUNT_WORKSPACE_API = \"workspaceAclsApi\";\n   public static final String END_USER_WORKSPACE_API = \"workspacesApi\";\n \n-  private static final List<String> BILLING_SCOPES =\n+  public static final List<String> BILLING_SCOPES =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6845e532c8d3c35d78c2b749f931caef01a34fbc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDI2NjYy", "url": "https://github.com/all-of-us/workbench/pull/3371#pullrequestreview-390426662", "createdAt": "2020-04-09T00:58:12Z", "commit": {"oid": "6845e532c8d3c35d78c2b749f931caef01a34fbc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3138, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}