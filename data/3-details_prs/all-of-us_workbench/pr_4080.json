{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NDQ2NTg0", "number": 4080, "title": "[RW-5662][risk=no] Puppeteer Fix flaky Cohort UI test", "bodyText": "Existing Sidebar xpath selector in Cohort Search page is not restrictive. More than one elements were found.\n\nFixed xpath selector.", "createdAt": "2020-09-28T22:59:40Z", "url": "https://github.com/all-of-us/workbench/pull/4080", "merged": true, "mergeCommit": {"oid": "812b71d91d19c597af996107d4c7f86f93af54f5"}, "closed": true, "closedAt": "2020-09-29T17:36:33Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNbpwnAH2gAyNDk0NDQ2NTg0OjdjYTU1YzQ1OWQ5MWU1YzY0OTU4ZjI5MmQ3NGE0MDk2MTY1YzZjYWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNo8kwgFqTQ5ODUyMzMzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7ca55c459d91e5c64958f292d74a4096165c6cab", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7ca55c459d91e5c64958f292d74a4096165c6cab", "committedDate": "2020-09-28T22:51:18Z", "message": "update select menu xpath selector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTU1NzI3", "url": "https://github.com/all-of-us/workbench/pull/4080#pullrequestreview-497955727", "createdAt": "2020-09-28T23:02:14Z", "commit": {"oid": "7ca55c459d91e5c64958f292d74a4096165c6cab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzowMjoxNFrOHZSpmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzowMjoxNFrOHZSpmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4MjAxMQ==", "bodyText": "tslint fix", "url": "https://github.com/all-of-us/workbench/pull/4080#discussion_r496282011", "createdAt": "2020-09-28T23:02:14Z", "author": {"login": "aweng98"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -14,8 +14,8 @@ describe('Jupyter notebook download test', () => {\n   const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n     const checkDownloadDisabledState = async (wantDisabled: boolean) => {\n       expect(await waitForFn(async () => {\n-        let downloadBtn = await modal.getDownloadButton();\n-        return wantDisabled == await getPropValue<boolean>(downloadBtn, 'disabled');\n+        const downloadBtn = await modal.getDownloadButton();\n+        return wantDisabled === await getPropValue<boolean>(downloadBtn, 'disabled');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ca55c459d91e5c64958f292d74a4096165c6cab"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTU3MTUy", "url": "https://github.com/all-of-us/workbench/pull/4080#pullrequestreview-497957152", "createdAt": "2020-09-28T23:06:08Z", "commit": {"oid": "7ca55c459d91e5c64958f292d74a4096165c6cab"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzowNjowOFrOHZSuhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzoxMjoxOVrOHZS1mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4MzI3MQ==", "bodyText": "The other change is fine, but the == was intentional, I'd like to treat nulls as false. If you want to switch this to ===, please also make it !!(await getPropValue<boolean>(downloadBtn, 'disabled')); Unless you're 100% confident that your helper method properly handles this case.\nAlso, if there's lint guidance you're following - is it not also part of our presubmit?", "url": "https://github.com/all-of-us/workbench/pull/4080#discussion_r496283271", "createdAt": "2020-09-28T23:06:08Z", "author": {"login": "calbach"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -14,8 +14,8 @@ describe('Jupyter notebook download test', () => {\n   const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n     const checkDownloadDisabledState = async (wantDisabled: boolean) => {\n       expect(await waitForFn(async () => {\n-        let downloadBtn = await modal.getDownloadButton();\n-        return wantDisabled == await getPropValue<boolean>(downloadBtn, 'disabled');\n+        const downloadBtn = await modal.getDownloadButton();\n+        return wantDisabled === await getPropValue<boolean>(downloadBtn, 'disabled');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4MjAxMQ=="}, "originalCommit": {"oid": "7ca55c459d91e5c64958f292d74a4096165c6cab"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4NTA4Mw==", "bodyText": "The help-sidebar is not exclusively used for cohorts and #selection-list is specific to cohorts, so this is not a reasonable default. It may cover all current use cases, but if so it's because cohorts are the only test coverage we have involving the help sidebar.\nI would add another helper like selectionXpath or cohortSelectionXpathand use that from individual methods instead. In general, it would also be nice if the identifiers were named more specifically, but this is an issue with the element IDs as well.", "url": "https://github.com/all-of-us/workbench/pull/4080#discussion_r496285083", "createdAt": "2020-09-28T23:12:19Z", "author": {"login": "calbach"}, "path": "e2e/app/component/help-sidebar.ts", "diffHunk": "@@ -10,7 +10,7 @@ import {ElementType} from 'app/xpath-options';\n import {waitWhileLoading} from 'utils/test-utils';\n import {waitForNumericalString} from 'utils/waits-utils';\n \n-const defaultXpath = '//*[@id=\"help-sidebar\"]';\n+const defaultXpath = '//*[@id=\"help-sidebar\"]//*[@id=\"selection-list\"]';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ca55c459d91e5c64958f292d74a4096165c6cab"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df35aa243be5597a6cac5097fe249b83a63b4fd4", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/df35aa243be5597a6cac5097fe249b83a63b4fd4", "committedDate": "2020-09-28T23:53:24Z", "message": "PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTc0NDQ0", "url": "https://github.com/all-of-us/workbench/pull/4080#pullrequestreview-497974444", "createdAt": "2020-09-28T23:58:00Z", "commit": {"oid": "df35aa243be5597a6cac5097fe249b83a63b4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzo1ODowMFrOHZTrKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzo1ODowMFrOHZTrKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODc5NA==", "bodyText": "This is not what I meant; this is still problematic because when we inevitably add methods to the HelpSidebar component which do non-cohorts things (like opening the data dictionary), they will just fail with this Xpath. Likewise, in other contexts the cohorts methods will not work.", "url": "https://github.com/all-of-us/workbench/pull/4080#discussion_r496298794", "createdAt": "2020-09-28T23:58:00Z", "author": {"login": "calbach"}, "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -132,7 +132,7 @@ export default class CohortSearchPage extends AuthenticatedPage {\n     await finishAndReviewButton.click();\n \n     // Click Save Criteria button in sidebar\n-    const helpSidebar = new HelpSidebar(this.page);\n+    const helpSidebar = new HelpSidebar(this.page, '//*[@id=\"help-sidebar\"]//*[@id=\"selection-list\"]');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df35aa243be5597a6cac5097fe249b83a63b4fd4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDAwNzYz", "url": "https://github.com/all-of-us/workbench/pull/4080#pullrequestreview-498000763", "createdAt": "2020-09-29T01:26:37Z", "commit": {"oid": "df35aa243be5597a6cac5097fe249b83a63b4fd4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMToyNjozN1rOHZVGxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMToyNjozN1rOHZVGxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyMjI0Nw==", "bodyText": "Hmm I see. btw, should xPathOptions support specifying a specific xpath as an option? I was looking for this on my last PR, but it seems it would have been useful here as well.\nPlease leave a TODO here or on help-sidebar and then perhaps @dolbeew has other ideas about how to clean this up. If left as-is, someone is going to try to reuse this component later and get an unfortunate surprise.", "url": "https://github.com/all-of-us/workbench/pull/4080#discussion_r496322247", "createdAt": "2020-09-29T01:26:37Z", "author": {"login": "calbach"}, "path": "e2e/app/page/cohort-search-page.ts", "diffHunk": "@@ -132,7 +132,7 @@ export default class CohortSearchPage extends AuthenticatedPage {\n     await finishAndReviewButton.click();\n \n     // Click Save Criteria button in sidebar\n-    const helpSidebar = new HelpSidebar(this.page);\n+    const helpSidebar = new HelpSidebar(this.page, '//*[@id=\"help-sidebar\"]//*[@id=\"selection-list\"]');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODc5NA=="}, "originalCommit": {"oid": "df35aa243be5597a6cac5097fe249b83a63b4fd4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d459afdf1ce30bccd2ce6da2b8bb58a8bd417326", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d459afdf1ce30bccd2ce6da2b8bb58a8bd417326", "committedDate": "2020-09-29T14:14:20Z", "message": "change buildXpath function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTIzMzMz", "url": "https://github.com/all-of-us/workbench/pull/4080#pullrequestreview-498523333", "createdAt": "2020-09-29T14:20:14Z", "commit": {"oid": "d459afdf1ce30bccd2ce6da2b8bb58a8bd417326"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMDoxNVrOHZvrDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMDoxNVrOHZvrDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1NzUxNg==", "bodyText": "How about this approach? Excluding elements that have class name p-disabled.", "url": "https://github.com/all-of-us/workbench/pull/4080#discussion_r496757516", "createdAt": "2020-09-29T14:20:15Z", "author": {"login": "aweng98"}, "path": "e2e/app/xpath-builders.ts", "diffHunk": "@@ -62,7 +62,7 @@ export function buildXPath(xOpts: XPathOptions, container?: Container): string {\n     selector = `${textExpr}//${type}`;\n     break;\n   case ElementType.Dropdown:\n-    selector = `${textExpr}${nodeLevel}//*[contains(concat(\" \", normalize-space(@class), \" \"), \" p-dropdown \")]`;\n+    selector = `${textExpr}${nodeLevel}//*[${classNameContains('p-dropdown')} and not(${classNameContains('p-disabled')})]`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d459afdf1ce30bccd2ce6da2b8bb58a8bd417326"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4127, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}