{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNzU0ODE2", "number": 4143, "title": "[no ticket][risk=no] Puppeteer fix a flaky test", "bodyText": "conceptsets/copy-to-workspace.spec.ts is flaky. Copy to Workspace modal was not ready after open.\nhttps://app.circleci.com/pipelines/github/all-of-us/workbench/4813/workflows/5e96ba37-155a-434f-b9b8-7c58772867f8/jobs/104053/steps\nFAIL  tests/conceptsets/copy-to-workspace.spec.ts (603.205 s)\n  Copy Concept Set to another workspace\n    \u2715 Workspace OWNER can copy Concept Set (312864 ms)\n\n  \u25cf Copy Concept Set to another workspace \u203a Workspace OWNER can copy Concept Set\n\n    TimeoutError: waiting for XPath \"(//*[@role=\"dialog\"]//label | //*[@role=\"dialog\"]//*)[contains(text(), \"Destination\") or contains(@aria-label, \"Destination\") or contains(@placeholder, \"Destination\")]/ancestor::node()[1]//input[@type=\"text\"]\" failed: timeout 10000ms exceeded\n\n      34 |     if (this.element !== undefined) return this.element.asElement();\n      35 |     try {\n    > 36 |       return this.page.waitForXPath(this.xpath, waitOptions).then(elemt => this.element = elemt.asElement());\n         |                        ^\n      37 |     } catch (err) {\n      38 |       console.error(`waitForXpath('${this.xpath}') encountered ${err}`);\n      39 |       // Debugging pause\n\n      at new WaitTask (node_modules/puppeteer/lib/cjs/puppeteer/common/DOMWorld.js:394:34)\n      at DOMWorld._waitForSelectorOrXPath (node_modules/puppeteer/lib/cjs/puppeteer/common/DOMWorld.js:326:26)\n      at DOMWorld.waitForXPath (node_modules/puppeteer/lib/cjs/puppeteer/common/DOMWorld.js:312:21)\n      at Frame.waitForXPath (node_modules/puppeteer/lib/cjs/puppeteer/common/FrameManager.js:825:51)\n      at Page.waitForXPath (node_modules/puppeteer/lib/cjs/puppeteer/common/Page.js:1218:33)\n      at Textbox.waitForXPath (app/element/base-element.ts:36:24)\n      at Textbox.asElementHandle (app/element/base-element.ts:340:17)\n      at Textbox.click (app/element/base-element.ts:144:17)\n      at CopyModal.copyToAnotherWorkspace (app/component/copy-modal.ts:30:28)\n      at Object.<anonymous> (tests/conceptsets/copy-to-workspace.spec.ts:59:5)", "createdAt": "2020-10-09T18:29:30Z", "url": "https://github.com/all-of-us/workbench/pull/4143", "merged": true, "mergeCommit": {"oid": "f23c34fd9f3a257396c8ea71899426d04b4cbb37"}, "closed": true, "closedAt": "2020-10-09T23:22:26Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ6av4AH2gAyNTAwNzU0ODE2OjU0ZGQyNTk0MDgxOGYyYzNjNjQyNGM1ODQ1OGRiZDgxOWIyYmQwODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSB-VoAFqTUwNzA4NDk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "54dd25940818f2c3c6424c58458dbd819b2bd082", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/54dd25940818f2c3c6424c58458dbd819b2bd082", "committedDate": "2020-10-09T18:23:44Z", "message": "modal waitForLoad change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "360254cdfa6cecf5cb1bddeb7e6b7ed4050979b9", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/360254cdfa6cecf5cb1bddeb7e6b7ed4050979b9", "committedDate": "2020-10-09T18:24:21Z", "message": "throw err"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTQyMzI0", "url": "https://github.com/all-of-us/workbench/pull/4143#pullrequestreview-505942324", "createdAt": "2020-10-09T19:36:48Z", "commit": {"oid": "360254cdfa6cecf5cb1bddeb7e6b7ed4050979b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDg0OTcw", "url": "https://github.com/all-of-us/workbench/pull/4143#pullrequestreview-507084970", "createdAt": "2020-10-13T05:45:51Z", "commit": {"oid": "360254cdfa6cecf5cb1bddeb7e6b7ed4050979b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNTo0NTo1MlrOHgWN_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNTo0NTo1MlrOHgWN_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4MDUxMQ==", "bodyText": "This appears to ahve created a circular dependency, resulting in an error importing Modal from ConceptSetSaveModal. moving waitWhileLoading into waits-utils may be the easiest path forward.\nLonger term, I suggest removing any dependency from utils -> Page, or components -> Page. This seems like it will just cause more of these issues going forwards.", "url": "https://github.com/all-of-us/workbench/pull/4143#discussion_r503680511", "createdAt": "2020-10-13T05:45:52Z", "author": {"login": "calbach"}, "path": "e2e/app/component/modal.ts", "diffHunk": "@@ -8,6 +8,7 @@ import {savePageToFile, takeScreenshot} from 'utils/save-file-utils';\n import {LinkText} from 'app/text-labels';\n import {getPropValue} from 'utils/element-utils';\n import * as fp from 'lodash/fp';\n+import {waitWhileLoading} from 'utils/test-utils';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "360254cdfa6cecf5cb1bddeb7e6b7ed4050979b9"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3938, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}