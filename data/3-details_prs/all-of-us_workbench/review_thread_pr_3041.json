{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDAzMTAy", "number": 3041, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDozMDowMFrODammlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjozMzoxMlrODaoPaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjIyMDM3OnYy", "diffSide": "RIGHT", "path": "api/db-cdr/generate-cdr/make-bq-data.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDozMDowMFrOFhpmIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNToyMDoxMlrOFiGdLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODgzNQ==", "bodyText": "@dolbeew need to confirm that all references to this survey use 'Family History'", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370828835", "createdAt": "2020-01-24T20:30:00Z", "author": {"login": "freemabd"}, "path": "api/db-cdr/generate-cdr/make-bq-data.sh", "diffHunk": "@@ -117,7 +117,7 @@ VALUES\n (1586134,'The Basics','Survey includes participant demographic information.',0,0,1),\n (43529712,'Personal Medical History','This survey includes information about past medical history, including medical conditions and approximate age of diagnosis.',0,0,4),\n (43528895,'Healthcare Access & Utilization','Survey includes information about a participants access to and use of health care.',0,0,5),\n-(43528698,'Family Medical History','Survey includes information about the medical history of a participants immediate biological family members.',0,0,6)\"\n+(43528698,'Family History','Survey includes information about the medical history of a participants immediate biological family members.',0,0,6)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NDAzNA==", "bodyText": "AKAIK we only use the value returned by the api. I don't believe the names are hardcoded anywhere, will double-check though.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370864034", "createdAt": "2020-01-24T22:07:38Z", "author": {"login": "dolbeew"}, "path": "api/db-cdr/generate-cdr/make-bq-data.sh", "diffHunk": "@@ -117,7 +117,7 @@ VALUES\n (1586134,'The Basics','Survey includes participant demographic information.',0,0,1),\n (43529712,'Personal Medical History','This survey includes information about past medical history, including medical conditions and approximate age of diagnosis.',0,0,4),\n (43528895,'Healthcare Access & Utilization','Survey includes information about a participants access to and use of health care.',0,0,5),\n-(43528698,'Family Medical History','Survey includes information about the medical history of a participants immediate biological family members.',0,0,6)\"\n+(43528698,'Family History','Survey includes information about the medical history of a participants immediate biological family members.',0,0,6)\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODgzNQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwMTY3Ng==", "bodyText": "Confirmed, we should be good to go.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r371301676", "createdAt": "2020-01-27T15:20:12Z", "author": {"login": "freemabd"}, "path": "api/db-cdr/generate-cdr/make-bq-data.sh", "diffHunk": "@@ -117,7 +117,7 @@ VALUES\n (1586134,'The Basics','Survey includes participant demographic information.',0,0,1),\n (43529712,'Personal Medical History','This survey includes information about past medical history, including medical conditions and approximate age of diagnosis.',0,0,4),\n (43528895,'Healthcare Access & Utilization','Survey includes information about a participants access to and use of health care.',0,0,5),\n-(43528698,'Family Medical History','Survey includes information about the medical history of a participants immediate biological family members.',0,0,6)\"\n+(43528698,'Family History','Survey includes information about the medical history of a participants immediate biological family members.',0,0,6)\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODgzNQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjIzMTExOnYy", "diffSide": "RIGHT", "path": "api/src/main/resources/client_api.yaml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDozNDoyNVrOFhpseQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNToyMToxOFrOFiGfuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMDQ1Nw==", "bodyText": "@dolbeew Should this api call be lumped in the the domain data api call, since we will only we showing 1 domain per bucket click?", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370830457", "createdAt": "2020-01-24T20:34:25Z", "author": {"login": "freemabd"}, "path": "api/src/main/resources/client_api.yaml", "diffHunk": "@@ -126,6 +126,31 @@ paths:\n           schema:\n             $ref: \"#/definitions/ConceptListResponse\"\n \n+  /v1/workspaces/{workspaceNamespace}/{workspaceId}/domainCounts:\n+    post:\n+      tags:\n+        - concepts\n+      consumes:\n+        - application/json\n+      description: >\n+        Searches for concepts in concept table by name, and optionally filter on\n+        domain, vocabulary IDs, or standard concept status. Uses the CDR version affiliated\n+        with the workspace specified in the path.\n+      operationId: \"domainCounts\"\n+      parameters:\n+        - $ref: '#/parameters/workspaceNamespace'\n+        - $ref: '#/parameters/workspaceId'\n+        - in: body\n+          name: request\n+          description: domain counts search request\n+          schema:\n+            $ref: \"#/definitions/DomainCountsRequest\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MzUyNQ==", "bodyText": "SGTM. And when searching from the homepage (all tabs), we would call that combined endpoint once for each tab?", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370863525", "createdAt": "2020-01-24T22:05:57Z", "author": {"login": "dolbeew"}, "path": "api/src/main/resources/client_api.yaml", "diffHunk": "@@ -126,6 +126,31 @@ paths:\n           schema:\n             $ref: \"#/definitions/ConceptListResponse\"\n \n+  /v1/workspaces/{workspaceNamespace}/{workspaceId}/domainCounts:\n+    post:\n+      tags:\n+        - concepts\n+      consumes:\n+        - application/json\n+      description: >\n+        Searches for concepts in concept table by name, and optionally filter on\n+        domain, vocabulary IDs, or standard concept status. Uses the CDR version affiliated\n+        with the workspace specified in the path.\n+      operationId: \"domainCounts\"\n+      parameters:\n+        - $ref: '#/parameters/workspaceNamespace'\n+        - $ref: '#/parameters/workspaceId'\n+        - in: body\n+          name: request\n+          description: domain counts search request\n+          schema:\n+            $ref: \"#/definitions/DomainCountsRequest\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMDQ1Nw=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwMjMyOA==", "bodyText": "Maybe, we can discuss this more after public launch.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r371302328", "createdAt": "2020-01-27T15:21:18Z", "author": {"login": "freemabd"}, "path": "api/src/main/resources/client_api.yaml", "diffHunk": "@@ -126,6 +126,31 @@ paths:\n           schema:\n             $ref: \"#/definitions/ConceptListResponse\"\n \n+  /v1/workspaces/{workspaceNamespace}/{workspaceId}/domainCounts:\n+    post:\n+      tags:\n+        - concepts\n+      consumes:\n+        - application/json\n+      description: >\n+        Searches for concepts in concept table by name, and optionally filter on\n+        domain, vocabulary IDs, or standard concept status. Uses the CDR version affiliated\n+        with the workspace specified in the path.\n+      operationId: \"domainCounts\"\n+      parameters:\n+        - $ref: '#/parameters/workspaceNamespace'\n+        - $ref: '#/parameters/workspaceId'\n+        - in: body\n+          name: request\n+          description: domain counts search request\n+          schema:\n+            $ref: \"#/definitions/DomainCountsRequest\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMDQ1Nw=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjIzNTQzOnYy", "diffSide": "RIGHT", "path": "common-api/src/main/java/org/pmiops/workbench/cdr/model/DbConcept.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDozNjoyMlrOFhpvHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjowODozNFrOFhrw6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMTEzMw==", "bodyText": "Eventually i think we will be replacing DbConcept with DbCriteria", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370831133", "createdAt": "2020-01-24T20:36:22Z", "author": {"login": "freemabd"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/model/DbConcept.java", "diffHunk": "@@ -49,6 +47,33 @@ public DbConcept(DbConcept a) {\n         .synonymsStr(a.getSynonymsStr());\n   }\n \n+  // Used from JQL queries in DbConcept", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NDM2MA==", "bodyText": "Good to know", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370864360", "createdAt": "2020-01-24T22:08:34Z", "author": {"login": "dolbeew"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/model/DbConcept.java", "diffHunk": "@@ -49,6 +47,33 @@ public DbConcept(DbConcept a) {\n         .synonymsStr(a.getSynonymsStr());\n   }\n \n+  // Used from JQL queries in DbConcept", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMTEzMw=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjIzODMyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-add-modal.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDozNzozOVrOFhpw_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjowOTozOFrOFhryJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMTYxNQ==", "bodyText": "At some point we should probably look at using Domain or DomainType but not both.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370831615", "createdAt": "2020-01-24T20:37:39Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-add-modal.tsx", "diffHunk": "@@ -26,13 +26,10 @@ const styles = reactStyles({\n });\n \n const filterConcepts = (concepts: any[], domain: Domain) => {\n-  if (domain === Domain.PHYSICALMEASUREMENT) {\n-    return concepts.filter(concept => concept.domainId === fp.capitalize(Domain[Domain.MEASUREMENT])\n-      && concept.vocabularyId === CriteriaType[CriteriaType.PPI]);\n-  } else if (domain === Domain.SURVEY) {\n+  if (domain === Domain.SURVEY) {\n     return concepts.filter(concept => !!concept.question);\n   } else {\n-    return concepts.filter(concept => concept.domainId === fp.capitalize(Domain[domain]));\n+    return concepts.filter(concept => concept.domainId.replace(' ', '').toLowerCase() === Domain[domain].toLowerCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NDY3OA==", "bodyText": "Agreed. Looks like they both have at least one value that the other doesn't. Would be good to see where those are being used, if at all, and consolidate them.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370864678", "createdAt": "2020-01-24T22:09:38Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/pages/data/concept/concept-add-modal.tsx", "diffHunk": "@@ -26,13 +26,10 @@ const styles = reactStyles({\n });\n \n const filterConcepts = (concepts: any[], domain: Domain) => {\n-  if (domain === Domain.PHYSICALMEASUREMENT) {\n-    return concepts.filter(concept => concept.domainId === fp.capitalize(Domain[Domain.MEASUREMENT])\n-      && concept.vocabularyId === CriteriaType[CriteriaType.PPI]);\n-  } else if (domain === Domain.SURVEY) {\n+  if (domain === Domain.SURVEY) {\n     return concepts.filter(concept => !!concept.question);\n   } else {\n-    return concepts.filter(concept => concept.domainId === fp.capitalize(Domain[domain]));\n+    return concepts.filter(concept => concept.domainId.replace(' ', '').toLowerCase() === Domain[domain].toLowerCase());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMTYxNQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjI0MzQ2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDo0MDowMFrOFhp0Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjoxNjo0MVrOFhr7Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMjQ1OA==", "bodyText": "@dolbeew we should probably only show this in local for the time being.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370832458", "createdAt": "2020-01-24T20:40:00Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -262,25 +241,24 @@ export const ConceptHomepage = withCurrentWorkspace()(\n           domain: domain.domain,\n           items: []\n         }));\n+        // Add ConceptCacheItem for Surveys tab\n+        conceptsCache.push({domain: Domain.SURVEY, items: []});\n         let conceptDomainCounts: DomainCount[] = conceptDomainInfo.items.map((domain) => ({\n           domain: domain.domain,\n           name: domain.name,\n           conceptCount: 0\n         }));\n-        if (environment.enableNewConceptTabs) {\n-          conceptsCache = [...conceptsCache, ...conceptCacheStub];\n-          conceptDomainCounts = [...conceptDomainCounts];\n-        } else {\n+        if (!environment.enableNewConceptTabs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2Njk0Nw==", "bodyText": "Yes, currently this flag is only enabled in the local environment", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370866947", "createdAt": "2020-01-24T22:16:41Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -262,25 +241,24 @@ export const ConceptHomepage = withCurrentWorkspace()(\n           domain: domain.domain,\n           items: []\n         }));\n+        // Add ConceptCacheItem for Surveys tab\n+        conceptsCache.push({domain: Domain.SURVEY, items: []});\n         let conceptDomainCounts: DomainCount[] = conceptDomainInfo.items.map((domain) => ({\n           domain: domain.domain,\n           name: domain.name,\n           conceptCount: 0\n         }));\n-        if (environment.enableNewConceptTabs) {\n-          conceptsCache = [...conceptsCache, ...conceptCacheStub];\n-          conceptDomainCounts = [...conceptDomainCounts];\n-        } else {\n+        if (!environment.enableNewConceptTabs) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMjQ1OA=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjI0NjM2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDo0MTozMFrOFhp2Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNToyNTowM1rOFiGpLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMjkzOQ==", "bodyText": "Should conceptCount be dynamic instead of 0?", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370832939", "createdAt": "2020-01-24T20:41:30Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -388,24 +366,28 @@ export const ConceptHomepage = withCurrentWorkspace()(\n       this.setState({\n         currentInputString: '',\n         currentSearchString: '',\n+        selectedSurvey: '',\n         showSearchError: false,\n         searching: false // reset the search result table to show browse/domain cards instead\n       });\n     }\n \n-    browseDomain(domain?: DomainInfo) {\n+    browseDomain(domain: DomainInfo) {\n       const {conceptDomainCounts} = this.state;\n-      const selectedDomain = !domain ? {domain: Domain.SURVEY, name: 'Surveys', conceptCount: 0}\n-        : conceptDomainCounts.find(domainCount => domainCount.domain === domain.domain);\n-      this.setState({currentInputString: '', currentSearchString: '', selectedDomain: selectedDomain}, () => this.searchConcepts());\n+      const selectedDomain = conceptDomainCounts.find(domainCount => domainCount.domain === domain.domain);\n+      this.setState(\n+        {currentInputString: '', currentSearchString: '', selectedDomain: selectedDomain, selectedSurvey: ''},\n+        () => this.searchConcepts()\n+      );\n     }\n \n     browseSurvey(surveyName) {\n-      if (environment.enableNewConceptTabs) {\n-        this.browseDomain();\n-      } else {\n-        this.setState({browsingSurvey: true, selectedSurvey: surveyName});\n-      }\n+      this.setState({\n+        currentInputString: '',\n+        currentSearchString: '',\n+        selectedDomain: {domain: Domain.SURVEY, name: 'Surveys', conceptCount: 0},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 209}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NzUxNg==", "bodyText": "It's basically a placeholder at this point. It will get replaced with the real count when searchConcepts() runs below.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370867516", "createdAt": "2020-01-24T22:18:31Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -388,24 +366,28 @@ export const ConceptHomepage = withCurrentWorkspace()(\n       this.setState({\n         currentInputString: '',\n         currentSearchString: '',\n+        selectedSurvey: '',\n         showSearchError: false,\n         searching: false // reset the search result table to show browse/domain cards instead\n       });\n     }\n \n-    browseDomain(domain?: DomainInfo) {\n+    browseDomain(domain: DomainInfo) {\n       const {conceptDomainCounts} = this.state;\n-      const selectedDomain = !domain ? {domain: Domain.SURVEY, name: 'Surveys', conceptCount: 0}\n-        : conceptDomainCounts.find(domainCount => domainCount.domain === domain.domain);\n-      this.setState({currentInputString: '', currentSearchString: '', selectedDomain: selectedDomain}, () => this.searchConcepts());\n+      const selectedDomain = conceptDomainCounts.find(domainCount => domainCount.domain === domain.domain);\n+      this.setState(\n+        {currentInputString: '', currentSearchString: '', selectedDomain: selectedDomain, selectedSurvey: ''},\n+        () => this.searchConcepts()\n+      );\n     }\n \n     browseSurvey(surveyName) {\n-      if (environment.enableNewConceptTabs) {\n-        this.browseDomain();\n-      } else {\n-        this.setState({browsingSurvey: true, selectedSurvey: surveyName});\n-      }\n+      this.setState({\n+        currentInputString: '',\n+        currentSearchString: '',\n+        selectedDomain: {domain: Domain.SURVEY, name: 'Surveys', conceptCount: 0},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMjkzOQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 209}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwNDc1MA==", "bodyText": "Oh.. gotcha. I think this is so, because surveys doesn't exist in the the domain_info table.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r371304750", "createdAt": "2020-01-27T15:25:03Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -388,24 +366,28 @@ export const ConceptHomepage = withCurrentWorkspace()(\n       this.setState({\n         currentInputString: '',\n         currentSearchString: '',\n+        selectedSurvey: '',\n         showSearchError: false,\n         searching: false // reset the search result table to show browse/domain cards instead\n       });\n     }\n \n-    browseDomain(domain?: DomainInfo) {\n+    browseDomain(domain: DomainInfo) {\n       const {conceptDomainCounts} = this.state;\n-      const selectedDomain = !domain ? {domain: Domain.SURVEY, name: 'Surveys', conceptCount: 0}\n-        : conceptDomainCounts.find(domainCount => domainCount.domain === domain.domain);\n-      this.setState({currentInputString: '', currentSearchString: '', selectedDomain: selectedDomain}, () => this.searchConcepts());\n+      const selectedDomain = conceptDomainCounts.find(domainCount => domainCount.domain === domain.domain);\n+      this.setState(\n+        {currentInputString: '', currentSearchString: '', selectedDomain: selectedDomain, selectedSurvey: ''},\n+        () => this.searchConcepts()\n+      );\n     }\n \n     browseSurvey(surveyName) {\n-      if (environment.enableNewConceptTabs) {\n-        this.browseDomain();\n-      } else {\n-        this.setState({browsingSurvey: true, selectedSurvey: surveyName});\n-      }\n+      this.setState({\n+        currentInputString: '',\n+        currentSearchString: '',\n+        selectedDomain: {domain: Domain.SURVEY, name: 'Surveys', conceptCount: 0},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMjkzOQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 209}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjI1MDcxOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/survey-details.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDo0MzozM1rOFhp5EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjoyMDowNFrOFhr-3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMzY4MQ==", "bodyText": "This new api call brings questions back in same order as CB.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370833681", "createdAt": "2020-01-24T20:43:33Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/survey-details.tsx", "diffHunk": "@@ -82,11 +82,11 @@ export const SurveyDetails = withCurrentWorkspace()(\n \n     async loadSurveyDetails() {\n       try {\n-        const {workspace, surveyName} = this.props;\n-        const surveys = await conceptsApi().getSurveyQuestions(\n-          workspace.namespace, workspace.id, surveyName);\n+        const {surveyName, workspace} = this.props;\n+        const request = {standardConceptFilter: StandardConceptFilter.ALLCONCEPTS, surveyName};\n+        const surveys = await conceptsApi().searchSurveys(workspace.namespace, workspace.id, request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NzkzNA==", "bodyText": "Ok, cool. That helps when we're ready to add numbers to the rows to match data browser.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370867934", "createdAt": "2020-01-24T22:20:04Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/pages/data/concept/survey-details.tsx", "diffHunk": "@@ -82,11 +82,11 @@ export const SurveyDetails = withCurrentWorkspace()(\n \n     async loadSurveyDetails() {\n       try {\n-        const {workspace, surveyName} = this.props;\n-        const surveys = await conceptsApi().getSurveyQuestions(\n-          workspace.namespace, workspace.id, surveyName);\n+        const {surveyName, workspace} = this.props;\n+        const request = {standardConceptFilter: StandardConceptFilter.ALLCONCEPTS, surveyName};\n+        const surveys = await conceptsApi().searchSurveys(workspace.namespace, workspace.id, request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMzY4MQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjQ4ODcyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjozMzoxMlrOFhsNpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNToyNDowMVrOFiGmRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg3MTcxOQ==", "bodyText": "I noticed that the SearchConceptsRequest accepted by this call has an optional surveyName param. Will that change anything in the response?", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r370871719", "createdAt": "2020-01-24T22:33:12Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -336,33 +314,36 @@ export const ConceptHomepage = withCurrentWorkspace()(\n     }\n \n     async searchConcepts() {\n-      const {standardConceptsOnly, currentSearchString, conceptsCache, selectedDomain,\n-        selectedConceptDomainMap} = this.state;\n+      const {standardConceptsOnly, currentSearchString, conceptsCache, selectedDomain, selectedConceptDomainMap, selectedSurvey}\n+        = this.state;\n       const {namespace, id} = this.props.workspace;\n       this.setState({concepts: [], searchLoading: true, searching: true, completedDomainSearches: []});\n       const standardConceptFilter = standardConceptsOnly ? StandardConceptFilter.STANDARDCONCEPTS : StandardConceptFilter.ALLCONCEPTS;\n       const completedDomainSearches = [];\n+      const request = {query: currentSearchString, standardConceptFilter: standardConceptFilter, maxResults: this.MAX_CONCEPT_FETCH};\n+      if (!!selectedSurvey) {\n+        request['surveyName'] = selectedSurvey;\n+      }\n+      conceptsApi().domainCounts(namespace, id, request).then(counts => {\n+        // Filter Physical Measurements if feature flag disabled\n+        const conceptDomainCounts = !environment.enableNewConceptTabs\n+          ? counts.domainCounts.filter(dc => dc.domain !== Domain.PHYSICALMEASUREMENT)\n+          : counts.domainCounts;\n+        this.setState({conceptDomainCounts: conceptDomainCounts});\n+      });\n       conceptsCache.forEach(async(cacheItem) => {\n         selectedConceptDomainMap[cacheItem.domain] = [];\n         const activeTabSearch = cacheItem.domain === selectedDomain.domain;\n-        const resp = await conceptsApi().searchConcepts(namespace, id, {\n-          query: currentSearchString,\n-          standardConceptFilter: standardConceptFilter,\n-          domain: cacheItem.domain,\n-          includeDomainCounts: activeTabSearch,\n-          maxResults: this.MAX_CONCEPT_FETCH\n-        });\n+        if (cacheItem.domain === Domain.SURVEY) {\n+          await conceptsApi().searchSurveys(namespace, id, request).then(resp => cacheItem.items = resp);\n+        } else {\n+          await conceptsApi().searchConcepts(namespace, id, {...request, domain: cacheItem.domain})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwNDAwNQ==", "bodyText": "Response will remain the same. SurveyName is only relevant when clicking a specific survey bucket.", "url": "https://github.com/all-of-us/workbench/pull/3041#discussion_r371304005", "createdAt": "2020-01-27T15:24:01Z", "author": {"login": "freemabd"}, "path": "ui/src/app/pages/data/concept/concept-homepage.tsx", "diffHunk": "@@ -336,33 +314,36 @@ export const ConceptHomepage = withCurrentWorkspace()(\n     }\n \n     async searchConcepts() {\n-      const {standardConceptsOnly, currentSearchString, conceptsCache, selectedDomain,\n-        selectedConceptDomainMap} = this.state;\n+      const {standardConceptsOnly, currentSearchString, conceptsCache, selectedDomain, selectedConceptDomainMap, selectedSurvey}\n+        = this.state;\n       const {namespace, id} = this.props.workspace;\n       this.setState({concepts: [], searchLoading: true, searching: true, completedDomainSearches: []});\n       const standardConceptFilter = standardConceptsOnly ? StandardConceptFilter.STANDARDCONCEPTS : StandardConceptFilter.ALLCONCEPTS;\n       const completedDomainSearches = [];\n+      const request = {query: currentSearchString, standardConceptFilter: standardConceptFilter, maxResults: this.MAX_CONCEPT_FETCH};\n+      if (!!selectedSurvey) {\n+        request['surveyName'] = selectedSurvey;\n+      }\n+      conceptsApi().domainCounts(namespace, id, request).then(counts => {\n+        // Filter Physical Measurements if feature flag disabled\n+        const conceptDomainCounts = !environment.enableNewConceptTabs\n+          ? counts.domainCounts.filter(dc => dc.domain !== Domain.PHYSICALMEASUREMENT)\n+          : counts.domainCounts;\n+        this.setState({conceptDomainCounts: conceptDomainCounts});\n+      });\n       conceptsCache.forEach(async(cacheItem) => {\n         selectedConceptDomainMap[cacheItem.domain] = [];\n         const activeTabSearch = cacheItem.domain === selectedDomain.domain;\n-        const resp = await conceptsApi().searchConcepts(namespace, id, {\n-          query: currentSearchString,\n-          standardConceptFilter: standardConceptFilter,\n-          domain: cacheItem.domain,\n-          includeDomainCounts: activeTabSearch,\n-          maxResults: this.MAX_CONCEPT_FETCH\n-        });\n+        if (cacheItem.domain === Domain.SURVEY) {\n+          await conceptsApi().searchSurveys(namespace, id, request).then(resp => cacheItem.items = resp);\n+        } else {\n+          await conceptsApi().searchConcepts(namespace, id, {...request, domain: cacheItem.domain})", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg3MTcxOQ=="}, "originalCommit": {"oid": "497286ae029184300bbb9c0bde9b4c28d4e85bfc"}, "originalPosition": 139}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3503, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}