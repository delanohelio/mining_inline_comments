{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3Mzk5Nzgx", "number": 3154, "title": "[RW-3848][Risk=no] Disable links for unregistered user in sidenav", "bodyText": "Description:\nChanges the sidenav to disable more things when you aren't registered. Adds unit tests to test for that. Also driveby fixes a bug I found where the user can't close the admin dropdown.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-02-19T21:14:35Z", "url": "https://github.com/all-of-us/workbench/pull/3154", "merged": true, "mergeCommit": {"oid": "e86ba88f380dd3308b059697bee2015b14dd5c8a"}, "closed": true, "closedAt": "2020-02-20T16:24:01Z", "author": {"login": "s-rubenstein"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF9KWWgH2gAyMzc3Mzk5NzgxOjMxZTJjNTViZTI3NjY0NmUwYTdkZGM4MmU2NTU0ODg2NjU1ZDQ4NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGNWpmAH2gAyMzc3Mzk5NzgxOjc3OGYzM2VhZDA2OTg2NGVhZGM1MzA2ZjRhMTVjYTUyOGIyNWNlYzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "31e2c55be276646e0a7ddc82e6554886655d4849", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/31e2c55be276646e0a7ddc82e6554886655d4849", "committedDate": "2020-02-19T21:11:13Z", "message": "[RW-3848][Risk=no] Disable links for unregistered user in sidenav"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNTExMzA5", "url": "https://github.com/all-of-us/workbench/pull/3154#pullrequestreview-361511309", "createdAt": "2020-02-19T23:21:14Z", "commit": {"oid": "31e2c55be276646e0a7ddc82e6554886655d4849"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyMToxNVrOFr7S1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyNDo0NlrOFr7XiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNDU2NA==", "bodyText": "unused", "url": "https://github.com/all-of-us/workbench/pull/3154#discussion_r381604564", "createdAt": "2020-02-19T23:21:15Z", "author": {"login": "calbach"}, "path": "ui/src/app/components/side-nav.spec.tsx", "diffHunk": "@@ -0,0 +1,39 @@\n+import {mount} from 'enzyme';\n+import * as React from 'react';\n+\n+import {SideNav, SideNavItem, SideNavProps} from './side-nav';\n+import {ProfileStubVariables} from \"../../testing/stubs/profile-api-stub\";\n+import {DataAccessLevel} from \"../../generated/fetch\";\n+\n+\n+describe('SideNav', () => {\n+  const existingNames = [];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e2c55be276646e0a7ddc82e6554886655d4849"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNTc2OQ==", "bodyText": "It would be better if this test also asserted that you found all the disabled items you were looking for. e.g. by removing elements from disabledItems as you find them and then asserting it's an empty list at the end. Or maybe by keeping a counter.\nFor example, if I added the string \"asdf\" to disabledItems above, the test wouldn't fail (more realistic scenario: we change the label text for one of these buttons and forget to update tests).", "url": "https://github.com/all-of-us/workbench/pull/3154#discussion_r381605769", "createdAt": "2020-02-19T23:24:46Z", "author": {"login": "calbach"}, "path": "ui/src/app/components/side-nav.spec.tsx", "diffHunk": "@@ -0,0 +1,39 @@\n+import {mount} from 'enzyme';\n+import * as React from 'react';\n+\n+import {SideNav, SideNavItem, SideNavProps} from './side-nav';\n+import {ProfileStubVariables} from \"../../testing/stubs/profile-api-stub\";\n+import {DataAccessLevel} from \"../../generated/fetch\";\n+\n+\n+describe('SideNav', () => {\n+  const existingNames = [];\n+  const props: SideNavProps = {\n+    profile: ProfileStubVariables.PROFILE_STUB,\n+    bannerAdminActive: false,\n+    workspaceAdminActive: false,\n+    homeActive: false,\n+    libraryActive: false,\n+    onToggleSideNav: () => {},\n+    profileActive: false,\n+    userAdminActive: false,\n+    workspacesActive: false,\n+  };\n+  const component = () => mount(<SideNav {...props}/>);\n+  it('should render', () => {\n+    const wrapper = component();\n+    expect(wrapper.exists()).toBeTruthy();\n+  });\n+\n+  it('disables options when user not registered', () => {\n+    const wrapper = mount(<SideNav {...props} profile={{...ProfileStubVariables.PROFILE_STUB,\n+      dataAccessLevel: DataAccessLevel.Unregistered}}/>);\n+    const disabledItems = ['Your Workspaces', 'Featured Workspaces', 'User Support'];\n+    wrapper.find(SideNavItem).forEach(sideNavItem => {\n+      if (disabledItems.includes(sideNavItem.text())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e2c55be276646e0a7ddc82e6554886655d4849"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df2efaedda9743adbe08cfe9ad3e2e52e03a6089", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/df2efaedda9743adbe08cfe9ad3e2e52e03a6089", "committedDate": "2020-02-20T15:45:28Z", "message": "PR Feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "778f33ead069864eadc5306f4a15ca528b25cec2", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/778f33ead069864eadc5306f4a15ca528b25cec2", "committedDate": "2020-02-20T16:03:08Z", "message": "Make tests do what I want"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3600, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}