{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MzE4NTEw", "number": 3775, "title": "[RW-2719][risk=no] Convert root CB component to React", "bodyText": "Converts the CohortSearch component from Angular to React. Should not include any design or functionality changes.\n@NehaBroad to review React conversion\n@freemabd to deploy UI locally to check functionality\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally", "createdAt": "2020-07-13T15:10:50Z", "url": "https://github.com/all-of-us/workbench/pull/3775", "merged": true, "mergeCommit": {"oid": "9c1af4c461c124a8ced075f168ce055d8ebeb405"}, "closed": true, "closedAt": "2020-07-15T14:41:59Z", "author": {"login": "dolbeew"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0jE7KAFqTQ0NzM1MzU5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1LrdzAFqTQ0OTAyMzkwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MzUzNTk4", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-447353598", "createdAt": "2020-07-13T15:22:11Z", "commit": {"oid": "02aa17b94d9a85d015020abda4d34fd4a820bca2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyMjoxMVrOGwtevA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyMjoxMVrOGwtevA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyOTk4MA==", "bodyText": "We can use FlexRowWrap here", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453729980", "createdAt": "2020-07-13T15:22:11Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,224 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,\n+          cohortChanged,\n+          updateGroupListsCount: this.state.updateGroupListsCount + 1\n+        });\n+      }));\n+      this.updateWrapperDimensions();\n+      this.props.setShowWarningModal(this.showWarningModal);\n+    }\n+\n+    componentWillUnmount() {\n+      this.subscription.unsubscribe();\n+      idsInUse.next(new Set());\n+      currentCohortStore.next(undefined);\n+      searchRequestStore.next({includes: [], excludes: [], dataFilters: []} as SearchRequest);\n+    }\n+\n+    async showWarningModal() {\n+      this.setState({modalOpen: true});\n+      return await new Promise<boolean>((resolve => this.resolve = resolve));\n+    }\n+\n+    getModalResponse(res: boolean) {\n+      this.setState({modalOpen: false});\n+      this.resolve(res);\n+    }\n+\n+    updateWrapperDimensions() {\n+      const {top} = this.searchWrapper.getBoundingClientRect();\n+      this.searchWrapper.style.minHeight = `${window.innerHeight - top - 24}px`;\n+    }\n+\n+    updateRequest = () => {\n+      // timeout prevents Angular 'Expression changed after checked' error\n+      setTimeout(() => this.setState({updateCount: this.state.updateCount + 1}));\n+    }\n+\n+    render() {\n+      const {cohort, cohortChanged, criteria, loading, modalOpen, overview, searchContext, updateCount, updateGroupListsCount} = this.state;\n+      return <React.Fragment>\n+        <div ref={el => this.searchWrapper = el} style={{padding: '1rem 1rem 2rem'}}>\n+        <div style={{display: 'flex', flexWrap: 'wrap', margin: '0 -0.5rem'}}>\n+          <div style={colStyle('66.66667')}>\n+            <div style={{display: 'flex', flexWrap: 'wrap', margin: '0 -0.5rem'}}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02aa17b94d9a85d015020abda4d34fd4a820bca2"}, "originalPosition": 141}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02aa17b94d9a85d015020abda4d34fd4a820bca2", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/02aa17b94d9a85d015020abda4d34fd4a820bca2", "committedDate": "2020-07-13T14:39:14Z", "message": "RW-2719 fix ui tests"}, "afterCommit": {"oid": "0a27ea634b027b357da7fb5680f2505c76d4a13c", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/0a27ea634b027b357da7fb5680f2505c76d4a13c", "committedDate": "2020-07-13T15:49:21Z", "message": "RW-2719 use flex component"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a27ea634b027b357da7fb5680f2505c76d4a13c", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/0a27ea634b027b357da7fb5680f2505c76d4a13c", "committedDate": "2020-07-13T15:49:21Z", "message": "RW-2719 use flex component"}, "afterCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3419128ca71c82d752da1610d86dd037aa98d2c6", "committedDate": "2020-07-13T16:54:05Z", "message": "RW-2719 use flex component"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDQzOTU3", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-447443957", "createdAt": "2020-07-13T17:13:54Z", "commit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxMzo1NFrOGwx8mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxMzo1NFrOGwx8mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMzE2MA==", "bodyText": "Question: Whats await new Promise((resolve => this.resolve = resolve)); used for", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453803160", "createdAt": "2020-07-13T17:13:54Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,\n+          cohortChanged,\n+          updateGroupListsCount: this.state.updateGroupListsCount + 1\n+        });\n+      }));\n+      this.updateWrapperDimensions();\n+      this.props.setShowWarningModal(this.showWarningModal);\n+    }\n+\n+    componentWillUnmount() {\n+      this.subscription.unsubscribe();\n+      idsInUse.next(new Set());\n+      currentCohortStore.next(undefined);\n+      searchRequestStore.next({includes: [], excludes: [], dataFilters: []} as SearchRequest);\n+    }\n+\n+    async showWarningModal() {\n+      this.setState({modalOpen: true});\n+      return await new Promise<boolean>((resolve => this.resolve = resolve));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDQ2MDc1", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-447446075", "createdAt": "2020-07-13T17:16:46Z", "commit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxNjo0N1rOGwyDiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxNjo0N1rOGwyDiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNDkzOQ==", "bodyText": "can sr ever be null? also can we use more meaningful variable searchRequest or something?", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453804939", "createdAt": "2020-07-13T17:16:47Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});\n+            currentCohortStore.next(cohort);\n+            if (cohort.criteria) {\n+              searchRequestStore.next(parseCohortDefinition(cohort.criteria));\n+            }\n+          });\n+        } else {\n+          this.setState({cohort: {criteria: `{'includes':[],'excludes':[],'dataFilters':[]}`, name: '', type: ''}});\n+        }\n+      });\n+\n+      this.subscription.add(searchRequestStore.subscribe(sr => {\n+        const cohortChanged = !!this.state.cohort && this.state.cohort.criteria !== JSON.stringify(mapRequest(sr));\n+        this.props.setCohortChanged(cohortChanged);\n+        this.setState({\n+          criteria: sr,\n+          overview: sr.includes.length > 0 || sr.excludes.length > 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDQ4NDc0", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-447448474", "createdAt": "2020-07-13T17:19:58Z", "commit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxOTo1OFrOGwyK8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxOTo1OFrOGwyK8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNjgzMw==", "bodyText": "What happens if this api throws an error", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453806833", "createdAt": "2020-07-13T17:19:58Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -0,0 +1,225 @@\n+import {Component} from '@angular/core';\n+import * as React from 'react';\n+\n+import {CBModal} from 'app/cohort-search/modal/modal.component';\n+import {ListOverview} from 'app/cohort-search/overview/overview.component';\n+import {SearchGroupList} from 'app/cohort-search/search-group-list/search-group-list.component';\n+import {idsInUse, searchRequestStore} from 'app/cohort-search/search-state.service';\n+import {mapRequest, parseCohortDefinition} from 'app/cohort-search/utils';\n+import {Button} from 'app/components/buttons';\n+import {FlexRowWrap} from 'app/components/flex';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import {SpinnerOverlay} from 'app/components/spinners';\n+import {cohortsApi} from 'app/services/swagger-fetch-clients';\n+import {ReactWrapperBase, withCurrentWorkspace} from 'app/utils';\n+import {currentCohortStore, queryParamsStore} from 'app/utils/navigation';\n+import {WorkspaceData} from 'app/utils/workspace-data';\n+import {Cohort, SearchRequest} from 'generated/fetch';\n+\n+function colStyle(percentage: string) {\n+  return {\n+    flex: `0 0 ${percentage}%`,\n+    maxWidth: `${percentage}%`,\n+    minHeight: '1px',\n+    padding: '0 0.5rem',\n+    position: 'relative',\n+    width: '100%'\n+  } as React.CSSProperties;\n+}\n+\n+interface Props {\n+  setCohortChanged: (cohortChanged: boolean) => void;\n+  setUpdatingCohort: (updatingCohort: boolean) => void;\n+  setShowWarningModal: (showWarningModal: () => Promise<boolean>) => void;\n+  workspace: WorkspaceData;\n+}\n+\n+interface State {\n+  loading: boolean;\n+  overview: boolean;\n+  criteria: SearchRequest;\n+  updateCount: number;\n+  cohort: Cohort;\n+  minHeight: string;\n+  modalPromise: Promise<boolean> | null;\n+  modalOpen: boolean;\n+  updateGroupListsCount: number;\n+  cohortChanged: boolean;\n+  searchContext: any;\n+}\n+\n+export const CohortSearch = withCurrentWorkspace() (\n+  class extends React.Component<Props, State> {\n+    private subscription;\n+    resolve: Function;\n+    searchWrapper: HTMLDivElement;\n+\n+    constructor(props: any) {\n+      super(props);\n+      this.state = {\n+        loading: false,\n+        overview: false,\n+        criteria: {includes: [], excludes: [], dataFilters: []},\n+        updateCount: 0,\n+        cohort: undefined,\n+        minHeight: '10rem',\n+        modalPromise:  null,\n+        modalOpen: false,\n+        updateGroupListsCount: 0,\n+        cohortChanged: false,\n+        searchContext: undefined\n+      };\n+      this.showWarningModal = this.showWarningModal.bind(this);\n+    }\n+\n+    componentDidMount() {\n+      const {workspace: {id, namespace}} = this.props;\n+      this.subscription = queryParamsStore.subscribe(params => {\n+        /* If a cohort id is given in the route, we initialize state with\n+         * it */\n+        const cohortId = params.cohortId;\n+        if (cohortId) {\n+          this.setState({loading: true});\n+          cohortsApi().getCohort(namespace, id, cohortId).then(cohort => {\n+            this.setState({cohort, loading: false});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDUxMjg4", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-447451288", "createdAt": "2020-07-13T17:23:44Z", "commit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoyMzo0NFrOGwyUKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoyMzo0NFrOGwyUKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwOTE5NA==", "bodyText": "Can we add more test like for search request with include/exclude?", "url": "https://github.com/all-of-us/workbench/pull/3775#discussion_r453809194", "createdAt": "2020-07-13T17:23:44Z", "author": {"login": "NehaBroad"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.spec.tsx", "diffHunk": "@@ -0,0 +1,19 @@\n+import {shallow} from 'enzyme';\n+import * as React from 'react';\n+\n+import {currentWorkspaceStore, queryParamsStore} from 'app/utils/navigation';\n+import {workspaceDataStub} from 'testing/stubs/workspaces-api-stub';\n+import {CohortSearch} from './cohort-search.component';\n+\n+describe('CohortSearch', () => {\n+  beforeEach(() => {\n+    currentWorkspaceStore.next(workspaceDataStub);\n+    queryParamsStore.next({\n+      cohortId: 'test-id'\n+    });\n+  });\n+  it('should render', () => {\n+    const wrapper = shallow(<CohortSearch setCohortChanged={() => {}} setShowWarningModal={() => {}} setUpdatingCohort={() => {}}/>);\n+    expect(wrapper).toBeTruthy();\n+  });\n+});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3419128ca71c82d752da1610d86dd037aa98d2c6"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16e5908cea5923177ccc7676d75eb7d83c30f784", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/16e5908cea5923177ccc7676d75eb7d83c30f784", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 initial react conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36b845ba6a2823d7ddc462cfadb44e56bfbed6ae", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/36b845ba6a2823d7ddc462cfadb44e56bfbed6ae", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 remove angular wrappers from children"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87a14660023e2264fbc5ca72e0665fc8a8a22693", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/87a14660023e2264fbc5ca72e0665fc8a8a22693", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 move cohort builder route to react router"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2decc3060f77ffdabc229beeef2dc523e5e1ba03", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/2decc3060f77ffdabc229beeef2dc523e5e1ba03", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 convert styles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78f76941d07c59df0c668e7a232f19da34709674", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/78f76941d07c59df0c668e7a232f19da34709674", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 workaraound for unsaved changes guard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "339f1427512d42d21c1a126ed0a87815ad14677e", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/339f1427512d42d21c1a126ed0a87815ad14677e", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 revert react-router changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a7e5fef350ae26eff2cc8d5a3c2489f62bb1793", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3a7e5fef350ae26eff2cc8d5a3c2489f62bb1793", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 fix ui tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb3085744abbde1302cb8290a593f2ff136e9c18", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/eb3085744abbde1302cb8290a593f2ff136e9c18", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 put back div ids for puppeteer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af79844229ac1f0f5171f59ff6aa568c7bfe2ec", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3af79844229ac1f0f5171f59ff6aa568c7bfe2ec", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 use flex component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3df93387a5de6896e6ea9b95fb405a0c42da0e7", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c3df93387a5de6896e6ea9b95fb405a0c42da0e7", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 pr feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5407d8409dc5ab45a0cadb944ec5fd44cc2e206", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d5407d8409dc5ab45a0cadb944ec5fd44cc2e206", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 add additional test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3320bd8c08864e45360e05e090def52fcf502567", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3320bd8c08864e45360e05e090def52fcf502567", "committedDate": "2020-07-14T14:41:25Z", "message": "RW-2719 add additional test"}, "afterCommit": {"oid": "d5407d8409dc5ab45a0cadb944ec5fd44cc2e206", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d5407d8409dc5ab45a0cadb944ec5fd44cc2e206", "committedDate": "2020-07-14T14:43:20Z", "message": "RW-2719 add additional test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzM1NTY1", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-448335565", "createdAt": "2020-07-14T17:54:54Z", "commit": {"oid": "d5407d8409dc5ab45a0cadb944ec5fd44cc2e206"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDIzOTA5", "url": "https://github.com/all-of-us/workbench/pull/3775#pullrequestreview-449023909", "createdAt": "2020-07-15T14:40:30Z", "commit": {"oid": "d5407d8409dc5ab45a0cadb944ec5fd44cc2e206"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4443, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}