{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NTI1MjEx", "number": 4028, "reviewThreads": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMjowOVrOElG5PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMzoyNFrOEmyZ0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ1NzI0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/google/CloudStorageService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMjowOVrOHUbChw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMjowOVrOHUbChw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NjU4Mw==", "bodyText": "alt: FileDetailMapper?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491176583", "createdAt": "2020-09-18T20:32:09Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/google/CloudStorageService.java", "diffHunk": "@@ -56,4 +57,14 @@ ServiceAccountCredentials getGarbageCollectionServiceAccountCredentials(\n   String getMoodleApiKey();\n \n   String getCaptchaServerKey();\n+\n+  default FileDetail blobToFileDetail(Blob blob, String bucketName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ2MDM2OnYy", "diffSide": "RIGHT", "path": "api/src/main/resources/workbench-api.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMzoxMlrOHUbEXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NjowOFrOHWIIqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NzA1Mg==", "bodyText": "alt: include this (and also cloudStorageTraffic?) in the WorkspaceAdminView", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491177052", "createdAt": "2020-09-18T20:33:12Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1720,6 +1720,21 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n+  \"/v1/admin/workspaces/{workspaceNamespace}/files\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NDAxMQ==", "bodyText": "I think I like what you've done here with splitting it out. In the future, if we need to paginate this endpoint we'll have the flexibility to do so.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492964011", "createdAt": "2020-09-22T18:56:08Z", "author": {"login": "calbach"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -1720,6 +1720,21 @@ paths:\n           description: HTML Read Only version of the notebook\n           schema:\n             \"$ref\": \"#/definitions/ReadOnlyNotebookResponse\"\n+  \"/v1/admin/workspaces/{workspaceNamespace}/files\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NzA1Mg=="}, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ2MjUwOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNDowMlrOHUbFsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNDowMlrOHUbFsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NzM5NQ==", "bodyText": "extracted from AdminWorkspaceImpl class", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491177395", "createdAt": "2020-09-18T20:34:02Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -30,22 +35,100 @@ const styles = reactStyles({\n   narrowWithMargin: {\n     width: '10rem',\n     marginRight: '1rem'\n-  }\n-});\n+  },\n+  fileDetailsTable: {\n+    maxWidth: '1000px',\n+    marginTop: '1rem',\n+  },\n+})\n \n const PurpleLabel = ({style = {}, children}) => {\n   return <label style={{color: colors.primary, ...style}}>\n     {...children}\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ2NzUzOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNTo0OFrOHUbItQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOToxNTo0OFrOHWIzhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3ODE2NQ==", "bodyText": "alt: parseLocation, deriveLocation, etc?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491178165", "createdAt": "2020-09-18T20:35:48Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -30,22 +35,100 @@ const styles = reactStyles({\n   narrowWithMargin: {\n     width: '10rem',\n     marginRight: '1rem'\n-  }\n-});\n+  },\n+  fileDetailsTable: {\n+    maxWidth: '1000px',\n+    marginTop: '1rem',\n+  },\n+})\n \n const PurpleLabel = ({style = {}, children}) => {\n   return <label style={{color: colors.primary, ...style}}>\n     {...children}\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={{width: '80%', maxWidth: '1000px'}}>\n+    <PurpleLabel\n+        style={{\n+          width: '250px',\n+          minWidth: '180px',\n+          textAlign: 'right',\n+          marginRight: '1rem',\n+        }}\n+    >\n+      {labelText}\n+    </PurpleLabel>\n+    <div\n+        style={{\n+          flex: 1,\n+          wordWrap: 'break-word',\n+        }}\n+    >\n+      {divContents}\n+    </div>\n+  </FlexRow>;\n+};\n+\n+const FileDetails = (props: {data: WorkspaceFiles}) => {\n+  const {data} = props;\n+  const {bucket} = data;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: number;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NDk4MQ==", "bodyText": "parseLocation seems reasonable to me", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492974981", "createdAt": "2020-09-22T19:15:48Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -30,22 +35,100 @@ const styles = reactStyles({\n   narrowWithMargin: {\n     width: '10rem',\n     marginRight: '1rem'\n-  }\n-});\n+  },\n+  fileDetailsTable: {\n+    maxWidth: '1000px',\n+    marginTop: '1rem',\n+  },\n+})\n \n const PurpleLabel = ({style = {}, children}) => {\n   return <label style={{color: colors.primary, ...style}}>\n     {...children}\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={{width: '80%', maxWidth: '1000px'}}>\n+    <PurpleLabel\n+        style={{\n+          width: '250px',\n+          minWidth: '180px',\n+          textAlign: 'right',\n+          marginRight: '1rem',\n+        }}\n+    >\n+      {labelText}\n+    </PurpleLabel>\n+    <div\n+        style={{\n+          flex: 1,\n+          wordWrap: 'break-word',\n+        }}\n+    >\n+      {divContents}\n+    </div>\n+  </FlexRow>;\n+};\n+\n+const FileDetails = (props: {data: WorkspaceFiles}) => {\n+  const {data} = props;\n+  const {bucket} = data;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: number;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3ODE2NQ=="}, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ5NDA4OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTozNFrOHUbYbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTozNFrOHUbYbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE4MjE4OQ==", "bodyText": "these are all whitespace and this. removal", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491182189", "createdAt": "2020-09-18T20:45:34Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -209,23 +273,14 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           <h2>Workspace</h2>\n           <h3>Basic Information</h3>\n           <div className='basic-info' style={{marginTop: '1rem'}}>\n-            {this.workspaceInfoField('Workspace Name', workspace.name)}\n-            {this.workspaceInfoField('Google Project Id', workspace.namespace)}\n-            {this.workspaceInfoField('Billing Status', workspace.billingStatus)}\n-            {this.workspaceInfoField('Billing Account Type', workspace.billingAccountType)}\n-            {this.workspaceInfoField(\n-              'Creation Time',\n-              new Date(workspace.creationTime).toDateString()\n-            )}\n-            {this.workspaceInfoField(\n-              'Last Modified Time',\n-              new Date(workspace.lastModifiedTime).toDateString()\n-            )}\n-            {this.workspaceInfoField(\n-              'Workspace Published',\n-              workspace.published ? 'Yes' : 'No'\n-            )}\n-            {this.workspaceInfoField('Audit', <a href={`/admin/workspace-audit/${workspace.namespace}`}>Audit History</a>)}\n+            {workspaceInfoField('Workspace Name', workspace.name)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 199}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ5NDkwOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTo0OVrOHUbY4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDo0NTo0OVrOHUbY4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE4MjMwNA==", "bodyText": "here's the new component!", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r491182304", "createdAt": "2020-09-18T20:45:49Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,82 +292,29 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            {workspaceInfoField('# of Cohorts', resources.workspaceObjects.cohortCount)}\n+            {workspaceInfoField('# of Concept Sets', resources.workspaceObjects.conceptSetCount)}\n+            {workspaceInfoField('# of Data Sets', resources.workspaceObjects.datasetCount)}\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            {workspaceInfoField('# of Notebook Files', resources.cloudStorage.notebookFileCount)}\n+            {workspaceInfoField('# of Non-Notebook Files', resources.cloudStorage.nonNotebookFileCount)}\n+            {workspaceInfoField('Storage used (bytes)', resources.cloudStorage.storageBytesUsed)}\n           </div>\n+          {files && <FileDetails data={files}/>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "980cb23becdaf572402ff5ad672ac06ff1231bcb"}, "originalPosition": 260}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzQ5MTY5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/google/CloudStorageService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0Mjo0NlrOHV4G5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0Mjo0NlrOHV4G5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMTQxMg==", "bodyText": "This line is the only addition.  The rest was moved as-is from NotebooksServiceImpl.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492701412", "createdAt": "2020-09-22T12:42:46Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/google/CloudStorageService.java", "diffHunk": "@@ -56,4 +57,14 @@ ServiceAccountCredentials getGarbageCollectionServiceAccountCredentials(\n   String getMoodleApiKey();\n \n   String getCaptchaServerKey();\n+\n+  default FileDetail blobToFileDetail(Blob blob, String bucketName) {\n+    String[] parts = blob.getName().split(\"/\");\n+    FileDetail fileDetail = new FileDetail();\n+    fileDetail.setName(parts[parts.length - 1]);\n+    fileDetail.setPath(\"gs://\" + bucketName + \"/\" + blob.getName());\n+    fileDetail.setLastModifiedTime(blob.getUpdateTime());\n+    fileDetail.setSize(blob.getSize());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzQ5MzU0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0MzoxNlrOHV4ICw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo0NjowMlrOHWHwwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMTcwNw==", "bodyText": "alt name: listFiles?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492701707", "createdAt": "2020-09-22T12:43:16Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -64,4 +66,10 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n         workspaceAdminService.getReadOnlyNotebook(workspaceNamespace, notebookName, accessReason);\n     return ResponseEntity.ok(new ReadOnlyNotebookResponse().html(notebookHtml));\n   }\n+\n+  @Override\n+  @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n+  public ResponseEntity<List<FileDetail>> getFiles(String workspaceNamespace) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1Nzg4OA==", "bodyText": "I like listFiles", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492957888", "createdAt": "2020-09-22T18:46:02Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/api/WorkspaceAdminController.java", "diffHunk": "@@ -64,4 +66,10 @@ public WorkspaceAdminController(WorkspaceAdminService workspaceAdminService) {\n         workspaceAdminService.getReadOnlyNotebook(workspaceNamespace, notebookName, accessReason);\n     return ResponseEntity.ok(new ReadOnlyNotebookResponse().html(notebookHtml));\n   }\n+\n+  @Override\n+  @AuthorityRequired({Authority.RESEARCHER_DATA_VIEW})\n+  public ResponseEntity<List<FileDetail>> getFiles(String workspaceNamespace) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMTcwNw=="}, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzQ5ODc3OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NDoyOFrOHV4LKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NDoyOFrOHV4LKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMjUwNA==", "bodyText": "extracted from workspaceInfoField()", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492702504", "createdAt": "2020-09-22T12:44:28Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -18,19 +18,41 @@ import {\n } from 'app/utils/research-purpose';\n import {\n   CloudStorageTraffic,\n-  ListRuntimeResponse, WorkspaceAdminView,\n+  FileDetail,\n+  ListRuntimeResponse,\n+  WorkspaceAdminView,\n } from 'generated/fetch';\n+import {Column} from 'primereact/column';\n+import {DataTable} from 'primereact/datatable';\n import {ReactFragment} from 'react';\n \n const styles = reactStyles({\n+  infoRow: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzUwNDA4OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo0NTo0NVrOHV4OUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOToxMjoyNlrOHWIskw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMzMxMg==", "bodyText": "changed this text to be more precise.  See the comments at https://precisionmedicineinitiative.atlassian.net/browse/RW-5471", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492703312", "createdAt": "2020-09-22T12:45:45Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,88 +283,29 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            {workspaceInfoField('# of Cohorts', resources.workspaceObjects.cohortCount)}\n+            {workspaceInfoField('# of Concept Sets', resources.workspaceObjects.conceptSetCount)}\n+            {workspaceInfoField('# of Data Sets', resources.workspaceObjects.datasetCount)}\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            {workspaceInfoField('GCS bucket path', resources.cloudStorage.storageBucketPath)}\n+            {workspaceInfoField('# of Workbench-managed notebook files', resources.cloudStorage.notebookFileCount)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 255}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3MzIwMw==", "bodyText": "FYI: Technically there is a middle-ground, which are notebooks in subdirs of notebooks/. These are synchronized back/forth to the notebook VM/GCS, but are not displayed on the RW notebooks list page. Way too much detail for this line, and I don't think I would change the description you have here.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492973203", "createdAt": "2020-09-22T19:12:26Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,88 +283,29 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            {workspaceInfoField('# of Cohorts', resources.workspaceObjects.cohortCount)}\n+            {workspaceInfoField('# of Concept Sets', resources.workspaceObjects.conceptSetCount)}\n+            {workspaceInfoField('# of Data Sets', resources.workspaceObjects.datasetCount)}\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            {workspaceInfoField('GCS bucket path', resources.cloudStorage.storageBucketPath)}\n+            {workspaceInfoField('# of Workbench-managed notebook files', resources.cloudStorage.notebookFileCount)}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwMzMxMg=="}, "originalCommit": {"oid": "b32e41ea10724f941cf3bd47865b0145f5fbe00e"}, "originalPosition": 255}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDc0MjIxOnYy", "diffSide": "LEFT", "path": "api/src/test/java/org/pmiops/workbench/api/WorkspacesControllerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowOToyNFrOHWENoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowOToyNFrOHWENoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5OTc0NQ==", "bodyText": "unused here.  useful for the other test, so I moved it there.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492899745", "createdAt": "2020-09-22T17:09:24Z", "author": {"login": "jmthibault79"}, "path": "api/src/test/java/org/pmiops/workbench/api/WorkspacesControllerTest.java", "diffHunk": "@@ -471,15 +475,6 @@ private void mockBillingProjectBuffer(String projectName) {\n     doReturn(entry).when(billingProjectBufferService).assignBillingProject(any());\n   }\n \n-  private Blob mockBlob(String bucket, String path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDc1MjYyOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxMjowN1rOHWEUBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxMjowN1rOHWEUBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwMTM4MA==", "bodyText": "These 3 lines copied from some other DataTable.  I can remove/adjust if inappropriate here.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492901380", "createdAt": "2020-09-22T17:12:07Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');\n+  };\n+\n+  const formatMB = (fileSize: number): string => {\n+    const mb = fileSize / 1000000.0;\n+    if (mb < 1.0) {\n+      return '<1';\n+    } else {\n+      return mb.toFixed(2);\n+    }\n+  };\n+\n+  const formattedData: Array<TableEntry> = data.map(file => {\n+    return {\n+      name: file.name,\n+      size: formatMB(file.size),\n+      location: getLocation(file)\n+    };\n+  });\n+\n+  const sortedData = formattedData.sort((a, b) => {\n+    const locCmp = a.location.localeCompare(b.location);\n+    if (locCmp === 0) {\n+      return a.name.localeCompare(b.name);\n+    } else {\n+      return locCmp;\n+    }\n+  });\n+\n+  return <DataTable\n+      data-test-id='object-details-table'\n+      value={sortedData}\n+      style={styles.fileDetailsTable}\n+      scrollable={true}\n+      paginator={true}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "400dd699e8ceca70ee6b352b0a924a0a3c82c69a"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTE0NjU5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODo1NToxN1rOHWIGrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToxNToyNFrOHWzoxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg==", "bodyText": "It's worth noting that the implementation for getBlobList is flawed - it only returns the first page of results. This is probably acceptable for your use case here, though it would be ideal to communicate whether there are more files or not back to the admin page. I think it will present more of a problem for us on the admin page - more so than on the user-facing page, since people may have a large number of object files living outside of the main notebooks/ directory.\nDo you mind adding a disclaimer to this method? Ideally the admin method would also communicate storage.get(bucketName).list().hasNextPage() back to the client.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492963502", "createdAt": "2020-09-22T18:55:17Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAyMDgwNg==", "bodyText": "whoa - I was not aware, thanks.  Is there a getBlobList ticket?  We should probably address this more generally.  Maybe with new names as a first step - getFirst100Blobs maybe?", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493020806", "createdAt": "2020-09-22T20:41:57Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2NTY3MA==", "bodyText": "I don't think there's a ticket - I just noticed this when I looked at the implementation during review. I fixed one similar issue around cloning a while back, but forgot to check this.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493065670", "createdAt": "2020-09-22T22:19:43Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA2NTk3OQ==", "bodyText": "And yea - updating the name make sense. I highly doubt the current behavior was intentional, devs often miss that these list APIs are (of course), paginated.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493065979", "createdAt": "2020-09-22T22:20:33Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA4MDAyOA==", "bodyText": "Welp.  It's crappy but it's honest.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493080028", "createdAt": "2020-09-22T23:00:43Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA4MDIyNQ==", "bodyText": "Added a bunch of Javadoc and code comments as well.  I'll file a ticket to come back to this.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493080225", "createdAt": "2020-09-22T23:01:19Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3Njc0MQ==", "bodyText": "https://precisionmedicineinitiative.atlassian.net/browse/RW-5633", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493676741", "createdAt": "2020-09-23T15:15:24Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/workspaceadmin/WorkspaceAdminServiceImpl.java", "diffHunk": "@@ -241,6 +242,21 @@ public String getReadOnlyNotebook(\n     return notebooksService.adminGetReadOnlyHtml(workspaceNamespace, workspaceName, notebookName);\n   }\n \n+  @Override\n+  public List<FileDetail> getFiles(String workspaceNamespace) {\n+    final String workspaceName =\n+        getWorkspaceByNamespaceOrThrow(workspaceNamespace).getFirecloudName();\n+    final String bucketName =\n+        fireCloudService\n+            .getWorkspaceAsService(workspaceNamespace, workspaceName)\n+            .getWorkspace()\n+            .getBucketName();\n+\n+    return cloudStorageService.getBlobList(bucketName).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2MzUwMg=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTE4NTM3OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTowNToyMFrOHWId_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDoyNDowNVrOHWLARQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2OTQ3MQ==", "bodyText": "Existing issue, so feel free to ignore this for now:\nI'm wondering whether it might be more idiomatic to just make this into a private function component as you did for FileDetailsTable, since it's only a few characters removed from that currently (maybe @petesantos has an opinion on this):\nconst WorkspaceInfoField = ({labelText, children}) => {\n  ...\n};\n\nlater..\n<WorkspaceInfoField labelText=\"...\"> ... </WorkspaceInfoField>", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492969471", "createdAt": "2020-09-22T19:05:20Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxMTAxMw==", "bodyText": "done", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493011013", "createdAt": "2020-09-22T20:24:05Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2OTQ3MQ=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTIxMTc3OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOToxMzoyNFrOHWIucg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOToxMzoyNFrOHWIucg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3MzY4Mg==", "bodyText": "Really nice solution, thank you. Could you apply this to the total on L304 as well?\nThis also satisfies the AC on https://precisionmedicineinitiative.atlassian.net/browse/RW-5472 , so please close that with this PR as well - if you don't mind.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492973682", "createdAt": "2020-09-22T19:13:24Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');\n+  };\n+\n+  const formatMB = (fileSize: number): string => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTIzNzU4OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOToyMToxNlrOHWI-3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDo0NDozMlrOHWLr-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Nzg4Nw==", "bodyText": "Current approach incorrectly handles this input:\nparseLocation({... 'gs://bkt/foo/bar/foo'}) -> 'gs://bkt/bar/foo'\n\nProbably substring() is best here; regexp is a bit dicey since the prefix/suffix are ultimately user input.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r492977887", "createdAt": "2020-09-22T19:21:16Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxMjcyMg==", "bodyText": "Sorry - not quite following here", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493012722", "createdAt": "2020-09-22T20:27:01Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Nzg4Nw=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAyMDc3NQ==", "bodyText": "replace replaces the first instance, so if the filename is duplicated in the path this approach fails", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493020775", "createdAt": "2020-09-22T20:41:53Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Nzg4Nw=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAyMjIwMw==", "bodyText": "ah thanks", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493022203", "createdAt": "2020-09-22T20:44:32Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -39,13 +61,76 @@ const PurpleLabel = ({style = {}, children}) => {\n   </label>;\n };\n \n+const workspaceInfoField = (labelText: string, divContents: React.ReactFragment) => {\n+  return <FlexRow style={styles.infoRow}>\n+    <PurpleLabel style={styles.infoLabel}>{labelText}</PurpleLabel>\n+    <div style={styles.infoValue}>{divContents}</div>\n+  </FlexRow>;\n+};\n+\n+const FileDetailsTable = (props: {data: Array<FileDetail>, bucket: string}) => {\n+  const {data, bucket} = props;\n+\n+  interface TableEntry {\n+    name: string;\n+    size: string;\n+    location: string;\n+  }\n+\n+  const getLocation = (file: FileDetail): string => {\n+    const prefix = `${bucket}/`;\n+    const suffix = `/${file.name}`;\n+    return file.path.replace(prefix, '').replace(suffix, '');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Nzg4Nw=="}, "originalCommit": {"oid": "743b4d780c19a67c6b05871efdab6cba13494c9a"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTA2NDAzOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMDo0MlrOHXBZ9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMDo0MlrOHXBZ9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMjMyNQ==", "bodyText": "nit: string literals prop values shouldn't need {}", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493902325", "createdAt": "2020-09-23T21:20:42Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,89 +297,48 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'# of Cohorts'}>{resources.workspaceObjects.cohortCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Concept Sets'}>{resources.workspaceObjects.conceptSetCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Data Sets'}>{resources.workspaceObjects.datasetCount}</WorkspaceInfoField>\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            <div style={{color: colors.warning, fontWeight: 'bold'}}>\n+              NOTE: these may be undercounts, because we process only a single page of storage list results.\n+            </div>\n+            <WorkspaceInfoField labelText={'GCS bucket path'}>\n+              {resources.cloudStorage.storageBucketPath}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Workbench-managed notebook files'}>\n+              {resources.cloudStorage.notebookFileCount}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of other files'}>\n+              {resources.cloudStorage.nonNotebookFileCount}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'Storage used (MB)'}>\n+              {formatMB(resources.cloudStorage.storageBytesUsed)}\n+            </WorkspaceInfoField>\n           </div>\n+          {files && <FileDetailsTable data={files} bucket={resources.cloudStorage.storageBucketPath}/>}\n           <h3>Research Purpose</h3>\n           <div className='research-purpose' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'Primary purpose of project',\n-                getSelectedPrimaryPurposeItems(\n-                  workspace.researchPurpose).map(\n-                    (\n-                      researchPurposeItem, i) =>\n-                      <div key={i}>{researchPurposeItem}</div>\n-                    )\n-                )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Reason for choosing All of Us',\n-                workspace.researchPurpose.reasonForAllOfUs\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Area of intended study',\n-                workspace.researchPurpose.intendedStudy\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Anticipated findings',\n-                workspace.researchPurpose.anticipatedFindings\n-              )\n-            }\n-            {\n-              workspace.researchPurpose.populationDetails.length > 0 && this.workspaceInfoField(\n-                'Population area(s) of focus',\n-                getSelectedPopulations(workspace.researchPurpose)\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'Primary purpose of project'}>\n+              {getSelectedPrimaryPurposeItems(workspace.researchPurpose).map((researchPurposeItem, i) =>\n+                  <div key={i}>{researchPurposeItem}</div>)}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'Reason for choosing All of Us'}>\n+              {workspace.researchPurpose.reasonForAllOfUs}\n+            </WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'Area of intended study'}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "originalPosition": 329}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTA2Nzg2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMjowNFrOHXBcSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMjowNFrOHXBcSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMjkyMg==", "bodyText": "I would clarify in this note that it may undercount if there are ~1000 or more objects in the bucket.", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493902922", "createdAt": "2020-09-23T21:22:04Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,89 +297,48 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'# of Cohorts'}>{resources.workspaceObjects.cohortCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Concept Sets'}>{resources.workspaceObjects.conceptSetCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Data Sets'}>{resources.workspaceObjects.datasetCount}</WorkspaceInfoField>\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            <div style={{color: colors.warning, fontWeight: 'bold'}}>\n+              NOTE: these may be undercounts, because we process only a single page of storage list results.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "originalPosition": 269}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTA3MTUzOnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/admin/admin-workspace.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMzoyNFrOHXBepQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMzoyNFrOHXBepQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMzUyNQ==", "bodyText": "Would also clarify that the file table may be incomplete as well", "url": "https://github.com/all-of-us/workbench/pull/4028#discussion_r493903525", "createdAt": "2020-09-23T21:23:24Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/admin/admin-workspace.tsx", "diffHunk": "@@ -237,89 +297,48 @@ class AdminWorkspaceImpl extends React.Component<UrlParamsProps, State> {\n           </div>\n           <h3>Cohort Builder</h3>\n           <div className='cohort-builder' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                '# of Cohorts',\n-                resources.workspaceObjects.cohortCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Concept Sets',\n-                resources.workspaceObjects.conceptSetCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Data Sets',\n-                resources.workspaceObjects.datasetCount\n-              )\n-            }\n+            <WorkspaceInfoField labelText={'# of Cohorts'}>{resources.workspaceObjects.cohortCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Concept Sets'}>{resources.workspaceObjects.conceptSetCount}</WorkspaceInfoField>\n+            <WorkspaceInfoField labelText={'# of Data Sets'}>{resources.workspaceObjects.datasetCount}</WorkspaceInfoField>\n           </div>\n           <h3>Cloud Storage Objects</h3>\n           <div className='cloud-storage-objects' style={{marginTop: '1rem'}}>\n-            {\n-              this.workspaceInfoField(\n-                'GCS bucket path',\n-                resources.cloudStorage.storageBucketPath\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Notebook Files',\n-                resources.cloudStorage.notebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                '# of Non-Notebook Files',\n-                resources.cloudStorage.nonNotebookFileCount\n-              )\n-            }\n-            {\n-              this.workspaceInfoField(\n-                'Storage used (bytes)',\n-                resources.cloudStorage.storageBytesUsed\n-              )\n-            }\n+            <div style={{color: colors.warning, fontWeight: 'bold'}}>\n+              NOTE: these may be undercounts, because we process only a single page of storage list results.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bc028889a68dca064120f8a130eb79cc31d6cbb"}, "originalPosition": 269}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3923, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}