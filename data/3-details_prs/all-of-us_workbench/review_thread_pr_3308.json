{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NzU2NjUx", "number": 3308, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjozMlrODsEU6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0ODoyNlrODsGQRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTM0ODI0OnYy", "diffSide": "LEFT", "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjozMlrOF8xbqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjozMlrOF8xbqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2ODc3Nw==", "bodyText": "Renamed to userHasRemainingFreeTierCredits and moved below", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399268777", "createdAt": "2020-03-27T13:36:32Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -61,10 +62,6 @@ public FreeTierBillingService(\n     this.workbenchConfigProvider = workbenchConfigProvider;\n   }\n \n-  public boolean userHasFreeTierCredits(DbUser user) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTM1MzAyOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNzo0MlrOF8xemw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNzo0MlrOF8xemw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2OTUzMQ==", "bodyText": "No functional change here", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399269531", "createdAt": "2020-03-27T13:37:42Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -245,11 +258,7 @@ public Double getUserCachedFreeTierUsage(DbUser user) {\n    * @return the US dollar amount, represented as a double\n    */\n   public double getUserFreeTierDollarLimit(DbUser user) {\n-    final Double override = user.getFreeTierCreditsLimitDollarsOverride();\n-    if (override != null) {\n-      return override;\n-    }\n-\n-    return workbenchConfigProvider.get().billing.defaultFreeCreditsDollarLimit;\n+    return Optional.ofNullable(user.getFreeTierCreditsLimitDollarsOverride())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTM1NTAyOnYy", "diffSide": "LEFT", "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozODowOFrOF8xf1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozODowOFrOF8xf1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2OTg0Ng==", "bodyText": "renamed: \"user\" is redundant", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399269846", "createdAt": "2020-03-27T13:38:08Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -230,13 +227,29 @@ private void maybeAlertOnCostThresholds(\n    * have created. This is NOT live BigQuery data: it is only as recent as the last\n    * checkFreeTierBillingUsage cron job, recorded as last_update_time in the DB.\n    *\n+   * <p>Note: return value may be null, to enable direct assignment to the nullable Profile field\n+   *\n    * @param user the user as represented in our database\n    * @return the total USD amount spent in workspaces created by this user, represented as a double\n    */\n-  public Double getUserCachedFreeTierUsage(DbUser user) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTY1Mzk1OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NjoxOFrOF80aHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNToxNTowN1rOF81sXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxNzUzNQ==", "bodyText": "nit: can it be like user: the user as represented in our database to make it more readable", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399317535", "createdAt": "2020-03-27T14:46:18Z", "author": {"login": "NehaBroad"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -230,13 +227,29 @@ private void maybeAlertOnCostThresholds(\n    * have created. This is NOT live BigQuery data: it is only as recent as the last\n    * checkFreeTierBillingUsage cron job, recorded as last_update_time in the DB.\n    *\n+   * <p>Note: return value may be null, to enable direct assignment to the nullable Profile field\n+   *\n    * @param user the user as represented in our database\n    * @return the total USD amount spent in workspaces created by this user, represented as a double\n    */\n-  public Double getUserCachedFreeTierUsage(DbUser user) {\n+  @Nullable\n+  public Double getCachedFreeTierUsage(DbUser user) {\n     return workspaceFreeTierUsageDao.totalCostByUser(user);\n   }\n \n+  /**\n+   * Does this user have remaining free tier credits? Compare the user-specific free tier limit (may\n+   * be the system default) to the amount they have used.\n+   *\n+   * @param user the user as represented in our database", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzODU5MA==", "bodyText": "I like that idea, but a space is the javadoc standard for @param", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399338590", "createdAt": "2020-03-27T15:15:07Z", "author": {"login": "jmthibault79"}, "path": "api/src/main/java/org/pmiops/workbench/billing/FreeTierBillingService.java", "diffHunk": "@@ -230,13 +227,29 @@ private void maybeAlertOnCostThresholds(\n    * have created. This is NOT live BigQuery data: it is only as recent as the last\n    * checkFreeTierBillingUsage cron job, recorded as last_update_time in the DB.\n    *\n+   * <p>Note: return value may be null, to enable direct assignment to the nullable Profile field\n+   *\n    * @param user the user as represented in our database\n    * @return the total USD amount spent in workspaces created by this user, represented as a double\n    */\n-  public Double getUserCachedFreeTierUsage(DbUser user) {\n+  @Nullable\n+  public Double getCachedFreeTierUsage(DbUser user) {\n     return workspaceFreeTierUsageDao.totalCostByUser(user);\n   }\n \n+  /**\n+   * Does this user have remaining free tier credits? Compare the user-specific free tier limit (may\n+   * be the system default) to the amount they have used.\n+   *\n+   * @param user the user as represented in our database", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxNzUzNQ=="}, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTY2NDA0OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/pmiops/workbench/workspaces/WorkspacesControllerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0ODoyNlrOF80gWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNToxNjoyNFrOF81wCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxOTEzMQ==", "bodyText": "Why to remove ?", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399319131", "createdAt": "2020-03-27T14:48:26Z", "author": {"login": "NehaBroad"}, "path": "api/src/test/java/org/pmiops/workbench/workspaces/WorkspacesControllerTest.java", "diffHunk": "@@ -236,7 +236,7 @@\n           .domainId(\"Measurement\")\n           .countValue(256L)\n           .prevalence(0.4F)\n-          .conceptSynonyms(new ArrayList<String>());\n+          .conceptSynonyms(new ArrayList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzOTUyOA==", "bodyText": "I have an auto-linter configured which does small fixes like this when I touch a file.", "url": "https://github.com/all-of-us/workbench/pull/3308#discussion_r399339528", "createdAt": "2020-03-27T15:16:24Z", "author": {"login": "jmthibault79"}, "path": "api/src/test/java/org/pmiops/workbench/workspaces/WorkspacesControllerTest.java", "diffHunk": "@@ -236,7 +236,7 @@\n           .domainId(\"Measurement\")\n           .countValue(256L)\n           .prevalence(0.4F)\n-          .conceptSynonyms(new ArrayList<String>());\n+          .conceptSynonyms(new ArrayList<>());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxOTEzMQ=="}, "originalCommit": {"oid": "9c29f8e5be65c94ae9722d1ea85f70365900caa7"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3075, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}