{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NTkwNDA2", "number": 3134, "title": "[RW-4335][RW-4336][risk=no] Concept Search - Search by domain", "bodyText": "When viewing a specific domain (after clicking a tile on concept homepage), show only the tab for that domain and only search by that domain.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n I have run and tested this change locally", "createdAt": "2020-02-14T22:01:13Z", "url": "https://github.com/all-of-us/workbench/pull/3134", "merged": true, "mergeCommit": {"oid": "f1d264a2e48baf772f5c1a98cff2f8f1d748caa8"}, "closed": true, "closedAt": "2020-02-21T17:21:25Z", "author": {"login": "dolbeew"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFPT3tgH2gAyMzc1NTkwNDA2OjdhN2IwZTdlOTUzMTRhZGJlNDg1OGQzZGFiYTgyNDUwM2E5YTA0N2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGi5Y2gFqTM2Mjc4MjQ4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a7b0e7e95314adbe4858d3daba824503a9a047e", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/7a7b0e7e95314adbe4858d3daba824503a9a047e", "committedDate": "2020-02-17T15:45:59Z", "message": "RW-4335 only show selected domain tab when clicking concept tile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d3c71cce2961120a791fb0c17c7a420168e523f", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6d3c71cce2961120a791fb0c17c7a420168e523f", "committedDate": "2020-02-17T15:45:59Z", "message": "RW-4335 show name in header when searching within a domain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84c03526ed6f640aa2761cffd9225f5655974c6d", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/84c03526ed6f640aa2761cffd9225f5655974c6d", "committedDate": "2020-02-17T15:46:00Z", "message": "RW-4335 search surveys by survey name when provided"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c993c1578f4dc14f177cd78c28b3d91c65645858", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c993c1578f4dc14f177cd78c28b3d91c65645858", "committedDate": "2020-02-14T21:55:12Z", "message": "RW-4335 search surveys by survey name when provided"}, "afterCommit": {"oid": "84c03526ed6f640aa2761cffd9225f5655974c6d", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/84c03526ed6f640aa2761cffd9225f5655974c6d", "committedDate": "2020-02-17T15:46:00Z", "message": "RW-4335 search surveys by survey name when provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/2ce55754c11faa90a363ec382761b09726d858ac", "committedDate": "2020-02-17T16:08:51Z", "message": "RW-4335 clear search input when navigating back to concept homepage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4339fc2a873c8bbb8e6630293f4b469491d95382", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/4339fc2a873c8bbb8e6630293f4b469491d95382", "committedDate": "2020-02-17T20:50:36Z", "message": "[RW-4469][risk=no] copy BQ tables (#3141)\n\n* moving tables.\r\n\r\n* fixng copy tables script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "808175c2c27cf0f4e56eeed2a7095fc87ef9e760", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/808175c2c27cf0f4e56eeed2a7095fc87ef9e760", "committedDate": "2020-02-18T16:22:08Z", "message": "[risk=no][RW-4384] Disable closed billing accounts in dropdown (#3133)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d01b455fded44fb3b9eb5eaee318b9547c08c4", "author": {"user": {"login": "ericsong", "name": "Eric Song"}}, "url": "https://github.com/all-of-us/workbench/commit/e7d01b455fded44fb3b9eb5eaee318b9547c08c4", "committedDate": "2020-02-18T17:39:21Z", "message": "[RW-4433][risk=no] Update code snippets (#3143)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a1981941ebd93d3bd037252f3d37f1594fcbba", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/64a1981941ebd93d3bd037252f3d37f1594fcbba", "committedDate": "2020-02-18T17:52:53Z", "message": "[risk=no][RW-4238]Update yarn.lock for Node 12 compatibility on Mac (#2972)\n\n* Don't allow fsevents installs below 1.2.9, required by Node 12\r\n* update Readme with known-compatible Node versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b7d6e8a747d3f7a7a567a14b2131f30f592ae7b", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/5b7d6e8a747d3f7a7a567a14b2131f30f592ae7b", "committedDate": "2020-02-18T18:43:58Z", "message": " [RW-4470][risk=no] Log username when rejecting a disabled user (#3144)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69ed5a0e6edc137fcdba85b6a272c91ba4425cb2", "author": {"user": {"login": "als364", "name": "Ariel Schwartz"}}, "url": "https://github.com/all-of-us/workbench/commit/69ed5a0e6edc137fcdba85b6a272c91ba4425cb2", "committedDate": "2020-02-18T18:54:25Z", "message": "[risk=low][RW-3407] Workspace Admin UI (#3117)\n\n* get clusters for gcp project id\r\n\r\n* stashing.\r\n\r\n* ok got workspace info now\r\n\r\n* workspace objects\r\n\r\n* more data, small refactor\r\n\r\n* styling\r\n\r\n* clusters\r\n\r\n* expando + research purpose\r\n\r\n* small refactors\r\n\r\n* linting\r\n\r\n* bad rebase\r\n\r\n* fix test\r\n\r\n* ui feedback\r\n\r\n* lint\r\n\r\n* reconfigure styles\r\n\r\n* lint\r\n\r\n* new test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81abb8b1126b9db63b5521de041d0761149102ad", "author": {"user": {"login": "dependabot[bot]", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/81abb8b1126b9db63b5521de041d0761149102ad", "committedDate": "2020-02-18T19:16:07Z", "message": "[risk=low]Bump yarn from 1.21.1 to 1.22.0 in /ui (#3137)\n\nBumps [yarn](https://github.com/yarnpkg/yarn) from 1.21.1 to 1.22.0.\r\n- [Release notes](https://github.com/yarnpkg/yarn/releases)\r\n- [Changelog](https://github.com/yarnpkg/yarn/blob/master/CHANGELOG.md)\r\n- [Commits](https://github.com/yarnpkg/yarn/compare/v1.21.1...v1.22.0)\r\n\r\nSigned-off-by: dependabot[bot] <support@github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44c932ae718c09dc54006be1ecd8ad0c4c5d0a79", "author": {"user": {"login": "jscherdin", "name": "Jon Scherdin"}}, "url": "https://github.com/all-of-us/workbench/commit/44c932ae718c09dc54006be1ecd8ad0c4c5d0a79", "committedDate": "2020-02-18T20:15:34Z", "message": "for cb_search_person table, changed dob column from timestamp to date, added two new columns age_at_consent and age_at_cdr and added code to calculate both of these data points (#3147)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ca5c0c319714d720018e9c69d8fe7dc09267ef", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/f3ca5c0c319714d720018e9c69d8fe7dc09267ef", "committedDate": "2020-02-18T20:23:40Z", "message": "[RW-4244][Risk=no] Srubenst/cookie policy (#3145)\n\n* WIP cookies warning\r\n\r\n* [RW-4244][Risk=no] Add Cookie Policy\r\n\r\n* Revert accidental text change\r\n\r\n* PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "833411decb9e85e4d268b90305b20a3bfb794fc1", "author": {"user": {"login": "jscherdin", "name": "Jon Scherdin"}}, "url": "https://github.com/all-of-us/workbench/commit/833411decb9e85e4d268b90305b20a3bfb794fc1", "committedDate": "2020-02-18T21:02:29Z", "message": "removing some json DDL files that are no longer used (#3148)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d0f36e659479455121d2ace8589222d3dd17327", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/8d0f36e659479455121d2ace8589222d3dd17327", "committedDate": "2020-02-18T22:39:37Z", "message": "[RW-4144][risk=no] Rebackfill the free tier billing account name (#3149)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f608d10bb1d2223f4dc61bea52b155965a033d53", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/f608d10bb1d2223f4dc61bea52b155965a033d53", "committedDate": "2020-02-19T16:50:47Z", "message": "[RW-4450][Risk=no] Remove limit on SQL query in notebooks (#3151)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa1abf3291f40346211fe8c2f05cbb2e3ebb8f55", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/aa1abf3291f40346211fe8c2f05cbb2e3ebb8f55", "committedDate": "2020-02-19T18:13:02Z", "message": "[RW-4435][risk=no] creating table for dob/age at consent/age at cdr generation (#3150)\n\n* make command to build cloud cdr.\r\n\r\n* RW-4435 removing unused generate-cloudsql-db command\r\n\r\n* rerun checks\r\n\r\n* RW-4435 adding data to cb_person for local development."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "292ec9187ce50bcfe2667fcfe4ce637d11763d4d", "author": {"user": {"login": "dolbeew", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/292ec9187ce50bcfe2667fcfe4ce637d11763d4d", "committedDate": "2020-02-19T19:40:38Z", "message": "[RW-3994][risk=no] CB - Add rename option to search items (#3146)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21a3a785c8e3e5557aae24004032060ea9240f6f", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/21a3a785c8e3e5557aae24004032060ea9240f6f", "committedDate": "2020-02-19T20:55:22Z", "message": "[RW-4244][Risk=no] Separate cookie banner (#3153)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96bc3411dde950e99de97159b2cbcf4d45552489", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/96bc3411dde950e99de97159b2cbcf4d45552489", "committedDate": "2020-02-19T21:41:34Z", "message": "[RW-4421][Risk=no] Remove pending review from workspace tiles (#3156)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d90f6194590b46332c8858747419cb3f2ec4b625", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/d90f6194590b46332c8858747419cb3f2ec4b625", "committedDate": "2020-02-19T21:43:48Z", "message": "[RW-3570][Risk=no] Update Fisma language (#3155)\n\n* [RW-3570][Risk=no] Update Fisma language\r\n\r\n* Fix linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a5e7b63dfafb435c0745dfbd8db13528bbc49eb", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2a5e7b63dfafb435c0745dfbd8db13528bbc49eb", "committedDate": "2020-02-20T03:51:13Z", "message": "Liquibase for workspace edit (#3111)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ace9c25cb9091577da661aa563813d1bd9633204", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ace9c25cb9091577da661aa563813d1bd9633204", "committedDate": "2020-02-20T04:14:37Z", "message": "[RW-4285][risk=NO] Changes to workspace description page (#3109)\n\n* Workspace Edit page\r\n\r\n* tests and other changes\r\n\r\n* null checks\r\n\r\n* Upsing optional.ofNullable\r\n\r\n* Test fix\r\n\r\n* Name change to ResearchOutcome\r\n\r\n* change variable name to have List\r\n\r\n* fix test\r\n\r\n* spotless\r\n\r\n* split Liquibase change to another PR\r\n\r\n* lint\r\n\r\n* adding comments\r\n\r\n* PR Comments I\r\n\r\n* test fix\r\n\r\n* UI TEST\r\n\r\n* Add tooltip\r\n\r\n* PR Comments: moving style and spaces\r\n\r\n* Margin correction for Specific population\r\n\r\n* UI Changes Primary Purpose\r\n\r\n* Fix UI Test\r\n\r\n* correct import statment\r\n\r\n* fix ui test\r\n\r\n* Lous UI Comment\r\n\r\n* Change font Size for sub Categories\r\n\r\n* Space after ."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "332cf0d529813bf3a73afea4516a57d5f8a28f75", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/332cf0d529813bf3a73afea4516a57d5f8a28f75", "committedDate": "2020-02-20T15:52:17Z", "message": "[RW-4463][RISK=NO] Interceptor-based logging (#3136)\n\nCreate request metric interceptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e86ba88f380dd3308b059697bee2015b14dd5c8a", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/e86ba88f380dd3308b059697bee2015b14dd5c8a", "committedDate": "2020-02-20T16:24:00Z", "message": "[RW-3848][Risk=no] Disable links for unregistered user in sidenav (#3154)\n\n* [RW-3848][Risk=no] Disable links for unregistered user in sidenav\r\n\r\n* PR Feedback\r\n\r\n* Make tests do what I want"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52d1641ae022d4a32bd3a027d9451da968e79c0c", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/52d1641ae022d4a32bd3a027d9451da968e79c0c", "committedDate": "2020-02-20T16:31:53Z", "message": "[RW-4481][Risk=no] Remove scroll to bottom from TOS (#3158)\n\n* [RW-4481][Risk=no] Remove scroll to bottom from TOS\r\n\r\n* Remove unused code\r\n\r\n* Lou Feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ff23fac58b2a13b1fbc6419667eb35ab6ec2b40", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/7ff23fac58b2a13b1fbc6419667eb35ab6ec2b40", "committedDate": "2020-02-20T16:52:26Z", "message": "[risk=no][RW-4438] Use actual query instead of Java stream over all table rows (#3126)\n\nimproved query efficiency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMDgzODY2", "url": "https://github.com/all-of-us/workbench/pull/3134#pullrequestreview-362083866", "createdAt": "2020-02-20T17:14:54Z", "commit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxNDo1NFrOFscACg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxODo1NVrOFscI5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MDQyNg==", "bodyText": "Need to delete countSurveys()", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382140426", "createdAt": "2020-02-20T17:14:54Z", "author": {"login": "freemabd"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -130,6 +130,35 @@\n       nativeQuery = true)\n   long countSurveys(@Param(\"term\") String term);\n \n+  @Query(\n+      value =\n+          \"select count(*) \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1\",\n+      nativeQuery = true)\n+  long countSurveyByName(@Param(\"term\") String term, @Param(\"surveyName\") String surveyName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MDc0NQ==", "bodyText": "need to delete findSurveys(@Param(\"limit\") int limit, @Param(\"offset\") int offset)", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382140745", "createdAt": "2020-02-20T17:15:33Z", "author": {"login": "freemabd"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -155,6 +184,41 @@\n   List<DbConcept> findSurveys(\n       @Param(\"term\") String term, @Param(\"limit\") int limit, @Param(\"offset\") int offset);\n \n+  @Query(\n+      value =\n+          \"select concept_id, concept_name, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1 \"\n+              + \"order by id \"\n+              + \"limit :limit offset :offset\",\n+      nativeQuery = true)\n+  List<DbConcept> findSurveysByName(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjMzOA==", "bodyText": "Also, can we rename this to findSurveysByTermAndName?", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382142338", "createdAt": "2020-02-20T17:18:18Z", "author": {"login": "freemabd"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -155,6 +184,41 @@\n   List<DbConcept> findSurveys(\n       @Param(\"term\") String term, @Param(\"limit\") int limit, @Param(\"offset\") int offset);\n \n+  @Query(\n+      value =\n+          \"select concept_id, concept_name, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1 \"\n+              + \"order by id \"\n+              + \"limit :limit offset :offset\",\n+      nativeQuery = true)\n+  List<DbConcept> findSurveysByName(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjY5NQ==", "bodyText": "Also, can we rename this to countSurveyByTermAndName?", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382142695", "createdAt": "2020-02-20T17:18:55Z", "author": {"login": "freemabd"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -130,6 +130,35 @@\n       nativeQuery = true)\n   long countSurveys(@Param(\"term\") String term);\n \n+  @Query(\n+      value =\n+          \"select count(*) \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1\",\n+      nativeQuery = true)\n+  long countSurveyByName(@Param(\"term\") String term, @Param(\"surveyName\") String surveyName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79d134090e0d330025ba745f8a477abb56e4bf14", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/79d134090e0d330025ba745f8a477abb56e4bf14", "committedDate": "2020-02-20T17:20:32Z", "message": "addressing comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "300df1cb0a3cd088b77a8337ad9579bc8c1db0f5", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/300df1cb0a3cd088b77a8337ad9579bc8c1db0f5", "committedDate": "2020-02-20T17:41:15Z", "message": "[RW-4354][Risk=no] Update homepage tagline (#3157)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e40320a0dd17d3fbbd155b8c0a0ce4a7b6c43c5d", "author": {"user": {"login": "freemabd", "name": "Brian Freeman"}}, "url": "https://github.com/all-of-us/workbench/commit/e40320a0dd17d3fbbd155b8c0a0ce4a7b6c43c5d", "committedDate": "2020-02-20T18:23:55Z", "message": "[no ticket][risk=no] Fixing broken test case in Intellij (#3164)\n\n* fixing test case that iss broken when running in Intellij.\r\n\r\n* adding comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad9ff518375737cb4dd4a8cb6534d01367c505b", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2ad9ff518375737cb4dd4a8cb6534d01367c505b", "committedDate": "2020-02-20T19:38:14Z", "message": "[RW-4285][RISK=NO] Changes to workspace description page -Send data to RDR (#3161)\n\n* send Workspace parameters to RDR\r\n\r\n* Change object name to specify RDR Object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e386bbf6a6d0fc0881772b39d81813ad912ca4a", "author": {"user": {"login": "s-rubenstein", "name": "Sky Rubenstein"}}, "url": "https://github.com/all-of-us/workbench/commit/0e386bbf6a6d0fc0881772b39d81813ad912ca4a", "committedDate": "2020-02-20T19:50:56Z", "message": "[RW-4353][Risk=low] Change logo image (#3166)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fce91b4142e88e4fa256e0ce28ffe2944c76a7c1", "author": {"user": {"login": "jscherdin", "name": "Jon Scherdin"}}, "url": "https://github.com/all-of-us/workbench/commit/fce91b4142e88e4fa256e0ce28ffe2944c76a7c1", "committedDate": "2020-02-20T21:03:53Z", "message": "added code to remove temp data from prep_criteria_ancestor so it is clean for future runs (#3165)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f36898b61db03170f10ad674cf0ae65ed4783e3", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/4f36898b61db03170f10ad674cf0ae65ed4783e3", "committedDate": "2020-02-20T21:43:03Z", "message": "RDR Workspace Export issue (#3168)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a25e3b68dae7550bd8c5368f5f095b9d9b823914", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/a25e3b68dae7550bd8c5368f5f095b9d9b823914", "committedDate": "2020-02-20T22:41:04Z", "message": "[risk=low][RW-4259]Enforce Verified Institutional Affiliation (API only) for new account creation if feature flag is set (#3139)\n\n* add InstitutionMapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a95eee00e356eac4eadc72677821243f9375e9", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/78a95eee00e356eac4eadc72677821243f9375e9", "committedDate": "2020-02-20T23:22:28Z", "message": "[risk=no] Add missing import (#3171)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20db4d1d41955b3abc426968420ff9a5e9ed1f48", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/20db4d1d41955b3abc426968420ff9a5e9ed1f48", "committedDate": "2020-02-21T12:30:03Z", "message": "RW-4335 only show selected domain tab when clicking concept tile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fbbd09c5c4edcb1d45d0ab6df1a1b468bddae92", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3fbbd09c5c4edcb1d45d0ab6df1a1b468bddae92", "committedDate": "2020-02-21T12:30:03Z", "message": "RW-4335 show name in header when searching within a domain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618c6c2c65d1aa42ceb72b1a78eee1c2ad0d6066", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/618c6c2c65d1aa42ceb72b1a78eee1c2ad0d6066", "committedDate": "2020-02-21T12:30:03Z", "message": "RW-4335 search surveys by survey name when provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62542117da9ae85f38ae8abe6398d2f430a19774", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/62542117da9ae85f38ae8abe6398d2f430a19774", "committedDate": "2020-02-21T12:30:03Z", "message": "RW-4335 clear search input when navigating back to concept homepage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cb825486fe3f3f64efd9d61c0597d28dc96cb1b", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/1cb825486fe3f3f64efd9d61c0597d28dc96cb1b", "committedDate": "2020-02-21T12:31:12Z", "message": "Merge branch 'dolbeew/RW-4335' of https://github.com/all-of-us/workbench into dolbeew/RW-4335\n\n\u0001 Conflicts:\n\u0001\tcommon-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzEzMjE3", "url": "https://github.com/all-of-us/workbench/pull/3134#pullrequestreview-362713217", "createdAt": "2020-02-21T15:32:28Z", "commit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTozMjoyOFrOFs644g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTozMjo1OVrOFs65_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY0NjQ5OA==", "bodyText": "Done", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382646498", "createdAt": "2020-02-21T15:32:28Z", "author": {"login": "dolbeew"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -130,6 +130,35 @@\n       nativeQuery = true)\n   long countSurveys(@Param(\"term\") String term);\n \n+  @Query(\n+      value =\n+          \"select count(*) \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1\",\n+      nativeQuery = true)\n+  long countSurveyByName(@Param(\"term\") String term, @Param(\"surveyName\") String surveyName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MDQyNg=="}, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY0NjYzMA==", "bodyText": "Good idea, done.", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382646630", "createdAt": "2020-02-21T15:32:44Z", "author": {"login": "dolbeew"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -130,6 +130,35 @@\n       nativeQuery = true)\n   long countSurveys(@Param(\"term\") String term);\n \n+  @Query(\n+      value =\n+          \"select count(*) \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1\",\n+      nativeQuery = true)\n+  long countSurveyByName(@Param(\"term\") String term, @Param(\"surveyName\") String surveyName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjY5NQ=="}, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY0NjczMw==", "bodyText": "Done", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382646733", "createdAt": "2020-02-21T15:32:53Z", "author": {"login": "dolbeew"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -155,6 +184,41 @@\n   List<DbConcept> findSurveys(\n       @Param(\"term\") String term, @Param(\"limit\") int limit, @Param(\"offset\") int offset);\n \n+  @Query(\n+      value =\n+          \"select concept_id, concept_name, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1 \"\n+              + \"order by id \"\n+              + \"limit :limit offset :offset\",\n+      nativeQuery = true)\n+  List<DbConcept> findSurveysByName(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MDc0NQ=="}, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY0Njc4Mg==", "bodyText": "Done", "url": "https://github.com/all-of-us/workbench/pull/3134#discussion_r382646782", "createdAt": "2020-02-21T15:32:59Z", "author": {"login": "dolbeew"}, "path": "common-api/src/main/java/org/pmiops/workbench/cdr/dao/ConceptDao.java", "diffHunk": "@@ -155,6 +184,41 @@\n   List<DbConcept> findSurveys(\n       @Param(\"term\") String term, @Param(\"limit\") int limit, @Param(\"offset\") int offset);\n \n+  @Query(\n+      value =\n+          \"select concept_id, concept_name, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"from \"\n+              + \"  (select case when @curType = concept_name then @curRow \\\\:= @curRow + 1 else @curRow \\\\:= 1 end as rank, \"\n+              + \"   id, @curType \\\\:= concept_name as concept_name, concept_id, domain_id, vocabulary_id, concept_class_id, standard_concept, concept_code, count_value, prevalence, source_count_value, synonyms \"\n+              + \"    from \"\n+              + \"      (select cr.id, c.* \"\n+              + \"        from cb_criteria cr \"\n+              + \"        join concept c on c.concept_id = cr.concept_id \"\n+              + \"        where cr.domain_id = 'SURVEY' \"\n+              + \"          and cr.type = 'PPI' \"\n+              + \"          and cr.subtype = 'ANSWER' \"\n+              + \"          and cr.path like CONCAT( \"\n+              + \"            (select dc.id \"\n+              + \"              from cb_criteria dc \"\n+              + \"              where dc.domain_id = 'SURVEY' \"\n+              + \"                and dc.type = 'PPI' \"\n+              + \"                and dc.name = :surveyName), '.%' \"\n+              + \"          ) \"\n+              + \"          and match(c.concept_name, c.concept_code, c.vocabulary_id, c.synonyms) against (:term in boolean mode)\"\n+              + \"      ) a, \"\n+              + \"      (select @curRow \\\\:= 0, @curType \\\\:= '') r \"\n+              + \"    order by concept_name, id \"\n+              + \"  ) as x \"\n+              + \"where rank = 1 \"\n+              + \"order by id \"\n+              + \"limit :limit offset :offset\",\n+      nativeQuery = true)\n+  List<DbConcept> findSurveysByName(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjMzOA=="}, "originalCommit": {"oid": "2ce55754c11faa90a363ec382761b09726d858ac"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzgyNDg5", "url": "https://github.com/all-of-us/workbench/pull/3134#pullrequestreview-362782489", "createdAt": "2020-02-21T17:09:05Z", "commit": {"oid": "1cb825486fe3f3f64efd9d61c0597d28dc96cb1b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3583, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}