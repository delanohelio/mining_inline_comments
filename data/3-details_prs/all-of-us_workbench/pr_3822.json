{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NDQ4NjU2", "number": 3822, "title": "[RW-5113][risk=no] UI - Sidebar to right of page with functionality to add criteria to groups (phase 1)", "bodyText": "Part of this PR:\n\nCriteria Added should match as that in mocks\n\n\n\nClicking Criteria should have Add Selected section slide out with two Groups: Standard and Source Code\n\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-07-23T02:33:56Z", "url": "https://github.com/all-of-us/workbench/pull/3822", "merged": true, "mergeCommit": {"oid": "6ed562213067664be6054bcd861261d5ede4375d"}, "closed": true, "closedAt": "2020-08-04T02:48:42Z", "author": {"login": "NehaBroad"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1REXCgH2gAyNDU1NDQ4NjU2OjdlYTRjMGE3ZjgxYzY0MjYwN2RmZWU5MDExOTQ3MjEzZTc5Y2MzZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7YSP2AFqTQ2MDMyODcyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7ea4c0a7f81c642607dfee9011947213e79cc3eb", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7ea4c0a7f81c642607dfee9011947213e79cc3eb", "committedDate": "2020-07-15T20:57:13Z", "message": "Sidebar Icon for Cohort Criteria page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd4e02767d1144b102586f27510494fe0ad7de9", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/cfd4e02767d1144b102586f27510494fe0ad7de9", "committedDate": "2020-07-15T21:09:00Z", "message": "Remove extra lines etc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "174d4f296c7a120801fdbda36ccac252e4cfb5cc", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/174d4f296c7a120801fdbda36ccac252e4cfb5cc", "committedDate": "2020-07-15T21:12:54Z", "message": "Fix UI test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fcb66d82c010cbf5a16b1d156b77af3ef3582cd", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9fcb66d82c010cbf5a16b1d156b77af3ef3582cd", "committedDate": "2020-07-20T15:06:45Z", "message": "PR Comments: Remove criteriaStore from criteriaReview and add config to selectionList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71a8d0d31c19072ca499604401001c06bab7d601", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/71a8d0d31c19072ca499604401001c06bab7d601", "committedDate": "2020-07-20T16:56:53Z", "message": "Use Growl instead of Message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d2956d71e4038701b888ffed1883c2eca75bc42", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1d2956d71e4038701b888ffed1883c2eca75bc42", "committedDate": "2020-07-20T18:17:26Z", "message": "Rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81fa7cc4e3d69698a87f4de30d56b856a9218023", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/81fa7cc4e3d69698a87f4de30d56b856a9218023", "committedDate": "2020-07-23T02:30:59Z", "message": "Criteria Cart"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66e7cf17aa3edb265bf988e5ec446a5d92f715cd", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/66e7cf17aa3edb265bf988e5ec446a5d92f715cd", "committedDate": "2020-07-23T02:50:46Z", "message": "Rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ebd62c8f90a2a10490937b8f6849ee59c85e0a3", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8ebd62c8f90a2a10490937b8f6849ee59c85e0a3", "committedDate": "2020-07-23T02:53:06Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1470c509b9ac37a64379c7b64f3b3b6126028f6", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f1470c509b9ac37a64379c7b64f3b3b6126028f6", "committedDate": "2020-07-23T02:55:13Z", "message": "Revert some extra adds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6227e5378a9d884c905079c4d5de7c23e02df07e", "committedDate": "2020-07-23T13:23:29Z", "message": "Fix UI Test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDY0OTc5", "url": "https://github.com/all-of-us/workbench/pull/3822#pullrequestreview-454464979", "createdAt": "2020-07-23T20:18:43Z", "commit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDoxODo0NFrOG2aGoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMToxOTowOVrOG2b73Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMzk2OQ==", "bodyText": "We should remove from currentCohortCriteriaStore instead of calling removeSelection here", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459703969", "createdAt": "2020-07-23T20:18:44Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -136,6 +141,55 @@ export class SelectionInfo extends React.Component<SelectionInfoProps, Selection\n   }\n }\n \n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <FlexColumn style={styles.selectionItem}>\n+      {this.showOr && <div style={{padding: '0.3rem 0rem 0.3rem 1rem'}}>OR&nbsp;</div>}\n+      <FlexRow style={{alignItems: 'baseline'}}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyNDQxMA==", "bodyText": "It won't let me comment on the actual lines, but here are a couple I missed last time:\n\nLine 343: Use right style property instead of paddingLeft: '83%' to set growl position. Using the percentage, the position of the growl changes with the screen size.\nLine 347: Nit - Drop closing growl tag since it's empty (<Growl ref={(el) => this.growl = el}/>)", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459724410", "createdAt": "2020-07-23T20:58:48Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -143,6 +149,10 @@ const css = `\n      background-color: ` + colorWithWhiteness(colors.success, 0.6) + `!important;\n      margin-left: 0.3rem;\n    }\n+\n+   .p-growl-message {\n+     margin-left: 0.5em\n+   }\n  `;\n \n export class CohortSearch extends React.Component<Props, State> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyODkxMg==", "bodyText": "I went into a little more detail offline, but I think we should use the existing structure to display this content.", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459728912", "createdAt": "2020-07-23T21:07:52Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -381,14 +394,30 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n \n     renderCriteria() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTczMzk4MQ==", "bodyText": "What does the ::before do? I removed it and didn't notice any change in the display.", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r459733981", "createdAt": "2020-07-23T21:19:09Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -104,37 +104,43 @@ interface State {\n }\n \n const css = `\n+  .p-growl {\n+    position: sticky;\n+  }\n   .p-growl.p-growl-topright {\n-     height: 29px;\n-     width: 7rem;\n-     padding-top: 6rem;\n-     line-hieght: 1rem;\n+     height: 1rem;\n+     width: 6.4rem;\n+     padding-top: 0.4rem;\n+     line-hieght: 0.7rem;\n      margin-right: 3rem;\n-\n+   }\n+   .p-growl .p-growl-item-container .p-growl-item .p-growl-image {\n+     font-size: 1rem !important;\n+     margin-top: 0.19rem\n    }\n \n   .p-growl-item-container::before {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cb2f73f8714986c25a09be5e0e9183f2e0a45af", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/4cb2f73f8714986c25a09be5e0e9183f2e0a45af", "committedDate": "2020-08-03T14:00:37Z", "message": "PR Comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "852b81a3578f97d655e2490536beeb7c98610ddd", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/852b81a3578f97d655e2490536beeb7c98610ddd", "committedDate": "2020-08-03T16:59:05Z", "message": "Use right rather than padding for growl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35989d86a0cba1ab1904334785009cd305520d20", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/35989d86a0cba1ab1904334785009cd305520d20", "committedDate": "2020-08-03T17:05:35Z", "message": "Remove commented out code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1b8d5bfc92712ec72825ca958470483e03b79b6", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d1b8d5bfc92712ec72825ca958470483e03b79b6", "committedDate": "2020-08-03T19:06:43Z", "message": "Fix ui test as Help icon is mow the second element in Icon list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33ff6dd0b4ccb40cddb7bd12f378646dc756dba5", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/33ff6dd0b4ccb40cddb7bd12f378646dc756dba5", "committedDate": "2020-08-03T19:08:07Z", "message": "Rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjYyNTg3", "url": "https://github.com/all-of-us/workbench/pull/3822#pullrequestreview-460262587", "createdAt": "2020-08-03T18:50:00Z", "commit": {"oid": "35989d86a0cba1ab1904334785009cd305520d20"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODo1MDowMFrOG7E4mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxOTozMDozN1rOG7GD3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5OTE5NQ==", "bodyText": "This is basically duplicating the icon container div from the render function here, which is throwing off the background of the active icon container. Also, the two FontAwesomeIcons below are identical. If we only put a condition on the counter, it should fix both, something similar to this:\nreturn <React.Fragment>\n  {(criteria && icon.page === 'criteria') &&\n    <span data-test-id = 'criteria-count' style={styles.criteriaCount}>{criteria.length}</span>}\n  <FontAwesomeIcon data-test-id={'help-sidebar-icon-' + i} icon={icon.faIcon} style={icon.style} />\n</React.Fragment>;\n\nThis would also require editing the test to use 'help-sidebar-icon-0' for the data-test-id instead of 'criteria-icon'", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464599195", "createdAt": "2020-08-03T18:50:00Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -451,6 +461,20 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n       </PopupTrigger>;\n     }\n \n+    showIcon(icon) {\n+      const {criteria, helpContentKey} = this.props;\n+      return !icon.page || icon.page === helpContentKey || (criteria && icon.page === 'criteria');\n+    }\n+\n+    displayIcon(icon, i) {\n+      const {criteria} = this.props;\n+\n+      return (criteria && icon.page === 'criteria') ?   <div style={styles.icon} data-test-id ='criteria-icon'>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35989d86a0cba1ab1904334785009cd305520d20"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYwMTgyNQ==", "bodyText": "I like separating the condition and icon rendering into functions, much cleaner in the render function that way.", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464601825", "createdAt": "2020-08-03T18:55:13Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/components/help-sidebar.tsx", "diffHunk": "@@ -451,6 +461,20 @@ export const HelpSidebar = fp.flow(withCurrentWorkspace(), withUserProfile(), wi\n       </PopupTrigger>;\n     }\n \n+    showIcon(icon) {\n+      const {criteria, helpContentKey} = this.props;\n+      return !icon.page || icon.page === helpContentKey || (criteria && icon.page === 'criteria');\n+    }\n+\n+    displayIcon(icon, i) {\n+      const {criteria} = this.props;\n+\n+      return (criteria && icon.page === 'criteria') ?   <div style={styles.icon} data-test-id ='criteria-icon'>\n+            <span data-test-id = 'criteria-count' style={styles.criteriaCount}>{criteria.length}</span>\n+            <FontAwesomeIcon data-test-id={'help-sidebar-icon-' + i} icon={icon.faIcon} style={icon.style} />\n+          </div> : <FontAwesomeIcon data-test-id={'help-sidebar-icon-' + i} icon={icon.faIcon} style={icon.style} />;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35989d86a0cba1ab1904334785009cd305520d20"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxNjYzMA==", "bodyText": "line-height is misspelled", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464616630", "createdAt": "2020-08-03T19:26:40Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/cohort-search/cohort-search.component.tsx", "diffHunk": "@@ -104,37 +104,32 @@ interface State {\n }\n \n const css = `\n+  .p-growl {\n+    position: sticky;\n+  }\n   .p-growl.p-growl-topright {\n-     height: 29px;\n-     width: 7rem;\n-     padding-top: 6rem;\n-     line-hieght: 1rem;\n+     height: 1rem;\n+     width: 6.4rem;\n+     padding-top: 0.4rem;\n+     line-hieght: 0.7rem;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33ff6dd0b4ccb40cddb7bd12f378646dc756dba5"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxODQ2MA==", "bodyText": "Thanks. The select icons in the tree are still not enabling after removing a selection, but I can handle that in #3836 since I've made changes to that component anyways.", "url": "https://github.com/all-of-us/workbench/pull/3822#discussion_r464618460", "createdAt": "2020-08-03T19:30:37Z", "author": {"login": "dolbeew"}, "path": "ui/src/app/cohort-search/selection-list/selection-list.component.tsx", "diffHunk": "@@ -136,6 +141,55 @@ export class SelectionInfo extends React.Component<SelectionInfoProps, Selection\n   }\n }\n \n+export class SelectionInfo extends React.Component<SelectionInfoProps, SelectionInfoState> {\n+  name: HTMLDivElement;\n+  constructor(props: SelectionInfoProps) {\n+    super(props);\n+    this.state = {truncated: false};\n+  }\n+\n+  componentDidMount(): void {\n+    const {offsetWidth, scrollWidth} = this.name;\n+    this.setState({truncated: scrollWidth > offsetWidth});\n+  }\n+\n+  get showType() {\n+    return ![\n+      DomainType.PHYSICALMEASUREMENT.toString(),\n+      DomainType.DRUG.toString(),\n+      DomainType.SURVEY.toString()\n+    ].includes(this.props.selection.domainId);\n+  }\n+\n+  get showOr() {\n+    const {index, selection} = this.props;\n+    return index > 0 && selection.domainId !== DomainType.PERSON.toString();\n+  }\n+\n+  render() {\n+    const {selection, removeSelection} = this.props;\n+    const itemName = <React.Fragment>\n+      {this.showType && <strong>{typeDisplay(selection)}&nbsp;</strong>}\n+      {nameDisplay(selection)} {attributeDisplay(selection)}\n+    </React.Fragment>;\n+    return <FlexColumn style={styles.selectionItem}>\n+      {this.showOr && <div style={{padding: '0.3rem 0rem 0.3rem 1rem'}}>OR&nbsp;</div>}\n+      <FlexRow style={{alignItems: 'baseline'}}>\n+      <button style={styles.removeSelection} onClick={() => removeSelection()}>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMzk2OQ=="}, "originalCommit": {"oid": "6227e5378a9d884c905079c4d5de7c23e02df07e"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034676f97cd66cd0bb0d702dc72ca30e0b180d23", "author": {"user": {"login": "NehaBroad", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/034676f97cd66cd0bb0d702dc72ca30e0b180d23", "committedDate": "2020-08-03T19:51:44Z", "message": "Spell Correct and moving display icon condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzI4NzI5", "url": "https://github.com/all-of-us/workbench/pull/3822#pullrequestreview-460328729", "createdAt": "2020-08-03T20:45:16Z", "commit": {"oid": "034676f97cd66cd0bb0d702dc72ca30e0b180d23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4492, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}