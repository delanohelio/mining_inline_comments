{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDA5ODQz", "number": 3416, "title": "[RW-4773][risk=no] Clean up and organize api/build.gradle a bit", "bodyText": "The main things I did were:\n\nalphabetized most of the lists. Tricky b/c of the mix of single and double quotes\nscoped the external symbols so IJ recognized them\nrenamed our custom source sets so that it was obvious which Java Plugin tasks were named after them. This is both really nice and somewhat horrifying.\nAdded group and description properties to the swagger tasks\nTried to add plugin notes and links to docs for plugin detritus.\n\nStill to do (possibly on this ticket):\n\ndetermine if there's a standard ordering for top level blocks like buildscript, dependencies, version, configurations, etc\nsee if it makes sense to organize the file into sections to make a multi-project build easier\nverify that we still actually need all the plugins, tasks, dependencies, and imports\n\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-04-15T21:58:22Z", "url": "https://github.com/all-of-us/workbench/pull/3416", "merged": true, "mergeCommit": {"oid": "52893b3199879bfc5cc90b11a1f071278c81ae68"}, "closed": true, "closedAt": "2020-04-21T21:22:34Z", "author": {"login": "jaycarlton"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX_-eeAFqTM5NDE3NzU0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ6OezAH2gAyNDA0MDA5ODQzOjUwYTg5NjgxODcyYzAxN2RlN2I5NDBjYjRiZWJhN2MwOGE1ZmJkZGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MTc3NTQ5", "url": "https://github.com/all-of-us/workbench/pull/3416#pullrequestreview-394177549", "createdAt": "2020-04-15T22:25:35Z", "commit": {"oid": "aec133f7a317bc4e6f82657ac8aad3cf7b720097"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMjoyNTozNVrOGGNwSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMjozNjo1OFrOGGOBaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2OTk5Mw==", "bodyText": "I don't disagree that this is probably the ideal end state, but I would not attempt to go down this path without first restructuring the codebase holistically to be more modular with cleaner dependencies. Originally, tools were a separate gradle file. This worked to a certain point and then completely broke down as more service dependencies were pulled in. In the end we wound up merging that into this file: https://precisionmedicineinitiative.atlassian.net/browse/RW-2172", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409169993", "createdAt": "2020-04-15T22:25:35Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -628,15 +684,15 @@ version = '0.1.0'          // Version in generated output\n sourceCompatibility = 1.8\n targetCompatibility = 1.8\n \n-task incrementalHotSwap(type: IncrementalHotSwapTask) {\n+task incrementalHotSwap(type: IncrementalHotSwapTask, dependsOn: 'compileJava') {\n     inputDir = sourceSets.main.java.outputDir\n }\n \n-incrementalHotSwap.dependsOn compileJava\n-\n task listProjectAPIs(type: GenerateAPIListingTask)\n \n \n+// TODO(jaycarlton) move tools-related stuff to its own Gradle project", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec133f7a317bc4e6f82657ac8aad3cf7b720097"}, "originalPosition": 674}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTg3Mw==", "bodyText": "Why the change to omit curly brackets? I'm surprised this is legal", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409171873", "createdAt": "2020-04-15T22:30:37Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -402,36 +464,36 @@ dependencies {\n   compile 'mysql:mysql-connector-java:8.0.16'\n   compile 'com.google.cloud.sql:mysql-socket-factory:1.0.10'\n \n-  compile \"com.google.appengine:appengine:${GAE_VERSION}\"\n-  compile \"com.google.appengine:appengine-api-1.0-sdk:${GAE_VERSION}\"\n+  compile \"com.google.appengine:appengine:$project.ext.GAE_VERSION\"\n+  compile \"com.google.appengine:appengine-api-1.0-sdk:$project.ext.GAE_VERSION\"\n \n-  compile(\"org.springframework.boot:spring-boot-starter-web:${SPRING_BOOT_VERSION}\") {\n+  compile(\"org.springframework.boot:spring-boot-starter-web:$project.ext.SPRING_BOOT_VERSION\") {\n     exclude module: 'spring-boot-starter-tomcat'\n     exclude group: 'org.slf4j', module: 'jul-to-slf4j'\n   }\n-  compile(\"org.springframework.boot:spring-boot-starter-data-jpa:${SPRING_BOOT_VERSION}\") {\n+  compile(\"org.springframework.boot:spring-boot-starter-data-jpa:$project.ext.SPRING_BOOT_VERSION\") {\n     exclude module: 'spring-boot-starter-tomcat'\n     exclude group: 'org.slf4j', module: 'jul-to-slf4j'\n   }\n-  compile(\"org.springframework.boot:spring-boot-starter-actuator:${SPRING_BOOT_VERSION}\") {\n+  compile(\"org.springframework.boot:spring-boot-starter-actuator:$project.ext.SPRING_BOOT_VERSION\") {\n     exclude module: 'spring-boot-starter-tomcat'\n     exclude group: 'org.slf4j', module: 'jul-to-slf4j'\n   }\n \n   compile 'ch.qos.logback:logback-classic:1.2.3'\n \n   compile 'org.springframework.security:spring-security-web:4.2.13.RELEASE'\n-  compile \"org.hibernate:hibernate-core:${HIBERNATE_VERSION}\"\n+  compile \"org.hibernate:hibernate-core:$project.ext.HIBERNATE_VERSION\"\n \n   // Force the Kotlin version, otherwise the Kotlin plugin conflicts with Jackson's\n   // Kotlin dep, resulting in massive logspam.\n-  compile \"org.jetbrains.kotlin:kotlin-reflect:${KOTLIN_VERSION}\"\n+  compile \"org.jetbrains.kotlin:kotlin-reflect:$project.ext.KOTLIN_VERSION\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec133f7a317bc4e6f82657ac8aad3cf7b720097"}, "originalPosition": 454}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MzA4MA==", "bodyText": "nit: Not that I don't like reading this, but I'd save the editorialized first person narration for the PR review and just leave the essentials in the code itself.", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409173080", "createdAt": "2020-04-15T22:33:46Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -316,7 +346,38 @@ sourceSets {\n     compileClasspath += generated.output\n     runtimeClasspath += generated.output\n   }\n-  integration {\n+\n+  //\n+  // Custom SourceSets\n+  //\n+  // Sometimes, in order to fight the clean code war, you have to get dirty in a battle.\n+  // Here we use a naming convention with __ word boundaries at start and end\n+  // to avoid confusion. For example, the plugin may define a __tools__Compile configuration\n+  // or a compile__tools__Java task. This \"shields up\" approach makes it obvious where there's\n+  // a dynamically defined symbol name, so usages stick out and it's easier to identify the\n+  // constituent parts. Why four underscores where two might do? Groovy is making me miss C++", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec133f7a317bc4e6f82657ac8aad3cf7b720097"}, "originalPosition": 279}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3NDI0Ng==", "bodyText": "s/RW0/RW/", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409174246", "createdAt": "2020-04-15T22:36:36Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,82 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Mainly sets up properties and dependencies.\n+buildscript {\n+  // Project-wide constants.\n+  ext {\n+    ELASTICSEARCH_VERSION = '6.8.3'\n+    GAE_VERSION = '1.9.64'\n+    GSON_VERSION = '2.8.5'\n+    HIBERNATE_VERSION = '5.2.10.Final'\n+    JACKSON_DATABIND_VERSION = '2.9.10.1'\n+    JACKSON_VERSION = '2.9.10'\n+    JODA_VERSION = '2.10'\n+    KOTLIN_VERSION = '1.3.50'\n+    MAPSTRUCT_VERSION = '1.3.1.Final'\n+    MOCKITO_KOTLIN_VERSION = '2.2.0'\n+    OKHTTP_VERSION = '2.7.5'\n+    OPENCENSUS_VERSION = '0.23.0'\n+    SPRINGFOX_VERSION = '2.6.1'\n+    SPRING_BOOT_VERSION = '1.5.22.RELEASE'\n+    SWAGGER_CODEGEN_VERSION = '2.2.3'\n+  }\n+\n+  repositories {\n+    // Bintray's repository - a fast Maven Central mirror & more\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+\n+  // Top-level Gradle project dependencies\n+  dependencies {\n+    classpath 'com.diffplug.spotless:spotless-plugin-gradle:3.23.0'\n+    classpath 'com.google.cloud.tools:appengine-gradle-plugin:1.3.5'\n+    classpath 'gradle.plugin.org.hidetake:gradle-swagger-generator-plugin:2.12.0'\n+    // Note: if you plan to upgrade the version of swagger-codegen beyond 2.2.3, be aware of two\n+    // implicit dependencies: (1) the set of \"generatedCompile\" Gradle dependencies need to be updated\n+    // to match the modules imported by the Swagger codegen templates, and (2) some template files\n+    // are overridden with forked templates within this repo; they will likely need to be re-copied from\n+    // the newer release version and have AoU-specific modifications re-applied.\n+    classpath \"io.swagger:swagger-codegen:$project.ext.SWAGGER_CODEGEN_VERSION\"\n+    classpath 'net.ltgt.gradle:gradle-apt-plugin:0.21'\n+    classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$project.ext.KOTLIN_VERSION\"\n+    classpath \"org.jetbrains.kotlin:kotlin-noarg:$project.ext.KOTLIN_VERSION\"\n+    classpath 'org.owasp:dependency-check-gradle:5.1.0'\n+    classpath \"org.springframework.boot:spring-boot-gradle-plugin:$project.ext.SPRING_BOOT_VERSION\"\n+  }\n+}\n+\n+project.ext['hibernate.version'] = project.ext.HIBERNATE_VERSION\n+\n+// TODO(jaycarlton): migrate to new plugin DSL (RW0-4772)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec133f7a317bc4e6f82657ac8aad3cf7b720097"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3NDM3OQ==", "bodyText": "Is there a reason not to do this now? Or are you waiting on the new plugin DSL to enable this?", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409174379", "createdAt": "2020-04-15T22:36:58Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,82 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Mainly sets up properties and dependencies.\n+buildscript {\n+  // Project-wide constants.\n+  ext {\n+    ELASTICSEARCH_VERSION = '6.8.3'\n+    GAE_VERSION = '1.9.64'\n+    GSON_VERSION = '2.8.5'\n+    HIBERNATE_VERSION = '5.2.10.Final'\n+    JACKSON_DATABIND_VERSION = '2.9.10.1'\n+    JACKSON_VERSION = '2.9.10'\n+    JODA_VERSION = '2.10'\n+    KOTLIN_VERSION = '1.3.50'\n+    MAPSTRUCT_VERSION = '1.3.1.Final'\n+    MOCKITO_KOTLIN_VERSION = '2.2.0'\n+    OKHTTP_VERSION = '2.7.5'\n+    OPENCENSUS_VERSION = '0.23.0'\n+    SPRINGFOX_VERSION = '2.6.1'\n+    SPRING_BOOT_VERSION = '1.5.22.RELEASE'\n+    SWAGGER_CODEGEN_VERSION = '2.2.3'\n+  }\n+\n+  repositories {\n+    // Bintray's repository - a fast Maven Central mirror & more\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+\n+  // Top-level Gradle project dependencies\n+  dependencies {\n+    classpath 'com.diffplug.spotless:spotless-plugin-gradle:3.23.0'\n+    classpath 'com.google.cloud.tools:appengine-gradle-plugin:1.3.5'\n+    classpath 'gradle.plugin.org.hidetake:gradle-swagger-generator-plugin:2.12.0'\n+    // Note: if you plan to upgrade the version of swagger-codegen beyond 2.2.3, be aware of two\n+    // implicit dependencies: (1) the set of \"generatedCompile\" Gradle dependencies need to be updated\n+    // to match the modules imported by the Swagger codegen templates, and (2) some template files\n+    // are overridden with forked templates within this repo; they will likely need to be re-copied from\n+    // the newer release version and have AoU-specific modifications re-applied.\n+    classpath \"io.swagger:swagger-codegen:$project.ext.SWAGGER_CODEGEN_VERSION\"\n+    classpath 'net.ltgt.gradle:gradle-apt-plugin:0.21'\n+    classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$project.ext.KOTLIN_VERSION\"\n+    classpath \"org.jetbrains.kotlin:kotlin-noarg:$project.ext.KOTLIN_VERSION\"\n+    classpath 'org.owasp:dependency-check-gradle:5.1.0'\n+    classpath \"org.springframework.boot:spring-boot-gradle-plugin:$project.ext.SPRING_BOOT_VERSION\"\n+  }\n+}\n+\n+project.ext['hibernate.version'] = project.ext.HIBERNATE_VERSION\n+\n+// TODO(jaycarlton): migrate to new plugin DSL (RW0-4772)\n+// TODO(jaycarlton): move the plugin apply statements closer to configuration blocks for the plugins", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec133f7a317bc4e6f82657ac8aad3cf7b720097"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0ODE3MTIz", "url": "https://github.com/all-of-us/workbench/pull/3416#pullrequestreview-394817123", "createdAt": "2020-04-16T16:46:23Z", "commit": {"oid": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjo0NjoyM1rOGGuNXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzowNzo0N1rOGGvBZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcwMTcyNQ==", "bodyText": "I'm a little confused about the idea of scoping. Further down in this buildscript section, you describe the repositories as \"buildscript-scoped repositories\". But here we describe \"project-wide constants\". Is there a difference, or are the comments just inconsistent with each other?", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409701725", "createdAt": "2020-04-16T16:46:23Z", "author": {"login": "gjuggler"}, "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,83 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Sets up properties and dependencies for the build\n+// process itself.\n+buildscript {\n+  // Project-wide constants.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxNDI4OA==", "bodyText": "How does this relate to buildscript.ext.HIBERNATE_VERSION? If you have a clear idea of what this line is doing / why it exists, a short comment here might help.", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409714288", "createdAt": "2020-04-16T17:06:33Z", "author": {"login": "gjuggler"}, "path": "api/build.gradle", "diffHunk": "@@ -3,13 +3,83 @@ import io.swagger.codegen.DefaultGenerator\n import org.pmiops.workbench.tooling.GenerateAPIListingTask\n import org.pmiops.workbench.tooling.IncrementalHotSwapTask\n \n+// Runs before all tasks. Sets up properties and dependencies for the build\n+// process itself.\n+buildscript {\n+  // Project-wide constants.\n+  ext {\n+    ELASTICSEARCH_VERSION = '6.8.3'\n+    GAE_VERSION = '1.9.64'\n+    GSON_VERSION = '2.8.5'\n+    HIBERNATE_VERSION = '5.2.10.Final'\n+    JACKSON_DATABIND_VERSION = '2.9.10.1'\n+    JACKSON_VERSION = '2.9.10'\n+    JODA_VERSION = '2.10'\n+    KOTLIN_VERSION = '1.3.50'\n+    MAPSTRUCT_VERSION = '1.3.1.Final'\n+    MOCKITO_KOTLIN_VERSION = '2.2.0'\n+    OKHTTP_VERSION = '2.7.5'\n+    OPENCENSUS_VERSION = '0.23.0'\n+    SPRINGFOX_VERSION = '2.6.1'\n+    SPRING_BOOT_VERSION = '1.5.22.RELEASE'\n+    SWAGGER_CODEGEN_VERSION = '2.2.3'\n+  }\n+\n+  repositories {\n+    // Bintray's repository - a fast Maven Central mirror & more\n+    jcenter()\n+    maven {\n+      url \"https://plugins.gradle.org/m2/\"\n+    }\n+  }\n+\n+  // Buildscript-specific dependencies (uses buildscript-scoped repositories). This\n+  // closure ensures allows the buildscript dependencies (e.g. for plgins) to be managed\n+  // independently from the main project's application code's dependencies\n+  dependencies {\n+    classpath 'com.diffplug.spotless:spotless-plugin-gradle:3.23.0'\n+    classpath 'com.google.cloud.tools:appengine-gradle-plugin:1.3.5'\n+    classpath 'gradle.plugin.org.hidetake:gradle-swagger-generator-plugin:2.12.0'\n+    // Note: if you plan to upgrade the version of swagger-codegen beyond 2.2.3, be aware of two\n+    // implicit dependencies: (1) the set of \"generatedCompile\" Gradle dependencies need to be updated\n+    // to match the modules imported by the Swagger codegen templates, and (2) some template files\n+    // are overridden with forked templates within this repo; they will likely need to be re-copied from\n+    // the newer release version and have AoU-specific modifications re-applied.\n+    classpath \"io.swagger:swagger-codegen:$project.ext.SWAGGER_CODEGEN_VERSION\"\n+    classpath 'net.ltgt.gradle:gradle-apt-plugin:0.21'\n+    classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$project.ext.KOTLIN_VERSION\"\n+    classpath \"org.jetbrains.kotlin:kotlin-noarg:$project.ext.KOTLIN_VERSION\"\n+    classpath 'org.owasp:dependency-check-gradle:5.1.0'\n+    classpath \"org.springframework.boot:spring-boot-gradle-plugin:$project.ext.SPRING_BOOT_VERSION\"\n+  }\n+}\n+\n+project.ext['hibernate.version'] = project.ext.HIBERNATE_VERSION", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxNTA0Ng==", "bodyText": "Nice comment \u2013\u00a0thanks for taking the time to make this clear.", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409715046", "createdAt": "2020-04-16T17:07:47Z", "author": {"login": "gjuggler"}, "path": "api/build.gradle", "diffHunk": "@@ -316,7 +347,36 @@ sourceSets {\n     compileClasspath += generated.output\n     runtimeClasspath += generated.output\n   }\n-  integration {\n+\n+  //\n+  // Custom SourceSets\n+  //\n+  // Here we use a naming convention with __ word boundaries at start and end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7"}, "originalPosition": 276}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0ODM4Nzcx", "url": "https://github.com/all-of-us/workbench/pull/3416#pullrequestreview-394838771", "createdAt": "2020-04-16T17:14:19Z", "commit": {"oid": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzoxNDoyMFrOGGvQRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzoxNDoyMFrOGGvQRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxODg1NQ==", "bodyText": "s/movre/more/", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r409718855", "createdAt": "2020-04-16T17:14:20Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -316,7 +347,36 @@ sourceSets {\n     compileClasspath += generated.output\n     runtimeClasspath += generated.output\n   }\n-  integration {\n+\n+  //\n+  // Custom SourceSets\n+  //\n+  // Here we use a naming convention with __ word boundaries at start and end\n+  // to avoid confusion. For example, the plugin may define a __tools__Compile configuration\n+  // or a compile__tools__Java task. This approach makes it movre obvious where there's", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8d4ee843c83099bd2f049d05bb820398ccbd9e7"}, "originalPosition": 278}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Nzg2NTkz", "url": "https://github.com/all-of-us/workbench/pull/3416#pullrequestreview-395786593", "createdAt": "2020-04-17T21:35:22Z", "commit": {"oid": "3a4f97d622cadc4c7bc73745b8059bfba183f362"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTozNToyMlrOGHdyMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTozNToyMlrOGHdyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4MTIwMg==", "bodyText": "contextual placement of this comment was lost here, since it now seems to refer to all following. Delete if you don't intend to maintain a semantic grouping of dependencies", "url": "https://github.com/all-of-us/workbench/pull/3416#discussion_r410481202", "createdAt": "2020-04-17T21:35:22Z", "author": {"login": "calbach"}, "path": "api/build.gradle", "diffHunk": "@@ -337,219 +398,223 @@ sourceSets {\n       srcDirs = ['tools/src/main/java']\n     }\n   }\n-  bigQueryTest {\n-    resources {\n-      srcDir \"bigquerytest/resources\"\n-      srcDir \"config/\"\n-      include \"bigquery/**\"\n-      include \"cdm/**\"\n-    }\n-    java {\n-      compileClasspath += main.output + test.output + generated.output\n-      runtimeClasspath += main.output + test.output + generated.output\n-      srcDir file('src/bigquerytest/java')\n-    }\n+}\n+\n+// Artifact configurations derived from base configs. Configuration names\n+// are concatenated by the Java plugin.\n+// https://docs.gradle.org/current/userguide/java_plugin.html#java_source_set_configurations\n+configurations {\n+  __bigQueryTest__Compile.extendsFrom testCompile\n+  __bigQueryTest__Runtime.extendsFrom testRuntime\n+\n+  __integration__Compile.extendsFrom testCompile\n+  __integration__Runtime.extendsFrom testRuntime\n+\n+  __tools__Implementation.extendsFrom implementation\n+  __tools__RuntimeOnly.extendsFrom runtimeOnly\n+\n+  generatedCompile {\n+    exclude group: 'com.google.guava', module:'guava-jdk5'\n   }\n }\n \n-generateApi.dependsOn validateSwagger\n-ideaModule.dependsOn generateApi\n-compileGeneratedJava.dependsOn generateApi\n-ideaModule.dependsOn generateFireCloudClient\n-compileGeneratedJava.dependsOn generateFireCloudClient\n-ideaModule.dependsOn generateNotebooksClient\n-compileGeneratedJava.dependsOn generateNotebooksClient\n-ideaModule.dependsOn generateJiraClient\n-compileGeneratedJava.dependsOn generateJiraClient\n-ideaModule.dependsOn generateMandrillClient\n-compileGeneratedJava.dependsOn generateMandrillClient\n-ideaModule.dependsOn generateMoodleClient\n-compileGeneratedJava.dependsOn generateMoodleClient\n-ideaModule.dependsOn generateRdrClient\n-compileGeneratedJava.dependsOn generateRdrClient\n-ideaModule.dependsOn generateCaptchaClient\n-compileGeneratedJava.dependsOn generateCaptchaClient\n-classes.dependsOn generatedClasses\n-compileJava.dependsOn compileGeneratedJava\n-\n-war.dependsOn compileGeneratedJava\n-war.dependsOn generate_appengine_web_xml\n-war.dependsOn generate_appengine_cron_yaml\n+// Add dependencies to the classes builtin task from the  Java plugin.\n+// \"This is an aggregate task that just depends on other tasks.\n+// Other plugins may attach additional compilation tasks to it.\"\n+// https://docs.gradle.org/current/userguide/java_plugin.html\n+classes.dependsOn 'generatedClasses'\n+\n+def swaggerCodegenTasks = ['generateWorkbenchApi', 'generateFireCloudClient', 'generateNotebooksClient',\n+                           'generateJiraClient', 'generateMandrillClient', 'generateMoodleClient',\n+                           'generateRdrClient', 'generateCaptchaClient']\n \n+// The IDEA plugin generates files that assist the IntelliJ IDE in opening Gradle-defined projects.\n+// https://docs.gradle.org/current/userguide/idea_plugin.html\n+project.tasks.ideaModule.dependsOn(swaggerCodegenTasks)\n+\n+// Java plugin's Generated Source Set gives us the compileGeneratedJava task.\n+// We need to provide it with the swagger-codegen tasks that excrete Java.\n+project.tasks.compileGeneratedJava.dependsOn(swaggerCodegenTasks)\n+\n+project.tasks.war.dependsOn(['compileGeneratedJava', 'generate_appengine_web_xml',\n+        'generate_appengine_cron_yaml'])\n+\n+// Clear out generated Java sorces before cleaning the project.\n clean.doFirst {\n   delete(\"${projectDir}/$swaggerTargetFolder\")\n }\n \n-repositories {   // repositories for Jar's you access in your code\n+repositories {\n   jcenter()\n }\n \n-ext {\n-  mapstructVersion = '1.3.1.Final'\n-}\n-\n+// TODO(jaycarlton): see if there's a way to subdivide this block for readability\n+// To show the dependency tree, try: ./project.rb gradle dependencies --configuration compile\n dependencies {\n+  annotationProcessor \"org.mapstruct:mapstruct-processor:$project.ext.MAPSTRUCT_VERSION\"\n \n-  // To show the dependency tree, try: ./project.rb gradle dependencies --configuration compile\n+  compile \"ch.qos.logback:logback-classic:1.2.3\"\n+  // Force these dependencies to safe versions, Zendesk client depends on this.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a4f97d622cadc4c7bc73745b8059bfba183f362"}, "originalPosition": 416}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7f403a6eade95bb9deed721be5f979f8456d044", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/e7f403a6eade95bb9deed721be5f979f8456d044", "committedDate": "2020-04-18T19:28:36Z", "message": "cleaning things up so the highlighter doesn't attack me so much"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f7fad28f8283e46547381868f4dd9bee8842804", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/5f7fad28f8283e46547381868f4dd9bee8842804", "committedDate": "2020-04-18T19:28:37Z", "message": "a bit more consolidation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49f49758e52d08bb5ce25b4df2367b852dfcdaa6", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/49f49758e52d08bb5ce25b4df2367b852dfcdaa6", "committedDate": "2020-04-18T19:28:37Z", "message": "restore a couple things"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e7728cc52068a37f9960370d157d2c2f8ea328", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/b9e7728cc52068a37f9960370d157d2c2f8ea328", "committedDate": "2020-04-18T19:28:37Z", "message": "rename source sets for clarity. more rearranging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79c79fd7ba2e841ec1e796f477a768ceeec8da42", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/79c79fd7ba2e841ec1e796f477a768ceeec8da42", "committedDate": "2020-04-18T19:28:37Z", "message": "more fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59df98ca5447b339903d70ab69130086174956ab", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/59df98ca5447b339903d70ab69130086174956ab", "committedDate": "2020-04-18T19:28:37Z", "message": "group & desc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bea92b4b7e43c32b91a738a1af3a3e679d883dec", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/bea92b4b7e43c32b91a738a1af3a3e679d883dec", "committedDate": "2020-04-18T19:28:38Z", "message": "comment & todo fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3dbcff59be229279f60a38f791666fe0dc309bc", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/c3dbcff59be229279f60a38f791666fe0dc309bc", "committedDate": "2020-04-18T19:28:38Z", "message": "alphabetize and a rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9709237900f05f05cf0c659ef5a729ed42d557bf", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/9709237900f05f05cf0c659ef5a729ed42d557bf", "committedDate": "2020-04-18T19:28:38Z", "message": "restore comments from pre-aphabetizization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2e82e53af5a140ad6a73e52bc71ebab0c4b83f5", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/b2e82e53af5a140ad6a73e52bc71ebab0c4b83f5", "committedDate": "2020-04-18T19:28:38Z", "message": "kill duplicated value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "199473448dbaf672a5bd2ce7ef9a191cbd92552d", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/199473448dbaf672a5bd2ce7ef9a191cbd92552d", "committedDate": "2020-04-18T19:28:39Z", "message": "update missed reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3b22eba494bbb56b23abc3de7e02c229d87b08", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/1f3b22eba494bbb56b23abc3de7e02c229d87b08", "committedDate": "2020-04-18T19:28:39Z", "message": "restore comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3738ed4ee633f27c2744eee510ebdfab0865ee37", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/3738ed4ee633f27c2744eee510ebdfab0865ee37", "committedDate": "2020-04-18T19:28:39Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62ca52838dbf9599fb8dbeb0113cbd2a1d089d97", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/62ca52838dbf9599fb8dbeb0113cbd2a1d089d97", "committedDate": "2020-04-18T19:28:39Z", "message": "restore name; this one didn't change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc2827a2e8795f7872b92d8c7a56d45b769f04f9", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/bc2827a2e8795f7872b92d8c7a56d45b769f04f9", "committedDate": "2020-04-18T19:28:40Z", "message": "descriptions & cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f19e8d614af93a05e081da0350aa91c983f9c5", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/d3f19e8d614af93a05e081da0350aa91c983f9c5", "committedDate": "2020-04-18T19:28:40Z", "message": "cleanup comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "885c6445ae50aa1271d99df0a54c54945b6ce51d", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/885c6445ae50aa1271d99df0a54c54945b6ce51d", "committedDate": "2020-04-19T20:13:36Z", "message": "temporarily remove application test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a4f97d622cadc4c7bc73745b8059bfba183f362", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/3a4f97d622cadc4c7bc73745b8059bfba183f362", "committedDate": "2020-04-17T20:51:51Z", "message": "descriptions & cleanup"}, "afterCommit": {"oid": "885c6445ae50aa1271d99df0a54c54945b6ce51d", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/885c6445ae50aa1271d99df0a54c54945b6ce51d", "committedDate": "2020-04-19T20:13:36Z", "message": "temporarily remove application test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b76258e50a2b7fee7aabc0e9605f2779a0b2d85d", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/b76258e50a2b7fee7aabc0e9605f2779a0b2d85d", "committedDate": "2020-04-21T16:48:20Z", "message": "Merge branch 'master' into jaycarlton/cleanGradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bfe2568ce49ac780a02446491cf438a815a6312", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/5bfe2568ce49ac780a02446491cf438a815a6312", "committedDate": "2020-04-21T16:48:46Z", "message": "Revert \"temporarily remove application test\"\n\nThis reverts commit 885c6445ae50aa1271d99df0a54c54945b6ce51d."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50a89681872c017de7b940cb4beba7c08a5fbdde", "author": {"user": {"login": "jaycarlton", "name": "Jay Carlton"}}, "url": "https://github.com/all-of-us/workbench/commit/50a89681872c017de7b940cb4beba7c08a5fbdde", "committedDate": "2020-04-21T21:04:30Z", "message": "add ticket"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3188, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}