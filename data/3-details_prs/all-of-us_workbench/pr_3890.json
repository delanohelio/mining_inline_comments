{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDcwMDY1", "number": 3890, "title": "[RW-5100][risk=no] Reactify homepage, workspace library", "bodyText": "Most important thing about this PR is that I couldn't make the wildcard work with the multiple guards, so I decided to just get rid of it and enumerate all routes in both the Angular and React router. We'll be able to just delete the Angular router when it's done, and we'll be able to regex-search for component not being AppRouting to find un-migrated routes.\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test:local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-08-17T21:11:56Z", "url": "https://github.com/all-of-us/workbench/pull/3890", "merged": true, "mergeCommit": {"oid": "86f181fd63f706195701cd7e01faf37217701016"}, "closed": true, "closedAt": "2020-08-19T16:23:05Z", "author": {"login": "als364"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_5Gk6gFqTQ2ODgzNjI1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAdlL9AFqTQ3MDU4OTc2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODM2MjU2", "url": "https://github.com/all-of-us/workbench/pull/3890#pullrequestreview-468836256", "createdAt": "2020-08-17T21:12:33Z", "commit": {"oid": "ce0b1ee70454843c759731ead1d3bdf84411868e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMToxMjozM1rOHB7CSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMToxNDo0N1rOHB7GJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc3Nzg2Nw==", "bodyText": "redirecting to homepage seemed most correct, let me know if there's some other thing that seems correcter to you", "url": "https://github.com/all-of-us/workbench/pull/3890#discussion_r471777867", "createdAt": "2020-08-17T21:12:33Z", "author": {"login": "als364"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -22,14 +24,21 @@ const signInGuard: Guard = {\n   redirectPath: '/login'\n };\n \n+const registrationGuard: Guard = {\n+  allowed: (): boolean => hasRegisteredAccess(profileStore.get().profile.dataAccessLevel),\n+  redirectPath: '/'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce0b1ee70454843c759731ead1d3bdf84411868e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc3ODg1Mw==", "bodyText": "worth noting: it caused confusing bugs when I tried to nest it inside the other ProtectedRoutes. so we'll probably have to enumerate all combinations of guards. not a huge deal since we only have a few.", "url": "https://github.com/all-of-us/workbench/pull/3890#discussion_r471778853", "createdAt": "2020-08-17T21:14:47Z", "author": {"login": "als364"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -61,21 +70,41 @@ export const AppRoutingComponent: React.FunctionComponent<RoutingProps> = ({onSi\n     />\n \n     <ProtectedRoutes guards={[signInGuard]}>\n-        <AppRoute\n+      <AppRoute\n+        path='/'\n+          component={() => <HomepagePage routeData={{title: 'Homepage'}}/>}\n+      />\n+      <AppRoute\n+          path='/admin/user-audit'\n+          component={() => <UserAuditPage routeData={{title: 'User Audit'}}/>}\n+      />\n+      <AppRoute\n+          path='/admin/user-audit/:username'\n+          component={() => <UserAuditPage routeData={{title: 'User Audit'}}/>}\n+      />\n+      <AppRoute\n+          path='/admin/workspace-audit'\n+          component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}\n+      />\n+      <AppRoute\n+          path='/admin/workspace-audit/:workspaceNamespace'\n+          component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}\n+      />\n+      <AppRoute\n           path='/data-code-of-conduct'\n           component={ () => <DataUserCodeOfConductPage routeData={{\n             title: 'Data User Code of Conduct',\n             minimizeChrome: true\n           }} />}\n-        />\n-        <AppRoute path='/admin/user-audit'\n-                  component={() => <UserAuditPage routeData={{title: 'User Audit'}}/>}/>\n-        <AppRoute path='/admin/user-audit/:username'\n-                  component={() => <UserAuditPage routeData={{title: 'User Audit'}}/>}/>\n-        <AppRoute path='/admin/workspace-audit'\n-                  component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}/>\n-        <AppRoute path='/admin/workspace-audit/:workspaceNamespace'\n-                  component={() => <WorkspaceAuditPage routeData={{title: 'Workspace Audit'}}/>}/>\n+      />\n+      <AppRoute path='/nih-callback' component={() => <HomepagePage routeData={{title: 'Homepage'}}/>} />\n+    </ProtectedRoutes>\n+\n+    <ProtectedRoutes guards={[signInGuard, registrationGuard]}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce0b1ee70454843c759731ead1d3bdf84411868e"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c84a4e15c24a99092021a486726afe7559cd1b59", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/c84a4e15c24a99092021a486726afe7559cd1b59", "committedDate": "2020-08-18T16:52:41Z", "message": "staging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59fea80ddf2e704d426e7d259ceded70923d5faf", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/59fea80ddf2e704d426e7d259ceded70923d5faf", "committedDate": "2020-08-18T16:52:41Z", "message": "library"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a21f5cd5f9faf733132700ce8611ba8518ed5cd0", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/a21f5cd5f9faf733132700ce8611ba8518ed5cd0", "committedDate": "2020-08-18T16:52:41Z", "message": "shelving ugh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3868fb749dc1e3398238ffdff063f46b0c6adc33", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/3868fb749dc1e3398238ffdff063f46b0c6adc33", "committedDate": "2020-08-18T16:52:41Z", "message": "rerouting step 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2972207b5124e415781279e650419c36cb1d37df", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/2972207b5124e415781279e650419c36cb1d37df", "committedDate": "2020-08-18T16:52:41Z", "message": "shelving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a289908697f96150dec1d75bb43604ece6caed4", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/0a289908697f96150dec1d75bb43604ece6caed4", "committedDate": "2020-08-18T16:52:41Z", "message": "shelving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b98b5c60f91cb53f611cf36caea2305e8f3a3c1", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6b98b5c60f91cb53f611cf36caea2305e8f3a3c1", "committedDate": "2020-08-18T16:52:41Z", "message": "mostly done"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d949197a8ff5b9665242c6cc9849635799a07e92", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/d949197a8ff5b9665242c6cc9849635799a07e92", "committedDate": "2020-08-18T16:52:41Z", "message": "side-nav cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e27870923578e1f16bf434e6b3d9b5060ed1ec7", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/6e27870923578e1f16bf434e6b3d9b5060ed1ec7", "committedDate": "2020-08-18T16:52:41Z", "message": "whitespace..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ad4893babcddb0a4d7327f06fd6333257e51df7", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/4ad4893babcddb0a4d7327f06fd6333257e51df7", "committedDate": "2020-08-18T16:52:41Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f42872ad9b659e0dbbcc430df23683bb6748f886", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/f42872ad9b659e0dbbcc430df23683bb6748f886", "committedDate": "2020-08-18T16:52:41Z", "message": "oops these go one layer up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/a0be0928400e1acb3f53aa89d2b4d33724c51650", "committedDate": "2020-08-18T16:52:41Z", "message": "HOKAY THEN"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce0b1ee70454843c759731ead1d3bdf84411868e", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/ce0b1ee70454843c759731ead1d3bdf84411868e", "committedDate": "2020-08-17T20:53:43Z", "message": "HOKAY THEN"}, "afterCommit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650", "author": {"user": null}, "url": "https://github.com/all-of-us/workbench/commit/a0be0928400e1acb3f53aa89d2b4d33724c51650", "committedDate": "2020-08-18T16:52:41Z", "message": "HOKAY THEN"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODA3ODIz", "url": "https://github.com/all-of-us/workbench/pull/3890#pullrequestreview-469807823", "createdAt": "2020-08-18T20:30:07Z", "commit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDozMDowN1rOHClcEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDozMDowN1rOHClcEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ3MjU5Mw==", "bodyText": "HomeUhhhhhhhPageIGuess", "url": "https://github.com/all-of-us/workbench/pull/3890#discussion_r472472593", "createdAt": "2020-08-18T20:30:07Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/app-routing.tsx", "diffHunk": "@@ -22,14 +24,21 @@ const signInGuard: Guard = {\n   redirectPath: '/login'\n };\n \n+const registrationGuard: Guard = {\n+  allowed: (): boolean => hasRegisteredAccess(profileStore.get().profile.dataAccessLevel),\n+  redirectPath: '/'\n+};\n+\n const CookiePolicyPage = withRouteData(CookiePolicy);\n const DataUserCodeOfConductPage = fp.flow(withRouteData, withFullHeight)(DataUserCodeOfConduct);\n+const HomepagePage = withRouteData(Homepage); // this name is bad i am sorry", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODA5NTEx", "url": "https://github.com/all-of-us/workbench/pull/3890#pullrequestreview-469809511", "createdAt": "2020-08-18T20:32:55Z", "commit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDozMjo1NVrOHClmVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDozNzoxN1rOHClx7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ3NTIyMQ==", "bodyText": "What's a good way for me to check that all of the previously-wildcard routes are now accounted for?", "url": "https://github.com/all-of-us/workbench/pull/3890#discussion_r472475221", "createdAt": "2020-08-18T20:32:55Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/app-routing.module.ts", "diffHunk": "@@ -361,13 +391,9 @@ const routes: Routes = [\n             path: 'institution/edit/:institutionId',\n             component: AdminInstitutionEditComponent,\n             data: { title: 'Institution Admin'},\n-          }]\n+          }\n+        ]\n       },\n-      {\n-        path: '**',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ3ODE5MA==", "bodyText": "what does this do?", "url": "https://github.com/all-of-us/workbench/pull/3890#discussion_r472478190", "createdAt": "2020-08-18T20:37:17Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/services/profile-storage.service.ts", "diffHunk": "@@ -54,10 +55,12 @@ export class ProfileStorageService {\n     this.profileService.getMe()\n       .retryWhen(ProfileStorageService.conflictRetryPolicy())\n       .subscribe((profile) => {\n+        profileStore.set({...profileStore.get(), profile: profile});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTg5NzYx", "url": "https://github.com/all-of-us/workbench/pull/3890#pullrequestreview-470589761", "createdAt": "2020-08-19T15:45:06Z", "commit": {"oid": "a0be0928400e1acb3f53aa89d2b4d33724c51650"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4289, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}