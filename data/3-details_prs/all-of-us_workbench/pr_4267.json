{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MTIwNjY1", "number": 4267, "title": "[risk=low][RW-5564][RW-5721] Workspace Creation/Duplication updates for CDR Versions ", "bodyText": "Description:\nPart 2 of RW-5564: during Workspace Creation and Workspace Duplication, user must confirm that they are using the older CDR Version for one of the allowed purposes and commit to documenting how they are doing so.\n(Workspace Edit prevents CDR Version changes)\n\nRW-5721: a red flag appears alongside the CDR Version name string for existing Workspaces using an older CDR version.  Clicking it pops up an upgrade modal, which will optionally take the user to the Duplicate Workspace screen with the new version pre-selected and a message with more information about the update process.  After the red flag is clicked once, it becomes blue (per-user, per-workspace) and may be clicked again.\n\nBuilds on previous work at #4283\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-11-10T00:09:26Z", "url": "https://github.com/all-of-us/workbench/pull/4267", "merged": true, "mergeCommit": {"oid": "6016266832a10189c073b096cd9e355f25c1f5ba"}, "closed": true, "closedAt": "2020-11-19T18:35:03Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbOP1_ABqjM5ODA1MTQ1MTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeGj2UgBqjQwMTcxNzEyNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f84ccd4dad0f4d72a2680aa71d67e4130e7e1c64", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f84ccd4dad0f4d72a2680aa71d67e4130e7e1c64", "committedDate": "2020-11-09T23:44:34Z", "message": "add data use policy link"}, "afterCommit": {"oid": "19e9180a377872e5ad5d38a156201db44c0cb5e8", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/19e9180a377872e5ad5d38a156201db44c0cb5e8", "committedDate": "2020-11-10T19:08:44Z", "message": "tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a97c803d05eed5a472c85f3c9a0622ae0f710f1", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8a97c803d05eed5a472c85f3c9a0622ae0f710f1", "committedDate": "2020-11-10T21:39:26Z", "message": "add e2e tests for cdr version upgrade+warning messages"}, "afterCommit": {"oid": "f32afcd5086a8d31d5015f8103e7ee509fda2107", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f32afcd5086a8d31d5015f8103e7ee509fda2107", "committedDate": "2020-11-15T20:49:38Z", "message": "New CDR Version Upgrade Flag and Modal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f32afcd5086a8d31d5015f8103e7ee509fda2107", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f32afcd5086a8d31d5015f8103e7ee509fda2107", "committedDate": "2020-11-15T20:49:38Z", "message": "New CDR Version Upgrade Flag and Modal"}, "afterCommit": {"oid": "832598b5e3e080e2d032afb3755239561ddcd6d6", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/832598b5e3e080e2d032afb3755239561ddcd6d6", "committedDate": "2020-11-16T20:10:05Z", "message": "e2e test for old cdr version modal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36edf70186a62cbc0a6488d360207db435e85ade", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/36edf70186a62cbc0a6488d360207db435e85ade", "committedDate": "2020-11-16T21:35:52Z", "message": "duplication test - wait for consent"}, "afterCommit": {"oid": "2a436bd9c672936f2b10c6a15fd33db5e11879f8", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2a436bd9c672936f2b10c6a15fd33db5e11879f8", "committedDate": "2020-11-17T00:21:07Z", "message": "RW-5721 New CDR Version Upgrade Flag and Modal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDI1OTM4", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532425938", "createdAt": "2020-11-17T14:37:17Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDozNzoxN1rOH032OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDozNzoxN1rOH032OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwMzAwMQ==", "bodyText": "New method below: minimal work required to create a new workspace", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525203001", "createdAt": "2020-11-17T14:37:17Z", "author": {"login": "jmthibault79"}, "path": "e2e/app/page/workspaces-page.ts", "diffHunk": "@@ -78,16 +78,33 @@ export default class WorkspacesPage extends WorkspaceEditPage {\n      billingAccount: string = UseFreeCredits,\n      reviewRequest: boolean = false): Promise<string[]> {\n \n+    const editPage = await this.fillOutRequiredCreationFields(workspaceName, billingAccount, reviewRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDMwMTM1", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532430135", "createdAt": "2020-11-17T14:41:09Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0MTowOVrOH04BqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0MTowOVrOH04BqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwNTkyOQ==", "bodyText": "or onClose?", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525205929", "createdAt": "2020-11-17T14:41:09Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/cdr-version-upgrade-modal.tsx", "diffHunk": "@@ -0,0 +1,38 @@\n+import * as React from 'react';\n+\n+import {Button, Clickable} from 'app/components/buttons';\n+import {FlexRow} from 'app/components/flex';\n+import {ClrIcon} from 'app/components/icons';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import colors from 'app/styles/colors';\n+import {AnalyticsTracker} from 'app/utils/analytics';\n+\n+interface Props {\n+  defaultCdrVersionName: string;\n+  onDismiss: () => void;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDMyMzIw", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532432320", "createdAt": "2020-11-17T14:43:13Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0MzoxNFrOH04H3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0MzoxNFrOH04H3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwNzUxOA==", "bodyText": "This is the only new field - the rest is just alphabetized", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525207518", "createdAt": "2020-11-17T14:43:14Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -236,47 +237,49 @@ export interface WorkspaceEditProps {\n }\n \n export interface WorkspaceEditState {\n+  billingAccounts: Array<BillingAccount>;\n   cdrVersionItems: Array<CdrVersion>;\n+  cloneUserRole: boolean;\n+  loading: boolean;\n+  populationChecked: boolean;\n   selectResearchPurpose: boolean;\n+  showCdrVersionModal: boolean;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDMzMzE3", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532433317", "createdAt": "2020-11-17T14:44:10Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NDoxMFrOH04Ksw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NDoxMFrOH04Ksw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwODI0Mw==", "bodyText": "the only new line; the rest is just alphabetized", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525208243", "createdAt": "2020-11-17T14:44:10Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -236,47 +237,49 @@ export interface WorkspaceEditProps {\n }\n \n export interface WorkspaceEditState {\n+  billingAccounts: Array<BillingAccount>;\n   cdrVersionItems: Array<CdrVersion>;\n+  cloneUserRole: boolean;\n+  loading: boolean;\n+  populationChecked: boolean;\n   selectResearchPurpose: boolean;\n+  showCdrVersionModal: boolean;\n+  showConfirmationModal: boolean;\n+  showCreateBillingAccountModal: boolean;\n+  showResearchPurpose: boolean;\n+  showStigmatizationDetails: boolean;\n+  showUnderservedPopulationDetails: boolean;\n   workspace: Workspace;\n   workspaceCreationConflictError: boolean;\n   workspaceCreationError: boolean;\n   workspaceCreationErrorMessage: string;\n   workspaceNewAclDelayed: boolean;\n   workspaceNewAclDelayedContinueFn: Function;\n-  cloneUserRole: boolean;\n-  loading: boolean;\n-  showUnderservedPopulationDetails: boolean;\n-  showStigmatizationDetails: boolean;\n-  showResearchPurpose: boolean;\n-  billingAccounts: Array<BillingAccount>;\n-  showCreateBillingAccountModal: boolean;\n-  showConfirmationModal: boolean;\n-  populationChecked: boolean;\n }\n \n export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace(), withCdrVersions(), withUserProfile())(\n   class WorkspaceEditCmp extends React.Component<WorkspaceEditProps, WorkspaceEditState> {\n     constructor(props: WorkspaceEditProps) {\n       super(props);\n       this.state = {\n+        billingAccounts: [],\n         cdrVersionItems: this.createInitialCdrVersionsList(),\n-        workspace: this.createInitialWorkspaceState(),\n+        cloneUserRole: false,\n+        loading: false,\n+        populationChecked: props.workspace ? props.workspace.researchPurpose.populationDetails.length > 0 : undefined,\n         selectResearchPurpose: this.updateSelectedResearch(),\n+        showCdrVersionModal: false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDM0ODYw", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532434860", "createdAt": "2020-11-17T14:45:34Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NTozNFrOH04Pag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NTozNFrOH04Pag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwOTQ1MA==", "bodyText": "Modal cancel: force the use of the default CDR\nModal continue (requires checkboxes): allows use of chosen older CDR", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525209450", "createdAt": "2020-11-17T14:45:34Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-edit.tsx", "diffHunk": "@@ -1004,10 +1008,18 @@ export const WorkspaceEdit = fp.flow(withRouteConfigData(), withCurrentWorkspace\n       return <FadeBox  style={{margin: 'auto', marginTop: '1rem', width: '95.7%'}}>\n         <div style={{width: '1120px'}}>\n           {loading && <SpinnerOverlay overrideStylesOverlay={styles.spinner}/>}\n+          {!hasDefaultCdrVersion(this.state.workspace, cdrVersionListResponse) && showCdrVersionModal &&\n+            <OldCdrVersionModal\n+                onCancel={() => {\n+                  this.setState(fp.set(['workspace', 'cdrVersionId'], cdrVersionListResponse.defaultCdrVersionId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDM4NDg3", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532438487", "createdAt": "2020-11-17T14:48:47Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0ODo0N1rOH04ZyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0ODo0N1rOH04ZyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxMjEwNA==", "bodyText": "For the circle around the flag.  The flag is a ClrIcon.", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525212104", "createdAt": "2020-11-17T14:48:47Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-nav-bar.tsx", "diffHunk": "@@ -56,9 +61,65 @@ const styles = reactStyles({\n   },\n   disabled: {\n     color: colors.disabled\n-  }\n+  },\n });\n \n+const stylesFunction = {\n+  cdrVersionFlagCircle: (alert: boolean): React.CSSProperties => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDM5NDU5", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532439459", "createdAt": "2020-11-17T14:49:38Z", "commit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0OTozOFrOH04crw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0OTozOFrOH04crw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxMjg0Nw==", "bodyText": "Better location for this const?", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525212847", "createdAt": "2020-11-17T14:49:38Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/pages/workspace/workspace-nav-bar.tsx", "diffHunk": "@@ -56,9 +61,65 @@ const styles = reactStyles({\n   },\n   disabled: {\n     color: colors.disabled\n-  }\n+  },\n });\n \n+const stylesFunction = {\n+  cdrVersionFlagCircle: (alert: boolean): React.CSSProperties => {\n+    return {\n+      border: 'solid 1px',\n+      borderRadius: '50%',\n+      height: '50px',\n+      width: '50px',\n+      marginLeft: '12px',\n+      padding: '4px',\n+      backgroundColor: alert ? colors.danger : colors.secondary,\n+    };\n+  }\n+};\n+\n+const USER_DISMISSED_ALERT_VALUE = 'DISMISSED';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTQ3NjM1", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532547635", "createdAt": "2020-11-17T16:23:01Z", "commit": {"oid": "1f3fee0a93aab8b096304cf74a7abf95bc063423"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjoyMzowMVrOH09hZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjoyMzowMVrOH09hZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NTk3NQ==", "bodyText": "I'd create a new file for cdr tests like workspace-cdr.spec.ts to include this new test and the test below to take advantage of running tests in parallel threads.", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525295975", "createdAt": "2020-11-17T16:23:01Z", "author": {"login": "aweng98"}, "path": "e2e/tests/workspace/workspace-create.spec.ts", "diffHunk": "@@ -72,6 +73,26 @@ describe('Creating new workspaces', () => {\n     await verifyWorkspaceLinkOnDataPage(newWorkspaceName);\n   });\n \n+  test('User cannot create a workspace with an old CDR Version without consenting to the restrictions', async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f3fee0a93aab8b096304cf74a7abf95bc063423"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjk5MTQ0", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532699144", "createdAt": "2020-11-17T19:06:53Z", "commit": {"oid": "8f582caaf4613dc48cfe5512b989abf49be98689"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzAyNTMw", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-532702530", "createdAt": "2020-11-17T19:09:33Z", "commit": {"oid": "8f582caaf4613dc48cfe5512b989abf49be98689"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTowOTozM1rOH1E4Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTowOTozM1rOH1E4Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNjUzMQ==", "bodyText": "nit: finding any object in a modal should use the modal parent: Checkbox.findByName(this.page, FIELD.willUseCheckbox.textOption, this);", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r525416531", "createdAt": "2020-11-17T19:09:33Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/old-cdr-version-modal.ts", "diffHunk": "@@ -0,0 +1,76 @@\n+import {Page} from 'puppeteer';\n+\n+import Button from 'app/element/button';\n+import Modal from 'app/component/modal';\n+import {waitWhileLoading} from 'utils/waits-utils';\n+import {ElementType} from '../xpath-options';\n+import {LinkText} from '../text-labels';\n+import Checkbox from '../element/checkbox';\n+\n+const LabelAlias = {\n+    WILL_USE_OLD_CDR_VERSION: 'I will use this workspace to complete an existing study or replicate a previous study.',\n+    WILL_IDENTIFY_OLD_CDR_VERSION: 'In the workspace description below, I will identify which study I am continuing or replicating.',\n+}\n+\n+const FIELD = {\n+    willUseCheckbox: {\n+        textOption: {name: LabelAlias.WILL_USE_OLD_CDR_VERSION, type: ElementType.Checkbox}\n+    },\n+    willIdentifyCheckbox: {\n+        textOption: {name: LabelAlias.WILL_IDENTIFY_OLD_CDR_VERSION, type: ElementType.Checkbox}\n+    },\n+    continueButton: {\n+        textOption: {name: LinkText.Continue}\n+    },\n+}\n+\n+export default class OldCdrVersionModal extends Modal {\n+\n+    constructor(page: Page, xpath?: string) {\n+        super(page, xpath);\n+    }\n+\n+    async isLoaded(): Promise<boolean> {\n+        const xpath = '//*[@data-test-id=\"old-cdr-version-modal\"]';\n+        await Promise.all([\n+            this.page.waitForXPath(xpath),\n+            waitWhileLoading(this.page),\n+        ]);\n+        return true;\n+    }\n+\n+    async getWillUseCheckbox(): Promise<Checkbox> {\n+        return Checkbox.findByName(this.page, FIELD.willUseCheckbox.textOption);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f582caaf4613dc48cfe5512b989abf49be98689"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NTg4MjQ3", "url": "https://github.com/all-of-us/workbench/pull/4267#pullrequestreview-534588247", "createdAt": "2020-11-19T15:51:57Z", "commit": {"oid": "92a4cb217d56271a6d64f58639d9fd80485b4aed"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNTo1MTo1N1rOH2lQRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNTo1NjowNVrOH2ldqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5NTUyNw==", "bodyText": "Does this need to be a string, could it be a boolean in localStorage?", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r526995527", "createdAt": "2020-11-19T15:51:57Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/workspace/workspace-nav-bar.tsx", "diffHunk": "@@ -56,9 +61,63 @@ const styles = reactStyles({\n   },\n   disabled: {\n     color: colors.disabled\n-  }\n+  },\n });\n \n+const stylesFunction = {\n+  cdrVersionFlagCircle: (alert: boolean): React.CSSProperties => {\n+    return {\n+      border: 'solid 1px',\n+      borderRadius: '50%',\n+      height: '50px',\n+      width: '50px',\n+      marginLeft: '12px',\n+      padding: '4px',\n+      backgroundColor: alert ? colors.danger : colors.secondary,\n+    };\n+  }\n+};\n+\n+const USER_DISMISSED_ALERT_VALUE = 'DISMISSED';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92a4cb217d56271a6d64f58639d9fd80485b4aed"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5NjI5Ng==", "bodyText": "Could we initialize the state with:\nlocalStorage.getItem(localStorageKey) === USER_DISMISSED_ALERT_VALUE\nor just the value if the localStorage value is a boolean?", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r526996296", "createdAt": "2020-11-19T15:52:55Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/workspace/workspace-nav-bar.tsx", "diffHunk": "@@ -56,9 +61,63 @@ const styles = reactStyles({\n   },\n   disabled: {\n     color: colors.disabled\n-  }\n+  },\n });\n \n+const stylesFunction = {\n+  cdrVersionFlagCircle: (alert: boolean): React.CSSProperties => {\n+    return {\n+      border: 'solid 1px',\n+      borderRadius: '50%',\n+      height: '50px',\n+      width: '50px',\n+      marginLeft: '12px',\n+      padding: '4px',\n+      backgroundColor: alert ? colors.danger : colors.secondary,\n+    };\n+  }\n+};\n+\n+const USER_DISMISSED_ALERT_VALUE = 'DISMISSED';\n+\n+const CdrVersion = (props: {workspace: Workspace, cdrVersionListResponse: CdrVersionListResponse}) => {\n+  const [showModal, setShowModal] = useState(false);\n+  const [userHasDismissedAlert, setUserHasDismissedAlert] = useState(false);\n+\n+  const {workspace, cdrVersionListResponse} = props;\n+  const {namespace, id} = workspace;\n+\n+  const localStorageKey = `${namespace}-${id}-user-dismissed-cdr-version-update-alert`;\n+\n+  // check whether the user has previously dismissed the alert in localStorage, to determine icon color\n+  useEffect(() =>\n+      setUserHasDismissedAlert(localStorage.getItem(localStorageKey) === USER_DISMISSED_ALERT_VALUE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92a4cb217d56271a6d64f58639d9fd80485b4aed"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5ODk1NA==", "bodyText": "Searching the code I am not seeing any instances of onDismiss, but lots of onClose. Perhaps in this case we should go with the de-facto standard onClose", "url": "https://github.com/all-of-us/workbench/pull/4267#discussion_r526998954", "createdAt": "2020-11-19T15:56:05Z", "author": {"login": "petesantos"}, "path": "ui/src/app/pages/workspace/cdr-version-upgrade-modal.tsx", "diffHunk": "@@ -0,0 +1,38 @@\n+import * as React from 'react';\n+\n+import {Button, Clickable} from 'app/components/buttons';\n+import {FlexRow} from 'app/components/flex';\n+import {ClrIcon} from 'app/components/icons';\n+import {Modal, ModalBody, ModalFooter, ModalTitle} from 'app/components/modals';\n+import colors from 'app/styles/colors';\n+import {AnalyticsTracker} from 'app/utils/analytics';\n+\n+interface Props {\n+  defaultCdrVersionName: string;\n+  onDismiss: () => void;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwNTkyOQ=="}, "originalCommit": {"oid": "576ffc31a61081251ec3180f99e547bba525e1ae"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92a4cb217d56271a6d64f58639d9fd80485b4aed", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/92a4cb217d56271a6d64f58639d9fd80485b4aed", "committedDate": "2020-11-17T19:38:56Z", "message": "add this-container to modal methods"}, "afterCommit": {"oid": "8b2a7164cce9b3f362d18eb341698b5933a476fc", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8b2a7164cce9b3f362d18eb341698b5933a476fc", "committedDate": "2020-11-19T16:52:47Z", "message": "onDismiss -> onClose"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "687ce92b5ff6d03055b5145204cf0fd5605ced52", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/687ce92b5ff6d03055b5145204cf0fd5605ced52", "committedDate": "2020-11-19T17:51:45Z", "message": "RW-5564 checkbox requirements for choosing an old CDR Version\n- OldCdrVersionModal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8336d0063619ba64815e69f1f794d51f77aeda9c", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/8336d0063619ba64815e69f1f794d51f77aeda9c", "committedDate": "2020-11-19T17:53:00Z", "message": "RW-5721 New CDR Version Upgrade Flag and Modal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd7f0b18f9f63cdc465c36c9fd04d4081cb6e83", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/acd7f0b18f9f63cdc465c36c9fd04d4081cb6e83", "committedDate": "2020-11-19T17:53:08Z", "message": "This is disgusting but it works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de59a67168fbaad3c2fbee8da7926a300d332495", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/de59a67168fbaad3c2fbee8da7926a300d332495", "committedDate": "2020-11-19T17:53:08Z", "message": "make data-test-id propagation optional for Clickable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd6ac22ebe30332e30068d86029bd88beadbfabc", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fd6ac22ebe30332e30068d86029bd88beadbfabc", "committedDate": "2020-11-19T17:53:09Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e4b811d6eeac1663d48024530cd7bbd6bac6f72", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1e4b811d6eeac1663d48024530cd7bbd6bac6f72", "committedDate": "2020-11-19T17:53:10Z", "message": "e2e cdr-version-upgrade-modal.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dacfc803fb708ceced264f68ef5adf37575f9693", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/dacfc803fb708ceced264f68ef5adf37575f9693", "committedDate": "2020-11-19T17:53:10Z", "message": "e2e old-cdr-version-modal.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "594ea1598975e692657eb33712ee180f0d38e8c1", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/594ea1598975e692657eb33712ee180f0d38e8c1", "committedDate": "2020-11-19T17:53:11Z", "message": "split up workspace e2e tests for parallelization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d626f6cd31db2798f0d94a2bbb9e5b92589c21ec", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d626f6cd31db2798f0d94a2bbb9e5b92589c21ec", "committedDate": "2020-11-19T17:53:11Z", "message": "split up cdr0versions e2e tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d817da22b05eb70485cbb10be9926cea88a8080b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/d817da22b05eb70485cbb10be9926cea88a8080b", "committedDate": "2020-11-19T17:53:12Z", "message": "add this-container to modal methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2831db91b58aac169d5007cc21bfe0203d254916", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/2831db91b58aac169d5007cc21bfe0203d254916", "committedDate": "2020-11-19T17:53:13Z", "message": "onDismiss -> onClose"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "508ea7fea609626ab6580f7002908d4cdd2371d7", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/508ea7fea609626ab6580f7002908d4cdd2371d7", "committedDate": "2020-11-19T17:53:13Z", "message": "init state from localStorage"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48cc4c4d5006f05936f15cf5e82c79645710f11f", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/48cc4c4d5006f05936f15cf5e82c79645710f11f", "committedDate": "2020-11-19T16:52:48Z", "message": "init state from localStorage"}, "afterCommit": {"oid": "508ea7fea609626ab6580f7002908d4cdd2371d7", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/508ea7fea609626ab6580f7002908d4cdd2371d7", "committedDate": "2020-11-19T17:53:13Z", "message": "init state from localStorage"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3845, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}