{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjY0NTI4", "number": 3255, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozNTo1MVrODoff2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo0NjozOVrODoftKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzg1Njg4OnYy", "diffSide": "RIGHT", "path": "api/src/main/resources/workbench-api.yaml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozNTo1MVrOF3EzwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozNTo1MVrOF3EzwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5NDc4NQ==", "bodyText": "nit: do we need single quotes?", "url": "https://github.com/all-of-us/workbench/pull/3255#discussion_r393294785", "createdAt": "2020-03-16T20:35:51Z", "author": {"login": "ericsong"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -815,6 +815,21 @@ paths:\n           description: Workspace deletion request accepted\n           schema:\n             \"$ref\": \"#/definitions/EmptyResponse\"\n+  \"/v1/workspaces/{workspaceNamespace}/{workspaceId}/billing-usage\":\n+    parameters:\n+      - \"$ref\": \"#/parameters/workspaceNamespace\"\n+      - \"$ref\": \"#/parameters/workspaceId\"\n+    get:\n+      tags:\n+      - workspaces\n+      description: 'Gets the free tier billing spend for a specified workspace'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac3fbd6a2934c316816532565a0bc98c6746ebd1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzg2NDA5OnYy", "diffSide": "RIGHT", "path": "api/src/main/resources/workbench-api.yaml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozODoyNVrOF3E4YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozODoyNVrOF3E4YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5NTk2OA==", "bodyText": "nit: I'd rename this to cost for consistency with our db", "url": "https://github.com/all-of-us/workbench/pull/3255#discussion_r393295968", "createdAt": "2020-03-16T20:38:25Z", "author": {"login": "ericsong"}, "path": "api/src/main/resources/workbench-api.yaml", "diffHunk": "@@ -3750,6 +3765,16 @@ definitions:\n       published:\n         type: boolean\n         default: false\n+  WorkspaceBillingUsageResponse:\n+    type: object\n+    required:\n+    - billingUsage\n+    properties:\n+      billingUsage:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac3fbd6a2934c316816532565a0bc98c6746ebd1"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzg2ODk0OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/pmiops/workbench/workspaces/WorkspacesControllerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozOTo1OVrOF3E7fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozOTo1OVrOF3E7fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5Njc2NA==", "bodyText": "would we be able to extend this test case to verify the return value? I'm hoping its as simple as just saving a free tier row and asserting the return value from here.", "url": "https://github.com/all-of-us/workbench/pull/3255#discussion_r393296764", "createdAt": "2020-03-16T20:39:59Z", "author": {"login": "ericsong"}, "path": "api/src/test/java/org/pmiops/workbench/workspaces/WorkspacesControllerTest.java", "diffHunk": "@@ -2989,6 +2989,22 @@ public void testNotebookLockingMetadataUnknownUser() {\n     assertNotebookLockingMetadata(gcsMetadata, expectedResponse, fcWorkspaceAcl);\n   }\n \n+  @Test\n+  public void testGetBillingUsage() {\n+    Workspace ws = createWorkspace();\n+    ws = workspacesController.createWorkspace(ws).getBody();\n+    stubGetWorkspace(ws.getNamespace(), ws.getId(), ws.getCreator(), WorkspaceAccessLevel.OWNER);\n+    workspacesController.getBillingUsage(ws.getNamespace(), ws.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac3fbd6a2934c316816532565a0bc98c6746ebd1"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzg5MDk2OnYy", "diffSide": "RIGHT", "path": "ui/src/app/pages/workspace/workspace-about.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo0NjozOVrOF3FJaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo0NjozOVrOF3FJaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwMDMyOQ==", "bodyText": "copied data-test-id?", "url": "https://github.com/all-of-us/workbench/pull/3255#discussion_r393300329", "createdAt": "2020-03-16T20:46:39Z", "author": {"login": "ericsong"}, "path": "ui/src/app/pages/workspace/workspace-about.tsx", "diffHunk": "@@ -240,6 +259,15 @@ export const WorkspaceAbout = fp.flow(withUserProfile(), withUrlParams(), withCd\n             <div style={{fontSize: '0.5rem'}}>{workspace ?\n               fp.capitalize(workspace.dataAccessLevel.toString()) : 'Loading...'}</div>\n           </div>\n+          {workspace && WorkspacePermissionsUtil.canWrite(workspace.accessLevel)\n+            && workspace.billingAccountType === BillingAccountType.FREETIER &&\n+              <div style={{...styles.infoBox, height: '2.5rem'}} data-test-id='dataAccessLevel'>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac3fbd6a2934c316816532565a0bc98c6746ebd1"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3239, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}