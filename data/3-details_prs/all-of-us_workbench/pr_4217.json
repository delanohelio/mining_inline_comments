{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMTc0MDY5", "number": 4217, "title": "[RW-5421][risk=no] Implement 'Delete Environment' button in runtime panel", "bodyText": "Introduced pattern for reuse with create panel and update confirm page: PanelContent (open to alternate naming suggestions), which switchCase's the primary content of the panel\nAdd the Delete Environment link and corresponding confirmation page\nRenamed runtimeState to runtimeStatus, for consistency\nA bunch of whitespace changes in the main panel - sorry for this: the only actual changes here are:\n\nintroduction of the switchCase, per above (resulting in indentation changes)\nsome style refactorings for reuse on the delete page\n\n\nHide the old reset button when enableCustomRuntimes is on", "createdAt": "2020-10-27T23:21:43Z", "url": "https://github.com/all-of-us/workbench/pull/4217", "merged": true, "mergeCommit": {"oid": "524bf47ec3e2ff51041176dcbe61c16865b2733a"}, "closed": true, "closedAt": "2020-11-05T23:33:09Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWyQ7pgFqTUxODI0MDMzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZpUDOgH2gAyNTExMTc0MDY5OjY5MmQ3YTg4YjdkN2RlNmJiZTRiNzliYzVjNGQ2NzQ3N2I5OGFiNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjQwMzM2", "url": "https://github.com/all-of-us/workbench/pull/4217#pullrequestreview-518240336", "createdAt": "2020-10-28T00:16:24Z", "commit": {"oid": "744a4878e1857b8a72c46d898d02528e144280ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMDoxNjoyNVrOHpVg4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMDoxNjoyNVrOHpVg4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzEwNjE0NQ==", "bodyText": "Curious about your thoughts on this. Ideally, we'd trigger a loading spinner at this point, then dispatch the delete/poll for recreation. Plumbing a promise out of setRuntimeStatus seems problematic, and I'm not sure whether it has the right side effects.\nAnother idea I had was perhaps to encode the state machine in this runtimepanel render function, e.g.\nif (deleting && runtime.status === Deleted) {\n  setDeleting(false);\n  setPanelContent(PanelContent.Customize);\n}\n\nreturn ...\n  {deleting && <SpinnerOverlay />}\n  ...;\n\nbut this also seems a bit difficult to follow.", "url": "https://github.com/all-of-us/workbench/pull/4217#discussion_r513106145", "createdAt": "2020-10-28T00:16:25Z", "author": {"login": "calbach"}, "path": "ui/src/app/pages/analysis/runtime-panel.tsx", "diffHunk": "@@ -218,116 +285,131 @@ export const RuntimePanel = fp.flow(withCurrentWorkspace(), withCdrVersions())((\n   }\n \n   return <div data-test-id='runtime-panel'>\n-    <h3 style={styles.sectionHeader}>Cloud analysis environment</h3>\n+    <h3 style={{...styles.baseHeader, ...styles.sectionHeader}}>Cloud analysis environment</h3>\n     <div>\n       Your analysis environment consists of an application and compute resources.\n       Your cloud environment is unique to this workspace and not shared with other users.\n     </div>\n-    {/* TODO(RW-5419): Cost estimates go here. */}\n-    <div style={styles.controlSection}>\n-      {/* Recommended runtime: pick from default templates or change the image. */}\n-      <PopupTrigger side='bottom'\n-                    closeOnClick\n-                    content={\n-                      <React.Fragment>\n-                        {\n-                          fp.flow(\n-                            fp.filter(['displayName', 'General Analysis']),\n-                            fp.toPairs,\n-                            fp.map(([i, preset]) => {\n-                              return <MenuItem\n-                              style={styles.presetMenuItem}\n-                              key={i}\n-                              onClick={() => {\n-                                // renaming to avoid shadowing\n-                                const {runtimeTemplate} = preset;\n-                                const {presetDiskSize, presetMachineName} = fp.cond([\n-                                  [() => !!runtimeTemplate.gceConfig, ({gceConfig: {bootDiskSize, machineType}}) => ({\n-                                    presetDiskSize: bootDiskSize,\n-                                    presetMachineName: machineType\n-                                  })],\n-                                  [() => !!runtimeTemplate.dataprocConfig, ({dataprocConfig: {masterDiskSize, masterMachineType}}) => ({\n-                                    presetDiskSize: masterDiskSize,\n-                                    presetMachineName: masterMachineType\n-                                  })]\n-                                ])(runtimeTemplate);\n-                                const presetMachineType = fp.find(({name}) => name === presetMachineName, validLeonardoMachineTypes);\n+    {switchCase(panelContent,\n+      [PanelContent.Delete, () => <ConfirmDelete\n+        onConfirm={() => {\n+          setRuntimeStatus(RuntimeStatusRequest.Delete);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "744a4878e1857b8a72c46d898d02528e144280ed"}, "originalPosition": 171}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNjU2OTU4", "url": "https://github.com/all-of-us/workbench/pull/4217#pullrequestreview-522656958", "createdAt": "2020-11-03T16:13:33Z", "commit": {"oid": "744a4878e1857b8a72c46d898d02528e144280ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "744a4878e1857b8a72c46d898d02528e144280ed", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/744a4878e1857b8a72c46d898d02528e144280ed", "committedDate": "2020-10-27T23:15:41Z", "message": "Hide reset and style"}, "afterCommit": {"oid": "b72572370edb0bd12c01a25dad557746533914c7", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/b72572370edb0bd12c01a25dad557746533914c7", "committedDate": "2020-11-04T01:18:28Z", "message": "Hide reset and style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b72572370edb0bd12c01a25dad557746533914c7", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/b72572370edb0bd12c01a25dad557746533914c7", "committedDate": "2020-11-04T01:18:28Z", "message": "Hide reset and style"}, "afterCommit": {"oid": "f26d0437eea9a04c2bd34d3f29822d9adf9bad68", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/f26d0437eea9a04c2bd34d3f29822d9adf9bad68", "committedDate": "2020-11-04T01:40:28Z", "message": "Hide reset and style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fa9955732b418b93aa3eff3e4b282a76b4be5ed", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/3fa9955732b418b93aa3eff3e4b282a76b4be5ed", "committedDate": "2020-11-04T03:39:44Z", "message": "lint"}, "afterCommit": {"oid": "564728012c64f29d196e388433d6810ef6051fbc", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/564728012c64f29d196e388433d6810ef6051fbc", "committedDate": "2020-11-05T21:13:56Z", "message": "lint / indent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "979fbbd68953c56715b20fe782620740b9f5601a", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/979fbbd68953c56715b20fe782620740b9f5601a", "committedDate": "2020-11-05T21:31:52Z", "message": "Delete Environment button"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1aee2b2d55ac7f4208da60c0a0b6806a98af1208", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/1aee2b2d55ac7f4208da60c0a0b6806a98af1208", "committedDate": "2020-11-05T21:30:01Z", "message": "lint/imports"}, "afterCommit": {"oid": "979fbbd68953c56715b20fe782620740b9f5601a", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/979fbbd68953c56715b20fe782620740b9f5601a", "committedDate": "2020-11-05T21:31:52Z", "message": "Delete Environment button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "692d7a88b7d7de6bbe4b79bc5c4d67477b98ab51", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/692d7a88b7d7de6bbe4b79bc5c4d67477b98ab51", "committedDate": "2020-11-05T21:33:21Z", "message": "stale comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4037, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}