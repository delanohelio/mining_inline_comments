{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjUyNzQx", "number": 4049, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToyOTozNFrOEmqIcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNjo0Mjo0MFrOEn2low==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTcxNjM0OnYy", "diffSide": "RIGHT", "path": "e2e/README.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToyOTozNFrOHW0Szg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNToyOTozNFrOHW0Szg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4NzUwMg==", "bodyText": "Note: in case you see this diff disappear, I stole this line for #4053", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r493687502", "createdAt": "2020-09-23T15:29:34Z", "author": {"login": "jmthibault79"}, "path": "e2e/README.md", "diffHunk": "@@ -44,6 +44,7 @@ interactions visible to you.\n * Run one test on deployed AoU \"test\" environment <div class=\"text-blue\">`yarn test:debug [TEST_FILE]` </div>\n * Run one test on your local server <div class=\"text-blue\">`yarn test-local [TEST_FILE]` </div>\n * Run one test in headless Chrome with node `--inspect-brk` argument. It pauses test playback at breakpoints which is useful for debugging or/and writing new tests <div class=\"text-blue\">`yarn test:debugTest [TEST_FILE]` </div>\n+  * Navigate to chrome://inspect after launching the tests to debug test code", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a582d55b6d9e099c6535bad5295f798c5e089641"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTY3NTY4OnYy", "diffSide": "RIGHT", "path": "e2e/tests/notebook/notebook-download.spec.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMTo1ODoyM1rOHXHCew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMTo1ODoyM1rOHXHCew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk5NDYxOQ==", "bodyText": "tslint error.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r493994619", "createdAt": "2020-09-24T01:58:23Z", "author": {"login": "aweng98"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -0,0 +1,88 @@\n+import NotebookDownloadModal from 'app/page/notebook-download-modal';\n+import WorkspaceDataPage from 'app/page/workspace-data-page';\n+import {makeRandomName} from 'utils/str-utils';\n+import {findWorkspace, signIn} from 'utils/test-utils';\n+import {waitForFn} from 'utils/waits-utils';\n+\n+describe('Jupyter notebook download test', () => {\n+\n+  beforeEach(async () => {\n+    await signIn(page);\n+  });\n+\n+  const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n+    let downloadBtn = await modal.getDownloadButton();\n+    expect(await downloadBtn.getProperty('disabled')).toBeTruthy();\n+\n+    await modal.clickPolicyCheckbox();\n+\n+    downloadBtn = await modal.getDownloadButton();\n+    const btnProps = await downloadBtn.getProperties();\n+    expect(btnProps['disabled']).toBeFalsy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTcxODk5OnYy", "diffSide": "RIGHT", "path": "e2e/app/page/notebook-page.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMjoyNDoxM1rOHXHbnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMDoyNTo0MFrOHYZI1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAwMTA1Mw==", "bodyText": "nit: I'd have used css selector to be consistent with others. but nothing wrong with xpath selectors.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r494001053", "createdAt": "2020-09-24T02:24:13Z", "author": {"login": "aweng98"}, "path": "e2e/app/page/notebook-page.ts", "diffHunk": "@@ -6,19 +6,28 @@ import {waitForDocumentTitle} from 'utils/waits-utils';\n import {ResourceCard} from 'app/text-labels';\n import AuthenticatedPage from './authenticated-page';\n import NotebookCell, {CellType} from './notebook-cell';\n+import NotebookDownloadModal from './notebook-download-modal';\n import WorkspaceAnalysisPage from './workspace-analysis-page';\n \n // CSS selectors\n enum CssSelector {\n   body = 'body.notebook_app',\n   notebookContainer = '#notebook-container',\n+\n   toolbarContainer = '#maintoolbar-container',\n   runCellButton = 'button[data-jupyter-action=\"jupyter-notebook:run-cell-and-select-next\"]',\n   saveNotebookButton = 'button[data-jupyter-action=\"jupyter-notebook:save-notebook\"]',\n   kernelIcon = '#kernel_indicator_icon',\n   kernelName = '.kernel_indicator_name',\n }\n \n+enum Xpath {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMzOTczNQ==", "bodyText": "Tried this at first, file menu does not have a logical html structure or clear class/ids, so I had to use the text content matching for it. The download buttons I figured I may as well be self-consistent with, but these could have been done in CSS instead.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r495339735", "createdAt": "2020-09-26T00:25:40Z", "author": {"login": "calbach"}, "path": "e2e/app/page/notebook-page.ts", "diffHunk": "@@ -6,19 +6,28 @@ import {waitForDocumentTitle} from 'utils/waits-utils';\n import {ResourceCard} from 'app/text-labels';\n import AuthenticatedPage from './authenticated-page';\n import NotebookCell, {CellType} from './notebook-cell';\n+import NotebookDownloadModal from './notebook-download-modal';\n import WorkspaceAnalysisPage from './workspace-analysis-page';\n \n // CSS selectors\n enum CssSelector {\n   body = 'body.notebook_app',\n   notebookContainer = '#notebook-container',\n+\n   toolbarContainer = '#maintoolbar-container',\n   runCellButton = 'button[data-jupyter-action=\"jupyter-notebook:run-cell-and-select-next\"]',\n   saveNotebookButton = 'button[data-jupyter-action=\"jupyter-notebook:save-notebook\"]',\n   kernelIcon = '#kernel_indicator_icon',\n   kernelName = '.kernel_indicator_name',\n }\n \n+enum Xpath {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAwMTA1Mw=="}, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTcyNTA4OnYy", "diffSide": "RIGHT", "path": "e2e/tests/notebook/notebook-download.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMjoyNzo0MVrOHXHfGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMDowMzozNFrOHYYnDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAwMTk0NA==", "bodyText": "nit: It would also make sense to check/verify policy texts in modal window before close.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r494001944", "createdAt": "2020-09-24T02:27:41Z", "author": {"login": "aweng98"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -0,0 +1,88 @@\n+import NotebookDownloadModal from 'app/page/notebook-download-modal';\n+import WorkspaceDataPage from 'app/page/workspace-data-page';\n+import {makeRandomName} from 'utils/str-utils';\n+import {findWorkspace, signIn} from 'utils/test-utils';\n+import {waitForFn} from 'utils/waits-utils';\n+\n+describe('Jupyter notebook download test', () => {\n+\n+  beforeEach(async () => {\n+    await signIn(page);\n+  });\n+\n+  const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n+    let downloadBtn = await modal.getDownloadButton();\n+    expect(await downloadBtn.getProperty('disabled')).toBeTruthy();\n+\n+    await modal.clickPolicyCheckbox();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMzMTA4NQ==", "bodyText": "Eh, I think I prefer without that. I'd rather use something like a snapshot test for something visual like this; testing for a string in the modal content I think is unlikely to protect against many regressions, and can break easily when we make changes.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r495331085", "createdAt": "2020-09-26T00:03:34Z", "author": {"login": "calbach"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -0,0 +1,88 @@\n+import NotebookDownloadModal from 'app/page/notebook-download-modal';\n+import WorkspaceDataPage from 'app/page/workspace-data-page';\n+import {makeRandomName} from 'utils/str-utils';\n+import {findWorkspace, signIn} from 'utils/test-utils';\n+import {waitForFn} from 'utils/waits-utils';\n+\n+describe('Jupyter notebook download test', () => {\n+\n+  beforeEach(async () => {\n+    await signIn(page);\n+  });\n+\n+  const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n+    let downloadBtn = await modal.getDownloadButton();\n+    expect(await downloadBtn.getProperty('disabled')).toBeTruthy();\n+\n+    await modal.clickPolicyCheckbox();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAwMTk0NA=="}, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTgwNzA3OnYy", "diffSide": "RIGHT", "path": "e2e/tests/notebook/notebook-download.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMzoxOTowNFrOHXIPdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwMDowMjoyMVrOHYYlVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAxNDMyNg==", "bodyText": "This check always pass even for disabled: false because getProperty() returns a JSHandle object.\nThis code checks properly:\n   let downloadBtn = await modal.getDownloadButton();\n   // sleep 2 seconds because state of the button changes. polling for \"disable: true\" would be a nicer solution. Without sleep, `disabled` is `false` after modal is opened because the check happened too soon.\n    await page.waitFor(2000);\n    expect(await getPropValue<boolean>(downloadBtn, 'disabled')).toBe(true);\n\n    await modal.clickPolicyCheckbox();\n\n    expect(await getPropValue<boolean>(downloadBtn, 'disabled')).toBe(false);", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r494014326", "createdAt": "2020-09-24T03:19:04Z", "author": {"login": "aweng98"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -0,0 +1,88 @@\n+import NotebookDownloadModal from 'app/page/notebook-download-modal';\n+import WorkspaceDataPage from 'app/page/workspace-data-page';\n+import {makeRandomName} from 'utils/str-utils';\n+import {findWorkspace, signIn} from 'utils/test-utils';\n+import {waitForFn} from 'utils/waits-utils';\n+\n+describe('Jupyter notebook download test', () => {\n+\n+  beforeEach(async () => {\n+    await signIn(page);\n+  });\n+\n+  const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n+    let downloadBtn = await modal.getDownloadButton();\n+    expect(await downloadBtn.getProperty('disabled')).toBeTruthy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMzMDY0Nw==", "bodyText": "Oops thanks, fixed.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r495330647", "createdAt": "2020-09-26T00:02:21Z", "author": {"login": "calbach"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -0,0 +1,88 @@\n+import NotebookDownloadModal from 'app/page/notebook-download-modal';\n+import WorkspaceDataPage from 'app/page/workspace-data-page';\n+import {makeRandomName} from 'utils/str-utils';\n+import {findWorkspace, signIn} from 'utils/test-utils';\n+import {waitForFn} from 'utils/waits-utils';\n+\n+describe('Jupyter notebook download test', () => {\n+\n+  beforeEach(async () => {\n+    await signIn(page);\n+  });\n+\n+  const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n+    let downloadBtn = await modal.getDownloadButton();\n+    expect(await downloadBtn.getProperty('disabled')).toBeTruthy();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDAxNDMyNg=="}, "originalCommit": {"oid": "621904d7ed7f7a686a4dcc39249cdb6f8e15ebdd"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMjI0MjkxOnYy", "diffSide": "RIGHT", "path": "e2e/tests/notebook/notebook-download.spec.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNjo0Mjo0MFrOHYofXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNjo0Mjo0MFrOHYofXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MTI2Mg==", "bodyText": "I like this code a lot. I can use same code pattern in other places.", "url": "https://github.com/all-of-us/workbench/pull/4049#discussion_r495591262", "createdAt": "2020-09-27T16:42:40Z", "author": {"login": "aweng98"}, "path": "e2e/tests/notebook/notebook-download.spec.ts", "diffHunk": "@@ -0,0 +1,75 @@\n+import NotebookDownloadModal from 'app/page/notebook-download-modal';\n+import WorkspaceDataPage from 'app/page/workspace-data-page';\n+import {makeRandomName} from 'utils/str-utils';\n+import {findWorkspace, signIn} from 'utils/test-utils';\n+import {getPropValue} from 'utils/element-utils';\n+import {waitForFn} from 'utils/waits-utils';\n+\n+describe('Jupyter notebook download test', () => {\n+\n+  beforeEach(async () => {\n+    await signIn(page);\n+  });\n+\n+  const testDownloadModal = async (modal: NotebookDownloadModal): Promise<void> => {\n+    const checkDownloadDisabledState = async (wantDisabled: boolean) => {\n+      expect(await waitForFn(async () => {\n+        let downloadBtn = await modal.getDownloadButton();\n+        return wantDisabled == await getPropValue<boolean>(downloadBtn, 'disabled');\n+      })).toBe(true);\n+    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "007dd0999829f147ebc53dd5b94f643ad7ebf406"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3948, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}