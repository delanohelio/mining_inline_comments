{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNzY0MDQ0", "number": 4064, "title": "[risk=low][RW-5560][RW-5561] Cross-CDR UX for Copy Concept Set and Notebook to Workspace ", "bodyText": "Description:\nRW-5560 Prevent Copy Concept to Workspace with a different CDR, with error message\n\nRW-5561 Warn when copying Notebook to Workspace with a different CDR (but allow it)\n\nTODO: styling to better match mocks\nTODO: unit tests\nTODO: e2e tests\n\nPR checklist\n\n This PR meets the Acceptance Criteria in the JIRA story\n The JIRA story has been moved to Dev Review\n This PR includes appropriate unit tests\n I have run and tested this change locally\n I have run the E2E tests on ths change against my local UI + API server with yarn test-local\n If this includes a UI change, I have taken screen recordings or screenshots of the new behavior and notified the PO and UX designer\n If this includes an API change, I have updated the appropriate Swagger definitions and notified API consumers\n If this includes a new feature flag, I have created and linked new JIRA tickets to (a) turn on the feature flag and (b) remove it later", "createdAt": "2020-09-25T00:22:27Z", "url": "https://github.com/all-of-us/workbench/pull/4064", "merged": true, "mergeCommit": {"oid": "c8903c10d5b5acf2b03526c122b80888e70431f7"}, "closed": true, "closedAt": "2020-10-14T17:59:09Z", "author": {"login": "jmthibault79"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMK_zYAFqTQ5NjA0Mjg1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSfH_-AH2gAyNDkyNzY0MDQ0OjIxM2Y5NjllZGVlOGRkMTRkODEwYzNiZDE0M2E2MWYwYmIyMDU2ODg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDQyODU3", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-496042857", "createdAt": "2020-09-25T00:53:04Z", "commit": {"oid": "cf4f0c7adf9eeae1a7025c6948a71d82cf76fb54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMDo1MzowNFrOHXxXLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMDo1MzowNFrOHXxXLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY4ODA0NQ==", "bodyText": "mostly copied from the mocks", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r494688045", "createdAt": "2020-09-25T00:53:04Z", "author": {"login": "jmthibault79"}, "path": "ui/src/app/components/copy-modal.tsx", "diffHunk": "@@ -21,54 +24,127 @@ const ResourceTypeHomeTabs = new Map()\n   .set(ResourceType.DATASET, 'data');\n \n export interface Props {\n+  cdrVersionListResponse: CdrVersionListResponse;\n   fromWorkspaceNamespace: string;\n-  fromWorkspaceName: string;\n+  fromWorkspaceFCName: string;\n   fromResourceName: string;\n+  fromCdrVersionId: string;\n   onClose: Function;\n   onCopy: Function;\n   resourceType: ResourceType;\n   saveFunction: (CopyRequest) => Promise<FileDetail | ConceptSet>;\n }\n \n interface State {\n-  writeableWorkspaces: Array<Workspace>;\n+  workspaceOptions: Array<Object>;\n   destination: Workspace;\n   newName: string;\n   requestState: RequestState;\n-  errorMsg: string;\n+  saveErrorMsg: string;\n   loading: boolean;\n+  cdrMismatch: string;\n }\n \n-const boldStyle = {\n-  fontWeight: 600\n-};\n+const styles = reactStyles({\n+  bold: {\n+    fontWeight: 600\n+  },\n+  conceptSetCdrMismatch: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4f0c7adf9eeae1a7025c6948a71d82cf76fb54"}, "originalPosition": 53}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf4f0c7adf9eeae1a7025c6948a71d82cf76fb54", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/cf4f0c7adf9eeae1a7025c6948a71d82cf76fb54", "committedDate": "2020-09-25T00:21:46Z", "message": "fixes for unit test"}, "afterCommit": {"oid": "ed14959e3b796c2643fcf59b613e88d8a20ecc4e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ed14959e3b796c2643fcf59b613e88d8a20ecc4e", "committedDate": "2020-09-25T16:43:33Z", "message": "RW-5560 RW-5561 cross-CDR copy UX for Notebook and Concept Set"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed14959e3b796c2643fcf59b613e88d8a20ecc4e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ed14959e3b796c2643fcf59b613e88d8a20ecc4e", "committedDate": "2020-09-25T16:43:33Z", "message": "RW-5560 RW-5561 cross-CDR copy UX for Notebook and Concept Set"}, "afterCommit": {"oid": "869ef443640cc6b44b775fcf4f5cff057189e093", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/869ef443640cc6b44b775fcf4f5cff057189e093", "committedDate": "2020-09-25T17:20:25Z", "message": "RW-5560 RW-5561 cross-CDR copy UX for Notebook and Concept Set"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b464124a330ac9c1bcc8e5f44d8dd59a2754223", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1b464124a330ac9c1bcc8e5f44d8dd59a2754223", "committedDate": "2020-09-25T21:14:30Z", "message": "unit tests"}, "afterCommit": {"oid": "6de0d125ad1733ac316f62b16dac830f1b9882e0", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6de0d125ad1733ac316f62b16dac830f1b9882e0", "committedDate": "2020-10-08T20:28:18Z", "message": "e2e test for Copy Concept Set"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6de0d125ad1733ac316f62b16dac830f1b9882e0", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6de0d125ad1733ac316f62b16dac830f1b9882e0", "committedDate": "2020-10-08T20:28:18Z", "message": "e2e test for Copy Concept Set"}, "afterCommit": {"oid": "dae51896787472665ab4e8a8a77a8712c8dc489d", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/dae51896787472665ab4e8a8a77a8712c8dc489d", "committedDate": "2020-10-08T21:12:42Z", "message": "rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47a751c7c0620db91703e8f49bde3eb8ed77310e", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/47a751c7c0620db91703e8f49bde3eb8ed77310e", "committedDate": "2020-10-09T12:44:21Z", "message": "restore previous functionality (which worked)"}, "afterCommit": {"oid": "ca12bd4da332dea3ca5e6f36c512a714630e3db8", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ca12bd4da332dea3ca5e6f36c512a714630e3db8", "committedDate": "2020-10-09T12:45:28Z", "message": "restore previous functionality (which worked)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca12bd4da332dea3ca5e6f36c512a714630e3db8", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ca12bd4da332dea3ca5e6f36c512a714630e3db8", "committedDate": "2020-10-09T12:45:28Z", "message": "restore previous functionality (which worked)"}, "afterCommit": {"oid": "9edfafe3d98017d220ce1bf15ead82c26ee08399", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9edfafe3d98017d220ce1bf15ead82c26ee08399", "committedDate": "2020-10-09T12:51:39Z", "message": "e2e test for Copy Concept Set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjQ3NTEz", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-507647513", "createdAt": "2020-10-13T16:54:57Z", "commit": {"oid": "9edfafe3d98017d220ce1bf15ead82c26ee08399"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo1NDo1N1rOHgwoIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo1NDo1N1rOHgwoIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDExMzE4NA==", "bodyText": "extracted from the existing test, for reuse", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r504113184", "createdAt": "2020-10-13T16:54:57Z", "author": {"login": "jmthibault79"}, "path": "e2e/tests/conceptsets/copy-to-workspace.spec.ts", "diffHunk": "@@ -7,8 +7,30 @@ import {SaveOption} from 'app/page/conceptset-save-modal';\n import WorkspaceDataPage from 'app/page/workspace-data-page';\n import {LinkText, ResourceCard} from 'app/text-labels';\n import {makeRandomName} from 'utils/str-utils';\n-import {findWorkspace, signIn} from 'utils/test-utils';\n-\n+import {createWorkspace, signIn} from 'utils/test-utils';\n+import {config} from 'resources/workbench-config';\n+\n+async function createConceptSet(srcWorkspaceCard: WorkspaceCard) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9edfafe3d98017d220ce1bf15ead82c26ee08399"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dfeb1a84fee9864b8565a943555f5de1972b69b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6dfeb1a84fee9864b8565a943555f5de1972b69b", "committedDate": "2020-10-13T18:02:18Z", "message": "RW-5560 RW-5561 cross-CDR copy UX for Notebook and Concept Set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc89565bf62ff6dd4ba8820e18602a34b6bf99a5", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fc89565bf62ff6dd4ba8820e18602a34b6bf99a5", "committedDate": "2020-10-13T18:02:19Z", "message": "unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd6759bd88856d7664bacdb25455b3053c6bb607", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/fd6759bd88856d7664bacdb25455b3053c6bb607", "committedDate": "2020-10-13T18:02:19Z", "message": "e2e test for Copy Concept Set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b1ab0acbfc6de4136a86806827b37c33f493a10", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9b1ab0acbfc6de4136a86806827b37c33f493a10", "committedDate": "2020-10-13T18:02:20Z", "message": "Add ConceptSetRestrictionText"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7b84f136ec6498ef596f9d72386e4014dbc84a2", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e7b84f136ec6498ef596f9d72386e4014dbc84a2", "committedDate": "2020-10-13T18:02:20Z", "message": "refactor copy-notebook test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed", "committedDate": "2020-10-13T18:02:20Z", "message": "copy alt cdr version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9edfafe3d98017d220ce1bf15ead82c26ee08399", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/9edfafe3d98017d220ce1bf15ead82c26ee08399", "committedDate": "2020-10-09T12:51:39Z", "message": "e2e test for Copy Concept Set"}, "afterCommit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed", "committedDate": "2020-10-13T18:02:20Z", "message": "copy alt cdr version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzEzODM1", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-507713835", "createdAt": "2020-10-13T18:20:08Z", "commit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMDowOFrOHgz3JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMDowOFrOHgz3JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NjE4MA==", "bodyText": "So this can be used for successful and attempted copies", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r504166180", "createdAt": "2020-10-13T18:20:08Z", "author": {"login": "jmthibault79"}, "path": "e2e/app/component/copy-modal.ts", "diffHunk": "@@ -19,12 +19,12 @@ export default class CopyModal extends Modal {\n     return new Textbox(this.page, `${this.getXpath()}//*[contains(text(), \"Name\")]/ancestor::node()[1]/input[@type=\"text\"]`);\n   }\n \n- /**\n-  *\n-  * @param {string} workspaceName Destination Workspace name.\n-  * @param {string} newName New name.\n-  */\n-  async copyToAnotherWorkspace(workspaceName: string, newName?: string): Promise<void> {\n+  /**\n+   *\n+   * @param {string} workspaceName Destination Workspace name.\n+   * @param {string} newName New name.\n+   */\n+  async beginCopyToAnotherWorkspace(workspaceName: string, newName?: string): Promise<void> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzE0NTAw", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-507714500", "createdAt": "2020-10-13T18:21:11Z", "commit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMToxMVrOHgz5Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMToxMVrOHgz5Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NjcyNw==", "bodyText": "TODO: refactor the kitchen-sink findWorkspace().  All we are using it for here is workspace creation.", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r504166727", "createdAt": "2020-10-13T18:21:11Z", "author": {"login": "jmthibault79"}, "path": "e2e/tests/conceptsets/copy-to-workspace.spec.ts", "diffHunk": "@@ -18,41 +40,26 @@ describe('Copy Concept Set to another workspace', () => {\n \n   /**\n    * Test:\n-   * - Copy Concept Set from one workspace to another workspace.\n+   * - Copy Concept Set from one workspace to another workspace when both have the same CDR Version.\n    */\n-  test('Workspace OWNER can copy Concept Set', async () => {\n+  test('Workspace OWNER can copy Concept Set when CDR Versions match', async () => {\n \n-    // Need a source and a destination workspace.\n+    // Create a source and a destination workspace with the same CDR Version.\n \n-    const destWorkspaceCard: WorkspaceCard = await findWorkspace(page, {create: true});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzE0OTI4", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-507714928", "createdAt": "2020-10-13T18:21:50Z", "commit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMTo1MFrOHgz6tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMTo1MFrOHgz6tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NzA5Mw==", "bodyText": "common code for two tests, copied from the original test", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r504167093", "createdAt": "2020-10-13T18:21:50Z", "author": {"login": "jmthibault79"}, "path": "e2e/tests/notebook/owner-copy-to-workspace.spec.ts", "diffHunk": "@@ -3,73 +3,79 @@ import Modal from 'app/component/modal';\n import WorkspaceDataPage from 'app/page/workspace-data-page';\n import {LinkText, ResourceCard} from 'app/text-labels';\n import {makeRandomName} from 'utils/str-utils';\n-import {findWorkspace, signIn} from 'utils/test-utils';\n+import {createWorkspace, findWorkspace, signIn} from 'utils/test-utils';\n+import {config} from 'resources/workbench-config';\n \n // Notebook server start may take a long time. Set maximum test running time to 20 minutes.\n jest.setTimeout(20 * 60 * 1000);\n \n+/**\n+ * Test:\n+ * - Create new Workspace as the copy-to destination Workspace.\n+ * - Create new Workspace as copy-from Workspace and create new notebook in this Workspace.\n+ * - Run code to print WORKSPACE_NAMESPACE. It should match Workspace namespace from Workspace URL.\n+ * - Copy notebook to destination Workspace and give copied notebook a new name.\n+ * - Verify copied notebook is in destination Workspace.\n+ * - Open copied notebook and run code to print WORKSPACE_NAMESPACE. It should match destination Workspace namespace.\n+ * - Delete notebooks.\n+ */\n+async function copyNotebookTest(srcCdrVersionName: string, destCdrVersionName: string) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzE1MjY0", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-507715264", "createdAt": "2020-10-13T18:22:20Z", "commit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMjoyMFrOHgz7uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoyMjoyMFrOHgz7uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NzM1NQ==", "bodyText": "Adapted from the creation path of findWorkspace()", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r504167355", "createdAt": "2020-10-13T18:22:20Z", "author": {"login": "jmthibault79"}, "path": "e2e/utils/test-utils.ts", "diffHunk": "@@ -178,6 +179,20 @@ export async function performAction(\n \n }\n \n+export async function createWorkspace(page: Page, cdrVersionName: string = config.defaultCdrVersionName): Promise<WorkspaceCard> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fc8c5cba10802657abf00f66c0e9fe4d7fae6ed"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06c224880f5350ff4f10db12498d646c62c9e7a4", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/06c224880f5350ff4f10db12498d646c62c9e7a4", "committedDate": "2020-10-13T18:49:09Z", "message": "styling fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4Mzg3NDkz", "url": "https://github.com/all-of-us/workbench/pull/4064#pullrequestreview-508387493", "createdAt": "2020-10-14T14:08:56Z", "commit": {"oid": "06c224880f5350ff4f10db12498d646c62c9e7a4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDowODo1NlrOHhU88w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDowODo1NlrOHhU88w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwODMzOQ==", "bodyText": "opt: consider using an fp.cond here - I believe it would eliminate the need for an early return and would tie together the 3 conditions as \"one of these can occur\"", "url": "https://github.com/all-of-us/workbench/pull/4064#discussion_r504708339", "createdAt": "2020-10-14T14:08:56Z", "author": {"login": "petesantos"}, "path": "ui/src/app/components/copy-modal.tsx", "diffHunk": "@@ -218,27 +276,57 @@ class CopyModalComponent extends React.Component<Props, State> {\n     }\n   }\n \n-  setDestination(destination: Workspace) {\n+  // OK to copy a notebook with a mismatch, but show a warning message\n+  setNotebookCdrMismatchWarning(destination: Workspace, fromCdrVersionId: string) {\n+    const warningMsg = `The selected destination workspace uses a different dataset version ` +\n+        `(${this.cdrName(destination.cdrVersionId)}) than the current workspace (${this.cdrName(fromCdrVersionId)}). ` +\n+        'Edits may be required to ensure your analysis is functional and accurate.';\n+    this.setState({ cdrMismatch: warningMsg, destination: destination });\n+  }\n+\n+  // not OK to copy a Concept Set with a mismatch.  Show an error message and prevent copy\n+  setConceptSetCdrMismatchError(destination: Workspace, fromCdrVersionId: string) {\n+    const errorMsg = `Can\u2019t copy to that workspace. It uses a different dataset version ` +\n+        `(${this.cdrName(destination.cdrVersionId)}) than the current workspace (${this.cdrName(fromCdrVersionId)}).`;\n+    this.setState({ cdrMismatch: errorMsg, destination: null });\n+  }\n+\n+  validateAndSetDestination(destination: Workspace) {\n+    const {fromCdrVersionId, resourceType} = this.props;\n+\n     this.clearCopyError();\n-    this.setState({destination: destination});\n+\n+    if (fromCdrVersionId === destination.cdrVersionId) {\n+      this.setState({cdrMismatch: '', destination: destination});\n+      return;\n+    }\n+\n+    if (resourceType === ResourceType.NOTEBOOK) {\n+      this.setNotebookCdrMismatchWarning(destination, fromCdrVersionId);\n+    } else if (resourceType === ResourceType.CONCEPTSET) {\n+      this.setConceptSetCdrMismatchError(destination, fromCdrVersionId);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06c224880f5350ff4f10db12498d646c62c9e7a4"}, "originalPosition": 139}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7152af17886f89821dec19e8ee66ffbe4ef3e5d1", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/7152af17886f89821dec19e8ee66ffbe4ef3e5d1", "committedDate": "2020-10-14T14:32:39Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea710b52279e4e34f07b67eaf3cdd761ddeead7b", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/ea710b52279e4e34f07b67eaf3cdd761ddeead7b", "committedDate": "2020-10-14T14:36:59Z", "message": "use fp.cond to set error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "213f969edee8dd14d810c3bd143a61f0bb205688", "author": {"user": {"login": "jmthibault79", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/213f969edee8dd14d810c3bd143a61f0bb205688", "committedDate": "2020-10-14T15:43:40Z", "message": "Revert \"use fp.cond to set error\"\n\nThis reverts commit ea710b52279e4e34f07b67eaf3cdd761ddeead7b."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4102, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}