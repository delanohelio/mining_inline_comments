{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NDYxNjQ3", "number": 4081, "title": "[RW-5614][risk=no] Handle egress events from GCE", "bodyText": "This is the only instance I was able to find where we might have a specific dependency on the VM naming convention. Please let me know if you're aware of any others.", "createdAt": "2020-09-28T23:52:16Z", "url": "https://github.com/all-of-us/workbench/pull/4081", "merged": true, "mergeCommit": {"oid": "0bfd573cdc618ed8fe0c0f9a5ead0d1e573e646c"}, "closed": true, "closedAt": "2020-09-30T23:41:59Z", "author": {"login": "calbach"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNcgDOAH2gAyNDk0NDYxNjQ3OmJiNWFlNTY4NzJiOTRhY2VkNDExZmEzZGQ3N2Q5OTcwMjk3ZmIyNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOEsvkAH2gAyNDk0NDYxNjQ3OmYyYWQ2OTM1MDQxNWQxOTIwYzE5M2I1Zjc4NjE0ZjQ0YjJhNWE3MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/bb5ae56872b94aced411fa3dd77d9970297fb269", "committedDate": "2020-09-28T23:50:36Z", "message": "Handle egress events from GCE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTczNTc2", "url": "https://github.com/all-of-us/workbench/pull/4081#pullrequestreview-497973576", "createdAt": "2020-09-28T23:55:06Z", "commit": {"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzo1NTowNlrOHZToSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzo1NTowNlrOHZToSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODA1Nw==", "bodyText": "Also while you're here: any initial thoughts on this?\nMy assumptions are:\n\nThe existing egress alerting already covers traffic coming from Dataproc workers nodes.\nThe naming convention for these nodes is not handled anywhere, so we may need to do some more clever mapping here to determine the owner.\nEgress from worker nodes is potentially a big red flag, and if it were easy, I might be in favor of locking it down. There is no real reason to allow worker nodes to send a lot of data out of the cluster", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r496298057", "createdAt": "2020-09-28T23:55:06Z", "author": {"login": "calbach"}, "path": "api/src/main/java/org/pmiops/workbench/actionaudit/auditors/EgressEventAuditorImpl.kt", "diffHunk": "@@ -36,12 +36,21 @@ constructor(\n      * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use\n      * of Dataproc (see https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/metadata).\n      *\n-     * TODO(RW-4848): Update this to account for GCE naming conventions.\n+     * TODO(RW-4848): How do egress alerts interact with worker nodes?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzIzNDIy", "url": "https://github.com/all-of-us/workbench/pull/4081#pullrequestreview-499723422", "createdAt": "2020-09-30T18:56:51Z", "commit": {"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1Njo1MVrOHarJ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1Nzo0M1rOHarLvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjA3Ng==", "bodyText": "All good points \u2013\u00a0nothing I'd add on top of that.", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r497732076", "createdAt": "2020-09-30T18:56:51Z", "author": {"login": "gjuggler"}, "path": "api/src/main/java/org/pmiops/workbench/actionaudit/auditors/EgressEventAuditorImpl.kt", "diffHunk": "@@ -36,12 +36,21 @@ constructor(\n      * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use\n      * of Dataproc (see https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/metadata).\n      *\n-     * TODO(RW-4848): Update this to account for GCE naming conventions.\n+     * TODO(RW-4848): How do egress alerts interact with worker nodes?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5ODA1Nw=="}, "originalCommit": {"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjU0Mg==", "bodyText": "nit: update comment", "url": "https://github.com/all-of-us/workbench/pull/4081#discussion_r497732542", "createdAt": "2020-09-30T18:57:43Z", "author": {"login": "gjuggler"}, "path": "api/src/main/java/org/pmiops/workbench/actionaudit/auditors/EgressEventAuditorImpl.kt", "diffHunk": "@@ -36,12 +36,21 @@ constructor(\n      * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use\n      * of Dataproc (see https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/metadata).\n      *\n-     * TODO(RW-4848): Update this to account for GCE naming conventions.\n+     * TODO(RW-4848): How do egress alerts interact with worker nodes?\n      */\n-    private fun dbUserToVmName(dbUser: DbUser): String {\n+    private fun dbUserToDataprocMasterVmName(dbUser: DbUser): String {\n         return dbUser.runtimeName + DATAPROC_MASTER_NODE_SUFFIX\n     }\n \n+    /**\n+     * Converts the AoU-chosen runtime name into the actual VM name as reported by Google Cloud's\n+     * flow logs. Empirically, an \"-m\" suffix is added to the VM name, due to Leo team's use", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb5ae56872b94aced411fa3dd77d9970297fb269"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2ad69350415d1920c193b5f78614f44b2a5a700", "author": {"user": {"login": "calbach", "name": "CH Albach"}}, "url": "https://github.com/all-of-us/workbench/commit/f2ad69350415d1920c193b5f78614f44b2a5a700", "committedDate": "2020-09-30T22:40:40Z", "message": "PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4130, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}