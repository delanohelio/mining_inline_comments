{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MTQ2Mjgz", "number": 3958, "title": "[no ticket][risk=no] Puppeteer: workspace-base deleteResource function", "bodyText": "Create common deleteResource() function in workspace-base.ts abstract class to replace deleteCohort, deleteConceptSet, deleteNotebook and deleteDataset functions to reduce code duplication.\nMove CardType enum from data-resource-card.ts to text-labels.ts and rename to ResourceCard.", "createdAt": "2020-09-02T20:23:52Z", "url": "https://github.com/all-of-us/workbench/pull/3958", "merged": true, "mergeCommit": {"oid": "d7597cae88587073d35b3eab0947eb9571318761"}, "closed": true, "closedAt": "2020-09-14T17:47:56Z", "author": {"login": "aweng98"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIo4C_gFqTQ4NzM2NTMwNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI2OyHgBqjM3NjQ0Mjg1NDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY1MzA1", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487365305", "createdAt": "2020-09-14T01:26:02Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyNjowMlrOHRBMqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyNjowMlrOHRBMqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzQ2NA==", "bodyText": "Do we need console message?", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487607464", "createdAt": "2020-09-14T01:26:02Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/component/share-modal.ts", "diffHunk": "@@ -25,6 +25,7 @@ export default class ShareModal extends Modal {\n     await ownerOpt.click();\n \n     await this.clickButton(LinkText.Save, {waitForClose: true});\n+    console.log(`Shared workspace to user ${username} with role ${level}`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY1NDI3", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487365427", "createdAt": "2020-09-14T01:26:32Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyNjozMlrOHRBNCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyNjozMlrOHRBNCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzU2Mg==", "bodyText": "nit: page/text-labels", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487607562", "createdAt": "2020-09-14T01:26:32Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/page/notebook-page.ts", "diffHunk": "@@ -1,11 +1,12 @@\n+import * as fs from 'fs';\n import {Frame, Page} from 'puppeteer';\n import {getPropValue} from 'utils/element-utils';\n import {waitWhileLoading} from 'utils/test-utils';\n import {waitForDocumentTitle} from 'utils/waits-utils';\n+import {ResourceCard} from '../text-labels';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY1NzM2", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487365736", "createdAt": "2020-09-14T01:28:02Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyODowMlrOHRBOIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyODowMlrOHRBOIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNzg0MA==", "bodyText": "Question: resourceCard is resource card list?", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487607840", "createdAt": "2020-09-14T01:28:02Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/page/workspace-analysis-page.ts", "diffHunk": "@@ -128,7 +110,7 @@ export default class WorkspaceAnalysisPage extends WorkspaceBase {\n    */\n   async duplicateNotebook(notebookName: string): Promise<string> {\n     const resourceCard = new DataResourceCard(this.page);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY2MTMx", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487366131", "createdAt": "2020-09-14T01:29:40Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyOTo0MFrOHRBPcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyOTo0MFrOHRBPcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODE3OQ==", "bodyText": "There can also be a utils method that takes in this.page , resource name and card type.\nconst resourceCard = new DataResourceCard(this.page); can move in that util method", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487608179", "createdAt": "2020-09-14T01:29:40Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/page/workspace-analysis-page.ts", "diffHunk": "@@ -143,7 +125,7 @@ export default class WorkspaceAnalysisPage extends WorkspaceBase {\n   async copyNotebookToWorkspace(notebookName: string, destinationWorkspace: string, destinationNotebookName?: string): Promise<void> {\n     // Open Copy modal.s\n     const resourceCard = new DataResourceCard(this.page);\n-    const notebookCard = await resourceCard.findCard(notebookName, CardType.Notebook);\n+    const notebookCard = await resourceCard.findCard(notebookName, ResourceCard.Notebook);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY2MjI0", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487366224", "createdAt": "2020-09-14T01:30:09Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTozMDowOVrOHRBP4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTozMDowOVrOHRBP4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODI4OQ==", "bodyText": "nit: app/component", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487608289", "createdAt": "2020-09-14T01:30:09Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -4,6 +4,9 @@ import {ElementType} from 'app/xpath-options';\n import {Page} from 'puppeteer';\n import {waitWhileLoading} from 'utils/test-utils';\n import {waitForAttributeEquality} from 'utils/waits-utils';\n+import DataResourceCard from '../component/data-resource-card';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY2Mzgy", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487366382", "createdAt": "2020-09-14T01:30:51Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTozMDo1MVrOHRBQXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTozMDo1MVrOHRBQXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwODQxMw==", "bodyText": "nit: indent for readability", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487608413", "createdAt": "2020-09-14T01:30:51Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -94,5 +97,48 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n     return waitForAttributeEquality(this.page, {xpath: selector}, 'aria-selected', 'true');\n   }\n \n+  /**\n+   * Delete ConceptSet, Dataset or Cohort thru Ellipsis menu located inside the resource card.\n+   * @param {string} resourceName\n+   * @param {ResourceCard} resourceType\n+   */\n+  async deleteResource(resourceName: string, resourceType: ResourceCard): Promise<string[]> {\n+    const resourceCard = new DataResourceCard(this.page);\n+    const card = await resourceCard.findCard(resourceName, resourceType);\n+    if (!card) {\n+      throw new Error(`Failed to find ${resourceType} card \"${resourceName}\"`);\n+    }\n+\n+    await card.clickEllipsisAction(EllipsisMenuAction.Delete, {waitForNav: false});\n+\n+    const modal = new Modal(this.page);\n+    await modal.waitForLoad();\n+    const modalTextContent = await modal.getTextContent();\n+\n+    let link;\n+    switch (resourceType) {\n+    case ResourceCard.Cohort:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY3MzM5", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487367339", "createdAt": "2020-09-14T01:35:05Z", "commit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTozNTowNVrOHRBTog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTozNTowNVrOHRBTog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwOTI1MA==", "bodyText": "Question: If we delete a concept Set or Cohort that is being used in existing dataSet ,there will be another Modal with warning text , is that covered?", "url": "https://github.com/all-of-us/workbench/pull/3958#discussion_r487609250", "createdAt": "2020-09-14T01:35:05Z", "author": {"login": "NehaBroad"}, "path": "e2e/app/page/workspace-base.ts", "diffHunk": "@@ -94,5 +97,48 @@ export default abstract class WorkspaceBase extends AuthenticatedPage {\n     return waitForAttributeEquality(this.page, {xpath: selector}, 'aria-selected', 'true');\n   }\n \n+  /**\n+   * Delete ConceptSet, Dataset or Cohort thru Ellipsis menu located inside the resource card.\n+   * @param {string} resourceName\n+   * @param {ResourceCard} resourceType\n+   */\n+  async deleteResource(resourceName: string, resourceType: ResourceCard): Promise<string[]> {\n+    const resourceCard = new DataResourceCard(this.page);\n+    const card = await resourceCard.findCard(resourceName, resourceType);\n+    if (!card) {\n+      throw new Error(`Failed to find ${resourceType} card \"${resourceName}\"`);\n+    }\n+\n+    await card.clickEllipsisAction(EllipsisMenuAction.Delete, {waitForNav: false});\n+\n+    const modal = new Modal(this.page);\n+    await modal.waitForLoad();\n+    const modalTextContent = await modal.getTextContent();\n+\n+    let link;\n+    switch (resourceType) {\n+    case ResourceCard.Cohort:\n+      link = LinkText.DeleteCohort;\n+      break;\n+    case ResourceCard.ConceptSet:\n+      link = LinkText.DeleteConceptSet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809099eb89e7d81c102125359f4846a4e313303f"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTQ4NTMw", "url": "https://github.com/all-of-us/workbench/pull/3958#pullrequestreview-487948530", "createdAt": "2020-09-14T16:31:43Z", "commit": {"oid": "1978ecbb08dd79356da222125c32ba800ee3c9d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0f37fc47e7e92f60a5c6dd90ed5fdd0f9dd0da2", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/f0f37fc47e7e92f60a5c6dd90ed5fdd0f9dd0da2", "committedDate": "2020-09-14T16:58:38Z", "message": "workspace-base deleteResource function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b8b6e4b66e21debc8006515673481a28ab5b022", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1b8b6e4b66e21debc8006515673481a28ab5b022", "committedDate": "2020-09-14T16:58:38Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0ebd9dda6465c9865791d9f61d8436178527ac3", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e0ebd9dda6465c9865791d9f61d8436178527ac3", "committedDate": "2020-09-14T16:58:38Z", "message": "PR feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1978ecbb08dd79356da222125c32ba800ee3c9d7", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/1978ecbb08dd79356da222125c32ba800ee3c9d7", "committedDate": "2020-09-14T16:25:37Z", "message": "PR feedback"}, "afterCommit": {"oid": "e0ebd9dda6465c9865791d9f61d8436178527ac3", "author": {"user": {"login": "aweng98", "name": null}}, "url": "https://github.com/all-of-us/workbench/commit/e0ebd9dda6465c9865791d9f61d8436178527ac3", "committedDate": "2020-09-14T16:58:38Z", "message": "PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4419, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}