{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDk1MzMy", "number": 1206, "title": "Elide5.0 - Simplify User Principal", "bodyText": "Resolves #773\nDescription\nSimplification of Elide's User concept in the following ways:\n\nElide's User now stores a Principal object instead of an Object.\nUser supports a mechanism to check for role membership (for standard checks coming in the future).\nUser supports a mechanism to get an identifier (for standard checks coming in the future).\nSpring Controller now takes an Authentication instead of a Principal\nSpring creates a subclass of User called AuthenticationUser that implements role membership checks.\nJAXRS creates a subclass of User called SecurityContextUser that implements role membership checks.\nRemoved UpdateOnCreate check (it is obsolete and can be replaced with Create and Update permissions).\nRemoved accessUser function in DataStoreTransaction to simplify the interface.\n\nMotivation and Context\nElide 5.0 interface cleanup.\nHow Has This Been Tested?\nExisting Tests Pass\nLicense\nI confirm that this contribution is made under an Apache 2.0 license and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-02-28T17:09:52Z", "url": "https://github.com/yahoo/elide/pull/1206", "merged": true, "mergeCommit": {"oid": "03d31ded4070270dd7081b122f788e8c84cb4c98"}, "closed": true, "closedAt": "2020-03-04T22:20:29Z", "author": {"login": "aklish"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJ2inYgFqTM2NzU5NjMzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKeaxRgFqTM2OTE2MjEzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTk2MzM0", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-367596334", "createdAt": "2020-03-02T23:07:43Z", "commit": {"oid": "4d24267aeadf35624972e842ac7db815c2ffde59"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMzowNzo0M1rOFwyqyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMzozNjo0M1rOFwzSrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcwNjEyMw==", "bodyText": "Technically Spring Security", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r386706123", "createdAt": "2020-03-02T23:07:43Z", "author": {"login": "codingwhatever"}, "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/security/AuthenticationUser.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+\n+package com.yahoo.elide.spring.security;\n+\n+import com.yahoo.elide.security.User;\n+import org.springframework.security.core.Authentication;\n+import org.springframework.security.core.GrantedAuthority;\n+\n+/**\n+ * Elide User object for Spring Boot.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d24267aeadf35624972e842ac7db815c2ffde59"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxMzMyNQ==", "bodyText": "How (if at all) will the Role class here relate to https://docs.spring.io/spring-security/site/docs/4.2.12.RELEASE/apidocs/org/springframework/security/core/GrantedAuthority.html in https://docs.spring.io/spring-security/site/docs/4.2.12.RELEASE/apidocs/org/springframework/security/core/Authentication.html for the spring security use case?", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r386713325", "createdAt": "2020-03-02T23:28:00Z", "author": {"login": "codingwhatever"}, "path": "elide-annotations/src/main/java/com/yahoo/elide/security/checks/prefab/Role.java", "diffHunk": "@@ -31,4 +31,19 @@ public boolean ok(User user) {\n             return false;\n         }\n     }\n+\n+    /**\n+     * Check which verifies if the user is a member of a particular role.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d24267aeadf35624972e842ac7db815c2ffde59"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxNjMzMw==", "bodyText": "Are there any known use cases that would not be supported by Principal?", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r386716333", "createdAt": "2020-03-02T23:36:43Z", "author": {"login": "codingwhatever"}, "path": "elide-annotations/src/main/java/com/yahoo/elide/security/User.java", "diffHunk": "@@ -1,19 +1,28 @@\n /*\n- * Copyright 2016, Yahoo Inc.\n+ * Copyright 2020, Yahoo Inc.\n  * Licensed under the Apache License, Version 2.0\n  * See LICENSE file in project root for terms.\n  */\n package com.yahoo.elide.security;\n \n import lombok.Getter;\n+import java.security.Principal;\n \n /**\n  * Wrapper for opaque user passed in every request.\n  */\n public class User {\n-    @Getter private final Object opaqueUser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d24267aeadf35624972e842ac7db815c2ffde59"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23acc07631b360437b62e01aa7fd2084b8d68b27", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/23acc07631b360437b62e01aa7fd2084b8d68b27", "committedDate": "2020-03-03T19:05:17Z", "message": "Initial version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55b9b4ef4740c9d99052174ca3b49e3d3fca2f84", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/55b9b4ef4740c9d99052174ca3b49e3d3fca2f84", "committedDate": "2020-03-03T19:05:18Z", "message": "All test pass except for spring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a5cbe59805e4e127a54d053903a3ce15a265789", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/7a5cbe59805e4e127a54d053903a3ce15a265789", "committedDate": "2020-03-03T19:06:34Z", "message": "Build passes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/69f64f25b0d65dbb9b7fa00ea229987c961ead54", "committedDate": "2020-03-03T19:06:35Z", "message": "Adding checkstyle comments for classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2c7898fdd7164ee17dcbd1c3ef9ffe775bfa9310", "author": {"user": {"login": "aklish", "name": "Aaron Klish"}}, "url": "https://github.com/yahoo/elide/commit/2c7898fdd7164ee17dcbd1c3ef9ffe775bfa9310", "committedDate": "2020-03-03T19:03:13Z", "message": "Merge branch 'elide-5.x' into SimplifyUserPrincipal"}, "afterCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/69f64f25b0d65dbb9b7fa00ea229987c961ead54", "committedDate": "2020-03-03T19:06:35Z", "message": "Adding checkstyle comments for classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTU4MzI0", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-368958324", "createdAt": "2020-03-04T17:02:57Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMjo1N1rOFx1wVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMjo1N1rOFx1wVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNTI3MA==", "bodyText": "@aklish Is this all that is left in RequestScope?", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387805270", "createdAt": "2020-03-04T17:02:57Z", "author": {"login": "wcekan"}, "path": "elide-annotations/src/main/java/com/yahoo/elide/security/RequestScope.java", "diffHunk": "@@ -1,16 +1,13 @@\n /*\n- * Copyright 2016, Yahoo Inc.\n+ * Copyright 2020, Yahoo Inc.\n  * Licensed under the Apache License, Version 2.0\n  * See LICENSE file in project root for terms.\n  */\n package com.yahoo.elide.security;\n \n-import java.util.Set;\n-\n /**\n  * The request scope interface passed to checks.\n  */\n public interface RequestScope {\n     User getUser();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTY1NDA5", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-368965409", "createdAt": "2020-03-04T17:12:43Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxMjo0M1rOFx2Frg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxMjo0M1rOFx2Frg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgxMDczNA==", "bodyText": "Should this be Principal?", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387810734", "createdAt": "2020-03-04T17:12:43Z", "author": {"login": "wcekan"}, "path": "elide-core/src/main/java/com/yahoo/elide/Elide.java", "diffHunk": "@@ -155,7 +155,7 @@ public void serialize(Object obj, JsonGenerator jsonGenerator,\n      * @param opaqueUser the opaque user\n      * @return Elide response object\n      */\n-    public ElideResponse get(String path, MultivaluedMap<String, String> queryParams, Object opaqueUser) {\n+    public ElideResponse get(String path, MultivaluedMap<String, String> queryParams, User opaqueUser) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTY2NTkw", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-368966590", "createdAt": "2020-03-04T17:14:20Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxNDoyMFrOFx2JVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxNDoyMFrOFx2JVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgxMTY3MA==", "bodyText": "@aklish We used this for hydrating the opaqueUser bean in the context of the current Hibernate transaction.\nHow will lifecycle work then without this?  The transaction is not created by us when we call Elide.", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387811670", "createdAt": "2020-03-04T17:14:20Z", "author": {"login": "wcekan"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/DataStoreTransaction.java", "diffHunk": "@@ -33,16 +32,6 @@\n         NONE\n     }\n \n-    /**\n-     * Wrap the opaque user.\n-     *\n-     * @param opaqueUser the opaque user\n-     * @return wrapped user context\n-     */\n-    default User accessUser(Object opaqueUser) {\n-        return new User(opaqueUser);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTY4NDQ4", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-368968448", "createdAt": "2020-03-04T17:16:51Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxNjo1MVrOFx2PEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxNjo1MVrOFx2PEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgxMzEzOA==", "bodyText": "User cannot be hydrated before the transaction is available.", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387813138", "createdAt": "2020-03-04T17:16:51Z", "author": {"login": "wcekan"}, "path": "elide-core/src/main/java/com/yahoo/elide/Elide.java", "diffHunk": "@@ -259,17 +259,16 @@ public HandlerResult visit(String path, RequestScope requestScope, BaseVisitor v\n      * Handle JSON API requests.\n      *\n      * @param isReadOnly if the transaction is read only\n-     * @param opaqueUser the user object from the container\n+     * @param user the user object from the container\n      * @param transaction a transaction supplier\n      * @param handler a function that creates the request scope and request handler\n      * @return the response\n      */\n-    protected ElideResponse handleRequest(boolean isReadOnly, Object opaqueUser,\n+    protected ElideResponse handleRequest(boolean isReadOnly, User user,\n                                           Supplier<DataStoreTransaction> transaction,\n                                           Handler<DataStoreTransaction, User, HandlerResult> handler) {\n         boolean isVerbose = false;\n         try (DataStoreTransaction tx = transaction.get()) {\n-            final User user = tx.accessUser(opaqueUser);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MDkxMTAz", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369091103", "createdAt": "2020-03-04T20:15:47Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxNTo0N1rOFx8JtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxNTo0N1rOFx8JtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxMDA2OQ==", "bodyText": "Will this work?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        final Object user = getUser().getPrincipal();\n          \n          \n            \n                        final Principal user = getUser().getPrincipal();", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387910069", "createdAt": "2020-03-04T20:15:47Z", "author": {"login": "jkusa"}, "path": "elide-core/src/main/java/com/yahoo/elide/audit/LogMessageImpl.java", "diffHunk": "@@ -125,7 +125,7 @@ public String getMessage() {\n                 singleElementContext.setVariable(name, singleElementExpression);\n             }\n \n-            final Object user = getUser().getOpaqueUser();\n+            final Object user = getUser().getPrincipal();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTAwODU4", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369100858", "createdAt": "2020-03-04T20:32:03Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMjowM1rOFx8nDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMjowM1rOFx8nDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxNzU4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    super(new Principal() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public String getName() {\n          \n          \n            \n                            return name;\n          \n          \n            \n                        }\n          \n          \n            \n                    });\n          \n          \n            \n                    super(() -> name);", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387917582", "createdAt": "2020-03-04T20:32:03Z", "author": {"login": "jkusa"}, "path": "elide-core/src/test/java/com/yahoo/elide/security/TestUser.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+\n+package com.yahoo.elide.security;\n+\n+import java.security.Principal;\n+\n+/**\n+ * Elide user for testing.\n+ */\n+public class TestUser extends User {\n+\n+    public TestUser(String name) {\n+        super(new Principal() {\n+            @Override\n+            public String getName() {\n+                return name;\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTAxNDQ1", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369101445", "createdAt": "2020-03-04T20:33:07Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMzowN1rOFx8o2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMzowN1rOFx8o2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxODA0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    goodUser = new User(new Principal() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public String getName() {\n          \n          \n            \n                            return \"1\";\n          \n          \n            \n                        }\n          \n          \n            \n                    });\n          \n          \n            \n                    goodUser = new User(() -> \"1\");", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387918041", "createdAt": "2020-03-04T20:33:07Z", "author": {"login": "jkusa"}, "path": "elide-datastore/elide-datastore-hibernate3/src/test/java/com/yahoo/elide/tests/DataStoreIT.java", "diffHunk": "@@ -61,6 +65,20 @@\n     private static final int ALL_BOOKS_COUNT = 3;\n \n     public DataStoreIT() {\n+        goodUser = new User(new Principal() {\n+            @Override\n+            public String getName() {\n+                return \"1\";\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTAxNzc5", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369101779", "createdAt": "2020-03-04T20:33:39Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMzozOVrOFx8p3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMzozOVrOFx8p3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxODMwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    badUser = new User(new Principal() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public String getName() {\n          \n          \n            \n                            return \"-1\";\n          \n          \n            \n                        }\n          \n          \n            \n                    });\n          \n          \n            \n                    badUser = new User(() -> \"-1\");", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387918303", "createdAt": "2020-03-04T20:33:39Z", "author": {"login": "jkusa"}, "path": "elide-datastore/elide-datastore-hibernate3/src/test/java/com/yahoo/elide/tests/DataStoreIT.java", "diffHunk": "@@ -61,6 +65,20 @@\n     private static final int ALL_BOOKS_COUNT = 3;\n \n     public DataStoreIT() {\n+        goodUser = new User(new Principal() {\n+            @Override\n+            public String getName() {\n+                return \"1\";\n+            }\n+        });\n+\n+        badUser = new User(new Principal() {\n+            @Override\n+            public String getName() {\n+                return \"-1\";\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTAyNDk2", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369102496", "createdAt": "2020-03-04T20:34:54Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozNDo1NVrOFx8r1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozNDo1NVrOFx8r1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxODgwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    goodUser = new User(new Principal() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public String getName() {\n          \n          \n            \n                            return \"1\";\n          \n          \n            \n                        }\n          \n          \n            \n                    });\n          \n          \n            \n            \n          \n          \n            \n                    badUser = new User(new Principal() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public String getName() {\n          \n          \n            \n                            return \"-1\";\n          \n          \n            \n                        }\n          \n          \n            \n                    });\n          \n          \n            \n                    goodUser = new User(() -> \"1\");\n          \n          \n            \n                    badUser = new User(() -> \"-1\");", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387918806", "createdAt": "2020-03-04T20:34:55Z", "author": {"login": "jkusa"}, "path": "elide-datastore/elide-datastore-hibernate5/src/test/java/com/yahoo/elide/tests/DataStoreIT.java", "diffHunk": "@@ -61,6 +65,19 @@\n     private static final int ALL_BOOKS_COUNT = 3;\n \n     public DataStoreIT() {\n+        goodUser = new User(new Principal() {\n+            @Override\n+            public String getName() {\n+                return \"1\";\n+            }\n+        });\n+\n+        badUser = new User(new Principal() {\n+            @Override\n+            public String getName() {\n+                return \"-1\";\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTAzOTM2", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369103936", "createdAt": "2020-03-04T20:37:13Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozNzoxNFrOFx8wOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozNzoxNFrOFx8wOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxOTkyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return new Principal() {\n          \n          \n            \n                                @Override\n          \n          \n            \n                                public String getName() {\n          \n          \n            \n                                    return \"1\";\n          \n          \n            \n                                }\n          \n          \n            \n                            };\n          \n          \n            \n                            return () -> \"1\";", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387919928", "createdAt": "2020-03-04T20:37:14Z", "author": {"login": "jkusa"}, "path": "elide-integration-tests/src/test/java/com/yahoo/elide/initialization/TestAuthFilter.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+\n+package com.yahoo.elide.initialization;\n+\n+import java.io.IOException;\n+import java.security.Principal;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerRequestFilter;\n+import javax.ws.rs.core.SecurityContext;\n+\n+/**\n+ * JAX-RS Filter that creates a test principal with ID 1.\n+ */\n+public class TestAuthFilter implements ContainerRequestFilter {\n+    @Override\n+    public void filter(ContainerRequestContext containerRequestContext) throws IOException {\n+        containerRequestContext.setSecurityContext(new SecurityContext() {\n+            @Override\n+            public Principal getUserPrincipal() {\n+                return new Principal() {\n+                    @Override\n+                    public String getName() {\n+                        return \"1\";\n+                    }\n+                };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTA0NDIz", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369104423", "createdAt": "2020-03-04T20:38:04Z", "commit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozODowNFrOFx8xtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozODowNFrOFx8xtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkyMDMwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    com.yahoo.elide.security.User user = new com.yahoo.elide.security.User(new Principal() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public String getName() {\n          \n          \n            \n                            return \"-1\";\n          \n          \n            \n                        }\n          \n          \n            \n                    });\n          \n          \n            \n                    com.yahoo.elide.security.User user = new com.yahoo.elide.security.User(() -> \"-1\");", "url": "https://github.com/yahoo/elide/pull/1206#discussion_r387920309", "createdAt": "2020-03-04T20:38:04Z", "author": {"login": "jkusa"}, "path": "elide-integration-tests/src/test/java/com/yahoo/elide/tests/ResourceIT.java", "diffHunk": "@@ -2475,7 +2476,14 @@ public void elideSecurityEnabled() {\n                 .withEntityDictionary(new EntityDictionary(TestCheckMappings.MAPPINGS))\n                 .withAuditLogger(new TestAuditLogger())\n                 .build());\n-        ElideResponse response = elide.get(\"parent/1/children\", new MultivaluedHashMap<>(), -1);\n+\n+        com.yahoo.elide.security.User user = new com.yahoo.elide.security.User(new Principal() {\n+            @Override\n+            public String getName() {\n+                return \"-1\";\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f64f25b0d65dbb9b7fa00ea229987c961ead54"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad47d3b43cb8af9e2e7778532b2173071f903fb1", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/ad47d3b43cb8af9e2e7778532b2173071f903fb1", "committedDate": "2020-03-04T21:20:14Z", "message": "Inspection comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "626614d9d37d7b403193e9417b20d3f116d4a959", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/626614d9d37d7b403193e9417b20d3f116d4a959", "committedDate": "2020-03-04T21:33:39Z", "message": "Fixed checkstyle issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTYyMTMy", "url": "https://github.com/yahoo/elide/pull/1206#pullrequestreview-369162132", "createdAt": "2020-03-04T22:11:43Z", "commit": {"oid": "626614d9d37d7b403193e9417b20d3f116d4a959"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 652, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}