{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MTk4NzQ2", "number": 1176, "title": "Added IsEmpty operation for filter predicate", "bodyText": "Resolves #1160\nDescription\nAdded IsEmpty Filter operation with syntax =isempty=.\nMotivation and Context\nisempty filter operation are useful in most cases and the community needed support for this operation.\nHow Has This Been Tested?\nAdded New Test Cases\nScreenshots (if appropriate):\nLicense\nI confirm that this contribution is made under an Apache 2.0 license and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-01-30T17:29:41Z", "url": "https://github.com/yahoo/elide/pull/1176", "merged": true, "mergeCommit": {"oid": "236ed8f9af121a2ebc32dcb9f40c47062c742f6e"}, "closed": true, "closedAt": "2020-02-15T18:46:04Z", "author": {"login": "Chandrasekar-Rajasekar"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_d7jPgH2gAyMzY5MTk4NzQ2OmE1NDZlNjg2ZmM4YWI1Mjc4MThhNjBhM2FlZjIzMWY1ZmRkZmNhYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEnVnMgH2gAyMzY5MTk4NzQ2OmI4MmJkYzNlYWI0ZWU0OTQxMDg5ODE3ODQ0OTUwMmU0MmUzNjkwZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/a546e686fc8ab527818a60a3aef231f5fddfcac6", "committedDate": "2020-01-30T17:24:27Z", "message": "Added IsEmpty operation for filter predicate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMTMwMzA2", "url": "https://github.com/yahoo/elide/pull/1176#pullrequestreview-351130306", "createdAt": "2020-01-30T20:47:15Z", "commit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDo0NzoxNVrOFj5Z7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDo1NjowMFrOFj5orw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE4NTAwNQ==", "bodyText": "copy pasted =isnull=. here should be =isempty=", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r373185005", "createdAt": "2020-01-30T20:47:15Z", "author": {"login": "PatRolland"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/filter/dialect/RSQLFilterDialect.java", "diffHunk": "@@ -368,5 +377,25 @@ private FilterExpression buildIsNullOperator(Path path, List<String> arguments)\n                 throw new RSQLParseException(String.format(\"Invalid value for operator =isnull= '%s'\", arg));\n             }\n         }\n+\n+        /**\n+         * Returns Predicate for '=isempty=' case depending on its arguments.\n+         * <p>\n+         * NOTE: Filter Expression builder specially for '=isnull=' case.\n+         *\n+         * @return\n+         */\n+        private FilterExpression buildIsEmptyOperator(Path path, List<String> arguments) {\n+            String arg = arguments.get(0);\n+            try {\n+                boolean wantsEmpty = CoerceUtil.coerce(arg, boolean.class);\n+                if (wantsEmpty) {\n+                    return new IsEmptyPredicate(path);\n+                }\n+                return new NotEmptyPredicate(path);\n+            } catch (InvalidValueException ignored) {\n+                throw new RSQLParseException(String.format(\"Invalid value for operator =isnull= '%s'\", arg));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE4ODM5NA==", "bodyText": "i feel like only collection and map should be handled here", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r373188394", "createdAt": "2020-01-30T20:55:07Z", "author": {"login": "PatRolland"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/filter/Operator.java", "diffHunk": "@@ -316,6 +334,24 @@ public static Operator fromString(final String string) {\n         return (T entity) -> false;\n     }\n \n+    private static <T> Predicate<T> isEmpty(String field, RequestScope requestScope) {\n+        return (T entity) -> {\n+            Object val = getFieldValue(entity, field, requestScope);\n+            if (val == null) { return true; }\n+            if (val instanceof String) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE4ODc4Mw==", "bodyText": "null and empty do not represent the same state imo", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r373188783", "createdAt": "2020-01-30T20:56:00Z", "author": {"login": "PatRolland"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/filter/Operator.java", "diffHunk": "@@ -316,6 +334,24 @@ public static Operator fromString(final String string) {\n         return (T entity) -> false;\n     }\n \n+    private static <T> Predicate<T> isEmpty(String field, RequestScope requestScope) {\n+        return (T entity) -> {\n+            Object val = getFieldValue(entity, field, requestScope);\n+            if (val == null) { return true; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d60d92da334d457ed84299e95934d54a9a778291", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/d60d92da334d457ed84299e95934d54a9a778291", "committedDate": "2020-01-30T21:32:53Z", "message": "small fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjM5OTM0", "url": "https://github.com/yahoo/elide/pull/1176#pullrequestreview-351239934", "createdAt": "2020-01-31T00:55:18Z", "commit": {"oid": "d60d92da334d457ed84299e95934d54a9a778291"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8104384443f7543f87b15a588e6db7e7d6f656a", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/c8104384443f7543f87b15a588e6db7e7d6f656a", "committedDate": "2020-02-02T22:20:30Z", "message": "Allow filter on ismany relationship for isempty operation. Add It test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e60b198d0fe3bc5d8ab1255841a071045737a42a", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/e60b198d0fe3bc5d8ab1255841a071045737a42a", "committedDate": "2020-02-02T23:57:58Z", "message": "Add @ElementCollection to attribute awards"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMzYzNjM3", "url": "https://github.com/yahoo/elide/pull/1176#pullrequestreview-352363637", "createdAt": "2020-02-03T15:58:29Z", "commit": {"oid": "e60b198d0fe3bc5d8ab1255841a071045737a42a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNTo1ODoyOVrOFk2fqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNTo1ODo0NFrOFk2gSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4NTg5Ng==", "bodyText": "@jkusa Any thoughts on this one?", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r374185896", "createdAt": "2020-02-03T15:58:29Z", "author": {"login": "aklish"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/filter/Operator.java", "diffHunk": "@@ -316,6 +334,24 @@ public static Operator fromString(final String string) {\n         return (T entity) -> false;\n     }\n \n+    private static <T> Predicate<T> isEmpty(String field, RequestScope requestScope) {\n+        return (T entity) -> {\n+            Object val = getFieldValue(entity, field, requestScope);\n+            if (val == null) { return true; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE4ODc4Mw=="}, "originalCommit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4NjA1Nw==", "bodyText": "@Chandrasekar-Rajasekar Let's remove the string case.", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r374186057", "createdAt": "2020-02-03T15:58:44Z", "author": {"login": "aklish"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/filter/Operator.java", "diffHunk": "@@ -316,6 +334,24 @@ public static Operator fromString(final String string) {\n         return (T entity) -> false;\n     }\n \n+    private static <T> Predicate<T> isEmpty(String field, RequestScope requestScope) {\n+        return (T entity) -> {\n+            Object val = getFieldValue(entity, field, requestScope);\n+            if (val == null) { return true; }\n+            if (val instanceof String) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE4ODM5NA=="}, "originalCommit": {"oid": "a546e686fc8ab527818a60a3aef231f5fddfcac6"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6ecc779495b00d19475ce7ed84d6f730aa3894e", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/f6ecc779495b00d19475ce7ed84d6f730aa3894e", "committedDate": "2020-02-05T22:11:03Z", "message": "remove string case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab1ba8ee8325d5e41c95a2edec297b6e7fdb4833", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/ab1ba8ee8325d5e41c95a2edec297b6e7fdb4833", "committedDate": "2020-02-05T22:26:53Z", "message": "exclude isnull check on attribute collection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MDk1NTk3", "url": "https://github.com/yahoo/elide/pull/1176#pullrequestreview-354095597", "createdAt": "2020-02-05T22:47:50Z", "commit": {"oid": "ab1ba8ee8325d5e41c95a2edec297b6e7fdb4833"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjo0Nzo1MFrOFmJ2jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjo0Nzo1MFrOFmJ2jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU1MTYyOQ==", "bodyText": "Looks like the fix for querying attribute collection on EMPTY operator is fixed in version 5.4.11. We are using 5.4.2.Final.\nOne option is we use where size(book.awards) = 0 as suggested in below link.\nOr we could continue using Empty operator and change the version to 5.4.11 when it gets released.\nhttps://hibernate.atlassian.net/browse/HHH-6686?attachmentOrder=asc&oldIssueView=true\nhttp://hibernate.org/orm/releases/5.4/", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r375551629", "createdAt": "2020-02-05T22:47:50Z", "author": {"login": "Chandrasekar-Rajasekar"}, "path": "elide-datastore/elide-datastore-hibernate5/pom.xml", "diffHunk": "@@ -37,6 +37,10 @@\n         <url>https://github.com/yahoo/elide.git</url>\n         <tag>HEAD</tag>\n     </scm>\n+    <properties>\n+        <excludeTags>emptyOnAttributeCollection</excludeTags>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab1ba8ee8325d5e41c95a2edec297b6e7fdb4833"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "665cd72c4d85d8f6da0a2e521673048b316ad412", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/665cd72c4d85d8f6da0a2e521673048b316ad412", "committedDate": "2020-02-06T05:35:41Z", "message": "skip query on attribute collection test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fa8c818d767f76203c69fd7c0577443f91b50db", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/0fa8c818d767f76203c69fd7c0577443f91b50db", "committedDate": "2020-02-06T22:55:08Z", "message": "exclude tags for jpa datastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d00db842297b4e32d281031417ab6f6dbb655c", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/97d00db842297b4e32d281031417ab6f6dbb655c", "committedDate": "2020-02-10T04:25:39Z", "message": "ieEmpty returns false if there is null association"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d7631b5bc21f857b8095eb4b2a4cf6524a66c33", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/4d7631b5bc21f857b8095eb4b2a4cf6524a66c33", "committedDate": "2020-02-11T23:34:03Z", "message": "Add exception if toMany association exist on the path and is not target collection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48041c0aba81d6b5bb9c2cffa3c11dab8c265154", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/48041c0aba81d6b5bb9c2cffa3c11dab8c265154", "committedDate": "2020-02-12T22:56:28Z", "message": "Add IT test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d827e846479045cdf9237bc841d5b00ccf8baa45", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/d827e846479045cdf9237bc841d5b00ccf8baa45", "committedDate": "2020-02-12T22:59:12Z", "message": "remove unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzU1MDkz", "url": "https://github.com/yahoo/elide/pull/1176#pullrequestreview-359355093", "createdAt": "2020-02-15T17:01:43Z", "commit": {"oid": "d827e846479045cdf9237bc841d5b00ccf8baa45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxNzowMTo0M1rOFqPxnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxNzowMTo0M1rOFqPxnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg0Mjk3Mw==", "bodyText": "typo", "url": "https://github.com/yahoo/elide/pull/1176#discussion_r379842973", "createdAt": "2020-02-15T17:01:43Z", "author": {"login": "aklish"}, "path": "elide-core/src/main/java/com/yahoo/elide/core/filter/IsEmptyPredicate.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright 2019, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.core.filter;\n+\n+import com.yahoo.elide.core.Path;\n+\n+import java.util.Collections;\n+\n+/**\n+ * Is EMopty Predicate Class.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d827e846479045cdf9237bc841d5b00ccf8baa45"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89a30de2edfdc66991826c25dbf2dbbf92079d8b", "author": {"user": {"login": "aklish", "name": "Aaron Klish"}}, "url": "https://github.com/yahoo/elide/commit/89a30de2edfdc66991826c25dbf2dbbf92079d8b", "committedDate": "2020-02-15T17:10:47Z", "message": "Fixing Typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzU1NTc3", "url": "https://github.com/yahoo/elide/pull/1176#pullrequestreview-359355577", "createdAt": "2020-02-15T17:11:30Z", "commit": {"oid": "89a30de2edfdc66991826c25dbf2dbbf92079d8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b82bdc3eab4ee49410898178449502e42e3690db", "author": {"user": {"login": "aklish", "name": "Aaron Klish"}}, "url": "https://github.com/yahoo/elide/commit/b82bdc3eab4ee49410898178449502e42e3690db", "committedDate": "2020-02-15T17:11:41Z", "message": "Merge branch 'master' into ISSUE-1160_add_isEmpty_filter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 633, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}