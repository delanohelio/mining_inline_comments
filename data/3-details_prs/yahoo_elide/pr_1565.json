{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NjQwMDc5", "number": 1565, "title": "Dynamic Config Inheritance", "bodyText": "Description\n\nIdentify Inheritance hierarchy in Dynamic config\nIdentify Dimensions & Measures to be overridden\n\nMotivation and Context\nHow Has This Been Tested?\nUnit test included\nScreenshots (if appropriate):\nLicense\nI confirm that this contribution is made under an Apache 2.0 license and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-09-30T16:39:31Z", "url": "https://github.com/yahoo/elide/pull/1565", "merged": true, "mergeCommit": {"oid": "365fae69570059dec7fba5f5fd601870ff8d4677"}, "closed": true, "closedAt": "2020-10-01T19:47:55Z", "author": {"login": "AvaniMakwana"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN_fy-AH2gAyNDk1NjQwMDc5OjM4N2MwNTU2Y2I1MjdlMDkxYzJkZDU1YTQzZTNiNzNmNzczYTdhYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOW01qAFqTUwMDY2Njk3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/387c0556cb527e091c2dd55a43e3b73f773a7aa8", "committedDate": "2020-09-30T16:37:00Z", "message": "override flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzA3MDc5", "url": "https://github.com/yahoo/elide/pull/1565#pullrequestreview-499707079", "createdAt": "2020-09-30T18:33:56Z", "commit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODozMzo1NlrOHaqX5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODozMzo1NlrOHaqX5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxOTI2OQ==", "bodyText": "Should we throw an error here?", "url": "https://github.com/yahoo/elide/pull/1565#discussion_r497719269", "createdAt": "2020-09-30T18:33:56Z", "author": {"login": "moizarafat"}, "path": "elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java", "diffHunk": "@@ -117,13 +117,78 @@ public void readAndValidateConfigs() throws IOException {\n         this.setDbVariables(readVariableConfig(Config.DBVARIABLE));\n         this.elideSQLDBConfig.setDbconfigs(readDbConfig());\n         this.elideTableConfig.setTables(readTableConfig());\n+        populateInheritanceHierarchy();\n         validateRequiredConfigsProvided();\n         validateNameUniqueness(this.elideSQLDBConfig.getDbconfigs());\n         validateNameUniqueness(this.elideTableConfig.getTables());\n         validateSqlInTableConfig(this.elideTableConfig);\n         validateJoinedTablesDBConnectionName(this.elideTableConfig);\n     }\n \n+    private void populateInheritanceHierarchy() {\n+        for (Table table : this.elideTableConfig.getTables()) {\n+            Set<Table> parentTables = getParents(table);\n+            if (parentTables.size() > 0) {\n+//                table.setInheritanceHierarchy(parentTables);\n+                flagMeasuresToOverride(table, parentTables);\n+                flagDimensionsToOverride(table, parentTables);\n+            }\n+        }\n+    }\n+\n+    private void flagMeasuresToOverride(Table table, Set<Table> parentTables) {\n+        Set<String> parentClassMeasures = new HashSet<>();\n+        parentTables.forEach(obj -> {\n+            obj.getMeasures().forEach(measure -> {\n+                parentClassMeasures.add(measure.getName());\n+            });\n+        });\n+\n+        for (Measure measure : table.getMeasures()) {\n+            if (parentClassMeasures.contains(measure.getName())) {\n+                measure.setOverride(true);\n+            }\n+        }\n+    }\n+\n+    private void flagDimensionsToOverride(Table table, Set<Table> parentTables) {\n+        Set<String> parentClassDimensions = new HashSet<>();\n+        parentTables.forEach(obj -> {\n+            obj.getDimensions().forEach(dimension -> {\n+                parentClassDimensions.add(dimension.getName());\n+            });\n+        });\n+\n+        for (Dimension dimension : table.getDimensions()) {\n+            if (parentClassDimensions.contains(dimension.getName())) {\n+                dimension.setOverride(true);\n+            }\n+        }\n+    }\n+\n+    private Set<Table> getParents(Table table) {\n+        Set<Table> parentTables = new HashSet<>();\n+        while (table != null && !table.getExtend().equals(\"\")) {\n+            Table parent = getTableByName(table.getExtend());\n+            parentTables.add(parent);\n+            table = parent;\n+        }\n+        return parentTables;\n+    }\n+\n+    private Table getTableByName(String tableName) {\n+        for (Table table : this.elideTableConfig.getTables()) {\n+            if (table.getName().equals(tableName)) {\n+                return table;\n+            }\n+            else {\n+                log.warn(\"Table \" + tableName + \" is not defined in Dynamic Config.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzA3NjQx", "url": "https://github.com/yahoo/elide/pull/1565#pullrequestreview-499707641", "createdAt": "2020-09-30T18:34:41Z", "commit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODozNDo0MVrOHaqZhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODozNDo0MVrOHaqZhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxOTY4NQ==", "bodyText": "Remove commented code.", "url": "https://github.com/yahoo/elide/pull/1565#discussion_r497719685", "createdAt": "2020-09-30T18:34:41Z", "author": {"login": "moizarafat"}, "path": "elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java", "diffHunk": "@@ -117,13 +117,78 @@ public void readAndValidateConfigs() throws IOException {\n         this.setDbVariables(readVariableConfig(Config.DBVARIABLE));\n         this.elideSQLDBConfig.setDbconfigs(readDbConfig());\n         this.elideTableConfig.setTables(readTableConfig());\n+        populateInheritanceHierarchy();\n         validateRequiredConfigsProvided();\n         validateNameUniqueness(this.elideSQLDBConfig.getDbconfigs());\n         validateNameUniqueness(this.elideTableConfig.getTables());\n         validateSqlInTableConfig(this.elideTableConfig);\n         validateJoinedTablesDBConnectionName(this.elideTableConfig);\n     }\n \n+    private void populateInheritanceHierarchy() {\n+        for (Table table : this.elideTableConfig.getTables()) {\n+            Set<Table> parentTables = getParents(table);\n+            if (parentTables.size() > 0) {\n+//                table.setInheritanceHierarchy(parentTables);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzIzOTk2", "url": "https://github.com/yahoo/elide/pull/1565#pullrequestreview-499723996", "createdAt": "2020-09-30T18:57:43Z", "commit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1Nzo0M1rOHarLuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1Nzo0M1rOHarLuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjUzOQ==", "bodyText": "I believe this will be reverted back", "url": "https://github.com/yahoo/elide/pull/1565#discussion_r497732539", "createdAt": "2020-09-30T18:57:43Z", "author": {"login": "moizarafat"}, "path": "elide-contrib/elide-dynamic-config-helpers/src/test/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHydratorTest.java", "diffHunk": "@@ -307,10 +307,14 @@\n     private HandlebarsHydrator hydrator;\n \n     @BeforeAll\n-    public void setup() throws IOException {\n+    public void setup() {\n         hydrator = new HandlebarsHydrator();\n         testClass = new DynamicConfigValidator(CONFIG_PATH);\n-        testClass.readAndValidateConfigs();\n+        try {\n+            testClass.readAndValidateConfigs();\n+        } catch (IOException e) {\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzI0MTc0", "url": "https://github.com/yahoo/elide/pull/1565#pullrequestreview-499724174", "createdAt": "2020-09-30T18:57:57Z", "commit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1Nzo1N1rOHarMUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1Nzo1N1rOHarMUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjY4OA==", "bodyText": "remove commented code.", "url": "https://github.com/yahoo/elide/pull/1565#discussion_r497732688", "createdAt": "2020-09-30T18:57:57Z", "author": {"login": "moizarafat"}, "path": "elide-contrib/elide-dynamic-config-helpers/src/test/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHydratorTest.java", "diffHunk": "@@ -332,6 +336,15 @@ public void testTableHydration() throws IOException {\n         assertEquals(VALID_TABLE_CLASS, tableClasses.get(VALID_TABLE_JAVA_NAME));\n     }\n \n+    @Test\n+    public void testChildTableHydration() throws IOException {\n+\n+        Map<String, String> tableClasses = hydrator.hydrateTableTemplate(testClass.getElideTableConfig());\n+\n+        assertTrue(tableClasses.keySet().contains(\"PlayerStatsChild\"));\n+//        assertEquals(VALID_TABLE_CLASS, tableClasses.get(\"PlayerStatsChild\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "387c0556cb527e091c2dd55a43e3b73f773a7aa8"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9809f4a595c071db9cb907328b4801b159ed6c59", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/9809f4a595c071db9cb907328b4801b159ed6c59", "committedDate": "2020-09-30T21:14:56Z", "message": "handlebar template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "315111679b4e42ffaf0639c494cb0f98de2f76ca", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/315111679b4e42ffaf0639c494cb0f98de2f76ca", "committedDate": "2020-10-01T03:52:00Z", "message": "handlebar updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5750dd6ebbdb0f1c21462545c94d2adeb96ad318", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/5750dd6ebbdb0f1c21462545c94d2adeb96ad318", "committedDate": "2020-10-01T04:13:35Z", "message": "remove sop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a74edb74ce9a190eed2f475dda8106557c1073af", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/a74edb74ce9a190eed2f475dda8106557c1073af", "committedDate": "2020-10-01T04:16:57Z", "message": "test override flg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "080d014a9d2a09a6e901a45d4e8d320c3bf27175", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/080d014a9d2a09a6e901a45d4e8d320c3bf27175", "committedDate": "2020-10-01T04:19:45Z", "message": "minor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42d6d7cd8664ae048d4fb39e1209cfb3d1320218", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/42d6d7cd8664ae048d4fb39e1209cfb3d1320218", "committedDate": "2020-10-01T17:11:09Z", "message": "update spring core version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNjY2OTc2", "url": "https://github.com/yahoo/elide/pull/1565#pullrequestreview-500666976", "createdAt": "2020-10-01T19:47:48Z", "commit": {"oid": "42d6d7cd8664ae048d4fb39e1209cfb3d1320218"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 839, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}