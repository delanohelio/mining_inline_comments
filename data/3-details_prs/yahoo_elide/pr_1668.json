{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNjY2NjE1", "number": 1668, "title": "Make Dynamic Compile work without shade plugin", "bodyText": "Description\nInMemoryCompiler can now locate jar and classes during compile time instead of relying on the Shade plugin.\nMotivation and Context\nFor dynamic compile to work we had to use the shade plugin. Though this was OK for standalone-example, for Spring we had to stop using spring-boot-maven-plugin. This might discourage some of our users who use Spring as the shade plugin will throw a lot of warnings.\nThe reason for using the shade plugin was that dynamic compile would not be able to read classes from jar files that are placed in the BOOT-INF location by Spring.\nHow Has This Been Tested?\nElide Spring and Standalone Example repos have been verified.\nLicense\nI confirm that this contribution is made under an Apache 2.0 license and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-11-17T19:50:44Z", "url": "https://github.com/yahoo/elide/pull/1668", "merged": true, "mergeCommit": {"oid": "4170b143cb04ee0ff0eabd30c6ba2097e505928c"}, "closed": true, "closedAt": "2020-11-18T23:13:28Z", "author": {"login": "moizarafat"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddfp45gBqjQwMDc0MDgzNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd2gZfAFqTUzMzk1NjQxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f3c1d5d8991944c65ec752a3da02bff707b93bb", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/0f3c1d5d8991944c65ec752a3da02bff707b93bb", "committedDate": "2020-11-17T19:43:26Z", "message": "initial commit"}, "afterCommit": {"oid": "8549e2cf99bf7381122f519a04473acbcadce63b", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/8549e2cf99bf7381122f519a04473acbcadce63b", "committedDate": "2020-11-17T20:32:33Z", "message": "Initial commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8549e2cf99bf7381122f519a04473acbcadce63b", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/8549e2cf99bf7381122f519a04473acbcadce63b", "committedDate": "2020-11-17T20:32:33Z", "message": "Initial commit"}, "afterCommit": {"oid": "51365f70f31b81e31fca8d2fe476fe24e33ac115", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/51365f70f31b81e31fca8d2fe476fe24e33ac115", "committedDate": "2020-11-17T20:38:12Z", "message": "Initial commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51365f70f31b81e31fca8d2fe476fe24e33ac115", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/51365f70f31b81e31fca8d2fe476fe24e33ac115", "committedDate": "2020-11-17T20:38:12Z", "message": "Initial commit"}, "afterCommit": {"oid": "06aa8d5c75e6c426be014b0a74694501ce591027", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/06aa8d5c75e6c426be014b0a74694501ce591027", "committedDate": "2020-11-17T20:40:01Z", "message": "Initial commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06aa8d5c75e6c426be014b0a74694501ce591027", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/06aa8d5c75e6c426be014b0a74694501ce591027", "committedDate": "2020-11-17T20:40:01Z", "message": "Initial commit"}, "afterCommit": {"oid": "954988e89bdd6d17b6c640d81148e564f30314ab", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/954988e89bdd6d17b6c640d81148e564f30314ab", "committedDate": "2020-11-17T20:41:17Z", "message": "Initial commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "954988e89bdd6d17b6c640d81148e564f30314ab", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/954988e89bdd6d17b6c640d81148e564f30314ab", "committedDate": "2020-11-17T20:41:17Z", "message": "Initial commit"}, "afterCommit": {"oid": "9b626fdae2fc82bd6dce562f4ef217183dc7a8f9", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/9b626fdae2fc82bd6dce562f4ef217183dc7a8f9", "committedDate": "2020-11-17T20:42:45Z", "message": "Initial commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b626fdae2fc82bd6dce562f4ef217183dc7a8f9", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/9b626fdae2fc82bd6dce562f4ef217183dc7a8f9", "committedDate": "2020-11-17T20:42:45Z", "message": "Initial commit"}, "afterCommit": {"oid": "d6ccdec84d2c34be74f32c7455897912ce7ebeb7", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/d6ccdec84d2c34be74f32c7455897912ce7ebeb7", "committedDate": "2020-11-17T21:54:57Z", "message": "Initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "committedDate": "2020-11-17T22:22:02Z", "message": "Initial commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6ccdec84d2c34be74f32c7455897912ce7ebeb7", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/d6ccdec84d2c34be74f32c7455897912ce7ebeb7", "committedDate": "2020-11-17T21:54:57Z", "message": "Initial commit"}, "afterCommit": {"oid": "43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "committedDate": "2020-11-17T22:22:02Z", "message": "Initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c88591001e7202cae0fa485868172ee3daf16d", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/27c88591001e7202cae0fa485868172ee3daf16d", "committedDate": "2020-11-18T20:12:10Z", "message": "Merge branch 'elide-5.x' into without_shade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb107f89dd8798d1847045a3824663ccdcabc13c", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/bb107f89dd8798d1847045a3824663ccdcabc13c", "committedDate": "2020-11-18T20:13:52Z", "message": "Update ElideDynamicEntityCompiler.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODQ4ODk3", "url": "https://github.com/yahoo/elide/pull/1668#pullrequestreview-533848897", "createdAt": "2020-11-18T20:28:31Z", "commit": {"oid": "bb107f89dd8798d1847045a3824663ccdcabc13c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDoyODozMVrOH2A4zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDoyODozMVrOH2A4zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5OTY5Mg==", "bodyText": "There are some strong recommendations to not use the context class loader and instead just this.class.getClassLoader instead:\nhttps://stackoverflow.com/questions/1771679/difference-between-threads-context-class-loader-and-normal-classloader#:~:text=The%20thread%20context%20classloader%20is,currentThread().", "url": "https://github.com/yahoo/elide/pull/1668#discussion_r526399692", "createdAt": "2020-11-18T20:28:31Z", "author": {"login": "aklish"}, "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -125,9 +125,24 @@ public ElideDynamicEntityCompiler(String path, DBPasswordExtractor dbPasswordExt\n             classNames.add(PACKAGE_NAME + entry.getKey());\n         }\n \n-        compiler.useParentClassLoader(\n-                new ElideDynamicInMemoryClassLoader(ClassLoader.getSystemClassLoader(),\n-                        Sets.newHashSet(classNames)));\n+        // Prepare classpath\n+        StringBuilder sb = new StringBuilder();\n+        Enumeration<URL> resources = Thread.currentThread().getContextClassLoader().getResources(\"/\");\n+        while (resources.hasMoreElements()) {\n+            URL url = resources.nextElement();\n+            String fileName = url.getFile();\n+            sb.append(fileName.substring(0, fileName.lastIndexOf(\"!\"))).append(File.pathSeparator);\n+        }\n+\n+        String classpath = sb.toString();\n+\n+        if (classpath != null && !classpath.equals(\"\")) {\n+            log.debug(\"Classpath = \" + classpath);\n+            compiler.useOptions(\"-classpath\", sb.toString());\n+        }\n+\n+        compiler.useParentClassLoader(Thread.currentThread().getContextClassLoader());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb107f89dd8798d1847045a3824663ccdcabc13c"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67792f9f3d663229572129068966ae03bccb0c8b", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/67792f9f3d663229572129068966ae03bccb0c8b", "committedDate": "2020-11-18T21:28:12Z", "message": "Review Comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTU2NDEy", "url": "https://github.com/yahoo/elide/pull/1668#pullrequestreview-533956412", "createdAt": "2020-11-18T23:11:18Z", "commit": {"oid": "67792f9f3d663229572129068966ae03bccb0c8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 779, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}