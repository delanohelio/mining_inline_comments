{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxOTYzMjkw", "number": 1259, "title": "Elide 5.x dynamic config standalone", "bodyText": "Authored-by: AvaniMakwana\nOne of the multiple PRs that will resolve #1178 (if appropriate)\nDescription\nEnable Dynamic Model Configuration for Elide-standalone\nMotivation and Context\nPlease refer #1178\nHow Has This Been Tested?\nUnit tests have been included.\nLicense\nI confirm that this contribution is made under an Apache 2.0 license and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-04-10T15:51:04Z", "url": "https://github.com/yahoo/elide/pull/1259", "merged": true, "mergeCommit": {"oid": "a2e1ef33de35f0ffe253d00adbdbecd0fa8b3867"}, "closed": true, "closedAt": "2020-05-26T19:15:44Z", "author": {"login": "AvaniMakwana"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYGLqZABqjMyMzgyOTMyMzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclJo-hgFqTQxODU5OTY2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08c36c670fe7296ab668c2aede95e9144cff2261", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/08c36c670fe7296ab668c2aede95e9144cff2261", "committedDate": "2020-04-16T05:37:19Z", "message": "codecy"}, "afterCommit": {"oid": "9ac9208e304f151664b6577c7d6f89654327d4d0", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/9ac9208e304f151664b6577c7d6f89654327d4d0", "committedDate": "2020-04-16T05:49:47Z", "message": "codecy issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MjE4OTg0", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398218984", "createdAt": "2020-04-22T13:57:54Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMzo1Nzo1NFrOGJ368w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMzo1Nzo1NFrOGJ368w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAwNjU3OQ==", "bodyText": "This line should be inside the if block at L-68, otherwise even when the dynamic config is disabled it will try to generate the Config POJOs.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413006579", "createdAt": "2020-04-22T13:57:54Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -53,28 +64,61 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n             options.put(\"javax.persistence.jdbc.password\", \"elide123\");\n         }\n \n-        PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n-                combineModelEntities(modelPackageName, includeAsyncModel), options);\n+        dynamicEntityCompiler = new ElideDynamicEntityCompiler(dynamicConfigPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MjUwNjY3", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398250667", "createdAt": "2020-04-22T14:29:19Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDoyOToxOVrOGJ5h3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDoyOToxOVrOGJ5h3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAzMjkyNg==", "bodyText": "These 3 sets of classes should not be binded to ElideDynamicEntityCompiler.bindClasses as they are not compiled through dynamic compiler. These 3 set of classes should be put in options as AvailableSettings.LOADED_CLASSES, <ClassScanner Scanned classes>  . Refer \n  \n    \n      elide/elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideDynamicConfiguration.java\n    \n    \n         Line 97\n      in\n      2d6436d\n    \n    \n    \n    \n\n        \n          \n           puiPropertyMap.put(AvailableSettings.LOADED_CLASSES, bindClasses);", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413032926", "createdAt": "2020-04-22T14:29:19Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -53,28 +64,61 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n             options.put(\"javax.persistence.jdbc.password\", \"elide123\");\n         }\n \n-        PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n-                combineModelEntities(modelPackageName, includeAsyncModel), options);\n+        dynamicEntityCompiler = new ElideDynamicEntityCompiler(dynamicConfigPath);\n+        if (includeDynamicModel) {\n+            dynamicEntityCompiler.compile();\n+            Collection<ClassLoader> classLoaders = new ArrayList<>();\n+            classLoaders.add(dynamicEntityCompiler.getClassLoader());\n+            options.put(AvailableSettings.CLASSLOADERS, classLoaders);\n+        }\n+        PersistenceUnitInfo persistenceUnitInfo = null;\n+        try {\n+\n+            ElideDynamicEntityCompiler.bindClasses = new HashSet<>();\n+            // add dynamic generated classes\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler, Entity.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler, FromTable.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler,\n+                    FromSubquery.class));\n+            // add classes\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(Entity.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzI5OTY2", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398329966", "createdAt": "2020-04-22T15:48:50Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo0ODo1MFrOGJ9paA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo0ODo1MFrOGJ9paA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEwMDM5Mg==", "bodyText": "We should probably not catch the exception and let the error propagate.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413100392", "createdAt": "2020-04-22T15:48:50Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -53,28 +64,61 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n             options.put(\"javax.persistence.jdbc.password\", \"elide123\");\n         }\n \n-        PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n-                combineModelEntities(modelPackageName, includeAsyncModel), options);\n+        dynamicEntityCompiler = new ElideDynamicEntityCompiler(dynamicConfigPath);\n+        if (includeDynamicModel) {\n+            dynamicEntityCompiler.compile();\n+            Collection<ClassLoader> classLoaders = new ArrayList<>();\n+            classLoaders.add(dynamicEntityCompiler.getClassLoader());\n+            options.put(AvailableSettings.CLASSLOADERS, classLoaders);\n+        }\n+        PersistenceUnitInfo persistenceUnitInfo = null;\n+        try {\n+\n+            ElideDynamicEntityCompiler.bindClasses = new HashSet<>();\n+            // add dynamic generated classes\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler, Entity.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler, FromTable.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler,\n+                    FromSubquery.class));\n+            // add classes\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(Entity.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(FromTable.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(FromSubquery.class));\n+\n+            persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n+                    combineModelEntities(dynamicEntityCompiler, modelPackageName,\n+                            includeAsyncModel, includeDynamicModel),\n+                    options,\n+                    dynamicEntityCompiler.getClassLoader());\n \n+        } catch (ClassNotFoundException e) {\n+            // TODO Auto-generated catch block\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzM3NDQ1", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398337445", "createdAt": "2020-04-22T15:57:01Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo1NzowMVrOGJ-CuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo1NzowMVrOGJ-CuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEwNjg3Mw==", "bodyText": "We dont need to do loadClass.getClass. Only loadClass is needed.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413106873", "createdAt": "2020-04-22T15:57:01Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -89,4 +133,39 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n                 .map(Class::getName)\n                 .collect(Collectors.toList());\n     }\n+\n+    /**\n+     * Find classes with a particular annotation from dynamic compiler.\n+     * @param compiler An instance of ElideDynamicEntityCompiler.\n+     * @param annotationClass Annotation to search for.\n+     * @return Set of Classes matching the annotation.\n+     * @throws ClassNotFoundException\n+     */\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static List<String> findAnnotatedClasses(ElideDynamicEntityCompiler compiler, Class annotationClass)\n+            throws ClassNotFoundException {\n+        List<String> annotatedClass = new ArrayList<String>();\n+        List<String> dynamicClasses = ElideDynamicEntityCompiler.classNames;\n+        for (String dynamicClass : dynamicClasses) {\n+            Class<?> classz = compiler.getClassLoader().loadClass(dynamicClass);\n+            if (classz.getAnnotation(annotationClass) != null) {\n+                annotatedClass.add(classz.getName());\n+            }\n+        }\n+        return annotatedClass;\n+    }\n+\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static Set<Class> populateBindClasses(ElideDynamicEntityCompiler compiler,\n+            Class annotationClass) throws ClassNotFoundException {\n+        Set<Class> bindClasses = new HashSet<>();\n+        List<String> dynamicClasses = ElideDynamicEntityCompiler.classNames;\n+        for (String dynamicClass : dynamicClasses) {\n+            Class<?> bindClass = compiler.getClassLoader().loadClass(dynamicClass).getClass();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 137}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzQxMzM4", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398341338", "createdAt": "2020-04-22T16:01:07Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjowMTowOFrOGJ-PWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjowMTowOFrOGJ-PWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzExMDEwNQ==", "bodyText": "annotatedClasses instead of annotatedClass", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413110105", "createdAt": "2020-04-22T16:01:08Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -89,4 +133,39 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n                 .map(Class::getName)\n                 .collect(Collectors.toList());\n     }\n+\n+    /**\n+     * Find classes with a particular annotation from dynamic compiler.\n+     * @param compiler An instance of ElideDynamicEntityCompiler.\n+     * @param annotationClass Annotation to search for.\n+     * @return Set of Classes matching the annotation.\n+     * @throws ClassNotFoundException\n+     */\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static List<String> findAnnotatedClasses(ElideDynamicEntityCompiler compiler, Class annotationClass)\n+            throws ClassNotFoundException {\n+        List<String> annotatedClass = new ArrayList<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 120}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzU3MTIw", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398357120", "createdAt": "2020-04-22T16:18:54Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjoxODo1NFrOGJ_D2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjoxODo1NFrOGJ_D2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEyMzU0NA==", "bodyText": "This is already defined as static in Util. We should reuse from there.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413123544", "createdAt": "2020-04-22T16:18:54Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -49,24 +51,36 @@\n \n     private static MetricRegistry metricRegistry = null;\n     private static HealthCheckRegistry healthCheckRegistry = null;\n+    private ElideDynamicEntityCompiler dynamicEntityCompiler = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzYxNjIx", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398361621", "createdAt": "2020-04-22T16:24:00Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjoyNDowMFrOGJ_S9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjoyNDowMFrOGJ_S9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEyNzQxMw==", "bodyText": "This piece of code is duplicated between Util.getEntityManager and here. Instead this could be a separate method in Util like initialize dynamic compiler which takes a boolean argument derived from enableDynamicModelConfig . And based on the boolean value and if dynamicEntityCompiler is null, dynamicEntityCompiler will be initialized and classes compiled.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413127413", "createdAt": "2020-04-22T16:24:00Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -49,24 +51,36 @@\n \n     private static MetricRegistry metricRegistry = null;\n     private static HealthCheckRegistry healthCheckRegistry = null;\n+    private ElideDynamicEntityCompiler dynamicEntityCompiler = null;\n \n     /**\n-     * Constructor\n+     * Constructor.\n      *\n-     * @param injector Injection instance for application\n+     * @param injector Injection instance for application.\n      */\n     @Inject\n     public ElideResourceConfig(ServiceLocator injector, @Context ServletContext servletContext) {\n         this.injector = injector;\n \n         settings = (ElideStandaloneSettings) servletContext.getAttribute(ELIDE_STANDALONE_SETTINGS_ATTR);\n \n+        dynamicEntityCompiler = new ElideDynamicEntityCompiler(settings.getDynamicConfigPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzY3NjQz", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398367643", "createdAt": "2020-04-22T16:30:58Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjozMDo1OFrOGJ_nqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjozMDo1OFrOGJ_nqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEzMjcxMg==", "bodyText": "lets have a singular name instead of with spaces. Just \"dynamic\" instead of \"dynamic model\";", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413132712", "createdAt": "2020-04-22T16:30:58Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -110,27 +124,45 @@ protected void configure() {\n \n         // Bind swaggers to given endpoint\n         register(new org.glassfish.hk2.utilities.binding.AbstractBinder() {\n+            @SuppressWarnings(\"rawtypes\")\n             @Override\n             protected void configure() {\n                 Map<String, Swagger> swaggerDocs = settings.enableSwagger();\n                 if (!swaggerDocs.isEmpty()) {\n                     // Include the async models in swagger docs\n-                    if(settings.enableAsync()) {\n-                        EntityDictionary dictionary = new EntityDictionary(new HashMap());\n+                    if (settings.enableAsync()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n                         dictionary.bindEntity(AsyncQuery.class);\n                         dictionary.bindEntity(AsyncQueryResult.class);\n-                         \n+\n                         Info info = new Info().title(\"Async Service\").version(\"1.0\");\n \n                         SwaggerBuilder builder = new SwaggerBuilder(dictionary, info);\n-                        \n+\n                         //Default value of getJsonApiPathSpec() ends with /* at the end. need to remove.\n                         String asyncBasePath = settings.getJsonApiPathSpec().replaceAll(\"/\\\\*\", \"\");\n \n                         Swagger swagger = builder.build().basePath(asyncBasePath);\n \n                         swaggerDocs.put(\"async\", swagger);\n                     }\n+                    // bind dynamic models\n+                    if (settings.enableDynamicModelConfig()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n+                        for (Class entity : dynamicEntityCompiler.getBindClasses()) {\n+                            dictionary.bindEntity(entity);\n+                        }\n+\n+                        Info info = new Info().title(\"Dynamic models Service\").version(\"1.0\");\n+                        SwaggerBuilder builder = new SwaggerBuilder(dictionary, info);\n+\n+                        //Default value of getJsonApiPathSpec() ends with /* at the end. need to remove.\n+                        String dynamicBasePath = settings.getJsonApiPathSpec().replaceAll(\"/\\\\*\", \"\");\n+\n+                        Swagger swagger = builder.build().basePath(dynamicBasePath);\n+\n+                        swaggerDocs.put(\"dynamic model\", swagger);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzY4MzU3", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398368357", "createdAt": "2020-04-22T16:31:47Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjozMTo0N1rOGJ_qQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjozMTo0N1rOGJ_qQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEzMzM3Ng==", "bodyText": "Since this is logic is same between both blocks, we can get it out in a separate common variable.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413133376", "createdAt": "2020-04-22T16:31:47Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -110,27 +124,45 @@ protected void configure() {\n \n         // Bind swaggers to given endpoint\n         register(new org.glassfish.hk2.utilities.binding.AbstractBinder() {\n+            @SuppressWarnings(\"rawtypes\")\n             @Override\n             protected void configure() {\n                 Map<String, Swagger> swaggerDocs = settings.enableSwagger();\n                 if (!swaggerDocs.isEmpty()) {\n                     // Include the async models in swagger docs\n-                    if(settings.enableAsync()) {\n-                        EntityDictionary dictionary = new EntityDictionary(new HashMap());\n+                    if (settings.enableAsync()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n                         dictionary.bindEntity(AsyncQuery.class);\n                         dictionary.bindEntity(AsyncQueryResult.class);\n-                         \n+\n                         Info info = new Info().title(\"Async Service\").version(\"1.0\");\n \n                         SwaggerBuilder builder = new SwaggerBuilder(dictionary, info);\n-                        \n+\n                         //Default value of getJsonApiPathSpec() ends with /* at the end. need to remove.\n                         String asyncBasePath = settings.getJsonApiPathSpec().replaceAll(\"/\\\\*\", \"\");\n \n                         Swagger swagger = builder.build().basePath(asyncBasePath);\n \n                         swaggerDocs.put(\"async\", swagger);\n                     }\n+                    // bind dynamic models\n+                    if (settings.enableDynamicModelConfig()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n+                        for (Class entity : dynamicEntityCompiler.getBindClasses()) {\n+                            dictionary.bindEntity(entity);\n+                        }\n+\n+                        Info info = new Info().title(\"Dynamic models Service\").version(\"1.0\");\n+                        SwaggerBuilder builder = new SwaggerBuilder(dictionary, info);\n+\n+                        //Default value of getJsonApiPathSpec() ends with /* at the end. need to remove.\n+                        String dynamicBasePath = settings.getJsonApiPathSpec().replaceAll(\"/\\\\*\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 126}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDAyOTg5", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398402989", "createdAt": "2020-04-22T17:12:42Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxMjo0MlrOGKBkSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxMjo0MlrOGKBkSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NDYxOQ==", "bodyText": "This method is not used anywhere. we should remove it.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413164619", "createdAt": "2020-04-22T17:12:42Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/dynamic/config/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.standalone.dynamic.config;\n+\n+import com.yahoo.elide.contrib.dynamicconfighelpers.model.ElideSecurityConfig;\n+import com.yahoo.elide.contrib.dynamicconfighelpers.model.ElideTableConfig;\n+import com.yahoo.elide.contrib.dynamicconfighelpers.parser.ElideConfigParser;\n+import com.yahoo.elide.contrib.dynamicconfighelpers.parser.handlebars.HandlebarsHydrator;\n+\n+import com.google.common.collect.Sets;\n+import org.mdkt.compiler.InMemoryJavaCompiler;\n+\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+\n+/**\n+ * Elide Dynamic entity compiler.\n+ */\n+@Slf4j\n+public class ElideDynamicEntityCompiler {\n+\n+    @SuppressWarnings(\"rawtypes\")\n+    public static Set<Class> bindClasses;\n+    public static final String PACKAGE_NAME = \"com.yahoo.elide.contrib.dynamicconfig.model.\";\n+    public static List<String> classNames = new ArrayList<String>();\n+\n+    private static InMemoryJavaCompiler inMemoryJavaCompiler = InMemoryJavaCompiler.newInstance();\n+    private static ElideConfigParser elideConfigParser = new ElideConfigParser();\n+    private static Map<String, Class<?>> compiledObjects;\n+\n+    private Map<String, String> tableClasses = new HashMap<String, String>();\n+    private Map<String, String> securityClasses = new HashMap<String, String>();\n+\n+    /**\n+     * generate java classes from dynamic config.\n+     * @param path to hjson config\n+     */\n+    public ElideDynamicEntityCompiler(String path) {\n+        try {\n+            elideConfigParser.parseConfigPath(path);\n+\n+            ElideTableConfig tableConfig = elideConfigParser.getElideTableConfig();\n+            ElideSecurityConfig securityConfig = elideConfigParser.getElideSecurityConfig();\n+            HandlebarsHydrator handlebarHydrator = new HandlebarsHydrator();\n+\n+            tableClasses = handlebarHydrator.hydrateTableTemplate(tableConfig);\n+            securityClasses = handlebarHydrator.hydrateSecurityTemplate(securityConfig);\n+\n+            for (Entry<String, String> entry : tableClasses.entrySet()) {\n+                classNames.add(PACKAGE_NAME + entry.getKey());\n+            }\n+\n+            for (Entry<String, String> entry : securityClasses.entrySet()) {\n+                classNames.add(PACKAGE_NAME + entry.getKey());\n+            }\n+\n+            inMemoryJavaCompiler.useParentClassLoader(\n+                    new ElideDynamicInMemoryClassLoader(ClassLoader.getSystemClassLoader(),\n+                            Sets.newHashSet(classNames)));\n+\n+        } catch (Exception e) {\n+            log.error(\"Unable to read Dynamic Configuration \" + e.getMessage());\n+        }\n+\n+    }\n+\n+    /**\n+     * compile dynamic classes in-memory.\n+     */\n+    public void compile() {\n+\n+        try {\n+            for (Map.Entry<String, String> tablePojo : tableClasses.entrySet()) {\n+                log.info(\"key: \" + PACKAGE_NAME + tablePojo.getKey() + \", value: \" + tablePojo.getValue());\n+                inMemoryJavaCompiler.addSource(PACKAGE_NAME + tablePojo.getKey(), tablePojo.getValue());\n+            }\n+\n+            for (Map.Entry<String, String> secPojo : securityClasses.entrySet()) {\n+                log.info(\"key: \" + PACKAGE_NAME +  secPojo.getKey() + \", value: \" + secPojo.getValue());\n+                inMemoryJavaCompiler.addSource(PACKAGE_NAME + secPojo.getKey(), secPojo.getValue());\n+            }\n+            compiledObjects = inMemoryJavaCompiler.compileAll();\n+        } catch (Exception e) {\n+            log.error(\"Unable to compile dynamic classes\");\n+        }\n+    }\n+\n+    /**\n+     * getter for classLoader.\n+     * @return ClassLoader\n+     */\n+    public ClassLoader getClassLoader() {\n+        return inMemoryJavaCompiler.getClassloader();\n+    }\n+\n+    /**\n+     * getter for compiled dynamic class.\n+     * @param name - class name\n+     * @return compiled class\n+     */\n+    public Class<?> getCompiled(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 110}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDA0NTcz", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398404573", "createdAt": "2020-04-22T17:14:37Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxNDozN1rOGKBpzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxNDozN1rOGKBpzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NjAzMQ==", "bodyText": "Please check the spring PR. I think we were able to successfully add it there. I think it should be like this 2020-01-01T00:00Z", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413166031", "createdAt": "2020-04-22T17:14:37Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/test/java/com/yahoo/elide/standalone/ElideStandaloneTest.java", "diffHunk": "@@ -89,79 +102,122 @@ public void shutdown() throws Exception {\n         elide.stop();\n     }\n \n+    @Test\n+    public void testJsonAPIPlayer() {\n+        given()\n+        .contentType(JSONAPI_CONTENT_TYPE)\n+        .accept(JSONAPI_CONTENT_TYPE)\n+        .body(\n+                datum(\n+                        resource(\n+                                type(\"player\"),\n+                                id(\"ready-player-1\"),\n+                                attributes(\n+                                        attr(\"name\", \"player1\"),\n+                                        attr(\"countryCode\", \"USA\"),\n+                                        attr(\"playerCountry\", \"USA\"),\n+                                        attr(\"highScore\", 100)\n+                                        //                        attr(\"createdOn\", \"2020-01-01\"); still need to be tested with date", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDA1MDU2", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398405056", "createdAt": "2020-04-22T17:15:12Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4Nzc1MzEz", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398775313", "createdAt": "2020-04-23T05:46:32Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo0NjozMlrOGKXnjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo0NjozMlrOGKXnjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUyNTkwMA==", "bodyText": "We can rename this to findAnnotatedClasses.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413525900", "createdAt": "2020-04-23T05:46:32Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -89,4 +133,39 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n                 .map(Class::getName)\n                 .collect(Collectors.toList());\n     }\n+\n+    /**\n+     * Find classes with a particular annotation from dynamic compiler.\n+     * @param compiler An instance of ElideDynamicEntityCompiler.\n+     * @param annotationClass Annotation to search for.\n+     * @return Set of Classes matching the annotation.\n+     * @throws ClassNotFoundException\n+     */\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static List<String> findAnnotatedClasses(ElideDynamicEntityCompiler compiler, Class annotationClass)\n+            throws ClassNotFoundException {\n+        List<String> annotatedClass = new ArrayList<String>();\n+        List<String> dynamicClasses = ElideDynamicEntityCompiler.classNames;\n+        for (String dynamicClass : dynamicClasses) {\n+            Class<?> classz = compiler.getClassLoader().loadClass(dynamicClass);\n+            if (classz.getAnnotation(annotationClass) != null) {\n+                annotatedClass.add(classz.getName());\n+            }\n+        }\n+        return annotatedClass;\n+    }\n+\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static Set<Class> populateBindClasses(ElideDynamicEntityCompiler compiler,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 132}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4Nzc2Nzc0", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398776774", "createdAt": "2020-04-23T05:50:27Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo1MDoyN1rOGKXtDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo1MDoyN1rOGKXtDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUyNzMxMQ==", "bodyText": "We need to add classes of type FromTable, FromSubQuery", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413527311", "createdAt": "2020-04-23T05:50:27Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -53,28 +64,61 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n             options.put(\"javax.persistence.jdbc.password\", \"elide123\");\n         }\n \n-        PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n-                combineModelEntities(modelPackageName, includeAsyncModel), options);\n+        dynamicEntityCompiler = new ElideDynamicEntityCompiler(dynamicConfigPath);\n+        if (includeDynamicModel) {\n+            dynamicEntityCompiler.compile();\n+            Collection<ClassLoader> classLoaders = new ArrayList<>();\n+            classLoaders.add(dynamicEntityCompiler.getClassLoader());\n+            options.put(AvailableSettings.CLASSLOADERS, classLoaders);\n+        }\n+        PersistenceUnitInfo persistenceUnitInfo = null;\n+        try {\n+\n+            ElideDynamicEntityCompiler.bindClasses = new HashSet<>();\n+            // add dynamic generated classes\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler, Entity.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler, FromTable.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(populateBindClasses(dynamicEntityCompiler,\n+                    FromSubquery.class));\n+            // add classes\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(Entity.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(FromTable.class));\n+            ElideDynamicEntityCompiler.bindClasses.addAll(ClassScanner.getAnnotatedClasses(FromSubquery.class));\n+\n+            persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n+                    combineModelEntities(dynamicEntityCompiler, modelPackageName,\n+                            includeAsyncModel, includeDynamicModel),\n+                    options,\n+                    dynamicEntityCompiler.getClassLoader());\n \n+        } catch (ClassNotFoundException e) {\n+            // TODO Auto-generated catch block\n+            e.printStackTrace();\n+        }\n         return new EntityManagerFactoryBuilderImpl(\n-                new PersistenceUnitInfoDescriptor(persistenceUnitInfo), new HashMap<>())\n+                new PersistenceUnitInfoDescriptor(persistenceUnitInfo), new HashMap<>(),\n+                dynamicEntityCompiler.getClassLoader())\n                 .build();\n     }\n \n     /**\n-     * Combine the model entities with Async model.\n+     * Combine the model entities with Async  and Dynamic models.\n      *\n      * @param modelPackageName Package name\n      * @param includeAsyncModel Include Async model package Name\n+     * @param includeDynamicModel Include Dynamic model package Name\n      * @return All entities combined from both package.\n+     * @throws ClassNotFoundException\n      */\n-    public static List<String> combineModelEntities(String modelPackageName, boolean includeAsyncModel) {\n-\n+    public static List<String> combineModelEntities(ElideDynamicEntityCompiler compiler, String modelPackageName,\n+            boolean includeAsyncModel, boolean includeDynamicModel) throws ClassNotFoundException {\n         List<String> modelEntities = getAllEntities(modelPackageName);\n-\n         if (includeAsyncModel) {\n             modelEntities.addAll(getAllEntities(AsyncQuery.class.getPackage().getName()));\n         }\n+        if (includeDynamicModel) {\n+            modelEntities.addAll(findAnnotatedClasses(compiler, Entity.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4Nzc3MTAx", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-398777101", "createdAt": "2020-04-23T05:51:14Z", "commit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo1MToxNVrOGKXukw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo1MToxNVrOGKXukw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUyNzY5OQ==", "bodyText": "we can call this findAnnotatedClassNames.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r413527699", "createdAt": "2020-04-23T05:51:15Z", "author": {"login": "moizarafat"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -89,4 +133,39 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n                 .map(Class::getName)\n                 .collect(Collectors.toList());\n     }\n+\n+    /**\n+     * Find classes with a particular annotation from dynamic compiler.\n+     * @param compiler An instance of ElideDynamicEntityCompiler.\n+     * @param annotationClass Annotation to search for.\n+     * @return Set of Classes matching the annotation.\n+     * @throws ClassNotFoundException\n+     */\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static List<String> findAnnotatedClasses(ElideDynamicEntityCompiler compiler, Class annotationClass)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f2d7baa15219e3f815e0f2125b5ccd6c5c58"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDkxNjEx", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-409491611", "createdAt": "2020-05-11T20:07:45Z", "commit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMDowNzo0NVrOGTrfTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMToyMTozOFrOGTt2rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4ODY1Mg==", "bodyText": "Remove optional=true", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423288652", "createdAt": "2020-05-11T20:07:45Z", "author": {"login": "aklish"}, "path": "elide-standalone/pom.xml", "diffHunk": "@@ -78,6 +83,12 @@\n             <artifactId>elide-async</artifactId>\n             <version>5.0.0-pr7-SNAPSHOT</version>\n         </dependency>\n+        <dependency>\n+            <groupId>com.yahoo.elide</groupId>\n+            <artifactId>elide-dynamic-config-helpers</artifactId>\n+            <version>5.0.0-pr7-SNAPSHOT</version>\n+            <optional>true</optional>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MzkyNw==", "bodyText": "I'm confused by this test.  In all the other places, player stats is an aggregation model - not something you can create - but only something you can run analytic queries against.  I would expect the aggregation store test would look like a GET query against this model.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423293927", "createdAt": "2020-05-11T20:17:57Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/java/com/yahoo/elide/standalone/ElideStandaloneTest.java", "diffHunk": "@@ -89,6 +104,30 @@ public void shutdown() throws Exception {\n         elide.stop();\n     }\n \n+    @Test\n+    public void testJsonAPIPlayerStats() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDM0NQ==", "bodyText": "I don't understand why we are testing create here.  In fact, I would expect create to fail - not succeed.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423294345", "createdAt": "2020-05-11T20:18:47Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/java/com/yahoo/elide/standalone/ElideStandaloneTest.java", "diffHunk": "@@ -139,29 +178,88 @@ public void testForbiddenJsonAPIPost() {\n     @Test\n     public void testMetricsServlet() throws Exception {\n         given()\n-                .when()\n-                .get(\"/stats/metrics\")\n-                .then()\n-                .statusCode(200)\n-                .body(\"meters\", hasKey(\"com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok\"));\n+            .when()\n+            .get(\"/stats/metrics\")\n+            .then()\n+            .statusCode(200)\n+            .body(\"meters\", hasKey(\"com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok\"));\n     }\n \n     @Test\n     public void testHealthCheckServlet() throws Exception {\n-            given()\n-                .when()\n-                .get(\"/stats/healthcheck\")\n-                .then()\n-                .statusCode(501); //Returns 'Not Implemented' if there are no Health Checks Registered\n+        given()\n+            .when()\n+            .get(\"/stats/healthcheck\")\n+            .then()\n+            .statusCode(501); //Returns 'Not Implemented' if there are no Health Checks Registered\n     }\n \n     @Test\n     public void testSwaggerEndpoint() throws Exception {\n         given()\n-                .when()\n-                .get(\"/swagger/doc/test\")\n-                .then()\n-                .statusCode(200);\n+            .when()\n+            .get(\"/swagger/doc/test\")\n+            .then()\n+            .statusCode(200);\n+    }\n+\n+    @Test\n+    public void testAggregationTableEndpoint() throws Exception {\n+        given()\n+           .when()\n+           .get(\"/api/v1/table\")\n+           .then()\n+           .statusCode(200);\n+    }\n+\n+    @Test\n+    public void testTimeDimensionEndpoint() throws Exception {\n+        given()\n+            .when()\n+            .get(\"/api/v1/timeDimension\")\n+            .then()\n+            .statusCode(200);\n+    }\n+\n+    @Test\n+    public void testPlayerEndpoint() throws Exception {\n+        given()\n+            .when()\n+            .get(\"/api/v1/Player\")\n+            .then()\n+            .statusCode(200);\n     }\n-}\n \n+    @Test\n+    public void testJsonApiGetPlayer() {\n+        //Prep with data load\n+        given()\n+            .contentType(JSONAPI_CONTENT_TYPE)\n+            .accept(JSONAPI_CONTENT_TYPE)\n+            .body(\n+                datum(\n+                    resource(\n+                        type(\"playerStats\"),\n+                        id(\"ready-player-2\"),\n+                        attributes(\n+                            attr(\"countryId\", \"1\"),\n+                            attr(\"score\", 100),\n+                            attr(\"createdOn\", \"2020-01-01T00:00Z\")\n+                        )\n+                    )\n+                )\n+            )\n+            .post(\"/api/v1/playerStats\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 184}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDg5Ng==", "bodyText": "This test looks duplicated with the one earlier - and is listed as GET (even though it does a POST).  I'm not sure what we are trying to test here.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423294896", "createdAt": "2020-05-11T20:19:39Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/java/com/yahoo/elide/standalone/ElideStandaloneTest.java", "diffHunk": "@@ -139,29 +178,88 @@ public void testForbiddenJsonAPIPost() {\n     @Test\n     public void testMetricsServlet() throws Exception {\n         given()\n-                .when()\n-                .get(\"/stats/metrics\")\n-                .then()\n-                .statusCode(200)\n-                .body(\"meters\", hasKey(\"com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok\"));\n+            .when()\n+            .get(\"/stats/metrics\")\n+            .then()\n+            .statusCode(200)\n+            .body(\"meters\", hasKey(\"com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok\"));\n     }\n \n     @Test\n     public void testHealthCheckServlet() throws Exception {\n-            given()\n-                .when()\n-                .get(\"/stats/healthcheck\")\n-                .then()\n-                .statusCode(501); //Returns 'Not Implemented' if there are no Health Checks Registered\n+        given()\n+            .when()\n+            .get(\"/stats/healthcheck\")\n+            .then()\n+            .statusCode(501); //Returns 'Not Implemented' if there are no Health Checks Registered\n     }\n \n     @Test\n     public void testSwaggerEndpoint() throws Exception {\n         given()\n-                .when()\n-                .get(\"/swagger/doc/test\")\n-                .then()\n-                .statusCode(200);\n+            .when()\n+            .get(\"/swagger/doc/test\")\n+            .then()\n+            .statusCode(200);\n+    }\n+\n+    @Test\n+    public void testAggregationTableEndpoint() throws Exception {\n+        given()\n+           .when()\n+           .get(\"/api/v1/table\")\n+           .then()\n+           .statusCode(200);\n+    }\n+\n+    @Test\n+    public void testTimeDimensionEndpoint() throws Exception {\n+        given()\n+            .when()\n+            .get(\"/api/v1/timeDimension\")\n+            .then()\n+            .statusCode(200);\n+    }\n+\n+    @Test\n+    public void testPlayerEndpoint() throws Exception {\n+        given()\n+            .when()\n+            .get(\"/api/v1/Player\")\n+            .then()\n+            .statusCode(200);\n     }\n-}\n \n+    @Test\n+    public void testJsonApiGetPlayer() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NTA4Nw==", "bodyText": "Do we even need this file?", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423295087", "createdAt": "2020-05-11T20:19:59Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/resources/models/variables.hjson", "diffHunk": "@@ -0,0 +1,5 @@\n+{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NTczMQ==", "bodyText": "We should only include the minimum config needed to support the tests.  Given that we don't test security, we can exclude this file.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423295731", "createdAt": "2020-05-11T20:21:13Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/resources/models/security.hjson", "diffHunk": "@@ -0,0 +1,18 @@\n+{\n+    roles : [\n+        admin", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NjQ4NQ==", "bodyText": "Instead of java config - can we do an HJSON config here?", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423296485", "createdAt": "2020-05-11T20:22:44Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/java/com/yahoo/elide/standalone/models/PlayerStats.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+\n+package com.yahoo.elide.standalone.models;\n+\n+import com.yahoo.elide.annotation.DeletePermission;\n+import com.yahoo.elide.annotation.Include;\n+import com.yahoo.elide.annotation.ReadPermission;\n+import com.yahoo.elide.annotation.UpdatePermission;\n+import com.yahoo.elide.datastores.aggregation.annotation.Cardinality;\n+import com.yahoo.elide.datastores.aggregation.annotation.CardinalitySize;\n+\n+import lombok.Data;\n+import lombok.EqualsAndHashCode;\n+import lombok.ToString;\n+\n+import java.util.Date;\n+\n+import javax.persistence.Entity;\n+import javax.persistence.Id;\n+\n+\n+/**\n+ * A root level entity for testing AggregationDataStore.\n+ */\n+@Include(rootLevel = true , type = \"playerStats\")\n+@Cardinality(size = CardinalitySize.LARGE)\n+@EqualsAndHashCode\n+@ToString\n+@Data\n+@Entity\n+@ReadPermission(expression = \"Prefab.Role.All\")\n+@UpdatePermission(expression = \"Prefab.Role.None\")\n+@DeletePermission(expression = \"Prefab.Role.None\")\n+public class PlayerStats {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5Njk2Nw==", "bodyText": "Use File.Separator - not \"/\"", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423296967", "createdAt": "2020-05-11T20:23:39Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideStandaloneSettings.java", "diffHunk": "@@ -167,7 +203,24 @@ default boolean enableJSONAPI() {\n     default boolean enableGraphQL() {\n         return true;\n     }\n-    \n+\n+    /**\n+     * Enable the support for Dynamic Model Configuration. If false, the feature will be disabled.\n+     *\n+     * @return Default: False\n+     */\n+    default boolean enableDynamicModelConfig() {\n+        return false;\n+    }\n+\n+    /**\n+     * Base path to Hjson dynamic model configurations.\n+     * @return Default: /models/\n+     */\n+    default String getDynamicConfigPath() {\n+        return \"/models/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NzU4NQ==", "bodyText": "What Exception are we expecting here?  In general, Exception should almost never be thrown or caught (except in tests and uncaught exception handlers).", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423297585", "createdAt": "2020-05-11T20:24:50Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideStandaloneSettings.java", "diffHunk": "@@ -60,14 +68,9 @@\n      *\n      * @param injector Service locator for web service for dependency injection.\n      * @return Configured ElideSettings object.\n+     * @throws Exception Exception thrown.\n      */\n-    default ElideSettings getElideSettings(ServiceLocator injector) {\n-        EntityManagerFactory entityManagerFactory = Util.getEntityManagerFactory(getModelPackageName(),\n-                enableAsync(), getDatabaseProperties());\n-        DataStore dataStore = new JpaDataStore(\n-                () -> { return entityManagerFactory.createEntityManager(); },\n-                (em -> { return new NonJtaTransaction(em); }));\n-\n+    default ElideSettings getElideSettings(ServiceLocator injector) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5OTY0MQ==", "bodyText": "The initialization of standalone needs to be broken up into different pieces - similar to the Elide spring beans.\nThere should be a configuration for getting the DataStore.  This function should not be creating and managing stores - but just setting up the ElideSettings object.  Let's break this apart so it is more extensible by someone - and simpler to grock.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423299641", "createdAt": "2020-05-11T20:28:28Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideStandaloneSettings.java", "diffHunk": "@@ -83,6 +86,39 @@ public void inject(Object entity) {\n \n         dictionary.scanForSecurityChecks();\n \n+        EntityManagerFactory entityManagerFactory = Util.getEntityManagerFactory(getModelPackageName(),\n+                enableAsync(), enableDynamicModelConfig(), getDynamicConfigPath(), getDatabaseProperties());\n+\n+        MetaDataStore metaDataStore = null;\n+\n+        if (enableDynamicModelConfig()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMwMDY3MQ==", "bodyText": "We should avoid static variables like this - They are hard to test.  This should be created during initialization and passed into constructors as needed.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423300671", "createdAt": "2020-05-11T20:30:19Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -24,8 +32,10 @@\n  */\n public class Util {\n \n-    public static EntityManagerFactory getEntityManagerFactory(String modelPackageName, boolean includeAsyncModel, \n-            Properties options) {\n+    public static ElideDynamicEntityCompiler dynamicEntityCompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMwMTMzOQ==", "bodyText": "Remove static initialization functions - this suggests we should be using a constructor somewhere else instead.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423301339", "createdAt": "2020-05-11T20:31:26Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -51,30 +61,66 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n             options.put(\"javax.persistence.jdbc.url\", \"jdbc:mysql://localhost/elide?serverTimezone=UTC\");\n             options.put(\"javax.persistence.jdbc.user\", \"elide\");\n             options.put(\"javax.persistence.jdbc.password\", \"elide123\");\n+\n+            //Bind entity classes from classpath to Persistence Unit\n+            ArrayList<Class> loadedClasses = new ArrayList<>();\n+            loadedClasses.addAll(ClassScanner.getAnnotatedClasses(Entity.class));\n+\n+            options.put(AvailableSettings.LOADED_CLASSES, loadedClasses);\n         }\n \n-        PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n-                combineModelEntities(modelPackageName, includeAsyncModel), options);\n+        PersistenceUnitInfo persistenceUnitInfo = null;\n+\n+        if (includeDynamicModel) {\n+            initDynamicConfig(dynamicConfigPath);\n+            Collection<ClassLoader> classLoaders = new ArrayList<>();\n+            classLoaders.add(dynamicEntityCompiler.getClassLoader());\n+            options.put(AvailableSettings.CLASSLOADERS, classLoaders);\n \n-        return new EntityManagerFactoryBuilderImpl(\n-                new PersistenceUnitInfoDescriptor(persistenceUnitInfo), new HashMap<>())\n-                .build();\n+            persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n+                    combineModelEntities(dynamicEntityCompiler, modelPackageName,\n+                            includeAsyncModel, includeDynamicModel),\n+                    options, dynamicEntityCompiler.getClassLoader());\n+\n+            return new EntityManagerFactoryBuilderImpl(\n+                    new PersistenceUnitInfoDescriptor(persistenceUnitInfo), new HashMap<>(),\n+                    dynamicEntityCompiler.getClassLoader())\n+                    .build();\n+        } else {\n+            persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n+                    combineModelEntities(dynamicEntityCompiler, modelPackageName,\n+                            includeAsyncModel, includeDynamicModel),\n+                    options);\n+            return new EntityManagerFactoryBuilderImpl(\n+                    new PersistenceUnitInfoDescriptor(persistenceUnitInfo), new HashMap<>())\n+                    .build();\n+        }\n+    }\n+\n+    public static void initDynamicConfig(String dynamicConfigPath) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyMTQ3Nw==", "bodyText": "Maybe this can be a non-static method on the compiler (to return the list of classes that it manages).", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423321477", "createdAt": "2020-05-11T21:09:51Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -89,4 +135,39 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n                 .map(Class::getName)\n                 .collect(Collectors.toList());\n     }\n+\n+    /**\n+     * Find classes with a particular annotation from dynamic compiler.\n+     * @param compiler An instance of ElideDynamicEntityCompiler.\n+     * @param annotationClass Annotation to search for.\n+     * @return Set of Classes matching the annotation.\n+     * @throws ClassNotFoundException ClassNameNotFound in compiler\n+     */\n+    @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n+    public static List<String> findAnnotatedClassNames(ElideDynamicEntityCompiler compiler, Class annotationClass)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyMzAxOA==", "bodyText": "Instead of includingDynamicModel - maybe have an Optional<DynamicEntityCompiler>", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423323018", "createdAt": "2020-05-11T21:12:57Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -24,8 +32,10 @@\n  */\n public class Util {\n \n-    public static EntityManagerFactory getEntityManagerFactory(String modelPackageName, boolean includeAsyncModel, \n-            Properties options) {\n+    public static ElideDynamicEntityCompiler dynamicEntityCompiler;\n+\n+    public static EntityManagerFactory getEntityManagerFactory(String modelPackageName, boolean includeAsyncModel,\n+            boolean includeDynamicModel, String dynamicConfigPath, Properties options) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNDE2Ng==", "bodyText": "Instead of creating the PersistentUnitInfoImpl in the if/else - this can be simplified by just setting the classloader and list of packages to include in the if/else - and then using those to create the PersistentUnitInfo outside the control block.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423324166", "createdAt": "2020-05-11T21:15:15Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/Util.java", "diffHunk": "@@ -51,30 +61,66 @@ public static EntityManagerFactory getEntityManagerFactory(String modelPackageNa\n             options.put(\"javax.persistence.jdbc.url\", \"jdbc:mysql://localhost/elide?serverTimezone=UTC\");\n             options.put(\"javax.persistence.jdbc.user\", \"elide\");\n             options.put(\"javax.persistence.jdbc.password\", \"elide123\");\n+\n+            //Bind entity classes from classpath to Persistence Unit\n+            ArrayList<Class> loadedClasses = new ArrayList<>();\n+            loadedClasses.addAll(ClassScanner.getAnnotatedClasses(Entity.class));\n+\n+            options.put(AvailableSettings.LOADED_CLASSES, loadedClasses);\n         }\n \n-        PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n-                combineModelEntities(modelPackageName, includeAsyncModel), options);\n+        PersistenceUnitInfo persistenceUnitInfo = null;\n+\n+        if (includeDynamicModel) {\n+            initDynamicConfig(dynamicConfigPath);\n+            Collection<ClassLoader> classLoaders = new ArrayList<>();\n+            classLoaders.add(dynamicEntityCompiler.getClassLoader());\n+            options.put(AvailableSettings.CLASSLOADERS, classLoaders);\n \n-        return new EntityManagerFactoryBuilderImpl(\n-                new PersistenceUnitInfoDescriptor(persistenceUnitInfo), new HashMap<>())\n-                .build();\n+            persistenceUnitInfo = new PersistenceUnitInfoImpl(\"elide-stand-alone\",\n+                    combineModelEntities(dynamicEntityCompiler, modelPackageName,\n+                            includeAsyncModel, includeDynamicModel),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNDgwOA==", "bodyText": "Elide 5 now interprets the version set in the Swagger document.  If the non-elide models don't have this version - they vanish.\nDon't set a version.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423324808", "createdAt": "2020-05-11T21:16:26Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -173,4 +204,15 @@ public static HealthCheckRegistry getHealthCheckRegistry() {\n \n         return healthCheckRegistry;\n     }\n+\n+    private Swagger setupSwagger(EntityDictionary dictionary, String path, String title) {\n+        Info info = new Info().title(title).version(\"1.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNTQ5MQ==", "bodyText": "We can at least log the class name since we are swallowing the exception.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423325491", "createdAt": "2020-05-11T21:17:47Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -110,27 +134,34 @@ protected void configure() {\n \n         // Bind swaggers to given endpoint\n         register(new org.glassfish.hk2.utilities.binding.AbstractBinder() {\n+            @SuppressWarnings(\"rawtypes\")\n             @Override\n             protected void configure() {\n                 Map<String, Swagger> swaggerDocs = settings.enableSwagger();\n                 if (!swaggerDocs.isEmpty()) {\n                     // Include the async models in swagger docs\n-                    if(settings.enableAsync()) {\n-                        EntityDictionary dictionary = new EntityDictionary(new HashMap());\n+                    if (settings.enableAsync()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n                         dictionary.bindEntity(AsyncQuery.class);\n                         dictionary.bindEntity(AsyncQueryResult.class);\n-                         \n-                        Info info = new Info().title(\"Async Service\").version(\"1.0\");\n-\n-                        SwaggerBuilder builder = new SwaggerBuilder(dictionary, info);\n-                        \n-                        //Default value of getJsonApiPathSpec() ends with /* at the end. need to remove.\n-                        String asyncBasePath = settings.getJsonApiPathSpec().replaceAll(\"/\\\\*\", \"\");\n-\n-                        Swagger swagger = builder.build().basePath(asyncBasePath);\n-\n+                        Swagger swagger = setupSwagger(dictionary, settings.getJsonApiPathSpec(), \"Async Service\");\n                         swaggerDocs.put(\"async\", swagger);\n                     }\n+                    // bind dynamic models\n+                    if (settings.enableDynamicModelConfig()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n+                        try {\n+                            for (Class entity : Util.dynamicEntityCompiler.findAnnotatedClasses(Entity.class)) {\n+                                dictionary.bindEntity(entity);\n+                            }\n+                        } catch (ClassNotFoundException e) {\n+                            log.error(\"error while binding class\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNjQxNQ==", "bodyText": "The swagger builder doesn't need a separate dictionary to only build a subset of models.  YOu can provide it the list of classes to load.  That's the recommended approach.  Let's follow that.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423326415", "createdAt": "2020-05-11T21:19:36Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -110,27 +134,34 @@ protected void configure() {\n \n         // Bind swaggers to given endpoint\n         register(new org.glassfish.hk2.utilities.binding.AbstractBinder() {\n+            @SuppressWarnings(\"rawtypes\")\n             @Override\n             protected void configure() {\n                 Map<String, Swagger> swaggerDocs = settings.enableSwagger();\n                 if (!swaggerDocs.isEmpty()) {\n                     // Include the async models in swagger docs\n-                    if(settings.enableAsync()) {\n-                        EntityDictionary dictionary = new EntityDictionary(new HashMap());\n+                    if (settings.enableAsync()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n                         dictionary.bindEntity(AsyncQuery.class);\n                         dictionary.bindEntity(AsyncQueryResult.class);\n-                         \n-                        Info info = new Info().title(\"Async Service\").version(\"1.0\");\n-\n-                        SwaggerBuilder builder = new SwaggerBuilder(dictionary, info);\n-                        \n-                        //Default value of getJsonApiPathSpec() ends with /* at the end. need to remove.\n-                        String asyncBasePath = settings.getJsonApiPathSpec().replaceAll(\"/\\\\*\", \"\");\n-\n-                        Swagger swagger = builder.build().basePath(asyncBasePath);\n-\n+                        Swagger swagger = setupSwagger(dictionary, settings.getJsonApiPathSpec(), \"Async Service\");\n                         swaggerDocs.put(\"async\", swagger);\n                     }\n+                    // bind dynamic models\n+                    if (settings.enableDynamicModelConfig()) {\n+                        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNjkwOA==", "bodyText": "What exception are we catching here an why?", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423326908", "createdAt": "2020-05-11T21:20:34Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -51,30 +53,52 @@\n     private static HealthCheckRegistry healthCheckRegistry = null;\n \n     /**\n-     * Constructor\n+     * Constructor.\n      *\n-     * @param injector Injection instance for application\n+     * @param injector Injection instance for application.\n+     * @param servletContext servlet context instance.\n      */\n     @Inject\n     public ElideResourceConfig(ServiceLocator injector, @Context ServletContext servletContext) {\n         this.injector = injector;\n \n         settings = (ElideStandaloneSettings) servletContext.getAttribute(ELIDE_STANDALONE_SETTINGS_ATTR);\n \n+        if (settings.enableDynamicModelConfig()) {\n+            try {\n+                Util.initDynamicConfig(settings.getDynamicConfigPath());\n+            } catch (Exception e) {\n+                log.error(\"error in resource config\" + e.getMessage());\n+                throw new IllegalStateException(e);\n+            }\n+        }\n+\n         // Bind things that should be injectable to the Settings class\n         register(new AbstractBinder() {\n             @Override\n             protected void configure() {\n-                bind(Util.combineModelEntities(settings.getModelPackageName(), settings.enableAsync())).to(Set.class)\n-                        .named(\"elideAllModels\");\n+                try {\n+                    bind(Util.combineModelEntities(Util.dynamicEntityCompiler,\n+                            settings.getModelPackageName(), settings.enableAsync(),\n+                            settings.enableDynamicModelConfig())).to(Set.class).named(\"elideAllModels\");\n+                } catch (ClassNotFoundException e) {\n+                    log.error(\"error in resource config\" + e.getMessage());\n+                    throw new IllegalStateException(e);\n+                }\n             }\n         });\n \n         // Bind to injector\n         register(new AbstractBinder() {\n             @Override\n             protected void configure() {\n-                ElideSettings elideSettings = settings.getElideSettings(injector);\n+                ElideSettings elideSettings = null;\n+                try {\n+                    elideSettings = settings.getElideSettings(injector);\n+                } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyNzQwNg==", "bodyText": "What exception are we catching here and why.  We need to be very careful about catching exception - in general - not advised.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r423327406", "createdAt": "2020-05-11T21:21:38Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -51,30 +53,52 @@\n     private static HealthCheckRegistry healthCheckRegistry = null;\n \n     /**\n-     * Constructor\n+     * Constructor.\n      *\n-     * @param injector Injection instance for application\n+     * @param injector Injection instance for application.\n+     * @param servletContext servlet context instance.\n      */\n     @Inject\n     public ElideResourceConfig(ServiceLocator injector, @Context ServletContext servletContext) {\n         this.injector = injector;\n \n         settings = (ElideStandaloneSettings) servletContext.getAttribute(ELIDE_STANDALONE_SETTINGS_ATTR);\n \n+        if (settings.enableDynamicModelConfig()) {\n+            try {\n+                Util.initDynamicConfig(settings.getDynamicConfigPath());\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e13c0fb35ba5853035d9b7ac7dd0b01e0f0c43"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9feed879d7068ac744833bd7e02a2df66bf9e145", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/9feed879d7068ac744833bd7e02a2df66bf9e145", "committedDate": "2020-05-13T05:45:40Z", "message": "Merge branch 'elide-5.x-dynamic-config-integration' into elide-5.x-dynamic-config-standalone-integration"}, "afterCommit": {"oid": "a8159add9a8c4aea2fa667d9fac6e5ae1ba286aa", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/a8159add9a8c4aea2fa667d9fac6e5ae1ba286aa", "committedDate": "2020-05-15T01:22:38Z", "message": "Rebase with 5.x and Standalone changes for Dynamic Config Model\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b19bcfaf390a44ceb6da736a14c668222facb13b", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/b19bcfaf390a44ceb6da736a14c668222facb13b", "committedDate": "2020-05-15T04:11:07Z", "message": "Testing swagger\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "1c47aaa8b7cbc5152318d3f1950e138c25ea3d56", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/1c47aaa8b7cbc5152318d3f1950e138c25ea3d56", "committedDate": "2020-05-15T19:20:11Z", "message": "Rebase with 5.x and Standalone changes for Dynamic Config Model\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c47aaa8b7cbc5152318d3f1950e138c25ea3d56", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/1c47aaa8b7cbc5152318d3f1950e138c25ea3d56", "committedDate": "2020-05-15T19:20:11Z", "message": "Rebase with 5.x and Standalone changes for Dynamic Config Model\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "7dfbecc24a2750545c12f8a644dbd0a3ca8086ed", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/7dfbecc24a2750545c12f8a644dbd0a3ca8086ed", "committedDate": "2020-05-15T19:22:51Z", "message": "Rebase with 5.x and Standalone changes for Dynamic Config Model\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dfbecc24a2750545c12f8a644dbd0a3ca8086ed", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/7dfbecc24a2750545c12f8a644dbd0a3ca8086ed", "committedDate": "2020-05-15T19:22:51Z", "message": "Rebase with 5.x and Standalone changes for Dynamic Config Model\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "9269f438b8c9c87b51a55500d2df18330f03bb25", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/9269f438b8c9c87b51a55500d2df18330f03bb25", "committedDate": "2020-05-16T00:19:36Z", "message": "Rebase against 5.x and standalone changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9269f438b8c9c87b51a55500d2df18330f03bb25", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/9269f438b8c9c87b51a55500d2df18330f03bb25", "committedDate": "2020-05-16T00:19:36Z", "message": "Rebase against 5.x and standalone changes"}, "afterCommit": {"oid": "32528b693e03b51ea5ee4c52bf08e6eaaf63d2c0", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/32528b693e03b51ea5ee4c52bf08e6eaaf63d2c0", "committedDate": "2020-05-16T00:23:29Z", "message": "Rebase against 5.x and standalone changes\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32528b693e03b51ea5ee4c52bf08e6eaaf63d2c0", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/32528b693e03b51ea5ee4c52bf08e6eaaf63d2c0", "committedDate": "2020-05-16T00:23:29Z", "message": "Rebase against 5.x and standalone changes\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "b70a77908218327c55c43c0d03d9e3ad63cd9291", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/b70a77908218327c55c43c0d03d9e3ad63cd9291", "committedDate": "2020-05-16T01:09:27Z", "message": "Fix method call\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b70a77908218327c55c43c0d03d9e3ad63cd9291", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/b70a77908218327c55c43c0d03d9e3ad63cd9291", "committedDate": "2020-05-16T01:09:27Z", "message": "Fix method call\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "33c2f92311a8f3dd75f89843c6ba204272c36fd9", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/33c2f92311a8f3dd75f89843c6ba204272c36fd9", "committedDate": "2020-05-17T00:41:59Z", "message": "Fix method call\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff2a8f5c1c7033dbccad53f7e4f8cf7bcc8e6ce5", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/ff2a8f5c1c7033dbccad53f7e4f8cf7bcc8e6ce5", "committedDate": "2020-05-19T19:56:08Z", "message": "Swagger doc update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "fa212e9c47906d3a32783993ad4dff2373d7f3ae", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/fa212e9c47906d3a32783993ad4dff2373d7f3ae", "committedDate": "2020-05-19T19:57:18Z", "message": "Fix method call, Swagger Doc Update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa212e9c47906d3a32783993ad4dff2373d7f3ae", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/fa212e9c47906d3a32783993ad4dff2373d7f3ae", "committedDate": "2020-05-19T19:57:18Z", "message": "Fix method call, Swagger Doc Update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "1b32fcb7b77dc57af6415069362d6590bf9a05d8", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/1b32fcb7b77dc57af6415069362d6590bf9a05d8", "committedDate": "2020-05-19T19:59:17Z", "message": "Fix method call, Swagger Doc Update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cb1de18275e7c873aa4d8916d7c36969edf44f3", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/6cb1de18275e7c873aa4d8916d7c36969edf44f3", "committedDate": "2020-05-21T18:43:23Z", "message": "Fix method call, Swagger Doc Update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc96a134f4bb742592348b443d735409dfed0abb", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/fc96a134f4bb742592348b443d735409dfed0abb", "committedDate": "2020-05-21T18:43:23Z", "message": "Swagger doc update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79b328b3d967d492ac9b3abd72d0a22ae3ced9cb", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/79b328b3d967d492ac9b3abd72d0a22ae3ced9cb", "committedDate": "2020-05-19T21:13:20Z", "message": "Swagger doc update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}, "afterCommit": {"oid": "fc96a134f4bb742592348b443d735409dfed0abb", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/fc96a134f4bb742592348b443d735409dfed0abb", "committedDate": "2020-05-21T18:43:23Z", "message": "Swagger doc update\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b64ac72decc791647cab20ff729ec13d25e4fcdf", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/b64ac72decc791647cab20ff729ec13d25e4fcdf", "committedDate": "2020-05-21T18:46:09Z", "message": "update pom.xml\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fec8b73a215f3e01159530cf1a9440d6a730405", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/4fec8b73a215f3e01159530cf1a9440d6a730405", "committedDate": "2020-05-21T18:45:06Z", "message": "Update pom.xml"}, "afterCommit": {"oid": "b64ac72decc791647cab20ff729ec13d25e4fcdf", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/b64ac72decc791647cab20ff729ec13d25e4fcdf", "committedDate": "2020-05-21T18:46:09Z", "message": "update pom.xml\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/b9ebd6d31c02955083273b0177eef4accc0c208f", "committedDate": "2020-05-21T18:52:14Z", "message": "update pom.xml\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDU4MDI3", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-416458027", "createdAt": "2020-05-21T20:13:44Z", "commit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMDoxMzo0NVrOGZBR8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMDozMjo0MlrOGZB3Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg4ODU2Mw==", "bodyText": "Redundant readAccess.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r428888563", "createdAt": "2020-05-21T20:13:45Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/resources/models/tables/PostView.hjson", "diffHunk": "@@ -0,0 +1,20 @@\n+{\n+    tables: [{\n+        name: PostView\n+        table: Post\n+        description:\n+        '''\n+        A long description\n+        '''\n+        cardinality : large\n+        readAccess : Prefab.Role.All\n+        dimensions : [\n+            {\n+                name : content\n+                type : TEXT\n+                readAccess : Prefab.Role.All", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg4OTYzMA==", "bodyText": "You can combine this test with the one below in a single request (test the body and the status code).", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r428889630", "createdAt": "2020-05-21T20:15:55Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/test/java/example/ElideStandaloneTest.java", "diffHunk": "@@ -159,6 +162,20 @@ public void testJsonAPIPost() {\n             .then()\n             .statusCode(HttpStatus.SC_CREATED)\n             .extract().body().asString();\n+\n+        // Test the Dynamic Generated Analytical Model is accessible\n+        given()\n+            .when()\n+            .get(\"/api/v1/postView\")\n+            .then()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg5Mzg2Mw==", "bodyText": "This should take the MetadataStore instead of the SQLQueryEngine as an argument.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r428893863", "createdAt": "2020-05-21T20:24:36Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideStandaloneSettings.java", "diffHunk": "@@ -286,11 +339,150 @@ default void updateServletContextHandler(ServletContextHandler servletContextHan\n     }\n \n     /**\n-     * Gets the audit logger for elide\n+     * Gets the audit logger for elide.\n      *\n      * @return Default: Slf4jLogger\n      */\n     default AuditLogger getAuditLogger() {\n         return new Slf4jLogger();\n     }\n+\n+    /**\n+     * Gets the dynamic compiler for elide.\n+     *\n+     * @return Optional ElideDynamicEntityCompiler\n+     */\n+    default Optional<ElideDynamicEntityCompiler> getDynamicCompiler() {\n+        ElideDynamicEntityCompiler dynamicEntityCompiler = null;\n+\n+        if (enableDynamicModelConfig()) {\n+            try {\n+                dynamicEntityCompiler = new ElideDynamicEntityCompiler(getDynamicConfigPath());\n+            } catch (Exception e) { // thrown by in memory compiler\n+                throw new IllegalStateException(e);\n+            }\n+        }\n+\n+        return Optional.ofNullable(dynamicEntityCompiler);\n+    }\n+\n+    /**\n+     * Gets the DataStore for elide.\n+     * @param queryEngine query engine object.\n+     * @param aggregationDataStore AggregationDataStore object.\n+     * @param entityManagerFactory EntityManagerFactory object.\n+     * @return EntityDictionary object initialized.\n+     */\n+    default DataStore getDataStore(SQLQueryEngine queryEngine, AggregationDataStore aggregationDataStore,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f"}, "originalPosition": 241}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg5NTYwNw==", "bodyText": "INstead of binding this to the SQLQueryEngine - can we just bind it to QueryEngine?", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r428895607", "createdAt": "2020-05-21T20:27:43Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideStandaloneSettings.java", "diffHunk": "@@ -286,11 +339,150 @@ default void updateServletContextHandler(ServletContextHandler servletContextHan\n     }\n \n     /**\n-     * Gets the audit logger for elide\n+     * Gets the audit logger for elide.\n      *\n      * @return Default: Slf4jLogger\n      */\n     default AuditLogger getAuditLogger() {\n         return new Slf4jLogger();\n     }\n+\n+    /**\n+     * Gets the dynamic compiler for elide.\n+     *\n+     * @return Optional ElideDynamicEntityCompiler\n+     */\n+    default Optional<ElideDynamicEntityCompiler> getDynamicCompiler() {\n+        ElideDynamicEntityCompiler dynamicEntityCompiler = null;\n+\n+        if (enableDynamicModelConfig()) {\n+            try {\n+                dynamicEntityCompiler = new ElideDynamicEntityCompiler(getDynamicConfigPath());\n+            } catch (Exception e) { // thrown by in memory compiler\n+                throw new IllegalStateException(e);\n+            }\n+        }\n+\n+        return Optional.ofNullable(dynamicEntityCompiler);\n+    }\n+\n+    /**\n+     * Gets the DataStore for elide.\n+     * @param queryEngine query engine object.\n+     * @param aggregationDataStore AggregationDataStore object.\n+     * @param entityManagerFactory EntityManagerFactory object.\n+     * @return EntityDictionary object initialized.\n+     */\n+    default DataStore getDataStore(SQLQueryEngine queryEngine, AggregationDataStore aggregationDataStore,\n+            EntityManagerFactory entityManagerFactory) {\n+\n+        DataStore jpaDataStore = new JpaDataStore(\n+                () -> { return entityManagerFactory.createEntityManager(); },\n+                (em -> { return new NonJtaTransaction(em); }));\n+\n+        DataStore dataStore = new MultiplexManager(jpaDataStore, queryEngine.getMetaDataStore(), aggregationDataStore);\n+\n+        return dataStore;\n+    }\n+\n+    /**\n+     * Gets the AggregationDataStore for elide.\n+     * @param queryEngine query engine object.\n+     * @param optionalCompiler optional dynamic compiler object.\n+     * @return AggregationDataStore object initialized.\n+     */\n+    default AggregationDataStore getAggregationDataStore(SQLQueryEngine queryEngine,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f"}, "originalPosition": 259}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg5ODA5MQ==", "bodyText": "You shouldn't have to call settings.getSQLQueryEngine twice here.", "url": "https://github.com/yahoo/elide/pull/1259#discussion_r428898091", "createdAt": "2020-05-21T20:32:42Z", "author": {"login": "aklish"}, "path": "elide-standalone/src/main/java/com/yahoo/elide/standalone/config/ElideResourceConfig.java", "diffHunk": "@@ -58,47 +59,62 @@\n     private static HealthCheckRegistry healthCheckRegistry = null;\n \n     /**\n-     * Constructor\n+     * Constructor.\n      *\n-     * @param injector Injection instance for application\n+     * @param injector Injection instance for application.\n+     * @param servletContext servlet context instance.\n      */\n     @Inject\n     public ElideResourceConfig(ServiceLocator injector, @Context ServletContext servletContext) {\n         this.injector = injector;\n \n         settings = (ElideStandaloneSettings) servletContext.getAttribute(ELIDE_STANDALONE_SETTINGS_ATTR);\n \n+        Optional<ElideDynamicEntityCompiler> optionalCompiler = settings.getDynamicCompiler();\n+\n         // Bind things that should be injectable to the Settings class\n         register(new AbstractBinder() {\n             @Override\n             protected void configure() {\n-                bind(Util.combineModelEntities(settings.getModelPackageName(), settings.enableAsync())).to(Set.class)\n-                        .named(\"elideAllModels\");\n+                bind(Util.combineModelEntities(optionalCompiler, settings.getModelPackageName(),\n+                        settings.enableAsync())).to(Set.class).named(\"elideAllModels\");\n             }\n         });\n \n         // Bind to injector\n         register(new AbstractBinder() {\n             @Override\n             protected void configure() {\n-                ElideSettings elideSettings = settings.getElideSettings(injector);\n+                EntityManagerFactory entityManagerFactory = Util.getEntityManagerFactory(settings.getModelPackageName(),\n+                        settings.enableAsync(), optionalCompiler, settings.getDatabaseProperties());\n+\n+                EntityDictionary dictionary = settings.getEntityDictionary(injector, optionalCompiler);\n+\n+                MetaDataStore metaDataStore = settings.getMetaDataStore(optionalCompiler);\n+\n+                SQLQueryEngine queryEngine = settings.getSQLQueryEngine(metaDataStore, entityManagerFactory);\n+\n+                DataStore dataStore = settings.getDataStore(\n+                        settings.getSQLQueryEngine(metaDataStore, entityManagerFactory),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9ebd6d31c02955083273b0177eef4accc0c208f"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7249fdba8aaa35f376bd74b37379fa535a013882", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/7249fdba8aaa35f376bd74b37379fa535a013882", "committedDate": "2020-05-21T22:19:49Z", "message": "review comments\n\nCo-authored-by: AvaniMakwana <Avani.makwana@outlook.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c81eb87db9bbf6a8d5eccec7bb8685bb3bab1cb8", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/c81eb87db9bbf6a8d5eccec7bb8685bb3bab1cb8", "committedDate": "2020-05-22T13:43:48Z", "message": "Update ElideStandaloneSettings.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "864e02d53f4e501838d46db04558dbbf6ffd8c74", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/864e02d53f4e501838d46db04558dbbf6ffd8c74", "committedDate": "2020-05-22T21:40:37Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b71404fe68ec9884473e115321e66dc8eccdbdf", "author": {"user": {"login": "moizarafat", "name": "Moiz Arafat"}}, "url": "https://github.com/yahoo/elide/commit/7b71404fe68ec9884473e115321e66dc8eccdbdf", "committedDate": "2020-05-22T21:51:50Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTk5NjY0", "url": "https://github.com/yahoo/elide/pull/1259#pullrequestreview-418599664", "createdAt": "2020-05-26T19:15:11Z", "commit": {"oid": "7b71404fe68ec9884473e115321e66dc8eccdbdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 903, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}