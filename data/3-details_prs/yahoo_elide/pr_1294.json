{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNzIwODM4", "number": 1294, "title": "fixes for Async Models lifecycle hooks failing", "bodyText": "Description\nThis is a fix for Async Lifecycle hooks failing due to AsyncExecutorService not initialized. ExecuteQueryHook is now manually binded to dictionary after the AsyncExecutorService is initialized.\nMotivation and Context\nWith recent change in LifeCycleHooks, all hooks are moved to a separate class and injected separately. The injection of hooks happen when elide comes up. Async Hooks inject AsyncExecutorService which is not initialized at that moment as it needs Elide to be initialized.\nHow Has This Been Tested?\nElide Standalone Example has been used for testing.\nElide SpringBoot Example has been used for testing.\nLicense\nI confirm that this contribution is made under an Apache 2.0 license and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-04-29T13:40:23Z", "url": "https://github.com/yahoo/elide/pull/1294", "merged": true, "mergeCommit": {"oid": "b9f4170d3dc8d4c3b09d3d9e68a6b010671b2f13"}, "closed": true, "closedAt": "2020-04-30T17:29:40Z", "author": {"login": "moizarafat"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccYm5RAH2gAyNDEwNzIwODM4OjZmYTUxYWVlNjhiY2VkZmY2MWU0YTNhNGVmMmVlOTlmMzdkNjQ2Zjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccwi1NgFqTQwMzczMDc2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6fa51aee68bcedff61e4a3a4ef2ee99f37d646f8", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/6fa51aee68bcedff61e4a3a4ef2ee99f37d646f8", "committedDate": "2020-04-29T13:36:10Z", "message": "elide standalone fixes for lifecycle hooks failing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3187fd9619902936ba9217bf3cf593e79541af52", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/3187fd9619902936ba9217bf3cf593e79541af52", "committedDate": "2020-04-29T19:06:31Z", "message": "Manual Binding of lifecycle hooks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cbbaf5047ab438bf3d6d441b4347af36836241f", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/4cbbaf5047ab438bf3d6d441b4347af36836241f", "committedDate": "2020-04-29T20:30:28Z", "message": "Manual binding of lifecycle in elide spring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e041368669469b86db7e4ca950a9e0cdcf7f2fb0", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/e041368669469b86db7e4ca950a9e0cdcf7f2fb0", "committedDate": "2020-04-29T20:34:00Z", "message": "Refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDE5NzU5", "url": "https://github.com/yahoo/elide/pull/1294#pullrequestreview-403019759", "createdAt": "2020-04-29T20:37:45Z", "commit": {"oid": "e041368669469b86db7e4ca950a9e0cdcf7f2fb0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDozNzo0NVrOGOQDEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDozNzo0NVrOGOQDEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU5NjE3OA==", "bodyText": "Might as well make this consistent - let's remove all life cycle hook annotations from this class.", "url": "https://github.com/yahoo/elide/pull/1294#discussion_r417596178", "createdAt": "2020-04-29T20:37:45Z", "author": {"login": "aklish"}, "path": "elide-async/src/main/java/com/yahoo/elide/async/models/AsyncQuery.java", "diffHunk": "@@ -30,14 +28,15 @@\n \n /**\n  * Model for Async Query.\n+ * ExecuteQueryHook is binded manually during the elide startup,\n+ * after asyncexecutorservice is initialized.\n  */\n @Entity\n @Include(type = \"asyncQuery\", rootLevel = true)\n @ReadPermission(expression = \"Principal is Owner\")\n @UpdatePermission(expression = \"Prefab.Role.None\")\n @DeletePermission(expression = \"Prefab.Role.None\")\n @LifeCycleHookBinding(hook = UpdatePrincipalNameHook.class, operation = CREATE, phase = PRESECURITY)\n-@LifeCycleHookBinding(hook = ExecuteQueryHook.class, operation = CREATE, phase = POSTCOMMIT)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e041368669469b86db7e4ca950a9e0cdcf7f2fb0"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDIwMjk0", "url": "https://github.com/yahoo/elide/pull/1294#pullrequestreview-403020294", "createdAt": "2020-04-29T20:38:35Z", "commit": {"oid": "e041368669469b86db7e4ca950a9e0cdcf7f2fb0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDozODozNVrOGOQEjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDozOTowOVrOGOQF1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU5NjU1Ng==", "bodyText": "I thought we were going to do all of this logic in the AsyncExecutorService bean?", "url": "https://github.com/yahoo/elide/pull/1294#discussion_r417596556", "createdAt": "2020-04-29T20:38:35Z", "author": {"login": "aklish"}, "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideAsyncConfiguration.java", "diffHunk": "@@ -72,4 +70,10 @@ public AsyncCleanerService buildAsyncCleanerService(Elide elide, ElideConfigProp\n     public AsyncQueryDAO buildAsyncQueryDAO(Elide elide) {\n         return new DefaultAsyncQueryDAO(elide, elide.getDataStore());\n     }\n+\n+    @Override\n+    public void afterPropertiesSet() {\n+        ExecuteQueryHook executeQueryHook = new ExecuteQueryHook(asyncExecutorService);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e041368669469b86db7e4ca950a9e0cdcf7f2fb0"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU5Njg4NA==", "bodyText": "Why not leave this in the ElideAsyncConfiguration file?", "url": "https://github.com/yahoo/elide/pull/1294#discussion_r417596884", "createdAt": "2020-04-29T20:39:09Z", "author": {"login": "aklish"}, "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideAutoConfiguration.java", "diffHunk": "@@ -144,4 +147,20 @@ public Swagger buildSwagger(EntityDictionary dictionary, ElideConfigProperties s\n \n         return swagger;\n     }\n+\n+    /**\n+     * Configure the AsyncExecutorService used for submitting async query requests.\n+     * @param elide elideObject.\n+     * @param settings Elide settings.\n+     * @return a AsyncExecutorService.\n+     */\n+    @Bean\n+    @ConditionalOnMissingBean\n+    @ConditionalOnProperty(prefix = \"elide.async\", name = \"enabled\", matchIfMissing = false)\n+    public AsyncExecutorService buildAsyncExecutorService(Elide elide, ElideConfigProperties settings,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e041368669469b86db7e4ca950a9e0cdcf7f2fb0"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ccfd1217e6c7e85d7c7facb9a95f4943fed83b", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/f1ccfd1217e6c7e85d7c7facb9a95f4943fed83b", "committedDate": "2020-04-29T21:35:36Z", "message": "Review Comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54cc38715f61daf8df914e1444f9032c18944b33", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/54cc38715f61daf8df914e1444f9032c18944b33", "committedDate": "2020-04-30T14:44:51Z", "message": "elide standalone fixes for lifecycle hooks failing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13a25b993313e49c653a725e3553927dffac8e32", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/13a25b993313e49c653a725e3553927dffac8e32", "committedDate": "2020-04-30T14:46:18Z", "message": "Manual Binding of lifecycle hooks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da0db3fb30e4b603a18b3f4f86452c5710f56bd1", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/da0db3fb30e4b603a18b3f4f86452c5710f56bd1", "committedDate": "2020-04-30T14:46:18Z", "message": "Manual binding of lifecycle in elide spring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5796f2ae04d75f73d037b9a61ed0c735a8c77d1", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/b5796f2ae04d75f73d037b9a61ed0c735a8c77d1", "committedDate": "2020-04-30T14:46:18Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a5437587995d8a05cc67db3152fb9d697cbf74d", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/2a5437587995d8a05cc67db3152fb9d697cbf74d", "committedDate": "2020-04-30T14:46:18Z", "message": "Review Comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d136f750e9d0a3e809ef2f428e722a4718f27e6c", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/d136f750e9d0a3e809ef2f428e722a4718f27e6c", "committedDate": "2020-04-30T14:49:45Z", "message": "Resolve conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "198c38d4e3c2ee1dea4b987db9d142ca8bc5fb7c", "author": {"user": null}, "url": "https://github.com/yahoo/elide/commit/198c38d4e3c2ee1dea4b987db9d142ca8bc5fb7c", "committedDate": "2020-04-30T16:14:54Z", "message": "Rebase with 5.x"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzMwNzYw", "url": "https://github.com/yahoo/elide/pull/1294#pullrequestreview-403730760", "createdAt": "2020-04-30T17:29:27Z", "commit": {"oid": "198c38d4e3c2ee1dea4b987db9d142ca8bc5fb7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 915, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}