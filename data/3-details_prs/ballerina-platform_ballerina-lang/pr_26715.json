{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NjI2MzQw", "number": 26715, "title": "[Testerina] Add diff to the error message when equality assertion fails for anydata map", "bodyText": "Purpose\nAdd diff to the error message when equality assertion fails for anydata map\nFixes #26204 for Json/map/record data types\nApproach\nWhen \"assertEquals\" fails and the types of the compared values are the same, a difference will be shown as in the below samples for Json/map/record data types.\nSamples\nSample 1\n >  json data1 = {\n        name: \"John Doe\",\n        age: \"25\",\n        address: {\n            city: \"Colombo\",\n            country: \"Sri Lanka\"\n        },\n        code: 94\n    };\n    json data2 = {\n        name: \"John Doe New\",\n        age: 25,\n        address: {\n            city: \"Sydney\",\n            country: \"Australia\"\n        },\n        code: 61\n    };\n\n    test:assertEquals(data1, data2);\n\n            Assertion Failed!\n            \n                expected: '{\"name\":\"John Doe New\",\"age\":25,\"address\":{\"city\":\"Sydney\",\"country\":\"Australia\"...'\n                actual  : '{\"name\":\"John Doe\",\"age\":\"25\",\"address\":{\"city\":\"Colombo\",\"country\":\"Sri Lanka\"}...'\n            \n                Diff    :\n            \n            \n                key: name\n                expected value  : John Doe New\n                actual value    : John Doe\n            \n                key: age\n                expected value  : <int> 25\n                actual value    : <string> 25\n            \n                key: address.city\n                expected value  : Sydney\n                actual value    : Colombo\n            \n                key: address.country\n                expected value  : Australia\n                actual value    : Sri Lanka\n            \n                key: code\n                expected value  : 61\n                actual value    : 94\n\nSample 2\n>  json data1 = {\n        name1: \"John Doe\",\n        age: \"25\",\n        address: {\n            city: \"Colombo\",\n            country: \"Sri Lanka\"\n        }\n    };\n    json data2 = {\n        name: \"John Doe\",\n        age: 25,\n        address2: {\n            city: \"Colombo\",\n            country: \"Sri Lanka\"\n        }\n    };\n\n    test:assertEquals(data1, data2);\n\n            Assertion Failed!\n            \n                expected: '{\"name\":\"John Doe\",\"age\":25,\"address2\":{\"city\":\"Colombo\",\"country\":\"Sri Lanka\"}}'\n                actual  : '{\"name1\":\"John Doe\",\"age\":\"25\",\"address\":{\"city\":\"Colombo\",\"country\":\"Sri Lanka\"...'\n            \n                Diff    :\n            \n                expected keys   : name, address2, address2.city, address2.country\n                actual keys     : name1, address, address.city, address.country\n            \n            \n                key: age\n                expected value  : <int> 25\n                actual value    : <string> 25\n\nSample 3\n>  json j1 = {name: \"Anne\", age: \"21\", marks: {maths: 99, physics: 80, chemistry: 70, english: 95, status: {pass:true}}};\n    json j2 = {name2: \"Anne\", age: 21, marks: {maths: 10, physics: 40, chemistry: 50, english: 55, status: {pass:false}}};\n    error? err = trap test:assertEquals(j1, j2);\n\n    test:assertEquals(j1, j2);\n\n            Assertion Failed!\n            \n                expected: '{\"name2\":\"Anne\",\"age\":21,\"marks\":{\"maths\":10,\"physics\":40,\"chemistry\":50,\"englis...'\n                actual  : '{\"name\":\"Anne\",\"age\":\"21\",\"marks\":{\"maths\":99,\"physics\":80,\"chemistry\":70,\"engli...'\n            \n                Diff    :\n            \n                expected keys   : name2\n                actual keys     : name\n            \n            \n                key: age\n                expected value  : <int> 21\n                actual value    : <string> 21\n            \n                key: marks.maths\n                expected value  : 10\n                actual value    : 99\n            \n                key: marks.physics\n                expected value  : 40\n                actual value    : 80\n            \n                key: marks.chemistry\n                expected value  : 50\n                actual value    : 70\n            \n                key: marks.english\n                expected value  : 55\n                actual value    : 95\n            \n                key: marks.status.pass\n                expected value  : false\n                actual value    : true\n            \n                Total value mismatches: 6\n\nRemarks\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-11-03T10:13:39Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26715", "merged": true, "mergeCommit": {"oid": "eb6ae265adb0a7dee54c55235a2751c9bae4ac23"}, "closed": true, "closedAt": "2020-11-03T16:14:31Z", "author": {"login": "Dilhasha"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYpgyIAH2gAyNTE0NjI2MzQwOjY5ZTNhYzYzMGUzNzdkN2YzNzdjODk0ZDkzMmY3YzQwNDM2MGM5OWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY55G5gFqTUyMjUzODYyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69e3ac630e377d7f377c894d932f7c404360c99f", "author": {"user": {"login": "Dilhasha", "name": "Fathima Dilhasha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/69e3ac630e377d7f377c894d932f7c404360c99f", "committedDate": "2020-11-02T19:13:20Z", "message": "Add map assertion diff implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdcbe4fe06e5284819cfd2a358c6cd0d2efe17fb", "author": {"user": {"login": "Dilhasha", "name": "Fathima Dilhasha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bdcbe4fe06e5284819cfd2a358c6cd0d2efe17fb", "committedDate": "2020-11-03T10:00:11Z", "message": "Improve test cases for assertion errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMzU1MDg4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26715#pullrequestreview-522355088", "createdAt": "2020-11-03T10:20:10Z", "commit": {"oid": "bdcbe4fe06e5284819cfd2a358c6cd0d2efe17fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMDoyMDoxMFrOHsoQQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMDoyMDoxMFrOHsoQQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU1ODkxMg==", "bodyText": "Is this a description comment or something that needs to be asserted? Can we remove it?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26715#discussion_r516558912", "createdAt": "2020-11-03T10:20:10Z", "author": {"login": "Ibaqu"}, "path": "tests/testerina-integration-test/src/test/resources/project-based-tests/basic-tests/src/assertions-error-messages/tests/assertions-diff-error-messages.bal", "diffHunk": "@@ -56,18 +70,45 @@ function testAssertJsonValues() {\n     json bioData2 = {name:\"John Doe New\", age:25, address:{city:\"Colombo\", country:\"Sri Lanka\"}};\n     error? err = trap test:assertEquals(bioData, bioData2);\n     error result = <error>err;\n-    test:assertEquals(result.message().toString(),\n-    \"Assertion Failed!\\n \\nexpected: '{\\\"name\\\":\\\"John Doe New\\\",\\\"age\\\":25,\\\"address\\\":{\\\"city\\\":\\\"Colombo\\\",\" + \"\\\"country\\\":\\\"Sri Lanka...'\\nactual\\t: '{\\\"name\\\":\\\"John Doe\\\",\\\"age\\\":25,\\\"address\\\":{\\\"city\\\":\\\"Colombo\\\",\" + \"\\\"country\\\":\\\"Sri Lanka\\\"}}'\");\n+    test:assertEquals(result.message().toString(), \"Assertion Failed!\\n \\nexpected: '{\\\"name\\\":\\\"John Doe New\\\",\\\"age\\\":25,\\\"address\\\":{\\\"city\\\":\\\"Colombo\\\",\" + \"\\\"country\\\":\\\"Sri Lanka...'\\nactual\\t: '{\\\"name\\\":\\\"John Doe\\\",\\\"age\\\":25,\\\"address\\\":{\\\"city\\\":\\\"Colombo\\\",\" + \"\\\"country\\\":\\\"Sri Lanka\\\"}}'\\n \\nDiff\\t:\\n \\n\\n \\nkey: name\\nexpected value\\t: John Doe New\\nactual value\\t: John Doe \\n \\n\");\n+}\n+\n+@test:Config {}\n+function testAssertJsonInJson() {\n+    json j1 = {name: \"Anne\", age: \"21\", marks: {maths: 100, physics: 90, status: {pass:true}}};\n+    json j2 = {name: \"Anne\", age: 21, marks: {maths: 100, physics: 90, status: {pass:false}}};\n+    error? err = trap test:assertEquals(j1, j2);\n+    error result = <error>err;\n+    test:assertEquals(result.message().toString(), \"Assertion Failed!\\n \\nexpected: '{\\\"name\\\":\\\"Anne\\\",\\\"age\\\":21,\\\"marks\\\":{\\\"maths\\\":100,\\\"physics\\\":90,\\\"status\\\":{\\\"pass\\\":false...'\\nactual\\t: '{\\\"name\\\":\\\"Anne\\\",\\\"age\\\":\\\"21\\\",\\\"marks\\\":{\\\"maths\\\":100,\\\"physics\\\":90,\\\"status\\\":{\\\"pass\\\":tru...'\\n \\nDiff\\t:\\n \\n\\n \\nkey: age\\nexpected value\\t: <int> 21\\nactual value\\t: <string> 21 \\n\\n \\nkey: marks.status.pass\\nexpected value\\t: false\\nactual value\\t: true \\n \\n\");\n }\n \n @test:Config {}\n function testAssertLongJsonValues() {\n     json bioData = {name:\"John Doe Old\", age:25, designation: \"SSE\", address:{city:\"Colombo\", country:\"Sri Lankaa\"}};\n     json bioData2 = {name:\"John Doe New\", age:25, designation: \"SSE\", address:{city:\"Colombo\", country:\"Sri Lanka\"}};\n+    //test:assertEquals(bioData, bioData2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdcbe4fe06e5284819cfd2a358c6cd0d2efe17fb"}, "originalPosition": 69}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edde6278718b60ebe8538e7460f696eb7e7c357e", "author": {"user": {"login": "Dilhasha", "name": "Fathima Dilhasha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/edde6278718b60ebe8538e7460f696eb7e7c357e", "committedDate": "2020-11-03T11:04:07Z", "message": "Remove unnecessary comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "035d8a2348642d0932a18010ea185794e8889946", "author": {"user": {"login": "Dilhasha", "name": "Fathima Dilhasha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/035d8a2348642d0932a18010ea185794e8889946", "committedDate": "2020-11-03T13:26:24Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-formatting-diff"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTM4NjI1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26715#pullrequestreview-522538625", "createdAt": "2020-11-03T14:18:23Z", "commit": {"oid": "035d8a2348642d0932a18010ea185794e8889946"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3286, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}