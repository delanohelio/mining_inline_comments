{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNjUzNjQw", "number": 24528, "title": "Mapping-match-pattern support to match statement", "bodyText": "Purpose\n$Subject\nFixes #24292\nNotes\nCommented failing test cases in the language server. #24601\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-07-01T12:02:35Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528", "merged": true, "mergeCommit": {"oid": "3215c5341cada9848ca878eeb86dfb6a23018e96"}, "closed": true, "closedAt": "2020-07-06T13:23:12Z", "author": {"login": "rdulmina"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwQrvJAH2gAyNDQyNjUzNjQwOmZhMjM3MWU5NjNjNmU3NjE4MGIxMDdlZTI4NjI0ODk1MjU1MTYzMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyRLQzgFqTQ0MzA2OTk5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa2371e963c6e76180b107ee2862489525516325", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fa2371e963c6e76180b107ee2862489525516325", "committedDate": "2020-06-30T07:40:42Z", "message": "Methods for mapping match pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a7e7ac41688328a7f2c0b133f25d04222327ba1", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a7e7ac41688328a7f2c0b133f25d04222327ba1", "committedDate": "2020-07-01T11:10:14Z", "message": "Mapping-match-pattern support to match statement."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4b8f77ed4a41a5cf98152e9877980a2ed9dae03", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b4b8f77ed4a41a5cf98152e9877980a2ed9dae03", "committedDate": "2020-07-01T11:16:07Z", "message": "Added missing files."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b6cda768cba21afeb10a5f38498b4ac1746a564", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8b6cda768cba21afeb10a5f38498b4ac1746a564", "committedDate": "2020-07-01T11:58:22Z", "message": "Test cases for adding mapping-match-pattern support to match statement."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11b0f534a8b7f50385fcfd14e6187127c63a07ea", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/11b0f534a8b7f50385fcfd14e6187127c63a07ea", "committedDate": "2020-07-01T11:59:08Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5ca38ff24d95c4404de7229287331f9e9ea88e9", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d5ca38ff24d95c4404de7229287331f9e9ea88e9", "committedDate": "2020-07-01T12:00:17Z", "message": "Add missing assert file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec1e73262d443213eaa5273d5ce6915479820605", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ec1e73262d443213eaa5273d5ce6915479820605", "committedDate": "2020-07-02T04:25:25Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7d1996fb5a8f7a74a6afa976ccbefa357a20a293", "committedDate": "2020-07-03T03:48:44Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "496faa23b5c1763bfb461985a2d3d3d464d06e84", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/496faa23b5c1763bfb461985a2d3d3d464d06e84", "committedDate": "2020-07-03T06:42:23Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f15d11fac313b1893db327f10f2155ab1a94b85", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f15d11fac313b1893db327f10f2155ab1a94b85", "committedDate": "2020-07-03T11:18:41Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed1854b146b0bf6c55131d2098fcc5ec740b5047", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ed1854b146b0bf6c55131d2098fcc5ec740b5047", "committedDate": "2020-07-05T11:18:42Z", "message": "Change assert file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb756f9cbc10390a30cb812cd4abed8121e76de", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/feb756f9cbc10390a30cb812cd4abed8121e76de", "committedDate": "2020-07-05T12:33:25Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTM3MjU3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#pullrequestreview-442137257", "createdAt": "2020-07-03T04:21:45Z", "commit": {"oid": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyMTo0NVrOGsjQdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMzoyMjo0NFrOGtHtFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2ODE4MQ==", "bodyText": "shall we go with fieldMatchPatterns to be consistent with the spec?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449368181", "createdAt": "2020-07-03T04:21:45Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -3888,6 +3888,50 @@\n                     \"type\": \"SimpleNameReferenceNode\"\n                 }\n             ]\n+        },\n+        {\n+            \"name\": \"MappingMatchPatternNode\",\n+            \"base\": \"Node\",\n+            \"kind\": \"MAPPING_MATCH_PATTERN\",\n+            \"attributes\": [\n+                {\n+                    \"name\": \"openBraceToken\",\n+                    \"type\": \"Token\"\n+                },\n+                {\n+                    \"name\": \"mappingMatchPatternListNode\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4NzkxMw==", "bodyText": "should the type be FieldMatchPatternNode?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449387913", "createdAt": "2020-07-03T05:50:20Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -3888,6 +3888,50 @@\n                     \"type\": \"SimpleNameReferenceNode\"\n                 }\n             ]\n+        },\n+        {\n+            \"name\": \"MappingMatchPatternNode\",\n+            \"base\": \"Node\",\n+            \"kind\": \"MAPPING_MATCH_PATTERN\",\n+            \"attributes\": [\n+                {\n+                    \"name\": \"openBraceToken\",\n+                    \"type\": \"Token\"\n+                },\n+                {\n+                    \"name\": \"mappingMatchPatternListNode\",\n+                    \"type\": \"Node\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2MzkxNg==", "bodyText": "add <br/> for line breaks.. otherwise the IDE preview will look cluttered.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449963916", "createdAt": "2020-07-06T03:14:24Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12619,6 +12623,103 @@ private STNode parseListMatchPatternMemberRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    /**\n+     * Parse mapping match pattern.\n+     * <p>\n+     *     mapping-match-pattern := { field-match-patterns }\n+     *     field-match-patterns :=", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feb756f9cbc10390a30cb812cd4abed8121e76de"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTExMQ==", "bodyText": "I think we should first parse the match-pattern (it could be a field-match-pattern or rest-match-pattern), and then check whether its a rest-pattern or not.\nReason is, if theres a junk token before ellipsis, above condition fail and it will try to parse it as a field-match-pattern.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449965111", "createdAt": "2020-07-06T03:21:20Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12619,6 +12623,103 @@ private STNode parseListMatchPatternMemberRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    /**\n+     * Parse mapping match pattern.\n+     * <p>\n+     *     mapping-match-pattern := { field-match-patterns }\n+     *     field-match-patterns :=\n+     *    field-match-pattern (, field-match-pattern)* [, rest-match-pattern]\n+     *    | [ rest-match-pattern ]\n+     *      field-match-pattern := field-name : match-pattern\n+     *      rest-match-pattern := ... var variable-name\n+     * </p>\n+     *\n+     * @return Parsed Node.\n+     */\n+    private STNode parseMappingMatchPattern() {\n+        startContext(ParserRuleContext.MAPPING_MATCH_PATTERN);\n+        STNode openBraceToken = parseOpenBrace();\n+        List<STNode> mappingMatchPatternList = new ArrayList<>();\n+        STNode restMatchPattern = null;\n+\n+        while (!isEndOfMappingMatchPattern()) {\n+            STToken nextToken = peek();\n+            if (nextToken.kind == SyntaxKind.ELLIPSIS_TOKEN) {\n+                restMatchPattern = parseRestMatchPattern();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feb756f9cbc10390a30cb812cd4abed8121e76de"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTMzMg==", "bodyText": "Also, once the rest pattern is found, we should continue to parse match-patterns (do not break the loop), but add them as invalid nodes.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449965332", "createdAt": "2020-07-06T03:22:44Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12619,6 +12623,103 @@ private STNode parseListMatchPatternMemberRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    /**\n+     * Parse mapping match pattern.\n+     * <p>\n+     *     mapping-match-pattern := { field-match-patterns }\n+     *     field-match-patterns :=\n+     *    field-match-pattern (, field-match-pattern)* [, rest-match-pattern]\n+     *    | [ rest-match-pattern ]\n+     *      field-match-pattern := field-name : match-pattern\n+     *      rest-match-pattern := ... var variable-name\n+     * </p>\n+     *\n+     * @return Parsed Node.\n+     */\n+    private STNode parseMappingMatchPattern() {\n+        startContext(ParserRuleContext.MAPPING_MATCH_PATTERN);\n+        STNode openBraceToken = parseOpenBrace();\n+        List<STNode> mappingMatchPatternList = new ArrayList<>();\n+        STNode restMatchPattern = null;\n+\n+        while (!isEndOfMappingMatchPattern()) {\n+            STToken nextToken = peek();\n+            if (nextToken.kind == SyntaxKind.ELLIPSIS_TOKEN) {\n+                restMatchPattern = parseRestMatchPattern();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTExMQ=="}, "originalCommit": {"oid": "feb756f9cbc10390a30cb812cd4abed8121e76de"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "364a0815e943cd1a89b178c7dacb2f9adcf8b627", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/364a0815e943cd1a89b178c7dacb2f9adcf8b627", "committedDate": "2020-07-06T04:57:32Z", "message": "Commented two language server test cases.\nCommented completionWithinInvocationArgs7 and completionWithinInvocationArgs6 test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae3f3236215e7f14aa694fccffc893ed032e91f9", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae3f3236215e7f14aa694fccffc893ed032e91f9", "committedDate": "2020-07-06T05:12:32Z", "message": "Refactor code to align with the specs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "719e8ee9b5032498832145d4c995d7452b7f865b", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/719e8ee9b5032498832145d4c995d7452b7f865b", "committedDate": "2020-07-06T10:19:05Z", "message": "Add invalid node support to field match pattern.\nIf there are more field match patterns after rest match pattern, those are added as invalid minutiae to the rest match pattern node."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDY5OTk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#pullrequestreview-443069994", "createdAt": "2020-07-06T13:22:59Z", "commit": {"oid": "719e8ee9b5032498832145d4c995d7452b7f865b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4137, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}