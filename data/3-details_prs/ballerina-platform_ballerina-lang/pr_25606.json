{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4Nzk2NDIy", "number": 25606, "title": "Create scopes for local variables in debugger", "bodyText": "Purpose\n$title\nFixes #24882\nApproach\n\nCreate a new scope every time a new variable is created.\nSave the current scope in every instruction\nCreate a label at the first instruction of a scope\nUse the label as the starting label\n\nSamples\n\nN/A\n\nRemarks\n\nN/A\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-03T18:03:44Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606", "merged": true, "mergeCommit": {"oid": "c62604dedd5541067801c8923a0ab17c447ffa50"}, "closed": true, "closedAt": "2020-09-16T17:50:26Z", "author": {"login": "dulvinw"}, "timelineItems": {"totalCount": 57, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFgLnDABqjM3MjgzNzUyNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJeAULgFqTQ4OTczNzc5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e45d578a48ac3e1f64d7a68cf9c578965a068873", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e45d578a48ac3e1f64d7a68cf9c578965a068873", "committedDate": "2020-09-03T07:54:27Z", "message": "Fix checkstyle"}, "afterCommit": {"oid": "0330cc573b856ed37bc848da005fffd6f35db211", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0330cc573b856ed37bc848da005fffd6f35db211", "committedDate": "2020-09-04T07:36:04Z", "message": "Fix checkstyle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0330cc573b856ed37bc848da005fffd6f35db211", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0330cc573b856ed37bc848da005fffd6f35db211", "committedDate": "2020-09-04T07:36:04Z", "message": "Fix checkstyle"}, "afterCommit": {"oid": "53bb17dbce131bc8705cf185994e59f854408b4d", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/53bb17dbce131bc8705cf185994e59f854408b4d", "committedDate": "2020-09-07T05:43:36Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzgxNjMy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-483781632", "createdAt": "2020-09-08T04:06:47Z", "commit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDowNjo0N1rOHOL_Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDowNjo0N1rOHOL_Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYzODU2Mw==", "bodyText": "Remove extra new lines", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r484638563", "createdAt": "2020-09-08T04:06:47Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -949,15 +954,27 @@ public void visit(BLangBlockStmt astBlockStmt) {\n \n     @Override\n     public void visit(BLangSimpleVariableDef astVarDefStmt) {\n+        VarKind kind;\n+        if (Symbols.isFlagOn(astVarDefStmt.var.symbol.flags, Flags.DESTRUCTURED)) {\n+            kind = VarKind.SYNTHETIC;\n+        } else {\n+            kind = VarKind.LOCAL;\n+        }\n         BIRVariableDcl birVarDcl = new BIRVariableDcl(astVarDefStmt.pos, astVarDefStmt.var.symbol.type,\n-                this.env.nextLocalVarId(names), VarScope.FUNCTION, VarKind.LOCAL, astVarDefStmt.var.name.value);\n+                this.env.nextLocalVarId(names), VarScope.FUNCTION, kind, astVarDefStmt.var.name.value);\n         birVarDcl.startBB = this.env.enclBB;\n         this.varDclsByBlock.get(this.currentBlock).add(birVarDcl);\n         this.env.enclFunc.localVars.add(birVarDcl);\n         // We maintain a mapping from variable symbol to the bir_variable declaration.\n         // This is required to pull the correct bir_variable declaration for variable references.\n         this.env.symbolVarMap.put(astVarDefStmt.var.symbol, birVarDcl);\n \n+        BirScope newScope = new BirScope(this.currentScope.id + 1, this.currentScope, this.currentScope.function);\n+        birVarDcl.insScope = newScope;\n+        this.currentScope = newScope;\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzg5ODM5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-483789839", "createdAt": "2020-09-08T04:39:17Z", "commit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDozOToxOFrOHOMa6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDozOToxOFrOHOMa6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0NTYwOA==", "bodyText": "Move out ot a method", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r484645608", "createdAt": "2020-09-08T04:39:18Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -2005,8 +2005,8 @@ public void visit(BLangTupleDestructure tupleDestructure) {\n         String name = \"tuple\";\n         final BLangSimpleVariable tuple =\n                 ASTBuilderUtil.createVariable(tupleDestructure.pos, name, runTimeType, null,\n-                                              new BVarSymbol(0, names.fromString(name), this.env.scope.owner.pkgID,\n-                                                             runTimeType, this.env.scope.owner, tupleDestructure.pos));\n+                        new BVarSymbol(Flags.DESTRUCTURED, names.fromString(name), this.env.scope.owner.pkgID,\n+                                runTimeType, this.env.scope.owner, tupleDestructure.pos));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzkzNTE4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-483793518", "createdAt": "2020-09-08T04:53:27Z", "commit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDo1MzoyOFrOHOMn4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDo1MzoyOFrOHOMn4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0ODkyOA==", "bodyText": "Remove this and use this in the JvmMethodGen", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r484648928", "createdAt": "2020-09-08T04:53:28Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCodeGenUtil.java", "diffHunk": "@@ -91,8 +95,11 @@\n     public static final ResolvedTypeBuilder TYPE_BUILDER = new ResolvedTypeBuilder();\n     public static final String INITIAL_MEHOD_DESC = \"(Lorg/ballerinalang/jvm/scheduling/Strand;\";\n \n-    private JvmCodeGenUtil() {\n+    public static final String SCOPE_PREFIX = \"_SCOPE_\";\n+    private static BirScope lastScope = null;\n+    private static Set<BirScope> visitedScopesSet = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzk2Mzky", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-483796392", "createdAt": "2020-09-08T05:03:41Z", "commit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNTowMzo0MlrOHOMxkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNTowMzo0MlrOHOMxkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY1MTQwOQ==", "bodyText": "Refactor this class names", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r484651409", "createdAt": "2020-09-08T05:03:42Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/internal/LabelGenerator.java", "diffHunk": "@@ -42,4 +42,8 @@ public Label getLabel(String labelKey) {\n             return label;\n         }\n     }\n+\n+    public void putLabel(String labelKey, Label label) {\n+        this.bbLabels.put(labelKey, label);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzk3MzQ3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-483797347", "createdAt": "2020-09-08T05:07:02Z", "commit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNTowNzowMlrOHOM0xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNTowNzowMlrOHOM0xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY1MjIzMA==", "bodyText": "writeBoolean()", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r484652230", "createdAt": "2020-09-08T05:07:02Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRInstructionWriter.java", "diffHunk": "@@ -71,6 +73,36 @@ void writeBBs(List<BIRBasicBlock> bbList) {\n         bbList.forEach(bb -> bb.accept(this));\n     }\n \n+    void writeScopes(List<BIRBasicBlock> bbList) {\n+        int instructionOffset = 0;\n+        BirScope currentScope = null;\n+        for (BIRBasicBlock bb : bbList) {\n+            for (BIRAbstractInstruction ins : bb.instructions) {\n+                instructionOffset++;\n+\n+                if (ins.scope == currentScope) {\n+                    continue;\n+                }\n+\n+                currentScope = ins.scope;\n+                writeScope(currentScope, instructionOffset);\n+            }\n+        }\n+    }\n+\n+    private void writeScope(BirScope currentScope, int instructionOffset) {\n+        buf.writeInt(currentScope.id);\n+        buf.writeInt(instructionOffset);\n+\n+        if (currentScope.parent != null) {\n+            buf.writeInt(1); // Parent available.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzk4MDgw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-483798080", "createdAt": "2020-09-08T05:09:29Z", "commit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNTowOToyOVrOHOM3cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNTowOToyOVrOHOM3cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY1MjkxNQ==", "bodyText": "Write the number of scopes", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r484652915", "createdAt": "2020-09-08T05:09:29Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRInstructionWriter.java", "diffHunk": "@@ -71,6 +73,36 @@ void writeBBs(List<BIRBasicBlock> bbList) {\n         bbList.forEach(bb -> bb.accept(this));\n     }\n \n+    void writeScopes(List<BIRBasicBlock> bbList) {\n+        int instructionOffset = 0;\n+        BirScope currentScope = null;\n+        for (BIRBasicBlock bb : bbList) {\n+            for (BIRAbstractInstruction ins : bb.instructions) {\n+                instructionOffset++;\n+\n+                if (ins.scope == currentScope) {\n+                    continue;\n+                }\n+\n+                currentScope = ins.scope;\n+                writeScope(currentScope, instructionOffset);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20798d7da9626eeae6a460168c6ef100fa22176f"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21db5369917dcf251a8144a33d0537b575d41c68", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/21db5369917dcf251a8144a33d0537b575d41c68", "committedDate": "2020-09-08T10:49:10Z", "message": "Review suggestions"}, "afterCommit": {"oid": "e14ea599d31cc78632d51b24761fb4e81e411999", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e14ea599d31cc78632d51b24761fb4e81e411999", "committedDate": "2020-09-08T16:44:29Z", "message": "Review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjI5MTU5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-486229159", "createdAt": "2020-09-10T19:03:12Z", "commit": {"oid": "386c4306159bec9bec82dec46b7ab0a8ec216f5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowMzoxMlrOHQB7aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowMzoxMlrOHQB7aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MDg1Nw==", "bodyText": "I think this count can also be written within intructionWriter as it is the one which calculates the total count.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r486570857", "createdAt": "2020-09-10T19:03:12Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRBinaryWriter.java", "diffHunk": "@@ -290,12 +292,23 @@ private void writeFunction(ByteBuf buf, BIRTypeWriter typeWriter, BIRInstruction\n             birbuf.writeBoolean(details.send);\n         }\n \n+        // Write the instruction vs scope table\n+        writeScopes(buf, scopebuf, funcInsWriter.getScopeCount());\n+\n         // Write length of the function body so that it can be skipped easily.\n         int length = birbuf.nioBuffer().limit();\n         buf.writeLong(length);\n         buf.writeBytes(birbuf.nioBuffer().array(), 0, length);\n     }\n \n+    private void writeScopes(ByteBuf buf, ByteBuf scopebuf, int scopeCount) {\n+        int length = scopebuf.nioBuffer().limit();\n+        // 4 is the size of int which is the number of scopes that we are going to add to the beginning of the buffer\n+        buf.writeLong(length + 4);\n+        buf.writeInt(scopeCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386c4306159bec9bec82dec46b7ab0a8ec216f5e"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjI5Mzk1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-486229395", "createdAt": "2020-09-10T19:03:33Z", "commit": {"oid": "386c4306159bec9bec82dec46b7ab0a8ec216f5e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4d3cdd67943d9fab8b9b2c4e3cda9f713fe7e56", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f4d3cdd67943d9fab8b9b2c4e3cda9f713fe7e56", "committedDate": "2020-09-11T13:39:56Z", "message": "Create scopes for local instructions following local variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fb4da5a665a0de78f3b4ca6ce402744e745e41f", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3fb4da5a665a0de78f3b4ca6ce402744e745e41f", "committedDate": "2020-09-11T13:39:56Z", "message": "Refactor code for new jbal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90c6ed2ffc8c037ff874343459a7fb56c95689b0", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90c6ed2ffc8c037ff874343459a7fb56c95689b0", "committedDate": "2020-09-11T13:41:07Z", "message": "Fix foreach desugar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aec4195806ba7480e459b5bd8a00b4a3cda45b89", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aec4195806ba7480e459b5bd8a00b4a3cda45b89", "committedDate": "2020-09-11T13:41:07Z", "message": "Enable previously removed query and transactional lang libs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70c3f3447b99a85b3d3151985aaf8eeb019a0bc7", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/70c3f3447b99a85b3d3151985aaf8eeb019a0bc7", "committedDate": "2020-09-11T13:41:08Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa794991f26eb7427ee334052ec48ada3727da9d", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa794991f26eb7427ee334052ec48ada3727da9d", "committedDate": "2020-09-11T13:42:09Z", "message": "Fix memory leak in static class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3165f4a1e22c5d276657934e0f7bc1b85c2f4423", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3165f4a1e22c5d276657934e0f7bc1b85c2f4423", "committedDate": "2020-09-11T13:45:31Z", "message": "Review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "073b22421cbb194de33d63b9b670bf781692eff4", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/073b22421cbb194de33d63b9b670bf781692eff4", "committedDate": "2020-09-11T13:45:32Z", "message": "Add number of scopes to the begining of the scope table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c49707d0227932954697a03976533485bf29ac9", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9c49707d0227932954697a03976533485bf29ac9", "committedDate": "2020-09-11T13:45:32Z", "message": "Added bir spec rules related to scope entries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "978d3e036ac330e783b36dd367a29f3c89257a46", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/978d3e036ac330e783b36dd367a29f3c89257a46", "committedDate": "2020-09-11T13:37:12Z", "message": "Add bir assers in the BIRTestUtils"}, "afterCommit": {"oid": "bdb622eb7c1129711c5781c1b808a84c51816e4b", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bdb622eb7c1129711c5781c1b808a84c51816e4b", "committedDate": "2020-09-11T13:45:32Z", "message": "Add bir assers in the BIRTestUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bdb622eb7c1129711c5781c1b808a84c51816e4b", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bdb622eb7c1129711c5781c1b808a84c51816e4b", "committedDate": "2020-09-11T13:45:32Z", "message": "Add bir assers in the BIRTestUtils"}, "afterCommit": {"oid": "f62ac7373fceda67fed78507e431f2bdfc889bef", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f62ac7373fceda67fed78507e431f2bdfc889bef", "committedDate": "2020-09-11T13:51:41Z", "message": "Add bir assers in the BIRTestUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eefede61c79fa7f0a1067d254f9437fe282d89d5", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eefede61c79fa7f0a1067d254f9437fe282d89d5", "committedDate": "2020-09-11T14:04:41Z", "message": "Add bir assers in the BIRTestUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f62ac7373fceda67fed78507e431f2bdfc889bef", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f62ac7373fceda67fed78507e431f2bdfc889bef", "committedDate": "2020-09-11T13:51:41Z", "message": "Add bir assers in the BIRTestUtils"}, "afterCommit": {"oid": "eefede61c79fa7f0a1067d254f9437fe282d89d5", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eefede61c79fa7f0a1067d254f9437fe282d89d5", "committedDate": "2020-09-11T14:04:41Z", "message": "Add bir assers in the BIRTestUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTEwNzA0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-486910704", "createdAt": "2020-09-11T15:31:39Z", "commit": {"oid": "eefede61c79fa7f0a1067d254f9437fe282d89d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTozMTozOVrOHQjrdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTozMTozOVrOHQjrdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMzgzMA==", "bodyText": "Can we move this varSymbol new instance creation logic to a method and call? Looks like there are 5-6 places the same is happening.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r487123830", "createdAt": "2020-09-11T15:31:39Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1142,9 +1142,9 @@ public void visit(BLangTupleVariable varNode) {\n         String name = \"$tuple$\";\n         final BLangSimpleVariable tuple =\n                 ASTBuilderUtil.createVariable(varNode.pos, name, symTable.arrayAllType, null,\n-                                              new BVarSymbol(0, names.fromString(name), this.env.scope.owner.pkgID,\n-                                                             symTable.arrayAllType, this.env.scope.owner, varNode.pos,\n-                                                             VIRTUAL));\n+                        new BVarSymbol(Flags.DESTRUCTURED, names.fromString(name), this.env.scope.owner.pkgID,\n+                                symTable.arrayAllType, this.env.scope.owner, varNode.pos,\n+                                VIRTUAL));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eefede61c79fa7f0a1067d254f9437fe282d89d5"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ca6af6969ec2ba9c61582a178d797c2172021fc", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1ca6af6969ec2ba9c61582a178d797c2172021fc", "committedDate": "2020-09-11T16:50:23Z", "message": "Review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04111de3bc8d51b74d342040f6782544d5cdc9a5", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/04111de3bc8d51b74d342040f6782544d5cdc9a5", "committedDate": "2020-09-11T16:42:03Z", "message": "Review suggestions"}, "afterCommit": {"oid": "1ca6af6969ec2ba9c61582a178d797c2172021fc", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1ca6af6969ec2ba9c61582a178d797c2172021fc", "committedDate": "2020-09-11T16:50:23Z", "message": "Review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ef2f13b58ce0754190a16bf2a63921f0930dea", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f1ef2f13b58ce0754190a16bf2a63921f0930dea", "committedDate": "2020-09-11T17:41:13Z", "message": "Refactor desugar to take use of originSymbol"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1dcd0728fcd10e36477fee8d5ab5b27a3dc4d56", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a1dcd0728fcd10e36477fee8d5ab5b27a3dc4d56", "committedDate": "2020-09-11T17:36:19Z", "message": "Refactor desugar to take use of originSymbol"}, "afterCommit": {"oid": "f1ef2f13b58ce0754190a16bf2a63921f0930dea", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f1ef2f13b58ce0754190a16bf2a63921f0930dea", "committedDate": "2020-09-11T17:41:13Z", "message": "Refactor desugar to take use of originSymbol"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjcyOTE4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-487672918", "createdAt": "2020-09-14T11:47:26Z", "commit": {"oid": "f1ef2f13b58ce0754190a16bf2a63921f0930dea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTo0NzoyN1rOHRQAPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTo0NzoyN1rOHRQAPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1MDA0NA==", "bodyText": "We only need the new buffer at function writing ? why it is needed here?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r487850044", "createdAt": "2020-09-14T11:47:27Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRBinaryWriter.java", "diffHunk": "@@ -65,8 +65,9 @@ public BIRBinaryWriter(BIRNode.BIRPackage birPackage) {\n \n     public byte[] serialize() {\n         ByteBuf birbuf = Unpooled.buffer();\n+        ByteBuf scopebuf = Unpooled.buffer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1ef2f13b58ce0754190a16bf2a63921f0930dea"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDI1ODM2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-488025836", "createdAt": "2020-09-14T18:14:05Z", "commit": {"oid": "f1ef2f13b58ce0754190a16bf2a63921f0930dea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxODoxNDowNlrOHRhCSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxODoxNDowNlrOHRhCSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEyOTA5OQ==", "bodyText": "not sure your formatting setting is correct here? the new line should start from the same column level as the previous line for method arguments.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r488129099", "createdAt": "2020-09-14T18:14:06Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCodeGenUtil.java", "diffHunk": "@@ -507,30 +511,68 @@ public static boolean isBallerinaBuiltinModule(String orgName, String moduleName\n         return orgName.equals(\"ballerina\") && moduleName.equals(\"builtin\");\n     }\n \n-    public static void generateBbInstructions(MethodVisitor mv, LabelGenerator labelGen, JvmInstructionGen instGen,\n-                                              int localVarOffset, AsyncDataCollector asyncDataCollector,\n-                                              String funcName,\n-                                              BIRNode.BIRBasicBlock bb) {\n+    public static BirScope generateBbInstructions(MethodVisitor mv, LabelGenerator labelGen, JvmInstructionGen instGen,\n+            int localVarOffset, AsyncDataCollector asyncDataCollector,\n+            String funcName,\n+            BIRNode.BIRBasicBlock bb, Set<BirScope> visitedScopesSet, BirScope lastScope) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1ef2f13b58ce0754190a16bf2a63921f0930dea"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae2e47870c3f327c800730aa342ef0a7a923aee5", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae2e47870c3f327c800730aa342ef0a7a923aee5", "committedDate": "2020-09-15T02:54:34Z", "message": "Review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d4e05b9b4df39b927b5328ee17919a2843bf10f", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5d4e05b9b4df39b927b5328ee17919a2843bf10f", "committedDate": "2020-09-15T06:54:48Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into lables-for-local-variables-2\n\n# Conflicts:\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/BIRPackageSymbolEnter.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRBinaryWriter.java\n#\tdocs/bir-spec/src/main/resources/kaitai/bir.ksy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4b246951dac26fde77a38172195110cb413130b", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d4b246951dac26fde77a38172195110cb413130b", "committedDate": "2020-09-15T08:54:35Z", "message": "review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad79a3888e606e9976c1ae6e7d30984ab2529f35", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ad79a3888e606e9976c1ae6e7d30984ab2529f35", "committedDate": "2020-09-15T08:36:15Z", "message": "review suggestions"}, "afterCommit": {"oid": "d4b246951dac26fde77a38172195110cb413130b", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d4b246951dac26fde77a38172195110cb413130b", "committedDate": "2020-09-15T08:54:35Z", "message": "review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTYyMTIx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-488562121", "createdAt": "2020-09-15T10:56:13Z", "commit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1NjoxM1rOHR8MMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1NjoxM1rOHR8MMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3NDAwMA==", "bodyText": "method name may not be correct as it returns BirScope?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r488574000", "createdAt": "2020-09-15T10:56:13Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCodeGenUtil.java", "diffHunk": "@@ -507,30 +511,70 @@ public static boolean isBallerinaBuiltinModule(String orgName, String moduleName\n         return orgName.equals(\"ballerina\") && moduleName.equals(\"builtin\");\n     }\n \n-    public static void generateBbInstructions(MethodVisitor mv, LabelGenerator labelGen, JvmInstructionGen instGen,\n-                                              int localVarOffset, AsyncDataCollector asyncDataCollector,\n-                                              String funcName,\n-                                              BIRNode.BIRBasicBlock bb) {\n+    public static BirScope generateBbInstructions(MethodVisitor mv, LabelGenerator labelGen, JvmInstructionGen instGen,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTYyNTIw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-488562520", "createdAt": "2020-09-15T10:56:45Z", "commit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1Njo0NVrOHR8NUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1Njo0NVrOHR8NUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3NDI5MA==", "bodyText": "Same here as well. Method name may not be correct as it returns BirScope?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r488574290", "createdAt": "2020-09-15T10:56:45Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCodeGenUtil.java", "diffHunk": "@@ -507,30 +511,70 @@ public static boolean isBallerinaBuiltinModule(String orgName, String moduleName\n         return orgName.equals(\"ballerina\") && moduleName.equals(\"builtin\");\n     }\n \n-    public static void generateBbInstructions(MethodVisitor mv, LabelGenerator labelGen, JvmInstructionGen instGen,\n-                                              int localVarOffset, AsyncDataCollector asyncDataCollector,\n-                                              String funcName,\n-                                              BIRNode.BIRBasicBlock bb) {\n+    public static BirScope generateBbInstructions(MethodVisitor mv, LabelGenerator labelGen, JvmInstructionGen instGen,\n+                                                  int localVarOffset, AsyncDataCollector asyncDataCollector,\n+                                                  String funcName,\n+                                                  BIRNode.BIRBasicBlock bb, Set<BirScope> visitedScopesSet,\n+                                                  BirScope lastScope) {\n+\n         int insCount = bb.instructions.size();\n         for (int i = 0; i < insCount; i++) {\n             Label insLabel = labelGen.getLabel(funcName + bb.id.value + \"ins\" + i);\n             mv.visitLabel(insLabel);\n             BIRInstruction inst = bb.instructions.get(i);\n             if (inst != null) {\n-                generateDiagnosticPos(((BIRNode) inst).pos, mv);\n+                lastScope = generateDiagnosticPos((BIRAbstractInstruction) inst, funcName, mv, labelGen,\n+                                                  visitedScopesSet, lastScope);\n                 instGen.generateInstructions(localVarOffset, asyncDataCollector, inst);\n             }\n         }\n+\n+        return lastScope;\n+    }\n+\n+    private static BirScope generateDiagnosticPos(BIRAbstractInstruction instruction, String funcName, MethodVisitor mv,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTYyOTk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-488562994", "createdAt": "2020-09-15T10:57:28Z", "commit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1NzoyOFrOHR8Ovw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1NzoyOFrOHR8Ovw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3NDY1NQ==", "bodyText": "we don't need this new constructor as discussed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r488574655", "createdAt": "2020-09-15T10:57:28Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRInstructionWriter.java", "diffHunk": "@@ -57,20 +61,65 @@\n public class BIRInstructionWriter extends BIRVisitor {\n \n     private ByteBuf buf;\n+    private ByteBuf scopeBuf;\n     private ConstantPool cp;\n     private BIRBinaryWriter binaryWriter;\n+    private int instructionOffset;\n+    private Set<BirScope> completedScopeSet;\n+    private int scopeCount;\n \n-    BIRInstructionWriter(ByteBuf buf, ConstantPool cp, BIRBinaryWriter birBinaryWriter) {\n+    BIRInstructionWriter(ByteBuf buf, ByteBuf scopeBuf, ConstantPool cp, BIRBinaryWriter birBinaryWriter) {\n         this.buf = buf;\n+        this.scopeBuf = scopeBuf;\n         this.binaryWriter = birBinaryWriter;\n         this.cp = cp;\n+        this.instructionOffset = 0;\n+        this.completedScopeSet = new HashSet<>();\n+        this.scopeCount = 0;\n+    }\n+\n+    BIRInstructionWriter(ByteBuf buf, ConstantPool cp, BIRBinaryWriter birBinaryWriter) {\n+        this(buf, null, cp, birBinaryWriter);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTYzMjg2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-488563286", "createdAt": "2020-09-15T10:57:52Z", "commit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1Nzo1MlrOHR8Piw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1Nzo1MlrOHR8Piw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3NDg1OQ==", "bodyText": "once you remove the constructor, this check will also be not needed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r488574859", "createdAt": "2020-09-15T10:57:52Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRInstructionWriter.java", "diffHunk": "@@ -57,20 +61,65 @@\n public class BIRInstructionWriter extends BIRVisitor {\n \n     private ByteBuf buf;\n+    private ByteBuf scopeBuf;\n     private ConstantPool cp;\n     private BIRBinaryWriter binaryWriter;\n+    private int instructionOffset;\n+    private Set<BirScope> completedScopeSet;\n+    private int scopeCount;\n \n-    BIRInstructionWriter(ByteBuf buf, ConstantPool cp, BIRBinaryWriter birBinaryWriter) {\n+    BIRInstructionWriter(ByteBuf buf, ByteBuf scopeBuf, ConstantPool cp, BIRBinaryWriter birBinaryWriter) {\n         this.buf = buf;\n+        this.scopeBuf = scopeBuf;\n         this.binaryWriter = birBinaryWriter;\n         this.cp = cp;\n+        this.instructionOffset = 0;\n+        this.completedScopeSet = new HashSet<>();\n+        this.scopeCount = 0;\n+    }\n+\n+    BIRInstructionWriter(ByteBuf buf, ConstantPool cp, BIRBinaryWriter birBinaryWriter) {\n+        this(buf, null, cp, birBinaryWriter);\n+    }\n+\n+    public int getScopeCount() {\n+        return scopeCount;\n     }\n \n     void writeBBs(List<BIRBasicBlock> bbList) {\n         buf.writeInt(bbList.size());\n         bbList.forEach(bb -> bb.accept(this));\n     }\n \n+    void writeScopes(BIRAbstractInstruction instruction) {\n+        if (scopeBuf == null) {\n+            return;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTYzODcy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-488563872", "createdAt": "2020-09-15T10:58:40Z", "commit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1ODo0MFrOHR8RQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo1ODo0MFrOHR8RQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3NTI5Nw==", "bodyText": "shall we inverse the if condition here?\nif (visitedScopes.contains(instructionScope)) {\ncontinue;\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r488575297", "createdAt": "2020-09-15T10:58:40Z", "author": {"login": "Kishanthan"}, "path": "docs/bir-spec/src/test/java/org/ballerinalang/birspec/BIRTestUtils.java", "diffHunk": "@@ -153,6 +158,73 @@ private static void assertFunctions(BIRNode.BIRPackage expectedBIR, Bir.Module b\n             // assert basic blocks\n             assertBasicBlocks(actualFunctionBody.functionBasicBlocksInfo(), expectedFunction.basicBlocks,\n                     constantPoolEntries);\n+\n+            assertScopes(actualFunction.scopeEntries(), expectedFunction);\n+        }\n+    }\n+\n+    private static void assertScopes(ArrayList<Bir.ScopeEntry> scopeEntries, BIRNode.BIRFunction function) {\n+        int instructionOffset = 0;\n+        Map<Integer, ExpectedScopeEntry> scopes = new HashMap<>();\n+        Set<BirScope> visitedScopes = new HashSet<>();\n+\n+        // Collect scope vs starting instruction offset\n+        Collection<List<BIRNode.BIRBasicBlock>> basicBlocksCollection = function.parameters.values();\n+        for (List<BIRNode.BIRBasicBlock> basicBlocks : basicBlocksCollection) {\n+            instructionOffset = generateExpectedScopeEntries(basicBlocks, instructionOffset, scopes, visitedScopes);\n+        }\n+\n+        generateExpectedScopeEntries(function.basicBlocks, instructionOffset, scopes, visitedScopes);\n+\n+        for (Bir.ScopeEntry actualScopeEntry : scopeEntries) {\n+            ExpectedScopeEntry expectedScopeEntry = scopes.get(actualScopeEntry.currentScopeIndex());\n+            Assert.assertNotNull(expectedScopeEntry);\n+\n+            Assert.assertEquals(actualScopeEntry.instructionOffset(), expectedScopeEntry.instructionOffset);\n+            Assert.assertEquals(actualScopeEntry.hasParent(), expectedScopeEntry.hasParent);\n+            Assert.assertEquals(actualScopeEntry.parentScopeIndex(), expectedScopeEntry.parentId);\n+        }\n+    }\n+\n+    private static int generateExpectedScopeEntries(List<BIRNode.BIRBasicBlock> bbList, int instructionOffset,\n+            Map<Integer, ExpectedScopeEntry> scopes, Set<BirScope> visitedScopes) {\n+        for (BIRNode.BIRBasicBlock bb : bbList) {\n+            for (BIRAbstractInstruction instruction : bb.instructions) {\n+                instructionOffset++;\n+                BirScope instructionScope = instruction.scope;\n+\n+                if (!visitedScopes.contains(instructionScope)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4b246951dac26fde77a38172195110cb413130b"}, "originalPosition": 63}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56119d048a0268ff1731157138ab46b8f3829c92", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/56119d048a0268ff1731157138ab46b8f3829c92", "committedDate": "2020-09-15T14:40:13Z", "message": "Refactor Code"}, "afterCommit": {"oid": "b2c8415871569d0365674e1c2b5ab538ae282717", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2c8415871569d0365674e1c2b5ab538ae282717", "committedDate": "2020-09-15T15:19:12Z", "message": "Refactor Code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa872945df416c667c51203146d77b9b8c26ecee", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa872945df416c667c51203146d77b9b8c26ecee", "committedDate": "2020-09-15T16:14:11Z", "message": "Refactor Code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2c8415871569d0365674e1c2b5ab538ae282717", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2c8415871569d0365674e1c2b5ab538ae282717", "committedDate": "2020-09-15T15:19:12Z", "message": "Refactor Code"}, "afterCommit": {"oid": "aa872945df416c667c51203146d77b9b8c26ecee", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa872945df416c667c51203146d77b9b8c26ecee", "committedDate": "2020-09-15T16:14:11Z", "message": "Refactor Code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67d52654d124b454347e8d73be774734e552a56f", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/67d52654d124b454347e8d73be774734e552a56f", "committedDate": "2020-09-15T16:25:51Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into lables-for-local-variables-2"}, "afterCommit": {"oid": "e29ffc6e36ccaf81f99ef19c5c0ba19fe3d6925d", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e29ffc6e36ccaf81f99ef19c5c0ba19fe3d6925d", "committedDate": "2020-09-15T16:30:21Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into lables-for-local-variables-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bd6d7a52cf4e53fe4dcaa273e8018eb322ede39", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2bd6d7a52cf4e53fe4dcaa273e8018eb322ede39", "committedDate": "2020-09-15T16:31:16Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into lables-for-local-variables-2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e29ffc6e36ccaf81f99ef19c5c0ba19fe3d6925d", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e29ffc6e36ccaf81f99ef19c5c0ba19fe3d6925d", "committedDate": "2020-09-15T16:30:21Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into lables-for-local-variables-2"}, "afterCommit": {"oid": "2bd6d7a52cf4e53fe4dcaa273e8018eb322ede39", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2bd6d7a52cf4e53fe4dcaa273e8018eb322ede39", "committedDate": "2020-09-15T16:31:16Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into lables-for-local-variables-2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89a9201b37458e06600938436b9589967825e889", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/89a9201b37458e06600938436b9589967825e889", "committedDate": "2020-09-15T17:13:50Z", "message": "Refactor BIRBinaryWriter and BIRInstructionWriter"}, "afterCommit": {"oid": "30861a4369e4df576eb4cd9bd178c4f2f8b21a38", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/30861a4369e4df576eb4cd9bd178c4f2f8b21a38", "committedDate": "2020-09-15T17:25:48Z", "message": "Refactor BIRBinaryWriter and BIRInstructionWriter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5354c74ff4b28d715c466543c0b14005718515b6", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5354c74ff4b28d715c466543c0b14005718515b6", "committedDate": "2020-09-15T17:33:59Z", "message": "Refactor BIRBinaryWriter and BIRInstructionWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30861a4369e4df576eb4cd9bd178c4f2f8b21a38", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/30861a4369e4df576eb4cd9bd178c4f2f8b21a38", "committedDate": "2020-09-15T17:25:48Z", "message": "Refactor BIRBinaryWriter and BIRInstructionWriter"}, "afterCommit": {"oid": "5354c74ff4b28d715c466543c0b14005718515b6", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5354c74ff4b28d715c466543c0b14005718515b6", "committedDate": "2020-09-15T17:33:59Z", "message": "Refactor BIRBinaryWriter and BIRInstructionWriter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjQ2ODIz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-489246823", "createdAt": "2020-09-16T03:26:42Z", "commit": {"oid": "5354c74ff4b28d715c466543c0b14005718515b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMzoyNjo0MlrOHSerCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMzoyNjo0MlrOHSerCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEzODk1Mw==", "bodyText": "is this constructor needed?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r489138953", "createdAt": "2020-09-16T03:26:42Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/writer/BIRWriterUtils.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ *\n+ */\n+\n+package org.wso2.ballerinalang.compiler.bir.writer;\n+\n+import io.netty.buffer.ByteBuf;\n+import org.ballerinalang.model.elements.PackageID;\n+import org.wso2.ballerinalang.compiler.bir.model.BIRNode;\n+import org.wso2.ballerinalang.compiler.util.diagnotic.DiagnosticPos;\n+\n+/**\n+ * Common functions used in BIR writers.\n+ *\n+ * @since 2.0.0\n+ */\n+public class BIRWriterUtils {\n+\n+    public BIRWriterUtils() {\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5354c74ff4b28d715c466543c0b14005718515b6"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cb7be8baebd712e8045c975b3d46b816d613b31", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0cb7be8baebd712e8045c975b3d46b816d613b31", "committedDate": "2020-09-16T04:35:38Z", "message": "Refactor BIRBinaryWriter and BIRInstructionWriter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MzYyNjYy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-489362662", "createdAt": "2020-09-16T07:50:22Z", "commit": {"oid": "0cb7be8baebd712e8045c975b3d46b816d613b31"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNzo1MDoyMlrOHSkgVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNzo1NzoyN1rOHSkxVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzNDUxNw==", "bodyText": "shall we have getter setter instead of having public variables?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r489234517", "createdAt": "2020-09-16T07:50:22Z", "author": {"login": "riyafa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/model/BirScope.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ *\n+ */\n+\n+package org.wso2.ballerinalang.compiler.bir.model;\n+\n+/**\n+ * Hold the scope of the instruction w.r.t variable declarations.\n+ *\n+ * @since 2.0.0\n+ */\n+public class BirScope {\n+    public int id;\n+    public BirScope parent;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb7be8baebd712e8045c975b3d46b816d613b31"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzNTkyOA==", "bodyText": "shall we have getter setter instead of having public variables? If it is a Immutable class let's make them final", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r489235928", "createdAt": "2020-09-16T07:52:42Z", "author": {"login": "riyafa"}, "path": "docs/bir-spec/src/test/java/org/ballerinalang/birspec/BIRTestUtils.java", "diffHunk": "@@ -590,4 +665,18 @@ Bir getActualBIR() {\n             return actualBIR;\n         }\n     }\n+\n+    static class ExpectedScopeEntry {\n+        public int id;\n+        public int instructionOffset;\n+        public int hasParent;\n+        public Integer parentId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb7be8baebd712e8045c975b3d46b816d613b31"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzODg3MA==", "bodyText": "Just for my clarity what does the new SYNTHETIC type mean? I think I have explicitly checked for LOCAL types and temp types when reusing variables during optimization. Using a new type might break all those code. There might be other places as well. Shall we also mention in the PR description on the need to introduce this new type as it appears to be a big change", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r489238870", "createdAt": "2020-09-16T07:57:27Z", "author": {"login": "riyafa"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/bir/bir-dump/cacheInserts", "diffHunk": "@@ -8,57 +8,57 @@ public cacheInserts function() -> () {\n     %6(TEMP) string;\n     %7(TEMP) float;\n     %8(LOCAL) ballerina/cache:2.0.0:Cache;\n-    %9(LOCAL) ballerina/cache:2.0.0:Cache;\n+    %9(SYNTHETIC) ballerina/cache:2.0.0:Cache;\n     %13(TEMP) ();\n-    %15(LOCAL) ();\n-    %16(LOCAL) error{map<anydata | readonly>} | ();\n+    %15(SYNTHETIC) ();\n+    %16(SYNTHETIC) error{map<anydata | readonly>} | ();\n     %18(TEMP) string;\n     %19(TEMP) any;\n     %20(TEMP) string;\n     %23(TEMP) ();\n     %24(TEMP) boolean;\n-    %25(LOCAL) ();\n-    %30(LOCAL) error;\n-    %35(LOCAL) ();\n-    %36(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %45(LOCAL) ();\n-    %50(LOCAL) error;\n-    %55(LOCAL) ();\n-    %56(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %65(LOCAL) ();\n-    %70(LOCAL) error;\n-    %75(LOCAL) ();\n-    %76(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %85(LOCAL) ();\n-    %90(LOCAL) error;\n-    %95(LOCAL) ();\n-    %96(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %105(LOCAL) ();\n-    %110(LOCAL) error;\n-    %115(LOCAL) ();\n-    %116(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %125(LOCAL) ();\n-    %130(LOCAL) error;\n-    %135(LOCAL) ();\n-    %136(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %145(LOCAL) ();\n-    %150(LOCAL) error;\n-    %155(LOCAL) ();\n-    %156(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %165(LOCAL) ();\n-    %170(LOCAL) error;\n-    %175(LOCAL) ();\n-    %176(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %185(LOCAL) ();\n-    %190(LOCAL) error;\n-    %195(LOCAL) ();\n-    %196(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %205(LOCAL) ();\n-    %210(LOCAL) error;\n-    %215(LOCAL) ();\n-    %216(LOCAL) ballerina/cache:2.0.0:CacheError | ();\n-    %225(LOCAL) ();\n-    %230(LOCAL) error;\n+    %25(SYNTHETIC) ();\n+    %30(SYNTHETIC) error;\n+    %35(SYNTHETIC) ();\n+    %36(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %45(SYNTHETIC) ();\n+    %50(SYNTHETIC) error;\n+    %55(SYNTHETIC) ();\n+    %56(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %65(SYNTHETIC) ();\n+    %70(SYNTHETIC) error;\n+    %75(SYNTHETIC) ();\n+    %76(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %85(SYNTHETIC) ();\n+    %90(SYNTHETIC) error;\n+    %95(SYNTHETIC) ();\n+    %96(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %105(SYNTHETIC) ();\n+    %110(SYNTHETIC) error;\n+    %115(SYNTHETIC) ();\n+    %116(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %125(SYNTHETIC) ();\n+    %130(SYNTHETIC) error;\n+    %135(SYNTHETIC) ();\n+    %136(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %145(SYNTHETIC) ();\n+    %150(SYNTHETIC) error;\n+    %155(SYNTHETIC) ();\n+    %156(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %165(SYNTHETIC) ();\n+    %170(SYNTHETIC) error;\n+    %175(SYNTHETIC) ();\n+    %176(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %185(SYNTHETIC) ();\n+    %190(SYNTHETIC) error;\n+    %195(SYNTHETIC) ();\n+    %196(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %205(SYNTHETIC) ();\n+    %210(SYNTHETIC) error;\n+    %215(SYNTHETIC) ();\n+    %216(SYNTHETIC) ballerina/cache:2.0.0:CacheError | ();\n+    %225(SYNTHETIC) ();\n+    %230(SYNTHETIC) error;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb7be8baebd712e8045c975b3d46b816d613b31"}, "originalPosition": 99}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55dca2644e867fc517e9c703d6b5510b7c6b9d57", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/55dca2644e867fc517e9c703d6b5510b7c6b9d57", "committedDate": "2020-09-16T08:16:48Z", "message": "Refactor BirScope and BIRTestUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDQyOTIy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-489442922", "createdAt": "2020-09-16T09:29:07Z", "commit": {"oid": "55dca2644e867fc517e9c703d6b5510b7c6b9d57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOToyOTowOFrOHSoWcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOToyOTowOFrOHSoWcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI5NzUyMA==", "bodyText": "Do we have to do this change? What if we leave it as LOCAL ? @dulvinw @riyafa", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#discussion_r489297520", "createdAt": "2020-09-16T09:29:08Z", "author": {"login": "Kishanthan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -1115,15 +1121,25 @@ public void visit(BLangFail failNode) {\n \n     @Override\n     public void visit(BLangSimpleVariableDef astVarDefStmt) {\n+        VarKind kind;\n+        if (astVarDefStmt.var.symbol.origin == SymbolOrigin.VIRTUAL) {\n+            kind = VarKind.SYNTHETIC;\n+        } else {\n+            kind = VarKind.LOCAL;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55dca2644e867fc517e9c703d6b5510b7c6b9d57"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9f24118c96f36ae1d3de2db12e942fea6f30634", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c9f24118c96f36ae1d3de2db12e942fea6f30634", "committedDate": "2020-09-16T15:04:56Z", "message": "Merge branch 'master' into lables-for-local-variables-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NzM1MTAx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-489735101", "createdAt": "2020-09-16T15:17:18Z", "commit": {"oid": "55dca2644e867fc517e9c703d6b5510b7c6b9d57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NzM3Nzk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25606#pullrequestreview-489737794", "createdAt": "2020-09-16T15:20:03Z", "commit": {"oid": "c9f24118c96f36ae1d3de2db12e942fea6f30634"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4808, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}