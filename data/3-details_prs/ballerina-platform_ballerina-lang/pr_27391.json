{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Njg5Mzk2", "number": 27391, "title": "Fix object type inclusion", "bodyText": "Purpose\n$title.\nThis PR fixes\n\nInclusion of object type descriptor with qualifiers\n\nWhen object type inclusion is used with an object type descriptor with qualifiers (isolated, client, and/or service), it is now mandatory for the referencing object to also have these qualifiers.\nFixes #27224\n\n\nFix inclusion with readonly classes\n\nObject type descriptors can no longer use object type inclusion with readonly classes\nClasses can use object type inclusion with readonly classes only if the referencing classes themselves are readonly\nThe type reference in an object constructor expression can refer to a readonly class only if the object being constructed is readonly\n\n\n\nFixes #26969\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-12-08T19:59:50Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391", "merged": true, "mergeCommit": {"oid": "e52fda487d30af5d76e4f639d12e9e1ca28d13bd"}, "closed": true, "closedAt": "2021-01-05T03:51:36Z", "author": {"login": "MaryamZi"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj3rkSgH2gAyNTM0Njg5Mzk2OjFlMjg4OTBiMjVjYjIyOWY4YjA2YmFkZDU1OTJlNmM1M2JkMGI3OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsvNOOgH2gAyNTM0Njg5Mzk2OmJhMjYwZDJjYzFjNDg2NGY1ZDIwZTA2MTc1NzIyZTk3NjMyNWI5Nzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e28890b25cb229f8b06badd5592e6c53bd0b798", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1e28890b25cb229f8b06badd5592e6c53bd0b798", "committedDate": "2020-12-07T15:56:57Z", "message": "Disallow inclusion of readonly classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f296255426ca329d1577a83ef8c9cc8ccddbb278", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f296255426ca329d1577a83ef8c9cc8ccddbb278", "committedDate": "2020-12-08T08:02:40Z", "message": "Fix inclusion with qualifiers\nWith this change the referencing object should have the same isolated, service, and/or client qualifier(s) as the included type(s)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "053152f2ad9ec3e76bb30f6444ff99ab763039e2", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/053152f2ad9ec3e76bb30f6444ff99ab763039e2", "committedDate": "2020-12-08T19:35:35Z", "message": "Fix object constructor expression with readonly reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c78eb821b9663e2c68cd1e505d38618b4efb703", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6c78eb821b9663e2c68cd1e505d38618b4efb703", "committedDate": "2020-12-08T19:57:30Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a386b01edf1ad47154744a4f46b45b5a77003d3f", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a386b01edf1ad47154744a4f46b45b5a77003d3f", "committedDate": "2020-12-11T03:56:29Z", "message": "Resolve conflicts and merge branch 'master' of https://github.com/ballerina-lang/ballerina into fix-inclusion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODY5MDg4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391#pullrequestreview-549869088", "createdAt": "2020-12-11T07:54:04Z", "commit": {"oid": "a386b01edf1ad47154744a4f46b45b5a77003d3f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "410c2ea80d4eb2c5d1ec34c9147a981293667d32", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/410c2ea80d4eb2c5d1ec34c9147a981293667d32", "committedDate": "2020-12-18T15:14:59Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into fix-inclusion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MTk0NTI3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391#pullrequestreview-556194527", "createdAt": "2020-12-21T08:08:39Z", "commit": {"oid": "a386b01edf1ad47154744a4f46b45b5a77003d3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwODowODozOVrOIJPi_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwODowODozOVrOIJPi_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU2MjgxNA==", "bodyText": "Why don't we move last boolean argument logic inside the function handleObjectConstrExprForReadOnly", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391#discussion_r546562814", "createdAt": "2020-12-21T08:08:39Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -2978,11 +2979,16 @@ public void visit(BLangTypeInit cIExpr) {\n                 if (isObjectConstructorExpr(cIExpr, actualObjectType)) {\n                     BLangClassDefinition classDefForConstructor = getClassDefinitionForObjectConstructorExpr(cIExpr,\n                                                                                                              env);\n+                    List<BLangType> typeRefs = classDefForConstructor.typeRefs;\n \n                     SymbolEnv pkgEnv = symTable.pkgEnvMap.get(env.enclPkg.symbol);\n \n                     if (Symbols.isFlagOn(expType.flags, Flags.READONLY)) {\n-                        handleObjectConstrExprForReadOnlyCET(cIExpr, actualObjectType, classDefForConstructor, pkgEnv);\n+                        handleObjectConstrExprForReadOnly(cIExpr, actualObjectType, classDefForConstructor, pkgEnv,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a386b01edf1ad47154744a4f46b45b5a77003d3f"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MDAwMDU0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391#pullrequestreview-557000054", "createdAt": "2020-12-22T11:08:36Z", "commit": {"oid": "a386b01edf1ad47154744a4f46b45b5a77003d3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMToxMzozN1rOIJ3ioA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMToxMzozN1rOIJ3ioA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIxODA4MA==", "bodyText": "In object constructor type-reference is implemented as a type inclusion. This may be confusing in some scenarios if the error refers to it as \"type inclusion\".", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391#discussion_r547218080", "createdAt": "2020-12-22T11:13:37Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1628,3 +1628,15 @@ error.invalid.isolated.qualifier.on.module.no.init.var.decl=\\\n \n error.binding.pattern.not.yet.supported.in.module.var.decl=\\\n   ''{0}'' binding pattern not yet supported in module variable declaration\n+\n+error.invalid.read.only.class.inclusion.in.object.type.descriptor=\\\n+  object type inclusion cannot be used with a ''readonly class'' in an object type descriptor\n+\n+error.invalid.inclusion.with.mismatched.qualifiers=\\\n+  invalid object type inclusion: missing ''{0}'' qualifier(s) in the referencing object\n+\n+error.invalid.read.only.class.inclusion.in.non.read.only.class=\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a386b01edf1ad47154744a4f46b45b5a77003d3f"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32e0cbb1933c5d6ce9020c66598df477c5806b85", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/32e0cbb1933c5d6ce9020c66598df477c5806b85", "committedDate": "2020-12-22T11:41:31Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into fix-inclusion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d057072bd1890d037487821568ba20eaf28c3a46", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d057072bd1890d037487821568ba20eaf28c3a46", "committedDate": "2020-12-22T14:16:03Z", "message": "Introduce separate error for missing qualifiers in object constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTQxOTA5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27391#pullrequestreview-557141909", "createdAt": "2020-12-22T15:00:05Z", "commit": {"oid": "d057072bd1890d037487821568ba20eaf28c3a46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba260d2cc1c4864f5d20e06175722e976325b979", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ba260d2cc1c4864f5d20e06175722e976325b979", "committedDate": "2021-01-04T05:09:53Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into fix-inclusion"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4763, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}