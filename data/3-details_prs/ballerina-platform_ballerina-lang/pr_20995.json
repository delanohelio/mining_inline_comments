{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNjc1MTc0", "number": 20995, "title": "Add a compiler phase to propagate constants before annotation process", "bodyText": "Purpose\nCurrently the replacement of constants (with literal) is done in desugar state. Since annotations processing runs before desugar state, the following code snippet (where constatnts are used in annotations) produces compilation errors.\nimport ballerina/http;\nimport ballerina/io;\n\nconst string RESOURCE_PATH = \"/{id}\";\n\nservice SampleService on new http:Listener(8080) {\n    \n    @http:ResourceConfig {\n        methods: [\"GET\"],\n        path: RESOURCE_PATH\n    }\n\n    resource function sampleResource(http:Caller caller, http:Request request, string id) {\n        io:print(\"sampleResource\");\n        var x = caller->respond(\"Hello from sampleResource\");\n    }\n\n}\nRelated issues: #20733 #20062\nThis PR fixes this issue.\nFixes #20733\nApproach\nThis is done via introducing a compiler phase before annotation processing to replace constants with literals.\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-11T14:01:43Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20995", "merged": true, "mergeCommit": {"oid": "a8d90917cc832ba9cc4012e5917d9394b1b38eaa"}, "closed": true, "closedAt": "2020-02-24T17:05:31Z", "author": {"login": "irshadnilam"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFeplygH2gAyMzczNjc1MTc0Ojk4NTFmNDIxNjFiNWEyMGUwM2E0ZTJjYmMyZDRkNjFiODc2NmNjOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHgpEFAFqTM2MzU1MjM1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9851f42161b5a20e03a4e2cbc2d4d61b8766cc9d", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9851f42161b5a20e03a4e2cbc2d4d61b8766cc9d", "committedDate": "2020-02-18T09:38:17Z", "message": "Add a compiler phase to propagate constants before annotation process"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f225fb4f04450d44f9858359b257f88c40d6305", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5f225fb4f04450d44f9858359b257f88c40d6305", "committedDate": "2020-02-18T09:38:22Z", "message": "Add test to check if constants are propagated before annotation process"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "918ca4980a0401dbc40052f231ac29922b54c26a", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/918ca4980a0401dbc40052f231ac29922b54c26a", "committedDate": "2020-02-18T09:38:23Z", "message": "Add BLangConstantRef type to hold constants refs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d2b023ab23cb6cee31491b53aac4c8d3c2f3255", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8d2b023ab23cb6cee31491b53aac4c8d3c2f3255", "committedDate": "2020-02-18T09:38:23Z", "message": "Modify annotation mapping in compiler plugin according to latest changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "139ba5ce01ce598694e49fbf0370a697d120fafa", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/139ba5ce01ce598694e49fbf0370a697d120fafa", "committedDate": "2020-02-23T13:23:39Z", "message": "fix language server compiler phases and visit const reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6231c50ed24dde0f6aaaf4c6963d227a9368b717", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6231c50ed24dde0f6aaaf4c6963d227a9368b717", "committedDate": "2020-02-23T16:04:36Z", "message": "Merge pull request #1 from nadeeshaan/fix-20733-irshad-master-local\n\nFix language server compiler phases and visit const reference"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMzA5NzMx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20995#pullrequestreview-363309731", "createdAt": "2020-02-24T11:02:24Z", "commit": {"oid": "6231c50ed24dde0f6aaaf4c6963d227a9368b717"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxMTowMjoyNVrOFtcyRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxMTowMjoyNVrOFtcyRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIwMTg2Mg==", "bodyText": "Missing Licence header.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20995#discussion_r383201862", "createdAt": "2020-02-24T11:02:25Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangConstRef.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.wso2.ballerinalang.compiler.tree.expressions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6231c50ed24dde0f6aaaf4c6963d227a9368b717"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b0f4ad85fff44111fef307d46820fcd6537e85b", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2b0f4ad85fff44111fef307d46820fcd6537e85b", "committedDate": "2020-02-24T11:13:31Z", "message": "Add missing licence header on BLangConstRef"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNTUyMzUw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20995#pullrequestreview-363552350", "createdAt": "2020-02-24T17:05:22Z", "commit": {"oid": "2b0f4ad85fff44111fef307d46820fcd6537e85b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4244, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}