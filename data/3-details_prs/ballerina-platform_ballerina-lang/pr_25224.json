{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NTAxMTQz", "number": 25224, "title": "Refactor and remove unused code from trace store", "bodyText": "Purpose\n\nRefactor and remove unused code from trace store\n\nApproach\n\nRefactor and remove unused code from trace store\n\nSamples\n\nN/A\n\nRemarks\n\nN/A\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-08-12T04:33:54Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224", "merged": true, "mergeCommit": {"oid": "a7bc21715c4bf10e07b71de0344bee2ff704fc29"}, "closed": true, "closedAt": "2020-08-24T05:18:22Z", "author": {"login": "nadundesilva"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-FgccgFqTQ2NTYyNTA5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB7kbigFqTQ3MzEyNTAxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjI1MDkx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#pullrequestreview-465625091", "createdAt": "2020-08-12T06:32:28Z", "commit": {"oid": "27c0096da43a9186eb41739056f1cf4f0c7310cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjozMjoyOFrOG_TkQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjozMjoyOFrOG_TkQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzNDA1MA==", "bodyText": "can't we use tracerName.equalsIgnoreCase(openTracer.getName())", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#discussion_r469034050", "createdAt": "2020-08-12T06:32:28Z", "author": {"login": "riyafa"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/tracer/TracersStore.java", "diffHunk": "@@ -51,31 +52,29 @@ private TracersStore() {\n     public void loadTracers() {\n         ConfigRegistry configRegistry = ConfigRegistry.getInstance();\n         if (configRegistry.getAsBoolean(CONFIG_TRACING_ENABLED)) {\n-\n-            this.tracerStore = new HashMap<>();\n+            String overallProviderName = configRegistry.getConfigOrDefault(CONFIG_OBSERVABILITY_PROVIDER, JAEGER);\n+            String tracerName = configRegistry.getConfigOrDefault(TRACER_NAME_CONFIG, overallProviderName);\n \n             ServiceLoader<OpenTracer> openTracers = ServiceLoader.load(OpenTracer.class);\n-            HashMap<String, OpenTracer> tracerMap = new HashMap<>();\n-            openTracers.forEach(t -> tracerMap.put(t.getName().toLowerCase(), t));\n-\n-            String defaultReporterName = configRegistry.getConfigOrDefault(CONFIG_OBSERVABILITY_PROVIDER, JAEGER);\n-            String tracerName = configRegistry.getConfigOrDefault(TRACER_NAME_CONFIG, defaultReporterName);\n+            for (OpenTracer openTracer : openTracers) {\n+                if (Objects.equals(openTracer.getName().toLowerCase(), tracerName.toLowerCase())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c0096da43a9186eb41739056f1cf4f0c7310cb"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "046eb1d37f2b6605530635bc3cf465cf28a59689", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/046eb1d37f2b6605530635bc3cf465cf28a59689", "committedDate": "2020-08-12T06:38:42Z", "message": "Fix code review suggestions"}, "afterCommit": {"oid": "7c83ef579f23ed8b961b3330a62375361e33302d", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7c83ef579f23ed8b961b3330a62375361e33302d", "committedDate": "2020-08-12T06:40:05Z", "message": "Fix code review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c83ef579f23ed8b961b3330a62375361e33302d", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7c83ef579f23ed8b961b3330a62375361e33302d", "committedDate": "2020-08-12T06:40:05Z", "message": "Fix code review suggestions"}, "afterCommit": {"oid": "4eb71e090000fd18127369855eda329819447c01", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4eb71e090000fd18127369855eda329819447c01", "committedDate": "2020-08-14T08:50:15Z", "message": "Fix code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b2d2c68250594d727b4537f005e36d5d4a02eb", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/24b2d2c68250594d727b4537f005e36d5d4a02eb", "committedDate": "2020-08-17T06:55:53Z", "message": "Refactor and cleanup Tracer Store"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab269a289fda03b9fa5fd62b738f8424d9bfcaa2", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ab269a289fda03b9fa5fd62b738f8424d9bfcaa2", "committedDate": "2020-08-17T06:55:53Z", "message": "Remove unused Span Store"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d6e9bb1182215f9f30648d09e86d870a193fb2f", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6d6e9bb1182215f9f30648d09e86d870a193fb2f", "committedDate": "2020-08-17T06:55:53Z", "message": "Refactor and cleanup Choreo extension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f64c07b0b40a83916a55f3db12527c520373267", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f64c07b0b40a83916a55f3db12527c520373267", "committedDate": "2020-08-17T06:55:53Z", "message": "Refactor and cleanup OpenTracingBallerinaWrapper"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4eb71e090000fd18127369855eda329819447c01", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4eb71e090000fd18127369855eda329819447c01", "committedDate": "2020-08-14T08:50:15Z", "message": "Fix code review suggestions"}, "afterCommit": {"oid": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "committedDate": "2020-08-17T06:55:53Z", "message": "Fix code review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTkyODQ1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#pullrequestreview-468992845", "createdAt": "2020-08-18T05:05:08Z", "commit": {"oid": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NjkxNjg0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#pullrequestreview-469691684", "createdAt": "2020-08-18T17:51:50Z", "commit": {"oid": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzo1MTo1MFrOHCfnew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzo1MTo1MFrOHCfnew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM3NzIxMQ==", "bodyText": "what is the reason for this change? synchronizing on a different object.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#discussion_r472377211", "createdAt": "2020-08-18T17:51:50Z", "author": {"login": "Kishanthan"}, "path": "misc/tracing-extensions/modules/ballerina-choreo-extension/src/main/java/org/ballerinalang/observe/trace/extension/choreo/ChoreoJaegerReporter.java", "diffHunk": "@@ -126,13 +126,15 @@ private synchronized void append(JaegerSpan jaegerSpan) {\n             long duration = jaegerSpan.getDuration() / 1000;    // Jaeger stores duration in microseconds by default\n             ChoreoTraceSpan traceSpan = new ChoreoTraceSpan(spanContext.getTraceId(), spanContext.getSpanId(),\n                     jaegerSpan.getServiceName(), jaegerSpan.getOperationName(), timestamp, duration, tags, references);\n-            traceSpans.add(traceSpan);\n+            synchronized (traceSpans) {\n+                traceSpans.add(traceSpan);\n+            }\n         }\n \n         @Override\n         public void run() {\n             ChoreoTraceSpan[] spansToBeSent;\n-            synchronized (this) {\n+            synchronized (traceSpans) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "committedDate": "2020-08-19T02:36:45Z", "message": "Fix code review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "committedDate": "2020-08-17T06:55:53Z", "message": "Fix code review suggestions"}, "afterCommit": {"oid": "0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "committedDate": "2020-08-19T02:36:45Z", "message": "Fix code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51d6ccb02b65433a521356238f049ec07ce2d965", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51d6ccb02b65433a521356238f049ec07ce2d965", "committedDate": "2020-08-22T09:49:09Z", "message": "Merge remote-tracking branch 'upstream/master' into ballerina-observability"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bc8333c645a7493a1f511154ee051ec9113de53", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8bc8333c645a7493a1f511154ee051ec9113de53", "committedDate": "2020-08-22T09:43:09Z", "message": "Merge remote-tracking branch 'upstream/master' into ballerina-observability"}, "afterCommit": {"oid": "51d6ccb02b65433a521356238f049ec07ce2d965", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51d6ccb02b65433a521356238f049ec07ce2d965", "committedDate": "2020-08-22T09:49:09Z", "message": "Merge remote-tracking branch 'upstream/master' into ballerina-observability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTI1MDE2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#pullrequestreview-473125016", "createdAt": "2020-08-24T05:15:21Z", "commit": {"oid": "51d6ccb02b65433a521356238f049ec07ce2d965"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3639, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}