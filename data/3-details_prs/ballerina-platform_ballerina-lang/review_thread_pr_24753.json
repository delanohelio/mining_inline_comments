{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MzY4NzEx", "number": 24753, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozMzozOFrOEPDP-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDoyNDoyOFrOEPjiZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjE3MzM5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/tree/expressions/FailExpressionNode.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozMzozOFrOGyi-1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozMzozOFrOGyi-1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1NTEyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * {@code FailExpressionNode} represents a expression which forces to return error.\n          \n          \n            \n             * {@code FailExpressionNode} represents an expression which forces to return error.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r455655127", "createdAt": "2020-07-16T09:33:38Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/tree/expressions/FailExpressionNode.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.model.tree.expressions;\n+\n+/**\n+ * {@code FailExpressionNode} represents a expression which forces to return error.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba366ebbd86459508e3c9e3a3154d2122644124"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjE5Mjk2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangFailExpr.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozOTowNlrOGyjLYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozOTowNlrOGyjLYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1ODMzNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * {@code FailExpressionNode} represents a expression which forces to return error.\n          \n          \n            \n             * {@code FailExpressionNode} represents an expression which forces to return error.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r455658337", "createdAt": "2020-07-16T09:39:06Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangFailExpr.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.wso2.ballerinalang.compiler.tree.expressions;\n+\n+import org.ballerinalang.model.tree.NodeKind;\n+import org.ballerinalang.model.tree.expressions.ExpressionNode;\n+import org.ballerinalang.model.tree.expressions.FailExpressionNode;\n+import org.wso2.ballerinalang.compiler.semantics.model.types.BType;\n+import org.wso2.ballerinalang.compiler.tree.BLangNodeVisitor;\n+\n+import java.util.List;\n+\n+/**\n+ * {@code FailExpressionNode} represents a expression which forces to return error.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba366ebbd86459508e3c9e3a3154d2122644124"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjE5NDkzOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangFailExpr.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozOTozOFrOGyjMow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozOTozOFrOGyjMow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1ODY1OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // This list caches types that are equivalent to the error type which are returned by the rhs expression.\n          \n          \n            \n                // This list catches types that are equivalent to the error type which are returned by the rhs expression.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r455658659", "createdAt": "2020-07-16T09:39:38Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangFailExpr.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.wso2.ballerinalang.compiler.tree.expressions;\n+\n+import org.ballerinalang.model.tree.NodeKind;\n+import org.ballerinalang.model.tree.expressions.ExpressionNode;\n+import org.ballerinalang.model.tree.expressions.FailExpressionNode;\n+import org.wso2.ballerinalang.compiler.semantics.model.types.BType;\n+import org.wso2.ballerinalang.compiler.tree.BLangNodeVisitor;\n+\n+import java.util.List;\n+\n+/**\n+ * {@code FailExpressionNode} represents a expression which forces to return error.\n+ *\n+ * @since Swan Lake\n+ */\n+public class BLangFailExpr extends BLangExpression implements FailExpressionNode {\n+\n+    public BLangExpression expr;\n+\n+    // This list caches types that are equivalent to the error type which are returned by the rhs expression.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba366ebbd86459508e3c9e3a3154d2122644124"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjIwMDc1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/tree/STFailExpressionNode.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo0MTowM1rOGyjQEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo0MTowM1rOGyjQEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1OTUzOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * @since 2.0.0\n          \n          \n            \n             * @since Swan Lake", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r455659539", "createdAt": "2020-07-16T09:41:03Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/tree/STFailExpressionNode.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package io.ballerinalang.compiler.internal.parser.tree;\n+\n+import io.ballerinalang.compiler.syntax.tree.FailExpressionNode;\n+import io.ballerinalang.compiler.syntax.tree.Node;\n+import io.ballerinalang.compiler.syntax.tree.NonTerminalNode;\n+import io.ballerinalang.compiler.syntax.tree.SyntaxKind;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+/**\n+ * This is a generated internal syntax tree node.\n+ *\n+ * @since 2.0.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba366ebbd86459508e3c9e3a3154d2122644124"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjIwMzE0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/FailExpressionNode.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo0MTo0NlrOGyjRiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo0MTo0NlrOGyjRiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1OTkxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * @since 2.0.0\n          \n          \n            \n             * @since Swan Lake", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r455659912", "createdAt": "2020-07-16T09:41:46Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/FailExpressionNode.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package io.ballerinalang.compiler.syntax.tree;\n+\n+import io.ballerinalang.compiler.internal.parser.tree.STNode;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This is a generated syntax tree node.\n+ *\n+ * @since 2.0.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba366ebbd86459508e3c9e3a3154d2122644124"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjIwNjQ4OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/query/fail-expression.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo0MjozN1rOGyjTkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo0MjozN1rOGyjTkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2MDQzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r455660432", "createdAt": "2020-07-16T09:42:37Z", "author": {"login": "gimantha"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/query/fail-expression.bal", "diffHunk": "@@ -0,0 +1,13 @@\n+\n+public function testFailExpr() returns error {\n+\n+    error err = error(\"Custom error thrown explicitly.\");\n+    error outputErr = fail err;\n+    return outputErr;\n+}\n+\n+public function testFailAction() returns error {\n+\n+    error err = error(\"Custom error thrown explicitly.\");\n+    fail err;\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba366ebbd86459508e3c9e3a3154d2122644124"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzMxOTI0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMzo0NjozMlrOGzTqMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNjoyMDowOVrOGzZLQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ1MjY1Nw==", "bodyText": "I think FAIL_EXPRESSION also should goes to the below block, and parse as an action-statement.\nAdding it here will parse the fail-expression as call-statement, which is not correct.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456452657", "createdAt": "2020-07-17T13:46:32Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -7259,9 +7310,11 @@ private STNode getExpressionAsStatement(STNode expression) {\n             case METHOD_CALL:\n             case FUNCTION_CALL:\n             case CHECK_EXPRESSION:\n+            case FAIL_EXPRESSION:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU0MzA0MQ==", "bodyText": "Fixed. I'll share the commit Id.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456543041", "createdAt": "2020-07-17T16:20:09Z", "author": {"login": "mohanvive"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -7259,9 +7310,11 @@ private STNode getExpressionAsStatement(STNode expression) {\n             case METHOD_CALL:\n             case FUNCTION_CALL:\n             case CHECK_EXPRESSION:\n+            case FAIL_EXPRESSION:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ1MjY1Nw=="}, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzM4MTQwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDowMjo0M1rOGzUQNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQyMzo1OTo0MVrOGzrUTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjM5MA==", "bodyText": "Since we add a new expression, we need to update few other places such as:\n\nisExpression(...)\nisValidExpressionStart(...)\nisValidExprStart(...)\netc..", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456462390", "createdAt": "2020-07-17T14:02:43Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -4077,6 +4079,8 @@ private STNode parseTerminalExpression(SyntaxKind kind, STNode annots, boolean i\n                 // In the checking action, nested actions are allowed. And that's the only\n                 // place where actions are allowed within an action or an expression.\n                 return parseCheckExpression(isRhsExpr, allowActions, isInConditionalExpr);\n+            case FAIL_KEYWORD:\n+                return parseFailExpression(isRhsExpr, allowActions, isInConditionalExpr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0MDI3MA==", "bodyText": "Done.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456840270", "createdAt": "2020-07-18T23:59:41Z", "author": {"login": "mohanvive"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -4077,6 +4079,8 @@ private STNode parseTerminalExpression(SyntaxKind kind, STNode annots, boolean i\n                 // In the checking action, nested actions are allowed. And that's the only\n                 // place where actions are allowed within an action or an expression.\n                 return parseCheckExpression(isRhsExpr, allowActions, isInConditionalExpr);\n+            case FAIL_KEYWORD:\n+                return parseFailExpression(isRhsExpr, allowActions, isInConditionalExpr);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjM5MA=="}, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzM5MTcwOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/query/FailExpressionTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDowNToyOVrOGzUWnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQyMzo1OTo1M1rOGzrUZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2NDAzMQ==", "bodyText": "Would be good to add some parser-tests as well, as it validates the tree-structure including nodes types, expr-precedence etc.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456464031", "createdAt": "2020-07-17T14:05:29Z", "author": {"login": "SupunS"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/query/FailExpressionTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.test.query;\n+\n+import org.ballerinalang.model.values.BError;\n+import org.ballerinalang.model.values.BValue;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.BRunUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import static org.ballerinalang.test.util.BAssertUtil.validateError;\n+\n+/**\n+ * This contains methods to test fail expressions.\n+ *\n+ * @since Swan Lake\n+ */\n+public class FailExpressionTest {\n+\n+    private CompileResult result;\n+\n+    @BeforeClass\n+    public void setup() {\n+        result = BCompileUtil.compile(\"test-src/query/fail-expression.bal\");\n+    }\n+\n+    @Test(description = \"Test fail expression basic syntax\")\n+    public void testFailExpr() {\n+        BValue[] returnValues = BRunUtil.invoke(result, \"testFailExpr\");\n+        Assert.assertNotNull(returnValues);\n+\n+        Assert.assertTrue(returnValues[0] instanceof BError);\n+        Assert.assertEquals(((BError) returnValues[0]).getMessage(),\n+                \"Custom error thrown explicitly.\");\n+    }\n+\n+    @Test(description = \"Test fail action basic syntax\")\n+    public void testFailAction() {\n+        BValue[] returnValues = BRunUtil.invoke(result, \"testFailAction\");\n+        Assert.assertNotNull(returnValues);\n+\n+        Assert.assertTrue(returnValues[0] instanceof BError);\n+        Assert.assertEquals(((BError) returnValues[0]).getMessage(),\n+                \"Custom error thrown explicitly.\");\n+    }\n+\n+    @Test(description = \"Test negative cases in fail expr\")\n+    public void testFailActionNegative() {\n+        CompileResult negativeResult = BCompileUtil.compile(\"test-src/query/fail-action-negative.bal\");\n+        Assert.assertEquals(negativeResult.getErrorCount(), 1);\n+        int index = 0;\n+\n+        validateError(negativeResult, index++,\n+                \"type 'err' not allowed here; expected an 'error' or a subtype of 'error'.\",\n+                5, 10);\n+    }\n+\n+    @Test(description = \"Test negative cases in fail expr\")\n+    public void testFailExprNegative() {\n+        CompileResult negativeResult = BCompileUtil.compile(\"test-src/query/fail-expression-negative.bal\");\n+        Assert.assertEquals(negativeResult.getErrorCount(), 1);\n+        int index = 0;\n+\n+        validateError(negativeResult, index++,\n+                \"this function must return a result\", 2, 1);\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0MDI5Mw==", "bodyText": "Done.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456840293", "createdAt": "2020-07-18T23:59:53Z", "author": {"login": "mohanvive"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/query/FailExpressionTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.test.query;\n+\n+import org.ballerinalang.model.values.BError;\n+import org.ballerinalang.model.values.BValue;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.BRunUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import static org.ballerinalang.test.util.BAssertUtil.validateError;\n+\n+/**\n+ * This contains methods to test fail expressions.\n+ *\n+ * @since Swan Lake\n+ */\n+public class FailExpressionTest {\n+\n+    private CompileResult result;\n+\n+    @BeforeClass\n+    public void setup() {\n+        result = BCompileUtil.compile(\"test-src/query/fail-expression.bal\");\n+    }\n+\n+    @Test(description = \"Test fail expression basic syntax\")\n+    public void testFailExpr() {\n+        BValue[] returnValues = BRunUtil.invoke(result, \"testFailExpr\");\n+        Assert.assertNotNull(returnValues);\n+\n+        Assert.assertTrue(returnValues[0] instanceof BError);\n+        Assert.assertEquals(((BError) returnValues[0]).getMessage(),\n+                \"Custom error thrown explicitly.\");\n+    }\n+\n+    @Test(description = \"Test fail action basic syntax\")\n+    public void testFailAction() {\n+        BValue[] returnValues = BRunUtil.invoke(result, \"testFailAction\");\n+        Assert.assertNotNull(returnValues);\n+\n+        Assert.assertTrue(returnValues[0] instanceof BError);\n+        Assert.assertEquals(((BError) returnValues[0]).getMessage(),\n+                \"Custom error thrown explicitly.\");\n+    }\n+\n+    @Test(description = \"Test negative cases in fail expr\")\n+    public void testFailActionNegative() {\n+        CompileResult negativeResult = BCompileUtil.compile(\"test-src/query/fail-action-negative.bal\");\n+        Assert.assertEquals(negativeResult.getErrorCount(), 1);\n+        int index = 0;\n+\n+        validateError(negativeResult, index++,\n+                \"type 'err' not allowed here; expected an 'error' or a subtype of 'error'.\",\n+                5, 10);\n+    }\n+\n+    @Test(description = \"Test negative cases in fail expr\")\n+    public void testFailExprNegative() {\n+        CompileResult negativeResult = BCompileUtil.compile(\"test-src/query/fail-expression-negative.bal\");\n+        Assert.assertEquals(negativeResult.getErrorCount(), 1);\n+        int index = 0;\n+\n+        validateError(negativeResult, index++,\n+                \"this function must return a result\", 2, 1);\n+    }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2NDAzMQ=="}, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzM5MzIxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/SyntaxKind.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDowNTo1MVrOGzUXgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNjoyMDozNVrOGzZMMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2NDI1OA==", "bodyText": "Number should be 1337", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456464258", "createdAt": "2020-07-17T14:05:51Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/SyntaxKind.java", "diffHunk": "@@ -289,6 +290,7 @@\n     XML_STEP_EXPRESSION(1334),\n     XML_NAME_PATTERN_CHAIN(1335),\n     XML_ATOMIC_NAME_PATTERN(1336),\n+    FAIL_EXPRESSION(1336),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU0MzI4MQ==", "bodyText": "Fixed. I'll share the commit Id.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456543281", "createdAt": "2020-07-17T16:20:35Z", "author": {"login": "mohanvive"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/SyntaxKind.java", "diffHunk": "@@ -289,6 +290,7 @@\n     XML_STEP_EXPRESSION(1334),\n     XML_NAME_PATTERN_CHAIN(1335),\n     XML_ATOMIC_NAME_PATTERN(1336),\n+    FAIL_EXPRESSION(1336),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2NDI1OA=="}, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzQ2MzQyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDoyNDoyOFrOGzVDEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNjoyMjoxMVrOGzZPBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ3NTQwOQ==", "bodyText": "Need to add this to the resumeParsing() method", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456475409", "createdAt": "2020-07-17T14:24:28Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -5763,6 +5768,52 @@ private STNode parseCheckingKeyword() {\n         }\n     }\n \n+    /**\n+     * Parse fail expression. This method is used to parse both fail expression\n+     * as well as fail action.\n+     *\n+     * <p>\n+     * <code>\n+     * fail-expr := fail-keyword expression\n+     * fail-action := fail-keyword action\n+     * </code>\n+     *\n+     * @param allowActions Allow actions\n+     * @param isRhsExpr    Is rhs expression\n+     * @return Fail expression node\n+     */\n+    private STNode parseFailExpression(boolean isRhsExpr, boolean allowActions, boolean isInConditionalExpr) {\n+\n+        STNode failKeyword = parseFailKeyword();\n+        STNode expr =\n+                parseExpression(OperatorPrecedence.EXPRESSION_ACTION, isRhsExpr, allowActions, isInConditionalExpr);\n+        if (isAction(expr)) {\n+            return STNodeFactory.createFailExpressionNode(SyntaxKind.FAIL_ACTION, failKeyword, expr);\n+        } else {\n+            return STNodeFactory.createFailExpressionNode(SyntaxKind.FAIL_EXPRESSION, failKeyword, expr);\n+        }\n+    }\n+\n+    /**\n+     * Parse fail keyword.\n+     * <p>\n+     * <code>\n+     * fail-keyword := fail\n+     * </code>\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseFailKeyword() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU0NDAwNw==", "bodyText": "Fixed. I'll share the commit Id.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24753#discussion_r456544007", "createdAt": "2020-07-17T16:22:11Z", "author": {"login": "mohanvive"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -5763,6 +5768,52 @@ private STNode parseCheckingKeyword() {\n         }\n     }\n \n+    /**\n+     * Parse fail expression. This method is used to parse both fail expression\n+     * as well as fail action.\n+     *\n+     * <p>\n+     * <code>\n+     * fail-expr := fail-keyword expression\n+     * fail-action := fail-keyword action\n+     * </code>\n+     *\n+     * @param allowActions Allow actions\n+     * @param isRhsExpr    Is rhs expression\n+     * @return Fail expression node\n+     */\n+    private STNode parseFailExpression(boolean isRhsExpr, boolean allowActions, boolean isInConditionalExpr) {\n+\n+        STNode failKeyword = parseFailKeyword();\n+        STNode expr =\n+                parseExpression(OperatorPrecedence.EXPRESSION_ACTION, isRhsExpr, allowActions, isInConditionalExpr);\n+        if (isAction(expr)) {\n+            return STNodeFactory.createFailExpressionNode(SyntaxKind.FAIL_ACTION, failKeyword, expr);\n+        } else {\n+            return STNodeFactory.createFailExpressionNode(SyntaxKind.FAIL_EXPRESSION, failKeyword, expr);\n+        }\n+    }\n+\n+    /**\n+     * Parse fail keyword.\n+     * <p>\n+     * <code>\n+     * fail-keyword := fail\n+     * </code>\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseFailKeyword() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ3NTQwOQ=="}, "originalCommit": {"oid": "819914deae85c3f479a1828ee37bf4ac8e2de204"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 491, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}