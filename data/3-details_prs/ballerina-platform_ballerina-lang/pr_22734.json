{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MTE5NTg3", "number": 22734, "title": "Refactor record, tuple and error var desugar logic", "bodyText": "Purpose\n\nThis PR refactors the desugar logic for record, error and tuple variables. Previously, the desugar logic for these variables were in the visit() methods of their respective definition nodes (e.g., BLangRecordVariableDef). Since these variables can be used in both expressions and statements, this had the side effect of having to include the definitions statements in expressions (e.g., Let expression). With this PR, that desugar logic is moved to the visit() methods of the variables themselves so that they can be used in both expression and statement contexts without any issue. This is a precursor to fixing #22701.", "createdAt": "2020-04-17T13:02:40Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22734", "merged": true, "mergeCommit": {"oid": "4f98af4e279745be38cad83c79a101987b1f835c"}, "closed": true, "closedAt": "2020-04-27T12:58:41Z", "author": {"login": "pubudu91"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaCKuJAFqTM5Nzg3MzE0Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbovmfABqjMyNzQwNzcyMzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODczMTQz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22734#pullrequestreview-397873143", "createdAt": "2020-04-22T06:18:23Z", "commit": {"oid": "3261aeb30b9842563d102de7407ce086ad98facc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjoxODoyNFrOGJlNMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjoxODo0OFrOGJlN7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY5OTk1NQ==", "bodyText": "Not introduced by this PR, but shouldn't we be using different names, starting with $?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22734#discussion_r412699955", "createdAt": "2020-04-22T06:18:24Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1184,17 +1184,76 @@ public void visit(BLangLetExpression letExpression) {\n \n     @Override\n     public void visit(BLangTupleVariable varNode) {\n-        result = varNode;\n+        //  case 1:\n+        //  (string, int) (a, b) = (tuple)\n+        //\n+        //  any[] x = (tuple);\n+        //  string a = x[0];\n+        //  int b = x[1];\n+        //\n+        //  case 2:\n+        //  ((string, float) int)) ((a, b), c)) = (tuple)\n+        //\n+        //  any[] x = (tuple);\n+        //  string a = x[0][0];\n+        //  float b = x[0][1];\n+        //  int c = x[1];\n+\n+        //create tuple destruct block stmt\n+        final BLangBlockStmt blockStmt = ASTBuilderUtil.createBlockStmt(varNode.pos);\n+\n+        //create a simple var for the array 'any[] x = (tuple)' based on the dimension for x\n+        String name = \"tuple\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3261aeb30b9842563d102de7407ce086ad98facc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcwMDE0Mg==", "bodyText": "Shall we refactor in all the moved code?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //create tuple destruct block stmt\n          \n          \n            \n                    // Create tuple destruct block stmt", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22734#discussion_r412700142", "createdAt": "2020-04-22T06:18:48Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1184,17 +1184,76 @@ public void visit(BLangLetExpression letExpression) {\n \n     @Override\n     public void visit(BLangTupleVariable varNode) {\n-        result = varNode;\n+        //  case 1:\n+        //  (string, int) (a, b) = (tuple)\n+        //\n+        //  any[] x = (tuple);\n+        //  string a = x[0];\n+        //  int b = x[1];\n+        //\n+        //  case 2:\n+        //  ((string, float) int)) ((a, b), c)) = (tuple)\n+        //\n+        //  any[] x = (tuple);\n+        //  string a = x[0][0];\n+        //  float b = x[0][1];\n+        //  int c = x[1];\n+\n+        //create tuple destruct block stmt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3261aeb30b9842563d102de7407ce086ad98facc"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3261aeb30b9842563d102de7407ce086ad98facc", "author": {"user": {"login": "pubudu91", "name": "Pubudu Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3261aeb30b9842563d102de7407ce086ad98facc", "committedDate": "2020-04-17T12:55:30Z", "message": "Refactor record, tuple and error var desugar logic"}, "afterCommit": {"oid": "d8a5d3a265f32defb8b17447e4967b2048a98726", "author": {"user": {"login": "pubudu91", "name": "Pubudu Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8a5d3a265f32defb8b17447e4967b2048a98726", "committedDate": "2020-04-23T06:35:23Z", "message": "Address suggestions from the review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNTYwMTQ0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22734#pullrequestreview-400560144", "createdAt": "2020-04-26T23:13:04Z", "commit": {"oid": "d8a5d3a265f32defb8b17447e4967b2048a98726"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e34babacb8304937b33c3f96e82546846b118fc", "author": {"user": {"login": "pubudu91", "name": "Pubudu Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e34babacb8304937b33c3f96e82546846b118fc", "committedDate": "2020-04-27T05:49:48Z", "message": "Refactor record, tuple and error var desugar logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10ac7bea49c9cada9355b77aa164bc288aee4d65", "author": {"user": {"login": "pubudu91", "name": "Pubudu Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/10ac7bea49c9cada9355b77aa164bc288aee4d65", "committedDate": "2020-04-27T05:49:52Z", "message": "Address suggestions from the review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8a5d3a265f32defb8b17447e4967b2048a98726", "author": {"user": {"login": "pubudu91", "name": "Pubudu Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8a5d3a265f32defb8b17447e4967b2048a98726", "committedDate": "2020-04-23T06:35:23Z", "message": "Address suggestions from the review"}, "afterCommit": {"oid": "10ac7bea49c9cada9355b77aa164bc288aee4d65", "author": {"user": {"login": "pubudu91", "name": "Pubudu Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/10ac7bea49c9cada9355b77aa164bc288aee4d65", "committedDate": "2020-04-27T05:49:52Z", "message": "Address suggestions from the review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3577, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}