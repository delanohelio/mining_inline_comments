{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MTMyNjMw", "number": 27477, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNjowMTowMVrOFE0OUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODowMzoxMFrOFE2Z_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNTk0MjU2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNjowMTowMVrOIFBFnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzoxNToyNFrOIFCvWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMTYxMw==", "bodyText": "without checking whether we are in a trx scope here, shall we check it in CodeAnalyzer's visit(BLangInvocation.BLangActionInvocation actionInvocation) ? We have this check there already", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542131613", "createdAt": "2020-12-14T06:01:01Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -4078,6 +4078,8 @@ private BLangOnFailClause createTrxInternalOnFail(Location pos, BLangSimpleVarRe\n \n     @Override\n     public void visit(BLangTransaction transactionNode) {\n+        boolean previousInTransactionContext = this.inTransactionContext;\n+        this.inTransactionContext = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "666cbc49b488c5ca0c63346f838d7336e7cbc313"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE1ODY4Mw==", "bodyText": "Fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542158683", "createdAt": "2020-12-14T07:15:24Z", "author": {"login": "lasinicl"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -4078,6 +4078,8 @@ private BLangOnFailClause createTrxInternalOnFail(Location pos, BLangSimpleVarRe\n \n     @Override\n     public void visit(BLangTransaction transactionNode) {\n+        boolean previousInTransactionContext = this.inTransactionContext;\n+        this.inTransactionContext = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMTYxMw=="}, "originalCommit": {"oid": "666cbc49b488c5ca0c63346f838d7336e7cbc313"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNjMwMDE0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODowMzoxMFrOIFEF6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODozNjoxMlrOIFFOwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE4MDg0MA==", "bodyText": "We already have a flag, called withinTransactionScope, I think we can use it", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542180840", "createdAt": "2020-12-14T08:03:10Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -575,7 +576,9 @@ public void visit(BLangTransaction transactionNode) {\n         int previousCommitCount = this.commitCount;\n         int previousRollbackCount = this.rollbackCount;\n         boolean prevCommitRollbackAllowed = this.commitRollbackAllowed;\n+        boolean prevWithinTransactionBlock = this.withinTransactionBlock;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2009f133d61edfb209028f0b2adcbedcbbb7bdc7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTQ4OA==", "bodyText": "Fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542199488", "createdAt": "2020-12-14T08:36:12Z", "author": {"login": "lasinicl"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -575,7 +576,9 @@ public void visit(BLangTransaction transactionNode) {\n         int previousCommitCount = this.commitCount;\n         int previousRollbackCount = this.rollbackCount;\n         boolean prevCommitRollbackAllowed = this.commitRollbackAllowed;\n+        boolean prevWithinTransactionBlock = this.withinTransactionBlock;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE4MDg0MA=="}, "originalCommit": {"oid": "2009f133d61edfb209028f0b2adcbedcbbb7bdc7"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2737, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}