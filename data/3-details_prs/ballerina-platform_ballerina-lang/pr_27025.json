{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MzYxMTE5", "number": 27025, "title": "Improvements to LS diagnostics, hover and import statement suggestions", "bodyText": "Purpose\n\nWith this,\n\n\nFix the diagnostics issues for multi-module and single file projects in language server\nRevamp the hover support to use the new project API\nRemove the version keyword suggestions for the import statement Fixes #26709\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-11-20T02:14:09Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025", "merged": true, "mergeCommit": {"oid": "950f4c34bf764fdac3ef1c8f341372cab4bc71d4"}, "closed": true, "closedAt": "2020-11-20T05:14:11Z", "author": {"login": "nadeeshaan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddXKXvgH2gAyNTI0MzYxMTE5OjMyZDg2ZGNhN2Y4OTk1MWJmODYxMjk2Y2YyMDFhNGQ0YzIyMmI5OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeQSYHgFqTUzNTEwODg3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "32d86dca7f89951bf861296cf201a4d4c222b995", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/32d86dca7f89951bf861296cf201a4d4c222b995", "committedDate": "2020-11-17T10:40:11Z", "message": "fix diagnostics for multi-module project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2879835957b55cba45b9cd3a1e733da868706dc8", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2879835957b55cba45b9cd3a1e733da868706dc8", "committedDate": "2020-11-18T03:10:33Z", "message": "Merge branch 'prj_api_module_refactor' into prj_api_module_refactor_dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c814e87877720bf2df5c2a6acca9dce8302a399a", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c814e87877720bf2df5c2a6acca9dce8302a399a", "committedDate": "2020-11-19T06:24:08Z", "message": "revamp hover support to work on project API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb4f5dd87cdb1b7cd2ece627c4a069054599c53", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bdb4f5dd87cdb1b7cd2ece627c4a069054599c53", "committedDate": "2020-11-19T06:28:56Z", "message": "Merge branch 'prj_api_module_refactor' into prj_api_module_refactor_dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "245b09ca188e7aac9963a5baea66709a314ef9b7", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/245b09ca188e7aac9963a5baea66709a314ef9b7", "committedDate": "2020-11-19T07:39:18Z", "message": "enable pretty print for failed diagnostics checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a93928147fc29ae6be41f87e51b9f782519bfe78", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a93928147fc29ae6be41f87e51b9f782519bfe78", "committedDate": "2020-11-19T10:48:43Z", "message": "remove version keyword suggestion support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47be20708e345e7bbcc6fac8d43c3cdbde0fc105", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/47be20708e345e7bbcc6fac8d43c3cdbde0fc105", "committedDate": "2020-11-19T10:50:05Z", "message": "Merge branch 'prj_api_module_refactor' into prj_api_module_refactor_dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408f25cca391c49727cd73f657fd572c9aed1360", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/408f25cca391c49727cd73f657fd572c9aed1360", "committedDate": "2020-11-20T02:08:23Z", "message": "Merge branch 'prj_api_module_refactor_dev' into dev-branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MDM0Njgw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#pullrequestreview-535034680", "createdAt": "2020-11-20T02:47:48Z", "commit": {"oid": "408f25cca391c49727cd73f657fd572c9aed1360"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMjo0Nzo0OFrOH27d3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMjo1MzozMlrOH27j4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM1OTQ1Mg==", "bodyText": "Shall we name this as DiagnosticsTest", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#discussion_r527359452", "createdAt": "2020-11-20T02:47:48Z", "author": {"login": "rasika"}, "path": "language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/Diagnostics.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ *  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langserver.diagnostics;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import org.ballerinalang.langserver.LSContextOperation;\n+import org.ballerinalang.langserver.common.utils.CommonUtil;\n+import org.ballerinalang.langserver.commons.DocumentServiceContext;\n+import org.ballerinalang.langserver.contexts.ContextBuilder;\n+import org.ballerinalang.langserver.diagnostic.DiagnosticsHelper;\n+import org.ballerinalang.langserver.util.FileUtils;\n+import org.ballerinalang.langserver.util.TestUtil;\n+import org.ballerinalang.langserver.workspace.BallerinaWorkspaceManager;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.jsonrpc.Endpoint;\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.InvalidPathException;\n+import java.nio.file.Path;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+/**\n+ * Diagnostics tests are covered here.\n+ * \n+ * @since 2.0.0\n+ */\n+public class Diagnostics {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "408f25cca391c49727cd73f657fd572c9aed1360"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2MDk5NA==", "bodyText": "Since the Symbol.docAttachment(); is at Symbol level, can't we have a single function to get markup content? Easier and minimum changes required to maintain against future lang changes.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#discussion_r527360994", "createdAt": "2020-11-20T02:53:32Z", "author": {"login": "rasika"}, "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/hover/HoverUtil.java", "diffHunk": "@@ -54,80 +49,144 @@\n     /**\n      * Get the hover content.\n      *\n-     * @param context        Hover operation context\n-     * @param cursorPosition Cursor position\n+     * @param context Hover operation context\n      * @return {@link Hover} Hover content\n      */\n-    public static Hover getHover(HoverContext context, Position cursorPosition) throws TokenOrSymbolNotFoundException {\n+    public static Hover getHover(HoverContext context) {\n         Optional<SemanticModel> semanticModel = context.workspace().semanticModel(context.filePath());\n         if (semanticModel.isEmpty()) {\n             return HoverUtil.getDefaultHoverObject();\n         }\n-        // TODO: Migrate to the latest\n-        Token tokenAtCursor = TokensUtil.findTokenAtPosition(context, cursorPosition);\n-        context.setTokenAtCursor(tokenAtCursor);\n \n-        return HoverUtil.getDefaultHoverObject();\n+        Position cursorPosition = context.getCursorPosition();\n+        LinePosition linePosition = LinePosition.from(cursorPosition.getLine(), cursorPosition.getCharacter());\n+        Optional<Symbol> symbolAtCursor = semanticModel.get()\n+                .symbol(context.filePath().getFileName().getFileName().toString(), linePosition);\n+        if (symbolAtCursor.isEmpty()) {\n+            return HoverUtil.getDefaultHoverObject();\n+        }\n+\n+        switch (symbolAtCursor.get().kind()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "408f25cca391c49727cd73f657fd572c9aed1360"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8826d68ba42ea4c94eca0cc8cd6600c07d78eb7e", "author": {"user": {"login": "nadeeshaan", "name": "Nadeeshaan Gunasinghe"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8826d68ba42ea4c94eca0cc8cd6600c07d78eb7e", "committedDate": "2020-11-20T03:58:29Z", "message": "rename test class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTA4ODc3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#pullrequestreview-535108877", "createdAt": "2020-11-20T05:13:31Z", "commit": {"oid": "8826d68ba42ea4c94eca0cc8cd6600c07d78eb7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4926, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}