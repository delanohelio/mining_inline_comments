{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzY3OTEz", "number": 20698, "title": "Fix Kafka module styling issues and bring similar java methods to single classes", "bodyText": "Purpose\n\n$subject\nThis is discussed in #20652\n\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-01-22T10:10:49Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698", "merged": true, "mergeCommit": {"oid": "d62f54e4e241824f748b3dc628224a18995d9699"}, "closed": true, "closedAt": "2020-01-30T05:39:25Z", "author": {"login": "ThisaruGuruge"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8hWlLgH2gAyMzY1NzY3OTEzOmIxM2Q4MTNiZjFjNDg5MmFhNDdmMmVjNWQxODJjNTg5MTU0MTcwN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_IXQYAFqTM1MDIzNjE0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b13d813bf1c4892aa47f2ec5d182c5891541707b", "committedDate": "2020-01-21T13:41:55Z", "message": "Revisit Kafka module code and fix styling issues and inter-op classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDUzNDc4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347053478", "createdAt": "2020-01-23T04:33:56Z", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNDozMzo1NlrOFgymFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNDozMzo1NlrOFgymFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyNzcwMA==", "bodyText": "Indentation is different from one to another. Shall we unify it to proper standard?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r369927700", "createdAt": "2020-01-23T04:33:56Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/ballerina/src/kafka/consumer.bal", "diffHunk": "@@ -263,7 +262,7 @@ public type Consumer client object {\n     # + duration - Timeout duration for the get beginning offsets execution.\n     # + return - Starting offsets for the given partitions if executes successfully, returns `kafka:ConsumerError` if the operation fails.\n     public remote function getBeginningOffsets(TopicPartition[] partitions, public int duration = -1)\n-                               returns PartitionOffset[]|ConsumerError {\n+                                                returns PartitionOffset[]|ConsumerError {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDUzNjY2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347053666", "createdAt": "2020-01-23T04:35:06Z", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNDozNTowNlrOFgymnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNDozNTowNlrOFgymnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyNzgzNw==", "bodyText": "Need another space in front of this?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r369927837", "createdAt": "2020-01-23T04:35:06Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/ballerina/src/kafka/producer.bal", "diffHunk": "@@ -448,7 +445,7 @@ function producerSendStringFloat(Producer producer, handle value, handle topic,\n } external;\n \n function producerSendStringByteArray(Producer producer, handle value, handle topic, byte[] key, int? partition = (),\n-                                int? timestamp = ()) returns ProducerError? =\n+                                    int? timestamp = ()) returns ProducerError? =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "originalPosition": 124}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDYyNzU5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347062759", "createdAt": "2020-01-23T05:10:42Z", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNToxMDo0MlrOFgy-pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNToxMDo0MlrOFgy-pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkzMzk5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r369933991", "createdAt": "2020-01-23T05:10:42Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/java/org/ballerinalang/messaging/kafka/nativeimpl/consumer/BrokerConnection.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDY4NDE3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347068417", "createdAt": "2020-01-23T05:36:41Z", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNTozNjo0MVrOFgzUTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNTozNjo0MVrOFgzUTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkzOTUzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r369939532", "createdAt": "2020-01-23T05:36:41Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/java/org/ballerinalang/messaging/kafka/nativeimpl/consumer/ConsumerInformationHandler.java", "diffHunk": "@@ -0,0 +1,252 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDY5NjUy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347069652", "createdAt": "2020-01-23T05:42:18Z", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNTo0MjoxOFrOFgzX_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNTo0MjoxOFrOFgzX_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk0MDQ3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r369940479", "createdAt": "2020-01-23T05:42:18Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/java/org/ballerinalang/messaging/kafka/nativeimpl/consumer/GetOffsets.java", "diffHunk": "@@ -0,0 +1,235 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDcxODY1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347071865", "createdAt": "2020-01-23T05:52:06Z", "commit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNTo1MjowN1rOFgzfBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNTo1MjowN1rOFgzfBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk0MjI3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r369942279", "createdAt": "2020-01-23T05:52:07Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/java/org/ballerinalang/messaging/kafka/nativeimpl/producer/ProducerActions.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13d813bf1c4892aa47f2ec5d182c5891541707b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88937d47630fbd4be129c878643a9a9c6061284f", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/88937d47630fbd4be129c878643a9a9c6061284f", "committedDate": "2020-01-24T06:22:38Z", "message": "Fix observability issues and update license headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3ODMxOTYz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-347831963", "createdAt": "2020-01-24T09:29:01Z", "commit": {"oid": "88937d47630fbd4be129c878643a9a9c6061284f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwOToyOTowMVrOFhX8QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwOToyOTowMVrOFhX8QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzOTU4NA==", "bodyText": "Shall we move this as a class variable?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r370539584", "createdAt": "2020-01-24T09:29:01Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/java/org/ballerinalang/messaging/kafka/observability/KafkaMetricsUtil.java", "diffHunk": "@@ -117,14 +119,27 @@ public static void reportPublish(ObjectValue producerObject, String topic, Objec\n             return;\n         }\n         int size = 0;\n-        try (ByteArrayOutputStream bos = new ByteArrayOutputStream()) {\n-            ObjectOutputStream oos = new ObjectOutputStream(bos);\n-            oos.writeObject(value);\n-            oos.flush();\n-            byte[] data = bos.toByteArray();\n-            size = data.length;\n-        } catch (IOException e) {\n-\n+        if (value instanceof String) {\n+            try {\n+                byte[] bytes = ((String) value).getBytes(\"UTF-8\");\n+                size = bytes.length;\n+            } catch (UnsupportedEncodingException e) {\n+                LoggerFactory.getLogger(KafkaMetricsUtil.class).error(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88937d47630fbd4be129c878643a9a9c6061284f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11e69a2dc803305285200e178f973fb0f3e789af", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/11e69a2dc803305285200e178f973fb0f3e789af", "committedDate": "2020-01-24T09:40:26Z", "message": "Implement code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23419183600f848678a7fe9bc721e79f0762f583", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/23419183600f848678a7fe9bc721e79f0762f583", "committedDate": "2020-01-24T09:41:19Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into kafka-default-serializers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b62097a23b7315b2c49bc33c06bec1a2efffb844", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b62097a23b7315b2c49bc33c06bec1a2efffb844", "committedDate": "2020-01-24T10:00:40Z", "message": "Fix Kafka build failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTMyNDAy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-349932402", "createdAt": "2020-01-29T08:33:02Z", "commit": {"oid": "b62097a23b7315b2c49bc33c06bec1a2efffb844"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwODozMzowMlrOFjAJIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwODozMzowMlrOFjAJIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI0NjgxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        size = 8;\n          \n          \n            \n                        size = Double.BYTES;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#discussion_r372246818", "createdAt": "2020-01-29T08:33:02Z", "author": {"login": "wggihan"}, "path": "stdlib/messaging/kafka/src/main/java/org/ballerinalang/messaging/kafka/observability/KafkaMetricsUtil.java", "diffHunk": "@@ -108,23 +110,32 @@ public static void reportConsumerClose(ObjectValue consumerObject) {\n     /**\n      * Reports a message being published by a Kafka producer.\n      *\n-     * @param producerObject  producer object.\n-     * @param topic Subject the message is published to.\n-     * @param value  Message object.\n+     * @param producerObject producer object.\n+     * @param topic          Subject the message is published to.\n+     * @param value          Message object.\n      */\n     public static void reportPublish(ObjectValue producerObject, String topic, Object value) {\n         if (!ObserveUtils.isMetricsEnabled()) {\n             return;\n         }\n         int size = 0;\n-        try (ByteArrayOutputStream bos = new ByteArrayOutputStream()) {\n-            ObjectOutputStream oos = new ObjectOutputStream(bos);\n-            oos.writeObject(value);\n-            oos.flush();\n-            byte[] data = bos.toByteArray();\n-            size = data.length;\n-        } catch (IOException e) {\n-\n+        if (value instanceof String) {\n+            byte[] bytes = ((String) value).getBytes(StandardCharsets.UTF_8);\n+            size = bytes.length;\n+        } else if (value instanceof Long || value instanceof Double) {\n+            size = 8;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b62097a23b7315b2c49bc33c06bec1a2efffb844"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f60a699e70546ee36d75744b535ced916444fabc", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f60a699e70546ee36d75744b535ced916444fabc", "committedDate": "2020-01-29T08:45:46Z", "message": "Use pre-defined constant instead of variable\n\nCo-Authored-By: Gihan Anuruddha <wggihan@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjM2MTQx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20698#pullrequestreview-350236141", "createdAt": "2020-01-29T16:16:48Z", "commit": {"oid": "f60a699e70546ee36d75744b535ced916444fabc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4350, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}