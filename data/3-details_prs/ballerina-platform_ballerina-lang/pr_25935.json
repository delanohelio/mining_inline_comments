{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MjE2NjIx", "number": 25935, "title": "Add support for `ensureType` langlib function", "bodyText": "Purpose\n\n$Subject.\n\nFixes #25464\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-18T10:10:55Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935", "merged": true, "mergeCommit": {"oid": "80c493c6d4a6b57f57165e9a20ffbc8d0a873f78"}, "closed": true, "closedAt": "2020-10-20T19:17:19Z", "author": {"login": "chiranSachintha"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKB8SbAH2gAyNDg5MjE2NjIxOjM4M2UxZWFhNDYzNDYzNjliYWIxOWY1NTJhZTlhZGEwNDkyNTczYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUdxcBAFqTUxMzA1NTk1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "383e1eaa46346369bab19f552ae9ada0492573b7", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/383e1eaa46346369bab19f552ae9ada0492573b7", "committedDate": "2020-09-18T09:12:14Z", "message": "Add support for json to simple type conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66c7f303809977c10c12c9a0cca3ab7db6d02d4e", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/66c7f303809977c10c12c9a0cca3ab7db6d02d4e", "committedDate": "2020-09-18T09:14:00Z", "message": "Generate `requireType` langLib function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "990c4ed10ca6cc814808b6e65882be3047e5e060", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/990c4ed10ca6cc814808b6e65882be3047e5e060", "committedDate": "2020-09-18T09:16:55Z", "message": "Add 'requireType' langlib method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad88178fd579c234a5ac0b63ca29d14d294e1f99", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ad88178fd579c234a5ac0b63ca29d14d294e1f99", "committedDate": "2020-09-18T09:17:09Z", "message": "Add langlib value tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16b23efed4f3b23be10afad15f0849d54fb82333", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/16b23efed4f3b23be10afad15f0849d54fb82333", "committedDate": "2020-09-18T10:09:56Z", "message": "Fix failure tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d800ba580b552246e49e2024c36e873ff4937a25", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d800ba580b552246e49e2024c36e873ff4937a25", "committedDate": "2020-09-18T11:40:24Z", "message": "Disallow conversion of json with checkpanic expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ca256ecb39e2fec69e9a699cdae6450671b8eb0", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5ca256ecb39e2fec69e9a699cdae6450671b8eb0", "committedDate": "2020-09-18T17:51:13Z", "message": "Fix lang server test fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a4d96036f200ff2fa671443e22bf3ab854770f5", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6a4d96036f200ff2fa671443e22bf3ab854770f5", "committedDate": "2020-09-18T17:55:32Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-25464\n\n\u0001 Conflicts:\n\u0001\tlanguage-server/modules/langserver-core/src/test/resources/completion/new/expression_context/config/field_access_ctx_config1.json\n\u0001\tlanguage-server/modules/langserver-core/src/test/resources/completion/new/expression_context/config/field_access_ctx_config2.json\n\u0001\tlanguage-server/modules/langserver-core/src/test/resources/completion/new/expression_context/config/field_access_ctx_config3.json\n\u0001\tlanguage-server/modules/langserver-core/src/test/resources/completion/new/expression_context/config/optional_field_access_ctx_config1.json\n\u0001\tlanguage-server/modules/langserver-core/src/test/resources/completion/new/expression_context/config/optional_field_access_ctx_config2.json\n\u0001\tlanguage-server/modules/langserver-core/src/test/resources/completion/new/expression_context/config/optional_field_access_ctx_config3.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd", "committedDate": "2020-09-18T18:43:47Z", "message": "Resolve conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjIwNDM2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-497620436", "createdAt": "2020-09-28T15:00:01Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowMDowMVrOHZCCFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowMDowMVrOHZCCFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAwOTc1MA==", "bodyText": "What is the purpose of enabling the desugared field?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r496009750", "createdAt": "2020-09-28T15:00:01Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -5033,6 +5039,19 @@ public void visit(BLangXMLElementAccess xmlElementAccess) {\n         result = rewriteExpr(invocationNode);\n     }\n \n+    private BLangInvocation generateRequireTypeLangLibFunction(BLangAccessExpression fieldAccessExpr) {\n+        ArrayList<BLangExpression> requiredArgs = new ArrayList<>();\n+        BType typedescType = new BTypedescType(fieldAccessExpr.type, null);\n+        BLangTypedescExpr typedescExpr = new BLangTypedescExpr();\n+        typedescExpr.resolvedType = fieldAccessExpr.type;\n+        typedescExpr.type = typedescType;\n+        requiredArgs.add(typedescExpr);\n+        fieldAccessExpr.desugared = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjIxNzIy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-497621722", "createdAt": "2020-09-28T15:01:17Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowMToxN1rOHZCIGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowMToxN1rOHZCIGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAxMTI5MQ==", "bodyText": "Instead of rewriting in L:3770, shall we rewrite before return?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r496011291", "createdAt": "2020-09-28T15:01:17Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -5033,6 +5039,19 @@ public void visit(BLangXMLElementAccess xmlElementAccess) {\n         result = rewriteExpr(invocationNode);\n     }\n \n+    private BLangInvocation generateRequireTypeLangLibFunction(BLangAccessExpression fieldAccessExpr) {\n+        ArrayList<BLangExpression> requiredArgs = new ArrayList<>();\n+        BType typedescType = new BTypedescType(fieldAccessExpr.type, null);\n+        BLangTypedescExpr typedescExpr = new BLangTypedescExpr();\n+        typedescExpr.resolvedType = fieldAccessExpr.type;\n+        typedescExpr.type = typedescType;\n+        requiredArgs.add(typedescExpr);\n+        fieldAccessExpr.desugared = true;\n+        BLangInvocation invocationNode = createLangLibInvocationNode(VALUE_REQUIRE_TYPE, fieldAccessExpr,\n+                requiredArgs, null, fieldAccessExpr.pos);\n+        return invocationNode;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjI5NDEy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-497629412", "createdAt": "2020-09-28T15:09:25Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowOToyNVrOHZCstQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowOToyNVrOHZCstQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAyMDY2MQ==", "bodyText": "Shall we replace the streams?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r496020661", "createdAt": "2020-09-28T15:09:25Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6112,7 +6120,25 @@ private BType checkFieldAccessExpr(BLangFieldBasedAccess fieldAccessExpr, BType\n             if (fieldAccessExpr.fieldKind == FieldKind.WITH_NS) {\n                 resolveXMLNamespace((BLangFieldBasedAccess.BLangNSPrefixedFieldBasedAccess) fieldAccessExpr);\n             }\n-            BType laxFieldAccessType = getLaxFieldAccessType(varRefType);\n+\n+            BType laxFieldAccessType;\n+            if (fieldAccessExpr.isWithCheckExpr && fieldAccessExpr.expectedType.tag != TypeTags.NONE) {\n+                BUnionType unionType = (BUnionType) fieldAccessExpr.expectedType;\n+                // Filter out the list of types which are not equivalent with the error type.\n+                List<BType> expectedTypes = unionType.getMemberTypes().stream()\n+                        .filter(type -> !symTable.errorType.equals(type)).collect(Collectors.toList());\n+                boolean isCovertible = expectedTypes.stream().allMatch(this::isNonStructureJsonType);\n+                BUnionType expectType = BUnionType.create(null, new LinkedHashSet<>(expectedTypes));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxOTk0ODcw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-501994870", "createdAt": "2020-10-05T12:16:49Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoxNjo0OVrOHcaXbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoxNjo0OVrOHcaXbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1NDE1OQ==", "bodyText": "Local variable invocationNode is redundant and we can return directly", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499554159", "createdAt": "2020-10-05T12:16:49Z", "author": {"login": "anupama-pathirage"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -5033,6 +5039,19 @@ public void visit(BLangXMLElementAccess xmlElementAccess) {\n         result = rewriteExpr(invocationNode);\n     }\n \n+    private BLangInvocation generateRequireTypeLangLibFunction(BLangAccessExpression fieldAccessExpr) {\n+        ArrayList<BLangExpression> requiredArgs = new ArrayList<>();\n+        BType typedescType = new BTypedescType(fieldAccessExpr.type, null);\n+        BLangTypedescExpr typedescExpr = new BLangTypedescExpr();\n+        typedescExpr.resolvedType = fieldAccessExpr.type;\n+        typedescExpr.type = typedescType;\n+        requiredArgs.add(typedescExpr);\n+        fieldAccessExpr.desugared = true;\n+        BLangInvocation invocationNode = createLangLibInvocationNode(VALUE_REQUIRE_TYPE, fieldAccessExpr,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxOTk3NzU5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-501997759", "createdAt": "2020-10-05T12:20:49Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoyMDo1MFrOHcafjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoyMDo1MFrOHcafjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1NjIzNw==", "bodyText": "Instead of instanceof check, can we use checkedExpr.expr.getKind() == NodeKind.FIELD_BASED_ACCESS_EXPR ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499556237", "createdAt": "2020-10-05T12:20:50Z", "author": {"login": "anupama-pathirage"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -4456,6 +4461,9 @@ private void visitCheckAndCheckPanicExpr(BLangCheckedExpr checkedExpr) {\n         String operatorType = checkedExpr.getKind() == NodeKind.CHECK_EXPR ? \"check\" : \"checkpanic\";\n         boolean firstVisit = checkedExpr.expr.type == null;\n         BType exprExpType;\n+        if (checkedExpr.expr instanceof BLangFieldBasedAccess && checkedExpr.getKind() == NodeKind.CHECK_EXPR) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxOTk4NDQ4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-501998448", "createdAt": "2020-10-05T12:21:47Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoyMTo0OFrOHcahVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoyMTo0OFrOHcahVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1NjY5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            boolean isCovertible = expectedTypes.stream().allMatch(this::isNonStructureJsonType);\n          \n          \n            \n                            boolean isConvertible = expectedTypes.stream().allMatch(this::isNonStructureJsonType);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499556694", "createdAt": "2020-10-05T12:21:48Z", "author": {"login": "anupama-pathirage"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6112,7 +6120,25 @@ private BType checkFieldAccessExpr(BLangFieldBasedAccess fieldAccessExpr, BType\n             if (fieldAccessExpr.fieldKind == FieldKind.WITH_NS) {\n                 resolveXMLNamespace((BLangFieldBasedAccess.BLangNSPrefixedFieldBasedAccess) fieldAccessExpr);\n             }\n-            BType laxFieldAccessType = getLaxFieldAccessType(varRefType);\n+\n+            BType laxFieldAccessType;\n+            if (fieldAccessExpr.isWithCheckExpr && fieldAccessExpr.expectedType.tag != TypeTags.NONE) {\n+                BUnionType unionType = (BUnionType) fieldAccessExpr.expectedType;\n+                // Filter out the list of types which are not equivalent with the error type.\n+                List<BType> expectedTypes = unionType.getMemberTypes().stream()\n+                        .filter(type -> !symTable.errorType.equals(type)).collect(Collectors.toList());\n+                boolean isCovertible = expectedTypes.stream().allMatch(this::isNonStructureJsonType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDAxMzUz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-502001353", "createdAt": "2020-10-05T12:25:39Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoyNTozOVrOHcapxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjoyNTozOVrOHcapxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1ODg1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # basic simple types are ()|int|float|decimal|string.\n          \n          \n            \n            # The basic simple types are ()|int|float|decimal|string.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499558855", "createdAt": "2020-10-05T12:25:39Z", "author": {"login": "anupama-pathirage"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -200,3 +200,10 @@ public isolated function fromJsonStringWithType(string str, typedesc<anydata> t)\n # - otherwise, the merge fails\n # If the merge fails, then `j1` is unchanged.\n public isolated function mergeJson(json j1, json j2) returns json|error = external;\n+\n+# Converts a field in map<json> to a user-specified basic simple type.\n+# basic simple types are ()|int|float|decimal|string.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDYxMDQ3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-502061047", "createdAt": "2020-10-05T13:34:32Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzozNDozM1rOHcdUDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzozNDozM1rOHcdUDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwMjQ0Ng==", "bodyText": "IINM, we are using @since 2.0.0. @hasithaa ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499602446", "createdAt": "2020-10-05T13:34:33Z", "author": {"login": "anupama-pathirage"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/RequireType.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.TypeChecker;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.types.BType;\n+import org.ballerinalang.jvm.values.ErrorValue;\n+import org.ballerinalang.jvm.values.TypedescValue;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Extern function lang.values:requireType.\n+ *\n+ * @since Swan Lake", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDY3MTQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-502067149", "createdAt": "2020-10-05T13:40:59Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo0MDo1OVrOHcdlWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo0MDo1OVrOHcdlWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwNjg3NA==", "bodyText": "Shall we properly format the json as it will improve the readability?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499606874", "createdAt": "2020-10-05T13:40:59Z", "author": {"login": "anupama-pathirage"}, "path": "langlib/langlib-test/src/test/resources/test-src/valuelib_test.bal", "diffHunk": "@@ -1050,3 +1050,181 @@ function assert(anydata actual, anydata expected) {\n         panic e;\n     }\n }\n+\n+///////////////////////// Tests for `requireType()` ///////////////////////////\n+\n+json  p = {name: \"Chiran\", age: 24, email: \"chirans\", height: 178.5, weight: 72.5, property: (), address: [125.0/3, \"xyz street\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDcxNTY3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-502071567", "createdAt": "2020-10-05T13:45:35Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo0NTozNVrOHcdxfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo0NTozNVrOHcdxfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwOTk4MQ==", "bodyText": "It seems code is not properly formatted. Remove the  space after >", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r499609981", "createdAt": "2020-10-05T13:45:35Z", "author": {"login": "anupama-pathirage"}, "path": "langlib/langlib-test/src/test/resources/test-src/valuelib_test.bal", "diffHunk": "@@ -1050,3 +1050,181 @@ function assert(anydata actual, anydata expected) {\n         panic e;\n     }\n }\n+\n+///////////////////////// Tests for `requireType()` ///////////////////////////\n+\n+json  p = {name: \"Chiran\", age: 24, email: \"chirans\", height: 178.5, weight: 72.5, property: (), address: [125.0/3, \"xyz street\",\n+{province: \"southern\", Country: \"Sri Lanka\"}, 81000], married: false, bloodType: {group: \"O\", RHD: \"+\"}};\n+\n+function testRequireTypeWithInt() returns int|error {\n+    int age = check p.age;\n+    return age;\n+}\n+\n+function testRequireTypeWithInt2() returns int|error {\n+    int height = check p.height;\n+    return height;\n+}\n+\n+function testRequireTypeWithInt3() returns int|error {\n+    int married = check p.married;\n+    return married;\n+}\n+\n+function testRequireTypeWithDecimal() returns decimal|error {\n+    decimal height = check p.height;\n+    return height;\n+}\n+\n+function testRequireTypeWithDecimal2() returns decimal|error {\n+    decimal age = check p.age;\n+    return age;\n+}\n+\n+function testRequireTypeWithNil() returns ()|error {\n+    () property = check p.property;\n+    return property;\n+}\n+\n+function testRequireTypeWithString() returns string|error {\n+    string name = check p.name;\n+    return name;\n+}\n+\n+function testRequireTypeWithFloat() returns float|error {\n+    float weight = check p.weight;\n+    return weight;\n+}\n+\n+function testRequireTypeWithUnion1() returns float|int|error {\n+    float|int weight = check p.weight;\n+    return weight;\n+}\n+\n+function testRequireTypeWithUnion2() returns float|string|error {\n+    float|string name = check p.name;\n+    return name;\n+}\n+\n+function testRequireTypeWithJson1() returns json|error {\n+    json age = check p.age;\n+    return age;\n+}\n+\n+function testRequireTypeWithJson2() returns json|error {\n+    json height = check p.height;\n+    return height;\n+}\n+\n+function testRequireTypeWithJson3() returns json|error {\n+    json bloodType = check p.bloodType;\n+    return bloodType;\n+}\n+\n+function testRequireTypeWithJson4() returns json|error {\n+    json address = check p.address;\n+    return address;\n+}\n+\n+function testRequireTypeWithJson5() returns json|error {\n+    json weight = check p.weight;\n+    return weight;\n+}\n+\n+function testRequireTypeWithJson6() returns json|error {\n+    json isMarried = check p.married;\n+    return isMarried;\n+}\n+\n+function testRequireTypeWithCast1() returns boolean|error {\n+    boolean isMarried = <boolean> check p.married;\n+    return isMarried;\n+}\n+\n+function testRequireTypeWithCast2() returns json[]|error {\n+    json[] address = <json[]> check p.address;\n+    return address;\n+}\n+\n+function testRequireTypeWithCast3() returns map<json>|error {\n+    map<json> bloodType = <map<json>> check p.bloodType;\n+    return bloodType;\n+}\n+\n+function testRequireType() {\n+    decimal h = 178.5;\n+    float h1 = 178.5;\n+    decimal w = 72.5;\n+    json name = \"Chiran\";\n+    json w1 = 72.5;\n+    float|int w2 = 72.5;\n+    float|string name2 = \"Chiran\";\n+    assert(<int> testRequireTypeWithInt(), 24);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTUwNTEw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-503150510", "createdAt": "2020-10-06T16:29:32Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoyOTozMlrOHdQLSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozNzoyNlrOHdQffw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTc4Ng==", "bodyText": "Instead of doing this here, can we not let field access be type-checked normally, and instead do these checks and set the final type in visitCheckAndCheckPanicExpr?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500435786", "createdAt": "2020-10-06T16:29:32Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6112,7 +6120,25 @@ private BType checkFieldAccessExpr(BLangFieldBasedAccess fieldAccessExpr, BType\n             if (fieldAccessExpr.fieldKind == FieldKind.WITH_NS) {\n                 resolveXMLNamespace((BLangFieldBasedAccess.BLangNSPrefixedFieldBasedAccess) fieldAccessExpr);\n             }\n-            BType laxFieldAccessType = getLaxFieldAccessType(varRefType);\n+\n+            BType laxFieldAccessType;\n+            if (fieldAccessExpr.isWithCheckExpr && fieldAccessExpr.expectedType.tag != TypeTags.NONE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNjYzMQ==", "bodyText": "That way we may be able to remove the isWithCheckExpr field too. Doesn't feel right to be adding that info to BLangFieldBasedAccess anyway.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500436631", "createdAt": "2020-10-06T16:30:46Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6112,7 +6120,25 @@ private BType checkFieldAccessExpr(BLangFieldBasedAccess fieldAccessExpr, BType\n             if (fieldAccessExpr.fieldKind == FieldKind.WITH_NS) {\n                 resolveXMLNamespace((BLangFieldBasedAccess.BLangNSPrefixedFieldBasedAccess) fieldAccessExpr);\n             }\n-            BType laxFieldAccessType = getLaxFieldAccessType(varRefType);\n+\n+            BType laxFieldAccessType;\n+            if (fieldAccessExpr.isWithCheckExpr && fieldAccessExpr.expectedType.tag != TypeTags.NONE) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTc4Ng=="}, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNzU0OA==", "bodyText": "While this is the use-case for which we need this method, this isn't the only usage, right? Shall we introduce docs describing the function in a generic manner?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500437548", "createdAt": "2020-10-06T16:32:09Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -200,3 +200,10 @@ public isolated function fromJsonStringWithType(string str, typedesc<anydata> t)\n # - otherwise, the merge fails\n # If the merge fails, then `j1` is unchanged.\n public isolated function mergeJson(json j1, json j2) returns json|error = external;\n+\n+# Converts a field in map<json> to a user-specified basic simple type.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzODIyNw==", "bodyText": "We can use org.ballerinalang.jvm.TypeChecker#getType and then check the type tag instead of the instanceof check.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500438227", "createdAt": "2020-10-06T16:33:11Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/RequireType.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.TypeChecker;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.types.BType;\n+import org.ballerinalang.jvm.values.ErrorValue;\n+import org.ballerinalang.jvm.values.TypedescValue;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Extern function lang.values:requireType.\n+ *\n+ * @since Swan Lake\n+ */\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"requireType\",\n+        args = {@Argument(name = \"v\", type = TypeKind.UNION), @Argument(name = \"type\", type = TypeKind.TYPEDESC)},\n+        returnType = {@ReturnType(type = TypeKind.UNION), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = false\n+)\n+\n+public class RequireType {\n+    public static Object requireType(Strand strand, Object value, TypedescValue type) {\n+        if (value instanceof ErrorValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzODM3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    BType describingType = type.getDescribingType();\n          \n          \n            \n                    return convert(describingType, value);\n          \n          \n            \n                    return convert(type.getDescribingType(), value);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500438372", "createdAt": "2020-10-06T16:33:26Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/RequireType.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.TypeChecker;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.types.BType;\n+import org.ballerinalang.jvm.values.ErrorValue;\n+import org.ballerinalang.jvm.values.TypedescValue;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Extern function lang.values:requireType.\n+ *\n+ * @since Swan Lake\n+ */\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"requireType\",\n+        args = {@Argument(name = \"v\", type = TypeKind.UNION), @Argument(name = \"type\", type = TypeKind.TYPEDESC)},\n+        returnType = {@ReturnType(type = TypeKind.UNION), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = false\n+)\n+\n+public class RequireType {\n+    public static Object requireType(Strand strand, Object value, TypedescValue type) {\n+        if (value instanceof ErrorValue) {\n+            return value;\n+        }\n+        BType describingType = type.getDescribingType();\n+        return convert(describingType, value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDYwNQ==", "bodyText": "Need to check int and string subtypes and boolean too, right?\nI think we can replace the method call with org.wso2.ballerinalang.compiler.semantics.analyzer.Types#isSimpleBasicType\ntypes.isSimpleBasicType(type) || type.tag == TypeTags.JSON;\n\nAlso returning true when expType.tag == TypeTags.JSON where the method name is isNonStructureJsonType doesn't seem right to me.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500440605", "createdAt": "2020-10-06T16:36:50Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -442,6 +442,11 @@ private void checkXMLNamespacePrefixes(List<BLangXMLElementFilter> filters) {\n         }\n     }\n \n+    private boolean isNonStructureJsonType(BType expType) {\n+        return expType.tag == TypeTags.INT || expType.tag == TypeTags.FLOAT || expType.tag == TypeTags.DECIMAL\n+                || expType.tag == TypeTags.NIL || expType.tag == TypeTags.STRING || expType.tag == TypeTags.JSON;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDk1OQ==", "bodyText": "Do we need these comments?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500440959", "createdAt": "2020-10-06T16:37:26Z", "author": {"login": "MaryamZi"}, "path": "langlib/langlib-test/src/test/java/org/ballerinalang/langlib/test/LangLibNegativeTest.java", "diffHunk": "@@ -39,9 +39,18 @@ public void setup() {\n     }\n \n     @Test\n-    public void testTypeParamNegative() {\n+    public void testLangLibNegative() {\n         int err = 0;\n+        //testTypeParamNegative", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTYxOTI3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-503161927", "createdAt": "2020-10-06T16:43:18Z", "commit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0MzoxOFrOHdQubA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0NDoxNlrOHdQw4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NDc4MA==", "bodyText": "Don't we have to ignore all error types? If so we need to check by tag.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .filter(type -> !symTable.errorType.equals(type)).collect(Collectors.toList());\n          \n          \n            \n                                    .filter(type -> type.tag != TypeTags.ERROR).collect(Collectors.toList());", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500444780", "createdAt": "2020-10-06T16:43:18Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6112,7 +6120,25 @@ private BType checkFieldAccessExpr(BLangFieldBasedAccess fieldAccessExpr, BType\n             if (fieldAccessExpr.fieldKind == FieldKind.WITH_NS) {\n                 resolveXMLNamespace((BLangFieldBasedAccess.BLangNSPrefixedFieldBasedAccess) fieldAccessExpr);\n             }\n-            BType laxFieldAccessType = getLaxFieldAccessType(varRefType);\n+\n+            BType laxFieldAccessType;\n+            if (fieldAccessExpr.isWithCheckExpr && fieldAccessExpr.expectedType.tag != TypeTags.NONE) {\n+                BUnionType unionType = (BUnionType) fieldAccessExpr.expectedType;\n+                // Filter out the list of types which are not equivalent with the error type.\n+                List<BType> expectedTypes = unionType.getMemberTypes().stream()\n+                        .filter(type -> !symTable.errorType.equals(type)).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NTQxMQ==", "bodyText": "Even if we were only checking for symTable.errorType, we can just do\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .filter(type -> !symTable.errorType.equals(type)).collect(Collectors.toList());\n          \n          \n            \n                                    .filter(type -> symTable.errorType != type).collect(Collectors.toList());\n          \n      \n    \n    \n  \n\ninstead of equals().", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r500445411", "createdAt": "2020-10-06T16:44:16Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6112,7 +6120,25 @@ private BType checkFieldAccessExpr(BLangFieldBasedAccess fieldAccessExpr, BType\n             if (fieldAccessExpr.fieldKind == FieldKind.WITH_NS) {\n                 resolveXMLNamespace((BLangFieldBasedAccess.BLangNSPrefixedFieldBasedAccess) fieldAccessExpr);\n             }\n-            BType laxFieldAccessType = getLaxFieldAccessType(varRefType);\n+\n+            BType laxFieldAccessType;\n+            if (fieldAccessExpr.isWithCheckExpr && fieldAccessExpr.expectedType.tag != TypeTags.NONE) {\n+                BUnionType unionType = (BUnionType) fieldAccessExpr.expectedType;\n+                // Filter out the list of types which are not equivalent with the error type.\n+                List<BType> expectedTypes = unionType.getMemberTypes().stream()\n+                        .filter(type -> !symTable.errorType.equals(type)).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NDc4MA=="}, "originalCommit": {"oid": "23b5bcbcbd0c8a04c1d83d663fcfcc4f2bdd5acd"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd2aa95a0a4937f522523b80323480c99a51dff8", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd2aa95a0a4937f522523b80323480c99a51dff8", "committedDate": "2020-10-07T10:27:02Z", "message": "Fix review Suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e67afc4f90ef7723bc1b781ba3c75725b55adce0", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e67afc4f90ef7723bc1b781ba3c75725b55adce0", "committedDate": "2020-10-07T10:31:12Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-25464\n\n\u0001 Conflicts:\n\u0001\tlanglib/lang.value/src/main/ballerina/src/lang.value/value.bal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bce4b8a297e2d01734edd6ce7a720a6240b1ad7", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8bce4b8a297e2d01734edd6ce7a720a6240b1ad7", "committedDate": "2020-10-07T13:55:00Z", "message": "Fix merge conflicts"}, "afterCommit": {"oid": "809491a71c27a6e788304e791711ccde7c027635", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/809491a71c27a6e788304e791711ccde7c027635", "committedDate": "2020-10-07T13:56:43Z", "message": "Fix merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e882611325a550333e0ace445bda3d6558adfb5", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5e882611325a550333e0ace445bda3d6558adfb5", "committedDate": "2020-10-07T14:37:52Z", "message": "Fix merge conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "809491a71c27a6e788304e791711ccde7c027635", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/809491a71c27a6e788304e791711ccde7c027635", "committedDate": "2020-10-07T13:56:43Z", "message": "Fix merge conflicts"}, "afterCommit": {"oid": "5e882611325a550333e0ace445bda3d6558adfb5", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5e882611325a550333e0ace445bda3d6558adfb5", "committedDate": "2020-10-07T14:37:52Z", "message": "Fix merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b1d6642d29e150c805aabd72290e9c2f59ec056", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8b1d6642d29e150c805aabd72290e9c2f59ec056", "committedDate": "2020-10-07T16:16:31Z", "message": "Disallow conversion of json to boolean"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1Mjk2OTYy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-505296962", "createdAt": "2020-10-09T01:46:10Z", "commit": {"oid": "8b1d6642d29e150c805aabd72290e9c2f59ec056"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7411a50fbfb6e34beb2cea074e3f8371a12eabf5", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7411a50fbfb6e34beb2cea074e3f8371a12eabf5", "committedDate": "2020-10-09T11:35:06Z", "message": "Fix review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b4a62630d9719421d314b43f78474360f44565d", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b4a62630d9719421d314b43f78474360f44565d", "committedDate": "2020-10-09T11:36:10Z", "message": "Modify langlib value tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f31417eb4a69bd128ebf2bec42eb16a5496e1e0", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3f31417eb4a69bd128ebf2bec42eb16a5496e1e0", "committedDate": "2020-10-09T12:49:45Z", "message": "Fix review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7300318a8cb989116ae0ba14f18d079786e5f930", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7300318a8cb989116ae0ba14f18d079786e5f930", "committedDate": "2020-10-09T12:45:30Z", "message": "Fix review suggestions"}, "afterCommit": {"oid": "3f31417eb4a69bd128ebf2bec42eb16a5496e1e0", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3f31417eb4a69bd128ebf2bec42eb16a5496e1e0", "committedDate": "2020-10-09T12:49:45Z", "message": "Fix review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1ODQ2MzQ2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-505846346", "createdAt": "2020-10-09T16:59:53Z", "commit": {"oid": "3f31417eb4a69bd128ebf2bec42eb16a5496e1e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNjo1OTo1NFrOHfR2Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNjo1OTo1NFrOHfR2Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MDI4Nw==", "bodyText": "In this method, checkedExpr.expr and checkedExpr.getKind() used several times, Shall we extract both as separate variables.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r502560287", "createdAt": "2020-10-09T16:59:54Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -4508,6 +4514,26 @@ private void visitCheckAndCheckPanicExpr(BLangCheckedExpr checkedExpr) {\n             exprExpType = BUnionType.create(null, expType, symTable.errorType);\n         }\n \n+        if (checkedExpr.expr.getKind() == NodeKind.FIELD_BASED_ACCESS_EXPR &&\n+                checkedExpr.getKind() == NodeKind.CHECK_EXPR && types.isUnionOfSimpleBasicTypes(expType)) {\n+            ArrayList<BLangExpression> argExprs = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f31417eb4a69bd128ebf2bec42eb16a5496e1e0"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "127887daca6daf86f4045f08b0a50ca57fd64616", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/127887daca6daf86f4045f08b0a50ca57fd64616", "committedDate": "2020-10-09T21:52:52Z", "message": "Refactor `visitCheckAndCheckPanicExpr` function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0", "committedDate": "2020-10-09T22:01:05Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-25464"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9a6c616d1441bfb015fe7273c4b45fdb85eb31c", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f9a6c616d1441bfb015fe7273c4b45fdb85eb31c", "committedDate": "2020-10-09T20:42:54Z", "message": "Refactor `visitCheckAndCheckPanicExpr` function"}, "afterCommit": {"oid": "127887daca6daf86f4045f08b0a50ca57fd64616", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/127887daca6daf86f4045f08b0a50ca57fd64616", "committedDate": "2020-10-09T21:52:52Z", "message": "Refactor `visitCheckAndCheckPanicExpr` function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDU4NjM5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-506058639", "createdAt": "2020-10-10T02:41:38Z", "commit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMjo0MTozOFrOHfckfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMjo1MTo1NlrOHfcn7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTk5Ng==", "bodyText": "Can we extract check and checkpanic extracted to variables? It seems check has been used couple of places", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r502735996", "createdAt": "2020-10-10T02:41:38Z", "author": {"login": "nadeeshaan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -4500,14 +4506,35 @@ private void handleInputClauseVariables(BLangInputClause bLangInputClause, Symbo\n \n     private void visitCheckAndCheckPanicExpr(BLangCheckedExpr checkedExpr) {\n         String operatorType = checkedExpr.getKind() == NodeKind.CHECK_EXPR ? \"check\" : \"checkpanic\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNjM0NQ==", "bodyText": "Can we rename exprExpType to something meaningful? This is somewhat confusing", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r502736345", "createdAt": "2020-10-10T02:45:27Z", "author": {"login": "nadeeshaan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -4500,14 +4506,35 @@ private void handleInputClauseVariables(BLangInputClause bLangInputClause, Symbo\n \n     private void visitCheckAndCheckPanicExpr(BLangCheckedExpr checkedExpr) {\n         String operatorType = checkedExpr.getKind() == NodeKind.CHECK_EXPR ? \"check\" : \"checkpanic\";\n-        boolean firstVisit = checkedExpr.expr.type == null;\n+        BLangExpression exprWithCheckingKeyword = checkedExpr.expr;\n+        boolean firstVisit = exprWithCheckingKeyword.type == null;\n         BType exprExpType;\n         if (expType == symTable.noType) {\n             exprExpType = symTable.noType;\n         } else {\n             exprExpType = BUnionType.create(null, expType, symTable.errorType);\n         }\n \n+        if (exprWithCheckingKeyword.getKind() == NodeKind.FIELD_BASED_ACCESS_EXPR &&\n+                operatorType.equals(\"check\") && types.isUnionOfSimpleBasicTypes(expType)) {\n+            ArrayList<BLangExpression> argExprs = new ArrayList<>();\n+            BType typedescType = new BTypedescType(expType, null);\n+            BLangTypedescExpr typedescExpr = new BLangTypedescExpr();\n+            typedescExpr.resolvedType = expType;\n+            typedescExpr.type = typedescType;\n+            argExprs.add(exprWithCheckingKeyword);\n+            argExprs.add(typedescExpr);\n+            BLangInvocation invocation = ASTBuilderUtil.createLangLibInvocationNode(FUNCTION_NAME_REQUIRE_TYPE,\n+                    argExprs, exprWithCheckingKeyword, checkedExpr.pos);\n+            BInvokableSymbol invokableSymbol = (BInvokableSymbol) symResolver.lookupLangLibMethod(exprExpType,\n+                    names.fromString(invocation.name.value));\n+            BInvokableType bInvokableType = (BInvokableType) invokableSymbol.type;\n+            bInvokableType.retType = exprExpType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNjU4Nw==", "bodyText": "Do we need a switch case here? We can stick to a simple, single if check and a default return", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r502736587", "createdAt": "2020-10-10T02:48:42Z", "author": {"login": "nadeeshaan"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/Types.java", "diffHunk": "@@ -3588,4 +3588,19 @@ public boolean isOrderedType(BType type) {\n                 return isSimpleBasicType(type.tag);\n         }\n     }\n+\n+    public boolean isUnionOfSimpleBasicTypes(BType type) {\n+        switch (type.tag) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNjg3OQ==", "bodyText": "remove extra new line", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r502736879", "createdAt": "2020-10-10T02:51:56Z", "author": {"login": "nadeeshaan"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/RequireType.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.TypeChecker;\n+import org.ballerinalang.jvm.types.BType;\n+import org.ballerinalang.jvm.types.TypeTags;\n+import org.ballerinalang.jvm.values.ErrorValue;\n+import org.ballerinalang.jvm.values.TypedescValue;\n+\n+/**\n+ * Extern function lang.values:requireType.\n+ *\n+ * @since 2.0.0\n+ */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjAzNTA3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-507203507", "createdAt": "2020-10-13T08:43:31Z", "commit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwODo0MzozMlrOHgb5yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwODo0MzozMlrOHgb5yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc3MzY0MA==", "bodyText": "In the proposal, the function name is ensureType \nballerina-platform/ballerina-spec#487 (comment)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r503773640", "createdAt": "2020-10-13T08:43:32Z", "author": {"login": "hasithaa"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -228,3 +228,13 @@ public isolated function mergeJson(json j1, json j2) returns json|error = @java:\n     'class: \"org.ballerinalang.langlib.value.MergeJson\",\n     name: \"mergeJson\"\n } external;\n+\n+# Converts a field in map<json> to a user-specified basic simple type.\n+# The basic simple types are ()|int|float|decimal|string|boolean.\n+# + v - field value of map<json> or json value\n+# + t - basic simple type to convert to\n+# + return - value belonging to `t`, or error if this cannot be done\n+public isolated function requireType(any|error v, typedesc<any> t) returns any|error =  @java:Method {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feaeb0f0e883c426fc9fd105e9f3145ec58ee4c0"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae1b3aad2a35d6b45e52a0b4054548ffa77f44e1", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae1b3aad2a35d6b45e52a0b4054548ffa77f44e1", "committedDate": "2020-10-14T12:26:10Z", "message": "Fix review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c373aa7bb7fe41e94e6371d7cf8e22c4f06227b5", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c373aa7bb7fe41e94e6371d7cf8e22c4f06227b5", "committedDate": "2020-10-14T13:11:28Z", "message": "Change function name `requireType` to `ensureType`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40d558350956c16de3a49141601a920ea62df1a8", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/40d558350956c16de3a49141601a920ea62df1a8", "committedDate": "2020-10-14T12:54:18Z", "message": "Change function name `requireType` to `ensureType`"}, "afterCommit": {"oid": "c373aa7bb7fe41e94e6371d7cf8e22c4f06227b5", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c373aa7bb7fe41e94e6371d7cf8e22c4f06227b5", "committedDate": "2020-10-14T13:11:28Z", "message": "Change function name `requireType` to `ensureType`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eff9a75a060a2ebe80597f666e5a87b7c809ca0", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0eff9a75a060a2ebe80597f666e5a87b7c809ca0", "committedDate": "2020-10-20T17:07:30Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-25464"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10933c8ebe53b9fd0f786aa54347e413c4fcc16e", "author": {"user": {"login": "chiranSachintha", "name": "Chiran Sachintha"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/10933c8ebe53b9fd0f786aa54347e413c4fcc16e", "committedDate": "2020-10-20T17:37:08Z", "message": "Resolve conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDUzOTk3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-513053997", "createdAt": "2020-10-20T19:14:10Z", "commit": {"oid": "10933c8ebe53b9fd0f786aa54347e413c4fcc16e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOToxNDoxMVrOHlNQ0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOToxNDoxMVrOHlNQ0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3NjY1Nw==", "bodyText": "The return error is {ballerina}TypeCastError which is incorrect IMO. Shall we use EnsureTypeError instead ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#discussion_r508776657", "createdAt": "2020-10-20T19:14:11Z", "author": {"login": "hasithaa"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/EnsureType.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langlib.value;\n+\n+import io.ballerina.runtime.TypeChecker;\n+import io.ballerina.runtime.api.TypeTags;\n+import io.ballerina.runtime.api.types.Type;\n+import io.ballerina.runtime.values.ErrorValue;\n+import io.ballerina.runtime.values.TypedescValue;\n+\n+/**\n+ * Extern function lang.values:ensureType.\n+ *\n+ * @since 2.0.0\n+ */\n+public class EnsureType {\n+    public static Object ensureType(Object value, TypedescValue type) {\n+        if (TypeChecker.getType(value).getTag() == TypeTags.ERROR_TAG) {\n+            return value;\n+        }\n+        return convert(type.getDescribingType(), value);\n+    }\n+\n+    public static Object convert(Type convertType, Object inputValue) {\n+        try {\n+             return TypeChecker.checkCast(inputValue, convertType);\n+        } catch (ErrorValue e) {\n+            return e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10933c8ebe53b9fd0f786aa54347e413c4fcc16e"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDU1OTU1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25935#pullrequestreview-513055955", "createdAt": "2020-10-20T19:16:58Z", "commit": {"oid": "10933c8ebe53b9fd0f786aa54347e413c4fcc16e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4620, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}