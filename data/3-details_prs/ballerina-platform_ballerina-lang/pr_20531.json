{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NTcwODIy", "number": 20531, "title": "Support using type `byte` as `json`", "bodyText": "Purpose\n$title\nFixes #20189\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-01-06T14:40:40Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531", "merged": true, "mergeCommit": {"oid": "b5f7618731095efdd337c5115f109009e0588ba8"}, "closed": true, "closedAt": "2020-01-08T11:07:01Z", "author": {"login": "irshadnilam"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3tdB6AFqTMzODY4OTY5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4TVzdAFqTMzOTc5MzIwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Njg5Njkz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-338689693", "createdAt": "2020-01-06T14:58:03Z", "commit": {"oid": "32818b96bc8e24be153aea2ba5fabdfe6627c216"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNDo1ODowM1rOFafyvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNDo1ODowM1rOFafyvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMyODE4OA==", "bodyText": "What is the reason to interchange this else if condition?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#discussion_r363328188", "createdAt": "2020-01-06T14:58:03Z", "author": {"login": "KavinduZoysa"}, "path": "stdlib/http/src/main/ballerina/src/http/http_commons.bal", "diffHunk": "@@ -242,10 +242,10 @@ function buildResponse(ResponseMessage message) returns Response {\n         response.setTextPayload(message);\n     } else if (message is xml) {\n         response.setXmlPayload(message);\n-    } else if (message is json) {\n-        response.setJsonPayload(message);\n     } else if (message is byte[]) {\n         response.setBinaryPayload(message);\n+    } else if (message is json) {\n+        response.setJsonPayload(message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32818b96bc8e24be153aea2ba5fabdfe6627c216"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4OTk2MjU3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-338996257", "createdAt": "2020-01-07T02:00:10Z", "commit": {"oid": "eaf8b224a046b92a90fad188469b1e3122913f5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDI2NDU5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339026459", "createdAt": "2020-01-07T04:33:30Z", "commit": {"oid": "a29fad7e63a0428078ccf72c2828285faaa3926f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MTMxMzE3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339131317", "createdAt": "2020-01-07T09:50:51Z", "commit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MTkxNzEz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339191713", "createdAt": "2020-01-07T11:55:14Z", "commit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NjQxNzc0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339641774", "createdAt": "2020-01-08T04:32:16Z", "commit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNDozMjoxNlrOFbMeTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNDozMjoxNlrOFbMeTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA2MDIzNg==", "bodyText": "Can we check with the std lib team if this order change is OK? Since this used to be the last case, just to make sure we aren't making the least likely usage the first check.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#discussion_r364060236", "createdAt": "2020-01-08T04:32:16Z", "author": {"login": "MaryamZi"}, "path": "stdlib/messaging/nats/src/main/ballerina/src/nats/commons.bal", "diffHunk": "@@ -20,7 +20,9 @@ public type Content byte[] | boolean | string | int | float | decimal | xml | js\n \n function convertData(Content data) returns string | byte[] | error {\n     string | byte[] | error converted;\n-    if (data is boolean) {\n+    if (data is byte[]) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NjQyMDE3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339642017", "createdAt": "2020-01-08T04:33:34Z", "commit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNDozMzozNVrOFbMfJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwNDozNTo1MlrOFbMgWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA2MDQ1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function testByteAsJsonVal() returns (json) {\n          \n          \n            \n            function testByteAsJsonVal() returns json {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#discussion_r364060454", "createdAt": "2020-01-08T04:33:35Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/jsontype/json-value.bal", "diffHunk": "@@ -13,6 +13,12 @@ function testFloatAsJsonVal () returns (json) {\n     return j;\n }\n \n+function testByteAsJsonVal() returns (json) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA2MDU2MA==", "bodyText": "Shall we reformat this bit? Noticed it's off to the int tests too, can you please reformat that too?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#discussion_r364060560", "createdAt": "2020-01-08T04:34:23Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/byte/byte_as_json_test.bal", "diffHunk": "@@ -0,0 +1,160 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+byte globalByte0 = 0;\n+byte globalByte30 = 30;\n+byte globalByte255 = 255;\n+\n+function testByteAsJson() returns boolean {\n+    byte b0 = 0;\n+    json j0 = b0;\n+    json ig0 = globalByte0;\n+    boolean byte0AsJson = j0 == ig0 && j0 == 0;\n+\n+    byte b30 = 30;\n+    json j30 = takeAJson(b30);\n+    json jg30 = globalByte30;\n+    boolean byte30AsJson = j30 == jg30 && j30 == 30;\n+\n+    byte b255 = 255;\n+    json j255 = b255;\n+    json jg255 = takeAJson(globalByte255);\n+    boolean byte255AsJson = j255 == jg255 && j255 == 255;\n+\n+    return byte0AsJson && byte30AsJson && byte255AsJson;\n+}\n+\n+function takeAJson(json j) returns json {\n+    return j;\n+}\n+\n+function testByteDowncastFromJson() returns boolean {\n+    json j0 = globalByte0;\n+    byte b0 = <byte> j0;\n+\n+    byte bl178 = 178;\n+    json j178 = bl178;\n+    byte b178 = <byte> j178;\n+\n+    json j255 = globalByte255;\n+    byte b255 = <byte> j255;\n+\n+    return b0 == 0 && b178 == 178 && b255 == 255;\n+}\n+\n+function testByteArrayDowncastFromJsonArray() returns boolean {\n+    byte b0 = 0;\n+    byte[] barr = [b0, 1, globalByte255];\n+    json[] jarr = barr;\n+\n+    byte b178 = 178;\n+    jarr.push(b178);\n+\n+    byte[] barr2 = <byte[]> jarr;\n+\n+    return barr2.length() == 4 &&\n+            barr2[0] == 0 && barr2[1] == <byte> 1 && barr2[2] == globalByte255 && barr2[3] == b178;\n+}\n+\n+function testBytesInJsonArray() returns boolean {\n+    byte b0 = 0;\n+    byte b178 = 178;\n+    byte b255 = 255;\n+\n+    json[] arr = [-1, b0, 120, b178, b255, 340];\n+\n+    foreach [int, json][index, val] in arr.enumerate() {\n+\t\tmatch index {\n+\t\t    1 => {\n+\t\t        if val != b0 {\n+\t\t            return false;\n+\t\t        }\n+\t\t    }\n+            3 => {\n+                if val != 178 {\n+                    return false;\n+                }\n+            }\n+            4 => {\n+                if val != b255 {\n+                    return false;\n+                }\n+            }\n+            _ => {\n+                if val != arr[index] {\n+                    return false;\n+                }\n+            }\n+\t\t}\n+\t}\n+\treturn true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA2MDc2MA==", "bodyText": "Instead of removing this and the tests in https://github.com/ballerina-platform/ballerina-lang/pull/20531/files#diff-17ddc3514c16ada932b765cb849594b1L228, shall we change the tests to use some other non-JSON compatible field?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#discussion_r364060760", "createdAt": "2020-01-08T04:35:52Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/expressions/conversion/NativeConversionNegativeTest.java", "diffHunk": "@@ -87,14 +87,6 @@ public void testTupleConversionFail() {\n                 + \"T2]'\");\n     }\n \n-    @Test(description = \"Test converting an unsupported array to json\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b54bce93d3e6eaebe9f988dd17dad3d3bfc59047"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b69fd1a7da5f850e7fedbeef86b809e44a74d754", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b69fd1a7da5f850e7fedbeef86b809e44a74d754", "committedDate": "2020-01-08T06:17:11Z", "message": "Support using type `byte` as `json`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15d4cd8a52daa06990b4b64e2112785ea3cdea7", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f15d4cd8a52daa06990b4b64e2112785ea3cdea7", "committedDate": "2020-01-08T06:22:47Z", "message": "Add more tests on using byte as json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "091f20ee401e21f690630dd8cf20c16f1e9a1b11", "author": {"user": {"login": "irshadnilam", "name": "Irshad Nilam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/091f20ee401e21f690630dd8cf20c16f1e9a1b11", "committedDate": "2020-01-08T06:22:53Z", "message": "Fix conversion tests that no longer valid"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NjY2Nzk5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339666799", "createdAt": "2020-01-08T06:30:31Z", "commit": {"oid": "091f20ee401e21f690630dd8cf20c16f1e9a1b11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NzkzMjAw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20531#pullrequestreview-339793200", "createdAt": "2020-01-08T11:06:42Z", "commit": {"oid": "091f20ee401e21f690630dd8cf20c16f1e9a1b11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4444, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}