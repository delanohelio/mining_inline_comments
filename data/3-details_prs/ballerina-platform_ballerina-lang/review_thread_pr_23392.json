{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNjg4NzY5", "number": 23392, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNTozODo0M1rOD_RCNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0MToyNFrOD_lAZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjY1OTczOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNTozODo0M1rOGZ1MDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzo0MDozM1rOGaSOvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTAyMg==", "bodyText": "is it possible to replace this with a .kind() check?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23392#discussion_r429739022", "createdAt": "2020-05-25T05:38:43Z", "author": {"login": "manuranga"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -2295,6 +2307,56 @@ private BLangUnionTypeNode addUnionType(BLangType lhsTypeNode, BLangType rhsType\n         return unionTypeNode;\n     }\n \n+    private boolean recordTypeDescritorIsAnonymous(RecordTypeDescriptorNode recordTypeDescriptorNode) {\n+        Node parent = recordTypeDescriptorNode.parent();\n+        switch (parent.kind()) {\n+            case UNION_TYPE_DESC:\n+            case ARRAY_TYPE_DESC:\n+            case OPTIONAL_TYPE_DESC:\n+            case TYPE_TEST_EXPRESSION:\n+                return true;\n+            default:\n+                return false;\n+        }\n+    }\n+\n+    private boolean ifInLocalContext(Node parent) {\n+        while (parent != null) {\n+            if (parent instanceof StatementNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15c51b68802dfd34dcc0d31fa2ee95b9b1bd21e0"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxNDg0NQ==", "bodyText": "fixed with 0f3b802. Didnt use the kind() check since there were a lot of types to check. used a flag instead.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23392#discussion_r430214845", "createdAt": "2020-05-26T07:40:33Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -2295,6 +2307,56 @@ private BLangUnionTypeNode addUnionType(BLangType lhsTypeNode, BLangType rhsType\n         return unionTypeNode;\n     }\n \n+    private boolean recordTypeDescritorIsAnonymous(RecordTypeDescriptorNode recordTypeDescriptorNode) {\n+        Node parent = recordTypeDescriptorNode.parent();\n+        switch (parent.kind()) {\n+            case UNION_TYPE_DESC:\n+            case ARRAY_TYPE_DESC:\n+            case OPTIONAL_TYPE_DESC:\n+            case TYPE_TEST_EXPRESSION:\n+                return true;\n+            default:\n+                return false;\n+        }\n+    }\n+\n+    private boolean ifInLocalContext(Node parent) {\n+        while (parent != null) {\n+            if (parent instanceof StatementNode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTAyMg=="}, "originalCommit": {"oid": "15c51b68802dfd34dcc0d31fa2ee95b9b1bd21e0"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTkzMTg5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0MToyNFrOGaUXsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNjoyNDozMFrOGa7BIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0OTkwNA==", "bodyText": "Checking instanceOf is far better than this IMO? Having these type of state variables will make the Transformer fragile WDYT @dulvinw @manuranga ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23392#discussion_r430249904", "createdAt": "2020-05-26T08:41:24Z", "author": {"login": "rasika"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -279,6 +279,8 @@\n     private Stack<TopLevelNode> additionalTopLevelNodes = new Stack<>();\n     /* To keep track of additional statements produced from multi-BLangNode resultant transformations */\n     private Stack<BLangStatement> additionalStatements = new Stack<>();\n+    /* To keep track if we are inside a block statment for the use of type definition creation */\n+    private boolean isInLocalContext = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4e7ef5085697603c36f0ebd4ed57cf93bcd4d59"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MDk0Nw==", "bodyText": "Why we need to track this anyway? while we are traversing through the each statements of the statement list we know we are inside a local context. Can have a parameterized private method to create anon/non-anon record.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23392#discussion_r430250947", "createdAt": "2020-05-26T08:43:11Z", "author": {"login": "rasika"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -279,6 +279,8 @@\n     private Stack<TopLevelNode> additionalTopLevelNodes = new Stack<>();\n     /* To keep track of additional statements produced from multi-BLangNode resultant transformations */\n     private Stack<BLangStatement> additionalStatements = new Stack<>();\n+    /* To keep track if we are inside a block statment for the use of type definition creation */\n+    private boolean isInLocalContext = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0OTkwNA=="}, "originalCommit": {"oid": "c4e7ef5085697603c36f0ebd4ed57cf93bcd4d59"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MjU3Nw==", "bodyText": "The other option is to add a big switch case for all the statements. Thought this is better performance wise. And we are creating type descriptors in both local and module level. hence need to differentiate.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23392#discussion_r430272577", "createdAt": "2020-05-26T09:18:32Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -279,6 +279,8 @@\n     private Stack<TopLevelNode> additionalTopLevelNodes = new Stack<>();\n     /* To keep track of additional statements produced from multi-BLangNode resultant transformations */\n     private Stack<BLangStatement> additionalStatements = new Stack<>();\n+    /* To keep track if we are inside a block statment for the use of type definition creation */\n+    private boolean isInLocalContext = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0OTkwNA=="}, "originalCommit": {"oid": "c4e7ef5085697603c36f0ebd4ed57cf93bcd4d59"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg4MzEwNQ==", "bodyText": "Can't we use this check to differentiate inner type descriptors?\nprivate List<BLangStatement> generateBLangStatements(NodeList<StatementNode> statementNodes) {\n    // ...\n   for (StatementNode statement : statementNodes) {\n      // if type desc\n       createTypeDesc(node, false)\n       //\n   }\n   // ...\n}\n\npublic transform(TypeDescriptorFoo) {\n    createTypeDesc(node, true)\n}\n\nprivate createTypeDesc(node, boolean isInner) {\n    if(isInner) {\n      // create anon\n    } else {\n     // create top-level\n    }\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23392#discussion_r430883105", "createdAt": "2020-05-27T06:24:30Z", "author": {"login": "rasika"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -279,6 +279,8 @@\n     private Stack<TopLevelNode> additionalTopLevelNodes = new Stack<>();\n     /* To keep track of additional statements produced from multi-BLangNode resultant transformations */\n     private Stack<BLangStatement> additionalStatements = new Stack<>();\n+    /* To keep track if we are inside a block statment for the use of type definition creation */\n+    private boolean isInLocalContext = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0OTkwNA=="}, "originalCommit": {"oid": "c4e7ef5085697603c36f0ebd4ed57cf93bcd4d59"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3572, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}