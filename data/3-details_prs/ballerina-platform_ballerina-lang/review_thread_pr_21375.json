{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxODg2NjUz", "number": 21375, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMzo1MDo0MFrODkgbWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1ODoxN1rODkkAtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NjA2NjE2OnYy", "diffSide": "RIGHT", "path": "langlib/lang.map/src/main/java/org/ballerinalang/langlib/map/ToArray.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMzo1MDo0MFrOFw3hXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwNjo1Mjo1N1rOFw6EfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc4NTYyOQ==", "bodyText": "Can we add a test for this method?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21375#discussion_r386785629", "createdAt": "2020-03-03T03:50:40Z", "author": {"login": "pramodya1994"}, "path": "langlib/lang.map/src/main/java/org/ballerinalang/langlib/map/ToArray.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.langlib.map;\n+\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.types.BArrayType;\n+import org.ballerinalang.jvm.types.BMapType;\n+import org.ballerinalang.jvm.types.BRecordType;\n+import org.ballerinalang.jvm.types.BType;\n+import org.ballerinalang.jvm.types.TypeTags;\n+import org.ballerinalang.jvm.values.ArrayValue;\n+import org.ballerinalang.jvm.values.ArrayValueImpl;\n+import org.ballerinalang.jvm.values.MapValue;\n+import org.ballerinalang.langlib.map.util.MapLibUtils;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import java.util.Collection;\n+\n+import static org.ballerinalang.jvm.MapUtils.createOpNotSupportedError;\n+\n+/**\n+ * Function for returning the values of the map as an array. T[] vals = m.toArray();\n+ *\n+ * @since 1.2.0\n+ */\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.map\",\n+        functionName = \"toArray\",\n+        args = {@Argument(name = \"m\", type = TypeKind.MAP)},\n+        returnType = {@ReturnType(type = TypeKind.ARRAY, elementType = TypeKind.ANY)},\n+        isPublic = true\n+)\n+public class ToArray {\n+\n+    public static ArrayValue toArray(Strand strand, MapValue<?, ?> m) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "390692d7e0387b1b4cde798145829afbb77355f3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyNzM4OQ==", "bodyText": "Added with 11bc310", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21375#discussion_r386827389", "createdAt": "2020-03-03T06:52:57Z", "author": {"login": "pubudu91"}, "path": "langlib/lang.map/src/main/java/org/ballerinalang/langlib/map/ToArray.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.langlib.map;\n+\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.types.BArrayType;\n+import org.ballerinalang.jvm.types.BMapType;\n+import org.ballerinalang.jvm.types.BRecordType;\n+import org.ballerinalang.jvm.types.BType;\n+import org.ballerinalang.jvm.types.TypeTags;\n+import org.ballerinalang.jvm.values.ArrayValue;\n+import org.ballerinalang.jvm.values.ArrayValueImpl;\n+import org.ballerinalang.jvm.values.MapValue;\n+import org.ballerinalang.langlib.map.util.MapLibUtils;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import java.util.Collection;\n+\n+import static org.ballerinalang.jvm.MapUtils.createOpNotSupportedError;\n+\n+/**\n+ * Function for returning the values of the map as an array. T[] vals = m.toArray();\n+ *\n+ * @since 1.2.0\n+ */\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.map\",\n+        functionName = \"toArray\",\n+        args = {@Argument(name = \"m\", type = TypeKind.MAP)},\n+        returnType = {@ReturnType(type = TypeKind.ARRAY, elementType = TypeKind.ANY)},\n+        isPublic = true\n+)\n+public class ToArray {\n+\n+    public static ArrayValue toArray(Strand strand, MapValue<?, ?> m) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc4NTYyOQ=="}, "originalCommit": {"oid": "390692d7e0387b1b4cde798145829afbb77355f3"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NjY0NjE2OnYy", "diffSide": "RIGHT", "path": "langlib/langlib-test/src/test/resources/test-src/maplib_test.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1NjowOVrOFw8-5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1NjowOVrOFw8-5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NTEwOQ==", "bodyText": "Shall we also add a test for records where the record fields are all of a single simple basic type?\ntype Bar record {|\n    byte a;\n    byte b;\n    byte...;\n|};\nThis array can also be updated right? Shall we add a test or two to cover updating a value at an index and maybe adding new elements at the end?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21375#discussion_r386875109", "createdAt": "2020-03-03T08:56:09Z", "author": {"login": "MaryamZi"}, "path": "langlib/langlib-test/src/test/resources/test-src/maplib_test.bal", "diffHunk": "@@ -73,3 +73,140 @@ function testReduce() returns float {\n     }, 0.0);\n     return avg;\n }\n+\n+function testBasicToArray() {\n+    map<int> ints = {\"one\": 1, \"two\": 2, \"three\": 3, \"four\": 4, \"five\": 5};\n+    int[] intArr = ints.toArray();\n+\n+    map<float> floats = {\"one\": 1.1, \"two\": 2.2, \"three\": 3.3, \"four\": 4.4, \"five\": 5.5};\n+    float[] floatArr = floats.toArray();\n+\n+    map<decimal> decimals = {\"one\": 1.1, \"two\": 2.2, \"three\": 3.3, \"four\": 4.4, \"five\": 5.5};\n+    decimal[] decimalArr = decimals.toArray();\n+\n+    map<string> strings = {\"a\": \"A\", \"b\": \"B\", \"c\": \"C\"};\n+    string[] stringArr = strings.toArray();\n+\n+    map<boolean> booleans = {\"a\": true, \"b\": false, \"c\": true};\n+    boolean[] booleanArr = booleans.toArray();\n+\n+    map<map<int>> maps = {\"a\": {\"one\": 1, \"two\": 2}, \"b\": {\"three\": 3, \"four\": 4}};\n+    map<int>[] mapArr = maps.toArray();\n+\n+    assert(<int[]>[1, 2, 3, 4, 5], intArr);\n+    assert(<float[]>[1.1, 2.2, 3.3, 4.4, 5.5], floatArr);\n+    assert(<decimal[]>[1.1, 2.2, 3.3, 4.4, 5.5], decimalArr);\n+    assert(<string[]>[\"A\", \"B\", \"C\"], stringArr);\n+    assert(<boolean[]>[true, false, true], booleanArr);\n+    assert(<map<int>[]>[{\"one\": 1, \"two\": 2}, {\"three\": 3, \"four\": 4}], mapArr);\n+}\n+\n+function testLargeMapToArray() {\n+    var fn = function () returns int[] {\n+        int[] arr = [];\n+        foreach var i in 0...999 {\n+            arr[i] = i + 1;\n+        }\n+        return arr;\n+    };\n+\n+    assert(fn(), getLargeMap().toArray());\n+}\n+\n+function getLargeMap() returns map<int> {\n+    map<int> m = {};\n+    foreach var i in 1...1000 {\n+        m[i.toString()] = i;\n+    }\n+    return m;\n+}\n+\n+type Person object {\n+    string name;\n+\n+    function __init(string n) {\n+        self.name = n;\n+    }\n+\n+    function getName() returns string => self.name;\n+};\n+\n+function testMapOfUnionToArray() {\n+    map<int|string|Person> m = {\"i\": 10, \"s\": \"foo\", \"p\": new Person(\"Pubudu\")};\n+    (int|string|Person)[] arr = m.toArray();\n+\n+    assert(10, <anydata>arr[0]);\n+    assert(\"foo\", <anydata>arr[1]);\n+    assertSameRef(m[\"p\"], arr[2]);\n+}\n+\n+type Foo record {|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11bc310f720fce8bda15f8421f4f6ba019c33b2a"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NjY0ODMxOnYy", "diffSide": "RIGHT", "path": "langlib/langlib-test/src/test/resources/test-src/maplib_test.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1Njo0MlrOFw9AHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1Njo0MlrOFw9AHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NTQyMA==", "bodyText": "Shall we return here after checking == instead?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21375#discussion_r386875420", "createdAt": "2020-03-03T08:56:42Z", "author": {"login": "MaryamZi"}, "path": "langlib/langlib-test/src/test/resources/test-src/maplib_test.bal", "diffHunk": "@@ -73,3 +73,140 @@ function testReduce() returns float {\n     }, 0.0);\n     return avg;\n }\n+\n+function testBasicToArray() {\n+    map<int> ints = {\"one\": 1, \"two\": 2, \"three\": 3, \"four\": 4, \"five\": 5};\n+    int[] intArr = ints.toArray();\n+\n+    map<float> floats = {\"one\": 1.1, \"two\": 2.2, \"three\": 3.3, \"four\": 4.4, \"five\": 5.5};\n+    float[] floatArr = floats.toArray();\n+\n+    map<decimal> decimals = {\"one\": 1.1, \"two\": 2.2, \"three\": 3.3, \"four\": 4.4, \"five\": 5.5};\n+    decimal[] decimalArr = decimals.toArray();\n+\n+    map<string> strings = {\"a\": \"A\", \"b\": \"B\", \"c\": \"C\"};\n+    string[] stringArr = strings.toArray();\n+\n+    map<boolean> booleans = {\"a\": true, \"b\": false, \"c\": true};\n+    boolean[] booleanArr = booleans.toArray();\n+\n+    map<map<int>> maps = {\"a\": {\"one\": 1, \"two\": 2}, \"b\": {\"three\": 3, \"four\": 4}};\n+    map<int>[] mapArr = maps.toArray();\n+\n+    assert(<int[]>[1, 2, 3, 4, 5], intArr);\n+    assert(<float[]>[1.1, 2.2, 3.3, 4.4, 5.5], floatArr);\n+    assert(<decimal[]>[1.1, 2.2, 3.3, 4.4, 5.5], decimalArr);\n+    assert(<string[]>[\"A\", \"B\", \"C\"], stringArr);\n+    assert(<boolean[]>[true, false, true], booleanArr);\n+    assert(<map<int>[]>[{\"one\": 1, \"two\": 2}, {\"three\": 3, \"four\": 4}], mapArr);\n+}\n+\n+function testLargeMapToArray() {\n+    var fn = function () returns int[] {\n+        int[] arr = [];\n+        foreach var i in 0...999 {\n+            arr[i] = i + 1;\n+        }\n+        return arr;\n+    };\n+\n+    assert(fn(), getLargeMap().toArray());\n+}\n+\n+function getLargeMap() returns map<int> {\n+    map<int> m = {};\n+    foreach var i in 1...1000 {\n+        m[i.toString()] = i;\n+    }\n+    return m;\n+}\n+\n+type Person object {\n+    string name;\n+\n+    function __init(string n) {\n+        self.name = n;\n+    }\n+\n+    function getName() returns string => self.name;\n+};\n+\n+function testMapOfUnionToArray() {\n+    map<int|string|Person> m = {\"i\": 10, \"s\": \"foo\", \"p\": new Person(\"Pubudu\")};\n+    (int|string|Person)[] arr = m.toArray();\n+\n+    assert(10, <anydata>arr[0]);\n+    assert(\"foo\", <anydata>arr[1]);\n+    assertSameRef(m[\"p\"], arr[2]);\n+}\n+\n+type Foo record {|\n+    string name;\n+    int age;\n+    float weight;\n+    decimal height;\n+    boolean isStudent;\n+|};\n+\n+function testRecordToArray() {\n+    Foo foo = {\n+        name: \"John Doe\",\n+        age: 25,\n+        weight: 65.5,\n+        height: 172.3,\n+        isStudent: true\n+    };\n+\n+    var arr = foo.toArray();\n+\n+    assert(<(string|int|float|decimal|boolean)[]>[\"John Doe\", 25, 65.5, 172.3d, true], arr);\n+}\n+\n+type OpenFoo record {\n+    string name;\n+    int age;\n+    float weight;\n+    decimal height;\n+    boolean isStudent;\n+};\n+\n+function testOpenRecordToArray() {\n+    OpenFoo foo = {\n+        name: \"John Doe\",\n+        age: 25,\n+        weight: 65.5,\n+        height: 172.3,\n+        isStudent: true,\n+        \"location\": \"Sri Lanka\",\n+        \"postalCode\": 12500\n+    };\n+\n+    var arr = foo.toArray();\n+\n+    assert(<(string|int|float|decimal|boolean)[]>[\"John Doe\", 25, 65.5, 172.3d, true, \"Sri Lanka\", 12500], arr);\n+}\n+\n+\n+// Util functions\n+\n+function assert(anydata expected, anydata actual) {\n+    if (expected != actual) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11bc310f720fce8bda15f8421f4f6ba019c33b2a"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NjY1MzM0OnYy", "diffSide": "RIGHT", "path": "langlib/langlib-test/src/test/resources/test-src/maplib_test.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1ODoxN1rOFw9DSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwODo1ODoxN1rOFw9DSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NjIzNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    error e = error(reason);\n          \n          \n            \n                    panic e;\n          \n          \n            \n                    panic error(reason);\n          \n      \n    \n    \n  \n\nJust to be consistent with our usage of reasons, shall we use a simple string as the reason (e.g., \"AssertionError\") and then add this current reason as the message field of the detail?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21375#discussion_r386876235", "createdAt": "2020-03-03T08:58:17Z", "author": {"login": "MaryamZi"}, "path": "langlib/langlib-test/src/test/resources/test-src/maplib_test.bal", "diffHunk": "@@ -73,3 +73,140 @@ function testReduce() returns float {\n     }, 0.0);\n     return avg;\n }\n+\n+function testBasicToArray() {\n+    map<int> ints = {\"one\": 1, \"two\": 2, \"three\": 3, \"four\": 4, \"five\": 5};\n+    int[] intArr = ints.toArray();\n+\n+    map<float> floats = {\"one\": 1.1, \"two\": 2.2, \"three\": 3.3, \"four\": 4.4, \"five\": 5.5};\n+    float[] floatArr = floats.toArray();\n+\n+    map<decimal> decimals = {\"one\": 1.1, \"two\": 2.2, \"three\": 3.3, \"four\": 4.4, \"five\": 5.5};\n+    decimal[] decimalArr = decimals.toArray();\n+\n+    map<string> strings = {\"a\": \"A\", \"b\": \"B\", \"c\": \"C\"};\n+    string[] stringArr = strings.toArray();\n+\n+    map<boolean> booleans = {\"a\": true, \"b\": false, \"c\": true};\n+    boolean[] booleanArr = booleans.toArray();\n+\n+    map<map<int>> maps = {\"a\": {\"one\": 1, \"two\": 2}, \"b\": {\"three\": 3, \"four\": 4}};\n+    map<int>[] mapArr = maps.toArray();\n+\n+    assert(<int[]>[1, 2, 3, 4, 5], intArr);\n+    assert(<float[]>[1.1, 2.2, 3.3, 4.4, 5.5], floatArr);\n+    assert(<decimal[]>[1.1, 2.2, 3.3, 4.4, 5.5], decimalArr);\n+    assert(<string[]>[\"A\", \"B\", \"C\"], stringArr);\n+    assert(<boolean[]>[true, false, true], booleanArr);\n+    assert(<map<int>[]>[{\"one\": 1, \"two\": 2}, {\"three\": 3, \"four\": 4}], mapArr);\n+}\n+\n+function testLargeMapToArray() {\n+    var fn = function () returns int[] {\n+        int[] arr = [];\n+        foreach var i in 0...999 {\n+            arr[i] = i + 1;\n+        }\n+        return arr;\n+    };\n+\n+    assert(fn(), getLargeMap().toArray());\n+}\n+\n+function getLargeMap() returns map<int> {\n+    map<int> m = {};\n+    foreach var i in 1...1000 {\n+        m[i.toString()] = i;\n+    }\n+    return m;\n+}\n+\n+type Person object {\n+    string name;\n+\n+    function __init(string n) {\n+        self.name = n;\n+    }\n+\n+    function getName() returns string => self.name;\n+};\n+\n+function testMapOfUnionToArray() {\n+    map<int|string|Person> m = {\"i\": 10, \"s\": \"foo\", \"p\": new Person(\"Pubudu\")};\n+    (int|string|Person)[] arr = m.toArray();\n+\n+    assert(10, <anydata>arr[0]);\n+    assert(\"foo\", <anydata>arr[1]);\n+    assertSameRef(m[\"p\"], arr[2]);\n+}\n+\n+type Foo record {|\n+    string name;\n+    int age;\n+    float weight;\n+    decimal height;\n+    boolean isStudent;\n+|};\n+\n+function testRecordToArray() {\n+    Foo foo = {\n+        name: \"John Doe\",\n+        age: 25,\n+        weight: 65.5,\n+        height: 172.3,\n+        isStudent: true\n+    };\n+\n+    var arr = foo.toArray();\n+\n+    assert(<(string|int|float|decimal|boolean)[]>[\"John Doe\", 25, 65.5, 172.3d, true], arr);\n+}\n+\n+type OpenFoo record {\n+    string name;\n+    int age;\n+    float weight;\n+    decimal height;\n+    boolean isStudent;\n+};\n+\n+function testOpenRecordToArray() {\n+    OpenFoo foo = {\n+        name: \"John Doe\",\n+        age: 25,\n+        weight: 65.5,\n+        height: 172.3,\n+        isStudent: true,\n+        \"location\": \"Sri Lanka\",\n+        \"postalCode\": 12500\n+    };\n+\n+    var arr = foo.toArray();\n+\n+    assert(<(string|int|float|decimal|boolean)[]>[\"John Doe\", 25, 65.5, 172.3d, true, \"Sri Lanka\", 12500], arr);\n+}\n+\n+\n+// Util functions\n+\n+function assert(anydata expected, anydata actual) {\n+    if (expected != actual) {\n+        typedesc<anydata> expT = typeof expected;\n+        typedesc<anydata> actT = typeof actual;\n+        string reason = \"expected [\" + expected.toString() + \"] of type [\" + expT.toString()\n+                            + \"], but found [\" + actual.toString() + \"] of type [\" + actT.toString() + \"]\";\n+        error e = error(reason);\n+        panic e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11bc310f720fce8bda15f8421f4f6ba019c33b2a"}, "originalPosition": 127}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1074, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}