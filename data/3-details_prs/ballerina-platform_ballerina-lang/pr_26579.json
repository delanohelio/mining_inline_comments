{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NjI4MzQ3", "number": 26579, "title": "Move Strand properties access to Environment api", "bodyText": "Purpose\nproperties are access is moved to Environment api, now there is no need to use strand internal api to use properties.\nProperties are now inherited by child strands\nPart of #25457", "createdAt": "2020-10-25T17:22:50Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579", "merged": true, "mergeCommit": {"oid": "287409c6eafdf1b27fa5abe3356a607a5304ba54"}, "closed": true, "closedAt": "2020-11-10T05:13:46Z", "author": {"login": "manuranga"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXQ0jzgBqjM5MzU5MjQ2MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY5TX3AFqTUyMjUwMDIxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4794701aad69b5e4aa8a03b774bcf01d3e624249", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4794701aad69b5e4aa8a03b774bcf01d3e624249", "committedDate": "2020-10-25T17:16:57Z", "message": "Move Strand properties to Environment api"}, "afterCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7", "committedDate": "2020-10-29T11:53:03Z", "message": "Move Strand properties to Environment api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMzQ4NzAy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#pullrequestreview-521348702", "createdAt": "2020-11-02T06:01:52Z", "commit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNjowMTo1MlrOHr3K5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNjowMTo1MlrOHr3K5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc1NDcyNw==", "bodyText": "Can we move the transaction context to strand locals similar to observation context", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#discussion_r515754727", "createdAt": "2020-11-02T06:01:52Z", "author": {"login": "warunalakshitha"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/scheduling/Strand.java", "diffHunk": "@@ -71,15 +70,14 @@\n     public boolean blockedOnExtern;\n     public Set<ChannelDetails> channelDetails;\n     public Set<SchedulerItem> dependants;\n-    public ObserverContext observerContext;\n     public boolean cancel;\n \n     SchedulerItem schedulerItem;\n     List<WaitContext> waitingContexts;\n     WaitContext waitContext;\n     ItemGroup strandGroup;\n \n-    private Map<String, Object> globalProps;\n+    public Map<String, Object> globalProps;\n     public TransactionLocalContext currentTrxContext;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMzU0NDY2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#pullrequestreview-521354466", "createdAt": "2020-11-02T06:20:01Z", "commit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNjoyMDowMVrOHr3djw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNjoyMjo1NlrOHr3gqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc1OTUwMw==", "bodyText": "This is not necessary. Is it? Because in the next line it will automatically throw Nullpointer and throwing this exception explicitly is not recommended AFAIK", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#discussion_r515759503", "createdAt": "2020-11-02T06:20:01Z", "author": {"login": "riyafa"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/api/Runtime.java", "diffHunk": "@@ -86,15 +83,10 @@ public Object invokeMethodAsync(BObject object, String methodName, String strand\n      */\n     public void invokeMethodAsync(BObject object, String methodName, String strandName, StrandMetadata metadata,\n                                   Callback callback, Map<String, Object> properties, Object... args) {\n-        Function<Object[], Object> func = objects -> {\n-            Strand strand = (Strand) objects[0];\n-            if (ObserveUtils.isObservabilityEnabled() && properties != null &&\n-                    properties.containsKey(ObservabilityConstants.KEY_OBSERVER_CONTEXT)) {\n-                strand.observerContext =\n-                        (ObserverContext) properties.remove(ObservabilityConstants.KEY_OBSERVER_CONTEXT);\n-            }\n-            return object.call(strand, methodName, args);\n-        };\n+        if (object == null) {\n+            throw new NullPointerException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc1OTgzOA==", "bodyText": "Shall we also create an issue for the Todo and link here or fix the Todo before the PR is merged?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#discussion_r515759838", "createdAt": "2020-11-02T06:21:15Z", "author": {"login": "riyafa"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/scheduling/Scheduler.java", "diffHunk": "@@ -456,7 +457,8 @@ public FutureValue createFuture(Strand parent, Callback callback, Map<String, Ob\n \n     private FutureValue createFuture(Strand parent, Callback callback, Type constraint, Strand newStrand) {\n         if (parent != null) {\n-            newStrand.observerContext = parent.observerContext;\n+            //TODO: improve by using a copy on write map", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc2MDI5Ng==", "bodyText": "Shall we try not to make public variables? We can use getters for any future variables. I know this class already uses a lot of public variables, but we can try to reduce them in the future", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#discussion_r515760296", "createdAt": "2020-11-02T06:22:56Z", "author": {"login": "riyafa"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/scheduling/Strand.java", "diffHunk": "@@ -71,15 +70,14 @@\n     public boolean blockedOnExtern;\n     public Set<ChannelDetails> channelDetails;\n     public Set<SchedulerItem> dependants;\n-    public ObserverContext observerContext;\n     public boolean cancel;\n \n     SchedulerItem schedulerItem;\n     List<WaitContext> waitingContexts;\n     WaitContext waitContext;\n     ItemGroup strandGroup;\n \n-    private Map<String, Object> globalProps;\n+    public Map<String, Object> globalProps;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMzc5OTg0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#pullrequestreview-521379984", "createdAt": "2020-11-02T07:26:40Z", "commit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzoyNjo0MFrOHr4sAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzoyNjo0MFrOHr4sAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc3OTU4Nw==", "bodyText": "Why did we make this public? I thought we are getting rid of it?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#discussion_r515779587", "createdAt": "2020-11-02T07:26:40Z", "author": {"login": "Kishanthan"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/scheduling/Strand.java", "diffHunk": "@@ -71,15 +70,14 @@\n     public boolean blockedOnExtern;\n     public Set<ChannelDetails> channelDetails;\n     public Set<SchedulerItem> dependants;\n-    public ObserverContext observerContext;\n     public boolean cancel;\n \n     SchedulerItem schedulerItem;\n     List<WaitContext> waitingContexts;\n     WaitContext waitContext;\n     ItemGroup strandGroup;\n \n-    private Map<String, Object> globalProps;\n+    public Map<String, Object> globalProps;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjQxMzMx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#pullrequestreview-522241331", "createdAt": "2020-11-03T07:41:03Z", "commit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo0MTowM1rOHsi2gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo0MTowM1rOHsi2gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MDQwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        //TODO: improve by using a copy on write map\n          \n          \n            \n                        //TODO: improve by using a copy on write map #26710", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#discussion_r516470403", "createdAt": "2020-11-03T07:41:03Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/scheduling/Scheduler.java", "diffHunk": "@@ -456,7 +457,8 @@ public FutureValue createFuture(Strand parent, Callback callback, Map<String, Ob\n \n     private FutureValue createFuture(Strand parent, Callback callback, Type constraint, Strand newStrand) {\n         if (parent != null) {\n-            newStrand.observerContext = parent.observerContext;\n+            //TODO: improve by using a copy on write map", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca15ea34aa10b9588b2a1df0aeeca8ff8e0adea7"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69cc7028c86eee9f51898d66993a98818bf765d8", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/69cc7028c86eee9f51898d66993a98818bf765d8", "committedDate": "2020-11-03T07:41:25Z", "message": "Add todo reference"}, "afterCommit": {"oid": "709b118bc674ef932f614da08cf4ca199c04e4c0", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/709b118bc674ef932f614da08cf4ca199c04e4c0", "committedDate": "2020-11-03T10:24:35Z", "message": "Restrict access to scheduling java module"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "709b118bc674ef932f614da08cf4ca199c04e4c0", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/709b118bc674ef932f614da08cf4ca199c04e4c0", "committedDate": "2020-11-03T10:24:35Z", "message": "Restrict access to scheduling java module"}, "afterCommit": {"oid": "8aad22cb323c15bbe7e030339cef3d25470b86aa", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8aad22cb323c15bbe7e030339cef3d25470b86aa", "committedDate": "2020-11-03T10:58:10Z", "message": "Restrict access to scheduling java module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "117c4da1106b562eb2dca2ff98202577d520fc16", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/117c4da1106b562eb2dca2ff98202577d520fc16", "committedDate": "2020-11-03T11:13:33Z", "message": "Move Strand properties to Environment api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc56b09c2e77e1102ad487d058a825e33390762b", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cc56b09c2e77e1102ad487d058a825e33390762b", "committedDate": "2020-11-03T11:13:45Z", "message": "Restrict access to scheduling java module"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8aad22cb323c15bbe7e030339cef3d25470b86aa", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8aad22cb323c15bbe7e030339cef3d25470b86aa", "committedDate": "2020-11-03T10:58:10Z", "message": "Restrict access to scheduling java module"}, "afterCommit": {"oid": "cc56b09c2e77e1102ad487d058a825e33390762b", "author": {"user": {"login": "manuranga", "name": "manuranga perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cc56b09c2e77e1102ad487d058a825e33390762b", "committedDate": "2020-11-03T11:13:45Z", "message": "Restrict access to scheduling java module"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTAwMjE5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26579#pullrequestreview-522500219", "createdAt": "2020-11-03T13:37:10Z", "commit": {"oid": "cc56b09c2e77e1102ad487d058a825e33390762b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4262, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}