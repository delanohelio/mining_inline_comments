{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4OTA2MzEz", "number": 23302, "title": "Implement `table<T> & readonly` and fix several issues with `xml<T> & readonly` ", "bodyText": "Purpose\nSupport T & readonly for table types.\nFixes #23032\nFix the following issues with immutable XML elements.\n\nFixes attribute setting failing on initialization for immutable elements.\nFixes the type of an immutable element's attribute map not being marked immutable.\nFixes children of an immutable element not being marked immutable.\n\nFixes #23276\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-05-16T03:14:19Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302", "merged": true, "mergeCommit": {"oid": "ac9058f25bd2282a6d4a93d4905743bc026aef7c"}, "closed": true, "closedAt": "2020-05-31T16:39:32Z", "author": {"login": "MaryamZi"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchflDrgH2gAyNDE4OTA2MzEzOjE3Zjc2NDMwOWU3YWMwMTIxY2UwYWM1OTQyNDUxNTUxZjM0YWFlOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmsTfbgH2gAyNDE4OTA2MzEzOjhlODgwN2JjOWNiZjRiMzUxMTA1ZDFmN2U1ZWQxMDdmYjYxMjFhYWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "17f764309e7ac0121ce0ac5942451551f34aae8b", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/17f764309e7ac0121ce0ac5942451551f34aae8b", "committedDate": "2020-05-15T10:33:07Z", "message": "Separate out XML attr. setting on creation vs subsequent upate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "761cfee34e674f3c5436ab42a85a0b195bedc99b", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/761cfee34e674f3c5436ab42a85a0b195bedc99b", "committedDate": "2020-05-15T18:25:53Z", "message": "Fix attribute map not being created as immutable for immutable elements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6466a29d6057327a56d1f4b4922d8685aa263f2c", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6466a29d6057327a56d1f4b4922d8685aa263f2c", "committedDate": "2020-05-16T02:57:20Z", "message": "Fix immutability of XML elements with children and add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f181dc7455a7dd49c0e98b41ac54353d725f76bb", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f181dc7455a7dd49c0e98b41ac54353d725f76bb", "committedDate": "2020-05-17T14:13:15Z", "message": "Merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63b6e938d45499c87146b1ed281a6740f9a7f496", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/63b6e938d45499c87146b1ed281a6740f9a7f496", "committedDate": "2020-05-19T04:20:23Z", "message": "Implement readonly intersection type for the table type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79cede70b3b8bafda1ca303da90d42c348e4408e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/79cede70b3b8bafda1ca303da90d42c348e4408e", "committedDate": "2020-05-19T13:46:27Z", "message": "Add tests for readonly table types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0a5761b4a745773f29058fadd83a46b1716ec78", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f0a5761b4a745773f29058fadd83a46b1716ec78", "committedDate": "2020-05-19T13:50:32Z", "message": "Add readonly type to type reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4860373eccac0b5361597ba569682fbc4b6fc0e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e4860373eccac0b5361597ba569682fbc4b6fc0e", "committedDate": "2020-05-19T14:40:31Z", "message": "Fix selectively immutable type check for tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2ec6bf8bddc6a84014e2b36b525a323b6a372e93", "committedDate": "2020-05-25T08:43:38Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12babdd9a99f08378fe4f9ed9ed9a51bce506fed", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12babdd9a99f08378fe4f9ed9ed9a51bce506fed", "committedDate": "2020-05-25T08:02:45Z", "message": "Resolve conflicts and merge master"}, "afterCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2ec6bf8bddc6a84014e2b36b525a323b6a372e93", "committedDate": "2020-05-25T08:43:38Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODEyNDUw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#pullrequestreview-419812450", "createdAt": "2020-05-28T06:32:27Z", "commit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNjozMjoyOFrOGbnX-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzowMzoxOFrOGboKWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYwOTg0OQ==", "bodyText": "I think due to line L279 - L281 we don't need a null check on defaultNsUri", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r431609849", "createdAt": "2020-05-28T06:32:28Z", "author": {"login": "KRVPerera"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/XMLFactory.java", "diffHunk": "@@ -284,13 +286,9 @@ public static XMLValue createXMLElement(XMLQName startTagName, String defaultNsU\n \n         if (nsUri == null) {\n             return new XMLItem(new QName(defaultNsUri, startTagName.getLocalName(), prefix), readonly);\n-        } else {\n-            XMLItem xmlItem = new XMLItem(new QName(nsUri, startTagName.getLocalName(), prefix), readonly);\n-            if (defaultNsUri != null && !defaultNsUri.isEmpty()) {\n-                xmlItem.setAttribute(XMLConstants.XMLNS_ATTRIBUTE, null, null, defaultNsUri);\n-            }\n-            return xmlItem;\n         }\n+        return createXMLItemWithDefaultNSAttribute(new QName(nsUri, startTagName.getLocalName(), prefix), readonly,\n+                                                   defaultNsUri);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYyMjc0Nw==", "bodyText": "Shouldn't this code be\nif (Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {\n   markChildrenAsImmutable(bLangXMLElementLiteral);\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r431622747", "createdAt": "2020-05-28T07:03:18Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3443,6 +3443,12 @@ public void visit(BLangXMLElementLiteral bLangXMLElementLiteral) {\n \n         resultType = checkXmlSubTypeLiteralCompatibility(bLangXMLElementLiteral.pos, symTable.xmlElementType,\n                                                          this.expType);\n+\n+        if (!Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODYyNjUz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#pullrequestreview-419862653", "createdAt": "2020-05-28T07:54:49Z", "commit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDY3MjEx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#pullrequestreview-421467211", "createdAt": "2020-05-31T07:00:20Z", "commit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cddd16074941d5d89fe8f120f8bcc5ad51fcf846", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cddd16074941d5d89fe8f120f8bcc5ad51fcf846", "committedDate": "2020-05-31T12:04:53Z", "message": "Merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e8807bc9cbf4b351105d1f7e5ed107fb6121aaf", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8e8807bc9cbf4b351105d1f7e5ed107fb6121aaf", "committedDate": "2020-05-31T14:12:19Z", "message": "Address review suggestions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3325, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}