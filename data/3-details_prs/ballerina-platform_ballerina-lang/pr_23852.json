{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxODM2ODAy", "number": 23852, "title": "Fix inconsistent violation with put/add against inherent table type", "bodyText": "Purpose\n\n$title\n\nFixes #23241\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-06-09T14:29:35Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852", "merged": true, "mergeCommit": {"oid": "7c4da4ae62686f8273b75ea5c1d5333027aa5790"}, "closed": true, "closedAt": "2020-06-16T03:37:15Z", "author": {"login": "lasinicl"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqgEx2gH2gAyNDMxODM2ODAyOjliNzc0NWJiN2IxZGYzMDkwZjRiNDMwZDU5NmQzMmVhMmFkM2JmZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrjUuAAFqTQzMDgxMDAxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9b7745bb7b1df3090f4b430d596d32ea2ad3bfde", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9b7745bb7b1df3090f4b430d596d32ea2ad3bfde", "committedDate": "2020-06-12T10:13:05Z", "message": "Add behavior for inherent type violation in put/add"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7714e7110b93951935decdfde99f06b8c7e76817", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7714e7110b93951935decdfde99f06b8c7e76817", "committedDate": "2020-06-09T14:17:32Z", "message": "Add tests for inconsistent violation with put/add"}, "afterCommit": {"oid": "9b7745bb7b1df3090f4b430d596d32ea2ad3bfde", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9b7745bb7b1df3090f4b430d596d32ea2ad3bfde", "committedDate": "2020-06-12T10:13:05Z", "message": "Add behavior for inherent type violation in put/add"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b223b7551f1aa5f3c532a6457e3037f4b4722c6b", "committedDate": "2020-06-14T03:47:19Z", "message": "Add tests for inherent type violation in map constr tbl"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1dde4af493f7fb92becebbad32236478170ad9e6", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1dde4af493f7fb92becebbad32236478170ad9e6", "committedDate": "2020-06-14T03:40:11Z", "message": "Add tests for inherent type violation in map constr tbl"}, "afterCommit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b223b7551f1aa5f3c532a6457e3037f4b4722c6b", "committedDate": "2020-06-14T03:47:19Z", "message": "Add tests for inherent type violation in map constr tbl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjQxNzMy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852#pullrequestreview-430241732", "createdAt": "2020-06-14T18:36:49Z", "commit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxODozNjo0OVrOGjetmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxODozNjo0OVrOGjetmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NjUzOA==", "bodyText": "Let's use InherentTypeViolation in https://github.com/ballerina-platform/ballerina-lang/blob/master/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/util/exceptions/BallerinaErrorReasons.java#L64 here instead.\nCheck map/tuple violation check", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852#discussion_r439856538", "createdAt": "2020-06-14T18:36:49Z", "author": {"login": "pcnfernando"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/TableValueImpl.java", "diffHunk": "@@ -538,6 +542,14 @@ private void updateIndexKeyMappings(Long hash) {\n         }\n     }\n \n+    // This method checks for inherent table type violation\n+    private void checkInherentTypeViolation(MapValue dataMap, BTableType type) {\n+        if (!TypeChecker.checkIsType(dataMap.getType(), type.getConstrainedType())) {\n+            throw BallerinaErrors.createError(VALUE_INCONSISTENT_WITH_TABLE_TYPE_ERROR,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjQzNjc2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852#pullrequestreview-430243676", "createdAt": "2020-06-14T19:07:37Z", "commit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxOTowNzozN1rOGje2rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxOTowNzozN1rOGje2rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1ODg2Mw==", "bodyText": "Shall we do use a map as table constrained and try to add () as well", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852#discussion_r439858863", "createdAt": "2020-06-14T19:07:37Z", "author": {"login": "pcnfernando"}, "path": "langlib/langlib-test/src/test/resources/test-src/tablelib_test.bal", "diffHunk": "@@ -42,6 +61,14 @@ type CustomerTable table<Customer> key(id);\n \n type CustomerKeyLessTable table<Customer>;\n \n+type PersonTable table<Person>;\n+\n+type EngineerTable table<Engineer>;\n+\n+type InternTable table<Intern>;\n+\n+type PersonAnyTable table<map<any>>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjQzODAz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852#pullrequestreview-430243803", "createdAt": "2020-06-14T19:09:39Z", "commit": {"oid": "b223b7551f1aa5f3c532a6457e3037f4b4722c6b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f363eb9908a106230535affd82fc4bef7d04ca04", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f363eb9908a106230535affd82fc4bef7d04ca04", "committedDate": "2020-06-15T05:03:22Z", "message": "Change error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b9108e2299e90f4a3528dfcc59a33f3c7adce4", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/42b9108e2299e90f4a3528dfcc59a33f3c7adce4", "committedDate": "2020-06-15T11:49:28Z", "message": "Add tests for map constrained table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19f6a135a6f82b64f572e010d6173a66c4e54685", "author": {"user": {"login": "lasinicl", "name": "Lasini Liyange"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/19f6a135a6f82b64f572e010d6173a66c4e54685", "committedDate": "2020-06-15T16:33:05Z", "message": "Add new line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODEwMDEz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23852#pullrequestreview-430810013", "createdAt": "2020-06-15T16:34:08Z", "commit": {"oid": "19f6a135a6f82b64f572e010d6173a66c4e54685"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4441, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}