{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MDQxMjMw", "number": 26370, "title": "Introduce formatting env to hold the state-variables", "bodyText": "Purpose\n\nDescribe the problems, issues, or needs driving this feature/fix and include links to related issues.\n\nFixes #\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-10-15T11:48:45Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370", "merged": true, "mergeCommit": {"oid": "7816320dd4080ef41e96fd2bd59032f194959b68"}, "closed": true, "closedAt": "2020-10-15T14:17:34Z", "author": {"login": "SupunS"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSu6_GAH2gAyNTA0MDQxMjMwOjk5MjljMDUwN2Y3MzU1YTZmYWY0NzYyNTdmOTgzZjcwMGM0YTBjYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSydwxAH2gAyNTA0MDQxMjMwOjlkOTBkYzA0NDU4NjBkYWFiMjI1OGZlODNiMTkzMGY5NmY2MmU4MWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9929c0507f7355a6faf476257f983f700c4a0ca4", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9929c0507f7355a6faf476257f983f700c4a0ca4", "committedDate": "2020-10-15T10:07:56Z", "message": "Introduce formatting env to hold the state-variables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5Mjk1NjIz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509295623", "createdAt": "2020-10-15T11:53:09Z", "commit": {"oid": "6c89902f0b576fec637320575a176d01f9edb16d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMTo1MzowOVrOHiED2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMTo1MzowOVrOHiED2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ4MDE1Mg==", "bodyText": "Shall we change the default line length to 120? Since it is the limit specified in the current guide [1].\n[1] https://ballerina.io/swan-lake/learn/coding-conventions/#indentation-and-line-length", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505480152", "createdAt": "2020-10-15T11:53:09Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingOptions.java", "diffHunk": "@@ -24,16 +24,19 @@\n     private int tabSize;\n \n     // Prefer spaces over tabs.\n-    private boolean insertSpaces;\n+    private String wsCharacter;\n+\n+    private int columnLimit;\n \n     FormattingOptions() {\n         this.tabSize = 4;\n-        this.insertSpaces = true;\n+        this.wsCharacter = \" \";\n+        this.columnLimit = 80;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c89902f0b576fec637320575a176d01f9edb16d"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c89902f0b576fec637320575a176d01f9edb16d", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6c89902f0b576fec637320575a176d01f9edb16d", "committedDate": "2020-10-15T11:46:14Z", "message": "Merge branch 'formatter-change' of https://github.com/ballerina-platform/ballerina-lang into formatter-change"}, "afterCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4fba2bbd88b6f3a70dc90d310e421759712e70eb", "committedDate": "2020-10-15T12:05:25Z", "message": "Merge branch 'formatter-change' of https://github.com/ballerina-platform/ballerina-lang into formatter-change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzExMjQ4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509311248", "createdAt": "2020-10-15T12:13:15Z", "commit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxMzoxNVrOHiEvEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxMzoxNVrOHiEvEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MTIxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // If env node has a trailing new line, then the next immediate token\n          \n          \n            \n                    // If this node has a trailing new line, then the next immediate token", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505491216", "createdAt": "2020-10-15T12:13:15Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/NewFormattingTreeModifier.java", "diffHunk": "@@ -3668,23 +3637,23 @@ public Token transform(Token token) {\n             return token;\n         }\n \n-        int prevTrailingNL = this.trailingNL;\n-        int prevTrailingWS = this.trailingWS;\n+        int prevTrailingNL = env.trailingNL;\n+        int prevTrailingWS = env.trailingWS;\n \n         // Trailing newlines can be at-most 1. Rest will go as newlines for the next token\n-        this.trailingNL = trailingNL > 0 ? 1 : 0;\n-        this.trailingWS = trailingWS;\n+        env.trailingNL = trailingNL > 0 ? 1 : 0;\n+        env.trailingWS = trailingWS;\n \n         token = formatTokenInternal(token);\n \n         // Set the leading newlines for the next token\n-        this.leadingNL = trailingNL > 0 ? trailingNL - 1 : 0;\n+        env.leadingNL = trailingNL > 0 ? trailingNL - 1 : 0;\n \n-        // If this node has a trailing new line, then the next immediate token\n+        // If env node has a trailing new line, then the next immediate token", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "originalPosition": 2084}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzExNTA2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509311506", "createdAt": "2020-10-15T12:13:34Z", "commit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxMzozNFrOHiEvuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxMzozNFrOHiEvuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MTM4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            // env is the last item of the list. Trailing WS and NL for the last item on the list\n          \n          \n            \n                            // This is the last item of the list. Trailing WS and NL for the last item on the list", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505491384", "createdAt": "2020-10-15T12:13:34Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/NewFormattingTreeModifier.java", "diffHunk": "@@ -3736,16 +3705,16 @@ public Token transform(Token token) {\n         for (int index = 0; index < size; index++) {\n             T oldNode = nodeList.get(index);\n             T newNode;\n-            boolean prevPreserveNL = this.preserveNewlines;\n-            this.preserveNewlines = preserveNL;\n+            boolean prevPreserveNL = env.preserveNewlines;\n+            env.preserveNewlines = preserveNL;\n             if (index == size - 1) {\n-                // This is the last item of the list. Trailing WS and NL for the last item on the list\n+                // env is the last item of the list. Trailing WS and NL for the last item on the list", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "originalPosition": 2105}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzEyMzcw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509312370", "createdAt": "2020-10-15T12:14:45Z", "commit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNDo0NlrOHiEyMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNDo0NlrOHiEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MjAxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Format a delimited list of nodes. env method assumes the delimiters are followed by a single whitespace character\n          \n          \n            \n                 * Format a delimited list of nodes. This method assumes the delimiters are followed by a single whitespace character", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505492018", "createdAt": "2020-10-15T12:14:46Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/NewFormattingTreeModifier.java", "diffHunk": "@@ -3761,8 +3730,8 @@ public Token transform(Token token) {\n     }\n \n     /**\n-     * Format a delimited list of nodes. This method assumes the delimiters are followed by a single whitespace\n-     * character only.\n+     * Format a delimited list of nodes. env method assumes the delimiters are followed by a single whitespace character", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "originalPosition": 2122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzEyNDk2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509312496", "createdAt": "2020-10-15T12:14:57Z", "commit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNDo1N1rOHiEykQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNDo1N1rOHiEykQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MjExMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            // env is the last item of the list. Trailing WS and NL for the last item on the list\n          \n          \n            \n                            // This is the last item of the list. Trailing WS and NL for the last item on the list", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505492113", "createdAt": "2020-10-15T12:14:57Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/NewFormattingTreeModifier.java", "diffHunk": "@@ -3813,7 +3782,7 @@ public Token transform(Token token) {\n             T oldNode = nodeList.get(index);\n             T newNode;\n             if (index == size - 1) {\n-                // This is the last item of the list. Trailing WS and NL for the last item on the list\n+                // env is the last item of the list. Trailing WS and NL for the last item on the list", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "originalPosition": 2132}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzEzMTc4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509313178", "createdAt": "2020-10-15T12:15:51Z", "commit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNTo1MVrOHiE0sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNTo1MVrOHiE0sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MjY1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Wrap the node. env is equivalent to adding a newline before the node and re-formatting the node. Wrapped content\n          \n          \n            \n                 * Wrap the node. This is equivalent to adding a newline before the node and re-formatting the node. Wrapped content", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505492657", "createdAt": "2020-10-15T12:15:51Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/NewFormattingTreeModifier.java", "diffHunk": "@@ -3925,7 +3901,7 @@ private boolean shouldWrapLine(Node node) {\n     }\n \n     /**\n-     * Wrap the node. This is equivalent to adding a newline before the node and re-formatting the node. Wrapped content\n+     * Wrap the node. env is equivalent to adding a newline before the node and re-formatting the node. Wrapped content", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "originalPosition": 2207}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzEzNDQx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509313441", "createdAt": "2020-10-15T12:16:12Z", "commit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNjoxMlrOHiE1fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxNjoxMlrOHiE1fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5Mjg2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    // If there's a newline before env, then add padding to\n          \n          \n            \n                                    // If there's a newline before this, then add padding to", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#discussion_r505492862", "createdAt": "2020-10-15T12:16:12Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/NewFormattingTreeModifier.java", "diffHunk": "@@ -3996,9 +3972,9 @@ private MinutiaeList getLeadingMinutiae(Token token) {\n                     break;\n                 case COMMENT_MINUTIAE:\n                     if (consecutiveNewlines > 0) {\n-                        // If there's a newline before this, then add padding to\n+                        // If there's a newline before env, then add padding to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb"}, "originalPosition": 2253}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ce20d493519dd0ddcccf2d46d457c7f8ab80059", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8ce20d493519dd0ddcccf2d46d457c7f8ab80059", "committedDate": "2020-10-15T12:18:02Z", "message": "Merge branch 'formatter-change' of https://github.com/ballerina-platform/ballerina-lang into formatter-change"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fba2bbd88b6f3a70dc90d310e421759712e70eb", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4fba2bbd88b6f3a70dc90d310e421759712e70eb", "committedDate": "2020-10-15T12:05:25Z", "message": "Merge branch 'formatter-change' of https://github.com/ballerina-platform/ballerina-lang into formatter-change"}, "afterCommit": {"oid": "8ce20d493519dd0ddcccf2d46d457c7f8ab80059", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8ce20d493519dd0ddcccf2d46d457c7f8ab80059", "committedDate": "2020-10-15T12:18:02Z", "message": "Merge branch 'formatter-change' of https://github.com/ballerina-platform/ballerina-lang into formatter-change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzE2Mjg0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26370#pullrequestreview-509316284", "createdAt": "2020-10-15T12:19:42Z", "commit": {"oid": "8ce20d493519dd0ddcccf2d46d457c7f8ab80059"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eb3f52e11534071781388c1469bbc8f10c6ba56", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5eb3f52e11534071781388c1469bbc8f10c6ba56", "committedDate": "2020-10-15T13:46:47Z", "message": "Fix line wrapping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d90dc0445860daab2258fe83b1930f96f62e81d", "author": {"user": {"login": "SupunS", "name": "Supun Setunga"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9d90dc0445860daab2258fe83b1930f96f62e81d", "committedDate": "2020-10-15T14:15:38Z", "message": "Add a line wrapping test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4372, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}