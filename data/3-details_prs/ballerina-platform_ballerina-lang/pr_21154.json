{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MDczMjY5", "number": 21154, "title": "Fix dynamic service registration issue in gRPC", "bodyText": "Purpose\n\nThis PR is to fix dynamic service registration issue in gRPC services\n\nFixes #21151\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-19T10:04:00Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21154", "merged": true, "mergeCommit": {"oid": "81d542c4ac47eb6a41e2ad4716bee37d6f7b0959"}, "closed": true, "closedAt": "2020-02-26T10:59:42Z", "author": {"login": "daneshk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFzjsdgH2gAyMzc3MDczMjY5OmNkMmZiOWJhMjE0ZWRlMWQ0Y2Q0OGE0ODM0ZjgzOGI2MTc1NTM3MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIEkKqAFqTM2NDgwMzYwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd2fb9ba214ede1d4cd48a4834f838b617553704", "author": {"user": {"login": "daneshk", "name": "Danesh Kuruppu"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd2fb9ba214ede1d4cd48a4834f838b617553704", "committedDate": "2020-02-19T09:59:51Z", "message": "Fix dynamic service registration issue in gRPC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48a87528f2b3053fa9a3c116329fb1aa8dd64466", "author": {"user": {"login": "daneshk", "name": "Danesh Kuruppu"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/48a87528f2b3053fa9a3c116329fb1aa8dd64466", "committedDate": "2020-02-20T02:51:05Z", "message": "Change port in testcase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTUxMzU0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21154#pullrequestreview-363151354", "createdAt": "2020-02-24T02:45:51Z", "commit": {"oid": "48a87528f2b3053fa9a3c116329fb1aa8dd64466"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjo0NTo1MVrOFtUspQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjo0NTo1MVrOFtUspQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2OTM0OQ==", "bodyText": "If we return the providedName from L87, we would not need this null check. WDYT?\nIf so, serviceName variable can be also removed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21154#discussion_r383069349", "createdAt": "2020-02-24T02:45:51Z", "author": {"login": "chamil321"}, "path": "stdlib/grpc/src/main/java/org/ballerinalang/net/grpc/ServicesBuilderUtils.java", "diffHunk": "@@ -69,16 +69,32 @@ public static ServerServiceDefinition getServiceDefinition(BRuntime runtime, Obj\n         if (fileDescriptor == null) {\n             throw new GrpcServerException(\"Couldn't find the service descriptor.\");\n         }\n-        String serviceTypeName = service.getType().getName(); // typeName format: <name>$$<type>$$<version>\n-        String[] splitValues = serviceTypeName.split(\"\\\\$\\\\$\");\n-        String serviceName = splitValues[0];\n+        String serviceName = getServiceName(service);\n         Descriptors.ServiceDescriptor serviceDescriptor = fileDescriptor.findServiceByName(serviceName);\n         if (serviceDescriptor == null) {\n             throw new GrpcServerException(\"Couldn't find the service descriptor for the service: \" + serviceName);\n         }\n         return getServiceDefinition(runtime, service, serviceDescriptor);\n     }\n-    \n+\n+    private static String getServiceName(ObjectValue service) {\n+        String serviceName = null;\n+        Object serviceConfigData = service.getType().getAnnotation(\"ballerina/grpc:ServiceConfig\");\n+        if (serviceConfigData != null) {\n+            MapValue<String, Object> configMap = (MapValue) serviceConfigData;\n+            String providedName = configMap.getStringValue(\"name\");\n+            if (providedName != null && !providedName.isEmpty()) {\n+                serviceName = providedName;\n+            }\n+        }\n+        if (serviceName == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48a87528f2b3053fa9a3c116329fb1aa8dd64466"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7008bb513e4903e8af293317461ccb4213f80bd0", "author": {"user": {"login": "daneshk", "name": "Danesh Kuruppu"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7008bb513e4903e8af293317461ccb4213f80bd0", "committedDate": "2020-02-25T02:42:31Z", "message": "Fix review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0ODAzNjA4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21154#pullrequestreview-364803608", "createdAt": "2020-02-26T10:56:36Z", "commit": {"oid": "7008bb513e4903e8af293317461ccb4213f80bd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4125, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}