{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzM3NzUw", "number": 24658, "title": "Add functional-match-pattern support to match statement", "bodyText": "Purpose\n$Subject\nFixes #24293 and #24388\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-07-08T15:58:31Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658", "merged": true, "mergeCommit": {"oid": "29799497889cbcbc967b08981f19d0c355275f08"}, "closed": true, "closedAt": "2020-07-10T06:01:21Z", "author": {"login": "rdulmina"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxLJCgAH2gAyNDQ2MzM3NzUwOmQxNmJhMzhiOGNjZTliZTZlZTcyNGMxZWJlNDlhZWEzMTllNDFkY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczdQOFgFqTQ0NjE0MDAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d16ba38b8cce9be6ee724c1ebe49aea319e41dcb", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d16ba38b8cce9be6ee724c1ebe49aea319e41dcb", "committedDate": "2020-07-03T03:47:12Z", "message": "parseFunctionalMatchPattern method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d624d1d84351d0f2d2d1c63072115eb320cdebfc", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d624d1d84351d0f2d2d1c63072115eb320cdebfc", "committedDate": "2020-07-03T11:18:08Z", "message": "parseFunctionalMatchPatternOrConsPattern method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf53d5787614ae50c7c846143af43984fb4a93e8", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cf53d5787614ae50c7c846143af43984fb4a93e8", "committedDate": "2020-07-05T11:03:15Z", "message": "functional match pattern support to match statement."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72d5d3e6c0725d82d9d60991cc5578e5f670c665", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/72d5d3e6c0725d82d9d60991cc5578e5f670c665", "committedDate": "2020-07-05T11:06:29Z", "message": "Changed the type of namedArgMatchPatternsNode."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "811db93741fad5b40f82f56340750ab09e289b3f", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/811db93741fad5b40f82f56340750ab09e289b3f", "committedDate": "2020-07-06T14:01:10Z", "message": "Added more comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f65fa25df234665caca3dc9a4937179771e8a59c", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f65fa25df234665caca3dc9a4937179771e8a59c", "committedDate": "2020-07-06T16:29:33Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41c4db473e46f9f3d3853dbd6fb53105a76aebe9", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41c4db473e46f9f3d3853dbd6fb53105a76aebe9", "committedDate": "2020-07-07T08:19:11Z", "message": "Changed the parsing logic of functional match pattern."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98930374df0e6dd695aa20f7e496bbaa8e339fdc", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98930374df0e6dd695aa20f7e496bbaa8e339fdc", "committedDate": "2020-07-08T11:18:26Z", "message": "Recovery logic for the functional match pattern."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f26fe5a1c6987cdc78c4ca8d3681c38ec833e7ef", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f26fe5a1c6987cdc78c4ca8d3681c38ec833e7ef", "committedDate": "2020-07-08T14:02:52Z", "message": "Test cases for functional match pattern."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7a7af90f7299044e650c41acf78228cb4df6de2", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f7a7af90f7299044e650c41acf78228cb4df6de2", "committedDate": "2020-07-08T15:13:05Z", "message": "Changed the context for open parenthesis in functional match pattern."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd8e55bdfe6fe3f5b817856332b2c9c96ff1f60", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0cd8e55bdfe6fe3f5b817856332b2c9c96ff1f60", "committedDate": "2020-07-08T15:41:33Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27b36fdc98bea11d278680a23ab8dc0bcd9ddd87", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/27b36fdc98bea11d278680a23ab8dc0bcd9ddd87", "committedDate": "2020-07-08T15:54:08Z", "message": "Undo unwanted changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjYwNzY5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#pullrequestreview-445260769", "createdAt": "2020-07-09T03:09:03Z", "commit": {"oid": "27b36fdc98bea11d278680a23ab8dc0bcd9ddd87"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMzowOTowM1rOGvAI9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMzoxMzoyNFrOGvANHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkzODU1MQ==", "bodyText": "I think we can simplify this method and parseOtherArgMatchPatterns method, if we follow the same approach as parseArgList method.\nA further simplified/cleanup version can be found in parseArgListBindingPatterns (still WIP). I would suggest let's do similar to this one.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#discussion_r451938551", "createdAt": "2020-07-09T03:09:03Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12744,6 +12754,251 @@ private STNode parseFieldMatchPatternRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    private STNode parseFunctionalMatchPatternOrConsPattern(STNode typeRefOrConstExpr) {\n+        return parseFunctionalMatchPatternOrConsPattern(peek().kind, typeRefOrConstExpr);\n+    }\n+\n+    private STNode parseFunctionalMatchPatternOrConsPattern(SyntaxKind nextToken, STNode typeRefOrConstExpr) {\n+        switch (nextToken) {\n+            case OPEN_PAREN_TOKEN:\n+                return parseFunctionalMatchPattern(typeRefOrConstExpr);\n+            default:\n+                if (isMatchPatternRhs(peek().kind)) {\n+                    return typeRefOrConstExpr;\n+                }\n+                Solution solution = recover(peek(), ParserRuleContext.FUNC_MATCH_PATTERN_OR_CONST_PATTERN,\n+                        typeRefOrConstExpr);\n+\n+                // If the parser recovered by inserting a token, then try to re-parse the same\n+                // rule with the inserted token. This is done to pick the correct branch\n+                // to continue the parsing.\n+                if (solution.action == Action.REMOVE) {\n+                    return solution.recoveredNode;\n+                }\n+\n+                return parseFunctionalMatchPatternOrConsPattern(solution.tokenKind, typeRefOrConstExpr);\n+        }\n+    }\n+\n+    private boolean isMatchPatternRhs(SyntaxKind tokenKind) {\n+        switch (tokenKind) {\n+            case RIGHT_DOUBLE_ARROW_TOKEN:\n+            case COMMA_TOKEN:\n+            case CLOSE_BRACE_TOKEN:\n+            case CLOSE_BRACKET_TOKEN:\n+            case CLOSE_PAREN_TOKEN:\n+            case PIPE_TOKEN:\n+            case IF_KEYWORD:\n+            case EOF_TOKEN:\n+                return true;\n+            default:\n+                return false;\n+        }\n+    }\n+\n+    /**\n+     * Parse functional match pattern.\n+     *<p>\n+     *     functional-match-pattern := functionally-constructible-type-reference ( arg-list-match-pattern )\n+     *     <br/>\n+     *     functionally-constructible-type-reference := error | type-reference\n+     *     <br/>\n+     *     type-reference := identifier | qualified-identifier\n+     *     <br/>\n+     *     arg-list-match-pattern := positional-arg-match-patterns [, other-arg-match-patterns]\n+     *    | other-arg-match-patterns\n+     *</p>\n+     *\n+     * @return Parsed functional match pattern node.\n+     */\n+    private STNode parseFunctionalMatchPattern(STNode typeRef) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b36fdc98bea11d278680a23ab8dc0bcd9ddd87"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkzOTYxMw==", "bodyText": "The comma in between the two lists are not captured?\nWould it be better to merge these two lists in to one (similar to arguments list in a function call)?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#discussion_r451939613", "createdAt": "2020-07-09T03:13:24Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -3938,6 +3938,70 @@\n                 }\n             ]\n         },\n+        {\n+            \"name\": \"FunctionalMatchPatternNode\",\n+            \"base\": \"Node\",\n+            \"kind\": \"FUNCTIONAL_MATCH_PATTERN\",\n+            \"attributes\": [\n+                {\n+                    \"name\": \"typeRef\",\n+                    \"type\": \"Node\"\n+                },\n+                {\n+                    \"name\": \"openParenthesisToken\",\n+                    \"type\": \"Token\"\n+                },\n+                {\n+                    \"name\": \"positionalArgMatchPatternsNode\",\n+                    \"type\": \"Node\",\n+                    \"occurrences\": \"MULTIPLE_SEPARATED\"\n+                },\n+                {\n+                    \"name\": \"otherArgMatchPatternsNode\",\n+                    \"type\": \"OtherArgMatchPatternsNode\"\n+                },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b36fdc98bea11d278680a23ab8dc0bcd9ddd87"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bcd730ce6557ad7bc2e9ac7188d88fb3bc86971", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6bcd730ce6557ad7bc2e9ac7188d88fb3bc86971", "committedDate": "2020-07-09T18:06:16Z", "message": "Improved the parsing logic of functional match pattern."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9f67cb59a922ba53e48331908dc454995cabb3b", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a9f67cb59a922ba53e48331908dc454995cabb3b", "committedDate": "2020-07-09T18:07:25Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b37494bb04dc5c9679a0f71984a7c205aa2b7c", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95b37494bb04dc5c9679a0f71984a7c205aa2b7c", "committedDate": "2020-07-10T04:20:31Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a42c37b8999bcad6d60546f9c363cd9d1bcf2e8", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a42c37b8999bcad6d60546f9c363cd9d1bcf2e8", "committedDate": "2020-07-10T04:23:27Z", "message": "Undo test1.bal file change."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MTQwMDA0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#pullrequestreview-446140004", "createdAt": "2020-07-10T06:01:11Z", "commit": {"oid": "7a42c37b8999bcad6d60546f9c363cd9d1bcf2e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4172, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}