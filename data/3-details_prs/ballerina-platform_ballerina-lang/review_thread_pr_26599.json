{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5OTA0Mjc5", "number": 26599, "reviewThreads": {"totalCount": 50, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjo1ODo1MVrOE3UhsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxMToyNDowMlrOFNo3AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDQzNDQxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/compiler/plugins/AbstractCompilerPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjo1ODo1MVrOHwmPTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjo1ODo1MVrOHwmPTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcyMDIwNQ==", "bodyText": "I guess this could be a breaking change for standard library modules and extensions. Let's raise this on Slack before merging the PR.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r520720205", "createdAt": "2020-11-10T16:58:51Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/compiler/plugins/AbstractCompilerPlugin.java", "diffHunk": "@@ -67,7 +67,7 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     }\n \n     @Override\n-    public void process(SimpleVariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n+    public void process(VariableNode variableNode, List<AnnotationAttachmentNode> annotations) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDc2NjcxOnYy", "diffSide": "RIGHT", "path": "misc/docerina/src/main/java/org/ballerinalang/docgen/docs/BallerinaDocGenerator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODoxODo0OVrOHwpdYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTo1MjoyMFrOHxrh1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3Mjk2MQ==", "bodyText": "Won't these casts leads to issues? Shouldn't we properly handle the list case also for now and appropriately handle the rest when they are being introduced?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r520772961", "createdAt": "2020-11-10T18:18:49Z", "author": {"login": "MaryamZi"}, "path": "misc/docerina/src/main/java/org/ballerinalang/docgen/docs/BallerinaDocGenerator.java", "diffHunk": "@@ -666,7 +667,8 @@ private static void sortModuleConstructs(BLangPackage bLangPackage) {\n         bLangPackage.getAnnotations().sort(Comparator.comparing(a -> a.getName().getValue()));\n         bLangPackage.getTypeDefinitions()\n                 .sort(Comparator.comparing(a -> a.getName() == null ? \"\" : a.getName().getValue()));\n-        bLangPackage.getGlobalVariables().sort(Comparator.comparing(a -> a.getName().getValue()));\n+        bLangPackage.getGlobalVariables().sort(Comparator.comparing(a ->\n+                ((BLangSimpleVariable) a).getName().getValue()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1NTQ0NQ==", "bodyText": "all the variables will desugar into simple variables, hence this should not fail", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r521855445", "createdAt": "2020-11-12T05:52:20Z", "author": {"login": "rdulmina"}, "path": "misc/docerina/src/main/java/org/ballerinalang/docgen/docs/BallerinaDocGenerator.java", "diffHunk": "@@ -666,7 +667,8 @@ private static void sortModuleConstructs(BLangPackage bLangPackage) {\n         bLangPackage.getAnnotations().sort(Comparator.comparing(a -> a.getName().getValue()));\n         bLangPackage.getTypeDefinitions()\n                 .sort(Comparator.comparing(a -> a.getName() == null ? \"\" : a.getName().getValue()));\n-        bLangPackage.getGlobalVariables().sort(Comparator.comparing(a -> a.getName().getValue()));\n+        bLangPackage.getGlobalVariables().sort(Comparator.comparing(a ->\n+                ((BLangSimpleVariable) a).getName().getValue()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3Mjk2MQ=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDc5NjcxOnYy", "diffSide": "RIGHT", "path": "tests/ballerina-compiler-plugin-test/src/test/java/io/ballerina/test/compiler/plugins/TestCompilerPlugin.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODoyNzowN1rOHwpv3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwNzo1MTowNlrOH8bzow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3NzY5Mw==", "bodyText": "This cast could also lead to issues, right?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r520777693", "createdAt": "2020-11-10T18:27:07Z", "author": {"login": "MaryamZi"}, "path": "tests/ballerina-compiler-plugin-test/src/test/java/io/ballerina/test/compiler/plugins/TestCompilerPlugin.java", "diffHunk": "@@ -77,8 +78,9 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     }\n \n     @Override\n-    public void process(SimpleVariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n-        addEvent(TestEvent.Kind.VARIAVLE_ANN, variableNode.getName().getValue(), annotations.size());\n+    public void process(VariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n+        addEvent(TestEvent.Kind.VARIAVLE_ANN, ((SimpleVariableNode) variableNode).getName().getValue(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5NTUwMQ==", "bodyText": "all the variables will desugar into simple variables, hence this should not fail", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r527495501", "createdAt": "2020-11-20T07:45:37Z", "author": {"login": "rdulmina"}, "path": "tests/ballerina-compiler-plugin-test/src/test/java/io/ballerina/test/compiler/plugins/TestCompilerPlugin.java", "diffHunk": "@@ -77,8 +78,9 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     }\n \n     @Override\n-    public void process(SimpleVariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n-        addEvent(TestEvent.Kind.VARIAVLE_ANN, variableNode.getName().getValue(), annotations.size());\n+    public void process(VariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n+        addEvent(TestEvent.Kind.VARIAVLE_ANN, ((SimpleVariableNode) variableNode).getName().getValue(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3NzY5Mw=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDc1Mg==", "bodyText": "Compiler plugins are invoked before the desugar though.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531404752", "createdAt": "2020-11-27T06:29:24Z", "author": {"login": "MaryamZi"}, "path": "tests/ballerina-compiler-plugin-test/src/test/java/io/ballerina/test/compiler/plugins/TestCompilerPlugin.java", "diffHunk": "@@ -77,8 +78,9 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     }\n \n     @Override\n-    public void process(SimpleVariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n-        addEvent(TestEvent.Kind.VARIAVLE_ANN, variableNode.getName().getValue(), annotations.size());\n+    public void process(VariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n+        addEvent(TestEvent.Kind.VARIAVLE_ANN, ((SimpleVariableNode) variableNode).getName().getValue(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3NzY5Mw=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQ2NDgwOA==", "bodyText": "Will have a look", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531464808", "createdAt": "2020-11-27T09:00:56Z", "author": {"login": "rdulmina"}, "path": "tests/ballerina-compiler-plugin-test/src/test/java/io/ballerina/test/compiler/plugins/TestCompilerPlugin.java", "diffHunk": "@@ -77,8 +78,9 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     }\n \n     @Override\n-    public void process(SimpleVariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n-        addEvent(TestEvent.Kind.VARIAVLE_ANN, variableNode.getName().getValue(), annotations.size());\n+    public void process(VariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n+        addEvent(TestEvent.Kind.VARIAVLE_ANN, ((SimpleVariableNode) variableNode).getName().getValue(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3NzY5Mw=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzEzMjE5NQ==", "bodyText": "Ignored compiler plugin runner for tuple variable", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r533132195", "createdAt": "2020-12-01T07:51:06Z", "author": {"login": "rdulmina"}, "path": "tests/ballerina-compiler-plugin-test/src/test/java/io/ballerina/test/compiler/plugins/TestCompilerPlugin.java", "diffHunk": "@@ -77,8 +78,9 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     }\n \n     @Override\n-    public void process(SimpleVariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n-        addEvent(TestEvent.Kind.VARIAVLE_ANN, variableNode.getName().getValue(), annotations.size());\n+    public void process(VariableNode variableNode, List<AnnotationAttachmentNode> annotations) {\n+        addEvent(TestEvent.Kind.VARIAVLE_ANN, ((SimpleVariableNode) variableNode).getName().getValue(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc3NzY5Mw=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDgyMTIwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODozNDowNlrOHwp_Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwNzo0ODoyNVrOHzrOdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MTU3OQ==", "bodyText": "Was trying to test the test compiler plugin and came across the following issue.\nAdding the following in tests/ and doing a ballerina build results in a bad, sad error.\nconst annotation annot on source var;\n\n@annot\n[int, int] [x, y] = [1, 2];\n[2020-11-10 23:54:22,205] SEVERE {b7a.log.crash} - null \njava.lang.NullPointerException\n\tat org.wso2.ballerinalang.compiler.semantics.analyzer.CompilerPluginRunner.notifyProcessors(CompilerPluginRunner.java:313)\n\tat org.wso2.ballerinalang.compiler.semantics.analyzer.CompilerPluginRunner.visit(CompilerPluginRunner.java:240)\n\tat org.wso2.ballerinalang.compiler.tree.BLangTupleVariable.accept(BLangTupleVariable.java:56)\n\tat org.wso2.ballerinalang.compiler.semantics.analyzer.CompilerPluginRunner.visit(CompilerPluginRunner.java:152)\n\tat org.wso2.ballerinalang.compiler.tree.BLangPackage.accept(BLangPackage.java:163)\n\tat org.wso2.ballerinalang.compiler.semantics.analyzer.CompilerPluginRunner.runPlugins(CompilerPluginRunner.java:135)\n\tat org.wso2.ballerinalang.compiler.CompilerDriver.annotationProcess(CompilerDriver.java:367)\n\tat org.wso2.ballerinalang.compiler.CompilerDriver.compile(CompilerDriver.java:303)\n\tat org.wso2.ballerinalang.compiler.CompilerDriver.compilePackageSymbol(CompilerDriver.java:260)\n\tat org.wso2.ballerinalang.compiler.CompilerDriver.compilePackage(CompilerDriver.java:143)\n\tat org.wso2.ballerinalang.compiler.Compiler.compilePackages(Compiler.java:176)\n\tat org.wso2.ballerinalang.compiler.Compiler.compilePackage(Compiler.java:221)\n\tat org.wso2.ballerinalang.compiler.Compiler.compile(Compiler.java:101)\n\tat org.wso2.ballerinalang.compiler.Compiler.build(Compiler.java:109)\n\tat org.ballerinalang.packerina.task.CompileTask.execute(CompileTask.java:62)\n\tat org.ballerinalang.packerina.TaskExecutor.executeTasks(TaskExecutor.java:38)\n\tat org.ballerinalang.packerina.cmd.BuildCommand.execute(BuildCommand.java:436)\n\tat java.base/java.util.Optional.ifPresent(Optional.java:183)\n\tat org.ballerinalang.tool.Main.main(Main.java:57)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r520781579", "createdAt": "2020-11-10T18:34:06Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -233,6 +234,12 @@ public void visit(BLangSimpleVariable varNode) {\n         notifyProcessors(attachmentList, (processor, list) -> processor.process(varNode, list));\n     }\n \n+    @Override\n+    public void visit(BLangTupleVariable tupleVariableNode) {\n+        List<BLangAnnotationAttachment> attachmentList = tupleVariableNode.getAnnotationAttachments();\n+        notifyProcessors(attachmentList, (processor, list) -> processor.process(tupleVariableNode, list));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0NzYzOA==", "bodyText": "fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r523947638", "createdAt": "2020-11-16T07:48:25Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -233,6 +234,12 @@ public void visit(BLangSimpleVariable varNode) {\n         notifyProcessors(attachmentList, (processor, list) -> processor.process(varNode, list));\n     }\n \n+    @Override\n+    public void visit(BLangTupleVariable tupleVariableNode) {\n+        List<BLangAnnotationAttachment> attachmentList = tupleVariableNode.getAnnotationAttachments();\n+        notifyProcessors(attachmentList, (processor, list) -> processor.process(tupleVariableNode, list));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MTU3OQ=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDgyNDIyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODozNDo1M1rOHwqAwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwNzo0ODozN1rOHzrOyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MjAxOA==", "bodyText": "There'll be scenarios where this cast could fail, right?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r520782018", "createdAt": "2020-11-10T18:34:53Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -343,10 +343,11 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        for (BLangVariable globalVar : globalVars) {\n             if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE,\n+                        ((BLangSimpleVariable) globalVar).name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MjgwNA==", "bodyText": "The following compiles, even though it is invalid, and crashes at runtime.\n[int, int] [a, b]; // no error\n\npublic function main() {\n    int x = a; // no error\n}\n[2020-11-11 00:05:47,501] SEVERE {b7a.log.crash} - null \njava.lang.NullPointerException\n\tat $_init.$gen$$0046$0060init$0062(.:1)\n\tat $_init.$moduleInit(.)\n\tat $_init.$lambda$$moduleInit$(.)\n\tat io.ballerina.runtime.internal.scheduling.SchedulerItem.execute(Scheduler.java:498)\n\tat io.ballerina.runtime.internal.scheduling.Scheduler.run(Scheduler.java:277)\n\tat io.ballerina.runtime.internal.scheduling.Scheduler.runSafely(Scheduler.java:245)\n\tat java.base/java.lang.Thread.run(Thread.java:834)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r520782804", "createdAt": "2020-11-10T18:36:13Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -343,10 +343,11 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        for (BLangVariable globalVar : globalVars) {\n             if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE,\n+                        ((BLangSimpleVariable) globalVar).name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MjAxOA=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1NjI5NQ==", "bodyText": "Yes, will look into that thanx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r521856295", "createdAt": "2020-11-12T05:55:02Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -343,10 +343,11 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        for (BLangVariable globalVar : globalVars) {\n             if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE,\n+                        ((BLangSimpleVariable) globalVar).name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MjAxOA=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0NzcyMw==", "bodyText": "fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r523947723", "createdAt": "2020-11-16T07:48:37Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -343,10 +343,11 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        for (BLangVariable globalVar : globalVars) {\n             if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+                this.dlog.error(globalVar.pos, DiagnosticCode.UNINITIALIZED_VARIABLE,\n+                        ((BLangSimpleVariable) globalVar).name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MjAxOA=="}, "originalCommit": {"oid": "53b326cd4da78c06960160f59e811c1c8eb673b3"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTYyMTYwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowMDowOFrOH3rS_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNjoxMjoxN1rOH4ASVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzEwMg==", "bodyText": "Do we need this comment?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528143102", "createdAt": "2020-11-21T08:00:08Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MDk5MA==", "bodyText": "It's better for readability right", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528470990", "createdAt": "2020-11-23T04:51:01Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzEwMg=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MjE1MQ==", "bodyText": "IMO it's kinda obvious when we look at what's done in the next few lines.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528472151", "createdAt": "2020-11-23T04:57:16Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzEwMg=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ4Njk5OQ==", "bodyText": "Removed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528486999", "createdAt": "2020-11-23T06:12:17Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzEwMg=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTYyMzA1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowMDoyNlrOH3rT8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNDo1MjozOVrOH3_VBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzM0NA==", "bodyText": "Shall we extract this into a separate method?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528143344", "createdAt": "2020-11-21T08:00:26Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef1 = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef1.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef1.var, env));\n+                });\n+            } else {\n+                addToInitFunction((BLangSimpleVariable) globalVar, initFnBody);\n+                desugaredGlobalVarList.add(rewrite(globalVar, env));\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MTMwMg==", "bodyText": "Yes, I moved this into a separate method in my next PR (error and mapping bp support). Let's keep it like this for now", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528471302", "createdAt": "2020-11-23T04:52:39Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef1 = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef1.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef1.var, env));\n+                });\n+            } else {\n+                addToInitFunction((BLangSimpleVariable) globalVar, initFnBody);\n+                desugaredGlobalVarList.add(rewrite(globalVar, env));\n             }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzM0NA=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTYyNDczOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowMDo1MlrOH3rVEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNDo1NzozMlrOH3_YlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzYzNA==", "bodyText": "Let's rename this too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528143634", "createdAt": "2020-11-21T08:00:52Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef1 = (BLangSimpleVariableDef) bLangStatement;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MjIxMw==", "bodyText": "Okay", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528472213", "createdAt": "2020-11-23T04:57:32Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,13 +725,25 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n-                initFnBody.stmts.add(assignment);\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                //Tuple variable will be desugared into block statement node\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef1 = (BLangSimpleVariableDef) bLangStatement;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0MzYzNA=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTYzMTU5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowMjozNlrOH3raIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNDo1NjowMFrOH3_XZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NDkzMA==", "bodyText": "Shall we check if the expr is null and return early instead?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (globalVar.expr != null) {\n          \n          \n            \n                        BLangAssignment assignment = createAssignmentStmt(globalVar);\n          \n          \n            \n                        initFnBody.stmts.add(assignment);\n          \n          \n            \n                    }\n          \n          \n            \n                    if (globalVar.expr == null) {\n          \n          \n            \n                            return;\n          \n          \n            \n                    }\n          \n          \n            \n                    BLangAssignment assignment = createAssignmentStmt(globalVar);\n          \n          \n            \n                    initFnBody.stmts.add(assignment);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528144930", "createdAt": "2020-11-21T08:02:36Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -772,6 +784,14 @@ public void visit(BLangPackage pkgNode) {\n         result = pkgNode;\n     }\n \n+    // Add global variables with default values to init function\n+    private void addToInitFunction(BLangSimpleVariable globalVar, BLangBlockFunctionBody initFnBody) {\n+        if (globalVar.expr != null) {\n+            BLangAssignment assignment = createAssignmentStmt(globalVar);\n+            initFnBody.stmts.add(assignment);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MTkxMA==", "bodyText": "Okay", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528471910", "createdAt": "2020-11-23T04:56:00Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -772,6 +784,14 @@ public void visit(BLangPackage pkgNode) {\n         result = pkgNode;\n     }\n \n+    // Add global variables with default values to init function\n+    private void addToInitFunction(BLangSimpleVariable globalVar, BLangBlockFunctionBody initFnBody) {\n+        if (globalVar.expr != null) {\n+            BLangAssignment assignment = createAssignmentStmt(globalVar);\n+            initFnBody.stmts.add(assignment);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NDkzMA=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTYzMzI3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowMzowN1rOH3rbZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNDo1OTozN1rOH3_Z7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NTI1Mg==", "bodyText": "This method is also self-explanatory right? Do we need the comment?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528145252", "createdAt": "2020-11-21T08:03:07Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -772,6 +784,14 @@ public void visit(BLangPackage pkgNode) {\n         result = pkgNode;\n     }\n \n+    // Add global variables with default values to init function", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MjU1Ng==", "bodyText": "Will remove thanx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528472556", "createdAt": "2020-11-23T04:59:37Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -772,6 +784,14 @@ public void visit(BLangPackage pkgNode) {\n         result = pkgNode;\n     }\n \n+    // Add global variables with default values to init function", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NTI1Mg=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTY0MDQ5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowNTowMFrOH3rgSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNTowMjowNFrOH3_bsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NjUwNg==", "bodyText": "Shall we revisit the comments and remove the ones that are not required?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528146506", "createdAt": "2020-11-21T08:05:00Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -559,20 +559,25 @@ public BLangNode transform(ModulePartNode modulePart) {\n \n     @Override\n     public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n+\n         TypedBindingPatternNode typedBindingPattern = modVarDeclrNode.typedBindingPattern();\n+\n         BindingPatternNode bindingPatternNode = typedBindingPattern.bindingPattern();\n+        Optional<io.ballerina.compiler.syntax.tree.ExpressionNode> initializer = modVarDeclrNode.initializer();\n+\n+        //Get target variable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MzAwOQ==", "bodyText": "Sure", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528473009", "createdAt": "2020-11-23T05:02:04Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -559,20 +559,25 @@ public BLangNode transform(ModulePartNode modulePart) {\n \n     @Override\n     public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n+\n         TypedBindingPatternNode typedBindingPattern = modVarDeclrNode.typedBindingPattern();\n+\n         BindingPatternNode bindingPatternNode = typedBindingPattern.bindingPattern();\n+        Optional<io.ballerina.compiler.syntax.tree.ExpressionNode> initializer = modVarDeclrNode.initializer();\n+\n+        //Get target variable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NjUwNg=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTY0MzQxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowNTozOFrOH3riPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNTowNTo0NlrOH3_eUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NzAwNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    initializeBLangVariable(variable, typedBindingPattern.typeDescriptor(), initializer,\n          \n          \n            \n                            isFinal);\n          \n          \n            \n                    initializeBLangVariable(variable, typedBindingPattern.typeDescriptor(), initializer, isFinal);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528147006", "createdAt": "2020-11-21T08:05:38Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -593,13 +597,18 @@ public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n             }\n         }\n \n-        BLangSimpleVariable simpleVar = createSimpleVar(variableName, typedBindingPattern.typeDescriptor(),\n-                modVarDeclrNode.initializer().orElse(null), isFinal, false, null,\n-                getAnnotations(modVarDeclrNode.metadata()));\n-        simpleVar.pos = getPositionWithoutMetadata(modVarDeclrNode);\n-        simpleVar.markdownDocumentationAttachment =\n+        // Initialize module variable\n+        initializeBLangVariable(variable, typedBindingPattern.typeDescriptor(), initializer,\n+                isFinal);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MzY4MA==", "bodyText": "Okay", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528473680", "createdAt": "2020-11-23T05:05:46Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -593,13 +597,18 @@ public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n             }\n         }\n \n-        BLangSimpleVariable simpleVar = createSimpleVar(variableName, typedBindingPattern.typeDescriptor(),\n-                modVarDeclrNode.initializer().orElse(null), isFinal, false, null,\n-                getAnnotations(modVarDeclrNode.metadata()));\n-        simpleVar.pos = getPositionWithoutMetadata(modVarDeclrNode);\n-        simpleVar.markdownDocumentationAttachment =\n+        // Initialize module variable\n+        initializeBLangVariable(variable, typedBindingPattern.typeDescriptor(), initializer,\n+                isFinal);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0NzAwNg=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTY1MDA1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODowNzoyMlrOH3rnDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNTowNTo1NVrOH3_eYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0ODIzOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        analyzeNode(bLangTupleVariable.expr, env);\n          \n          \n            \n                    } else {\n          \n          \n            \n                        bLangTupleVariable.memberVariables.forEach(member -> {\n          \n          \n            \n                            analyzeNode(member, env);\n          \n          \n            \n                        });\n          \n          \n            \n                    }\n          \n          \n            \n                        analyzeNode(bLangTupleVariable.expr, env);\n          \n          \n            \n                        return;\n          \n          \n            \n                    }\n          \n          \n            \n                    bLangTupleVariable.memberVariables.forEach(member -> {\n          \n          \n            \n                            analyzeNode(member, env);\n          \n          \n            \n                    });", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528148239", "createdAt": "2020-11-21T08:07:22Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -1646,15 +1656,19 @@ public void visit(BLangErrorVarRef varRefExpr) {\n     @Override\n     public void visit(BLangTupleVariable bLangTupleVariable) {\n         analyzeNode(bLangTupleVariable.typeNode, env);\n+        if (bLangTupleVariable.expr != null) {\n+            analyzeNode(bLangTupleVariable.expr, env);\n+        } else {\n+            bLangTupleVariable.memberVariables.forEach(member -> {\n+                analyzeNode(member, env);\n+            });\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MzY5OQ==", "bodyText": "+1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528473699", "createdAt": "2020-11-23T05:05:55Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -1646,15 +1656,19 @@ public void visit(BLangErrorVarRef varRefExpr) {\n     @Override\n     public void visit(BLangTupleVariable bLangTupleVariable) {\n         analyzeNode(bLangTupleVariable.typeNode, env);\n+        if (bLangTupleVariable.expr != null) {\n+            analyzeNode(bLangTupleVariable.expr, env);\n+        } else {\n+            bLangTupleVariable.memberVariables.forEach(member -> {\n+                analyzeNode(member, env);\n+            });\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE0ODIzOQ=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMTY2NzU0OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/vardeclr/ModuleVariableTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwODoxMTo1M1rOH3rzhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNjoxMzo0MlrOH4ATeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE1MTQyOQ==", "bodyText": "Shall we write these assertions in ballerina itself?\ne.g., https://github.com/ballerina-platform/ballerina-lang/blob/v2.0.0-Preview5/tests/jballerina-unit-test/src/test/resources/test-src/types/readonly/test_selectively_immutable_type.bal#L990", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528151429", "createdAt": "2020-11-21T08:11:53Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/vardeclr/ModuleVariableTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.ballerinalang.test.statements.vardeclr;\n+\n+import org.ballerinalang.core.model.values.BBoolean;\n+import org.ballerinalang.core.model.values.BByte;\n+import org.ballerinalang.core.model.values.BFloat;\n+import org.ballerinalang.core.model.values.BInteger;\n+import org.ballerinalang.core.model.values.BValue;\n+import org.ballerinalang.test.BCompileUtil;\n+import org.ballerinalang.test.BRunUtil;\n+import org.ballerinalang.test.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import static org.ballerinalang.test.BAssertUtil.validateError;\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertTrue;\n+\n+/**\n+ * Class to test module level variable declaration for all binding patterns.\n+ *\n+ * @since 2.0\n+ */\n+public class ModuleVariableTest {\n+\n+    private CompileResult compileResult, compileResultNegative;\n+\n+    @BeforeClass\n+    public void setup() {\n+        compileResult = BCompileUtil.compile(\"test-src/statements/vardeclr/module_tuple_var_decl.bal\");\n+        compileResultNegative = BCompileUtil.compile(\"test-src/statements/vardeclr/module_tuple_var_decl_negetive.bal\");\n+    }\n+\n+    @Test\n+    public void testBasicModuleLevelTupleVarDecl() {\n+\n+        BValue[] returns = BRunUtil.invoke(compileResult, \"testBasic\");\n+\n+        int index = 0;\n+        assertTrue(((BBoolean) returns[index++]).booleanValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ4NzI4OA==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r528487288", "createdAt": "2020-11-23T06:13:42Z", "author": {"login": "rdulmina"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/vardeclr/ModuleVariableTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.ballerinalang.test.statements.vardeclr;\n+\n+import org.ballerinalang.core.model.values.BBoolean;\n+import org.ballerinalang.core.model.values.BByte;\n+import org.ballerinalang.core.model.values.BFloat;\n+import org.ballerinalang.core.model.values.BInteger;\n+import org.ballerinalang.core.model.values.BValue;\n+import org.ballerinalang.test.BCompileUtil;\n+import org.ballerinalang.test.BRunUtil;\n+import org.ballerinalang.test.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import static org.ballerinalang.test.BAssertUtil.validateError;\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertTrue;\n+\n+/**\n+ * Class to test module level variable declaration for all binding patterns.\n+ *\n+ * @since 2.0\n+ */\n+public class ModuleVariableTest {\n+\n+    private CompileResult compileResult, compileResultNegative;\n+\n+    @BeforeClass\n+    public void setup() {\n+        compileResult = BCompileUtil.compile(\"test-src/statements/vardeclr/module_tuple_var_decl.bal\");\n+        compileResultNegative = BCompileUtil.compile(\"test-src/statements/vardeclr/module_tuple_var_decl_negetive.bal\");\n+    }\n+\n+    @Test\n+    public void testBasicModuleLevelTupleVarDecl() {\n+\n+        BValue[] returns = BRunUtil.invoke(compileResult, \"testBasic\");\n+\n+        int index = 0;\n+        assertTrue(((BBoolean) returns[index++]).booleanValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE1MTQyOQ=="}, "originalCommit": {"oid": "2e500adac17372cb7301a0684fdabeb457d74510"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMjk0NTk2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNDozMDo1MFrOH6wrzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNzo0MTo0MFrOH6zx4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM3NzEwMg==", "bodyText": "Shall we extract this logic out to a method?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531377102", "createdAt": "2020-11-27T04:30:50Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef.var, env));\n+                });\n+            } else {\n+                long globalVarFlags = globalVar.symbol.flags;\n+                BLangSimpleVariable simpleGlobalVar = (BLangSimpleVariable) globalVar;\n                 if (Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n                     if (Symbols.isFlagOn(globalVarFlags, Flags.REQUIRED)) {\n                         // If it is required configuration get directly\n-                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(globalVar);\n+                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(simpleGlobalVar);\n                         BLangInvocation getValueInvocation = createLangLibInvocationNode(\"getConfigurableValue\",\n-                                args, symTable.anydataType, globalVar.pos);\n-                        globalVar.expr = getValueInvocation;\n+                                args, symTable.anydataType, simpleGlobalVar.pos);\n+                        simpleGlobalVar.expr = getValueInvocation;\n                     } else {\n                         // If it is optional configuration create if else\n-                        globalVar.expr = createIfElseFromConfigurable(globalVar);\n+                        simpleGlobalVar.expr  = createIfElseFromConfigurable(simpleGlobalVar);\n                     }\n                 }\n-\n-                BLangAssignment assignment = createAssignmentStmt(globalVar);\n-                initFnBody.stmts.add(assignment);\n+                addToInitFunction(simpleGlobalVar, initFnBody);\n+                desugaredGlobalVarList.add(rewrite(simpleGlobalVar, env));\n             }\n         });\n+        pkgNode.globalVars = desugaredGlobalVarList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQyNzgxMQ==", "bodyText": "Okay", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531427811", "createdAt": "2020-11-27T07:41:40Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef.var, env));\n+                });\n+            } else {\n+                long globalVarFlags = globalVar.symbol.flags;\n+                BLangSimpleVariable simpleGlobalVar = (BLangSimpleVariable) globalVar;\n                 if (Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n                     if (Symbols.isFlagOn(globalVarFlags, Flags.REQUIRED)) {\n                         // If it is required configuration get directly\n-                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(globalVar);\n+                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(simpleGlobalVar);\n                         BLangInvocation getValueInvocation = createLangLibInvocationNode(\"getConfigurableValue\",\n-                                args, symTable.anydataType, globalVar.pos);\n-                        globalVar.expr = getValueInvocation;\n+                                args, symTable.anydataType, simpleGlobalVar.pos);\n+                        simpleGlobalVar.expr = getValueInvocation;\n                     } else {\n                         // If it is optional configuration create if else\n-                        globalVar.expr = createIfElseFromConfigurable(globalVar);\n+                        simpleGlobalVar.expr  = createIfElseFromConfigurable(simpleGlobalVar);\n                     }\n                 }\n-\n-                BLangAssignment assignment = createAssignmentStmt(globalVar);\n-                initFnBody.stmts.add(assignment);\n+                addToInitFunction(simpleGlobalVar, initFnBody);\n+                desugaredGlobalVarList.add(rewrite(simpleGlobalVar, env));\n             }\n         });\n+        pkgNode.globalVars = desugaredGlobalVarList;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM3NzEwMg=="}, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMjk0NjE0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNDozMTowMlrOH6wr6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMjozMzo1MFrOH75HZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM3NzEzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // This will convert complex variables to simple variable\n          \n          \n            \n                        // This will convert complex variables to simple variables.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531377131", "createdAt": "2020-11-27T04:31:02Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzMTI3NA==", "bodyText": "Can we add some tests for global variables with list binding patterns for\n* annotations\n  \n  * annotation on such a global variable\n  * using such a global variable in an annotation value\n\n* global variable reordering/forward referencing - e.g., referring to other global variable(s) defined after the particular variable, in the initial value expression\n\n* initialization in the module `init` function without specifying an initialization expression\n\n* usage with `var`\n\n* taint analysis. e.g., a test that asserts that the following results in an error\n\n[int, int] [a, b] = [1, 2];\n\npublic function main(int j) {\n    a = j;\n}\n\n\nWill add", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531431274", "createdAt": "2020-11-27T07:50:39Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM3NzEzMQ=="}, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU2MzgxNQ==", "bodyText": "added test cases except no init var decl. Please note", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r532563815", "createdAt": "2020-11-30T12:33:50Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM3NzEzMQ=="}, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzA5MzAxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjowMzowMlrOH6x9OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNzo1Njo0NFrOH60JQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM5Nzk0NQ==", "bodyText": "I think we can convert the forEach to a simple for loop and use continue at the end of the if block, and remove this else block and move the logic out.\nSomething like\n        for (BLangVariable globalVar : pkgNode.globalVars) {\n            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n                // ....   \n                continue;\n            }\n            \n            long globalVarFlags = globalVar.symbol.flags;\n            // ...\n        }", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531397945", "createdAt": "2020-11-27T06:03:02Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef.var, env));\n+                });\n+            } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzMzc5Mg==", "bodyText": "Noted", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531433792", "createdAt": "2020-11-27T07:56:44Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef.var, env));\n+                });\n+            } else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM5Nzk0NQ=="}, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzA5NDEyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjowMzo1MFrOH6x96Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODowNjoyNlrOH60Y7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM5ODEyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    simpleGlobalVar.expr  = createIfElseFromConfigurable(simpleGlobalVar);\n          \n          \n            \n                                    simpleGlobalVar.expr = createIfElseFromConfigurable(simpleGlobalVar);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531398121", "createdAt": "2020-11-27T06:03:50Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef.var, env));\n+                });\n+            } else {\n+                long globalVarFlags = globalVar.symbol.flags;\n+                BLangSimpleVariable simpleGlobalVar = (BLangSimpleVariable) globalVar;\n                 if (Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n                     if (Symbols.isFlagOn(globalVarFlags, Flags.REQUIRED)) {\n                         // If it is required configuration get directly\n-                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(globalVar);\n+                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(simpleGlobalVar);\n                         BLangInvocation getValueInvocation = createLangLibInvocationNode(\"getConfigurableValue\",\n-                                args, symTable.anydataType, globalVar.pos);\n-                        globalVar.expr = getValueInvocation;\n+                                args, symTable.anydataType, simpleGlobalVar.pos);\n+                        simpleGlobalVar.expr = getValueInvocation;\n                     } else {\n                         // If it is optional configuration create if else\n-                        globalVar.expr = createIfElseFromConfigurable(globalVar);\n+                        simpleGlobalVar.expr  = createIfElseFromConfigurable(simpleGlobalVar);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzNzgwNw==", "bodyText": "noted", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531437807", "createdAt": "2020-11-27T08:06:26Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -724,28 +725,38 @@ public void visit(BLangPackage pkgNode) {\n                 initFnBody.stmts.add(constInit);\n             }\n         }\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            long globalVarFlags = globalVar.symbol.flags;\n-            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n-\n+            // This will convert complex variables to simple variable\n+            if (globalVar.getKind() == NodeKind.TUPLE_VARIABLE) {\n+                BLangNode blockStatementNode = rewrite(globalVar, env);\n+                // Add each desugared simple variable to global variables\n+                ((BLangBlockStmt) blockStatementNode).stmts.forEach(bLangStatement -> {\n+                    BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                    addToInitFunction(simpleVarDef.var, initFnBody);\n+                    desugaredGlobalVarList.add(rewrite(simpleVarDef.var, env));\n+                });\n+            } else {\n+                long globalVarFlags = globalVar.symbol.flags;\n+                BLangSimpleVariable simpleGlobalVar = (BLangSimpleVariable) globalVar;\n                 if (Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n                     if (Symbols.isFlagOn(globalVarFlags, Flags.REQUIRED)) {\n                         // If it is required configuration get directly\n-                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(globalVar);\n+                        List<BLangExpression> args = getConfigurableLangLibInvocationParam(simpleGlobalVar);\n                         BLangInvocation getValueInvocation = createLangLibInvocationNode(\"getConfigurableValue\",\n-                                args, symTable.anydataType, globalVar.pos);\n-                        globalVar.expr = getValueInvocation;\n+                                args, symTable.anydataType, simpleGlobalVar.pos);\n+                        simpleGlobalVar.expr = getValueInvocation;\n                     } else {\n                         // If it is optional configuration create if else\n-                        globalVar.expr = createIfElseFromConfigurable(globalVar);\n+                        simpleGlobalVar.expr  = createIfElseFromConfigurable(simpleGlobalVar);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM5ODEyMQ=="}, "originalCommit": {"oid": "1ee7b34b4cd488d8ece45d00e174e9a9c993f8be"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzEyMjI5OnYy", "diffSide": "LEFT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoxOTo0MlrOH6yNyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0Mjo1NVrOIF9GSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMjE4NQ==", "bodyText": "With this we are changing the order in which different constructs are desugared, right? Hope this wouldn't cause issues in serviceDesugar, annotationDesugar, etc.\nFor example, in the annotation desugar we populate a global map variable. Wonder if it still gets rewritten after this change. Can you try several different scenarios and validate?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531402185", "createdAt": "2020-11-27T06:19:42Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -760,7 +780,6 @@ public void visit(BLangPackage pkgNode) {\n         pkgNode.typeDefinitions = rewrite(pkgNode.typeDefinitions, env);\n         pkgNode.xmlnsList = rewrite(pkgNode.xmlnsList, env);\n         pkgNode.constants = rewrite(pkgNode.constants, env);\n-        pkgNode.globalVars = rewrite(pkgNode.globalVars, env);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzNjcyMw==", "bodyText": "We can move global var desugar logic to here if so. Should we move?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531436723", "createdAt": "2020-11-27T08:03:52Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -760,7 +780,6 @@ public void visit(BLangPackage pkgNode) {\n         pkgNode.typeDefinitions = rewrite(pkgNode.typeDefinitions, env);\n         pkgNode.xmlnsList = rewrite(pkgNode.xmlnsList, env);\n         pkgNode.constants = rewrite(pkgNode.constants, env);\n-        pkgNode.globalVars = rewrite(pkgNode.globalVars, env);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMjE4NQ=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExNDgyNw==", "bodyText": "Yeah, I think it's better to maintain the previous order. Or the desugaring here can result in unexpected results in these phases.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543114827", "createdAt": "2020-12-15T07:42:55Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -760,7 +780,6 @@ public void visit(BLangPackage pkgNode) {\n         pkgNode.typeDefinitions = rewrite(pkgNode.typeDefinitions, env);\n         pkgNode.xmlnsList = rewrite(pkgNode.xmlnsList, env);\n         pkgNode.constants = rewrite(pkgNode.constants, env);\n-        pkgNode.globalVars = rewrite(pkgNode.globalVars, env);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMjE4NQ=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzEyNTUyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoyMToyMVrOH6yPhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODowNjoxN1rOH60Yuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMjYzMQ==", "bodyText": "We can return early and remove the else block.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        result = blockStmt;\n          \n          \n            \n                    } else {\n          \n          \n            \n                        createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n          \n          \n            \n                        result = rewrite(blockStmt, env);\n          \n          \n            \n                    }\n          \n          \n            \n                        result = blockStmt;\n          \n          \n            \n                        return;\n          \n          \n            \n                    }\n          \n          \n            \n                    createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n          \n          \n            \n                    result = rewrite(blockStmt, env);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531402631", "createdAt": "2020-11-27T06:21:21Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1275,10 +1305,19 @@ public void visit(BLangTupleVariable varNode) {\n \n         // Create the variable definition statements using the root block stmt created\n         createVarDefStmts(varNode, blockStmt, tuple.symbol, null);\n-        createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n \n-        // Finally rewrite the populated block statement\n-        result = rewrite(blockStmt, env);\n+        if (((this.env.scope.owner.tag & SymTag.PACKAGE) == SymTag.PACKAGE)) {\n+            // Rest field def stmt virtual variables will be added to init function body, hence change the env\n+            SymbolEnv previousEnv = this.env;\n+            this.env = this.initFunctionEnv;\n+            createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n+            this.env = previousEnv;\n+            // If it is a global variable don't rewrite now, will be rewritten later\n+            result = blockStmt;\n+        } else {\n+            createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n+            result = rewrite(blockStmt, env);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzNzc1NQ==", "bodyText": "+1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531437755", "createdAt": "2020-11-27T08:06:17Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1275,10 +1305,19 @@ public void visit(BLangTupleVariable varNode) {\n \n         // Create the variable definition statements using the root block stmt created\n         createVarDefStmts(varNode, blockStmt, tuple.symbol, null);\n-        createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n \n-        // Finally rewrite the populated block statement\n-        result = rewrite(blockStmt, env);\n+        if (((this.env.scope.owner.tag & SymTag.PACKAGE) == SymTag.PACKAGE)) {\n+            // Rest field def stmt virtual variables will be added to init function body, hence change the env\n+            SymbolEnv previousEnv = this.env;\n+            this.env = this.initFunctionEnv;\n+            createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n+            this.env = previousEnv;\n+            // If it is a global variable don't rewrite now, will be rewritten later\n+            result = blockStmt;\n+        } else {\n+            createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n+            result = rewrite(blockStmt, env);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMjYzMQ=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 143}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzEzMzA3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoyNToyMlrOH6yTyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODowODozMVrOH60cfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMzcyMw==", "bodyText": "Shall we directly call modVarDeclrNode.initializer() in L592 instead? We don't seem to be using this variable elsewhere.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531403723", "createdAt": "2020-11-27T06:25:22Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -559,20 +559,24 @@ public BLangNode transform(ModulePartNode modulePart) {\n \n     @Override\n     public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n+\n         TypedBindingPatternNode typedBindingPattern = modVarDeclrNode.typedBindingPattern();\n+\n         BindingPatternNode bindingPatternNode = typedBindingPattern.bindingPattern();\n+        Optional<io.ballerina.compiler.syntax.tree.ExpressionNode> initializer = modVarDeclrNode.initializer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzODcxNw==", "bodyText": "+1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531438717", "createdAt": "2020-11-27T08:08:31Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -559,20 +559,24 @@ public BLangNode transform(ModulePartNode modulePart) {\n \n     @Override\n     public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n+\n         TypedBindingPatternNode typedBindingPattern = modVarDeclrNode.typedBindingPattern();\n+\n         BindingPatternNode bindingPatternNode = typedBindingPattern.bindingPattern();\n+        Optional<io.ballerina.compiler.syntax.tree.ExpressionNode> initializer = modVarDeclrNode.initializer();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMzcyMw=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzEzNjI3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoyNzoyMlrOH6yVww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODoxMDozNlrOH60geA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDIyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (varNode.flagSet.contains(Flag.ISOLATED)) {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    }\n          \n          \n            \n                    return false;\n          \n          \n            \n                    return varNode.flagSet.contains(Flag.ISOLATED);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531404227", "createdAt": "2020-11-27T06:27:22Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -3502,4 +3525,11 @@ private boolean isConfigurable(BLangVariable varNode) {\n         }\n         return false;\n     }\n+\n+    private boolean isIsolated(BLangVariable varNode) {\n+        if (varNode.flagSet.contains(Flag.ISOLATED)) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzOTczNg==", "bodyText": "Thanx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531439736", "createdAt": "2020-11-27T08:10:36Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -3502,4 +3525,11 @@ private boolean isConfigurable(BLangVariable varNode) {\n         }\n         return false;\n     }\n+\n+    private boolean isIsolated(BLangVariable varNode) {\n+        if (varNode.flagSet.contains(Flag.ISOLATED)) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDIyNw=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMzEzNzM5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoyODowNlrOH6yWeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwODoxMjozOVrOH60kLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDQxMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              only simple variables are allowed to be isolated\n          \n          \n            \n              only a simple variable can be marked as ''isolated''", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531404410", "createdAt": "2020-11-27T06:28:06Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1599,5 +1599,8 @@ error.invalid.usage.of.multiple.restricted.vars.in.lock=\\\n error.invalid.isolated.qualifier.on.module.no.init.var.decl=\\\n   an uninitialized module variable declaration cannot be marked as ''isolated''\n \n+error.only.simple.variables.are.allowed.to.be.isolated=\\\n+  only simple variables are allowed to be isolated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDQ4OA==", "bodyText": "Let's update the error code accordingly.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531404488", "createdAt": "2020-11-27T06:28:27Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1599,5 +1599,8 @@ error.invalid.usage.of.multiple.restricted.vars.in.lock=\\\n error.invalid.isolated.qualifier.on.module.no.init.var.decl=\\\n   an uninitialized module variable declaration cannot be marked as ''isolated''\n \n+error.only.simple.variables.are.allowed.to.be.isolated=\\\n+  only simple variables are allowed to be isolated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDQxMA=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQ0MDY4Nw==", "bodyText": "Noted", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r531440687", "createdAt": "2020-11-27T08:12:39Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1599,5 +1599,8 @@ error.invalid.usage.of.multiple.restricted.vars.in.lock=\\\n error.invalid.isolated.qualifier.on.module.no.init.var.decl=\\\n   an uninitialized module variable declaration cannot be marked as ''isolated''\n \n+error.only.simple.variables.are.allowed.to.be.isolated=\\\n+  only simple variables are allowed to be isolated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwNDQxMA=="}, "originalCommit": {"oid": "32560c701223ace13558337a5da2cc17488a887b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjUwMTM4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzozOTowNFrOIF89tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNTozODozNFrOIGyL4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExMjYzMQ==", "bodyText": "How is this not an issue for other non-rest binding patterns? Rather than specifically checking here, I think we should try and set this initFunctionEnv before getting here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543112631", "createdAt": "2020-12-15T07:39:04Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1286,9 +1326,18 @@ public void visit(BLangTupleVariable varNode) {\n \n         // Create the variable definition statements using the root block stmt created\n         createVarDefStmts(varNode, blockStmt, tuple.symbol, null);\n-        createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n \n-        // Finally rewrite the populated block statement\n+        if (((this.env.scope.owner.tag & SymTag.PACKAGE) == SymTag.PACKAGE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk4NDYxMA==", "bodyText": "Reason behind this is desugar creates virtual simple variables for rest binding pattern. which will be added only to init function body at the end, So need to set the env to initFunctionEnv. Other variable def statements and virtual variables will be added as global variables, hence no issue.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543984610", "createdAt": "2020-12-16T05:38:34Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1286,9 +1326,18 @@ public void visit(BLangTupleVariable varNode) {\n \n         // Create the variable definition statements using the root block stmt created\n         createVarDefStmts(varNode, blockStmt, tuple.symbol, null);\n-        createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n \n-        // Finally rewrite the populated block statement\n+        if (((this.env.scope.owner.tag & SymTag.PACKAGE) == SymTag.PACKAGE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExMjYzMQ=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 151}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjUwNjg2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0MDoyNVrOIF9Arw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0MDoyNVrOIF9Arw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExMzM5MQ==", "bodyText": "If we are going with this approach, IMO we should bring the (BLangSimpleVariable) parentTupleVariable.restVariable != null check out of createRestFieldVarDefStmts and check that first before changing the env unnecessarily.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543113391", "createdAt": "2020-12-15T07:40:25Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1286,9 +1326,18 @@ public void visit(BLangTupleVariable varNode) {\n \n         // Create the variable definition statements using the root block stmt created\n         createVarDefStmts(varNode, blockStmt, tuple.symbol, null);\n-        createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);\n \n-        // Finally rewrite the populated block statement\n+        if (((this.env.scope.owner.tag & SymTag.PACKAGE) == SymTag.PACKAGE)) {\n+            // Rest field def stmt virtual variables will be added to init function body, hence change the env\n+            SymbolEnv previousEnv = this.env;\n+            this.env = this.initFunctionEnv;\n+            createRestFieldVarDefStmts(varNode, blockStmt, tuple.symbol);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjUxMDQ2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0MToxOFrOIF9ChA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0MToxOFrOIF9ChA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExMzg2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            && (varNode.symbol.owner.tag & SymTag.LET) != SymTag.LET &&\n          \n          \n            \n                            (varNode.symbol.owner.tag & SymTag.PACKAGE) != SymTag.PACKAGE) {\n          \n          \n            \n                            && (varNode.symbol.owner.tag & SymTag.LET) != SymTag.LET\n          \n          \n            \n                            && (varNode.symbol.owner.tag & SymTag.PACKAGE) != SymTag.PACKAGE) {\n          \n      \n    \n    \n  \n\nfor consistency.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543113860", "createdAt": "2020-12-15T07:41:18Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -1205,7 +1243,8 @@ public void visit(BLangAnnotationAttachment annAttachmentNode) {\n     @Override\n     public void visit(BLangSimpleVariable varNode) {\n         if (((varNode.symbol.owner.tag & SymTag.INVOKABLE) != SymTag.INVOKABLE)\n-                && (varNode.symbol.owner.tag & SymTag.LET) != SymTag.LET) {\n+                && (varNode.symbol.owner.tag & SymTag.LET) != SymTag.LET &&\n+                (varNode.symbol.owner.tag & SymTag.PACKAGE) != SymTag.PACKAGE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjUyOTgyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0NjoyOVrOIF9NuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNzo0NjoyOVrOIF9NuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExNjcyOA==", "bodyText": "Instead of introducing a global variable shall we check if it possible to move this desugarGlobalVariables and use the env from there?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543116728", "createdAt": "2020-12-15T07:46:29Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -606,6 +608,9 @@ private void createPackageInitFunctions(BLangPackage pkgNode, SymbolEnv env) {\n         createInvokableSymbol(pkgNode.startFunction, env);\n         // Create invokable symbol for stop function\n         createInvokableSymbol(pkgNode.stopFunction, env);\n+\n+        this.initFunctionEnv =\n+                SymbolEnv.createFunctionEnv(pkgNode.initFunction, pkgNode.initFunction.symbol.scope, env);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjYyNDA5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwODoxMTowOFrOIF-C-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwODoxMTowOFrOIF-C-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDM2MA==", "bodyText": "Unnecessary new line?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543130360", "createdAt": "2020-12-15T08:11:08Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -558,20 +558,23 @@ public BLangNode transform(ModulePartNode modulePart) {\n \n     @Override\n     public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjYzNDkxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwODoxMzo1OVrOIF-JJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNToxMDowOVrOIHk9Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMTk0MA==", "bodyText": "Don't we have to implement this similar to BLangSimpleVariable?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543131940", "createdAt": "2020-12-15T08:13:59Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -233,6 +234,11 @@ public void visit(BLangSimpleVariable varNode) {\n         notifyProcessors(attachmentList, (processor, list) -> processor.process(varNode, list));\n     }\n \n+    @Override\n+    public void visit(BLangTupleVariable tupleVariableNode) {\n+        /* ignore */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxNTUwMA==", "bodyText": "As discussed with @rdhananjaya architecture of the compiler plugin runner will be changed, so that we don't add new visit methods. However, I will create an issue to track this", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544815500", "createdAt": "2020-12-17T05:07:04Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -233,6 +234,11 @@ public void visit(BLangSimpleVariable varNode) {\n         notifyProcessors(attachmentList, (processor, list) -> processor.process(varNode, list));\n     }\n \n+    @Override\n+    public void visit(BLangTupleVariable tupleVariableNode) {\n+        /* ignore */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMTk0MA=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxNjQxNQ==", "bodyText": "#27541", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544816415", "createdAt": "2020-12-17T05:10:09Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -233,6 +234,11 @@ public void visit(BLangSimpleVariable varNode) {\n         notifyProcessors(attachmentList, (processor, list) -> processor.process(varNode, list));\n     }\n \n+    @Override\n+    public void visit(BLangTupleVariable tupleVariableNode) {\n+        /* ignore */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMTk0MA=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjYzNjk4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwODoxNDoyNVrOIF-KQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNDo0NzowMFrOIHkg-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMjIyNA==", "bodyText": "Is there an issue for this?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543132224", "createdAt": "2020-12-15T08:14:25Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -344,10 +344,21 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n-            if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticErrorCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        // TODO: remove unwanted cases after disallowing uninitialized tuple variables from parser", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgwOTIxMQ==", "bodyText": "Yes, #27259", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544809211", "createdAt": "2020-12-17T04:47:00Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -344,10 +344,21 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n-            if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticErrorCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        // TODO: remove unwanted cases after disallowing uninitialized tuple variables from parser", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMjIyNA=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzM1MzA1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/model/symbols/BComplexVarSymbol.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDo0OToyNlrOIGEtFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwOTo0MzowNVrOIHs_fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzOTQ0NQ==", "bodyText": "Can't we make this work with BVarSymbol instead of introducing a new kind of symbol just for this?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543239445", "createdAt": "2020-12-15T10:49:26Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/model/symbols/BComplexVarSymbol.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.wso2.ballerinalang.compiler.semantics.model.symbols;\n+\n+import io.ballerina.tools.diagnostics.Location;\n+import org.ballerinalang.model.elements.PackageID;\n+import org.ballerinalang.model.symbols.SymbolOrigin;\n+import org.wso2.ballerinalang.compiler.semantics.model.types.BType;\n+import org.wso2.ballerinalang.compiler.util.Name;\n+\n+\n+/**\n+ * This symbol is used as the symbol of variables other than a simple variable.\n+ * <br/>\n+ * The only need of a symbol for complex variables is to record dependencies in the DataFlowAnalyzer.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxNzcxOQ==", "bodyText": "We can, but as discussed with @rdhananjaya it would be better to distinguish these symbols with simple variable symbols. because these symbols are only used in DataFlowAnalyzer.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544817719", "createdAt": "2020-12-17T05:14:16Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/model/symbols/BComplexVarSymbol.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.wso2.ballerinalang.compiler.semantics.model.symbols;\n+\n+import io.ballerina.tools.diagnostics.Location;\n+import org.ballerinalang.model.elements.PackageID;\n+import org.ballerinalang.model.symbols.SymbolOrigin;\n+import org.wso2.ballerinalang.compiler.semantics.model.types.BType;\n+import org.wso2.ballerinalang.compiler.util.Name;\n+\n+\n+/**\n+ * This symbol is used as the symbol of variables other than a simple variable.\n+ * <br/>\n+ * The only need of a symbol for complex variables is to record dependencies in the DataFlowAnalyzer.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzOTQ0NQ=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk0ODA5NQ==", "bodyText": "Used the same BVarSymbol for complex variables as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544948095", "createdAt": "2020-12-17T09:43:05Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/model/symbols/BComplexVarSymbol.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.wso2.ballerinalang.compiler.semantics.model.symbols;\n+\n+import io.ballerina.tools.diagnostics.Location;\n+import org.ballerinalang.model.elements.PackageID;\n+import org.ballerinalang.model.symbols.SymbolOrigin;\n+import org.wso2.ballerinalang.compiler.semantics.model.types.BType;\n+import org.wso2.ballerinalang.compiler.util.Name;\n+\n+\n+/**\n+ * This symbol is used as the symbol of variables other than a simple variable.\n+ * <br/>\n+ * The only need of a symbol for complex variables is to record dependencies in the DataFlowAnalyzer.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzOTQ0NQ=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzM3ODE3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDo1NDo0OFrOIGE7zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNToxNzoyNlrOIHlGeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI0MzIxNA==", "bodyText": "Why do we need to make the expr null here?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543243214", "createdAt": "2020-12-15T10:54:48Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -860,6 +844,60 @@ private BLangStatementExpression createIfElseFromConfigurable(BLangSimpleVariabl\n         return new ArrayList<>(Arrays.asList(orgLiteral, moduleNameLiteral, versionLiteral, configNameLiteral));\n     }\n \n+    private List<BLangVariable> desugarGlobalVariables(List<BLangVariable> globalVars,\n+                                                       BLangBlockFunctionBody initFnBody) {\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n+\n+        globalVars.forEach(globalVar -> {\n+            // This will convert complex variables to simple variables.\n+            switch (globalVar.getKind()) {\n+                case TUPLE_VARIABLE:\n+                    BLangNode blockStatementNode = rewrite(globalVar, env);\n+                    for (BLangStatement bLangStatement : ((BLangBlockStmt) blockStatementNode).stmts) {\n+                        if (bLangStatement.getKind() == NodeKind.FOREACH) {\n+                            initFnBody.stmts.add(rewrite(bLangStatement, this.initFunctionEnv));\n+                            continue;\n+                        }\n+                        BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                        simpleVarDef.var.annAttachments = globalVar.getAnnotationAttachments();\n+                        rewrite(simpleVarDef, env);\n+                        addToInitFunction(simpleVarDef.var, initFnBody);\n+                        desugaredGlobalVarList.add(simpleVarDef.var);\n+                    }\n+                    break;\n+                default:\n+                    long globalVarFlags = globalVar.symbol.flags;\n+                    BLangSimpleVariable simpleGlobalVar = (BLangSimpleVariable) globalVar;\n+                    if (Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n+                        if (Symbols.isFlagOn(globalVarFlags, Flags.REQUIRED)) {\n+                            // If it is required configuration get directly\n+                            List<BLangExpression> args = getConfigurableLangLibInvocationParam(simpleGlobalVar);\n+                            BLangInvocation getValueInvocation = createLangLibInvocationNode(\"getConfigurableValue\",\n+                                    args, symTable.anydataType, simpleGlobalVar.pos);\n+                            simpleGlobalVar.expr = getValueInvocation;\n+                        } else {\n+                            // If it is optional configuration create if else\n+                            simpleGlobalVar.expr = createIfElseFromConfigurable(simpleGlobalVar);\n+                        }\n+                    }\n+                    addToInitFunction(simpleGlobalVar, initFnBody);\n+                    desugaredGlobalVarList.add(simpleGlobalVar);\n+                    break;\n+            }\n+        });\n+\n+        return desugaredGlobalVarList;\n+    }\n+\n+    private void addToInitFunction(BLangSimpleVariable globalVar, BLangBlockFunctionBody initFnBody) {\n+        if (globalVar.expr == null) {\n+            return;\n+        }\n+        BLangAssignment assignment = createAssignmentStmt(globalVar);\n+        initFnBody.stmts.add(assignment);\n+        globalVar.expr = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxODgwOA==", "bodyText": "Global variables are initialized inside the init method so remove the expression and add it to global variables. This concept was there before this PR I have just moved it here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544818808", "createdAt": "2020-12-17T05:17:26Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -860,6 +844,60 @@ private BLangStatementExpression createIfElseFromConfigurable(BLangSimpleVariabl\n         return new ArrayList<>(Arrays.asList(orgLiteral, moduleNameLiteral, versionLiteral, configNameLiteral));\n     }\n \n+    private List<BLangVariable> desugarGlobalVariables(List<BLangVariable> globalVars,\n+                                                       BLangBlockFunctionBody initFnBody) {\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n+\n+        globalVars.forEach(globalVar -> {\n+            // This will convert complex variables to simple variables.\n+            switch (globalVar.getKind()) {\n+                case TUPLE_VARIABLE:\n+                    BLangNode blockStatementNode = rewrite(globalVar, env);\n+                    for (BLangStatement bLangStatement : ((BLangBlockStmt) blockStatementNode).stmts) {\n+                        if (bLangStatement.getKind() == NodeKind.FOREACH) {\n+                            initFnBody.stmts.add(rewrite(bLangStatement, this.initFunctionEnv));\n+                            continue;\n+                        }\n+                        BLangSimpleVariableDef simpleVarDef = (BLangSimpleVariableDef) bLangStatement;\n+                        simpleVarDef.var.annAttachments = globalVar.getAnnotationAttachments();\n+                        rewrite(simpleVarDef, env);\n+                        addToInitFunction(simpleVarDef.var, initFnBody);\n+                        desugaredGlobalVarList.add(simpleVarDef.var);\n+                    }\n+                    break;\n+                default:\n+                    long globalVarFlags = globalVar.symbol.flags;\n+                    BLangSimpleVariable simpleGlobalVar = (BLangSimpleVariable) globalVar;\n+                    if (Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {\n+                        if (Symbols.isFlagOn(globalVarFlags, Flags.REQUIRED)) {\n+                            // If it is required configuration get directly\n+                            List<BLangExpression> args = getConfigurableLangLibInvocationParam(simpleGlobalVar);\n+                            BLangInvocation getValueInvocation = createLangLibInvocationNode(\"getConfigurableValue\",\n+                                    args, symTable.anydataType, simpleGlobalVar.pos);\n+                            simpleGlobalVar.expr = getValueInvocation;\n+                        } else {\n+                            // If it is optional configuration create if else\n+                            simpleGlobalVar.expr = createIfElseFromConfigurable(simpleGlobalVar);\n+                        }\n+                    }\n+                    addToInitFunction(simpleGlobalVar, initFnBody);\n+                    desugaredGlobalVarList.add(simpleGlobalVar);\n+                    break;\n+            }\n+        });\n+\n+        return desugaredGlobalVarList;\n+    }\n+\n+    private void addToInitFunction(BLangSimpleVariable globalVar, BLangBlockFunctionBody initFnBody) {\n+        if (globalVar.expr == null) {\n+            return;\n+        }\n+        BLangAssignment assignment = createAssignmentStmt(globalVar);\n+        initFnBody.stmts.add(assignment);\n+        globalVar.expr = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI0MzIxNA=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzQzOTU5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTowODo1NlrOIGFfVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNToyMjoxMFrOIHlMYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MjMxMQ==", "bodyText": "Can't we just define the symbol here and continue to do the actual checkTypeAndVarCountConsistency logic at semantic analysis? I'm not sure if calling types.checkType from symbol enter (L1754) is the best approach.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r543252311", "createdAt": "2020-12-15T11:08:56Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1613,10 +1619,153 @@ public void visit(BLangSimpleVariable varNode) {\n \n     @Override\n     public void visit(BLangTupleVariable varNode) {\n-        // assign the type to var type node\n+        if (varNode.isDeclaredWithVar) {\n+            // Will be handled in semantic analyzer.\n+            return;\n+        }\n         if (varNode.type == null) {\n             varNode.type = symResolver.resolveTypeNode(varNode.typeNode, env);\n         }\n+\n+        // To support variable forward referencing we need to symbol enter each tuple member with type at SymbolEnter.\n+        if (!(checkTypeAndVarCountConsistency(varNode, env))) {\n+            varNode.type = symTable.semanticError;\n+            return;\n+        }\n+    }\n+\n+    boolean checkTypeAndVarCountConsistency(BLangTupleVariable varNode, SymbolEnv env) {\n+\n+        Name varName = names.fromString(anonymousModelHelper.getNextTupleVarKey(env.enclPkg.packageID));\n+\n+        BComplexVarSymbol varSymbol = createComplexVarSymbol(varNode.flagSet, varNode.type, varName, env, varNode.pos,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgyMDMyMQ==", "bodyText": "Actually, my previous approach is that. used type as 'other' for member variables at the symbol enter. But it causes errors in variable forward referencing.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r544820321", "createdAt": "2020-12-17T05:22:10Z", "author": {"login": "rdulmina"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1613,10 +1619,153 @@ public void visit(BLangSimpleVariable varNode) {\n \n     @Override\n     public void visit(BLangTupleVariable varNode) {\n-        // assign the type to var type node\n+        if (varNode.isDeclaredWithVar) {\n+            // Will be handled in semantic analyzer.\n+            return;\n+        }\n         if (varNode.type == null) {\n             varNode.type = symResolver.resolveTypeNode(varNode.typeNode, env);\n         }\n+\n+        // To support variable forward referencing we need to symbol enter each tuple member with type at SymbolEnter.\n+        if (!(checkTypeAndVarCountConsistency(varNode, env))) {\n+            varNode.type = symTable.semanticError;\n+            return;\n+        }\n+    }\n+\n+    boolean checkTypeAndVarCountConsistency(BLangTupleVariable varNode, SymbolEnv env) {\n+\n+        Name varName = names.fromString(anonymousModelHelper.getNextTupleVarKey(env.enclPkg.packageID));\n+\n+        BComplexVarSymbol varSymbol = createComplexVarSymbol(varNode.flagSet, varNode.type, varName, env, varNode.pos,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MjMxMQ=="}, "originalCommit": {"oid": "93d46f819b3c6ba6a3d7a9ff866c4da58f4ed32e"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODE4OTQ0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzozOToxNlrOINkvxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzozOToxNlrOINkvxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwNDQ1NQ==", "bodyText": "Why do we check i == 0 here? Shall we add a comment too?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551104455", "createdAt": "2021-01-04T03:39:16Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -862,6 +843,64 @@ private BLangStatementExpression createIfElseFromConfigurable(BLangSimpleVariabl\n         return new ArrayList<>(Arrays.asList(orgLiteral, moduleNameLiteral, versionLiteral, configNameLiteral));\n     }\n \n+    private List<BLangVariable> desugarGlobalVariables(BLangPackage pkgNode, BLangBlockFunctionBody initFnBody) {\n+        List<BLangVariable> globalVars = pkgNode.globalVars;\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n+        SymbolEnv initFunctionEnv =\n+                SymbolEnv.createFunctionEnv(pkgNode.initFunction, pkgNode.initFunction.symbol.scope, env);\n+\n+        globalVars.forEach(globalVar -> {\n+            this.env.enclPkg.topLevelNodes.remove(globalVar);\n+            // This will convert complex variables to simple variables.\n+            switch (globalVar.getKind()) {\n+                case TUPLE_VARIABLE:\n+                    BLangNode blockStatementNode = rewrite(globalVar, initFunctionEnv);\n+                    List<BLangStatement> statements = ((BLangBlockStmt) blockStatementNode).stmts;\n+                    for (int i = 0; i < statements.size(); i++) {\n+                        BLangStatement bLangStatement = statements.get(i);\n+                        if (bLangStatement.getKind() == NodeKind.BLOCK || i == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODIxMjQxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/ServiceDesugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzo1NTowMlrOINk7dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzo1NTowMlrOINk7dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwNzQ0NQ==", "bodyText": "Shall we replace these also with ordinary for loops? Please check the same for other .forEach introductions in this PR.\nSee https://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551107445", "createdAt": "2021-01-04T03:55:02Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/ServiceDesugar.java", "diffHunk": "@@ -88,19 +89,22 @@ private ServiceDesugar(CompilerContext context) {\n         this.transactionDesugar = TransactionDesugar.getInstance(context);\n     }\n \n-    void rewriteListeners(List<BLangSimpleVariable> variables, SymbolEnv env, BLangFunction startFunction,\n+    void rewriteListeners(List<BLangVariable> variables, SymbolEnv env, BLangFunction startFunction,\n                           BLangFunction stopFunction) {\n-        variables.stream().filter(varNode -> Symbols.isFlagOn(varNode.symbol.flags, Flags.LISTENER))\n-                .forEach(varNode -> rewriteListener(varNode, env, startFunction, stopFunction));\n+        variables.forEach(varNode -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODIyNTM3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDowNToyM1rOINlCTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDowNToyM1rOINlCTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwOTE5Ng==", "bodyText": "Do we need the default case here?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551109196", "createdAt": "2021-01-04T04:05:23Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -344,10 +344,21 @@ private void analyzeModuleInitFunc(BLangFunction funcNode) {\n         this.currDependentSymbol.pop();\n     }\n \n-    private void checkForUninitializedGlobalVars(List<BLangSimpleVariable> globalVars) {\n-        for (BLangSimpleVariable globalVar : globalVars) {\n-            if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n-                this.dlog.error(globalVar.pos, DiagnosticErrorCode.UNINITIALIZED_VARIABLE, globalVar.name);\n+    private void checkForUninitializedGlobalVars(List<BLangVariable> globalVars) {\n+        // TODO: remove unwanted cases after disallowing uninitialized tuple variables from parser\n+        for (BLangVariable globalVar : globalVars) {\n+            switch (globalVar.getKind()) {\n+                case VARIABLE:\n+                    if (this.uninitializedVars.containsKey(globalVar.symbol)) {\n+                        this.dlog.error(globalVar.pos, DiagnosticErrorCode.UNINITIALIZED_VARIABLE,\n+                                ((BLangSimpleVariable) globalVar).name);\n+                    }\n+                    break;\n+                case TUPLE_VARIABLE:\n+                    checkForUninitializedGlobalVars(((BLangTupleVariable) globalVar).memberVariables);\n+                    break;\n+                default:\n+                    break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODIyNjcyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDowNjoyOVrOINlDBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDowNjoyOVrOINlDBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwOTM4Mw==", "bodyText": "We no longer need the var variable, right?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    analyzeNode(var, env);\n          \n          \n            \n                    analyzeNode(bLangTupleVariableDef.var, env);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551109383", "createdAt": "2021-01-04T04:06:29Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -1656,15 +1667,21 @@ public void visit(BLangErrorVarRef varRefExpr) {\n     @Override\n     public void visit(BLangTupleVariable bLangTupleVariable) {\n         analyzeNode(bLangTupleVariable.typeNode, env);\n+        if (bLangTupleVariable.expr != null) {\n+            this.currDependentSymbol.push(bLangTupleVariable.symbol);\n+            analyzeNode(bLangTupleVariable.expr, env);\n+            this.currDependentSymbol.pop();\n+            return;\n+        }\n+        bLangTupleVariable.memberVariables.forEach(member -> {\n+            analyzeNode(member, env);\n+        });\n     }\n \n     @Override\n     public void visit(BLangTupleVariableDef bLangTupleVariableDef) {\n         BLangVariable var = bLangTupleVariableDef.var;\n-        if (var.expr == null) {\n-            addUninitializedVar(var);\n-            return;\n-        }\n+        analyzeNode(var, env);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODIzNjg1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoxNToyMFrOINlIbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoxNToyMFrOINlIbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExMDc2NQ==", "bodyText": "Shall we extract out two variables\n           BType type = var.symbol.type;\n           BTypeSymbol tSymbol = type.tsymbol;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551110765", "createdAt": "2021-01-04T04:15:20Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -405,9 +407,12 @@ private void defineConstructs(BLangPackage pkgNode, SymbolEnv pkgEnv) {\n         pkgNode.globalVars.forEach(var -> defineNode(var, pkgEnv));\n \n         // Update globalVar for endpoints.\n-        pkgNode.globalVars.stream().filter(var -> var.symbol.type.tsymbol != null && Symbols\n-                .isFlagOn(var.symbol.type.tsymbol.flags, Flags.CLIENT)).map(varNode -> varNode.symbol)\n-                .forEach(varSymbol -> varSymbol.tag = SymTag.ENDPOINT);\n+        pkgNode.globalVars.forEach(var -> {\n+           if (var.getKind() == NodeKind.VARIABLE && var.symbol.type.tsymbol != null &&\n+                   Symbols.isFlagOn(var.symbol.type.tsymbol.flags, Flags.CLIENT)) {\n+               var.symbol.tag = SymTag.ENDPOINT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODIzNzU5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoxNTo1MlrOINlIzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoxNTo1MlrOINlIzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExMDg2MA==", "bodyText": "Shall we replace the stream?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551110860", "createdAt": "2021-01-04T04:15:52Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1618,10 +1623,157 @@ public void visit(BLangSimpleVariable varNode) {\n \n     @Override\n     public void visit(BLangTupleVariable varNode) {\n-        // assign the type to var type node\n+        if (varNode.isDeclaredWithVar) {\n+            // Symbol enter with type other\n+            varNode.memberVariables.forEach(member -> {\n+                member.isDeclaredWithVar = true;\n+                defineNode(member, env);\n+            });\n+            return;\n+        }\n         if (varNode.type == null) {\n             varNode.type = symResolver.resolveTypeNode(varNode.typeNode, env);\n         }\n+        // To support variable forward referencing we need to symbol enter each tuple member with type at SymbolEnter.\n+        if (!(checkTypeAndVarCountConsistency(varNode, env))) {\n+            varNode.type = symTable.semanticError;\n+            return;\n+        }\n+    }\n+\n+    boolean checkTypeAndVarCountConsistency(BLangTupleVariable varNode, SymbolEnv env) {\n+        Name varName = names.fromString(anonymousModelHelper.getNextTupleVarKey(env.enclPkg.packageID));\n+        varNode.symbol = defineVarSymbol(varNode.pos, varNode.flagSet, varNode.type, varName, env, varNode.internal);\n+        \n+        return checkTypeAndVarCountConsistency(varNode, null, env);\n+    }\n+\n+    boolean checkTypeAndVarCountConsistency(BLangTupleVariable varNode, BTupleType tupleTypeNode,\n+                                                    SymbolEnv env) {\n+\n+        if (tupleTypeNode == null) {\n+        /*\n+          This switch block will resolve the tuple type of the tuple variable.\n+          For example consider the following - [int, string]|[boolean, float] [a, b] = foo();\n+          Since the varNode type is a union, the types of 'a' and 'b' will be resolved as follows:\n+          Type of 'a' will be (int | boolean) while the type of 'b' will be (string | float).\n+          Consider anydata (a, b) = foo();\n+          Here, the type of 'a'and type of 'b' will be both anydata.\n+         */\n+            switch (varNode.type.tag) {\n+                case TypeTags.UNION:\n+                    Set<BType> unionType = types.expandAndGetMemberTypesRecursive(varNode.type);\n+                    List<BType> possibleTypes = unionType.stream()\n+                            .filter(type -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODI0MzI4OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/vardeclr/ModuleVariableTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoxOTo1OFrOINlLxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoxOTo1OFrOINlLxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExMTYyMA==", "bodyText": "Shall we use a data provider instead? That way we can get the subsequent tests to run even when one of these fails.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551111620", "createdAt": "2021-01-04T04:19:58Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/vardeclr/ModuleVariableTest.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.ballerinalang.test.statements.vardeclr;\n+\n+import org.ballerinalang.test.BCompileUtil;\n+import org.ballerinalang.test.BRunUtil;\n+import org.ballerinalang.test.CompileResult;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import static org.ballerinalang.test.BAssertUtil.validateError;\n+import static org.testng.Assert.assertEquals;\n+\n+/**\n+ * Class to test module level variable declaration for all binding patterns.\n+ *\n+ * @since 2.0\n+ */\n+public class ModuleVariableTest {\n+\n+    private CompileResult compileResult, compileResultNegative;\n+\n+    @BeforeClass\n+    public void setup() {\n+        compileResult = BCompileUtil.compile(\"test-src/statements/vardeclr/module_tuple_var_decl.bal\");\n+        compileResultNegative = BCompileUtil.compile(\"test-src/statements/vardeclr/module_tuple_var_decl_negetive.bal\");\n+    }\n+\n+    @Test\n+    public void testBasicModuleLevelTupleVarDecl() {\n+        BRunUtil.invoke(compileResult, \"testBasic\");\n+    }\n+    \n+    @Test\n+    public void testComplexModuleLevelTupleVarDecl() {\n+        BRunUtil.invoke(compileResult, \"testTupleBindingWithRecordsAndObjects\");\n+        BRunUtil.invoke(compileResult, \"testTupleBindingPatternWithRestBindingPattern\");\n+        BRunUtil.invoke(compileResult, \"testDeclaredWithVar\");\n+        BRunUtil.invoke(compileResult, \"testTupleVarWithAnnotations\");\n+        BRunUtil.invoke(compileResult, \"testVariableForwardReferencing\");\n+        BRunUtil.invoke(compileResult, \"testVariableDeclaredInTupleAsAnnotationValue\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODI0NDgzOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoyMTozMlrOINlMmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDoyMTozMlrOINlMmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExMTgzMw==", "bodyText": "Shall we add deprecation tests too? Let's check and add tests for each phase where possible, if not already done.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r551111833", "createdAt": "2021-01-04T04:21:32Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "diffHunk": "@@ -151,6 +152,17 @@ public void visit(BLangSimpleVariable varNode) {\n         validateDeprecatedParametersDocumentation(varNode.markdownDocumentationAttachment, varNode.pos);\n     }\n \n+    @Override\n+    public void visit(BLangTupleVariable tupleVariableNode) {\n+        validateNoParameters(tupleVariableNode);\n+        validateReturnParameter(tupleVariableNode, null, false);\n+        validateReferences(tupleVariableNode);\n+        validateDeprecationDocumentation(tupleVariableNode.markdownDocumentationAttachment, false,\n+                tupleVariableNode.pos);\n+        validateDeprecatedParametersDocumentation(tupleVariableNode.markdownDocumentationAttachment,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1a8f1960474000368a1c2103025f0be5cabc39"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzA1MTMxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwMzoyNzoyMVrOIRwQEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwMzoyNzoyMVrOIRwQEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQ4NzI0OQ==", "bodyText": "This isn't quite clear to me. Are we trying to say\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    // Rest binding pattern array initialization will be desugared as a block hence add them only\n          \n          \n            \n                                    // to init function body.\n          \n          \n            \n                                    // Rest binding pattern array initialization will be desugared as a block hence add them \n          \n          \n            \n                                    // directly to the init function body.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555487249", "createdAt": "2021-01-12T03:27:21Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -860,6 +841,67 @@ private BLangStatementExpression createIfElseFromConfigurable(BLangSimpleVariabl\n         return new ArrayList<>(Arrays.asList(orgLiteral, moduleNameLiteral, versionLiteral, configNameLiteral));\n     }\n \n+    private List<BLangVariable> desugarGlobalVariables(BLangPackage pkgNode, BLangBlockFunctionBody initFnBody) {\n+        List<BLangVariable> globalVars = pkgNode.globalVars;\n+        List<BLangVariable> desugaredGlobalVarList = new ArrayList<>();\n+        SymbolEnv initFunctionEnv =\n+                SymbolEnv.createFunctionEnv(pkgNode.initFunction, pkgNode.initFunction.symbol.scope, env);\n+\n+        globalVars.forEach(globalVar -> {\n+            this.env.enclPkg.topLevelNodes.remove(globalVar);\n+            // This will convert complex variables to simple variables.\n+            switch (globalVar.getKind()) {\n+                case TUPLE_VARIABLE:\n+                    BLangNode blockStatementNode = rewrite(globalVar, initFunctionEnv);\n+                    List<BLangStatement> statements = ((BLangBlockStmt) blockStatementNode).stmts;\n+                    for (int i = 0; i < statements.size(); i++) {\n+                        BLangStatement bLangStatement = statements.get(i);\n+                        // First statement is the virtual array created for the init expression.\n+                        // Rest binding pattern array initialization will be desugared as a block hence add them only\n+                        // to init function body.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2fce30176fadfbae4d3a450887d17c5e6ca45e5"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzE2MjE4OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/documentation/markdown_negative.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxNzozMFrOIRxRmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTowNDo1MFrOIRx_4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUwNDAyNg==", "bodyText": "Even the following wouldn't work, right?\n# Docs.\n# + a - docs for a\n# + b - docs for b\n[int, float] [a, b] = getTuple();\nIMO, we need to have a way to document the individual variables. Shall we initiate a discussion regarding this?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555504026", "createdAt": "2021-01-12T04:17:30Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/documentation/markdown_negative.bal", "diffHunk": "@@ -110,3 +110,8 @@ final string testConsts = \"TestConstantDocumentation\";\n public function load(string filePath) {\n \n }\n+\n+# + a - parameter a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19e603ba1daabc2a973852d60bd6737b8a25204e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUxNTg3Mw==", "bodyText": "+1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555515873", "createdAt": "2021-01-12T05:04:50Z", "author": {"login": "rdulmina"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/documentation/markdown_negative.bal", "diffHunk": "@@ -110,3 +110,8 @@ final string testConsts = \"TestConstantDocumentation\";\n public function load(string filePath) {\n \n }\n+\n+# + a - parameter a", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUwNDAyNg=="}, "originalCommit": {"oid": "19e603ba1daabc2a973852d60bd6737b8a25204e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzE2MjY5OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/documentation/markdown_negative.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxNzo0MlrOIRxR2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxNzo0MlrOIRxR2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUwNDA4OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [int ,float, string] [a, b, c] = [1, 2.5, \"Mac\"];\n          \n          \n            \n            [int, float, string] [a, b, c] = [1, 2.5, \"Mac\"];", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555504088", "createdAt": "2021-01-12T04:17:42Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/documentation/markdown_negative.bal", "diffHunk": "@@ -110,3 +110,8 @@ final string testConsts = \"TestConstantDocumentation\";\n public function load(string filePath) {\n \n }\n+\n+# + a - parameter a\n+# + return - `float` return parameter is float\n+# # parameter `invalidParameter`\n+[int ,float, string] [a, b, c] = [1, 2.5, \"Mac\"];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19e603ba1daabc2a973852d60bd6737b8a25204e"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzE2NDMxOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxODo0NVrOIRxS0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxODo0NVrOIRxS0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUwNDMzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [int ,float] [a, b] = [1, 2.5];\n          \n          \n            \n            [int, float] [a ,b] = [1, 2.5];\n          \n      \n    \n    \n  \n\nPlease check wherever applicable.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555504336", "createdAt": "2021-01-12T04:18:45Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl.bal", "diffHunk": "@@ -0,0 +1,155 @@\n+//  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+//  WSO2 Inc. licenses this file to you under the Apache License,\n+//  Version 2.0 (the \"License\"); you may not use this file except\n+//  in compliance with the License.\n+//  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+// Test module level list binding pattern\n+[int ,float] [a, b] = [1, 2.5];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19e603ba1daabc2a973852d60bd6737b8a25204e"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzE2NDc2OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl_annotation_negetive.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxOTowMFrOIRxTBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNDoxOTowMFrOIRxTBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUwNDM4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [int, byte] [d,e] = [1,3];\n          \n          \n            \n            [int, byte] [d, e] = [1, 3];", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555504389", "createdAt": "2021-01-12T04:19:00Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl_annotation_negetive.bal", "diffHunk": "@@ -0,0 +1,21 @@\n+//  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+//  WSO2 Inc. licenses this file to you under the Apache License,\n+//  Version 2.0 (the \"License\"); you may not use this file except\n+//  in compliance with the License.\n+//  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+// deprecated annotation not allowed\n+# # Deprecated\n+# This tuple is deprecated.\n+@deprecated\n+[int, byte] [d,e] = [1,3];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19e603ba1daabc2a973852d60bd6737b8a25204e"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzMxNDk4OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl_negetive.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTo0Mjo0MFrOIRyoPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTo0Mjo0MFrOIRyoPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUyNjIwNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [int ,float, string] [a, b, c] = [1, 2.5, \"Mac\"];\n          \n          \n            \n            [int, float, string] [a, b, c] = [1, 2.5, \"Mac\"];", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555526207", "createdAt": "2021-01-12T05:42:40Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl_negetive.bal", "diffHunk": "@@ -0,0 +1,44 @@\n+//  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+//  WSO2 Inc. licenses this file to you under the Apache License,\n+//  Version 2.0 (the \"License\"); you may not use this file except\n+//  in compliance with the License.\n+//  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+//Test duplicate module level var declaration inside tuple binding pattern\n+int a = 5;\n+[int ,float, string] [a, b, c] = [1, 2.5, \"Mac\"];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336a2042ed281e6019f596f6bc2f9668fb11ccc8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzMxNTUxOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTo0MzowNFrOIRyolA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTo0MzowNFrOIRyolA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUyNjI5Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [decimal, byte] [l, m] = [n ,o];\n          \n          \n            \n            [decimal, byte] [l, m] = [n, o];", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555526292", "createdAt": "2021-01-12T05:43:04Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/vardeclr/module_tuple_var_decl.bal", "diffHunk": "@@ -0,0 +1,153 @@\n+//  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+//  WSO2 Inc. licenses this file to you under the Apache License,\n+//  Version 2.0 (the \"License\"); you may not use this file except\n+//  in compliance with the License.\n+//  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+// Test module level list binding pattern\n+[int, float] [a, b] = [1, 2.5];\n+[boolean, float, string] [c, d, e] = [true, 2.25, \"Jhone\"];\n+public function testBasic() {\n+    while (d < 3) {\n+        d += 1;\n+    }\n+    assertTrue(c);\n+    assertEquality(3.25, d);\n+    assertEquality(\"Jhone\", e);\n+}\n+\n+// Recursive list binding pattern with objects\n+Foo foo = {name:\"Test\", age:23};\n+Bar bar = {id:34, flag:true};\n+FooObj fooObj = new (\"Fooo\", 3.7, 23);\n+BarObj barObj = new (true, 56);\n+[string, [Foo, [BarObj, FooObj]], [Bar, int]] [a2, [b2, [c2, d2]], [e2, f2]] = [foo.name, [foo, [barObj, fooObj]], [bar, barObj.i]];\n+\n+function testTupleBindingWithRecordsAndObjects() {\n+    assertEquality(\"Test\", a2);\n+    assertEquality(\"Test\", b2.name);\n+    assertEquality(23, b2.age);\n+    assertEquality(34, e2.id);\n+    assertTrue(e2.flag);\n+    assertEquality(\"Fooo\", d2.s);\n+    assertEquality(3.7, d2.f);\n+    assertEquality(23, d2.b);\n+    assertTrue(c2.b);\n+    assertEquality(56, c2.i);\n+    assertEquality(56, f2);\n+}\n+\n+// Test tuple binding pattern with rest binding pattern\n+[int, string...] [Id, ...FullName] = [1002, \"Peter\", \"Parker\"];\n+[int, string...] [Id2, ...FullName2] = [1003, \"Jhone\", \"Anistine\"];\n+function testTupleBindingPatternWithRestBindingPattern() {\n+    assertEquality(1002, Id);\n+    assertEquality(\"Peter\", FullName[0]);\n+    assertEquality(\"Parker\", FullName[1]);\n+    assertEquality(1003, Id2);\n+    assertEquality(\"Jhone\", FullName2[0]);\n+    assertEquality(\"Anistine\", FullName2[1]);\n+}\n+\n+// Tuple variable declared with 'var'\n+[int, string] g = [1, \"\"];\n+var [h, i] = g;\n+function testDeclaredWithVar() {\n+    assertEquality(1, h);\n+    assertEquality(\"\", i);\n+}\n+\n+// Test tuple var declaration with annotations\n+const annotation map<string> annot on source var;\n+\n+@annot {\n+    value: \"annotationValue\"\n+}\n+[int, int] [j, k] = [1, 2];\n+@annot {\n+    value: \"annotationValue\"\n+}\n+var [j1, k1] = g;\n+public function testTupleVarWithAnnotations() {\n+    assertEquality(1, j);\n+    assertEquality(2, k);\n+    assertEquality(1, j1);\n+    assertEquality(\"\", k1);\n+}\n+\n+annotation record {int i;} x on function;\n+@x {\n+    i: h\n+}\n+public function testVariableDeclaredInTupleAsAnnotationValue() {\n+    typedesc<function ()> td = typeof testVariableDeclaredInTupleAsAnnotationValue;\n+    record {int i;}? xVal = td.@x;\n+    assertEquality(<record {int i;}>{i:1}, xVal);\n+}\n+\n+// Test tuple variable reordering/forward referencing\n+[decimal, byte] [l, m] = [n ,o];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336a2042ed281e6019f596f6bc2f9668fb11ccc8"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NzMxNzM1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTo0Mzo1NlrOIRypnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNTo0Mzo1NlrOIRypnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTUyNjU1Ng==", "bodyText": "Have we added tests for the uninitialized local variable scenario fixed here?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555526556", "createdAt": "2021-01-12T05:43:56Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -1667,15 +1675,20 @@ public void visit(BLangErrorVarRef varRefExpr) {\n     @Override\n     public void visit(BLangTupleVariable bLangTupleVariable) {\n         analyzeNode(bLangTupleVariable.typeNode, env);\n+        if (bLangTupleVariable.expr != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336a2042ed281e6019f596f6bc2f9668fb11ccc8"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5ODQ1MjQ5OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/dataflow/analysis/uninitialized_local_tuple_variable.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxMToyNDowMlrOIR9OYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxMToyNDowMlrOIR9OYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTY5OTgwOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             // Copyright (c) 2018, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             // Copyright (c) 2021, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26599#discussion_r555699809", "createdAt": "2021-01-12T11:24:02Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/dataflow/analysis/uninitialized_local_tuple_variable.bal", "diffHunk": "@@ -0,0 +1,21 @@\n+ // Copyright (c) 2018, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6654c3bf18cf65767b8355bf81d83f6a7daa7d2f"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4647, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}