{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MTUxMzkz", "number": 27245, "title": "Desugar transaction & retry without lambda wrapping", "bodyText": "Purpose\n\nWhen transactions/retry are wrapped within lambda functions and these functions are visited separately at BIR generation; we cannot use fail/break statements within them and expect it to jump to the enclosing block.\n\nFixes #26562\nFixes #26853\nFixes #26653\nAddresses #27260\nApproach\n\nn/a\n\nSamples\n\nn/a\n\nRemarks\n\nn/a\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-11-29T18:30:39Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27245", "merged": true, "mergeCommit": {"oid": "2811322600380756c0804448324d7e634637e3c3"}, "closed": true, "closedAt": "2020-12-04T17:15:33Z", "author": {"login": "pcnfernando"}, "timelineItems": {"totalCount": 50, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZLdNSAH2gAyNTI5MTUxMzkzOmFlMTMwNjk1NzExNDk5ODA3N2EwZTc2NjgzYmU5NDg1NmFhZjBkNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi7AMKAFqTU0NTE0NjQ0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae1306957114998077a0e76683be94856aaf0d49", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae1306957114998077a0e76683be94856aaf0d49", "committedDate": "2020-11-04T10:46:12Z", "message": "Desugar trx to statement expr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40c2278c9559e7bfc377d640502afb2ae742d1d2", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/40c2278c9559e7bfc377d640502afb2ae742d1d2", "committedDate": "2020-11-04T11:58:53Z", "message": "Add rollback stmt to onfail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58bd7b9cd32a3c56e2dd74c31c61ead87d3e680a", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/58bd7b9cd32a3c56e2dd74c31c61ead87d3e680a", "committedDate": "2020-11-04T12:01:24Z", "message": "Temperoraly disable retry trx desugar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "312af553cb8bda0a8f645e42295f54b274e6ae46", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/312af553cb8bda0a8f645e42295f54b274e6ae46", "committedDate": "2020-11-04T13:42:49Z", "message": "Invoke cleanup within onfail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9c77892516a5a20498dc1d65a3697eace6f6f98", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f9c77892516a5a20498dc1d65a3697eace6f6f98", "committedDate": "2020-11-04T17:05:23Z", "message": "Rollback trx during a panic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "883b8c56feb705ab6beb5ce98c523504d2778061", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/883b8c56feb705ab6beb5ce98c523504d2778061", "committedDate": "2020-11-06T05:44:33Z", "message": "Add fail statement to nested trx to jump"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a0e4f836988e7602072b6c2d2634bf3996d0496", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a0e4f836988e7602072b6c2d2634bf3996d0496", "committedDate": "2020-11-10T08:51:49Z", "message": "Desugar rollback stmnt to a fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73e43e09101011dd694a452d8c2264d703821cec", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/73e43e09101011dd694a452d8c2264d703821cec", "committedDate": "2020-11-13T11:57:30Z", "message": "rewrite retry desugar without manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc09612facf73e082da7188d8c25854ea6dda68", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6dc09612facf73e082da7188d8c25854ea6dda68", "committedDate": "2020-11-16T12:39:08Z", "message": "Add retry manager to retry desugar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07307b33de11b6bc6eaf3cf0adbcdcf29e3f156f", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/07307b33de11b6bc6eaf3cf0adbcdcf29e3f156f", "committedDate": "2020-11-17T17:53:25Z", "message": "Add support to force jump from retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fc02d37b026e1a01328c82697f497bfa1594fb7", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6fc02d37b026e1a01328c82697f497bfa1594fb7", "committedDate": "2020-11-17T19:37:07Z", "message": "Add brake statement during nested onfail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44427216c3fba9d71736d42bcbd87c9578353be5", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/44427216c3fba9d71736d42bcbd87c9578353be5", "committedDate": "2020-11-19T09:13:37Z", "message": "Improve retry tests with on fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8b0652abf5462ae67ccfeb4b781aac42f9e8360", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8b0652abf5462ae67ccfeb4b781aac42f9e8360", "committedDate": "2020-11-19T09:14:20Z", "message": "Support returning error after max retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43f8914fe6b2c90060ffaa766cec227c392e16dc", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/43f8914fe6b2c90060ffaa766cec227c392e16dc", "committedDate": "2020-11-19T14:04:52Z", "message": "Add comments for retry desugaring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cefbe0ca807d3a8288e1525727b3054d60e90d99", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cefbe0ca807d3a8288e1525727b3054d60e90d99", "committedDate": "2020-11-19T16:08:56Z", "message": "Move var to scope without resetting in loop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2408f04f6f3d9a90d513359799126344bd22cb3", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a2408f04f6f3d9a90d513359799126344bd22cb3", "committedDate": "2020-11-19T16:29:37Z", "message": "Add nested retry with less onfail success test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2a704b8dfc886a6ad2827599f637875ad54f6e6", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2a704b8dfc886a6ad2827599f637875ad54f6e6", "committedDate": "2020-11-19T16:30:04Z", "message": "Add nested retry with less onfail success test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77ac9e9a31a1e25fe2b63941c06c2a78c1c13227", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/77ac9e9a31a1e25fe2b63941c06c2a78c1c13227", "committedDate": "2020-11-22T09:16:02Z", "message": "Introduce should panic check to internal onfail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1643f2ebb64c8ead4f24338bcb289abc1aede5b6", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1643f2ebb64c8ead4f24338bcb289abc1aede5b6", "committedDate": "2020-11-22T18:10:02Z", "message": "Add manual rollback test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd7bb5071edc8d3acbfc58f39a6b3da58aeb9f36", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fd7bb5071edc8d3acbfc58f39a6b3da58aeb9f36", "committedDate": "2020-11-22T18:10:49Z", "message": "Add retry transaction support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c5870dc1efba0edc5d6b63f2ece28404174b3c7", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3c5870dc1efba0edc5d6b63f2ece28404174b3c7", "committedDate": "2020-11-23T08:30:15Z", "message": "Add error return from trx test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60b46841df6bb7c1ba3a37d7f5b0f2bab3663e2c", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/60b46841df6bb7c1ba3a37d7f5b0f2bab3663e2c", "committedDate": "2020-11-23T11:26:50Z", "message": "Temp disable to verify test scenarios wrt spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6729cfa4bc28bba2bcb3d4a5072edc15f8abe609", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6729cfa4bc28bba2bcb3d4a5072edc15f8abe609", "committedDate": "2020-11-23T11:28:20Z", "message": "Assert panic in bal code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "175f272b572d605328722ee1522ca2b82cc3a137", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/175f272b572d605328722ee1522ca2b82cc3a137", "committedDate": "2020-11-23T11:29:05Z", "message": "Add tests for asserting returns after rollback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeabe1ebbd1decd338c942c0e8c2d6970bf4f1c0", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eeabe1ebbd1decd338c942c0e8c2d6970bf4f1c0", "committedDate": "2020-11-23T11:30:09Z", "message": "Support returns after rollback during failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04a2b0d5e4abe92849839182d9159c6b8de6c157", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/04a2b0d5e4abe92849839182d9159c6b8de6c157", "committedDate": "2020-11-23T12:30:13Z", "message": "Add desugaring steps as comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "349d085d17b13f426fd2e2168d316ef3f6cd5161", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/349d085d17b13f426fd2e2168d316ef3f6cd5161", "committedDate": "2020-11-23T12:30:30Z", "message": "Fix test failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "972ed74817a8a99c7e40ee302bacd8a3363c2dfe", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/972ed74817a8a99c7e40ee302bacd8a3363c2dfe", "committedDate": "2020-11-23T12:56:52Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang\n\n\u0001 Conflicts:\n\u0001\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\n\u0001\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/TransactionDesugar.java\n\u0001\ttests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/transaction/NestedRetryTransactionStmtsTest.java\n\u0001\ttests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/transaction/NestedTransactionTest.java\n\u0001\ttests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/transaction/RetryTransactionBlockStmtOutcomesTest.java\n\u0001\ttests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/transaction/TransactionStmtTest.java\n\u0001\ttests/jballerina-unit-test/src/test/resources/test-src/statements/transaction/nested_retry_transaction_stmts.bal\n\u0001\ttests/jballerina-unit-test/src/test/resources/test-src/statements/transaction/nested_transaction_test.bal\n\u0001\ttests/jballerina-unit-test/src/test/resources/test-src/statements/transaction/transaction_stmt.bal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dee38e312c3958b90564ca927378ea478d42fd8a", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dee38e312c3958b90564ca927378ea478d42fd8a", "committedDate": "2020-11-23T15:59:04Z", "message": "Sync with upstream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd30dfeb470a80477c1ecdd7549ae40647ccd9e7", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd30dfeb470a80477c1ecdd7549ae40647ccd9e7", "committedDate": "2020-11-23T15:59:43Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15c60f2a56600f64aaa8e47bb06d982abc446c55", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/15c60f2a56600f64aaa8e47bb06d982abc446c55", "committedDate": "2020-11-23T18:08:53Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8c595b7caa83690ab643c48acd2532fc5f00ec1", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c8c595b7caa83690ab643c48acd2532fc5f00ec1", "committedDate": "2020-11-24T15:25:21Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a985ac01f514698f1145cd269e9868df1705c27", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9a985ac01f514698f1145cd269e9868df1705c27", "committedDate": "2020-11-28T08:09:11Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c583abf2961646f22dbbe9e44313424e4cf5830", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8c583abf2961646f22dbbe9e44313424e4cf5830", "committedDate": "2020-11-29T12:57:18Z", "message": "Reset on-fail clause when visits end"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1251adf2961f1c1914838177139b16eeddc70f6d", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1251adf2961f1c1914838177139b16eeddc70f6d", "committedDate": "2020-11-29T13:05:58Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8066d60dbaad505360bf73a43950d3f7f7b6c75", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b8066d60dbaad505360bf73a43950d3f7f7b6c75", "committedDate": "2020-11-29T14:03:40Z", "message": "Remove commented code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18673384199f9193943767aabdfe1dd497b63276", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/18673384199f9193943767aabdfe1dd497b63276", "committedDate": "2020-11-30T16:46:38Z", "message": "Add multi level retry fail tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c29e3a6cfb7b7357b11ffbf4348a102ac241401d", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c29e3a6cfb7b7357b11ffbf4348a102ac241401d", "committedDate": "2020-11-30T16:53:20Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4fe241b5fe08fb6119e91d55c510d93777cbbf7", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c4fe241b5fe08fb6119e91d55c510d93777cbbf7", "committedDate": "2020-11-30T16:58:09Z", "message": "Merge branches 'on-fail-impl' and 'retry' of https://github.com/pcnfernando/ballerina-lang into retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73b0ca1f60117d33774a06c1aa142bd0481a7185", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/73b0ca1f60117d33774a06c1aa142bd0481a7185", "committedDate": "2020-11-30T17:18:42Z", "message": "Enable multi level retry fail tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8055cf613e3c3789f16602ef0b9a37773bdeb7fb", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8055cf613e3c3789f16602ef0b9a37773bdeb7fb", "committedDate": "2020-12-01T17:45:20Z", "message": "Return error from internal trx onfail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c2feae3fbfb1e600105944a0eb576bd3cb1809f", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4c2feae3fbfb1e600105944a0eb576bd3cb1809f", "committedDate": "2020-12-02T12:13:50Z", "message": "Check strand in trx mode before rollback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d47f11dced6d42c040bb6f7c13d2d4abe8b1e10", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9d47f11dced6d42c040bb6f7c13d2d4abe8b1e10", "committedDate": "2020-12-02T12:16:15Z", "message": "Add trx mode check to trx internal on fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944a89b342400d6fac837b476fa00265856028f5", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/944a89b342400d6fac837b476fa00265856028f5", "committedDate": "2020-12-02T18:49:15Z", "message": "Improve trx code analyzing for if statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df092fb4ab0da4145f7d46febe48a53ac34c1764", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/df092fb4ab0da4145f7d46febe48a53ac34c1764", "committedDate": "2020-12-03T17:49:06Z", "message": "Improve trx code analyzing for else if"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "652df45784d80f23a638ce0d9ede27f7698e3bc2", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/652df45784d80f23a638ce0d9ede27f7698e3bc2", "committedDate": "2020-12-03T17:49:41Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzM5ODE2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27245#pullrequestreview-544739816", "createdAt": "2020-12-04T08:19:48Z", "commit": {"oid": "944a89b342400d6fac837b476fa00265856028f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwODoxOTo0OFrOH_FrQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwODoxOTo0OFrOH_FrQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkxNTMyOQ==", "bodyText": "add more comments with desugaring", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27245#discussion_r535915329", "createdAt": "2020-12-04T08:19:48Z", "author": {"login": "pcnfernando"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -3757,28 +3996,203 @@ public void visit(BLangUnLockStmt unLockStmt) {\n         result = unLockStmt;\n     }\n \n+\n+    private BLangOnFailClause createTrxInternalOnFail(Location pos, BLangSimpleVarRef shouldPanicRef) {\n+        BLangOnFailClause trxOnFailClause = (BLangOnFailClause) TreeBuilder.createOnFailClauseNode();\n+        trxOnFailClause.pos = pos;\n+        trxOnFailClause.body = ASTBuilderUtil.createBlockStmt(pos);\n+        trxOnFailClause.body.scope = new Scope(env.scope.owner);\n+        trxOnFailClause.isInternal = true;\n+\n+        BVarSymbol trxOnFailErrorSym = new BVarSymbol(0, names.fromString(\"$trxError$\"),\n+                env.scope.owner.pkgID, symTable.errorType, env.scope.owner, pos, VIRTUAL);\n+        BLangSimpleVariable trxOnFailError = ASTBuilderUtil.createVariable(pos,\n+                \"$trxError$\", symTable.errorType, null, trxOnFailErrorSym);\n+        trxOnFailClause.variableDefinitionNode = ASTBuilderUtil.createVariableDef(pos,\n+                trxOnFailError);\n+        trxOnFailClause.body.scope.define(trxOnFailErrorSym.name, trxOnFailErrorSym);\n+        transactionDesugar.createRollbackIfFailed(pos, trxOnFailClause.body, trxOnFailErrorSym, trxBlockId);\n+\n+        BLangGroupExpr shouldNotPanic = new BLangGroupExpr();\n+        shouldNotPanic.type = symTable.booleanType;\n+        shouldNotPanic.expression = createNotBinaryExpression(pos, shouldPanicRef);\n+\n+        BLangSimpleVarRef caughtError =  ASTBuilderUtil.createVariableRef(pos, trxOnFailErrorSym);\n+\n+        BLangBlockStmt failBlock = ASTBuilderUtil.createBlockStmt(pos);\n+\n+        BLangPanic panicNode = (BLangPanic) TreeBuilder.createPanicNode();\n+        panicNode.pos = pos;\n+        panicNode.expr = caughtError;\n+\n+        BLangIf exitIf = ASTBuilderUtil.createIfElseStmt(pos, shouldNotPanic, failBlock, panicNode);\n+        trxOnFailClause.body.stmts.add(exitIf);\n+\n+        BLangFail failStmt = (BLangFail) TreeBuilder.createFailNode();\n+        failStmt.pos = pos;\n+        failStmt.expr = caughtError;\n+        failBlock.stmts.add(failStmt);\n+        trxOnFailClause.bodyContainsFail = true;\n+\n+        return trxOnFailClause;\n+    }\n+\n     @Override\n     public void visit(BLangTransaction transactionNode) {\n-        BLangOnFailClause currentOnFailClause = this.onFailClause;\n-        BLangSimpleVariableDef currentOnFailCallDef = this.onFailCallFuncDef;\n-        analyzeOnFailClause(transactionNode.onFailClause, transactionNode.transactionBody);\n-        BLangStatementExpression transactionStmtExpr = transactionDesugar.rewrite(transactionNode, env,\n-                onFailClause != null);\n-        result = createExpressionStatement(transactionNode.pos, transactionStmtExpr,\n-                transactionNode.statementBlockReturns, env);\n-        swapAndResetEnclosingOnFail(currentOnFailClause, currentOnFailCallDef);\n+        if (transactionNode.onFailClause != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "944a89b342400d6fac837b476fa00265856028f5"}, "originalPosition": 716}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "508c1f1cdf4b67ff777dd560fe091676c2531b69", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/508c1f1cdf4b67ff777dd560fe091676c2531b69", "committedDate": "2020-12-04T16:05:03Z", "message": "Add desugaring steps as comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b211243a3e4af8829d9df2a5db8b30768fbf248", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5b211243a3e4af8829d9df2a5db8b30768fbf248", "committedDate": "2020-12-04T16:07:40Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTQ2NDQ4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27245#pullrequestreview-545146448", "createdAt": "2020-12-04T17:15:16Z", "commit": {"oid": "5b211243a3e4af8829d9df2a5db8b30768fbf248"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4872, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}