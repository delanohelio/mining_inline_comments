{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNTIzMzUw", "number": 23829, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNToxMjo0OVrOEDtouw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwODoxNjo1NFrOEEMMYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMzI4ODkxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNToxMjo0OVrOGg4_1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNjoyODo1MFrOGg6fRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE0MTQ2Mw==", "bodyText": "I'm not sure if this belongs here. Why are we moving this from SemanticAnalyzer, given that BLangAnnotationAttachment itself is not an expression, and only the expr part is?\nWe already seem to be doing the relevant semantic/constant analyzer based analysis in SemanticAnalyzer, and only seem to be calling into TypeChecker for the expression https://github.com/ballerina-platform/ballerina-lang/pull/23829/files#diff-7123076514bbb67aa85076709d29ee0fL2880.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437141463", "createdAt": "2020-06-09T05:12:49Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3224,10 +3229,113 @@ public void visit(BLangUnaryExpr unaryExpr) {\n         resultType = types.checkType(unaryExpr, actualType, expType);\n     }\n \n+    public void visit(BLangAnnotationAttachment annAttachmentNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3874dacb47e020ea5a2d110eb549a63ea2a4cde2"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE1MjQ3MQ==", "bodyText": "What I want to do is execute annotation validation logic from typecheker since that's where we see the annotation on a typeconvertion expression.\nIf not moving to typechecker we will have to move that logic to its own class, but I don't see any compelling advantage of moving to a separate class that moving to typecheker.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437152471", "createdAt": "2020-06-09T05:50:46Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3224,10 +3229,113 @@ public void visit(BLangUnaryExpr unaryExpr) {\n         resultType = types.checkType(unaryExpr, actualType, expType);\n     }\n \n+    public void visit(BLangAnnotationAttachment annAttachmentNode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE0MTQ2Mw=="}, "originalCommit": {"oid": "3874dacb47e020ea5a2d110eb549a63ea2a4cde2"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE1NjgwMg==", "bodyText": "It seems we do call back to SemanticAnalyzer from typechecker.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437156802", "createdAt": "2020-06-09T06:03:57Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3224,10 +3229,113 @@ public void visit(BLangUnaryExpr unaryExpr) {\n         resultType = types.checkType(unaryExpr, actualType, expType);\n     }\n \n+    public void visit(BLangAnnotationAttachment annAttachmentNode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE0MTQ2Mw=="}, "originalCommit": {"oid": "3874dacb47e020ea5a2d110eb549a63ea2a4cde2"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2NTg5Mg==", "bodyText": "Yeah, there was a similar requirement with streaming and it was decided to have this circular dependency for the time-being instead of moving the logic.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437165892", "createdAt": "2020-06-09T06:28:50Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3224,10 +3229,113 @@ public void visit(BLangUnaryExpr unaryExpr) {\n         resultType = types.checkType(unaryExpr, actualType, expType);\n     }\n \n+    public void visit(BLangAnnotationAttachment annAttachmentNode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE0MTQ2Mw=="}, "originalCommit": {"oid": "3874dacb47e020ea5a2d110eb549a63ea2a4cde2"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyODE3NDg0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzo0Mzo1MlrOGhoy2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzo0Mzo1MlrOGhoy2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkyNDU3MQ==", "bodyText": "Unused?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437924571", "createdAt": "2020-06-10T07:43:52Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -6478,6 +6485,19 @@ private void logUndefinedSymbolError(DiagnosticPos pos, String name) {\n         }\n     }\n \n+    public void checkAnnot(BLangAnnotationAttachment annAttachmentNode, SymbolEnv env) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c19f1cb12777db9a2e97dfd1cb14a6a62aeb5d7f"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyODE3NTQ4OnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/report-tools/package.json", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzo0NDowOFrOGhozWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzo1MjozOVrOGhpGrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkyNDY5OQ==", "bodyText": "Do we need this change?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437924699", "createdAt": "2020-06-10T07:44:08Z", "author": {"login": "MaryamZi"}, "path": "misc/testerina/modules/report-tools/package.json", "diffHunk": "@@ -1,6 +1,6 @@\n {\n     \"name\": \"@ballerina/testerina-report\",\n-    \"version\": \"2.0.0-Preview1-M3\",\n+    \"version\": \"2.0.0-SNAPSHOT\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c19f1cb12777db9a2e97dfd1cb14a6a62aeb5d7f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkyOTY0NQ==", "bodyText": "Looks like a merge issue, ill remove and go though the changed file list again", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437929645", "createdAt": "2020-06-10T07:52:39Z", "author": {"login": "rdhananjaya"}, "path": "misc/testerina/modules/report-tools/package.json", "diffHunk": "@@ -1,6 +1,6 @@\n {\n     \"name\": \"@ballerina/testerina-report\",\n-    \"version\": \"2.0.0-Preview1-M3\",\n+    \"version\": \"2.0.0-SNAPSHOT\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkyNDY5OQ=="}, "originalCommit": {"oid": "c19f1cb12777db9a2e97dfd1cb14a6a62aeb5d7f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyODE4Njc4OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/http2/src/http2services/10_http_2.0_forwarded_header.bal", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzo0NzoyMFrOGho6kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNzo0NzoyMFrOGho6kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkyNjU0Ng==", "bodyText": "Shouldn't this fail?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    var resultSentToInitClient = caller->respond(<@untaianted> response);\n          \n          \n            \n                    var resultSentToInitClient = caller->respond(<@untainted> response);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437926546", "createdAt": "2020-06-10T07:47:20Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-integration-test/src/test/resources/http2/src/http2services/10_http_2.0_forwarded_header.bal", "diffHunk": "@@ -37,6 +37,6 @@ service forwardedBackend on new http:Listener(9106, {httpVersion: \"2.0\"}) {\n         http:Response response = new();\n         response.setHeader(\"forwarded\", header);\n         response.setPayload(\"forward is working\");\n-        var resultSentToInitClient = caller->respond(<@untianted> response);\n+        var resultSentToInitClient = caller->respond(<@untaianted> response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c19f1cb12777db9a2e97dfd1cb14a6a62aeb5d7f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyODI5NTM5OnYy", "diffSide": "RIGHT", "path": "langlib/lang.annotations/src/main/ballerina/src/lang.annotations/annotations.bal", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwODoxNjo1NFrOGhp_MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToxODozMlrOGhwRvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0NDExMw==", "bodyText": "This will allow using <@tainted> too right? I hope that's intentional? Do we have tests for that flow?\nSomething like\npublic function main() {\n    int x = 1;\n    foo(<@tainted> x);\n}\n\nfunction foo(@untainted int i) {\n    \n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437944113", "createdAt": "2020-06-10T08:16:54Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.annotations/src/main/ballerina/src/lang.annotations/annotations.bal", "diffHunk": "@@ -15,7 +15,7 @@\n // under the License.\n \n # Denote that the return value is tainted.\n-public const annotation tainted on parameter, return, source listener, source var;\n+public const annotation tainted on parameter, return, source listener, source var, source type;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e62edb24c32010140b49b379b67d36606233f09c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk4NTYxMA==", "bodyText": "We already had logic [1] in taint analyzer to untaint for <@untaint>, looks like we don't have any test for it, I'll add.\n[1] - \n  \n    \n      ballerina-lang/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TaintAnalyzer.java\n    \n    \n         Line 1265\n      in\n      53b98ed\n    \n    \n    \n    \n\n        \n          \n           TaintedStatus annotStatus = getTaintedStatusBasedOnAnnotations(conversionExpr.annAttachments);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r437985610", "createdAt": "2020-06-10T09:24:07Z", "author": {"login": "rdhananjaya"}, "path": "langlib/lang.annotations/src/main/ballerina/src/lang.annotations/annotations.bal", "diffHunk": "@@ -15,7 +15,7 @@\n // under the License.\n \n # Denote that the return value is tainted.\n-public const annotation tainted on parameter, return, source listener, source var;\n+public const annotation tainted on parameter, return, source listener, source var, source type;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0NDExMw=="}, "originalCommit": {"oid": "e62edb24c32010140b49b379b67d36606233f09c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0NzE2NA==", "bodyText": "Test case added", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23829#discussion_r438047164", "createdAt": "2020-06-10T11:18:32Z", "author": {"login": "rdhananjaya"}, "path": "langlib/lang.annotations/src/main/ballerina/src/lang.annotations/annotations.bal", "diffHunk": "@@ -15,7 +15,7 @@\n // under the License.\n \n # Denote that the return value is tainted.\n-public const annotation tainted on parameter, return, source listener, source var;\n+public const annotation tainted on parameter, return, source listener, source var, source type;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0NDExMw=="}, "originalCommit": {"oid": "e62edb24c32010140b49b379b67d36606233f09c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3491, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}