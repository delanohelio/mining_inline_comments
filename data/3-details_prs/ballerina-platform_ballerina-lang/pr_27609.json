{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNDI5ODIz", "number": 27609, "title": "Allow field access on structural constructors", "bodyText": "Purpose\nPurpose of this PR is to $title.\nFixes #26206\nFixes #20238\nFixes #25219\nNote: This PR will change the inheritance hierarchy of BLangAccessExpression and BLangVariableReference. According to (https://ballerina.io/spec/lang/master/#section_7.14.1) var-ref, field access, and member access should have a single abstraction.\nlvexpr :=\n   variable-reference-lvexpr\n   | field-access-lvexpr\n   | member-access-lvexpr\n\nApproach\nn/a\nSamples\nn/a\nRelated Issues/PRs\n\n#18298\n#19020\n#20234\n#20238\n#24603\n#25219\n#26206\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-12-21T11:40:07Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609", "merged": true, "mergeCommit": {"oid": "1e1c748d7aaf8d5c068bd096f998ea4dc8f7aa5f"}, "closed": true, "closedAt": "2021-01-14T04:34:09Z", "author": {"login": "grainier"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoUDbTgH2gAyNTQzNDI5ODIzOjY0MjNlNjVhOGVhMmNjNWMzYzY3ZTBmOGUxN2EyYzE5NzgxMGYzOGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdv71qGgH2gAyNTQzNDI5ODIzOmMyYjcyZDdjMGRlNmYzMmUwMTdiNWE1YjFmMmViMmQyZWUyYTgzOTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6423e65a8ea2cc5c3c67e0f8e17a2c197810f38c", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6423e65a8ea2cc5c3c67e0f8e17a2c197810f38c", "committedDate": "2020-12-21T11:16:03Z", "message": "Allow field access on structural constructors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76dbe7f2d70fb6c03eecb853346d0724cb86eec7", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/76dbe7f2d70fb6c03eecb853346d0724cb86eec7", "committedDate": "2020-12-21T11:31:54Z", "message": "Enable tests disabled on #20234"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTA2MjIz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#pullrequestreview-556506223", "createdAt": "2020-12-21T16:30:18Z", "commit": {"oid": "76dbe7f2d70fb6c03eecb853346d0724cb86eec7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjozMDoxOFrOIJeR0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjozMDoxOFrOIJeR0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgwNDE3Nw==", "bodyText": "I'm not sure if we should be marking these as BLangAccessExpressions. These aren't access expressions, right? They are the expressions on which the access is done?\nShouldn't we fix the visits for field/member access instead? To consider any BLangExpression rather than expecting a BLangVariableReference (https://github.com/ballerina-platform/ballerina-lang/blob/master/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java#L2465)?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r546804177", "createdAt": "2020-12-21T16:30:18Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangListConstructorExpr.java", "diffHunk": "@@ -35,7 +35,7 @@\n  * @see BLangJSONArrayLiteral\n  * @since 1.0\n  */\n-public class BLangListConstructorExpr extends BLangExpression implements ListConstructorExprNode {\n+public class BLangListConstructorExpr extends BLangAccessExpression implements ListConstructorExprNode {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76dbe7f2d70fb6c03eecb853346d0724cb86eec7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aff3ccf3116c262a3c77f90b8af27cb57003392", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8aff3ccf3116c262a3c77f90b8af27cb57003392", "committedDate": "2021-01-07T03:47:19Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e976387db5e67d8ad1b4f662f2659055f0945c60", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e976387db5e67d8ad1b4f662f2659055f0945c60", "committedDate": "2021-01-07T03:52:51Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7190c099227f5c8069a3a898ca649600f702bf90", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7190c099227f5c8069a3a898ca649600f702bf90", "committedDate": "2021-01-11T09:26:19Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5359dcaafca68baeffa0ec2865741b99ed7cd5e5", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5359dcaafca68baeffa0ec2865741b99ed7cd5e5", "committedDate": "2021-01-12T12:49:06Z", "message": "Change the inheritance hierarchy of BLangAccessExpression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caaf71654677876ec9d991a3d553338f94f55d6e", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/caaf71654677876ec9d991a3d553338f94f55d6e", "committedDate": "2021-01-12T12:49:34Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59693712cfcf2ddf432565b4fddea756ddd1e125", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/59693712cfcf2ddf432565b4fddea756ddd1e125", "committedDate": "2021-01-12T12:59:51Z", "message": "Remove unused imports"}, "afterCommit": {"oid": "d3ca828f928f4081151365ce22eaf1b1bad7d127", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3ca828f928f4081151365ce22eaf1b1bad7d127", "committedDate": "2021-01-12T13:13:00Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89bf2e7fbc542694dc6d4f3705cf6363da3c281f", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/89bf2e7fbc542694dc6d4f3705cf6363da3c281f", "committedDate": "2021-01-12T13:22:25Z", "message": "Remove unused imports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3ca828f928f4081151365ce22eaf1b1bad7d127", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3ca828f928f4081151365ce22eaf1b1bad7d127", "committedDate": "2021-01-12T13:13:00Z", "message": "Remove unused imports"}, "afterCommit": {"oid": "89bf2e7fbc542694dc6d4f3705cf6363da3c281f", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/89bf2e7fbc542694dc6d4f3705cf6363da3c281f", "committedDate": "2021-01-12T13:22:25Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b13d7dc3174b81ed8bded493120f0b7c15b9f07e", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b13d7dc3174b81ed8bded493120f0b7c15b9f07e", "committedDate": "2021-01-13T04:18:35Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b8b583dd52feb7c65746c56e201c07aa652c090", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9b8b583dd52feb7c65746c56e201c07aa652c090", "committedDate": "2021-01-13T04:54:02Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2OTE3MDYx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#pullrequestreview-566917061", "createdAt": "2021-01-13T06:10:35Z", "commit": {"oid": "9b8b583dd52feb7c65746c56e201c07aa652c090"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2OTU2Mzg2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#pullrequestreview-566956386", "createdAt": "2021-01-13T07:39:04Z", "commit": {"oid": "9b8b583dd52feb7c65746c56e201c07aa652c090"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QwNzozOTowNFrOISi26A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QwNzozOTowNFrOISi26A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjMxNjM5Mg==", "bodyText": "Shall we rename this method and first param, as this function now support more than simpleVariableReferences", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r556316392", "createdAt": "2021-01-13T07:39:04Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -2367,7 +2367,7 @@ private void createVarRefAssignmentStmts(BLangTupleVarRef parentTupleVariable, B\n      * This method creates a assignment statement and assigns and array expression based on the given indexExpr.\n      *\n      */\n-    private void createSimpleVarRefAssignmentStmt(BLangVariableReference simpleVarRef, BLangBlockStmt parentBlockStmt,\n+    private void createSimpleVarRefAssignmentStmt(BLangExpression simpleVarRef, BLangBlockStmt parentBlockStmt,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b8b583dd52feb7c65746c56e201c07aa652c090"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "019e8ee7b2762d0ada913637f3a57297982116a4", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/019e8ee7b2762d0ada913637f3a57297982116a4", "committedDate": "2021-01-13T11:22:00Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "278547735197ee003300179d272056e1b9251534", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/278547735197ee003300179d272056e1b9251534", "committedDate": "2021-01-13T11:38:02Z", "message": "Refactor method name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3MTc0MzQz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#pullrequestreview-567174343", "createdAt": "2021-01-13T12:30:04Z", "commit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3MjkxMjUw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#pullrequestreview-567291250", "createdAt": "2021-01-13T14:45:19Z", "commit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNDo0NToxOVrOISyccA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNDo1MDo0NFrOISyshg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU3MTc2MA==", "bodyText": "Can we accept BLangAccessibleExpressions here?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r556571760", "createdAt": "2021-01-13T14:45:19Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/ASTBuilderUtil.java", "diffHunk": "@@ -724,19 +723,19 @@ public static BLangMatchExpression createMatchExpression(BLangExpression expr) {\n         return matchExpr;\n     }\n \n-    public static BLangFieldBasedAccess createFieldAccessExpr(BLangVariableReference varRef, BLangIdentifier field) {\n+    public static BLangFieldBasedAccess createFieldAccessExpr(BLangExpression varRef, BLangIdentifier field) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU3MjcxOQ==", "bodyText": "Shouldn't this be a BLangAccessibleExpression?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r556572719", "createdAt": "2021-01-13T14:46:36Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -2367,25 +2367,25 @@ private void createVarRefAssignmentStmts(BLangTupleVarRef parentTupleVariable, B\n      * This method creates a assignment statement and assigns and array expression based on the given indexExpr.\n      *\n      */\n-    private void createSimpleVarRefAssignmentStmt(BLangVariableReference simpleVarRef, BLangBlockStmt parentBlockStmt,\n-                                                  BLangExpression indexExpr, BVarSymbol tupleVarSymbol,\n-                                                  BLangIndexBasedAccess parentArrayAccessExpr) {\n+    private void createAssignmentStmt(BLangAccessExpression accessExpression, BLangBlockStmt parentBlockStmt,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU3NTQ3OA==", "bodyText": "Shouldn't this always be true? If not, shouldn't we log an error or return?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r556575478", "createdAt": "2021-01-13T14:50:12Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -2462,11 +2463,14 @@ private boolean isFunctionArgument(BSymbol symbol, List<BLangSimpleVariable> par\n     }\n \n     public void visit(BLangFieldBasedAccess fieldAccessExpr) {\n-        // First analyze the variable reference expression.\n-        ((BLangVariableReference) fieldAccessExpr.expr).lhsVar = fieldAccessExpr.lhsVar;\n-        ((BLangVariableReference) fieldAccessExpr.expr).compoundAssignmentLhsVar =\n-                fieldAccessExpr.compoundAssignmentLhsVar;\n-        BType varRefType = getTypeOfExprInFieldAccess(fieldAccessExpr.expr);\n+        // First analyze the accessible expression.\n+        BLangExpression containerExpression = fieldAccessExpr.expr;\n+        if (containerExpression instanceof BLangAccessibleExpression) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU3NTcwNA==", "bodyText": "Unnecessary change?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r556575704", "createdAt": "2021-01-13T14:50:31Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangAccessExpression.java", "diffHunk": "@@ -26,12 +25,13 @@\n  * \n  * @since 0.970.0\n  */\n-public abstract class BLangAccessExpression extends BLangVariableReference implements VariableReferenceNode {\n+public abstract class BLangAccessExpression extends BLangAccessibleExpression {\n \n     public BLangExpression expr;\n     public boolean optionalFieldAccess = false;\n     public boolean errorSafeNavigation = false;\n     public boolean nilSafeNavigation = false;\n     public BType originalType;\n     public boolean leafNode;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU3NTg3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             *  Copyright (c) 2021, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#discussion_r556575878", "createdAt": "2021-01-13T14:50:44Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/expressions/BLangAccessibleExpression.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "278547735197ee003300179d272056e1b9251534"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "004d3a3cb8cbe22385e5526d5a8960a45f517977", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/004d3a3cb8cbe22385e5526d5a8960a45f517977", "committedDate": "2021-01-13T15:39:17Z", "message": "Improve BLangAccessibleExpression validations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "786531acc7a60d7846b18ca58b88f3639fc0dd34", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/786531acc7a60d7846b18ca58b88f3639fc0dd34", "committedDate": "2021-01-13T15:40:12Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3MzYyODYz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27609#pullrequestreview-567362863", "createdAt": "2021-01-13T15:50:04Z", "commit": {"oid": "786531acc7a60d7846b18ca58b88f3639fc0dd34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2b72d7c0de6f32e017b5a5b1f2eb2d2ee2a8392", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c2b72d7c0de6f32e017b5a5b1f2eb2d2ee2a8392", "committedDate": "2021-01-14T03:34:41Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25219"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4661, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}