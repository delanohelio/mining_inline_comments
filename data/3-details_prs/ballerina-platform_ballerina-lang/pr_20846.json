{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMjgwNjk0", "number": 20846, "title": "Migrate codegen to use BString", "bodyText": "Purpose\n\nMigrate backend-jvm to BString from StringValue\nSupport Array new and array store to BString\n\nFixes #\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-03T11:59:29Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846", "merged": true, "mergeCommit": {"oid": "195eb1625bca52f901c0b55dc2e6bf7ce0a9e473"}, "closed": true, "closedAt": "2020-02-07T08:14:40Z", "author": {"login": "vinok88"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcArkVMgH2gAyMzcwMjgwNjk0OjllZGYwMTZiYTA4NWRhZjgwZDU0NThhZDhjYmVkNDQyMDA3ZTcyMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB6s3FAFqTM1NDk4MzQxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9edf016ba085daf80d5458ad8cbed442007e7237", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9edf016ba085daf80d5458ad8cbed442007e7237", "committedDate": "2020-02-03T11:51:41Z", "message": "Migrate codegen to use BString"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3554a9df097291aa61f11764efec14872597cff", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c3554a9df097291aa61f11764efec14872597cff", "committedDate": "2020-02-03T17:50:02Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into bstring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24d973ca8794154e21b7002a97a4cdb066a6e035", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/24d973ca8794154e21b7002a97a4cdb066a6e035", "committedDate": "2020-02-05T04:35:07Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into bstring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eb3809bf0d198b16d748b66e06e15dbecfd41ee", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1eb3809bf0d198b16d748b66e06e15dbecfd41ee", "committedDate": "2020-02-05T07:23:38Z", "message": "Fix StringUtils compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2", "committedDate": "2020-02-05T08:41:08Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MjgxMzAw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#pullrequestreview-354281300", "createdAt": "2020-02-06T08:52:02Z", "commit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwODo1MjowM1rOFmTPkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwODo1MzowMlrOFmTRTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwNTQ4OA==", "bodyText": "We assert the length because that is the main difference from the old String. If we assert by value both old and new cases pass. Shall we return the length and assert?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#discussion_r375705488", "createdAt": "2020-02-06T08:52:03Z", "author": {"login": "riyafa"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/types/string/StringValueBasicsTest.java", "diffHunk": "@@ -69,6 +70,13 @@ public void testError() {\n         Assert.assertEquals(((BInteger) returns[0]).intValue(), 5);\n     }\n \n+    @Test\n+    public void testArrayStore() {\n+        BValue[] returns = BRunUtil.invoke(result, \"testArrayStore\");\n+        Assert.assertEquals(returns[0].getClass(), BValueArray.class);\n+        Assert.assertEquals(((BValueArray) returns[0]).getStringArray()[0], \"h\ud83d\ude00llo\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwNTYwMg==", "bodyText": "Shall we return the length?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#discussion_r375705602", "createdAt": "2020-02-06T08:52:18Z", "author": {"login": "riyafa"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/string/string-value-test.bal", "diffHunk": "@@ -20,3 +20,9 @@ function testError() returns int {\n     error err = error(smiley);\n     return err.reason().length();\n }\n+\n+function testArrayStore() returns string[] {\n+    string[] arr = [];\n+    arr[0] = \"h\ud83d\ude00llo\";\n+    return arr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwNTkzNQ==", "bodyText": "Shall we add test for a multi element array also, just to be on the safe side?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#discussion_r375705935", "createdAt": "2020-02-06T08:53:02Z", "author": {"login": "riyafa"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/string/string-value-test.bal", "diffHunk": "@@ -20,3 +20,9 @@ function testError() returns int {\n     error err = error(smiley);\n     return err.reason().length();\n }\n+\n+function testArrayStore() returns string[] {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MjkwNzM1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#pullrequestreview-354290735", "createdAt": "2020-02-06T09:07:44Z", "commit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwOTowNzo0NFrOFmTsKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwOToxMTozOFrOFmTzVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcxMjgwOA==", "bodyText": "fromString is used to convert java string to ballerina. do we need a way to convert BString to BString?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#discussion_r375712808", "createdAt": "2020-02-06T09:07:44Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/StringUtils.java", "diffHunk": "@@ -133,4 +133,8 @@ public static StringValue fromString(String s) {\n         return new NonBmpStringValue(s, highSurrogatesArr);\n     }\n \n+    public static BString fromString(BString s) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcxMzg3Nw==", "bodyText": "extra paran", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#discussion_r375713877", "createdAt": "2020-02-06T09:10:01Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/BmpStringValue.java", "diffHunk": "@@ -46,9 +48,9 @@ public int length() {\n      }\n \n      @Override\n-     public StringValue concat(StringValue str) {\n+     public BString concat(BString str) {\n          if (str instanceof BmpStringValue) {\n-             return new BmpStringValue(this.value + ((BmpStringValue) str).value);\n+             return new BmpStringValue((this.value + ((BmpStringValue) str).value));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcxNDY0NQ==", "bodyText": "need the long name ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#discussion_r375714645", "createdAt": "2020-02-06T09:11:38Z", "author": {"login": "manuranga"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/javainterop/RefTypeTests.java", "diffHunk": "@@ -388,7 +387,7 @@ public static HandleValue getHandle() {\n         return new HandleValue(m);\n     }\n \n-    public static StringValue useHandle(HandleValue h) {\n+    public static org.ballerinalang.jvm.values.api.BString useHandle(HandleValue h) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28418ef44e9fa44a3444eae3b2f1b2ba8f30ad2"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26e71e6860d93dc8e12a74a2377d135bae0c274c", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/26e71e6860d93dc8e12a74a2377d135bae0c274c", "committedDate": "2020-02-07T05:09:44Z", "message": "Support BString for array load"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c535e7d328dd16e3dbac1f713084f7ea6b0fdb3d", "author": {"user": {"login": "vinok88", "name": "Vinod Kavinda"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c535e7d328dd16e3dbac1f713084f7ea6b0fdb3d", "committedDate": "2020-02-07T06:11:52Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTU3NTE0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#pullrequestreview-354957514", "createdAt": "2020-02-07T06:47:27Z", "commit": {"oid": "c535e7d328dd16e3dbac1f713084f7ea6b0fdb3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTgzNDEx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20846#pullrequestreview-354983411", "createdAt": "2020-02-07T08:03:30Z", "commit": {"oid": "c535e7d328dd16e3dbac1f713084f7ea6b0fdb3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4292, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}