{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMzU3Nzg1", "number": 27339, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOToxMDowMlrOFAs0uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOToxMDowMlrOFAs0uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2Mjc4NzEyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOToxMDowMlrOH_HhWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMTowMjoyNVrOH_L6sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk0NTU2MQ==", "bodyText": "Can you check this fix instead for the else part against the tests\n       analyzeNode(ifStmt.elseStmt, env);\n        boolean elseWithinTrxMode = this.withinTransactionScope;\n        this.statementReturns = ifStmtReturns && this.statementReturns;\n        this.errorThrown = currentErrorThrown && this.errorThrown;\n        this.withinTransactionScope = (!prevTxMode || ifWithinTrxMode || elseWithinTrxMode) && prevTxMode;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27339#discussion_r535945561", "createdAt": "2020-12-04T09:10:02Z", "author": {"login": "pcnfernando"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -817,19 +808,25 @@ public void visit(BLangIf ifStmt) {\n         }\n         boolean ifStmtReturns = this.statementReturns;\n         boolean currentErrorThrown = this.errorThrown;\n+        boolean ifWithinTrxMode = this.withinTransactionScope;\n         this.resetStatementReturns();\n         this.resetErrorThrown();\n+        if (prevTxMode) {\n+            this.resetWithinTrxScopeToTrue();\n+        }\n         if (ifStmt.elseStmt != null) {\n-            if (independentBlocks) {\n-                commitRollbackAllowed = true;\n-                withinTransactionScope = true;\n-            }\n             analyzeNode(ifStmt.elseStmt, env);\n-            if ((prevCommitCount != commitCount) || prevRollbackCount != rollbackCount) {\n-                commitRollbackAllowed = false;\n+            boolean hasVisitedCommitOrRollback = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bdbbf8198b6f6cd3de28a7bfa1d3e82a4a9ad2b"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAxNzU4NA==", "bodyText": "updated in 0135c17 . fixed the tests in ballerina-platform/module-ballerinai-transaction@cd53c3a", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27339#discussion_r536017584", "createdAt": "2020-12-04T11:02:25Z", "author": {"login": "lasinicl"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -817,19 +808,25 @@ public void visit(BLangIf ifStmt) {\n         }\n         boolean ifStmtReturns = this.statementReturns;\n         boolean currentErrorThrown = this.errorThrown;\n+        boolean ifWithinTrxMode = this.withinTransactionScope;\n         this.resetStatementReturns();\n         this.resetErrorThrown();\n+        if (prevTxMode) {\n+            this.resetWithinTrxScopeToTrue();\n+        }\n         if (ifStmt.elseStmt != null) {\n-            if (independentBlocks) {\n-                commitRollbackAllowed = true;\n-                withinTransactionScope = true;\n-            }\n             analyzeNode(ifStmt.elseStmt, env);\n-            if ((prevCommitCount != commitCount) || prevRollbackCount != rollbackCount) {\n-                commitRollbackAllowed = false;\n+            boolean hasVisitedCommitOrRollback = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk0NTU2MQ=="}, "originalCommit": {"oid": "5bdbbf8198b6f6cd3de28a7bfa1d3e82a4a9ad2b"}, "originalPosition": 105}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2857, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}