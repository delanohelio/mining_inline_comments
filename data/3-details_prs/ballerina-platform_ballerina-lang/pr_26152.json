{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NzUxNTEz", "number": 26152, "title": "[Debugger] Add global variable support", "bodyText": "Purpose,\nThis PR\n\nintroduces debugging support for global/constant variable scopes.\nupdates expression evaluation engine to support global variables.\nadds integration tests for global variable related contexts.\n\nFixes #25275.\nRemarks\nPlease note that few of the test scenarios are currently disabled due to the following minor runtime issues which were captured while working the $subject and should be enabled once the relevant fixes are merged to the runtime.\n\n#26122 - Ballerina runtime error due to naming conflicts between user defined and generated variable names.\n#26139 - Inconsistent behavior when generating byte code for ballerina constant definitions.\n\nSamples\nPlease refer below scenarios with global variable and constant definitions.\n\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-29T11:11:31Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26152", "merged": true, "mergeCommit": {"oid": "92b948b655cbff241331758d42a834977b5dc82d"}, "closed": true, "closedAt": "2020-10-08T11:42:52Z", "author": {"login": "NipunaRanasinghe"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMn1vBgH2gAyNDk0NzUxNTEzOjI3NTYyNmFjNjVkYTQ0MjgxYmU1ODllODliODg0YzIzMjgxYmEyYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQfz5dAFqTUwNDY4MTI0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "275626ac65da44281be589e89b884c23281ba2a4", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/275626ac65da44281be589e89b884c23281ba2a4", "committedDate": "2020-09-26T10:29:19Z", "message": "Add debugging support to view global variable scope"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8edfca86331b81802451e870ecbfec784b6e531f", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8edfca86331b81802451e870ecbfec784b6e531f", "committedDate": "2020-09-28T07:48:41Z", "message": "Update variable evaluation support for global variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2338996262822548e51f643c5cd2b974e71c90", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3c2338996262822548e51f643c5cd2b974e71c90", "committedDate": "2020-09-28T11:11:25Z", "message": "Update debugger test framework and resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aecddeddd3a4717303e7f6aef550290620aa5152", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aecddeddd3a4717303e7f6aef550290620aa5152", "committedDate": "2020-09-29T04:43:55Z", "message": "Refactor local variable test utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14f35c61f29d6b703f7b14fb4fe42346f34a75b7", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/14f35c61f29d6b703f7b14fb4fe42346f34a75b7", "committedDate": "2020-09-29T06:07:29Z", "message": "Add variable and expression evaluation tests for global variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b20484e2ed2e3325b75fda7f5f9142697a769157", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b20484e2ed2e3325b75fda7f5f9142697a769157", "committedDate": "2020-09-29T06:12:41Z", "message": "Add minor fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59fedee76ca6ee0ec8684c63bad65424203dc21", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a59fedee76ca6ee0ec8684c63bad65424203dc21", "committedDate": "2020-09-29T10:27:54Z", "message": "Rectify a debugger adapter protocol violation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNjk3MjQy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26152#pullrequestreview-501697242", "createdAt": "2020-10-05T02:54:49Z", "commit": {"oid": "a59fedee76ca6ee0ec8684c63bad65424203dc21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwMjo1NDo0OVrOHcMZOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwMjo1NDo0OVrOHcMZOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTMyNTI0MA==", "bodyText": "As a practice, let's try to get each of the stream operations to a new line", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26152#discussion_r499325240", "createdAt": "2020-10-05T02:54:49Z", "author": {"login": "nadeeshaan"}, "path": "tests/jballerina-debugger-integration-test/src/test/java/org/ballerinalang/debugger/test/DebugAdapterBaseTestCase.java", "diffHunk": "@@ -356,15 +360,18 @@ private void setBreakpoints(List<BallerinaTestDebugPoint> breakPoints) throws Ba\n                     .stackTrace(stackTraceArgs);\n             StackFrame[] stackFrames = stackTraceResp.getStackFrames();\n             if (stackFrames.length == 0) {\n-                return new Variable[0];\n+                return variables;\n+            }\n+            if (scope == VariableScope.LOCAL) {\n+                scopeArgs.setFrameId(stackFrames[0].getId());\n+            } else {\n+                scopeArgs.setFrameId(-stackFrames[0].getId());\n             }\n-\n-            scopeArgs.setFrameId(stackFrames[0].getId());\n             ScopesResponse scopesResp = DebugHitListener.connector.getRequestManager().scopes(scopeArgs);\n             variableArgs.setVariablesReference(scopesResp.getScopes()[0].getVariablesReference());\n             VariablesResponse variableResp = DebugHitListener.connector.getRequestManager().variables(variableArgs);\n-            return variableResp.getVariables();\n-\n+            Arrays.stream(variableResp.getVariables()).forEach(variable -> variables.put(variable.getName(), variable));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a59fedee76ca6ee0ec8684c63bad65424203dc21"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNjk3ODcw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26152#pullrequestreview-501697870", "createdAt": "2020-10-05T02:57:56Z", "commit": {"oid": "a59fedee76ca6ee0ec8684c63bad65424203dc21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwMjo1Nzo1NlrOHcMbYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwMjo1Nzo1NlrOHcMbYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTMyNTc5NA==", "bodyText": "May be we can use the conditional operator here", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26152#discussion_r499325794", "createdAt": "2020-10-05T02:57:56Z", "author": {"login": "nadeeshaan"}, "path": "tests/jballerina-debugger-integration-test/src/test/java/org/ballerinalang/debugger/test/DebugAdapterBaseTestCase.java", "diffHunk": "@@ -356,15 +360,18 @@ private void setBreakpoints(List<BallerinaTestDebugPoint> breakPoints) throws Ba\n                     .stackTrace(stackTraceArgs);\n             StackFrame[] stackFrames = stackTraceResp.getStackFrames();\n             if (stackFrames.length == 0) {\n-                return new Variable[0];\n+                return variables;\n+            }\n+            if (scope == VariableScope.LOCAL) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a59fedee76ca6ee0ec8684c63bad65424203dc21"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9e03c60f78430cbd30ea5d968cb92e03099b36", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/db9e03c60f78430cbd30ea5d968cb92e03099b36", "committedDate": "2020-10-06T05:25:19Z", "message": "Add review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1f507ccfbb60ac7991890e6c2ffd20383bb3aef", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a1f507ccfbb60ac7991890e6c2ffd20383bb3aef", "committedDate": "2020-10-06T05:35:13Z", "message": "Sync with master and resolve conflicts\n# Conflicts:\n#\tmisc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/evaluation/engine/SimpleNameReferenceEvaluator.java\n#\ttests/jballerina-debugger-integration-test/src/test/java/org/ballerinalang/debugger/test/adapter/evaluation/ExpressionEvaluationTest.java\n#\ttests/jballerina-debugger-integration-test/src/test/java/org/ballerinalang/debugger/test/adapter/variables/VariableVisibilityTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjgxMjQ2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26152#pullrequestreview-504681246", "createdAt": "2020-10-08T11:23:46Z", "commit": {"oid": "a1f507ccfbb60ac7991890e6c2ffd20383bb3aef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4492, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}