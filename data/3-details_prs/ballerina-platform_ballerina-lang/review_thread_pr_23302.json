{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4OTA2MzEz", "number": 23302, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNjozMjoyOFrOEAYG9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzowMzoxOFrOEAYl1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODMwNDUyOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/XMLFactory.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNjozMjoyOFrOGbnX-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoyMDo0MlrOGc5S4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYwOTg0OQ==", "bodyText": "I think due to line L279 - L281 we don't need a null check on defaultNsUri", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r431609849", "createdAt": "2020-05-28T06:32:28Z", "author": {"login": "KRVPerera"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/XMLFactory.java", "diffHunk": "@@ -284,13 +286,9 @@ public static XMLValue createXMLElement(XMLQName startTagName, String defaultNsU\n \n         if (nsUri == null) {\n             return new XMLItem(new QName(defaultNsUri, startTagName.getLocalName(), prefix), readonly);\n-        } else {\n-            XMLItem xmlItem = new XMLItem(new QName(nsUri, startTagName.getLocalName(), prefix), readonly);\n-            if (defaultNsUri != null && !defaultNsUri.isEmpty()) {\n-                xmlItem.setAttribute(XMLConstants.XMLNS_ATTRIBUTE, null, null, defaultNsUri);\n-            }\n-            return xmlItem;\n         }\n+        return createXMLItemWithDefaultNSAttribute(new QName(nsUri, startTagName.getLocalName(), prefix), readonly,\n+                                                   defaultNsUri);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAyMzAwMw==", "bodyText": "Yeah will change and check.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r432023003", "createdAt": "2020-05-28T18:02:26Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/XMLFactory.java", "diffHunk": "@@ -284,13 +286,9 @@ public static XMLValue createXMLElement(XMLQName startTagName, String defaultNsU\n \n         if (nsUri == null) {\n             return new XMLItem(new QName(defaultNsUri, startTagName.getLocalName(), prefix), readonly);\n-        } else {\n-            XMLItem xmlItem = new XMLItem(new QName(nsUri, startTagName.getLocalName(), prefix), readonly);\n-            if (defaultNsUri != null && !defaultNsUri.isEmpty()) {\n-                xmlItem.setAttribute(XMLConstants.XMLNS_ATTRIBUTE, null, null, defaultNsUri);\n-            }\n-            return xmlItem;\n         }\n+        return createXMLItemWithDefaultNSAttribute(new QName(nsUri, startTagName.getLocalName(), prefix), readonly,\n+                                                   defaultNsUri);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYwOTg0OQ=="}, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MjAzMg==", "bodyText": "Updated with 8e8807b.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r432952032", "createdAt": "2020-05-31T14:20:42Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/XMLFactory.java", "diffHunk": "@@ -284,13 +286,9 @@ public static XMLValue createXMLElement(XMLQName startTagName, String defaultNsU\n \n         if (nsUri == null) {\n             return new XMLItem(new QName(defaultNsUri, startTagName.getLocalName(), prefix), readonly);\n-        } else {\n-            XMLItem xmlItem = new XMLItem(new QName(nsUri, startTagName.getLocalName(), prefix), readonly);\n-            if (defaultNsUri != null && !defaultNsUri.isEmpty()) {\n-                xmlItem.setAttribute(XMLConstants.XMLNS_ATTRIBUTE, null, null, defaultNsUri);\n-            }\n-            return xmlItem;\n         }\n+        return createXMLItemWithDefaultNSAttribute(new QName(nsUri, startTagName.getLocalName(), prefix), readonly,\n+                                                   defaultNsUri);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYwOTg0OQ=="}, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODM4MzU4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzowMzoxOFrOGboKWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoyMTo1OFrOGc5TQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYyMjc0Nw==", "bodyText": "Shouldn't this code be\nif (Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {\n   markChildrenAsImmutable(bLangXMLElementLiteral);\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r431622747", "createdAt": "2020-05-28T07:03:18Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3443,6 +3443,12 @@ public void visit(BLangXMLElementLiteral bLangXMLElementLiteral) {\n \n         resultType = checkXmlSubTypeLiteralCompatibility(bLangXMLElementLiteral.pos, symTable.xmlElementType,\n                                                          this.expType);\n+\n+        if (!Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAyMzk5MQ==", "bodyText": "Would it make a difference? And I think the common case would be the current check evaluating to true (i.e., mutable result type).", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r432023991", "createdAt": "2020-05-28T18:04:21Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3443,6 +3443,12 @@ public void visit(BLangXMLElementLiteral bLangXMLElementLiteral) {\n \n         resultType = checkXmlSubTypeLiteralCompatibility(bLangXMLElementLiteral.pos, symTable.xmlElementType,\n                                                          this.expType);\n+\n+        if (!Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYyMjc0Nw=="}, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0MDU2OA==", "bodyText": "My opinion is that if lines are separated here, we lose the actual logic we need. Logic is not obvious anymore. Because these two lines are separated someone may put some lines in between in future and decide to return. At that time for some elements, we won't be calling markChildrenAsImmutable.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r432340568", "createdAt": "2020-05-29T08:41:00Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3443,6 +3443,12 @@ public void visit(BLangXMLElementLiteral bLangXMLElementLiteral) {\n \n         resultType = checkXmlSubTypeLiteralCompatibility(bLangXMLElementLiteral.pos, symTable.xmlElementType,\n                                                          this.expType);\n+\n+        if (!Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYyMjc0Nw=="}, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MjEyOQ==", "bodyText": "I've updated the logic with 8e8807b since this is a single invocation. But regarding adding lines in between, IMO the logic here is quite straightforward and it is reasonable to expect whoever doing the change to understand the area they are changing when doing the changes.  :) Especially given that we've adopted a similar approach with a significant number of functions.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23302#discussion_r432952129", "createdAt": "2020-05-31T14:21:58Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -3443,6 +3443,12 @@ public void visit(BLangXMLElementLiteral bLangXMLElementLiteral) {\n \n         resultType = checkXmlSubTypeLiteralCompatibility(bLangXMLElementLiteral.pos, symTable.xmlElementType,\n                                                          this.expType);\n+\n+        if (!Symbols.isFlagOn(resultType.flags, Flags.READONLY)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYyMjc0Nw=="}, "originalCommit": {"oid": "2ec6bf8bddc6a84014e2b36b525a323b6a372e93"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3658, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}