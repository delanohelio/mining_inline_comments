{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3MjYyODU1", "number": 24962, "title": "Allow users to define custom remote maven repositories", "bodyText": "Purpose\n\n$title\nFixes #24593\n\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-07-27T16:13:09Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962", "merged": true, "mergeCommit": {"oid": "d5435ab6b494e5347913b8b3d81e623cd9ca6890"}, "closed": true, "closedAt": "2020-08-04T04:28:20Z", "author": {"login": "suganyasuven"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5EKMNgH2gAyNDU3MjYyODU1OmM2YWMzNDY5OTc1ZWUzZDE1NTM0NzcyYjRlNDkxN2E5MTVjMDhkMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7cLupAFqTQ2MDQzMzg3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6ac3469975ee3d15534772b4e4917a915c08d36", "author": {"user": {"login": "suganyasuven", "name": "Suganya"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c6ac3469975ee3d15534772b4e4917a915c08d36", "committedDate": "2020-07-27T16:10:31Z", "message": "Allow users to define custom remote maven repositories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4dce86a596a1830db9e6fe1c94bd4b1ac103235", "author": {"user": {"login": "suganyasuven", "name": "Suganya"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b4dce86a596a1830db9e6fe1c94bd4b1ac103235", "committedDate": "2020-07-27T16:32:12Z", "message": "Add tests for resolving custom remote maven repositories"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzM0ODUw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-456334850", "createdAt": "2020-07-28T06:26:14Z", "commit": {"oid": "b4dce86a596a1830db9e6fe1c94bd4b1ac103235"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjoyNjoxNFrOG3-WSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjoyNjoxNFrOG3-WSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM0NjM3Ng==", "bodyText": "If this step is done only if the id and url are not null, then the initialization of username and password variables can be done within the if condition.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r461346376", "createdAt": "2020-07-28T06:26:14Z", "author": {"login": "azinneera"}, "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/task/ResolveMavenDependenciesTask.java", "diffHunk": "@@ -51,6 +52,22 @@ public void execute(BuildContext buildContext) {\n                 + \"platform-libs\";\n         MavenResolver resolver = new MavenResolver(targetRepo);\n \n+        if (manifest.getPlatform().getRepositories() != null && manifest.getPlatform().getRepositories().size() > 0) {\n+            for (Repository repository : manifest.getPlatform().getRepositories()) {\n+                String id = repository.getId();\n+                String url = repository.getUrl();\n+                String username = repository.getUser();\n+                String password = repository.getToken();\n+                if (id != null && url != null) {\n+                    if (username != null && password != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dce86a596a1830db9e6fe1c94bd4b1ac103235"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzQ1Mjkz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-456345293", "createdAt": "2020-07-28T06:47:05Z", "commit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo0NzowNVrOG3-4Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo0NzowNVrOG3-4Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM1NTAzNA==", "bodyText": "Let's append the exception value (e) also to the error here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r461355034", "createdAt": "2020-07-28T06:47:05Z", "author": {"login": "azinneera"}, "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/task/ResolveMavenDependenciesTask.java", "diffHunk": "@@ -60,16 +77,15 @@ public void execute(BuildContext buildContext) {\n         if (mavenDependencies.size() > 0) {\n             buildContext.out().println(\"Resolving Maven dependencies\\n\\tDownloading dependencies into \" + targetRepo);\n             for (Library library : mavenDependencies) {\n-                if (library.getPath() == null) {\n-                    try {\n-                        Dependency dependency = resolver.resolve(library.getGroupId(), library.getArtifactId(),\n-                                library.getVersion(), false);\n-                        library.setPath(Utils.getJarPath(targetRepo, dependency));\n-                    } catch (MavenResolverException e) {\n-                        buildContext.err().print(\"cannot resolve \" + library.getArtifactId());\n-                    }\n+                try {\n+                    Dependency dependency = resolver.resolve(library.getGroupId(), library.getArtifactId(),\n+                            library.getVersion(), false);\n+                    library.setPath(Utils.getJarPath(targetRepo, dependency));\n+                } catch (MavenResolverException e) {\n+                    buildContext.err().print(\"cannot resolve \" + library.getArtifactId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzQ4NjUx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-456348651", "createdAt": "2020-07-28T06:53:01Z", "commit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1MzowMVrOG3_CbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1MzowMVrOG3_CbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM1NzY3Ng==", "bodyText": "Let's use Paths.get since File.sperator is the pre-1.7 JDKs way", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r461357676", "createdAt": "2020-07-28T06:53:01Z", "author": {"login": "azinneera"}, "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -804,9 +804,33 @@ public void testBuildWithSkipTests() throws IOException {\n                 \"\\nGenerating executables\\n\" +\n                 \"\\ttarget/bin/module1.jar\\n\");\n     }\n-    \n-    // Check compile command inside a module directory\n \n+    @Test(description = \"Test the project with Maven dependencies\")\n+    public void testBuildWithMavenDependencies() throws IOException {\n+        // valid source root path\n+        Path validBalFilePath = this.testResources.resolve(\"project-with-maven-dependencies\");\n+        BuildCommand buildCommand = new BuildCommand(validBalFilePath, printStream, printStream, false, true);\n+        new CommandLine(buildCommand).parse(\"-a\");\n+        buildCommand.execute();\n+        Path target = validBalFilePath.resolve(ProjectDirConstants.TARGET_DIR_NAME);\n+        Path platformLibsDir = target.resolve(\"platform-libs\");\n+        Assert.assertTrue(Files.exists(target), \"Check if target directory is created\");\n+        Assert.assertTrue(Files.exists(platformLibsDir), \"Check if platform-libs is created\");\n+\n+        //Assert maven dependencies are downloaded\n+        Assert.assertTrue(Files.exists(Paths.get(getJarPath(platformLibsDir.toString(), \"org.apache.maven\",\n+                \"maven-artifact\", \"3.6.3\"))));\n+        Assert.assertTrue(Files.exists(Paths.get(getJarPath(platformLibsDir.toString(), \"org.ballerinalang\",\n+                \"wso2-cassandra\", \"0.8.3\"))));\n+\n+    }\n+\n+    public static String getJarPath(String targetPath, String groupId, String artifactId, String version) {\n+        return targetPath + File.separator + groupId.replace('.', File.separatorChar) + File.separator +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzQ5ODY0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-456349864", "createdAt": "2020-07-28T06:55:14Z", "commit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1NToxNFrOG3_GGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1NToxNFrOG3_GGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM1ODYxOQ==", "bodyText": "Shall we add a test case to check the expected behavior when only the group [[platform.repositories]] is given without any entries?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r461358619", "createdAt": "2020-07-28T06:55:14Z", "author": {"login": "azinneera"}, "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -804,9 +804,33 @@ public void testBuildWithSkipTests() throws IOException {\n                 \"\\nGenerating executables\\n\" +\n                 \"\\ttarget/bin/module1.jar\\n\");\n     }\n-    \n-    // Check compile command inside a module directory\n \n+    @Test(description = \"Test the project with Maven dependencies\")\n+    public void testBuildWithMavenDependencies() throws IOException {\n+        // valid source root path\n+        Path validBalFilePath = this.testResources.resolve(\"project-with-maven-dependencies\");\n+        BuildCommand buildCommand = new BuildCommand(validBalFilePath, printStream, printStream, false, true);\n+        new CommandLine(buildCommand).parse(\"-a\");\n+        buildCommand.execute();\n+        Path target = validBalFilePath.resolve(ProjectDirConstants.TARGET_DIR_NAME);\n+        Path platformLibsDir = target.resolve(\"platform-libs\");\n+        Assert.assertTrue(Files.exists(target), \"Check if target directory is created\");\n+        Assert.assertTrue(Files.exists(platformLibsDir), \"Check if platform-libs is created\");\n+\n+        //Assert maven dependencies are downloaded\n+        Assert.assertTrue(Files.exists(Paths.get(getJarPath(platformLibsDir.toString(), \"org.apache.maven\",\n+                \"maven-artifact\", \"3.6.3\"))));\n+        Assert.assertTrue(Files.exists(Paths.get(getJarPath(platformLibsDir.toString(), \"org.ballerinalang\",\n+                \"wso2-cassandra\", \"0.8.3\"))));\n+\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzUwNzIy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-456350722", "createdAt": "2020-07-28T06:56:46Z", "commit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1Njo0N1rOG3_I0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1Njo0N1rOG3_I0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM1OTMxMg==", "bodyText": "Why do we need these exclusions?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r461359312", "createdAt": "2020-07-28T06:56:47Z", "author": {"login": "azinneera"}, "path": "compiler/ballerina-lang/spotbugs-exclude.xml", "diffHunk": "@@ -75,6 +75,15 @@\n     </Match>\n     <Match>\n         <Class name = \"org.ballerinalang.toml.model.Library\"/>\n+        <Bug pattern=\"UWF_UNWRITTEN_FIELD\"/>\n+    </Match>\n+    <Match>\n+        <Class name = \"org.ballerinalang.toml.model.Repository\"/>\n+        <Bug pattern=\"UWF_UNWRITTEN_FIELD\"/>\n+    </Match>\n+    <Match>\n+        <Class name = \"org.ballerinalang.toml.model.Platform\"/>\n+        <Bug pattern=\"UWF_UNWRITTEN_PUBLIC_OR_PROTECTED_FIELD\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzUxNzYw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-456351760", "createdAt": "2020-07-28T06:58:42Z", "commit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1ODo0MlrOG3_MBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNjo1ODo0MlrOG3_MBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM2MDEzMg==", "bodyText": "Why have we disabled this test?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r461360132", "createdAt": "2020-07-28T06:58:42Z", "author": {"login": "azinneera"}, "path": "misc/maven-resolver/src/test/java/org/ballerinalang/maven/MavenResolverTest.java", "diffHunk": "@@ -52,4 +52,33 @@ public void testTransitiveDependency() {\n             Assert.fail(e.getMessage());\n         }\n     }\n+\n+    @Test\n+    public void testAddRemoteRepository() {\n+        try {\n+            resolver.addRepository(\"wso2-releases\", \"http://maven.wso2.org/nexus/content/repositories/releases/\");\n+            Dependency dependency = resolver.resolve(\"org.ballerinalang\", \"wso2-cassandra\",\n+                    \"0.8.3\", true);\n+            String jarPath = Utils.getJarPath(targetRepo, dependency.getDepedencies().get(0));\n+            Assert.assertTrue(new File(jarPath).exists());\n+        } catch (MavenResolverException e) {\n+            Assert.fail(e.getMessage());\n+        }\n+    }\n+\n+    @Test(enabled = false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1113d229a209910a7f2869f61a92e7e8bd33ac2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65d2559295475f7c7ef375e674939046165b74fc", "author": {"user": {"login": "suganyasuven", "name": "Suganya"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/65d2559295475f7c7ef375e674939046165b74fc", "committedDate": "2020-07-29T17:31:09Z", "message": "Address review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "414bbee03b692d201e17966ce6118d004198e767", "author": {"user": {"login": "suganyasuven", "name": "Suganya"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/414bbee03b692d201e17966ce6118d004198e767", "committedDate": "2020-07-29T19:42:34Z", "message": "Fix test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI2MzAz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-458126303", "createdAt": "2020-07-30T06:48:34Z", "commit": {"oid": "414bbee03b692d201e17966ce6118d004198e767"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo0ODozNVrOG5Vg3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo0ODozNVrOG5Vg3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NDQ5NA==", "bodyText": "For this scenario, Can't we generate warning message including the missing fields and continue the process? Then the user can continue works or if he or she misses it without knowing can fill it.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#discussion_r462774494", "createdAt": "2020-07-30T06:48:35Z", "author": {"login": "lnash94"}, "path": "cli/ballerina-packerina/src/test/resources/test-resources/maven-dependency-project/project-without-custom-maven-dependencies/Ballerina.toml", "diffHunk": "@@ -0,0 +1,15 @@\n+[project]\n+org-name= \"suganya\"\n+version= \"0.1.0\"\n+\n+[dependencies]\n+\n+[platform]\n+target = \"java8\"\n+\n+    [[platform.repositories]]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "414bbee03b692d201e17966ce6118d004198e767"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "548699032c80f3db8579441beeb3b97617900c7b", "author": {"user": {"login": "suganyasuven", "name": "Suganya"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/548699032c80f3db8579441beeb3b97617900c7b", "committedDate": "2020-07-30T16:27:46Z", "message": "Add validation for platform libraries and repositories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a91496f0b93d8cdbc9223b0bc55740aff8c231b", "author": {"user": {"login": "suganyasuven", "name": "Suganya"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1a91496f0b93d8cdbc9223b0bc55740aff8c231b", "committedDate": "2020-07-31T14:51:24Z", "message": "Add review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNDMzODc2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24962#pullrequestreview-460433876", "createdAt": "2020-08-04T01:17:46Z", "commit": {"oid": "1a91496f0b93d8cdbc9223b0bc55740aff8c231b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3723, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}