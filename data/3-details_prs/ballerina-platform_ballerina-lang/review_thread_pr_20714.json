{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2Mjk5MTU1", "number": 20714, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNDo1MDozNVrODaYp5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNzo1OTo0N1rODd8Faw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTkzNTExOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNDo1MDozNVrOFhT3xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNjoyOTozNVrOFhU3vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3MjkwMA==", "bodyText": "IIUC, the spec says this is invalid, should we improve the error message instead of saying unsupported?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370472900", "createdAt": "2020-01-24T04:50:35Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1143,3 +1143,6 @@ error.mapping.constructor.compatible.type.not.found =\\\n \n error.cannot.infer.types.for.tuple.binding=\\\n   invalid list constructor expression: types cannot be inferred for ''{0}''\n+\n+error.unsupported.unicode=\\\n+  unsupported unicode ''{0}''", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4OTI3OA==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370489278", "createdAt": "2020-01-24T06:29:35Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1143,3 +1143,6 @@ error.mapping.constructor.compatible.type.not.found =\\\n \n error.cannot.infer.types.for.tuple.binding=\\\n   invalid list constructor expression: types cannot be inferred for ''{0}''\n+\n+error.unsupported.unicode=\\\n+  unsupported unicode ''{0}''", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3MjkwMA=="}, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTkzNjA0OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/types/string/UniCodeTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNDo1MToxMVrOFhT4Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNjoyOToyNlrOFhU3ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3MzAzMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class UniCodeTest {\n          \n          \n            \n            public class UnicodeTest {\n          \n      \n    \n    \n  \n\nShall we fix wherever applicable?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370473030", "createdAt": "2020-01-24T04:51:11Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/types/string/UniCodeTest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.test.types.string;\n+\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.BRunUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Negative test class to check the Unicode patterns.\n+ */\n+public class UniCodeTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4OTI0Ng==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370489246", "createdAt": "2020-01-24T06:29:26Z", "author": {"login": "KavinduZoysa"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/types/string/UniCodeTest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.test.types.string;\n+\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.BRunUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Negative test class to check the Unicode patterns.\n+ */\n+public class UniCodeTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3MzAzMA=="}, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTk3NTY0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNTozMTowMFrOFhUQIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMToxMTo1MFrOFihP-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3OTEzOQ==", "bodyText": "do we need [{] and [}] instead we should be able to use \\\\{ and \\\\}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370479139", "createdAt": "2020-01-24T05:31:00Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "diffHunk": "@@ -40,4 +40,5 @@ private Constants() {\n \n     public static final int INIT_METHOD_SPLIT_SIZE = 50;\n \n+    public static final String UNICODE_REGEX = \"\\\\\\\\u[{]([a-fA-F0-9]*)[}]\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3OTczOA==", "bodyText": "And please check what happens if an empty string is matched here and too large number matches here.\nI think it will be a number format exception when parsing the int.\nShall we therefore use something like \\\\\\\\u\\\\{([a-fA-F0-9]{1,6})\\\\}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370479738", "createdAt": "2020-01-24T05:35:02Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "diffHunk": "@@ -40,4 +40,5 @@ private Constants() {\n \n     public static final int INIT_METHOD_SPLIT_SIZE = 50;\n \n+    public static final String UNICODE_REGEX = \"\\\\\\\\u[{]([a-fA-F0-9]*)[}]\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3OTEzOQ=="}, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4OTIxOA==", "bodyText": "do we need [{] and [}] instead we should be able to use \\\\{ and \\\\}\n\n+1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370489218", "createdAt": "2020-01-24T06:29:14Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "diffHunk": "@@ -40,4 +40,5 @@ private Constants() {\n \n     public static final int INIT_METHOD_SPLIT_SIZE = 50;\n \n+    public static final String UNICODE_REGEX = \"\\\\\\\\u[{]([a-fA-F0-9]*)[}]\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3OTEzOQ=="}, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0MDY2Ng==", "bodyText": "And please check what happens if an empty string is matched here and too large number matches here.\nI think it will be a number format exception when parsing the int.\nShall we therefore use something like \\\\\\\\u\\\\{([a-fA-F0-9]{1,6})\\\\}\n\nAccording to the spec, there should be at least one hex value. So if the user enters an empty string, parse throws an error. Also, the Unicodes which are out of range(greater than 0x10FFFF) are handled here, because we need to throw a compile error.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r371740666", "createdAt": "2020-01-28T11:11:50Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "diffHunk": "@@ -40,4 +40,5 @@ private Constants() {\n \n     public static final int INIT_METHOD_SPLIT_SIZE = 50;\n \n+    public static final String UNICODE_REGEX = \"\\\\\\\\u[{]([a-fA-F0-9]*)[}]\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3OTEzOQ=="}, "originalCommit": {"oid": "b76906d713684ecad0b9d7ba12abb7c8fe984197"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MDE0ODAxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwNzo0NDowM1rOFhV01Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowNjoxMVrOFihHGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUwNDkxNw==", "bodyText": "Instead of discarding the previous match data and starting from the beginning we can start from the previous matchers end index.\nint idx = 0;\nwhile (matcher.find(idx)) {\n    ....\n    text = matcher.replaceFirst(\"\\\\\\\\u\" + hexStringVal);\n    idx = matcher.end() - 2;  // 2 assuming we remove two characters only by the replace\n    matcher = pattern.matcher(text);\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r370504917", "createdAt": "2020-01-24T07:44:03Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,22 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);\n+            String originalText = text; // to log the errors\n+            Pattern pattern = Pattern.compile(Constants.UNICODE_REGEX);\n+            Matcher matcher = pattern.matcher(text);\n+            while (matcher.find()) {\n+                String hexStringVal = matcher.group(1);\n+                int hexDecimalVal = Integer.parseInt(hexStringVal, 16);\n+                if ((hexDecimalVal >= 0xD800 && hexDecimalVal <= 0xDFFF) || hexDecimalVal > 0x10FFFF) {\n+                    String hexStringWithBraces = matcher.group(0);\n+                    int offset = originalText.indexOf(hexStringWithBraces) + 1;\n+                    dlog.error(new DiagnosticPos(diagnosticSrc, pos.sLine, pos.eLine, pos.sCol + offset,\n+                                    pos.sCol + offset + hexStringWithBraces.length()),\n+                            DiagnosticCode.INVALID_UNICODE, hexStringWithBraces);\n+                }\n+                text = matcher.replaceFirst(\"\\\\\\\\u\" + hexStringVal);\n+                matcher = pattern.matcher(text);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9f024b68c862452609ede02c27bf75d9a95096"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczODM5NQ==", "bodyText": "+1 and done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r371738395", "createdAt": "2020-01-28T11:06:11Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,22 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);\n+            String originalText = text; // to log the errors\n+            Pattern pattern = Pattern.compile(Constants.UNICODE_REGEX);\n+            Matcher matcher = pattern.matcher(text);\n+            while (matcher.find()) {\n+                String hexStringVal = matcher.group(1);\n+                int hexDecimalVal = Integer.parseInt(hexStringVal, 16);\n+                if ((hexDecimalVal >= 0xD800 && hexDecimalVal <= 0xDFFF) || hexDecimalVal > 0x10FFFF) {\n+                    String hexStringWithBraces = matcher.group(0);\n+                    int offset = originalText.indexOf(hexStringWithBraces) + 1;\n+                    dlog.error(new DiagnosticPos(diagnosticSrc, pos.sLine, pos.eLine, pos.sCol + offset,\n+                                    pos.sCol + offset + hexStringWithBraces.length()),\n+                            DiagnosticCode.INVALID_UNICODE, hexStringWithBraces);\n+                }\n+                text = matcher.replaceFirst(\"\\\\\\\\u\" + hexStringVal);\n+                matcher = pattern.matcher(text);\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUwNDkxNw=="}, "originalCommit": {"oid": "2a9f024b68c862452609ede02c27bf75d9a95096"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTAwMDUwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMzoxMjo0M1rOFi7eqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxMzoyMDozNFrOFkht4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MDQwOA==", "bodyText": "Since this will be called more than once (in a general scenario when compiling a Ballerina program), I think it is better to compile this Regex once (declare as a top level variable) to reduce the overhead. WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372170408", "createdAt": "2020-01-29T03:12:43Z", "author": {"login": "Shan1024"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,24 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);\n+            String originalText = text; // to log the errors\n+            Pattern pattern = Pattern.compile(Constants.UNICODE_REGEX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg0NTQ3NA==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r373845474", "createdAt": "2020-02-02T13:20:34Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,24 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);\n+            String originalText = text; // to log the errors\n+            Pattern pattern = Pattern.compile(Constants.UNICODE_REGEX);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MDQwOA=="}, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTAxMDU4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMzoyMDozNFrOFi7kiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNDoxODo0NlrOFi8KYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MTkxMg==", "bodyText": "Adding braces around the value looks bit weird. Is there any specific reason to do this? \ud83d\ude05", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372171912", "createdAt": "2020-01-29T03:20:34Z", "author": {"login": "Shan1024"}, "path": "compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4", "diffHunk": "@@ -341,7 +341,7 @@ EscapeSequence\n \n fragment\n UnicodeEscape\n-    :   '\\\\' 'u' HexDigit HexDigit HexDigit HexDigit\n+    :   '\\\\' 'u' LEFT_BRACE HexDigit+ RIGHT_BRACE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4MTYwMw==", "bodyText": "It seems like, In the JS world, it is a norm. :) Here is the Spec change related to this. ballerina-platform/ballerina-spec@eb2fa56", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372181603", "createdAt": "2020-01-29T04:18:46Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4", "diffHunk": "@@ -341,7 +341,7 @@ EscapeSequence\n \n fragment\n UnicodeEscape\n-    :   '\\\\' 'u' HexDigit HexDigit HexDigit HexDigit\n+    :   '\\\\' 'u' LEFT_BRACE HexDigit+ RIGHT_BRACE", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MTkxMg=="}, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTAxMjU0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMzoyMjoxMFrOFi7ltQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxMzoyMDozOVrOFkht5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MjIxMw==", "bodyText": "Lexer rule is defined as HexDigit+. But here, the regex is defined as [a-fA-F0-9]*. I think this can be changed to [a-fA-F0-9]+. WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372172213", "createdAt": "2020-01-29T03:22:10Z", "author": {"login": "Shan1024"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "diffHunk": "@@ -40,4 +40,5 @@ private Constants() {\n \n     public static final int INIT_METHOD_SPLIT_SIZE = 50;\n \n+    public static final String UNICODE_REGEX = \"\\\\\\\\u\\\\{([a-fA-F0-9]*)\\\\}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg0NTQ3OA==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r373845478", "createdAt": "2020-02-02T13:20:39Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/Constants.java", "diffHunk": "@@ -40,4 +40,5 @@ private Constants() {\n \n     public static final int INIT_METHOD_SPLIT_SIZE = 50;\n \n+    public static final String UNICODE_REGEX = \"\\\\\\\\u\\\\{([a-fA-F0-9]*)\\\\}\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MjIxMw=="}, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTAxNTQ5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMzoyNDozOVrOFi7nfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxMzoyMDo0MlrOFkht9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MjY3MA==", "bodyText": "I think it is better to merge these two lines in this PR as well -\nString text = node.getText().substring(1, text.length() - 1);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372172670", "createdAt": "2020-01-29T03:24:39Z", "author": {"login": "Shan1024"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,24 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg0NTQ5Mw==", "bodyText": "We cannot do that because we need to get text.length()", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r373845493", "createdAt": "2020-02-02T13:20:42Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,24 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MjY3MA=="}, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTA3NjgzOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNDoyMTozNFrOFi8MJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxMzoyMDo0N1rOFkht-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4MjA1Mg==", "bodyText": "Better to move these values to constants.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372182052", "createdAt": "2020-01-29T04:21:34Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,24 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);\n+            String originalText = text; // to log the errors\n+            Pattern pattern = Pattern.compile(Constants.UNICODE_REGEX);\n+            Matcher matcher = pattern.matcher(text);\n+            int position = 0;\n+            while (matcher.find(position)) {\n+                String hexStringVal = matcher.group(1);\n+                int hexDecimalVal = Integer.parseInt(hexStringVal, 16);\n+                if ((hexDecimalVal >= 0xD800 && hexDecimalVal <= 0xDFFF) || hexDecimalVal > 0x10FFFF) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg0NTQ5Ng==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r373845496", "createdAt": "2020-02-02T13:20:47Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -2648,6 +2651,24 @@ public void exitSimpleLiteral(BallerinaParser.SimpleLiteralContext ctx) {\n         } else if ((node = ctx.QuotedStringLiteral()) != null) {\n             String text = node.getText();\n             text = text.substring(1, text.length() - 1);\n+            String originalText = text; // to log the errors\n+            Pattern pattern = Pattern.compile(Constants.UNICODE_REGEX);\n+            Matcher matcher = pattern.matcher(text);\n+            int position = 0;\n+            while (matcher.find(position)) {\n+                String hexStringVal = matcher.group(1);\n+                int hexDecimalVal = Integer.parseInt(hexStringVal, 16);\n+                if ((hexDecimalVal >= 0xD800 && hexDecimalVal <= 0xDFFF) || hexDecimalVal > 0x10FFFF) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4MjA1Mg=="}, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTA5NDY4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNDozMjoxNlrOFi8WFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxMzoyMDo1MlrOFkhuBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4NDU5OQ==", "bodyText": "Should we change HexDigit* here to avoid a syntax error?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r372184599", "createdAt": "2020-01-29T04:32:16Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4", "diffHunk": "@@ -341,7 +341,7 @@ EscapeSequence\n \n fragment\n UnicodeEscape\n-    :   '\\\\' 'u' HexDigit HexDigit HexDigit HexDigit\n+    :   '\\\\' 'u' LEFT_BRACE HexDigit+ RIGHT_BRACE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg0NTUwOQ==", "bodyText": "According to the spec, Unicode is defined as,\nStringNumericEscape := \\u{ CodePoint }\nCodePoint := HexDigit+", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r373845509", "createdAt": "2020-02-02T13:20:52Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4", "diffHunk": "@@ -341,7 +341,7 @@ EscapeSequence\n \n fragment\n UnicodeEscape\n-    :   '\\\\' 'u' HexDigit HexDigit HexDigit HexDigit\n+    :   '\\\\' 'u' LEFT_BRACE HexDigit+ RIGHT_BRACE", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4NDU5OQ=="}, "originalCommit": {"oid": "50a59fbcca28b86c9fb0404840ee4edb698307b4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzE5NzIzOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/antlr4/BallerinaLexer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNzo1OTo0N1rOFm03DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMDowMTowNlrOFm3-Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI1NjI2OQ==", "bodyText": "Shall we generate the parser from compiler/ballerina-lang/src/main/resources/grammar/ directory\nNavigate to grammar directory:\njava -jar ~/Downloads/antlr-4.5.3-complete.jar *.g4 -package org.wso2.ballerinalang.compiler.parser.antlr4 -o ../../java/org/wso2/ballerinalang/compiler/parser/antlr4/", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r376256269", "createdAt": "2020-02-07T07:59:47Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/antlr4/BallerinaLexer.java", "diffHunk": "@@ -1,4 +1,4 @@\n-// Generated from BallerinaLexer.g4 by ANTLR 4.5.3\n+// Generated from /home/kavindu/WSO2-GIT/test/ballerina-lang/compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4 by ANTLR 4.5.3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd1c7b86f176474685296fafdae195e8836cd7ea"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwNDQwMw==", "bodyText": "This will get fixed, Once I combine All PRs. But it is a good practice to generate parser as @rdhananjaya mentioned.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r376304403", "createdAt": "2020-02-07T09:54:57Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/antlr4/BallerinaLexer.java", "diffHunk": "@@ -1,4 +1,4 @@\n-// Generated from BallerinaLexer.g4 by ANTLR 4.5.3\n+// Generated from /home/kavindu/WSO2-GIT/test/ballerina-lang/compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4 by ANTLR 4.5.3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI1NjI2OQ=="}, "originalCommit": {"oid": "fd1c7b86f176474685296fafdae195e8836cd7ea"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwNzI1OQ==", "bodyText": "ACK.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20714#discussion_r376307259", "createdAt": "2020-02-07T10:01:06Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/antlr4/BallerinaLexer.java", "diffHunk": "@@ -1,4 +1,4 @@\n-// Generated from BallerinaLexer.g4 by ANTLR 4.5.3\n+// Generated from /home/kavindu/WSO2-GIT/test/ballerina-lang/compiler/ballerina-lang/src/main/resources/grammar/BallerinaLexer.g4 by ANTLR 4.5.3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI1NjI2OQ=="}, "originalCommit": {"oid": "fd1c7b86f176474685296fafdae195e8836cd7ea"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 555, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}