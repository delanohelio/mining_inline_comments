{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MTQ5NjQ5", "number": 24112, "title": "Enable jBallerina finite type test", "bodyText": "Purpose\n$subject\nFixes #24111\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-06-14T14:06:24Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112", "merged": true, "mergeCommit": {"oid": "3dcedef2a3fa71eda5e8a479ac69c0e8fcccf49a"}, "closed": true, "closedAt": "2020-06-15T19:32:11Z", "author": {"login": "rdulmina"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrL__0gH2gAyNDM0MTQ5NjQ5OjFjZTAzYzBhN2YxODE1MjAzZWYzZDFjOWU4MDBmZWU5MjYwY2MwZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrl3h7AFqTQzMDkzMzQ3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1ce03c0a7f1815203ef3d1c9e800fee9260cc0e6", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1ce03c0a7f1815203ef3d1c9e800fee9260cc0e6", "committedDate": "2020-06-14T13:23:41Z", "message": "Enable finite type test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51b24cc13d623ab1c25c6271f5105b2a9f7e52a8", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51b24cc13d623ab1c25c6271f5105b2a9f7e52a8", "committedDate": "2020-06-14T13:26:02Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/06f20d2538f0e7f7141c4aed331c1c492513e39d", "committedDate": "2020-06-14T13:28:52Z", "message": "Add whitespace."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjI0ODAw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#pullrequestreview-430224800", "createdAt": "2020-06-14T14:36:09Z", "commit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNDozNjoxMFrOGjdeXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNDozODoxMlrOGjdfBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzNjI1Mw==", "bodyText": "no need to do replaceAll, which may be slower, also why are there , commas between chars.\n. replaceFirst(\"[fd]$\", \"\");", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#discussion_r439836253", "createdAt": "2020-06-14T14:36:10Z", "author": {"login": "manuranga"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -3655,8 +3662,13 @@ private BLangLiteral createSimpleLiteral(Node literal, SyntaxKind sign) {\n         } else if (type == SyntaxKind.DECIMAL_FLOATING_POINT_LITERAL) {\n             //TODO: Check effect of mapping negative(-) numbers as unary-expr\n             typeTag = NumericLiteralSupport.isDecimalDiscriminated(textValue) ? TypeTags.DECIMAL : TypeTags.FLOAT;\n-            value = textValue;\n-            originalValue = textValue;\n+            if (isFiniteType) {\n+                value = textValue.replaceAll(\"[f,d,/+]\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzNjQyMA==", "bodyText": "Oh is this replacing the leading + as well? and what about / I though escaping is done by \\\\", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#discussion_r439836420", "createdAt": "2020-06-14T14:38:12Z", "author": {"login": "manuranga"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -3655,8 +3662,13 @@ private BLangLiteral createSimpleLiteral(Node literal, SyntaxKind sign) {\n         } else if (type == SyntaxKind.DECIMAL_FLOATING_POINT_LITERAL) {\n             //TODO: Check effect of mapping negative(-) numbers as unary-expr\n             typeTag = NumericLiteralSupport.isDecimalDiscriminated(textValue) ? TypeTags.DECIMAL : TypeTags.FLOAT;\n-            value = textValue;\n-            originalValue = textValue;\n+            if (isFiniteType) {\n+                value = textValue.replaceAll(\"[f,d,/+]\", \"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzNjI1Mw=="}, "originalCommit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjI1MjUz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#pullrequestreview-430225253", "createdAt": "2020-06-14T14:42:04Z", "commit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNDo0MjowNFrOGjdgOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNDo0NDo1NFrOGjdhZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzNjcyOQ==", "bodyText": "Any reason for commenting out?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#discussion_r439836729", "createdAt": "2020-06-14T14:42:04Z", "author": {"login": "SupunS"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/types/finite/FiniteTypeTest.java", "diffHunk": "@@ -362,11 +362,11 @@ public void testFiniteTypeWithDiscriminatedMembers() {\n         Assert.assertEquals(returns[1], new BDecimal(\"1.0\"));\n     }\n \n-    @Test(description = \"Test finite type where typename is espaed identifier\", groups = { \"brokenOnSpecDeviation\" })\n-    public void testEscapedTypeName() {\n-        BValue[] returns = BRunUtil.invoke(result, \"testEscapedTypeName\");\n-        Assert.assertEquals(returns[0].stringValue(), \"-\");\n-    }\n+//    @Test(description = \"Test finite type where typename is espaed identifier\", groups = { \"brokenOnSpecDeviation\" })\n+//    public void testEscapedTypeName() {\n+//        BValue[] returns = BRunUtil.invoke(result, \"testEscapedTypeName\");\n+//        Assert.assertEquals(returns[0].stringValue(), \"-\");\n+//    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzNzAyOA==", "bodyText": "I think this is already handled inside createSimpleLiteral() method?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#discussion_r439837028", "createdAt": "2020-06-14T14:44:54Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -630,7 +630,14 @@ public BLangNode transform(UnionTypeDescriptorNode unionTypeDescriptorNode) {\n         BLangFiniteTypeNode bLangFiniteTypeNode = (BLangFiniteTypeNode) TreeBuilder.createFiniteTypeNode();\n         for (TypeDescriptorNode finiteTypeEl : finiteTypeElements) {\n             SingletonTypeDescriptorNode singletonTypeNode = (SingletonTypeDescriptorNode) finiteTypeEl;\n-            BLangLiteral literal = createSimpleLiteral(singletonTypeNode.simpleContExprNode());\n+            BLangLiteral literal;\n+            Node simpleContExprNode = singletonTypeNode.simpleContExprNode();\n+            if (simpleContExprNode.kind() == SyntaxKind.UNARY_EXPRESSION) {\n+                UnaryExpressionNode unaryExpr = (UnaryExpressionNode) simpleContExprNode;\n+                literal = createSimpleLiteral(unaryExpr.expression(), unaryExpr.unaryOperator().kind(), true);\n+            } else {\n+                literal = createSimpleLiteral(simpleContExprNode, SyntaxKind.NONE, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f20d2538f0e7f7141c4aed331c1c492513e39d"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae980573197c0a6b4979927a4f332ef078dd6a8f", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae980573197c0a6b4979927a4f332ef078dd6a8f", "committedDate": "2020-06-15T06:46:48Z", "message": "Uncomment commented test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa6aa8257642b9a038fd5950c1002aaa63668b25", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa6aa8257642b9a038fd5950c1002aaa63668b25", "committedDate": "2020-06-15T06:51:02Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1a32f5c61066d3fa01c62905edb062be5211722", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d1a32f5c61066d3fa01c62905edb062be5211722", "committedDate": "2020-06-15T06:57:04Z", "message": "Removed unwanted code lines."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4ef4aaf39f6b7fe88d27c0e3820d0f005ed0ea", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2f4ef4aaf39f6b7fe88d27c0e3820d0f005ed0ea", "committedDate": "2020-06-15T09:11:02Z", "message": "Overload createSimpleLiteral method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd88dc5afe05a8e134c4ff0e20742c9ada835cd", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ffd88dc5afe05a8e134c4ff0e20742c9ada835cd", "committedDate": "2020-06-15T09:15:21Z", "message": "Remove new line."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1461e00044cff519082f495f1f8eea1555d4d5a0", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1461e00044cff519082f495f1f8eea1555d4d5a0", "committedDate": "2020-06-15T11:09:20Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5b4693cb1adbb7cb714e8b09acf52494d385346", "author": {"user": {"login": "rdulmina", "name": "Dulmina Renuke"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b5b4693cb1adbb7cb714e8b09acf52494d385346", "committedDate": "2020-06-15T15:41:47Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzczODcw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#pullrequestreview-430773870", "createdAt": "2020-06-15T15:49:30Z", "commit": {"oid": "b5b4693cb1adbb7cb714e8b09acf52494d385346"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwOTMzNDcy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24112#pullrequestreview-430933472", "createdAt": "2020-06-15T19:31:59Z", "commit": {"oid": "b5b4693cb1adbb7cb714e8b09acf52494d385346"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4334, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}