{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MDk1NDkw", "number": 20681, "title": "Fix an issue in top level variable definition", "bodyText": "Purpose\n$subject.\nFixes #10865\nFixes #20864\nApproach\nChange SymTags in order to fix the issue.\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-01-21T05:00:19Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681", "merged": true, "mergeCommit": {"oid": "eedba2b561136b6089dbe4ddfbebe231e0c2fefb"}, "closed": true, "closedAt": "2020-02-12T03:22:42Z", "author": {"login": "KavinduZoysa"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8xl9sAFqTM0NjQxNTI0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDVaepgFqTM1Njg2MjA0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDE1MjQ4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-346415248", "createdAt": "2020-01-22T08:37:11Z", "commit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozNzoxMlrOFgT_sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozNzoxMlrOFgT_sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNjM1NQ==", "bodyText": "I feel like if we move the complex logic to a function it would enhance readability. WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r369426355", "createdAt": "2020-01-22T08:37:12Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -202,7 +202,7 @@ private boolean isDistinctSymbol(DiagnosticPos pos, BSymbol symbol, BSymbol foun\n         }\n \n         // Type names should be unique and cannot be shadowed\n-        if ((foundSym.tag & SymTag.TYPE) == SymTag.TYPE) {\n+        if ((foundSym.tag & SymTag.TYPE) == SymTag.TYPE && !((foundSym.tag & SymTag.CONSTANT) == SymTag.CONSTANT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c", "committedDate": "2020-01-21T04:58:56Z", "message": "Add a negative test case"}, "afterCommit": {"oid": "297ef7be36d7ffc2b4d27301f526b976b6ac9ced", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/297ef7be36d7ffc2b4d27301f526b976b6ac9ced", "committedDate": "2020-01-23T10:38:52Z", "message": "Add the test cases"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "297ef7be36d7ffc2b4d27301f526b976b6ac9ced", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/297ef7be36d7ffc2b4d27301f526b976b6ac9ced", "committedDate": "2020-01-23T10:38:52Z", "message": "Add the test cases"}, "afterCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c", "committedDate": "2020-01-21T04:58:56Z", "message": "Add a negative test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5ODU3OTU0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-349857954", "createdAt": "2020-01-29T04:40:45Z", "commit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNDo0MDo0NVrOFi8bNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNDo0MDo0NVrOFi8bNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4NTkxMA==", "bodyText": "Shall we add more test cases? Eg- #10865 (comment)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r372185910", "createdAt": "2020-01-29T04:40:45Z", "author": {"login": "Shan1024"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/assign/var-negative.bal", "diffHunk": "@@ -73,3 +73,8 @@ function test10 () {\n     var x = <Foo> bar;\n     string result1 = x + ex;\n }\n+\n+function test11 () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "974a51536da6a08c0ad28b7308130a250f311cca", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/974a51536da6a08c0ad28b7308130a250f311cca", "committedDate": "2020-02-02T07:50:09Z", "message": "Change lookup method"}, "afterCommit": {"oid": "d3d9f907cf4a618061233fb89ca6ec47a64207a7", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3d9f907cf4a618061233fb89ca6ec47a64207a7", "committedDate": "2020-02-02T08:00:25Z", "message": "Change lookup method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3d9f907cf4a618061233fb89ca6ec47a64207a7", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3d9f907cf4a618061233fb89ca6ec47a64207a7", "committedDate": "2020-02-02T08:00:25Z", "message": "Change lookup method"}, "afterCommit": {"oid": "58f5d95fdbacdf2496ce108a05ddbf267baa5bbe", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/58f5d95fdbacdf2496ce108a05ddbf267baa5bbe", "committedDate": "2020-02-02T08:06:15Z", "message": "Change lookup method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3efbfb946ade60148c340b83963cdcb13dba7f20", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3efbfb946ade60148c340b83963cdcb13dba7f20", "committedDate": "2020-02-03T04:52:20Z", "message": "Change the SymTag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30f84aefe556302acf9367a75cde85d19f8aeb13", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/30f84aefe556302acf9367a75cde85d19f8aeb13", "committedDate": "2020-02-03T04:52:20Z", "message": "Set the unknown error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deb63f0a602fefa7523eec067d7d783516568dc1", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/deb63f0a602fefa7523eec067d7d783516568dc1", "committedDate": "2020-02-03T04:52:20Z", "message": "Add a negative test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a4b65073ef6e8307ca055c356c73ecf26db9992", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0a4b65073ef6e8307ca055c356c73ecf26db9992", "committedDate": "2020-02-03T04:52:20Z", "message": "Add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e385181e80305212de2536e12dade7cb0b4bdacb", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e385181e80305212de2536e12dade7cb0b4bdacb", "committedDate": "2020-02-03T04:52:20Z", "message": "Add new scopes to SymTags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad2d2a7038ea28f507805ab8bb7dedcf24c5aec", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2ad2d2a7038ea28f507805ab8bb7dedcf24c5aec", "committedDate": "2020-02-03T04:52:20Z", "message": "Change lookup method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3359d7032c2ec47d695635031f80ee481b0d636", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e3359d7032c2ec47d695635031f80ee481b0d636", "committedDate": "2020-02-03T04:52:20Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5db13f2fbec192b2906644ff517d4abc0e5bb3f", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f5db13f2fbec192b2906644ff517d4abc0e5bb3f", "committedDate": "2020-02-03T04:52:20Z", "message": "Fix check style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91744733b6f2928c4470bd623243d951f2099360", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/91744733b6f2928c4470bd623243d951f2099360", "committedDate": "2020-02-03T04:52:20Z", "message": "Add more test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "011bb583d2c9c55f68a3a7e3321235d0bab2e96b", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/011bb583d2c9c55f68a3a7e3321235d0bab2e96b", "committedDate": "2020-02-03T10:59:58Z", "message": "Add new scope for CONSTRUCTOR"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef3a1fc2e6c6d66098dc96021edb6426e35a8a13", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ef3a1fc2e6c6d66098dc96021edb6426e35a8a13", "committedDate": "2020-02-02T15:26:15Z", "message": "Add more test cases"}, "afterCommit": {"oid": "011bb583d2c9c55f68a3a7e3321235d0bab2e96b", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/011bb583d2c9c55f68a3a7e3321235d0bab2e96b", "committedDate": "2020-02-03T10:59:58Z", "message": "Add new scope for CONSTRUCTOR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb170194af02d9b897e5b1bc7fa155e2d9b229b", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3cb170194af02d9b897e5b1bc7fa155e2d9b229b", "committedDate": "2020-02-03T11:28:28Z", "message": "Refactor the SymTags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNTY0NDYy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-353564462", "createdAt": "2020-02-05T09:19:28Z", "commit": {"oid": "a01cc16ff5aa498ac0025f8fc110b53beac3b989"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToxOToyOFrOFlwoDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToxOToyOFrOFlwoDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzODMxNw==", "bodyText": "is this todo still relevant? expSymTag seems to be removed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375138317", "createdAt": "2020-02-05T09:19:28Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -135,15 +135,31 @@ public SymbolResolver(CompilerContext context) {\n         this.types = Types.getInstance(context);\n     }\n \n-    public boolean checkForUniqueSymbol(DiagnosticPos pos, SymbolEnv env, BSymbol symbol, int expSymTag) {\n+    // TODO : Remove the 'expSymTag'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a01cc16ff5aa498ac0025f8fc110b53beac3b989"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/525b3c2d96d72216cde694a62eb072797f688d87", "committedDate": "2020-02-05T09:20:54Z", "message": "Add one more test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a01cc16ff5aa498ac0025f8fc110b53beac3b989", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a01cc16ff5aa498ac0025f8fc110b53beac3b989", "committedDate": "2020-02-05T08:58:35Z", "message": "Add one more test case"}, "afterCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/525b3c2d96d72216cde694a62eb072797f688d87", "committedDate": "2020-02-05T09:20:54Z", "message": "Add one more test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODc5OTEz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-354879913", "createdAt": "2020-02-07T01:16:31Z", "commit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToxNjozMlrOFmvlyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToxNjozMlrOFmvlyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE2OTkyOA==", "bodyText": "Shouldn't we verify the resolved symbol is a variable here? I think we should.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376169928", "createdAt": "2020-02-07T01:16:32Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1579,8 +1579,7 @@ private boolean workerExists(BType type, String workerName) {\n \n     // Asynchronous Send Statement\n     public void visit(BLangWorkerSend workerSendNode) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerSendNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODgwMTM2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-354880136", "createdAt": "2020-02-07T01:17:21Z", "commit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToxNzoyMVrOFmvmhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToxNzoyMVrOFmvmhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3MDExOQ==", "bodyText": "Need to check for an Object symbol after this.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376170119", "createdAt": "2020-02-07T01:17:21Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -301,7 +301,7 @@ private void handleServiceTypeProcesses(CompilerPlugin plugin) {\n             BPackageSymbol symbol = this.packageCache.getSymbol(packageQName);\n             if (symbol != null) {\n                 SymbolEnv pkgEnv = symTable.pkgEnvMap.get(symbol);\n-                final BSymbol listenerSymbol = symResolver.lookupSymbol(pkgEnv, listenerName, SymTag.OBJECT);\n+                final BSymbol listenerSymbol = symResolver.lookupMainSpaceSymbol(pkgEnv, listenerName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8aa4acbb4bcd233aeb9bd0f6478393f120c7411c", "committedDate": "2020-02-09T07:19:07Z", "message": "Check the symtag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzgwNzI5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-355780729", "createdAt": "2020-02-10T09:16:33Z", "commit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNjozM1rOFnemHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNjozM1rOFnemHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDA2Mg==", "bodyText": "We need to add SymTag validation here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376940062", "createdAt": "2020-02-10T09:16:33Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -576,7 +576,7 @@ public void visit(BLangInvocation invocationExpr) {\n \n             // Todo: test lambdas and function arguments\n \n-            BSymbol dependsOnFunctionSym = symResolver.lookupSymbol(this.env, name, SymTag.FUNCTION);\n+            BSymbol dependsOnFunctionSym = symResolver.lookupMainSpaceSymbol(this.env, name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzgxMTQw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-355781140", "createdAt": "2020-02-10T09:17:13Z", "commit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNzoxNFrOFnengQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNzoxNFrOFnengQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDQxNw==", "bodyText": "We need to add SymTag validation here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376940417", "createdAt": "2020-02-10T09:17:14Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1644,8 +1647,7 @@ private BType createAccumulatedErrorTypeForMatchingRecive(DiagnosticPos pos, BTy\n \n     @Override\n     public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(syncSendExpr.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(syncSendExpr.workerIdentifier));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzgxMjQx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-355781241", "createdAt": "2020-02-10T09:17:22Z", "commit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNzoyMlrOFnen4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNzoyMlrOFnen4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDUxMg==", "bodyText": "We need to add SymTag validation here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376940512", "createdAt": "2020-02-10T09:17:22Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1672,8 +1674,7 @@ public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n     public void visit(BLangWorkerReceive workerReceiveNode) {\n         // Validate worker receive\n         validateActionParentNode(workerReceiveNode.pos, workerReceiveNode);\n-        BSymbol sender = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerReceiveNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol sender = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerReceiveNode.workerIdentifier));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzgzMTI1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-355783125", "createdAt": "2020-02-10T09:20:28Z", "commit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToyMDoyOFrOFneuDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToyMDoyOFrOFneuDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MjA5Mw==", "bodyText": "I think this validation is not needed. types are defined only in the main symbol space.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376942093", "createdAt": "2020-02-10T09:20:28Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "diffHunk": "@@ -323,11 +323,17 @@ private BSymbol resolveFullyQualifiedSymbol(DiagnosticPos pos, SymbolEnv env, St\n \n         // If there is no type in the reference we need to search in the package level and the current scope only.\n         if (typeName == Names.EMPTY) {\n-            return symResolver.lookupSymbolInPackage(pos, env, pkgName, identifierName, tag);\n+            if ((tag & SymTag.IMPORT) == SymTag.IMPORT) {\n+                return symResolver.lookupPrefixSpaceSymbolInPackage(pos, env, pkgName, identifierName);\n+            } else if ((tag & SymTag.ANNOTATION) == SymTag.ANNOTATION) {\n+                return symResolver.lookupAnnotationSpaceSymbolInPackage(pos, env, pkgName, identifierName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1Nzg0NDU2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-355784456", "createdAt": "2020-02-10T09:22:34Z", "commit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToyMjozNFrOFnex-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToyMjozNFrOFnex-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MzA5OA==", "bodyText": "Need to validate SymTag.CONSTANT", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376943098", "createdAt": "2020-02-10T09:22:34Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -1419,8 +1419,8 @@ private boolean validateErrorReasonMatchPatternSyntax(BLangErrorVariable errorVa\n                 && errorVariable.reasonMatchConst == null\n                 && isReasonSpecified(errorVariable)) {\n \n-            BSymbol reasonConst = symResolver.lookupSymbol(\n-                    this.env.enclEnv, names.fromString(errorVariable.reason.name.value), SymTag.CONSTANT);\n+            BSymbol reasonConst = symResolver.lookupMainSpaceSymbol(this.env.enclEnv,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNTY3NTA1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-353567505", "createdAt": "2020-02-05T09:24:13Z", "commit": {"oid": "a01cc16ff5aa498ac0025f8fc110b53beac3b989"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyNTo1NlrOFlw04Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMjoyNzoyM1rOFnkPtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ==", "bodyText": "Shall we rephrase this method? Something like lookupSymbolInMainSpace?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375141601", "createdAt": "2020-02-05T09:25:56Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTc5NA==", "bodyText": "Same goes for the rest of the such methods as well", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375141794", "createdAt": "2020-02-05T09:26:22Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5OTQ3OA==", "bodyText": "This logic with the use of a temp var is unnecessary right? Since we are verifying that it is var sym tag, we can do the following:\nBSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));\nif ((receiver.tag & SymTag.VARIABLE) == SymTag.VARIABLE) {\n    receiver = symTable.notFoundSymbol;\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376999478", "createdAt": "2020-02-10T11:10:36Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1579,8 +1579,11 @@ private boolean workerExists(BType type, String workerName) {\n \n     // Asynchronous Send Statement\n     public void visit(BLangWorkerSend workerSendNode) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerSendNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symTable.notFoundSymbol;\n+        BSymbol tempSymbol = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));\n+        if ((tempSymbol.tag & SymTag.VARIABLE) == SymTag.VARIABLE) {\n+            receiver = tempSymbol;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxNTc2Mw==", "bodyText": "I think this is ok. By this time, the receiver seems to be validated to be a worker. For example,\nfunction process() returns string {\n    string ss = \":\";\n\n    worker w1 {\n        int a = 10;\n        a ->> ss;\n    }\n\n    worker w2 {\n        io:println(\"In w2\");\n    }\n\n    wait w1;\n\n    return \"done\";\n}\nThe above results in the following error:\nundefined worker 'ss'", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377015763", "createdAt": "2020-02-10T11:49:09Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1644,8 +1647,7 @@ private BType createAccumulatedErrorTypeForMatchingRecive(DiagnosticPos pos, BTy\n \n     @Override\n     public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(syncSendExpr.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(syncSendExpr.workerIdentifier));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDQxNw=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxOTE4Nw==", "bodyText": "Similar concern as above regarding the use of a temp var", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377019187", "createdAt": "2020-02-10T11:56:55Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -301,8 +301,10 @@ private void handleServiceTypeProcesses(CompilerPlugin plugin) {\n             BPackageSymbol symbol = this.packageCache.getSymbol(packageQName);\n             if (symbol != null) {\n                 SymbolEnv pkgEnv = symTable.pkgEnvMap.get(symbol);\n-                final BSymbol listenerSymbol = symResolver.lookupSymbol(pkgEnv, listenerName, SymTag.OBJECT);\n-                if (listenerSymbol != symTable.notFoundSymbol) {\n+                BSymbol listenerSymbol;\n+                BSymbol tempListenerSymbol = symResolver.lookupMainSpaceSymbol(pkgEnv, listenerName);\n+                if ((tempListenerSymbol.tag & SymTag.OBJECT) == SymTag.OBJECT) {\n+                    listenerSymbol = tempListenerSymbol;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAzMjM1NQ==", "bodyText": "Same comment as above. For phases after semantic analyzer, we don't need to validate the sym tag since it would already have been caught if the sym tag was invalid.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377032355", "createdAt": "2020-02-10T12:26:44Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -576,7 +576,7 @@ public void visit(BLangInvocation invocationExpr) {\n \n             // Todo: test lambdas and function arguments\n \n-            BSymbol dependsOnFunctionSym = symResolver.lookupSymbol(this.env, name, SymTag.FUNCTION);\n+            BSymbol dependsOnFunctionSym = symResolver.lookupMainSpaceSymbol(this.env, name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDA2Mg=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAzMjYzMQ==", "bodyText": "Or lookupInMainSymbolSpace", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377032631", "createdAt": "2020-02-10T12:27:23Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2d1587f0422493c8e45a3ddc437d4fe2240b15e", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d2d1587f0422493c8e45a3ddc437d4fe2240b15e", "committedDate": "2020-02-11T07:46:28Z", "message": "Modify the method name and do the requested changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dc6e218435e608cf492b3378d633175c2ad47af", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0dc6e218435e608cf492b3378d633175c2ad47af", "committedDate": "2020-02-11T07:29:21Z", "message": "Modify the method name and do the requested changes"}, "afterCommit": {"oid": "d2d1587f0422493c8e45a3ddc437d4fe2240b15e", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d2d1587f0422493c8e45a3ddc437d4fe2240b15e", "committedDate": "2020-02-11T07:46:28Z", "message": "Modify the method name and do the requested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27ddf75e0d91caadbdb5aba65d8d6d0423567ca2", "author": {"user": {"login": "KavinduZoysa", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/27ddf75e0d91caadbdb5aba65d8d6d0423567ca2", "committedDate": "2020-02-11T13:44:06Z", "message": "Validate symtag in CodeAnalyzer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2ODYyMDQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#pullrequestreview-356862049", "createdAt": "2020-02-11T17:44:47Z", "commit": {"oid": "27ddf75e0d91caadbdb5aba65d8d6d0423567ca2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4340, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}