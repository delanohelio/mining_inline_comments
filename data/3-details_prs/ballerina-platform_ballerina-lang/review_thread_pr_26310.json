{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMzkwOTM0", "number": 26310, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjozMToyMlrOEtkTng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjozNDo1MFrOEtkY7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjE2MjIyOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/observability/metrics/MetricsTestCase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjozMToyMlrOHhbglQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNzo0Mjo1MVrOHheIog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNTc2NQ==", "bodyText": "This if condition block seems to be too big and should be refactored into multiple methods for better readability.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26310#discussion_r504815765", "createdAt": "2020-10-14T16:31:22Z", "author": {"login": "Kishanthan"}, "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/observability/metrics/MetricsTestCase.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.test.observability.metrics;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+import org.ballerina.testobserve.metrics.extension.model.Metrics;\n+import org.ballerina.testobserve.metrics.extension.model.MockMetric;\n+import org.ballerinalang.jvm.observability.metrics.PercentileValue;\n+import org.ballerinalang.jvm.observability.metrics.Snapshot;\n+import org.ballerinalang.jvm.observability.metrics.Tag;\n+import org.ballerinalang.test.observability.ObservabilityBaseTest;\n+import org.ballerinalang.test.util.HttpClientRequest;\n+import org.ballerinalang.test.util.HttpResponse;\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+import java.time.Duration;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Metrics related Test Cases.\n+ */\n+public class MetricsTestCase extends ObservabilityBaseTest {\n+    private static final String MODULE_NAME = \"testservices\";\n+    protected static final String MODULE_ID = \"ballerina-test/\" + MODULE_NAME + \":0.0.1\";\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void setup() throws Exception {\n+        super.setupServer(\"metrics\", MODULE_NAME, new int[] {10090, 10091});\n+    }\n+\n+    @AfterClass(alwaysRun = true)\n+    public void cleanup() throws Exception {\n+        super.cleanupServer();\n+    }\n+\n+    private Metrics getMetrics() throws IOException {\n+        String requestUrl = \"http://localhost:10090/metricsRegistry/getMetrics\";\n+        String data = HttpClientRequest.doPost(requestUrl, \"\", Collections.emptyMap()).getData();\n+        Type type = new TypeToken<Metrics>() { }.getType();\n+        return new Gson().fromJson(data, type);\n+    }\n+\n+    private Metrics filterByTag(Metrics metrics, String key, String value) {\n+        Metrics filteredMetrics = new Metrics();\n+        filteredMetrics.addAllCounters(filterByTag(metrics.getCounters(), key, value));\n+        filteredMetrics.addAllGauges(filterByTag(metrics.getGauges(), key, value));\n+        filteredMetrics.addAllPolledGauges(filterByTag(metrics.getPolledGauges(), key, value));\n+        return filteredMetrics;\n+    }\n+\n+    private <M extends MockMetric> List<M> filterByTag(List<M> metrics, String key, String value) {\n+        return metrics.stream()\n+                .filter(metric -> {\n+                    Optional<Tag> tag = metric.getId().getTags().stream()\n+                            .filter(t -> Objects.equals(t.getKey(), key))\n+                            .findFirst();\n+                    return (tag.isEmpty() && value == null)\n+                            || (tag.isPresent() && Objects.equals(tag.get().getValue(), value));\n+                })\n+                .collect(Collectors.toList());\n+    }\n+\n+    private void assertFunctionMetrics(Metrics allMetrics, String invocationPosition, long invocationCount,\n+                                       Tag ...additionalTags) {\n+        Metrics functionMetrics = filterByTag(allMetrics, \"src.position\", invocationPosition);\n+        Set<Tag> tags = new HashSet<>(Arrays.asList(additionalTags));\n+        tags.add(Tag.of(\"src.module\", MODULE_ID));\n+        tags.add(Tag.of(\"src.position\", invocationPosition));\n+\n+        Assert.assertEquals(functionMetrics.getCounters().stream()\n+                        .map(gauge -> gauge.getId().getName())\n+                        .collect(Collectors.toSet()),\n+                new HashSet<>(Arrays.asList(\"requests_total\", \"response_time_nanoseconds_total\")));\n+        Assert.assertEquals(functionMetrics.getCounters().size(), 2);\n+        functionMetrics.getCounters().forEach(counter -> {\n+            Assert.assertEquals(counter.getId().getTags(), tags);\n+            if (Objects.equals(counter.getId().getName(), \"requests_total\")) {\n+                Assert.assertEquals(counter.getValue(), invocationCount);\n+            } else if (Objects.equals(counter.getId().getName(), \"response_time_nanoseconds_total\")) {\n+                if (invocationCount > 0) {\n+                    Assert.assertTrue(counter.getValue() > 0,\n+                            \"response_time_nanoseconds_total expected to be greater than 0, but found \"\n+                            + counter.getValue());\n+                } else {\n+                    Assert.assertEquals(counter.getValue(), 0);\n+                }\n+            } else {\n+                Assert.fail(\"Unexpected metric \" + counter.getId().getName());\n+            }\n+        });\n+\n+        Assert.assertEquals(functionMetrics.getGauges().stream()\n+                        .map(gauge -> gauge.getId().getName())\n+                        .collect(Collectors.toSet()),\n+                new HashSet<>(Arrays.asList(\"response_time_seconds\", \"inprogress_requests\")));\n+        Assert.assertEquals(functionMetrics.getGauges().size(), 2);\n+        functionMetrics.getGauges().forEach(gauge -> {\n+            if (Objects.equals(gauge.getId().getName(), \"response_time_seconds\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe1275edfef98bc6785bbb4cc82c01f17e2616e"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1ODc4Ng==", "bodyText": "Fixed in f2a17a0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26310#discussion_r504858786", "createdAt": "2020-10-14T17:42:51Z", "author": {"login": "nadundesilva"}, "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/observability/metrics/MetricsTestCase.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.test.observability.metrics;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+import org.ballerina.testobserve.metrics.extension.model.Metrics;\n+import org.ballerina.testobserve.metrics.extension.model.MockMetric;\n+import org.ballerinalang.jvm.observability.metrics.PercentileValue;\n+import org.ballerinalang.jvm.observability.metrics.Snapshot;\n+import org.ballerinalang.jvm.observability.metrics.Tag;\n+import org.ballerinalang.test.observability.ObservabilityBaseTest;\n+import org.ballerinalang.test.util.HttpClientRequest;\n+import org.ballerinalang.test.util.HttpResponse;\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+import java.time.Duration;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Metrics related Test Cases.\n+ */\n+public class MetricsTestCase extends ObservabilityBaseTest {\n+    private static final String MODULE_NAME = \"testservices\";\n+    protected static final String MODULE_ID = \"ballerina-test/\" + MODULE_NAME + \":0.0.1\";\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void setup() throws Exception {\n+        super.setupServer(\"metrics\", MODULE_NAME, new int[] {10090, 10091});\n+    }\n+\n+    @AfterClass(alwaysRun = true)\n+    public void cleanup() throws Exception {\n+        super.cleanupServer();\n+    }\n+\n+    private Metrics getMetrics() throws IOException {\n+        String requestUrl = \"http://localhost:10090/metricsRegistry/getMetrics\";\n+        String data = HttpClientRequest.doPost(requestUrl, \"\", Collections.emptyMap()).getData();\n+        Type type = new TypeToken<Metrics>() { }.getType();\n+        return new Gson().fromJson(data, type);\n+    }\n+\n+    private Metrics filterByTag(Metrics metrics, String key, String value) {\n+        Metrics filteredMetrics = new Metrics();\n+        filteredMetrics.addAllCounters(filterByTag(metrics.getCounters(), key, value));\n+        filteredMetrics.addAllGauges(filterByTag(metrics.getGauges(), key, value));\n+        filteredMetrics.addAllPolledGauges(filterByTag(metrics.getPolledGauges(), key, value));\n+        return filteredMetrics;\n+    }\n+\n+    private <M extends MockMetric> List<M> filterByTag(List<M> metrics, String key, String value) {\n+        return metrics.stream()\n+                .filter(metric -> {\n+                    Optional<Tag> tag = metric.getId().getTags().stream()\n+                            .filter(t -> Objects.equals(t.getKey(), key))\n+                            .findFirst();\n+                    return (tag.isEmpty() && value == null)\n+                            || (tag.isPresent() && Objects.equals(tag.get().getValue(), value));\n+                })\n+                .collect(Collectors.toList());\n+    }\n+\n+    private void assertFunctionMetrics(Metrics allMetrics, String invocationPosition, long invocationCount,\n+                                       Tag ...additionalTags) {\n+        Metrics functionMetrics = filterByTag(allMetrics, \"src.position\", invocationPosition);\n+        Set<Tag> tags = new HashSet<>(Arrays.asList(additionalTags));\n+        tags.add(Tag.of(\"src.module\", MODULE_ID));\n+        tags.add(Tag.of(\"src.position\", invocationPosition));\n+\n+        Assert.assertEquals(functionMetrics.getCounters().stream()\n+                        .map(gauge -> gauge.getId().getName())\n+                        .collect(Collectors.toSet()),\n+                new HashSet<>(Arrays.asList(\"requests_total\", \"response_time_nanoseconds_total\")));\n+        Assert.assertEquals(functionMetrics.getCounters().size(), 2);\n+        functionMetrics.getCounters().forEach(counter -> {\n+            Assert.assertEquals(counter.getId().getTags(), tags);\n+            if (Objects.equals(counter.getId().getName(), \"requests_total\")) {\n+                Assert.assertEquals(counter.getValue(), invocationCount);\n+            } else if (Objects.equals(counter.getId().getName(), \"response_time_nanoseconds_total\")) {\n+                if (invocationCount > 0) {\n+                    Assert.assertTrue(counter.getValue() > 0,\n+                            \"response_time_nanoseconds_total expected to be greater than 0, but found \"\n+                            + counter.getValue());\n+                } else {\n+                    Assert.assertEquals(counter.getValue(), 0);\n+                }\n+            } else {\n+                Assert.fail(\"Unexpected metric \" + counter.getId().getName());\n+            }\n+        });\n+\n+        Assert.assertEquals(functionMetrics.getGauges().stream()\n+                        .map(gauge -> gauge.getId().getName())\n+                        .collect(Collectors.toSet()),\n+                new HashSet<>(Arrays.asList(\"response_time_seconds\", \"inprogress_requests\")));\n+        Assert.assertEquals(functionMetrics.getGauges().size(), 2);\n+        functionMetrics.getGauges().forEach(gauge -> {\n+            if (Objects.equals(gauge.getId().getName(), \"response_time_seconds\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNTc2NQ=="}, "originalCommit": {"oid": "8fe1275edfef98bc6785bbb4cc82c01f17e2616e"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjE3MTc3OnYy", "diffSide": "RIGHT", "path": "tests/observability-test-utils/src/main/resources/META-INF/services/org.ballerinalang.jvm.observability.metrics.spi.MetricReporter", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjozNDowMFrOHhbmyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNzo0MzoxNVrOHheJfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNzM1NA==", "bodyText": "add EoF line here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26310#discussion_r504817354", "createdAt": "2020-10-14T16:34:00Z", "author": {"login": "Kishanthan"}, "path": "tests/observability-test-utils/src/main/resources/META-INF/services/org.ballerinalang.jvm.observability.metrics.spi.MetricReporter", "diffHunk": "@@ -0,0 +1 @@\n+org.ballerina.testobserve.metrics.extension.BMockMetricsReporter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe1275edfef98bc6785bbb4cc82c01f17e2616e"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1OTAwNw==", "bodyText": "Fixed in 9e52e04", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26310#discussion_r504859007", "createdAt": "2020-10-14T17:43:15Z", "author": {"login": "nadundesilva"}, "path": "tests/observability-test-utils/src/main/resources/META-INF/services/org.ballerinalang.jvm.observability.metrics.spi.MetricReporter", "diffHunk": "@@ -0,0 +1 @@\n+org.ballerina.testobserve.metrics.extension.BMockMetricsReporter", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNzM1NA=="}, "originalCommit": {"oid": "8fe1275edfef98bc6785bbb4cc82c01f17e2616e"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjE3NTgxOnYy", "diffSide": "RIGHT", "path": "tests/observability-test-utils/src/main/java/org/ballerina/testobserve/metrics/extension/MetricsUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjozNDo1MFrOHhbpMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNzo1MzoxMFrOHhehAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNzk3MA==", "bodyText": "Only way is to check instanceof here? Can't we have some type / enum based cases?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26310#discussion_r504817970", "createdAt": "2020-10-14T16:34:50Z", "author": {"login": "Kishanthan"}, "path": "tests/observability-test-utils/src/main/java/org/ballerina/testobserve/metrics/extension/MetricsUtils.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerina.testobserve.metrics.extension;\n+\n+import com.google.gson.Gson;\n+import org.ballerina.testobserve.metrics.extension.model.Metrics;\n+import org.ballerina.testobserve.metrics.extension.model.MockCounter;\n+import org.ballerina.testobserve.metrics.extension.model.MockGauge;\n+import org.ballerina.testobserve.metrics.extension.model.MockPolledGauge;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.observability.metrics.Counter;\n+import org.ballerinalang.jvm.observability.metrics.DefaultMetricRegistry;\n+import org.ballerinalang.jvm.observability.metrics.Gauge;\n+import org.ballerinalang.jvm.observability.metrics.Metric;\n+import org.ballerinalang.jvm.observability.metrics.PolledGauge;\n+\n+/**\n+ * Java functions called from Ballerina related to metrics.\n+ */\n+public class MetricsUtils {\n+    public static Object getMetrics() {\n+        Metric[] metricsList = DefaultMetricRegistry.getInstance().getAllMetrics();\n+        Metrics metrics = new Metrics();\n+        for (Metric metric : metricsList) {\n+            if (metric instanceof Counter) {\n+                Counter counter = (Counter) metric;\n+                MockCounter mockCounter = new MockCounter();\n+                mockCounter.setId(counter.getId());\n+                mockCounter.setValue(counter.getValue());\n+                metrics.addCounter(mockCounter);\n+            } else if (metric instanceof Gauge) {\n+                Gauge gauge = (Gauge) metric;\n+                MockGauge mockGauge = new MockGauge();\n+                mockGauge.setId(gauge.getId());\n+                mockGauge.setValue(gauge.getValue());\n+                mockGauge.setCount(gauge.getCount());\n+                mockGauge.setSum(gauge.getSum());\n+                mockGauge.setSnapshots(gauge.getSnapshots());\n+                metrics.addGauge(mockGauge);\n+            } else if (metric instanceof PolledGauge) {\n+                PolledGauge polledGauge = (PolledGauge) metric;\n+                MockPolledGauge mockPolledGauge = new MockPolledGauge();\n+                mockPolledGauge.setId(polledGauge.getId());\n+                mockPolledGauge.setValue(polledGauge.getValue());\n+                metrics.addPolledGauge(mockPolledGauge);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe1275edfef98bc6785bbb4cc82c01f17e2616e"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2NTAyNA==", "bodyText": "We don't have a enum defined for metric kind at the moment. But we can introduce it though.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26310#discussion_r504865024", "createdAt": "2020-10-14T17:53:10Z", "author": {"login": "nadundesilva"}, "path": "tests/observability-test-utils/src/main/java/org/ballerina/testobserve/metrics/extension/MetricsUtils.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerina.testobserve.metrics.extension;\n+\n+import com.google.gson.Gson;\n+import org.ballerina.testobserve.metrics.extension.model.Metrics;\n+import org.ballerina.testobserve.metrics.extension.model.MockCounter;\n+import org.ballerina.testobserve.metrics.extension.model.MockGauge;\n+import org.ballerina.testobserve.metrics.extension.model.MockPolledGauge;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.observability.metrics.Counter;\n+import org.ballerinalang.jvm.observability.metrics.DefaultMetricRegistry;\n+import org.ballerinalang.jvm.observability.metrics.Gauge;\n+import org.ballerinalang.jvm.observability.metrics.Metric;\n+import org.ballerinalang.jvm.observability.metrics.PolledGauge;\n+\n+/**\n+ * Java functions called from Ballerina related to metrics.\n+ */\n+public class MetricsUtils {\n+    public static Object getMetrics() {\n+        Metric[] metricsList = DefaultMetricRegistry.getInstance().getAllMetrics();\n+        Metrics metrics = new Metrics();\n+        for (Metric metric : metricsList) {\n+            if (metric instanceof Counter) {\n+                Counter counter = (Counter) metric;\n+                MockCounter mockCounter = new MockCounter();\n+                mockCounter.setId(counter.getId());\n+                mockCounter.setValue(counter.getValue());\n+                metrics.addCounter(mockCounter);\n+            } else if (metric instanceof Gauge) {\n+                Gauge gauge = (Gauge) metric;\n+                MockGauge mockGauge = new MockGauge();\n+                mockGauge.setId(gauge.getId());\n+                mockGauge.setValue(gauge.getValue());\n+                mockGauge.setCount(gauge.getCount());\n+                mockGauge.setSum(gauge.getSum());\n+                mockGauge.setSnapshots(gauge.getSnapshots());\n+                metrics.addGauge(mockGauge);\n+            } else if (metric instanceof PolledGauge) {\n+                PolledGauge polledGauge = (PolledGauge) metric;\n+                MockPolledGauge mockPolledGauge = new MockPolledGauge();\n+                mockPolledGauge.setId(polledGauge.getId());\n+                mockPolledGauge.setValue(polledGauge.getValue());\n+                metrics.addPolledGauge(mockPolledGauge);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNzk3MA=="}, "originalCommit": {"oid": "8fe1275edfef98bc6785bbb4cc82c01f17e2616e"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4933, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}