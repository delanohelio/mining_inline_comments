{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMwOTIyNDkx", "number": 23795, "title": "Make objects a selectively immutable type and add tests", "bodyText": "Purpose\n$title.\nFixes #23864 - Implement the readonly object\nFixes #23420 - (Abstract) Objects should be a selectively immutable type\nFixes #23464 - If all the fields in a closed record typedesc are readonly the record type itself should be a subtype of readonly. Similarly objects that have all readonly fields are made a subtype of readonly.\nFixes #23587 - Fix missing flags in BIRPackageSymbolEnter and add balo tests for immutable types and readonly fields\nFixes #23901 - Defaults values are not set for immutable typed fields of an immutable-typed record/object\nFixes  #23815 - visitMaxs error for T & readonly where T is anydata, any, or json\nRemarks\nballerina-platform/ballerina-spec#535\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-06-08T08:28:45Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795", "merged": true, "mergeCommit": {"oid": "3757dac0e9a090b2c42fb7563a8f73eae4ce8f92"}, "closed": true, "closedAt": "2020-06-14T08:13:03Z", "author": {"login": "MaryamZi"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmDi7MAH2gAyNDMwOTIyNDkxOmU4NWQzZDNjMjhiMGU1NmJlNTUxYTdmMzZmYTBjM2U2Yzc0MmU4YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrF6twgFqTQzMDE5MTEwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e85d3d3c28b0e56be551a7f36fa0c3e6c742e8bc", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e85d3d3c28b0e56be551a7f36fa0c3e6c742e8bc", "committedDate": "2020-05-29T14:43:04Z", "message": "Make objects a selectively immutable type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18fd5c9d43de5dffe30c13395545d457b2c39800", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/18fd5c9d43de5dffe30c13395545d457b2c39800", "committedDate": "2020-06-03T11:35:24Z", "message": "Allow readonly intersections with objects only if abstract"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42eeaa5d70dead9d55544794623c314705e39412", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/42eeaa5d70dead9d55544794623c314705e39412", "committedDate": "2020-06-03T12:40:09Z", "message": "Fix field update check for objects and fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adc595774ab20540aba859318d37d279e4dcfcf0", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/adc595774ab20540aba859318d37d279e4dcfcf0", "committedDate": "2020-06-03T17:28:07Z", "message": "Fix setting immutable intersecn type and add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "553bf42adfc462f7843de441c6ebe39bd43c5880", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/553bf42adfc462f7843de441c6ebe39bd43c5880", "committedDate": "2020-06-03T17:29:11Z", "message": "Merge branch 'impl-intersectn-type' of https://github.com/MaryamZi/ballerina into obj-imm-take-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd65b51cf3ebfd086eec550de23310fcdb8f7a14", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dd65b51cf3ebfd086eec550de23310fcdb8f7a14", "committedDate": "2020-06-04T06:59:39Z", "message": "Add tests for all readonly field structures being immutable types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64d992c3b4490efbccfac66e79dda72d7fedbec7", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/64d992c3b4490efbccfac66e79dda72d7fedbec7", "committedDate": "2020-06-04T15:15:02Z", "message": "Add basic balo tests for selectively immutable types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f927cb8433063feafc8abd2031421ad2bcd471", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/36f927cb8433063feafc8abd2031421ad2bcd471", "committedDate": "2020-06-05T06:11:56Z", "message": "Create immutable tsymbol only if original tsymbol is not null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bec9c889e95fa6b7c17345a085183df369082b1", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0bec9c889e95fa6b7c17345a085183df369082b1", "committedDate": "2020-06-05T17:43:12Z", "message": "Fix setting immutability in BIRPackageSymbolEnter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40a17a72c3f7d60e60d6430db2ded9b29cdbf932", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/40a17a72c3f7d60e60d6430db2ded9b29cdbf932", "committedDate": "2020-06-06T07:28:55Z", "message": "Prepend module to readonly symbol and add balo tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b502782dd441597f5c2c4de14e1d69f127a9ce3", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3b502782dd441597f5c2c4de14e1d69f127a9ce3", "committedDate": "2020-06-06T12:58:32Z", "message": "Add immutability test for same named constructs from diff modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "587c923cb0d598f0d5a87685a56f9e0346e4a5b5", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/587c923cb0d598f0d5a87685a56f9e0346e4a5b5", "committedDate": "2020-06-07T07:34:21Z", "message": "Merge branch 'impl-intersectn-type' of https://github.com/MaryamZi/ballerina into obj-imm-take-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391a9a615e3d34bd1d5dc0e7a5b882106496c24c", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/391a9a615e3d34bd1d5dc0e7a5b882106496c24c", "committedDate": "2020-06-07T08:03:38Z", "message": "Fix compilation error due to sync"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54da694d046f4225650693e03729c5b10cdde89b", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/54da694d046f4225650693e03729c5b10cdde89b", "committedDate": "2020-06-08T17:15:41Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into obj-imm-take-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dcf6541dcb0a494a22001268f5a3aa4fa35f6f3", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4dcf6541dcb0a494a22001268f5a3aa4fa35f6f3", "committedDate": "2020-06-08T20:14:58Z", "message": "Fix literal assignment to broad immutable intersection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcaabd71212ee6454d0b3986e355dfe02c99750e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bcaabd71212ee6454d0b3986e355dfe02c99750e", "committedDate": "2020-06-09T13:00:40Z", "message": "Fix readonly checks for unions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27908a2d535ebf9cd30adab36dc3d9b2b219244f", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/27908a2d535ebf9cd30adab36dc3d9b2b219244f", "committedDate": "2020-06-09T13:11:46Z", "message": "Add basic intersection tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f89fc8d993c732b3be4f4763c9a55b5c43b823f8", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f89fc8d993c732b3be4f4763c9a55b5c43b823f8", "committedDate": "2020-06-09T15:38:05Z", "message": "Fix type flags getting overwritten with aliases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e19b6841b67b5580cc8accb63a2f5f23e9c7921", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1e19b6841b67b5580cc8accb63a2f5f23e9c7921", "committedDate": "2020-06-09T16:33:26Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfe3e159bbe5b5f217387fab9e8af69aa499f52c", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dfe3e159bbe5b5f217387fab9e8af69aa499f52c", "committedDate": "2020-06-10T11:05:25Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3478c173963eda6c01bbea1733683d690b3c37e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3478c173963eda6c01bbea1733683d690b3c37e", "committedDate": "2020-06-10T14:54:58Z", "message": "Change __init to init in new tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b43c73eb461a192e7735a25c97486edff6ee4f8", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6b43c73eb461a192e7735a25c97486edff6ee4f8", "committedDate": "2020-06-10T16:59:42Z", "message": "Intro grammar changes for readonly objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37ed3423838aafbe55b900d19cb55fbaeaa172b", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c37ed3423838aafbe55b900d19cb55fbaeaa172b", "committedDate": "2020-06-11T06:16:59Z", "message": "Fix default values not being set for immutable-typed fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Njk5ODQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#pullrequestreview-428699849", "createdAt": "2020-06-11T08:29:38Z", "commit": {"oid": "1e19b6841b67b5580cc8accb63a2f5f23e9c7921"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODoyOTozOFrOGiTmoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODoyOTozOFrOGiTmoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyNTk1Mg==", "bodyText": "IMO using !(A || B) is much readable than (!A && !B)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#discussion_r438625952", "createdAt": "2020-06-11T08:29:38Z", "author": {"login": "rdhananjaya"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -1295,6 +1291,21 @@ public static boolean isSelectivelyImmutableType(BType type, Set<BType> unresolv\n \n                 return isInherentlyImmutableType(recordRestType) ||\n                         isSelectivelyImmutableType(recordRestType, unresolvedTypes);\n+            case TypeTags.OBJECT_TYPE_TAG:\n+                BObjectType objectType = (BObjectType) type;\n+\n+                if (!Flags.isFlagOn(objectType.flags, Flags.ABSTRACT)) {\n+                    return false;\n+                }\n+\n+                for (BField field : objectType.getFields().values()) {\n+                    BType fieldType = field.type;\n+                    if (!isInherentlyImmutableType(fieldType) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e19b6841b67b5580cc8accb63a2f5f23e9c7921"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4ODkwNDE4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#pullrequestreview-428890418", "createdAt": "2020-06-11T13:10:39Z", "commit": {"oid": "1e19b6841b67b5580cc8accb63a2f5f23e9c7921"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzoxMDozOVrOGicWSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzoxMDozOVrOGicWSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc2OTIyNw==", "bodyText": "@Kishanthan, this PR introduces some changes to support object/record intersection types, where for something like\nimport ballerina/http;\n\npublic function main() {\n    http:Versioning & readonly v = {};\n}\nthe name of the type of v has a name like (ballerina/http:1.0.0:Versioning & readonly), with / and . in the name, which results in errors. So I've replaced them with _ too.\nI also had to call this method when calculating the type field name (org.wso2.ballerinalang.compiler.bir.codegen.JvmTypeGen#getTypeFieldName), since that too would have these characters.\nDo you see any issue with this change?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#discussion_r438769227", "createdAt": "2020-06-11T13:10:39Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmMethodGen.java", "diffHunk": "@@ -1207,7 +1207,8 @@ private static String getFrameClassName(String pkgName, String funcName, BType a\n      * @return cleaned name\n      */\n     static String cleanupTypeName(String name) {\n-\n+        name = name.replace(\"/\", \"_\");\n+        name = name.replace(\".\", \"_\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e19b6841b67b5580cc8accb63a2f5f23e9c7921"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6fc90de257ffcc0aa111f4e337636b0f7c72a44", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d6fc90de257ffcc0aa111f4e337636b0f7c72a44", "committedDate": "2020-06-11T18:46:27Z", "message": "Add support for readonly objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3db52acba28b25fcc1df1f1db634f285529f52b9", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3db52acba28b25fcc1df1f1db634f285529f52b9", "committedDate": "2020-06-11T20:55:45Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99dfca690f6a633020d9613deedd6e5839efd4c0", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/99dfca690f6a633020d9613deedd6e5839efd4c0", "committedDate": "2020-06-11T21:20:19Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDA5MTkx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#pullrequestreview-429409191", "createdAt": "2020-06-12T01:43:18Z", "commit": {"oid": "99dfca690f6a633020d9613deedd6e5839efd4c0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe224094cab802358218005006e60c3bfeb02f9", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0fe224094cab802358218005006e60c3bfeb02f9", "committedDate": "2020-06-12T05:24:23Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into obj-imm-take-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c115aff5dbef10786ca6a5c3e70527074d721b3e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c115aff5dbef10786ca6a5c3e70527074d721b3e", "committedDate": "2020-06-12T08:04:33Z", "message": "Remove unnecessary readonly field compatibility check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0183b8a4de3589c8d9aa3721883e99fe3e348c6d", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0183b8a4de3589c8d9aa3721883e99fe3e348c6d", "committedDate": "2020-06-12T08:49:54Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2f98cff59a7e96e3afba1bb2fa2a8ab9509caf8", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f2f98cff59a7e96e3afba1bb2fa2a8ab9509caf8", "committedDate": "2020-06-12T10:34:22Z", "message": "Skip immutability check for parameterized types\nsince the check will be done once the type is resolved."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c0a75aeb133943375c86ea734db66b8dc3f07c4", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8c0a75aeb133943375c86ea734db66b8dc3f07c4", "committedDate": "2020-06-13T16:49:52Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into obj-imm-take-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78608ca076abdfff8f3196328ec8feffc4324154", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/78608ca076abdfff8f3196328ec8feffc4324154", "committedDate": "2020-06-13T21:04:10Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into obj-imm-take-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTg2Mjc1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#pullrequestreview-430186275", "createdAt": "2020-06-14T04:22:00Z", "commit": {"oid": "f2f98cff59a7e96e3afba1bb2fa2a8ab9509caf8"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "003c05b8ec6fc798f5e676aa3d876f2f0b2d0dc9", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/003c05b8ec6fc798f5e676aa3d876f2f0b2d0dc9", "committedDate": "2020-06-14T04:54:36Z", "message": "Resolve conflicts and merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b99bcb74708bd1f7bf7a4763627dcc2c8330a9", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c9b99bcb74708bd1f7bf7a4763627dcc2c8330a9", "committedDate": "2020-06-14T06:04:10Z", "message": "Temporarily disable tests failing on new parser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTkxMTAw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23795#pullrequestreview-430191100", "createdAt": "2020-06-14T06:18:29Z", "commit": {"oid": "c9b99bcb74708bd1f7bf7a4763627dcc2c8330a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4415, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}