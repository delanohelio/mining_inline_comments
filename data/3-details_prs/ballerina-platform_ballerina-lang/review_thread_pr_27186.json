{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MDc1MzY1", "number": 27186, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMToxNVrOE9owPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozOToyMFrOE9o8DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMDY2MzAxOnYy", "diffSide": "LEFT", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMToxNVrOH6bjsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNDoyMzo1OVrOH6deag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDk2Mg==", "bodyText": "The ProjectConstants.TEST_DIR_NAME is removed here since it adds a duplicated tests directory in the path generated. Here, the module.document(documentId).name()) gives the bal file path along with the tests directory.\nE.g. If the .bal file inside the tests directory is main_test.bal the name given by module.document(documentId).name()) would be,\ntests/main_test.bal\nThere weren't other usages found for this method except for the one that is added in this PR.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531030962", "createdAt": "2020-11-26T13:31:15Z", "author": {"login": "IrushiL"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "diffHunk": "@@ -94,15 +94,10 @@ private BuildProject(ProjectEnvironmentBuilder environmentBuilder, Path projectP\n         for (ModuleId moduleId : currentPackage().moduleIds()) {\n             Module module = currentPackage().module(moduleId);\n             Optional<Path> modulePath = modulePath(moduleId);\n-            if (module.documentIds().contains(documentId)) {\n+            if (module.documentIds().contains(documentId) || module.testDocumentIds().contains(documentId)) {\n                 if (modulePath.isPresent()) {\n                     return Optional.of(modulePath.get().resolve(module.document(documentId).name()));\n                 }\n-            } else if (module.testDocumentIds().contains(documentId)) {\n-                if (modulePath.isPresent()) {\n-                    return Optional.of(modulePath.get()\n-                            .resolve(ProjectConstants.TEST_DIR_NAME).resolve(module.document(documentId).name()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMzc3Mg==", "bodyText": "The duplication happens because we give the document name as TEST_DIR_NAME + \"/\" + documentName + ` to get the proper directory structure within the testable jar creation. Changing this is fine but I doubt it will work on Windows.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531033772", "createdAt": "2020-11-26T13:36:11Z", "author": {"login": "azinneera"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "diffHunk": "@@ -94,15 +94,10 @@ private BuildProject(ProjectEnvironmentBuilder environmentBuilder, Path projectP\n         for (ModuleId moduleId : currentPackage().moduleIds()) {\n             Module module = currentPackage().module(moduleId);\n             Optional<Path> modulePath = modulePath(moduleId);\n-            if (module.documentIds().contains(documentId)) {\n+            if (module.documentIds().contains(documentId) || module.testDocumentIds().contains(documentId)) {\n                 if (modulePath.isPresent()) {\n                     return Optional.of(modulePath.get().resolve(module.document(documentId).name()));\n                 }\n-            } else if (module.testDocumentIds().contains(documentId)) {\n-                if (modulePath.isPresent()) {\n-                    return Optional.of(modulePath.get()\n-                            .resolve(ProjectConstants.TEST_DIR_NAME).resolve(module.document(documentId).name()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDk2Mg=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNzY0NQ==", "bodyText": "IMO, its safe to split the test document name and resolve the path in an OS independent way.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531037645", "createdAt": "2020-11-26T13:42:46Z", "author": {"login": "azinneera"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "diffHunk": "@@ -94,15 +94,10 @@ private BuildProject(ProjectEnvironmentBuilder environmentBuilder, Path projectP\n         for (ModuleId moduleId : currentPackage().moduleIds()) {\n             Module module = currentPackage().module(moduleId);\n             Optional<Path> modulePath = modulePath(moduleId);\n-            if (module.documentIds().contains(documentId)) {\n+            if (module.documentIds().contains(documentId) || module.testDocumentIds().contains(documentId)) {\n                 if (modulePath.isPresent()) {\n                     return Optional.of(modulePath.get().resolve(module.document(documentId).name()));\n                 }\n-            } else if (module.testDocumentIds().contains(documentId)) {\n-                if (modulePath.isPresent()) {\n-                    return Optional.of(modulePath.get()\n-                            .resolve(ProjectConstants.TEST_DIR_NAME).resolve(module.document(documentId).name()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDk2Mg=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA2MjM3OA==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531062378", "createdAt": "2020-11-26T14:23:59Z", "author": {"login": "IrushiL"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "diffHunk": "@@ -94,15 +94,10 @@ private BuildProject(ProjectEnvironmentBuilder environmentBuilder, Path projectP\n         for (ModuleId moduleId : currentPackage().moduleIds()) {\n             Module module = currentPackage().module(moduleId);\n             Optional<Path> modulePath = modulePath(moduleId);\n-            if (module.documentIds().contains(documentId)) {\n+            if (module.documentIds().contains(documentId) || module.testDocumentIds().contains(documentId)) {\n                 if (modulePath.isPresent()) {\n                     return Optional.of(modulePath.get().resolve(module.document(documentId).name()));\n                 }\n-            } else if (module.testDocumentIds().contains(documentId)) {\n-                if (modulePath.isPresent()) {\n-                    return Optional.of(modulePath.get()\n-                            .resolve(ProjectConstants.TEST_DIR_NAME).resolve(module.document(documentId).name()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDk2Mg=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMDY4NTM3OnYy", "diffSide": "RIGHT", "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozNzoxNFrOH6bxGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzo1MDowOFrOH6cOXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNDM5Mg==", "bodyText": "We dont need this check here. BuildProject.load() will do the validation", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531034392", "createdAt": "2020-11-26T13:37:14Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -117,6 +108,11 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                 } else {\n                     moduleName = argList.get(0);\n \n+                    // Check whether the given directory is not in a ballerina project.\n+                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA0MTg4NA==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531041884", "createdAt": "2020-11-26T13:50:08Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -117,6 +108,11 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                 } else {\n                     moduleName = argList.get(0);\n \n+                    // Check whether the given directory is not in a ballerina project.\n+                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNDM5Mg=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMDY4ODc2OnYy", "diffSide": "RIGHT", "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozODoxMFrOH6bzJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzo1MDoyMlrOH6cPBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNDkxNw==", "bodyText": "We need to wrap this with a try-catch to catch the ProjectException", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531034917", "createdAt": "2020-11-26T13:38:10Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA0MjA1Mw==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531042053", "createdAt": "2020-11-26T13:50:22Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNDkxNw=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMDY5MTYwOnYy", "diffSide": "RIGHT", "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozODo1N1rOH6b05w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNDoyNDo0OFrOH6dgkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTM2Nw==", "bodyText": "We need to iterate the module ids and get the module", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531035367", "createdAt": "2020-11-26T13:38:57Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzODE0OA==", "bodyText": "This is for formatting a single module that is provided as an argument to the formatter command. This approach should be okay right?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531038148", "createdAt": "2020-11-26T13:43:43Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTM2Nw=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA2MjkyOA==", "bodyText": "yes ok, I mistook it", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531062928", "createdAt": "2020-11-26T14:24:48Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTM2Nw=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMDY5MzI1OnYy", "diffSide": "RIGHT", "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozOToyMFrOH6b11w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzo0OTowM1rOH6cL3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTYwNw==", "bodyText": "We can remove this", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531035607", "createdAt": "2020-11-26T13:39:20Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),\n+                            getModuleName(moduleName)));\n \n                     // Iterate and format the ballerina package.\n-                    List<String> formattedFiles = iterateAndFormat(bLangPackage, sourceRootPath, dryRun);\n+                    List<String> formattedFiles = iterateAndFormat(getDocumentPaths(project, module.moduleId()),\n+                            sourceRootPath, dryRun);\n                     generateChangeReport(formattedFiles, dryRun);\n                 }\n             } else {\n-                List<BLangPackage> packages = FormatUtil.compileProject(sourceRootPath);\n-                List<String> formattedFiles = new ArrayList<>();\n-                // Iterate and format all the ballerina packages.\n-                for (BLangPackage bLangPackage : packages) {\n-                    formattedFiles.addAll(iterateAndFormat(bLangPackage, sourceRootPath, dryRun));\n+                // Check whether the given directory is not a ballerina project.\n+                if (!FormatUtil.isBallerinaProject(sourceRootPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA0MTI0NQ==", "bodyText": "Here, the reason why this check was done beforehand was because 2 test cases gave an exception with the stack strace as follows:\n        at io.ballerina.projects.internal.environment.BallerinaDistribution.validateBallerinaHomeDir(BallerinaDistribution.java:75)\n        at io.ballerina.projects.internal.environment.BallerinaDistribution.from(BallerinaDistribution.java:58)\n        at io.ballerina.projects.internal.environment.BallerinaDistribution.from(BallerinaDistribution.java:54)\n        at io.ballerina.projects.environment.EnvironmentBuilder.getBallerinaDistribution(EnvironmentBuilder.java:103)\n        at io.ballerina.projects.environment.EnvironmentBuilder.build(EnvironmentBuilder.java:77)\n        at io.ballerina.projects.environment.EnvironmentBuilder.buildDefault(EnvironmentBuilder.java:50)\n        at io.ballerina.projects.ProjectEnvironmentBuilder.getDefaultBuilder(ProjectEnvironmentBuilder.java:49)\n        at io.ballerina.projects.directory.BuildProject.load(BuildProject.java:68)\n        at org.ballerinalang.formatter.cli.FormatUtil.execute(FormatUtil.java:143)\n        at org.ballerinalang.formatter.cli.FormatCmdTest.formatCLINotAProjectTest(FormatCmdTest.java:60)\n\nDebugging a similar scenario gave the following bad sad error.\n[2020-11-26 18:16:47,748] SEVERE {b7a.log.crash} - Invalid Ballerina package directory: /Users/irushi/Desktop/temp2/notAProject, cannot find 'Ballerina.toml' file. \nio.ballerina.projects.ProjectException: Invalid Ballerina package directory: /Users/irushi/Desktop/temp2/notAProject, cannot find 'Ballerina.toml' file.\n\tat io.ballerina.projects.internal.ProjectFiles.validateBuildProjectDirPath(ProjectFiles.java:173)\n\tat io.ballerina.projects.internal.PackageConfigCreator.createBuildProjectConfig(PackageConfigCreator.java:52)\n\tat io.ballerina.projects.directory.BuildProject.load(BuildProject.java:69)\n\tat org.ballerinalang.formatter.cli.FormatUtil.execute(FormatUtil.java:140)\n\tat org.ballerinalang.formatter.cli.FormatCmd.execute(FormatCmd.java:46)\n\tat java.base/java.util.Optional.ifPresent(Optional.java:183)\n\tat org.ballerinalang.tool.Main.main(Main.java:57)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531041245", "createdAt": "2020-11-26T13:49:03Z", "author": {"login": "IrushiL"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),\n+                            getModuleName(moduleName)));\n \n                     // Iterate and format the ballerina package.\n-                    List<String> formattedFiles = iterateAndFormat(bLangPackage, sourceRootPath, dryRun);\n+                    List<String> formattedFiles = iterateAndFormat(getDocumentPaths(project, module.moduleId()),\n+                            sourceRootPath, dryRun);\n                     generateChangeReport(formattedFiles, dryRun);\n                 }\n             } else {\n-                List<BLangPackage> packages = FormatUtil.compileProject(sourceRootPath);\n-                List<String> formattedFiles = new ArrayList<>();\n-                // Iterate and format all the ballerina packages.\n-                for (BLangPackage bLangPackage : packages) {\n-                    formattedFiles.addAll(iterateAndFormat(bLangPackage, sourceRootPath, dryRun));\n+                // Check whether the given directory is not a ballerina project.\n+                if (!FormatUtil.isBallerinaProject(sourceRootPath)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTYwNw=="}, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 98}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2971, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}