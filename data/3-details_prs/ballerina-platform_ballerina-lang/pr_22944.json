{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMTE4OTIw", "number": 22944, "title": "Improve batching in metrics and traces published", "bodyText": "Purpose\n\nImprove batching in metrics and traces published", "createdAt": "2020-04-28T13:27:58Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944", "merged": true, "mergeCommit": {"oid": "16ed6f142d5d1462573b98ae47cfd265745a37aa"}, "closed": true, "closedAt": "2020-04-29T16:25:07Z", "author": {"login": "nadundesilva"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccD9f7gBqjMyODAzNDIyNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccWzKCgBqjMyODQxNjg0NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d2e7ed7f3f5671d5a5d6febb53026e3ee4911e2", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5d2e7ed7f3f5671d5a5d6febb53026e3ee4911e2", "committedDate": "2020-04-28T13:17:11Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit\n\n# When the total batch size exceeds the max frame size limit imposed by Choreo Cloud, the data needs to be separated into batched. Otherwise Choreo cloud will refuse to accept the payload. Moreover, if a single span or a metric is larger than the frame size limit (this is highly imporbable) it will be dropped as it cannot be published."}, "afterCommit": {"oid": "3dfeadee34ca64d583c8ce0a86ecda4801cb4569", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3dfeadee34ca64d583c8ce0a86ecda4801cb4569", "committedDate": "2020-04-28T13:32:38Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit\n\n# When the total batch size exceeds the max frame size limit imposed by Choreo Cloud, the data needs to be separated into batched. Otherwise Choreo cloud will refuse to accept the payload. Moreover, if a single span or a metric is larger than the frame size limit (this is highly imporbable) it will be dropped as it cannot be published."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3dfeadee34ca64d583c8ce0a86ecda4801cb4569", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3dfeadee34ca64d583c8ce0a86ecda4801cb4569", "committedDate": "2020-04-28T13:32:38Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit\n\n# When the total batch size exceeds the max frame size limit imposed by Choreo Cloud, the data needs to be separated into batched. Otherwise Choreo cloud will refuse to accept the payload. Moreover, if a single span or a metric is larger than the frame size limit (this is highly imporbable) it will be dropped as it cannot be published."}, "afterCommit": {"oid": "4ebd4f552185ccd5cfdf3500027ccd22521ed29f", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4ebd4f552185ccd5cfdf3500027ccd22521ed29f", "committedDate": "2020-04-28T14:20:03Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8960bf4beb8098f9a67d3b19e7644ac544e05e9a", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8960bf4beb8098f9a67d3b19e7644ac544e05e9a", "committedDate": "2020-04-29T07:04:01Z", "message": "Update Timer to ScheduledThreadPoolExecutor for publishing metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34cd0d75a9ffeaa63b3346c76823fd0995680e91", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/34cd0d75a9ffeaa63b3346c76823fd0995680e91", "committedDate": "2020-04-29T07:09:17Z", "message": "Update Timer to ScheduledThreadPoolExecutor for publishing trace spans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fbd10d15c56fc558805a94a131214e7b568c7589", "committedDate": "2020-04-29T07:09:38Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ebd4f552185ccd5cfdf3500027ccd22521ed29f", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4ebd4f552185ccd5cfdf3500027ccd22521ed29f", "committedDate": "2020-04-28T14:20:03Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit"}, "afterCommit": {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fbd10d15c56fc558805a94a131214e7b568c7589", "committedDate": "2020-04-29T07:09:38Z", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNDI5MTUy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#pullrequestreview-402429152", "createdAt": "2020-04-29T07:42:04Z", "commit": {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo0MjowNVrOGNzOfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo0MjowNVrOGNzOfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyMzk2NA==", "bodyText": "PUBLISH_INTERVAL_SECS ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#discussion_r417123964", "createdAt": "2020-04-29T07:42:05Z", "author": {"login": "afkham"}, "path": "misc/tracing-extensions/modules/ballerina-choreo-extension/src/main/java/org/ballerinalang/observe/trace/extension/choreo/ChoreoJaegerReporter.java", "diffHunk": "@@ -33,58 +33,64 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Objects;\n-import java.util.Timer;\n-import java.util.TimerTask;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledThreadPoolExecutor;\n+import java.util.concurrent.TimeUnit;\n \n /**\n  * Custom Jaeger tracing reporter for publishing stats to Choreo cloud.\n  */\n public class ChoreoJaegerReporter implements Reporter, AutoCloseable {\n-    private static final int PUBLISH_INTERVAL = 10 * 1000;\n+    private static final int PUBLISH_INTERVAL = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNDI5Njc3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#pullrequestreview-402429677", "createdAt": "2020-04-29T07:42:51Z", "commit": {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo0Mjo1MlrOGNzQMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo0Mjo1MlrOGNzQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyNDQwMA==", "bodyText": "PUBLISH_INTERVAL_SECS ?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#discussion_r417124400", "createdAt": "2020-04-29T07:42:52Z", "author": {"login": "afkham"}, "path": "misc/tracing-extensions/modules/ballerina-choreo-extension/src/main/java/org/ballerinalang/observe/trace/extension/choreo/MetricsReporterExtension.java", "diffHunk": "@@ -50,7 +52,7 @@\n public class MetricsReporterExtension implements MetricReporter, AutoCloseable {\n     private static final Logger LOGGER = LogFactory.getLogger();\n \n-    private static final int PUBLISH_INTERVAL = 10 * 1000;\n+    private static final int PUBLISH_INTERVAL = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNDk5OTA0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#pullrequestreview-402499904", "createdAt": "2020-04-29T09:25:26Z", "commit": {"oid": "b2e65582fced4e75a622602afbda4dcb54f67651"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2e65582fced4e75a622602afbda4dcb54f67651", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2e65582fced4e75a622602afbda4dcb54f67651", "committedDate": "2020-04-29T07:50:45Z", "message": "Add code review suggestions"}, "afterCommit": {"oid": "ac151819d51ec0c027341a2a2beb85544f7853ef", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac151819d51ec0c027341a2a2beb85544f7853ef", "committedDate": "2020-04-29T09:41:22Z", "message": "Add code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "committedDate": "2020-04-29T11:27:30Z", "message": "Add code review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac151819d51ec0c027341a2a2beb85544f7853ef", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac151819d51ec0c027341a2a2beb85544f7853ef", "committedDate": "2020-04-29T09:41:22Z", "message": "Add code review suggestions"}, "afterCommit": {"oid": "0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "author": {"user": {"login": "nadundesilva", "name": "Nadun De Silva"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "committedDate": "2020-04-29T11:27:30Z", "message": "Add code review suggestions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3512, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}