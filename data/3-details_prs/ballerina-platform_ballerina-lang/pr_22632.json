{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNjM0MzA5", "number": 22632, "title": "Add params support for SQL connectors", "bodyText": "Purpose\n\nDescribe the problems, issues, or needs driving this feature/fix and include links to related issues.\n\nFixes #22415\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-04-15T09:06:26Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632", "merged": true, "mergeCommit": {"oid": "1345b7c8dad5a7047697274aee9feb3a3fb66246"}, "closed": true, "closedAt": "2020-04-16T13:32:29Z", "author": {"login": "sinthuja"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTSeXTAH2gAyNDAzNjM0MzA5OmJjZWI3ZGVmNjcyZmE2Mjg3ZmYyZWE4MWFmMzY4ZTlmNmM3NjcwM2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYMv47AFqTM5NDYzNDM5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bceb7def672fa6287ff2ea81af368e9f6c76703f", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bceb7def672fa6287ff2ea81af368e9f6c76703f", "committedDate": "2020-04-01T07:22:06Z", "message": "Add initial cut of parameterized string to sql query operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39dfc375ef1cf79018c05ea259e7a0beb7930244", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/39dfc375ef1cf79018c05ea259e7a0beb7930244", "committedDate": "2020-04-01T13:22:32Z", "message": "Add support for primitive types on the parameterized string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e12e561bda3c0bcb48a4c62ff09d85bbbb21b078", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e12e561bda3c0bcb48a4c62ff09d85bbbb21b078", "committedDate": "2020-04-06T06:30:40Z", "message": "Add support for string and boolean sql types as params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac31dd68122b533efffa29c9f425e45843ba30e0", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac31dd68122b533efffa29c9f425e45843ba30e0", "committedDate": "2020-04-06T09:38:47Z", "message": "Add params support for numeric types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f048bff98ce2e00f06ca40588341538d9048e604", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f048bff98ce2e00f06ca40588341538d9048e604", "committedDate": "2020-04-08T13:39:31Z", "message": "Add params support for binary, clob, and blob types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929dfb0483f42b3df09a4e8f1eebe57baff9a715", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/929dfb0483f42b3df09a4e8f1eebe57baff9a715", "committedDate": "2020-04-09T16:45:48Z", "message": "Add params support for date, time, timestamp and datetime type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35e100ab466c2f7de90299aa7b8134493ec62e70", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/35e100ab466c2f7de90299aa7b8134493ec62e70", "committedDate": "2020-04-14T14:18:41Z", "message": "Add params support for arrays and struct types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "147dfb75e50fc62c98b27cdb470ba281ddd7166d", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/147dfb75e50fc62c98b27cdb470ba281ddd7166d", "committedDate": "2020-04-14T14:32:52Z", "message": "Fix jdbc2 module api to be compatible with sql module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc50d62f3ad21b157270086d72266701971e51b9", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dc50d62f3ad21b157270086d72266701971e51b9", "committedDate": "2020-04-15T05:28:25Z", "message": "Update mysql client with sql module changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62cafbe39baec09c332965f31223ac625eef6555", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/62cafbe39baec09c332965f31223ac625eef6555", "committedDate": "2020-04-15T08:12:51Z", "message": "Add jdbc2 test cases for the updated query operation with params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a73382ae2176db080cad5c7ad3f77d6cf8a5a0af", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a73382ae2176db080cad5c7ad3f77d6cf8a5a0af", "committedDate": "2020-04-15T08:55:21Z", "message": "Merge branch 'upstream-master' into sql-connector-params-support\n\n# Conflicts:\n#\tstdlib/database/sql/src/main/java/org/ballerinalang/sql/utils/Utils.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "852c6d0f05fad419d05515dc58440d0cb67d4c36", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/852c6d0f05fad419d05515dc58440d0cb67d4c36", "committedDate": "2020-04-15T09:02:02Z", "message": "Fix conflicts with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b07bfa47e35ca616ae2a5031026966c34327c810", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b07bfa47e35ca616ae2a5031026966c34327c810", "committedDate": "2020-04-15T09:04:33Z", "message": "Fix code formatting issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c87a4c013e2a6a3bd8e032ca68d8976eb493670e", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c87a4c013e2a6a3bd8e032ca68d8976eb493670e", "committedDate": "2020-04-15T13:03:10Z", "message": "Add mysql connector test cases for the query operation with params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a31056b285d49018373d8eeea8a1472ca4b9f83", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4a31056b285d49018373d8eeea8a1472ca4b9f83", "committedDate": "2020-04-15T13:07:36Z", "message": "Fix code formatting issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTQxMTQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#pullrequestreview-393941149", "createdAt": "2020-04-15T16:30:37Z", "commit": {"oid": "4a31056b285d49018373d8eeea8a1472ca4b9f83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozMDozN1rOGGB7XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozMDozN1rOGGB7XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk3NjIyMQ==", "bodyText": "Can we lift up this line to before line?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#discussion_r408976221", "createdAt": "2020-04-15T16:30:37Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/database/sql/src/main/java/org/ballerinalang/sql/utils/Utils.java", "diffHunk": "@@ -90,6 +104,411 @@ public static void closeResources(ResultSet resultSet, Statement statement, Conn\n         }\n     }\n \n+    static String getSqlQuery(MapValue<String, Object> paramString) throws ApplicationError {\n+        ArrayValue partsArray = paramString.getArrayValue(Constants.ParameterizedStingFields.PARTS);\n+        ArrayValue insertionsArray = paramString.getArrayValue(Constants.ParameterizedStingFields.INSERTIONS);\n+        if (partsArray.size() - 1 == insertionsArray.size()) {\n+            StringBuilder sqlQuery = new StringBuilder();\n+            for (int i = 0; i < partsArray.size(); i++) {\n+                if (i > 0) {\n+                    sqlQuery.append(\" ? \");\n+                }\n+                sqlQuery.append(partsArray.get(i).toString());\n+            }\n+            return sqlQuery.toString();\n+        } else {\n+            throw new ApplicationError(\"Parts and insertions count doesn't match in ParametrizedString passed. \"\n+                    + paramString.toString());\n+        }\n+    }\n+\n+    static void setParams(Connection connection, PreparedStatement preparedStatement, MapValue<String,\n+            Object> paramString)\n+            throws SQLException, ApplicationError, IOException, ParseException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a31056b285d49018373d8eeea8a1472ca4b9f83"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTQzNTQ3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#pullrequestreview-393943547", "createdAt": "2020-04-15T16:33:43Z", "commit": {"oid": "4a31056b285d49018373d8eeea8a1472ca4b9f83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozMzo0M1rOGGCCmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozMzo0M1rOGGCCmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk3ODA3Mg==", "bodyText": "Remove this extra line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#discussion_r408978072", "createdAt": "2020-04-15T16:33:43Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/database/mysql/src/test/java/org/ballerinalang/mysql/query/ParamsQueryTest.java", "diffHunk": "@@ -0,0 +1,456 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.mysql.query;\n+\n+import org.ballerinalang.model.values.BBoolean;\n+import org.ballerinalang.model.values.BDecimal;\n+import org.ballerinalang.model.values.BError;\n+import org.ballerinalang.model.values.BFloat;\n+import org.ballerinalang.model.values.BInteger;\n+import org.ballerinalang.model.values.BMap;\n+import org.ballerinalang.model.values.BString;\n+import org.ballerinalang.model.values.BValue;\n+import org.ballerinalang.mysql.BaseTest;\n+import org.ballerinalang.mysql.utils.SQLDBUtils;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.BRunUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+import org.wso2.ballerinalang.compiler.util.TypeTags;\n+\n+import java.io.File;\n+import java.text.DecimalFormat;\n+import java.util.LinkedHashMap;\n+\n+/**\n+ * This test class verifies the behaviour of the ParameterizedString passed into the testQuery operation.\n+ *\n+ * @since 1.3.0\n+ */\n+public class ParamsQueryTest {\n+    private CompileResult result;\n+    private static final String DB_NAME = \"TEST_SQL_PARAMS_QUERY\";\n+    private static final String SQL_SCRIPT = SQLDBUtils.SQL_RESOURCE_DIR + File.separator + SQLDBUtils.QUERY_DIR +\n+            File.separator + \"simple-params-test-data.sql\";\n+\n+    static {\n+        BaseTest.addDBSchema(DB_NAME, SQL_SCRIPT);\n+    }\n+\n+    @BeforeClass\n+    public void setup() {\n+        result = BCompileUtil.compileOffline(SQLDBUtils.getBalFilesDir(SQLDBUtils.QUERY_DIR,\n+                \"simple-params-query-test.bal\"));\n+    }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a31056b285d49018373d8eeea8a1472ca4b9f83"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce4f082ea7b9424cacec3d970fff980868e5fb0f", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ce4f082ea7b9424cacec3d970fff980868e5fb0f", "committedDate": "2020-04-15T17:14:38Z", "message": "Fix code formatting issues suggested with code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33305117a38708457d6fcce45194267f2c88312a", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/33305117a38708457d6fcce45194267f2c88312a", "committedDate": "2020-04-15T17:38:04Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69849f36b5cb29d90e9650b7d944f243f0ac5290", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/69849f36b5cb29d90e9650b7d944f243f0ac5290", "committedDate": "2020-04-16T09:03:08Z", "message": "Merge branch 'upstream-master' into sql-connector-params-support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a45f9493e73aa4b828b42db94a4c04e5d86a9665", "author": {"user": {"login": "sinthuja", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a45f9493e73aa4b828b42db94a4c04e5d86a9665", "committedDate": "2020-04-16T09:31:25Z", "message": "Merge branch 'upstream-master' into sql-connector-params-support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjM0Mzk1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#pullrequestreview-394634395", "createdAt": "2020-04-16T13:31:26Z", "commit": {"oid": "a45f9493e73aa4b828b42db94a4c04e5d86a9665"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3538, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}