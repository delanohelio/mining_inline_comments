{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NjU2ODE2", "number": 25473, "title": "Fix query join spec deviations", "bodyText": "Purpose\n$title. Ref [1] & [2].\nFixes #25152\nApproach\nn/a\nSamples\nn/a\nRemarks\n[1] #25152\n[2]ballerina-platform/ballerina-spec#581\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-08-27T12:09:35Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25473", "merged": true, "mergeCommit": {"oid": "603ef231ce54aed22951e96598144471fc9384d7"}, "closed": true, "closedAt": "2020-08-31T11:42:59Z", "author": {"login": "grainier"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCkJkVgH2gAyNDc0NjU2ODE2OjE1ZGQ4ZTE3N2U2MTQ4NTg5ZGQ3YWFjNzA5MjU1OTNhNGYwNmRhMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdERTumAFqTQ3ODU0MzU0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15dd8e177e6148589dd7aac70925593a4f06da0c", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/15dd8e177e6148589dd7aac70925593a4f06da0c", "committedDate": "2020-08-26T04:32:07Z", "message": "Fix join spec deviations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00e2ed6d4877202527af129a1f725a01140fba03", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/00e2ed6d4877202527af129a1f725a01140fba03", "committedDate": "2020-08-26T04:48:51Z", "message": "Merge upstream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333bdfef2f8fa892528bfe8f71da17e9298d3762", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/333bdfef2f8fa892528bfe8f71da17e9298d3762", "committedDate": "2020-08-26T05:41:44Z", "message": "Fix parser error recovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cd50902282964bd449b88ff521d1083398f829b", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7cd50902282964bd449b88ff521d1083398f829b", "committedDate": "2020-08-26T06:08:43Z", "message": "Fix formatter for join spec deviation changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e2ec8ce6a38a1d862d4d25d32bdf89a9c5c1d17", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1e2ec8ce6a38a1d862d4d25d32bdf89a9c5c1d17", "committedDate": "2020-08-27T06:30:20Z", "message": "Fix key function type issue in codegen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6a228ea69e152e56cfbffed117b7c7c2ac494be", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a6a228ea69e152e56cfbffed117b7c7c2ac494be", "committedDate": "2020-08-27T06:31:00Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d0e8b0c6cc0d1c9f7fea5bc6dd1d145eafbfb5c", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4d0e8b0c6cc0d1c9f7fea5bc6dd1d145eafbfb5c", "committedDate": "2020-08-27T12:01:32Z", "message": "Fix tests for join spec deviations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8af29b79d821de44ee280a0e7ff4413dbd935b7", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f8af29b79d821de44ee280a0e7ff4413dbd935b7", "committedDate": "2020-08-27T12:01:59Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73e7c213c7f08ed22e334f2312ebd256bdca24cd", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/73e7c213c7f08ed22e334f2312ebd256bdca24cd", "committedDate": "2020-08-27T12:10:23Z", "message": "Remove un-used methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "345d6a615068930d0212a9ad38549f345e3bc365", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/345d6a615068930d0212a9ad38549f345e3bc365", "committedDate": "2020-08-27T13:02:58Z", "message": "Fix parser tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9893af56145e0396cf5c7ebc043ddabbce607c3", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b9893af56145e0396cf5c7ebc043ddabbce607c3", "committedDate": "2020-08-27T17:18:52Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60acc39b0be0a371bbadefe6434b872dcd6cb1b6", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/60acc39b0be0a371bbadefe6434b872dcd6cb1b6", "committedDate": "2020-08-28T00:12:25Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e581773d8653a2cc563ab804e4e5d8bd82b99f5", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2e581773d8653a2cc563ab804e4e5d8bd82b99f5", "committedDate": "2020-08-28T01:16:17Z", "message": "Fix LS tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MjE2OTU4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25473#pullrequestreview-477216958", "createdAt": "2020-08-28T03:27:20Z", "commit": {"oid": "2e581773d8653a2cc563ab804e4e5d8bd82b99f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzoyNzoyMFrOHIoPhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzoyNzoyMFrOHIoPhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwOTk5MA==", "bodyText": "Shall we end the join-clause context before parsing the on-clause. like we had earlier?\n\nSince we already have a expr parsing(L9504) within join-clause context, cannot parse another expr under the same parent context as there would be an ambiguity.\nIn the error handler get next rule for the expression-rhs when the parent ctx is  join-clause includes on-clause as an alternative path.\nConsider recovery for, from int a in b join int d in e on <missing expr> select f\nafter recoverying the missing expr, error handler will then check on-clause as the next rule.\ni.e could have two on-clauses after recovery", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25473#discussion_r478809990", "createdAt": "2020-08-28T03:27:20Z", "author": {"login": "lochana-chathura"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -9486,16 +9502,8 @@ private STNode parseJoinClause(boolean isRhsExpr) {\n         // allow-actions flag is always false, since there will not be any actions\n         // within the from-clause, due to the precedence.\n         STNode expression = parseExpression(OperatorPrecedence.QUERY, isRhsExpr, false);\n+        STNode onCondition = parseOnClause(isRhsExpr);\n         endContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e581773d8653a2cc563ab804e4e5d8bd82b99f5"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MjE4MDc3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25473#pullrequestreview-477218077", "createdAt": "2020-08-28T03:31:29Z", "commit": {"oid": "2e581773d8653a2cc563ab804e4e5d8bd82b99f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzozMToyOVrOHIoTmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzozMToyOVrOHIoTmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMTAzNA==", "bodyText": "This is related to above comment. Since we end the join-clause ctx for on-clause we don't need this if condition.\nnext rule will be taken as expresssion under QUERY_EXPRESSION parent context in L2731-L2732", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25473#discussion_r478811034", "createdAt": "2020-08-28T03:31:29Z", "author": {"login": "lochana-chathura"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParserErrorHandler.java", "diffHunk": "@@ -2730,6 +2730,8 @@ private ParserRuleContext getNextRuleForKeywords(ParserRuleContext currentCtx, i\n                     return ParserRuleContext.CONFLICT_KEYWORD;\n                 } else if (parentCtx == ParserRuleContext.QUERY_EXPRESSION) {\n                     return ParserRuleContext.EXPRESSION;\n+                } else if (parentCtx == ParserRuleContext.JOIN_CLAUSE) {\n+                    return ParserRuleContext.EXPRESSION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e581773d8653a2cc563ab804e4e5d8bd82b99f5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38c43d3409b9f63c69bfa1514ea97a9c29e2fb1a", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/38c43d3409b9f63c69bfa1514ea97a9c29e2fb1a", "committedDate": "2020-08-31T07:27:02Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cbebd1f47e78021801025b25fb3b4fa48114ae0", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7cbebd1f47e78021801025b25fb3b4fa48114ae0", "committedDate": "2020-08-31T08:27:40Z", "message": "Fix parser error recovery for join condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b703f6f7be85ed95c5af3abeecf6ab436acafb46", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b703f6f7be85ed95c5af3abeecf6ab436acafb46", "committedDate": "2020-08-31T08:38:36Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-25152"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NTQzNTQ1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25473#pullrequestreview-478543545", "createdAt": "2020-08-31T11:42:52Z", "commit": {"oid": "b703f6f7be85ed95c5af3abeecf6ab436acafb46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4939, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}