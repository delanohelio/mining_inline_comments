{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNjcxMTEx", "number": 26035, "title": "Fix issues with final fields", "bodyText": "Purpose\n$title.\nFixes #25963 - Cannot update a mutable value assigned to a final object field using field access\nFixes #26021 - Object with all final fields is marked as immutable even when a type of a field is mutable\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-23T10:20:29Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035", "merged": true, "mergeCommit": {"oid": "a897d7f3964d3b76075bbd095aa578f2f1a1d1bf"}, "closed": true, "closedAt": "2020-10-20T20:04:29Z", "author": {"login": "MaryamZi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLpgibgH2gAyNDkxNjcxMTExOjg4ZjBlOGM0MzUyMDdjOGUwOThlZmM0NGFiZWI0MDE5NjBkMzVkNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUeczaAFqTUxMzA4ODk5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88f0e8c435207c8e098efc44abeb401960d35d55", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/88f0e8c435207c8e098efc44abeb401960d35d55", "committedDate": "2020-09-23T09:52:03Z", "message": "Fix issues with final fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "203fa31e83c532d71abd40a793effd2e7837b3f6", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/203fa31e83c532d71abd40a793effd2e7837b3f6", "committedDate": "2020-09-23T10:19:05Z", "message": "Add object constructor tests for final fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTIwODk4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035#pullrequestreview-494520898", "createdAt": "2020-09-23T10:33:19Z", "commit": {"oid": "203fa31e83c532d71abd40a793effd2e7837b3f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDozMzoxOVrOHWkcvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDozMzoxOVrOHWkcvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyNzkwMg==", "bodyText": "\u26cf\ufe0f Extract this out of for loop? Symbols.isFlagOn(structureType.flags, Flags.READONLY)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035#discussion_r493427902", "createdAt": "2020-09-23T10:33:19Z", "author": {"login": "KRVPerera"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -2228,24 +2228,32 @@ private void validateFieldsAndSetReadOnlyType(List<BLangNode> typeDefNodes, Symb\n                 continue;\n             }\n \n-            boolean allReadOnlyOrFinalFields = true;\n+            boolean allImmutableFields = true;\n \n             Collection<BField> fields = structureType.fields.values();\n \n             if (fields.isEmpty()) {\n                 continue;\n             }\n \n-            int flagToCheck = nodeKind == NodeKind.RECORD_TYPE ? Flags.READONLY : Flags.FINAL;\n-\n-            for (BField field : fields) {\n-                if (!Symbols.isFlagOn(field.symbol.flags, flagToCheck)) {\n-                    allReadOnlyOrFinalFields = false;\n-                    break;\n+            if (nodeKind == NodeKind.RECORD_TYPE) {\n+                for (BField field : fields) {\n+                    if (!Symbols.isFlagOn(field.symbol.flags, Flags.READONLY)) {\n+                        allImmutableFields = false;\n+                        break;\n+                    }\n+                }\n+            } else {\n+                for (BField field : fields) {\n+                    if (!Symbols.isFlagOn(field.symbol.flags, Flags.FINAL) ||\n+                            !Symbols.isFlagOn(structureType.flags, Flags.READONLY)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "203fa31e83c532d71abd40a793effd2e7837b3f6"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2badab321139d68fd2d456efb44220d9d1d177c", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2badab321139d68fd2d456efb44220d9d1d177c", "committedDate": "2020-09-23T11:25:25Z", "message": "Remove obsolete code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e38d4c63d377a2492889dbd6982060234d4b28bf", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e38d4c63d377a2492889dbd6982060234d4b28bf", "committedDate": "2020-10-07T04:20:10Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into readonly-to-final-field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abd066b411de0ad83e805f5e1ccaf5b2c6d6a13c", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/abd066b411de0ad83e805f5e1ccaf5b2c6d6a13c", "committedDate": "2020-10-20T15:28:29Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into readonly-to-final-field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDg4OTkz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035#pullrequestreview-513088993", "createdAt": "2020-10-20T20:04:21Z", "commit": {"oid": "abd066b411de0ad83e805f5e1ccaf5b2c6d6a13c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4654, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}