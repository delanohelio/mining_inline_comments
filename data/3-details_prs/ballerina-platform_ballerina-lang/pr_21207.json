{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4ODIzOTAy", "number": 21207, "title": "Allow spread operators in mapping constructor expressions", "bodyText": "Purpose\n$title. Also fixes rest param annotation attachments not being available at runtime.\nFixes #20736\nFixes #21200\nApproach\nSpread operators are desugared to a foreach, and the members in the relevant mapping are added to the constructed mapping.\nSamples\nimport ballerina/io;\n\ntype Foo record {|\n    string s;\n    int i;\n    float f;\n    boolean|float...;\n|};\n\ntype Bar record {|\n    string s;\n    int i;\n|};\n\npublic function main() {\n    map<float> m1 = {q: 1.0, w: 2.0};\n    map<boolean|float> m2 = {a: true, ...m1}; // spreads `m1`\n\n    io:println(\"-------- m2 --------\");\n    foreach var [k, v] in m2.entries() {\n        io:println(\"key: \", k, \", value: \", v);\n    }\n\n    function () returns map<boolean|float> func = () => m2;\n    Bar b = {s: \"str\", i: 1};\n    Foo f = {...b, f: 123.4, ...func()}; // spreads `b` and `m2` returned by `func`\n\n\n    io:println(\"\\n-------- f --------\");\n    foreach var [k, v] in f.entries() {\n        io:println(\"key: \", k, \", value: \", v);\n    }\n}\n$ ballerina run xyz.bal \nCompiling source\n        xyz.bal\nRunning executables\n\n-------- m2 --------\nkey: a, value: true\nkey: q, value: 1.0\nkey: w, value: 2.0\n\n-------- f --------\nkey: s, value: str\nkey: i, value: 1\nkey: f, value: 123.4\nkey: a, value: true\nkey: q, value: 1.0\nkey: w, value: 2.0\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#21206)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-24T06:01:57Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207", "merged": true, "mergeCommit": {"oid": "bc5ec12b47de1c10b09248ceebe6d240d00ee6f1"}, "closed": true, "closedAt": "2020-03-03T09:12:52Z", "author": {"login": "MaryamZi"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC5BcnAH2gAyMzc4ODIzOTAyOmJjZTdlMzgwNTlmZDFiMjRjNWNhODhjZDFiNzI4NTdlYTcwNmRlMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ-rDAAFqTM2NzgwNzQyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bce7e38059fd1b24c5ca88cd1b72857ea706de0e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bce7e38059fd1b24c5ca88cd1b72857ea706de0e", "committedDate": "2020-02-10T08:40:06Z", "message": "Intro grammar changes for spread operator in mapping-constr-expr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "349d57f1a264bd11d6a5cde6684d13bcccfc7e30", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/349d57f1a264bd11d6a5cde6684d13bcccfc7e30", "committedDate": "2020-02-13T09:11:39Z", "message": "Merge ballerina-lang master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a56b97fa4da46c53a67a594710b42ce01904880e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a56b97fa4da46c53a67a594710b42ce01904880e", "committedDate": "2020-02-15T18:21:12Z", "message": "Implement semantic, code, df, and taint analysis for spread operator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95cc638f16b4a41d7992fbb63557eb1f193c77e1", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95cc638f16b4a41d7992fbb63557eb1f193c77e1", "committedDate": "2020-02-15T18:24:17Z", "message": "Resolve conflicts and merge ballerina-lang/master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590222e89fda81f3333e30706d55396212b2151d", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/590222e89fda81f3333e30706d55396212b2151d", "committedDate": "2020-02-16T03:38:27Z", "message": "Regenerate parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178d4acb466687a1775dda1d687aeb3d7349dcd8", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/178d4acb466687a1775dda1d687aeb3d7349dcd8", "committedDate": "2020-02-16T05:41:09Z", "message": "Remove BLangJSONLiteral and few unused Desugar methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acab182417e6ad25370ba18a3d6112e7b8696e30", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/acab182417e6ad25370ba18a3d6112e7b8696e30", "committedDate": "2020-02-17T13:41:38Z", "message": "Resolve conflicts and merge ballerina-lang/master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e01cc22e2c8abc28c900754d2c707e25365646aa", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e01cc22e2c8abc28c900754d2c707e25365646aa", "committedDate": "2020-02-22T15:40:10Z", "message": "Regenerate parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d02eaac0dd089cfb4eba6f9d2baca0d0df279af3", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d02eaac0dd089cfb4eba6f9d2baca0d0df279af3", "committedDate": "2020-02-22T15:40:24Z", "message": "Move mapping field insertion logic to Desugar from BIRGen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42cf0ba12280855bc08e9d4528769d39c68abf81", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/42cf0ba12280855bc08e9d4528769d39c68abf81", "committedDate": "2020-02-22T15:40:29Z", "message": "Fix rest param annots for runtime and AnnotationAttachmentTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41d29cf4064d12e29c0cfebbc6086a8cba04871a", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41d29cf4064d12e29c0cfebbc6086a8cba04871a", "committedDate": "2020-02-22T15:40:34Z", "message": "Desugar spread operator to a foreach statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "747d8732f2df8bcfa703cba36c241bcc60a1607f", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/747d8732f2df8bcfa703cba36c241bcc60a1607f", "committedDate": "2020-02-23T09:06:10Z", "message": "Add validation for non-record spread op and fix type inferring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7682640434e708d6553f6358afc50578bfd71958", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7682640434e708d6553f6358afc50578bfd71958", "committedDate": "2020-02-24T05:40:13Z", "message": "Fix spread op type inferring and usage in maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d923f8c5ead6cf35d3de602f964cd8bbe571d17d", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d923f8c5ead6cf35d3de602f964cd8bbe571d17d", "committedDate": "2020-02-24T18:30:16Z", "message": "Fix const analysis for spread op and add more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63f4e0cb176a94d8dbb9c7c0fad9ea26c25e7b9e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/63f4e0cb176a94d8dbb9c7c0fad9ea26c25e7b9e", "committedDate": "2020-02-26T09:42:20Z", "message": "Resolve conflicts and merge ballerina-platform/master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b14150c73642791255c67080640c37dfcb92c3a5", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b14150c73642791255c67080640c37dfcb92c3a5", "committedDate": "2020-02-27T13:45:37Z", "message": "Merge ballerina-platform/master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7ac5424156509c10a30630565801c6347b875e", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4b7ac5424156509c10a30630565801c6347b875e", "committedDate": "2020-02-29T06:30:03Z", "message": "Infer optional fields via spread op as optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "133d9010951cf306ffc708243a18bc3e9f111c22", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/133d9010951cf306ffc708243a18bc3e9f111c22", "committedDate": "2020-02-29T06:31:17Z", "message": "Merge ballerina-platform/master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2OTc2NzM1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207#pullrequestreview-366976735", "createdAt": "2020-03-02T06:44:31Z", "commit": {"oid": "133d9010951cf306ffc708243a18bc3e9f111c22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNjo0NDozMVrOFwU8JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNjo0NDozMVrOFwU8JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxOTA0NA==", "bodyText": "What does this check do? The DESUGARED_MAPPING_CONSTR_KEY constant doesn't seem to be set as a var name anywhere?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207#discussion_r386219044", "createdAt": "2020-03-02T06:44:31Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -572,6 +570,24 @@ private boolean isCompileTimeAnnotationValue(BLangExpression expr) {\n                 return true;\n             case TYPE_CONVERSION_EXPR:\n                 return isCompileTimeAnnotationValue(((BLangTypeConversionExpr) expr).expr);\n+            case STATEMENT_EXPRESSION:\n+                BLangStatementExpression stmtExpr = (BLangStatementExpression) expr;\n+                List<BLangStatement> stmts = ((BLangBlockStmt) stmtExpr.stmt).stmts;\n+\n+                if (!((BLangLocalVarRef) stmtExpr.expr).varSymbol.name.value.startsWith(DESUGARED_MAPPING_CONSTR_KEY)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "133d9010951cf306ffc708243a18bc3e9f111c22"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODA3NDI1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207#pullrequestreview-367807425", "createdAt": "2020-03-03T09:12:32Z", "commit": {"oid": "133d9010951cf306ffc708243a18bc3e9f111c22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4148, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}