{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NzM1MDU2", "number": 24726, "title": "Fix error detail type resolving issue new parser", "bodyText": "Purpose\n\nDescribe the problems, issues, or needs driving this feature/fix and include links to related issues.\n\nFixes #24715 and #25205\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-07-14T08:35:50Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726", "merged": true, "mergeCommit": {"oid": "100402c15e7200d91a25a000d63c1ccd81ac424e"}, "closed": true, "closedAt": "2020-09-14T08:44:58Z", "author": {"login": "rdhananjaya"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0xM1vgH2gAyNDQ4NzM1MDU2OmNiYTA5NGYxZmU2NjJkMDQ1MzAwZWRiZGE4MTMzMWZkMjRlMTQ3MGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIvJvAAFqTQ4NzU0MjM2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cba094f1fe662d045300edbda81331fd24e1470f", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cba094f1fe662d045300edbda81331fd24e1470f", "committedDate": "2020-07-14T07:49:31Z", "message": "Set detail type of user defined error type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b66adedd0581b210a237d20eb273c20a7736fc0", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9b66adedd0581b210a237d20eb273c20a7736fc0", "committedDate": "2020-07-14T08:32:29Z", "message": "Add error type resolving test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16f88a8d4366f3275bf34e41027703022522e076", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/16f88a8d4366f3275bf34e41027703022522e076", "committedDate": "2020-07-15T01:11:35Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-error-detail-type-resolving-issue-new-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd", "committedDate": "2020-07-16T07:50:02Z", "message": "Improve node transformer for distinct errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNTA1NzU3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#pullrequestreview-460505757", "createdAt": "2020-08-04T05:29:38Z", "commit": {"oid": "e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwNToyOTozOFrOG7RpPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwNjoxNjoyOFrOG7Si8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgwODI1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else {\n          \n          \n            \n                        return nodeType;\n          \n          \n            \n                    }\n          \n          \n            \n                    }\n          \n          \n            \n                    return nodeType;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r464808254", "createdAt": "2020-08-04T05:29:38Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -431,6 +431,17 @@ public void visit(BLangTypeDefinition astTypeDefinition) {\n         }\n     }\n \n+    private BType getDefinedType(BLangTypeDefinition astTypeDefinition) {\n+        BType nodeType = astTypeDefinition.typeNode.type;\n+        // Consider: type DE distinct E;\n+        // For distinct types, the type defined by typeDefStmt (DE) is different from type used to define it (E).\n+        if (nodeType.tag == TypeTags.ERROR) {\n+            return astTypeDefinition.symbol.type;\n+        } else {\n+            return nodeType;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgxMzA4MQ==", "bodyText": "Can't we assert these in ballerina itself?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r464813081", "createdAt": "2020-08-04T05:45:58Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/error/ErrorTest.java", "diffHunk": "@@ -66,6 +66,12 @@ public void testDistinctFooError() {\n         Assert.assertEquals(errors[0].stringValue(), \"error message {\\\"detailField\\\":true}\");\n     }\n \n+    @Test\n+    public void testFunctionCallInDetailArgExpr() {\n+        BValue[] errors = BRunUtil.invoke(distinctErrorTestResult, \"testFunctionCallInDetailArgExpr\");\n+        Assert.assertEquals(errors[0].stringValue(), \"Concurrent graph modification {code:\\\"1234\\\", details:{}}\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgyMDQxMA==", "bodyText": "Should we extract typeDef.typeNode out to a variable?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r464820410", "createdAt": "2020-08-04T06:08:42Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1525,19 +1525,22 @@ private void addTopLevelNode(BLangPackage pkgNode, TopLevelNode node) {\n \n     private void defineErrorDetails(List<BLangTypeDefinition> typeDefNodes, SymbolEnv pkgEnv) {\n         for (BLangTypeDefinition typeDef : typeDefNodes) {\n-            if (typeDef.typeNode.getKind() != NodeKind.ERROR_TYPE) {\n-                continue;\n+            if (typeDef.typeNode.getKind() == NodeKind.ERROR_TYPE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgyMzAyNw==", "bodyText": "Shouldn't we use a type env here also? If so can we refactor these two blocks to avoid repeating the same logic?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r464823027", "createdAt": "2020-08-04T06:16:28Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1525,19 +1525,22 @@ private void addTopLevelNode(BLangPackage pkgNode, TopLevelNode node) {\n \n     private void defineErrorDetails(List<BLangTypeDefinition> typeDefNodes, SymbolEnv pkgEnv) {\n         for (BLangTypeDefinition typeDef : typeDefNodes) {\n-            if (typeDef.typeNode.getKind() != NodeKind.ERROR_TYPE) {\n-                continue;\n+            if (typeDef.typeNode.getKind() == NodeKind.ERROR_TYPE) {\n+                BLangErrorType errorTypeNode = (BLangErrorType) typeDef.typeNode;\n+                SymbolEnv typeDefEnv = SymbolEnv.createTypeEnv(errorTypeNode, typeDef.symbol.scope, pkgEnv);\n+\n+                BType detailType = Optional.ofNullable(errorTypeNode.detailType)\n+                        .map(bLangType -> symResolver.resolveTypeNode(bLangType, typeDefEnv))\n+                        .orElse(symTable.detailType);\n+\n+                ((BErrorType) typeDef.symbol.type).detailType = detailType;\n+            } else if (typeDef.typeNode.type != null && typeDef.typeNode.type.tag == TypeTags.ERROR) {\n+                BType detailType = ((BErrorType) typeDef.typeNode.type).detailType;\n+                if (detailType == symTable.noType) {\n+                    BErrorType type = (BErrorType) symResolver.resolveTypeNode(typeDef.typeNode, pkgEnv);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6888493ed6ac1b2ccce937c1f65d5c9a4cee7fd"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f24262f1c4fe08476c2112b6ad4cf9fedb4c776", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2f24262f1c4fe08476c2112b6ad4cf9fedb4c776", "committedDate": "2020-08-07T05:23:02Z", "message": "Apply review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc0a066300327e97da70cbdb51175bca186382ee", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fc0a066300327e97da70cbdb51175bca186382ee", "committedDate": "2020-08-07T09:16:46Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-error-detail-type-resolving-issue-new-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/997e5414369d240e2f02820a429a98d0d5ee2ddb", "committedDate": "2020-08-07T09:35:06Z", "message": "Fix nullpointer error when creating typeDefEnv"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTgzNDkx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#pullrequestreview-465583491", "createdAt": "2020-08-12T04:30:56Z", "commit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNDozMDo1NlrOG_RaFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNDo1NTozOVrOG_Rxbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk5ODY3OQ==", "bodyText": "Missing a new line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r468998679", "createdAt": "2020-08-12T04:30:56Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/error/distinct_error_test.bal", "diffHunk": "@@ -8,3 +8,31 @@ function testFooError() returns Foo {\n \n     return foo;\n }\n+\n+public type GraphAPIError distinct error<GraphAPIErrorDetails>;\n+public type GraphAPIErrorDetails record {|\n+    string code;\n+    map<anydata> details;\n+|};\n+\n+public function testFunctionCallInDetailArgExpr() {\n+    json codeJson = \"1234\";\n+    map<anydata> details = {};\n+    var x = GraphAPIError(\"Concurrent graph modification\", code = codeJson.toString(), details = details);\n+    assertEquality(x.toString(), \"error Concurrent graph modification code=1234 details=\");\n+}\n+\n+const ASSERTION_ERROR_REASON = \"AssertionError\";\n+\n+function assertEquality(any|error actual, any|error expected) {\n+    if expected is anydata && actual is anydata && expected == actual {\n+        return;\n+    }\n+\n+    if expected === actual {\n+        return;\n+    }\n+\n+    panic error(ASSERTION_ERROR_REASON,\n+                message = \"expected '\" + expected.toString() + \"', found '\" + actual.toString () + \"'\");\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAwMzkyOA==", "bodyText": "Can the detail type here be null like for normal errors (what's handled in L1550-L1552)? If that is the case should we not set symTable.detailType?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r469003928", "createdAt": "2020-08-12T04:52:50Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1542,19 +1542,24 @@ private void addTopLevelNode(BLangPackage pkgNode, TopLevelNode node) {\n \n     private void defineErrorDetails(List<BLangTypeDefinition> typeDefNodes, SymbolEnv pkgEnv) {\n         for (BLangTypeDefinition typeDef : typeDefNodes) {\n-            if (typeDef.typeNode.getKind() != NodeKind.ERROR_TYPE) {\n-                continue;\n+            BLangType typeNode = typeDef.typeNode;\n+            if (typeNode.getKind() == NodeKind.ERROR_TYPE) {\n+                SymbolEnv typeDefEnv = SymbolEnv.createTypeEnv(typeNode, typeDef.symbol.scope, pkgEnv);\n+                BLangErrorType errorTypeNode = (BLangErrorType) typeNode;\n+\n+                BType detailType = Optional.ofNullable(errorTypeNode.detailType)\n+                        .map(bLangType -> symResolver.resolveTypeNode(bLangType, typeDefEnv))\n+                        .orElse(symTable.detailType);\n+\n+                ((BErrorType) typeDef.symbol.type).detailType = detailType;\n+            } else if (typeNode.type != null && typeNode.type.tag == TypeTags.ERROR) {\n+                SymbolEnv typeDefEnv = SymbolEnv.createTypeEnv(typeNode, typeDef.symbol.scope, pkgEnv);\n+                BType detailType = ((BErrorType) typeNode.type).detailType;\n+                if (detailType == symTable.noType) {\n+                    BErrorType type = (BErrorType) symResolver.resolveTypeNode(typeNode, typeDefEnv);\n+                    ((BErrorType) typeDef.symbol.type).detailType = type.detailType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAwNDE0OQ==", "bodyText": "Shall we assert this in b7a itself?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r469004149", "createdAt": "2020-08-12T04:53:51Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/balo/types/ErrorTypeTest.java", "diffHunk": "@@ -106,13 +106,22 @@ public void testPerformInvalidCastWithDistinctErrorType() {\n                 \"{ballerina}TypeCastError {\\\"message\\\":\\\"incompatible types: 'OurProccessingError' cannot be cast to \" +\n                         \"'errors:OrderProcessingError'\\\"}\");\n     }\n+\n+    @Test\n+    public void testErrorDetailDefinedAfterErrorDef() {\n+        BValue[] returns = BRunUtil.invoke(result, \"testErrorDetailDefinedAfterErrorDef\");\n+        Assert.assertEquals(returns[0].stringValue(), \"New error {code:\\\"ABCD\\\"}\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAwNDQwMQ==", "bodyText": "Extra line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r469004401", "createdAt": "2020-08-12T04:54:48Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/balo/test_projects/test_project/src/errors/errors.bal", "diffHunk": "@@ -13,3 +13,12 @@ public type ApplicationError error<ApplicationErrorData>;\n public type OrderCreationError distinct ApplicationError;\n public type OrderProcessingError distinct ApplicationError;\n public type OrderCreationError2 distinct OrderCreationError;\n+\n+public type NewPostDefinedError distinct PostDefinedError;\n+public type PostDefinedError error<ErrorData>;\n+\n+\n+public type ErrorData record {|\n+    string code;\n+|};\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAwNDQzMA==", "bodyText": "Extra line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r469004430", "createdAt": "2020-08-12T04:54:54Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/balo/test_projects/test_project/src/errors/errors.bal", "diffHunk": "@@ -13,3 +13,12 @@ public type ApplicationError error<ApplicationErrorData>;\n public type OrderCreationError distinct ApplicationError;\n public type OrderProcessingError distinct ApplicationError;\n public type OrderCreationError2 distinct OrderCreationError;\n+\n+public type NewPostDefinedError distinct PostDefinedError;\n+public type PostDefinedError error<ErrorData>;\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAwNDY1NQ==", "bodyText": "Instead of using the toString() representation, shall we assert the message, code, and details maps separately?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r469004655", "createdAt": "2020-08-12T04:55:39Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/error/distinct_error_test.bal", "diffHunk": "@@ -8,3 +8,31 @@ function testFooError() returns Foo {\n \n     return foo;\n }\n+\n+public type GraphAPIError distinct error<GraphAPIErrorDetails>;\n+public type GraphAPIErrorDetails record {|\n+    string code;\n+    map<anydata> details;\n+|};\n+\n+public function testFunctionCallInDetailArgExpr() {\n+    json codeJson = \"1234\";\n+    map<anydata> details = {};\n+    var x = GraphAPIError(\"Concurrent graph modification\", code = codeJson.toString(), details = details);\n+    assertEquality(x.toString(), \"error Concurrent graph modification code=1234 details=\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d5d1f1fb31abc869ddf22e4abc9fbc8a61608ad", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9d5d1f1fb31abc869ddf22e4abc9fbc8a61608ad", "committedDate": "2020-08-12T07:03:42Z", "message": "Expand error type assert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd7684ed8e8ac0256ea79faa29c2d0e8d4435009", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fd7684ed8e8ac0256ea79faa29c2d0e8d4435009", "committedDate": "2020-09-11T03:47:23Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-error-detail-type-resolving-issue-new-parser\n\n\u0001 Conflicts:\n\u0001\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8b81f6e19e2f4571afc830656548e58cda121cd", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a8b81f6e19e2f4571afc830656548e58cda121cd", "committedDate": "2020-09-11T04:19:15Z", "message": "Apply review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzkwMzAx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#pullrequestreview-487390301", "createdAt": "2020-09-14T03:14:34Z", "commit": {"oid": "a8b81f6e19e2f4571afc830656548e58cda121cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMzoxNDozNFrOHRCjXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMzoxNDozNFrOHRCjXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYyOTY2Mw==", "bodyText": "Also, is it possible for detail type to be symTable.noType when we get to L1576? Wouldn't we have set symTable.detailType?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#discussion_r487629663", "createdAt": "2020-09-14T03:14:34Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -1542,19 +1542,24 @@ private void addTopLevelNode(BLangPackage pkgNode, TopLevelNode node) {\n \n     private void defineErrorDetails(List<BLangTypeDefinition> typeDefNodes, SymbolEnv pkgEnv) {\n         for (BLangTypeDefinition typeDef : typeDefNodes) {\n-            if (typeDef.typeNode.getKind() != NodeKind.ERROR_TYPE) {\n-                continue;\n+            BLangType typeNode = typeDef.typeNode;\n+            if (typeNode.getKind() == NodeKind.ERROR_TYPE) {\n+                SymbolEnv typeDefEnv = SymbolEnv.createTypeEnv(typeNode, typeDef.symbol.scope, pkgEnv);\n+                BLangErrorType errorTypeNode = (BLangErrorType) typeNode;\n+\n+                BType detailType = Optional.ofNullable(errorTypeNode.detailType)\n+                        .map(bLangType -> symResolver.resolveTypeNode(bLangType, typeDefEnv))\n+                        .orElse(symTable.detailType);\n+\n+                ((BErrorType) typeDef.symbol.type).detailType = detailType;\n+            } else if (typeNode.type != null && typeNode.type.tag == TypeTags.ERROR) {\n+                SymbolEnv typeDefEnv = SymbolEnv.createTypeEnv(typeNode, typeDef.symbol.scope, pkgEnv);\n+                BType detailType = ((BErrorType) typeNode.type).detailType;\n+                if (detailType == symTable.noType) {\n+                    BErrorType type = (BErrorType) symResolver.resolveTypeNode(typeNode, typeDefEnv);\n+                    ((BErrorType) typeDef.symbol.type).detailType = type.detailType;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAwMzkyOA=="}, "originalCommit": {"oid": "997e5414369d240e2f02820a429a98d0d5ee2ddb"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de8685d8eddb93a7ed21d5f10c1a33b8e6bf07c9", "author": {"user": {"login": "rdhananjaya", "name": "Dhananjaya [Danje]"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/de8685d8eddb93a7ed21d5f10c1a33b8e6bf07c9", "committedDate": "2020-09-14T03:45:41Z", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-error-detail-type-resolving-issue-new-parser\n\n\u0001 Conflicts:\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/AbstractParser.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTQyMzY4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24726#pullrequestreview-487542368", "createdAt": "2020-09-14T08:44:48Z", "commit": {"oid": "de8685d8eddb93a7ed21d5f10c1a33b8e6bf07c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3735, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}