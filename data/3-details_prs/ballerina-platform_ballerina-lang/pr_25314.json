{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NDUyMDY4", "number": 25314, "title": "Fix modifySeparatedNodeList", "bodyText": "Purpose\nfix modifySeparatedNodeList returning NodeList instead of SeperatedNodeList when SeperatedNodeList is modified.\nFixes #25273\nApproach\n\nChanged the method to check if input is a separatedNodeList and return accordingly.\n\nSamples\n\nn/a\n\nRemarks\n\nn/a\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-08-18T12:01:23Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314", "merged": true, "mergeCommit": {"oid": "c9badb0335f3ff7cc5a354dafca5ac21f6b450db"}, "closed": true, "closedAt": "2020-08-21T06:10:37Z", "author": {"login": "m36dot"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAFsgBAH2gAyNDY5NDUyMDY4OmI4OWRlOGIyMzhmZDE5NzNjYWRhNzY0ODEwM2JjZmVmMDk3MDEyZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA-j29gFqTQ3MjE3MjA2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b89de8b238fd1973cada7648103bcfef097012eb", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b89de8b238fd1973cada7648103bcfef097012eb", "committedDate": "2020-08-18T11:55:22Z", "message": "Fix modifySeparatedNodeList\n\nfix modifySeparatedNodeList returning NodeList instead of\nSeperatedNodeList when SeperatedNodeList is modified."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMDk5MzM4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#pullrequestreview-470099338", "createdAt": "2020-08-19T03:28:14Z", "commit": {"oid": "b89de8b238fd1973cada7648103bcfef097012eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMzoyODoxNVrOHCvsPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMzozNjowNVrOHCv-PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY0MDU3NA==", "bodyText": "Can we use separate methods for modifying NodeList and SeparatedNodeList?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r472640574", "createdAt": "2020-08-19T03:28:15Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java", "diffHunk": "@@ -3070,14 +3070,23 @@ protected Node transformSyntaxNode(Node node) {\n         }\n \n         boolean nodeModified = false;\n-        STNode[] newSTNodes = new STNode[nodeList.size()];\n+        STNode[] newSTNodes = new STNode[nodeList.internalListNode.size()];\n+\n         for (int index = 0; index < nodeList.size(); index++) {\n             T oldNode = nodeList.get(index);\n             T newNode = modifyNode(oldNode);\n             if (oldNode != newNode) {\n                 nodeModified = true;\n             }\n-            newSTNodes[index] = newNode.internalNode();\n+\n+            if (nodeList instanceof SeparatedNodeList && index < nodeList.size() - 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b89de8b238fd1973cada7648103bcfef097012eb"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY0MjU1NQ==", "bodyText": "Looks like the separator is not modified.\nShall we add a test case to check whether the separator is also modified? e.g: remove all whitespaces", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r472642555", "createdAt": "2020-08-19T03:31:32Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java", "diffHunk": "@@ -3070,14 +3070,23 @@ protected Node transformSyntaxNode(Node node) {\n         }\n \n         boolean nodeModified = false;\n-        STNode[] newSTNodes = new STNode[nodeList.size()];\n+        STNode[] newSTNodes = new STNode[nodeList.internalListNode.size()];\n+\n         for (int index = 0; index < nodeList.size(); index++) {\n             T oldNode = nodeList.get(index);\n             T newNode = modifyNode(oldNode);\n             if (oldNode != newNode) {\n                 nodeModified = true;\n             }\n-            newSTNodes[index] = newNode.internalNode();\n+\n+            if (nodeList instanceof SeparatedNodeList && index < nodeList.size() - 1) {\n+                newSTNodes[2 * index] = newNode.internalNode();\n+                newSTNodes[(2 * index) + 1] = ((SeparatedNodeList<?>) nodeList).getSeparator(index).internalNode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b89de8b238fd1973cada7648103bcfef097012eb"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY0NTE4MQ==", "bodyText": "missing EOF newline", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r472645181", "createdAt": "2020-08-19T03:36:05Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/test/resources/tree/separated_node_list_modify.bal", "diffHunk": "@@ -0,0 +1 @@\n+int a = [a,b,c];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b89de8b238fd1973cada7648103bcfef097012eb"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb4812c58058d2a5c6f5dffa1669b4410987f9c7", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fb4812c58058d2a5c6f5dffa1669b4410987f9c7", "committedDate": "2020-08-19T07:39:01Z", "message": "Refactor Code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ba9261e0b2a9aae7b4831aa9dafd8e3066d8f48", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3ba9261e0b2a9aae7b4831aa9dafd8e3066d8f48", "committedDate": "2020-08-19T08:13:54Z", "message": "Fix CheckstyleTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzM1NzQ0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#pullrequestreview-470335744", "createdAt": "2020-08-19T10:41:43Z", "commit": {"oid": "3ba9261e0b2a9aae7b4831aa9dafd8e3066d8f48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDo0MTo0NFrOHDBm0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDo0NDo1NVrOHDBtXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzNDA5Nw==", "bodyText": "Inverting the condition would simplify the logic i think.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r472934097", "createdAt": "2020-08-19T10:41:44Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-treegen/src/main/resources/external_tree_modifier_template.mustache", "diffHunk": "@@ -69,7 +69,42 @@ public abstract class {{className}} extends {{superClassName}}<Node> {\n     }\n \n     protected <T extends Node> SeparatedNodeList<T> modifySeparatedNodeList(SeparatedNodeList<T> nodeList) {\n-        return modifyGenericNodeList(nodeList, SeparatedNodeList::new);\n+        Function<NonTerminalNode, SeparatedNodeList> nodeListCreator = SeparatedNodeList::new;\n+        if (nodeList.isEmpty()) {\n+            return nodeList;\n+        }\n+\n+        boolean nodeModified = false;\n+        STNode[] newSTNodes = new STNode[nodeList.internalListNode.size()];\n+\n+        for (int index = 0; index < nodeList.size(); index++) {\n+            T oldNode = nodeList.get(index);\n+            T newNode = modifyNode(oldNode);\n+            if (oldNode != newNode) {\n+                nodeModified = true;\n+            }\n+\n+            if (index != nodeList.size() - 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba9261e0b2a9aae7b4831aa9dafd8e3066d8f48"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzNDQ5NA==", "bodyText": "This line is common to both conditions. can take it out.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r472934494", "createdAt": "2020-08-19T10:42:24Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-treegen/src/main/resources/external_tree_modifier_template.mustache", "diffHunk": "@@ -69,7 +69,42 @@ public abstract class {{className}} extends {{superClassName}}<Node> {\n     }\n \n     protected <T extends Node> SeparatedNodeList<T> modifySeparatedNodeList(SeparatedNodeList<T> nodeList) {\n-        return modifyGenericNodeList(nodeList, SeparatedNodeList::new);\n+        Function<NonTerminalNode, SeparatedNodeList> nodeListCreator = SeparatedNodeList::new;\n+        if (nodeList.isEmpty()) {\n+            return nodeList;\n+        }\n+\n+        boolean nodeModified = false;\n+        STNode[] newSTNodes = new STNode[nodeList.internalListNode.size()];\n+\n+        for (int index = 0; index < nodeList.size(); index++) {\n+            T oldNode = nodeList.get(index);\n+            T newNode = modifyNode(oldNode);\n+            if (oldNode != newNode) {\n+                nodeModified = true;\n+            }\n+\n+            if (index != nodeList.size() - 1) {\n+                Token oldSeperator = nodeList.getSeparator(index);\n+                Token newSeperator = modifyToken(oldSeperator);\n+\n+                if (oldSeperator != newSeperator) {\n+                    nodeModified = true;\n+                }\n+\n+                newSTNodes[2 * index] = newNode.internalNode();\n+                newSTNodes[(2 * index) + 1] = newSeperator.internalNode();\n+            } else {\n+                newSTNodes[2 * index] = newNode.internalNode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba9261e0b2a9aae7b4831aa9dafd8e3066d8f48"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzNTc3Mg==", "bodyText": "These two asserts only checks for the counts.\nWe need to assert the content as well, to see whether they were updated correctly or not.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r472935772", "createdAt": "2020-08-19T10:44:55Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/test/java/io/ballerinalang/compiler/parser/test/tree/SyntaxTreeModifierTest.java", "diffHunk": "@@ -109,6 +115,54 @@ public void testBinaryExprModification() {\n         Assert.assertEquals(minusOrSlashCounter.transform(newRoot), new Integer(4));\n     }\n \n+    @Test\n+    public void testSeparatedListNodeNonSeperatorModification() {\n+        SyntaxTree syntaxTree = parseFile(\"separated_node_list_modify_all_nodes.bal\");\n+        ModulePartNode oldRoot = syntaxTree.rootNode();\n+\n+        ModuleVariableDeclarationNode oldModuleVariableDeclarationNode =\n+                (ModuleVariableDeclarationNode) oldRoot.members().get(0);\n+        ListConstructorExpressionNode oldSeperatedlistNode =\n+                (ListConstructorExpressionNode) oldModuleVariableDeclarationNode.initializer();\n+\n+        IdentifierModifier identifierModifier = new IdentifierModifier();\n+        ModulePartNode newRoot = (ModulePartNode) oldRoot.apply(identifierModifier);\n+\n+        ModuleVariableDeclarationNode newModuleVariableDeclarationNode =\n+                (ModuleVariableDeclarationNode) newRoot.members().get(0);\n+        ListConstructorExpressionNode newSeperatedlistNode =\n+                (ListConstructorExpressionNode) newModuleVariableDeclarationNode.initializer();\n+\n+        Assert.assertEquals(oldSeperatedlistNode.expressions().separatorSize(),\n+                newSeperatedlistNode.expressions().separatorSize());\n+        Assert.assertEquals(oldSeperatedlistNode.expressions().size(),\n+                newSeperatedlistNode.expressions().size());\n+    }\n+\n+    @Test\n+    public void testSeparatedListNodeAllNodeModification() {\n+        SyntaxTree syntaxTree = parseFile(\"separated_node_list_modify.bal\");\n+        ModulePartNode oldRoot = syntaxTree.rootNode();\n+\n+        ModuleVariableDeclarationNode oldModuleVariableDeclarationNode =\n+                (ModuleVariableDeclarationNode) oldRoot.members().get(0);\n+        ListConstructorExpressionNode oldSeperatedlistNode =\n+                (ListConstructorExpressionNode) oldModuleVariableDeclarationNode.initializer();\n+\n+        TokenModifier tokenModifier = new TokenModifier();\n+        ModulePartNode newRoot = (ModulePartNode) oldRoot.apply(tokenModifier);\n+\n+        ModuleVariableDeclarationNode newModuleVariableDeclarationNode =\n+                (ModuleVariableDeclarationNode) newRoot.members().get(0);\n+        ListConstructorExpressionNode newSeperatedlistNode =\n+                (ListConstructorExpressionNode) newModuleVariableDeclarationNode.initializer();\n+\n+        Assert.assertEquals(oldSeperatedlistNode.expressions().separatorSize(),\n+                newSeperatedlistNode.expressions().separatorSize());\n+        Assert.assertEquals(oldSeperatedlistNode.expressions().size(),\n+                newSeperatedlistNode.expressions().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba9261e0b2a9aae7b4831aa9dafd8e3066d8f48"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b90f75176dde824497c6a4089361c3aca9ccdc61", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b90f75176dde824497c6a4089361c3aca9ccdc61", "committedDate": "2020-08-19T11:14:28Z", "message": "Refactor Code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "338c8942ddfd0021e42f4dd80bbc986051ef843e", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/338c8942ddfd0021e42f4dd80bbc986051ef843e", "committedDate": "2020-08-19T11:55:31Z", "message": "Refactor Code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff761448cb216b32dc053a7e4fdeed3f668ccbff", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ff761448cb216b32dc053a7e4fdeed3f668ccbff", "committedDate": "2020-08-19T12:14:32Z", "message": "Fix Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc2075ed6b5f58704369e03560e06a5193677494", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cc2075ed6b5f58704369e03560e06a5193677494", "committedDate": "2020-08-20T06:49:37Z", "message": "Fix seperatedNodeList Modify test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efbae4cd5494e1fe4e54fac8f1f8bf385cae8a6e", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/efbae4cd5494e1fe4e54fac8f1f8bf385cae8a6e", "committedDate": "2020-08-20T07:01:13Z", "message": "Remove Unused Imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzMyODg3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#pullrequestreview-471332887", "createdAt": "2020-08-20T07:31:09Z", "commit": {"oid": "efbae4cd5494e1fe4e54fac8f1f8bf385cae8a6e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzozMTowOVrOHDwDqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzozMTowOVrOHDwDqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY5NTE0Nw==", "bodyText": "Shouldn't the WhiteSpaceMinutiaeRemover remove all the whitespaces?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#discussion_r473695147", "createdAt": "2020-08-20T07:31:09Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/test/resources/tree/separated_node_list_modify_all_nodes_assert.bal", "diffHunk": "@@ -0,0 +1 @@\n+inta =[a  ,b  ,c];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efbae4cd5494e1fe4e54fac8f1f8bf385cae8a6e"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "367231e08ed90b262178b99071a38981ec5588ef", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/367231e08ed90b262178b99071a38981ec5588ef", "committedDate": "2020-08-20T08:06:41Z", "message": "Fix removeWhiteSpaceMinutiate to remove all whiteSpaceMinutiae"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e1f36ffb350e3eeee2420a597f663d7148de789", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5e1f36ffb350e3eeee2420a597f663d7148de789", "committedDate": "2020-08-21T04:43:32Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fixbadSadSaif"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMTcyMDY5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25314#pullrequestreview-472172069", "createdAt": "2020-08-21T06:10:31Z", "commit": {"oid": "5e1f36ffb350e3eeee2420a597f663d7148de789"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4880, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}