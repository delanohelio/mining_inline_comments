{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMDczMzEw", "number": 23089, "title": "Add let expression parsing", "bodyText": "Purpose\n\nAdd let expression support\n\nFixes #23056\nApproach\n\nN/A\n\nSamples\n\nN/A\n\nRemarks\n\nN/A\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-05-04T17:07:57Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23089", "merged": true, "mergeCommit": {"oid": "59f74d1a41406da2f42ff08f450abd27cf2d12a4"}, "closed": true, "closedAt": "2020-05-06T13:58:14Z", "author": {"login": "lochana-chathura"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcd62kZgH2gAyNDEzMDczMzEwOjEwNjc2M2FkZTQ2MWI0NGQzNDUxOGE1Yzg5YzliNDRjZmJkMWU1OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcepGPWAFqTQwNjYzODU0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "106763ade461b44d34518a5c89c9b44cfbd1e594", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/106763ade461b44d34518a5c89c9b44cfbd1e594", "committedDate": "2020-05-04T08:03:59Z", "message": "Add let expression support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b3a48b6ed99590a1a8b3016a60ab27b983700ee", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9b3a48b6ed99590a1a8b3016a60ab27b983700ee", "committedDate": "2020-05-04T08:05:18Z", "message": "Add syntax validation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4abb2102ba1411d6184c47178f074c016c3ae88", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d4abb2102ba1411d6184c47178f074c016c3ae88", "committedDate": "2020-05-04T17:03:16Z", "message": "Add error recovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e031d565607bc0c2570dfabaf00f67e8ed047b2e", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e031d565607bc0c2570dfabaf00f67e8ed047b2e", "committedDate": "2020-05-04T17:04:28Z", "message": "Add recovery test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MTgzMjM1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23089#pullrequestreview-405183235", "createdAt": "2020-05-04T17:11:53Z", "commit": {"oid": "e031d565607bc0c2570dfabaf00f67e8ed047b2e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzoxMTo1M1rOGQJ47g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzoxMTo1M1rOGQJ47g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU5MjQzMA==", "bodyText": "With let expression support this assignment-stmt recovery test case recovers as a let expression. So I altered the test case a little.  Is it alright?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23089#discussion_r419592430", "createdAt": "2020-05-04T17:11:53Z", "author": {"login": "lochana-chathura"}, "path": "compiler/ballerina-parser/src/test/resources/statements/assignment-stmt/assignment_stmt_source_12.bal", "diffHunk": "@@ -1,5 +1,5 @@\n function foo() {\n     a =\n-    int b =\n+    b =\n     int a = 6;\n }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e031d565607bc0c2570dfabaf00f67e8ed047b2e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45e8ca8d25e8fde8cdc4e6e62b0b0863007eb038", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/45e8ca8d25e8fde8cdc4e6e62b0b0863007eb038", "committedDate": "2020-05-04T17:16:21Z", "message": "Merge branch 'incremental-parser' of https://github.com/ballerina-platform/ballerina-lang into incremental-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ab98298f752cf6443a6da6501d72f1966b4d315", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9ab98298f752cf6443a6da6501d72f1966b4d315", "committedDate": "2020-05-05T04:35:03Z", "message": "Add generated internal and external nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5256aaf65ed997403ac3998badf38f238215e2cf", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5256aaf65ed997403ac3998badf38f238215e2cf", "committedDate": "2020-05-05T06:48:46Z", "message": "Merge branch 'incremental-parser' of https://github.com/ballerina-platform/ballerina-lang into incremental-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9f8fd3eebea4b7d1aa4da046c9c68b14b70c298", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a9f8fd3eebea4b7d1aa4da046c9c68b14b70c298", "committedDate": "2020-05-06T04:21:05Z", "message": "Merge branch 'incremental-parser' of https://github.com/ballerina-platform/ballerina-lang into incremental-parser\n\n\u0001 Conflicts:\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaLexer.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParserErrorHandler.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/LexerTerminals.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/ParserRuleContext.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/tree/STNodeFactory.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/NodeFactory.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/NodeTransformer.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/NodeVisitor.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/SyntaxKind.java\n\u0001\tcompiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java\n\u0001\tcompiler/ballerina-parser/src/test/java/io/ballerinalang/compiler/parser/test/ParserTestUtils.java\n\u0001\tcompiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1da6919a33f9bf8fd1a530cd0a4f0c862a1ba485", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1da6919a33f9bf8fd1a530cd0a4f0c862a1ba485", "committedDate": "2020-05-06T04:25:16Z", "message": "Regenerate tree after merging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzExMjE1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23089#pullrequestreview-406311215", "createdAt": "2020-05-06T05:26:20Z", "commit": {"oid": "1da6919a33f9bf8fd1a530cd0a4f0c862a1ba485"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNToyNjoyMFrOGREdIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNToyNjoyMFrOGREdIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU1MTk3MA==", "bodyText": "Should we return an empty list here?\nAnd context should be ended.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23089#discussion_r420551970", "createdAt": "2020-05-06T05:26:20Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -7301,4 +7309,102 @@ private STNode parseErrorKeyWord() {\n             return sol.recoveredNode;\n         }\n     }\n+\n+    /**\n+     * Parse let expression.\n+     * <p>\n+     * <code>\n+     * let-expr := let let-var-decl [, let-var-decl]* in expression\n+     * </code>\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseLetExpression() {\n+        STNode letKeyword = parseLetKeyword();\n+        STNode letVarDeclarations = parseLetVarDeclarations();\n+        STNode inKeyword = parseInKeyword();\n+        STNode expression = parseExpression();\n+        return STNodeFactory.createLetExpressionNode(letKeyword, letVarDeclarations, inKeyword, expression);\n+    }\n+\n+    /**\n+     * Parse let-keyword.\n+     *\n+     * @return Let-keyword node\n+     */\n+    private STNode parseLetKeyword() {\n+        STToken token = peek();\n+        if (token.kind == SyntaxKind.LET_KEYWORD) {\n+            return consume();\n+        } else {\n+            Solution sol = recover(token, ParserRuleContext.LET_KEYWORD);\n+            return sol.recoveredNode;\n+        }\n+    }\n+\n+    /**\n+     * Parse let variable declarations.\n+     * <p>\n+     * <code>let-var-decl-list := let-var-decl [, let-var-decl]*</code>\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseLetVarDeclarations() {\n+        startContext(ParserRuleContext.LET_VAR_DECL);\n+        List<STNode> varDecls = new ArrayList<>();\n+        STToken nextToken = peek();\n+\n+        // Make sure at least one let variable declaration is present\n+        if (isEndOfLetVarDeclarations(nextToken.kind)) {\n+            this.errorHandler.reportMissingTokenError(\"missing let variable declaration\");\n+            return STNodeFactory.createMissingToken(SyntaxKind.LET_VAR_DECL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1da6919a33f9bf8fd1a530cd0a4f0c862a1ba485"}, "originalPosition": 88}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1027ae5a110dbb4e18adb88c7ed09f78ea82314", "author": {"user": {"login": "lochana-chathura", "name": null}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e1027ae5a110dbb4e18adb88c7ed09f78ea82314", "committedDate": "2020-05-06T09:52:46Z", "message": "Fix small issue in parseLetVarDeclarations method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NjM4NTQy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23089#pullrequestreview-406638542", "createdAt": "2020-05-06T13:56:44Z", "commit": {"oid": "e1027ae5a110dbb4e18adb88c7ed09f78ea82314"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3378, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}