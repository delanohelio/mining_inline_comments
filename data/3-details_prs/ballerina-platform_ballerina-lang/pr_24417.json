{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MDk5MTU0", "number": 24417, "title": "Fix issues when passing a vararg for non-rest params", "bodyText": "Purpose\n$title.\nFixes #24348 - Invalid type set for the rest arg when the vararg provides for required/defualtable params too\nFixes #24281 - Taint analyzer crashes when passing a rest arg to a function with no rest param\nRemarks\n#24415\n#23307 (comment)\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-06-22T18:06:58Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417", "merged": true, "mergeCommit": {"oid": "0dcd3df7ce4ed6af497a9693df8a245fbf3e2f7e"}, "closed": true, "closedAt": "2020-07-15T15:24:41Z", "author": {"login": "MaryamZi"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctVmCvAH2gAyNDM4MDk5MTU0Ojc5MzYwMWEwMDJmOGQ2OTlmM2EzYzA0NTY5YTgzYWMwNzQyZmM3OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1MTqEAFqTQ0OTA2OTIzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "793601a002f8d699f3a3c04569a83ac0742fc78d", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/793601a002f8d699f3a3c04569a83ac0742fc78d", "committedDate": "2020-06-21T05:42:14Z", "message": "Fix issues when using a vararg to provide for required/defaultable params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c81ebe29187370771bee5591de6baade46fb7c95", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c81ebe29187370771bee5591de6baade46fb7c95", "committedDate": "2020-06-22T16:20:56Z", "message": "Add tests for taint analysis with vararg for non-rest param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c43ca80e9074ecf187ea301d9e662ac37a4e1111", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c43ca80e9074ecf187ea301d9e662ac37a4e1111", "committedDate": "2020-06-22T17:05:19Z", "message": "Add test for vararg for different typed params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f33f2552f5dabd1cca6841d90cc6ec554a342c3d", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f33f2552f5dabd1cca6841d90cc6ec554a342c3d", "committedDate": "2020-06-23T06:49:33Z", "message": "Refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzMyMTAz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#pullrequestreview-448732103", "createdAt": "2020-07-15T08:20:51Z", "commit": {"oid": "f33f2552f5dabd1cca6841d90cc6ec554a342c3d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODoyMDo1MVrOGxzfLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODoyMDo1MVrOGxzfLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg3Njk3NA==", "bodyText": "Shall we add a comment about what's being desugared into what?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r454876974", "createdAt": "2020-07-15T08:20:51Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -5454,21 +5454,72 @@ private void reorderArguments(BLangInvocation iExpr) {\n             stmtExpression.type = firstNonRestArg.type;\n             iExpr.requiredArgs.add(0, stmtExpression);\n \n-            // The original value passed as the vararg has to now be sliced to pass only the args for the rest param,\n-            // if there is a rest param.\n+            // If there's no rest param, the vararg only provided for required/defaultable params.\n             if (invokableSymbol.restParam == null) {\n+                restArgs.remove(0);\n                 return;\n             }\n \n+            // If there is a rest param, the vararg could provide for the rest param too.\n+            // Create a new array with just the members of the original vararg specified for the rest param.\n+            BLangRestArgsExpression restArgsExpression = (BLangRestArgsExpression) restArgs.remove(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33f2552f5dabd1cca6841d90cc6ec554a342c3d"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abfee195c6464213d1a54a68b4f1a387fd40b746", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/abfee195c6464213d1a54a68b4f1a387fd40b746", "committedDate": "2020-07-15T10:31:14Z", "message": "Address review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bcccde548d7c12f568dd41818bd2e10762ad254", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8bcccde548d7c12f568dd41818bd2e10762ad254", "committedDate": "2020-07-15T10:31:27Z", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into fix-vararg-as-non-rest-param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe", "author": {"user": {"login": "MaryamZi", "name": "Maryam Ziyad"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/579416ae8c78cf098770eb09387b214f12325cfe", "committedDate": "2020-07-15T11:47:04Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDU0NzEy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#pullrequestreview-449054712", "createdAt": "2020-07-15T15:07:51Z", "commit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDY2ODk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#pullrequestreview-449066894", "createdAt": "2020-07-15T15:21:42Z", "commit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNToyMTo0M1rOGyDT9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNToyMTo0M1rOGyDT9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNjI0Nw==", "bodyText": "Is this indentation correct here? I think we can change this latter", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455136247", "createdAt": "2020-07-15T15:21:43Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TaintAnalyzer.java", "diffHunk": "@@ -2445,6 +2473,28 @@ private void analyzeInvocation(BLangInvocation invocationExpr) {\n         getCurrentAnalysisState().taintedStatus = returnTaintedStatus;\n     }\n \n+    private boolean restoreTableIfIgnored(BInvokableSymbol invokableSymbol, Map<Integer, TaintRecord> origTaintTable,\n+     TaintedStatus argumentTaintReturnValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe"}, "originalPosition": 134}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDY4NjY0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#pullrequestreview-449068664", "createdAt": "2020-07-15T15:23:42Z", "commit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNToyMzo0MlrOGyDaMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNToyMzo0MlrOGyDaMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNzg0MQ==", "bodyText": "Do we need this param returnTaintedStatus", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455137841", "createdAt": "2020-07-15T15:23:42Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TaintAnalyzer.java", "diffHunk": "@@ -2445,6 +2473,28 @@ private void analyzeInvocation(BLangInvocation invocationExpr) {\n         getCurrentAnalysisState().taintedStatus = returnTaintedStatus;\n     }\n \n+    private boolean restoreTableIfIgnored(BInvokableSymbol invokableSymbol, Map<Integer, TaintRecord> origTaintTable,\n+     TaintedStatus argumentTaintReturnValue) {\n+        if (argumentTaintReturnValue != TaintedStatus.IGNORED) {\n+            return false;\n+        }\n+        invokableSymbol.taintTable = origTaintTable; // restore taint table.\n+        return true;\n+    }\n+\n+    private TaintedStatus updateAndGetTaintedStatus(BLangInvocation invocationExpr, TaintedStatus returnTaintedStatus,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe"}, "originalPosition": 142}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDY5MjM3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#pullrequestreview-449069237", "createdAt": "2020-07-15T15:24:24Z", "commit": {"oid": "579416ae8c78cf098770eb09387b214f12325cfe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4213, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}