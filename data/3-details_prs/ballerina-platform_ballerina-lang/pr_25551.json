{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3Mjk1OTQ0", "number": 25551, "title": "Add 'const' support for specifying array length", "bodyText": "Purpose\n\nWhen providing the length of an array as a numeric reference (int or const) the original value was not being recognized leading to spec deviations in the following scenarios:\n\nScenario 1\n   const len = 5;\n\npublic function main() {\n    int[len] intArr = [1, 2, 3, 4, 5, 6];\n}\n\nExpected: size mismatch error\nGiven: no error\nScenario 2\n   int len = 5;\n\npublic function main() {\n    int[len] intArr = [1, 2, 3, 4, 5, 6];\n}\n\nExpected: error on invalid size reference type\nGiven: no error\nScenario 3\n   const len = \"5\";\n\npublic function main() {\n    int[len] intArr = [1, 2, 3, 4, 5,6];\n}\n\n\nExpected: error on const array size reference data type\nGiven: no error\nScenario 4\npublic function main() {\n    int[len] intArr = [1, 2, 3, 4, 5,6];\n}\n\nExpected: error on undefined size reference\nGiven: no error\nThese spec deviations are fixed in this pull request.\nFixes #13162\nApproach\n\nPreserving the reference in a 'BLangExpression' array that is used to store the array length.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-01T19:48:43Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551", "merged": true, "mergeCommit": {"oid": "4c7d43833cd2df4895cf67ab5aed5b7854b9706e"}, "closed": true, "closedAt": "2020-09-16T06:25:58Z", "author": {"login": "suleka96"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdErnOvAH2gAyNDc3Mjk1OTQ0OjZlYzdmZDJhYmViNzQ3YTNhY2U2OWNhZDQ1ZWI4ZGE1NGE4N2VkOGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJWWfjAFqTQ4OTMwODUwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ec7fd2abeb747a3ace69cad45eb8da54a87ed8c", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6ec7fd2abeb747a3ace69cad45eb8da54a87ed8c", "committedDate": "2020-09-01T18:21:42Z", "message": "Add diagnostic codes for errors."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dce3daf4f9ea553ef657f0f5f6b773c9d9bed31", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2dce3daf4f9ea553ef657f0f5f6b773c9d9bed31", "committedDate": "2020-09-01T18:31:43Z", "message": "Change int array in BLangArrayType to BLangExpression array."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb2058d7d9eba6cbc88e640a9b70999eb3d1ed1", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8eb2058d7d9eba6cbc88e640a9b70999eb3d1ed1", "committedDate": "2020-09-01T18:58:39Z", "message": "Update BLangNodeTransformer to preserve const expression."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa3e700a348f43785763ce40e6b566bab8e5789", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4fa3e700a348f43785763ce40e6b566bab8e5789", "committedDate": "2020-09-01T19:35:55Z", "message": "Update SymbolResolver to resolve const expression."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86f189e70d04eb008c4524fc5758f40f2e50a7a8", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/86f189e70d04eb008c4524fc5758f40f2e50a7a8", "committedDate": "2020-09-01T19:41:14Z", "message": "Add error messages in compiler properties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7bd0f713b073134cbe5c8d3d3220eeb01eccfb53", "committedDate": "2020-09-01T20:29:42Z", "message": "Fix CheckStyles issues."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNDgzMjg1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#pullrequestreview-480483285", "createdAt": "2020-09-02T04:56:39Z", "commit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNDo1NjozOVrOHLYIWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNjoxOTozNVrOHLdMgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTY5MTczNg==", "bodyText": "Shall we remove this extra line?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481691736", "createdAt": "2020-09-02T04:56:39Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/tree/types/ArrayTypeNode.java", "diffHunk": "@@ -17,6 +17,9 @@\n */\n package org.ballerinalang.model.tree.types;\n \n+import org.wso2.ballerinalang.compiler.tree.expressions.BLangExpression;\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTY5ODQ5MQ==", "bodyText": "Can't we remove the stream and just do\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    arrayTypeNode.sizes = sizes.stream().toArray(BLangExpression[]::new);\n          \n          \n            \n                    arrayTypeNode.sizes = sizes.toArray(new BLangExpression[0]);\n          \n      \n    \n    \n  \n\nWe try to avoid streams due to performance impacts.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481698491", "createdAt": "2020-09-02T05:03:23Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -3071,7 +3071,7 @@ public BLangNode transform(ArrayTypeDescriptorNode arrayTypeDescriptorNode) {\n         arrayTypeNode.pos = position;\n         arrayTypeNode.elemtype = createTypeNode(arrayTypeDescriptorNode.memberTypeDesc());\n         arrayTypeNode.dimensions = dimensions;\n-        arrayTypeNode.sizes = sizes.stream().mapToInt(val -> val).toArray();\n+        arrayTypeNode.sizes = sizes.stream().toArray(BLangExpression[]::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcwMTgxOQ==", "bodyText": "Extra line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481701819", "createdAt": "2020-09-02T05:06:43Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -116,10 +117,11 @@\n import java.util.stream.Collectors;\n import java.util.stream.Stream;\n \n-import static java.lang.String.format;\n import static org.wso2.ballerinalang.compiler.semantics.model.Scope.NOT_FOUND_ENTRY;\n import static org.wso2.ballerinalang.compiler.util.Constants.OPEN_SEALED_ARRAY_INDICATOR;\n import static org.wso2.ballerinalang.compiler.util.Constants.UNSEALED_ARRAY_INDICATOR;\n+import static java.lang.String.format;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcyMDc5OA==", "bodyText": "This logic is repeated for the valid scenarios, right? I think we can avoid repeating this by returning if there is an error, and then moving this out of the if-else blocks as it was originally.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481720798", "createdAt": "2020-09-02T05:26:28Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTczMDMxMA==", "bodyText": "Shall we check by node kind instead of using the instanceof check?\nI believe in this case we'll have to check for NUMERIC_LITERAL.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (size instanceof BLangLiteral) {\n          \n          \n            \n                            if (size.getKind() == NodeKind.NUMERIC_LITERAL) {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481730310", "createdAt": "2020-09-02T05:36:18Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size instanceof BLangLiteral) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTczMjQ2Mg==", "bodyText": "Shall we extract (Integer) (((BLangLiteral) size).getValue() out to a variable since we seem to be using it multiple times.\nWill also improve readability, IMO.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481732462", "createdAt": "2020-09-02T05:38:34Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size instanceof BLangLiteral) {\n+                    arrType = ((Integer) (((BLangLiteral) size).getValue()) == UNSEALED_ARRAY_INDICATOR) ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTczNzc1Mw==", "bodyText": "We can check == here. With the early returns on error as suggested previously, by swapping the conditions we can remove the else blocks.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (!(symTable.notFoundSymbol.equals(sizeSymbol))) {\n          \n          \n            \n                                if (symTable.notFoundSymbol == sizeSymbol) {\n          \n          \n            \n                                    // log error, set resultType and return\n          \n          \n            \n                                }\n          \n          \n            \n                                \n          \n          \n            \n                                if (sizeSymbol.tag != SymTag.CONSTANT) {\n          \n          \n            \n                                    // log error, set resultType and return\n          \n          \n            \n                                }\n          \n          \n            \n                                \n          \n          \n            \n                                BType lengthLiteralType = ((BConstantSymbol) sizeSymbol).literalType;\n          \n          \n            \n                                if (lengthLiteralType.tag != TypeTags.INT) {\n          \n          \n            \n                                    // log error, set resultType and return\n          \n          \n            \n                                }\n          \n          \n            \n                                \n          \n          \n            \n                                // actual length logic", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481737753", "createdAt": "2020-09-02T05:43:44Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size instanceof BLangLiteral) {\n+                    arrType = ((Integer) (((BLangLiteral) size).getValue()) == UNSEALED_ARRAY_INDICATOR) ?\n+                            new BArrayType(resultType, arrayTypeSymbol,\n+                                    (Integer) (((BLangLiteral) size).getValue()),\n+                                    BArrayState.UNSEALED) :\n+                            ((Integer) (((BLangLiteral) size).getValue()) == OPEN_SEALED_ARRAY_INDICATOR) ?\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.OPEN_SEALED) :\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.CLOSED_SEALED);\n+                    arrayTypeSymbol.type = arrType;\n+                    markParameterizedType(arrType, arrType.eType);\n+                    resultType = arrayTypeSymbol.type;\n \n-            markParameterizedType(arrType, arrType.eType);\n+                } else {\n+                    Name pkgAlias = names.fromIdNode(((BLangSimpleVarRef) size).pkgAlias);\n+                    Name typeName = names.fromIdNode(((BLangSimpleVarRef) size).variableName);\n+\n+                    BSymbol sizeSymbol = lookupMainSpaceSymbolInPackage(size.pos, env, pkgAlias, typeName);\n+\n+                    if (!(symTable.notFoundSymbol.equals(sizeSymbol))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTczODQzNQ==", "bodyText": "Shall we extract (BLangSimpleVarRef) size also to a variable?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481738435", "createdAt": "2020-09-02T05:44:26Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size instanceof BLangLiteral) {\n+                    arrType = ((Integer) (((BLangLiteral) size).getValue()) == UNSEALED_ARRAY_INDICATOR) ?\n+                            new BArrayType(resultType, arrayTypeSymbol,\n+                                    (Integer) (((BLangLiteral) size).getValue()),\n+                                    BArrayState.UNSEALED) :\n+                            ((Integer) (((BLangLiteral) size).getValue()) == OPEN_SEALED_ARRAY_INDICATOR) ?\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.OPEN_SEALED) :\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.CLOSED_SEALED);\n+                    arrayTypeSymbol.type = arrType;\n+                    markParameterizedType(arrType, arrType.eType);\n+                    resultType = arrayTypeSymbol.type;\n \n-            markParameterizedType(arrType, arrType.eType);\n+                } else {\n+                    Name pkgAlias = names.fromIdNode(((BLangSimpleVarRef) size).pkgAlias);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc2ODA3MQ==", "bodyText": "I think we can reuse existing error messages for these errors. For example here we can say\nincompatible types: expected 'int', found 'T' where T is the actual type.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481768071", "createdAt": "2020-09-02T06:13:19Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size instanceof BLangLiteral) {\n+                    arrType = ((Integer) (((BLangLiteral) size).getValue()) == UNSEALED_ARRAY_INDICATOR) ?\n+                            new BArrayType(resultType, arrayTypeSymbol,\n+                                    (Integer) (((BLangLiteral) size).getValue()),\n+                                    BArrayState.UNSEALED) :\n+                            ((Integer) (((BLangLiteral) size).getValue()) == OPEN_SEALED_ARRAY_INDICATOR) ?\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.OPEN_SEALED) :\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.CLOSED_SEALED);\n+                    arrayTypeSymbol.type = arrType;\n+                    markParameterizedType(arrType, arrType.eType);\n+                    resultType = arrayTypeSymbol.type;\n \n-            markParameterizedType(arrType, arrType.eType);\n+                } else {\n+                    Name pkgAlias = names.fromIdNode(((BLangSimpleVarRef) size).pkgAlias);\n+                    Name typeName = names.fromIdNode(((BLangSimpleVarRef) size).variableName);\n+\n+                    BSymbol sizeSymbol = lookupMainSpaceSymbolInPackage(size.pos, env, pkgAlias, typeName);\n+\n+                    if (!(symTable.notFoundSymbol.equals(sizeSymbol))) {\n+                        if (sizeSymbol.tag == SymTag.CONSTANT) {\n+                            BType lengthLiteralType = ((BConstantSymbol) sizeSymbol).literalType;\n+                            if (lengthLiteralType.tag == TypeTags.INT) {\n+                                long length = (long) ((BConstantSymbol) sizeSymbol).value.value;\n+                                arrType = new BArrayType(resultType, arrayTypeSymbol,\n+                                        (int) length,\n+                                        BArrayState.CLOSED_SEALED);\n+                                arrayTypeSymbol.type = arrType;\n+                                markParameterizedType(arrType, arrType.eType);\n+                                resultType = arrayTypeSymbol.type;\n+\n+                            } else {\n+                                dlog.error(arrayTypeNode.pos,\n+                                        DiagnosticCode.INVALID_ARRAY_SIZE_REFERENCE_TYPE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc3Mzg2Mg==", "bodyText": "Here, IMO, we can use the undefined symbol error.\nundefined symbol 'x'", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481773862", "createdAt": "2020-09-02T06:18:47Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -905,17 +907,61 @@ public void visit(BLangArrayType arrayTypeNode) {\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n+                arrayTypeSymbol.type = arrType;\n+                markParameterizedType(arrType, arrType.eType);\n+                resultType = arrayTypeSymbol.type;\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size instanceof BLangLiteral) {\n+                    arrType = ((Integer) (((BLangLiteral) size).getValue()) == UNSEALED_ARRAY_INDICATOR) ?\n+                            new BArrayType(resultType, arrayTypeSymbol,\n+                                    (Integer) (((BLangLiteral) size).getValue()),\n+                                    BArrayState.UNSEALED) :\n+                            ((Integer) (((BLangLiteral) size).getValue()) == OPEN_SEALED_ARRAY_INDICATOR) ?\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.OPEN_SEALED) :\n+                                    new BArrayType(resultType, arrayTypeSymbol,\n+                                            (Integer) (((BLangLiteral) size).getValue()),\n+                                            BArrayState.CLOSED_SEALED);\n+                    arrayTypeSymbol.type = arrType;\n+                    markParameterizedType(arrType, arrType.eType);\n+                    resultType = arrayTypeSymbol.type;\n \n-            markParameterizedType(arrType, arrType.eType);\n+                } else {\n+                    Name pkgAlias = names.fromIdNode(((BLangSimpleVarRef) size).pkgAlias);\n+                    Name typeName = names.fromIdNode(((BLangSimpleVarRef) size).variableName);\n+\n+                    BSymbol sizeSymbol = lookupMainSpaceSymbolInPackage(size.pos, env, pkgAlias, typeName);\n+\n+                    if (!(symTable.notFoundSymbol.equals(sizeSymbol))) {\n+                        if (sizeSymbol.tag == SymTag.CONSTANT) {\n+                            BType lengthLiteralType = ((BConstantSymbol) sizeSymbol).literalType;\n+                            if (lengthLiteralType.tag == TypeTags.INT) {\n+                                long length = (long) ((BConstantSymbol) sizeSymbol).value.value;\n+                                arrType = new BArrayType(resultType, arrayTypeSymbol,\n+                                        (int) length,\n+                                        BArrayState.CLOSED_SEALED);\n+                                arrayTypeSymbol.type = arrType;\n+                                markParameterizedType(arrType, arrType.eType);\n+                                resultType = arrayTypeSymbol.type;\n+\n+                            } else {\n+                                dlog.error(arrayTypeNode.pos,\n+                                        DiagnosticCode.INVALID_ARRAY_SIZE_REFERENCE_TYPE,\n+                                        ((BConstantSymbol) sizeSymbol).literalType);\n+                                resultType = symTable.semanticError;\n+                            }\n+                        } else {\n+                            dlog.error(arrayTypeNode.pos, DiagnosticCode.INVALID_ARRAY_SIZE_REFERENCE, sizeSymbol);\n+                            resultType = symTable.semanticError;\n+                        }\n+                    } else {\n+                        dlog.error(arrayTypeNode.pos, DiagnosticCode.ARRAY_SIZE_REFERENCE_NOT_DEFINED, size);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc3NDExNA==", "bodyText": "Let's use node kind.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481774114", "createdAt": "2020-09-02T06:19:01Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/types/BLangArrayType.java", "diffHunk": "@@ -62,10 +65,14 @@ public String toString() {\n         final StringBuilder[] sb = {new StringBuilder(getTypeName())};\n         if (sizes.length == 0) {\n             Arrays.stream(sizes).forEach(size -> {\n-                if (size == -1) {\n-                    sb[0].append(\"[]\");\n+                if (size instanceof BLangLiteral) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc3NDcyMg==", "bodyText": "Let's extract (Integer) (((BLangLiteral) size).getValue() out to a variable.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r481774722", "createdAt": "2020-09-02T06:19:35Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/types/BLangArrayType.java", "diffHunk": "@@ -62,10 +65,14 @@ public String toString() {\n         final StringBuilder[] sb = {new StringBuilder(getTypeName())};\n         if (sizes.length == 0) {\n             Arrays.stream(sizes).forEach(size -> {\n-                if (size == -1) {\n-                    sb[0].append(\"[]\");\n+                if (size instanceof BLangLiteral) {\n+                    if ((Integer) (((BLangLiteral) size).getValue()) == -1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd0f713b073134cbe5c8d3d3220eeb01eccfb53"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db809ef9d96e73d43753b6bff9327f278ad213f9", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/db809ef9d96e73d43753b6bff9327f278ad213f9", "committedDate": "2020-09-02T22:53:10Z", "message": "Refactor all files."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868f928ef7f45a099ad40f6f318edf2056883bcb", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/868f928ef7f45a099ad40f6f318edf2056883bcb", "committedDate": "2020-09-02T23:36:35Z", "message": "Add back instance of instead of node type."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDc3MzE4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#pullrequestreview-481477318", "createdAt": "2020-09-03T04:06:41Z", "commit": {"oid": "868f928ef7f45a099ad40f6f318edf2056883bcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNDowNjo0MVrOHMVHAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNDowNjo0MVrOHMVHAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY5MDgxNw==", "bodyText": "Let's make this more detailed.\nFor example, something like\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              invalid array size reference ''{0}''\n          \n          \n            \n              invalid reference expression ''{0}'' as array size: expected a constant reference expression", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r482690817", "createdAt": "2020-09-03T04:06:41Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1044,6 +1044,9 @@ error.mismatching.array.literal.values=\\\n error.index.out.of.range=\\\n   index out of range: index: ''{0}''\n \n+error.invalid.array.size.reference=\\\n+  invalid array size reference ''{0}''", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "868f928ef7f45a099ad40f6f318edf2056883bcb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f27adc652ca641f494db48aa4fb05ac2c58e0b4d", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f27adc652ca641f494db48aa4fb05ac2c58e0b4d", "committedDate": "2020-09-03T07:13:42Z", "message": "Fix CheckStyle issues and refactor array size logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c93857f69d50f63d8b1903c0c0b5d0d5aec5f9c6", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c93857f69d50f63d8b1903c0c0b5d0d5aec5f9c6", "committedDate": "2020-09-03T07:26:35Z", "message": "Change import order of java.lang.String.format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51ef246ac21ef24b9a163a04c4cc5c6461ef4e25", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51ef246ac21ef24b9a163a04c4cc5c6461ef4e25", "committedDate": "2020-09-07T15:39:39Z", "message": "Add array size tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc547dfce6b54d93982db2985f417d468a311176", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bc547dfce6b54d93982db2985f417d468a311176", "committedDate": "2020-09-07T16:15:04Z", "message": "Update const array size reference test in sealed array tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3649abb055a0c64c0b6e9432fed9e5d1b1cb36a1", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3649abb055a0c64c0b6e9432fed9e5d1b1cb36a1", "committedDate": "2020-09-08T05:30:36Z", "message": "Fix bad sad error in constant size reference array in module scope."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4539e93841ec3277611ceb4984f611eeb51cddb4", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4539e93841ec3277611ceb4984f611eeb51cddb4", "committedDate": "2020-09-08T06:04:50Z", "message": "Fix CheckStyle issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dd5c86862a5cba13b9ae5d82c3605f0883f3b43a", "committedDate": "2020-09-08T06:35:42Z", "message": "Remove unused imports."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDI1NTU4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#pullrequestreview-485025558", "createdAt": "2020-09-09T13:46:44Z", "commit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "state": "COMMENTED", "comments": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMzo0Njo0NFrOHPIKqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo0ODozMVrOHPLGIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyNDQ4OA==", "bodyText": "Let's leave one new line after the imports.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485624488", "createdAt": "2020-09-09T13:46:44Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/tree/types/ArrayTypeNode.java", "diffHunk": "@@ -17,6 +17,7 @@\n */\n package org.ballerinalang.model.tree.types;\n \n+import org.wso2.ballerinalang.compiler.tree.expressions.BLangExpression;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyNTM0NA==", "bodyText": "One new line after the set of imports should be enough.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485625344", "createdAt": "2020-09-09T13:47:49Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -58,9 +61,11 @@\n import java.util.regex.Pattern;\n \n import static org.wso2.ballerinalang.compiler.parser.BLangPackageBuilder.escapeQuotedIdentifier;\n+import static org.wso2.ballerinalang.compiler.util.Constants.INFERRED_ARRAY_INDICATOR;\n+import static org.wso2.ballerinalang.compiler.util.Constants.OPEN_ARRAY_INDICATOR;\n import static org.wso2.ballerinalang.compiler.util.Constants.OPEN_SEALED_ARRAY;\n-import static org.wso2.ballerinalang.compiler.util.Constants.OPEN_SEALED_ARRAY_INDICATOR;\n-import static org.wso2.ballerinalang.compiler.util.Constants.UNSEALED_ARRAY_INDICATOR;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzNTc1MA==", "bodyText": "Creating these expressions and setting them is usually delegated off to the package builder. Also doesn't feel quite right for the parser listener to know of the symbol table.\nSince the antlr parser will be removed soon, shall we just pass an empty list in L858 and disable the tests on the old parser, instead of introducing these changes?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485635750", "createdAt": "2020-09-09T14:01:11Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -828,18 +834,18 @@ public void exitArrayTypeNameLabel(BallerinaParser.ArrayTypeNameLabelContext ctx\n \n         int index = 1;\n         int dimensions = 0;\n-        List<Integer> sizes = new ArrayList<>();\n+        List<BLangExpression> sizes = new ArrayList<>();\n         List<ParseTree> children = ctx.children;\n         while (index < children.size()) {\n             if (children.get(index).getText().equals(\"[\")) {\n                 if (children.get(index + 1).getText().equals(\"]\")) {\n-                    sizes.add(UNSEALED_ARRAY_INDICATOR);\n+                    sizes.add(new BLangLiteral(Integer.valueOf(OPEN_ARRAY_INDICATOR), symTable.intType));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzNzYyMQ==", "bodyText": "Leave a new line after the imports. Please check and fix everywhere.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485637621", "createdAt": "2020-09-09T14:03:45Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -118,9 +119,8 @@\n \n import static java.lang.String.format;\n import static org.wso2.ballerinalang.compiler.semantics.model.Scope.NOT_FOUND_ENTRY;\n-import static org.wso2.ballerinalang.compiler.util.Constants.OPEN_SEALED_ARRAY_INDICATOR;\n-import static org.wso2.ballerinalang.compiler.util.Constants.UNSEALED_ARRAY_INDICATOR;\n-\n+import static org.wso2.ballerinalang.compiler.util.Constants.INFERRED_ARRAY_INDICATOR;\n+import static org.wso2.ballerinalang.compiler.util.Constants.OPEN_ARRAY_INDICATOR;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1NzM5Ng==", "bodyText": "Since it is only the array state that changes, IMO we can improve readability here by doing something like\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n          \n          \n            \n                                    arrType = new BArrayType(resultType,\n          \n          \n            \n                                            arrayTypeSymbol,\n          \n          \n            \n                                            sizeIndicator,\n          \n          \n            \n                                            BArrayState.UNSEALED);\n          \n          \n            \n                                } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n          \n          \n            \n                                    arrType = new BArrayType(resultType,\n          \n          \n            \n                                            arrayTypeSymbol,\n          \n          \n            \n                                            sizeIndicator,\n          \n          \n            \n                                            BArrayState.OPEN_SEALED);\n          \n          \n            \n                                } else {\n          \n          \n            \n                                    arrType =  new BArrayType(resultType,\n          \n          \n            \n                                            arrayTypeSymbol,\n          \n          \n            \n                                            sizeIndicator,\n          \n          \n            \n                                            BArrayState.CLOSED_SEALED);\n          \n          \n            \n                                }\n          \n          \n            \n                                BArrayState arrayState;\n          \n          \n            \n                                if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n          \n          \n            \n                                    arrayState = BArrayState.UNSEALED;\n          \n          \n            \n                                } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n          \n          \n            \n                                    arrayState = BArrayState.OPEN_SEALED;\n          \n          \n            \n                                } else {\n          \n          \n            \n                                    arrayState = BArrayState.CLOSED_SEALED;\n          \n          \n            \n                                }\n          \n          \n            \n                                arrType =  new BArrayType(resultType, arrayTypeSymbol,  sizeIndicator, arrayState);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485657396", "createdAt": "2020-09-09T14:29:06Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -899,24 +899,79 @@ public void visit(BLangArrayType arrayTypeNode) {\n         if (resultType == symTable.noType) {\n             return;\n         }\n+        boolean isError = false;\n         for (int i = 0; i < arrayTypeNode.dimensions; i++) {\n             BTypeSymbol arrayTypeSymbol = Symbols.createTypeSymbol(SymTag.ARRAY_TYPE, Flags.PUBLIC, Names.EMPTY,\n                                                                    env.enclPkg.symbol.pkgID, null, env.scope.owner);\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size.getKind() == NodeKind.LITERAL || size.getKind() == NodeKind.NUMERIC_LITERAL) {\n+                    Integer sizeIndicator = (Integer) (((BLangLiteral) size).getValue());\n+\n+                    if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n+                        arrType = new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.UNSEALED);\n+                    } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n+                        arrType = new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.OPEN_SEALED);\n+                    } else {\n+                        arrType =  new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.CLOSED_SEALED);\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1ODQxMw==", "bodyText": "Shall we reformat this to have whatever possible in a single line?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485658413", "createdAt": "2020-09-09T14:30:21Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -899,24 +899,79 @@ public void visit(BLangArrayType arrayTypeNode) {\n         if (resultType == symTable.noType) {\n             return;\n         }\n+        boolean isError = false;\n         for (int i = 0; i < arrayTypeNode.dimensions; i++) {\n             BTypeSymbol arrayTypeSymbol = Symbols.createTypeSymbol(SymTag.ARRAY_TYPE, Flags.PUBLIC, Names.EMPTY,\n                                                                    env.enclPkg.symbol.pkgID, null, env.scope.owner);\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size.getKind() == NodeKind.LITERAL || size.getKind() == NodeKind.NUMERIC_LITERAL) {\n+                    Integer sizeIndicator = (Integer) (((BLangLiteral) size).getValue());\n+\n+                    if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n+                        arrType = new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.UNSEALED);\n+                    } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n+                        arrType = new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.OPEN_SEALED);\n+                    } else {\n+                        arrType =  new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.CLOSED_SEALED);\n+                    }\n+                } else {\n+                    BLangSimpleVarRef sizeReference = (BLangSimpleVarRef) size;\n+                    Name pkgAlias = names.fromIdNode(sizeReference.pkgAlias);\n+                    Name typeName = names.fromIdNode(sizeReference.variableName);\n+\n+                    BSymbol sizeSymbol = lookupMainSpaceSymbolInPackage(size.pos, env, pkgAlias, typeName);\n+\n+                    if (symTable.notFoundSymbol == sizeSymbol) {\n+                        dlog.error(arrayTypeNode.pos, DiagnosticCode.UNDEFINED_SYMBOL, size);\n+                        isError = true;\n+                        continue;\n+                    }\n+\n+                    if (sizeSymbol.tag != SymTag.CONSTANT) {\n+                        dlog.error(size.pos, DiagnosticCode.INVALID_ARRAY_SIZE_REFERENCE, sizeSymbol);\n+                        isError = true;\n+                        continue;\n+                    }\n+\n+                    BConstantSymbol sizeConstSymbol = (BConstantSymbol) sizeSymbol;\n+                    BType lengthLiteralType = sizeConstSymbol.literalType;\n+\n+                    if (lengthLiteralType.tag != TypeTags.INT) {\n+                        dlog.error(size.pos,\n+                                DiagnosticCode.INCOMPATIBLE_TYPES,\n+                                symTable.intType,\n+                                sizeConstSymbol.literalType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1ODU3Mw==", "bodyText": "Please check other places too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485658573", "createdAt": "2020-09-09T14:30:34Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -899,24 +899,79 @@ public void visit(BLangArrayType arrayTypeNode) {\n         if (resultType == symTable.noType) {\n             return;\n         }\n+        boolean isError = false;\n         for (int i = 0; i < arrayTypeNode.dimensions; i++) {\n             BTypeSymbol arrayTypeSymbol = Symbols.createTypeSymbol(SymTag.ARRAY_TYPE, Flags.PUBLIC, Names.EMPTY,\n                                                                    env.enclPkg.symbol.pkgID, null, env.scope.owner);\n             BArrayType arrType;\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size.getKind() == NodeKind.LITERAL || size.getKind() == NodeKind.NUMERIC_LITERAL) {\n+                    Integer sizeIndicator = (Integer) (((BLangLiteral) size).getValue());\n+\n+                    if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n+                        arrType = new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.UNSEALED);\n+                    } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n+                        arrType = new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.OPEN_SEALED);\n+                    } else {\n+                        arrType =  new BArrayType(resultType,\n+                                arrayTypeSymbol,\n+                                sizeIndicator,\n+                                BArrayState.CLOSED_SEALED);\n+                    }\n+                } else {\n+                    BLangSimpleVarRef sizeReference = (BLangSimpleVarRef) size;\n+                    Name pkgAlias = names.fromIdNode(sizeReference.pkgAlias);\n+                    Name typeName = names.fromIdNode(sizeReference.variableName);\n+\n+                    BSymbol sizeSymbol = lookupMainSpaceSymbolInPackage(size.pos, env, pkgAlias, typeName);\n+\n+                    if (symTable.notFoundSymbol == sizeSymbol) {\n+                        dlog.error(arrayTypeNode.pos, DiagnosticCode.UNDEFINED_SYMBOL, size);\n+                        isError = true;\n+                        continue;\n+                    }\n+\n+                    if (sizeSymbol.tag != SymTag.CONSTANT) {\n+                        dlog.error(size.pos, DiagnosticCode.INVALID_ARRAY_SIZE_REFERENCE, sizeSymbol);\n+                        isError = true;\n+                        continue;\n+                    }\n+\n+                    BConstantSymbol sizeConstSymbol = (BConstantSymbol) sizeSymbol;\n+                    BType lengthLiteralType = sizeConstSymbol.literalType;\n+\n+                    if (lengthLiteralType.tag != TypeTags.INT) {\n+                        dlog.error(size.pos,\n+                                DiagnosticCode.INCOMPATIBLE_TYPES,\n+                                symTable.intType,\n+                                sizeConstSymbol.literalType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1ODQxMw=="}, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1OTQ1NQ==", "bodyText": "Can we not have this on one line?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485659455", "createdAt": "2020-09-09T14:31:41Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/arrays/ArraySizeDefinitionTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.ballerinalang.test.statements.arrays;\n+\n+import org.ballerinalang.test.util.BAssertUtil;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Array size definition test.\n+ *\n+ */\n+public class ArraySizeDefinitionTest {\n+\n+    private String sizeMismatchError = \"size mismatch in sealed array. expected '2', but found '3'\";\n+    private String invalidReferenceExpressionError = \"invalid reference expression \" +\n+            \"'intLength' as array size: expected a constant reference expression\";\n+    private String incompatibleTypeError = \"incompatible types: expected 'int', found 'string'\";\n+    private String undefinedSymbolError = \"undefined symbol 'length'\";\n+\n+    @Test(groups = { \"disableOnOldParser\" })\n+    public void testCompilationSizeReferenceErrors() {\n+        int index = 0;\n+        CompileResult result = BCompileUtil.compile(\n+                \"test-src/statements/arrays/array-size-test.bal\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2MzY0NQ==", "bodyText": "Let's move this to the end and assert equality between index and result.getDiagnostics().length, that way we also make sure we've asserted all the errors.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485663645", "createdAt": "2020-09-09T14:37:01Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/arrays/ArraySizeDefinitionTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.ballerinalang.test.statements.arrays;\n+\n+import org.ballerinalang.test.util.BAssertUtil;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Array size definition test.\n+ *\n+ */\n+public class ArraySizeDefinitionTest {\n+\n+    private String sizeMismatchError = \"size mismatch in sealed array. expected '2', but found '3'\";\n+    private String invalidReferenceExpressionError = \"invalid reference expression \" +\n+            \"'intLength' as array size: expected a constant reference expression\";\n+    private String incompatibleTypeError = \"incompatible types: expected 'int', found 'string'\";\n+    private String undefinedSymbolError = \"undefined symbol 'length'\";\n+\n+    @Test(groups = { \"disableOnOldParser\" })\n+    public void testCompilationSizeReferenceErrors() {\n+        int index = 0;\n+        CompileResult result = BCompileUtil.compile(\n+                \"test-src/statements/arrays/array-size-test.bal\");\n+        Assert.assertEquals(result.getDiagnostics().length, 20);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2Mzg4NA==", "bodyText": "Please check other places too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485663884", "createdAt": "2020-09-09T14:37:20Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/arrays/ArraySizeDefinitionTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.ballerinalang.test.statements.arrays;\n+\n+import org.ballerinalang.test.util.BAssertUtil;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Array size definition test.\n+ *\n+ */\n+public class ArraySizeDefinitionTest {\n+\n+    private String sizeMismatchError = \"size mismatch in sealed array. expected '2', but found '3'\";\n+    private String invalidReferenceExpressionError = \"invalid reference expression \" +\n+            \"'intLength' as array size: expected a constant reference expression\";\n+    private String incompatibleTypeError = \"incompatible types: expected 'int', found 'string'\";\n+    private String undefinedSymbolError = \"undefined symbol 'length'\";\n+\n+    @Test(groups = { \"disableOnOldParser\" })\n+    public void testCompilationSizeReferenceErrors() {\n+        int index = 0;\n+        CompileResult result = BCompileUtil.compile(\n+                \"test-src/statements/arrays/array-size-test.bal\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1OTQ1NQ=="}, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2Mzk5Nw==", "bodyText": "Let's not remove this.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485663997", "createdAt": "2020-09-09T14:37:31Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array-fill-test.bal", "diffHunk": "@@ -13,7 +13,6 @@\n // KIND, either express or implied.  See the License for the\n // specific language governing permissions and limitations\n // under the License.\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2NDI0NQ==", "bodyText": "Please add the license text to all the bal files too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485664245", "createdAt": "2020-09-09T14:37:53Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array-size-scope-test.bal", "diffHunk": "@@ -0,0 +1,39 @@\n+const constLength = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2NzE1Mg==", "bodyText": "Let's use underscores instead of hyphens in bal file names.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485667152", "createdAt": "2020-09-09T14:41:36Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array-size-scope-test.bal", "diffHunk": "@@ -0,0 +1,39 @@\n+const constLength = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2NzQwNw==", "bodyText": "We don't quite need these comments right?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485667407", "createdAt": "2020-09-09T14:41:56Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array-size-scope-test.bal", "diffHunk": "@@ -0,0 +1,39 @@\n+const constLength = 2;\n+int intLength = 2;\n+const stringLength = \"2\";\n+\n+//in module scope", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2OTU0OQ==", "bodyText": "Let's also suffix the negative test bal files with _negative", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485669549", "createdAt": "2020-09-09T14:44:44Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array-size-scope-test.bal", "diffHunk": "@@ -0,0 +1,39 @@\n+const constLength = 2;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2NzE1Mg=="}, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2OTc0OA==", "bodyText": "Missing a new line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485669748", "createdAt": "2020-09-09T14:45:00Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array-size-test.bal", "diffHunk": "@@ -0,0 +1,29 @@\n+const constLength = 2;\n+int intLength = 2;\n+const stringLength = \"2\";\n+\n+function arraySizeTest() {\n+    int[constLength] a = [1, 2, 3];\n+    int[intLength] b = [1, 2];\n+    int[stringLength] c = [1, 2];\n+    int[length] d = [1, 2];\n+    int[2] e = [1, 2, 3];\n+\n+    int[2][constLength] f = [[1,2],[1,2,3]];\n+    int[2][intLength] g = [[1,2],[1,2]];\n+    int[2][stringLength] h = [[1,2],[1,2]];\n+    int[2][length] i = [[1,2],[1,2]];\n+    int[2][2] j = [[1,2],[1,2,3]];\n+\n+    int[constLength][2] k = [[1,2],[1,2],[1,2]];\n+    int[intLength][2] l = [[1,2],[1,2]];\n+    int[stringLength][2] m = [[1,2],[1,2]];\n+    int[length][2] n = [[1,2],[1,2]];\n+    int[2][2] o = [[1,2],[1,2],[1,2]];\n+\n+    int[2][constLength][2] p = [[[1,2],[1,2],[1,2]],[[1,2],[1,2]]];\n+    int[2][intLength][2] q = [[[1,2],[1,2]],[[1,2],[1,2]]];\n+    int[2][stringLength][2] r = [[[1,2],[1,2]],[[1,2],[1,2]]];\n+    int[2][length][2] s = [[[1,2],[1,2]],[[1,2],[1,2]]];\n+    int[2][2][2] t = [[[1,2],[1,2],[1,2]],[[1,2],[1,2]]];\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2OTkwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                a[1]=2;\n          \n          \n            \n                a[1] = 2;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485669907", "createdAt": "2020-09-09T14:45:12Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array_fill_runtime_test.bal", "diffHunk": "@@ -120,6 +121,28 @@ function createMultipleConstLiteralAutoFilledSealedArray() {\n     assertEqualPanic(1, sealedArray[3]);\n }\n \n+function tesOneDimensionalArrayWithConstantSizeReferenceFill() {\n+    int[constLength] a = [];\n+    a[1]=2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3MDgxNQ==", "bodyText": "Can we also add positive tests for module level, anon functions, etc. array definitions with constants?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485670815", "createdAt": "2020-09-09T14:46:25Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/sealed_array.bal", "diffHunk": "@@ -15,6 +15,8 @@\n // under the License.\n import ballerina/lang.'int;\n \n+const constLength = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3MTgyOQ==", "bodyText": "Need to also include positive and negative tests for scenarios where the constant is defined after the array in the source.\nFor example, the following should work.\nint[TWO] x = [1, 2];\n\nconst TWO = 2;\nand the following should result in an error.\nint[ONE] x = [1, 2];\n\nconst ONE = 1;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485671829", "createdAt": "2020-09-09T14:47:43Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/sealed_array.bal", "diffHunk": "@@ -15,6 +15,8 @@\n // under the License.\n import ballerina/lang.'int;\n \n+const constLength = 2;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3MDgxNQ=="}, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3MjQ4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                sealedArray[1]=2;\n          \n          \n            \n                sealedArray[1] = 2;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r485672483", "createdAt": "2020-09-09T14:48:31Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/sealed_array.bal", "diffHunk": "@@ -438,6 +440,13 @@ function createConstLiteralAutoFilledSealedArray() {\n     assertArrayLengthPanic(5, sealedArray);\n }\n \n+function testArrayWithConstantSizeReferenceFill() {\n+    int[constLength] sealedArray = [1];\n+    sealedArray[1]=2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5c86862a5cba13b9ae5d82c3605f0883f3b43a"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a63ed91ce8b84ec892c4874501ebbfce7bd80f8b", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a63ed91ce8b84ec892c4874501ebbfce7bd80f8b", "committedDate": "2020-09-11T17:43:51Z", "message": "Refactor all files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjI0NDE1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#pullrequestreview-487224415", "createdAt": "2020-09-12T11:43:24Z", "commit": {"oid": "a63ed91ce8b84ec892c4874501ebbfce7bd80f8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxMTo0MzoyNFrOHQ0m3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxMTo0MzoyNFrOHQ0m3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwMTE4MA==", "bodyText": "Do we really need this to be commented out?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r487401180", "createdAt": "2020-09-12T11:43:24Z", "author": {"login": "dulajdilshan"}, "path": "tests/jballerina-unit-test/src/test/resources/testng.xml", "diffHunk": "@@ -27,7 +27,7 @@\n         <!--<listener class-name=\"org.ballerinalang.test.utils.TestNGListener\"/>-->\n     </listeners>\n     <suite-files>\n-        <suite-file path=\"./testng-jballerina.xml\" />\n+<!--        <suite-file path=\"./testng-jballerina.xml\" />-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a63ed91ce8b84ec892c4874501ebbfce7bd80f8b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b87a2eeef4fd5fc14bf5d6a67e4588fa2f370f5", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5b87a2eeef4fd5fc14bf5d6a67e4588fa2f370f5", "committedDate": "2020-09-14T02:38:13Z", "message": "Resolve merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c98d0c8c0c6dce760ebe75066145590dce372e6", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0c98d0c8c0c6dce760ebe75066145590dce372e6", "committedDate": "2020-09-14T03:05:39Z", "message": "Add unstaged change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/36bf966d84751a61c33b63373c8f57177956a894", "committedDate": "2020-09-14T04:24:57Z", "message": "Revert \"Add unstaged change\"\n\nThis reverts commit 0c98d0c8c0c6dce760ebe75066145590dce372e6.\n\nRevert commit 0c98d0c8c0c6dce760ebe75066145590dce372e6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzQzMzM3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#pullrequestreview-488343337", "createdAt": "2020-09-15T05:50:28Z", "commit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNTo1MDoyOFrOHRxqtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNjowMToxOFrOHRx6wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwMTU5MQ==", "bodyText": "Shall we minimize the changes to BLangParserListener by introducing in BLangPackageBuilder another method that does not accept the size array?\nvoid addArrayType(DiagnosticPos pos, Set<Whitespace> ws, int dimensions) {\n\n}\nAnd from that call the current addArrayType method with an empty BlangExpression array? That way we can avoid importing BLangExpression too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488401591", "createdAt": "2020-09-15T05:50:28Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangParserListener.java", "diffHunk": "@@ -848,8 +849,7 @@ public void exitArrayTypeNameLabel(BallerinaParser.ArrayTypeNameLabelContext ctx\n             }\n         }\n         Collections.reverse(sizes);\n-        this.pkgBuilder.addArrayType(\n-                getCurrentPos(ctx), getWS(ctx), dimensions, sizes.stream().mapToInt(val -> val).toArray());\n+        this.pkgBuilder.addArrayType(getCurrentPos(ctx), getWS(ctx), dimensions, new BLangExpression[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNDIyMg==", "bodyText": "Can we assume this is always a var ref if it is not a literal? Can you validate with something like\npublic function main() {\n    int[[int, string]] x = 1;\n}\nWe may have to explicitly validate if it is\n\na literal\n* - inferred\na variable reference expression", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488404222", "createdAt": "2020-09-15T05:57:33Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -911,17 +913,60 @@ public void visit(BLangArrayType arrayTypeNode) {\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size.getKind() == NodeKind.LITERAL || size.getKind() == NodeKind.NUMERIC_LITERAL) {\n+                    Integer sizeIndicator = (Integer) (((BLangLiteral) size).getValue());\n+                    BArrayState arrayState;\n+                    if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n+                        arrayState = BArrayState.UNSEALED;\n+                    } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n+                        arrayState = BArrayState.OPEN_SEALED;\n+                    } else {\n+                        arrayState = BArrayState.CLOSED_SEALED;\n+                    }\n+                    arrType =  new BArrayType(resultType, arrayTypeSymbol,  sizeIndicator, arrayState);\n+                } else {\n+                    BLangSimpleVarRef sizeReference = (BLangSimpleVarRef) size;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNDUzMg==", "bodyText": "We can refactor this to be on one or two lines instead of having the individual args on separate lines, right?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488404532", "createdAt": "2020-09-15T05:58:26Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -911,17 +913,60 @@ public void visit(BLangArrayType arrayTypeNode) {\n             if (arrayTypeNode.sizes.length == 0) {\n                 arrType = new BArrayType(resultType, arrayTypeSymbol);\n             } else {\n-                int size = arrayTypeNode.sizes[i];\n-                arrType = (size == UNSEALED_ARRAY_INDICATOR) ?\n-                        new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.UNSEALED) :\n-                        (size == OPEN_SEALED_ARRAY_INDICATOR) ?\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.OPEN_SEALED) :\n-                                new BArrayType(resultType, arrayTypeSymbol, size, BArrayState.CLOSED_SEALED);\n-            }\n-            resultType = arrayTypeSymbol.type = arrType;\n+                BLangExpression size = arrayTypeNode.sizes[i];\n+                if (size.getKind() == NodeKind.LITERAL || size.getKind() == NodeKind.NUMERIC_LITERAL) {\n+                    Integer sizeIndicator = (Integer) (((BLangLiteral) size).getValue());\n+                    BArrayState arrayState;\n+                    if (sizeIndicator == OPEN_ARRAY_INDICATOR) {\n+                        arrayState = BArrayState.UNSEALED;\n+                    } else if (sizeIndicator == INFERRED_ARRAY_INDICATOR) {\n+                        arrayState = BArrayState.OPEN_SEALED;\n+                    } else {\n+                        arrayState = BArrayState.CLOSED_SEALED;\n+                    }\n+                    arrType =  new BArrayType(resultType, arrayTypeSymbol,  sizeIndicator, arrayState);\n+                } else {\n+                    BLangSimpleVarRef sizeReference = (BLangSimpleVarRef) size;\n+                    Name pkgAlias = names.fromIdNode(sizeReference.pkgAlias);\n+                    Name typeName = names.fromIdNode(sizeReference.variableName);\n+\n+                    BSymbol sizeSymbol = lookupMainSpaceSymbolInPackage(size.pos, env, pkgAlias, typeName);\n+\n+                    if (symTable.notFoundSymbol == sizeSymbol) {\n+                        dlog.error(arrayTypeNode.pos, DiagnosticCode.UNDEFINED_SYMBOL, size);\n+                        isError = true;\n+                        continue;\n+                    }\n+\n+                    if (sizeSymbol.tag != SymTag.CONSTANT) {\n+                        dlog.error(size.pos, DiagnosticCode.INVALID_ARRAY_SIZE_REFERENCE, sizeSymbol);\n+                        isError = true;\n+                        continue;\n+                    }\n \n+                    BConstantSymbol sizeConstSymbol = (BConstantSymbol) sizeSymbol;\n+                    BType lengthLiteralType = sizeConstSymbol.literalType;\n+\n+                    if (lengthLiteralType.tag != TypeTags.INT) {\n+                        dlog.error(size.pos,\n+                                DiagnosticCode.INCOMPATIBLE_TYPES,\n+                                symTable.intType,\n+                                sizeConstSymbol.literalType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNDk1MQ==", "bodyText": "Since it's just int literals wouldn't a check for just NUMERIC_LITERAL be enough? Please check other usage too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488404951", "createdAt": "2020-09-15T05:59:25Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/tree/types/BLangArrayType.java", "diffHunk": "@@ -62,10 +65,15 @@ public String toString() {\n         final StringBuilder[] sb = {new StringBuilder(getTypeName())};\n         if (sizes.length == 0) {\n             Arrays.stream(sizes).forEach(size -> {\n-                if (size == -1) {\n-                    sb[0].append(\"[]\");\n+                if (size.getKind() == NodeKind.LITERAL || size.getKind() == NodeKind.NUMERIC_LITERAL) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNTI5NQ==", "bodyText": "Shall we add @since Swan Lake?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488405295", "createdAt": "2020-09-15T06:00:14Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/statements/arrays/ArraySizeDefinitionTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+*  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+*\n+*  WSO2 Inc. licenses this file to you under the Apache License,\n+*  Version 2.0 (the \"License\"); you may not use this file except\n+*  in compliance with the License.\n+*  You may obtain a copy of the License at\n+*\n+*    http://www.apache.org/licenses/LICENSE-2.0\n+*\n+*  Unless required by applicable law or agreed to in writing,\n+*  software distributed under the License is distributed on an\n+*  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+*  KIND, either express or implied.  See the License for the\n+*  specific language governing permissions and limitations\n+*  under the License.\n+*/\n+package org.ballerinalang.test.statements.arrays;\n+\n+import org.ballerinalang.test.util.BAssertUtil;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Array size definition test.\n+ *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNTYxOA==", "bodyText": "Extra new lines.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488405618", "createdAt": "2020-09-15T06:01:03Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array_size_scope_test_negative.bal", "diffHunk": "@@ -0,0 +1,54 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+int[constLength] arr = [1, 2, 3];\n+\n+const constLength = 2;\n+int intLength = 2;\n+const stringLength = \"2\";\n+\n+int[constLength] a = [1, 2, 3];\n+int[intLength] b = [1, 2];\n+int[stringLength] c = [1, 2];\n+int[length] d = [1, 2];\n+\n+function arraySizeReferenceInDifferentScopeTest() {\n+    int[constLength] e = [1, 2, 3];\n+    int[intLength] f = [1, 2];\n+    int[stringLength] g = [1, 2];\n+    int[length] h = [1, 2];\n+\n+    function () anonFunction =\n+                function () {\n+                   int[constLength] i = [1, 2, 3];\n+                   int[intLength] j = [1, 2];\n+                   int[stringLength] k = [1, 2];\n+                   int[length] l = [1, 2];\n+                };\n+\n+    anonFunction();\n+\n+    int x = 10;\n+\n+    if (x == 10) {\n+        int[constLength] m = [1, 2, 3];\n+        int[intLength] n = [1, 2];\n+        int[stringLength] o = [1, 2];\n+        int[length] p = [1, 2];\n+    }\n+}\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNTY5OA==", "bodyText": "Please check all files.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#discussion_r488405698", "createdAt": "2020-09-15T06:01:18Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/arrays/array_size_scope_test_negative.bal", "diffHunk": "@@ -0,0 +1,54 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+int[constLength] arr = [1, 2, 3];\n+\n+const constLength = 2;\n+int intLength = 2;\n+const stringLength = \"2\";\n+\n+int[constLength] a = [1, 2, 3];\n+int[intLength] b = [1, 2];\n+int[stringLength] c = [1, 2];\n+int[length] d = [1, 2];\n+\n+function arraySizeReferenceInDifferentScopeTest() {\n+    int[constLength] e = [1, 2, 3];\n+    int[intLength] f = [1, 2];\n+    int[stringLength] g = [1, 2];\n+    int[length] h = [1, 2];\n+\n+    function () anonFunction =\n+                function () {\n+                   int[constLength] i = [1, 2, 3];\n+                   int[intLength] j = [1, 2];\n+                   int[stringLength] k = [1, 2];\n+                   int[length] l = [1, 2];\n+                };\n+\n+    anonFunction();\n+\n+    int x = 10;\n+\n+    if (x == 10) {\n+        int[constLength] m = [1, 2, 3];\n+        int[intLength] n = [1, 2];\n+        int[stringLength] o = [1, 2];\n+        int[length] p = [1, 2];\n+    }\n+}\n+\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQwNTYxOA=="}, "originalCommit": {"oid": "36bf966d84751a61c33b63373c8f57177956a894"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9bc12cfa2fee14695e51162f1e83e7107f02f43", "author": {"user": {"login": "suleka96", "name": "Suleka Helmini"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f9bc12cfa2fee14695e51162f1e83e7107f02f43", "committedDate": "2020-09-16T01:52:11Z", "message": "Refactor all files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MzA4NTA2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25551#pullrequestreview-489308506", "createdAt": "2020-09-16T06:25:02Z", "commit": {"oid": "f9bc12cfa2fee14695e51162f1e83e7107f02f43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}