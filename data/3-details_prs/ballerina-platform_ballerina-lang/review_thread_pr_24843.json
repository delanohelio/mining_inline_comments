{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMTI3NjEz", "number": 24843, "reviewThreads": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMTozMTozNVrOEQH-mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNTo1NDowMlrOETh8CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MzQzMzg3OnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketConstants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMTozMTozNVrOG0HWeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjoxMzoyMFrOG0JBfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzI5OTU3Nw==", "bodyText": "What is this message_datasource for?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r457299577", "createdAt": "2020-07-20T11:31:35Z", "author": {"login": "daneshk"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketConstants.java", "diffHunk": "@@ -72,6 +72,7 @@\n     public static final String RESOURCE_NAME_UPGRADE = \"upgrade\";\n \n     public static final String WEBSOCKET_HANDSHAKER = \"WEBSOCKET_MESSAGE\";\n+    public static final String MESSAGE_DATA_SOURCE = \"message_datasource\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMyNjk3NA==", "bodyText": "In the entity, the payload is set by the message_datasource key as native data. So, I use it to get the response's payload from the entity.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r457326974", "createdAt": "2020-07-20T12:13:20Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketConstants.java", "diffHunk": "@@ -72,6 +72,7 @@\n     public static final String RESOURCE_NAME_UPGRADE = \"upgrade\";\n \n     public static final String WEBSOCKET_HANDSHAKER = \"WEBSOCKET_MESSAGE\";\n+    public static final String MESSAGE_DATA_SOURCE = \"message_datasource\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzI5OTU3Nw=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MzQ3Njg2OnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMTo0MTo1MVrOG0HvmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMzoxMDo1MFrOG2uv2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMwNjAwOA==", "bodyText": "Shall we have a meaningful message instead of e.getPrintableStackTrace(), since it is there in the e", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r457306008", "createdAt": "2020-07-20T11:41:51Z", "author": {"login": "daneshk"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA0MjIwMA==", "bodyText": "These changes have been reverted in a30ea6f", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r460042200", "createdAt": "2020-07-24T13:10:50Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMwNjAwOA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MzY4ODIyOnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjoyNzoyM1rOG0JmbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMzoxMDo1OFrOG2uwGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMzNjQyOA==", "bodyText": "this change seems like a new addition to the error message. With the brackets, I feel like the shape of the error syntax has changed. WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r457336428", "createdAt": "2020-07-20T12:27:23Z", "author": {"login": "chamil321"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketUtil.java", "diffHunk": "@@ -578,7 +578,7 @@ public static void countDownForHandshake(ObjectValue webSocketClient) {\n     public static WebSocketException getWebSocketException(String msg, Throwable throwable, String errorCode,\n                                                            ErrorValue cause) {\n         WebSocketException exception;\n-        String message = errorCode.substring(2) + \": \" + msg;\n+        String message = \"[\" + errorCode.substring(2) + \"] \" + msg;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAyNTAxOQ==", "bodyText": "At some places,  colon comes in more than once places. I thought that it is not a good format. So, I have changed it to the bracket.\n\nhttps://github.com/ballerina-platform/ballerina-lang/blob/master/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/service/websocket/CookieTest.java#L56\nhttps://github.com/ballerina-platform/ballerina-lang/blob/master/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/service/websocket/ClientErrorsTest.java#L74", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458025019", "createdAt": "2020-07-21T11:25:55Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketUtil.java", "diffHunk": "@@ -578,7 +578,7 @@ public static void countDownForHandshake(ObjectValue webSocketClient) {\n     public static WebSocketException getWebSocketException(String msg, Throwable throwable, String errorCode,\n                                                            ErrorValue cause) {\n         WebSocketException exception;\n-        String message = errorCode.substring(2) + \": \" + msg;\n+        String message = \"[\" + errorCode.substring(2) + \"] \" + msg;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMzNjQyOA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA0MjI2Ng==", "bodyText": "These changes have been reverted in a30ea6f", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r460042266", "createdAt": "2020-07-24T13:10:58Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/websocket/WebSocketUtil.java", "diffHunk": "@@ -578,7 +578,7 @@ public static void countDownForHandshake(ObjectValue webSocketClient) {\n     public static WebSocketException getWebSocketException(String msg, Throwable throwable, String errorCode,\n                                                            ErrorValue cause) {\n         WebSocketException exception;\n-        String message = errorCode.substring(2) + \": \" + msg;\n+        String message = \"[\" + errorCode.substring(2) + \"] \" + msg;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMzNjQyOA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Njk0OTgzOnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNDozOToxN1rOG0n0Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMjoyMjoyMFrOG1f7LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMTQ1OA==", "bodyText": "Throwing WebSocket exception during the HTTP flow seems incorrect. Still, the upgrade has not happed to WebSocket and this is a response flow to the HTTP request. 401 should go to the client without an exception thrown IMO", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r457831458", "createdAt": "2020-07-21T04:39:17Z", "author": {"login": "chamil321"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }\n         } catch (Throwable e) {\n             unBlockStrand(strand);\n-            //Exception is already notified by http transport.\n-            String errorMessage = \"Couldn't complete outbound response\";\n-            log.debug(errorMessage, e);\n-            return HttpUtil.createHttpError(errorMessage, HttpErrorType.GENERIC_LISTENER_ERROR);\n+            String errorMessage = \"\";\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(message, e);\n+                }\n+                throw getWebSocketException(outboundResponseObj);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAxNjQ4MA==", "bodyText": "According to the current implementation, Success and Errors are handled by OnUpgradeResourceCallback during the Websocket upgrade connection. So If we will throw the exception, OnError can handle that.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458016480", "createdAt": "2020-07-21T11:08:57Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }\n         } catch (Throwable e) {\n             unBlockStrand(strand);\n-            //Exception is already notified by http transport.\n-            String errorMessage = \"Couldn't complete outbound response\";\n-            log.debug(errorMessage, e);\n-            return HttpUtil.createHttpError(errorMessage, HttpErrorType.GENERIC_LISTENER_ERROR);\n+            String errorMessage = \"\";\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(message, e);\n+                }\n+                throw getWebSocketException(outboundResponseObj);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMTQ1OA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxMzA3MQ==", "bodyText": "Had a call with @kalaiyarasiganeshalingam and cleared the flow. (Ignore the above comment)\nIt seems like from the Auth filter an HTTP response(401) is sent to the WSClient instead of WebSocket response.\nIMO at AuthFilter level, this should be handled not in the Respond method. If the Auth filter can identify the WebSocket upgrade request and respond appropriately then this exception will not have occurred.\n@ldclakmal @daneshk WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458613071", "createdAt": "2020-07-22T08:09:27Z", "author": {"login": "chamil321"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }\n         } catch (Throwable e) {\n             unBlockStrand(strand);\n-            //Exception is already notified by http transport.\n-            String errorMessage = \"Couldn't complete outbound response\";\n-            log.debug(errorMessage, e);\n-            return HttpUtil.createHttpError(errorMessage, HttpErrorType.GENERIC_LISTENER_ERROR);\n+            String errorMessage = \"\";\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(message, e);\n+                }\n+                throw getWebSocketException(outboundResponseObj);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMTQ1OA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc0NDg1Mw==", "bodyText": "In HTTP filter level, I don't think we have a way to identify whether this is an WS upgrade request. IMO, the transport pipeline should get updated to WS after authentication filters. Then we can simply respond (HTTP responses) with 401 or 403. Seems like, here the transport get updated before engaging filters. Shall we schedule a meeting and discuss this? WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458744853", "createdAt": "2020-07-22T12:10:57Z", "author": {"login": "ldclakmal"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }\n         } catch (Throwable e) {\n             unBlockStrand(strand);\n-            //Exception is already notified by http transport.\n-            String errorMessage = \"Couldn't complete outbound response\";\n-            log.debug(errorMessage, e);\n-            return HttpUtil.createHttpError(errorMessage, HttpErrorType.GENERIC_LISTENER_ERROR);\n+            String errorMessage = \"\";\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(message, e);\n+                }\n+                throw getWebSocketException(outboundResponseObj);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMTQ1OA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc1MDc2NQ==", "bodyText": "+1 Let's have a meeting and discuss", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458750765", "createdAt": "2020-07-22T12:22:20Z", "author": {"login": "daneshk"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }\n         } catch (Throwable e) {\n             unBlockStrand(strand);\n-            //Exception is already notified by http transport.\n-            String errorMessage = \"Couldn't complete outbound response\";\n-            log.debug(errorMessage, e);\n-            return HttpUtil.createHttpError(errorMessage, HttpErrorType.GENERIC_LISTENER_ERROR);\n+            String errorMessage = \"\";\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(message, e);\n+                }\n+                throw getWebSocketException(outboundResponseObj);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMTQ1OA=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODUxOTQ5OnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMjo1NzowOVrOG02ohg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMzoxMTowNlrOG2uwWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA3NDI0Ng==", "bodyText": "We don't need this check here since this is checked at the library itself. We usually add this only if the message has any sting concatenation since that is heavy processing.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458074246", "createdAt": "2020-07-21T12:57:09Z", "author": {"login": "niveathika"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA0MjMzMA==", "bodyText": "These changes have been reverted in a30ea6f", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r460042330", "createdAt": "2020-07-24T13:11:06Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA3NDI0Ng=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODUzMjEzOnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzowMDowMlrOG02wEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzo1NjowOVrOG1RyYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA3NjE3OQ==", "bodyText": "Is there a specific use case when connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) can be null?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458076179", "createdAt": "2020-07-21T13:00:02Z", "author": {"login": "niveathika"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxOTEzNw==", "bodyText": "Yes. That is indicated this is not a request of the http Websocket upgrade.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458519137", "createdAt": "2020-07-22T03:56:09Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA3NjE3OQ=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTgxNzYxOnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNzoyOTo0NFrOG1WKNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMzoxMToxM1rOG2uwlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MDc3Mg==", "bodyText": "We dont usually return Exceptions. Use throw. Also add a comment for the specific null check\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n          \n          \n            \n                            throw getWebSocketException(outboundResponseObj);\n          \n          \n            \n                        } else {\n          \n          \n            \n                            return e;\n          \n          \n            \n                        }\n          \n          \n            \n                        if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n          \n          \n            \n                            throw getWebSocketException(outboundResponseObj);\n          \n          \n            \n                        } \n          \n          \n            \n                         throw e;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r458590772", "createdAt": "2020-07-22T07:29:44Z", "author": {"login": "niveathika"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA0MjM5MQ==", "bodyText": "These changes have been reverted in a30ea6f", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r460042391", "createdAt": "2020-07-24T13:11:13Z", "author": {"login": "kalaiyarasiganeshalingam"}, "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -108,14 +113,30 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n             }\n         } catch (ErrorValue e) {\n             unBlockStrand(strand);\n-            log.debug(e.getPrintableStackTrace(), e);\n-            return e;\n+            if (log.isDebugEnabled()) {\n+                log.debug(e.getPrintableStackTrace(), e);\n+            }\n+            if (connectionObj.getNativeData(WebSocketConstants.WEBSOCKET_HANDSHAKER) != null) {\n+                throw getWebSocketException(outboundResponseObj);\n+            } else {\n+                return e;\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5MDc3Mg=="}, "originalCommit": {"oid": "847ab18a7bcaa876a332ecd680de5142b1727119"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDU4MTgyOnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/ballerina/src/http/auth/utils.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTowNDoxMVrOG4osLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTowNDoxMVrOG4osLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0MDExMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Checks whether the `ResourceConfig` has `WebSocketUpgradeConfig` or not.\n          \n          \n            \n            # Checks whether the `http:ResourceConfig` has `http:WebSocketUpgradeConfig` or not.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462040111", "createdAt": "2020-07-29T05:04:11Z", "author": {"login": "ldclakmal"}, "path": "stdlib/http/src/main/ballerina/src/http/auth/utils.bal", "diffHunk": "@@ -252,6 +252,22 @@ function getResourceAuthConfig(FilterContext context) returns ResourceAuth? {\n     }\n }\n \n+# Checks whether the `ResourceConfig` has `WebSocketUpgradeConfig` or not.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6b688477810ca9600fb3c7b75eded4fa544750"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYxOTI0OnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/ballerina/src/http/auth/utils.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyNDozMFrOG4pCcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyNDozMFrOG4pCcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0NTgxMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # + return - Whether the `ResourceConfig` has `WebSocketUpgradeConfig` or not\n          \n          \n            \n            # + return - Whether the `http:ResourceConfig` has `http:WebSocketUpgradeConfig` or not", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462045811", "createdAt": "2020-07-29T05:24:30Z", "author": {"login": "ldclakmal"}, "path": "stdlib/http/src/main/ballerina/src/http/auth/utils.bal", "diffHunk": "@@ -252,6 +252,22 @@ function getResourceAuthConfig(FilterContext context) returns ResourceAuth? {\n     }\n }\n \n+# Checks whether the `http:ResourceConfig` has `http:WebSocketUpgradeConfig` or not.\n+#\n+# + context - The `FilterContext` instance\n+# + return - Whether the `ResourceConfig` has `WebSocketUpgradeConfig` or not", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYyMDIxOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/40_authanticateServer.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyNDo1M1rOG4pC_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyNDo1M1rOG4pC_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0NTk1MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            http:BasicAuthHandler inboundBasicAuthHandler = new (new auth:InboundBasicAuthProvider({ tableName: \"b7a.users\" }));\n          \n          \n            \n            http:BasicAuthHandler inboundBasicAuthHandler = new (new auth:InboundBasicAuthProvider());", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462045951", "createdAt": "2020-07-29T05:24:53Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/40_authanticateServer.bal", "diffHunk": "@@ -0,0 +1,58 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+import ballerina/auth;\n+import ballerina/http;\n+import ballerina/io;\n+import ballerina/log;\n+\n+http:BasicAuthHandler inboundBasicAuthHandler = new (new auth:InboundBasicAuthProvider({ tableName: \"b7a.users\" }));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYyNjg0OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/39_authentication.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyODozMFrOG4pG_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyODozMFrOG4pG_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0Njk3NQ==", "bodyText": "Shall we rename the file as 39_authentication_success_client.bal?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462046975", "createdAt": "2020-07-29T05:28:30Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/39_authentication.bal", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYyNzM2OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/40_authanticateServer.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyODo0NlrOG4pHSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyODo0NlrOG4pHSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0NzA1MQ==", "bodyText": "Shall we rename the file as 40_authentication_success_server.bal?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462047051", "createdAt": "2020-07-29T05:28:46Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/40_authanticateServer.bal", "diffHunk": "@@ -0,0 +1,58 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYyNzgzOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/42_unauthentication_client.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyOTowOFrOG4pHpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyOTowOFrOG4pHpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0NzE0Mg==", "bodyText": "Shall we rename the file as 41_authentication_failure_client.bal?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462047142", "createdAt": "2020-07-29T05:29:08Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/42_unauthentication_client.bal", "diffHunk": "@@ -0,0 +1,50 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYyODUxOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/41_unauthenticate_server.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyOToyN1rOG4pIDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNToyOToyN1rOG4pIDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0NzI0NQ==", "bodyText": "Shall we rename the file as 42_authentication_failure_server.bal?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462047245", "createdAt": "2020-07-29T05:29:27Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/41_unauthenticate_server.bal", "diffHunk": "@@ -0,0 +1,51 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDYzMjExOnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/41_unauthenticate_server.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTozMToyOVrOG4pKLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTozMToyOVrOG4pKLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA0Nzc4OQ==", "bodyText": "Let's switch the port 21041 and 21042 with client and server, in order to match with file name ordering as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462047789", "createdAt": "2020-07-29T05:31:29Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/resources/websocket/src/wsservices/41_unauthenticate_server.bal", "diffHunk": "@@ -0,0 +1,51 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+import ballerina/auth;\n+import ballerina/http;\n+import ballerina/io;\n+import ballerina/log;\n+\n+http:BasicAuthHandler basicAuthHandler = new (new auth:InboundBasicAuthProvider());\n+\n+listener http:Listener httpServ = new (21041, config = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5791845179b6847d29d9026e521670e5c8d4f520"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDY4OTQ1OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/service/websocket/AuthenticationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTo1OTozMFrOG4psGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTo1OTozMFrOG4psGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA1NjQ3NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testBasicAuthentication() throws URISyntaxException, InterruptedException, BallerinaTestException {\n          \n          \n            \n                public void testBasicAuthenticationSuccess() throws URISyntaxException, InterruptedException, BallerinaTestException {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462056475", "createdAt": "2020-07-29T05:59:30Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/service/websocket/AuthenticationTest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.test.service.websocket;\n+\n+import org.ballerinalang.test.context.BallerinaTestException;\n+import org.ballerinalang.test.context.LogLeecher;\n+import org.ballerinalang.test.util.websocket.client.WebSocketTestClient;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+import java.net.URISyntaxException;\n+\n+/**\n+ * Tests the authentication support of the WebSocket client.\n+ */\n+@Test(groups = {\"websocket-test\"})\n+public class AuthenticationTest {\n+\n+    private WebSocketTestClient client;\n+    private LogLeecher logLeecher;\n+    String expectingErrorLog;\n+\n+    @Test(description = \"Tests with correct credential\")\n+    public void testBasicAuthentication() throws URISyntaxException, InterruptedException, BallerinaTestException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ee2de16cfc9605929da4f944965a2e58650021"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDY5MDc1OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/service/websocket/AuthenticationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTo1OTo0N1rOG4psvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNTo1OTo0N1rOG4psvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA1NjYzOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void negativeTestcase() throws URISyntaxException, InterruptedException, BallerinaTestException {\n          \n          \n            \n                public void testBasicAuthenticationFailure() throws URISyntaxException, InterruptedException, BallerinaTestException {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462056639", "createdAt": "2020-07-29T05:59:47Z", "author": {"login": "ldclakmal"}, "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/service/websocket/AuthenticationTest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.test.service.websocket;\n+\n+import org.ballerinalang.test.context.BallerinaTestException;\n+import org.ballerinalang.test.context.LogLeecher;\n+import org.ballerinalang.test.util.websocket.client.WebSocketTestClient;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+import java.net.URISyntaxException;\n+\n+/**\n+ * Tests the authentication support of the WebSocket client.\n+ */\n+@Test(groups = {\"websocket-test\"})\n+public class AuthenticationTest {\n+\n+    private WebSocketTestClient client;\n+    private LogLeecher logLeecher;\n+    String expectingErrorLog;\n+\n+    @Test(description = \"Tests with correct credential\")\n+    public void testBasicAuthentication() throws URISyntaxException, InterruptedException, BallerinaTestException {\n+        expectingErrorLog = \"Hello World!\";\n+        logLeecher = new LogLeecher(expectingErrorLog);\n+        WebSocketTestCommons.serverInstance.addLogLeecher(logLeecher);\n+        client = new WebSocketTestClient(\"ws://localhost:21039\");\n+        client.handshake();\n+        logLeecher.waitForText(WebSocketTestCommons.TIMEOUT_IN_SECS * 1000);\n+        client.shutDown();\n+    }\n+\n+    @Test(description = \"Tests with wrong credential\")\n+    public void negativeTestcase() throws URISyntaxException, InterruptedException, BallerinaTestException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ee2de16cfc9605929da4f944965a2e58650021"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTE0NDQwOnYy", "diffSide": "RIGHT", "path": "stdlib/http/src/main/ballerina/src/http/auth/utils.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNTo1NDowMlrOG5UGdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNTo1NDowMlrOG5UGdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1MTM1MQ==", "bodyText": "Shall we check the nilable annData and do an early return?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (!(annData is ())) {\n          \n          \n            \n                if (annData is ()) {\n          \n          \n            \n                    return false;\n          \n          \n            \n                }", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24843#discussion_r462751351", "createdAt": "2020-07-30T05:54:02Z", "author": {"login": "chamil321"}, "path": "stdlib/http/src/main/ballerina/src/http/auth/utils.bal", "diffHunk": "@@ -252,6 +252,22 @@ function getResourceAuthConfig(FilterContext context) returns ResourceAuth? {\n     }\n }\n \n+# Checks whether the `http:ResourceConfig` has `http:WebSocketUpgradeConfig` or not.\n+#\n+# + context - The `FilterContext` instance\n+# + return - Whether the `http:ResourceConfig` has `http:WebSocketUpgradeConfig` or not\n+function isWebSocketUpgradeRequest(FilterContext context) returns boolean {\n+    any annData = reflect:getResourceAnnotations(context.getService(), context.getResourceName(), RESOURCE_ANN_NAME,\n+                                                 ANN_MODULE);\n+    if (!(annData is ())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a79bbae0fd5e751c078fe3f938186726c48344d7"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 413, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}