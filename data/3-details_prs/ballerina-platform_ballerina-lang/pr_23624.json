{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NTI2MjU1", "number": 23624, "title": "Merge codegen with compile phases", "bodyText": "Purpose\nThis PR will merge the codegen with compile phases and now codegen will run as the final phase in the compile frontend.\nFixes #21977", "createdAt": "2020-05-30T21:32:55Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23624", "merged": true, "mergeCommit": {"oid": "6f970d928f070793be928078128b36219b09bb47"}, "closed": true, "closedAt": "2020-06-02T07:26:26Z", "author": {"login": "Kishanthan"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmde4fgH2gAyNDI1NTI2MjU1OmFhODNlNmM1YWM3NWRiOGE2MTEzZmJmYTZmNDMyOTMyMjVlMzk3YmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnPUJxgFqTQyMjM5MjQwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa83e6c5ac75db8a6113fbfa6f43293225e397bb", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa83e6c5ac75db8a6113fbfa6f43293225e397bb", "committedDate": "2020-05-30T20:56:11Z", "message": "Move NativeDependencyResolver lookup key to API class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6863ecf66cf286e0974293d503607eb672d4b9a1", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6863ecf66cf286e0974293d503607eb672d4b9a1", "committedDate": "2020-05-30T20:56:53Z", "message": "Add jar file binary writer class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988c83ff47f7fdf8569192ef08d959a3e734b7de", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/988c83ff47f7fdf8569192ef08d959a3e734b7de", "committedDate": "2020-05-30T20:57:43Z", "message": "Refactor JarFile class as CompiledJarFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5711050461efad0cd5c611385773d57d6fa1d92f", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5711050461efad0cd5c611385773d57d6fa1d92f", "committedDate": "2020-05-30T20:58:54Z", "message": "Remove unused lib-creator-milestone gradle module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48ce58bf70617428e61888bd9e51dd5ffc7fa7b5", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/48ce58bf70617428e61888bd9e51dd5ffc7fa7b5", "committedDate": "2020-05-30T20:59:47Z", "message": "Remove BackendDriver as it is not used anymore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e30354feadb35ae6a45e91c6683d6a29a01ccaf", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1e30354feadb35ae6a45e91c6683d6a29a01ccaf", "committedDate": "2020-05-30T21:01:33Z", "message": "Remove JarFile class as it replaced by CompiledJarFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2342c28d7ba69aff73198a17ea0b6d3c0084b96a", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2342c28d7ba69aff73198a17ea0b6d3c0084b96a", "committedDate": "2020-05-30T21:13:31Z", "message": "Add new compiler options needed for codegen phase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a13431b3e96bc60d8d75b554a8135e5a5e95b213", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a13431b3e96bc60d8d75b554a8135e5a5e95b213", "committedDate": "2020-05-30T21:14:10Z", "message": "Store compiled module jar content in-memory in symbol"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b009fd741e0fab05dcf1854dd96f4e14f5e60d0", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7b009fd741e0fab05dcf1854dd96f4e14f5e60d0", "committedDate": "2020-05-30T21:14:25Z", "message": "Use JarFileWriter to write balo jars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff3e349fb16034eef3760a2ff294305f8f3faec", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dff3e349fb16034eef3760a2ff294305f8f3faec", "committedDate": "2020-05-30T21:15:55Z", "message": "Refactor codegen to run as a compilation phase\n\nThis change will make codegen class to generate the bytecode and\nstore it in the symbol for each package that is being called. The\nCompilerDriver will call CodeGenerator now as the last phase in\ncompilation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bca762b6321b54825175ce6a694c3647e16ed47", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0bca762b6321b54825175ce6a694c3647e16ed47", "committedDate": "2020-05-30T21:18:15Z", "message": "Add codegen as the last compilation phase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3692ee3da2b421bbc689d59cc3beba9d8ea062d", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e3692ee3da2b421bbc689d59cc3beba9d8ea062d", "committedDate": "2020-05-30T21:19:30Z", "message": "Refactor JvmPackageGen to work with codegen changes\n\nThis commit also has the fix to interop validation for non-entry\nmodules."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcf70120dd19e66e4a3cd32aaafccf2f194df375", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fcf70120dd19e66e4a3cd32aaafccf2f194df375", "committedDate": "2020-05-30T21:21:10Z", "message": "Code refactor with correct allignment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81a81f2b49fcd7e57e492052d2d4353e29b1d716", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/81a81f2b49fcd7e57e492052d2d4353e29b1d716", "committedDate": "2020-05-30T21:22:35Z", "message": "Exclude BPackageSymbol in spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2389132494b9f7936bb5f7443ef7abeb4fba5b2b", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2389132494b9f7936bb5f7443ef7abeb4fba5b2b", "committedDate": "2020-05-30T21:23:30Z", "message": "Use JarFileWriter to write thin jars to target path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "437f5088e9d7459309007f4fd0212165cdf504bb", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/437f5088e9d7459309007f4fd0212165cdf504bb", "committedDate": "2020-05-30T21:24:35Z", "message": "Add codegen related complier options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "403335b019c8bb53cfe7892f2cc8c607001cf993", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/403335b019c8bb53cfe7892f2cc8c607001cf993", "committedDate": "2020-05-30T21:26:12Z", "message": "Add jackson core module to dependency resolving issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08aec62b51621fe426332b679807916892b74346", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/08aec62b51621fe426332b679807916892b74346", "committedDate": "2020-05-30T21:27:11Z", "message": "Add packerina gradle dependency to test utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56bcce5019a50d5165b5510d2b51b3ad8e715ff7", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/56bcce5019a50d5165b5510d2b51b3ad8e715ff7", "committedDate": "2020-05-30T21:27:27Z", "message": "Update compileOnJballerina method with codegen changes\n\nThe new JarFileWriter class is used to write the thin jars now.\nAlso, this commit has some code cleaup of the whole BCompileUtil\nclass."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3d4bc21dbfce64cced6aed12c3bc5fed1f83fbd", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f3d4bc21dbfce64cced6aed12c3bc5fed1f83fbd", "committedDate": "2020-05-30T21:29:43Z", "message": "Clean cache directory for balo test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a263cb7b90a94da9f1782a3bd678d602e0a537b3", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a263cb7b90a94da9f1782a3bd678d602e0a537b3", "committedDate": "2020-05-30T21:30:06Z", "message": "Remove unwanted path check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc056cdf0e7e869ebd22f8553c33f20c46c2978e", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cc056cdf0e7e869ebd22f8553c33f20c46c2978e", "committedDate": "2020-05-31T09:37:52Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTk4Nzgz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23624#pullrequestreview-421598783", "createdAt": "2020-06-01T05:22:15Z", "commit": {"oid": "cc056cdf0e7e869ebd22f8553c33f20c46c2978e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNToyMjoxNVrOGc_CeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNToyMjoxNVrOGc_CeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0NjEzNw==", "bodyText": "Shall we rename to baloGen or baloGenerated and remove is prefix to be consistent with other boolean variable names\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean isBaloGen;\n          \n          \n            \n                private boolean baloGen;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23624#discussion_r433046137", "createdAt": "2020-06-01T05:22:15Z", "author": {"login": "riyafa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/CodeGenerator.java", "diffHunk": "@@ -52,18 +63,31 @@\n public class CodeGenerator {\n \n     private static final CompilerContext.Key<CodeGenerator> CODE_GEN = new CompilerContext.Key<>();\n-\n     private SymbolTable symbolTable;\n-\n-    private Map<String, BIRNode.BIRPackage> compiledPkgCache = new HashMap<>();\n-\n-    private JvmPackageGen jvmPackageGen;\n-\n-    private CodeGenerator(CompilerContext context) {\n-\n-        context.put(CODE_GEN, this);\n-        symbolTable = SymbolTable.getInstance(context);\n-        jvmPackageGen = JvmPackageGen.getInstance(context);\n+    private PackageCache packageCache;\n+    private BLangDiagnosticLogHelper dlog;\n+    private BIREmitter birEmitter;\n+    private boolean isBaloGen;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc056cdf0e7e869ebd22f8553c33f20c46c2978e"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35af21b5874add9c7a8e52b71a5e4d9eec72c47a", "author": {"user": {"login": "Kishanthan", "name": "Kishanthan Thangarajah"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/35af21b5874add9c7a8e52b71a5e4d9eec72c47a", "committedDate": "2020-06-01T10:02:07Z", "message": "Use consistent naming for baloGen flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMzczMTA0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23624#pullrequestreview-422373104", "createdAt": "2020-06-02T06:22:04Z", "commit": {"oid": "35af21b5874add9c7a8e52b71a5e4d9eec72c47a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjoyMjowNFrOGdjmCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjoyMjowNFrOGdjmCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY0NTA2Nw==", "bodyText": "Why we need these changes in this test?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23624#discussion_r433645067", "createdAt": "2020-06-02T06:22:04Z", "author": {"login": "warunalakshitha"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/balo/imports/ImportsTests.java", "diffHunk": "@@ -43,42 +39,21 @@\n \n     private static final String USER_HOME = \"user.home\";\n     private String previousUserHome;\n-    private Path tempBir;\n     private Path imports;\n-    private Path homeBirCache;\n-    private Path birDir;\n-    private List<Path> birFiles;\n \n     @BeforeClass(description = \"Build the necessary modules.\")\n     public void setup() throws IOException {\n         Path tempDir = Files.createTempDirectory(\"temp-bal-home\");\n-\n-        tempBir = Paths.get(System.getProperty(\"user.dir\"), \"build\", \"test-bir-temp\");\n-\n         imports = Paths.get(\"test-src\", \"balo\", \"imports\");\n-\n-        homeBirCache = tempDir.resolve(Paths.get(\".ballerina\", \"bir_cache\" + \"-\" +\n-                RepoUtils.getBallerinaVersion()));\n-\n         previousUserHome = System.getProperty(USER_HOME);\n         System.setProperty(USER_HOME, tempDir.toString());\n-\n-        // Delete all existing bir files.\n-        BFileUtil.deleteAll(tempBir, \"testModule.bir\");\n     }\n \n     @Test(description = \"Get the version from the source file.\")\n-    public void testVersionSupportImportFromSourceFile() throws IOException {\n+    public void testVersionSupportImportFromSourceFile() {\n         BaloCreator.cleanCacheDirectories();\n         BaloCreator.createAndSetupBalo(imports.resolve(Paths.get(\"test_module1\", \"test_module\")).toString(),\n                 \"testOrg\", \"testModule\", \"1.1.0\");\n-        birFiles = Files.find(tempBir, Integer.MAX_VALUE, (path, attribute) ->\n-                path.toString().contains(\"testModule.bir\")\n-                        && !path.toString().contains(\"imports\")).collect(Collectors.toList());\n-        birDir = Files.createDirectories(homeBirCache.resolve(Paths.get(\"testOrg\", \"testModule\", \"1.1.0\")));\n-        BFileUtil.copy(birFiles.get(0), birDir.resolve(Paths.get(\"testModule.bir\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35af21b5874add9c7a8e52b71a5e4d9eec72c47a"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMzkyNDA1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23624#pullrequestreview-422392405", "createdAt": "2020-06-02T06:59:43Z", "commit": {"oid": "35af21b5874add9c7a8e52b71a5e4d9eec72c47a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4478, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}