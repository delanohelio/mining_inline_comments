{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNzYwNDA0", "number": 23540, "title": "Improve log-API performance", "bodyText": "Purpose\n\nOptimize log-API performance.\n\nFixes #\n#23461", "createdAt": "2020-05-27T10:35:59Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540", "merged": true, "mergeCommit": {"oid": "4bf47d2ce81480e07dfda274ec37754324572dd2"}, "closed": true, "closedAt": "2020-05-29T06:48:36Z", "author": {"login": "MadhukaHarith92"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclYDbogFqTQxOTExNTY4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl8rQhAFqTQyMDY4OTU2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MTE1Njgw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#pullrequestreview-419115680", "createdAt": "2020-05-27T11:52:58Z", "commit": {"oid": "a290f7bdb57dd395e869b61f43ba9822d9e40206"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMTo1Mjo1OFrOGbFvqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMTo1OTo1N1rOGbF9sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODg1Ng==", "bodyText": "This still doesn't address the said issue though. Here, the getPackagePath() method needs to be called anyway to get the module name for a given log call. These if conditions are duplicating two checks/functionalities:\n\nThe call to get the module name\nThe check to see if the log level is enabled (since it is checked in the logMessage() method)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r431058856", "createdAt": "2020-05-27T11:52:58Z", "author": {"login": "pubudu91"}, "path": "stdlib/log-api/src/main/java/org/ballerinalang/stdlib/log/Utils.java", "diffHunk": "@@ -27,39 +27,76 @@\n  * @since 1.1.0\n  */\n public class Utils extends AbstractLogFunction {\n+    private static boolean logLevelEnabled = false;\n+\n     public static void printDebug(Object msg) {\n-        logMessage(Scheduler.getStrand(), msg, BLogLevel.DEBUG, getPackagePath(),\n-                (pkg, message) -> {\n-            getLogger(pkg).debug(message);\n-        });\n+        if (LOG_MANAGER.isModuleLogLevelEnabled()) {\n+            logLevelEnabled = isLogLevelEnabled(BLogLevel.DEBUG, getPackagePath());\n+        } else {\n+            logLevelEnabled = isLogLevelEnabled(BLogLevel.DEBUG, \"\");\n+        }\n+        if (logLevelEnabled) {\n+            logMessage(Scheduler.getStrand(), msg, BLogLevel.DEBUG, getPackagePath(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a290f7bdb57dd395e869b61f43ba9822d9e40206"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MjQ1MQ==", "bodyText": "This API is sort of redundant isn't it? This is basically doing the same thing as what LogManager.getPackageLogLevel() API does.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r431062451", "createdAt": "2020-05-27T11:59:57Z", "author": {"login": "pubudu91"}, "path": "stdlib/log-api/src/main/java/org/ballerinalang/stdlib/log/AbstractLogFunction.java", "diffHunk": "@@ -91,4 +91,14 @@ static String getPackagePath() {\n         }\n         return \".\";\n     }\n+\n+    static boolean isLogLevelEnabled(BLogLevel logLevel, String pckg) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a290f7bdb57dd395e869b61f43ba9822d9e40206"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDAzMTE4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#pullrequestreview-420403118", "createdAt": "2020-05-28T19:00:41Z", "commit": {"oid": "a924c621e865d2da539992fa3c4d34461046558e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxOTowMDo0MVrOGcCiMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxOTowMDo0MVrOGcCiMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1NDgzMg==", "bodyText": "Why is this maintained at class level? There's no need for this right? Each time a log function is called this is updated, but never used. Plus, this class is meant to be stateless isn't it?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r432054832", "createdAt": "2020-05-28T19:00:41Z", "author": {"login": "pubudu91"}, "path": "stdlib/log-api/src/main/java/org/ballerinalang/stdlib/log/Utils.java", "diffHunk": "@@ -27,39 +27,76 @@\n  * @since 1.1.0\n  */\n public class Utils extends AbstractLogFunction {\n+    private static boolean logLevelEnabled = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a924c621e865d2da539992fa3c4d34461046558e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5607a425616134d87fe4f124939244d0f611bb", "author": {"user": {"login": "MadhukaHarith92", "name": "Madhuka Harith Wickramapala"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2e5607a425616134d87fe4f124939244d0f611bb", "committedDate": "2020-05-29T04:09:18Z", "message": "Improve log-API performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c8c82f05653b0c96fba98aba2d9b06d25de7d5", "author": {"user": {"login": "MadhukaHarith92", "name": "Madhuka Harith Wickramapala"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/78c8c82f05653b0c96fba98aba2d9b06d25de7d5", "committedDate": "2020-05-29T04:12:07Z", "message": "Fix code review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjg5NTY3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#pullrequestreview-420689567", "createdAt": "2020-05-29T06:42:51Z", "commit": {"oid": "78c8c82f05653b0c96fba98aba2d9b06d25de7d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4452, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}