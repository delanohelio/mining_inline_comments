{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMDc2ODM1", "number": 25378, "reviewThreads": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwMDozMzoyNVrOEbXt9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNToxNDozMVrOEjpE5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTM1NjA2OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwMDozMzoyNVrOHFRV5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowNjo1NlrOHFjecA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI4OTA2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Parses a string in JSON format and returns the the value that it represents.\n          \n          \n            \n            # Parses a string in JSON format and returns the value that it represents.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475289062", "createdAt": "2020-08-24T00:33:25Z", "author": {"login": "dulajdilshan"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;\n+\n+# Parses a string in JSON format and returns the the value that it represents.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4NjE2MA==", "bodyText": "Fixed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475586160", "createdAt": "2020-08-24T13:06:56Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;\n+\n+# Parses a string in JSON format and returns the the value that it represents.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI4OTA2Mg=="}, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTM1NjQwOnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwMDozMzo0NVrOHFRWEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowNzowN1rOHFjezw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI4OTEwNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Parses a string in JSON format and returns the the value that it represents.\n          \n          \n            \n            # Parses a string in JSON format and returns the value that it represents.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475289107", "createdAt": "2020-08-24T00:33:45Z", "author": {"login": "dulajdilshan"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the the value that it represents.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4NjI1NQ==", "bodyText": "Fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475586255", "createdAt": "2020-08-24T13:07:07Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the the value that it represents.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI4OTEwNw=="}, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTU4MTU5OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwMzoyMjo1N1rOHFTUUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowNzo1N1rOHFjgwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyMTQyNg==", "bodyText": "We don't need !fromJsonFloatStringMode in first if condition due to second if else condition fromJsonFloatStringMode.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475321426", "createdAt": "2020-08-24T03:22:57Z", "author": {"login": "KRVPerera"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -874,28 +875,49 @@ private void processNonStringValue(ValueType type) throws JsonParserException {\n                     }\n                 } else {\n                     try {\n-                        long longValue = Long.parseLong(str);\n-                        switch (type) {\n-                            case ARRAY_ELEMENT:\n-                                ((ArrayValue) this.currentJsonNode).append(longValue);\n-                                break;\n-                            case FIELD:\n-                                ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n-                                        StringUtils.fromString(this.fieldNames.pop()), longValue);\n-                                break;\n-                            case VALUE:\n-                                currentJsonNode = longValue;\n-                                break;\n-                            default:\n-                                break;\n+                        if (ch == '-' && !fromJsonFloatStringMode && !fromJsonDecimalStringMode && isZero(str)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4Njc1Mg==", "bodyText": "Fixed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475586752", "createdAt": "2020-08-24T13:07:57Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -874,28 +875,49 @@ private void processNonStringValue(ValueType type) throws JsonParserException {\n                     }\n                 } else {\n                     try {\n-                        long longValue = Long.parseLong(str);\n-                        switch (type) {\n-                            case ARRAY_ELEMENT:\n-                                ((ArrayValue) this.currentJsonNode).append(longValue);\n-                                break;\n-                            case FIELD:\n-                                ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n-                                        StringUtils.fromString(this.fieldNames.pop()), longValue);\n-                                break;\n-                            case VALUE:\n-                                currentJsonNode = longValue;\n-                                break;\n-                            default:\n-                                break;\n+                        if (ch == '-' && !fromJsonFloatStringMode && !fromJsonDecimalStringMode && isZero(str)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyMTQyNg=="}, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTU4MjMyOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwMzoyMzozMVrOHFTUwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowNzo0MVrOHFjgHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyMTUzNw==", "bodyText": "We don't need !fromJsonFloatStringMode in first if condition due to second if else condition fromJsonFloatStringMode.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475321537", "createdAt": "2020-08-24T03:23:31Z", "author": {"login": "KRVPerera"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -806,23 +809,21 @@ public State transition(StateMachine sm, char[] buff, int i, int count) throws J\n         private void processNonStringValue(ValueType type) throws JsonParserException {\n             String str = value();\n             if (str.indexOf('.') >= 0) {\n+                char ch = str.charAt(0);\n                 try {\n-                    double doubleValue = Double.parseDouble(str);\n-                    switch (type) {\n-                        case ARRAY_ELEMENT:\n-                            ((ArrayValue) this.currentJsonNode).append(doubleValue);\n-                            break;\n-                        case FIELD:\n-                            ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n-                                    StringUtils.fromString(this.fieldNames.pop()), doubleValue);\n-                            break;\n-                        case VALUE:\n-                            currentJsonNode = doubleValue;\n-                            break;\n-                        default:\n-                            break;\n+                    if (ch == '-' && !fromJsonFloatStringMode && !fromJsonDecimalStringMode && isZero(str)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4NjU4OA==", "bodyText": "Fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475586588", "createdAt": "2020-08-24T13:07:41Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -806,23 +809,21 @@ public State transition(StateMachine sm, char[] buff, int i, int count) throws J\n         private void processNonStringValue(ValueType type) throws JsonParserException {\n             String str = value();\n             if (str.indexOf('.') >= 0) {\n+                char ch = str.charAt(0);\n                 try {\n-                    double doubleValue = Double.parseDouble(str);\n-                    switch (type) {\n-                        case ARRAY_ELEMENT:\n-                            ((ArrayValue) this.currentJsonNode).append(doubleValue);\n-                            break;\n-                        case FIELD:\n-                            ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n-                                    StringUtils.fromString(this.fieldNames.pop()), doubleValue);\n-                            break;\n-                        case VALUE:\n-                            currentJsonNode = doubleValue;\n-                            break;\n-                        default:\n-                            break;\n+                    if (ch == '-' && !fromJsonFloatStringMode && !fromJsonDecimalStringMode && isZero(str)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyMTUzNw=="}, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTU5Mzk3OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonFloatString.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwMzozMDo1MFrOHFTbIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMjowMDowNVrOHHIu7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyMzE2OQ==", "bodyText": "not sure a static state variable is a good idea. And to properly set it to false we may need to set it to false when there is an exception also.\nAlso when the condition str.equals(\"null\") is true we forget to set it back to false.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r475323169", "createdAt": "2020-08-24T03:30:50Z", "author": {"login": "KRVPerera"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonFloatString.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ *   Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.BallerinaErrors;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.util.exceptions.BallerinaException;\n+import org.ballerinalang.jvm.values.api.BString;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Parse a string in JSON format and return the the value that it represents.\n+ * All numbers in the JSON will be represented as float values.\n+ */\n+\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"fromJsonFloatString\",\n+        args = {@Argument(name = \"str\", type = TypeKind.STRING)},\n+        returnType = {@ReturnType(type = TypeKind.JSON), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = true\n+)\n+\n+public class FromJsonFloatString {\n+\n+    public static Object fromJsonFloatString(Strand strand, BString value) {\n+\n+        JSONParser.fromJsonFloatStringMode = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI0NTE2Ng==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r477245166", "createdAt": "2020-08-26T12:00:05Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonFloatString.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ *   Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.BallerinaErrors;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.util.exceptions.BallerinaException;\n+import org.ballerinalang.jvm.values.api.BString;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Parse a string in JSON format and return the the value that it represents.\n+ * All numbers in the JSON will be represented as float values.\n+ */\n+\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"fromJsonFloatString\",\n+        args = {@Argument(name = \"str\", type = TypeKind.STRING)},\n+        returnType = {@ReturnType(type = TypeKind.JSON), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = true\n+)\n+\n+public class FromJsonFloatString {\n+\n+    public static Object fromJsonFloatString(Strand strand, BString value) {\n+\n+        JSONParser.fromJsonFloatStringMode = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyMzE2OQ=="}, "originalCommit": {"oid": "d3c2fa78294e260469de8887289a32643f7b22d6"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3OTg1MzA1OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo1Mjo1NVrOHGjZsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMjowMDoyNFrOHHIvpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYzMzUyMQ==", "bodyText": "Can't we merge these two conditions, it seems that same this is doing in both cases.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r476633521", "createdAt": "2020-08-25T17:52:55Z", "author": {"login": "KavinduZoysa"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -806,23 +809,21 @@ public State transition(StateMachine sm, char[] buff, int i, int count) throws J\n         private void processNonStringValue(ValueType type) throws JsonParserException {\n             String str = value();\n             if (str.indexOf('.') >= 0) {\n+                char ch = str.charAt(0);\n                 try {\n-                    double doubleValue = Double.parseDouble(str);\n-                    switch (type) {\n-                        case ARRAY_ELEMENT:\n-                            ((ArrayValue) this.currentJsonNode).append(doubleValue);\n-                            break;\n-                        case FIELD:\n-                            ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n-                                    StringUtils.fromString(this.fieldNames.pop()), doubleValue);\n-                            break;\n-                        case VALUE:\n-                            currentJsonNode = doubleValue;\n-                            break;\n-                        default:\n-                            break;\n+                    if (ch == '-' && !fromJsonDecimalStringMode && isZero(str)) {\n+                        double doubleValue = Double.parseDouble(str);\n+                        setValueToJsonType(type, doubleValue);\n+                    } else if (fromJsonFloatStringMode) {\n+                        double doubleValue = Double.parseDouble(str);\n+                        setValueToJsonType(type, doubleValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef9d6b538c6d3bac94fb0a1562fd8f0d4a7f8898"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI0NTM1MQ==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r477245351", "createdAt": "2020-08-26T12:00:24Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -806,23 +809,21 @@ public State transition(StateMachine sm, char[] buff, int i, int count) throws J\n         private void processNonStringValue(ValueType type) throws JsonParserException {\n             String str = value();\n             if (str.indexOf('.') >= 0) {\n+                char ch = str.charAt(0);\n                 try {\n-                    double doubleValue = Double.parseDouble(str);\n-                    switch (type) {\n-                        case ARRAY_ELEMENT:\n-                            ((ArrayValue) this.currentJsonNode).append(doubleValue);\n-                            break;\n-                        case FIELD:\n-                            ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n-                                    StringUtils.fromString(this.fieldNames.pop()), doubleValue);\n-                            break;\n-                        case VALUE:\n-                            currentJsonNode = doubleValue;\n-                            break;\n-                        default:\n-                            break;\n+                    if (ch == '-' && !fromJsonDecimalStringMode && isZero(str)) {\n+                        double doubleValue = Double.parseDouble(str);\n+                        setValueToJsonType(type, doubleValue);\n+                    } else if (fromJsonFloatStringMode) {\n+                        double doubleValue = Double.parseDouble(str);\n+                        setValueToJsonType(type, doubleValue);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYzMzUyMQ=="}, "originalCommit": {"oid": "ef9d6b538c6d3bac94fb0a1562fd8f0d4a7f8898"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4ODY5NjY0OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoxODo0NVrOHH8OXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoxODo0NVrOHH8OXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4ODc5OA==", "bodyText": "Return type of fromJsonFloatString should be JsonFloat. This will fix with #25446", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r478088798", "createdAt": "2020-08-27T04:18:45Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4ODcxNjk2OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoyMjoyMlrOHH8cHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoyMjoyMlrOHH8cHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA5MjMxNg==", "bodyText": "Return type of fromJsonDecimalString should be JsonDecimal. This will fix with #25446", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r478092316", "createdAt": "2020-08-27T04:22:22Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;\n+\n+# Parses a string in JSON format and returns the value that it represents.\n+# All numbers in the JSON will be represented as decimal values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonDecimalString(string str) returns json|error = external;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjQwMjQ0OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNjoyODo0NVrOHLdxMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNTo0OToxNFrOHNw6lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc4NDExMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param mode    set the mode which process numeric values\n          \n          \n            \n                 * @param mode    the mode to use when processing numeric values", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r481784113", "createdAt": "2020-09-02T06:28:45Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -93,6 +101,18 @@ public static Object parse(String jsonStr) throws BallerinaException {\n         return parse(new StringReader(jsonStr));\n     }\n \n+    /**\n+     * Parses the contents in the given string and returns a json.\n+     *\n+     * @param jsonStr the string which contains the JSON content\n+     * @param mode    set the mode which process numeric values", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE5NDk2Nw==", "bodyText": "Fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r484194967", "createdAt": "2020-09-07T05:49:14Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -93,6 +101,18 @@ public static Object parse(String jsonStr) throws BallerinaException {\n         return parse(new StringReader(jsonStr));\n     }\n \n+    /**\n+     * Parses the contents in the given string and returns a json.\n+     *\n+     * @param jsonStr the string which contains the JSON content\n+     * @param mode    set the mode which process numeric values", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc4NDExMw=="}, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjQwNDE0OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNjoyOTowOFrOHLdyTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNTo0OTowMVrOHNw6Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc4NDM5OA==", "bodyText": "Shall we say\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return JSON structure\n          \n          \n            \n                 * @return JSON value if parsing is successful", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r481784398", "createdAt": "2020-09-02T06:29:08Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -93,6 +101,18 @@ public static Object parse(String jsonStr) throws BallerinaException {\n         return parse(new StringReader(jsonStr));\n     }\n \n+    /**\n+     * Parses the contents in the given string and returns a json.\n+     *\n+     * @param jsonStr the string which contains the JSON content\n+     * @param mode    set the mode which process numeric values\n+     * @return JSON structure", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE5NDkwNw==", "bodyText": "Fixed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r484194907", "createdAt": "2020-09-07T05:49:01Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -93,6 +101,18 @@ public static Object parse(String jsonStr) throws BallerinaException {\n         return parse(new StringReader(jsonStr));\n     }\n \n+    /**\n+     * Parses the contents in the given string and returns a json.\n+     *\n+     * @param jsonStr the string which contains the JSON content\n+     * @param mode    set the mode which process numeric values\n+     * @return JSON structure", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc4NDM5OA=="}, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjQxMzUyOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNjozMToxNlrOHLd4bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNTo0ODozOFrOHNw59Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc4NTk2Ng==", "bodyText": "This method seems to duplicate the logic in org.ballerinalang.jvm.JSONParser#parse(java.io.Reader). Shall we call this method from that by passing the default mode as the second arg?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r481785966", "createdAt": "2020-09-02T06:31:16Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -118,6 +138,26 @@ public static Object parse(Reader reader) throws BallerinaException {\n         }\n     }\n \n+    /**\n+     * Parses the contents in the given {@link Reader} and returns a json.\n+     *\n+     * @param reader reader which contains the JSON content\n+     * @param mode   set the mode which process numeric values\n+     * @return JSON structure\n+     * @throws BallerinaException for any parsing error\n+     */\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE5NDgwNQ==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r484194805", "createdAt": "2020-09-07T05:48:38Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -118,6 +138,26 @@ public static Object parse(Reader reader) throws BallerinaException {\n         }\n     }\n \n+    /**\n+     * Parses the contents in the given {@link Reader} and returns a json.\n+     *\n+     * @param reader reader which contains the JSON content\n+     * @param mode   set the mode which process numeric values\n+     * @return JSON structure\n+     * @throws BallerinaException for any parsing error\n+     */\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTc4NTk2Ng=="}, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjgyMDgxOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzo1NTowNVrOHLh_jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODo0Mjo0OVrOHN2Qbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg1MzMyNw==", "bodyText": "Would this static variable approach work with concurrent invocations of functions that use the JSON parser? We seem to be updating this via instance methods.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r481853327", "createdAt": "2020-09-02T07:55:05Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -181,6 +221,7 @@ public JsonParserException(String msg) {\n                 new StringFieldUnicodeHexProcessingState();\n         private static final State STRING_VALUE_UNICODE_HEX_PROCESSING_STATE =\n                 new StringValueUnicodeHexProcessingState();\n+        private static NonStringValueProcessingMode mode = NonStringValueProcessingMode.FROM_JSON_STRING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4MjQ3OA==", "bodyText": "Changed it as a non-static variable.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r484282478", "createdAt": "2020-09-07T08:42:49Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -181,6 +221,7 @@ public JsonParserException(String msg) {\n                 new StringFieldUnicodeHexProcessingState();\n         private static final State STRING_VALUE_UNICODE_HEX_PROCESSING_STATE =\n                 new StringValueUnicodeHexProcessingState();\n+        private static NonStringValueProcessingMode mode = NonStringValueProcessingMode.FROM_JSON_STRING;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg1MzMyNw=="}, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjgzNjI5OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzo1Nzo1MVrOHLiJUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNTo0ODoyM1rOHNw5qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg1NTgyNQ==", "bodyText": "Since we only use this in conjunction with ch == '-', IMO, we can change this method to something like isNegativeZero, and bring the ch == '-' check also into this method.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r481855825", "createdAt": "2020-09-02T07:57:51Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -896,6 +939,27 @@ private void processNonStringValue(ValueType type) throws JsonParserException {\n             }\n         }\n \n+        private void setValueToJsonType(ValueType type, Object value) {\n+            switch (type) {\n+                case ARRAY_ELEMENT:\n+                    ((ArrayValue) this.currentJsonNode).append(value);\n+                    break;\n+                case FIELD:\n+                    ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n+                            StringUtils.fromString(this.fieldNames.pop()), value);\n+                    break;\n+                case VALUE:\n+                    currentJsonNode = value;\n+                    break;\n+                default:\n+                    break;\n+            }\n+        }\n+\n+        private boolean isZero(String str) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 167}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE5NDcyOQ==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r484194729", "createdAt": "2020-09-07T05:48:23Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -896,6 +939,27 @@ private void processNonStringValue(ValueType type) throws JsonParserException {\n             }\n         }\n \n+        private void setValueToJsonType(ValueType type, Object value) {\n+            switch (type) {\n+                case ARRAY_ELEMENT:\n+                    ((ArrayValue) this.currentJsonNode).append(value);\n+                    break;\n+                case FIELD:\n+                    ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n+                            StringUtils.fromString(this.fieldNames.pop()), value);\n+                    break;\n+                case VALUE:\n+                    currentJsonNode = value;\n+                    break;\n+                default:\n+                    break;\n+            }\n+        }\n+\n+        private boolean isZero(String str) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg1NTgyNQ=="}, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 167}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjg0Mzc4OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonDecimalString.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzo1OToxN1rOHLiOTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNTo0NzozMVrOHNw44w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg1NzEwMg==", "bodyText": "Do we need a separate variable for this? If we do, IMO, it has to be final.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r481857102", "createdAt": "2020-09-02T07:59:17Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonDecimalString.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ *   Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.BallerinaErrors;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.util.exceptions.BallerinaException;\n+import org.ballerinalang.jvm.values.api.BString;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Parse a string in JSON format and return the the value that it represents.\n+ * All numbers in the JSON will be represented as decimal values.\n+ */\n+\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"fromJsonDecimalString\",\n+        args = {@Argument(name = \"str\", type = TypeKind.STRING)},\n+        returnType = {@ReturnType(type = TypeKind.JSON), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = true\n+)\n+\n+public class FromJsonDecimalString {\n+\n+    public static Object fromJsonDecimalString(Strand strand, BString value) {\n+\n+        JSONParser.NonStringValueProcessingMode mode = JSONParser.NonStringValueProcessingMode.FROM_JSON_DECIMAL_STRING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE5NDUzMQ==", "bodyText": "Removed that variable.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r484194531", "createdAt": "2020-09-07T05:47:31Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonDecimalString.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ *   Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.BallerinaErrors;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.util.exceptions.BallerinaException;\n+import org.ballerinalang.jvm.values.api.BString;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Parse a string in JSON format and return the the value that it represents.\n+ * All numbers in the JSON will be represented as decimal values.\n+ */\n+\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"fromJsonDecimalString\",\n+        args = {@Argument(name = \"str\", type = TypeKind.STRING)},\n+        returnType = {@ReturnType(type = TypeKind.JSON), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = true\n+)\n+\n+public class FromJsonDecimalString {\n+\n+    public static Object fromJsonDecimalString(Strand strand, BString value) {\n+\n+        JSONParser.NonStringValueProcessingMode mode = JSONParser.NonStringValueProcessingMode.FROM_JSON_DECIMAL_STRING;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg1NzEwMg=="}, "originalCommit": {"oid": "2354669bc22a5b40e53a480b309c7f100b85ff15"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNjk1MjYwOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMToyMTo1NlrOHPCrBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNToxMzozM1rOHREItg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzNDQ2OA==", "bodyText": "Shall we document these fields since these modes aren't quite intuitive when it comes to the JSONParser?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r485534468", "createdAt": "2020-09-09T11:21:56Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -53,6 +54,13 @@ public StateMachine initialValue() {\n         }\n     };\n \n+    /**\n+     * Represents the modes which process numeric values.\n+     */\n+    public enum NonStringValueProcessingMode {\n+        FROM_JSON_STRING, FROM_JSON_FLOAT_STRING, FROM_JSON_DECIMAL_STRING", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY1NTYwNg==", "bodyText": "Added.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r487655606", "createdAt": "2020-09-14T05:13:33Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -53,6 +54,13 @@ public StateMachine initialValue() {\n         }\n     };\n \n+    /**\n+     * Represents the modes which process numeric values.\n+     */\n+    public enum NonStringValueProcessingMode {\n+        FROM_JSON_STRING, FROM_JSON_FLOAT_STRING, FROM_JSON_DECIMAL_STRING", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzNDQ2OA=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNjk4MzAwOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTozMToyN1rOHPC9Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTo1MTo1M1rOHTeY0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng==", "bodyText": "Still not sure if we can set the mode directly to the state machine even though it is a thread local variable since we can have a scenario with multiple workers on the same thread?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r485539146", "createdAt": "2020-09-09T11:31:27Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIxNzQyMA==", "bodyText": "Looking at reset method I don't believe parser is created to be used by two workers on same thread.\n\n  \n    \n      ballerina-lang/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java\n    \n    \n         Line 202\n      in\n      4babdba\n    \n    \n    \n    \n\n        \n          \n           public void reset() {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r487217420", "createdAt": "2020-09-11T18:28:06Z", "author": {"login": "KRVPerera"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc3MDA1OA==", "bodyText": "Yeah, we'll have to verify this and introduce changes if required.\nI guess we can go ahead with Chiran's changes for the time-being if this is an issue in general, but let's verify first.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r488770058", "createdAt": "2020-09-15T15:42:24Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE0ODgyMg==", "bodyText": "@manuranga  Any suggestions?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r489148822", "createdAt": "2020-09-16T04:06:06Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE5MTcxMw==", "bodyText": "Ballerina schedule will reuse the same thread for multiple workers, but it uses a non-preemptive strategy. That is, we only yield and resume strands at given points. Since there are no resume points inside extern  code, java method should execute from the top each time (ie, atomic).\nTherefor, thread local state should be safe.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r489191713", "createdAt": "2020-09-16T06:25:24Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1MDkwNg==", "bodyText": "@chiranSachintha any workaround for adhering to this breaking API change. And please add the API doc description for this new param.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r489350906", "createdAt": "2020-09-16T11:01:52Z", "author": {"login": "BuddhiWathsala"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ4ODE0Mw==", "bodyText": "@manuranga, ack, thank you!", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r489488143", "createdAt": "2020-09-16T14:36:21Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE4Mjg2Ng==", "bodyText": "@chiranSachintha any workaround for adhering to this breaking API change. And please add the API doc description for this new param.\n\nFixed with this PR (#25881)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r490182866", "createdAt": "2020-09-17T11:51:53Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -107,8 +128,9 @@ private static Object changeForBString(Object jsonObj) {\n      * @return JSON structure\n      * @throws BallerinaException for any parsing error\n      */\n-    public static Object parse(Reader reader) throws BallerinaException {\n+    public static Object parse(Reader reader, NonStringValueProcessingMode mode) throws BallerinaException {\n         StateMachine sm = tlStateMachine.get();\n+        sm.mode = mode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTE0Ng=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNjk4NjM5OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTozMjoyMVrOHPC_Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNToxMzoxNlrOHREIZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTYzMA==", "bodyText": "Is this used?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r485539630", "createdAt": "2020-09-09T11:32:21Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -806,20 +830,21 @@ public State transition(StateMachine sm, char[] buff, int i, int count) throws J\n         private void processNonStringValue(ValueType type) throws JsonParserException {\n             String str = value();\n             if (str.indexOf('.') >= 0) {\n+                char ch = str.charAt(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY1NTUyNQ==", "bodyText": "No, Removed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r487655525", "createdAt": "2020-09-14T05:13:16Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -806,20 +830,21 @@ public State transition(StateMachine sm, char[] buff, int i, int count) throws J\n         private void processNonStringValue(ValueType type) throws JsonParserException {\n             String str = value();\n             if (str.indexOf('.') >= 0) {\n+                char ch = str.charAt(0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUzOTYzMA=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzAwOTM5OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTozODo1NFrOHPDM9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNToxMjo0MFrOHREH5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0MzE1OA==", "bodyText": "Can't we make this the default case and remove the one below?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r485543158", "createdAt": "2020-09-09T11:38:54Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -896,6 +921,27 @@ private void processNonStringValue(ValueType type) throws JsonParserException {\n             }\n         }\n \n+        private void setValueToJsonType(ValueType type, Object value) {\n+            switch (type) {\n+                case ARRAY_ELEMENT:\n+                    ((ArrayValue) this.currentJsonNode).append(value);\n+                    break;\n+                case FIELD:\n+                    ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n+                            StringUtils.fromString(this.fieldNames.pop()), value);\n+                    break;\n+                case VALUE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY1NTM5OQ==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r487655399", "createdAt": "2020-09-14T05:12:40Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -896,6 +921,27 @@ private void processNonStringValue(ValueType type) throws JsonParserException {\n             }\n         }\n \n+        private void setValueToJsonType(ValueType type, Object value) {\n+            switch (type) {\n+                case ARRAY_ELEMENT:\n+                    ((ArrayValue) this.currentJsonNode).append(value);\n+                    break;\n+                case FIELD:\n+                    ((MapValueImpl<BString, Object>) this.currentJsonNode).put(\n+                            StringUtils.fromString(this.fieldNames.pop()), value);\n+                    break;\n+                case VALUE:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0MzE1OA=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzAyNjU2OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonDecimalString.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTo0Mzo1NlrOHPDXLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNToxMjoxM1rOHREHeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0NTc3Mg==", "bodyText": "The prefix we use usually indicates the langlib module the error originates from, so in this case it has to be\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return BallerinaErrors.createError(\"{ballerina}FromJsonDecimalStringError\", e.getMessage());\n          \n          \n            \n                        return BallerinaErrors.createError(\"{ballerina/lang.value}FromJsonDecimalStringError\", e.getMessage());\n          \n      \n    \n    \n  \n\nfromJsonString also seems to have just {ballerina}.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r485545772", "createdAt": "2020-09-09T11:43:56Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonDecimalString.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ *   Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.BallerinaErrors;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.util.exceptions.BallerinaException;\n+import org.ballerinalang.jvm.values.api.BString;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Parse a string in JSON format and return the the value that it represents.\n+ * All numbers in the JSON will be represented as decimal values.\n+ */\n+\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"fromJsonDecimalString\",\n+        args = {@Argument(name = \"str\", type = TypeKind.STRING)},\n+        returnType = {@ReturnType(type = TypeKind.JSON), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = true\n+)\n+\n+public class FromJsonDecimalString {\n+\n+    public static Object fromJsonDecimalString(Strand strand, BString value) {\n+\n+        String str = value.getValue();\n+        if (str.equals(\"null\")) {\n+            return null;\n+        }\n+        try {\n+            return JSONParser.parse(str, JSONParser.NonStringValueProcessingMode.FROM_JSON_DECIMAL_STRING);\n+        } catch (BallerinaException e) {\n+            return BallerinaErrors.createError(\"{ballerina}FromJsonDecimalStringError\", e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY1NTI4OQ==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r487655289", "createdAt": "2020-09-14T05:12:13Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/java/org/ballerinalang/langlib/value/FromJsonDecimalString.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ *   Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.langlib.value;\n+\n+import org.ballerinalang.jvm.BallerinaErrors;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.scheduling.Strand;\n+import org.ballerinalang.jvm.util.exceptions.BallerinaException;\n+import org.ballerinalang.jvm.values.api.BString;\n+import org.ballerinalang.model.types.TypeKind;\n+import org.ballerinalang.natives.annotations.Argument;\n+import org.ballerinalang.natives.annotations.BallerinaFunction;\n+import org.ballerinalang.natives.annotations.ReturnType;\n+\n+import static org.ballerinalang.util.BLangCompilerConstants.VALUE_VERSION;\n+\n+/**\n+ * Parse a string in JSON format and return the the value that it represents.\n+ * All numbers in the JSON will be represented as decimal values.\n+ */\n+\n+@BallerinaFunction(\n+        orgName = \"ballerina\", packageName = \"lang.value\", version = VALUE_VERSION,\n+        functionName = \"fromJsonDecimalString\",\n+        args = {@Argument(name = \"str\", type = TypeKind.STRING)},\n+        returnType = {@ReturnType(type = TypeKind.JSON), @ReturnType(type = TypeKind.ERROR)},\n+        isPublic = true\n+)\n+\n+public class FromJsonDecimalString {\n+\n+    public static Object fromJsonDecimalString(Strand strand, BString value) {\n+\n+        String str = value.getValue();\n+        if (str.equals(\"null\")) {\n+            return null;\n+        }\n+        try {\n+            return JSONParser.parse(str, JSONParser.NonStringValueProcessingMode.FROM_JSON_DECIMAL_STRING);\n+        } catch (BallerinaException e) {\n+            return BallerinaErrors.createError(\"{ballerina}FromJsonDecimalStringError\", e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0NTc3Mg=="}, "originalCommit": {"oid": "69307e47af6918b273067e8c33247a51917fb8cc"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODAzNTU0OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNTowNDowMFrOHSGaBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTo1MjoxNVrOHTeZjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MTM4MQ==", "bodyText": "We can document this at field level.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * Represents the modes which process numeric values.\n          \n          \n            \n                 * FROM_JSON_STRING convert numeric values that starts with minus(-) and numerically equal zero(0) to -0.0f, numeric\n          \n          \n            \n                 * values that is syntactically an integer to int and all other numeric values to decimal while converting a string\n          \n          \n            \n                 * to JSON\n          \n          \n            \n                 * FROM_JSON_FLOAT_STRING convert all numerical values to float while converting a string to JSON\n          \n          \n            \n                 * FROM_JSON_DECIMAL_STRING convert all numerical values to decimal while converting a string to JSON\n          \n          \n            \n                 */\n          \n          \n            \n                public enum NonStringValueProcessingMode {\n          \n          \n            \n                    FROM_JSON_STRING, FROM_JSON_FLOAT_STRING, FROM_JSON_DECIMAL_STRING\n          \n          \n            \n                }\n          \n          \n            \n                /**\n          \n          \n            \n                 * Represents the modes which process numeric values while converting a string to JSON.\n          \n          \n            \n                 */\n          \n          \n            \n                public enum NonStringValueProcessingMode {\n          \n          \n            \n                    /**\n          \n          \n            \n                     * FROM_JSON_STRING converts a numeric value that\n          \n          \n            \n                     * - starts with the negative sign (-) and is numerically equal to zero (0) to `-0.0f`\n          \n          \n            \n                     * - is syntactically an integer to an `int`\n          \n          \n            \n                     * - doesn't belong to the above to decimal.\n          \n          \n            \n                     */\n          \n          \n            \n                    FROM_JSON_STRING,\n          \n          \n            \n            \n          \n          \n            \n                    /**\n          \n          \n            \n                     * FROM_JSON_FLOAT_STRING converts all numerical values to float.\n          \n          \n            \n                     */\n          \n          \n            \n                    FROM_JSON_FLOAT_STRING,\n          \n          \n            \n            \n          \n          \n            \n                    /**\n          \n          \n            \n                     * FROM_JSON_DECIMAL_STRING converts all numerical values to decimal.\n          \n          \n            \n                     */\n          \n          \n            \n                    FROM_JSON_DECIMAL_STRING\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\nSuggested a few changes to the documentation itself too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r488741381", "createdAt": "2020-09-15T15:04:00Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -53,6 +54,18 @@ public StateMachine initialValue() {\n         }\n     };\n \n+    /**\n+     * Represents the modes which process numeric values.\n+     * FROM_JSON_STRING convert numeric values that starts with minus(-) and numerically equal zero(0) to -0.0f, numeric\n+     * values that is syntactically an integer to int and all other numeric values to decimal while converting a string\n+     * to JSON\n+     * FROM_JSON_FLOAT_STRING convert all numerical values to float while converting a string to JSON\n+     * FROM_JSON_DECIMAL_STRING convert all numerical values to decimal while converting a string to JSON\n+     */\n+    public enum NonStringValueProcessingMode {\n+        FROM_JSON_STRING, FROM_JSON_FLOAT_STRING, FROM_JSON_DECIMAL_STRING\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33a2d5e0319784f974865b67ae9e4ca8760d910f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE4MzA1NA==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r490183054", "createdAt": "2020-09-17T11:52:15Z", "author": {"login": "chiranSachintha"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/JSONParser.java", "diffHunk": "@@ -53,6 +54,18 @@ public StateMachine initialValue() {\n         }\n     };\n \n+    /**\n+     * Represents the modes which process numeric values.\n+     * FROM_JSON_STRING convert numeric values that starts with minus(-) and numerically equal zero(0) to -0.0f, numeric\n+     * values that is syntactically an integer to int and all other numeric values to decimal while converting a string\n+     * to JSON\n+     * FROM_JSON_FLOAT_STRING convert all numerical values to float while converting a string to JSON\n+     * FROM_JSON_DECIMAL_STRING convert all numerical values to decimal while converting a string to JSON\n+     */\n+    public enum NonStringValueProcessingMode {\n+        FROM_JSON_STRING, FROM_JSON_FLOAT_STRING, FROM_JSON_DECIMAL_STRING\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MTM4MQ=="}, "originalCommit": {"oid": "33a2d5e0319784f974865b67ae9e4ca8760d910f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODA4NjE0OnYy", "diffSide": "RIGHT", "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNToxNDozMVrOHSG5VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTo1MjozMlrOHTeaBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0OTM5Ng==", "bodyText": "If this PR gets merged after merging the isolated function change, we need to mark these functions as isolated.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r488749396", "createdAt": "2020-09-15T15:14:31Z", "author": {"login": "MaryamZi"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33a2d5e0319784f974865b67ae9e4ca8760d910f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE5MDE0Nw==", "bodyText": "@chiranSachintha Can you send another PR making this Isolated.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r489190147", "createdAt": "2020-09-16T06:21:27Z", "author": {"login": "hasithaa"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0OTM5Ng=="}, "originalCommit": {"oid": "33a2d5e0319784f974865b67ae9e4ca8760d910f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE4MzE3Mg==", "bodyText": "Fixed with this PR (#25881)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25378#discussion_r490183172", "createdAt": "2020-09-17T11:52:32Z", "author": {"login": "chiranSachintha"}, "path": "langlib/lang.value/src/main/ballerina/src/lang.value/value.bal", "diffHunk": "@@ -140,13 +140,31 @@ public function toJson(anydata v) returns json = external;\n public function toJsonString(anydata v) returns string = external;\n \n # Parses a string in JSON format and returns the the value that it represents.\n-# All numbers in the JSON will be represented as float values.\n+# All integer numbers in the JSON will be represented as integer values.\n+# All decimal numbers except -0.0 in the JSON will be represent as decimal values.\n+# -0.0 in the JSON will be represent as float value.\n # Returns an error if the string cannot be parsed.\n #\n # + str - string representation of json\n # + return - `str` parsed to json or error\n public function fromJsonString(string str) returns json|error = external;\n \n+# Parses a string in JSON format and returns the value that it represents.\n+# All numbers in the JSON will be represented as float values.\n+# Returns an error if the string cannot be parsed.\n+#\n+# + str - string representation of json\n+# + return - `str` parsed to json or error\n+public function fromJsonFloatString(string str) returns json|error = external;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0OTM5Ng=="}, "originalCommit": {"oid": "33a2d5e0319784f974865b67ae9e4ca8760d910f"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 265, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}