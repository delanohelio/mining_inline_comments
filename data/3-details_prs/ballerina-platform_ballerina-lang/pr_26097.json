{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTMyNzQz", "number": 26097, "title": "Revamp add-documentation code-action to use new parser API", "bodyText": "Purpose\n\nRevamp add-documentation code-action to use new parser API.\n\nFixes #25112\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-25T08:56:06Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097", "merged": true, "mergeCommit": {"oid": "bb09a30a6e645fbc11bac4e41fda644132d73e2c"}, "closed": true, "closedAt": "2020-09-28T08:20:00Z", "author": {"login": "rasika"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMR3fBgH2gAyNDkyOTMyNzQzOmU3NDg3NmI0ZmI1NWEzMWYxYTcxMTE0NTM5MGFkOTIwMDk3Mjc3MWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNPLpggFqTQ5NzI4NTQzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e74876b4fb55a31f1a711145390ad9200972771c", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e74876b4fb55a31f1a711145390ad9200972771c", "committedDate": "2020-09-25T08:53:19Z", "message": "Revamp add-docs code-action to use new parser-api\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5839000fa4697db3ada8099f103b344d8fde0f1", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e5839000fa4697db3ada8099f103b344d8fde0f1", "committedDate": "2020-09-25T08:53:50Z", "message": "Remove unused code lenses\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fcbc28dc9da0847a2783a5cde11e30144e014235", "committedDate": "2020-09-25T08:54:34Z", "message": "Revamp add-doc code lense\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDUyMTYx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#pullrequestreview-497052161", "createdAt": "2020-09-27T05:20:19Z", "commit": {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNToyMDoxOVrOHYkx-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNToyMDoxOVrOHYkx-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMDQ4OA==", "bodyText": "We will need to get rid of the code lenses caching within the Document Manager. Once the new Semantic API and Project API is integrated let's remove this part", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495530488", "createdAt": "2020-09-27T05:20:19Z", "author": {"login": "nadeeshaan"}, "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/BallerinaTextDocumentService.java", "diffHunk": "@@ -495,9 +495,14 @@ void setClientCapabilities(LSClientCapabilities clientCapabilities) {\n \n             Path compilationPath = getUntitledFilePath(docSymbolFilePath.toString()).orElse(docSymbolFilePath.get());\n             Optional<Lock> lock = docManager.lockFile(compilationPath);\n+\n+            LSContext codeLensContext = new DocumentServiceOperationContext\n+                    .ServiceOperationContextBuilder(LSContextOperation.TXT_CODE_LENS)\n+                    .withCommonParams(null, fileUri, docManager)\n+                    .build();\n+\n             try {\n-                // Compile source document\n-                lenses = CodeLensUtil.compileAndGetCodeLenses(fileUri, docManager);\n+                lenses = CodeLensUtil.getCodeLenses(codeLensContext);\n                 docManager.setCodeLenses(compilationPath, lenses);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDUyNjEx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#pullrequestreview-497052611", "createdAt": "2020-09-27T05:30:00Z", "commit": {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNTozMDowMFrOHYk0nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNTozMDowMFrOHYk0nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMTE2Nw==", "bodyText": "Since we still use the AST nodes to get the node type, let's skip using the BLangNode. Let's calculate the top level node type to be the Syntax node type directly.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495531167", "createdAt": "2020-09-27T05:30:00Z", "author": {"login": "nadeeshaan"}, "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java", "diffHunk": "@@ -134,6 +135,22 @@ public static CodeActionNodeType topLevelNodeInLine(LSContext context, TextDocum\n                         && cursorLine == diagnosticPos.sLine) {\n                     return CodeActionNodeType.RECORD;\n                 }\n+\n+                if (topLevelNode instanceof BLangClassDefinition) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3Mjg1NDMz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#pullrequestreview-497285433", "createdAt": "2020-09-28T08:19:33Z", "commit": {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4669, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}