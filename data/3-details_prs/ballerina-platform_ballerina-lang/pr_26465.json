{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NDE1MTU0", "number": 26465, "title": "Change the formatter API to return an exception", "bodyText": "Purpose\nFixes #26381\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-10-21T10:07:43Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465", "merged": true, "mergeCommit": {"oid": "67b972a1f922b7722fdaba9a1a2b6f61f3d9ec22"}, "closed": true, "closedAt": "2020-10-28T08:47:37Z", "author": {"login": "IrushiL"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUsr76AH2gAyNTA3NDE1MTU0OmIwOWEwZTg5NDcyNTAyZWNjZmUwZWYwZTI4ZDc4ZWZlZGJmNTdjZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW5jYMAFqTUxODQzMzE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b09a0e89472502eccfe0ef0e28d78efedbf57cfe", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b09a0e89472502eccfe0ef0e28d78efedbf57cfe", "committedDate": "2020-10-21T12:39:32Z", "message": "Return an exception from the formatter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37bb184a127d8933d1fcf624c73dfe4d1aa42d06", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/37bb184a127d8933d1fcf624c73dfe4d1aa42d06", "committedDate": "2020-10-21T12:39:32Z", "message": "Fix formatting issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "149a3e43fbb36de07a504c8eb3540e5fcf3bd25d", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/149a3e43fbb36de07a504c8eb3540e5fcf3bd25d", "committedDate": "2020-10-21T12:39:32Z", "message": "Refactor the exception return in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ea6a6209c8b0c5033963f2967d1d217d4dca8ab", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4ea6a6209c8b0c5033963f2967d1d217d4dca8ab", "committedDate": "2020-10-21T12:39:32Z", "message": "Handle formatting exception in range formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "980057402b4e3efb131dade1554bf7e490c232db", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/980057402b4e3efb131dade1554bf7e490c232db", "committedDate": "2020-10-21T12:39:32Z", "message": "Refactor the exception handling in formatter cli"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17830fabc72f7290c994367f20add65fa681368e", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/17830fabc72f7290c994367f20add65fa681368e", "committedDate": "2020-10-21T12:39:32Z", "message": "Add the since annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjUyMDU5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465#pullrequestreview-514652059", "createdAt": "2020-10-22T12:07:17Z", "commit": {"oid": "51d8b8e78835830fbd6ee4d6635f2f3fc91f2833"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjowNzoxN1rOHmedTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjowOToxMFrOHmehcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwNjk1OQ==", "bodyText": "Does e.getMessage() always return the source name? Otherwise let's change the exception message", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465#discussion_r510106959", "createdAt": "2020-10-22T12:07:17Z", "author": {"login": "nadeeshaan"}, "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/Formatter.java", "diffHunk": "@@ -94,19 +96,20 @@ public static SyntaxTree format(SyntaxTree syntaxTree, LineRange range, Formatti\n      * @param syntaxTree The SyntaxTree which is to be formatted\n      * @param options Formatting options that are to be used when formatting\n      * @return The modified SyntaxTree after formatting changes\n+     * @throws FormatterException Exception caught while formatting\n      */\n-    public static SyntaxTree format(SyntaxTree syntaxTree, FormattingOptions options) {\n+    public static SyntaxTree format(SyntaxTree syntaxTree, FormattingOptions options) throws FormatterException {\n         return modifyTree(syntaxTree, options, null);\n     }\n \n-    private static SyntaxTree modifyTree(SyntaxTree syntaxTree, FormattingOptions options, LineRange range) {\n+    private static SyntaxTree modifyTree(SyntaxTree syntaxTree, FormattingOptions options, LineRange range)\n+            throws FormatterException {\n         FormattingTreeModifier treeModifier = new FormattingTreeModifier(options, range);\n         ModulePartNode modulePartNode = syntaxTree.rootNode();\n         try {\n             return syntaxTree.modifyWith(treeModifier.transform(modulePartNode));\n         } catch (Exception e) {\n-            LOGGER.error(String.format(\"Error while formatting the source: %s\", e.getMessage()));\n-            return syntaxTree;\n+            throw new FormatterException(\"Error while formatting the source: \" + e.getMessage(), e.getCause());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51d8b8e78835830fbd6ee4d6635f2f3fc91f2833"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEwODAxOA==", "bodyText": "Are we going to add test cases for these particular negative cases or just ignore them? If ignoring let's remove the commented code", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465#discussion_r510108018", "createdAt": "2020-10-22T12:09:10Z", "author": {"login": "nadeeshaan"}, "path": "misc/formatter/modules/formatter-core/src/test/java/org/ballerinalang/formatter/core/FormatterTest.java", "diffHunk": "@@ -59,8 +59,13 @@ public void test(String source, String sourcePath) throws IOException {\n         String content = getSourceText(sourceFilePath);\n         TextDocument textDocument = TextDocuments.from(content);\n         SyntaxTree syntaxTree = SyntaxTree.from(textDocument);\n-        SyntaxTree newSyntaxTree = Formatter.format(syntaxTree);\n-        Assert.assertEquals(newSyntaxTree.toSourceCode(), getSourceText(assertFilePath));\n+        try {\n+            SyntaxTree newSyntaxTree = Formatter.format(syntaxTree);\n+            Assert.assertEquals(newSyntaxTree.toSourceCode(), getSourceText(assertFilePath));\n+        } catch (FormatterException e) {\n+            // TODO: handle the test cases causing formatting exceptions\n+//            Assert.fail(e.getMessage(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51d8b8e78835830fbd6ee4d6635f2f3fc91f2833"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc15a08154385580417da33a4b79feb2a87e9635", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dc15a08154385580417da33a4b79feb2a87e9635", "committedDate": "2020-10-27T07:24:23Z", "message": "Fix the error message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51d8b8e78835830fbd6ee4d6635f2f3fc91f2833", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51d8b8e78835830fbd6ee4d6635f2f3fc91f2833", "committedDate": "2020-10-21T10:10:29Z", "message": "Add the since annotation"}, "afterCommit": {"oid": "dc15a08154385580417da33a4b79feb2a87e9635", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dc15a08154385580417da33a4b79feb2a87e9635", "committedDate": "2020-10-27T07:24:23Z", "message": "Fix the error message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NDM1MDI4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465#pullrequestreview-517435028", "createdAt": "2020-10-27T08:09:42Z", "commit": {"oid": "dc15a08154385580417da33a4b79feb2a87e9635"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwODowOTo0MlrOHovpQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwODowOTo0MlrOHovpQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4NTY5Nw==", "bodyText": "Can directly use content here", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465#discussion_r512485697", "createdAt": "2020-10-27T08:09:42Z", "author": {"login": "SupunS"}, "path": "misc/formatter/modules/formatter-core/src/test/java/org/ballerinalang/formatter/core/FormatterTest.java", "diffHunk": "@@ -74,8 +79,13 @@ public void testParserResources(String sourcePath) throws IOException {\n         TextDocument textDocument = TextDocuments.from(content);\n         SyntaxTree syntaxTree = SyntaxTree.from(textDocument);\n         if (!syntaxTree.hasDiagnostics()) {\n-            SyntaxTree newSyntaxTree = Formatter.format(syntaxTree);\n-            Assert.assertEquals(newSyntaxTree.toSourceCode(), getSourceText(filePath));\n+            try {\n+                SyntaxTree newSyntaxTree = Formatter.format(syntaxTree);\n+                Assert.assertEquals(newSyntaxTree.toSourceCode(), getSourceText(filePath));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc15a08154385580417da33a4b79feb2a87e9635"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9178fbfe10faf6fbff444c65769b7b4c938fc887", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9178fbfe10faf6fbff444c65769b7b4c938fc887", "committedDate": "2020-10-27T09:29:19Z", "message": "Fix review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be2ca832a3e7a357e75214e0ead0c71ad2e2b15e", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/be2ca832a3e7a357e75214e0ead0c71ad2e2b15e", "committedDate": "2020-10-28T07:56:47Z", "message": "Fix review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDMzMTYz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26465#pullrequestreview-518433163", "createdAt": "2020-10-28T08:46:48Z", "commit": {"oid": "be2ca832a3e7a357e75214e0ead0c71ad2e2b15e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4442, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}