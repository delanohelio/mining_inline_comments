{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNDc3OTA5", "number": 26948, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNjowMzoyNFrOE643fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNTowNzowMFrOE8Qfiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTg0NTc0OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNjowMzoyNFrOH2N8-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNjowMzoyNFrOH2N8-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYxMzc1Mg==", "bodyText": "let's run this into early return to avoid too many nesting", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526613752", "createdAt": "2020-11-19T06:03:24Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+import com.moandjiezana.toml.Toml;\n+import io.ballerina.runtime.api.Module;\n+import io.ballerina.runtime.api.TypeTags;\n+import io.ballerina.runtime.internal.configurable.exceptions.TomlException;\n+import io.ballerina.runtime.internal.util.RuntimeUtils;\n+import io.ballerina.runtime.internal.values.BmpStringValue;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.CONFIG_FILE_NAME;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_TOML_FILE;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_VARIABLE_TYPE;\n+\n+/**\n+ * Toml parser for configurable implementation.\n+ *\n+ * @since 2.0.0\n+ */\n+public class TomlParser {\n+\n+    static final Path CONFIG_FILE_PATH = Paths.get(RuntimeUtils.USER_DIR).resolve(CONFIG_FILE_NAME);\n+\n+    private static Toml getConfigurationData() throws TomlException {\n+        if (!Files.exists(CONFIG_FILE_PATH)) {\n+            throw new TomlException(\"Configuration toml file `\" + CONFIG_FILE_NAME + \"` is not found\");\n+        }\n+        return new Toml().read(CONFIG_FILE_PATH.toFile());\n+    }\n+\n+    public static void populateConfigMap(String module, VariableKey[] configurationData) throws TomlException {\n+        Map<VariableKey, Object> configurableMap = ConfigurableMapHolder.getConfigurationMap();\n+        if (isConfigurationDataEmpty(configurationData)) {\n+            return;\n+        }\n+        Toml toml = getConfigurationData();\n+        if (toml != null && !toml.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTg1MDIxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNjowNToyMVrOH2N_ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNjowNToyMVrOH2N_ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYxNDQxMA==", "bodyText": "lets combine the ifs, use boolean variables if needed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526614410", "createdAt": "2020-11-19T06:05:21Z", "author": {"login": "manuranga"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -726,8 +726,23 @@ public void visit(BLangPackage pkgNode) {\n         }\n \n         pkgNode.globalVars.forEach(globalVar -> {\n-            BLangAssignment assignment = createAssignmentStmt(globalVar);\n-            if (assignment.expr != null) {\n+            long globalVarFlags = globalVar.symbol.flags;\n+            if (globalVar.expr != null || Symbols.isFlagOn(globalVarFlags, Flags.CONFIGURABLE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjM0MDQ1OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/ConfigurableConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1MToxNVrOH2Simg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1MToxNVrOH2Simg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4ODkyMg==", "bodyText": "Shall we remove addtional empty lines.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526688922", "createdAt": "2020-11-19T08:51:15Z", "author": {"login": "warunalakshitha"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/ConfigurableConstants.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+/**\n+ * Constants used by toml parser.\n+ *\n+ * @since 2.0.0\n+ */\n+public class ConfigurableConstants {\n+    public static final String CONFIG_FILE_NAME = \"config-variables.toml\";\n+    public static final String INVALID_TOML_FILE = \"Invalid configuration toml file `\" + CONFIG_FILE_NAME + \"` : \";\n+    public static final String INVALID_VARIABLE_TYPE =\n+            \"Invalid value type found for variable '%s' in toml file `\" + CONFIG_FILE_NAME + \"` \";\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjM1MjM5OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1NDoxNFrOH2Sp8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1NDoxNFrOH2Sp8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY5MDgwMg==", "bodyText": "We can directly return false here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526690802", "createdAt": "2020-11-19T08:54:14Z", "author": {"login": "warunalakshitha"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+import com.moandjiezana.toml.Toml;\n+import io.ballerina.runtime.api.Module;\n+import io.ballerina.runtime.api.TypeTags;\n+import io.ballerina.runtime.internal.configurable.exceptions.TomlException;\n+import io.ballerina.runtime.internal.util.RuntimeUtils;\n+import io.ballerina.runtime.internal.values.BmpStringValue;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.CONFIG_FILE_NAME;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_TOML_FILE;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_VARIABLE_TYPE;\n+\n+/**\n+ * Toml parser for configurable implementation.\n+ *\n+ * @since 2.0.0\n+ */\n+public class TomlParser {\n+\n+    static final Path CONFIG_FILE_PATH = Paths.get(RuntimeUtils.USER_DIR).resolve(CONFIG_FILE_NAME);\n+\n+    private static Toml getConfigurationData() throws TomlException {\n+        if (!Files.exists(CONFIG_FILE_PATH)) {\n+            throw new TomlException(\"Configuration toml file `\" + CONFIG_FILE_NAME + \"` is not found\");\n+        }\n+        return new Toml().read(CONFIG_FILE_PATH.toFile());\n+    }\n+\n+    public static void populateConfigMap(String module, VariableKey[] configurationData) throws TomlException {\n+        Map<VariableKey, Object> configurableMap = ConfigurableMapHolder.getConfigurationMap();\n+        if (isConfigurationDataEmpty(configurationData)) {\n+            return;\n+        }\n+        Toml toml = getConfigurationData();\n+        if (toml != null && !toml.isEmpty()) {\n+            String orgName = configurationData[0].module.getOrg();\n+            validateOrganizationName(toml, orgName);\n+            for (Map.Entry<String, Object> organizaion : toml.entrySet()) {\n+                Toml moduleToml = extractModuleTable((Toml) organizaion.getValue(), module);\n+                for (VariableKey key : configurationData) {\n+                    Object value = validateAndExtractValue(key, moduleToml);\n+                    if (value == null) {\n+                        //This indicates the value not provided at toml file\n+                        break;\n+                    }\n+                    configurableMap.put(key, value);\n+                }\n+            }\n+        }\n+    }\n+\n+    private static Object validateAndExtractValue(VariableKey key, Toml moduleToml) throws TomlException {\n+        String variableName = key.variable;\n+        if (!moduleToml.contains(variableName)) {\n+            return null;\n+        }\n+        Object value;\n+        try {\n+            switch (key.type.getTag()) {\n+                case TypeTags.INT_TAG:\n+                    value = moduleToml.getLong(variableName);\n+                    break;\n+                case TypeTags.BOOLEAN_TAG:\n+                    value = moduleToml.getBoolean(variableName);\n+                    break;\n+                case TypeTags.FLOAT_TAG:\n+                    value = moduleToml.getDouble(variableName);\n+                    break;\n+                case TypeTags.STRING_TAG:\n+                    value = new BmpStringValue(moduleToml.getString(variableName));\n+                    break;\n+                default:\n+                    throw new TomlException(String.format(\"Configurable feature is yet to be supported for type '%s'\",\n+                            key.type.toString()));\n+            }\n+        } catch (ClassCastException e) {\n+            throw new TomlException(String.format(INVALID_VARIABLE_TYPE, key.variable));\n+        }\n+        return value;\n+    }\n+\n+    private static Toml extractModuleTable(Toml modules, String module) {\n+\n+        Toml moduleToml = modules;\n+        if (!module.contains(\".\")) {\n+            moduleToml = modules.getTable(module);\n+        } else {\n+            String parent = module.substring(0, module.indexOf('.'));\n+            String submodule = module.substring(module.indexOf('.') + 1);\n+            moduleToml = extractModuleTable(moduleToml.getTable(parent), submodule);\n+        }\n+        return moduleToml;\n+    }\n+\n+    private static void validateVariableType(VariableKey tomlKey, VariableKey[] configurationData)\n+            throws TomlException {\n+\n+        List<VariableKey> dataList = Arrays.asList(configurationData);\n+        boolean moduleFound = false;\n+        for (VariableKey variableKey : configurationData) {\n+            Module confModule = variableKey.module;\n+            moduleFound = confModule.equals(tomlKey.module);\n+        }\n+\n+        if (!moduleFound) {\n+            throw new TomlException(INVALID_TOML_FILE + \"Module name not found.\");\n+\n+        }\n+\n+    }\n+\n+    private static void validateOrganizationName(Toml toml, String orgName) throws TomlException {\n+        if (toml.entrySet().size() != 1) {\n+            throw new TomlException(INVALID_TOML_FILE + \"Multiple organization names found.\");\n+        }\n+        if (!toml.contains(orgName)) {\n+            throw new TomlException(INVALID_TOML_FILE + \"Organization name '\" + orgName + \"' not found.\");\n+        }\n+    }\n+\n+    private static boolean isConfigurationDataEmpty(VariableKey[] configurationData) {\n+        boolean empty = true;\n+        for (VariableKey variableKey : configurationData) {\n+            if (variableKey != null) {\n+                empty = false;\n+                break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 152}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjM1NDYwOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1NDo0NFrOH2SrUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1NDo0NFrOH2SrUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY5MTE1Mw==", "bodyText": "Why can't we check configurableData size", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526691153", "createdAt": "2020-11-19T08:54:44Z", "author": {"login": "warunalakshitha"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+import com.moandjiezana.toml.Toml;\n+import io.ballerina.runtime.api.Module;\n+import io.ballerina.runtime.api.TypeTags;\n+import io.ballerina.runtime.internal.configurable.exceptions.TomlException;\n+import io.ballerina.runtime.internal.util.RuntimeUtils;\n+import io.ballerina.runtime.internal.values.BmpStringValue;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.CONFIG_FILE_NAME;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_TOML_FILE;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_VARIABLE_TYPE;\n+\n+/**\n+ * Toml parser for configurable implementation.\n+ *\n+ * @since 2.0.0\n+ */\n+public class TomlParser {\n+\n+    static final Path CONFIG_FILE_PATH = Paths.get(RuntimeUtils.USER_DIR).resolve(CONFIG_FILE_NAME);\n+\n+    private static Toml getConfigurationData() throws TomlException {\n+        if (!Files.exists(CONFIG_FILE_PATH)) {\n+            throw new TomlException(\"Configuration toml file `\" + CONFIG_FILE_NAME + \"` is not found\");\n+        }\n+        return new Toml().read(CONFIG_FILE_PATH.toFile());\n+    }\n+\n+    public static void populateConfigMap(String module, VariableKey[] configurationData) throws TomlException {\n+        Map<VariableKey, Object> configurableMap = ConfigurableMapHolder.getConfigurationMap();\n+        if (isConfigurationDataEmpty(configurationData)) {\n+            return;\n+        }\n+        Toml toml = getConfigurationData();\n+        if (toml != null && !toml.isEmpty()) {\n+            String orgName = configurationData[0].module.getOrg();\n+            validateOrganizationName(toml, orgName);\n+            for (Map.Entry<String, Object> organizaion : toml.entrySet()) {\n+                Toml moduleToml = extractModuleTable((Toml) organizaion.getValue(), module);\n+                for (VariableKey key : configurationData) {\n+                    Object value = validateAndExtractValue(key, moduleToml);\n+                    if (value == null) {\n+                        //This indicates the value not provided at toml file\n+                        break;\n+                    }\n+                    configurableMap.put(key, value);\n+                }\n+            }\n+        }\n+    }\n+\n+    private static Object validateAndExtractValue(VariableKey key, Toml moduleToml) throws TomlException {\n+        String variableName = key.variable;\n+        if (!moduleToml.contains(variableName)) {\n+            return null;\n+        }\n+        Object value;\n+        try {\n+            switch (key.type.getTag()) {\n+                case TypeTags.INT_TAG:\n+                    value = moduleToml.getLong(variableName);\n+                    break;\n+                case TypeTags.BOOLEAN_TAG:\n+                    value = moduleToml.getBoolean(variableName);\n+                    break;\n+                case TypeTags.FLOAT_TAG:\n+                    value = moduleToml.getDouble(variableName);\n+                    break;\n+                case TypeTags.STRING_TAG:\n+                    value = new BmpStringValue(moduleToml.getString(variableName));\n+                    break;\n+                default:\n+                    throw new TomlException(String.format(\"Configurable feature is yet to be supported for type '%s'\",\n+                            key.type.toString()));\n+            }\n+        } catch (ClassCastException e) {\n+            throw new TomlException(String.format(INVALID_VARIABLE_TYPE, key.variable));\n+        }\n+        return value;\n+    }\n+\n+    private static Toml extractModuleTable(Toml modules, String module) {\n+\n+        Toml moduleToml = modules;\n+        if (!module.contains(\".\")) {\n+            moduleToml = modules.getTable(module);\n+        } else {\n+            String parent = module.substring(0, module.indexOf('.'));\n+            String submodule = module.substring(module.indexOf('.') + 1);\n+            moduleToml = extractModuleTable(moduleToml.getTable(parent), submodule);\n+        }\n+        return moduleToml;\n+    }\n+\n+    private static void validateVariableType(VariableKey tomlKey, VariableKey[] configurationData)\n+            throws TomlException {\n+\n+        List<VariableKey> dataList = Arrays.asList(configurationData);\n+        boolean moduleFound = false;\n+        for (VariableKey variableKey : configurationData) {\n+            Module confModule = variableKey.module;\n+            moduleFound = confModule.equals(tomlKey.module);\n+        }\n+\n+        if (!moduleFound) {\n+            throw new TomlException(INVALID_TOML_FILE + \"Module name not found.\");\n+\n+        }\n+\n+    }\n+\n+    private static void validateOrganizationName(Toml toml, String orgName) throws TomlException {\n+        if (toml.entrySet().size() != 1) {\n+            throw new TomlException(INVALID_TOML_FILE + \"Multiple organization names found.\");\n+        }\n+        if (!toml.contains(orgName)) {\n+            throw new TomlException(INVALID_TOML_FILE + \"Organization name '\" + orgName + \"' not found.\");\n+        }\n+    }\n+\n+    private static boolean isConfigurationDataEmpty(VariableKey[] configurationData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjM2MTI1OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/module-info.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1NjoyNFrOH2Svjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1NjoyNFrOH2Svjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY5MjIzOQ==", "bodyText": "Shall we add specific modules to export here than exporting to all modules outside.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526692239", "createdAt": "2020-11-19T08:56:24Z", "author": {"login": "warunalakshitha"}, "path": "bvm/ballerina-runtime/src/main/java/module-info.java", "diffHunk": "@@ -55,4 +56,5 @@\n             io.ballerina.lang.floatingpoint, io.ballerina.lang.map, io.ballerina.lang.string, io.ballerina.lang.table,\n             io.ballerina.lang.xml, io.ballerina.testerina.core, io.ballerina.cli.utils;\n     exports io.ballerina.runtime.internal.values to io.ballerina.testerina.core, io.ballerina.testerina.runtime;\n+    exports io.ballerina.runtime.internal.configurable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjQ1NzgyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwOToyMDoyN1rOH2TqxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwOToyMDoyN1rOH2TqxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcwNzM5Ng==", "bodyText": "Better to create a git issue for Todos for future reference", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r526707396", "createdAt": "2020-11-19T09:20:27Z", "author": {"login": "warunalakshitha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -586,14 +586,19 @@ public BLangNode transform(ModuleVariableDeclarationNode modVarDeclrNode) {\n         }\n \n         boolean isFinal = false;\n+        boolean isConfigurable = false;\n+        // TODO handle this inside createSimpleVar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0a0fa4bd8c42a24547b63ba5e6d3d6a9ee5e2e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDkwMDI2OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/VariableKey.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTozMzo1MVrOH4FS5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo0MDo0MVrOH4FjdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU2OTA2MA==", "bodyText": "is there any reason why this is not Objects.hash(module, variable, type)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r528569060", "createdAt": "2020-11-23T09:33:51Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/VariableKey.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+import io.ballerina.runtime.api.Module;\n+import io.ballerina.runtime.api.types.Type;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Class that represents the key for configurable variables.\n+ *\n+ * @since 2.0.0\n+ */\n+public class VariableKey {\n+    Module module;\n+    String variable;\n+    Type type;\n+\n+    public VariableKey(String org, String module, String version, String variable) {\n+        this.module = new Module(org, module, version);\n+        this.variable = variable;\n+        this.type = null;\n+    }\n+\n+    public VariableKey(Module module, String variable) {\n+        this.module = module;\n+        this.variable = variable;\n+        this.type = null;\n+    }\n+\n+    public VariableKey(String org, String module, String version, String variable, Type type) {\n+        this.module = new Module(org, module, version);\n+        this.variable = variable;\n+        this.type = type;\n+    }\n+\n+    public VariableKey(Module module, String variable, Type type) {\n+        this.module = module;\n+        this.variable = variable;\n+        this.type = type;\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) {\n+            return true;\n+        }\n+        if (o == null || getClass() != o.getClass()) {\n+            return false;\n+        }\n+        VariableKey variableKey = (VariableKey) o;\n+        boolean isEqual = Objects.equals(module, variableKey.module) &&\n+                Objects.equals(variable, variableKey.variable);\n+        if (type == null || variableKey.type == null) {\n+            return isEqual;\n+        }\n+        return isEqual && Objects.equals(type, variableKey.type);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(module, variable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b254d94e0d33fc01fef7849ad716510ab251b951"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU3MzMwMA==", "bodyText": "when we access the map at runtime (from .internal.runtime langlib), the type information of the variable is not available. So the equals can only check  module & variable", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r528573300", "createdAt": "2020-11-23T09:40:41Z", "author": {"login": "HindujaB"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/VariableKey.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+import io.ballerina.runtime.api.Module;\n+import io.ballerina.runtime.api.types.Type;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Class that represents the key for configurable variables.\n+ *\n+ * @since 2.0.0\n+ */\n+public class VariableKey {\n+    Module module;\n+    String variable;\n+    Type type;\n+\n+    public VariableKey(String org, String module, String version, String variable) {\n+        this.module = new Module(org, module, version);\n+        this.variable = variable;\n+        this.type = null;\n+    }\n+\n+    public VariableKey(Module module, String variable) {\n+        this.module = module;\n+        this.variable = variable;\n+        this.type = null;\n+    }\n+\n+    public VariableKey(String org, String module, String version, String variable, Type type) {\n+        this.module = new Module(org, module, version);\n+        this.variable = variable;\n+        this.type = type;\n+    }\n+\n+    public VariableKey(Module module, String variable, Type type) {\n+        this.module = module;\n+        this.variable = variable;\n+        this.type = type;\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) {\n+            return true;\n+        }\n+        if (o == null || getClass() != o.getClass()) {\n+            return false;\n+        }\n+        VariableKey variableKey = (VariableKey) o;\n+        boolean isEqual = Objects.equals(module, variableKey.module) &&\n+                Objects.equals(variable, variableKey.variable);\n+        if (type == null || variableKey.type == null) {\n+            return isEqual;\n+        }\n+        return isEqual && Objects.equals(type, variableKey.type);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(module, variable);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU2OTA2MA=="}, "originalCommit": {"oid": "b254d94e0d33fc01fef7849ad716510ab251b951"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTA2OTExOnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-config/src/main/java/module-info.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDoxNjowOVrOH4G43Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDoxNjowOVrOH4G43Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU5NTE2NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r528595165", "createdAt": "2020-11-23T10:16:09Z", "author": {"login": "riyafa"}, "path": "bvm/ballerina-config/src/main/java/module-info.java", "diffHunk": "@@ -1,5 +1,6 @@\n module io.ballerina.config {\n     requires org.apache.commons.lang3;\n+    requires toml4j;\n     exports org.ballerinalang.config;\n     exports org.ballerinalang.config.cipher;\n }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ceee96b8df4f67eb8520aa0229778e257b668bf"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNjE3ODE0OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNTowMTo1NlrOH4RVeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNTowMTo1NlrOH4RVeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc2NjMyOQ==", "bodyText": "lets add expected type\n#27096", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r528766329", "createdAt": "2020-11-23T15:01:56Z", "author": {"login": "manuranga"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/TomlParser.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+import com.moandjiezana.toml.Toml;\n+import io.ballerina.runtime.api.Module;\n+import io.ballerina.runtime.api.TypeTags;\n+import io.ballerina.runtime.api.utils.StringUtils;\n+import io.ballerina.runtime.internal.configurable.exceptions.TomlException;\n+import io.ballerina.runtime.internal.util.RuntimeUtils;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Map;\n+\n+import static io.ballerina.runtime.api.constants.RuntimeConstants.ANON_ORG;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.CONFIG_FILE_NAME;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.DEFAULT_MODULE;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_TOML_FILE;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.INVALID_VARIABLE_TYPE;\n+import static io.ballerina.runtime.internal.configurable.ConfigurableConstants.SUBMODULE_DELIMITER;\n+\n+/**\n+ * Toml parser for configurable implementation.\n+ *\n+ * @since 2.0.0\n+ */\n+public class TomlParser {\n+\n+    static final Path CONFIG_FILE_PATH = Paths.get(RuntimeUtils.USER_DIR).resolve(CONFIG_FILE_NAME);\n+\n+    private static Toml getConfigurationData() throws TomlException {\n+        if (!Files.exists(CONFIG_FILE_PATH)) {\n+            throw new TomlException(\"Configuration toml file `\" + CONFIG_FILE_NAME + \"` is not found\");\n+        }\n+        try {\n+            return new Toml().read(CONFIG_FILE_PATH.toFile());\n+        } catch (RuntimeException exception) {\n+            throw new TomlException(INVALID_TOML_FILE + exception.getCause().getMessage());\n+        }\n+    }\n+\n+    public static void populateConfigMap(Map<Module, VariableKey[]> configurationData) throws TomlException {\n+        if (configurationData.isEmpty()) {\n+            return;\n+        }\n+        Toml toml = getConfigurationData();\n+        if (toml.isEmpty()) {\n+            //No values provided at toml file\n+            return;\n+        }\n+        for (Map.Entry<Module, VariableKey[]> moduleEntry : configurationData.entrySet()) {\n+            String orgName = moduleEntry.getKey().getOrg();\n+            String moduleName = moduleEntry.getKey().getName();\n+            Toml orgToml = orgName.equals(ANON_ORG) ? toml : extractOrganizationTable(toml, orgName);\n+            Toml moduleToml = moduleName.equals(DEFAULT_MODULE) ? orgToml : extractModuleTable(orgToml, moduleName);\n+            for (VariableKey key : moduleEntry.getValue()) {\n+                if (!moduleToml.contains(key.variable)) {\n+                    //It is an optional configurable variable\n+                    break;\n+                }\n+                Object value = validateAndExtractValue(key, moduleToml);\n+                ConfigurableMap.put(key, value);\n+            }\n+        }\n+    }\n+\n+    private static Object validateAndExtractValue(VariableKey key, Toml moduleToml) throws TomlException {\n+        String variableName = key.variable;\n+        Object value;\n+        try {\n+            switch (key.type.getTag()) {\n+                case TypeTags.INT_TAG:\n+                    value = moduleToml.getLong(variableName);\n+                    break;\n+                case TypeTags.BOOLEAN_TAG:\n+                    value = moduleToml.getBoolean(variableName);\n+                    break;\n+                case TypeTags.FLOAT_TAG:\n+                    value = moduleToml.getDouble(variableName);\n+                    break;\n+                case TypeTags.STRING_TAG:\n+                    value = StringUtils.fromString(moduleToml.getString(variableName));\n+                    break;\n+                default:\n+                    throw new TomlException(String.format(\"Configurable feature is yet to be supported for type '%s'\",\n+                            key.type.toString()));\n+            }\n+        } catch (ClassCastException e) {\n+            throw new TomlException(INVALID_TOML_FILE + String.format(INVALID_VARIABLE_TYPE, variableName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8defaae5d5305cdb2f618ebc198b49e4dd0c637"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNjIwMjM1OnYy", "diffSide": "RIGHT", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/ConfigurableConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNTowNzowMFrOH4RkTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNTowNzowMFrOH4RkTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc3MDEyNQ==", "bodyText": "Created issue for this. #27096", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26948#discussion_r528770125", "createdAt": "2020-11-23T15:07:00Z", "author": {"login": "hasithaa"}, "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/internal/configurable/ConfigurableConstants.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.ballerina.runtime.internal.configurable;\n+\n+/**\n+ * Constants used by toml parser.\n+ *\n+ * @since 2.0.0\n+ */\n+public class ConfigurableConstants {\n+    public static final String CONFIG_FILE_NAME = \"configuration.toml\";\n+    public static final String INVALID_TOML_FILE = \"Invalid `\" + CONFIG_FILE_NAME + \"` file : \";\n+    public static final String INVALID_VARIABLE_TYPE = \"invalid type found for variable '%s'.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8defaae5d5305cdb2f618ebc198b49e4dd0c637"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3009, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}