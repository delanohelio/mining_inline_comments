{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MzA2MjAw", "number": 24747, "reviewThreads": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowMTowNlrOEOnYxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMjoxNjoxNFrOEPGnXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzYwODM4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowMTowNlrOGx3J3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozMjo1MVrOGx4MIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzNzA1NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        String packageName = functionName.substring(functionName.indexOf(\"/\") + 1, functionName.indexOf(\":\"));\n          \n          \n            \n                        String packageName = functionName.substring(functionName.indexOf('/') + 1, functionName.indexOf(':'));\n          \n      \n    \n    \n  \n\nFaster indexOf method by using char", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454937055", "createdAt": "2020-07-15T10:01:06Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -102,15 +96,33 @@ public void generateMockFunctions(BLangPackage pkgNode) {\n         Set<String> mockFunctionSet = mockFunctionMap.keySet();\n \n         for (String function: mockFunctionSet) {\n-            if (!function.contains(\"#\")) { // Check added to skip desugaring for previous implementation mock functions\n-                pkgNode.getTestablePkg().functions.add(generateMockFunction(function));\n-            }\n+            pkgNode.getTestablePkg().functions.add(generateMockFunction(function));\n         }\n     }\n \n     private BLangFunction generateMockFunction(String functionName) {\n-        // Get the orginal function from the pkgNode function list for reference\n-        this.originalFunction = getOriginalFunction(functionName);\n+        // Set the current mock object\n+        this.mockFnObjectName = this.bLangPackage.getTestablePkg().getMockFunctionNamesMap().get(functionName);\n+\n+        // Reset both import and original functions\n+        this.importFunction = null;\n+        this.originalFunction = null;\n+\n+        // Function name is going to be 'ballerina/math:1.0.0 # absInt'\n+        String currentPackageId = this.bLangPackage.packageID.toString();\n+\n+\n+        // We need to identify if the function is part of the current package or imported package\n+        if (functionName.contains(currentPackageId)) {\n+            // Simply extract the name only and set it to function name\n+            functionName = functionName.substring(functionName.indexOf(MOCK_ANNOTATION_DELIMITER) + 1);\n+            this.originalFunction = getOriginalFunction(functionName);\n+        } else {\n+            // Extract the name and the package details\n+            String packageName = functionName.substring(functionName.indexOf(\"/\") + 1, functionName.indexOf(\":\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1NDAxNw==", "bodyText": "Switched to using char instead of String for indexOf", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454954017", "createdAt": "2020-07-15T10:32:51Z", "author": {"login": "Ibaqu"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -102,15 +96,33 @@ public void generateMockFunctions(BLangPackage pkgNode) {\n         Set<String> mockFunctionSet = mockFunctionMap.keySet();\n \n         for (String function: mockFunctionSet) {\n-            if (!function.contains(\"#\")) { // Check added to skip desugaring for previous implementation mock functions\n-                pkgNode.getTestablePkg().functions.add(generateMockFunction(function));\n-            }\n+            pkgNode.getTestablePkg().functions.add(generateMockFunction(function));\n         }\n     }\n \n     private BLangFunction generateMockFunction(String functionName) {\n-        // Get the orginal function from the pkgNode function list for reference\n-        this.originalFunction = getOriginalFunction(functionName);\n+        // Set the current mock object\n+        this.mockFnObjectName = this.bLangPackage.getTestablePkg().getMockFunctionNamesMap().get(functionName);\n+\n+        // Reset both import and original functions\n+        this.importFunction = null;\n+        this.originalFunction = null;\n+\n+        // Function name is going to be 'ballerina/math:1.0.0 # absInt'\n+        String currentPackageId = this.bLangPackage.packageID.toString();\n+\n+\n+        // We need to identify if the function is part of the current package or imported package\n+        if (functionName.contains(currentPackageId)) {\n+            // Simply extract the name only and set it to function name\n+            functionName = functionName.substring(functionName.indexOf(MOCK_ANNOTATION_DELIMITER) + 1);\n+            this.originalFunction = getOriginalFunction(functionName);\n+        } else {\n+            // Extract the name and the package details\n+            String packageName = functionName.substring(functionName.indexOf(\"/\") + 1, functionName.indexOf(\":\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzNzA1NQ=="}, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzYxODUyOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowMzo1M1rOGx3QDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozMzoxMFrOGx4Mvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzODYzOQ==", "bodyText": "importFunction hides the field declared at L68, Shall we use another name for this?\nAlso, initializer null is redundant.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454938639", "createdAt": "2020-07-15T10:03:53Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -136,16 +149,96 @@ private BLangFunction getOriginalFunction(String functionName) {\n         return null;\n     }\n \n+    private BInvokableSymbol getImportFunction(String functionName, String packageName) {\n+        BInvokableSymbol importFunction = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1NDE3NQ==", "bodyText": "Changed the name for the BInvokableSymbol", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454954175", "createdAt": "2020-07-15T10:33:10Z", "author": {"login": "Ibaqu"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -136,16 +149,96 @@ private BLangFunction getOriginalFunction(String functionName) {\n         return null;\n     }\n \n+    private BInvokableSymbol getImportFunction(String functionName, String packageName) {\n+        BInvokableSymbol importFunction = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzODYzOQ=="}, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzYyMTkwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowNDo0NlrOGx3SBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozMzozM1rOGx4NxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzOTE0Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<BLangSimpleVariable> requiredParams = null;\n          \n          \n            \n                    List<BLangSimpleVariable> requiredParams;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454939142", "createdAt": "2020-07-15T10:04:46Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -136,16 +149,96 @@ private BLangFunction getOriginalFunction(String functionName) {\n         return null;\n     }\n \n+    private BInvokableSymbol getImportFunction(String functionName, String packageName) {\n+        BInvokableSymbol importFunction = null;\n+        importFunction = getInvokableSymbol(functionName, packageName, this.bLangPackage.getImports());\n+\n+        if (importFunction == null) {\n+            importFunction =\n+                    getInvokableSymbol(functionName, packageName,  this.bLangPackage.getTestablePkg().getImports());\n+        }\n+\n+        return importFunction;\n+    }\n+\n+    private BInvokableSymbol getInvokableSymbol(String functionName,\n+                                                String packageName,\n+                                                List<BLangImportPackage> importList) {\n+        // Loop through each BLangImportPackage\n+        for (BLangImportPackage importPkg : importList) {\n+            // If the import package name matches\n+            if (importPkg.alias.getValue().equals(packageName)) {\n+                // return the function name defined in the package entry map\n+                return (BInvokableSymbol) importPkg.symbol.scope.entries.get(new Name(functionName)).symbol;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n     private List<BLangSimpleVariable> generateRequiredParams() {\n-        List<BLangSimpleVariable> requiredParams = this.originalFunction.requiredParams;\n+        List<BLangSimpleVariable> requiredParams = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1NDQzNg==", "bodyText": "Removed all unnecessary nulls", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454954436", "createdAt": "2020-07-15T10:33:33Z", "author": {"login": "Ibaqu"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -136,16 +149,96 @@ private BLangFunction getOriginalFunction(String functionName) {\n         return null;\n     }\n \n+    private BInvokableSymbol getImportFunction(String functionName, String packageName) {\n+        BInvokableSymbol importFunction = null;\n+        importFunction = getInvokableSymbol(functionName, packageName, this.bLangPackage.getImports());\n+\n+        if (importFunction == null) {\n+            importFunction =\n+                    getInvokableSymbol(functionName, packageName,  this.bLangPackage.getTestablePkg().getImports());\n+        }\n+\n+        return importFunction;\n+    }\n+\n+    private BInvokableSymbol getInvokableSymbol(String functionName,\n+                                                String packageName,\n+                                                List<BLangImportPackage> importList) {\n+        // Loop through each BLangImportPackage\n+        for (BLangImportPackage importPkg : importList) {\n+            // If the import package name matches\n+            if (importPkg.alias.getValue().equals(packageName)) {\n+                // return the function name defined in the package entry map\n+                return (BInvokableSymbol) importPkg.symbol.scope.entries.get(new Name(functionName)).symbol;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n     private List<BLangSimpleVariable> generateRequiredParams() {\n-        List<BLangSimpleVariable> requiredParams = this.originalFunction.requiredParams;\n+        List<BLangSimpleVariable> requiredParams = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzOTE0Mg=="}, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzYyMzc5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowNToyMFrOGx3TLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowNToyMFrOGx3TLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzOTQzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    BLangType returnTypeNode = null;\n          \n          \n            \n                    BLangType returnTypeNode;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454939436", "createdAt": "2020-07-15T10:05:20Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -136,16 +149,96 @@ private BLangFunction getOriginalFunction(String functionName) {\n         return null;\n     }\n \n+    private BInvokableSymbol getImportFunction(String functionName, String packageName) {\n+        BInvokableSymbol importFunction = null;\n+        importFunction = getInvokableSymbol(functionName, packageName, this.bLangPackage.getImports());\n+\n+        if (importFunction == null) {\n+            importFunction =\n+                    getInvokableSymbol(functionName, packageName,  this.bLangPackage.getTestablePkg().getImports());\n+        }\n+\n+        return importFunction;\n+    }\n+\n+    private BInvokableSymbol getInvokableSymbol(String functionName,\n+                                                String packageName,\n+                                                List<BLangImportPackage> importList) {\n+        // Loop through each BLangImportPackage\n+        for (BLangImportPackage importPkg : importList) {\n+            // If the import package name matches\n+            if (importPkg.alias.getValue().equals(packageName)) {\n+                // return the function name defined in the package entry map\n+                return (BInvokableSymbol) importPkg.symbol.scope.entries.get(new Name(functionName)).symbol;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n     private List<BLangSimpleVariable> generateRequiredParams() {\n-        List<BLangSimpleVariable> requiredParams = this.originalFunction.requiredParams;\n+        List<BLangSimpleVariable> requiredParams = null;\n+\n+        if (this.originalFunction == null) {\n+            requiredParams = generateImportRequiredParams();\n+        } else {\n+            requiredParams = this.originalFunction.requiredParams;\n+        }\n+\n         return requiredParams;\n     }\n \n+    private List<BLangSimpleVariable> generateImportRequiredParams() {\n+        List<BLangSimpleVariable> bLangSimpleVariables = new ArrayList<>();\n+\n+        // Iterate through the params and generate the BLangSimpleVariable\n+        for (BVarSymbol bVarSymbol : this.importFunction.params) {\n+            BLangSimpleVariable bLangSimpleVariable =\n+                    ASTBuilderUtil.createVariable(bLangPackage.pos, bVarSymbol.name.getValue(),\n+                            bVarSymbol.type, null, bVarSymbol);\n+            bLangSimpleVariables.add(bLangSimpleVariable);\n+        }\n+\n+        return bLangSimpleVariables;\n+    }\n+\n+    private BLangSimpleVariable generateRestParam() {\n+        BLangSimpleVariable bLangSimpleVariable = null;\n+\n+        if (this.importFunction != null) {\n+            BVarSymbol restParam = this.importFunction.restParam;\n+\n+            if (this.importFunction.restParam != null) {\n+                bLangSimpleVariable = ASTBuilderUtil.createVariable(bLangPackage.pos, restParam.name.getValue(),\n+                        restParam.type, null, restParam);\n+                bLangSimpleVariable.typeNode = ASTBuilderUtil.createTypeNode(restParam.type);\n+            }\n+        }\n+\n+        return bLangSimpleVariable;\n+    }\n+\n     private BLangType generateReturnTypeNode() {\n-        BLangType returnTypeNode = this.originalFunction.returnTypeNode;\n+        BLangType returnTypeNode = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 187}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzYyNTkwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowNTo1OVrOGx3UlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowNTo1OVrOGx3UlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzOTc5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    BInvokableType bInvokableType = null;\n          \n          \n            \n                    BInvokableType bInvokableType;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454939797", "createdAt": "2020-07-15T10:05:59Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -160,13 +253,14 @@ private BInvokableSymbol generateSymbol(String functionName) {\n     }\n \n     private BInvokableType generateSymbolInvokableType() {\n-        BInvokableType bInvokableType = (BInvokableType) this.originalFunction.symbol.type;\n-        return bInvokableType;\n-    }\n+        BInvokableType bInvokableType = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 217}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzYzMTU3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowNzo0NlrOGx3YQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDowODoxNlrOGx3ZVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0MDczOQ==", "bodyText": "Isn't it redundant?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454940739", "createdAt": "2020-07-15T10:07:46Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -208,10 +323,9 @@ private BLangFieldBasedAccess generateFieldBasedAccess() {\n     }\n \n     // = (functionToMock)\n-    private BLangLiteral generateRHSExpr() {\n+    private BLangLiteral generateRHSExpr(String val) {\n         BType type = symTable.stringType;\n-        Object value = this.originalFunction.name.value;\n-\n+        Object value = val;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 291}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0MTAxMw==", "bodyText": "You can directly pass val to ASTBuilderUtil.createLiteral method", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454941013", "createdAt": "2020-07-15T10:08:16Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -208,10 +323,9 @@ private BLangFieldBasedAccess generateFieldBasedAccess() {\n     }\n \n     // = (functionToMock)\n-    private BLangLiteral generateRHSExpr() {\n+    private BLangLiteral generateRHSExpr(String val) {\n         BType type = symTable.stringType;\n-        Object value = this.originalFunction.name.value;\n-\n+        Object value = val;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0MDczOQ=="}, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 291}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzY1NzE5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDoxNToxOFrOGx3oKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDoxNToxOFrOGx3oKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0NDgwOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<BLangSimpleVarRef> argVariables = null;\n          \n          \n            \n                    List<BLangSimpleVarRef> argVariables;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454944808", "createdAt": "2020-07-15T10:15:18Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -266,21 +380,25 @@ private BInvokableSymbol getMockHandlerInvokableSymbol() {\n     }\n \n     private BLangSimpleVarRef getMockFunctionReference() {\n-        String mockObjName =\n-                bLangPackage.getTestablePkg().getMockFunctionNamesMap().get(originalFunction.getName().toString());\n         BVarSymbol mockObjectSymbol =\n-                (BVarSymbol) bLangPackage.getTestablePkg().symbol.scope.lookup(new Name(mockObjName)).symbol;\n-\n+                (BVarSymbol) bLangPackage.getTestablePkg().symbol.scope.lookup(new Name(this.mockFnObjectName)).symbol;\n         BLangSimpleVarRef bLangSimpleVarRef = ASTBuilderUtil.createVariableRef(bLangPackage.pos, mockObjectSymbol);\n-\n         return bLangSimpleVarRef;\n     }\n \n     private BLangListConstructorExpr generateMockHandlerArgs() {\n         BLangListConstructorExpr argsList =\n                 ASTBuilderUtil.createEmptyArrayLiteral(bLangPackage.pos, symTable.arrayAnydataType);\n-        List<BLangSimpleVarRef> argVariables =\n-                ASTBuilderUtil.createVariableRefList(bLangPackage.pos, originalFunction.requiredParams);\n+\n+        List<BLangSimpleVarRef> argVariables = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 316}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzY2NTc1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDoxODowNFrOGx3tXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDoxODowNFrOGx3tXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0NjE0MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    BType type = null;\n          \n          \n            \n                    BType type;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454946141", "createdAt": "2020-07-15T10:18:04Z", "author": {"login": "pramodya1994"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -296,4 +414,16 @@ private static IdentifierNode createIdentifier(String value) {\n         }\n         return node;\n     }\n+\n+    private BType generateType() {\n+        BType type = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 334}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzY3MTI4OnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/ballerina/src/test/mock.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDoxOTo0OFrOGx3wyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozNDowN1rOGx4PBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0NzAxOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                };\n          \n          \n            \n            };", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454947019", "createdAt": "2020-07-15T10:19:48Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/ballerina/src/test/mock.bal", "diffHunk": "@@ -223,7 +223,10 @@ public function when(MockFunction mockFunction) returns FunctionStub {\n }\n \n # Represents a MockFunction object\n-public type MockFunction object { string functionToMock = \"\"; };\n+public type MockFunction object {\n+    string functionToMock = \"\";\n+    string functionToMockPackage = \"\";\n+    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1NDc1Ng==", "bodyText": "Fixed this indentation.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454954756", "createdAt": "2020-07-15T10:34:07Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/ballerina/src/test/mock.bal", "diffHunk": "@@ -223,7 +223,10 @@ public function when(MockFunction mockFunction) returns FunctionStub {\n }\n \n # Represents a MockFunction object\n-public type MockFunction object { string functionToMock = \"\"; };\n+public type MockFunction object {\n+    string functionToMock = \"\";\n+    string functionToMockPackage = \"\";\n+    };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk0NzAxOQ=="}, "originalCommit": {"oid": "b4dc4da31baf5164cfd88dca4ae5a6c35dfcf992"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzczODgyOnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozOTozMFrOGx4Z8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozOTozMFrOGx4Z8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1NzU1NA==", "bodyText": "This is never used", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454957554", "createdAt": "2020-07-15T10:39:30Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -78,14 +74,12 @@\n     private static final String VALUE_SET_ANNOTATION_NAME = \"dataProvider\";\n     private static final String TEST_ENABLE_ANNOTATION_NAME = \"enable\";\n     private static final String MOCK_ANNOTATION_DELIMITER = \"#\";\n-    private static final String MOCK_FN = \"Mock\";\n+    private static final String MOCK_FN = \"MockFn\"; //Remove this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzc0Mzc2OnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDo0MDo1OFrOGx4c8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzo1NTozMlrOGx_T7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1ODMyMA==", "bodyText": "It's better if we can divide this method since its complexity is high and long.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454958320", "createdAt": "2020-07-15T10:40:58Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -314,23 +238,30 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     // Extract mock function information\n     @Override\n     public void process(SimpleVariableNode simpleVariableNode, List<AnnotationAttachmentNode> annotations) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA3MDcwMA==", "bodyText": "Further divided the method for better understandability", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r455070700", "createdAt": "2020-07-15T13:55:32Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -314,23 +238,30 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     // Extract mock function information\n     @Override\n     public void process(SimpleVariableNode simpleVariableNode, List<AnnotationAttachmentNode> annotations) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1ODMyMA=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzc0NTE3OnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDo0MToyNlrOGx4dzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTowNzoyMVrOGx5QtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1ODU0Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                annotationValues[0] = packageName; // Set default value of the annotation as the current pacakge\n          \n          \n            \n                                annotationValues[0] = packageName; // Set default value of the annotation as the current package", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454958543", "createdAt": "2020-07-15T10:41:26Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -314,23 +238,30 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     // Extract mock function information\n     @Override\n     public void process(SimpleVariableNode simpleVariableNode, List<AnnotationAttachmentNode> annotations) {\n-        annotations = annotations.stream().distinct().collect(Collectors.toList());\n+        parent = (BLangPackage) ((BLangSimpleVariable) simpleVariableNode).parent;\n+        String packageName = getPackageName(parent);\n \n+        annotations = annotations.stream().distinct().collect(Collectors.toList());\n+        // Iterate through all the annotations\n         for (AnnotationAttachmentNode attachmentNode : annotations) {\n             String annotationName = attachmentNode.getAnnotationName().getValue();\n-            // Check if the annotation name is Mock\n-            if (MOCK_ANNOTATION_NAME.equals(annotationName)) {\n-                String type = ((BLangUserDefinedType) ((BLangSimpleVariable) simpleVariableNode).typeNode)\n-                        .typeName.getValue();\n \n+            if (MOCK_ANNOTATION_NAME.equals(annotationName)) {\n+                String type = ((BLangUserDefinedType) ((BLangSimpleVariable) simpleVariableNode).typeNode).\n+                        typeName.getValue();\n+                // Check if the simpleVariableNode that the annotation is attached to is in fact the MockFunction object\n                 if (type.equals(\"MockFunction\")) {\n-                    String[] vals = new String[2];\n-                    // Extract function to mock name\n+                    String mockFnObjectName = simpleVariableNode.getName().getValue();\n+                    String[] annotationValues = new String[2]; // [0] - moduleName, [1] - functionName\n+                    annotationValues[0] = packageName; // Set default value of the annotation as the current pacakge", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3MTU3Mw==", "bodyText": "Corrected", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454971573", "createdAt": "2020-07-15T11:07:21Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -314,23 +238,30 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n     // Extract mock function information\n     @Override\n     public void process(SimpleVariableNode simpleVariableNode, List<AnnotationAttachmentNode> annotations) {\n-        annotations = annotations.stream().distinct().collect(Collectors.toList());\n+        parent = (BLangPackage) ((BLangSimpleVariable) simpleVariableNode).parent;\n+        String packageName = getPackageName(parent);\n \n+        annotations = annotations.stream().distinct().collect(Collectors.toList());\n+        // Iterate through all the annotations\n         for (AnnotationAttachmentNode attachmentNode : annotations) {\n             String annotationName = attachmentNode.getAnnotationName().getValue();\n-            // Check if the annotation name is Mock\n-            if (MOCK_ANNOTATION_NAME.equals(annotationName)) {\n-                String type = ((BLangUserDefinedType) ((BLangSimpleVariable) simpleVariableNode).typeNode)\n-                        .typeName.getValue();\n \n+            if (MOCK_ANNOTATION_NAME.equals(annotationName)) {\n+                String type = ((BLangUserDefinedType) ((BLangSimpleVariable) simpleVariableNode).typeNode).\n+                        typeName.getValue();\n+                // Check if the simpleVariableNode that the annotation is attached to is in fact the MockFunction object\n                 if (type.equals(\"MockFunction\")) {\n-                    String[] vals = new String[2];\n-                    // Extract function to mock name\n+                    String mockFnObjectName = simpleVariableNode.getName().getValue();\n+                    String[] annotationValues = new String[2]; // [0] - moduleName, [1] - functionName\n+                    annotationValues[0] = packageName; // Set default value of the annotation as the current pacakge", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1ODU0Mw=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzc0ODM4OnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDo0MjozM1rOGx4f5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTowNzowOVrOGx5QXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1OTA3OQ==", "bodyText": "variableNode is never used", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454959079", "createdAt": "2020-07-15T10:42:33Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -429,34 +343,27 @@ private String formatPackageName(String value) {\n \n     /**\n      * Validates the function name provided in the annotation.\n-     * @param functionName Function to mock\n+     * @param functionName Name of the function to mock\n      * @param variableNode  MockFunction object variable node\n      * @param attachmentNode  MockFunction object attachment node\n      */\n-    private void validateFunctionName(String functionName, SimpleVariableNode variableNode,\n+    private void validateFunctionName(String functionName, PackageID functionToMockID, SimpleVariableNode variableNode,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 253}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3MTQ4NQ==", "bodyText": "Removed variableNode", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454971485", "createdAt": "2020-07-15T11:07:09Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -429,34 +343,27 @@ private String formatPackageName(String value) {\n \n     /**\n      * Validates the function name provided in the annotation.\n-     * @param functionName Function to mock\n+     * @param functionName Name of the function to mock\n      * @param variableNode  MockFunction object variable node\n      * @param attachmentNode  MockFunction object attachment node\n      */\n-    private void validateFunctionName(String functionName, SimpleVariableNode variableNode,\n+    private void validateFunctionName(String functionName, PackageID functionToMockID, SimpleVariableNode variableNode,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1OTA3OQ=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 253}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzc1MjkzOnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDo0NDowM1rOGx4i1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzowMjozMlrOGx9BTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1OTgzMA==", "bodyText": "functionToMockID is nullable. NPE can be thrown.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454959830", "createdAt": "2020-07-15T10:44:03Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -465,7 +372,8 @@ private void validateFunctionName(String functionName, SimpleVariableNode variab\n \n             // If it reaches this part, then the function has'nt been found in both packages\n             diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, attachmentNode.getPosition(),\n-                    \"Function \\'\" + functionName + \"\\' cannot be found in the current package\");\n+                    \"Function \\'\" + functionName + \"\\' cannot be found in the package \\'\"\n+                            + functionToMockID.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 292}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk4NzQzMw==", "bodyText": "There is a null check for functionToMockID before which throws an error. Woudlnt that be enough or should the NPE be handled here as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454987433", "createdAt": "2020-07-15T11:40:11Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -465,7 +372,8 @@ private void validateFunctionName(String functionName, SimpleVariableNode variab\n \n             // If it reaches this part, then the function has'nt been found in both packages\n             diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, attachmentNode.getPosition(),\n-                    \"Function \\'\" + functionName + \"\\' cannot be found in the current package\");\n+                    \"Function \\'\" + functionName + \"\\' cannot be found in the package \\'\"\n+                            + functionToMockID.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1OTgzMA=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 292}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwMDcyNA==", "bodyText": "Is it line 351, Is yes, That's not enough because there is no else part for that condition and still NPE can be thrown right?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r455000724", "createdAt": "2020-07-15T12:06:12Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -465,7 +372,8 @@ private void validateFunctionName(String functionName, SimpleVariableNode variab\n \n             // If it reaches this part, then the function has'nt been found in both packages\n             diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, attachmentNode.getPosition(),\n-                    \"Function \\'\" + functionName + \"\\' cannot be found in the current package\");\n+                    \"Function \\'\" + functionName + \"\\' cannot be found in the package \\'\"\n+                            + functionToMockID.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1OTgzMA=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 292}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzMzE2Nw==", "bodyText": "I added a check for the functionToMockID. If it doesnt exist, then it will show up as a compile-time error", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r455033167", "createdAt": "2020-07-15T13:02:32Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -465,7 +372,8 @@ private void validateFunctionName(String functionName, SimpleVariableNode variab\n \n             // If it reaches this part, then the function has'nt been found in both packages\n             diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, attachmentNode.getPosition(),\n-                    \"Function \\'\" + functionName + \"\\' cannot be found in the current package\");\n+                    \"Function \\'\" + functionName + \"\\' cannot be found in the package \\'\"\n+                            + functionToMockID.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1OTgzMA=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 292}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzc2MDQyOnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/natives/test/FunctionMock.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDo0NjoxMlrOGx4nRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTowNjowNFrOGx5OXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2MDk2NQ==", "bodyText": "Seems thenReturn and mockHandler methods never used. Pls remove them if it is not used.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454960965", "createdAt": "2020-07-15T10:46:12Z", "author": {"login": "pramodya1994"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/natives/test/FunctionMock.java", "diffHunk": "@@ -43,14 +43,18 @@ public static ErrorValue thenReturn(ObjectValue caseObj) {\n \n     public static Object mockHandler(ObjectValue mockFuncObj, ArrayValue args) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3MDk3Mw==", "bodyText": "In this case, thenReturn and mockHandler are being used by the java interop in mock.bal. These are required for the functionality to work.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454970973", "createdAt": "2020-07-15T11:06:04Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/natives/test/FunctionMock.java", "diffHunk": "@@ -43,14 +43,18 @@ public static ErrorValue thenReturn(ObjectValue caseObj) {\n \n     public static Object mockHandler(ObjectValue mockFuncObj, ArrayValue args) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2MDk2NQ=="}, "originalCommit": {"oid": "51259c72b66598e38db2a6db79b60c10de1b60e9"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzk3OTQzOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTo1NToxNFrOGx6suQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzoyMjozNVrOGx92ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTEyOQ==", "bodyText": "Is \"this.importFunction\" nullable? Should we add a null check for that as well?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454995129", "createdAt": "2020-07-15T11:55:14Z", "author": {"login": "Dilhasha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -160,13 +253,14 @@ private BInvokableSymbol generateSymbol(String functionName) {\n     }\n \n     private BInvokableType generateSymbolInvokableType() {\n-        BInvokableType bInvokableType = (BInvokableType) this.originalFunction.symbol.type;\n-        return bInvokableType;\n-    }\n+        BInvokableType bInvokableType;\n \n-    private BType generateType() {\n-        BType type = ((BInvokableType) this.originalFunction.type).retType;\n-        return type;\n+        if (this.originalFunction == null) {\n+            bInvokableType = (BInvokableType) this.importFunction.type;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19be154c1766990b6e0f4e40a8ddee2e357ef604"}, "originalPosition": 223}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NjgxOQ==", "bodyText": "I added a null check for both import function and original function. In this case, one of the two has to be null. If both arent then the function will not go through the desugaring process and throws an error instead.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r455046819", "createdAt": "2020-07-15T13:22:35Z", "author": {"login": "Ibaqu"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -160,13 +253,14 @@ private BInvokableSymbol generateSymbol(String functionName) {\n     }\n \n     private BInvokableType generateSymbolInvokableType() {\n-        BInvokableType bInvokableType = (BInvokableType) this.originalFunction.symbol.type;\n-        return bInvokableType;\n-    }\n+        BInvokableType bInvokableType;\n \n-    private BType generateType() {\n-        BType type = ((BInvokableType) this.originalFunction.type).retType;\n-        return type;\n+        if (this.originalFunction == null) {\n+            bInvokableType = (BInvokableType) this.importFunction.type;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTEyOQ=="}, "originalCommit": {"oid": "19be154c1766990b6e0f4e40a8ddee2e357ef604"}, "originalPosition": 223}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzk4Mjk2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTo1NjoyMFrOGx6u7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTo1NjoyMFrOGx6u7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTY5NA==", "bodyText": "Is \"this.importFunction\" nullable? Should we add a null check for that as well?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r454995694", "createdAt": "2020-07-15T11:56:20Z", "author": {"login": "Dilhasha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/MockDesugar.java", "diffHunk": "@@ -177,24 +271,45 @@ private BLangFunctionBody generateBody() {\n \n     private List<BLangStatement> generateStatements() {\n         // <MockFunctionObj>.functionToMock = (functionToMock);\n-        BLangAssignment bLangAssignment =\n-                ASTBuilderUtil.createAssignmentStmt(bLangPackage.pos, generateFieldBasedAccess(), generateRHSExpr());\n+        String functionToMockVal = (this.originalFunction == null) ?\n+                this.importFunction.name.toString() : this.originalFunction.name.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19be154c1766990b6e0f4e40a8ddee2e357ef604"}, "originalPosition": 238}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjcyNDc4OnYy", "diffSide": "RIGHT", "path": "misc/testerina/modules/testerina-core/src/main/ballerina/src/test/annotations.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMjoxNjoxNFrOGyoQmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMzo1NToyNFrOGysGHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc0MTU5Mg==", "bodyText": "This change will break the BBE tests in ballerina-distribution repo. Can we have the same Mock annotation for both function and parameter.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r455741592", "createdAt": "2020-07-16T12:16:14Z", "author": {"login": "hevayo"}, "path": "misc/testerina/modules/testerina-core/src/main/ballerina/src/test/annotations.bal", "diffHunk": "@@ -62,7 +62,7 @@ public annotation BeforeEach on function;\n public annotation AfterEach on function;\n \n # Identifies the MockFunction object\n-public const annotation MockConfig MockFn on source var;\n+public const annotation MockConfig Mock on source var;\n \n # Identifies the Mock Function\n-public annotation MockConf Mock on function;\n+public annotation MockConf MockFn on function;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af79b9d4bf4184f482d5f6c834fb084dfdf85ac"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgwNDQ0Ng==", "bodyText": "Changed the annotation to Mock for both old and new implementations", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24747#discussion_r455804446", "createdAt": "2020-07-16T13:55:24Z", "author": {"login": "Ibaqu"}, "path": "misc/testerina/modules/testerina-core/src/main/ballerina/src/test/annotations.bal", "diffHunk": "@@ -62,7 +62,7 @@ public annotation BeforeEach on function;\n public annotation AfterEach on function;\n \n # Identifies the MockFunction object\n-public const annotation MockConfig MockFn on source var;\n+public const annotation MockConfig Mock on source var;\n \n # Identifies the Mock Function\n-public annotation MockConf Mock on function;\n+public annotation MockConf MockFn on function;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc0MTU5Mg=="}, "originalCommit": {"oid": "5af79b9d4bf4184f482d5f6c834fb084dfdf85ac"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 487, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}