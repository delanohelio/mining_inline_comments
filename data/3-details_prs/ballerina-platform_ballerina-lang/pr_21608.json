{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzM3ODgw", "number": 21608, "title": "Add support for iterator errors", "bodyText": "Purpose\n$title\nFixes #20720\nApproach\nn/a\nSamples\ntype Iterable object {\n    public function __iterator() returns abstract object {public function next() returns record {|int value;|}|error?;\n    } {\n        object {\n            int[] integers = [12, 34, 56, 34, 78, 21, 90];\n            int cursorIndex = 0;\n            public function next() returns\n            record {|\n                int value;\n            |}|error? {\n                self.cursorIndex += 1;\n                if (self.cursorIndex <= 7) {\n                    return {\n                        value: self.integers[self.cursorIndex - 1]\n                    };\n                } else {\n                    return ();\n                }\n            }\n        } sample = new;\n        return sample;\n    }\n};\n\npublic function main() {\n    Iterable p = new Iterable();\n    int[] integers = [];\n    foreach int|error item in p {\n        integers.push(<int>item);\n    }\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-03-10T20:04:30Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21608", "merged": true, "mergeCommit": {"oid": "62c0d6087102c19af5bb4364443d485e421d6c42"}, "closed": true, "closedAt": "2020-03-11T02:18:51Z", "author": {"login": "grainier"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMYHvagH2gAyMzg2MzM3ODgwOjgyOTBmYjIyMWY2NjFjM2E2ODdhYmRhZjNlMjdhMjA0MTE5MDE2NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMc-fHAFqTM3MjQyNjEzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8290fb221f661c3a687abdaf3e27a2041190165d", "author": {"user": {"login": "grainier", "name": "Grainier Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8290fb221f661c3a687abdaf3e27a2041190165d", "committedDate": "2020-03-10T19:59:21Z", "message": "Add support for iterator errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDE4ODg5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21608#pullrequestreview-372418889", "createdAt": "2020-03-11T01:11:15Z", "commit": {"oid": "8290fb221f661c3a687abdaf3e27a2041190165d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxMToxNlrOF0mL8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxMToxNlrOF0mL8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NTkyMw==", "bodyText": "We can just pass the member types to BUnionType.create(null, foreach.resultType, foreach.errorType)\nlet's change that when you add the test cases..", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21608#discussion_r390695923", "createdAt": "2020-03-11T01:11:16Z", "author": {"login": "rdhananjaya"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -2829,32 +2829,68 @@ private BLangBlockStmt desugarForeachToWhile(BLangForeach foreach, BLangSimpleVa\n                 getIteratorNextVariableDefinition(foreach, iteratorSymbol, resultSymbol);\n \n         // Note - $result$ != ()\n+        BLangType userDefineType;\n+        if (foreach.errorType != null) {\n+            userDefineType = getUserDefineTypeNode(BUnionType.create(null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8290fb221f661c3a687abdaf3e27a2041190165d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDI2MTMz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21608#pullrequestreview-372426133", "createdAt": "2020-03-11T01:38:46Z", "commit": {"oid": "8290fb221f661c3a687abdaf3e27a2041190165d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3858, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}