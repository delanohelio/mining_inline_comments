{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2MjY5Mjg5", "number": 24934, "title": "Fix actions being allowed in expressions", "bodyText": "Purpose\nTo allow only expression where expressions are expected and add a diagnostic if an action is provided\nFixes #23037\nApproach\nAdded a check in parseExpression to see if the parsed node is an action or expression and added a diagnostic if action is returned where it isn't supposed to be. Modified existing test asserts to go with the new change.\nSamples\n\nn/a\n\nRemarks\n\nn/a\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-07-24T12:50:36Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24934", "merged": true, "mergeCommit": {"oid": "08cd59489aa5bb44ec1bad5370eb558bf68b304d"}, "closed": true, "closedAt": "2020-07-28T10:49:11Z", "author": {"login": "m36dot"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4DZCLAH2gAyNDU2MjY5Mjg5Ojc2MTliMDVjY2Q5NTczNGIxMGI3MGJlMTAzNDEwZjYyZWM0OWMxZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5UKOTAFqTQ1NjUxNjI2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7619b05ccd95734b10b70be103410f62ec49c1d8", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7619b05ccd95734b10b70be103410f62ec49c1d8", "committedDate": "2020-07-24T12:42:54Z", "message": "Fix actions in expressions\n\ndisallow actions where only expressions are allowed. Change the asserts\nfor tests asserts that had wrong trees."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjUzMjQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24934#pullrequestreview-455253249", "createdAt": "2020-07-25T02:15:20Z", "commit": {"oid": "7619b05ccd95734b10b70be103410f62ec49c1d8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMjoxNToyMFrOG3BqHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMjoxNToyMFrOG3BqHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM1MjAyOQ==", "bodyText": "Why do we need this check?\nCan the same error be logged in two places? If so, Would removing the error from the other place solve the problem?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24934#discussion_r460352029", "createdAt": "2020-07-25T02:15:20Z", "author": {"login": "SupunS"}, "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -4101,9 +4098,34 @@ private STNode parseExpression(OperatorPrecedence precedenceLevel, boolean isRhs\n     private STNode parseExpression(SyntaxKind kind, OperatorPrecedence precedenceLevel, boolean isRhsExpr,\n                                    boolean allowActions, boolean isInMatchGuard, boolean isInConditionalExpr) {\n         STNode expr = parseTerminalExpression(kind, isRhsExpr, allowActions, isInConditionalExpr);\n-        return parseExpressionRhs(precedenceLevel, expr, isRhsExpr, allowActions, isInMatchGuard, isInConditionalExpr);\n+        STNode actionOrExpression =\n+                parseExpressionRhs(precedenceLevel, expr, isRhsExpr, allowActions, isInMatchGuard, isInConditionalExpr);\n+        //braced actions are just paranthesis enclosing actions, no need to add a diagnostic there when we have added\n+        //diagnostics to its children\n+        if (!allowActions && isAction(actionOrExpression) && actionOrExpression.kind != SyntaxKind.BRACED_ACTION) {\n+            actionOrExpression = attachErrorExpectedActionFoundDiagnostic(actionOrExpression);\n+        }\n+        return actionOrExpression;\n     }\n \n+    private boolean containsDiagnostics(STNode node, DiagnosticErrorCode diagnosticErrorCode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7619b05ccd95734b10b70be103410f62ec49c1d8"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bb69105c0324c5f390214a6e3ebfe732d82bc06", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0bb69105c0324c5f390214a6e3ebfe732d82bc06", "committedDate": "2020-07-27T06:15:00Z", "message": "Fix parseExpressionRhs\n\nFix adding diagnostic twice, now action_but_expression_expected diagnostic\nis only added once."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd1593eae93f24f42c490f2de735edebe56a8ff5", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd1593eae93f24f42c490f2de735edebe56a8ff5", "committedDate": "2020-07-27T06:52:14Z", "message": "Fix checkStyle and spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4cadad7768199be6476c9e3e1398ace703c1ba6", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f4cadad7768199be6476c9e3e1398ace703c1ba6", "committedDate": "2020-07-28T07:20:29Z", "message": "Refactor Code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c4b325bf36280a7abaa2adaa486bafbcab9df4d", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8c4b325bf36280a7abaa2adaa486bafbcab9df4d", "committedDate": "2020-07-28T08:26:46Z", "message": "Fix Conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a95dcbe6996a80cf54ac3c00564709dfc601a40f", "author": {"user": {"login": "m36dot", "name": "Saif Abdul Cassim"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a95dcbe6996a80cf54ac3c00564709dfc601a40f", "committedDate": "2020-07-28T08:49:50Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTE2MjY4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24934#pullrequestreview-456516268", "createdAt": "2020-07-28T10:49:02Z", "commit": {"oid": "a95dcbe6996a80cf54ac3c00564709dfc601a40f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3712, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}