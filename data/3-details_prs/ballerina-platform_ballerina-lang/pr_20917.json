{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMzEyMDA0", "number": 20917, "title": "Make listener variables final", "bodyText": "Purpose\nFixes #20892\nApproach\nFlag listener variables as final\nSamples\nCode\nimport ballerina/http;\nlistener http:Listener l = new (8080);\npublic function main() {\n    l = new (8181);\n}\nOutput\ninvalid assignment: 'listener' variable 'l' is final\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\nMaybe there is room for improvement for the error message.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-07T09:23:21Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917", "merged": true, "mergeCommit": {"oid": "98c8e2512d2acb3acfc1a8660ad946cd71886962"}, "closed": true, "closedAt": "2020-02-13T02:37:33Z", "author": {"login": "KRVPerera"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCV5P2ABqjMwMTk5ODAxOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDkiRIAFqTM1NzM3NDk1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8519745302ebd7d2ef3406cd06f50a0999d7d81a", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8519745302ebd7d2ef3406cd06f50a0999d7d81a", "committedDate": "2020-02-07T09:13:37Z", "message": "Make listener variables final\n\nThis will fix #20892 by flaging listener variables as final\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "b03539571ba11720c55c60affdd6928ec9307377", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b03539571ba11720c55c60affdd6928ec9307377", "committedDate": "2020-02-08T15:44:07Z", "message": "Make listener variables final\n\nThis will fix #20892 by flaging listener variables as final\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjAxODg0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-355601884", "createdAt": "2020-02-09T11:53:31Z", "commit": {"oid": "b03539571ba11720c55c60affdd6928ec9307377"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzYyMzMy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-355762332", "createdAt": "2020-02-10T08:44:29Z", "commit": {"oid": "b03539571ba11720c55c60affdd6928ec9307377"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwODo0NDoyOVrOFndt-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwODo0NDoyOVrOFndt-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkyNTY5MQ==", "bodyText": "Shall we improve the name of the function to reflect what's actually being tested?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#discussion_r376925691", "createdAt": "2020-02-10T08:44:29Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/finaltypes/final-field-test-negative.bal", "diffHunk": "@@ -71,3 +71,9 @@ function testLocalFinalValueWithoutTypeInitializedFromFunction() {\n function getName() returns string {\n     return \"Ballerina\";\n }\n+\n+listener http:MockListener ml = new http:MockListener(8080);\n+\n+public function testListenerVariable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b03539571ba11720c55c60affdd6928ec9307377"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b03539571ba11720c55c60affdd6928ec9307377", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b03539571ba11720c55c60affdd6928ec9307377", "committedDate": "2020-02-08T15:44:07Z", "message": "Make listener variables final\n\nThis will fix #20892 by flaging listener variables as final\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "1f0f11c3648b93a63518f73666d45100902a38e3", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1f0f11c3648b93a63518f73666d45100902a38e3", "committedDate": "2020-02-10T15:38:52Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f0f11c3648b93a63518f73666d45100902a38e3", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1f0f11c3648b93a63518f73666d45100902a38e3", "committedDate": "2020-02-10T15:38:52Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "db35f274c600457ff15e880736942bd90a8e682d", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/db35f274c600457ff15e880736942bd90a8e682d", "committedDate": "2020-02-11T00:51:50Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db35f274c600457ff15e880736942bd90a8e682d", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/db35f274c600457ff15e880736942bd90a8e682d", "committedDate": "2020-02-11T00:51:50Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12a51a244bdf47a9b2f7abe7b7234c9cdf448690", "committedDate": "2020-02-11T01:33:58Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTc2NzIx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-357176721", "createdAt": "2020-02-12T04:03:31Z", "commit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDowMzozMVrOFohK5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDowMzozMVrOFohK5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzMDgyMQ==", "bodyText": "This is not used anymore. I think safe to remove this.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#discussion_r378030821", "createdAt": "2020-02-12T04:03:31Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -2071,6 +2077,7 @@ private void checkConstantAssignment(BLangExpression varRef) {\n         }\n     }\n \n+    // TODO : check if READONLY is used now", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTc2OTIx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-357176921", "createdAt": "2020-02-12T04:04:23Z", "commit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDowNDoyM1rOFohLlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDowNDoyM1rOFohLlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzMDk5OQ==", "bodyText": "Better to move string literals to constants. Same for Listener as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#discussion_r378030999", "createdAt": "2020-02-12T04:04:23Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -2062,7 +2062,13 @@ private void checkConstantAssignment(BLangExpression varRef) {\n         Name varName = names.fromIdNode(simpleVarRef.variableName);\n         if (!Names.IGNORE.equals(varName) && env.enclInvokable != env.enclPkg.initFunction) {\n             if ((simpleVarRef.symbol.flags & Flags.FINAL) == Flags.FINAL) {\n-                dlog.error(varRef.pos, DiagnosticCode.CANNOT_ASSIGN_VALUE_FINAL, varRef);\n+                if ((simpleVarRef.symbol.flags & Flags.SERVICE) == Flags.SERVICE) {\n+                    dlog.error(varRef.pos, DiagnosticCode.INVALID_VARIABLE_ASSIGNMENT_FINAL, \"service\", varRef);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MjYzNTAz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-357263503", "createdAt": "2020-02-12T08:31:45Z", "commit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MjY0MTU4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-357264158", "createdAt": "2020-02-12T08:32:54Z", "commit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozMjo1NFrOFolgzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozMjo1NFrOFolgzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEwMTk2NA==", "bodyText": "Instead of variable, we can say Listener/Service declaration is final.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#discussion_r378101964", "createdAt": "2020-02-12T08:32:54Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -353,6 +353,9 @@ error.no.new.variables.var.assignment=\\\n error.invalid.variable.assignment=\\\n   invalid assignment in variable ''{0}''\n \n+error.invalid.variable.assignment.field.final =\\\n+  invalid assignment: ''{0}'' variable ''{1}'' is final", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MjY0NzY3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-357264767", "createdAt": "2020-02-12T08:34:01Z", "commit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozNDowMVrOFolimQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozNDowMVrOFolimQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEwMjQyNQ==", "bodyText": "Sometimes Service name can be anonymous. (name will start with $) In such cases, avoiding name will be good.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#discussion_r378102425", "createdAt": "2020-02-12T08:34:01Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -2062,7 +2062,13 @@ private void checkConstantAssignment(BLangExpression varRef) {\n         Name varName = names.fromIdNode(simpleVarRef.variableName);\n         if (!Names.IGNORE.equals(varName) && env.enclInvokable != env.enclPkg.initFunction) {\n             if ((simpleVarRef.symbol.flags & Flags.FINAL) == Flags.FINAL) {\n-                dlog.error(varRef.pos, DiagnosticCode.CANNOT_ASSIGN_VALUE_FINAL, varRef);\n+                if ((simpleVarRef.symbol.flags & Flags.SERVICE) == Flags.SERVICE) {\n+                    dlog.error(varRef.pos, DiagnosticCode.INVALID_VARIABLE_ASSIGNMENT_FINAL, \"service\", varRef);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3728ea118df471e1abcbeffc5a80bf7fdb36ede8", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3728ea118df471e1abcbeffc5a80bf7fdb36ede8", "committedDate": "2020-02-12T08:48:23Z", "message": "Make listener variables final\n\nThis will fix #20892 by flaging listener variables as final\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ded33ea2770951ce5b10bfd5885f1a47bdb6a1d", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8ded33ea2770951ce5b10bfd5885f1a47bdb6a1d", "committedDate": "2020-02-12T08:48:23Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13a4c86abd72dae60708afbe19cd828cea2696b9", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/13a4c86abd72dae60708afbe19cd828cea2696b9", "committedDate": "2020-02-12T09:13:42Z", "message": "Remove unused READONLY flag from the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e180205c48cf93b86e7cee6ef116d6e2961bfa0", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e180205c48cf93b86e7cee6ef116d6e2961bfa0", "committedDate": "2020-02-12T09:13:42Z", "message": "Chane error for listener/service reassignment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12a51a244bdf47a9b2f7abe7b7234c9cdf448690", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12a51a244bdf47a9b2f7abe7b7234c9cdf448690", "committedDate": "2020-02-11T01:33:58Z", "message": "Give a error for listener/service var reassignment\n\nBoth service and listener variables are implicitly final and compilor\nerror message improved for listeber/service var re-assignment\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "6e180205c48cf93b86e7cee6ef116d6e2961bfa0", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e180205c48cf93b86e7cee6ef116d6e2961bfa0", "committedDate": "2020-02-12T09:13:42Z", "message": "Chane error for listener/service reassignment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Mzc0OTU2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20917#pullrequestreview-357374956", "createdAt": "2020-02-12T11:21:52Z", "commit": {"oid": "6e180205c48cf93b86e7cee6ef116d6e2961bfa0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4194, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}