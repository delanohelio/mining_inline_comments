{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MDEzMDcx", "number": 22447, "title": "Remove `isFieldAnalyseRequired` from code", "bodyText": "Purpose\nThis variable resides in code deciding whether to run code analysis on a particular record or a object. This prevents code analysis running on locally defined anonymous records.\nFixes #22061\nApproach\nAs there is no proven usefulness of not running code analysts on certain record/object this variable and related code will be refactored.\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-04-03T07:42:28Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447", "merged": true, "mergeCommit": {"oid": "98d2eca4939bd6cd81da5a36916ed7c08832571f"}, "closed": true, "closedAt": "2020-04-17T18:33:36Z", "author": {"login": "KRVPerera"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT8MyhgBqjMxOTUyNzYxNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYlqkfgFqTM5NTY4NDQ2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b82fd7d90944041db7c420816a84498bac7e1ff0", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b82fd7d90944041db7c420816a84498bac7e1ff0", "committedDate": "2020-04-03T07:49:41Z", "message": "Remove `isFieldAnalyseRequired` from code\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "afe16377caf1abeced1675ba5078ffdae4619f9b", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/afe16377caf1abeced1675ba5078ffdae4619f9b", "committedDate": "2020-04-03T07:51:25Z", "message": "Remove `isFieldAnalyseRequired` from code\n\nThis variable is preventing code analysys on an anonymous\nrecords/objects. No usefulness of the variable in the current code.\nVariable is removed by this commit.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NDgwOTg3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#pullrequestreview-387480987", "createdAt": "2020-04-03T18:18:25Z", "commit": {"oid": "afe16377caf1abeced1675ba5078ffdae4619f9b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxODoxODoyNVrOGAiWpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxODoxODo1NlrOGAiYJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjAzNw==", "bodyText": "Why have we commented these (here and L2298) out instead of removing?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403216037", "createdAt": "2020-04-03T18:18:25Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -2285,18 +2285,20 @@ public void visit(BLangIntRangeExpression intRangeExpression) {\n     public void visit(BLangRecordTypeNode recordTypeNode) {\n \n         SymbolEnv recordEnv = SymbolEnv.createTypeEnv(recordTypeNode, recordTypeNode.symbol.scope, env);\n-        if (recordTypeNode.isFieldAnalyseRequired) {\n-            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n-        }\n+//        if (recordTypeNode.isFieldAnalyseRequired) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe16377caf1abeced1675ba5078ffdae4619f9b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjQyMg==", "bodyText": "Shall we replace this and below with foreach loops?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403216422", "createdAt": "2020-04-03T18:18:56Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -2285,18 +2285,20 @@ public void visit(BLangIntRangeExpression intRangeExpression) {\n     public void visit(BLangRecordTypeNode recordTypeNode) {\n \n         SymbolEnv recordEnv = SymbolEnv.createTypeEnv(recordTypeNode, recordTypeNode.symbol.scope, env);\n-        if (recordTypeNode.isFieldAnalyseRequired) {\n-            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n-        }\n+//        if (recordTypeNode.isFieldAnalyseRequired) {\n+//            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n+//        }\n+        recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe16377caf1abeced1675ba5078ffdae4619f9b"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43f10e8a097742ff9f2116aefb1e653e48a5487", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e43f10e8a097742ff9f2116aefb1e653e48a5487", "committedDate": "2020-04-04T07:10:06Z", "message": "Remove `isFieldAnalyseRequired` from code\n\nThis variable is preventing code analysys on an anonymous\nrecords/objects. No usefulness of the variable in the current code.\nVariable is removed by this commit.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "committedDate": "2020-04-04T07:10:06Z", "message": "Remove commented lines in CodeAnalyzer.java\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "afe16377caf1abeced1675ba5078ffdae4619f9b", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/afe16377caf1abeced1675ba5078ffdae4619f9b", "committedDate": "2020-04-03T07:51:25Z", "message": "Remove `isFieldAnalyseRequired` from code\n\nThis variable is preventing code analysys on an anonymous\nrecords/objects. No usefulness of the variable in the current code.\nVariable is removed by this commit.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "e8ca71620e9bc63092cdf42e8775ca578855a3be", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e8ca71620e9bc63092cdf42e8775ca578855a3be", "committedDate": "2020-04-04T07:11:49Z", "message": "Replace java stream in CodeAnalyzer\n\nJava stream based code in CodeAnalyzer.java BLangObjectTypeNode visitor\nis replaced by java vanilla for each loop.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8ca71620e9bc63092cdf42e8775ca578855a3be", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e8ca71620e9bc63092cdf42e8775ca578855a3be", "committedDate": "2020-04-04T07:11:49Z", "message": "Replace java stream in CodeAnalyzer\n\nJava stream based code in CodeAnalyzer.java BLangObjectTypeNode visitor\nis replaced by java vanilla for each loop.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}, "afterCommit": {"oid": "3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "committedDate": "2020-04-04T07:10:06Z", "message": "Remove commented lines in CodeAnalyzer.java\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e8d2fb2111b4b9ee18eaafa7fdce45eda0df10f", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3e8d2fb2111b4b9ee18eaafa7fdce45eda0df10f", "committedDate": "2020-04-04T07:44:40Z", "message": "Replace a java stream in CodeAnalyzer with foreach\n\nJava stream based code in CodeAnalyzer.java BLangObjectTypeNode visitor\nis replaced by java for each loop.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1829e492a3a1398a5a7821b2f4a42e9b568bf76c", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1829e492a3a1398a5a7821b2f4a42e9b568bf76c", "committedDate": "2020-04-05T09:24:17Z", "message": "Remove unused imports from CodeAnalyzer.java\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a04399453de1bfea94fff526dc43c541815c2dd1", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a04399453de1bfea94fff526dc43c541815c2dd1", "committedDate": "2020-04-06T11:05:09Z", "message": "Refactor replace forEach with simple for loop\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NjMwMzQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#pullrequestreview-389630349", "createdAt": "2020-04-08T03:31:45Z", "commit": {"oid": "a04399453de1bfea94fff526dc43c541815c2dd1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzozMTo0NVrOGCdybA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzozMTo0NVrOGCdybA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzODM4MA==", "bodyText": "Shall we use a meaningful name instead of o?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r405238380", "createdAt": "2020-04-08T03:31:45Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -2326,24 +2324,29 @@ public void visit(BLangIntRangeExpression intRangeExpression) {\n     public void visit(BLangRecordTypeNode recordTypeNode) {\n \n         SymbolEnv recordEnv = SymbolEnv.createTypeEnv(recordTypeNode, recordTypeNode.symbol.scope, env);\n-        if (recordTypeNode.isFieldAnalyseRequired) {\n-            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n+        for (BLangSimpleVariable field : recordTypeNode.fields) {\n+            analyzeNode(field, recordEnv);\n         }\n     }\n \n     @Override\n     public void visit(BLangObjectTypeNode objectTypeNode) {\n \n         SymbolEnv objectEnv = SymbolEnv.createTypeEnv(objectTypeNode, objectTypeNode.symbol.scope, env);\n-        if (objectTypeNode.isFieldAnalyseRequired) {\n-            objectTypeNode.fields.forEach(field -> analyzeNode(field, objectEnv));\n+        for (BLangSimpleVariable field : objectTypeNode.fields) {\n+            analyzeNode(field, objectEnv);\n+        }\n+\n+        List<BLangFunction> bLangFunctionList = new ArrayList<>(objectTypeNode.functions);\n+        if (objectTypeNode.initFunction != null) {\n+            bLangFunctionList.add(objectTypeNode.initFunction);\n         }\n \n         // To ensure the order of the compile errors\n-        Stream.concat(objectTypeNode.functions.stream(),\n-                Optional.ofNullable(objectTypeNode.initFunction).map(Stream::of).orElseGet(Stream::empty))\n-                .sorted(Comparator.comparingInt(fn -> fn.pos.sLine))\n-                .forEachOrdered(fn -> this.analyzeNode(fn, objectEnv));\n+        bLangFunctionList.sort(Comparator.comparingInt(o -> o.pos.sLine));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a04399453de1bfea94fff526dc43c541815c2dd1"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9ac13b6aedad14312ec620d191afb37c907ed13", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a9ac13b6aedad14312ec620d191afb37c907ed13", "committedDate": "2020-04-08T06:12:52Z", "message": "Refactor CodeAnalyzer.java rename a variable\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTcyNjUy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#pullrequestreview-390172652", "createdAt": "2020-04-08T17:14:08Z", "commit": {"oid": "a9ac13b6aedad14312ec620d191afb37c907ed13"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTc0NzYz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#pullrequestreview-390174763", "createdAt": "2020-04-08T17:17:04Z", "commit": {"oid": "a9ac13b6aedad14312ec620d191afb37c907ed13"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2307336c9f3b45f6884d49c97647d1cb3dbe07ea", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2307336c9f3b45f6884d49c97647d1cb3dbe07ea", "committedDate": "2020-04-15T16:38:42Z", "message": "Add test : Code Analyzer on anonymous Records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3bddbed9e87aa3c2816c38521f8c9515871cd85", "author": {"user": {"login": "KRVPerera", "name": "Rukshan Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b3bddbed9e87aa3c2816c38521f8c9515871cd85", "committedDate": "2020-04-16T12:33:41Z", "message": "Add test : Code analyzer on anonymous object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Njg0NDYy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#pullrequestreview-395684462", "createdAt": "2020-04-17T18:33:15Z", "commit": {"oid": "b3bddbed9e87aa3c2816c38521f8c9515871cd85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4158, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}