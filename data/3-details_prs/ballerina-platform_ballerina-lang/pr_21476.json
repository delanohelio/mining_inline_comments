{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNDUwNTIz", "number": 21476, "title": "Implement get generated keys only if supported by JDBC", "bodyText": "Purpose\n$Subject\nFixes #20795\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-03-04T10:02:16Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476", "merged": true, "mergeCommit": {"oid": "6d79a7c0fd6b2052b6c5dc43fd5072f740e309aa"}, "closed": true, "closedAt": "2020-03-11T06:16:09Z", "author": {"login": "kalaiyarasiganeshalingam"}, "timelineItems": {"totalCount": 53, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKUBKpAH2gAyMzgzNDUwNTIzOjZiMWFjNjhmMDNkMTIzMjBmMGI3MjlhNjUxNDZhMDkzMDY2NWM4ZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMf3k0AFqTM3MjQ3Njg2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6b1ac68f03d12320f0b729a65146a0930665c8dc", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6b1ac68f03d12320f0b729a65146a0930665c8dc", "committedDate": "2020-03-04T10:04:42Z", "message": "Improve the supportsGetGeneratedkey() function\n\nImprove the implementation\n\nChange the error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dded750f7cbd57c06da9ce4a6e6ab95151bba783", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dded750f7cbd57c06da9ce4a6e6ab95151bba783", "committedDate": "2020-03-04T10:07:30Z", "message": "Remove unwanted files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjQ5ODM2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-368649836", "createdAt": "2020-03-04T10:10:36Z", "commit": {"oid": "dded750f7cbd57c06da9ce4a6e6ab95151bba783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxMDozNlrOFxnKtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxMDozNlrOFxnKtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjI2Mw==", "bodyText": "Why this is a property in ClientConfiguration level? Can't we make it a optional parameter in update action only?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r387566263", "createdAt": "2020-03-04T10:10:36Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/types.bal", "diffHunk": "@@ -25,12 +25,15 @@ import ballerinax/java;\n # + poolOptions - Properties for the connection pool configuration. Refer `PoolOptions` for more details\n # + dbOptions - A map of DB specific properties. These properties will have an effect only if the dataSourceClassName is\n #               provided in poolOptions\n+# + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is `true`.\n+#                      It will return auto-generated keys only if supported by JDBC\n public type ClientConfiguration record {|\n     string url = \"\";\n     string username = \"\";\n     string password = \"\";\n     PoolOptions poolOptions?;\n     map<anydata> dbOptions = {};\n+    boolean getGeneratedKeys = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dded750f7cbd57c06da9ce4a6e6ab95151bba783"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a51708cc7a8bfd913f183f7850b8093e985220a7", "committedDate": "2020-03-05T06:19:03Z", "message": "Fix the reviewed comment\n\nMake changes in the example\n\nAdd value in the bal file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDUyMTE1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369452115", "createdAt": "2020-03-05T10:26:08Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDoyNjowOFrOFyOCOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDoyNjowOFrOFyOCOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIwMzA2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is\n          \n          \n            \n                # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if the value is", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388203064", "createdAt": "2020-03-05T10:26:08Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,16 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDUzMDQy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369453042", "createdAt": "2020-03-05T10:27:26Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDoyNzoyNlrOFyOFHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDoyNzoyNlrOFyOFHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIwMzgwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                      `true`.It will return auto-generated keys only if supported by JDBC\n          \n          \n            \n                #                      `true`. If it is not supported by the used JDBC driver, still it will return `nil`.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388203805", "createdAt": "2020-03-05T10:27:26Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,16 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is\n+    #                      `true`.It will return auto-generated keys only if supported by JDBC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDUzNjc5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369453679", "createdAt": "2020-03-05T10:28:17Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDoyODoxN1rOFyOHDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDoyODoxN1rOFyOHDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIwNDMwMw==", "bodyText": "please change similar to above doc comment suggestion", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388204303", "createdAt": "2020-03-05T10:28:17Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +80,21 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDU1NDk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369455494", "createdAt": "2020-03-05T10:30:49Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDozMDo0OVrOFyOMlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDozMDo0OVrOFyOMlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIwNTcxNw==", "bodyText": "It seems the parameters are not consistent in this remote function now. The rollbackAllInFailure is a boolean while the next similar parameter getGeneratedKeys is boolean?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388205717", "createdAt": "2020-03-05T10:30:49Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +80,21 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is\n+    #                      `true`.It will return auto-generated keys only if supported by JDBC\n     # + return - A `BatchUpdateResult` with the updated row count and returned error if any. If all the commands\n     #            in the batch have executed successfully, the error will be `nil`. If one or more commands have failed,\n     #            the `returnedError` field will give the corresponding `Error` along with the int[] which\n-    #            contains updated row count or the status returned from each command in the batch.\n+    #            contains updated row count or the status returned from each command in the batch\n     public remote function batchUpdate(@untainted string sqlQuery, boolean rollbackAllInFailure,\n-                                       Param?[]... parameters)\n+                                       boolean? getGeneratedKeys = (), Param?[]... parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDYzNzk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369463794", "createdAt": "2020-03-05T10:42:57Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo0Mjo1N1rOFyOm0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo0Mjo1N1rOFyOm0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIxMjQzNQ==", "bodyText": "IMO, instead of boolean? we should use boolean with default value. So for simple update statements which doesn't have parameters, we can specify the sqlQuery only", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388212435", "createdAt": "2020-03-05T10:42:57Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,16 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is\n+    #                      `true`.It will return auto-generated keys only if supported by JDBC\n     # + return - `UpdateResult` with the updated row count and key column values,\n     #             else `Error` will be returned if there is an error\n-    public remote function update(@untainted string sqlQuery, Param... parameters)\n-                                  returns UpdateResult|Error {\n+    public remote function update(@untainted string sqlQuery, boolean? getGeneratedKeys = (),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDY4ODIx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369468821", "createdAt": "2020-03-05T10:50:21Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo1MDoyMVrOFyO2iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo1MDoyMVrOFyO2iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIxNjQ1Ng==", "bodyText": "Shall we swap parameters and getGeneratedKeys? Bascially have the same order in the remote function it self.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388216456", "createdAt": "2020-03-05T10:50:21Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,16 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if value is\n+    #                      `true`.It will return auto-generated keys only if supported by JDBC\n     # + return - `UpdateResult` with the updated row count and key column values,\n     #             else `Error` will be returned if there is an error\n-    public remote function update(@untainted string sqlQuery, Param... parameters)\n-                                  returns UpdateResult|Error {\n+    public remote function update(@untainted string sqlQuery, boolean? getGeneratedKeys = (),\n+                                  Param... parameters) returns UpdateResult|Error {\n         if (!self.clientActive) {\n             return self.handleStoppedClientInvocation();\n         }\n-        return nativeUpdate(self, java:fromString(sqlQuery), parameters);\n+        return nativeUpdate(self, java:fromString(sqlQuery), parameters, getGeneratedKeys);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDcwMDc5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369470079", "createdAt": "2020-03-05T10:52:10Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo1MjoxMFrOFyO6nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo1MjoxMFrOFyO6nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIxNzUwMQ==", "bodyText": "Why only this map is mar as nillable? Why we are not being consistent with UpdateResult record?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388217501", "createdAt": "2020-03-05T10:52:10Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/types.bal", "diffHunk": "@@ -232,7 +232,7 @@ public type UpdateResult record {|\n # + returnedError - The `Error` returned from the remote function in case of a failure\n public type BatchUpdateResult record {|\n     int[] updatedRowCount;\n-    map<anydata[]> generatedKeys;\n+    map<anydata[]>? generatedKeys;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDczODk1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-369473895", "createdAt": "2020-03-05T10:57:57Z", "commit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo1Nzo1OFrOFyPGBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDo1Nzo1OFrOFyPGBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyMDQyMg==", "bodyText": "What is the reason for appending . at the end instead of the beginning of the line?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388220422", "createdAt": "2020-03-05T10:57:58Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/methods/ExternFunctions.java", "diffHunk": "@@ -72,9 +74,9 @@ public static void createClient(ObjectValue client, MapValue<String, Object> con\n         String dbType = url.split(\":\")[1].toUpperCase(Locale.getDefault());\n \n         SQLDatasource.SQLDatasourceParamsBuilder builder = new SQLDatasource.SQLDatasourceParamsBuilder(dbType);\n-        SQLDatasource.SQLDatasourceParams sqlDatasourceParams = builder.withPoolOptions(poolOptionsWrapper)\n-                .withJdbcUrl(url).withUsername(username).withPassword(password).withDbOptionsMap(dbOptions)\n-                .withIsGlobalDatasource(userProvidedPoolOptionsNotPresent).build();\n+        SQLDatasource.SQLDatasourceParams sqlDatasourceParams = builder.withPoolOptions(poolOptionsWrapper).\n+                withJdbcUrl(url).withUsername(username).withPassword(password).withDbOptionsMap(dbOptions).\n+                withIsGlobalDatasource(userProvidedPoolOptionsNotPresent).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a51708cc7a8bfd913f183f7850b8093e985220a7"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "386f5d28bff6c29fba0dd770106c5981f6cd69c5", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/386f5d28bff6c29fba0dd770106c5981f6cd69c5", "committedDate": "2020-03-05T19:11:49Z", "message": "Make suggested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3ba0164d1576381c0b6953f54b8565240cba0a63", "committedDate": "2020-03-05T19:40:11Z", "message": "Merge https://github.com/ballerina-platform/ballerina-lang into db_get_generated_key"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDU2ODc5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370056879", "createdAt": "2020-03-06T03:04:25Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzowNDoyNlrOFyr2VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzowNDoyNlrOFyr2VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5MTU0MA==", "bodyText": "IMO, a better name for this variable is returnGeneratedKeys", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388691540", "createdAt": "2020-03-06T03:04:26Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,16 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if the value is\n+    #                      `true`. If it is not supported by the used JDBC driver, still it will return `nil`.\n     # + return - `UpdateResult` with the updated row count and key column values,\n     #             else `Error` will be returned if there is an error\n-    public remote function update(@untainted string sqlQuery, Param... parameters)\n-                                  returns UpdateResult|Error {\n+    public remote function update(@untainted string sqlQuery, boolean getGeneratedKeys = false, Param... parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDU4ODgz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370058883", "createdAt": "2020-03-06T03:12:36Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoxMjozNlrOFyr9Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoxMjozNlrOFyr9Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5MzI4Nw==", "bodyText": "Same as above. I think a better name for this variable is returnGeneratedKeys", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388693287", "createdAt": "2020-03-06T03:12:36Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +80,21 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if the value is\n+    #                      `true`. If it is not supported by the used JDBC driver, still it will return `nil`.\n     # + return - A `BatchUpdateResult` with the updated row count and returned error if any. If all the commands\n     #            in the batch have executed successfully, the error will be `nil`. If one or more commands have failed,\n     #            the `returnedError` field will give the corresponding `Error` along with the int[] which\n-    #            contains updated row count or the status returned from each command in the batch.\n-    public remote function batchUpdate(@untainted string sqlQuery, boolean rollbackAllInFailure,\n-                                       Param?[]... parameters)\n+    #            contains updated row count or the status returned from each command in the batch\n+    public remote function batchUpdate(@untainted string sqlQuery, boolean rollbackAllInFailure = false,\n+                                       boolean getGeneratedKeys = false, Param?[]... parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDYxNDk2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370061496", "createdAt": "2020-03-06T03:23:42Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoyMzo0MlrOFysGGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoyMzo0MlrOFysGGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NTU3OA==", "bodyText": "# + getGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is set to true, auto-generated keys are made available to retrieve when the statement is executed. If the underline JDBC driver does not support it, still it will return `()` value.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388695578", "createdAt": "2020-03-06T03:23:42Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +80,21 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + getGeneratedKeys - Allow to retrieves auto-generated keys after a statement has been executed if the value is\n+    #                      `true`. If it is not supported by the used JDBC driver, still it will return `nil`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDYzNjM1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370063635", "createdAt": "2020-03-06T03:32:22Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzozMjoyM1rOFysM-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzozMjoyM1rOFysM-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NzMzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean supportsGetGeneratedKeys = false;\n          \n          \n            \n                private boolean supportGeneratedKeys = false;", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388697337", "createdAt": "2020-03-06T03:32:23Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/datasource/SQLDatasource.java", "diffHunk": "@@ -50,6 +51,7 @@\n     private AtomicInteger clientCounter = new AtomicInteger(0);\n     private Lock mutex = new ReentrantLock();\n     private boolean poolShutdown = false;\n+    private boolean supportsGetGeneratedKeys = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDc5OTQ5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370079949", "createdAt": "2020-03-06T04:46:06Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo0NjowNlrOFytC9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo0NjowNlrOFytC9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMTE1OA==", "bodyText": "Shall we change this to something like below and use that boolean for other two places? That will avoid taking && twice with the same booleans.\nboolean retrieveGeneratedKeys = isKeyRetrievalSupportedStatement() && getGeneratedKey", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388711158", "createdAt": "2020-03-06T04:46:06Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/statement/UpdateStatement.java", "diffHunk": "@@ -74,24 +78,26 @@ public Object execute() {\n             ArrayValue generatedParams = constructParameters(parameters);\n             conn = getDatabaseConnection(strand, client, datasource);\n             String processedQuery = createProcessedQueryString(query, generatedParams);\n-            stmt = conn.prepareStatement(processedQuery, Statement.RETURN_GENERATED_KEYS);\n+\n+            boolean keyRetrievalSupportedStatement = isKeyRetrievalSupportedStatement();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDgwNzI1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370080725", "createdAt": "2020-03-06T04:49:33Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo0OTozM1rOFytFhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo0OTozM1rOFytFhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMTgxMg==", "bodyText": "What is the purpose of this method?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388711812", "createdAt": "2020-03-06T04:49:33Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/statement/UpdateStatement.java", "diffHunk": "@@ -133,7 +134,25 @@ private boolean isDdlStatement() {\n         return populatedUpdateResultRecord;\n     }\n \n-    private enum DdlKeyword {\n-        CREATE, ALTER, DROP, TRUNCATE, COMMENT, RENAME\n+    private enum GenKeyStmt {\n+        INSERT, DELETE, UPDATE, MERGE\n+    }\n+\n+    /**\n+     * Check if the statement is one of INSERT, DELETE, UPDATE or MERGE.\n+     */\n+    private boolean isKeyRetrievalSupportedStatement() {\n+        if (datasource.isKeyRetrievalSupported()) {\n+            return Arrays.stream(GenKeyStmt.values()).anyMatch(stmt -> this.query.trim().toUpperCase(Locale.ENGLISH).\n+                    startsWith(stmt.name()));\n+        } else {\n+            ErrorHandlerUtils.printError(\"ERROR: Unable to get keys as JDBC is not supported to retrieve \" +\n+                    \"auto-generated keys from \" + datasource.getDatabaseProductName());\n+            return false;\n+        }\n+    }\n+\n+    public static boolean getGeneratedKey(Object getGeneratedKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 111}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDgxMzcz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370081373", "createdAt": "2020-03-06T04:52:32Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo1MjozMlrOFytHnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo1MjozMlrOFytHnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMjM1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        boolean keyRetrievalSupportedStatement = datasource.isKeyRetrievalSupported();\n          \n          \n            \n                        boolean keyRetrievalSupported = datasource.isKeyRetrievalSupported();", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388712351", "createdAt": "2020-03-06T04:52:32Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/statement/BatchUpdateStatement.java", "diffHunk": "@@ -83,8 +87,8 @@ public BatchUpdateStatement(ObjectValue client, SQLDatasource datasource, String\n         String errorMessagePrefix = \"failed to execute batch update\";\n         try {\n             conn = getDatabaseConnection(strand, client, datasource);\n-            boolean generatedKeyReturningSupported = isGeneratedKeyReturningSupported();\n-            if (generatedKeyReturningSupported) {\n+            boolean keyRetrievalSupportedStatement = datasource.isKeyRetrievalSupported();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDgxNTM0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370081534", "createdAt": "2020-03-06T04:53:22Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo1MzoyMlrOFytIKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo1MzoyMlrOFytIKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMjQ4OA==", "bodyText": "Normal practice is boolean returned function name = is + boolean variable name. Can we rename the method name or variable name to follow the same practice?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388712488", "createdAt": "2020-03-06T04:53:22Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/datasource/SQLDatasource.java", "diffHunk": "@@ -119,6 +123,10 @@ public boolean isPoolShutdown() {\n         return poolShutdown;\n     }\n \n+    public boolean isKeyRetrievalSupported() {\n+        return this.supportsGetGeneratedKeys;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDgyNjYx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370082661", "createdAt": "2020-03-06T04:58:33Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo1ODozM1rOFytMBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDo1ODozM1rOFytMBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMzQ3Ng==", "bodyText": "Why do we need to define this constant like this? This is not a jdbc related constant. @daneshk / @wggihan Are we following similar pattern in other modules?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388713476", "createdAt": "2020-03-06T04:58:33Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/Constants.java", "diffHunk": "@@ -165,6 +165,9 @@\n         public static final String MSSQL_SERVER = \"microsoft sql server\";\n     }\n \n+    // Warning suppression\n+    public static final String UNCHECKED = \"unchecked\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDgzMzI1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370083325", "createdAt": "2020-03-06T05:01:23Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTowMToyM1rOFytOTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTowMToyM1rOFytOTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxNDA2MA==", "bodyText": "We cannot rely on this API to check whether DB driver supports get generated keys. Because there is no guarantee that all DB driver implements this function. IMO we should not use this for our internal logic", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388714060", "createdAt": "2020-03-06T05:01:23Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/datasource/SQLDatasource.java", "diffHunk": "@@ -61,7 +63,9 @@ public SQLDatasource init(SQLDatasourceParams sqlDatasourceParams) {\n             throw ErrorGenerator.getSQLDatabaseError(e);\n         }\n         try (Connection con = getSQLConnection()) {\n-            databaseProductName = con.getMetaData().getDatabaseProductName().toLowerCase(Locale.ENGLISH);\n+            DatabaseMetaData metaData = con.getMetaData();\n+            databaseProductName = metaData.getDatabaseProductName().toLowerCase(Locale.ENGLISH);\n+            this.supportsGetGeneratedKeys = metaData.supportsGetGeneratedKeys();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDgzNjEz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370083613", "createdAt": "2020-03-06T05:02:44Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTowMjo0NFrOFytPTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTowMjo0NFrOFytPTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxNDMxNg==", "bodyText": "Instead of this comment, shall we use descriptive name for the function itself. This is the pattern followed for other test cases as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388714316", "createdAt": "2020-03-06T05:02:44Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/test/java/org/ballerinax/jdbc/actions/UpdateTest.java", "diffHunk": "@@ -229,12 +229,24 @@ public void testInsertBoolDataAsIntsAndReturnInts() {\n         Assert.assertEquals(((BInteger) returns[2]).intValue(), 1);\n     }\n \n+    /**\n+     * Test for getting auto-generated key when getGeneratedKey is true and the table doesn't have auto generated key.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDg1Njk0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370085694", "createdAt": "2020-03-06T05:11:36Z", "commit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNToxMTozNlrOFytWQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNToxMTozNlrOFytWQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxNjA5OA==", "bodyText": "Shall we remove checking keyRetrievalSupportedStatement and only rely on value set by the user?\nand pass all the errors we encounter while performing the operation to the user.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388716098", "createdAt": "2020-03-06T05:11:36Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/statement/BatchUpdateStatement.java", "diffHunk": "@@ -83,8 +87,8 @@ public BatchUpdateStatement(ObjectValue client, SQLDatasource datasource, String\n         String errorMessagePrefix = \"failed to execute batch update\";\n         try {\n             conn = getDatabaseConnection(strand, client, datasource);\n-            boolean generatedKeyReturningSupported = isGeneratedKeyReturningSupported();\n-            if (generatedKeyReturningSupported) {\n+            boolean keyRetrievalSupportedStatement = datasource.isKeyRetrievalSupported();\n+            if (getGeneratedKey && keyRetrievalSupportedStatement) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0164d1576381c0b6953f54b8565240cba0a63"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d1c774a621c60895931bc54f3e7a6abd07cbf11", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9d1c774a621c60895931bc54f3e7a6abd07cbf11", "committedDate": "2020-03-06T06:59:31Z", "message": "Merge https://github.com/ballerina-platform/ballerina-lang into db_get_generated_key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "795d8a7c8689ac2af32d13bed5ae811980f957df", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/795d8a7c8689ac2af32d13bed5ae811980f957df", "committedDate": "2020-03-06T08:27:21Z", "message": "Improve the implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ecf0cabaa906d97448341042d4ff83688ad82e4", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5ecf0cabaa906d97448341042d4ff83688ad82e4", "committedDate": "2020-03-06T08:41:54Z", "message": "Change variables' name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjM1Mzc2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370235376", "createdAt": "2020-03-06T10:49:41Z", "commit": {"oid": "5ecf0cabaa906d97448341042d4ff83688ad82e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDo0OTo0MVrOFy0qXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDo0OTo0MVrOFy0qXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgzNTkzNA==", "bodyText": "Shouldn't it be an error if the underline JDBC driver does not support it?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388835934", "createdAt": "2020-03-06T10:49:41Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,18 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return `()`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ecf0cabaa906d97448341042d4ff83688ad82e4"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjM2Mjg0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370236284", "createdAt": "2020-03-06T10:51:19Z", "commit": {"oid": "5ecf0cabaa906d97448341042d4ff83688ad82e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDo1MToxOVrOFy0tWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMDo1MToxOVrOFy0tWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgzNjY5OA==", "bodyText": "Same as above?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388836698", "createdAt": "2020-03-06T10:51:19Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +82,23 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return `()`\n+    #                         value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ecf0cabaa906d97448341042d4ff83688ad82e4"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d623a82ce636b043c49d8075c6ea01963e994a8f", "committedDate": "2020-03-06T11:05:17Z", "message": "Make changes in the bal file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjgxNjYx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370281661", "createdAt": "2020-03-06T12:19:17Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoxOToxN1rOFy23Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoxOToxN1rOFy23Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3MjAxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                         is executed. If the underline JDBC driver does not support it, still it will return\n          \n          \n            \n                #                         is executed. If the underline JDBC driver does not support it, it will return", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388872011", "createdAt": "2020-03-06T12:19:17Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,18 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjgyMDM4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370282038", "createdAt": "2020-03-06T12:20:06Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyMDowNlrOFy24YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyMDowNlrOFy24YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3MjI4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                         is executed. If the underline JDBC driver does not support it, still it will return\n          \n          \n            \n                #                         is executed. If the underline JDBC driver does not support it, it will return", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388872289", "createdAt": "2020-03-06T12:20:06Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +82,23 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjg0ODI1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370284825", "createdAt": "2020-03-06T12:25:48Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNTo0OVrOFy3Avg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNTo0OVrOFy3Avg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3NDQzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                         set to true, auto-generated keys are made available to retrieve when the statement\n          \n          \n            \n                #                         set to `true`, auto-generated keys are made available to retrieve when the statement", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388874430", "createdAt": "2020-03-06T12:25:49Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,18 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjg1MDAx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370285001", "createdAt": "2020-03-06T12:26:09Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNjoxMFrOFy3BRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNjoxMFrOFy3BRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3NDU2NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                         an `Error`\n          \n          \n            \n                #                         an `Error`.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388874565", "createdAt": "2020-03-06T12:26:10Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,18 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return\n+    #                         an `Error`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjg1MTkx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370285191", "createdAt": "2020-03-06T12:26:33Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNjozM1rOFy3B5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNjozM1rOFy3B5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3NDcyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                         set to true, auto-generated keys are made available to retrieve when the statement\n          \n          \n            \n                #                         set to `true`, auto-generated keys are made available to retrieve when the statement", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388874725", "createdAt": "2020-03-06T12:26:33Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +82,23 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjg1MjU0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370285254", "createdAt": "2020-03-06T12:26:42Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNjo0MlrOFy3CGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNjo0MlrOFy3CGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3NDc3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #                         an `Error`\n          \n          \n            \n                #                         an `Error`.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388874778", "createdAt": "2020-03-06T12:26:42Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +82,23 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return\n+    #                         an `Error`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjg1NDY3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370285467", "createdAt": "2020-03-06T12:27:07Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNzowOFrOFy3C7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyNzowOFrOFy3C7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3NDk5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                #            contains updated row count or the status returned from each command in the batch\n          \n          \n            \n                #            contains updated row count or the status returned from each command in the batch.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388874991", "createdAt": "2020-03-06T12:27:08Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +82,23 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to true, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, still it will return\n+    #                         an `Error`\n     # + return - A `BatchUpdateResult` with the updated row count and returned error if any. If all the commands\n     #            in the batch have executed successfully, the error will be `nil`. If one or more commands have failed,\n     #            the `returnedError` field will give the corresponding `Error` along with the int[] which\n-    #            contains updated row count or the status returned from each command in the batch.\n+    #            contains updated row count or the status returned from each command in the batch", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjg2ODM2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370286836", "createdAt": "2020-03-06T12:29:47Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyOTo0OFrOFy3HRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjoyOTo0OFrOFy3HRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3NjEwMg==", "bodyText": "Can we add a test case for this scenario as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388876102", "createdAt": "2020-03-06T12:29:48Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/statement/UpdateStatement.java", "diffHunk": "@@ -70,26 +71,36 @@ public Object execute() {\n         checkAndObserveSQLAction(strand, datasource, query);\n         boolean isInTransaction = strand.isInTransaction();\n         String errorMessagePrefix = \"failed to execute update query: \";\n+        MapValue<String, Object> generatedKeys = new MapValueImpl<>();\n         try {\n             ArrayValue generatedParams = constructParameters(parameters);\n             conn = getDatabaseConnection(strand, client, datasource);\n             String processedQuery = createProcessedQueryString(query, generatedParams);\n-            stmt = conn.prepareStatement(processedQuery, Statement.RETURN_GENERATED_KEYS);\n+\n+            if (returnGeneratedKeys) {\n+                stmt = conn.prepareStatement(processedQuery, PreparedStatement.RETURN_GENERATED_KEYS);\n+            } else {\n+                stmt = conn.prepareStatement(processedQuery);\n+            }\n+\n             ProcessedStatement processedStatement = new ProcessedStatement(conn, stmt, generatedParams,\n                     datasource.getDatabaseProductName());\n             stmt = processedStatement.prepare();\n             int count = stmt.executeUpdate();\n-            MapValue<String, Object> generatedKeys;\n-            if (!isDdlStatement()) {\n-                rs = stmt.getGeneratedKeys();\n-                //This result set contains the auto generated keys.\n-                if (rs.next()) {\n-                    generatedKeys = getGeneratedKeys(rs);\n+            if (returnGeneratedKeys) {\n+                if (isKeyRetrievalSupported()) {\n+                    rs = stmt.getGeneratedKeys();\n+                    //This result set contains the auto generated keys.\n+                    if (rs.next()) {\n+                        generatedKeys = getGeneratedKeys(rs);\n+                    }\n                 } else {\n-                    generatedKeys = new MapValueImpl<>();\n+                    handleErrorOnTransaction(this.strand);\n+                    String message = \"The returnGeneratedKeys only support INSERT, UPDATE, DELETE and MERGE \" +\n+                            \"operations.\";\n+                    checkAndObserveSQLError(strand, \"execute update failed: \" + message);\n+                    return ErrorGenerator.getSQLApplicationError(message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjkzNDAx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-370293401", "createdAt": "2020-03-06T12:42:16Z", "commit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjo0MjoxNlrOFy3bNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjo0MjoxNlrOFy3bNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg4MTIwNQ==", "bodyText": "Why do we need this extra check?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r388881205", "createdAt": "2020-03-06T12:42:16Z", "author": {"login": "daneshk"}, "path": "stdlib/jdbc/src/main/java/org/ballerinax/jdbc/statement/UpdateStatement.java", "diffHunk": "@@ -70,26 +71,36 @@ public Object execute() {\n         checkAndObserveSQLAction(strand, datasource, query);\n         boolean isInTransaction = strand.isInTransaction();\n         String errorMessagePrefix = \"failed to execute update query: \";\n+        MapValue<String, Object> generatedKeys = new MapValueImpl<>();\n         try {\n             ArrayValue generatedParams = constructParameters(parameters);\n             conn = getDatabaseConnection(strand, client, datasource);\n             String processedQuery = createProcessedQueryString(query, generatedParams);\n-            stmt = conn.prepareStatement(processedQuery, Statement.RETURN_GENERATED_KEYS);\n+\n+            if (returnGeneratedKeys) {\n+                stmt = conn.prepareStatement(processedQuery, PreparedStatement.RETURN_GENERATED_KEYS);\n+            } else {\n+                stmt = conn.prepareStatement(processedQuery);\n+            }\n+\n             ProcessedStatement processedStatement = new ProcessedStatement(conn, stmt, generatedParams,\n                     datasource.getDatabaseProductName());\n             stmt = processedStatement.prepare();\n             int count = stmt.executeUpdate();\n-            MapValue<String, Object> generatedKeys;\n-            if (!isDdlStatement()) {\n-                rs = stmt.getGeneratedKeys();\n-                //This result set contains the auto generated keys.\n-                if (rs.next()) {\n-                    generatedKeys = getGeneratedKeys(rs);\n+            if (returnGeneratedKeys) {\n+                if (isKeyRetrievalSupported()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d623a82ce636b043c49d8075c6ea01963e994a8f"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f8f969e23a6e9176ca029ec72cce2590cb75549", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7f8f969e23a6e9176ca029ec72cce2590cb75549", "committedDate": "2020-03-08T14:17:43Z", "message": "Merge https://github.com/ballerina-platform/ballerina-lang into db_get_generated_key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90dac1112bb6177ae3fc4d510624bf055576e0e9", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90dac1112bb6177ae3fc4d510624bf055576e0e9", "committedDate": "2020-03-08T15:46:34Z", "message": "Fix suggested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d526150f5addfdbeb8c63556baa5a98e26ed51c", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2d526150f5addfdbeb8c63556baa5a98e26ed51c", "committedDate": "2020-03-08T18:08:57Z", "message": "Fix integration test failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODc4MTc4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-371878178", "createdAt": "2020-03-10T11:40:42Z", "commit": {"oid": "2d526150f5addfdbeb8c63556baa5a98e26ed51c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMTo0MDo0MlrOF0LT-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMTo0MDo0MlrOF0LT-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI1NTYxMA==", "bodyText": "Can't we make this a defaultable parameter with default value is false. Then we don't need to append false for simple update statements which doesn't have parameters", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r390255610", "createdAt": "2020-03-10T11:40:42Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -59,14 +59,17 @@ public type Client client object {\n     #\n     # + sqlQuery - SQL statement to execute\n     # + parameters - The parameters to be passed to the update query\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to `true`, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, it will return an `Error`.\n     # + return - `UpdateResult` with the updated row count and key column values,\n     #             else `Error` will be returned if there is an error\n-    public remote function update(@untainted string sqlQuery, Param... parameters)\n-                                  returns UpdateResult|Error {\n+    public remote function update(@untainted string sqlQuery, boolean returnGeneratedKeys, Param... parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d526150f5addfdbeb8c63556baa5a98e26ed51c"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODgwMTY0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-371880164", "createdAt": "2020-03-10T11:44:04Z", "commit": {"oid": "2d526150f5addfdbeb8c63556baa5a98e26ed51c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMTo0NDowNFrOF0LaSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMTo0NDowNFrOF0LaSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI1NzIyNQ==", "bodyText": "Same as above. Can't we change the boolean arugments to defaultable parameters?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r390257225", "createdAt": "2020-03-10T11:44:04Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +81,22 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to `true`, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, it will return an `Error`.\n     # + return - A `BatchUpdateResult` with the updated row count and returned error if any. If all the commands\n     #            in the batch have executed successfully, the error will be `nil`. If one or more commands have failed,\n     #            the `returnedError` field will give the corresponding `Error` along with the int[] which\n     #            contains updated row count or the status returned from each command in the batch.\n     public remote function batchUpdate(@untainted string sqlQuery, boolean rollbackAllInFailure,\n-                                       Param?[]... parameters)\n+                                       boolean returnGeneratedKeys, Param?[]... parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d526150f5addfdbeb8c63556baa5a98e26ed51c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd58703e5c603bd46f47dd45300816d5bf2beb57", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd58703e5c603bd46f47dd45300816d5bf2beb57", "committedDate": "2020-03-10T12:12:31Z", "message": "Change the mendatory parameter to a defaultable parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTAzNzEx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-371903711", "createdAt": "2020-03-10T12:24:07Z", "commit": {"oid": "cd58703e5c603bd46f47dd45300816d5bf2beb57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMjoyNDowN1rOF0MkNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMjoyNDowN1rOF0MkNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3NjE1MA==", "bodyText": "IMO we should make rollbackAllInFailure also a defaultable parameter.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r390276150", "createdAt": "2020-03-10T12:24:07Z", "author": {"login": "anupama-pathirage"}, "path": "stdlib/jdbc/src/main/ballerina/src/java.jdbc/client.bal", "diffHunk": "@@ -78,18 +81,22 @@ public type Client client object {\n     #           may or may not continue to process the remaining commands in the batch. This property can be\n     #           used to override this behavior. When it is set to true, if there is a failure in a few commands and\n     #           the JDBC driver continues with the remaining commands, the successfully executed commands in the batch\n-    #           also will get rolled back.\n+    #           also will get rolled back\n+    # + returnGeneratedKeys - Indicate that generated keys should be made available for retrieval. If the value is\n+    #                         set to `true`, auto-generated keys are made available to retrieve when the statement\n+    #                         is executed. If the underline JDBC driver does not support it, it will return an `Error`.\n     # + return - A `BatchUpdateResult` with the updated row count and returned error if any. If all the commands\n     #            in the batch have executed successfully, the error will be `nil`. If one or more commands have failed,\n     #            the `returnedError` field will give the corresponding `Error` along with the int[] which\n     #            contains updated row count or the status returned from each command in the batch.\n     public remote function batchUpdate(@untainted string sqlQuery, boolean rollbackAllInFailure,\n-                                       Param?[]... parameters)\n+                                       boolean returnGeneratedKeys = false, Param?[]... parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd58703e5c603bd46f47dd45300816d5bf2beb57"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "644cb2f52b862dbd8a46e4dac5f3d48104921f3c", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/644cb2f52b862dbd8a46e4dac5f3d48104921f3c", "committedDate": "2020-03-10T13:43:04Z", "message": "Fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b991435fedeab740ae1d6d4c1e985744b6e88d4e", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b991435fedeab740ae1d6d4c1e985744b6e88d4e", "committedDate": "2020-03-10T13:53:35Z", "message": "Remove unwanted changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "773e6c03d8f6e6ff1d6f499b69271dc672a80924", "author": {"user": {"login": "kalaiyarasiganeshalingam", "name": "Kalaiyarasi Ganeshalingam"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/773e6c03d8f6e6ff1d6f499b69271dc672a80924", "committedDate": "2020-03-10T14:01:05Z", "message": "Add the bracket"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDQ0MDU2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-372444056", "createdAt": "2020-03-11T02:43:49Z", "commit": {"oid": "773e6c03d8f6e6ff1d6f499b69271dc672a80924"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMjo0Mzo1MFrOF0nhKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMjo0Mzo1MFrOF0nhKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcxNzczNw==", "bodyText": "Why we can't remove passing false? we already have set false as default value", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#discussion_r390717737", "createdAt": "2020-03-11T02:43:50Z", "author": {"login": "daneshk"}, "path": "examples/jdbc-client-crud-operations/jdbc_client_crud_operations.bal", "diffHunk": "@@ -45,7 +45,7 @@ public function main() {\n     // of the `java.jdbc` module.\n     int age = 24;\n     string name = \"Anne\";\n-    ret = testDB->update(\"INSERT INTO student(age, name) values (?, ?)\",\n+    ret = testDB->update(\"INSERT INTO student(age, name) values (?, ?)\", false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "773e6c03d8f6e6ff1d6f499b69271dc672a80924"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDc2ODY5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21476#pullrequestreview-372476869", "createdAt": "2020-03-11T05:00:56Z", "commit": {"oid": "773e6c03d8f6e6ff1d6f499b69271dc672a80924"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3953, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}