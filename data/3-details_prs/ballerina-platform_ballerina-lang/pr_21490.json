{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MTI3MDM3", "number": 21490, "title": "Add retry functionality to gRPC unary blocking client", "bodyText": "Purpose\n\n$subject\n\nFixes #21311\nApproach\n\nRetry functionality is introduced to the gRPC blocking client. The functionality can be enabled by providing retryConfiguration value to the grpc:ClientConfiguration.\nThe retryConfiguration field is of type grpc:RetryConfiguration, which is defined as follows\npublic type RetryConfiguration record {\n    int retryCount;\n    int intervalInMillis;\n    int maxIntervalInMillis;\n    int backoffFactor;\n    ErrorType[] errorTypes = [INTERNAL_ERROR];\n}\n\nSamples\n\nUser can enable retry functionality using the aforementioned grpc:RetryConfiguration record.\ngrpc:RetryConfiguration retryConfiguration = {\n    retryCount: 5,\n    intervalInMillis: 2000,\n    maxIntervalInMillis: 10000,\n    backoffFactor: 2,\n    errorTypes: [grpc:INTERNAL_ERROR, grpc:UNAVAILABLE_ERROR]\n};\n\ngrpc:ClientConfiguration clientConfiguration = {\n    // Other configurations\n    retryConfiguration: retryConfiguration\n};\n\nSampleGrpcClient sampleClient = new(\"http://sample-service\", clientConfiguration);\nThis will create a gRPC client with following features.\n\nClient will consider only grpc:InternalError and grpc:UnavailableError as error scenarios. (errorTypes)\nIf the client gets an above mentioned error, it will retry, for maximum of 5 (retryCount) attempts.\nInitially, the second attempt (first retry) will occur after 2000 milliseconds. (intervalInMillis).\nNext attempt will happen after (2000 * 2 = ) 4000 milliseconds. (Multiplying the interval by backoffFactor).\nNext attempt will happen after (4000 * 2 = ) 8000 milliseconds. (Multiplying the current interval by the backoffFactor.\nBut at a given time, cannot exceed the maximumIntervalInMillis. Hence the subsequent retry attempts will be done after 10000 milliseconds or 10 seconds of intervals.\n\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-03-05T08:10:32Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490", "merged": true, "mergeCommit": {"oid": "6d967cb1ffcaac1b8ea7064724f2c94ba9bc13a8"}, "closed": true, "closedAt": "2020-03-10T11:27:46Z", "author": {"login": "ThisaruGuruge"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIT97hgH2gAyMzg0MTI3MDM3OjFjNzNlN2IzM2QwY2Y1ZDM0YTljNDEwYmUyYzc1ZWQzNjQwM2YwNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMQxjngFqTM3MTg2OTU0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c73e7b33d0cf5d34a9c410be2c75ed36403f041", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1c73e7b33d0cf5d34a9c410be2c75ed36403f041", "committedDate": "2020-02-27T04:53:19Z", "message": "Add retry configurations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "000808806317ccbe62337a3596c49eefd57ec232", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/000808806317ccbe62337a3596c49eefd57ec232", "committedDate": "2020-02-27T04:53:34Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into grpc-resiliency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b8728a0979d76daf3ea501d1a62babf88797341", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7b8728a0979d76daf3ea501d1a62babf88797341", "committedDate": "2020-03-03T11:54:12Z", "message": "Implement gRPC unary retry functionality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bf98629914c07946cee7d55dd67c0949ac901c8", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6bf98629914c07946cee7d55dd67c0949ac901c8", "committedDate": "2020-03-04T16:00:13Z", "message": "Fix missing last retry attempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea23393fc51c2adc8be27b3b5e283c98a68000fd", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ea23393fc51c2adc8be27b3b5e283c98a68000fd", "committedDate": "2020-03-05T07:54:10Z", "message": "Add grpc retry integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea35a3857cf531bf0dca6317185aa517e51acbd9", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ea35a3857cf531bf0dca6317185aa517e51acbd9", "committedDate": "2020-03-05T08:11:47Z", "message": "Merge branch 'master' into grpc-resiliency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "343a1ca338f6b8d1712b7bfa6c1801ad32bc4ef2", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/343a1ca338f6b8d1712b7bfa6c1801ad32bc4ef2", "committedDate": "2020-03-05T11:21:15Z", "message": "Fix conflicts with master branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d42cd43fdbe02db94ddf651cff5eed398150b20a", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d42cd43fdbe02db94ddf651cff5eed398150b20a", "committedDate": "2020-03-05T12:12:37Z", "message": "Fix ordering issues in testng file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8357e4762997ae003c054070961c6400a896c27", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b8357e4762997ae003c054070961c6400a896c27", "committedDate": "2020-03-06T06:28:57Z", "message": "Fix grpc retry test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b9d4eb84812873d4f4f39b851743aada40f8eec", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1b9d4eb84812873d4f4f39b851743aada40f8eec", "committedDate": "2020-03-06T07:45:58Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into grpc-resiliency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43da231fd783e254e04c34bc5cecb4f1566b82b2", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/43da231fd783e254e04c34bc5cecb4f1566b82b2", "committedDate": "2020-03-06T07:57:53Z", "message": "Fix travis failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "423b6e743e447c8d48c56c1adb87546dc846070e", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/423b6e743e447c8d48c56c1adb87546dc846070e", "committedDate": "2020-03-06T08:50:30Z", "message": "revert travis fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5ecf34d35aaabb3a0f09e798fa17c581b5dacb52", "committedDate": "2020-03-06T09:20:37Z", "message": "fix travix issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTkxMjE0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#pullrequestreview-370991214", "createdAt": "2020-03-09T08:47:28Z", "commit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwODo0NzoyOFrOFzerIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwODo0NzoyOFrOFzerIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUyNDI1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function retryBlockingAction(Client grpcClient, handle methodIdHandle, anydata payload, Headers? headers,\n          \n          \n            \n            function retryBlockingExecute(Client grpcClient, handle methodIdHandle, anydata payload, Headers? headers,", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#discussion_r389524258", "createdAt": "2020-03-09T08:47:28Z", "author": {"login": "daneshk"}, "path": "stdlib/grpc/src/main/ballerina/src/grpc/client_endpoint.bal", "diffHunk": "@@ -82,6 +88,35 @@ public type Client client object {\n     }\n };\n \n+function retryBlockingAction(Client grpcClient, handle methodIdHandle, anydata payload, Headers? headers,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTk3NDc5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#pullrequestreview-370997479", "createdAt": "2020-03-09T08:58:12Z", "commit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwODo1ODoxMlrOFze-HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwODo1ODoxMlrOFze-HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUyOTExNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // Copyright (c) 2018 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n            // Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#discussion_r389529116", "createdAt": "2020-03-09T08:58:12Z", "author": {"login": "daneshk"}, "path": "stdlib/grpc/src/main/ballerina/src/grpc/utils.bal", "diffHunk": "@@ -0,0 +1,25 @@\n+// Copyright (c) 2018 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDA0NzA2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#pullrequestreview-371004706", "createdAt": "2020-03-09T09:10:42Z", "commit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOToxMDo0MlrOFzfT_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOToxMDo0MlrOFzfT_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzNDcxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return retryBlockingAction(self, methodIdHandle, payload, headers, retryConfig);\n          \n          \n            \n                        return retryBlockingExecute(self, methodIdHandle, payload, headers, retryConfig);", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#discussion_r389534719", "createdAt": "2020-03-09T09:10:42Z", "author": {"login": "daneshk"}, "path": "stdlib/grpc/src/main/ballerina/src/grpc/client_endpoint.bal", "diffHunk": "@@ -56,7 +57,12 @@ public type Client client object {\n     # + headers - Optional headers parameter. Passes header value if needed. Default sets to nil.\n     # + return - Returns response message and headers if executes successfully, error otherwise.\n     public remote function blockingExecute(string methodID, anydata payload, Headers? headers = ()) returns ([anydata, Headers]|Error) {\n-        return externBlockingExecute(self, java:fromString(methodID), payload, headers);\n+        var retryConfig = self.config.retryConfiguration;\n+        handle methodIdHandle = java:fromString(methodID);\n+        if (retryConfig is RetryConfiguration) {\n+            return retryBlockingAction(self, methodIdHandle, payload, headers, retryConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ecf34d35aaabb3a0f09e798fa17c581b5dacb52"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3699695ae2672b19adde35931aa5ce7246a5e2f7", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3699695ae2672b19adde35931aa5ce7246a5e2f7", "committedDate": "2020-03-10T04:01:31Z", "message": "Apply suggestions from code review\n\nCo-Authored-By: Danesh Kuruppu <daneshk@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3e5303178037c2055729c584e4997e81d9a092", "author": {"user": {"login": "ThisaruGuruge", "name": "Thisaru Guruge"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8f3e5303178037c2055729c584e4997e81d9a092", "committedDate": "2020-03-10T04:03:21Z", "message": "remove travis fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODY5NTQ1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21490#pullrequestreview-371869545", "createdAt": "2020-03-10T11:25:47Z", "commit": {"oid": "8f3e5303178037c2055729c584e4997e81d9a092"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3969, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}