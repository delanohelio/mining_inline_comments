{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyOTQ0NDc4", "number": 26988, "title": "Add 'dependency-graph.json' to Balo", "bodyText": "Purpose\n\nAdd dependency-graph.json to balo file to retrieve the dependency list of the packages and modules.\n\nFixes #\nApproach\n\ndependency-graph.json will have package dependencies and module dependencies like the below example.\n\n{\n  \"package\": [\n    {\n      \"org\": \"samjs\",\n      \"name\": \"package_d\",\n      \"version\": \"0.1.0\",\n      \"dependencies\": [\n        {\n          \"org\": \"samjs\",\n          \"name\": \"package_b\",\n          \"version\": \"0.1.0\"\n        },\n        {\n          \"org\": \"samjs\",\n          \"name\": \"package_e\",\n          \"version\": \"0.1.0\"\n        }\n      ]\n    },\n    {\n      \"org\": \"samjs\",\n      \"name\": \"package_b\",\n      \"version\": \"0.1.0\",\n      \"dependencies\": []\n    },\n    {\n      \"org\": \"samjs\",\n      \"name\": \"package_e\",\n      \"version\": \"0.1.0\",\n      \"dependencies\": []\n    }\n  ],\n  \"module\": [\n    {\n      \"name\": \"package_d\",\n      \"dependencies\": []\n    }\n  ]\n}\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-11-18T06:19:44Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988", "merged": true, "mergeCommit": {"oid": "5d36b6e67fc0a47a84d5ec7d0b2d95ea572ee5da"}, "closed": true, "closedAt": "2020-11-21T11:57:34Z", "author": {"login": "pramodya1994"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddokUtgFqTUzMzE0ODA3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeHSQDABqjQwMTczNjkwNDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTQ4MDcw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#pullrequestreview-533148070", "createdAt": "2020-11-18T06:56:46Z", "commit": {"oid": "6245d728933166b5c75ed60972bb7588a3470c0a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNjo1Njo0N1rOH1febw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNjo1Njo0N1rOH1febw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg1MjI3MQ==", "bodyText": "Here we are writing the list of dependencies.  I think the original requirement was to dump the dependency graph so that we can get it back when we read the Balo project?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#discussion_r525852271", "createdAt": "2020-11-18T06:56:47Z", "author": {"login": "sameerajayasoma"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/BaloWriter.java", "diffHunk": "@@ -244,6 +255,31 @@ private void addPackageSource(ZipOutputStream baloOutputStream, Package pkg) thr\n         }\n     }\n \n+    private void addDependenciesJson(ZipOutputStream baloOutputStream, Package pkg) {\n+        List<PackageId> sortedPackageIds = pkg.getCompilation().packageDependencyGraph().toTopologicallySortedList();\n+        ProjectEnvironment projectEnvironment = pkg.packageContext().project().projectEnvironmentContext();\n+        PackageResolver packageResolver = projectEnvironment.getService(PackageResolver.class);\n+        List<Dependency> dependencies = new ArrayList<>();\n+\n+        for (PackageId packageId : sortedPackageIds) {\n+            PackageContext packageContext = packageResolver.getPackage(packageId).packageContext();\n+            Dependency dependency = new Dependency(packageContext.packageOrg().toString(),\n+                    packageContext.packageName().toString(),\n+                    packageContext.packageVersion().toString());\n+            dependencies.add(dependency);\n+        }\n+\n+        DependenciesJson dependenciesJson = new DependenciesJson(dependencies);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6245d728933166b5c75ed60972bb7588a3470c0a"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "committedDate": "2020-11-18T11:43:37Z", "message": "Add 'dependencies.json' to balo"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6245d728933166b5c75ed60972bb7588a3470c0a", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6245d728933166b5c75ed60972bb7588a3470c0a", "committedDate": "2020-11-18T06:17:44Z", "message": "Add 'dependencies.json' to balo"}, "afterCommit": {"oid": "ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "committedDate": "2020-11-18T11:43:37Z", "message": "Add 'dependencies.json' to balo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58de042751597892a4be5beca8e6c14a1592003", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a58de042751597892a4be5beca8e6c14a1592003", "committedDate": "2020-11-18T12:46:28Z", "message": "Merge branch 'prj_api_module_refactor' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjA1MTA5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#pullrequestreview-533605109", "createdAt": "2020-11-18T16:05:27Z", "commit": {"oid": "a58de042751597892a4be5beca8e6c14a1592003"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjowNToyN1rOH11PPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjowNToyN1rOH11PPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwODgzMQ==", "bodyText": "I have a concern about exposing the internal data structure of the dependency graph.\nWe can refactor this later.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#discussion_r526208831", "createdAt": "2020-11-18T16:05:27Z", "author": {"login": "sameerajayasoma"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/DependencyGraph.java", "diffHunk": "@@ -84,6 +84,10 @@ public void findCycles() {\n         return topologicallySortedNodes;\n     }\n \n+    Map<T, Set<T>> dependencies() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58de042751597892a4be5beca8e6c14a1592003"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b290863ff061f888f7e929a69f4961c361186076", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b290863ff061f888f7e929a69f4961c361186076", "committedDate": "2020-11-19T04:01:31Z", "message": "Merge branch 'prj_api_module_refactor' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13aaa4f1267e5942076d7b0ee932e59600e131da", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/13aaa4f1267e5942076d7b0ee932e59600e131da", "committedDate": "2020-11-19T11:38:35Z", "message": "Merge branch 'prj_api_module_refactor' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a728248417d0445aeb5725c1fb58f5e55ccf2acc", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a728248417d0445aeb5725c1fb58f5e55ccf2acc", "committedDate": "2020-11-19T15:59:19Z", "message": "Add 'dependency-graph.json' to balo & populate balo project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fb7f558dc64691d6f2eade873183f54c758abd9", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9fb7f558dc64691d6f2eade873183f54c758abd9", "committedDate": "2020-11-19T16:55:27Z", "message": "Fix checkstyles and test failures"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9806118e41b0cfd1d53775df85ffaf1922402657", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9806118e41b0cfd1d53775df85ffaf1922402657", "committedDate": "2020-11-19T16:56:15Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}, "afterCommit": {"oid": "41f92ae8a287c4f299130ef6c16d7cf994eabab5", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41f92ae8a287c4f299130ef6c16d7cf994eabab5", "committedDate": "2020-11-19T18:37:34Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e3ff6323d7a1b6e11635ca91ef45666f9502956", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e3ff6323d7a1b6e11635ca91ef45666f9502956", "committedDate": "2020-11-19T18:43:47Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41f92ae8a287c4f299130ef6c16d7cf994eabab5", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41f92ae8a287c4f299130ef6c16d7cf994eabab5", "committedDate": "2020-11-19T18:37:34Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}, "afterCommit": {"oid": "6e3ff6323d7a1b6e11635ca91ef45666f9502956", "author": {"user": {"login": "pramodya1994", "name": "Pramodya Mendis"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e3ff6323d7a1b6e11635ca91ef45666f9502956", "committedDate": "2020-11-19T18:43:47Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4906, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}