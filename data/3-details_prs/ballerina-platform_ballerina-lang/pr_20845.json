{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMjcyMDMy", "number": 20845, "title": "Add initial implementation of Query expression", "bodyText": "Purpose\nThis PR contains the initial implementation of query expression.\nApproach\nN/A\nSamples\nN/A\nRemarks\nRefer, related issue #20722 ...\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-03T11:38:36Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845", "merged": true, "mergeCommit": {"oid": "1f82b1e396bbab492ed3b21f856f2dbb5accc28e"}, "closed": true, "closedAt": "2020-02-05T11:00:34Z", "author": {"login": "mohanvive"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-wCN_AH2gAyMzcwMjcyMDMyOjExMzQzNmVjYjIyMmI5MTRmNzUyNzAxOTJhOGIxNjg2NTZhMzFlZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBSZ6WAFqTM1MzU1NjQzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "113436ecb222b914f75270192a8b168656a31ef5", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/113436ecb222b914f75270192a8b168656a31ef5", "committedDate": "2020-01-28T11:56:06Z", "message": "Add initial query implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1396251e3775d648d1a5dbab6172c55c3f4d7f0f", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1396251e3775d648d1a5dbab6172c55c3f4d7f0f", "committedDate": "2020-01-30T04:54:54Z", "message": "Add initial desugar changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "971c1829dd8500071542632228ee9939b202e621", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/971c1829dd8500071542632228ee9939b202e621", "committedDate": "2020-01-30T06:11:33Z", "message": "Refactor desugar implementation & tree builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35140c73b6a366f78cd480006352399b3f61a7d", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f35140c73b6a366f78cd480006352399b3f61a7d", "committedDate": "2020-01-30T06:54:33Z", "message": "Introduce where clause to Query Expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208845ed8aa1ca168d9b6f1bac8b4e16f73263b5", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/208845ed8aa1ca168d9b6f1bac8b4e16f73263b5", "committedDate": "2020-01-30T06:54:33Z", "message": "Desugar where clause to If statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ca34c066e2206fd5b6f3f4f1ce90560011bf01", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c5ca34c066e2206fd5b6f3f4f1ce90560011bf01", "committedDate": "2020-01-30T06:59:59Z", "message": "Add comments to where desugar logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00de5e9039d30ecb7db445c45ebcaf77c442fe37", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/00de5e9039d30ecb7db445c45ebcaf77c442fe37", "committedDate": "2020-01-30T07:12:35Z", "message": "Add license headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24faacd3d51bb51c82ac1a0f8458a5ffb4ee289e", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/24faacd3d51bb51c82ac1a0f8458a5ffb4ee289e", "committedDate": "2020-01-30T07:33:23Z", "message": "Introduce where clause to Query Expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fa3e1dc72523f0f20ce411bd73852fa2ed9778d", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3fa3e1dc72523f0f20ce411bd73852fa2ed9778d", "committedDate": "2020-01-30T07:37:44Z", "message": "Revert \"Introduce where clause to Query Expression\"\n\nThis reverts commit 24faacd3d51bb51c82ac1a0f8458a5ffb4ee289e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eee1b04860022ed3dd6acaa6de0eef3f0a9f5dd8", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eee1b04860022ed3dd6acaa6de0eef3f0a9f5dd8", "committedDate": "2020-01-30T07:41:32Z", "message": "Introduce where clause to query expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f51d9b7acc91c8282232d3e516c0a1994104ee3f", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f51d9b7acc91c8282232d3e516c0a1994104ee3f", "committedDate": "2020-01-30T08:25:51Z", "message": "Merge branch 'query-phase1' of https://github.com/mohanvive/ballerina-lang into query-phase1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "890d10bf22e79370e5fa7d13341155cabf0be963", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/890d10bf22e79370e5fa7d13341155cabf0be963", "committedDate": "2020-01-30T08:27:09Z", "message": "Fix to allow whereclause as optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d53e169e6c88e47eb385aeff961cd812806ff096", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d53e169e6c88e47eb385aeff961cd812806ff096", "committedDate": "2020-01-30T11:22:58Z", "message": "Add support for multiple from clauses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59f39375b2c6da0dcce653f4b0973569f6f5c489", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/59f39375b2c6da0dcce653f4b0973569f6f5c489", "committedDate": "2020-01-31T04:46:02Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into query-phase1\n\n# Conflicts:\n#\ttool-plugins/vscode/grammar/ballerina-grammar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "911a5042232513d0f11a6d9b42287cdc1c8d67b6", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/911a5042232513d0f11a6d9b42287cdc1c8d67b6", "committedDate": "2020-01-31T13:23:56Z", "message": "Add testcases for select query expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd823232365def4b30f065c84608832341f10ad0", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fd823232365def4b30f065c84608832341f10ad0", "committedDate": "2020-02-02T18:46:53Z", "message": "Support multiple where clauses to be added to query expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be7705d9465683cb4bfc667413e2b1116930dd23", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/be7705d9465683cb4bfc667413e2b1116930dd23", "committedDate": "2020-02-03T05:12:55Z", "message": "Add multiple where clause testcase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e5a28d606f90c3c0688612794bf3bbbff3d1316", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0e5a28d606f90c3c0688612794bf3bbbff3d1316", "committedDate": "2020-02-03T06:51:44Z", "message": "Add query expression native test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ed8a2f470ca90b995da22d8c0133d75b61d0567", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7ed8a2f470ca90b995da22d8c0133d75b61d0567", "committedDate": "2020-02-03T06:55:31Z", "message": "Merge branch 'query-phase1' of https://github.com/mohanvive/ballerina-lang into query-phase1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f2e3a40028d946236c52251fa7e25dfc372dabd", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5f2e3a40028d946236c52251fa7e25dfc372dabd", "committedDate": "2020-02-03T06:58:37Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into query-phase1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88881b9d71c4f6d4f68a4c02a5d099ccf125392b", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/88881b9d71c4f6d4f68a4c02a5d099ccf125392b", "committedDate": "2020-02-03T09:20:31Z", "message": "Add testcase for basic type array list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "108d6e103a5add48d235de6b241b4a9a26dfd2fc", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/108d6e103a5add48d235de6b241b4a9a26dfd2fc", "committedDate": "2020-02-03T11:17:06Z", "message": "Add support for custom select expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d8eea4d09191e86aa92bcbf591cdec18dc0c9b", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b4d8eea4d09191e86aa92bcbf591cdec18dc0c9b", "committedDate": "2020-02-03T12:02:06Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into query-phase1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abd9494b3c9ed8532360968d89310aa2341ffb31", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/abd9494b3c9ed8532360968d89310aa2341ffb31", "committedDate": "2020-02-03T12:10:13Z", "message": "Revert irrelevant vscode plugin changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16d8596662680f572f111457a72e681df3c6f798", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/16d8596662680f572f111457a72e681df3c6f798", "committedDate": "2020-02-03T12:14:38Z", "message": "Set where clause's environment as parent for select clause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc0cdb5c73ed599c6d03b43db6ffbd9ed9dc9ef", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7dc0cdb5c73ed599c6d03b43db6ffbd9ed9dc9ef", "committedDate": "2020-02-03T13:08:02Z", "message": "Revert irrelevant ballerina-grammar changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dea09093f9b04373ec7076bd8cf718dd9a644348", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dea09093f9b04373ec7076bd8cf718dd9a644348", "committedDate": "2020-02-03T13:33:24Z", "message": "Fix checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce33eb96c86f34b5602e6907d83c1b1fba8990d", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3ce33eb96c86f34b5602e6907d83c1b1fba8990d", "committedDate": "2020-02-04T03:27:41Z", "message": "Fix checkstyle and findbug issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c7328512745863ae332d0b55166b095f65d8b7c", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9c7328512745863ae332d0b55166b095f65d8b7c", "committedDate": "2020-02-05T04:30:10Z", "message": "Fix the test failure due to grammar changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/afe62db700616a9c5150087fb801eceb719097ea", "committedDate": "2020-02-05T05:12:41Z", "message": "Fix the test failure due to grammar changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDcxMjU1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#pullrequestreview-353471255", "createdAt": "2020-02-05T05:18:37Z", "commit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToxODozN1rOFlsDmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToxODozN1rOFlsDmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MzQ1MA==", "bodyText": "Need to add version info", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#discussion_r375063450", "createdAt": "2020-02-05T05:18:37Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/clauses/FromClauseNode.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.ballerinalang.model.clauses;\n+\n+import org.ballerinalang.model.tree.Node;\n+import org.ballerinalang.model.tree.expressions.ExpressionNode;\n+import org.ballerinalang.model.tree.statements.VariableDefinitionNode;\n+\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDcxNjUx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#pullrequestreview-353471651", "createdAt": "2020-02-05T05:20:15Z", "commit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToyMDoxNlrOFlsE3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToyMDoxNlrOFlsE3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2Mzc3NQ==", "bodyText": "IMO the description is not meaningful", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#discussion_r375063775", "createdAt": "2020-02-05T05:20:16Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/tree/expressions/QueryExpressionNode.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.ballerinalang.model.tree.expressions;\n+\n+import org.ballerinalang.model.clauses.FromClauseNode;\n+import org.ballerinalang.model.clauses.SelectClauseNode;\n+import org.ballerinalang.model.clauses.WhereClauseNode;\n+\n+import java.util.List;\n+\n+/**\n+ * Expression of (expression).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDcyNjgz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#pullrequestreview-353472683", "createdAt": "2020-02-05T05:24:32Z", "commit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToyNDozM1rOFlsIOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToyNDozM1rOFlsIOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2NDYzMw==", "bodyText": "Why do we set this field to true always?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#discussion_r375064633", "createdAt": "2020-02-05T05:24:33Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -4324,6 +4328,139 @@ public void visit(BLangStatementExpression bLangStatementExpression) {\n         result = bLangStatementExpression;\n     }\n \n+    @Override\n+    public void visit(BLangQueryExpr queryExpr) {\n+        List<BLangFromClause> fromClauseList = queryExpr.fromClauseList;\n+        BLangFromClause fromClause = fromClauseList.get(0);\n+        BLangSelectClause selectClause = queryExpr.selectClause;\n+        List<BLangWhereClause> whereClauseList = queryExpr.whereClauseList;\n+        DiagnosticPos pos = fromClause.pos;\n+\n+        // Create Foreach statement\n+        //\n+        // Below query expression :\n+        //      from var person in personList\n+        //\n+        // changes as,\n+        //      foreach var person in personList {\n+        //          ....\n+        //      }\n+\n+        BLangForeach leafForEach = null;\n+        BLangForeach parentForEach = null;\n+\n+        for (BLangFromClause bLangFromClause : fromClauseList) {\n+            BLangForeach foreach = (BLangForeach) TreeBuilder.createForeachNode();\n+            foreach.pos = queryExpr.pos;\n+            foreach.collection = bLangFromClause.collection;\n+            types.setForeachTypedBindingPatternType(foreach);\n+\n+            foreach.variableDefinitionNode = bLangFromClause.variableDefinitionNode;\n+            foreach.isDeclaredWithVar = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDczNDEw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#pullrequestreview-353473410", "createdAt": "2020-02-05T05:27:32Z", "commit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToyNzozMlrOFlsKpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToyNzozMlrOFlsKpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2NTI1NQ==", "bodyText": "this is always not null after typechecker?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#discussion_r375065255", "createdAt": "2020-02-05T05:27:32Z", "author": {"login": "gimantha"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -4324,6 +4328,139 @@ public void visit(BLangStatementExpression bLangStatementExpression) {\n         result = bLangStatementExpression;\n     }\n \n+    @Override\n+    public void visit(BLangQueryExpr queryExpr) {\n+        List<BLangFromClause> fromClauseList = queryExpr.fromClauseList;\n+        BLangFromClause fromClause = fromClauseList.get(0);\n+        BLangSelectClause selectClause = queryExpr.selectClause;\n+        List<BLangWhereClause> whereClauseList = queryExpr.whereClauseList;\n+        DiagnosticPos pos = fromClause.pos;\n+\n+        // Create Foreach statement\n+        //\n+        // Below query expression :\n+        //      from var person in personList\n+        //\n+        // changes as,\n+        //      foreach var person in personList {\n+        //          ....\n+        //      }\n+\n+        BLangForeach leafForEach = null;\n+        BLangForeach parentForEach = null;\n+\n+        for (BLangFromClause bLangFromClause : fromClauseList) {\n+            BLangForeach foreach = (BLangForeach) TreeBuilder.createForeachNode();\n+            foreach.pos = queryExpr.pos;\n+            foreach.collection = bLangFromClause.collection;\n+            types.setForeachTypedBindingPatternType(foreach);\n+\n+            foreach.variableDefinitionNode = bLangFromClause.variableDefinitionNode;\n+            foreach.isDeclaredWithVar = true;\n+\n+            if (leafForEach != null) {\n+                BLangBlockStmt foreachBody = ASTBuilderUtil.createBlockStmt(pos);\n+                foreachBody.addStatement(foreach);\n+                leafForEach.setBody(foreachBody);\n+            } else {\n+                parentForEach = foreach;\n+            }\n+\n+            leafForEach = foreach;\n+        }\n+\n+        BLangBlockStmt foreachBody = ASTBuilderUtil.createBlockStmt(pos);\n+\n+        BType outputArrayType;\n+        if (selectClause.expression  != null && selectClause.expression.type != null) {\n+            outputArrayType = new BArrayType(selectClause.expression.type);\n+        } else {\n+            outputArrayType = fromClause.varType;\n+        }\n+\n+        BLangListConstructorExpr emptyArrayExpr = ASTBuilderUtil.createEmptyArrayLiteral(pos,\n+                (BArrayType) outputArrayType);\n+        BVarSymbol emptyArrayVarSymbol = new BVarSymbol(0, new Name(\"$outputDataArray$\"),\n+                this.env.scope.owner.pkgID, outputArrayType, env.scope.owner);\n+        BLangSimpleVariable outputArrayVariable =\n+                ASTBuilderUtil.createVariable(pos, \"$outputDataArray$\", outputArrayType,\n+                        emptyArrayExpr, emptyArrayVarSymbol);\n+\n+        // Create temp array variable\n+        //      Person[] x = [];\n+\n+        BLangSimpleVariableDef outputVariableDef =\n+                ASTBuilderUtil.createVariableDef(pos, outputArrayVariable);\n+        BLangSimpleVarRef outputVarRef = ASTBuilderUtil.createVariableRef(pos, outputArrayVariable.symbol);\n+\n+        // Create indexed based access expression statement\n+        //      x[x.length()] = {\n+        //         firstName: person.firstName,\n+        //         lastName: person.lastName\n+        //      };\n+\n+        if (selectClause.expression.type == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe62db700616a9c5150087fb801eceb719097ea"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f940b062e7556a7369d52fc187a1fd4c843dba6", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f940b062e7556a7369d52fc187a1fd4c843dba6", "committedDate": "2020-02-05T05:30:17Z", "message": "Add fixes to review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675328f4685103140560b0353f8c40587953af9f", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/675328f4685103140560b0353f8c40587953af9f", "committedDate": "2020-02-05T07:45:18Z", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into query-phase1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1afe63121fec71fc354ee91372f132cc4426d313", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1afe63121fec71fc354ee91372f132cc4426d313", "committedDate": "2020-02-05T07:56:23Z", "message": "Fix the conflicts due to stream changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ada92092c9ad07b619ddb502f6394c279dfac1d6", "author": {"user": {"login": "pcnfernando", "name": "Chiran Fernando"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ada92092c9ad07b619ddb502f6394c279dfac1d6", "committedDate": "2020-02-05T07:58:34Z", "message": "Add tests for map, tuple, json used with query expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b32d7cea7811c46e90d6257e60a66097199e1f2", "author": {"user": {"login": "mohanvive", "name": "Mohanadarshan V"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7b32d7cea7811c46e90d6257e60a66097199e1f2", "committedDate": "2020-02-05T08:35:08Z", "message": "Fix for the checkstyle issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNTU2NDMw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20845#pullrequestreview-353556430", "createdAt": "2020-02-05T09:06:36Z", "commit": {"oid": "7b32d7cea7811c46e90d6257e60a66097199e1f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4290, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}