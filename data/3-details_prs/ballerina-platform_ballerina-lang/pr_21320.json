{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNjk3ODU0", "number": 21320, "title": "Fix Compilation error when function has a function typed param with only rest params", "bodyText": "Purpose\n$title\nFixes #20919\nApproach\nVar list stack pops out the empty list added to the var list stack if function typed param has only rest param\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-27T08:14:05Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320", "merged": true, "mergeCommit": {"oid": "76a53ff03c106ce05c66a78a19775465dd002fd0"}, "closed": true, "closedAt": "2020-03-05T07:58:10Z", "author": {"login": "dulajdilshan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIZykKAFqTM2NTYxMzI4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKmzZBgFqTM2OTM1NjA4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjEzMjg2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#pullrequestreview-365613286", "createdAt": "2020-02-27T11:40:19Z", "commit": {"oid": "d64fd3e833536be164bdf00a5a60dd21e7e08125"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMTo0MDoxOVrOFvPDdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMTo0MDoxOVrOFvPDdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3NDAzNg==", "bodyText": "We normally don't mention the issue number on fixes. Shall we remove the issue number?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385074036", "createdAt": "2020-02-27T11:40:19Z", "author": {"login": "irshadnilam"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangPackageBuilder.java", "diffHunk": "@@ -574,6 +574,9 @@ void addFunctionType(DiagnosticPos pos, Set<Whitespace> ws, boolean paramsAvail,\n         if (paramsAvail) {\n             functionTypeNode.addWS(commaWsStack.pop());\n             functionTypeNode.params.addAll(this.varListStack.pop());\n+        } else if (restParamAvail) {\n+            // VarListStack pops when function typed param has only rest params, Fix for: 20919", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d64fd3e833536be164bdf00a5a60dd21e7e08125"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjEzMzg4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#pullrequestreview-365613388", "createdAt": "2020-02-27T11:40:31Z", "commit": {"oid": "d64fd3e833536be164bdf00a5a60dd21e7e08125"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMTo0MDozMVrOFvPDzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMTo0MDozMVrOFvPDzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3NDEyNQ==", "bodyText": "Line break", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385074125", "createdAt": "2020-02-27T11:40:31Z", "author": {"login": "irshadnilam"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionWithFunctionTypedParamWithOnlyRestParam(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testInvokeFunctionWithFunctionTypedParamWithOnlyRestParam1() returns [int,int]{\n+    int[] x = [4];\n+    return functionWithFunctionTypedParamWithOnlyRestParam(x, sampleFunctionTypedParam);\n+}\n+\n+function testInvokeFunctionWithFunctionTypedParamWithOnlyRestParam2() returns [int,int]{\n+    int[] x = [10, 20, 30];\n+    return functionWithFunctionTypedParamWithOnlyRestParam(x, sampleFunctionTypedParam);\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d64fd3e833536be164bdf00a5a60dd21e7e08125"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MTYwMTU3", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#pullrequestreview-366160157", "createdAt": "2020-02-28T04:52:40Z", "commit": {"oid": "56d061ed6bcd5b6dc9b3b89acd45735a4203402f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjE0OTg4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#pullrequestreview-366214988", "createdAt": "2020-02-28T08:01:22Z", "commit": {"oid": "56d061ed6bcd5b6dc9b3b89acd45735a4203402f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODowMToyMlrOFvsWrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODowMToyMlrOFvsWrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NDA5Mw==", "bodyText": "Shall we shorten the function names?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385554093", "createdAt": "2020-02-28T08:01:22Z", "author": {"login": "hasithaa"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionWithFunctionTypedParamWithOnlyRestParam(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testInvokeFunctionWithFunctionTypedParamWithOnlyRestParam1() returns [int,int]{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56d061ed6bcd5b6dc9b3b89acd45735a4203402f"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56d061ed6bcd5b6dc9b3b89acd45735a4203402f", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/56d061ed6bcd5b6dc9b3b89acd45735a4203402f", "committedDate": "2020-02-28T03:56:07Z", "message": "- removed the issue number in the comment -Added a line break to the .bal file"}, "afterCommit": {"oid": "5635a38ec1173c52a27e57dd54222f1f2cf07f35", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5635a38ec1173c52a27e57dd54222f1f2cf07f35", "committedDate": "2020-02-28T09:51:29Z", "message": "Fix some code practices issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5635a38ec1173c52a27e57dd54222f1f2cf07f35", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5635a38ec1173c52a27e57dd54222f1f2cf07f35", "committedDate": "2020-02-28T09:51:29Z", "message": "Fix some code practices issues"}, "afterCommit": {"oid": "90529b291b355958c1040103b5ab3799ffb333ac", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90529b291b355958c1040103b5ab3799ffb333ac", "committedDate": "2020-02-28T09:54:26Z", "message": "Fix some code practices issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90529b291b355958c1040103b5ab3799ffb333ac", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90529b291b355958c1040103b5ab3799ffb333ac", "committedDate": "2020-02-28T09:54:26Z", "message": "Fix some code practices issues"}, "afterCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/92c564970f91e9ffea457f6e43cae43953344e6b", "committedDate": "2020-02-28T11:14:13Z", "message": "Resolve param issue when function typed params with rest params are used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MTI2MDcz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#pullrequestreview-367126073", "createdAt": "2020-03-02T11:24:21Z", "commit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMToyNDoyMlrOFwcJAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMToyNzoyN1rOFwcOag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNzAyNA==", "bodyText": "Do we need this comment? Shall we maybe improve it to indicate popping out the empty list added to the var list stack if no non-rest params are available?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386337024", "createdAt": "2020-03-02T11:24:22Z", "author": {"login": "MaryamZi"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangPackageBuilder.java", "diffHunk": "@@ -574,6 +574,9 @@ void addFunctionType(DiagnosticPos pos, Set<Whitespace> ws, boolean paramsAvail,\n         if (paramsAvail) {\n             functionTypeNode.addWS(commaWsStack.pop());\n             functionTypeNode.params.addAll(this.varListStack.pop());\n+        } else if (restParamAvail) {\n+            // VarListStack pops when function typed param has only rest params", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODAwNA==", "bodyText": "Since recently, we've been trying to write the tests more in Ballerina. For example, \n  \n    \n      ballerina-lang/tests/jballerina-unit-test/src/test/resources/test-src/expressions/mappingconstructor/spread_op_field.bal\n    \n    \n         Line 31\n      in\n      133d901\n    \n    \n    \n    \n\n        \n          \n           public function testMapRefAsSpreadOp() { \n        \n    \n  \n\n.\nShall we try and do the same for the newly added tests?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338004", "createdAt": "2020-03-02T11:26:32Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/functions/FunctionSignatureTest.java", "diffHunk": "@@ -444,4 +444,30 @@ public static ArrayValue mockedNativeFuncWithOptionalParams(long a, double b, St\n         tuple.add(4, (Object) e);\n         return tuple;\n     }\n+\n+    @Test(description = \"Test1: function signature which has a function typed param with only rest param\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODE2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n          \n          \n            \n            function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int, int] {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338162", "createdAt": "2020-03-02T11:26:50Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODIxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function sampleFunctionTypedParam(int... a) returns int{\n          \n          \n            \n            function sampleFunctionTypedParam(int... a) returns int {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338215", "createdAt": "2020-03-02T11:26:59Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODMyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest1() returns [int,int]{\n          \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest1() returns [int, int] {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338322", "createdAt": "2020-03-02T11:27:14Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testFunctionOfFunctionTypedParamWithRest1() returns [int,int]{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODQxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest2() returns [int,int]{\n          \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest2() returns [int, int] {", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338410", "createdAt": "2020-03-02T11:27:27Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testFunctionOfFunctionTypedParamWithRest1() returns [int,int]{\n+    int[] x = [4];\n+    return functionOfFunctionTypedParamWithRest(x, sampleFunctionTypedParam);\n+}\n+\n+function testFunctionOfFunctionTypedParamWithRest2() returns [int,int]{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "committedDate": "2020-03-03T10:35:19Z", "message": "Resolve param issue when function typed params with rest params are used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d557e0da26dcb2ba1b4f0bec4ba541e700232aa", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7d557e0da26dcb2ba1b4f0bec4ba541e700232aa", "committedDate": "2020-03-03T10:07:21Z", "message": "Add minor changes"}, "afterCommit": {"oid": "cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "committedDate": "2020-03-03T10:35:19Z", "message": "Resolve param issue when function typed params with rest params are used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzU2MDg0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#pullrequestreview-369356084", "createdAt": "2020-03-05T07:57:51Z", "commit": {"oid": "cd1ba9cf87786fa5dba9eaefbd57c2eba8693021"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4052, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}