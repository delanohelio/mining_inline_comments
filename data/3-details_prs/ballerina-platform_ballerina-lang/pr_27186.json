{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MDc1MzY1", "number": 27186, "title": "Integrate the Project API changes to Formatter CLI", "bodyText": "Purpose\n$subject\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-11-26T13:24:17Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186", "merged": true, "mergeCommit": {"oid": "3367fd09803ceec0584b4c762011ef8f77818701"}, "closed": true, "closedAt": "2020-11-26T15:27:15Z", "author": {"login": "IrushiL"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgRtv3AH2gAyNTI4MDc1MzY1OjcwNWUyZWI3N2M5NWY5M2Y0YmMxOTM3ZDRmZWUzZDljY2YwNTQwZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgUZiAAFqTUzOTM5MzE0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "705e2eb77c95f93f4bc1937d4fee3d9ccf0540da", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/705e2eb77c95f93f4bc1937d4fee3d9ccf0540da", "committedDate": "2020-11-26T12:01:10Z", "message": "Migrate the formatter cli with Project API changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/531730be58b79c5411b556aff1b17d79896a255b", "committedDate": "2020-11-26T13:21:37Z", "message": "Fix the formatter tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzE3MDc0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#pullrequestreview-539317074", "createdAt": "2020-11-26T13:31:15Z", "commit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMToxNVrOH6bjsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMToxNVrOH6bjsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDk2Mg==", "bodyText": "The ProjectConstants.TEST_DIR_NAME is removed here since it adds a duplicated tests directory in the path generated. Here, the module.document(documentId).name()) gives the bal file path along with the tests directory.\nE.g. If the .bal file inside the tests directory is main_test.bal the name given by module.document(documentId).name()) would be,\ntests/main_test.bal\nThere weren't other usages found for this method except for the one that is added in this PR.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531030962", "createdAt": "2020-11-26T13:31:15Z", "author": {"login": "IrushiL"}, "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "diffHunk": "@@ -94,15 +94,10 @@ private BuildProject(ProjectEnvironmentBuilder environmentBuilder, Path projectP\n         for (ModuleId moduleId : currentPackage().moduleIds()) {\n             Module module = currentPackage().module(moduleId);\n             Optional<Path> modulePath = modulePath(moduleId);\n-            if (module.documentIds().contains(documentId)) {\n+            if (module.documentIds().contains(documentId) || module.testDocumentIds().contains(documentId)) {\n                 if (modulePath.isPresent()) {\n                     return Optional.of(modulePath.get().resolve(module.document(documentId).name()));\n                 }\n-            } else if (module.testDocumentIds().contains(documentId)) {\n-                if (modulePath.isPresent()) {\n-                    return Optional.of(modulePath.get()\n-                            .resolve(ProjectConstants.TEST_DIR_NAME).resolve(module.document(documentId).name()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzIxNDky", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#pullrequestreview-539321492", "createdAt": "2020-11-26T13:37:14Z", "commit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozNzoxNFrOH6bxGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozNzoxNFrOH6bxGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNDM5Mg==", "bodyText": "We dont need this check here. BuildProject.load() will do the validation", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531034392", "createdAt": "2020-11-26T13:37:14Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -117,6 +108,11 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                 } else {\n                     moduleName = argList.get(0);\n \n+                    // Check whether the given directory is not in a ballerina project.\n+                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzIyMTgx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#pullrequestreview-539322181", "createdAt": "2020-11-26T13:38:10Z", "commit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozODoxMFrOH6bzJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozODoxMFrOH6bzJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNDkxNw==", "bodyText": "We need to wrap this with a try-catch to catch the ProjectException", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531034917", "createdAt": "2020-11-26T13:38:10Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzIyNzUz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#pullrequestreview-539322753", "createdAt": "2020-11-26T13:38:57Z", "commit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozODo1N1rOH6b05w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozODo1N1rOH6b05w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTM2Nw==", "bodyText": "We need to iterate the module ids and get the module", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531035367", "createdAt": "2020-11-26T13:38:57Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzIzMDQw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#pullrequestreview-539323040", "createdAt": "2020-11-26T13:39:20Z", "commit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozOToyMFrOH6b11w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozOToyMFrOH6b11w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzNTYwNw==", "bodyText": "We can remove this", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#discussion_r531035607", "createdAt": "2020-11-26T13:39:20Z", "author": {"login": "azinneera"}, "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -130,32 +126,55 @@ static void execute(List<String> argList, boolean helpFlag, boolean dryRun, Path\n                         }\n                     }\n \n-                    // Check whether the given directory is not in a ballerina project.\n-                    if (!FormatUtil.isBallerinaProject(sourceRootPath)) {\n-                        throw LauncherUtils.createLauncherException(Messages.getNotBallerinaProject());\n-                    }\n-                    BLangPackage bLangPackage = FormatUtil\n-                            .compileModule(sourceRootPath, getModuleName(moduleName));\n+                    BuildProject project = BuildProject.load(sourceRootPath, constructBuildOptions());\n+                    Package currentPackage = project.currentPackage();\n+                    Module module = currentPackage.module(ModuleName.from(currentPackage.packageName(),\n+                            getModuleName(moduleName)));\n \n                     // Iterate and format the ballerina package.\n-                    List<String> formattedFiles = iterateAndFormat(bLangPackage, sourceRootPath, dryRun);\n+                    List<String> formattedFiles = iterateAndFormat(getDocumentPaths(project, module.moduleId()),\n+                            sourceRootPath, dryRun);\n                     generateChangeReport(formattedFiles, dryRun);\n                 }\n             } else {\n-                List<BLangPackage> packages = FormatUtil.compileProject(sourceRootPath);\n-                List<String> formattedFiles = new ArrayList<>();\n-                // Iterate and format all the ballerina packages.\n-                for (BLangPackage bLangPackage : packages) {\n-                    formattedFiles.addAll(iterateAndFormat(bLangPackage, sourceRootPath, dryRun));\n+                // Check whether the given directory is not a ballerina project.\n+                if (!FormatUtil.isBallerinaProject(sourceRootPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "531730be58b79c5411b556aff1b17d79896a255b"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "384de858cb1e741efbe0d809533b9f6a259d0501", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/384de858cb1e741efbe0d809533b9f6a259d0501", "committedDate": "2020-11-26T13:57:19Z", "message": "Fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaac3f06e78d639e6f921d02dd0383e4f5ed786f", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aaac3f06e78d639e6f921d02dd0383e4f5ed786f", "committedDate": "2020-11-26T14:22:39Z", "message": "Fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cb043d79e534d3d24c4664e047742e56235347d", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7cb043d79e534d3d24c4664e047742e56235347d", "committedDate": "2020-11-26T14:32:15Z", "message": "Fix checkstyle issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666b335690cc92e4f46326d6fd6523d47fd5fb8f", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/666b335690cc92e4f46326d6fd6523d47fd5fb8f", "committedDate": "2020-11-26T14:55:11Z", "message": "Fix a review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzkzMTQ2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27186#pullrequestreview-539393146", "createdAt": "2020-11-26T15:08:48Z", "commit": {"oid": "666b335690cc92e4f46326d6fd6523d47fd5fb8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4841, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}