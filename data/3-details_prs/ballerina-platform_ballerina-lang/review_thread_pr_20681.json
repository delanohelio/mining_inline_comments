{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MDk1NDkw", "number": 20681, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozNzoxMlrODZv7ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo1Njo1NVrODebRfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MzI2MzMwOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODozNzoxMlrOFgT_sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQwODowMjoxM1rOFkgl7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNjM1NQ==", "bodyText": "I feel like if we move the complex logic to a function it would enhance readability. WDYT?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r369426355", "createdAt": "2020-01-22T08:37:12Z", "author": {"login": "dulvinw"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -202,7 +202,7 @@ private boolean isDistinctSymbol(DiagnosticPos pos, BSymbol symbol, BSymbol foun\n         }\n \n         // Type names should be unique and cannot be shadowed\n-        if ((foundSym.tag & SymTag.TYPE) == SymTag.TYPE) {\n+        if ((foundSym.tag & SymTag.TYPE) == SymTag.TYPE && !((foundSym.tag & SymTag.CONSTANT) == SymTag.CONSTANT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgyNzA1Mg==", "bodyText": "It is not used anymore.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r373827052", "createdAt": "2020-02-02T08:02:13Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -202,7 +202,7 @@ private boolean isDistinctSymbol(DiagnosticPos pos, BSymbol symbol, BSymbol foun\n         }\n \n         // Type names should be unique and cannot be shadowed\n-        if ((foundSym.tag & SymTag.TYPE) == SymTag.TYPE) {\n+        if ((foundSym.tag & SymTag.TYPE) == SymTag.TYPE && !((foundSym.tag & SymTag.CONSTANT) == SymTag.CONSTANT)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNjM1NQ=="}, "originalCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTEwMzQ5OnYy", "diffSide": "RIGHT", "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/assign/var-negative.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNDo0MDo0NVrOFi8bNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDozMzoxOFrOFkzXSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4NTkxMA==", "bodyText": "Shall we add more test cases? Eg- #10865 (comment)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r372185910", "createdAt": "2020-01-29T04:40:45Z", "author": {"login": "Shan1024"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/assign/var-negative.bal", "diffHunk": "@@ -73,3 +73,8 @@ function test10 () {\n     var x = <Foo> bar;\n     string result1 = x + ex;\n }\n+\n+function test11 () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEzNDYwMg==", "bodyText": "Added more test cases.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r374134602", "createdAt": "2020-02-03T14:33:18Z", "author": {"login": "KavinduZoysa"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/statements/assign/var-negative.bal", "diffHunk": "@@ -73,3 +73,8 @@ function test10 () {\n     var x = <Foo> bar;\n     string result1 = x + ex;\n }\n+\n+function test11 () {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE4NTkxMA=="}, "originalCommit": {"oid": "b5f5cb2376e8e5b5eaa4aa29345d2bd06bf3114c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMDA4MTc2OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToxOToyOFrOFlwoDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyMTo1OVrOFlwtRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzODMxNw==", "bodyText": "is this todo still relevant? expSymTag seems to be removed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375138317", "createdAt": "2020-02-05T09:19:28Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -135,15 +135,31 @@ public SymbolResolver(CompilerContext context) {\n         this.types = Types.getInstance(context);\n     }\n \n-    public boolean checkForUniqueSymbol(DiagnosticPos pos, SymbolEnv env, BSymbol symbol, int expSymTag) {\n+    // TODO : Remove the 'expSymTag'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a01cc16ff5aa498ac0025f8fc110b53beac3b989"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzOTY1Mg==", "bodyText": "Yes, it is removed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375139652", "createdAt": "2020-02-05T09:21:59Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -135,15 +135,31 @@ public SymbolResolver(CompilerContext context) {\n         this.types = Types.getInstance(context);\n     }\n \n-    public boolean checkForUniqueSymbol(DiagnosticPos pos, SymbolEnv env, BSymbol symbol, int expSymTag) {\n+    // TODO : Remove the 'expSymTag'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzODMxNw=="}, "originalCommit": {"oid": "a01cc16ff5aa498ac0025f8fc110b53beac3b989"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMDEwMjg1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyNTo1NlrOFlw04Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzoyMzo0NlrOFn_KRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ==", "bodyText": "Shall we rephrase this method? Something like lookupSymbolInMainSpace?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375141601", "createdAt": "2020-02-05T09:25:56Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTc5NA==", "bodyText": "Same goes for the rest of the such methods as well", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r375141794", "createdAt": "2020-02-05T09:26:22Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAzMjYzMQ==", "bodyText": "Or lookupInMainSymbolSpace", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377032631", "createdAt": "2020-02-10T12:27:23Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3MzYwNw==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377473607", "createdAt": "2020-02-11T07:23:46Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolResolver.java", "diffHunk": "@@ -546,6 +537,22 @@ public BSymbol lookupSymbol(SymbolEnv env, Name name, int expSymTag) {\n         return symTable.notFoundSymbol;\n     }\n \n+    public BSymbol lookupMainSpaceSymbol(SymbolEnv env, Name name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MTYwMQ=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 143}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjYyNTk4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToxNjozMlrOFmvlyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMDoxODozMlrOFnUTHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE2OTkyOA==", "bodyText": "Shouldn't we verify the resolved symbol is a variable here? I think we should.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376169928", "createdAt": "2020-02-07T01:16:32Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1579,8 +1579,7 @@ private boolean workerExists(BType type, String workerName) {\n \n     // Asynchronous Send Statement\n     public void visit(BLangWorkerSend workerSendNode) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerSendNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc3MTM1OA==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376771358", "createdAt": "2020-02-09T10:18:32Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1579,8 +1579,7 @@ private boolean workerExists(BType type, String workerName) {\n \n     // Asynchronous Send Statement\n     public void visit(BLangWorkerSend workerSendNode) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerSendNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE2OTkyOA=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjYyNzI0OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToxNzoyMVrOFmvmhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMDoxODo0NFrOFnUTMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3MDExOQ==", "bodyText": "Need to check for an Object symbol after this.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376170119", "createdAt": "2020-02-07T01:17:21Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -301,7 +301,7 @@ private void handleServiceTypeProcesses(CompilerPlugin plugin) {\n             BPackageSymbol symbol = this.packageCache.getSymbol(packageQName);\n             if (symbol != null) {\n                 SymbolEnv pkgEnv = symTable.pkgEnvMap.get(symbol);\n-                final BSymbol listenerSymbol = symResolver.lookupSymbol(pkgEnv, listenerName, SymTag.OBJECT);\n+                final BSymbol listenerSymbol = symResolver.lookupMainSpaceSymbol(pkgEnv, listenerName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc3MTM3Nw==", "bodyText": "Changed", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376771377", "createdAt": "2020-02-09T10:18:44Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -301,7 +301,7 @@ private void handleServiceTypeProcesses(CompilerPlugin plugin) {\n             BPackageSymbol symbol = this.packageCache.getSymbol(packageQName);\n             if (symbol != null) {\n                 SymbolEnv pkgEnv = symTable.pkgEnvMap.get(symbol);\n-                final BSymbol listenerSymbol = symResolver.lookupSymbol(pkgEnv, listenerName, SymTag.OBJECT);\n+                final BSymbol listenerSymbol = symResolver.lookupMainSpaceSymbol(pkgEnv, listenerName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3MDExOQ=="}, "originalCommit": {"oid": "525b3c2d96d72216cde694a62eb072797f688d87"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTc5ODg5OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNjozM1rOFnemHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMjoyNjo0NFrOFnkOow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDA2Mg==", "bodyText": "We need to add SymTag validation here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376940062", "createdAt": "2020-02-10T09:16:33Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -576,7 +576,7 @@ public void visit(BLangInvocation invocationExpr) {\n \n             // Todo: test lambdas and function arguments\n \n-            BSymbol dependsOnFunctionSym = symResolver.lookupSymbol(this.env, name, SymTag.FUNCTION);\n+            BSymbol dependsOnFunctionSym = symResolver.lookupMainSpaceSymbol(this.env, name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAzMjM1NQ==", "bodyText": "Same comment as above. For phases after semantic analyzer, we don't need to validate the sym tag since it would already have been caught if the sym tag was invalid.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377032355", "createdAt": "2020-02-10T12:26:44Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DataflowAnalyzer.java", "diffHunk": "@@ -576,7 +576,7 @@ public void visit(BLangInvocation invocationExpr) {\n \n             // Todo: test lambdas and function arguments\n \n-            BSymbol dependsOnFunctionSym = symResolver.lookupSymbol(this.env, name, SymTag.FUNCTION);\n+            BSymbol dependsOnFunctionSym = symResolver.lookupMainSpaceSymbol(this.env, name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDA2Mg=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTgwMTI3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNzoxNFrOFnengQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNjo1Mzo1N1rOFn-vYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDQxNw==", "bodyText": "We need to add SymTag validation here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376940417", "createdAt": "2020-02-10T09:17:14Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1644,8 +1647,7 @@ private BType createAccumulatedErrorTypeForMatchingRecive(DiagnosticPos pos, BTy\n \n     @Override\n     public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(syncSendExpr.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(syncSendExpr.workerIdentifier));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxNTc2Mw==", "bodyText": "I think this is ok. By this time, the receiver seems to be validated to be a worker. For example,\nfunction process() returns string {\n    string ss = \":\";\n\n    worker w1 {\n        int a = 10;\n        a ->> ss;\n    }\n\n    worker w2 {\n        io:println(\"In w2\");\n    }\n\n    wait w1;\n\n    return \"done\";\n}\nThe above results in the following error:\nundefined worker 'ss'", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377015763", "createdAt": "2020-02-10T11:49:09Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1644,8 +1647,7 @@ private BType createAccumulatedErrorTypeForMatchingRecive(DiagnosticPos pos, BTy\n \n     @Override\n     public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(syncSendExpr.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(syncSendExpr.workerIdentifier));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDQxNw=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ2NjcyMQ==", "bodyText": "Tested the above example with this change, and it throws above error", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377466721", "createdAt": "2020-02-11T06:53:57Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1644,8 +1647,7 @@ private BType createAccumulatedErrorTypeForMatchingRecive(DiagnosticPos pos, BTy\n \n     @Override\n     public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(syncSendExpr.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(syncSendExpr.workerIdentifier));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDQxNw=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTgwMTk3OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToxNzoyMlrOFnen4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzoyNTowOFrOFn_Lvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDUxMg==", "bodyText": "We need to add SymTag validation here.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376940512", "createdAt": "2020-02-10T09:17:22Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1672,8 +1674,7 @@ public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n     public void visit(BLangWorkerReceive workerReceiveNode) {\n         // Validate worker receive\n         validateActionParentNode(workerReceiveNode.pos, workerReceiveNode);\n-        BSymbol sender = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerReceiveNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol sender = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerReceiveNode.workerIdentifier));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3Mzk4Mw==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377473983", "createdAt": "2020-02-11T07:25:08Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1672,8 +1674,7 @@ public void visit(BLangWorkerSyncSendExpr syncSendExpr) {\n     public void visit(BLangWorkerReceive workerReceiveNode) {\n         // Validate worker receive\n         validateActionParentNode(workerReceiveNode.pos, workerReceiveNode);\n-        BSymbol sender = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerReceiveNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol sender = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerReceiveNode.workerIdentifier));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MDUxMg=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTgxMjQxOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToyMDoyOFrOFneuDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzowMDoxOVrOFn-1Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MjA5Mw==", "bodyText": "I think this validation is not needed. types are defined only in the main symbol space.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376942093", "createdAt": "2020-02-10T09:20:28Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "diffHunk": "@@ -323,11 +323,17 @@ private BSymbol resolveFullyQualifiedSymbol(DiagnosticPos pos, SymbolEnv env, St\n \n         // If there is no type in the reference we need to search in the package level and the current scope only.\n         if (typeName == Names.EMPTY) {\n-            return symResolver.lookupSymbolInPackage(pos, env, pkgName, identifierName, tag);\n+            if ((tag & SymTag.IMPORT) == SymTag.IMPORT) {\n+                return symResolver.lookupPrefixSpaceSymbolInPackage(pos, env, pkgName, identifierName);\n+            } else if ((tag & SymTag.ANNOTATION) == SymTag.ANNOTATION) {\n+                return symResolver.lookupAnnotationSpaceSymbolInPackage(pos, env, pkgName, identifierName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ2ODE4Nw==", "bodyText": "But according to this, SymTag can be ANNOTATION, or IMPORT. Therefore don't we need to validate the symbol.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377468187", "createdAt": "2020-02-11T07:00:19Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "diffHunk": "@@ -323,11 +323,17 @@ private BSymbol resolveFullyQualifiedSymbol(DiagnosticPos pos, SymbolEnv env, St\n \n         // If there is no type in the reference we need to search in the package level and the current scope only.\n         if (typeName == Names.EMPTY) {\n-            return symResolver.lookupSymbolInPackage(pos, env, pkgName, identifierName, tag);\n+            if ((tag & SymTag.IMPORT) == SymTag.IMPORT) {\n+                return symResolver.lookupPrefixSpaceSymbolInPackage(pos, env, pkgName, identifierName);\n+            } else if ((tag & SymTag.ANNOTATION) == SymTag.ANNOTATION) {\n+                return symResolver.lookupAnnotationSpaceSymbolInPackage(pos, env, pkgName, identifierName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MjA5Mw=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTgxOTI1OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOToyMjozNFrOFnex-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzoyMTo0MlrOFn_IRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MzA5OA==", "bodyText": "Need to validate SymTag.CONSTANT", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376943098", "createdAt": "2020-02-10T09:22:34Z", "author": {"login": "hasithaa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -1419,8 +1419,8 @@ private boolean validateErrorReasonMatchPatternSyntax(BLangErrorVariable errorVa\n                 && errorVariable.reasonMatchConst == null\n                 && isReasonSpecified(errorVariable)) {\n \n-            BSymbol reasonConst = symResolver.lookupSymbol(\n-                    this.env.enclEnv, names.fromString(errorVariable.reason.name.value), SymTag.CONSTANT);\n+            BSymbol reasonConst = symResolver.lookupMainSpaceSymbol(this.env.enclEnv,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3MzA5Mg==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377473092", "createdAt": "2020-02-11T07:21:42Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -1419,8 +1419,8 @@ private boolean validateErrorReasonMatchPatternSyntax(BLangErrorVariable errorVa\n                 && errorVariable.reasonMatchConst == null\n                 && isReasonSpecified(errorVariable)) {\n \n-            BSymbol reasonConst = symResolver.lookupSymbol(\n-                    this.env.enclEnv, names.fromString(errorVariable.reason.name.value), SymTag.CONSTANT);\n+            BSymbol reasonConst = symResolver.lookupMainSpaceSymbol(this.env.enclEnv,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MzA5OA=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjE4MzMzOnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMToxMDozNlrOFniONg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzoyMzoyNlrOFn_J2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5OTQ3OA==", "bodyText": "This logic with the use of a temp var is unnecessary right? Since we are verifying that it is var sym tag, we can do the following:\nBSymbol receiver = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));\nif ((receiver.tag & SymTag.VARIABLE) == SymTag.VARIABLE) {\n    receiver = symTable.notFoundSymbol;\n}", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r376999478", "createdAt": "2020-02-10T11:10:36Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1579,8 +1579,11 @@ private boolean workerExists(BType type, String workerName) {\n \n     // Asynchronous Send Statement\n     public void visit(BLangWorkerSend workerSendNode) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerSendNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symTable.notFoundSymbol;\n+        BSymbol tempSymbol = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));\n+        if ((tempSymbol.tag & SymTag.VARIABLE) == SymTag.VARIABLE) {\n+            receiver = tempSymbol;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3MzQ5OQ==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377473499", "createdAt": "2020-02-11T07:23:26Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -1579,8 +1579,11 @@ private boolean workerExists(BType type, String workerName) {\n \n     // Asynchronous Send Statement\n     public void visit(BLangWorkerSend workerSendNode) {\n-        BSymbol receiver = symResolver.lookupSymbol(env,\n-                names.fromIdNode(workerSendNode.workerIdentifier), SymTag.VARIABLE);\n+        BSymbol receiver = symTable.notFoundSymbol;\n+        BSymbol tempSymbol = symResolver.lookupMainSpaceSymbol(env, names.fromIdNode(workerSendNode.workerIdentifier));\n+        if ((tempSymbol.tag & SymTag.VARIABLE) == SymTag.VARIABLE) {\n+            receiver = tempSymbol;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5OTQ3OA=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjMwNzE4OnYy", "diffSide": "RIGHT", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo1Njo1NVrOFnjbMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNzoyMzozNFrOFn_KCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxOTE4Nw==", "bodyText": "Similar concern as above regarding the use of a temp var", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377019187", "createdAt": "2020-02-10T11:56:55Z", "author": {"login": "pubudu91"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -301,8 +301,10 @@ private void handleServiceTypeProcesses(CompilerPlugin plugin) {\n             BPackageSymbol symbol = this.packageCache.getSymbol(packageQName);\n             if (symbol != null) {\n                 SymbolEnv pkgEnv = symTable.pkgEnvMap.get(symbol);\n-                final BSymbol listenerSymbol = symResolver.lookupSymbol(pkgEnv, listenerName, SymTag.OBJECT);\n-                if (listenerSymbol != symTable.notFoundSymbol) {\n+                BSymbol listenerSymbol;\n+                BSymbol tempListenerSymbol = symResolver.lookupMainSpaceSymbol(pkgEnv, listenerName);\n+                if ((tempListenerSymbol.tag & SymTag.OBJECT) == SymTag.OBJECT) {\n+                    listenerSymbol = tempListenerSymbol;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3MzU0Nw==", "bodyText": "Done", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20681#discussion_r377473547", "createdAt": "2020-02-11T07:23:34Z", "author": {"login": "KavinduZoysa"}, "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java", "diffHunk": "@@ -301,8 +301,10 @@ private void handleServiceTypeProcesses(CompilerPlugin plugin) {\n             BPackageSymbol symbol = this.packageCache.getSymbol(packageQName);\n             if (symbol != null) {\n                 SymbolEnv pkgEnv = symTable.pkgEnvMap.get(symbol);\n-                final BSymbol listenerSymbol = symResolver.lookupSymbol(pkgEnv, listenerName, SymTag.OBJECT);\n-                if (listenerSymbol != symTable.notFoundSymbol) {\n+                BSymbol listenerSymbol;\n+                BSymbol tempListenerSymbol = symResolver.lookupMainSpaceSymbol(pkgEnv, listenerName);\n+                if ((tempListenerSymbol.tag & SymTag.OBJECT) == SymTag.OBJECT) {\n+                    listenerSymbol = tempListenerSymbol;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxOTE4Nw=="}, "originalCommit": {"oid": "8aa4acbb4bcd233aeb9bd0f6478393f120c7411c"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 529, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}