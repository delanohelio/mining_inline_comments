{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNTEyNDE5", "number": 20598, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNjo0MDo1MlrODYZutg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNjo0MDo1MlrODYZutg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTEzOTc0OnYy", "diffSide": "RIGHT", "path": "tool-plugins/intellij/src/main/java/io/ballerina/plugins/idea/editor/inserthandlers/BallerinaEnterInDocumentationHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNjo0MDo1MlrOFePWhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNzo1OToyNFrOFeQthw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1MzEyNw==", "bodyText": "Better to use method documentation format instead of the single line comment", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20598#discussion_r367253127", "createdAt": "2020-01-16T06:40:52Z", "author": {"login": "nadeeshaan"}, "path": "tool-plugins/intellij/src/main/java/io/ballerina/plugins/idea/editor/inserthandlers/BallerinaEnterInDocumentationHandler.java", "diffHunk": "@@ -29,48 +30,53 @@\n import org.jetbrains.annotations.NotNull;\n \n /**\n- * Handles the enter key press in braces.\n+ * Handles the enter key press events within ballerina documentation.\n  */\n public class BallerinaEnterInDocumentationHandler extends EnterHandlerDelegateAdapter {\n \n+    private static final String BAL_DOC_PREFIX = \"#\";\n+\n     @Override\n     public Result postProcessEnter(@NotNull PsiFile file, @NotNull Editor editor, @NotNull DataContext dataContext) {\n-        if (!file.getLanguage().is(BallerinaLanguage.INSTANCE)) {\n+\n+        if (!file.getLanguage().is(BallerinaLanguage.INSTANCE) || editor.isDisposed()) {\n             return Result.Continue;\n         }\n+        Document doc = editor.getDocument();\n+\n         // We need to save the file before checking. Otherwise issues can occur when we press enter in a string.\n         Project project = file.getProject();\n-        PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());\n+        PsiDocumentManager.getInstance(project).commitDocument(doc);\n \n-        // Checks whether the previous line starts with \"#\".\n         LogicalPosition caretPos = editor.getCaretModel().getLogicalPosition();\n         int prevLine = caretPos.line - 1;\n-        String lineString = editor.getDocument().getText(\n-                new TextRange(editor.getDocument().getLineStartOffset(prevLine),\n-                        editor.getDocument().getLineEndOffset(prevLine))).trim();\n-        if (lineString.startsWith(\"#\")) {\n-            int newCol = lineString.replace(\"\\t\", \"    \").indexOf(\"#\");\n-            String enteredText = editor.getDocument().getText(\n-                    new TextRange(editor.getDocument().getLineStartOffset(caretPos.line),\n-                            editor.getDocument().getLineEndOffset(caretPos.line))).trim();\n-            editor.getDocument().deleteString(editor.getDocument().getLineStartOffset(caretPos.line),\n-                    editor.getDocument().getLineEndOffset(caretPos.line));\n-            editor.getCaretModel().moveToLogicalPosition(new LogicalPosition(caretPos.line, 1));\n-            enterNewLine(editor, enteredText, newCol);\n+        String lineString = doc.getText(new TextRange(doc.getLineStartOffset(prevLine),\n+                doc.getLineEndOffset(prevLine)));\n \n+        if (lineString.trim().startsWith(BAL_DOC_PREFIX)) {\n+            addNewline(editor, doc, lineString, caretPos);\n             // Commit the document.\n-            PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());\n+            PsiDocumentManager.getInstance(project).commitDocument(doc);\n         }\n         return Result.Continue;\n     }\n \n-    private void enterNewLine(Editor editor, String str, int col) {\n-        StringBuilder strBuilder = new StringBuilder(\"# \" + str);\n-        // Left padding with whitespaces in order to be vertically aligned with the previous doc line.\n-        for (int i = 0; i < col; i++) {\n+    // Inserts the splitted documentation at the next line.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "295d5f881ca46a713dcb1296578ad865e2736fbe"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI3NTM5OQ==", "bodyText": "@nadeeshaan As per my knowledge,\n\njavadocs comes forward when the info presents which the user of a class needs to know and\nInfo that a developer modifying a class needs to know might better go into a normal comment (block or line).\n\nAbove context (private method without function args descriptions) is more related to the scenario (2) IMO :) WDYT?\nPlease also refer this SO Thread as well.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20598#discussion_r367275399", "createdAt": "2020-01-16T07:59:24Z", "author": {"login": "NipunaRanasinghe"}, "path": "tool-plugins/intellij/src/main/java/io/ballerina/plugins/idea/editor/inserthandlers/BallerinaEnterInDocumentationHandler.java", "diffHunk": "@@ -29,48 +30,53 @@\n import org.jetbrains.annotations.NotNull;\n \n /**\n- * Handles the enter key press in braces.\n+ * Handles the enter key press events within ballerina documentation.\n  */\n public class BallerinaEnterInDocumentationHandler extends EnterHandlerDelegateAdapter {\n \n+    private static final String BAL_DOC_PREFIX = \"#\";\n+\n     @Override\n     public Result postProcessEnter(@NotNull PsiFile file, @NotNull Editor editor, @NotNull DataContext dataContext) {\n-        if (!file.getLanguage().is(BallerinaLanguage.INSTANCE)) {\n+\n+        if (!file.getLanguage().is(BallerinaLanguage.INSTANCE) || editor.isDisposed()) {\n             return Result.Continue;\n         }\n+        Document doc = editor.getDocument();\n+\n         // We need to save the file before checking. Otherwise issues can occur when we press enter in a string.\n         Project project = file.getProject();\n-        PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());\n+        PsiDocumentManager.getInstance(project).commitDocument(doc);\n \n-        // Checks whether the previous line starts with \"#\".\n         LogicalPosition caretPos = editor.getCaretModel().getLogicalPosition();\n         int prevLine = caretPos.line - 1;\n-        String lineString = editor.getDocument().getText(\n-                new TextRange(editor.getDocument().getLineStartOffset(prevLine),\n-                        editor.getDocument().getLineEndOffset(prevLine))).trim();\n-        if (lineString.startsWith(\"#\")) {\n-            int newCol = lineString.replace(\"\\t\", \"    \").indexOf(\"#\");\n-            String enteredText = editor.getDocument().getText(\n-                    new TextRange(editor.getDocument().getLineStartOffset(caretPos.line),\n-                            editor.getDocument().getLineEndOffset(caretPos.line))).trim();\n-            editor.getDocument().deleteString(editor.getDocument().getLineStartOffset(caretPos.line),\n-                    editor.getDocument().getLineEndOffset(caretPos.line));\n-            editor.getCaretModel().moveToLogicalPosition(new LogicalPosition(caretPos.line, 1));\n-            enterNewLine(editor, enteredText, newCol);\n+        String lineString = doc.getText(new TextRange(doc.getLineStartOffset(prevLine),\n+                doc.getLineEndOffset(prevLine)));\n \n+        if (lineString.trim().startsWith(BAL_DOC_PREFIX)) {\n+            addNewline(editor, doc, lineString, caretPos);\n             // Commit the document.\n-            PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());\n+            PsiDocumentManager.getInstance(project).commitDocument(doc);\n         }\n         return Result.Continue;\n     }\n \n-    private void enterNewLine(Editor editor, String str, int col) {\n-        StringBuilder strBuilder = new StringBuilder(\"# \" + str);\n-        // Left padding with whitespaces in order to be vertically aligned with the previous doc line.\n-        for (int i = 0; i < col; i++) {\n+    // Inserts the splitted documentation at the next line.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1MzEyNw=="}, "originalCommit": {"oid": "295d5f881ca46a713dcb1296578ad865e2736fbe"}, "originalPosition": 64}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 642, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}