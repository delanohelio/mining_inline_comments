{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMjMyNDgz", "number": 21278, "title": "Fix typetest equality check in TypeChecker", "bodyText": "Purpose\n\nFix typetest in typechecker for typedefs.\n\nFixes #21225\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-26T12:54:12Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278", "merged": true, "mergeCommit": {"oid": "4c080eddff726b45329cbbc81c1938f091673b1b"}, "closed": true, "closedAt": "2020-02-28T07:59:23Z", "author": {"login": "dulvinw"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIGN0YAH2gAyMzgwMjMyNDgzOmE5Y2JmN2IwNGZiMmVkZmE3ZmIwMDg3OTYxZDY3MDY0NzU1NTg2MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIrOhDgFqTM2NjIxNDA5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a9cbf7b04fb2edfa7fb0087961d6706475558602", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a9cbf7b04fb2edfa7fb0087961d6706475558602", "committedDate": "2020-02-26T12:52:00Z", "message": "Fix typetest for Typedefs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77c34db61d196cfd41005b0a447cd6cee748c45e", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/77c34db61d196cfd41005b0a447cd6cee748c45e", "committedDate": "2020-02-26T16:35:27Z", "message": "Fix checkstyle errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/417fc6b2f85504f6bc8c0196e18955504b9d52c3", "committedDate": "2020-02-26T17:09:04Z", "message": "Add checkstyle fixes 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NDI4OTc0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#pullrequestreview-365428974", "createdAt": "2020-02-27T05:53:20Z", "commit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNTo1MzoyMFrOFvGAPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjowMjoxNFrOFvGIxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkyNTc1Nw==", "bodyText": "Shouldn't this go into checkIsRecursiveType similar to maps, lists, etc.?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#discussion_r384925757", "createdAt": "2020-02-27T05:53:20Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -502,6 +503,8 @@ public static boolean checkIsType(BType sourceType, BType targetType, List<TypeP\n                 return checkIsServiceType(sourceType);\n             case TypeTags.HANDLE_TAG:\n                 return sourceType.getTag() == TypeTags.HANDLE_TAG;\n+            case TypeTags.TYPEDESC_TAG:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkyNTkyMw==", "bodyText": "Shall we pass down the unresolved types also and use it when calling checkIsType for the constraint?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#discussion_r384925923", "createdAt": "2020-02-27T05:54:03Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -510,6 +513,15 @@ public static boolean checkIsType(BType sourceType, BType targetType, List<TypeP\n \n     // Private methods\n \n+    private static boolean checkTypeDescType(BType sourceType, BTypedescType targetType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkyNjcyNg==", "bodyText": "Should we call .equals() instead?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#discussion_r384926726", "createdAt": "2020-02-27T05:57:36Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/types/BTypedescType.java", "diffHunk": "@@ -52,6 +52,17 @@ public int getTag() {\n         return TypeTags.TYPEDESC_TAG;\n     }\n \n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        }\n+        if (obj instanceof BTypedescType) {\n+            return constraint == ((BTypedescType) obj).getConstraint();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkyNzk0Mg==", "bodyText": "Instead of importing http shall we introduce a new object here?\nOr if the test is for an object from an imported module, shall we use something from langlib or just add a separate balo test?\nAlso, I guess it would be better to move these tests to TypeGuardTest.java and test type narrowing also?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#discussion_r384927942", "createdAt": "2020-02-27T06:02:14Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/typedesc/typedesc_positive.bal", "diffHunk": "@@ -1,3 +1,5 @@\n+import ballerina/http;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NDM5MDkw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#pullrequestreview-365439090", "createdAt": "2020-02-27T06:27:21Z", "commit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyNzoyMVrOFvGg_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyNzoyMVrOFvGg_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzNDE0Mg==", "bodyText": "Do we need the describingType field anymore, since that is already there in the type now?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#discussion_r384934142", "createdAt": "2020-02-27T06:27:21Z", "author": {"login": "SupunS"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/TypedescValue.java", "diffHunk": "@@ -44,7 +44,7 @@\n \n     @Deprecated\n     public TypedescValue(BType describingType) {\n-        this.type = BTypes.typeTypedesc;\n+        this.type = new BTypedescType(describingType);\n         this.describingType = describingType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "417fc6b2f85504f6bc8c0196e18955504b9d52c3"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ec475b05be3be82c2ffa1267801e50d0cb389d", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/16ec475b05be3be82c2ffa1267801e50d0cb389d", "committedDate": "2020-02-27T09:43:42Z", "message": "Fix review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3bb04f193db7ccae1fdbf223dcbf3e3aac6c55d", "author": {"user": {"login": "dulvinw", "name": "Dulvin Witharane"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3bb04f193db7ccae1fdbf223dcbf3e3aac6c55d", "committedDate": "2020-02-28T05:06:46Z", "message": "Revert unneccesary file changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjE0MDkw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21278#pullrequestreview-366214090", "createdAt": "2020-02-28T07:59:15Z", "commit": {"oid": "d3bb04f193db7ccae1fdbf223dcbf3e3aac6c55d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4030, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}