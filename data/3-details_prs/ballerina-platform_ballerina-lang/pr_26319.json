{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNjMzMTU3", "number": 26319, "title": "Fix issue when calling function with error return in service", "bodyText": "Purpose\nResolve #24795\nApproach\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nSamples\nN/A\nRemarks\nN/A\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-10-12T14:58:12Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26319", "merged": true, "mergeCommit": {"oid": "60ddca903ee77866e61b874b0f1d713623211104"}, "closed": true, "closedAt": "2020-10-16T05:13:09Z", "author": {"login": "riyafa"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSBN1IgBqjM4NjkyNjY5OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS_RneAFqTUxMDA5MzQwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e72fda3acb949c7f57053b17dede561e526b5952", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e72fda3acb949c7f57053b17dede561e526b5952", "committedDate": "2020-10-12T14:57:47Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}, "afterCommit": {"oid": "e19c7e9b0d10365c1b365f3dcbb65d57e4b0d4b0", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e19c7e9b0d10365c1b365f3dcbb65d57e4b0d4b0", "committedDate": "2020-10-13T04:52:33Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDcwMDg5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26319#pullrequestreview-507070089", "createdAt": "2020-10-13T05:01:15Z", "commit": {"oid": "e19c7e9b0d10365c1b365f3dcbb65d57e4b0d4b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNTowMToxNVrOHgVc-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNTowMToxNVrOHgVc-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY2Nzk2MQ==", "bodyText": "Can you use the BRuntime api's to do this invocation? BExecutor will be removed.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26319#discussion_r503667961", "createdAt": "2020-10-13T05:01:15Z", "author": {"login": "Kishanthan"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/nativeimpl/jvm/tests/MockListener.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.nativeimpl.jvm.tests;\n+\n+import org.ballerinalang.jvm.api.BExecutor;\n+import org.ballerinalang.jvm.api.connector.CallableUnitCallback;\n+import org.ballerinalang.jvm.api.values.BError;\n+import org.ballerinalang.jvm.api.values.BObject;\n+import org.ballerinalang.jvm.api.values.BString;\n+import org.ballerinalang.jvm.scheduling.Scheduler;\n+\n+import java.util.HashMap;\n+import java.util.concurrent.CountDownLatch;\n+\n+/**\n+ * A mock listener for testing services. It can be used to invoke a resource in the service.\n+ */\n+public class MockListener {\n+\n+    private static BObject service;\n+    private static BError err;\n+\n+    public static Object attach(BObject servObj) {\n+        service = servObj;\n+        return null;\n+    }\n+\n+    public static Object invokeResource(BString name) throws InterruptedException {\n+        if (service != null) {\n+            CountDownLatch latch = new CountDownLatch(1);\n+            BExecutor.submit(Scheduler.getStrand().scheduler, service, name.getValue(), null, null,\n+                             new CallableUnitCallback() {\n+                                 @Override\n+                                 public void notifySuccess() {\n+                                     latch.countDown();\n+                                 }\n+\n+                                 @Override\n+                                 public void notifyFailure(BError error) {\n+                                     err = error;\n+                                     latch.countDown();\n+                                 }\n+                             }, new HashMap<>(), null);\n+            latch.await();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e19c7e9b0d10365c1b365f3dcbb65d57e4b0d4b0"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e19c7e9b0d10365c1b365f3dcbb65d57e4b0d4b0", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e19c7e9b0d10365c1b365f3dcbb65d57e4b0d4b0", "committedDate": "2020-10-13T04:52:33Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}, "afterCommit": {"oid": "954c3642a764be1c56f6ea887eb62a6588129d7a", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/954c3642a764be1c56f6ea887eb62a6588129d7a", "committedDate": "2020-10-13T07:53:32Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "954c3642a764be1c56f6ea887eb62a6588129d7a", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/954c3642a764be1c56f6ea887eb62a6588129d7a", "committedDate": "2020-10-13T07:53:32Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}, "afterCommit": {"oid": "e1ffc76aac0cef9af9f12c43e17e03fe6450ccbf", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e1ffc76aac0cef9af9f12c43e17e03fe6450ccbf", "committedDate": "2020-10-14T09:05:22Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1ffc76aac0cef9af9f12c43e17e03fe6450ccbf", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e1ffc76aac0cef9af9f12c43e17e03fe6450ccbf", "committedDate": "2020-10-14T09:05:22Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}, "afterCommit": {"oid": "6c23db1ad20c3b3b6f2cee3485713d49071e8f6e", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6c23db1ad20c3b3b6f2cee3485713d49071e8f6e", "committedDate": "2020-10-14T10:29:16Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NTI1MTgy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26319#pullrequestreview-508525182", "createdAt": "2020-10-14T16:28:18Z", "commit": {"oid": "6c23db1ad20c3b3b6f2cee3485713d49071e8f6e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36be68c8eb0a359171e60a7a28d52d7f7f4489d3", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/36be68c8eb0a359171e60a7a28d52d7f7f4489d3", "committedDate": "2020-10-15T00:53:44Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c23db1ad20c3b3b6f2cee3485713d49071e8f6e", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6c23db1ad20c3b3b6f2cee3485713d49071e8f6e", "committedDate": "2020-10-14T10:29:16Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}, "afterCommit": {"oid": "36be68c8eb0a359171e60a7a28d52d7f7f4489d3", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/36be68c8eb0a359171e60a7a28d52d7f7f4489d3", "committedDate": "2020-10-15T00:53:44Z", "message": "Fix issue when calling function with error return in service\n\nThe issue is in generating the method call of a function in a service. Earlier since only resources were allowed in a service the method calls of all functions in a service were throwing errors when it has an error return. Now a check has been added to throw an error only for a resource.\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/24795"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDkzNDAz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26319#pullrequestreview-510093403", "createdAt": "2020-10-16T05:11:08Z", "commit": {"oid": "36be68c8eb0a359171e60a7a28d52d7f7f4489d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4583, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}