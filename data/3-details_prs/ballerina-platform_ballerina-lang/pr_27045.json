{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NjI3MTEw", "number": 27045, "title": "Fix zero-based error line and column numbers printing when compiling", "bodyText": "Purpose\n$title\nFixes #27043\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-11-20T11:02:45Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27045", "merged": true, "mergeCommit": {"oid": "bde0aafa517c5034722228dd30526349b5b447bf"}, "closed": true, "closedAt": "2020-11-23T05:11:57Z", "author": {"login": "dulajdilshan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeVMFRAH2gAyNTI0NjI3MTEwOmQ0MjgzMTYxNjI0ZjczMzRiMTIyY2Q0ZjJhM2NlNDQxNTEyMDRmMTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfOD1mgFqTUzNjE4MDY4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4283161624f7334b122cd4f2a3ce44151204f14", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d4283161624f7334b122cd4f2a3ce44151204f14", "committedDate": "2020-11-20T10:56:10Z", "message": "Fix zero-based error line number printing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzMzMzgz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27045#pullrequestreview-535333383", "createdAt": "2020-11-20T11:06:57Z", "commit": {"oid": "d4283161624f7334b122cd4f2a3ce44151204f14"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "808a14135ca4aad92c67e0271226f45a85ae4662", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/808a14135ca4aad92c67e0271226f45a85ae4662", "committedDate": "2020-11-20T11:16:49Z", "message": "Fix cli-test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTMxOTA0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27045#pullrequestreview-535531904", "createdAt": "2020-11-20T15:33:40Z", "commit": {"oid": "808a14135ca4aad92c67e0271226f45a85ae4662"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNTozMzo0MFrOH3UnKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNTozMzo0MFrOH3UnKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3MTQzMw==", "bodyText": "Is this the best way to handle this? \ud83e\udd14 My concern here is that the toString() of the Diagnostic impl is duplicated here. How about creating a copy of the whole Diagnostic instance? Maybe add a builder API to Diagnostic to make it easier to create copies of Diagnostic instances?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27045#discussion_r527771433", "createdAt": "2020-11-20T15:33:40Z", "author": {"login": "pubudu91"}, "path": "cli/ballerina-cli/src/main/java/io/ballerina/cli/task/CompileTask.java", "diffHunk": "@@ -63,9 +66,21 @@ public void execute(Project project) {\n         PackageCompilation packageCompilation = project.currentPackage().getCompilation();\n         JBallerinaBackend jBallerinaBackend = JBallerinaBackend.from(packageCompilation, JdkVersion.JAVA_11);\n         DiagnosticResult diagnosticResult = jBallerinaBackend.diagnosticResult();\n-        diagnosticResult.diagnostics().forEach(d -> err.println(d.toString()));\n+        diagnosticResult.diagnostics().forEach(d -> err.println(convertDiagnosticToString(d)));\n         if (diagnosticResult.hasErrors()) {\n             throw createLauncherException(\"compilation contains errors\");\n         }\n     }\n+\n+    private String convertDiagnosticToString(Diagnostic diagnostic) {\n+        LineRange lineRange = diagnostic.location().lineRange();\n+\n+        LineRange oneBasedLineRange = LineRange.from(\n+                lineRange.filePath(),\n+                LinePosition.from(lineRange.startLine().line() + 1, lineRange.startLine().offset() + 1),\n+                LinePosition.from(lineRange.endLine().line() + 1, lineRange.endLine().offset() + 1));\n+\n+        return diagnostic.diagnosticInfo().severity().toString() + \" [\" +\n+                oneBasedLineRange.filePath() + \":\" + oneBasedLineRange + \"] \" + diagnostic.message();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "808a14135ca4aad92c67e0271226f45a85ae4662"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTc3MzI4", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27045#pullrequestreview-536177328", "createdAt": "2020-11-23T04:55:31Z", "commit": {"oid": "808a14135ca4aad92c67e0271226f45a85ae4662"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTgwNjgy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27045#pullrequestreview-536180682", "createdAt": "2020-11-23T05:11:45Z", "commit": {"oid": "808a14135ca4aad92c67e0271226f45a85ae4662"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4934, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}